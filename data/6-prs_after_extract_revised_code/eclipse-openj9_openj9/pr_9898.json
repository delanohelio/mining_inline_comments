{"pr_number": 9898, "pr_title": "[Test] Adjust the setting of GC specific tests on RISC-V", "pr_createdAt": "2020-06-16T14:51:59Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/9898", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5NDU5OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9898#discussion_r441594598", "bodyText": "I believe you can just replace \"60\" to \"200\" regardless of platform. This extends valid range for parameter only.", "author": "dmitripivkine", "createdAt": "2020-06-17T14:35:51Z", "path": "test/functional/cmdLineTests/gcRegressionTests/src/com/ibm/tests/garbagecollector/SpinAllocate.java", "diffHunk": "@@ -29,18 +29,25 @@\n public class SpinAllocate\n {\n \tpublic static Object _objectHolder;\n+\t\n+\t/* Given that the jdk runs very slow on RISC-V, we have to increase \n+\t * the threshold value to ensure the test is completed.\n+\t */\n+\tprivate static String archName = System.getProperty(\"os.arch\");\n+\tprivate static boolean isRiscv = archName.toLowerCase().contains(\"riscv\");\n+\tprivate static int threshold = (isRiscv) ? 200 : 60;\n \n \t/**\n \t * @param args Takes one argument:  number of seconds to spin for before terminating with a message that the test ran to completion.\n-\t * This argument is required.  It must be in the range [1-60]\n+\t * This argument is required.  It must be in the range [1-200]\n \t */\n \tpublic static void main(String[] args)\n \t{\n \t\tif (1 == args.length)\n \t\t{\n \t\t\tint secondsToSpin = Integer.parseInt(args[0]);\n \n-\t\t\tif ((secondsToSpin >= 1) && (secondsToSpin <= 60))\n+\t\t\tif ((secondsToSpin >= 1) && (secondsToSpin <= threshold))", "originalCommit": "184e782aa8f8b7cca16e256ae2540fce24851f39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwODA3OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/9898#discussion_r441608079", "bodyText": "It makes more sense to me this way in terms of RISC-V.  Will update as long as it works for other platforms,  in which case the timeout setting on platforms might be adjusted accordingly.", "author": "ChengJin01", "createdAt": "2020-06-17T14:53:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5NDU5OA=="}], "type": "inlineReview", "revised_code": {"commit": "4a3cf770e7d03e53742c90c18e600597eba11891", "chunk": "diff --git a/test/functional/cmdLineTests/gcRegressionTests/src/com/ibm/tests/garbagecollector/SpinAllocate.java b/test/functional/cmdLineTests/gcRegressionTests/src/com/ibm/tests/garbagecollector/SpinAllocate.java\nindex f1f2b4517..a1628d552 100644\n--- a/test/functional/cmdLineTests/gcRegressionTests/src/com/ibm/tests/garbagecollector/SpinAllocate.java\n+++ b/test/functional/cmdLineTests/gcRegressionTests/src/com/ibm/tests/garbagecollector/SpinAllocate.java\n\n@@ -29,13 +29,6 @@ package com.ibm.tests.garbagecollector;\n public class SpinAllocate\n {\n \tpublic static Object _objectHolder;\n-\t\n-\t/* Given that the jdk runs very slow on RISC-V, we have to increase \n-\t * the threshold value to ensure the test is completed.\n-\t */\n-\tprivate static String archName = System.getProperty(\"os.arch\");\n-\tprivate static boolean isRiscv = archName.toLowerCase().contains(\"riscv\");\n-\tprivate static int threshold = (isRiscv) ? 200 : 60;\n \n \t/**\n \t * @param args Takes one argument:  number of seconds to spin for before terminating with a message that the test ran to completion.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTYwNzg4MA==", "url": "https://github.com/eclipse-openj9/openj9/pull/9898#discussion_r441607880", "bodyText": "From test correctness point of view we can replace \"5\" to \"200\" regardless of platform. The only issue with this it might increase hang detection time from 10 to 400 seconds. @llxia is it acceptable?", "author": "dmitripivkine", "createdAt": "2020-06-17T14:53:19Z", "path": "test/functional/Java8andUp/src/org/openj9/test/nogc/TestGCPolicyNogc.java", "diffHunk": "@@ -118,7 +125,7 @@ public void testGCPolicyNogc() {\n \t\twhile (allocator.isAlive()) {\n \t\t\ttry {\n \t\t\t\tcount++;\n-\t\t\t\tif (count > 5) {\n+\t\t\t\tif (count > threshold) {", "originalCommit": "184e782aa8f8b7cca16e256ae2540fce24851f39", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4a3cf770e7d03e53742c90c18e600597eba11891", "chunk": "diff --git a/test/functional/Java8andUp/src/org/openj9/test/nogc/TestGCPolicyNogc.java b/test/functional/Java8andUp/src/org/openj9/test/nogc/TestGCPolicyNogc.java\nindex a94dbcffb..0388254f0 100644\n--- a/test/functional/Java8andUp/src/org/openj9/test/nogc/TestGCPolicyNogc.java\n+++ b/test/functional/Java8andUp/src/org/openj9/test/nogc/TestGCPolicyNogc.java\n\n@@ -125,7 +118,7 @@ public class TestGCPolicyNogc {\n \t\twhile (allocator.isAlive()) {\n \t\t\ttry {\n \t\t\t\tcount++;\n-\t\t\t\tif (count > threshold) {\n+\t\t\t\tif (count > 200) {\n \t\t\t\t\tAllocator.bQuit = true;\n \t\t\t\t}\n \t\t\t\tThread.sleep(2*1000);\n"}}, {"oid": "4a3cf770e7d03e53742c90c18e600597eba11891", "url": "https://github.com/eclipse-openj9/openj9/commit/4a3cf770e7d03e53742c90c18e600597eba11891", "message": "[Test] Adjust the setting of GC specific tests on RISC-V\n\nThe test change is to update the initial memory setting &\nthe threshold values in GC specific tests to ensure the\nJVM works appropriately as expected in tests due to the\nlack of JIT on RISC-V.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-06-17T20:20:24Z", "type": "forcePushed"}, {"oid": "151838253c128f56c6a3aa8811467464594aca74", "url": "https://github.com/eclipse-openj9/openj9/commit/151838253c128f56c6a3aa8811467464594aca74", "message": "[Test] Adjust the setting of GC specific tests on RISC-V\n\nThe test change is to update the initial memory setting &\nthe threshold values in GC specific tests to ensure the\nJVM works appropriately as expected in tests due to the\nlack of JIT on RISC-V.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-07-06T15:13:26Z", "type": "forcePushed"}, {"oid": "5f3a1f6f69b045aecc0b52b0d4419cb8d27abb47", "url": "https://github.com/eclipse-openj9/openj9/commit/5f3a1f6f69b045aecc0b52b0d4419cb8d27abb47", "message": "[Test] Adjust the setting of GC specific tests on RISC-V\n\nThe test change is to update the initial memory setting &\nthe threshold values in GC specific tests to ensure the\nJVM works appropriately as expected in tests due to the\nlack of JIT on RISC-V.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-07-06T16:50:12Z", "type": "commit"}, {"oid": "5f3a1f6f69b045aecc0b52b0d4419cb8d27abb47", "url": "https://github.com/eclipse-openj9/openj9/commit/5f3a1f6f69b045aecc0b52b0d4419cb8d27abb47", "message": "[Test] Adjust the setting of GC specific tests on RISC-V\n\nThe test change is to update the initial memory setting &\nthe threshold values in GC specific tests to ensure the\nJVM works appropriately as expected in tests due to the\nlack of JIT on RISC-V.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-07-06T16:50:12Z", "type": "forcePushed"}]}