{"pr_number": 10389, "pr_title": "Not invoke Exception.printStackTrace() at early VM startup stage", "pr_createdAt": "2020-08-14T01:04:06Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10389", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NTI0OA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10389#discussion_r470375248", "bodyText": "Actually, can't cause be null?", "author": "gacholio", "createdAt": "2020-08-14T02:25:54Z", "path": "jcl/src/java.base/share/classes/java/lang/ClassLoader.java", "diffHunk": "@@ -265,7 +265,8 @@ static final void initializeClassLoaders() {\n \t\t\tSystem.bootLayer = jdk.internal.module.ModuleBootstrap.boot();\n \t\t/*[IF Java10]*/\n \t\t} catch (Exception ex) {\n-\t\t\tex.printStackTrace();\n+\t\t\tSystem.out.println(ex);\n+\t\t\tSystem.out.println(\"Caused by: \" + ex.getCause()); //$NON-NLS-1$", "originalCommit": "0ae8c9cc82944ca5a6596c9cb80160f23e008148", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM4MTQ2OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10389#discussion_r470381469", "bodyText": "Added null check, won't print message for a null cause.\nPlease have another look.", "author": "JasonFengJ9", "createdAt": "2020-08-14T02:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NTI0OA=="}], "type": "inlineReview", "revised_code": {"commit": "f2fabb4cddb9e7a796d756a45ffb59accd2ba25a", "chunk": "diff --git a/jcl/src/java.base/share/classes/java/lang/ClassLoader.java b/jcl/src/java.base/share/classes/java/lang/ClassLoader.java\nindex 27598e316..86730d933 100644\n--- a/jcl/src/java.base/share/classes/java/lang/ClassLoader.java\n+++ b/jcl/src/java.base/share/classes/java/lang/ClassLoader.java\n\n@@ -266,7 +266,10 @@ public abstract class ClassLoader {\n \t\t/*[IF Java10]*/\n \t\t} catch (Exception ex) {\n \t\t\tSystem.out.println(ex);\n-\t\t\tSystem.out.println(\"Caused by: \" + ex.getCause()); //$NON-NLS-1$\n+\t\t\tThrowable t = ex.getCause();\n+\t\t\tif (t != null) {\n+\t\t\t\tSystem.out.println(\"Caused by: \" + t); //$NON-NLS-1$\n+\t\t\t}\n \t\t\tSystem.exit(1);\n \t\t}\n \t\t/*[ENDIF]*/\n"}}, {"oid": "f2fabb4cddb9e7a796d756a45ffb59accd2ba25a", "url": "https://github.com/eclipse-openj9/openj9/commit/f2fabb4cddb9e7a796d756a45ffb59accd2ba25a", "message": "Early stage System.exit() don't invoke Exception.printStackTrace()\n\nAt early stage of VM startup, vm->applicationClassLoader is still NULL\nwhen Exception.printStackTrace() is invoked, hence cause segmentation\nerror;\nReplace it with the exception message & cause.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-14T02:51:45Z", "type": "forcePushed"}, {"oid": "7f9455d9a0a45e424591751780230bd4afaa9b24", "url": "https://github.com/eclipse-openj9/openj9/commit/7f9455d9a0a45e424591751780230bd4afaa9b24", "message": "Not invoke Exception.printStackTrace() at early VM startup stage\n\nAt early stage of VM startup, vm->applicationClassLoader is still NULL\nwhen Exception.printStackTrace() is invoked, hence segmentation\nerror;\nReplace it with the exception message & its causes.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-14T11:44:44Z", "type": "commit"}, {"oid": "7f9455d9a0a45e424591751780230bd4afaa9b24", "url": "https://github.com/eclipse-openj9/openj9/commit/7f9455d9a0a45e424591751780230bd4afaa9b24", "message": "Not invoke Exception.printStackTrace() at early VM startup stage\n\nAt early stage of VM startup, vm->applicationClassLoader is still NULL\nwhen Exception.printStackTrace() is invoked, hence segmentation\nerror;\nReplace it with the exception message & its causes.\n\nSigned-off-by: Jason Feng <fengj@ca.ibm.com>", "committedDate": "2020-08-14T11:44:44Z", "type": "forcePushed"}]}