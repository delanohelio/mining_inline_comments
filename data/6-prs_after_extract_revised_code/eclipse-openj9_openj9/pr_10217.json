{"pr_number": 10217, "pr_title": "Remaining master/slave replacements", "pr_createdAt": "2020-07-22T04:07:24Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/10217", "timeline": [{"oid": "92536d326e26c3bcd2de6ff837c0459c5e50a58f", "url": "https://github.com/eclipse-openj9/openj9/commit/92536d326e26c3bcd2de6ff837c0459c5e50a58f", "message": "Remaining gc compiler master/slave replacements\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T04:12:59Z", "type": "forcePushed"}, {"oid": "88ac5e69b52a788022ea2e31eb6335df34ab3b12", "url": "https://github.com/eclipse-openj9/openj9/commit/88ac5e69b52a788022ea2e31eb6335df34ab3b12", "message": "Attach masterLock to controllerLock\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T04:16:01Z", "type": "forcePushed"}, {"oid": "af538e0028c104c2760b2b36b304b9bf055228c3", "url": "https://github.com/eclipse-openj9/openj9/commit/af538e0028c104c2760b2b36b304b9bf055228c3", "message": "Attach masterLock to controllerLock\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T04:19:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDY5OQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458794699", "bodyText": "The changes in this class are problematic, as they are publicly documented API. Changing these could break a user's application.\nhttps://www.ibm.com/support/knowledgecenter/SSYKE2_8.0.0/com.ibm.java.api.80.doc/com.ibm.lang.management/com/ibm/lang/management/MemoryMXBean.html", "author": "pshipton", "createdAt": "2020-07-22T13:33:42Z", "path": "jcl/src/jdk.management/share/classes/com/ibm/lang/management/MemoryMXBean.java", "diffHunk": "@@ -248,18 +248,18 @@\n \tpublic String getGCMode();\n \n \t/**\n-     * Returns the amount of CPU time spent in the GC by the master thread, in milliseconds.\n+     * Returns the amount of CPU time spent in the GC by the main thread, in milliseconds.\n      * \n      * @return CPU time used in milliseconds\n      */\n-\tpublic long getGCMasterThreadCpuUsed();\n+\tpublic long getGCMainThreadCpuUsed();", "originalCommit": "af538e0028c104c2760b2b36b304b9bf055228c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NTg0Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458795843", "bodyText": "I think all we can do here is add the alternatives in addition to the original API, and deprecate the original for later removal.", "author": "pshipton", "createdAt": "2020-07-22T13:35:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDY5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NjgyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458796824", "bodyText": "We'll also have to generate new docs.\nThe OpenJ9 version of the docs\nhttps://www.eclipse.org/openj9/docs/api-langmgmt/\nhttps://www.eclipse.org/openj9/docs/api/jdk8/jre/management/extension/com/ibm/lang/management/MemoryMXBean.html", "author": "pshipton", "createdAt": "2020-07-22T13:36:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDY5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxMTU4Mw==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458911583", "bodyText": "I have added back and deprecated the master/slave public methods and created a docs issue: eclipse-openj9/openj9-docs#607", "author": "theresa-m", "createdAt": "2020-07-22T16:13:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5NDY5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "0e8a5d1721ef8e187df0bac9c38a548b29a0c6be", "chunk": "diff --git a/jcl/src/jdk.management/share/classes/com/ibm/lang/management/MemoryMXBean.java b/jcl/src/jdk.management/share/classes/com/ibm/lang/management/MemoryMXBean.java\nindex f14e4f34a..8ee5c85e0 100644\n--- a/jcl/src/jdk.management/share/classes/com/ibm/lang/management/MemoryMXBean.java\n+++ b/jcl/src/jdk.management/share/classes/com/ibm/lang/management/MemoryMXBean.java\n\n@@ -240,26 +240,50 @@ public interface MemoryMXBean extends java.lang.management.MemoryMXBean {\n      */\n     public long getSharedClassCacheFreeSpace();\n \t\n-\t/**\n-\t * Returns the current GC mode as a human-readable string.  \n-\t * \n-\t * @return a String describing the mode the GC is currently operating in\n-\t */\n-\tpublic String getGCMode();\n+    /**\n+     * Returns the current GC mode as a human-readable string.\n+     * \n+     * @return a String describing the mode the GC is currently operating in\n+     */\n+    public String getGCMode();\n \n-\t/**\n-     * Returns the amount of CPU time spent in the GC by the main thread, in milliseconds.\n+    /**\n+     * Returns the amount of CPU time spent in the GC by the master thread, in\n+     * milliseconds.\n      * \n      * @return CPU time used in milliseconds\n+     * \n+     * @deprecated renamed to getGCMainThreadCpuUsed\n      */\n-\tpublic long getGCMainThreadCpuUsed();\n+    @Deprecated\n+    public long getGCMasterThreadCpuUsed();\n \n-\t/**\n-     * Returns the total amount of CPU time spent in the GC by all worker threads, in milliseconds.\n+    /**\n+     * Returns the amount of CPU time spent in the GC by the main thread, in\n+     * milliseconds.\n+     * \n+     * @return CPU time used in milliseconds\n+     */\n+    public long getGCMainThreadCpuUsed();\n+\n+    /**\n+     * Returns the total amount of CPU time spent in the GC by all slave threads, in\n+     * milliseconds.\n+     * \n+     * @return CPU time used in milliseconds\n+     * \n+     * @deprecated renamed to getGCWorkerThreadsCpuUsed\n+     */\n+    @Deprecated\n+    public long getGCSlaveThreadsCpuUsed();\n+\n+    /**\n+     * Returns the total amount of CPU time spent in the GC by all worker threads,\n+     * in milliseconds.\n      * \n      * @return CPU time used in milliseconds\n      */\n-\tpublic long getGCWorkerThreadsCpuUsed();\n+    public long getGCWorkerThreadsCpuUsed();\n \n \t/**\n      * Returns the maximum number of GC worker threads.\n"}}, {"oid": "0e8a5d1721ef8e187df0bac9c38a548b29a0c6be", "url": "https://github.com/eclipse-openj9/openj9/commit/0e8a5d1721ef8e187df0bac9c38a548b29a0c6be", "message": "Deprecate MemoryMXBean methods for gc master/slave\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T16:06:33Z", "type": "forcePushed"}, {"oid": "0bdb1beb76e54e4730eb86e8391ed6eb9e4ae9fa", "url": "https://github.com/eclipse-openj9/openj9/commit/0bdb1beb76e54e4730eb86e8391ed6eb9e4ae9fa", "message": "Deprecate MemoryMXBean methods for gc master/slave\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T16:07:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyOTkwOA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458929908", "bodyText": "Pls use the long form for Java 11+, i.e. @Deprecated(forRemoval=true, since=\"15\").\nYou can create the processor instructions for Java 16 and remove the methods for Java 16+.", "author": "pshipton", "createdAt": "2020-07-22T16:36:09Z", "path": "jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java", "diffHunk": "@@ -777,33 +777,49 @@ public String getGCMode() {\n \tprivate native String getGCModeImpl();\n \n \t/**\n-\t * Returns the amount of CPU time spent in the GC by the master thread, in milliseconds.\n+\t * Returns the amount of CPU time spent in the GC by the main thread, in milliseconds.\n \t *\n \t * @return CPU time used in milliseconds\n-\t * @see #getGCMasterThreadCpuUsed()\n+\t * @see #getGCMainThreadCpuUsed()\n \t */\n-\tprivate native long getGCMasterThreadCpuUsedImpl();\n+\tprivate native long getGCMainThreadCpuUsedImpl();\n \n \t/**\n \t * {@inheritDoc}\n \t */\n+\t@Deprecated", "originalCommit": "0bdb1beb76e54e4730eb86e8391ed6eb9e4ae9fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkzOTcyOQ==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458939729", "bodyText": "I have updated the deprecated annotation and added preprocessor instructions to remove the methods in Java16.", "author": "theresa-m", "createdAt": "2020-07-22T16:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyOTkwOA=="}], "type": "inlineReview", "revised_code": {"commit": "da1df4defe0114e9a12913e273942e0bf07c128c", "chunk": "diff --git a/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java b/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\nindex 6f9d6db8f..a07375d37 100644\n--- a/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\n+++ b/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\n\n@@ -784,13 +784,15 @@ public class MemoryMXBeanImpl extends LazyDelegatingNotifier implements MemoryMX\n \t */\n \tprivate native long getGCMainThreadCpuUsedImpl();\n \n+/*[IF !Java16]*/\n \t/**\n \t * {@inheritDoc}\n \t */\n-\t@Deprecated\n+\t@Deprecated(forRemoval=true, since=\"15\")\n \tpublic long getGCMasterThreadCpuUsed() {\n \t\treturn getGCMainThreadCpuUsedImpl();\n \t}\n+/*[ENDIF] !Java16 */\n \n \t/**\n \t * {@inheritDoc}\n"}}, {"oid": "da1df4defe0114e9a12913e273942e0bf07c128c", "url": "https://github.com/eclipse-openj9/openj9/commit/da1df4defe0114e9a12913e273942e0bf07c128c", "message": "Deprecate MemoryMXBean methods for gc master/slave\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T16:50:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NDM5Ng==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458944396", "bodyText": "I don't think this works for Java 8 (Java 8 won't compile), you need to use the processor.", "author": "pshipton", "createdAt": "2020-07-22T16:59:54Z", "path": "jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java", "diffHunk": "@@ -777,33 +777,53 @@ public String getGCMode() {\n \tprivate native String getGCModeImpl();\n \n \t/**\n-\t * Returns the amount of CPU time spent in the GC by the master thread, in milliseconds.\n+\t * Returns the amount of CPU time spent in the GC by the main thread, in milliseconds.\n \t *\n \t * @return CPU time used in milliseconds\n-\t * @see #getGCMasterThreadCpuUsed()\n+\t * @see #getGCMainThreadCpuUsed()\n \t */\n-\tprivate native long getGCMasterThreadCpuUsedImpl();\n+\tprivate native long getGCMainThreadCpuUsedImpl();\n \n+/*[IF !Java16]*/\n \t/**\n \t * {@inheritDoc}\n \t */\n+\t@Deprecated(forRemoval=true, since=\"15\")", "originalCommit": "da1df4defe0114e9a12913e273942e0bf07c128c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk1MDU4NA==", "url": "https://github.com/eclipse-openj9/openj9/pull/10217#discussion_r458950584", "bodyText": "fixed.", "author": "theresa-m", "createdAt": "2020-07-22T17:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NDM5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "dafd5c5fbdd8a1796b6ec2a07ebc174935d2542c", "chunk": "diff --git a/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java b/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\nindex a07375d37..ab3934b7e 100644\n--- a/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\n+++ b/jcl/src/java.management/share/classes/com/ibm/java/lang/management/internal/MemoryMXBeanImpl.java\n\n@@ -788,7 +788,11 @@ public class MemoryMXBeanImpl extends LazyDelegatingNotifier implements MemoryMX\n \t/**\n \t * {@inheritDoc}\n \t */\n+\t/*[IF Java11]*/\n \t@Deprecated(forRemoval=true, since=\"15\")\n+\t/*[ELSE] Java11 */\n+\t@Deprecated\n+\t/*[ENDIF] Java11 */\n \tpublic long getGCMasterThreadCpuUsed() {\n \t\treturn getGCMainThreadCpuUsedImpl();\n \t}\n"}}, {"oid": "dafd5c5fbdd8a1796b6ec2a07ebc174935d2542c", "url": "https://github.com/eclipse-openj9/openj9/commit/dafd5c5fbdd8a1796b6ec2a07ebc174935d2542c", "message": "Deprecate MemoryMXBean methods for gc master/slave\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T17:09:38Z", "type": "forcePushed"}, {"oid": "8e7de1a3d08e1394e07d8e4bd29cea3ac73e169c", "url": "https://github.com/eclipse-openj9/openj9/commit/8e7de1a3d08e1394e07d8e4bd29cea3ac73e169c", "message": "Remaining gc compiler master/slave replacements\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T20:55:58Z", "type": "commit"}, {"oid": "cdcfc907e46f4b57e7016aa713c1c139184c8715", "url": "https://github.com/eclipse-openj9/openj9/commit/cdcfc907e46f4b57e7016aa713c1c139184c8715", "message": "Attach masterLock to controllerLock\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T20:55:58Z", "type": "commit"}, {"oid": "c1c8fdbe7e86b37567c801e356110eefd80ceedf", "url": "https://github.com/eclipse-openj9/openj9/commit/c1c8fdbe7e86b37567c801e356110eefd80ceedf", "message": "Deprecate MemoryMXBean methods for gc master/slave\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T20:55:58Z", "type": "commit"}, {"oid": "b2c99536d2bedfaa93d19789fa06b93837cc4b2e", "url": "https://github.com/eclipse-openj9/openj9/commit/b2c99536d2bedfaa93d19789fa06b93837cc4b2e", "message": "Update TestMemoryMXBean with additional MemoryMXBean methods\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T21:36:17Z", "type": "forcePushed"}, {"oid": "bc52969d64602cf0247b9062f1318dbbfe95844c", "url": "https://github.com/eclipse-openj9/openj9/commit/bc52969d64602cf0247b9062f1318dbbfe95844c", "message": "Update TestMemoryMXBean with additional MemoryMXBean methods\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T21:39:30Z", "type": "commit"}, {"oid": "bc52969d64602cf0247b9062f1318dbbfe95844c", "url": "https://github.com/eclipse-openj9/openj9/commit/bc52969d64602cf0247b9062f1318dbbfe95844c", "message": "Update TestMemoryMXBean with additional MemoryMXBean methods\n\nSigned-off-by: Theresa Mammarella <Theresa.T.Mammarella@ibm.com>", "committedDate": "2020-07-22T21:39:30Z", "type": "forcePushed"}]}