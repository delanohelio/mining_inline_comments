{"pr_number": 8779, "pr_title": "Update the security check of defineClass against Java 14 Spec", "pr_createdAt": "2020-03-06T20:22:27Z", "pr_url": "https://github.com/eclipse-openj9/openj9/pull/8779", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEzNjMxNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8779#discussion_r389136314", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t{\n          \n          \n            \n            \t\t\tif ((secmgr != null)\n          \n          \n            \n            \t\t\t\t/*[IF Java14]*/\n          \n          \n            \n            \t\t\t\t&& !hasFullPrivilegeAccess()\n          \n          \n            \n            \t\t\t\t/*[ENDIF] Java14 */\n          \n          \n            \n            \t\t\t) {", "author": "JasonFengJ9", "createdAt": "2020-03-06T20:48:16Z", "path": "jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java", "diffHunk": "@@ -2085,7 +2085,12 @@ public VarHandle unreflectVarHandle(Field field) throws IllegalAccessException {\n \t\t\t}\n \t\t\t\n \t\t\tSecurityManager secmgr = System.getSecurityManager();\n-\t\t\tif (null != secmgr) {\n+\t\t\t/*[IF Java14]*/\n+\t\t\tif ((null != secmgr) && !hasFullPrivilegeAccess())\n+\t\t\t/*[ELSE]*/\n+\t\t\tif (null != secmgr)\n+\t\t\t/*[ENDIF] Java14*/\n+\t\t\t{", "originalCommit": "2d9c2b6e672f61fc72037a6fa615646e96ff2383", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTE1MTEyNA==", "url": "https://github.com/eclipse-openj9/openj9/pull/8779#discussion_r389151124", "bodyText": "Fixed as suggested above.", "author": "ChengJin01", "createdAt": "2020-03-06T21:23:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEzNjMxNA=="}], "type": "inlineReview", "revised_code": {"commit": "b05316ae7bf4b7e80b00995d4b27730c04386a59", "chunk": "diff --git a/jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java b/jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java\nindex 6854562fb..258bd4a8d 100644\n--- a/jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java\n+++ b/jcl/src/java.base/share/classes/java/lang/invoke/MethodHandles.java\n\n@@ -2085,12 +2085,11 @@ public class MethodHandles {\n \t\t\t}\n \t\t\t\n \t\t\tSecurityManager secmgr = System.getSecurityManager();\n-\t\t\t/*[IF Java14]*/\n-\t\t\tif ((null != secmgr) && !hasFullPrivilegeAccess())\n-\t\t\t/*[ELSE]*/\n-\t\t\tif (null != secmgr)\n-\t\t\t/*[ENDIF] Java14*/\n-\t\t\t{\n+\t\t\tif ((null != secmgr)\n+\t\t\t\t/*[IF Java14]*/\n+\t\t\t\t&& !hasFullPrivilegeAccess()\n+\t\t\t\t/*[ENDIF] Java14*/\n+\t\t\t) {\n \t\t\t\tsecmgr.checkPermission(com.ibm.oti.util.RuntimePermissions.permissionDefineClass);\n \t\t\t}\n \t\t\t\n"}}, {"oid": "b05316ae7bf4b7e80b00995d4b27730c04386a59", "url": "https://github.com/eclipse-openj9/openj9/commit/b05316ae7bf4b7e80b00995d4b27730c04386a59", "message": "Update the security check of defineClass against Java 14 Spec\n\nThe change is to update the security check of defineClass\nto ensure it does the check only when the lookup has no full\nprivilege access.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-03-06T21:23:18Z", "type": "commit"}, {"oid": "b05316ae7bf4b7e80b00995d4b27730c04386a59", "url": "https://github.com/eclipse-openj9/openj9/commit/b05316ae7bf4b7e80b00995d4b27730c04386a59", "message": "Update the security check of defineClass against Java 14 Spec\n\nThe change is to update the security check of defineClass\nto ensure it does the check only when the lookup has no full\nprivilege access.\n\nSigned-off-by: Cheng Jin <jincheng@ca.ibm.com>", "committedDate": "2020-03-06T21:23:18Z", "type": "forcePushed"}]}