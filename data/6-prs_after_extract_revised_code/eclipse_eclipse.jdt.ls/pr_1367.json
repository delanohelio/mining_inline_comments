{"pr_number": 1367, "pr_title": "match filterText with textEdit", "pr_createdAt": "2020-02-26T12:42:10Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367", "timeline": [{"oid": "975aacde21f1265be1894d7bd1edf3f8735d4154", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/975aacde21f1265be1894d7bd1edf3f8735d4154", "message": "match filterText with textEdit\n\nSigned-off-by: Yan Zhang <yanzh@microsoft.com>", "committedDate": "2020-02-26T12:39:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ3MTQwMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#discussion_r384471402", "bodyText": "This case was to ensure that label is of the format \"SimpleName - PackageName\", nothing to do with filterText. Now since InsertText is set to the SimpleName as a fallback, I'm simply using it instead.\nIn the below line, I add a case to ensure filterText starts with the prefix, which is calculated from textEdit.range", "author": "Eskibear", "createdAt": "2020-02-26T12:51:16Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -237,7 +237,8 @@ public void testCompletion_object() throws Exception{\n \t\t\tassertTrue(isNotBlank(item.getInsertText()));\n \t\t\tassertNotNull(item.getFilterText());\n \t\t\tassertFalse(item.getFilterText().contains(\" \"));\n-\t\t\tassertTrue(item.getLabel().startsWith(item.getFilterText()));\n+\t\t\tassertTrue(item.getLabel().startsWith(item.getInsertText()));", "originalCommit": "975aacde21f1265be1894d7bd1edf3f8735d4154", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTIwOTU4Nw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1367#discussion_r385209587", "bodyText": "Here to minimize the risk and avoid unexpected behaviors, I only apply it to TYPE_REF kind. In fact, if I remove proposal.getKind() == CompletionProposal.TYPE_REF condition, and update the filterText for all items, current test cases are also passed.", "author": "Eskibear", "createdAt": "2020-02-27T16:10:09Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/contentassist/CompletionProposalRequestor.java", "diffHunk": "@@ -266,6 +266,11 @@ public CompletionItem toCompletionItem(CompletionProposal proposal, int index) {\n \t\t\t}\n \t\t}\n \t\tproposalProvider.updateReplacement(proposal, $, '\\0');\n+\t\t// Make sure `filterText` matches `textEdit`\n+\t\t// See https://github.com/eclipse/eclipse.jdt.ls/issues/1348\n+\t\tif (proposal.getKind() == CompletionProposal.TYPE_REF && $.getTextEdit() != null && $.getTextEdit().getRange() != null && $.getTextEdit().getNewText() != null) {", "originalCommit": "975aacde21f1265be1894d7bd1edf3f8735d4154", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}