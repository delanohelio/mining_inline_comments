{"pr_number": 1490, "pr_title": "jdt.ls should store gradle wrapper checksums at build time", "pr_createdAt": "2020-06-23T16:28:34Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490", "timeline": [{"oid": "9623dacb62b6208c011e4021a2584ea44531bf92", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/9623dacb62b6208c011e4021a2584ea44531bf92", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-26T02:02:48Z", "type": "forcePushed"}, {"oid": "d0f42c0b730cccb6cb29130589d7747a167da0d3", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/d0f42c0b730cccb6cb29130589d7747a167da0d3", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-26T02:20:09Z", "type": "forcePushed"}, {"oid": "7c037817c3fa2bd0edb42814b5710d7413f3cb6c", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/7c037817c3fa2bd0edb42814b5710d7413f3cb6c", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-06-26T16:30:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk1MzIwNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r446953205", "bodyText": "always true since that's what you're iterating over", "author": "fbricon", "createdAt": "2020-06-29T13:02:26Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java", "diffHunk": "@@ -114,6 +130,9 @@ public String apply(Map<String, String> input) {\n \t\t\t\t\tFile cacheDir = getSha256CacheFile();\n \t\t\t\t\tfor (String wrapperChecksumUrl : wrapperChecksumUrls) {\n \t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tif (wrapperChecksumUrls.contains(wrapperChecksumUrl)) {", "originalCommit": "7c037817c3fa2bd0edb42814b5710d7413f3cb6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxMDM4Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r448310383", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-07-01T11:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk1MzIwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "842e1acf3c41846d09b31c3340358638bd904598", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\nindex b4e10b82..ef1177de 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n\n@@ -128,9 +128,9 @@ public class WrapperValidator {\n \t\t\t\t\tDownloadChecksumJob downloadJob = new DownloadChecksumJob();\n \t\t\t\t\tint count = 0;\n \t\t\t\t\tFile cacheDir = getSha256CacheFile();\n-\t\t\t\t\tfor (String wrapperChecksumUrl : wrapperChecksumUrls) {\n+\t\t\t\t\tfor (String wrapperChecksumUrl : urls) {\n \t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\tif (wrapperChecksumUrls.contains(wrapperChecksumUrl)) {\n+\t\t\t\t\t\t\tif (WrapperValidator.wrapperChecksumUrls.contains(wrapperChecksumUrl)) {\n \t\t\t\t\t\t\t\tcontinue;\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t\tString fileName = getFileName(wrapperChecksumUrl);\n"}}, {"oid": "842e1acf3c41846d09b31c3340358638bd904598", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/842e1acf3c41846d09b31c3340358638bd904598", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-07-01T11:51:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzUwMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r448317502", "bodyText": "loadInternalChecksums", "author": "fbricon", "createdAt": "2020-07-01T12:07:14Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java", "diffHunk": "@@ -159,6 +180,55 @@ public String apply(Map<String, String> input) {\n \t\t}\n \t}\n \n+\tprivate void getInternalChecksums() {", "originalCommit": "842e1acf3c41846d09b31c3340358638bd904598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMjMwOA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r448322308", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-07-01T12:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzUwMg=="}], "type": "inlineReview", "revised_code": {"commit": "44c88a7e02edb306940a6694646fa6c905b299f9", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\nindex ef1177de..93b5006a 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n\n@@ -180,7 +180,7 @@ public class WrapperValidator {\n \t\t}\n \t}\n \n-\tprivate void getInternalChecksums() {\n+\tprivate void loadInternalChecksums() {\n \t\tBundle bundle = Platform.getBundle(IConstants.PLUGIN_ID);\n \t\tURL url = FileLocator.find(bundle, new org.eclipse.core.runtime.Path(GRADLE_CHECKSUMS));\n \t\tif (url != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzgzOQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r448317839", "bodyText": "updateGradleVersionsFile", "author": "fbricon", "createdAt": "2020-07-01T12:07:56Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java", "diffHunk": "@@ -159,6 +180,55 @@ public String apply(Map<String, String> input) {\n \t\t}\n \t}\n \n+\tprivate void getInternalChecksums() {\n+\t\tBundle bundle = Platform.getBundle(IConstants.PLUGIN_ID);\n+\t\tURL url = FileLocator.find(bundle, new org.eclipse.core.runtime.Path(GRADLE_CHECKSUMS));\n+\t\tif (url != null) {\n+\t\t\ttry (InputStream inputStream = url.openStream(); InputStreamReader inputStreamReader = new InputStreamReader(inputStream); Reader reader = new BufferedReader(inputStreamReader)) {\n+\t\t\t\tJsonElement jsonElement = new JsonParser().parse(reader);\n+\t\t\t\tif (jsonElement instanceof JsonArray) {\n+\t\t\t\t\tJsonArray array = (JsonArray) jsonElement;\n+\t\t\t\t\tfor (JsonElement json : array) {\n+\t\t\t\t\t\tString sha256 = json.getAsJsonObject().get(\"sha256\").getAsString();\n+\t\t\t\t\t\tString wrapperChecksumUrl = json.getAsJsonObject().get(\"wrapperChecksumUrl\").getAsString();\n+\t\t\t\t\t\tif (sha256 != null) {\n+\t\t\t\t\t\t\tallowed.add(sha256);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t\tif (wrapperChecksumUrl != null) {\n+\t\t\t\t\t\t\twrapperChecksumUrls.add(wrapperChecksumUrl);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tJavaLanguageServerPlugin.logException(e.getMessage(), e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tprivate void updateVersions() {", "originalCommit": "842e1acf3c41846d09b31c3340358638bd904598", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMjM5OQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1490#discussion_r448322399", "bodyText": "Fixed.", "author": "snjeza", "createdAt": "2020-07-01T12:17:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzgzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "44c88a7e02edb306940a6694646fa6c905b299f9", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\nindex ef1177de..93b5006a 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/internal/gradle/checksums/WrapperValidator.java\n\n@@ -180,7 +180,7 @@ public class WrapperValidator {\n \t\t}\n \t}\n \n-\tprivate void getInternalChecksums() {\n+\tprivate void loadInternalChecksums() {\n \t\tBundle bundle = Platform.getBundle(IConstants.PLUGIN_ID);\n \t\tURL url = FileLocator.find(bundle, new org.eclipse.core.runtime.Path(GRADLE_CHECKSUMS));\n \t\tif (url != null) {\n"}}, {"oid": "44c88a7e02edb306940a6694646fa6c905b299f9", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/44c88a7e02edb306940a6694646fa6c905b299f9", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-07-01T12:12:52Z", "type": "forcePushed"}, {"oid": "fc4f608a0a1bb6d5ef969d8fe572ce736f84fb10", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/fc4f608a0a1bb6d5ef969d8fe572ce736f84fb10", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-07-01T12:16:04Z", "type": "forcePushed"}, {"oid": "34d2213765c8586fb46986e44130aa94b8aa9ce2", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/34d2213765c8586fb46986e44130aa94b8aa9ce2", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-07-01T12:41:46Z", "type": "commit"}, {"oid": "34d2213765c8586fb46986e44130aa94b8aa9ce2", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/34d2213765c8586fb46986e44130aa94b8aa9ce2", "message": "jdt.ls should store gradle wrapper checksums at build time\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-07-01T12:41:46Z", "type": "forcePushed"}]}