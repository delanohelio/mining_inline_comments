{"pr_number": 1411, "pr_title": "CompletionHandlerTest.testStarImports fails randomly", "pr_createdAt": "2020-04-16T12:39:10Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410203016", "bodyText": "That's a really ugly band-aid. Have you checked the PR without it?", "author": "fbricon", "createdAt": "2020-04-17T12:55:35Z", "path": "org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java", "diffHunk": "@@ -2643,7 +2643,11 @@ public void testStarImports() throws Exception {\n \t\t\t\"}\\n\");\n \t\t\t//@formatter:on\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n+\t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\tif (list.isIncomplete()) {", "originalCommit": "ece2928a15eb1435b772a7c4cf4c2116a7516595", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwODUyMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410408522", "bodyText": "I have started 12 jenkins builds.\n\n6 builds without the PR - 1 fails\n6 builds with the PR - 0 fails\n\nThe issue happens because of the completion timeout - https://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandler.java#L132", "author": "snjeza", "createdAt": "2020-04-17T18:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyMTY2Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410421663", "bodyText": "Are we waiting for the indexing to finish? Could we ensure it's done before running the completion tests?\nAlso the tests could control the timeout value with a system property", "author": "fbricon", "createdAt": "2020-04-17T19:16:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNjUyMg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r410426522", "bodyText": "Are we waiting for the indexing to finish?\n\nYes, we are. See https://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/managers/AbstractProjectsManagerBasedTest.java#L231\n\nAlso the tests could control the timeout value with a system property\n\nThe timeout value is hardcoded\n\nhttps://github.com/eclipse/eclipse.jdt.ls/blob/master/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandler.java#L132\n10e0a06", "author": "snjeza", "createdAt": "2020-04-17T19:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTI0OTQ0Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r415249443", "bodyText": "Yes so it needs to be changed to something like\nprivate static long TIMEOUT  = Long.getLong(\"completion.timeout\", 5000);", "author": "fbricon", "createdAt": "2020-04-26T08:10:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMyNTU0NA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1411#discussion_r415325544", "bodyText": "Done.", "author": "snjeza", "createdAt": "2020-04-26T14:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMzAxNg=="}], "type": "inlineReview", "revised_code": {"commit": "ce80a225003f4482ec798ff4a5d8b661290fc226", "chunk": "diff --git a/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java b/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java\nindex ca056109..783f84e6 100644\n--- a/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java\n+++ b/org.eclipse.jdt.ls.tests/src/org/eclipse/jdt/ls/core/internal/handlers/CompletionHandlerTest.java\n\n@@ -2645,9 +2645,9 @@ public class CompletionHandlerTest extends AbstractCompilationUnitBasedTest {\n \t\t\tint[] loc = findCompletionLocation(unit, \"new ArrayL\");\n \t\t\tJob.getJobManager().join(DocumentLifeCycleHandler.DOCUMENT_LIFE_CYCLE_JOBS, new NullProgressMonitor());\n \t\t\tCompletionList list = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n-\t\t\tif (list.isIncomplete()) {\n-\t\t\t\tlist = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n-\t\t\t}\n+\t\t\t//\t\t\tif (list.isIncomplete()) {\n+\t\t\t//\t\t\t\tlist = server.completion(JsonMessageHelper.getParams(createCompletionRequest(unit, loc[0], loc[1]))).join().getRight();\n+\t\t\t//\t\t\t}\n \t\t\tassertNotNull(list);\n \t\t\tassertTrue(list.getItems().size() > 0);\n \t\t\tCompletionItem item = list.getItems().stream().filter(i -> \"ArrayList()\".equals(i.getLabel())).collect(Collectors.toList()).get(0);\n"}}, {"oid": "ce80a225003f4482ec798ff4a5d8b661290fc226", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/ce80a225003f4482ec798ff4a5d8b661290fc226", "message": "CompletionHandlerTest.testStarImports fails randomly\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-04-17T15:40:09Z", "type": "forcePushed"}, {"oid": "04f9edf7b0d8a4170c257d4f96603c755472a5d2", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/04f9edf7b0d8a4170c257d4f96603c755472a5d2", "message": "CompletionHandlerTest.testStarImports fails randomly\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-04-17T18:50:37Z", "type": "forcePushed"}, {"oid": "2699ce8155d36ad5f1c01f15a2879f92e4235db7", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2699ce8155d36ad5f1c01f15a2879f92e4235db7", "message": "CompletionHandlerTest.testStarImports fails randomly\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-04-26T14:09:39Z", "type": "commit"}, {"oid": "2699ce8155d36ad5f1c01f15a2879f92e4235db7", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/2699ce8155d36ad5f1c01f15a2879f92e4235db7", "message": "CompletionHandlerTest.testStarImports fails randomly\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-04-26T14:09:39Z", "type": "forcePushed"}]}