{"pr_number": 1381, "pr_title": "Add GRADLE_USER_HOME preference", "pr_createdAt": "2020-03-10T21:48:45Z", "pr_url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MTk4Mg==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392341982", "bodyText": "should check getGradleUserHome()  is not blank", "author": "fbricon", "createdAt": "2020-03-13T16:38:22Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java", "diffHunk": "@@ -151,6 +153,19 @@ public static File getGradleHomeFile(Map<String, String> env, Properties sysprop\n \t\treturn null;\n \t}\n \n+\tpublic static File getGradleUserHomeFile() {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {", "originalCommit": "0f7b68a50225f60ecfd643b983114cf4490a5d73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM4MDgyMw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392380823", "bodyText": "Done.", "author": "snjeza", "createdAt": "2020-03-13T17:48:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MTk4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "44a571bd64343610a8cf0eb7984ce780d5e3edf4", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\nindex fd1ca17e..8eef6863 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n\n@@ -154,16 +154,15 @@ public class GradleProjectImporter extends AbstractProjectImporter {\n \t}\n \n \tpublic static File getGradleUserHomeFile() {\n-\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null\n+\t\t\t\t&& !JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome().isEmpty()) {\n \t\t\treturn new File(JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome());\n \t\t}\n-\t\tMap<String, String> env = System.getenv();\n-\t\tProperties sysprops = System.getProperties();\n-\t\tString gradleUserHome = env.get(GRADLE_USER_HOME);\n+\t\tString gradleUserHome = System.getenv().get(GRADLE_USER_HOME);\n \t\tif (gradleUserHome == null) {\n-\t\t\tgradleUserHome = sysprops.getProperty(GRADLE_USER_HOME);\n+\t\t\tgradleUserHome = System.getProperties().getProperty(GRADLE_USER_HOME);\n \t\t}\n-\t\treturn gradleUserHome == null ? null : new File(gradleUserHome);\n+\t\treturn (gradleUserHome == null || gradleUserHome.isEmpty()) ? null : new File(gradleUserHome);\n \t}\n \n \tprotected void startSynchronization(Path rootFolder, IProgressMonitor monitor) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MjI4Mw==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392342283", "bodyText": "move down inside the if block", "author": "fbricon", "createdAt": "2020-03-13T16:38:53Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java", "diffHunk": "@@ -151,6 +153,19 @@ public static File getGradleHomeFile(Map<String, String> env, Properties sysprop\n \t\treturn null;\n \t}\n \n+\tpublic static File getGradleUserHomeFile() {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {\n+\t\t\treturn new File(JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome());\n+\t\t}\n+\t\tMap<String, String> env = System.getenv();\n+\t\tProperties sysprops = System.getProperties();", "originalCommit": "0f7b68a50225f60ecfd643b983114cf4490a5d73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM4MDkzNQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392380935", "bodyText": "Done.", "author": "snjeza", "createdAt": "2020-03-13T17:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MjI4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "44a571bd64343610a8cf0eb7984ce780d5e3edf4", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\nindex fd1ca17e..8eef6863 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n\n@@ -154,16 +154,15 @@ public class GradleProjectImporter extends AbstractProjectImporter {\n \t}\n \n \tpublic static File getGradleUserHomeFile() {\n-\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null\n+\t\t\t\t&& !JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome().isEmpty()) {\n \t\t\treturn new File(JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome());\n \t\t}\n-\t\tMap<String, String> env = System.getenv();\n-\t\tProperties sysprops = System.getProperties();\n-\t\tString gradleUserHome = env.get(GRADLE_USER_HOME);\n+\t\tString gradleUserHome = System.getenv().get(GRADLE_USER_HOME);\n \t\tif (gradleUserHome == null) {\n-\t\t\tgradleUserHome = sysprops.getProperty(GRADLE_USER_HOME);\n+\t\t\tgradleUserHome = System.getProperties().getProperty(GRADLE_USER_HOME);\n \t\t}\n-\t\treturn gradleUserHome == null ? null : new File(gradleUserHome);\n+\t\treturn (gradleUserHome == null || gradleUserHome.isEmpty()) ? null : new File(gradleUserHome);\n \t}\n \n \tprotected void startSynchronization(Path rootFolder, IProgressMonitor monitor) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MjY1OA==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392342658", "bodyText": "should check if not blank", "author": "fbricon", "createdAt": "2020-03-13T16:39:32Z", "path": "org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java", "diffHunk": "@@ -151,6 +153,19 @@ public static File getGradleHomeFile(Map<String, String> env, Properties sysprop\n \t\treturn null;\n \t}\n \n+\tpublic static File getGradleUserHomeFile() {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {\n+\t\t\treturn new File(JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome());\n+\t\t}\n+\t\tMap<String, String> env = System.getenv();\n+\t\tProperties sysprops = System.getProperties();\n+\t\tString gradleUserHome = env.get(GRADLE_USER_HOME);\n+\t\tif (gradleUserHome == null) {\n+\t\t\tgradleUserHome = sysprops.getProperty(GRADLE_USER_HOME);\n+\t\t}\n+\t\treturn gradleUserHome == null ? null : new File(gradleUserHome);", "originalCommit": "0f7b68a50225f60ecfd643b983114cf4490a5d73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM4MTAzMQ==", "url": "https://github.com/eclipse/eclipse.jdt.ls/pull/1381#discussion_r392381031", "bodyText": "Done.", "author": "snjeza", "createdAt": "2020-03-13T17:48:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM0MjY1OA=="}], "type": "inlineReview", "revised_code": {"commit": "44a571bd64343610a8cf0eb7984ce780d5e3edf4", "chunk": "diff --git a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\nindex fd1ca17e..8eef6863 100644\n--- a/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n+++ b/org.eclipse.jdt.ls.core/src/org/eclipse/jdt/ls/core/internal/managers/GradleProjectImporter.java\n\n@@ -154,16 +154,15 @@ public class GradleProjectImporter extends AbstractProjectImporter {\n \t}\n \n \tpublic static File getGradleUserHomeFile() {\n-\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null) {\n+\t\tif (JavaLanguageServerPlugin.getPreferencesManager() != null && JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome() != null\n+\t\t\t\t&& !JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome().isEmpty()) {\n \t\t\treturn new File(JavaLanguageServerPlugin.getPreferencesManager().getPreferences().getGradleUserHome());\n \t\t}\n-\t\tMap<String, String> env = System.getenv();\n-\t\tProperties sysprops = System.getProperties();\n-\t\tString gradleUserHome = env.get(GRADLE_USER_HOME);\n+\t\tString gradleUserHome = System.getenv().get(GRADLE_USER_HOME);\n \t\tif (gradleUserHome == null) {\n-\t\t\tgradleUserHome = sysprops.getProperty(GRADLE_USER_HOME);\n+\t\t\tgradleUserHome = System.getProperties().getProperty(GRADLE_USER_HOME);\n \t\t}\n-\t\treturn gradleUserHome == null ? null : new File(gradleUserHome);\n+\t\treturn (gradleUserHome == null || gradleUserHome.isEmpty()) ? null : new File(gradleUserHome);\n \t}\n \n \tprotected void startSynchronization(Path rootFolder, IProgressMonitor monitor) {\n"}}, {"oid": "44a571bd64343610a8cf0eb7984ce780d5e3edf4", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/44a571bd64343610a8cf0eb7984ce780d5e3edf4", "message": "Add GRADLE_USER_HOME preference\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-03-13T17:47:20Z", "type": "commit"}, {"oid": "44a571bd64343610a8cf0eb7984ce780d5e3edf4", "url": "https://github.com/eclipse/eclipse.jdt.ls/commit/44a571bd64343610a8cf0eb7984ce780d5e3edf4", "message": "Add GRADLE_USER_HOME preference\n\nSigned-off-by: Snjezana Peco <snjezana.peco@redhat.com>", "committedDate": "2020-03-13T17:47:20Z", "type": "forcePushed"}]}