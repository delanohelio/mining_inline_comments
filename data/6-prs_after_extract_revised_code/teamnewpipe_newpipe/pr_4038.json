{"pr_number": 4038, "pr_title": "Remember last selected media type for downloads.", "pr_createdAt": "2020-08-01T09:16:34Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4038", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MDY3NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463950675", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n          \n          \n            \n                    final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "author": "TobiGr", "createdAt": "2020-08-01T10:57:54Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\nindex 8d3a5adaf..ab44e0fc1 100644\n--- a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n+++ b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n\n@@ -516,18 +517,19 @@ public class DownloadDialog extends DialogFragment\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n         prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n-        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n-                    getString(R.string.video));\n+        final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.last_download_type_video_key));\n \n-        assert defaultMedia != null;\n-        if (isVideoStreamsAvailable && (defaultMedia.equals(getString(R.string.video)))) {\n+        if (isVideoStreamsAvailable\n+                && (defaultMedia.equals(getString(R.string.last_download_type_video_key)))) {\n             videoButton.setChecked(true);\n             setupVideoSpinner();\n-        } else if (isAudioStreamsAvailable && (defaultMedia.equals(getString(R.string.audio)))) {\n+        } else if (isAudioStreamsAvailable\n+                && (defaultMedia.equals(getString(R.string.last_download_type_audio_key)))) {\n             audioButton.setChecked(true);\n             setupAudioSpinner();\n         } else if (isSubtitleStreamsAvailable\n-                && (defaultMedia.equals(getString(R.string.caption_setting_title)))) {\n+                && (defaultMedia.equals(getString(R.string.last_download_type_subtitle_key)))) {\n             subtitleButton.setChecked(true);\n             setupSubtitleSpinner();\n         } else if (isVideoStreamsAvailable) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MTEzMw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463951133", "bodyText": "(defaultMedia.equals(getString(R.string.video)) this will fail to detect the last used type when the user changed tha pplication language. Please create three keys in settings_keys.xml to avoid that.", "author": "TobiGr", "createdAt": "2020-08-01T11:03:47Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.video));\n+\n+        assert defaultMedia != null;\n+        if (isVideoStreamsAvailable && (defaultMedia.equals(getString(R.string.video)))) {", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\nindex 8d3a5adaf..ab44e0fc1 100644\n--- a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n+++ b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n\n@@ -516,18 +517,19 @@ public class DownloadDialog extends DialogFragment\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n         prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n-        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n-                    getString(R.string.video));\n+        final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.last_download_type_video_key));\n \n-        assert defaultMedia != null;\n-        if (isVideoStreamsAvailable && (defaultMedia.equals(getString(R.string.video)))) {\n+        if (isVideoStreamsAvailable\n+                && (defaultMedia.equals(getString(R.string.last_download_type_video_key)))) {\n             videoButton.setChecked(true);\n             setupVideoSpinner();\n-        } else if (isAudioStreamsAvailable && (defaultMedia.equals(getString(R.string.audio)))) {\n+        } else if (isAudioStreamsAvailable\n+                && (defaultMedia.equals(getString(R.string.last_download_type_audio_key)))) {\n             audioButton.setChecked(true);\n             setupAudioSpinner();\n         } else if (isSubtitleStreamsAvailable\n-                && (defaultMedia.equals(getString(R.string.caption_setting_title)))) {\n+                && (defaultMedia.equals(getString(R.string.last_download_type_subtitle_key)))) {\n             subtitleButton.setChecked(true);\n             setupSubtitleSpinner();\n         } else if (isVideoStreamsAvailable) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MjM2NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463952364", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    SharedPreferences.Editor editor = prefs.edit();\n          \n          \n            \n                    final SharedPreferences.Editor editor = prefs.edit();", "author": "TobiGr", "createdAt": "2020-08-01T11:19:08Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -663,6 +682,11 @@ private void prepareSelectedDownload() {\n \n         // check for existing file with the same name\n         checkSelectedDownload(mainStorage, mainStorage.findFile(filename), filename, mime);\n+\n+        // remember the last media type downloaded by the user\n+        SharedPreferences.Editor editor = prefs.edit();", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\nindex 8d3a5adaf..ab44e0fc1 100644\n--- a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n+++ b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n\n@@ -684,9 +686,9 @@ public class DownloadDialog extends DialogFragment\n         checkSelectedDownload(mainStorage, mainStorage.findFile(filename), filename, mime);\n \n         // remember the last media type downloaded by the user\n-        SharedPreferences.Editor editor = prefs.edit();\n-        editor.putString(getString(R.string.last_used_download_type), selectedMediaType);\n-        editor.apply();\n+        prefs.edit()\n+                .putString(getString(R.string.last_used_download_type), selectedMediaType)\n+                .apply();\n     }\n \n     private void checkSelectedDownload(final StoredDirectoryHelper mainStorage,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk4MjYxOQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r470982619", "bodyText": "According to the docs, getString(resInt) cannot be null, thus defaultMedia cannot be null (as long as we don't put anything stupid into the preferences, which we clearly do not). I think, the assertion can be removed.", "author": "TobiGr", "createdAt": "2020-08-15T13:34:42Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,24 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.last_download_type_video_key));\n+\n+        assert defaultMedia != null;", "originalCommit": "4f40bd6ae58c9d8732f8ba2f3c842a2a8b3264bf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\nindex eade719bb..ab44e0fc1 100644\n--- a/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n+++ b/app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java\n\n@@ -519,7 +520,6 @@ public class DownloadDialog extends DialogFragment\n         final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n                     getString(R.string.last_download_type_video_key));\n \n-        assert defaultMedia != null;\n         if (isVideoStreamsAvailable\n                 && (defaultMedia.equals(getString(R.string.last_download_type_video_key)))) {\n             videoButton.setChecked(true);\n"}}, {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "message": "Remember last selected media type for downloads.", "committedDate": "2020-09-03T17:47:34Z", "type": "commit"}, {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "message": "Remember last selected media type for downloads.", "committedDate": "2020-09-03T17:47:34Z", "type": "forcePushed"}]}