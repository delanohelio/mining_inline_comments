{"pr_number": 3160, "pr_title": "Hide 5, 15, 25 second seek options if inexact seek is enabled", "pr_createdAt": "2020-02-29T12:02:01Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3160", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYyNjY2MA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r386626660", "bodyText": "Add a newline here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));\n          \n          \n            \n            \n          \n          \n            \n                    final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "author": "Stypox", "createdAt": "2020-03-02T20:17:59Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,59 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);\n+                displayedDescriptionValues.add(String.format(\n+                    res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n+                        currentDurationValue),\n+                    currentDurationValue));\n+            } catch (Resources.NotFoundException ignored) {\n+                //if this happens, the translation is missing, and the english string will be displayed instead\n+            }\n+        }\n+        final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));", "originalCommit": "8a077c46958e3f550309b45bd0a257e763586071", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\nindex f68fc5e23..5476158c4 100644\n--- a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\n@@ -46,60 +69,10 @@ public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n                             .show();\n \n                 }\n-            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n-                updateSeekOptions();\n             }\n         };\n     }\n \n-    /**\n-     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n-     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n-     */\n-    private void updateSeekOptions() {\n-        //initializing R.array.seek_duration_description to display the translation of seconds\n-        final Resources res = getResources();\n-        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n-        final List<String> displayedDurationValues = new LinkedList<>();\n-        final List<String> displayedDescriptionValues = new LinkedList<>();\n-        int currentDurationValue;\n-        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n-            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n-\n-        for (String durationsValue : durationsValues) {\n-            currentDurationValue =\n-                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n-            if (inexactSeek && currentDurationValue % 10 == 5) {\n-                continue;\n-            }\n-            try {\n-                displayedDurationValues.add(durationsValue);\n-                displayedDescriptionValues.add(String.format(\n-                    res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n-                        currentDurationValue),\n-                    currentDurationValue));\n-            } catch (Resources.NotFoundException ignored) {\n-                //if this happens, the translation is missing, and the english string will be displayed instead\n-            }\n-        }\n-        final ListPreference durations = (ListPreference) findPreference(getString(R.string.seek_duration_key));\n-        durations.setEntryValues(displayedDurationValues.toArray(new CharSequence[0]));\n-        durations.setEntries(displayedDescriptionValues.toArray(new CharSequence[0]));\n-        final int selectedDuration = Integer.parseInt(durations.getValue());\n-        if (selectedDuration / (int) DateUtils.SECOND_IN_MILLIS % 10 == 5) {\n-            final int newDuration = selectedDuration / (int) DateUtils.SECOND_IN_MILLIS + 5;\n-            durations.setValue(Integer.toString(newDuration * (int) DateUtils.SECOND_IN_MILLIS));\n-\n-            Toast toast = Toast.makeText(getContext(),\n-                getString(R.string.new_seek_duration_toast) + \" \" + String.format(\n-                    res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n-                        newDuration),\n-                    newDuration),\n-                Toast.LENGTH_LONG);\n-            toast.show();\n-        }\n-    }\n-\n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n         addPreferencesFromResource(R.xml.video_audio_settings);\n"}}, {"oid": "57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "url": "https://github.com/TeamNewPipe/NewPipe/commit/57504acd0017b2825ecbb68a4ff7bec9c7f64fdc", "message": "If inexact seekt is used, hide 5,15,25 seconds seek duration options when opening settings", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "446380433804c1c38213c37562d8d34151caca3b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/446380433804c1c38213c37562d8d34151caca3b", "message": "Update seek options on inexact seek option change.\nReset to 10 seconds when previous value is not valid anymore", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "288a61895cde2c271ae80c7b927a0200ca1480c9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/288a61895cde2c271ae80c7b927a0200ca1480c9", "message": "Update inexact seek summary", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "6a42714326dbd42dabdf4b072cf25396fa4da529", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6a42714326dbd42dabdf4b072cf25396fa4da529", "message": "Round seek duration up instead of setting it to 10 seconds", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "7d3b21582cc94b3954d88d57ec3c186712396a78", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7d3b21582cc94b3954d88d57ec3c186712396a78", "message": "Use DateUtils constant for 1000", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "message": "Show a toast when seek duration was rounded up", "committedDate": "2020-03-03T18:40:10Z", "type": "commit"}, {"oid": "e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e3fff4356a5c7cc4138f9a4dde954cf2bdea03ef", "message": "Show a toast when seek duration was rounded up", "committedDate": "2020-03-03T18:40:10Z", "type": "forcePushed"}, {"oid": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "url": "https://github.com/TeamNewPipe/NewPipe/commit/efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "message": "Change toast string resource to be useable with different languages", "committedDate": "2020-03-03T18:50:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzI1MzY3OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3160#discussion_r387253679", "bodyText": "Even though this is not relative to this PR, I think this line should be before the try-catch, since it can't throw an exception, and for a moment it led me to thinking that for missing translations the value would not be added.\nAlso note the added newline.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        try {\n          \n          \n            \n                            displayedDurationValues.add(durationsValue);\n          \n          \n            \n            \n          \n          \n            \n                        displayedDurationValues.add(durationsValue);\n          \n          \n            \n                        try {", "author": "Stypox", "createdAt": "2020-03-03T19:47:46Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -58,10 +46,58 @@ public void onCreate(@Nullable Bundle savedInstanceState) {\n                             .show();\n \n                 }\n+            } else if (s.equals(getString(R.string.use_inexact_seek_key))) {\n+                updateSeekOptions();\n             }\n         };\n     }\n \n+    /**\n+     * Update fast-forward/-rewind seek duration options according to language and inexact seek setting.\n+     * Exoplayer can't seek 5 seconds in audio when using inexact seek.\n+     */\n+    private void updateSeekOptions() {\n+        //initializing R.array.seek_duration_description to display the translation of seconds\n+        final Resources res = getResources();\n+        final String[] durationsValues = res.getStringArray(R.array.seek_duration_value);\n+        final List<String> displayedDurationValues = new LinkedList<>();\n+        final List<String> displayedDescriptionValues = new LinkedList<>();\n+        int currentDurationValue;\n+        final boolean inexactSeek = getPreferenceManager().getSharedPreferences()\n+            .getBoolean(res.getString(R.string.use_inexact_seek_key), false);\n+\n+        for (String durationsValue : durationsValues) {\n+            currentDurationValue =\n+                Integer.parseInt(durationsValue) / (int) DateUtils.SECOND_IN_MILLIS;\n+            if (inexactSeek && currentDurationValue % 10 == 5) {\n+                continue;\n+            }\n+            try {\n+                displayedDurationValues.add(durationsValue);", "originalCommit": "efb67b0fd4e98fe5e99b6d323a4d8686bc6c06f7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f7ef7a18ac764f53c7b2a748af43a34a252abe90", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\nindex 27ae4d3aa..d4897ecaa 100644\n--- a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\n@@ -72,8 +72,9 @@ public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n             if (inexactSeek && currentDurationValue % 10 == 5) {\n                 continue;\n             }\n+\n+            displayedDurationValues.add(durationsValue);\n             try {\n-                displayedDurationValues.add(durationsValue);\n                 displayedDescriptionValues.add(String.format(\n                     res.getQuantityString(R.plurals.dynamic_seek_duration_description,\n                         currentDurationValue),\n"}}, {"oid": "f7ef7a18ac764f53c7b2a748af43a34a252abe90", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7ef7a18ac764f53c7b2a748af43a34a252abe90", "message": "Update app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\nCo-Authored-By: Stypox <stypox@pm.me>", "committedDate": "2020-03-03T20:41:15Z", "type": "commit"}, {"oid": "4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4bb6a146e8212af975d9c1acd1bbd3cf51fa6af6", "message": "Update app/src/main/res/values/strings.xml", "committedDate": "2020-03-03T20:51:46Z", "type": "commit"}]}