{"pr_number": 5310, "pr_title": "add list item to play video on kodi", "pr_createdAt": "2020-12-30T02:31:44Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/5310", "timeline": [{"oid": "83faf119a90ac1adb02d62fee2ec31d54f18e669", "url": "https://github.com/TeamNewPipe/NewPipe/commit/83faf119a90ac1adb02d62fee2ec31d54f18e669", "message": "add list item to play video on kodi\n\ncloses: #5157", "committedDate": "2020-12-30T02:53:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDAxNjM2Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550016362", "bodyText": "You could provide this as a method in KoreUtil so if the logic for when to show the kodi entry is centralized and not copied over 3 places.", "author": "XiangRongLin", "createdAt": "2020-12-30T08:10:28Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/list/playlist/PlaylistFragment.java", "diffHunk": "@@ -174,6 +176,12 @@ protected void showStreamDialog(final StreamInfoItem item) {\n                     StreamDialogEntry.share\n             ));\n         }\n+        final boolean enableKodiEntry = KoreUtil.isServiceSupportedByKore(item.getServiceId())\n+                && PreferenceManager.getDefaultSharedPreferences(context)\n+                .getBoolean(context.getString(R.string.show_play_with_kodi_key), false);", "originalCommit": "83faf119a90ac1adb02d62fee2ec31d54f18e669", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "48a5107296c4f62fa762dafe4e999337f2b23e62", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/fragments/list/playlist/PlaylistFragment.java b/app/src/main/java/org/schabi/newpipe/fragments/list/playlist/PlaylistFragment.java\nindex a4ccd9c78..0eed5f4b0 100644\n--- a/app/src/main/java/org/schabi/newpipe/fragments/list/playlist/PlaylistFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/fragments/list/playlist/PlaylistFragment.java\n\n@@ -176,11 +175,8 @@ public class PlaylistFragment extends BaseListInfoFragment<PlaylistInfo> {\n                     StreamDialogEntry.share\n             ));\n         }\n-        final boolean enableKodiEntry = KoreUtil.isServiceSupportedByKore(item.getServiceId())\n-                && PreferenceManager.getDefaultSharedPreferences(context)\n-                .getBoolean(context.getString(R.string.show_play_with_kodi_key), false);\n-        if (enableKodiEntry) {\n-            entries.add(StreamDialogEntry.play_on_kodi);\n+        if (KoreUtil.shouldShowPlayWithKodi(context, item)) {\n+            entries.add(StreamDialogEntry.play_with_kodi);\n         }\n         StreamDialogEntry.setEnabledEntries(entries);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDA2NTI4NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550065284", "bodyText": "Call this \"play_with_kody\" to stay consistent", "author": "Stypox", "createdAt": "2020-12-30T09:14:04Z", "path": "app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java", "diffHunk": "@@ -70,6 +71,15 @@\n         }\n     }),\n \n+    play_on_kodi(R.string.play_with_kodi_title, (fragment, item) -> {", "originalCommit": "83faf119a90ac1adb02d62fee2ec31d54f18e669", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "48a5107296c4f62fa762dafe4e999337f2b23e62", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java b/app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java\nindex d85f5ae57..153ba7cf4 100644\n--- a/app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java\n+++ b/app/src/main/java/org/schabi/newpipe/util/StreamDialogEntry.java\n\n@@ -71,7 +71,7 @@ public enum StreamDialogEntry {\n         }\n     }),\n \n-    play_on_kodi(R.string.play_with_kodi_title, (fragment, item) -> {\n+    play_with_kodi(R.string.play_with_kodi_title, (fragment, item) -> {\n         final Uri videoUrl = Uri.parse(item.getUrl());\n         try {\n             NavigationHelper.playWithKore(fragment.getContext(), videoUrl);\n"}}, {"oid": "48a5107296c4f62fa762dafe4e999337f2b23e62", "url": "https://github.com/TeamNewPipe/NewPipe/commit/48a5107296c4f62fa762dafe4e999337f2b23e62", "message": "address pull request feedback", "committedDate": "2020-12-30T22:45:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc1MTM5Mw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550751393", "bodyText": "This method can be also used in other places, e.g. in the player, can't it?", "author": "Stypox", "createdAt": "2021-01-01T09:41:59Z", "path": "app/src/main/java/org/schabi/newpipe/util/KoreUtil.java", "diffHunk": "@@ -16,6 +18,12 @@ public static boolean isServiceSupportedByKore(final int serviceId) {\n                 || serviceId == ServiceList.SoundCloud.getServiceId());\n     }\n \n+    public static boolean shouldShowPlayWithKodi(final Context context, final StreamInfoItem item) {", "originalCommit": "48a5107296c4f62fa762dafe4e999337f2b23e62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc2NDIwNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550764204", "bodyText": "Do you mean places like this one?\n\n  \n    \n      NewPipe/app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java\n    \n    \n        Lines 934 to 937\n      in\n      8fe1a76\n    \n    \n    \n    \n\n        \n          \n           final boolean showKodiButton = playQueue != null && playQueue.getItem() != null \n        \n\n        \n          \n                   && KoreUtil.isServiceSupportedByKore(playQueue.getItem().getServiceId()) \n        \n\n        \n          \n                   && PreferenceManager.getDefaultSharedPreferences(context) \n        \n\n        \n          \n                   .getBoolean(context.getString(R.string.show_play_with_kodi_key), false); \n        \n    \n  \n\n\nIt should be used here, too.", "author": "TobiGr", "createdAt": "2021-01-01T12:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc1MTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgyOTY2OQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550829669", "bodyText": "this seems like a reasonable place to use the new method, but i couldn't find a way to get a StreamInfoItem from a playQueue. any suggestions?", "author": "khimaros", "createdAt": "2021-01-02T01:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc1MTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDg1Njg4OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550856888", "bodyText": "@khimaros Instead of passing in a StreamInfoItem you can pass in the service id, since that is the thing you actually need. Otherwise those items should have a common superclass, that would work too, but just passing the id is preferred.", "author": "XiangRongLin", "createdAt": "2021-01-02T08:02:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc1MTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDkxMjUzNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5310#discussion_r550912537", "bodyText": "that works, thanks!", "author": "khimaros", "createdAt": "2021-01-02T19:25:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc1MTM5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "ac59382b84cc047483e29df1ba40a2a71848d5be", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java b/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java\nindex 26019cd1f..de6f3fa9a 100644\n--- a/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java\n+++ b/app/src/main/java/org/schabi/newpipe/util/KoreUtil.java\n\n@@ -18,8 +16,8 @@ public final class KoreUtil {\n                 || serviceId == ServiceList.SoundCloud.getServiceId());\n     }\n \n-    public static boolean shouldShowPlayWithKodi(final Context context, final StreamInfoItem item) {\n-        return isServiceSupportedByKore(item.getServiceId())\n+    public static boolean shouldShowPlayWithKodi(final Context context, final int serviceId) {\n+        return isServiceSupportedByKore(serviceId)\n                 && PreferenceManager.getDefaultSharedPreferences(context)\n                 .getBoolean(context.getString(R.string.show_play_with_kodi_key), false);\n     }\n"}}, {"oid": "ac59382b84cc047483e29df1ba40a2a71848d5be", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ac59382b84cc047483e29df1ba40a2a71848d5be", "message": "pass serviceId instead of item, reduce duplication", "committedDate": "2021-01-02T19:24:33Z", "type": "commit"}]}