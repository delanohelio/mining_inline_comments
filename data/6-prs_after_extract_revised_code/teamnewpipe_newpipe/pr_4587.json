{"pr_number": 4587, "pr_title": "Separate player gesture logic and UI", "pr_createdAt": "2020-10-21T15:11:12Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4587", "timeline": [{"oid": "268304376226457e99aea640aedfa3ccc22c59bb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/268304376226457e99aea640aedfa3ccc22c59bb", "message": "Player gestures: separate logic and UI", "committedDate": "2020-10-29T11:46:34Z", "type": "commit"}, {"oid": "e97f71cf2c7005c114e2e81853063add9da5b496", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e97f71cf2c7005c114e2e81853063add9da5b496", "message": "Player gestures: Add multi-double-tap logic", "committedDate": "2020-10-29T11:46:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4NzY3NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#discussion_r515987674", "bodyText": "Could you add here else if (portion == DisplayPortion.MIDDLE) { playerImpl.onPlayPause(); }, so that a double tap in the middle changes the playing state, as it did before #2907? Or will you do this in a future PR?", "author": "Stypox", "createdAt": "2020-11-02T13:57:21Z", "path": "app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java", "diffHunk": "@@ -23,217 +23,114 @@\n import static org.schabi.newpipe.util.AnimationUtils.Type.SCALE_AND_ALPHA;\n import static org.schabi.newpipe.util.AnimationUtils.animateView;\n \n+/**\n+ * GestureListener for the player\n+ *\n+ * While {@link BasePlayerGestureListener} contains the logic behind the single gestures\n+ * this class focuses on the visual aspect like hiding and showing the controls or changing\n+ * volume/brightness during scrolling for specific events.\n+ */\n public class PlayerGestureListener\n-        extends GestureDetector.SimpleOnGestureListener\n+        extends BasePlayerGestureListener\n         implements View.OnTouchListener {\n     private static final String TAG = \".PlayerGestureListener\";\n     private static final boolean DEBUG = BasePlayer.DEBUG;\n \n-    private final VideoPlayerImpl playerImpl;\n-    private final MainPlayer service;\n-\n-    private int initialPopupX;\n-    private int initialPopupY;\n-\n-    private boolean isMovingInMain;\n-    private boolean isMovingInPopup;\n-\n-    private boolean isResizing;\n-\n-    private final int tossFlingVelocity;\n-\n     private final boolean isVolumeGestureEnabled;\n     private final boolean isBrightnessGestureEnabled;\n     private final int maxVolume;\n-    private static final int MOVEMENT_THRESHOLD = 40;\n-\n-    // [popup] initial coordinates and distance between fingers\n-    private double initPointerDistance = -1;\n-    private float initFirstPointerX = -1;\n-    private float initFirstPointerY = -1;\n-    private float initSecPointerX = -1;\n-    private float initSecPointerY = -1;\n-\n \n     public PlayerGestureListener(final VideoPlayerImpl playerImpl, final MainPlayer service) {\n-        this.playerImpl = playerImpl;\n-        this.service = service;\n-        this.tossFlingVelocity = PlayerHelper.getTossFlingVelocity(service);\n+        super(playerImpl, service);\n \n         isVolumeGestureEnabled = PlayerHelper.isVolumeGestureEnabled(service);\n         isBrightnessGestureEnabled = PlayerHelper.isBrightnessGestureEnabled(service);\n         maxVolume = playerImpl.getAudioReactor().getMaxVolume();\n     }\n \n-    /*//////////////////////////////////////////////////////////////////////////\n-    // Helpers\n-    //////////////////////////////////////////////////////////////////////////*/\n-\n-    /*\n-     * Main and popup players' gesture listeners is too different.\n-     * So it will be better to have different implementations of them\n-     * */\n-    @Override\n-    public boolean onDoubleTap(final MotionEvent e) {\n-        if (DEBUG) {\n-            Log.d(TAG, \"onDoubleTap() called with: e = [\" + e + \"]\" + \"rawXy = \"\n-                    + e.getRawX() + \", \" + e.getRawY() + \", xy = \" + e.getX() + \", \" + e.getY());\n-        }\n-\n-        if (playerImpl.popupPlayerSelected()) {\n-            return onDoubleTapInPopup(e);\n-        } else {\n-            return onDoubleTapInMain(e);\n-        }\n-    }\n-\n     @Override\n-    public boolean onSingleTapConfirmed(final MotionEvent e) {\n+    public void onDoubleTap(@NotNull final MotionEvent event,\n+                            @NotNull final DisplayPortion portion) {\n         if (DEBUG) {\n-            Log.d(TAG, \"onSingleTapConfirmed() called with: e = [\" + e + \"]\");\n+            Log.d(TAG, \"onDoubleTap called with playerType = [\"\n+                    + playerImpl.getPlayerType() + \"], portion = [\"\n+                    + portion + \"]\");\n         }\n-\n-        if (playerImpl.popupPlayerSelected()) {\n-            return onSingleTapConfirmedInPopup(e);\n-        } else {\n-            return onSingleTapConfirmedInMain(e);\n-        }\n-    }\n-\n-    @Override\n-    public boolean onDown(final MotionEvent e) {\n-        if (DEBUG) {\n-            Log.d(TAG, \"onDown() called with: e = [\" + e + \"]\");\n+        if (playerImpl.isSomePopupMenuVisible()) {\n+            playerImpl.hideControls(0, 0);\n         }\n \n-        if (playerImpl.popupPlayerSelected()) {\n-            return onDownInPopup(e);\n-        } else {\n-            return true;\n+        if (portion == DisplayPortion.LEFT) {\n+            playerImpl.onFastRewind();\n+        } else if (portion == DisplayPortion.RIGHT) {", "originalCommit": "e97f71cf2c7005c114e2e81853063add9da5b496", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAwMjcyMg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#discussion_r516002722", "bodyText": "Oh, I missed this middle gesture somehow., my bad. I'll add it again (or if you'd like to you can do it since you're authorized) :')", "author": "vkay94", "createdAt": "2020-11-02T14:20:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4NzY3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAxNDYyNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4587#discussion_r516014624", "bodyText": "Ok, I'm gonna do it and then merge", "author": "Stypox", "createdAt": "2020-11-02T14:37:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTk4NzY3NA=="}], "type": "inlineReview", "revised_code": {"commit": "347566c311f9e215b48baa20ab3c10f53525f809", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java b/app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java\nindex 003b9ff9d..a23d5d3ff 100644\n--- a/app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java\n+++ b/app/src/main/java/org/schabi/newpipe/player/event/PlayerGestureListener.java\n\n@@ -62,6 +62,8 @@ public class PlayerGestureListener\n \n         if (portion == DisplayPortion.LEFT) {\n             playerImpl.onFastRewind();\n+        } else if (portion == DisplayPortion.MIDDLE) {\n+            playerImpl.onPlayPause();\n         } else if (portion == DisplayPortion.RIGHT) {\n             playerImpl.onFastForward();\n         }\n"}}, {"oid": "347566c311f9e215b48baa20ab3c10f53525f809", "url": "https://github.com/TeamNewPipe/NewPipe/commit/347566c311f9e215b48baa20ab3c10f53525f809", "message": "Player gestures: Add multi-double-tap logic", "committedDate": "2020-11-02T14:50:34Z", "type": "commit"}, {"oid": "347566c311f9e215b48baa20ab3c10f53525f809", "url": "https://github.com/TeamNewPipe/NewPipe/commit/347566c311f9e215b48baa20ab3c10f53525f809", "message": "Player gestures: Add multi-double-tap logic", "committedDate": "2020-11-02T14:50:34Z", "type": "forcePushed"}]}