{"pr_number": 3300, "pr_title": "handle ContentNotSupportedException", "pr_createdAt": "2020-03-30T10:16:10Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3300", "timeline": [{"oid": "c7497a4813cfdbfed1f512925e11fd5729dc3152", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c7497a4813cfdbfed1f512925e11fd5729dc3152", "message": "handle ContentNotAvailableException", "committedDate": "2020-03-30T10:33:04Z", "type": "forcePushed"}, {"oid": "9191f26e4865ef767d5c974859b548c9a41e005a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/9191f26e4865ef767d5c974859b548c9a41e005a", "message": "handle ContentNotSupportedException", "committedDate": "2020-03-30T10:34:19Z", "type": "forcePushed"}, {"oid": "ee41e1d28bb6accced853fe9f87f5557a92bbd8d", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ee41e1d28bb6accced853fe9f87f5557a92bbd8d", "message": "handle ContentNotSupportedException", "committedDate": "2020-03-30T10:38:42Z", "type": "forcePushed"}, {"oid": "7c508ce568e3ed6c71075e3a3f5f673126d38d2e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7c508ce568e3ed6c71075e3a3f5f673126d38d2e", "message": "use 2 \\n instead of 1 for content not supported message", "committedDate": "2020-04-01T20:52:23Z", "type": "forcePushed"}, {"oid": "47aa4eae3b0f4d9ee19d3ad1ca3b0bc610a97ba4", "url": "https://github.com/TeamNewPipe/NewPipe/commit/47aa4eae3b0f4d9ee19d3ad1ca3b0bc610a97ba4", "message": "handle ContentNotSupportedException in ExtractorHelper.handleGeneralException()", "committedDate": "2020-04-07T12:54:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk5ODQxNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3300#discussion_r405998415", "bodyText": "Rename this function to showContentNotSupported.", "author": "wb9688", "createdAt": "2020-04-09T07:07:57Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java", "diffHunk": "@@ -439,6 +468,13 @@ public void handleResult(@NonNull final ChannelInfo result) {\n                 .playOnBackgroundPlayer(activity, getPlayQueue(), false));\n     }\n \n+    private void updateNoVideoDisplay() {", "originalCommit": "7012fba665e7d749d8f069b2c953b6789535f27b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "073119ce8ec9715873cd1e1bb3c3921bdda3b304", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java b/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\nindex 90363c324..a78ddfa5d 100644\n--- a/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\n\n@@ -468,7 +467,7 @@ public class ChannelFragment extends BaseListInfoFragment<ChannelInfo> {\n                 .playOnBackgroundPlayer(activity, getPlayQueue(), false));\n     }\n \n-    private void updateNoVideoDisplay() {\n+    private void showContentNotSupported() {\n         contentNotSupportedTextView.setVisibility(View.VISIBLE);\n         kaomojiTextView.setText(\"(\ufe36\ufe39\ufe3a)\");\n         kaomojiTextView.setTextSize(TypedValue.COMPLEX_UNIT_SP, 45f);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMjY4Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3300#discussion_r406012682", "bodyText": "Can't you just use for (Throwable throwable : errors)? I.e.:\n        List<Throwable> errors = new ArrayList<>(result.getErrors());\n\n        // handling ContentNotSupportedException not to show the error but an appropriate string\n        // so that crashes won't be sent uselessly and the user will understand what happened\n        for (Throwable throwable : errors) {\n            if (throwable instanceof ContentNotSupportedException) {\n                showContentNotSupported();\n                errors.remove(throwable);\n            }\n        }\n\n        if (!errors.isEmpty()) {\n            showSnackBarError(result.getErrors(), UserAction.REQUESTED_CHANNEL,\n                    NewPipe.getNameOfService(result.getServiceId()), result.getUrl(), 0);\n        }", "author": "wb9688", "createdAt": "2020-04-09T07:37:47Z", "path": "app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java", "diffHunk": "@@ -417,9 +431,24 @@ public void handleResult(@NonNull final ChannelInfo result) {\n \n         playlistCtrl.setVisibility(View.VISIBLE);\n \n-        if (!result.getErrors().isEmpty()) {\n-            showSnackBarError(result.getErrors(), UserAction.REQUESTED_CHANNEL,\n-                    NewPipe.getNameOfService(result.getServiceId()), result.getUrl(), 0);\n+        List<Throwable> errors = result.getErrors();\n+        if (!errors.isEmpty()) {\n+\n+            // handling ContentNotSupportedException not to show the error but an appropriate string\n+            // so that crashes won't be sent uselessly and the user will understand what happened\n+            Iterator<Throwable> it = errors.iterator();\n+            while (it.hasNext()) {\n+                Throwable throwable = it.next();\n+                if (throwable instanceof ContentNotSupportedException) {\n+                    updateNoVideoDisplay();\n+                    it.remove();\n+                }\n+            }", "originalCommit": "7012fba665e7d749d8f069b2c953b6789535f27b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAyMjcyNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3300#discussion_r406022725", "bodyText": "Is it ConcurrentModificationException free? I was told that I should use iterator if I want to remove or add things while iterating because it's always safe.\nedit:\nIt is not safe. Test this:\nList<Integer> list = new ArrayList<>(\n for (int i = 0; i < 1000; i++)\n    list.add(i);\n}\n// works, `list` is all int from 0 to 999\nfor (Integer i : list) {\n    if (200 < i && i < 900) {\n        list.remove(i);\n       // at some point of the list, it will trigger ConcurrentModificationException\n    }\n}\nSystem.out.println(list);", "author": "B0pol", "createdAt": "2020-04-09T07:57:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMjY4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAzMjU1MA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3300#discussion_r406032550", "bodyText": "@B0pol: You're right. I'm used to Python. You should still remove the outer if though, and I still prefer making a copy of the list, though that uses more memory. You're also currently assuming there could only be one ContentNotSupportedException, while you wouldn't when just making a copy of the list.\n        List<Throwable> errors = new ArrayList<>(result.getErrors());\n\n        // handling ContentNotSupportedException not to show the error but an appropriate string\n        // so that crashes won't be sent uselessly and the user will understand what happened\n        Iterator<Throwable> it = errors.iterator();\n        while (it.hasNext()) {\n            Throwable throwable = it.next();\n            if (throwable instanceof ContentNotSupportedException) {\n                showContentNotSupported();\n                it.remove();\n            }\n        }\n\n        if (!errors.isEmpty()) {\n            showSnackBarError(result.getErrors(), UserAction.REQUESTED_CHANNEL,\n                    NewPipe.getNameOfService(result.getServiceId()), result.getUrl(), 0);\n        }", "author": "wb9688", "createdAt": "2020-04-09T08:14:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMjY4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ4MjgwNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3300#discussion_r406482804", "bodyText": "I'd keep the if, but also agree to use a copy of the list to keep the original order.", "author": "TobiGr", "createdAt": "2020-04-09T21:17:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMjY4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "073119ce8ec9715873cd1e1bb3c3921bdda3b304", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java b/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\nindex 90363c324..a78ddfa5d 100644\n--- a/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/fragments/list/channel/ChannelFragment.java\n\n@@ -431,22 +431,21 @@ public class ChannelFragment extends BaseListInfoFragment<ChannelInfo> {\n \n         playlistCtrl.setVisibility(View.VISIBLE);\n \n-        List<Throwable> errors = result.getErrors();\n+        List<Throwable> errors = new ArrayList<>(result.getErrors());\n         if (!errors.isEmpty()) {\n \n             // handling ContentNotSupportedException not to show the error but an appropriate string\n             // so that crashes won't be sent uselessly and the user will understand what happened\n-            Iterator<Throwable> it = errors.iterator();\n-            while (it.hasNext()) {\n+            for (Iterator<Throwable> it = errors.iterator(); it.hasNext(); ) {\n                 Throwable throwable = it.next();\n                 if (throwable instanceof ContentNotSupportedException) {\n-                    updateNoVideoDisplay();\n+                    showContentNotSupported();\n                     it.remove();\n                 }\n             }\n \n             if (!errors.isEmpty()) {\n-                showSnackBarError(result.getErrors(), UserAction.REQUESTED_CHANNEL,\n+                showSnackBarError(errors, UserAction.REQUESTED_CHANNEL,\n                         NewPipe.getNameOfService(result.getServiceId()), result.getUrl(), 0);\n             }\n         }\n"}}, {"oid": "073119ce8ec9715873cd1e1bb3c3921bdda3b304", "url": "https://github.com/TeamNewPipe/NewPipe/commit/073119ce8ec9715873cd1e1bb3c3921bdda3b304", "message": "handle ContentNotSupportedException for Channel Fragment (when an user has no video tab)", "committedDate": "2020-04-09T21:56:24Z", "type": "forcePushed"}, {"oid": "cc7a25d9ce8a4546e981d438e6b32125f3eac160", "url": "https://github.com/TeamNewPipe/NewPipe/commit/cc7a25d9ce8a4546e981d438e6b32125f3eac160", "message": "handle ContentNotSupportedException in BaseStateFragment\n\nthus not supported soundcloud streams (e.g. hls streams) don't crash\nanyore", "committedDate": "2020-04-09T21:58:01Z", "type": "commit"}, {"oid": "c392804f47e9fe2ac0c3f86ac9726fe63ed51751", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c392804f47e9fe2ac0c3f86ac9726fe63ed51751", "message": "handle ContentNotSupportedException in ExtractorHelper.handleGeneralException()", "committedDate": "2020-04-09T21:58:01Z", "type": "commit"}, {"oid": "769ebe20d9a263e6d668671047e9ed5d3bde019b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/769ebe20d9a263e6d668671047e9ed5d3bde019b", "message": "handle ContentNotSupportedException for Channel Fragment (when an user has no video tab)", "committedDate": "2020-04-09T21:58:02Z", "type": "forcePushed"}, {"oid": "4c128d837cbf778fcd5f1f7e1154e3f95da0aa4c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4c128d837cbf778fcd5f1f7e1154e3f95da0aa4c", "message": "handle ContentNotSupportedException for Channel Fragment (when an user has no video tab)", "committedDate": "2020-04-10T07:12:29Z", "type": "commit"}, {"oid": "4c128d837cbf778fcd5f1f7e1154e3f95da0aa4c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4c128d837cbf778fcd5f1f7e1154e3f95da0aa4c", "message": "handle ContentNotSupportedException for Channel Fragment (when an user has no video tab)", "committedDate": "2020-04-10T07:12:29Z", "type": "forcePushed"}]}