{"pr_number": 5228, "pr_title": "Remove timestamp from share url for all services except youtube", "pr_createdAt": "2020-12-19T23:15:43Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/5228", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzNTgyNQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5228#discussion_r546335825", "bodyText": "Can't ServiceHelper.getSelectedService be used? It has the advantage of not relying on the specific format of the url.", "author": "XiangRongLin", "createdAt": "2020-12-20T07:37:27Z", "path": "app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java", "diffHunk": "@@ -889,10 +889,15 @@ private void onMoreOptionsClicked() {\n     private void onShareClicked() {\n         // share video at the current time (youtube.com/watch?v=ID&t=SECONDS)\n         // Timestamp doesn't make sense in a live stream so drop it\n-        final String ts = isLive() ? \"\" : (\"&t=\" + (getPlaybackSeekBar().getProgress() / 1000));\n+\n+        String videoUrl = getVideoUrl();\n+        final int ts = getPlaybackSeekBar().getProgress() / 1000;\n+        if (!isLive() && videoUrl.contains(\"https://www.youtube.com\") && ts >= 0) {", "originalCommit": "9436828d8c3c34274f8cba23344df7e4bb4333fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MDkwNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5228#discussion_r546350907", "bodyText": "No because selected service isn't always video service. E.g, go to app drawer, select peertube, open a youtube link from an external lihk, and your are playing a youtube video in peertube selected service, and there won't be timestamp even if it should.\nWorse, select youtube service (by default when you open the app), open a link except youtube from an external app, there will be timestamp and will break video url\nand I know it's not the best solution but it's a quick one waiting for someone to properly work on the extractor side\n\nIdeally we should implement this\n#4316 (comment)\nwe also shouldn't even use URL there client-side, but add an extractor-side API for getting an URL with timestamp.\nbut it has been three months and no one is willing to work on this, then I'd like to get this PR merged for the next release.", "author": "B0pol", "createdAt": "2020-12-20T09:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzNTgyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MjMyMA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5228#discussion_r546352320", "bodyText": "Now I check video service id, instead of www.youtube.com (or selected service id)", "author": "B0pol", "createdAt": "2020-12-20T09:52:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzNTgyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM1MzEwNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/5228#discussion_r546353107", "bodyText": "Perfect, I just wanted to suggest this \ud83d\udc4d", "author": "TobiGr", "createdAt": "2020-12-20T09:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjMzNTgyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "b2b25dbebe0c50d311bd29e94bf3ade0d7bab4d7", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java b/app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java\nindex 34c2e7871..951e6f4d8 100644\n--- a/app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java\n+++ b/app/src/main/java/org/schabi/newpipe/player/VideoPlayerImpl.java\n\n@@ -890,9 +891,11 @@ public class VideoPlayerImpl extends VideoPlayer\n         // share video at the current time (youtube.com/watch?v=ID&t=SECONDS)\n         // Timestamp doesn't make sense in a live stream so drop it\n \n-        String videoUrl = getVideoUrl();\n         final int ts = getPlaybackSeekBar().getProgress() / 1000;\n-        if (!isLive() && videoUrl.contains(\"https://www.youtube.com\") && ts >= 0) {\n+        final MediaSourceTag metadata = getCurrentMetadata();\n+        String videoUrl = getVideoUrl();\n+        if (!isLive() && metadata != null\n+                && metadata.getMetadata().getServiceId() == YouTube.getServiceId() && ts >= 0) {\n             videoUrl += (\"&t=\" + ts);\n         }\n         ShareUtils.shareUrl(service,\n"}}, {"oid": "b2b25dbebe0c50d311bd29e94bf3ade0d7bab4d7", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b2b25dbebe0c50d311bd29e94bf3ade0d7bab4d7", "message": "remove timestamp from share url for all services except youtube\n\nIt produces not found error for PeerTube, media.ccc.de, SoundCloud", "committedDate": "2020-12-20T09:51:22Z", "type": "forcePushed"}, {"oid": "7a7a90bf79a613dad94fac4eea1af3747ccbb725", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7a7a90bf79a613dad94fac4eea1af3747ccbb725", "message": "remove timestamp from share url for all services except youtube\n\nIt produces not found error for PeerTube, media.ccc.de, SoundCloud", "committedDate": "2020-12-20T09:53:22Z", "type": "commit"}, {"oid": "7a7a90bf79a613dad94fac4eea1af3747ccbb725", "url": "https://github.com/TeamNewPipe/NewPipe/commit/7a7a90bf79a613dad94fac4eea1af3747ccbb725", "message": "remove timestamp from share url for all services except youtube\n\nIt produces not found error for PeerTube, media.ccc.de, SoundCloud", "committedDate": "2020-12-20T09:53:22Z", "type": "forcePushed"}]}