{"pr_number": 2921, "pr_title": "Add language selector to change the app language", "pr_createdAt": "2020-01-04T20:56:22Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/2921", "timeline": [{"oid": "dea1e0dcb9652dbaddcd1f1de68d8a5d340426a2", "url": "https://github.com/TeamNewPipe/NewPipe/commit/dea1e0dcb9652dbaddcd1f1de68d8a5d340426a2", "message": "Update localizations settings\n\n1) now, on \u00ab content language \u00bb change, it will also change the app language\n2) added Esperanto to the list of language in content language", "committedDate": "2020-01-04T20:38:27Z", "type": "commit"}, {"oid": "3ad0e313caee037d42ea9a4ef89e80fbd04d9a2f", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3ad0e313caee037d42ea9a4ef89e80fbd04d9a2f", "message": "changed the way to change language, now is \u00abNewPipe's language\u00bb selector", "committedDate": "2020-01-09T08:40:05Z", "type": "commit"}, {"oid": "e0a39efa2b9d61428a5cd3dafbf28266d98a1e1c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e0a39efa2b9d61428a5cd3dafbf28266d98a1e1c", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-09T09:07:22Z", "type": "commit"}, {"oid": "ed9a3517c63708a613373ff274cd6eeec63f79ff", "url": "https://github.com/TeamNewPipe/NewPipe/commit/ed9a3517c63708a613373ff274cd6eeec63f79ff", "message": "removed unused imports", "committedDate": "2020-01-09T11:15:01Z", "type": "commit"}, {"oid": "b32935a1b087bbc6d19fb7e50493273796d2ffb4", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b32935a1b087bbc6d19fb7e50493273796d2ffb4", "message": "app language now changes time formatting (3hrs ago), was system language b4", "committedDate": "2020-01-09T14:51:41Z", "type": "commit"}, {"oid": "8f46432391578b6602cea69ef344817857f75a7e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/8f46432391578b6602cea69ef344817857f75a7e", "message": "fixed some activities where the wrong languages would be set", "committedDate": "2020-01-10T14:50:15Z", "type": "commit"}, {"oid": "11d06dc86d8e1f0e2614251a1359e36dd537a81c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/11d06dc86d8e1f0e2614251a1359e36dd537a81c", "message": "remove todo as it's already done", "committedDate": "2020-01-10T15:03:24Z", "type": "commit"}, {"oid": "382e69273ee29ce62ee39ecfc55ba03351b52820", "url": "https://github.com/TeamNewPipe/NewPipe/commit/382e69273ee29ce62ee39ecfc55ba03351b52820", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-14T10:11:45Z", "type": "commit"}, {"oid": "f8a7aac40d0e7e1a6558753e012dabd6f97d7df7", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f8a7aac40d0e7e1a6558753e012dabd6f97d7df7", "message": "fixed indonesian, see https://stackoverflow.com/questions/13291578/how-to-localize-an-android-app-in-indonesian-language", "committedDate": "2020-01-14T13:15:42Z", "type": "commit"}, {"oid": "055365a44931b65e9fffd0d5d57595fe3be40abb", "url": "https://github.com/TeamNewPipe/NewPipe/commit/055365a44931b65e9fffd0d5d57595fe3be40abb", "message": "added Occitan to the selector", "committedDate": "2020-01-14T13:26:53Z", "type": "commit"}, {"oid": "105981b2eb426b598f81694442621e8b695a642e", "url": "https://github.com/TeamNewPipe/NewPipe/commit/105981b2eb426b598f81694442621e8b695a642e", "message": "made system translatable + renamed it to system's language", "committedDate": "2020-01-14T18:11:46Z", "type": "commit"}, {"oid": "9d8fcbbffe7ade9e662ab94e1a5a539a7e4e7d04", "url": "https://github.com/TeamNewPipe/NewPipe/commit/9d8fcbbffe7ade9e662ab94e1a5a539a7e4e7d04", "message": "fix: wrong language shown when rotating screen in popup player", "committedDate": "2020-01-15T07:33:57Z", "type": "commit"}, {"oid": "0cd9fb32a8cfdf71ab5083866a8f61192f412103", "url": "https://github.com/TeamNewPipe/NewPipe/commit/0cd9fb32a8cfdf71ab5083866a8f61192f412103", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-17T23:26:04Z", "type": "commit"}, {"oid": "b155f23d276ebc48ffe5fe86759320b6751ac512", "url": "https://github.com/TeamNewPipe/NewPipe/commit/b155f23d276ebc48ffe5fe86759320b6751ac512", "message": "fix: wrong language shown in playback parameters dialog\n\nThis is a hardly reproduceable bug that I hopefully fixed. After a long time of watching videos, you could have your system language shown in playback parameters dialog.\nCalling changeAppLanguage(getAppLocale(\u2026),\u2026) onCreate will most certainly fix this bug", "committedDate": "2020-01-18T08:46:38Z", "type": "commit"}, {"oid": "e08e7245738ca8ee5dab4dc5801dc6d35399873a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e08e7245738ca8ee5dab4dc5801dc6d35399873a", "message": "upload date in description now matches newpipe's language", "committedDate": "2020-01-18T09:46:53Z", "type": "commit"}, {"oid": "e58088d290e065b736f8feb5b1ce9d10465dd8e2", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e58088d290e065b736f8feb5b1ce9d10465dd8e2", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-19T17:09:17Z", "type": "commit"}, {"oid": "489420e8557917c7054eee30f65a79319c1f2c63", "url": "https://github.com/TeamNewPipe/NewPipe/commit/489420e8557917c7054eee30f65a79319c1f2c63", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-24T19:19:51Z", "type": "commit"}, {"oid": "e94981e6f7b4a0a33b3e5030d32f5ecbbcb88d52", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e94981e6f7b4a0a33b3e5030d32f5ecbbcb88d52", "message": "Merge branch 'dev' into dev", "committedDate": "2020-01-27T18:24:18Z", "type": "commit"}, {"oid": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1", "url": "https://github.com/TeamNewPipe/NewPipe/commit/156a2eb4ffe7479333536f3195ed3ceee63fa7f1", "message": "update prettytime dependency\n\nsee https://github.com/TeamNewPipe/NewPipe/pull/2921#issuecomment-572601812\nIt will add Esperanto, add bengali, update vietnamese\npretty time is the library used in the home page: \u2026 days ago", "committedDate": "2020-01-27T18:32:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTQwNg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371759406", "bodyText": "Is this to differentiate between accents like EN-GB and EN-US? If yes, please add a comment to help others to understand this.", "author": "TobiGr", "createdAt": "2020-01-28T11:56:46Z", "path": "app/src/main/java/org/schabi/newpipe/util/Localization.java", "diffHunk": "@@ -199,21 +204,41 @@ public static String getDurationString(long duration) {\n     // Pretty Time\n     //////////////////////////////////////////////////////////////////////////*/\n \n-    private static void initPrettyTime() {\n-        prettyTime = new PrettyTime(Locale.getDefault());\n+    private static void initPrettyTime(Context context) {\n+        prettyTime = new PrettyTime(getAppLocale(context));\n         // Do not use decades as YouTube doesn't either.\n         prettyTime.removeUnit(Decade.class);\n     }\n \n     private static PrettyTime getPrettyTime() {\n-        // If pretty time's Locale is different, init again with the new one.\n-        if (!prettyTime.getLocale().equals(Locale.getDefault())) {\n-            initPrettyTime();\n-        }\n         return prettyTime;\n     }\n \n     public static String relativeTime(Calendar calendarTime) {\n         return getPrettyTime().formatUnrounded(calendarTime);\n     }\n+\n+    public static void changeAppLanguage(Locale loc, Resources res) {\n+        DisplayMetrics dm = res.getDisplayMetrics();\n+        Configuration conf = res.getConfiguration();\n+        conf.setLocale(loc);\n+        res.updateConfiguration(conf, dm);\n+    }\n+\n+    public static Locale getAppLocale(Context context) {\n+        SharedPreferences prefs = androidx.preference.PreferenceManager.getDefaultSharedPreferences(context);\n+        String lang = prefs.getString(\"newpipes_language_key\", \"en\");\n+        Locale loc;\n+        if (lang.equals(\"system\")) {\n+            loc = Locale.getDefault();\n+        } else if (lang.matches(\".*-.*\")) {", "originalCommit": "156a2eb4ffe7479333536f3195ed3ceee63fa7f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTk3OTM0NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/2921#discussion_r371979345", "bodyText": "not en-gb and en-us (there is only one form of english in NewPipe and weblate), but pt (portugal) from pt-br (brazil), same for nl and nl-be, chinese\u2026", "author": "B0pol", "createdAt": "2020-01-28T18:28:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTc1OTQwNg=="}], "type": "inlineReview", "revised_code": {"commit": "edc9d47da795efbc1606efae50788bdc81f4468b", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/util/Localization.java b/app/src/main/java/org/schabi/newpipe/util/Localization.java\nindex d2fbd3a65..6149118cc 100644\n--- a/app/src/main/java/org/schabi/newpipe/util/Localization.java\n+++ b/app/src/main/java/org/schabi/newpipe/util/Localization.java\n\n@@ -218,7 +218,7 @@ public class Localization {\n         return getPrettyTime().formatUnrounded(calendarTime);\n     }\n \n-    public static void changeAppLanguage(Locale loc, Resources res) {\n+    private static void changeAppLanguage(Locale loc, Resources res) {\n         DisplayMetrics dm = res.getDisplayMetrics();\n         Configuration conf = res.getConfiguration();\n         conf.setLocale(loc);\n"}}, {"oid": "edc9d47da795efbc1606efae50788bdc81f4468b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/edc9d47da795efbc1606efae50788bdc81f4468b", "message": "app language: refactoring\n\nrenamed NewPipe's language into App language, and same for all the\nconcerning thing (keys, comments\u2026)\n\nwe now call assureCorrectAppLanguage(CONTEXT) in activities needing it\ninstead of changeAppLanguage(getAppLocale(CONTEXT), RESOURCES)\nchangeAppLanguage becomes private.", "committedDate": "2020-01-29T20:21:00Z", "type": "commit"}, {"oid": "edc9d47da795efbc1606efae50788bdc81f4468b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/edc9d47da795efbc1606efae50788bdc81f4468b", "message": "app language: refactoring\n\nrenamed NewPipe's language into App language, and same for all the\nconcerning thing (keys, comments\u2026)\n\nwe now call assureCorrectAppLanguage(CONTEXT) in activities needing it\ninstead of changeAppLanguage(getAppLocale(CONTEXT), RESOURCES)\nchangeAppLanguage becomes private.", "committedDate": "2020-01-29T20:21:00Z", "type": "forcePushed"}, {"oid": "6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "message": "fix wrong language shown many popup dialogs\n\nChanged android.R.string.ok, which is \"OK\", into R.string.finish, which is also OK, but from our strings\nThen for a small amount of languages that don't have Android translation, it will show the good string.", "committedDate": "2020-02-01T08:44:49Z", "type": "commit"}, {"oid": "6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "url": "https://github.com/TeamNewPipe/NewPipe/commit/6be23a0a6fd7ea3ced7efed21c5b8e4b8321a7ec", "message": "fix wrong language shown many popup dialogs\n\nChanged android.R.string.ok, which is \"OK\", into R.string.finish, which is also OK, but from our strings\nThen for a small amount of languages that don't have Android translation, it will show the good string.", "committedDate": "2020-02-01T08:44:49Z", "type": "forcePushed"}, {"oid": "c5e6bb58bce295a18e0d5a478a7c77eb0ee522b9", "url": "https://github.com/TeamNewPipe/NewPipe/commit/c5e6bb58bce295a18e0d5a478a7c77eb0ee522b9", "message": "Merge remote-tracking branch 'upstream/dev' into dev\n\nmerging dev", "committedDate": "2020-02-01T14:11:01Z", "type": "commit"}, {"oid": "55a138e8da10ffb7b9a18b9ee602c20f2ef4b307", "url": "https://github.com/TeamNewPipe/NewPipe/commit/55a138e8da10ffb7b9a18b9ee602c20f2ef4b307", "message": "fix toast on app language change\n\nI forgot to change the key here when I renamed it", "committedDate": "2020-02-01T14:30:51Z", "type": "commit"}, {"oid": "d36ac7a5dee1c460e5bf06dd291f292830e77dd4", "url": "https://github.com/TeamNewPipe/NewPipe/commit/d36ac7a5dee1c460e5bf06dd291f292830e77dd4", "message": "Improve formatting", "committedDate": "2020-02-01T14:35:33Z", "type": "commit"}]}