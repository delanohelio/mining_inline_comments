{"pr_number": 3004, "pr_title": "ask for display over other apps permission in settings", "pr_createdAt": "2020-01-25T17:06:34Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3004", "timeline": [{"oid": "e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "url": "https://github.com/TeamNewPipe/NewPipe/commit/e1145f16f2b49b07d6a74d3ebe1fe6e22095ec3b", "message": "ask for display over other apps permission in settings", "committedDate": "2020-01-25T17:00:49Z", "type": "commit"}, {"oid": "52420d4bf109bc36d4b299283f317aa43e86ff06", "url": "https://github.com/TeamNewPipe/NewPipe/commit/52420d4bf109bc36d4b299283f317aa43e86ff06", "message": "Merge branch 'dev' into ask-overlay-perm-settings", "committedDate": "2020-01-26T04:27:30Z", "type": "commit"}, {"oid": "1f24c186146c17f6fe5e140539cc7e56b2266062", "url": "https://github.com/TeamNewPipe/NewPipe/commit/1f24c186146c17f6fe5e140539cc7e56b2266062", "message": "reformatted and commented code", "committedDate": "2020-01-28T14:44:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1MzQ4NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3004#discussion_r371853485", "bodyText": "Suggestion:\npublic void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n    // on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n    // display over other apps permission, so show a snackbar to let the user give permission\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\n            s.equals(getString(R.string.minimize_on_exit_key))) {\n\n        String newSetting = sharedPreferences.getString(s,null);\n        if(newSetting != null &&\n                newSetting.equals(getString(R.string.minimize_on_exit_popup_key)) &&\n                !Settings.canDrawOverlays(getContext())) {\n\n            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n                           .setAction(R.string.settings, new View.OnClickListener() {\n                               @Override\n                               public void onClick(View view) {\n                                   PermissionHelper.checkSystemAlertWindowPermission(getContext());\n                               }\n                           })\n                           .show();\n        }\n    }\n}", "author": "Stypox", "createdAt": "2020-01-28T14:58:18Z", "path": "app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java", "diffHunk": "@@ -1,12 +1,75 @@\n package org.schabi.newpipe.settings;\n \n+import android.content.SharedPreferences;\n+import android.os.Build;\n import android.os.Bundle;\n+import android.provider.Settings;\n+import android.view.View;\n+\n+import androidx.annotation.Nullable;\n+\n+import com.google.android.material.snackbar.Snackbar;\n \n import org.schabi.newpipe.R;\n+import org.schabi.newpipe.util.PermissionHelper;\n \n public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n+\n+    private SharedPreferences.OnSharedPreferenceChangeListener listener;\n+\n+    @Override\n+    public void onCreate(@Nullable Bundle savedInstanceState) {\n+        super.onCreate(savedInstanceState);\n+\n+        listener = new SharedPreferences.OnSharedPreferenceChangeListener() {\n+            @Override\n+            public void onSharedPreferenceChanged(SharedPreferences sharedPreferences, String s) {\n+\n+                //on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n+                //display over other apps permission, show a snackbar to let the user give permission\n+                if(s.equals(getString(R.string.minimize_on_exit_key))){\n+\n+                    String newSetting = sharedPreferences.getString(s,null);\n+                    if(newSetting != null){\n+\n+                        if(newSetting.equals(getString(R.string.minimize_on_exit_popup_key))){\n+\n+                            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && !Settings.canDrawOverlays(getContext())){\n+\n+                                Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n+                                        .setAction(R.string.settings, new View.OnClickListener() {\n+                                            @Override\n+                                            public void onClick(View view) {\n+                                                PermissionHelper.checkSystemAlertWindowPermission(getContext());\n+                                            }\n+                                        })\n+                                        .show();\n+\n+                            }\n+                        }\n+                    }\n+                }\n+            }", "originalCommit": "1f24c186146c17f6fe5e140539cc7e56b2266062", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a78762756a68b8db5fd711f461e53b8aed0a3c48", "chunk": "diff --git a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\nindex 86b04c4a7..6d32fb39f 100644\n--- a/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n+++ b/app/src/main/java/org/schabi/newpipe/settings/VideoAudioSettingsFragment.java\n\n@@ -27,29 +27,27 @@ public class VideoAudioSettingsFragment extends BasePreferenceFragment {\n \n                 //on M and above, if user chooses to minimise to popup player on exit and the app doesn't have\n                 //display over other apps permission, show a snackbar to let the user give permission\n-                if(s.equals(getString(R.string.minimize_on_exit_key))){\n+                if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M &&\n+                        s.equals(getString(R.string.minimize_on_exit_key))){\n \n                     String newSetting = sharedPreferences.getString(s,null);\n-                    if(newSetting != null){\n+                    if(newSetting != null\n+                            && newSetting.equals(getString(R.string.minimize_on_exit_popup_key))\n+                            && !Settings.canDrawOverlays(getContext())){\n+\n+                            Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n+                                    .setAction(R.string.settings, new View.OnClickListener() {\n+                                        @Override\n+                                        public void onClick(View view) {\n+                                            PermissionHelper.checkSystemAlertWindowPermission(getContext());\n+                                        }\n+                                    })\n+                                    .show();\n \n-                        if(newSetting.equals(getString(R.string.minimize_on_exit_popup_key))){\n-\n-                            if(Build.VERSION.SDK_INT >= Build.VERSION_CODES.M && !Settings.canDrawOverlays(getContext())){\n-\n-                                Snackbar.make(getListView(),R.string.permission_display_over_apps,Snackbar.LENGTH_INDEFINITE)\n-                                        .setAction(R.string.settings, new View.OnClickListener() {\n-                                            @Override\n-                                            public void onClick(View view) {\n-                                                PermissionHelper.checkSystemAlertWindowPermission(getContext());\n-                                            }\n-                                        })\n-                                        .show();\n-\n-                            }\n-                        }\n                     }\n                 }\n             }\n+\n         };\n     }\n \n"}}, {"oid": "a78762756a68b8db5fd711f461e53b8aed0a3c48", "url": "https://github.com/TeamNewPipe/NewPipe/commit/a78762756a68b8db5fd711f461e53b8aed0a3c48", "message": "reformatted code", "committedDate": "2020-01-28T15:24:24Z", "type": "commit"}, {"oid": "f7203d4ac9666c1eee10374210c2f92ec50a2eba", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f7203d4ac9666c1eee10374210c2f92ec50a2eba", "message": "Fix formatting and use lamda functions", "committedDate": "2020-02-01T12:41:03Z", "type": "commit"}]}