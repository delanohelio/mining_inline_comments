{"pr_number": 1601, "pr_title": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "pr_createdAt": "2020-10-23T01:18:06Z", "pr_url": "https://github.com/apache/hive/pull/1601", "timeline": [{"oid": "dd636fa93d4744f67bcc9a3c68b1c94ecd7d2805", "url": "https://github.com/apache/hive/commit/dd636fa93d4744f67bcc9a3c68b1c94ecd7d2805", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-10-23T07:29:54Z", "type": "forcePushed"}, {"oid": "7ab8c06af65279b66b89f90d2a9903a02ee50e12", "url": "https://github.com/apache/hive/commit/7ab8c06af65279b66b89f90d2a9903a02ee50e12", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-10-23T18:25:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIzMDI5OQ==", "url": "https://github.com/apache/hive/pull/1601#discussion_r513230299", "bodyText": "Nit: Instead of using a try-catch block, you could use StringUtils.isNumeric() to determine if a string is a positive decimal number.", "author": "lcspinter", "createdAt": "2020-10-28T07:34:00Z", "path": "serde/src/java/org/apache/hadoop/hive/serde2/avro/SchemaToTypeInfo.java", "diffHunk": "@@ -186,6 +188,20 @@ public static TypeInfo generateTypeInfo(Schema schema,\n     return typeInfoCache.retrieve(schema, seenSchemas);\n   }\n \n+  private static int getIntValue(JsonNode jsonNode) {\n+    int value = 0;\n+    if (jsonNode instanceof TextNode) {\n+      try {", "originalCommit": "7ab8c06af65279b66b89f90d2a9903a02ee50e12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTczNzQ1NA==", "url": "https://github.com/apache/hive/pull/1601#discussion_r515737454", "bodyText": "Done.", "author": "nareshpr", "createdAt": "2020-11-02T04:42:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzIzMDI5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "00464bcf6f5b76c1248d9096354819921cf778c6", "chunk": "diff --git a/serde/src/java/org/apache/hadoop/hive/serde2/avro/SchemaToTypeInfo.java b/serde/src/java/org/apache/hadoop/hive/serde2/avro/SchemaToTypeInfo.java\nindex 181665d276..a2b8476fc6 100644\n--- a/serde/src/java/org/apache/hadoop/hive/serde2/avro/SchemaToTypeInfo.java\n+++ b/serde/src/java/org/apache/hadoop/hive/serde2/avro/SchemaToTypeInfo.java\n\n@@ -189,15 +190,9 @@ public static TypeInfo generateTypeInfo(Schema schema,\n   }\n \n   private static int getIntValue(JsonNode jsonNode) {\n-    int value = 0;\n-    if (jsonNode instanceof TextNode) {\n-      try {\n+    int value = jsonNode.getIntValue();\n+    if (jsonNode instanceof TextNode && StringUtils.isNumeric(jsonNode.getTextValue())) {\n         value = Integer.parseInt(jsonNode.getTextValue());\n-      } catch (Exception e) {\n-        // Ignore invalid string\n-      }\n-    } else {\n-      value = jsonNode.getIntValue();\n     }\n     return value;\n   }\n"}}, {"oid": "00464bcf6f5b76c1248d9096354819921cf778c6", "url": "https://github.com/apache/hive/commit/00464bcf6f5b76c1248d9096354819921cf778c6", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-10-30T05:57:32Z", "type": "forcePushed"}, {"oid": "446fcda02f8294b385d4041bcf61c69c31e5a789", "url": "https://github.com/apache/hive/commit/446fcda02f8294b385d4041bcf61c69c31e5a789", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-01T05:56:10Z", "type": "forcePushed"}, {"oid": "2cb83b8abc440ac9b93445691e94804a259e5c6f", "url": "https://github.com/apache/hive/commit/2cb83b8abc440ac9b93445691e94804a259e5c6f", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-02T04:43:04Z", "type": "forcePushed"}, {"oid": "dfaca95b9b22177f78b0888fcae80e4fa80d1c8a", "url": "https://github.com/apache/hive/commit/dfaca95b9b22177f78b0888fcae80e4fa80d1c8a", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-02T18:43:55Z", "type": "forcePushed"}, {"oid": "51255ec90320a576f597f4912ce6d39412111fd1", "url": "https://github.com/apache/hive/commit/51255ec90320a576f597f4912ce6d39412111fd1", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-03T04:39:33Z", "type": "forcePushed"}, {"oid": "cfe8a0f793821f26e61b8494eb244c6aca3a9d66", "url": "https://github.com/apache/hive/commit/cfe8a0f793821f26e61b8494eb244c6aca3a9d66", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-04T04:26:18Z", "type": "commit"}, {"oid": "cfe8a0f793821f26e61b8494eb244c6aca3a9d66", "url": "https://github.com/apache/hive/commit/cfe8a0f793821f26e61b8494eb244c6aca3a9d66", "message": "HIVE-24305: avro decimal schema is not properly populating scale/precision if value is enclosed in quote", "committedDate": "2020-11-04T04:26:18Z", "type": "forcePushed"}]}