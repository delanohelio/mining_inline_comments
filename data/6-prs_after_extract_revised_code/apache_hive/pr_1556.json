{"pr_number": 1556, "pr_title": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly", "pr_createdAt": "2020-10-06T09:50:04Z", "pr_url": "https://github.com/apache/hive/pull/1556", "timeline": [{"oid": "857601d696d3692e735f81d285910d31ff06c195", "url": "https://github.com/apache/hive/commit/857601d696d3692e735f81d285910d31ff06c195", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-06T09:53:35Z", "type": "forcePushed"}, {"oid": "45b1ea298efe61e9de2a7b3086387b5a6c25e71b", "url": "https://github.com/apache/hive/commit/45b1ea298efe61e9de2a7b3086387b5a6c25e71b", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-08T15:28:59Z", "type": "forcePushed"}, {"oid": "f4d6864e9183fecf4b24f2d951cfe572b7d23737", "url": "https://github.com/apache/hive/commit/f4d6864e9183fecf4b24f2d951cfe572b7d23737", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-12T11:11:50Z", "type": "forcePushed"}, {"oid": "75a741124b80f4787c7819d1f79ecdb96cfa684e", "url": "https://github.com/apache/hive/commit/75a741124b80f4787c7819d1f79ecdb96cfa684e", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-14T08:28:37Z", "type": "forcePushed"}, {"oid": "b8e0f9256227165db2b0f6208af80e3362c75e3f", "url": "https://github.com/apache/hive/commit/b8e0f9256227165db2b0f6208af80e3362c75e3f", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-28T22:31:08Z", "type": "forcePushed"}, {"oid": "a6253b8c08ed326811fb3135e584ba6c227ff96d", "url": "https://github.com/apache/hive/commit/a6253b8c08ed326811fb3135e584ba6c227ff96d", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-29T06:42:56Z", "type": "forcePushed"}, {"oid": "76ed4e64fb90c152bd14164bb01b3d654fa3256c", "url": "https://github.com/apache/hive/commit/76ed4e64fb90c152bd14164bb01b3d654fa3256c", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-10-30T11:59:52Z", "type": "forcePushed"}, {"oid": "bc964fe9add5cfe986c8bfabbf6a384549ac5274", "url": "https://github.com/apache/hive/commit/bc964fe9add5cfe986c8bfabbf6a384549ac5274", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-02T08:32:00Z", "type": "forcePushed"}, {"oid": "2c0c58512528d61fa863b5c232e7fac61ffccfb5", "url": "https://github.com/apache/hive/commit/2c0c58512528d61fa863b5c232e7fac61ffccfb5", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-04T08:53:02Z", "type": "forcePushed"}, {"oid": "bade21136ecc07d5a6bbcc253e933c24691a278e", "url": "https://github.com/apache/hive/commit/bade21136ecc07d5a6bbcc253e933c24691a278e", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-07T09:31:57Z", "type": "forcePushed"}, {"oid": "a43064fc9f668b39385f048f5649384803fe7b5b", "url": "https://github.com/apache/hive/commit/a43064fc9f668b39385f048f5649384803fe7b5b", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-08T10:40:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxODQxNA==", "url": "https://github.com/apache/hive/pull/1556#discussion_r539818414", "bodyText": "remove this?", "author": "rbalamohan", "createdAt": "2020-12-10T03:31:07Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/LimitOperator.java", "diffHunk": "@@ -19,11 +19,18 @@\n package org.apache.hadoop.hive.ql.exec;\n \n import java.io.Serializable;\n+import java.util.concurrent.Callable;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+import java.util.concurrent.atomic.AtomicInteger;\n \n import org.apache.hadoop.conf.Configuration;\n+import org.apache.hadoop.hive.conf.HiveConf;\n import org.apache.hadoop.hive.ql.CompilationOpContext;\n+import org.apache.hadoop.hive.ql.exec.tez.DagUtils;\n+import org.apache.hadoop.hive.ql.exec.tez.LlapObjectCache;\n import org.apache.hadoop.hive.ql.metadata.HiveException;\n import org.apache.hadoop.hive.ql.plan.LimitDesc;\n+import org.apache.hadoop.hive.ql.plan.OperatorDesc;", "originalCommit": "a43064fc9f668b39385f048f5649384803fe7b5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNTEwOA==", "url": "https://github.com/apache/hive/pull/1556#discussion_r540005108", "bodyText": "I'll do", "author": "abstractdog", "createdAt": "2020-12-10T09:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxODQxNA=="}], "type": "inlineReview", "revised_code": {"commit": "25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "chunk": "diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/LimitOperator.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/LimitOperator.java\nindex 981d88769f..608a0fd679 100644\n--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/LimitOperator.java\n+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/LimitOperator.java\n\n@@ -26,11 +26,10 @@\n import org.apache.hadoop.conf.Configuration;\n import org.apache.hadoop.hive.conf.HiveConf;\n import org.apache.hadoop.hive.ql.CompilationOpContext;\n-import org.apache.hadoop.hive.ql.exec.tez.DagUtils;\n import org.apache.hadoop.hive.ql.exec.tez.LlapObjectCache;\n+import org.apache.hadoop.hive.ql.exec.tez.TezProcessor;\n import org.apache.hadoop.hive.ql.metadata.HiveException;\n import org.apache.hadoop.hive.ql.plan.LimitDesc;\n-import org.apache.hadoop.hive.ql.plan.OperatorDesc;\n import org.apache.hadoop.hive.ql.plan.api.OperatorType;\n \n /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgyMDM3MA==", "url": "https://github.com/apache/hive/pull/1556#discussion_r539820370", "bodyText": "Move this in TezProcessor itself? It is not DAG specific and is needed mainly for logging purposes. Having it within TezProcessor will make it easier to read and not confuse anyone trying to walk through DagUtils.", "author": "rbalamohan", "createdAt": "2020-12-10T03:36:35Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java", "diffHunk": "@@ -1811,4 +1819,11 @@ static long parseRightmostXmx(String javaOpts) {\n     }\n     return allNonAppFileResources;\n   }\n+\n+  public static void initTezAttributes(Configuration conf, ProcessorContext context) {", "originalCommit": "a43064fc9f668b39385f048f5649384803fe7b5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDAwNzI3Ng==", "url": "https://github.com/apache/hive/pull/1556#discussion_r540007276", "bodyText": "makes sense\nI want to rely on this in later patches, e.g. HIVE-24278, but I think we can still make use of these properties runtime if it's moved to  TezProcessor, I'll do that", "author": "abstractdog", "createdAt": "2020-12-10T09:25:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgyMDM3MA=="}], "type": "inlineReview", "revised_code": {"commit": "25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "chunk": "diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java\nindex dd81a46d5e..877a8979bd 100644\n--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java\n+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java\n\n@@ -1819,11 +1811,4 @@ static long parseRightmostXmx(String javaOpts) {\n     }\n     return allNonAppFileResources;\n   }\n-\n-  public static void initTezAttributes(Configuration conf, ProcessorContext context) {\n-    conf.set(HIVE_TEZ_VERTEX_NAME, context.getTaskVertexName());\n-    conf.setInt(HIVE_TEZ_VERTEX_INDEX, context.getTaskVertexIndex());\n-    conf.setInt(HIVE_TEZ_TASK_INDEX, context.getTaskIndex());\n-    conf.setInt(HIVE_TEZ_TASK_ATTEMPT_NUMBER, context.getTaskAttemptNumber());\n-  }\n }\n"}}, {"oid": "25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "url": "https://github.com/apache/hive/commit/25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-10T11:11:01Z", "type": "commit"}, {"oid": "25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "url": "https://github.com/apache/hive/commit/25f8f8aec4b03003eb2dc4ac8e305d72e2a973a2", "message": "HIVE-24207: LimitOperator can leverage ObjectCache to bail out quickly\n\nChange-Id: I12d2719acdf80ffa3a5c14b1c3fce2d4cbe00911", "committedDate": "2020-12-10T11:11:01Z", "type": "forcePushed"}]}