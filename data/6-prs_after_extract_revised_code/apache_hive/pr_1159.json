{"pr_number": 1159, "pr_title": "HIVE-23741: Store CacheTags in the file cache level", "pr_createdAt": "2020-06-22T14:32:27Z", "pr_url": "https://github.com/apache/hive/pull/1159", "timeline": [{"oid": "410c7b1601bd6cafa4b870011f1a0e7d1268bb32", "url": "https://github.com/apache/hive/commit/410c7b1601bd6cafa4b870011f1a0e7d1268bb32", "message": "HIVE-23741: Store CacheTags in the file cache level\n\nChange-Id: I2985b74b7b7864734d03180992295621bb82f9b5", "committedDate": "2020-06-22T14:27:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc3MTk2Mg==", "url": "https://github.com/apache/hive/pull/1159#discussion_r444771962", "bodyText": "This sets the reference from buffer to filecache instance alright.\nBut as far as I see this only happens when LowLevelCacheImpl is used, aka caching Orc files, how does this reference setting happen with the SerdeLowLevelCache (text based files)?", "author": "szlta", "createdAt": "2020-06-24T09:39:58Z", "path": "llap-server/src/java/org/apache/hadoop/hive/llap/cache/LowLevelCacheImpl.java", "diffHunk": "@@ -305,10 +305,10 @@ private boolean lockBuffer(LlapDataBuffer buffer, boolean doNotifyPolicy) {\n         long offset = ranges[i].getOffset() + baseOffset;\n         assert buffer.declaredCachedLength == LlapDataBuffer.UNKNOWN_CACHED_LENGTH;\n         buffer.declaredCachedLength = ranges[i].getLength();\n-        buffer.setTag(tag);\n         while (true) { // Overwhelmingly executes once, or maybe twice (replacing stale value).\n           LlapDataBuffer oldVal = subCache.getCache().putIfAbsent(offset, buffer);\n           if (oldVal == null) {\n+            buffer.setFileCache(subCache);", "originalCommit": "410c7b1601bd6cafa4b870011f1a0e7d1268bb32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYxOTEzMw==", "url": "https://github.com/apache/hive/pull/1159#discussion_r445619133", "bodyText": "Thanks, it's fixed now.", "author": "asinkovits", "createdAt": "2020-06-25T14:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc3MTk2Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e20caf1c0fefc174c9782a2448278c5176a01546", "url": "https://github.com/apache/hive/commit/e20caf1c0fefc174c9782a2448278c5176a01546", "message": "Cache tag extract for text files as well.\n\nChange-Id: I2928360d5fafed629bf96af487b24e0f56107945", "committedDate": "2020-06-25T14:16:23Z", "type": "commit"}, {"oid": "9fffdf269f3f281a3707c7d9f466b812e72c71cf", "url": "https://github.com/apache/hive/commit/9fffdf269f3f281a3707c7d9f466b812e72c71cf", "message": "Revert some required methods back from the base class.\n\nChange-Id: I2bf372d242e6f0237f52ab2828bce9cf8a03dfdb", "committedDate": "2020-06-26T07:39:48Z", "type": "commit"}]}