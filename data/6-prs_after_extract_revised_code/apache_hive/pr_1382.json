{"pr_number": 1382, "pr_title": "HIVE-24020: Fix Automatic compaction for streaming ingest with dynamic partition", "pr_createdAt": "2020-08-10T07:24:17Z", "pr_url": "https://github.com/apache/hive/pull/1382", "timeline": [{"oid": "af5c5fd9375c8d826ce16d02af40a1151c65c708", "url": "https://github.com/apache/hive/commit/af5c5fd9375c8d826ce16d02af40a1151c65c708", "message": "HIVE-24020: Fix Automaction compaction for streaming ingest with dynamic partition", "committedDate": "2020-08-10T07:14:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE4OTE1Mw==", "url": "https://github.com/apache/hive/pull/1382#discussion_r475189153", "bodyText": "Can we please rename the 'addedPartitions' to something like more resembling the actual usage, like 'updatedPartitions', or 'changedPartitions', or whatever? Maybe a comment on the attribute/and getter should be good as well.\nOtherwise LGTM.\nThanks, Peter", "author": "pvary", "createdAt": "2020-08-23T08:19:26Z", "path": "streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java", "diffHunk": "@@ -581,16 +582,9 @@ protected RecordUpdater getRecordUpdater(List<String> partitionValues, int bucke\n           destLocation = new Path(table.getSd().getLocation());\n         } else {\n           PartitionInfo partitionInfo = conn.createPartitionIfNotExists(partitionValues);\n-          // collect the newly added partitions. connection.commitTransaction() will report the dynamically added\n-          // partitions to TxnHandler\n-          if (!partitionInfo.isExists()) {\n-            addedPartitions.add(partitionInfo.getName());\n-          } else {\n-            if (LOG.isDebugEnabled()) {\n-              LOG.debug(\"Partition {} already exists for table {}\",\n-                  partitionInfo.getName(), fullyQualifiedTableName);\n-            }\n-          }\n+          // collect the newly added/updated partitions. connection.commitTransaction() will report the dynamically\n+          // added partitions to TxnHandler\n+          addedPartitions.add(partitionInfo.getName());", "originalCommit": "af5c5fd9375c8d826ce16d02af40a1151c65c708", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIxOTAzMQ==", "url": "https://github.com/apache/hive/pull/1382#discussion_r475219031", "bodyText": "Done.", "author": "vpnvishv", "createdAt": "2020-08-23T13:22:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE4OTE1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "943d70a947dc1fc705da9d8ace6e029a0ebac85c", "chunk": "diff --git a/streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java b/streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java\nindex 3576b1323d..a7c366487a 100644\n--- a/streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java\n+++ b/streaming/src/java/org/apache/hive/streaming/AbstractRecordWriter.java\n\n@@ -584,7 +587,7 @@ protected RecordUpdater getRecordUpdater(List<String> partitionValues, int bucke\n           PartitionInfo partitionInfo = conn.createPartitionIfNotExists(partitionValues);\n           // collect the newly added/updated partitions. connection.commitTransaction() will report the dynamically\n           // added partitions to TxnHandler\n-          addedPartitions.add(partitionInfo.getName());\n+          updatedPartitions.add(partitionInfo.getName());\n           destLocation = new Path(partitionInfo.getPartitionLocation());\n         }\n         partitionPaths.put(key, destLocation);\n"}}, {"oid": "943d70a947dc1fc705da9d8ace6e029a0ebac85c", "url": "https://github.com/apache/hive/commit/943d70a947dc1fc705da9d8ace6e029a0ebac85c", "message": "review comments", "committedDate": "2020-08-23T13:21:04Z", "type": "commit"}]}