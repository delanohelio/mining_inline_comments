{"pr_number": 1080, "pr_title": "HIVE-23026: Allow for custom YARN application name for TEZ queries (branch-2)", "pr_createdAt": "2020-06-08T17:29:41Z", "pr_url": "https://github.com/apache/hive/pull/1080", "timeline": [{"oid": "f2c9b49510c3f804726cce7b57a166245f329f8a", "url": "https://github.com/apache/hive/commit/f2c9b49510c3f804726cce7b57a166245f329f8a", "message": "Support for setup tez job name\n\nadd a configuration item 'tez.job.name'  to set tez job name", "committedDate": "2020-06-08T17:22:39Z", "type": "commit"}, {"oid": "e716908e288ff391058f78e2b5fedbec50a2684b", "url": "https://github.com/apache/hive/commit/e716908e288ff391058f78e2b5fedbec50a2684b", "message": "support for set the tez job name", "committedDate": "2020-06-08T17:25:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODI1NQ==", "url": "https://github.com/apache/hive/pull/1080#discussion_r437518255", "bodyText": "The second value here, I believe is a 'default' value. The default should be HIVE-%s. Also please update comments to explain how this works.", "author": "belugabehr", "createdAt": "2020-06-09T15:24:29Z", "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -1500,6 +1500,9 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n     HIVEQUERYNAME (\"hive.query.name\", null,\n         \"This named is used by Tez to set the dag name. This name in turn will appear on \\n\" +\n         \"the Tez UI representing the work that was done.\"),\n+    HIVETEZJOBNAME(\"tez.job.name\", null,", "originalCommit": "e716908e288ff391058f78e2b5fedbec50a2684b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MjE0MA==", "url": "https://github.com/apache/hive/pull/1080#discussion_r437552140", "bodyText": "We can use 'set tez.job.name=<customized_job_name>;' or '--hiveconf ez.job.name=<customized_job_name>'  to use this function to customize Yarn application name when we run a sql", "author": "xiejiajun", "createdAt": "2020-06-09T16:11:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODI1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "6853b449f8523e7d7e5e1f211b443018364e1f9c", "chunk": "diff --git a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\nindex 2cccdce65d..2be3bce4a7 100644\n--- a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n+++ b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n\n@@ -1500,7 +1500,7 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n     HIVEQUERYNAME (\"hive.query.name\", null,\n         \"This named is used by Tez to set the dag name. This name in turn will appear on \\n\" +\n         \"the Tez UI representing the work that was done.\"),\n-    HIVETEZJOBNAME(\"tez.job.name\", null,\n+    HIVETEZJOBNAME(\"tez.job.name\", \"HIVE-%s\",\n         \"This named is used by Tez to set the job name. This name in turn will appear on \\n\" +\n         \"the Yarn UI representing the Yarn Application Name.\"),\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODcwOQ==", "url": "https://github.com/apache/hive/pull/1080#discussion_r437518709", "bodyText": "Here is what I am suggesting:\n    String tezJobNameFormat = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME);\n    final TezClient session = TezClient.newBuilder(String.format(tezJobNameFormat, sessionId), tezConfig)", "author": "belugabehr", "createdAt": "2020-06-09T15:24:56Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java", "diffHunk": "@@ -317,7 +317,8 @@ protected void openInternal(final HiveConf conf, Collection<String> additionalFi\n \n     setupSessionAcls(tezConfig, conf);\n \n-    final TezClient session = TezClient.newBuilder(\"HIVE-\" + sessionId, tezConfig)\n+    String tezJobName = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME, sessionId);\n+    final TezClient session = TezClient.newBuilder(String.format(\"HIVE-%s\", tezJobName), tezConfig)", "originalCommit": "e716908e288ff391058f78e2b5fedbec50a2684b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU1MzQ5OQ==", "url": "https://github.com/apache/hive/pull/1080#discussion_r437553499", "bodyText": "Thanks for the hint, I have updated the code according to your suggestion", "author": "xiejiajun", "createdAt": "2020-06-09T16:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxODcwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "90d222dabb5e8ade9f55e303ac236a8e135e21ab", "chunk": "diff --git a/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java b/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java\nindex 096adcdb70..d718dc96bd 100644\n--- a/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java\n+++ b/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezSessionState.java\n\n@@ -317,8 +317,8 @@ protected void openInternal(final HiveConf conf, Collection<String> additionalFi\n \n     setupSessionAcls(tezConfig, conf);\n \n-    String tezJobName = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME, sessionId);\n-    final TezClient session = TezClient.newBuilder(String.format(\"HIVE-%s\", tezJobName), tezConfig)\n+    String tezJobNameFormat = HiveConf.getVar(conf, ConfVars.HIVETEZJOBNAME);\n+    final TezClient session = TezClient.newBuilder(String.format(tezJobNameFormat, sessionId), tezConfig)\n         .setIsSession(true).setLocalResources(commonLocalResources)\n         .setCredentials(llapCredentials).setServicePluginDescriptor(servicePluginsDescriptor)\n         .build();\n"}}, {"oid": "6853b449f8523e7d7e5e1f211b443018364e1f9c", "url": "https://github.com/apache/hive/commit/6853b449f8523e7d7e5e1f211b443018364e1f9c", "message": "update tez job name default scheme", "committedDate": "2020-06-09T15:54:23Z", "type": "commit"}, {"oid": "90d222dabb5e8ade9f55e303ac236a8e135e21ab", "url": "https://github.com/apache/hive/commit/90d222dabb5e8ade9f55e303ac236a8e135e21ab", "message": "update tez job format", "committedDate": "2020-06-09T15:59:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwOTU4MQ==", "url": "https://github.com/apache/hive/pull/1080#discussion_r438109581", "bodyText": "Still need to update this comment.  Something like:\nThe job name may be a Java String.format() String, to which a the session ID will be supplied as the single parameter.", "author": "belugabehr", "createdAt": "2020-06-10T13:11:34Z", "path": "common/src/java/org/apache/hadoop/hive/conf/HiveConf.java", "diffHunk": "@@ -1500,6 +1500,9 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n     HIVEQUERYNAME (\"hive.query.name\", null,\n         \"This named is used by Tez to set the dag name. This name in turn will appear on \\n\" +\n         \"the Tez UI representing the work that was done.\"),\n+    HIVETEZJOBNAME(\"tez.job.name\", \"HIVE-%s\",\n+        \"This named is used by Tez to set the job name. This name in turn will appear on \\n\" +\n+        \"the Yarn UI representing the Yarn Application Name.\"),", "originalCommit": "90d222dabb5e8ade9f55e303ac236a8e135e21ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE4NDYyMg==", "url": "https://github.com/apache/hive/pull/1080#discussion_r438184622", "bodyText": "@belugabehr\nok. I have updated the comment", "author": "xiejiajun", "createdAt": "2020-06-10T14:51:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODEwOTU4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b37ba64d918325ec778ead26baeadff2bb609f7f", "chunk": "diff --git a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\nindex 2be3bce4a7..a1d4866c3d 100644\n--- a/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n+++ b/common/src/java/org/apache/hadoop/hive/conf/HiveConf.java\n\n@@ -1502,7 +1502,8 @@ private static void populateLlapDaemonVarsSet(Set<String> llapDaemonVarsSetLocal\n         \"the Tez UI representing the work that was done.\"),\n     HIVETEZJOBNAME(\"tez.job.name\", \"HIVE-%s\",\n         \"This named is used by Tez to set the job name. This name in turn will appear on \\n\" +\n-        \"the Yarn UI representing the Yarn Application Name.\"),\n+        \"the Yarn UI representing the Yarn Application Name And The job name may be a \\n\" +\n+        \"Java String.format() string, to which the session ID will be supplied as the single parameter.\"),\n \n     HIVEOPTIMIZEBUCKETINGSORTING(\"hive.optimize.bucketingsorting\", true,\n         \"Don't create a reducer for enforcing \\n\" +\n"}}, {"oid": "b37ba64d918325ec778ead26baeadff2bb609f7f", "url": "https://github.com/apache/hive/commit/b37ba64d918325ec778ead26baeadff2bb609f7f", "message": "update tez job name desc", "committedDate": "2020-06-10T14:39:21Z", "type": "commit"}, {"oid": "6ede55fba83d60166f5aa9dafd9376669566faa3", "url": "https://github.com/apache/hive/commit/6ede55fba83d60166f5aa9dafd9376669566faa3", "message": "Format the HIVETEZJOBNAME desc", "committedDate": "2020-06-10T14:48:03Z", "type": "commit"}]}