{"pr_number": 2714, "pr_title": "Continue IdentityUserIdResolverListener operation when the user list is empty", "pr_createdAt": "2020-01-29T14:10:21Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2714", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQzMzYzOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2714#discussion_r372433639", "bodyText": "Shall we wrap this code logic to a private method similar to getUserIds() and re-use, as the logic is re-used several places? the method will return the userID list for a non-empty user list and a non-empty userID list. Otherwise, it will return an empty string array.\nAnd also, IMO empty user list equals empty userIDs. If we plan to trigger all the listeners for an empty user list, the same can be applied with an empty userID list returned for a non-empty user list. WDYT?", "author": "tharindu-bandara", "createdAt": "2020-01-29T15:00:52Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java", "diffHunk": "@@ -531,7 +531,16 @@ public boolean doPreAddRole(String roleName, String[] userList, Permission[] per\n             return true;\n         }\n \n-        String[] userIDs = getUserIdsFromUserNames(userList, (AbstractUserStoreManager) userStoreManager);\n+        String[] userIDs;\n+        if (ArrayUtils.isNotEmpty(userList)) {\n+            userIDs = getUserIdsFromUserNames(userList, (AbstractUserStoreManager) userStoreManager);\n+\n+            if (ArrayUtils.isEmpty(userIDs)) {\n+                return true;\n+            }\n+        } else {\n+            userIDs = new String[0];\n+        }", "originalCommit": "ef6be8f4eebb5cd94408152c93d247c89af29513", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ0ODE4OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2714#discussion_r372448189", "bodyText": "getUserIdsFromUserNames method will return an empty user list if there was an error while converting username list to user id list. In such a case, we need to return from the method. But when the userList is empty also, it will return an empty list and we don't want to return from the method. So the above approach will not work.\nThe best approach to reduce the redundant code is to throw the exception from getUserIdsFromUserNames method and handle in each method.", "author": "madurangasiriwardena", "createdAt": "2020-01-29T15:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQzMzYzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "chunk": "diff --git a/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java b/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\nindex fea8dd2c90b..c9b83157d38 100644\n--- a/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\n+++ b/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\n\n@@ -542,10 +542,6 @@ public class IdentityUserIdResolverListener extends AbstractIdentityUserOperatio\n             userIDs = new String[0];\n         }\n \n-        if (ArrayUtils.isEmpty(userIDs)) {\n-            return true;\n-        }\n-\n         for (UserOperationEventListener listener : getUserStoreManagerListeners()) {\n \n             if (!(listener instanceof IdentityUserNameResolverListener)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ0OTM2Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2714#discussion_r372449367", "bodyText": "We need to remove this check as this will override the fix.", "author": "tharindu-bandara", "createdAt": "2020-01-29T15:24:49Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java", "diffHunk": "@@ -531,7 +531,16 @@ public boolean doPreAddRole(String roleName, String[] userList, Permission[] per\n             return true;\n         }\n \n-        String[] userIDs = getUserIdsFromUserNames(userList, (AbstractUserStoreManager) userStoreManager);\n+        String[] userIDs;\n+        if (ArrayUtils.isNotEmpty(userList)) {\n+            userIDs = getUserIdsFromUserNames(userList, (AbstractUserStoreManager) userStoreManager);\n+\n+            if (ArrayUtils.isEmpty(userIDs)) {\n+                return true;\n+            }\n+        } else {\n+            userIDs = new String[0];\n+        }\n \n         if (ArrayUtils.isEmpty(userIDs)) {\n             return true;", "originalCommit": "ef6be8f4eebb5cd94408152c93d247c89af29513", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "chunk": "diff --git a/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java b/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\nindex fea8dd2c90b..c9b83157d38 100644\n--- a/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\n+++ b/components/identity-mgt/org.wso2.carbon.identity.mgt/src/main/java/org/wso2/carbon/identity/mgt/listener/IdentityUserIdResolverListener.java\n\n@@ -542,10 +542,6 @@ public class IdentityUserIdResolverListener extends AbstractIdentityUserOperatio\n             userIDs = new String[0];\n         }\n \n-        if (ArrayUtils.isEmpty(userIDs)) {\n-            return true;\n-        }\n-\n         for (UserOperationEventListener listener : getUserStoreManagerListeners()) {\n \n             if (!(listener instanceof IdentityUserNameResolverListener)) {\n"}}, {"oid": "f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "url": "https://github.com/wso2/carbon-identity-framework/commit/f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "message": "Continue IdentityUserIdResolverListener operation when the user list is empty", "committedDate": "2020-01-29T15:29:53Z", "type": "commit"}, {"oid": "f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "url": "https://github.com/wso2/carbon-identity-framework/commit/f2ae3f4a627cc522cf57c5aa3a6fcc063c007377", "message": "Continue IdentityUserIdResolverListener operation when the user list is empty", "committedDate": "2020-01-29T15:29:53Z", "type": "forcePushed"}, {"oid": "1a621b82c514d81e4cdb8964af90b948a3c2fac6", "url": "https://github.com/wso2/carbon-identity-framework/commit/1a621b82c514d81e4cdb8964af90b948a3c2fac6", "message": "Refactor the logic", "committedDate": "2020-01-29T15:51:18Z", "type": "commit"}, {"oid": "1a621b82c514d81e4cdb8964af90b948a3c2fac6", "url": "https://github.com/wso2/carbon-identity-framework/commit/1a621b82c514d81e4cdb8964af90b948a3c2fac6", "message": "Refactor the logic", "committedDate": "2020-01-29T15:51:18Z", "type": "forcePushed"}]}