{"pr_number": 3190, "pr_title": "Add role cache clearing", "pr_createdAt": "2020-10-27T11:12:15Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3190", "timeline": [{"oid": "5be8ffc00daeea1ce03f8e0fa35287e2eff827f4", "url": "https://github.com/wso2/carbon-identity-framework/commit/5be8ffc00daeea1ce03f8e0fa35287e2eff827f4", "message": "Add role cache clearing", "committedDate": "2020-10-28T09:12:07Z", "type": "forcePushed"}, {"oid": "5f8b3653b3f337517b1c5c8886b55dd0f4f26615", "url": "https://github.com/wso2/carbon-identity-framework/commit/5f8b3653b3f337517b1c5c8886b55dd0f4f26615", "message": "Add role cache clearing", "committedDate": "2020-10-28T09:16:49Z", "type": "forcePushed"}, {"oid": "f541fbcdf55cf3dfd0165e2ecab6c66c30026612", "url": "https://github.com/wso2/carbon-identity-framework/commit/f541fbcdf55cf3dfd0165e2ecab6c66c30026612", "message": "Add role cache clearing", "committedDate": "2020-10-28T09:21:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMjM1OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3190#discussion_r513302359", "bodyText": "If we clear the cache by tenant why do we need to clear for specific users again?", "author": "IsuraD", "createdAt": "2020-10-28T09:40:05Z", "path": "components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java", "diffHunk": "@@ -157,6 +162,11 @@ public RoleBasicInfo addRole(String roleName, List<String> userList, List<String\n                         }\n                         processBatchUpdateForUsers(roleName, userNamesList, tenantId, primaryDomainName, connection,\n                                 addUsersSQL);\n+\n+                        for (String username : userNamesList) {\n+                            clearUserRolesCache(username, tenantId);\n+                        }\n+                        clearUserRolesCacheByTenant(tenantId);", "originalCommit": "f541fbcdf55cf3dfd0165e2ecab6c66c30026612", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ2MTE2MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3190#discussion_r513461160", "bodyText": "fixed", "author": "janakamarasena", "createdAt": "2020-10-28T13:54:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMwMjM1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "0f8eda4508a1e7ee1af3826634ff28055a6abe72", "chunk": "diff --git a/components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java b/components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java\nindex 118bf25b1dd..366e4b851d4 100644\n--- a/components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java\n+++ b/components/role-mgt/org.wso2.carbon.identity.role.mgt.core/src/main/java/org/wso2/carbon/identity/role/mgt/core/dao/RoleDAOImpl.java\n\n@@ -166,7 +166,6 @@ public class RoleDAOImpl implements RoleDAO {\n                         for (String username : userNamesList) {\n                             clearUserRolesCache(username, tenantId);\n                         }\n-                        clearUserRolesCacheByTenant(tenantId);\n                     }\n \n                     // Add groups to the created role.\n"}}, {"oid": "0f8eda4508a1e7ee1af3826634ff28055a6abe72", "url": "https://github.com/wso2/carbon-identity-framework/commit/0f8eda4508a1e7ee1af3826634ff28055a6abe72", "message": "Add role cache clearing", "committedDate": "2020-10-28T13:46:13Z", "type": "forcePushed"}, {"oid": "63d672fe2dbd2e738c02e87964ffaf08d193c752", "url": "https://github.com/wso2/carbon-identity-framework/commit/63d672fe2dbd2e738c02e87964ffaf08d193c752", "message": "Add role cache clearing", "committedDate": "2020-10-28T19:25:20Z", "type": "commit"}, {"oid": "63d672fe2dbd2e738c02e87964ffaf08d193c752", "url": "https://github.com/wso2/carbon-identity-framework/commit/63d672fe2dbd2e738c02e87964ffaf08d193c752", "message": "Add role cache clearing", "committedDate": "2020-10-28T19:25:20Z", "type": "forcePushed"}]}