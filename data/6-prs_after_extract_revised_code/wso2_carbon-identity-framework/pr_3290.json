{"pr_number": 3290, "pr_title": "Add userstore config listeners", "pr_createdAt": "2020-12-15T11:17:32Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3290", "timeline": [{"oid": "88e31a29a274a396b0c01967340d7aa7a14449e9", "url": "https://github.com/wso2/carbon-identity-framework/commit/88e31a29a274a396b0c01967340d7aa7a14449e9", "message": "Add userstore config listeners", "committedDate": "2020-12-15T11:21:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2NTA3OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3290#discussion_r543265078", "bodyText": "isn't it worth to have a debug log denoting userstore listeners that were executed ?", "author": "hasinthaindrajee", "createdAt": "2020-12-15T11:29:45Z", "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java", "diffHunk": "@@ -778,6 +779,77 @@ public static void triggerListenersOnUserStorePreAdd(String domainName) throws U\n         }\n     }\n \n+    /**\n+     * Trigger the listeners after a userstore is retrieved.\n+     *\n+     * @param userStoreDTO Retrieved userstore configuration.\n+     * @throws UserStoreException throws when an error occurred when triggering listeners.\n+     */\n+    public static void triggerListenersOnUserStorePostGet(UserStoreDTO userStoreDTO) throws UserStoreException {\n+\n+        int tenantId = CarbonContext.getThreadLocalCarbonContext().getTenantId();\n+        List<UserStoreConfigListener> userStoreConfigListeners = UserStoreConfigListenersHolder.getInstance()\n+                .getUserStoreConfigListeners();\n+\n+        for (UserStoreConfigListener userStoreConfigListener : userStoreConfigListeners) {", "originalCommit": "88e31a29a274a396b0c01967340d7aa7a14449e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI4Mjg0OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3290#discussion_r543282848", "bodyText": "added", "author": "janakamarasena", "createdAt": "2020-12-15T11:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2NTA3OA=="}], "type": "inlineReview", "revised_code": {"commit": "4617ecbfadf5f4aa3de80cade7003e3a853c7b7b", "chunk": "diff --git a/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java b/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java\nindex c44b4d9fea4..3f0970c0e84 100644\n--- a/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java\n+++ b/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java\n\n@@ -775,6 +787,9 @@ public class SecondaryUserStoreConfigurationUtil {\n                 .getUserStoreConfigListeners();\n \n         for (UserStoreConfigListener userStoreConfigListener : userStoreConfigListeners) {\n+            if (LOG.isDebugEnabled()) {\n+                LOG.debug(\"Triggering userstore pre add listener: \" + userStoreConfigListener.getClass().getName());\n+            }\n             userStoreConfigListener.onUserStorePreAdd(tenantId, domainName);\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2NjE1Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3290#discussion_r543266153", "bodyText": "Hope these errors are handled through CXF errors  and printed properly in case if debug is turned on. Unless these error messages can go unnoticed even if debug is turned on.", "author": "hasinthaindrajee", "createdAt": "2020-12-15T11:31:31Z", "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/utils/SecondaryUserStoreConfigurationUtil.java", "diffHunk": "@@ -790,4 +862,21 @@ public static boolean isUserStoreRepositorySeparationEnabled() {\n         // https://github.com/wso2/product-is/issues/5673\n         return false;\n     }\n+\n+    /**\n+     * Wrap UserStoreClientException in a IdentityUserStoreClientException.\n+     *\n+     * @param defaultMessage Default error message.\n+     * @param e UserStoreClientException.\n+     * @return new IdentityUserStoreClientException.\n+     */\n+    public static IdentityUserStoreClientException buildIdentityUserStoreClientException(String defaultMessage,\n+                                                                                         UserStoreClientException e) {\n+\n+        String errorMessage = defaultMessage;\n+        if (e.getMessage() != null) {\n+            errorMessage = e.getMessage();\n+        }\n+        return new IdentityUserStoreClientException(errorMessage, e);", "originalCommit": "88e31a29a274a396b0c01967340d7aa7a14449e9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "4617ecbfadf5f4aa3de80cade7003e3a853c7b7b", "url": "https://github.com/wso2/carbon-identity-framework/commit/4617ecbfadf5f4aa3de80cade7003e3a853c7b7b", "message": "Add userstore config listeners", "committedDate": "2020-12-15T11:58:38Z", "type": "forcePushed"}, {"oid": "044f01f64ed75a5245be0957614bf841e26ed0a0", "url": "https://github.com/wso2/carbon-identity-framework/commit/044f01f64ed75a5245be0957614bf841e26ed0a0", "message": "Add userstore config listeners", "committedDate": "2020-12-15T15:36:11Z", "type": "commit"}, {"oid": "044f01f64ed75a5245be0957614bf841e26ed0a0", "url": "https://github.com/wso2/carbon-identity-framework/commit/044f01f64ed75a5245be0957614bf841e26ed0a0", "message": "Add userstore config listeners", "committedDate": "2020-12-15T15:36:11Z", "type": "forcePushed"}]}