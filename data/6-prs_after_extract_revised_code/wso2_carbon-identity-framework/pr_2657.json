{"pr_number": 2657, "pr_title": "Delete user role for the deleted userStore and get roles from enable userStore", "pr_createdAt": "2020-01-03T03:34:12Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2657", "timeline": [{"oid": "eb456425859888dfdf646ef75f206facdf2b775f", "url": "https://github.com/wso2/carbon-identity-framework/commit/eb456425859888dfdf646ef75f206facdf2b775f", "message": "Delete user role for the deleted userStore and get roles from enable userStore", "committedDate": "2020-01-03T03:32:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMzk4OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2657#discussion_r362703988", "bodyText": "can this be NULL?", "author": "somindatommy", "createdAt": "2020-01-03T04:30:21Z", "path": "components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/dao/impl/DatabaseBasedUserStoreDAOImpl.java", "diffHunk": "@@ -362,6 +362,9 @@ public void deleteUserStore(String domain) throws IdentityUserStoreMgtException\n             // Run pre user-store name update listeners\n             triggerListnersOnUserStorePreDelete(domain);\n             deleteUserStore(domain, tenantId);\n+            AbstractUserStoreManager userStoreManager = (AbstractUserStoreManager) CarbonContext.", "originalCommit": "eb456425859888dfdf646ef75f206facdf2b775f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc0MzM0NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2657#discussion_r362743345", "bodyText": "Added", "author": "thushaaanthan", "createdAt": "2020-01-03T09:18:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMzk4OA=="}], "type": "inlineReview", "revised_code": {"commit": "b346d4ba6b6d5449c92bd3d965f2788047c92d3c", "chunk": "diff --git a/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/dao/impl/DatabaseBasedUserStoreDAOImpl.java b/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/dao/impl/DatabaseBasedUserStoreDAOImpl.java\nindex c557e9ca98a..1bb733646e5 100644\n--- a/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/dao/impl/DatabaseBasedUserStoreDAOImpl.java\n+++ b/components/user-store/org.wso2.carbon.identity.user.store.configuration/src/main/java/org/wso2/carbon/identity/user/store/configuration/dao/impl/DatabaseBasedUserStoreDAOImpl.java\n\n@@ -361,10 +361,13 @@ public class DatabaseBasedUserStoreDAOImpl extends AbstractUserStoreDAO {\n         try {\n             // Run pre user-store name update listeners\n             triggerListnersOnUserStorePreDelete(domain);\n-            deleteUserStore(domain, tenantId);\n             AbstractUserStoreManager userStoreManager = (AbstractUserStoreManager) CarbonContext.\n                     getThreadLocalCarbonContext().getUserRealm().getUserStoreManager();\n+            if (userStoreManager == null) {\n+                throw new IdentityUserStoreMgtException(\"Unable to find a user for delete user store.\");\n+            }\n             userStoreManager.deletePersistedDomain(domain);\n+            deleteUserStore(domain, tenantId);\n             removeRealmFromSecondaryUserStoreManager(domain);\n         } catch (UserStoreException e) {\n             throw new IdentityUserStoreMgtException(\"Error while triggering the userstore pre delete listeners.\");\n"}}, {"oid": "b346d4ba6b6d5449c92bd3d965f2788047c92d3c", "url": "https://github.com/wso2/carbon-identity-framework/commit/b346d4ba6b6d5449c92bd3d965f2788047c92d3c", "message": "modification", "committedDate": "2020-01-03T06:03:41Z", "type": "commit"}, {"oid": "bfcffa376f95c5ef859a0294138cbfd2c10ac3ee", "url": "https://github.com/wso2/carbon-identity-framework/commit/bfcffa376f95c5ef859a0294138cbfd2c10ac3ee", "message": "small modification", "committedDate": "2020-01-03T06:28:29Z", "type": "commit"}, {"oid": "97f51f7773160e327f5e41f6add544ddf8992ad0", "url": "https://github.com/wso2/carbon-identity-framework/commit/97f51f7773160e327f5e41f6add544ddf8992ad0", "message": "less character", "committedDate": "2020-01-03T06:45:13Z", "type": "commit"}, {"oid": "e272601a76e0d2e0e387c70cf31d2bf797c11f39", "url": "https://github.com/wso2/carbon-identity-framework/commit/e272601a76e0d2e0e387c70cf31d2bf797c11f39", "message": "Username filter contains illegal character error", "committedDate": "2020-01-03T08:59:22Z", "type": "commit"}, {"oid": "ec2567827c1d00e467ec6f9e5597fb4b0bd4c8c7", "url": "https://github.com/wso2/carbon-identity-framework/commit/ec2567827c1d00e467ec6f9e5597fb4b0bd4c8c7", "message": "Revert \"Username filter contains illegal character error\"\n\nThis reverts commit e272601a76e0d2e0e387c70cf31d2bf797c11f39.", "committedDate": "2020-01-03T09:00:25Z", "type": "commit"}]}