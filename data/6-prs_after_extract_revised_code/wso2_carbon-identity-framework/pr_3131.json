{"pr_number": 3131, "pr_title": "[Improvement] Extending the expiry time of commonAuth Cookie", "pr_createdAt": "2020-09-28T04:30:12Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3131", "timeline": [{"oid": "6fab1e16999c996b76a66584e787d10062d00cd9", "url": "https://github.com/wso2/carbon-identity-framework/commit/6fab1e16999c996b76a66584e787d10062d00cd9", "message": "[Improvement] Extending the expiry time of commonAuth Cookie", "committedDate": "2020-09-28T04:21:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NDU5OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3131#discussion_r495684598", "bodyText": "make final", "author": "janakamarasena", "createdAt": "2020-09-28T04:35:44Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java", "diffHunk": "@@ -82,6 +82,7 @@\n     private static final Log log = LogFactory.getLog(DefaultAuthenticationRequestHandler.class);\n     private static final Log AUDIT_LOG = CarbonConstants.AUDIT_LOG;\n     private static volatile DefaultAuthenticationRequestHandler instance;\n+    private static String EXTEND_REMEMBER_ME_SESSION_ON_AUTH = \"TimeConfig.ExtendRememberMeSessionTimeoutOnAuth\";", "originalCommit": "6fab1e16999c996b76a66584e787d10062d00cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NjY4Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3131#discussion_r495686687", "bodyText": "We can move this to FrameworkConstants as well.\nhttps://github.com/wso2/carbon-identity-framework/blob/master/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/util/FrameworkConstants.java", "author": "janakamarasena", "createdAt": "2020-09-28T04:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NDU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY5MTMzMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3131#discussion_r495691330", "bodyText": "Fixed: 2dc93b4", "author": "somindatommy", "createdAt": "2020-09-28T05:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NDU5OA=="}], "type": "inlineReview", "revised_code": {"commit": "dab555e935264772e2a3f50df0fd5482bc0de0f1", "chunk": "diff --git a/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java b/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\nindex eaa0ea0bcf0..4fe690ae78d 100644\n--- a/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\n+++ b/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\n\n@@ -82,7 +82,7 @@ public class DefaultAuthenticationRequestHandler implements AuthenticationReques\n     private static final Log log = LogFactory.getLog(DefaultAuthenticationRequestHandler.class);\n     private static final Log AUDIT_LOG = CarbonConstants.AUDIT_LOG;\n     private static volatile DefaultAuthenticationRequestHandler instance;\n-    private static String EXTEND_REMEMBER_ME_SESSION_ON_AUTH = \"TimeConfig.ExtendRememberMeSessionTimeoutOnAuth\";\n+    private static final String EXTEND_REMEMBER_ME_SESSION_ON_AUTH = \"TimeConfig.ExtendRememberMeSessionTimeoutOnAuth\";\n \n     public static DefaultAuthenticationRequestHandler getInstance() {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NTE2MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3131#discussion_r495685161", "bodyText": "From how much is the expiry time increased?\nis it by SessionIdleTimeout?", "author": "janakamarasena", "createdAt": "2020-09-28T04:38:46Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java", "diffHunk": "@@ -419,6 +420,15 @@ protected void concludeFlow(HttpServletRequest request, HttpServletResponse resp\n                         log.error(\"Updating session meta data failed.\", e);\n                     }\n                 }\n+                /*\n+                 * In the default configuration, the expiry time of the commonAuthCookie is fixed when rememberMe\n+                 * option is selected. With this config, the expiry time will increase at every authentication.\n+                 */\n+                if (sessionContext.isRememberMe() &&\n+                        Boolean.parseBoolean(IdentityUtil.getProperty(EXTEND_REMEMBER_ME_SESSION_ON_AUTH))) {\n+                    context.setRememberMe(sessionContext.isRememberMe());\n+                    setAuthCookie(request, response, context, commonAuthCookie, applicationTenantDomain);", "originalCommit": "6fab1e16999c996b76a66584e787d10062d00cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4ODQ4MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3131#discussion_r495688481", "bodyText": "No. In the resident IDP config we specify the remember me timeout. So for each auth, this expiry time will be extended for that specified time.", "author": "somindatommy", "createdAt": "2020-09-28T04:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTY4NTE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "2dc93b4f4987b4ac95f607c667d4ec86c75ec661", "chunk": "diff --git a/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java b/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\nindex eaa0ea0bcf0..b64f4146aa5 100644\n--- a/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\n+++ b/components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/handler/request/impl/DefaultAuthenticationRequestHandler.java\n\n@@ -425,7 +425,8 @@ public class DefaultAuthenticationRequestHandler implements AuthenticationReques\n                  * option is selected. With this config, the expiry time will increase at every authentication.\n                  */\n                 if (sessionContext.isRememberMe() &&\n-                        Boolean.parseBoolean(IdentityUtil.getProperty(EXTEND_REMEMBER_ME_SESSION_ON_AUTH))) {\n+                        Boolean.parseBoolean(IdentityUtil.getProperty(\n+                                IdentityConstants.ServerConfig.EXTEND_REMEMBER_ME_SESSION_ON_AUTH))) {\n                     context.setRememberMe(sessionContext.isRememberMe());\n                     setAuthCookie(request, response, context, commonAuthCookie, applicationTenantDomain);\n                 }\n"}}, {"oid": "dab555e935264772e2a3f50df0fd5482bc0de0f1", "url": "https://github.com/wso2/carbon-identity-framework/commit/dab555e935264772e2a3f50df0fd5482bc0de0f1", "message": "Addressing comments", "committedDate": "2020-09-28T04:51:51Z", "type": "commit"}, {"oid": "2dc93b4f4987b4ac95f607c667d4ec86c75ec661", "url": "https://github.com/wso2/carbon-identity-framework/commit/2dc93b4f4987b4ac95f607c667d4ec86c75ec661", "message": "Improving config paths", "committedDate": "2020-09-28T05:06:48Z", "type": "commit"}]}