{"pr_number": 3132, "pr_title": "Fix postgresql and oracle issues", "pr_createdAt": "2020-09-28T07:17:40Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3132", "timeline": [{"oid": "b04df6a325a24d387b34d5246eca320893d461bc", "url": "https://github.com/wso2/carbon-identity-framework/commit/b04df6a325a24d387b34d5246eca320893d461bc", "message": "Fix postgresql issue", "committedDate": "2020-09-28T07:05:49Z", "type": "commit"}, {"oid": "93ee1d0c38530c7875c9db36208cefbd2b46d9e4", "url": "https://github.com/wso2/carbon-identity-framework/commit/93ee1d0c38530c7875c9db36208cefbd2b46d9e4", "message": "Fix oracle issue", "committedDate": "2020-09-28T18:01:11Z", "type": "commit"}, {"oid": "1baaf86ae17fd031d50646866aa5e6b47359de50", "url": "https://github.com/wso2/carbon-identity-framework/commit/1baaf86ae17fd031d50646866aa5e6b47359de50", "message": "Fix conventions", "committedDate": "2020-09-29T11:16:36Z", "type": "commit"}, {"oid": "1baaf86ae17fd031d50646866aa5e6b47359de50", "url": "https://github.com/wso2/carbon-identity-framework/commit/1baaf86ae17fd031d50646866aa5e6b47359de50", "message": "Fix conventions", "committedDate": "2020-09-29T11:16:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3NjAzNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497076034", "bodyText": "What is the reason for moving away from NamedPreparedStatement here?", "author": "ivantha", "createdAt": "2020-09-29T21:39:36Z", "path": "components/cors-mgt/org.wso2.carbon.identity.cors.mgt.core/src/main/java/org/wso2/carbon/identity/cors/mgt/core/constant/SQLQueries.java", "diffHunk": "@@ -29,11 +29,11 @@\n \n     public static final String INSERT_CORS_ORIGIN =\n             \"INSERT INTO IDN_CORS_ORIGIN (TENANT_ID, ORIGIN, UUID) \" +\n-            \"VALUES (?, ?, ?)\";\n+            \"VALUES (:TENANT_ID;, :ORIGIN;, :UUID;)\";\n \n     public static final String INSERT_CORS_ASSOCIATION =\n             \"INSERT INTO IDN_CORS_ASSOCIATION (IDN_CORS_ORIGIN_ID, SP_APP_ID) \" +\n-            \"VALUES (:IDN_CORS_ORIGIN_ID;, :SP_APP_ID;)\";\n+            \"VALUES (?,?)\";", "originalCommit": "1baaf86ae17fd031d50646866aa5e6b47359de50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIyMjQ5MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497222490", "bodyText": "NamedPreparedstatement having issue with postgresql. With postgresql if we use namedpreparedstatment it is always expecting the returned key and throwing [1]. Thatswhy changed to Preparedstatement\n[1] wso2/product-is#9608", "author": "nilasini", "createdAt": "2020-09-30T03:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3NjAzNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3NjUzOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497076539", "bodyText": "Same as the ^ comment.", "author": "ivantha", "createdAt": "2020-09-29T21:40:40Z", "path": "components/cors-mgt/org.wso2.carbon.identity.cors.mgt.core/src/main/java/org/wso2/carbon/identity/cors/mgt/core/constant/SQLQueries.java", "diffHunk": "@@ -55,5 +55,5 @@\n     public static final String DELETE_CORS_APPLICATION_ASSOCIATION =\n             \"DELETE \" +\n             \"FROM IDN_CORS_ASSOCIATION \" +\n-            \"WHERE IDN_CORS_ORIGIN_ID = :IDN_CORS_ORIGIN_ID; AND SP_APP_ID = :SP_APP_ID;\";\n+            \"WHERE IDN_CORS_ORIGIN_ID = ? AND SP_APP_ID = ?\";", "originalCommit": "1baaf86ae17fd031d50646866aa5e6b47359de50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIyMjU3NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497222574", "bodyText": "https://github.com/wso2/carbon-identity-framework/pull/3132/files#r497222490", "author": "nilasini", "createdAt": "2020-09-30T03:29:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3NjUzOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3ODA3MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497078070", "bodyText": "Since we are using a UUID and the db scema reflects the property as a UUID, isn't it better to keep the initial naming in order to have more consistency? WDYT?", "author": "ivantha", "createdAt": "2020-09-29T21:43:55Z", "path": "components/cors-mgt/org.wso2.carbon.identity.cors.mgt.core/src/main/java/org/wso2/carbon/identity/cors/mgt/core/constant/SchemaConstants.java", "diffHunk": "@@ -13,7 +13,7 @@\n         public static final String ID = \"ID\";\n         public static final String TENANT_ID = \"TENANT_ID\";\n         public static final String ORIGIN = \"ORIGIN\";\n-        public static final String UUID = \"UUID\";\n+        public static final String UNIQUE_ID = \"UUID\";", "originalCommit": "1baaf86ae17fd031d50646866aa5e6b47359de50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIyMTI2Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497221266", "bodyText": "If we using UUID as the name then while importing it is conflicting with java.utils.UUID that's why changed the name so that static imports will work for java UUID as well.", "author": "nilasini", "createdAt": "2020-09-30T03:24:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3ODA3MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3ODkwNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497078906", "bodyText": "Does this work for the NamedPreparedStatement without the initial RETURN_GENERATED_KEYS parameter?", "author": "ivantha", "createdAt": "2020-09-29T21:45:02Z", "path": "components/cors-mgt/org.wso2.carbon.identity.cors.mgt.core/src/test/java/org/wso2/carbon/identity/cors/mgt/core/test/CORSManagementServiceTests.java", "diffHunk": "@@ -150,17 +149,17 @@ public void testGetCORSOriginsWithApplication() throws CORSManagementServiceExce\n         try (Connection connection = IdentityDatabaseUtil.getDBConnection(true)) {\n             try {\n                 for (String origin : SAMPLE_ORIGIN_LIST_1) {\n-                    try (PreparedStatement preparedStatement2 =\n-                                 connection.prepareStatement(INSERT_CORS_ORIGIN, RETURN_GENERATED_KEYS)) {\n+                    try (NamedPreparedStatement namedPreparedStatement =\n+                                 new NamedPreparedStatement(connection, INSERT_CORS_ORIGIN)) {\n                         // Origin is not present. Therefore add an origin.\n-                        preparedStatement2.setInt(1, SampleTenant.ID);\n-                        preparedStatement2.setString(2, origin);\n-                        preparedStatement2.setString(3, UUID.randomUUID().toString().replace(\"-\", \"\"));\n-                        preparedStatement2.executeUpdate();\n+                        namedPreparedStatement.setInt(1, SampleTenant.ID);\n+                        namedPreparedStatement.setString(2, origin);\n+                        namedPreparedStatement.setString(3, UUID.randomUUID().toString());\n+                        namedPreparedStatement.executeUpdate();\n \n                         // Get origin id.\n                         int corsOriginId;\n-                        try (ResultSet resultSet = preparedStatement2.getGeneratedKeys()) {\n+                        try (ResultSet resultSet = namedPreparedStatement.getGeneratedKeys()) {", "originalCommit": "1baaf86ae17fd031d50646866aa5e6b47359de50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzIyMzI5OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3132#discussion_r497223298", "bodyText": "Yes because NamedPreparedStatement already handled the expected returning columns through [1]\n[1] https://github.com/wso2/carbon-utils/blob/master/components/org.wso2.carbon.database.utils/src/main/java/org/wso2/carbon/database/utils/jdbc/NamedPreparedStatement.java#L86", "author": "nilasini", "createdAt": "2020-09-30T03:32:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzA3ODkwNg=="}], "type": "inlineReview", "revised_code": null}]}