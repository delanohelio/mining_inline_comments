{"pr_number": 2898, "pr_title": "Fix OIDC issuer ID in resident IdP", "pr_createdAt": "2020-04-24T10:25:32Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2898", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3MzE3Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2898#discussion_r414473176", "bodyText": "Are we still using the previous util method as well? Can't we use the new ServiceURLBuilder hear as well?", "author": "ashensw", "createdAt": "2020-04-24T10:34:55Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -206,6 +206,7 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n         if (StringUtils.isBlank(oauth2TokenEPUrl)) {\n             oauth2TokenEPUrl = IdentityUtil.getServerURL(IdentityConstants.OAuth.TOKEN, true, false);", "originalCommit": "4fa923084ec82f38fb2b661d28a868edd3245072", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4NTgxNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2898#discussion_r414485815", "bodyText": "Yes. We can change these to use the ServiceURLBuilder.", "author": "chamathns", "createdAt": "2020-04-24T10:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3MzE3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwNDM5OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2898#discussion_r414504398", "bodyText": "The PR is now updated.", "author": "chamathns", "createdAt": "2020-04-24T11:31:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3MzE3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "dec8df0736ff3661c0d7a9044fd73e3b77b040e6", "chunk": "diff --git a/components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java b/components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java\nindex e22f5e4cd4d..8115eb383cd 100644\n--- a/components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java\n+++ b/components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java\n\n@@ -206,7 +206,7 @@ public class IdentityProviderManager implements IdpManager {\n         if (StringUtils.isBlank(oauth2TokenEPUrl)) {\n             oauth2TokenEPUrl = IdentityUtil.getServerURL(IdentityConstants.OAuth.TOKEN, true, false);\n         }\n-        oauth2TokenEPUrl = resolveAbsoluteURL(IdPManagementConstants.OAUTH2_TOKEN_EP_URL, oauth2TokenEPUrl);\n+        oauth2TokenEPUrl = resolveAbsoluteURL(IdentityConstants.OAuth.TOKEN, oauth2TokenEPUrl);\n \n         if (StringUtils.isBlank(oauth2RevokeEPUrl)) {\n             oauth2RevokeEPUrl = IdentityUtil.getServerURL(IdentityConstants.OAuth.REVOKE, true, false);\n"}}, {"oid": "dec8df0736ff3661c0d7a9044fd73e3b77b040e6", "url": "https://github.com/wso2/carbon-identity-framework/commit/dec8df0736ff3661c0d7a9044fd73e3b77b040e6", "message": "Fix OIDC issuer ID in resident IdP", "committedDate": "2020-04-24T10:39:32Z", "type": "commit"}, {"oid": "dec8df0736ff3661c0d7a9044fd73e3b77b040e6", "url": "https://github.com/wso2/carbon-identity-framework/commit/dec8df0736ff3661c0d7a9044fd73e3b77b040e6", "message": "Fix OIDC issuer ID in resident IdP", "committedDate": "2020-04-24T10:39:32Z", "type": "forcePushed"}, {"oid": "810276eb3dc798ca5c7aeeab30144adc73fb9eb0", "url": "https://github.com/wso2/carbon-identity-framework/commit/810276eb3dc798ca5c7aeeab30144adc73fb9eb0", "message": "add changes to resolveAbsoluteURL method", "committedDate": "2020-04-24T11:16:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0Mzk0NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2898#discussion_r469043944", "bodyText": "Start sentence with a capital letter.", "author": "janakamarasena", "createdAt": "2020-08-12T06:55:26Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2515,17 +2513,31 @@ private void validateResourceId(String resourceId, String tenantDomain) throws I\n         }\n     }\n \n-    private String resolveAbsoluteURL(String urlContext, String resolvedUrl) throws IdentityProviderManagementServerException {\n+    /**\n+     * Resolves the public service url given the default context and the url picked from the configuration based on\n+     * the 'tenant_context.enable_tenant_qualified_urls' mode set in deployment.toml.\n+     *\n+     * @param defaultUrlContext default url context path\n+     * @param urlFromConfig     url picked from the file configuration\n+     * @return absolute public url of the service if 'enable_tenant_qualified_urls' is 'true', else returns the url\n+     * from the file config\n+     * @throws IdentityProviderManagementServerException when fail to build the absolute public url", "originalCommit": "810276eb3dc798ca5c7aeeab30144adc73fb9eb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3NzAwMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2898#discussion_r478177000", "bodyText": "Fixed with #3064.", "author": "chamathns", "createdAt": "2020-08-27T06:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA0Mzk0NA=="}], "type": "inlineReview", "revised_code": null}]}