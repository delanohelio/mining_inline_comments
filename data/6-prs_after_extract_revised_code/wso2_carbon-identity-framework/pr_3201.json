{"pr_number": 3201, "pr_title": "Handle adding existing claim dialect URI", "pr_createdAt": "2020-10-28T16:52:10Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3201", "timeline": [{"oid": "2e3f6a66084f7c25549fd3638fd32ee69a6c576e", "url": "https://github.com/wso2/carbon-identity-framework/commit/2e3f6a66084f7c25549fd3638fd32ee69a6c576e", "message": "Handle adding existing claim dialect URI", "committedDate": "2020-10-28T13:45:54Z", "type": "commit"}, {"oid": "4a6854f90b76b965c6a84ca7d21c6bf2090a6249", "url": "https://github.com/wso2/carbon-identity-framework/commit/4a6854f90b76b965c6a84ca7d21c6bf2090a6249", "message": "Refactoring static imports", "committedDate": "2020-10-28T16:56:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY0NDY1NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201#discussion_r513644654", "bodyText": "since we are using contains() below, better to use a set here which will be efficient", "author": "pulasthi7", "createdAt": "2020-10-28T17:47:10Z", "path": "components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java", "diffHunk": "@@ -82,11 +87,23 @@ public void addClaimDialect(ClaimDialect claimDialect, String tenantDomain) thro\n         if (claimDialect == null || StringUtils.isBlank(claimDialect.getClaimDialectURI())) {\n             throw new ClaimMetadataClientException(ERROR_CODE_EMPTY_CLAIM_DIALECT);\n         }\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            throw new ClaimMetadataClientException(ERROR_CODE_EMPTY_TENANT_DOMAIN);\n+        }\n+        int tenantId = IdentityTenantUtil.getTenantId(tenantDomain);\n+        if (tenantId == MultitenantConstants.INVALID_TENANT_ID) {\n+            throw new ClaimMetadataClientException(ERROR_CODE_INVALID_TENANT_DOMAIN.getCode(),\n+                    String.format(ERROR_CODE_INVALID_TENANT_DOMAIN.getMessage(), tenantDomain));\n+        }\n \n-        // TODO : validate claim dialect already exists?\n+        List<ClaimDialect> claimDialects = this.claimDialectDAO.getClaimDialects(tenantId);\n+        List<String> claimDialectUris = claimDialects.stream().map(ClaimDialect::getClaimDialectURI).", "originalCommit": "4a6854f90b76b965c6a84ca7d21c6bf2090a6249", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY3OTk4OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3201#discussion_r513679988", "bodyText": "Fixed: e892da0", "author": "somindatommy", "createdAt": "2020-10-28T18:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzY0NDY1NA=="}], "type": "inlineReview", "revised_code": {"commit": "e892da0880f754ef15e877f078706ba84d41dd8e", "chunk": "diff --git a/components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java b/components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java\nindex e26032f6779..2af1146584a 100644\n--- a/components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java\n+++ b/components/claim-mgt/org.wso2.carbon.identity.claim.metadata.mgt/src/main/java/org/wso2/carbon/identity/claim/metadata/mgt/ClaimMetadataManagementServiceImpl.java\n\n@@ -97,8 +98,8 @@ public class ClaimMetadataManagementServiceImpl implements ClaimMetadataManageme\n         }\n \n         List<ClaimDialect> claimDialects = this.claimDialectDAO.getClaimDialects(tenantId);\n-        List<String> claimDialectUris = claimDialects.stream().map(ClaimDialect::getClaimDialectURI).\n-                collect(Collectors.toList());\n+        Set<String> claimDialectUris = claimDialects.stream().map(ClaimDialect::getClaimDialectURI).\n+                collect(Collectors.toSet());\n \n         if (claimDialectUris.contains(claimDialect.getClaimDialectURI())) {\n             throw new ClaimMetadataClientException(ERROR_CODE_EXISTING_CLAIM_DIALECT.getCode(),\n"}}, {"oid": "e892da0880f754ef15e877f078706ba84d41dd8e", "url": "https://github.com/wso2/carbon-identity-framework/commit/e892da0880f754ef15e877f078706ba84d41dd8e", "message": "Addressing comments", "committedDate": "2020-10-28T18:41:18Z", "type": "commit"}]}