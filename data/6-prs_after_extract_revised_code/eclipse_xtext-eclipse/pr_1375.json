{"pr_number": 1375, "pr_title": "Migrated the Xtend code from org.eclipse.xtext.builder project to Java ", "pr_createdAt": "2020-03-22T14:49:17Z", "pr_url": "https://github.com/eclipse/xtext-eclipse/pull/1375", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjUwNQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396102505", "bodyText": "@cdietrich @tivervac @szarnekow  Kindly confirm the year. The Copyright is missing in the file history. I checked other files that were introduced in the \"2.7\" release and put the year.  Please suggest if this needs to be changed.", "author": "nbhusare", "createdAt": "2020-03-22T14:53:58Z", "path": "org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/ParallelFileSystemAccess.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/**\n+ * Copyright (c) 2017, 2020 itemis AG (http://www.itemis.eu) and others.", "originalCommit": "b4216ffb86f31868403d451280a03604e897820b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjYyMA==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396102620", "bodyText": "should be 2014", "author": "cdietrich", "createdAt": "2020-03-22T14:55:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjUwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwNTM0OQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396105349", "bodyText": "Updated the year to 2014.", "author": "nbhusare", "createdAt": "2020-03-22T15:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjUwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "e3c9d5538d3fe8c61564a100d4a777cdfdf4f746", "chunk": "diff --git a/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/ParallelFileSystemAccess.java b/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/ParallelFileSystemAccess.java\nindex 440a0167c..0d6f1d08f 100644\n--- a/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/ParallelFileSystemAccess.java\n+++ b/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/ParallelFileSystemAccess.java\n\n@@ -1,5 +1,5 @@\n /**\n- * Copyright (c) 2017, 2020 itemis AG (http://www.itemis.eu) and others.\n+ * Copyright (c) 2014, 2020 itemis AG (http://www.itemis.eu) and others.\n  * This program and the accompanying materials are made available under the\n  * terms of the Eclipse Public License 2.0 which is available at\n  * http://www.eclipse.org/legal/epl-2.0.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjk0OA==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396102948", "bodyText": "@cdietrich @tivervac @szarnekow The earlier code sets a null value in the second param if the if-condition on line 82 is  not satisfied. I believe it is not needed. Please review and confirm.", "author": "nbhusare", "createdAt": "2020-03-22T14:58:03Z", "path": "org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/impl/javasupport/JdtQueuedBuildData.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Copyright (c) 2013, 2020 itemis AG (http://www.itemis.eu) and others.\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0.\n+ * \n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.eclipse.xtext.builder.impl.javasupport;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.eclipse.core.resources.IProject;\n+import org.eclipse.xtext.builder.impl.IQueuedBuildDataContribution;\n+import org.eclipse.xtext.common.types.ui.notification.JavaBuilderState;\n+import org.eclipse.xtext.naming.QualifiedName;\n+import org.eclipse.xtext.resource.IEObjectDescription;\n+import org.eclipse.xtext.resource.IResourceDescription;\n+import org.eclipse.xtext.xbase.lib.Procedures.Procedure1;\n+\n+import com.google.inject.Singleton;\n+\n+/**\n+ * @author Anton Kosyakov - Initial contribution and API\n+ */\n+@Singleton\n+public class JdtQueuedBuildData implements IQueuedBuildDataContribution {\n+\n+\tprivate Map<String, JavaBuilderState> javaBuildState;\n+\n+\tprivate Map<String, JavaBuilderState> javaBuildStateCopy;\n+\n+\tprivate Collection<UnconfirmedStructuralChangesDelta> unconfirmedDeltas;\n+\n+\tprivate Collection<UnconfirmedStructuralChangesDelta> unconfirmedDeltasCopy;\n+\n+\t@Override\n+\tpublic void reset() {\n+\t\tjavaBuildState = new HashMap<>();\n+\t\tunconfirmedDeltas = new ArrayList<>();\n+\t}\n+\n+\t@Override\n+\tpublic void reset(IProject project) {\n+\t\tjavaBuildState.remove(project.getName());\n+\t}\n+\n+\t/**\n+\t * Public for testing purpose\n+\t */\n+\tpublic Collection<UnconfirmedStructuralChangesDelta> getUnconfirmedDeltas() {\n+\t\treturn unconfirmedDeltas;\n+\t}\n+\n+\t@Override\n+\tpublic boolean queueChange(IResourceDescription.Delta delta) {\n+\t\tif (delta instanceof UnconfirmedStructuralChangesDelta) {\n+\t\t\tUnconfirmedStructuralChangesDelta ucDelta = (UnconfirmedStructuralChangesDelta) delta;\n+\t\t\tIProject project = ucDelta.getProject();\n+\t\t\tJavaBuilderState state = javaBuildState.get(project.getName());\n+\t\t\tif (state == null) {\n+\t\t\t\tstate = JavaBuilderState.getLastBuiltState(project);\n+\t\t\t\tjavaBuildState.put(project.getName(), state);\n+\t\t\t}\n+\t\t\tucDelta.setBuildNumber(state.getBuildNumber().intValue());\n+\t\t\tunconfirmedDeltas.add(ucDelta);\n+\t\t\treturn true;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\t@Override\n+\tpublic boolean needsRebuild(IProject project, Collection<IResourceDescription.Delta> deltas) {\n+\t\tJavaBuilderState oldState = javaBuildState.get(project.getName());\n+\t\tJavaBuilderState newState = JavaBuilderState.getLastBuiltState(project);\n+\t\treturn doNeedRebuild(newState, (delta) -> {", "originalCommit": "b4216ffb86f31868403d451280a03604e897820b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwNjUyOQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396106529", "bodyText": "The old code passes null as the callable into doNeedRebuild. Since this code here is very brittle and relies a lot on the internals of the Java builder, I'd prefer to keep it exactly as it was.", "author": "szarnekow", "createdAt": "2020-03-22T15:31:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjExNzYzOQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1375#discussion_r396117639", "bodyText": "@szarnekow I have made the changes. Please check.", "author": "nbhusare", "createdAt": "2020-03-22T17:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjk0OA=="}], "type": "inlineReview", "revised_code": {"commit": "804f3120dd092e2421872d7c03e9539c6d5cdc0b", "chunk": "diff --git a/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/impl/javasupport/JdtQueuedBuildData.java b/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/impl/javasupport/JdtQueuedBuildData.java\nindex 72fc64ca7..f0a4f2205 100644\n--- a/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/impl/javasupport/JdtQueuedBuildData.java\n+++ b/org.eclipse.xtext.builder/src/org/eclipse/xtext/builder/impl/javasupport/JdtQueuedBuildData.java\n\n@@ -78,15 +78,21 @@ public class JdtQueuedBuildData implements IQueuedBuildDataContribution {\n \tpublic boolean needsRebuild(IProject project, Collection<IResourceDescription.Delta> deltas) {\n \t\tJavaBuilderState oldState = javaBuildState.get(project.getName());\n \t\tJavaBuilderState newState = JavaBuilderState.getLastBuiltState(project);\n-\t\treturn doNeedRebuild(newState, (delta) -> {\n-\t\t\tif (oldState == null || oldState.getLastStructuralBuildTime() != newState.getLastStructuralBuildTime()) {\n+\n+\t\tfinal Procedure1<UnconfirmedStructuralChangesDelta> processor;\n+\t\tif (oldState == null || oldState.getLastStructuralBuildTime() != newState.getLastStructuralBuildTime()) {\n+\t\t\tprocessor = (delta) -> {\n \t\t\t\tSet<QualifiedName> structurallyChangedTypes = newState.getStructurallyChangedTypes();\n \t\t\t\tif (namesIntersect(delta.getNew(), structurallyChangedTypes) //\n \t\t\t\t\t\t|| namesIntersect(delta.getOld(), structurallyChangedTypes)) {\n \t\t\t\t\tdeltas.add(delta);\n \t\t\t\t}\n-\t\t\t}\n-\t\t});\n+\t\t\t};\n+\t\t} else {\n+\t\t\tprocessor = null;\n+\t\t}\n+\n+\t\treturn doNeedRebuild(newState, processor);\n \t}\n \n \tprotected boolean doNeedRebuild(JavaBuilderState javaBuilderState, Procedure1<? super UnconfirmedStructuralChangesDelta> processor) {\n"}}, {"oid": "e3c9d5538d3fe8c61564a100d4a777cdfdf4f746", "url": "https://github.com/eclipse/xtext-eclipse/commit/e3c9d5538d3fe8c61564a100d4a777cdfdf4f746", "message": "Migrated Xtend code to Java\nRemoved the xtend-gen folder\nRemoved org.eclipse.xtend.lib dependency from the manifest file\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>", "committedDate": "2020-03-22T15:18:54Z", "type": "forcePushed"}, {"oid": "804f3120dd092e2421872d7c03e9539c6d5cdc0b", "url": "https://github.com/eclipse/xtext-eclipse/commit/804f3120dd092e2421872d7c03e9539c6d5cdc0b", "message": "Migrated Xtend code to Java\nRemoved the xtend-gen folder\nRemoved org.eclipse.xtend.lib dependency from the manifest file\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>", "committedDate": "2020-03-22T17:07:09Z", "type": "commit"}, {"oid": "804f3120dd092e2421872d7c03e9539c6d5cdc0b", "url": "https://github.com/eclipse/xtext-eclipse/commit/804f3120dd092e2421872d7c03e9539c6d5cdc0b", "message": "Migrated Xtend code to Java\nRemoved the xtend-gen folder\nRemoved org.eclipse.xtend.lib dependency from the manifest file\n\nSigned-off-by: nbhusare <neerajbhusare@gmail.com>", "committedDate": "2020-03-22T17:07:09Z", "type": "forcePushed"}]}