{"pr_number": 1452, "pr_title": "[#1450] adapted JavaBuilderState to change in field type of State.references", "pr_createdAt": "2020-05-13T09:26:18Z", "pr_url": "https://github.com/eclipse/xtext-eclipse/pull/1452", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMTE5Ng==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1452#discussion_r424301196", "bodyText": "A comment with a version hint would be great.", "author": "szarnekow", "createdAt": "2020-05-13T09:29:13Z", "path": "org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java", "diffHunk": "@@ -233,8 +239,10 @@ private SimpleLookupTable getReferences() {\n \t\t}\n \n \t\tObject readReferences = readField(state, \"references\", null);\n-\t\tif (readReferences instanceof SimpleLookupTable) {\n-\t\t\treferences = (SimpleLookupTable) readReferences;\n+\t\tif (readReferences instanceof Map) {", "originalCommit": "61dd242ea311db5b7ba7770dcdf40fbeecd48dab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef480d76498d4118ddd1a63195ed09d4da28da14", "chunk": "diff --git a/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java b/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java\nindex d02d27f42..146ffc31e 100644\n--- a/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java\n+++ b/org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java\n\n@@ -240,8 +240,10 @@ public class JavaBuilderState {\n \n \t\tObject readReferences = readField(state, \"references\", null);\n \t\tif (readReferences instanceof Map) {\n+\t\t\t// used in 4.16 and later\n \t\t\treferences = readReferences;\n \t\t} else if (readReferences instanceof SimpleLookupTable) {\n+\t\t\t// used in 4.15 and earlier\n \t\t\treferences = readReferences;\n \t\t}\n \t\treturn references;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMTU0NQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1452#discussion_r424301545", "bodyText": "I like that. Initially I though we'd have to dup the field, but having the two instanceof checks looks pretty clean - given the circumstances.", "author": "szarnekow", "createdAt": "2020-05-13T09:29:46Z", "path": "org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java", "diffHunk": "@@ -223,7 +229,7 @@ private String getSimplePrimaryTypeName(ICompilationUnit compilationUnit) {\n \t\treturn elementName.substring(0, elementName.lastIndexOf(\".\"));\n \t}\n \n-\tprivate SimpleLookupTable getReferences() {\n+\tprivate Object getReferences() {", "originalCommit": "61dd242ea311db5b7ba7770dcdf40fbeecd48dab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMjExMw==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1452#discussion_r424302113", "bodyText": "I was trying to understand what this code is supposed to do with the type locators, but failed until now to grasp it. So I appreciate the local change.", "author": "szarnekow", "createdAt": "2020-05-13T09:30:40Z", "path": "org.eclipse.xtext.common.types.ui/src/org/eclipse/xtext/common/types/ui/notification/JavaBuilderState.java", "diffHunk": "@@ -143,7 +144,13 @@ protected TypeNames _getQualifiedTypeNames(IPackageFragment packageFragment) {\n \t\tString packageName = packageFragment.getElementName();\n \t\tIPath packagePath = resource.getProjectRelativePath();\n \t\tint srcPathSegmentCount = getPackageFragmentRoot(packageFragment).getResource().getProjectRelativePath().segmentCount();\n-\t\tfor (Object typeLocator : references.keyTable) {\n+\t\tIterable<?> keys;\n+\t\tif (references instanceof Map) {\n+\t\t\tkeys = ((Map<?,?>) references).keySet();\n+\t\t} else {\n+\t\t\tkeys = Arrays.asList(((SimpleLookupTable)references).keyTable);\n+\t\t}\n+\t\tfor (Object typeLocator : keys) {", "originalCommit": "61dd242ea311db5b7ba7770dcdf40fbeecd48dab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "ef480d76498d4118ddd1a63195ed09d4da28da14", "url": "https://github.com/eclipse/xtext-eclipse/commit/ef480d76498d4118ddd1a63195ed09d4da28da14", "message": "[#1450] adapted JavaBuilderState to change in field type of State.references\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-05-13T09:33:57Z", "type": "commit"}, {"oid": "ef480d76498d4118ddd1a63195ed09d4da28da14", "url": "https://github.com/eclipse/xtext-eclipse/commit/ef480d76498d4118ddd1a63195ed09d4da28da14", "message": "[#1450] adapted JavaBuilderState to change in field type of State.references\n\nSigned-off-by: Christian Dietrich <christian.dietrich@itemis.de>", "committedDate": "2020-05-13T09:33:57Z", "type": "forcePushed"}]}