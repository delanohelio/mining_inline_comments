{"pr_number": 1480, "pr_title": "[bugzilla 564578] Fix wrong colors on colors preference page", "pr_createdAt": "2020-06-23T12:18:27Z", "pr_url": "https://github.com/eclipse/xtext-eclipse/pull/1480", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE3OTQyMQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444179421", "bodyText": "wonder why this was here in the first place", "author": "cdietrich", "createdAt": "2020-06-23T12:20:03Z", "path": "org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java", "diffHunk": "@@ -104,7 +104,6 @@ public final void propertyChange(PropertyChangeEvent event) {\n \t\tif (event.getSource() instanceof FieldEditor) {\n \t\t\tFieldEditor fe = (FieldEditor) event.getSource();\n \t\t\tinternalStore.setValue(fe.getPreferenceName(), fe.getPreferenceStore().getDefaultString(fe.getPreferenceName()));\n-\t\t\tfe.setPreferenceStore(internalStore);", "originalCommit": "d7246c27b010ef6cbb0205a96bbda5cb25b894f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4MTg4Ng==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444181886", "bodyText": "this changes seems to break the editor changing on preference change", "author": "cdietrich", "createdAt": "2020-06-23T12:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE3OTQyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4OTYwMw==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444189603", "bodyText": "I was too quick. I'll have another look.", "author": "heeckhau", "createdAt": "2020-06-23T12:37:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE3OTQyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDIxNTYxNg==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444215616", "bodyText": "looks better now. lets see what the build tells", "author": "cdietrich", "createdAt": "2020-06-23T13:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE3OTQyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "fd15940d32b96240ba8ab46718b2c95742db81a0", "chunk": "diff --git a/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java b/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java\nindex 1f9b0b707..102e0dee2 100644\n--- a/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java\n+++ b/org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java\n\n@@ -104,7 +104,11 @@ public abstract class AbstractDetailsPart extends FieldEditorPreferencePage {\n \t\tif (event.getSource() instanceof FieldEditor) {\n \t\t\tFieldEditor fe = (FieldEditor) event.getSource();\n \t\t\tinternalStore.setValue(fe.getPreferenceName(), fe.getPreferenceStore().getDefaultString(fe.getPreferenceName()));\n+\t\t\t// store changed value in internalStore\n+\t\t\tfe.setPreferenceStore(internalStore);\n \t\t\tfe.store();\n+\t\t\t// reset preference store of fieldEditor to chained store, so it also works for other token styles.\n+\t\t\tfe.setPreferenceStore(getPreferenceStore());\n \t\t}\n \t\tsuper.propertyChange(event);\n \t}\n"}}, {"oid": "fdc16d819ce75e104ae877516691af0388e489bf", "url": "https://github.com/eclipse/xtext-eclipse/commit/fdc16d819ce75e104ae877516691af0388e489bf", "message": "[bugzilla 564578] Fix wrong colors on colors preference page\n\nThis fixes an issue on the syntax coloring preference page:\nwhen one color is changed, all other colors were shown as black\n\nThe preference store of field editors should not be replaced when\nwhen a color is changed. The preference store is already a chained\npreference store that contains the internal store.\n\nThis fixes bugzilla 564578\n\nSigned-off-by: Hendrik Eeckhaut <hendrik.eeckhaut@sigasi.com>", "committedDate": "2020-06-23T12:25:25Z", "type": "forcePushed"}, {"oid": "fd15940d32b96240ba8ab46718b2c95742db81a0", "url": "https://github.com/eclipse/xtext-eclipse/commit/fd15940d32b96240ba8ab46718b2c95742db81a0", "message": "[bugzilla 564578] Fix wrong colors on colors preference page\n\nThis fixes an issue on the syntax coloring preference page:\nwhen one color is changed, all other colors were shown as black\n\nThe preference store of field editors should not be replaced when\nwhen a color is changed. The preference store is already a chained\npreference store that contains the internal store.\n\nThis fixes bugzilla 564578\n\nSigned-off-by: Hendrik Eeckhaut <hendrik.eeckhaut@sigasi.com>", "committedDate": "2020-06-23T13:05:18Z", "type": "commit"}, {"oid": "fd15940d32b96240ba8ab46718b2c95742db81a0", "url": "https://github.com/eclipse/xtext-eclipse/commit/fd15940d32b96240ba8ab46718b2c95742db81a0", "message": "[bugzilla 564578] Fix wrong colors on colors preference page\n\nThis fixes an issue on the syntax coloring preference page:\nwhen one color is changed, all other colors were shown as black\n\nThe preference store of field editors should not be replaced when\nwhen a color is changed. The preference store is already a chained\npreference store that contains the internal store.\n\nThis fixes bugzilla 564578\n\nSigned-off-by: Hendrik Eeckhaut <hendrik.eeckhaut@sigasi.com>", "committedDate": "2020-06-23T13:05:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxNjY5OQ==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444716699", "bodyText": "Shouldn't this be done in a finally block? I assume store can throw either Core or IOExceptions", "author": "tivervac", "createdAt": "2020-06-24T08:04:31Z", "path": "org.eclipse.xtext.ui/src/org/eclipse/xtext/ui/editor/preferences/fields/AbstractDetailsPart.java", "diffHunk": "@@ -104,8 +104,11 @@ public final void propertyChange(PropertyChangeEvent event) {\n \t\tif (event.getSource() instanceof FieldEditor) {\n \t\t\tFieldEditor fe = (FieldEditor) event.getSource();\n \t\t\tinternalStore.setValue(fe.getPreferenceName(), fe.getPreferenceStore().getDefaultString(fe.getPreferenceName()));\n+\t\t\t// store changed value in internalStore\n \t\t\tfe.setPreferenceStore(internalStore);\n \t\t\tfe.store();\n+\t\t\t// reset preference store of fieldEditor to chained store, so it also works for other token styles.\n+\t\t\tfe.setPreferenceStore(getPreferenceStore());", "originalCommit": "fd15940d32b96240ba8ab46718b2c95742db81a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk5MDQ0OA==", "url": "https://github.com/eclipse/xtext-eclipse/pull/1480#discussion_r444990448", "bodyText": "Maybe, but this is not done for similar code in this class.\nI tried to keep the fix as small as possible", "author": "heeckhau", "createdAt": "2020-06-24T15:42:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxNjY5OQ=="}], "type": "inlineReview", "revised_code": null}]}