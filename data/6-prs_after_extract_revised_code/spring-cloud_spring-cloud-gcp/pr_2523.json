{"pr_number": 2523, "pr_title": "Firestore extractDatabasePath update", "pr_createdAt": "2020-09-15T14:24:30Z", "pr_url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523", "timeline": [{"oid": "e12636e8d09402c0cd07764218e3dc3d5285c4d0", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/e12636e8d09402c0cd07764218e3dc3d5285c4d0", "message": "fix firestore dependency issue", "committedDate": "2020-09-15T14:11:02Z", "type": "commit"}, {"oid": "f31436cec4f667573ab351ab352c90a2ebbb9fa2", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/f31436cec4f667573ab351ab352c90a2ebbb9fa2", "message": "update gcp-libraries-bom version", "committedDate": "2020-09-15T14:21:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1MzE2Mw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488753163", "bodyText": "What happened to StringUtils? Why can't we use it anymore?", "author": "meltsufin", "createdAt": "2020-09-15T15:19:19Z", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));", "originalCommit": "f31436cec4f667573ab351ab352c90a2ebbb9fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1Nzc2Ng==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488857766", "bodyText": "org.apache.commons.lang3 was removed from dependencies and I don't want to bring it in only for this one method.", "author": "dmitry-s", "createdAt": "2020-09-15T17:53:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc1MzE2Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488791365", "bodyText": "Since you're appending each character at a time anyway in a StringBuilder, might as well just do String.split(\"/\") and then do return arr[0] + \"/\" + arr[1] + ... + arr[3]; would be more readable (only 2-3 lines total).", "author": "dzou", "createdAt": "2020-09-15T16:12:37Z", "path": "spring-cloud-gcp-data-firestore/src/main/java/org/springframework/cloud/gcp/data/firestore/util/Util.java", "diffHunk": "@@ -27,7 +25,20 @@ private Util() {\n \t}\n \n \tpublic static String extractDatabasePath(String parent) {\n-\t\treturn parent.substring(0, StringUtils.ordinalIndexOf(parent, \"/\", 4));\n+\t\t//the parent looks like this: projects/{project_id}/databases/{database_id}/...\n+\t\t//and the database path is the first 4 segments, separated by /\n+\t\tStringBuilder sb = new StringBuilder();\n+\t\tint count = 0;\n+\t\tfor (int i = 0; i < parent.length(); i++) {\n+\t\t\tchar c = parent.charAt(i);\n+\t\t\tif (c == '/') {\n+\t\t\t\tcount++;\n+\t\t\t}\n+\t\t\tif (count == 4) {\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t\tsb.append(c);", "originalCommit": "f31436cec4f667573ab351ab352c90a2ebbb9fa2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MjgxNg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488792816", "bodyText": "You can even make it more efficient using the limit arg in String.split: https://docs.oracle.com/javase/7/docs/api/java/lang/String.html#split(java.lang.String,%20int)", "author": "dzou", "createdAt": "2020-09-15T16:14:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1NzE2MQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488857161", "bodyText": "I was trying to avoid unnecessary computation, since split allocates an array and then we need to combine the items. Also, split is a regex based method so the computational complexity is higher.", "author": "dmitry-s", "createdAt": "2020-09-15T17:52:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1OTI3Nw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2523#discussion_r488859277", "bodyText": "I see, makes sense.", "author": "dzou", "createdAt": "2020-09-15T17:56:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5MTM2NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "65e17bd802a881d90a87a9b6cad4296d40124f12", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/65e17bd802a881d90a87a9b6cad4296d40124f12", "message": "roll back bom", "committedDate": "2020-09-15T18:27:19Z", "type": "commit"}]}