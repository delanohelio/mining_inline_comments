{"pr_number": 2156, "pr_title": "set of small code-style improvements", "pr_createdAt": "2020-01-31T15:55:39Z", "pr_url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156", "timeline": [{"oid": "57ef9afdebe865b046d3fd5574192aacbc1925d8", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/57ef9afdebe865b046d3fd5574192aacbc1925d8", "message": "code-style improvements", "committedDate": "2020-01-31T15:51:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373567614", "bodyText": "could you clarify why was the call to resolveEntityClassNames removed?", "author": "dmitry-s", "createdAt": "2020-01-31T16:27:25Z", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "originalCommit": "57ef9afdebe865b046d3fd5574192aacbc1925d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2OTc5NA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373569794", "bodyText": "the executeReadSql method is invoked only from the executeRawResult where resolveEntityClassNames  already invoked in the line 222", "author": "s13o", "createdAt": "2020-01-31T16:31:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3MjIwNw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373572207", "bodyText": "we should better invoke it once in the constructor of QueryTagValue and mark the field 'sql' as final", "author": "s13o", "createdAt": "2020-01-31T16:36:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU3Mzg2Ng==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373573866", "bodyText": "Ok so executeReadSql is only called from executeRawResult, and resolveEntityClassNames is done there.\nI think the best way to fix that would be to call resolveEntityClassNames in the constructor, this way the sql field will always have resolved class names and there will be no need for any individual method to do that.", "author": "dmitry-s", "createdAt": "2020-01-31T16:39:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU4MDAwOA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373580008", "bodyText": "Basically It is already like this, but without changing the constructor's signature.\nI've just removed a double invocation because I believe this method is costly", "author": "s13o", "createdAt": "2020-01-31T16:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU4MTUyNA==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373581524", "bodyText": "Well, what if I'll add one more commit? Will it become added to the PR automatically or I should cancel the PR and create a new one?", "author": "s13o", "createdAt": "2020-01-31T16:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYyMjkzNg==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373622936", "bodyText": "it will be added to the PR", "author": "dmitry-s", "createdAt": "2020-01-31T18:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2NzYxNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a9d3bee91975ff5dd6498d6d0d50a6b2eac668a1", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/a9d3bee91975ff5dd6498d6d0d50a6b2eac668a1", "message": "code-style improvements", "committedDate": "2020-01-31T17:36:16Z", "type": "commit"}, {"oid": "a9d3bee91975ff5dd6498d6d0d50a6b2eac668a1", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/a9d3bee91975ff5dd6498d6d0d50a6b2eac668a1", "message": "code-style improvements", "committedDate": "2020-01-31T17:36:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU1MzEwNw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373553107", "bodyText": "if you will check the invocation stack you will find that the method 'resolveEntityClassNames' has been already applied to queryTagValue.sql", "author": "s13o", "createdAt": "2020-01-31T15:59:07Z", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -245,8 +245,7 @@ private List executeReadSql(Pageable pageable, Sort sort, QueryTagValue queryTag\n \n \t\tqueryTagValue.sql = SpannerStatementQueryExecutor\n \t\t\t\t.applySortingPagingQueryOptions(this.entityType, spannerQueryOptions,\n-\t\t\t\t\t\tresolveEntityClassNames(queryTagValue.sql),", "originalCommit": "57ef9afdebe865b046d3fd5574192aacbc1925d8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "ae5f9d1defc712bbcb39a6421f62c18e1987af9f", "url": "https://github.com/spring-cloud/spring-cloud-gcp/commit/ae5f9d1defc712bbcb39a6421f62c18e1987af9f", "message": "refactoring", "committedDate": "2020-01-31T20:24:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY4Mzg4OQ==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373683889", "bodyText": "I knew that, but you requested to modify the constructor :)", "author": "s13o", "createdAt": "2020-01-31T21:02:40Z", "path": "spring-cloud-gcp-data-spanner/src/main/java/org/springframework/cloud/gcp/data/spanner/repository/query/SqlSpannerQuery.java", "diffHunk": "@@ -301,11 +301,10 @@ else if (expression instanceof CompositeStringExpression) {\n \n \t\tString sql;\n \n-\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql,\n-\t\t\t\tSpannerMappingContext spannerMappingContext) {\n+\t\tQueryTagValue(List<String> tags, Object[] rawParams, Object[] params, String sql) {\n \t\t\tthis.tags = tags;\n \t\t\tthis.intialParams = params;\n-\t\t\tthis.sql = resolveEntityClassNames(sql, spannerMappingContext);\n+\t\t\tthis.sql = sql;", "originalCommit": "ae5f9d1defc712bbcb39a6421f62c18e1987af9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY5MDA4Mw==", "url": "https://github.com/spring-cloud/spring-cloud-gcp/pull/2156#discussion_r373690083", "bodyText": "not that constructor :)", "author": "dmitry-s", "createdAt": "2020-01-31T21:19:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY4Mzg4OQ=="}], "type": "inlineReview", "revised_code": null}]}