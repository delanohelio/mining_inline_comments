{"pr_number": 113, "pr_title": "DEV-1106 Always use a second PD SSD when local SSDs disabled", "pr_createdAt": "2020-01-13T22:26:59Z", "pr_url": "https://github.com/hartwigmedical/pipeline5/pull/113", "timeline": [{"oid": "4bce44b6f26d63002668c22541e822706517f08d", "url": "https://github.com/hartwigmedical/pipeline5/commit/4bce44b6f26d63002668c22541e822706517f08d", "message": "DEV-1106 Always use a second PD SSD when local SSDs disabled\n\nThis solves the issue of the 2TB limit of the boot disk. The boot disk will\nalways be 100GB (although perhaps that can be reduced?) and workind disk size\nthe size of the new disk.\n\nThe disk is mounted in the startup script with the PersistentStorageStrategy.\nthis mounts /dev/sdb to /data.", "committedDate": "2020-01-13T22:26:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUyMzAxMA==", "url": "https://github.com/hartwigmedical/pipeline5/pull/113#discussion_r366523010", "bodyText": "Nit: maybe extend the analogy and call this bootDiskParams?", "author": "nedleitch", "createdAt": "2020-01-14T19:14:38Z", "path": "cluster/src/main/java/com/hartwig/pipeline/execution/vm/ComputeEngine.java", "diffHunk": "@@ -203,33 +205,46 @@ private void addNetworkInterface(Instance instance, String projectName) {\n         instance.setNetworkInterfaces(singletonList(networkInterface));\n     }\n \n-    private Image attachDisks(Compute compute, Instance instance, VirtualMachineJobDefinition jobDefinition, String projectName, String vmName,\n-                              String zone) throws IOException {\n+    private Image attachDisks(Compute compute, Instance instance, VirtualMachineJobDefinition jobDefinition, String projectName,\n+            String vmName, String zone) throws IOException {\n         Image sourceImage = resolveLatestImage(compute, jobDefinition.imageFamily(), projectName);\n-        AttachedDisk disk = new AttachedDisk();\n-        disk.setBoot(true);\n-        disk.setAutoDelete(true);\n+        AttachedDisk bootDisk = new AttachedDisk();\n+        bootDisk.setBoot(true);\n+        bootDisk.setAutoDelete(true);\n         AttachedDiskInitializeParams params = new AttachedDiskInitializeParams();", "originalCommit": "4bce44b6f26d63002668c22541e822706517f08d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0dcd8f37f1776ed768e7898bd6306962ffec108", "chunk": "diff --git a/cluster/src/main/java/com/hartwig/pipeline/execution/vm/ComputeEngine.java b/cluster/src/main/java/com/hartwig/pipeline/execution/vm/ComputeEngine.java\nindex ac151fbd..344fc48c 100644\n--- a/cluster/src/main/java/com/hartwig/pipeline/execution/vm/ComputeEngine.java\n+++ b/cluster/src/main/java/com/hartwig/pipeline/execution/vm/ComputeEngine.java\n\n@@ -211,11 +211,11 @@ public class ComputeEngine {\n         AttachedDisk bootDisk = new AttachedDisk();\n         bootDisk.setBoot(true);\n         bootDisk.setAutoDelete(true);\n-        AttachedDiskInitializeParams params = new AttachedDiskInitializeParams();\n-        params.setSourceImage(sourceImage.getSelfLink());\n-        params.setDiskType(pdssd(projectName, zone));\n-        params.setDiskSizeGb(jobDefinition.baseImageDiskSizeGb());\n-        bootDisk.setInitializeParams(params);\n+        AttachedDiskInitializeParams bootDiskParams = new AttachedDiskInitializeParams();\n+        bootDiskParams.setSourceImage(sourceImage.getSelfLink());\n+        bootDiskParams.setDiskType(pdssd(projectName, zone));\n+        bootDiskParams.setDiskSizeGb(jobDefinition.baseImageDiskSizeGb());\n+        bootDisk.setInitializeParams(bootDiskParams);\n         List<AttachedDisk> disks = new ArrayList<>(singletonList(bootDisk));\n         if (arguments.useLocalSsds()) {\n             attachLocalSsds(disks, jobDefinition.localSsdCount(), projectName, zone);\n"}}, {"oid": "f0dcd8f37f1776ed768e7898bd6306962ffec108", "url": "https://github.com/hartwigmedical/pipeline5/commit/f0dcd8f37f1776ed768e7898bd6306962ffec108", "message": "DEV-1106 Review comments\n\nImprove variable name.", "committedDate": "2020-01-14T20:00:35Z", "type": "commit"}]}