{"pr_number": 619, "pr_title": "#616 - Simplify user() method", "pr_createdAt": "2020-09-22T09:33:44Z", "pr_url": "https://github.com/artipie/artipie/pull/619", "timeline": [{"oid": "53e66542c31185278d4d8413495ac404c4db2a6a", "url": "https://github.com/artipie/artipie/commit/53e66542c31185278d4d8413495ac404c4db2a6a", "message": "#616 - Simplify user() method", "committedDate": "2020-09-22T09:31:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2Nzk4OA==", "url": "https://github.com/artipie/artipie/pull/619#discussion_r493267988", "bodyText": "@genryxy passing nullable type into check method does not seem elegant, and also method with name check does not suppose to extract password type... So, I'd suggest create separate method to obtain password type (simply extract this logic from check) and then call check method with known password type.", "author": "olenagerasimova", "createdAt": "2020-09-23T07:46:14Z", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -74,24 +68,13 @@ public AuthFromYaml(final YamlMapping cred) {\n     public Optional<Authentication.User> user(final String user, final String pass) {\n         final YamlMapping users = this.cred.yamlMapping(\"credentials\");\n         Optional<Authentication.User> res = Optional.empty();\n-        //@checkstyle NestedIfDepthCheck (10 lines)\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            if (stored != null) {\n-                final String type = users.yamlMapping(user).string(\"type\");\n-                if (type != null) {\n-                    if (check(stored, type, pass)) {\n-                        res = Optional.of(\n-                            new User(user, AuthFromYaml.groups(users.yamlMapping(user)))\n-                        );\n-                    }\n-                } else {\n-                    if (check(stored, pass)) {\n-                        res = Optional.of(\n-                            new User(user, AuthFromYaml.groups(users.yamlMapping(user)))\n-                        );\n-                    }\n-                }\n+            final String type = users.yamlMapping(user).string(\"type\");", "originalCommit": "53e66542c31185278d4d8413495ac404c4db2a6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE3MjY3NA==", "url": "https://github.com/artipie/artipie/pull/619#discussion_r494172674", "bodyText": "@olenagerasimova thanks. If I obtain password type from the method it becomes more difficult to distinguish password that have type at the beginning plain:123 from the password 123. I can pass user and users to check() method instead of nullable type but in this case method will have 4 parameters. Or would it be better to find a solution that doesn't pass nullable value to the method?", "author": "genryxy", "createdAt": "2020-09-24T09:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2Nzk4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIyNzg3Nw==", "url": "https://github.com/artipie/artipie/pull/619#discussion_r494227877", "bodyText": "@genryxy I see, sorry for the misguided suggestion. Maybe we can make type Optional<String> to avoid null and rename check method properly? The name of the method should show shortly explain what the method does.", "author": "olenagerasimova", "createdAt": "2020-09-24T11:09:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2Nzk4OA=="}], "type": "inlineReview", "revised_code": {"commit": "fe497ed3cb0a85f1ffe1c5812746e0eebce89742", "chunk": "diff --git a/src/main/java/com/artipie/auth/AuthFromYaml.java b/src/main/java/com/artipie/auth/AuthFromYaml.java\nindex 6494ded..7fbf521 100644\n--- a/src/main/java/com/artipie/auth/AuthFromYaml.java\n+++ b/src/main/java/com/artipie/auth/AuthFromYaml.java\n\n@@ -70,8 +70,10 @@ public final class AuthFromYaml implements Authentication {\n         Optional<Authentication.User> res = Optional.empty();\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n-            final String type = users.yamlMapping(user).string(\"type\");\n-            if (stored != null && check(stored, type, pass)) {\n+            final Optional<String> type = Optional.ofNullable(\n+                users.yamlMapping(user).string(\"type\")\n+            );\n+            if (stored != null && checkPswdByType(stored, type, pass)) {\n                 res = Optional.of(\n                     new User(user, AuthFromYaml.groups(users.yamlMapping(user)))\n                 );\n"}}, {"oid": "fe497ed3cb0a85f1ffe1c5812746e0eebce89742", "url": "https://github.com/artipie/artipie/commit/fe497ed3cb0a85f1ffe1c5812746e0eebce89742", "message": "#616 - Review fixes", "committedDate": "2020-09-24T11:44:28Z", "type": "commit"}, {"oid": "1b551bc6edb81347d1076bbe7948b91e73939104", "url": "https://github.com/artipie/artipie/commit/1b551bc6edb81347d1076bbe7948b91e73939104", "message": "Merge remote-tracking branch 'upstream/master' into 616-simplify-user", "committedDate": "2020-09-24T11:45:55Z", "type": "commit"}, {"oid": "2a0b22ba7d591ea2a2163ab3354a3eb36da13aca", "url": "https://github.com/artipie/artipie/commit/2a0b22ba7d591ea2a2163ab3354a3eb36da13aca", "message": "Merge branch 'master' into 616-simplify-user", "committedDate": "2020-09-24T17:14:48Z", "type": "commit"}]}