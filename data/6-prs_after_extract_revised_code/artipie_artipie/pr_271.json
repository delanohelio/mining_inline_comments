{"pr_number": 271, "pr_title": "Authentication and authorization logging", "pr_createdAt": "2020-07-07T11:15:06Z", "pr_url": "https://github.com/artipie/artipie/pull/271", "timeline": [{"oid": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "url": "https://github.com/artipie/artipie/commit/6e972be8dc750b9a0a444a632a02973b0f4785b1", "message": "#197 - authentication and authorization logging", "committedDate": "2020-07-07T11:13:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMTA0Nw==", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450801047", "bodyText": "@g4s8 please consider renaming the class to YamlPermissions as it more common to put implementation specifics first and interface name second", "author": "olegmoz", "createdAt": "2020-07-07T11:41:08Z", "path": "src/main/java/com/artipie/PermissionsYaml.java", "diffHunk": "@@ -36,7 +37,7 @@\n  * on repository yaml configuration file.\n  * @since 0.2\n  */\n-public final class RpPermissions implements Permissions {\n+public final class PermissionsYaml implements Permissions {", "originalCommit": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "chunk": "diff --git a/src/main/java/com/artipie/PermissionsYaml.java b/src/main/java/com/artipie/YamlPermissions.java\nsimilarity index 92%\nrename from src/main/java/com/artipie/PermissionsYaml.java\nrename to src/main/java/com/artipie/YamlPermissions.java\nindex b29b25d..86e1099 100644\n--- a/src/main/java/com/artipie/PermissionsYaml.java\n+++ b/src/main/java/com/artipie/YamlPermissions.java\n\n@@ -37,7 +37,7 @@ import java.io.IOException;\n  * on repository yaml configuration file.\n  * @since 0.2\n  */\n-public final class PermissionsYaml implements Permissions {\n+public final class YamlPermissions implements Permissions {\n \n     /**\n      * Asterisk wildcard.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMjgyNw==", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450802827", "bodyText": "@g4s8 logging level looks to be too high for this kind of messages as they explain they do not log actions, but explain reason why certain actions were made. I'd suggest to decrease logging level to debug or make it configurable", "author": "olegmoz", "createdAt": "2020-07-07T11:44:36Z", "path": "src/main/java/com/artipie/PermissionsYaml.java", "diffHunk": "@@ -52,23 +53,29 @@\n      * Ctor.\n      * @param conf Config file\n      */\n-    public RpPermissions(final File conf) {\n+    public PermissionsYaml(final File conf) {\n         this(readYaml(conf));\n     }\n \n     /**\n      * Ctor.\n      * @param yaml Configuration yaml\n      */\n-    public RpPermissions(final YamlMapping yaml) {\n+    public PermissionsYaml(final YamlMapping yaml) {\n         this.yaml = yaml;\n     }\n \n     @Override\n     public boolean allowed(final String name, final String action) {\n         final YamlMapping all = this.yaml.yamlMapping(\"permissions\");\n-        return check(all.yamlSequence(name), action)\n-            || check(all.yamlSequence(RpPermissions.WILDCARD), action);\n+        final boolean res = check(all.yamlSequence(name), action)\n+            || check(all.yamlSequence(PermissionsYaml.WILDCARD), action);\n+        if (res) {\n+            Logger.info(this, \"Operation '%s' allowed for '%s'\", action, name);\n+        } else {\n+            Logger.info(this, \"Operation '%s' denied for '%s'\", action, name);", "originalCommit": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "chunk": "diff --git a/src/main/java/com/artipie/PermissionsYaml.java b/src/main/java/com/artipie/YamlPermissions.java\nsimilarity index 92%\nrename from src/main/java/com/artipie/PermissionsYaml.java\nrename to src/main/java/com/artipie/YamlPermissions.java\nindex b29b25d..86e1099 100644\n--- a/src/main/java/com/artipie/PermissionsYaml.java\n+++ b/src/main/java/com/artipie/YamlPermissions.java\n\n@@ -53,7 +53,7 @@ public final class PermissionsYaml implements Permissions {\n      * Ctor.\n      * @param conf Config file\n      */\n-    public PermissionsYaml(final File conf) {\n+    public YamlPermissions(final File conf) {\n         this(readYaml(conf));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMzA1NQ==", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450803055", "bodyText": "@g4s8 logging levels, see my previous comment", "author": "olegmoz", "createdAt": "2020-07-07T11:45:05Z", "path": "src/main/java/com/artipie/auth/AuthFromEnv.java", "diffHunk": "@@ -71,8 +72,10 @@ public AuthFromEnv(final Map<String, String> env) {\n         // @checkstyle LineLengthCheck (5 lines)\n         if (Objects.equals(Objects.requireNonNull(username), this.env.get(AuthFromEnv.ENV_NAME))\n             && Objects.equals(Objects.requireNonNull(password), this.env.get(AuthFromEnv.ENV_PASS))) {\n+            Logger.info(this, \"Successfully authenticated '%s' user\", username);\n             result = Optional.of(username);\n         } else {\n+            Logger.info(this, \"Failed to authenticate '%s' user\", username);", "originalCommit": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "chunk": "diff --git a/src/main/java/com/artipie/auth/AuthFromEnv.java b/src/main/java/com/artipie/auth/AuthFromEnv.java\nindex 62d6e7b..c6a8c8c 100644\n--- a/src/main/java/com/artipie/auth/AuthFromEnv.java\n+++ b/src/main/java/com/artipie/auth/AuthFromEnv.java\n\n@@ -72,10 +71,8 @@ public final class AuthFromEnv implements Authentication {\n         // @checkstyle LineLengthCheck (5 lines)\n         if (Objects.equals(Objects.requireNonNull(username), this.env.get(AuthFromEnv.ENV_NAME))\n             && Objects.equals(Objects.requireNonNull(password), this.env.get(AuthFromEnv.ENV_PASS))) {\n-            Logger.info(this, \"Successfully authenticated '%s' user\", username);\n             result = Optional.of(username);\n         } else {\n-            Logger.info(this, \"Failed to authenticate '%s' user\", username);\n             result = Optional.of(\"anonymous\");\n         }\n         return result;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgwMzE4Mw==", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450803183", "bodyText": "@g4s8 logging levels, see my previous comment", "author": "olegmoz", "createdAt": "2020-07-07T11:45:20Z", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -84,6 +85,11 @@ public AuthFromYaml(final YamlMapping cred) {\n                 }\n             }\n         }\n+        if (res.isEmpty()) {\n+            Logger.info(this, \"Failed to authenticate '%s' user\", user);\n+        } else {\n+            Logger.info(this, \"Successfully authenticated '%s' user\", user);\n+        }", "originalCommit": "6e972be8dc750b9a0a444a632a02973b0f4785b1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "chunk": "diff --git a/src/main/java/com/artipie/auth/AuthFromYaml.java b/src/main/java/com/artipie/auth/AuthFromYaml.java\nindex 763a4f6..b5a68c2 100644\n--- a/src/main/java/com/artipie/auth/AuthFromYaml.java\n+++ b/src/main/java/com/artipie/auth/AuthFromYaml.java\n\n@@ -85,11 +84,6 @@ public final class AuthFromYaml implements Authentication {\n                 }\n             }\n         }\n-        if (res.isEmpty()) {\n-            Logger.info(this, \"Failed to authenticate '%s' user\", user);\n-        } else {\n-            Logger.info(this, \"Successfully authenticated '%s' user\", user);\n-        }\n         return res;\n     }\n \n"}}, {"oid": "ccf5525ee91ad11ff619f090f8422519770ff4f0", "url": "https://github.com/artipie/artipie/commit/ccf5525ee91ad11ff619f090f8422519770ff4f0", "message": "#197 - review fixes", "committedDate": "2020-07-07T14:03:48Z", "type": "commit"}, {"oid": "651bfee52a100a869c9118bd6726cee9fbdcae89", "url": "https://github.com/artipie/artipie/commit/651bfee52a100a869c9118bd6726cee9fbdcae89", "message": "Merge branch 'master' into 197", "committedDate": "2020-07-07T14:11:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkwNjYxMQ==", "url": "https://github.com/artipie/artipie/pull/271#discussion_r450906611", "bodyText": "@g4s8 guess you forgot to delete logging here", "author": "olegmoz", "createdAt": "2020-07-07T14:26:42Z", "path": "src/main/java/com/artipie/YamlPermissions.java", "diffHunk": "@@ -52,23 +53,29 @@\n      * Ctor.\n      * @param conf Config file\n      */\n-    public RpPermissions(final File conf) {\n+    public YamlPermissions(final File conf) {\n         this(readYaml(conf));\n     }\n \n     /**\n      * Ctor.\n      * @param yaml Configuration yaml\n      */\n-    public RpPermissions(final YamlMapping yaml) {\n+    public YamlPermissions(final YamlMapping yaml) {\n         this.yaml = yaml;\n     }\n \n     @Override\n     public boolean allowed(final String name, final String action) {\n         final YamlMapping all = this.yaml.yamlMapping(\"permissions\");\n-        return check(all.yamlSequence(name), action)\n-            || check(all.yamlSequence(RpPermissions.WILDCARD), action);\n+        final boolean res = check(all.yamlSequence(name), action)\n+            || check(all.yamlSequence(YamlPermissions.WILDCARD), action);\n+        if (res) {\n+            Logger.info(this, \"Operation '%s' allowed for '%s'\", action, name);\n+        } else {\n+            Logger.info(this, \"Operation '%s' denied for '%s'\", action, name);\n+        }", "originalCommit": "651bfee52a100a869c9118bd6726cee9fbdcae89", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4a495fa194a2f7d4b857f5e08ff52f94827e542a", "chunk": "diff --git a/src/main/java/com/artipie/YamlPermissions.java b/src/main/java/com/artipie/YamlPermissions.java\nindex 86e1099..a921181 100644\n--- a/src/main/java/com/artipie/YamlPermissions.java\n+++ b/src/main/java/com/artipie/YamlPermissions.java\n\n@@ -68,14 +67,8 @@ public final class YamlPermissions implements Permissions {\n     @Override\n     public boolean allowed(final String name, final String action) {\n         final YamlMapping all = this.yaml.yamlMapping(\"permissions\");\n-        final boolean res = check(all.yamlSequence(name), action)\n+        return check(all.yamlSequence(name), action)\n             || check(all.yamlSequence(YamlPermissions.WILDCARD), action);\n-        if (res) {\n-            Logger.info(this, \"Operation '%s' allowed for '%s'\", action, name);\n-        } else {\n-            Logger.info(this, \"Operation '%s' denied for '%s'\", action, name);\n-        }\n-        return res;\n     }\n \n     /**\n"}}, {"oid": "4a495fa194a2f7d4b857f5e08ff52f94827e542a", "url": "https://github.com/artipie/artipie/commit/4a495fa194a2f7d4b857f5e08ff52f94827e542a", "message": "#197 - removed logging from yaml-permissions", "committedDate": "2020-07-07T15:21:42Z", "type": "commit"}, {"oid": "fb6e5ad295435d292aba40078186323654ac8b10", "url": "https://github.com/artipie/artipie/commit/fb6e5ad295435d292aba40078186323654ac8b10", "message": "Merge branch 'master' into 197", "committedDate": "2020-07-08T14:32:36Z", "type": "commit"}, {"oid": "cc36cc0eb961facb673136f0169565ecc9b0a855", "url": "https://github.com/artipie/artipie/commit/cc36cc0eb961facb673136f0169565ecc9b0a855", "message": "Merge branch 'master' into 197", "committedDate": "2020-07-08T14:34:35Z", "type": "commit"}]}