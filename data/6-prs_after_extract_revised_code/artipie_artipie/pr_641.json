{"pr_number": 641, "pr_title": "#573 - update http", "pr_createdAt": "2020-09-28T06:14:58Z", "pr_url": "https://github.com/artipie/artipie/pull/641", "timeline": [{"oid": "e597d192cca5142fa321db1646108a1e78dacff6", "url": "https://github.com/artipie/artipie/commit/e597d192cca5142fa321db1646108a1e78dacff6", "message": "#573 - update http", "committedDate": "2020-09-28T06:12:53Z", "type": "commit"}, {"oid": "6dced3f5f753283904f6c614d2908ecfba86add4", "url": "https://github.com/artipie/artipie/commit/6dced3f5f753283904f6c614d2908ecfba86add4", "message": "Merge branch 'master' into 573-udpdate-http", "committedDate": "2020-09-28T07:14:52Z", "type": "commit"}, {"oid": "a3c7a86e911a187b498ca659f051727fe2896917", "url": "https://github.com/artipie/artipie/commit/a3c7a86e911a187b498ca659f051727fe2896917", "message": "check groups in YamlPermissions and update docker", "committedDate": "2020-09-28T10:30:15Z", "type": "commit"}, {"oid": "ddf1cdc283a65c4beb48ac3551d32d7c0f31b54e", "url": "https://github.com/artipie/artipie/commit/ddf1cdc283a65c4beb48ac3551d32d7c0f31b54e", "message": "#573 - bumped gem version", "committedDate": "2020-09-29T04:58:40Z", "type": "commit"}, {"oid": "ef7fad21fa58a1f260ef940e485b43c3dfa3051d", "url": "https://github.com/artipie/artipie/commit/ef7fad21fa58a1f260ef940e485b43c3dfa3051d", "message": "Merge branch 'master' into 573-udpdate-http", "committedDate": "2020-09-29T05:05:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4MjUzNA==", "url": "https://github.com/artipie/artipie/pull/641#discussion_r496482534", "bodyText": "@olenagerasimova I think User class lacks proper toString method at the moment. So we need to implement User formatting ourselves here or just print user's name for now", "author": "olegmoz", "createdAt": "2020-09-29T07:40:00Z", "path": "src/main/java/com/artipie/LoggingPermissions.java", "diffHunk": "@@ -63,12 +64,12 @@ public LoggingPermissions(final Permissions origin, final Level level) {\n     }\n \n     @Override\n-    public boolean allowed(final String name, final String action) {\n-        final boolean res = this.origin.allowed(name, action);\n+    public boolean allowed(final Authentication.User user, final String action) {\n+        final boolean res = this.origin.allowed(user, action);\n         if (res) {\n-            Logger.log(this.level, this.origin, \"Operation '%s' allowed for '%s'\", action, name);\n+            Logger.log(this.level, this.origin, \"Operation '%s' allowed for '%s'\", action, user);\n         } else {\n-            Logger.log(this.level, this.origin, \"Operation '%s' denied for '%s'\", action, name);\n+            Logger.log(this.level, this.origin, \"Operation '%s' denied for '%s'\", action, user);", "originalCommit": "ef7fad21fa58a1f260ef940e485b43c3dfa3051d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjUxODY1Nw==", "url": "https://github.com/artipie/artipie/pull/641#discussion_r496518657", "bodyText": "@olegmoz created artipie/http#246", "author": "olenagerasimova", "createdAt": "2020-09-29T08:21:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4MjUzNA=="}], "type": "inlineReview", "revised_code": {"commit": "dcb535d2cf646601d366bc9dc7fb32609a878f40", "chunk": "diff --git a/src/main/java/com/artipie/LoggingPermissions.java b/src/main/java/com/artipie/LoggingPermissions.java\nindex 3bfa0bb..b221886 100644\n--- a/src/main/java/com/artipie/LoggingPermissions.java\n+++ b/src/main/java/com/artipie/LoggingPermissions.java\n\n@@ -67,9 +67,13 @@ public final class LoggingPermissions implements Permissions {\n     public boolean allowed(final Authentication.User user, final String action) {\n         final boolean res = this.origin.allowed(user, action);\n         if (res) {\n-            Logger.log(this.level, this.origin, \"Operation '%s' allowed for '%s'\", action, user);\n+            Logger.log(\n+                this.level, this.origin, \"Operation '%s' allowed for '%s'\", action, user.name()\n+            );\n         } else {\n-            Logger.log(this.level, this.origin, \"Operation '%s' denied for '%s'\", action, user);\n+            Logger.log(\n+                this.level, this.origin, \"Operation '%s' denied for '%s'\", action, user.name()\n+            );\n         }\n         return res;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjQ4ODM5MA==", "url": "https://github.com/artipie/artipie/pull/641#discussion_r496488390", "bodyText": "@olenagerasimova I'd suggest to extract variable for Authentication.User(uname) to make code easier to read here and in janeCanDownloadAndDeploy, adminCanDoAnything methods", "author": "olegmoz", "createdAt": "2020-09-29T07:49:59Z", "path": "src/test/java/com/artipie/YamlPermissionsTest.java", "diffHunk": "@@ -48,10 +53,11 @@ void johnCanDownloadDeployAndDelete() throws Exception {\n             this.permissions(),\n             new AllOf<YamlPermissions>(\n                 new ListOf<org.hamcrest.Matcher<? super YamlPermissions>>(\n-                    new MatcherOf<>(perm -> { return perm.allowed(uname, \"delete\"); }),\n-                    new MatcherOf<>(perm -> { return perm.allowed(uname, \"deploy\"); }),\n-                    new MatcherOf<>(perm -> { return perm.allowed(uname, \"download\"); }),\n-                    new MatcherOf<>(perm -> !perm.allowed(uname, \"install\"))\n+                    // @checkstyle LineLengthCheck (4 lines)\n+                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"delete\"); }),\n+                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"deploy\"); }),\n+                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"download\"); }),\n+                    new MatcherOf<>(perm -> !perm.allowed(new Authentication.User(uname), \"install\"))", "originalCommit": "ef7fad21fa58a1f260ef940e485b43c3dfa3051d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dcb535d2cf646601d366bc9dc7fb32609a878f40", "chunk": "diff --git a/src/test/java/com/artipie/YamlPermissionsTest.java b/src/test/java/com/artipie/YamlPermissionsTest.java\nindex b29097e..74aa427 100644\n--- a/src/test/java/com/artipie/YamlPermissionsTest.java\n+++ b/src/test/java/com/artipie/YamlPermissionsTest.java\n\n@@ -48,16 +48,15 @@ class YamlPermissionsTest {\n \n     @Test\n     void johnCanDownloadDeployAndDelete() throws Exception {\n-        final String uname = \"john\";\n+        final Authentication.User user = new Authentication.User(\"john\");\n         MatcherAssert.assertThat(\n             this.permissions(),\n             new AllOf<YamlPermissions>(\n                 new ListOf<org.hamcrest.Matcher<? super YamlPermissions>>(\n-                    // @checkstyle LineLengthCheck (4 lines)\n-                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"delete\"); }),\n-                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"deploy\"); }),\n-                    new MatcherOf<>(perm -> { return perm.allowed(new Authentication.User(uname), \"download\"); }),\n-                    new MatcherOf<>(perm -> !perm.allowed(new Authentication.User(uname), \"install\"))\n+                    new MatcherOf<>(perm -> { return perm.allowed(user, \"delete\"); }),\n+                    new MatcherOf<>(perm -> { return perm.allowed(user, \"deploy\"); }),\n+                    new MatcherOf<>(perm -> { return perm.allowed(user, \"download\"); }),\n+                    new MatcherOf<>(perm -> !perm.allowed(user, \"install\"))\n                 )\n             )\n         );\n"}}, {"oid": "dcb535d2cf646601d366bc9dc7fb32609a878f40", "url": "https://github.com/artipie/artipie/commit/dcb535d2cf646601d366bc9dc7fb32609a878f40", "message": "#573 - CR", "committedDate": "2020-09-29T08:25:43Z", "type": "commit"}, {"oid": "34b91a3a415a91f6734c4dd7400df6475b3e90ea", "url": "https://github.com/artipie/artipie/commit/34b91a3a415a91f6734c4dd7400df6475b3e90ea", "message": "Merge branch 'master' into 573-udpdate-http", "committedDate": "2020-09-29T08:26:19Z", "type": "commit"}]}