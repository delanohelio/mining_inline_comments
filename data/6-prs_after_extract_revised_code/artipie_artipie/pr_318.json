{"pr_number": 318, "pr_title": "Authentication by github tokens", "pr_createdAt": "2020-07-13T13:27:18Z", "pr_url": "https://github.com/artipie/artipie/pull/318", "timeline": [{"oid": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "url": "https://github.com/artipie/artipie/commit/dc7330265bf4d39efb9d3444d7f454401e5437dd", "message": "#285 - authentication by github tokens", "committedDate": "2020-07-13T13:25:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgyNDk3Nw==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453824977", "bodyText": "@g4s8 seems like \"not\" should be \"now\"", "author": "olenagerasimova", "createdAt": "2020-07-13T17:50:25Z", "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -45,6 +47,11 @@\n  * Settings built from YAML.\n  *\n  * @since 0.1\n+ * @todo #285:30min Settings configuration for GitHub auth.\n+ *  Add additional settings configuration for GitHub authentication,\n+ *  not it's applied by default to auth from yaml using chained authentication.", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "chunk": "diff --git a/src/main/java/com/artipie/YamlSettings.java b/src/main/java/com/artipie/YamlSettings.java\nindex 0a4dc7c..e3cbaeb 100644\n--- a/src/main/java/com/artipie/YamlSettings.java\n+++ b/src/main/java/com/artipie/YamlSettings.java\n\n@@ -49,9 +49,10 @@ import org.reactivestreams.Publisher;\n  * @since 0.1\n  * @todo #285:30min Settings configuration for GitHub auth.\n  *  Add additional settings configuration for GitHub authentication,\n- *  not it's applied by default to auth from yaml using chained authentication.\n- *  We can configure this chain via settings and compose complex authentication providers there.\n- *  E.g. user can use ordered list of env auth, github auth and auth from yaml file.\n+ *  now it's applied by default to auth from yaml using chained authentication, see auth()\n+ *  method. We can configure this chain via settings and compose complex authentication\n+ *  providers there. E.g. user can use ordered list of env auth, github auth\n+ *  and auth from yaml file.\n  * @checkstyle ReturnCountCheck (500 lines)\n  */\n public final class YamlSettings implements Settings {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgyOTY1Mw==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453829653", "bodyText": "@g4s8 guava has time evicted cache implementation, I'd suggest simply todo to use it here", "author": "olenagerasimova", "createdAt": "2020-07-13T17:58:23Z", "path": "src/main/java/com/artipie/auth/CachedAuth.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import com.artipie.http.auth.Authentication;\n+import java.util.Optional;\n+import java.util.concurrent.ConcurrentMap;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+import org.jruby.util.collections.ConcurrentWeakHashMap;\n+\n+/**\n+ * Cached authentication decorator.\n+ * <p>\n+ * It remembers the result of decorated authentication provider and returns it\n+ * instead of calling origin authentication.\n+ * </p>\n+ * @since 0.10\n+ * @todo #285:30min Specify expiration time configuration.\n+ *  Instead of using scheduled executor to clean-up all cache map, use\n+ *  some configuration to clean-up only expired items, e.g. if token was not accessed for\n+ *  X minutes, then remove only this token.", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NDU0MQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453874541", "bodyText": "@olenagerasimova, a good point.", "author": "Sammers21", "createdAt": "2020-07-13T19:16:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgyOTY1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "chunk": "diff --git a/src/main/java/com/artipie/auth/CachedAuth.java b/src/main/java/com/artipie/auth/CachedAuth.java\nindex 4b5f08c..5397bd5 100644\n--- a/src/main/java/com/artipie/auth/CachedAuth.java\n+++ b/src/main/java/com/artipie/auth/CachedAuth.java\n\n@@ -40,7 +40,8 @@ import org.jruby.util.collections.ConcurrentWeakHashMap;\n  * @todo #285:30min Specify expiration time configuration.\n  *  Instead of using scheduled executor to clean-up all cache map, use\n  *  some configuration to clean-up only expired items, e.g. if token was not accessed for\n- *  X minutes, then remove only this token.\n+ *  X minutes, then remove only this token. Consider using Guava's time-evicted-cache\n+ *  implementation: https://github.com/google/guava/wiki/CachesExplained#eviction\n  */\n public final class CachedAuth implements Authentication {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgzNzU0NQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453837545", "bodyText": "@g4s8 hm, assertion message usually (in EO style code) specify that is expected, not what was wrong. I'm not sure this is some kind of rule though and hamcrest does not specify what we should put in the message...", "author": "olenagerasimova", "createdAt": "2020-07-13T18:12:19Z", "path": "src/test/java/com/artipie/auth/CachedAuthTest.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import java.util.Optional;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import org.cactoos.map.MapEntry;\n+import org.cactoos.map.MapOf;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+\n+/**\n+ * Test case for {@link CachedAuth}.\n+ *\n+ * @since 0.10\n+ */\n+final class CachedAuthTest {\n+\n+    @Test\n+    void usesCache() {\n+        final String username = \"test/user\";\n+        final String user = \"user\";\n+        MatcherAssert.assertThat(\n+            new CachedAuth(\n+                (usr, pass) -> Optional.empty(),\n+                new ConcurrentHashMap<>(new MapOf<>(new MapEntry<>(username, Optional.of(user))))\n+            ).user(username, \"any\").orElseThrow(),\n+            new IsEqual<>(user)\n+        );\n+    }\n+\n+    @Test\n+    void callsOriginOnlyOnce() {\n+        final String username = \"usr\";\n+        final AtomicInteger counter = new AtomicInteger();\n+        final CachedAuth target = new CachedAuth(\n+            (usr, pass) -> Optional.of(String.format(\"%s-%d\", usr, counter.incrementAndGet())),\n+            new ConcurrentHashMap<>()\n+        );\n+        final String expected = \"usr-1\";\n+        MatcherAssert.assertThat(\n+            \"Wrong user on first cache call\",", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE2NjA5NQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454166095", "bodyText": "@olenagerasimova assertion description is shown only when assertion fails, so it looks logical to say what is wrong. The example: Wrong user on first cache call: expected \"usr\", but was \"other\".", "author": "g4s8", "createdAt": "2020-07-14T07:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgzNzU0NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgzODAxMQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453838011", "bodyText": "@g4s8 same here", "author": "olenagerasimova", "createdAt": "2020-07-13T18:13:06Z", "path": "src/test/java/com/artipie/auth/CachedAuthTest.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import java.util.Optional;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.atomic.AtomicInteger;\n+import org.cactoos.map.MapEntry;\n+import org.cactoos.map.MapOf;\n+import org.hamcrest.MatcherAssert;\n+import org.hamcrest.core.IsEqual;\n+import org.junit.jupiter.api.Test;\n+\n+/**\n+ * Test case for {@link CachedAuth}.\n+ *\n+ * @since 0.10\n+ */\n+final class CachedAuthTest {\n+\n+    @Test\n+    void usesCache() {\n+        final String username = \"test/user\";\n+        final String user = \"user\";\n+        MatcherAssert.assertThat(\n+            new CachedAuth(\n+                (usr, pass) -> Optional.empty(),\n+                new ConcurrentHashMap<>(new MapOf<>(new MapEntry<>(username, Optional.of(user))))\n+            ).user(username, \"any\").orElseThrow(),\n+            new IsEqual<>(user)\n+        );\n+    }\n+\n+    @Test\n+    void callsOriginOnlyOnce() {\n+        final String username = \"usr\";\n+        final AtomicInteger counter = new AtomicInteger();\n+        final CachedAuth target = new CachedAuth(\n+            (usr, pass) -> Optional.of(String.format(\"%s-%d\", usr, counter.incrementAndGet())),\n+            new ConcurrentHashMap<>()\n+        );\n+        final String expected = \"usr-1\";\n+        MatcherAssert.assertThat(\n+            \"Wrong user on first cache call\",\n+            target.user(username, \"\").orElseThrow(),\n+            new IsEqual<>(expected)\n+        );\n+        MatcherAssert.assertThat(\n+            \"Wrong user on second cache call\",", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2MzM3Mg==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453863372", "bodyText": "No reference to the official docs.\nwhat does \"prefixed by provider name username\" mean?", "author": "Sammers21", "createdAt": "2020-07-13T18:56:38Z", "path": "src/main/java/com/artipie/auth/GithubAuth.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import com.artipie.http.auth.Authentication;\n+import com.jcabi.github.RtGithub;\n+import java.io.IOException;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * GitHub authentication uses prefixed by provider name username and personal access token", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "chunk": "diff --git a/src/main/java/com/artipie/auth/GithubAuth.java b/src/main/java/com/artipie/auth/GithubAuth.java\nindex 499d0c9..783fdcf 100644\n--- a/src/main/java/com/artipie/auth/GithubAuth.java\n+++ b/src/main/java/com/artipie/auth/GithubAuth.java\n\n@@ -34,8 +34,10 @@ import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n /**\n- * GitHub authentication uses prefixed by provider name username and personal access token\n- * as a password.\n+ * GitHub authentication uses username prefixed by provider name {@code github.com}\n+ * and personal access token as a password.\n+ * See <a href=\"https://developer.github.com/v3/oauth_authorizations/\">GitHub docs</a>\n+ * for details.\n  * @implNote This implementation is not case sensitive.\n  * @since 0.10\n  */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2NTc5MA==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453865790", "bodyText": "The strangest general description I saw in my life. Can you explain for which purpose you plan to use it? And in which cases it is useful?", "author": "Sammers21", "createdAt": "2020-07-13T19:00:46Z", "path": "src/main/java/com/artipie/auth/ChainedAuth.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import com.artipie.http.auth.Authentication;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+/**\n+ * Chained authentication provider, composed by multiple", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE2ODUyMg==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454168522", "bodyText": "@Sammers21 can you explain what exactly is not clear here? It says composed by multiple authentication providers invoked by user specified order..", "author": "g4s8", "createdAt": "2020-07-14T07:47:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2NTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyMTQ5NQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454221495", "bodyText": "@g4s8, I got the meaning, but it is still hard for me to imagine. An example would be helpful.", "author": "Sammers21", "createdAt": "2020-07-14T09:20:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg2NTc5MA=="}], "type": "inlineReview", "revised_code": {"commit": "18380f66db404de355fd0e3b6cecc4edd4b627cd", "chunk": "diff --git a/src/main/java/com/artipie/auth/ChainedAuth.java b/src/main/java/com/artipie/auth/ChainedAuth.java\nindex 7fabfdf..4ca9a98 100644\n--- a/src/main/java/com/artipie/auth/ChainedAuth.java\n+++ b/src/main/java/com/artipie/auth/ChainedAuth.java\n\n@@ -32,6 +32,16 @@ import java.util.Optional;\n /**\n  * Chained authentication provider, composed by multiple\n  * authentication providers invoked by user specified order.\n+ * <p>\n+ * Example, this code will check authentication using {@code GithubAuth} provider first,\n+ * and {@code EnvAuth} then, if first provider didn't resolve the user:\n+ * <pre><code>\n+ * new ChainedAuth(\n+ *   new GithubAuth(),\n+ *   new EnvAuth()\n+ * )\n+ * </code></pre>\n+ * </p>\n  * @since 0.10\n  */\n public final class ChainedAuth implements Authentication {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3MzE1OA==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453873158", "bodyText": "I can't understand the description. Can you explain what already done and what is planned to do in the puzzle?", "author": "Sammers21", "createdAt": "2020-07-13T19:14:19Z", "path": "src/main/java/com/artipie/YamlSettings.java", "diffHunk": "@@ -45,6 +47,11 @@\n  * Settings built from YAML.\n  *\n  * @since 0.1\n+ * @todo #285:30min Settings configuration for GitHub auth.", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "chunk": "diff --git a/src/main/java/com/artipie/YamlSettings.java b/src/main/java/com/artipie/YamlSettings.java\nindex 0a4dc7c..e3cbaeb 100644\n--- a/src/main/java/com/artipie/YamlSettings.java\n+++ b/src/main/java/com/artipie/YamlSettings.java\n\n@@ -49,9 +49,10 @@ import org.reactivestreams.Publisher;\n  * @since 0.1\n  * @todo #285:30min Settings configuration for GitHub auth.\n  *  Add additional settings configuration for GitHub authentication,\n- *  not it's applied by default to auth from yaml using chained authentication.\n- *  We can configure this chain via settings and compose complex authentication providers there.\n- *  E.g. user can use ordered list of env auth, github auth and auth from yaml file.\n+ *  now it's applied by default to auth from yaml using chained authentication, see auth()\n+ *  method. We can configure this chain via settings and compose complex authentication\n+ *  providers there. E.g. user can use ordered list of env auth, github auth\n+ *  and auth from yaml file.\n  * @checkstyle ReturnCountCheck (500 lines)\n  */\n public final class YamlSettings implements Settings {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NTk0Nw==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r453875947", "bodyText": "The if statement looks ugly", "author": "Sammers21", "createdAt": "2020-07-13T19:19:27Z", "path": "src/main/java/com/artipie/auth/GithubAuth.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import com.artipie.http.auth.Authentication;\n+import com.jcabi.github.RtGithub;\n+import java.io.IOException;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * GitHub authentication uses prefixed by provider name username and personal access token\n+ * as a password.\n+ * @implNote This implementation is not case sensitive.\n+ * @since 0.10\n+ */\n+public final class GithubAuth implements Authentication {\n+\n+    /**\n+     * Username pattern, starts with provider name {@code github.com}, slash,\n+     * and GitHub username, e.g. {@code github.com/octocat}.\n+     */\n+    private static final Pattern PTN_NAME = Pattern.compile(\"^github\\\\.com/(.+)$\");\n+\n+    /**\n+     * Github username resolver by personal access token.\n+     */\n+    private final Function<String, String> github;\n+\n+    /**\n+     * New GitHub authentication.\n+     * @checkstyle ReturnCountCheck (10 lines)\n+     */\n+    public GithubAuth() {\n+        this(\n+            token -> {\n+                try {\n+                    return new RtGithub(token).users().self().login();\n+                } catch (final IOException unauthorized) {\n+                    return \"\";\n+                }\n+            }\n+        );\n+    }\n+\n+    /**\n+     * Primary constructor.\n+     * @param github Github username resolver\n+     */\n+    GithubAuth(final Function<String, String> github) {\n+        this.github = github;\n+    }\n+\n+    @Override\n+    public Optional<String> user(final String username, final String password) {\n+        Optional<String> result = Optional.empty();\n+        final Matcher matcher = GithubAuth.PTN_NAME.matcher(username);\n+        if (matcher.matches()) {\n+            final String login = this.github.apply(password).toLowerCase(Locale.US);\n+            if (\n+                Objects.equals(login, matcher.group(1).toLowerCase(Locale.US))\n+            ) {", "originalCommit": "dc7330265bf4d39efb9d3444d7f454401e5437dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDE3MDI5NA==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454170294", "bodyText": "@Sammers21 it's not constructive. I've either suggest an improvement or say what exactly is wrong.", "author": "g4s8", "createdAt": "2020-07-14T07:50:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NTk0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyMzk2Nw==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454223967", "bodyText": "@g4s8, beauty can't be constructive or non-construtive. It is a personal matter", "author": "Sammers21", "createdAt": "2020-07-14T09:25:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3NTk0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "chunk": "diff --git a/src/main/java/com/artipie/auth/GithubAuth.java b/src/main/java/com/artipie/auth/GithubAuth.java\nindex 499d0c9..783fdcf 100644\n--- a/src/main/java/com/artipie/auth/GithubAuth.java\n+++ b/src/main/java/com/artipie/auth/GithubAuth.java\n\n@@ -34,8 +34,10 @@ import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n /**\n- * GitHub authentication uses prefixed by provider name username and personal access token\n- * as a password.\n+ * GitHub authentication uses username prefixed by provider name {@code github.com}\n+ * and personal access token as a password.\n+ * See <a href=\"https://developer.github.com/v3/oauth_authorizations/\">GitHub docs</a>\n+ * for details.\n  * @implNote This implementation is not case sensitive.\n  * @since 0.10\n  */\n"}}, {"oid": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "url": "https://github.com/artipie/artipie/commit/63f377d39cc64aa1aa886cacd32cfa6701888e65", "message": "#285 - github auth review fixes", "committedDate": "2020-07-14T07:51:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIzNjQ5MQ==", "url": "https://github.com/artipie/artipie/pull/318#discussion_r454236491", "bodyText": "Resolves tokens to username? Right? can you specify it?", "author": "Sammers21", "createdAt": "2020-07-14T09:46:43Z", "path": "src/main/java/com/artipie/auth/GithubAuth.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright (c) 2020 artipie.com\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included\n+ * in all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package com.artipie.auth;\n+\n+import com.artipie.http.auth.Authentication;\n+import com.jcabi.github.RtGithub;\n+import java.io.IOException;\n+import java.util.Locale;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.function.Function;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * GitHub authentication uses username prefixed by provider name {@code github.com}\n+ * and personal access token as a password.\n+ * See <a href=\"https://developer.github.com/v3/oauth_authorizations/\">GitHub docs</a>\n+ * for details.\n+ * @implNote This implementation is not case sensitive.\n+ * @since 0.10\n+ */\n+public final class GithubAuth implements Authentication {\n+\n+    /**\n+     * Username pattern, starts with provider name {@code github.com}, slash,\n+     * and GitHub username, e.g. {@code github.com/octocat}.\n+     */\n+    private static final Pattern PTN_NAME = Pattern.compile(\"^github\\\\.com/(.+)$\");\n+\n+    /**\n+     * Github username resolver by personal access token.\n+     */\n+    private final Function<String, String> github;\n+\n+    /**\n+     * New GitHub authentication.\n+     * @checkstyle ReturnCountCheck (10 lines)\n+     */\n+    public GithubAuth() {\n+        this(\n+            token -> {\n+                try {\n+                    return new RtGithub(token).users().self().login();\n+                } catch (final IOException unauthorized) {\n+                    return \"\";\n+                }\n+            }\n+        );\n+    }\n+\n+    /**\n+     * Primary constructor.\n+     * @param github Github username resolver", "originalCommit": "63f377d39cc64aa1aa886cacd32cfa6701888e65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "18380f66db404de355fd0e3b6cecc4edd4b627cd", "chunk": "diff --git a/src/main/java/com/artipie/auth/GithubAuth.java b/src/main/java/com/artipie/auth/GithubAuth.java\nindex 783fdcf..1bd721f 100644\n--- a/src/main/java/com/artipie/auth/GithubAuth.java\n+++ b/src/main/java/com/artipie/auth/GithubAuth.java\n\n@@ -72,7 +72,7 @@ public final class GithubAuth implements Authentication {\n \n     /**\n      * Primary constructor.\n-     * @param github Github username resolver\n+     * @param github Resolves GitHub token to username\n      */\n     GithubAuth(final Function<String, String> github) {\n         this.github = github;\n"}}, {"oid": "18380f66db404de355fd0e3b6cecc4edd4b627cd", "url": "https://github.com/artipie/artipie/commit/18380f66db404de355fd0e3b6cecc4edd4b627cd", "message": "#285 - more javadocs, review fixes", "committedDate": "2020-07-15T07:33:11Z", "type": "commit"}, {"oid": "9a74a1bcd857accc79f3a4e72bbdb842a11c0530", "url": "https://github.com/artipie/artipie/commit/9a74a1bcd857accc79f3a4e72bbdb842a11c0530", "message": "Merge branch 'master' into 285", "committedDate": "2020-07-15T07:34:46Z", "type": "commit"}, {"oid": "46f9fef47dbb659d93cba4c978da0e4488323e1a", "url": "https://github.com/artipie/artipie/commit/46f9fef47dbb659d93cba4c978da0e4488323e1a", "message": "Merge branch 'master' into 285", "committedDate": "2020-07-15T12:36:35Z", "type": "commit"}]}