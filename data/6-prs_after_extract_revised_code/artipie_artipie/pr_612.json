{"pr_number": 612, "pr_title": "#572 - read groups in AuthFromYaml", "pr_createdAt": "2020-09-20T06:58:14Z", "pr_url": "https://github.com/artipie/artipie/pull/612", "timeline": [{"oid": "30db0aed4bcae9e7cdf10d4da310ec89be0ea01a", "url": "https://github.com/artipie/artipie/commit/30db0aed4bcae9e7cdf10d4da310ec89be0ea01a", "message": "#572 - read groups in AuthFromYaml", "committedDate": "2020-09-20T06:52:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MTQyNQ==", "url": "https://github.com/artipie/artipie/pull/612#discussion_r491891425", "bodyText": "@olenagerasimova merging of nested if/else statements you've mad are not identical. Is it intentional? I'd suggest to keep it as it is for now and address in separate issue/PR if it needs to be fixed", "author": "olegmoz", "createdAt": "2020-09-21T09:07:01Z", "path": "src/main/java/com/artipie/auth/AuthFromYaml.java", "diffHunk": "@@ -65,22 +68,18 @@ public AuthFromYaml(final YamlMapping cred) {\n     }\n \n     @Override\n-    public Optional<String> user(final String user, final String pass) {\n+    public Optional<Authentication.User> user(final String user, final String pass) {\n         final YamlMapping users = this.cred.yamlMapping(\"credentials\");\n-        Optional<String> res = Optional.empty();\n+        Optional<Authentication.User> res = Optional.empty();\n         //@checkstyle NestedIfDepthCheck (10 lines)\n         if (users != null && users.yamlMapping(user) != null) {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n             if (stored != null) {\n                 final String type = users.yamlMapping(user).string(\"type\");\n-                if (type != null) {\n-                    if (check(stored, type, pass)) {\n-                        res = Optional.of(user);\n-                    }\n-                } else {\n-                    if (check(stored, pass)) {\n-                        res = Optional.of(user);\n-                    }\n+                if (type != null && check(stored, type, pass)) {\n+                    res = Optional.of(new User(user, AuthFromYaml.groups(users.yamlMapping(user))));\n+                } else if (check(stored, pass)) {\n+                    res = Optional.of(new User(user, AuthFromYaml.groups(users.yamlMapping(user))));", "originalCommit": "30db0aed4bcae9e7cdf10d4da310ec89be0ea01a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eacadd3c87054445614b2131b8a0a209ebc2d849", "chunk": "diff --git a/src/main/java/com/artipie/auth/AuthFromYaml.java b/src/main/java/com/artipie/auth/AuthFromYaml.java\nindex 034e455..ef9a243 100644\n--- a/src/main/java/com/artipie/auth/AuthFromYaml.java\n+++ b/src/main/java/com/artipie/auth/AuthFromYaml.java\n\n@@ -76,10 +79,18 @@ public final class AuthFromYaml implements Authentication {\n             final String stored = users.yamlMapping(user).string(\"pass\");\n             if (stored != null) {\n                 final String type = users.yamlMapping(user).string(\"type\");\n-                if (type != null && check(stored, type, pass)) {\n-                    res = Optional.of(new User(user, AuthFromYaml.groups(users.yamlMapping(user))));\n-                } else if (check(stored, pass)) {\n-                    res = Optional.of(new User(user, AuthFromYaml.groups(users.yamlMapping(user))));\n+                if (type != null) {\n+                    if (check(stored, type, pass)) {\n+                        res = Optional.of(\n+                            new User(user, AuthFromYaml.groups(users.yamlMapping(user)))\n+                        );\n+                    }\n+                } else {\n+                    if (check(stored, pass)) {\n+                        res = Optional.of(\n+                            new User(user, AuthFromYaml.groups(users.yamlMapping(user)))\n+                        );\n+                    }\n                 }\n             }\n         }\n"}}, {"oid": "eacadd3c87054445614b2131b8a0a209ebc2d849", "url": "https://github.com/artipie/artipie/commit/eacadd3c87054445614b2131b8a0a209ebc2d849", "message": "#572 - CR", "committedDate": "2020-09-21T09:34:58Z", "type": "commit"}, {"oid": "317e52641090d0ca4824639bcf55b9543190a597", "url": "https://github.com/artipie/artipie/commit/317e52641090d0ca4824639bcf55b9543190a597", "message": "Merge branch 'master' into 572-update-http", "committedDate": "2020-09-21T10:33:24Z", "type": "commit"}]}