{"pr_number": 644, "pr_title": "#573 - add groups to GetPermissionSlice", "pr_createdAt": "2020-09-28T13:01:01Z", "pr_url": "https://github.com/artipie/artipie/pull/644", "timeline": [{"oid": "5da77e4b88f6f48af9a70f09f5b307074a7e5081", "url": "https://github.com/artipie/artipie/commit/5da77e4b88f6f48af9a70f09f5b307074a7e5081", "message": "#573 - add groups to GetPermissionSlice", "committedDate": "2020-09-28T12:59:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTk1MTU1OA==", "url": "https://github.com/artipie/artipie/pull/644#discussion_r495951558", "bodyText": "@olenagerasimova I think we need to extract item.username().charAt(0) == '/' this predicate to a method or class and reuse it in both filter expressions here to avoid code duplication and make intent more clear", "author": "olegmoz", "createdAt": "2020-09-28T13:46:30Z", "path": "src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java", "diffHunk": "@@ -111,7 +112,22 @@ private static JsonObject response(\n         return Json.createObjectBuilder()\n             .add(\"includesPattern\", includesPattern(patterns))\n             .add(\"repositories\", Json.createArrayBuilder().add(repo).build())\n-            .add(\"principals\", Json.createObjectBuilder().add(\"users\", users(permissions)))\n+            .add(\n+                \"principals\",\n+                Json.createObjectBuilder()\n+                    .add(\n+                        \"users\",\n+                        permissions(\n+                            permissions.stream().filter(item -> item.username().charAt(0) != '/')\n+                        )\n+                    )\n+                    .add(\n+                        \"groups\",\n+                        permissions(\n+                            permissions.stream().filter(item -> item.username().charAt(0) == '/')\n+                        )", "originalCommit": "5da77e4b88f6f48af9a70f09f5b307074a7e5081", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "000a6106fbf2c462bb4a18d0be9cdfed9bcbad01", "chunk": "diff --git a/src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java b/src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java\nindex 401d267..bc77462 100644\n--- a/src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java\n+++ b/src/main/java/com/artipie/api/artifactory/GetPermissionSlice.java\n\n@@ -117,15 +119,11 @@ public final class GetPermissionSlice implements Slice {\n                 Json.createObjectBuilder()\n                     .add(\n                         \"users\",\n-                        permissions(\n-                            permissions.stream().filter(item -> item.username().charAt(0) != '/')\n-                        )\n+                        permissionsJson(permissions.stream().filter(new UsersFilter()))\n                     )\n                     .add(\n                         \"groups\",\n-                        permissions(\n-                            permissions.stream().filter(item -> item.username().charAt(0) == '/')\n-                        )\n+                        permissionsJson(permissions.stream().filter(new UsersFilter().negate()))\n                     )\n             )\n             .build();\n"}}, {"oid": "000a6106fbf2c462bb4a18d0be9cdfed9bcbad01", "url": "https://github.com/artipie/artipie/commit/000a6106fbf2c462bb4a18d0be9cdfed9bcbad01", "message": "#573 - CR", "committedDate": "2020-09-28T17:43:32Z", "type": "commit"}, {"oid": "cf8c86904304bb47fc9070df5c97d787d517b74c", "url": "https://github.com/artipie/artipie/commit/cf8c86904304bb47fc9070df5c97d787d517b74c", "message": "Merge branch 'master' into 573-groups-for-get-perm-slice", "committedDate": "2020-09-29T07:12:31Z", "type": "commit"}]}