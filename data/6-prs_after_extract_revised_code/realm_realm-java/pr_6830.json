{"pr_number": 6830, "pr_title": "Fix broken tests on CI and expose bug in Core", "pr_createdAt": "2020-05-04T07:50:58Z", "pr_url": "https://github.com/realm/realm-java/pull/6830", "timeline": [{"oid": "399d89fc6815bae0ee7c3e46e13b031d51ec110b", "url": "https://github.com/realm/realm-java/commit/399d89fc6815bae0ee7c3e46e13b031d51ec110b", "message": "Fix tests", "committedDate": "2020-05-04T07:50:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTYzOA==", "url": "https://github.com/realm/realm-java/pull/6830#discussion_r419311638", "bodyText": "I assume the callback above will be immediately executed after committing the transaction, right? Otherwise, we could face problems with the test finishing before the callback kicks in.", "author": "edualonso", "createdAt": "2020-05-04T09:25:53Z", "path": "realm/realm-library/src/androidTest/java/io/realm/internal/OsSharedRealmTests.java", "diffHunk": "@@ -178,6 +178,33 @@ public void onSchemaChanged() {\n         assertTrue(listenerCalled.get());\n     }\n \n+    // Test for https://github.com/realm/realm-core/issues/3707\n+    @Test\n+    public void emitTableInstructionsForCustomClasses() {\n+        final AtomicBoolean listenerCalled = new AtomicBoolean(false);\n+        assertFalse(sharedRealm.hasTable(\"NewTable\"));\n+        sharedRealm.registerSchemaChangedCallback(new OsSharedRealm.SchemaChangedCallback() {\n+            @Override\n+            public void onSchemaChanged() {\n+                assertTrue(sharedRealm.hasTable(\"NewTable\"));\n+                listenerCalled.set(true);\n+            }\n+        });\n+\n+        // Change schema using another Realm\n+        // Classes not starting with class_ were treated differently by Sync\n+        OsSharedRealm bgRealm = OsSharedRealm.getInstance(config, OsSharedRealm.VersionID.LIVE);\n+        bgRealm.beginTransaction();\n+        bgRealm.createTable(\"NewTable\");\n+        bgRealm.commitTransaction();", "originalCommit": "399d89fc6815bae0ee7c3e46e13b031d51ec110b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTk4MQ==", "url": "https://github.com/realm/realm-java/pull/6830#discussion_r419311981", "bodyText": "Yes, it does.", "author": "cmelchior", "createdAt": "2020-05-04T09:26:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMTYzOA=="}], "type": "inlineReview", "revised_code": null}]}