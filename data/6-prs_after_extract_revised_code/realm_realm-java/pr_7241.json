{"pr_number": 7241, "pr_title": "Consume monorepo core binaries", "pr_createdAt": "2020-12-09T17:37:40Z", "pr_url": "https://github.com/realm/realm-java/pull/7241", "timeline": [{"oid": "65130524043b17acdf0aabaa3c36d0361c2c96fb", "url": "https://github.com/realm/realm-java/commit/65130524043b17acdf0aabaa3c36d0361c2c96fb", "message": "RJAVA-564: Use monorepo (#7146)\n\n* Use monorepo\r\n\r\n* Use newer CMake\r\n\r\n* use latest monorepo\r\n\r\n* Point to right cmake version\r\nJenkins to use right cmake version\r\nFix imports and executables linking\r\n\r\n* Fix cmake url\r\n\r\n* Add ninja-build package to docker image\r\n\r\n* Add new cmake instructions to readme\r\n\r\n* don\u2019t worry about realm-core\u2019s command-line targets\r\n\r\n* use latest monorepo\r\n\r\n* Add support for LTO. It is enabled by default for release builds, but can be opted out of.\r\n\r\n* Rename abiFilter to indicate it support multiple flags\r\n\r\n* Set an optimization level, it is required when enabling LTO.\r\n\r\n* Bump core commit\r\n\r\n* Bump monorepo core version\r\n\r\n* rollback mongodb realm server version\r\n\r\n* Fix checkstyle step in Jenkins file\r\n\r\n* remove the gradle logic to download core\r\n\r\nthis should be moved to CMake\r\n\r\nCo-authored-by: Clemente Tort <clementetb@gmail.com>\r\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2020-11-09T12:08:07Z", "type": "commit"}, {"oid": "d80a23e709e5feded782358d771039f41208908b", "url": "https://github.com/realm/realm-java/commit/d80a23e709e5feded782358d771039f41208908b", "message": "Update license. Remove Realm Component license. (#7194)", "committedDate": "2020-11-12T05:53:42Z", "type": "commit"}, {"oid": "fad5fdc4cefd13175ac4cc05c94aad3e10ce19b7", "url": "https://github.com/realm/realm-java/commit/fad5fdc4cefd13175ac4cc05c94aad3e10ce19b7", "message": "Merge branch 'master' into support-new-datatypes\n\n# Conflicts:\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2020-11-24T16:25:09Z", "type": "commit"}, {"oid": "64fd2b1f026d30f523950ed78dc8521801de4275", "url": "https://github.com/realm/realm-java/commit/64fd2b1f026d30f523950ed78dc8521801de4275", "message": "Added temporarily missing dictionary and mixed type functions to java_object_accessor", "committedDate": "2020-11-26T10:04:40Z", "type": "commit"}, {"oid": "87f243958acd6dd1a2479754a03b6c8d229e6c85", "url": "https://github.com/realm/realm-java/commit/87f243958acd6dd1a2479754a03b6c8d229e6c85", "message": "Merge master in", "committedDate": "2020-12-09T13:50:57Z", "type": "commit"}, {"oid": "40c4051a04f0c1255f16c2830e65f22ad8b06972", "url": "https://github.com/realm/realm-java/commit/40c4051a04f0c1255f16c2830e65f22ad8b06972", "message": "Add support for consuming realm-core binaries", "committedDate": "2020-12-09T17:31:16Z", "type": "commit"}, {"oid": "d10ecc7262a8692fb61b140494211c156dae9d7f", "url": "https://github.com/realm/realm-java/commit/d10ecc7262a8692fb61b140494211c156dae9d7f", "message": "Force building from sources on base", "committedDate": "2020-12-09T18:10:11Z", "type": "commit"}, {"oid": "554d677bde67ce00967a13fb486c886a32fc5d2c", "url": "https://github.com/realm/realm-java/commit/554d677bde67ce00967a13fb486c886a32fc5d2c", "message": "Rename LTO switch property", "committedDate": "2020-12-09T18:12:26Z", "type": "commit"}, {"oid": "2f79643b04c155dc50b9c551d330ef6fdf792698", "url": "https://github.com/realm/realm-java/commit/2f79643b04c155dc50b9c551d330ef6fdf792698", "message": "Update Jenkins file to consume binaries when testing, and build core with LTO enabled on release.", "committedDate": "2020-12-09T18:13:24Z", "type": "commit"}, {"oid": "cd63a1709ec3a7e8e1d17eb0432a7db372ecc2cc", "url": "https://github.com/realm/realm-java/commit/cd63a1709ec3a7e8e1d17eb0432a7db372ecc2cc", "message": "Allow to cache binary resources\nEnable LTO optimizations by default", "committedDate": "2020-12-10T13:01:41Z", "type": "commit"}, {"oid": "8e0e3ca3cb33b039de9ffbbf5118de81a8295cf0", "url": "https://github.com/realm/realm-java/commit/8e0e3ca3cb33b039de9ffbbf5118de81a8295cf0", "message": "Use system env variable for defining the core download dir\nFix gradle not picking up boolean values", "committedDate": "2020-12-10T14:55:46Z", "type": "commit"}, {"oid": "87664eb1b9fff36950c7885bd5d0acaed971200b", "url": "https://github.com/realm/realm-java/commit/87664eb1b9fff36950c7885bd5d0acaed971200b", "message": "Update readme", "committedDate": "2020-12-10T15:03:42Z", "type": "commit"}, {"oid": "3e9147f61e79816005c3fcb8009d77bfb5f2bb09", "url": "https://github.com/realm/realm-java/commit/3e9147f61e79816005c3fcb8009d77bfb5f2bb09", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:17:39Z", "type": "commit"}, {"oid": "34005b5c49383f3153e204a2db832d783f574cc6", "url": "https://github.com/realm/realm-java/commit/34005b5c49383f3153e204a2db832d783f574cc6", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:18:04Z", "type": "commit"}, {"oid": "6f350593b4563cef436a665638ff12eb91f0d1b6", "url": "https://github.com/realm/realm-java/commit/6f350593b4563cef436a665638ff12eb91f0d1b6", "message": "Update realm/realm-library/src/main/cpp/CMakeLists.txt\n\nCo-authored-by: Yavor Georgiev <fealebenpae@users.noreply.github.com>", "committedDate": "2020-12-10T16:18:10Z", "type": "commit"}, {"oid": "10ff4c0922e4a917d08aff6e3a9b29e1da447c10", "url": "https://github.com/realm/realm-java/commit/10ff4c0922e4a917d08aff6e3a9b29e1da447c10", "message": "Add SHA validation for core artifacts", "committedDate": "2020-12-10T17:38:14Z", "type": "commit"}, {"oid": "489917464ebcbc6a0b34e141aa536ddf56ad3a5d", "url": "https://github.com/realm/realm-java/commit/489917464ebcbc6a0b34e141aa536ddf56ad3a5d", "message": "Bump realm core commit", "committedDate": "2020-12-14T08:04:52Z", "type": "commit"}, {"oid": "a11cf8233217e6ef6aa6a994e586fd9036432025", "url": "https://github.com/realm/realm-java/commit/a11cf8233217e6ef6aa6a994e586fd9036432025", "message": "Update changelog", "committedDate": "2020-12-14T08:54:51Z", "type": "commit"}, {"oid": "ef91bb62a99573e2f5a478125d981e0625493447", "url": "https://github.com/realm/realm-java/commit/ef91bb62a99573e2f5a478125d981e0625493447", "message": "Fix rename of REALM_SYNC", "committedDate": "2020-12-14T09:41:48Z", "type": "commit"}, {"oid": "39fa223ab20776233b177a75b433c6b9aaf4daa4", "url": "https://github.com/realm/realm-java/commit/39fa223ab20776233b177a75b433c6b9aaf4daa4", "message": "Remove fingerprint check", "committedDate": "2020-12-14T11:19:43Z", "type": "commit"}, {"oid": "271592cbe899c7254c65694b5ac6758d47fcc0fd", "url": "https://github.com/realm/realm-java/commit/271592cbe899c7254c65694b5ac6758d47fcc0fd", "message": "Bump realm-core commit to master 10.3.2", "committedDate": "2020-12-14T13:01:47Z", "type": "commit"}, {"oid": "1a7f797ca53d33e03decf9e6ac76526a0dd8a5b2", "url": "https://github.com/realm/realm-java/commit/1a7f797ca53d33e03decf9e6ac76526a0dd8a5b2", "message": "Ignore failing tests", "committedDate": "2020-12-14T13:01:57Z", "type": "commit"}, {"oid": "1dd23deaddf567b7d67ee8f9173cd200a009bf33", "url": "https://github.com/realm/realm-java/commit/1dd23deaddf567b7d67ee8f9173cd200a009bf33", "message": "Ignore further failing tests", "committedDate": "2020-12-14T13:52:17Z", "type": "commit"}, {"oid": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "url": "https://github.com/realm/realm-java/commit/e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "message": "Profile JNI library sizes.", "committedDate": "2020-12-15T10:15:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544144611", "bodyText": "Is this still a problem? At least the comments in the issue seems to indicate it has been fixed?\nIf it hasn't been fixed, how critical is it?", "author": "cmelchior", "createdAt": "2020-12-16T09:31:23Z", "path": "realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java", "diffHunk": "@@ -113,6 +114,7 @@\n  */\n \n @RunWith(Parameterized.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMzNzk3Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544337972", "bodyText": "It has been fixed but hasn't been released yet. It is on the core develop branch.\nThe issue crashes the test process, and it would crash any app. We shouldn't release without fixing the issue.", "author": "clementetb", "createdAt": "2020-12-16T14:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDkxOTU4Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544919582", "bodyText": "Okay, in that case, I would put this PR on hold until we can get a fix from Core. But otherwise I would say this PR is ready to be merge.", "author": "cmelchior", "createdAt": "2020-12-17T09:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NDYxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "905ca1982415cb3237ff927c99ee46f68958f0ed", "chunk": "diff --git a/realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java b/realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java\nindex 54e741610..7635d06da 100644\n--- a/realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java\n+++ b/realm/realm-library/src/androidTest/java/io/realm/ManagedOrderedRealmCollectionTests.java\n\n@@ -114,7 +114,7 @@ import static org.junit.Assert.fail;\n  */\n \n @RunWith(Parameterized.class)\n-@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n+//@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n public class ManagedOrderedRealmCollectionTests extends CollectionTests {\n \n     private static final int TEST_SIZE = 10;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTA4Mg==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145082", "bodyText": "Is this still relevant?", "author": "cmelchior", "createdAt": "2020-12-16T09:31:59Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java", "diffHunk": "@@ -75,6 +75,7 @@\n import static org.junit.Assume.assumeThat;\n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "905ca1982415cb3237ff927c99ee46f68958f0ed", "chunk": "diff --git a/realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java b/realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java\nindex 278de3f1e..4fd7cd25e 100644\n--- a/realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java\n+++ b/realm/realm-library/src/androidTest/java/io/realm/RealmJsonTests.java\n\n@@ -75,7 +75,7 @@ import static org.junit.Assert.fail;\n import static org.junit.Assume.assumeThat;\n \n @RunWith(AndroidJUnit4.class)\n-@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n+//@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n public class RealmJsonTests {\n     private static final Charset UTF_8 = Charset.forName(\"UTF-8\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTMyMw==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145323", "bodyText": "Same?", "author": "cmelchior", "createdAt": "2020-12-16T09:32:17Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java", "diffHunk": "@@ -68,6 +68,7 @@\n import static org.junit.Assert.fail;\n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "905ca1982415cb3237ff927c99ee46f68958f0ed", "chunk": "diff --git a/realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java b/realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java\nindex 561d21f08..54d86a93c 100644\n--- a/realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java\n+++ b/realm/realm-library/src/androidTest/java/io/realm/RealmResultsTests.java\n\n@@ -68,7 +68,7 @@ import static org.junit.Assert.assertTrue;\n import static org.junit.Assert.fail;\n \n @RunWith(AndroidJUnit4.class)\n-@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n+//@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n public class RealmResultsTests extends CollectionTests {\n \n     private final static int TEST_DATA_SIZE = 100;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDE0NTQwMQ==", "url": "https://github.com/realm/realm-java/pull/7241#discussion_r544145401", "bodyText": "Same?", "author": "cmelchior", "createdAt": "2020-12-16T09:32:22Z", "path": "realm/realm-library/src/androidTest/java/io/realm/RealmTests.java", "diffHunk": "@@ -135,6 +135,7 @@\n \n \n @RunWith(AndroidJUnit4.class)\n+@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")", "originalCommit": "e9c7ea21b41796fc9349fac8f85e9c23fe69b49d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "905ca1982415cb3237ff927c99ee46f68958f0ed", "chunk": "diff --git a/realm/realm-library/src/androidTest/java/io/realm/RealmTests.java b/realm/realm-library/src/androidTest/java/io/realm/RealmTests.java\nindex a60b59820..f1f4e5805 100644\n--- a/realm/realm-library/src/androidTest/java/io/realm/RealmTests.java\n+++ b/realm/realm-library/src/androidTest/java/io/realm/RealmTests.java\n\n@@ -135,7 +135,7 @@ import static org.mockito.Mockito.when;\n \n \n @RunWith(AndroidJUnit4.class)\n-@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n+//@Ignore(\"Tests crash due to bug in core, see https://jira.mongodb.org/browse/RCORE-435\")\n public class RealmTests {\n     private final static int TEST_DATA_SIZE = 10;\n \n"}}, {"oid": "9e034aa039277cff95f7d375934aa0567b581bea", "url": "https://github.com/realm/realm-java/commit/9e034aa039277cff95f7d375934aa0567b581bea", "message": "Update changelog", "committedDate": "2020-12-16T14:45:16Z", "type": "commit"}, {"oid": "905ca1982415cb3237ff927c99ee46f68958f0ed", "url": "https://github.com/realm/realm-java/commit/905ca1982415cb3237ff927c99ee46f68958f0ed", "message": "Bump master and enable tests affected by RCORE-435", "committedDate": "2021-01-08T11:18:57Z", "type": "commit"}, {"oid": "894c820c5264287d0aacaad401febb3cb785d445", "url": "https://github.com/realm/realm-java/commit/894c820c5264287d0aacaad401febb3cb785d445", "message": "Fix object store not copying data", "committedDate": "2021-01-08T12:29:49Z", "type": "commit"}, {"oid": "0f41646819c928a6da8702146b6f31cee84a50bd", "url": "https://github.com/realm/realm-java/commit/0f41646819c928a6da8702146b6f31cee84a50bd", "message": "Remove ignore comments", "committedDate": "2021-01-08T13:18:18Z", "type": "commit"}, {"oid": "427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "url": "https://github.com/realm/realm-java/commit/427d88faf6fcc9a5a419e3a24bdbcc4a2bcd92a2", "message": "PR changes and bump core to v10.3.3", "committedDate": "2021-01-08T14:36:23Z", "type": "commit"}, {"oid": "c3b99c7a5b87c372c0893781308c565841d8cf59", "url": "https://github.com/realm/realm-java/commit/c3b99c7a5b87c372c0893781308c565841d8cf59", "message": "Update CHANGELOG.md\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2021-01-08T14:40:34Z", "type": "commit"}, {"oid": "0800bd0381136c3844dd124f128e43391e5deaa0", "url": "https://github.com/realm/realm-java/commit/0800bd0381136c3844dd124f128e43391e5deaa0", "message": "Update CHANGELOG.md\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2021-01-08T14:40:44Z", "type": "commit"}, {"oid": "cb4a3c2495e4f74a6cfa252873e026bfaa6c912b", "url": "https://github.com/realm/realm-java/commit/cb4a3c2495e4f74a6cfa252873e026bfaa6c912b", "message": "Point to realm core in dependencies comments", "committedDate": "2021-01-08T14:58:00Z", "type": "commit"}, {"oid": "6d6e05e781e2b771d5ff6c0ffb61830367ad52b1", "url": "https://github.com/realm/realm-java/commit/6d6e05e781e2b771d5ff6c0ffb61830367ad52b1", "message": "Update changelog with some more fixes", "committedDate": "2021-01-08T16:14:44Z", "type": "commit"}, {"oid": "31c45fb6473c45ec2a7d61711e1ecb1cac4dcca0", "url": "https://github.com/realm/realm-java/commit/31c45fb6473c45ec2a7d61711e1ecb1cac4dcca0", "message": "Merge branch 'master' into ct/consume-monorepo-binaries\n\n# Conflicts:\n#\tCHANGELOG.md\n#\trealm/realm-library/src/main/cpp/object-store", "committedDate": "2021-01-08T16:29:18Z", "type": "commit"}]}