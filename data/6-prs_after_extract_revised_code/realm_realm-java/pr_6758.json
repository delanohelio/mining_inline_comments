{"pr_number": 6758, "pr_title": "Remove Query-based Sync API's", "pr_createdAt": "2020-02-27T07:27:09Z", "pr_url": "https://github.com/realm/realm-java/pull/6758", "timeline": [{"oid": "f752e83d8468703695f2361928b674cf66b51e44", "url": "https://github.com/realm/realm-java/commit/f752e83d8468703695f2361928b674cf66b51e44", "message": "Remove all API's and mentions of Query-based Sync.", "committedDate": "2020-02-07T14:38:53Z", "type": "commit"}, {"oid": "8a422b90287edb18f0ae9ac6c147564c3d18e25d", "url": "https://github.com/realm/realm-java/commit/8a422b90287edb18f0ae9ac6c147564c3d18e25d", "message": "Fix findbugs", "committedDate": "2020-02-07T15:18:47Z", "type": "commit"}, {"oid": "756a5244b1bc8ecebcd2eafdab89adaa80fcd5a4", "url": "https://github.com/realm/realm-java/commit/756a5244b1bc8ecebcd2eafdab89adaa80fcd5a4", "message": "Ignore crashing test", "committedDate": "2020-02-07T19:07:54Z", "type": "commit"}, {"oid": "cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "url": "https://github.com/realm/realm-java/commit/cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "message": "Fix more tests", "committedDate": "2020-02-21T19:30:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMDA3Nw==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385000077", "bodyText": "Why silencing FindBug? is this used from the generated class?", "author": "nhachicha", "createdAt": "2020-02-27T09:20:54Z", "path": "realm/realm-library/src/main/java/io/realm/internal/RealmObjectProxy.java", "diffHunk": "@@ -34,6 +35,7 @@\n      * Tuple class for saving meta data about a cached RealmObject.\n      */\n     class CacheData<E extends RealmModel> {\n+        @SuppressFBWarnings(\"URF_UNREAD_PUBLIC_OR_PROTECTED_FIELD\")\n         public int minDepth;", "originalCommit": "cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA0NTc2MQ==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385045761", "bodyText": "Yes, it is referenced by our proxy classes. Not entirely sure why it suddenly starts complaining.", "author": "cmelchior", "createdAt": "2020-02-27T10:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMDA3Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMTQxMw==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385001413", "bodyText": "Leftover for the FIXME?", "author": "nhachicha", "createdAt": "2020-02-27T09:23:25Z", "path": "realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java", "diffHunk": "@@ -652,7 +642,9 @@ public void stop_multipleTimes() {\n \n     @Test\n     @RunTestInLooperThread\n+    @Ignore(\"FIXME https://github.com/realm/realm-sync/issues/3234\")\n     public void waitForInitialRemoteData_throwsOnTimeout() {\n+        RealmLog.setLevel(LogLevel.DEBUG);", "originalCommit": "cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4014d3cf3e47853c3871c6115a87ab691ba0e63", "chunk": "diff --git a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\nindex c898e3e5e..859354da4 100644\n--- a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\n+++ b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\n\n@@ -642,9 +640,7 @@ public class SyncSessionTests extends StandardIntegrationTest {\n \n     @Test\n     @RunTestInLooperThread\n-    @Ignore(\"FIXME https://github.com/realm/realm-sync/issues/3234\")\n     public void waitForInitialRemoteData_throwsOnTimeout() {\n-        RealmLog.setLevel(LogLevel.DEBUG);\n         SyncUser user = UserFactory.createUniqueUser(Constants.AUTH_URL);\n         SyncConfiguration syncConfiguration = configFactory\n                 .createSyncConfigurationBuilder(user, Constants.SYNC_SERVER_URL)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMTg1Ng==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385001856", "bodyText": "The Java & Core issue related to this seems closed, do you want to enable this again?", "author": "nhachicha", "createdAt": "2020-02-27T09:24:11Z", "path": "realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java", "diffHunk": "@@ -652,7 +642,9 @@ public void stop_multipleTimes() {\n \n     @Test\n     @RunTestInLooperThread\n+    @Ignore(\"FIXME https://github.com/realm/realm-sync/issues/3234\")", "originalCommit": "cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyOTczMQ==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385029731", "bodyText": "Yup, reenabling.", "author": "cmelchior", "createdAt": "2020-02-27T10:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMTg1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f4014d3cf3e47853c3871c6115a87ab691ba0e63", "chunk": "diff --git a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\nindex c898e3e5e..859354da4 100644\n--- a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\n+++ b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncSessionTests.java\n\n@@ -642,9 +640,7 @@ public class SyncSessionTests extends StandardIntegrationTest {\n \n     @Test\n     @RunTestInLooperThread\n-    @Ignore(\"FIXME https://github.com/realm/realm-sync/issues/3234\")\n     public void waitForInitialRemoteData_throwsOnTimeout() {\n-        RealmLog.setLevel(LogLevel.DEBUG);\n         SyncUser user = UserFactory.createUniqueUser(Constants.AUTH_URL);\n         SyncConfiguration syncConfiguration = configFactory\n                 .createSyncConfigurationBuilder(user, Constants.SYNC_SERVER_URL)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMjg0OQ==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385002849", "bodyText": "Hmm. this is confusing RealmMigrationNeededException doesn't make sense in an additive Sync schema scenario...", "author": "nhachicha", "createdAt": "2020-02-27T09:26:00Z", "path": "realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncedRealmIntegrationTests.java", "diffHunk": "@@ -299,7 +293,7 @@ public void waitForInitialRemoteData_readOnlyTrue_throwsIfWrongServerSchema() {\n             // schema.\n             realm = Realm.getInstance(configNew);\n             fail();\n-        } catch (IllegalStateException ignored) {\n+        } catch (RealmMigrationNeededException ignored) {", "originalCommit": "cb1b8a82a44c8b9d9399786a7c4efb0b837097f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAyOTY1MQ==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385029651", "bodyText": "Good point. I'll fix it.", "author": "cmelchior", "createdAt": "2020-02-27T10:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMjg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTA3MjU2Nw==", "url": "https://github.com/realm/realm-java/pull/6758#discussion_r385072567", "bodyText": "There is something odd here. But changing the exception to IllegalState causes other errors. It looks like a difference between query-based and fully synchronized Realms (since this PR changes the default back to fully synchronized). I have created #6759 to track it.", "author": "cmelchior", "createdAt": "2020-02-27T11:37:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTAwMjg0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f4014d3cf3e47853c3871c6115a87ab691ba0e63", "chunk": "diff --git a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncedRealmIntegrationTests.java b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncedRealmIntegrationTests.java\nindex 06d352400..c0556246f 100644\n--- a/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncedRealmIntegrationTests.java\n+++ b/realm/realm-library/src/syncIntegrationTest/java/io/realm/SyncedRealmIntegrationTests.java\n\n@@ -293,7 +293,7 @@ public class SyncedRealmIntegrationTests extends StandardIntegrationTest {\n             // schema.\n             realm = Realm.getInstance(configNew);\n             fail();\n-        } catch (RealmMigrationNeededException ignored) {\n+        } catch (IllegalStateException ignore) {\n         } finally {\n             if (realm != null) {\n                 realm.close();\n"}}, {"oid": "f4014d3cf3e47853c3871c6115a87ab691ba0e63", "url": "https://github.com/realm/realm-java/commit/f4014d3cf3e47853c3871c6115a87ab691ba0e63", "message": "PR feedback", "committedDate": "2020-02-27T10:38:46Z", "type": "commit"}, {"oid": "ba23e1b8bbe204c77936658cad261fbc3baf1995", "url": "https://github.com/realm/realm-java/commit/ba23e1b8bbe204c77936658cad261fbc3baf1995", "message": "Revert exception being thrown", "committedDate": "2020-02-27T11:09:27Z", "type": "commit"}]}