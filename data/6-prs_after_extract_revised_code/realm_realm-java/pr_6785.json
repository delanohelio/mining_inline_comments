{"pr_number": 6785, "pr_title": "Add support for allUsers(), switchUser(), removeUser()", "pr_createdAt": "2020-03-25T14:29:55Z", "pr_url": "https://github.com/realm/realm-java/pull/6785", "timeline": [{"oid": "2ad949d35fe7b6e423bc1caf4379617e05a1e2c0", "url": "https://github.com/realm/realm-java/commit/2ad949d35fe7b6e423bc1caf4379617e05a1e2c0", "message": "Add support for allUsers, switchUser and removeUser", "committedDate": "2020-03-25T14:26:45Z", "type": "commit"}, {"oid": "45eb9c547db7452bce533cfdb50b63d05684017d", "url": "https://github.com/realm/realm-java/commit/45eb9c547db7452bce533cfdb50b63d05684017d", "message": "Fix FindBugs warning", "committedDate": "2020-03-25T16:11:12Z", "type": "commit"}, {"oid": "13e586a937633cc2f08c73c9ec9f6c73cf219099", "url": "https://github.com/realm/realm-java/commit/13e586a937633cc2f08c73c9ec9f6c73cf219099", "message": "Merge branch 'v10' into cm/app/allusers\n\n# Conflicts:\n#\trealm/realm-library/src/androidTestObjectServer/kotlin/io/realm/RealmAppTests.kt", "committedDate": "2020-03-30T05:48:21Z", "type": "commit"}, {"oid": "303ec7eda320f6796893426055dffd82f0fcb7c9", "url": "https://github.com/realm/realm-java/commit/303ec7eda320f6796893426055dffd82f0fcb7c9", "message": "Add missing tests", "committedDate": "2020-03-30T06:18:37Z", "type": "commit"}, {"oid": "4b7125d5fb5392a2644db591d2494f8e6814575e", "url": "https://github.com/realm/realm-java/commit/4b7125d5fb5392a2644db591d2494f8e6814575e", "message": "More test improvements", "committedDate": "2020-03-30T06:22:26Z", "type": "commit"}, {"oid": "7f06900f7e528c5956cfb19f39b66fa21231296d", "url": "https://github.com/realm/realm-java/commit/7f06900f7e528c5956cfb19f39b66fa21231296d", "message": "Fix test", "committedDate": "2020-03-30T07:30:24Z", "type": "commit"}, {"oid": "c4a0b8aa1690435313de40791cd8efe46525c8bd", "url": "https://github.com/realm/realm-java/commit/c4a0b8aa1690435313de40791cd8efe46525c8bd", "message": "Disable broken tests (for now)", "committedDate": "2020-03-31T06:12:15Z", "type": "commit"}, {"oid": "3d6d23a348996a01a39dbf1d9cfd8c0a4d90a5fe", "url": "https://github.com/realm/realm-java/commit/3d6d23a348996a01a39dbf1d9cfd8c0a4d90a5fe", "message": "Disable more tests", "committedDate": "2020-03-31T09:06:10Z", "type": "commit"}, {"oid": "cc81ff5736c7f5e3256fcb16ba914f5ed7d77e88", "url": "https://github.com/realm/realm-java/commit/cc81ff5736c7f5e3256fcb16ba914f5ed7d77e88", "message": "Ignore more tests", "committedDate": "2020-03-31T10:27:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5MzI1Nw==", "url": "https://github.com/realm/realm-java/pull/6785#discussion_r401293257", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * happen on the same thread as this this method is called on.\n          \n          \n            \n                 * happen on the same thread as this method is called on.", "author": "nhachicha", "createdAt": "2020-04-01T00:40:20Z", "path": "realm/realm-library/src/objectServer/java/io/realm/RealmApp.java", "diffHunk": "@@ -139,12 +142,58 @@ public RealmUser currentUser() {\n     }\n \n     /**\n-     * TODO: Manually set the user returned by {@link #currentUser()}\n+     * Switch current user. The current user is the user returned by {@link #currentUser()}.\n      *\n-     * @param user\n+     * @param user the new current user.\n+     * @throws IllegalArgumentException if the user is is not {@link RealmUser.State#LOGGED_IN}.\n      */\n-    public static void setCurrentUser(SyncUser user) {\n-        // FIXME\n+    public RealmUser switchUser(RealmUser user) {\n+        Util.checkNull(user, \"user\");\n+        nativeSwitchUser(nativePtr, user.osUser.getNativePtr());\n+        return user;\n+    }\n+\n+    /**\n+     * Removes a users credentials from this device. If the user was currently logged in, they\n+     * will be logged out as part of the process. This is only a local change and does not\n+     * affect the user state on the server.\n+     *\n+     * @param user user to remove.\n+     * @return user that was removed.\n+     * @throws ObjectServerError if called from the UI thread or if the user was logged in, but\n+     * could not be logged out.\n+     */\n+    public RealmUser removeUser(RealmUser user) throws ObjectServerError {\n+        Util.checkNull(user, \"user\");\n+        AtomicReference<RealmUser> success = new AtomicReference<>(null);\n+        AtomicReference<ObjectServerError> error = new AtomicReference<>(null);\n+        nativeRemoveUser(nativePtr, user.osUser.getNativePtr(), new OsJNIResultCallback<RealmUser>(success, error) {\n+            @Override\n+            protected void mapSuccess(Object result, AtomicReference<RealmUser> success) {\n+                success.set(user);\n+            }\n+        });\n+        return handleResult(success, error);\n+    }\n+\n+    /**\n+     * Removes a users credentials from this device. If the user was currently logged in, they\n+     * will be logged out as part of the process. This is only a local change and does not\n+     * affect the user state on the server.\n+     *\n+     * @param user user to remove.\n+     * @param callback callback when removing the user has completed or failed. The callback will always\n+     * happen on the same thread as this this method is called on.", "originalCommit": "cc81ff5736c7f5e3256fcb16ba914f5ed7d77e88", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "762626e6c0547359c31bb92614802a1f75ade2ad", "chunk": "diff --git a/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java b/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\nindex 0a4f29737..df524b6ef 100644\n--- a/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\n+++ b/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\n\n@@ -183,7 +183,7 @@ public class RealmApp {\n      *\n      * @param user user to remove.\n      * @param callback callback when removing the user has completed or failed. The callback will always\n-     * happen on the same thread as this this method is called on.\n+     * happen on the same thread as this method is called on.\n      * @throws IllegalStateException if called from a non-looper thread.\n      */\n     public RealmAsyncTask removeUserAsync(RealmUser user, Callback<RealmUser> callback) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5Mzc5OA==", "url": "https://github.com/realm/realm-java/pull/6785#discussion_r401293798", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * happen on the same thread as this this method is called on.\n          \n          \n            \n                 * happen on the same thread as this method is called on.", "author": "nhachicha", "createdAt": "2020-04-01T00:42:21Z", "path": "realm/realm-library/src/objectServer/java/io/realm/RealmApp.java", "diffHunk": "@@ -217,7 +270,13 @@ public void logOut() {\n      * <p>\n      * Once the Realm App has confirmed the logout any registered {@link AuthenticationListener}\n      * will be notified and user credentials will be deleted from this device.\n+     * <p>\n+     * Logging out anonymous users will remove them immediately instead of marking them as\n+     * {@link RealmUser.State#LOGGED_OUT}. All other users will be marked as {@link RealmUser.State#LOGGED_OUT}\n+     * and will still be returned by {@link #allUsers()}.\n      *\n+     * @param callback callback when logging out has completed or failed. The callback will always\n+     * happen on the same thread as this this method is called on.", "originalCommit": "cc81ff5736c7f5e3256fcb16ba914f5ed7d77e88", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "762626e6c0547359c31bb92614802a1f75ade2ad", "chunk": "diff --git a/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java b/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\nindex 0a4f29737..df524b6ef 100644\n--- a/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\n+++ b/realm/realm-library/src/objectServer/java/io/realm/RealmApp.java\n\n@@ -276,7 +276,7 @@ public class RealmApp {\n      * and will still be returned by {@link #allUsers()}.\n      *\n      * @param callback callback when logging out has completed or failed. The callback will always\n-     * happen on the same thread as this this method is called on.\n+     * happen on the same thread as this method is called on.\n      * @throws IllegalStateException if not called on a looper thread or no current user could be found.\n      */\n      public RealmAsyncTask logOutAsync(Callback<RealmUser> callback) {\n"}}, {"oid": "762626e6c0547359c31bb92614802a1f75ade2ad", "url": "https://github.com/realm/realm-java/commit/762626e6c0547359c31bb92614802a1f75ade2ad", "message": "Apply suggestions from code review\n\nCo-Authored-By: Nabil Hachicha <nh@realm.io>", "committedDate": "2020-04-01T06:46:27Z", "type": "commit"}]}