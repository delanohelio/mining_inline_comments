{"pr_number": 1595, "pr_title": "Update manual array to collections copy method.", "pr_createdAt": "2020-04-24T14:36:00Z", "pr_url": "https://github.com/apache/accumulo/pull/1595", "timeline": [{"oid": "cdda97aa0b8c0553c2986e13b42309ae950b570c", "url": "https://github.com/apache/accumulo/commit/cdda97aa0b8c0553c2986e13b42309ae950b570c", "message": "Update manual array to collections copy method.\n\nReplace instances of copying of array contents to a collection where\neach element is added individually using a for loop with a call to\nCollection.addAll().", "committedDate": "2020-04-24T14:22:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzNDY0OQ==", "url": "https://github.com/apache/accumulo/pull/1595#discussion_r414634649", "bodyText": "I'm not sure this keeps the same behaviour. The == will test if the passed arrays are the same reference.  Replacing with Arrays.equals is also going to check if the contents are the same.  This would make the rest of the test redundant - and from the code comments is trying to optimize the comparison.", "author": "EdColeman", "createdAt": "2020-04-24T14:48:07Z", "path": "core/src/main/java/org/apache/accumulo/core/data/Key.java", "diffHunk": "@@ -1159,7 +1159,7 @@ public int getSize() {\n   }\n \n   private static boolean isEqual(byte[] a1, byte[] a2) {\n-    if (a1 == a2)\n+    if (Arrays.equals(a1, a2))", "originalCommit": "cdda97aa0b8c0553c2986e13b42309ae950b570c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzNjA5OA==", "url": "https://github.com/apache/accumulo/pull/1595#discussion_r414636098", "bodyText": "Thanks for the catch Ed! I will revert that change. It didn't really go with the rest of the changes anyway.", "author": "jmark99", "createdAt": "2020-04-24T14:50:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYzNDY0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "54da03d2f1d3404634a155d474ca428588f002fe", "chunk": "diff --git a/core/src/main/java/org/apache/accumulo/core/data/Key.java b/core/src/main/java/org/apache/accumulo/core/data/Key.java\nindex 0f75fa07a8..6b21da67c8 100644\n--- a/core/src/main/java/org/apache/accumulo/core/data/Key.java\n+++ b/core/src/main/java/org/apache/accumulo/core/data/Key.java\n\n@@ -1159,7 +1159,7 @@ public class Key implements WritableComparable<Key>, Cloneable {\n   }\n \n   private static boolean isEqual(byte[] a1, byte[] a2) {\n-    if (Arrays.equals(a1, a2))\n+    if (a1 == a2)\n       return true;\n \n     int last = a1.length;\n"}}, {"oid": "54da03d2f1d3404634a155d474ca428588f002fe", "url": "https://github.com/apache/accumulo/commit/54da03d2f1d3404634a155d474ca428588f002fe", "message": "Update manual array to colletions copy method.\n\nReverted an array equality check back to its original form.", "committedDate": "2020-04-24T14:50:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1ODE3NQ==", "url": "https://github.com/apache/accumulo/pull/1595#discussion_r414758175", "bodyText": "This is a handy method, I didn't know it existed.", "author": "keith-turner", "createdAt": "2020-04-24T17:54:08Z", "path": "core/src/main/java/org/apache/accumulo/core/clientImpl/mapreduce/lib/InputConfigurator.java", "diffHunk": "@@ -360,9 +361,7 @@ public static void fetchColumns(Class<?> implementingClass, Configuration conf,\n     List<String> serialized = new ArrayList<>();\n     if (confValue != null) {\n       // Split and include any trailing empty strings to allow empty column families\n-      for (String val : confValue.split(\",\", -1)) {\n-        serialized.add(val);\n-      }\n+      Collections.addAll(serialized, confValue.split(\",\", -1));", "originalCommit": "54da03d2f1d3404634a155d474ca428588f002fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}