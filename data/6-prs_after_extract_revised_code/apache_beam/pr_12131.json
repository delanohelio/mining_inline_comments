{"pr_number": 12131, "pr_title": "[BEAM-10335] Add STS assume role to AwsModule", "pr_createdAt": "2020-06-30T05:58:00Z", "pr_url": "https://github.com/apache/beam/pull/12131", "timeline": [{"oid": "f52c7de94af8dcbbe115277c51c6c824e1b72a80", "url": "https://github.com/apache/beam/commit/f52c7de94af8dcbbe115277c51c6c824e1b72a80", "message": "BEAM-10335 add STS assume role to AwsModule", "committedDate": "2020-06-30T05:49:18Z", "type": "commit"}, {"oid": "3ceac0c0a1091f7f093a39dc464cfa5d64e9c2ed", "url": "https://github.com/apache/beam/commit/3ceac0c0a1091f7f093a39dc464cfa5d64e9c2ed", "message": "BEAM-10335 add STS assume role to AwsModule", "committedDate": "2020-06-30T05:56:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc2MTQxNg==", "url": "https://github.com/apache/beam/pull/12131#discussion_r447761416", "bodyText": "Why do we need to use a Wrapper instead of just using STSAssumeRoleSessionCredentialsProvider?", "author": "aromanenko-dev", "createdAt": "2020-06-30T15:11:30Z", "path": "sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/STSCredentialsProviderWrapper.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.aws.sts;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.auth.AWSCredentialsProvider;\n+import com.amazonaws.auth.STSAssumeRoleSessionCredentialsProvider;\n+import com.amazonaws.regions.Regions;\n+import com.amazonaws.services.securitytoken.AWSSecurityTokenService;\n+import com.amazonaws.services.securitytoken.AWSSecurityTokenServiceClientBuilder;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+\n+/*\n+ *\n+ * {@link AWSCredentialsProvider} that loads credentials using Assume Role\n+ *\n+ */\n+\n+public class STSCredentialsProviderWrapper implements AWSCredentialsProvider {", "originalCommit": "3ceac0c0a1091f7f093a39dc464cfa5d64e9c2ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dba93f9e794e6e53d3339b08b0c3b8eacf7d53ba", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/STSCredentialsProviderWrapper.java b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/STSCredentialsProviderWrapper.java\ndeleted file mode 100644\nindex d48817db50..0000000000\n--- a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/STSCredentialsProviderWrapper.java\n+++ /dev/null\n\n@@ -1,71 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-package org.apache.beam.sdk.io.aws.sts;\n-\n-import com.amazonaws.auth.AWSCredentials;\n-import com.amazonaws.auth.AWSCredentialsProvider;\n-import com.amazonaws.auth.STSAssumeRoleSessionCredentialsProvider;\n-import com.amazonaws.regions.Regions;\n-import com.amazonaws.services.securitytoken.AWSSecurityTokenService;\n-import com.amazonaws.services.securitytoken.AWSSecurityTokenServiceClientBuilder;\n-import org.apache.commons.logging.Log;\n-import org.apache.commons.logging.LogFactory;\n-\n-/*\n- *\n- * {@link AWSCredentialsProvider} that loads credentials using Assume Role\n- *\n- */\n-\n-public class STSCredentialsProviderWrapper implements AWSCredentialsProvider {\n-\n-  private static final Log LOG = LogFactory.getLog(STSCredentialsProviderWrapper.class);\n-  public static final int DEFAULT_DURATION_SECONDS = 3600;\n-  public final String roleArn;\n-  public final String roleSessionName;\n-  public final String region;\n-  private final Regions rgn;\n-  private final AWSCredentialsProvider provider;\n-\n-  public STSCredentialsProviderWrapper(String roleArn, String region, String roleSessionName) {\n-    this.roleArn = roleArn;\n-    this.region = region;\n-    this.roleSessionName = roleSessionName;\n-    rgn = region == null ? Regions.DEFAULT_REGION : Regions.fromName(region);\n-    provider = initializeProvider();\n-  }\n-\n-  private AWSCredentialsProvider initializeProvider() {\n-    AWSSecurityTokenService stsClient =\n-        AWSSecurityTokenServiceClientBuilder.standard().withRegion(rgn).build();\n-    return new STSAssumeRoleSessionCredentialsProvider.Builder(roleArn, roleSessionName)\n-        .withStsClient(stsClient)\n-        .withRoleSessionDurationSeconds(DEFAULT_DURATION_SECONDS)\n-        .build();\n-  }\n-\n-  @Override\n-  public AWSCredentials getCredentials() {\n-    return provider.getCredentials();\n-  }\n-\n-  @Override\n-  public void refresh() {\n-    provider.refresh();\n-  }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzc2NTIzMQ==", "url": "https://github.com/apache/beam/pull/12131#discussion_r447765231", "bodyText": "I'm not sure that it's needed to create a separate package for STS. Can we put STSCredentialsProviderWrapper  into options?", "author": "aromanenko-dev", "createdAt": "2020-06-30T15:16:40Z", "path": "sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/package-info.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+/** Defines IO connectors for Amazon Web Services SQS. */\n+@Experimental(Kind.SOURCE_SINK)\n+package org.apache.beam.sdk.io.aws.sts;", "originalCommit": "3ceac0c0a1091f7f093a39dc464cfa5d64e9c2ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dba93f9e794e6e53d3339b08b0c3b8eacf7d53ba", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/package-info.java b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/package-info.java\ndeleted file mode 100644\nindex ddccc54fcd..0000000000\n--- a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/sts/package-info.java\n+++ /dev/null\n\n@@ -1,23 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one\n- * or more contributor license agreements.  See the NOTICE file\n- * distributed with this work for additional information\n- * regarding copyright ownership.  The ASF licenses this file\n- * to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance\n- * with the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-/** Defines IO connectors for Amazon Web Services SQS. */\n-@Experimental(Kind.SOURCE_SINK)\n-package org.apache.beam.sdk.io.aws.sts;\n-\n-import org.apache.beam.sdk.annotations.Experimental;\n-import org.apache.beam.sdk.annotations.Experimental.Kind;\n"}}, {"oid": "dba93f9e794e6e53d3339b08b0c3b8eacf7d53ba", "url": "https://github.com/apache/beam/commit/dba93f9e794e6e53d3339b08b0c3b8eacf7d53ba", "message": "[BEAM-10335] update with unit test", "committedDate": "2020-06-30T21:57:00Z", "type": "commit"}, {"oid": "134be881d0731abb7b0a192dc1c6d8df0cce2b6a", "url": "https://github.com/apache/beam/commit/134be881d0731abb7b0a192dc1c6d8df0cce2b6a", "message": "[BEAM-10335] update with gradle build", "committedDate": "2020-07-01T10:44:34Z", "type": "commit"}, {"oid": "f78d77072b730e43bffbb28f745199a3ba7e0917", "url": "https://github.com/apache/beam/commit/f78d77072b730e43bffbb28f745199a3ba7e0917", "message": "[BEAM-10335] apply spotless", "committedDate": "2020-07-01T16:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NzcyOA==", "url": "https://github.com/apache/beam/pull/12131#discussion_r448477728", "bodyText": "Please, add Serialization/Deserialization asserts as we do for other provider tests.", "author": "aromanenko-dev", "createdAt": "2020-07-01T16:23:34Z", "path": "sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java", "diffHunk": "@@ -117,6 +119,17 @@ public void testClasspathPropertiesFileCredentialsProviderSerializationDeseriali\n     assertEquals(credentialsFilePath, deserializedCredentialsFilePath);\n   }\n \n+  @Test\n+  public void testSTSCredentialsProviderWrapperSerializationDeserialization() throws Exception {\n+    String roleArn = \"arn:aws:iam::000111222333:role/TestRole\";\n+    String roleSessionName = \"roleSessionName\";\n+    STSAssumeRoleSessionCredentialsProvider credentialsProvider =\n+        AssumeRoleSessionCredentialsProvider.getInstance(roleArn, roleSessionName)\n+            .getSessionCredentialsProvider();\n+\n+    assertNotNull(credentialsProvider);", "originalCommit": "f78d77072b730e43bffbb28f745199a3ba7e0917", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bb4840dba2e75d745b96079b08c74911166e6934", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\nindex 4b84f4f07f..926ee6c9ab 100644\n--- a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n+++ b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n\n@@ -124,10 +123,22 @@ public class AwsModuleTest {\n     String roleArn = \"arn:aws:iam::000111222333:role/TestRole\";\n     String roleSessionName = \"roleSessionName\";\n     STSAssumeRoleSessionCredentialsProvider credentialsProvider =\n-        AssumeRoleSessionCredentialsProvider.getInstance(roleArn, roleSessionName)\n-            .getSessionCredentialsProvider();\n+        new STSAssumeRoleSessionCredentialsProvider.Builder(roleArn, roleSessionName).build();\n+    String serializedCredentialsProvider = objectMapper.writeValueAsString(credentialsProvider);\n+    AWSCredentialsProvider deserializedCredentialsProvider =\n+        objectMapper.readValue(serializedCredentialsProvider, AWSCredentialsProvider.class);\n \n-    assertNotNull(credentialsProvider);\n+    assertEquals(credentialsProvider.getClass(), deserializedCredentialsProvider.getClass());\n+    Field fieldRole = STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleArn\");\n+    fieldRole.setAccessible(true);\n+    String deserializedRoleArn = (String) fieldRole.get(deserializedCredentialsProvider);\n+    assertEquals(roleArn, deserializedRoleArn);\n+\n+    Field fieldSession =\n+        STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleSessionName\");\n+    fieldSession.setAccessible(true);\n+    String deserializedRoleSessionName = (String) fieldSession.get(deserializedCredentialsProvider);\n+    assertEquals(roleSessionName, deserializedRoleSessionName);\n   }\n \n   @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4MjAwMg==", "url": "https://github.com/apache/beam/pull/12131#discussion_r448482002", "bodyText": "Can we just return new STSAssumeRoleSessionCredentialsProvider.Builder(asMap.get(ROLE_ARN), asMap.get(ROLE_SESSION_NAME)).build() here? Why do we need to create AssumeRoleSessionCredentialsProvider class?", "author": "aromanenko-dev", "createdAt": "2020-07-01T16:30:49Z", "path": "sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java", "diffHunk": "@@ -132,6 +135,10 @@ public AWSCredentialsProvider deserializeWithType(\n         return new ProfileCredentialsProvider();\n       } else if (typeName.equals(EC2ContainerCredentialsProviderWrapper.class.getSimpleName())) {\n         return new EC2ContainerCredentialsProviderWrapper();\n+      } else if (typeName.equals(STSAssumeRoleSessionCredentialsProvider.class.getSimpleName())) {\n+        return AssumeRoleSessionCredentialsProvider.getInstance(", "originalCommit": "f78d77072b730e43bffbb28f745199a3ba7e0917", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bb4840dba2e75d745b96079b08c74911166e6934", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\nindex 3734a99f6b..6246346792 100644\n--- a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n+++ b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n\n@@ -136,9 +136,9 @@ public class AwsModule extends SimpleModule {\n       } else if (typeName.equals(EC2ContainerCredentialsProviderWrapper.class.getSimpleName())) {\n         return new EC2ContainerCredentialsProviderWrapper();\n       } else if (typeName.equals(STSAssumeRoleSessionCredentialsProvider.class.getSimpleName())) {\n-        return AssumeRoleSessionCredentialsProvider.getInstance(\n+        return new STSAssumeRoleSessionCredentialsProvider.Builder(\n                 asMap.get(ROLE_ARN), asMap.get(ROLE_SESSION_NAME))\n-            .getSessionCredentialsProvider();\n+            .build();\n       } else {\n         throw new IOException(\n             String.format(\"AWS credential provider type '%s' is not supported\", typeName));\n"}}, {"oid": "bb4840dba2e75d745b96079b08c74911166e6934", "url": "https://github.com/apache/beam/commit/bb4840dba2e75d745b96079b08c74911166e6934", "message": "[BEAM-10335] update on test", "committedDate": "2020-07-01T18:59:31Z", "type": "commit"}, {"oid": "10e038585729a8973229ad6d5778fc283934f271", "url": "https://github.com/apache/beam/commit/10e038585729a8973229ad6d5778fc283934f271", "message": "[BEAM-10335] remove unused files", "committedDate": "2020-07-01T21:46:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExNDc3Nw==", "url": "https://github.com/apache/beam/pull/12131#discussion_r449114777", "bodyText": "Use ROLE_ARN constant here.", "author": "aromanenko-dev", "createdAt": "2020-07-02T15:55:10Z", "path": "sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java", "diffHunk": "@@ -203,7 +211,27 @@ public void serializeWithType(\n         } catch (NoSuchFieldException | IllegalAccessException e) {\n           throw new IOException(\"failed to access private field with reflection\", e);\n         }\n+      } else if (credentialsProvider\n+          .getClass()\n+          .equals(STSAssumeRoleSessionCredentialsProvider.class)) {\n+        try {\n+          STSAssumeRoleSessionCredentialsProvider specificProvider =\n+              (STSAssumeRoleSessionCredentialsProvider) credentialsProvider;\n+\n+          Field fieldRole =\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleArn\");", "originalCommit": "10e038585729a8973229ad6d5778fc283934f271", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0c752def04fa45f45babac2c0e093e4d8332ab90", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\nindex 6246346792..2416d306eb 100644\n--- a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n+++ b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n\n@@ -219,13 +219,13 @@ public class AwsModule extends SimpleModule {\n               (STSAssumeRoleSessionCredentialsProvider) credentialsProvider;\n \n           Field fieldRole =\n-              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleArn\");\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(ROLE_ARN);\n           fieldRole.setAccessible(true);\n           String roleArn = (String) fieldRole.get(specificProvider);\n           jsonGenerator.writeStringField(ROLE_ARN, roleArn);\n \n           Field fieldSession =\n-              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleSessionName\");\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(ROLE_SESSION_NAME);\n           fieldSession.setAccessible(true);\n           String roleSessionName = (String) fieldSession.get(specificProvider);\n           jsonGenerator.writeStringField(ROLE_SESSION_NAME, roleSessionName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExNTAzMA==", "url": "https://github.com/apache/beam/pull/12131#discussion_r449115030", "bodyText": "Use ROLE_SESSION_NAME constant here.", "author": "aromanenko-dev", "createdAt": "2020-07-02T15:55:33Z", "path": "sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java", "diffHunk": "@@ -203,7 +211,27 @@ public void serializeWithType(\n         } catch (NoSuchFieldException | IllegalAccessException e) {\n           throw new IOException(\"failed to access private field with reflection\", e);\n         }\n+      } else if (credentialsProvider\n+          .getClass()\n+          .equals(STSAssumeRoleSessionCredentialsProvider.class)) {\n+        try {\n+          STSAssumeRoleSessionCredentialsProvider specificProvider =\n+              (STSAssumeRoleSessionCredentialsProvider) credentialsProvider;\n+\n+          Field fieldRole =\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleArn\");\n+          fieldRole.setAccessible(true);\n+          String roleArn = (String) fieldRole.get(specificProvider);\n+          jsonGenerator.writeStringField(ROLE_ARN, roleArn);\n \n+          Field fieldSession =\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleSessionName\");", "originalCommit": "10e038585729a8973229ad6d5778fc283934f271", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0c752def04fa45f45babac2c0e093e4d8332ab90", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\nindex 6246346792..2416d306eb 100644\n--- a/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n+++ b/sdks/java/io/amazon-web-services/src/main/java/org/apache/beam/sdk/io/aws/options/AwsModule.java\n\n@@ -219,13 +219,13 @@ public class AwsModule extends SimpleModule {\n               (STSAssumeRoleSessionCredentialsProvider) credentialsProvider;\n \n           Field fieldRole =\n-              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleArn\");\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(ROLE_ARN);\n           fieldRole.setAccessible(true);\n           String roleArn = (String) fieldRole.get(specificProvider);\n           jsonGenerator.writeStringField(ROLE_ARN, roleArn);\n \n           Field fieldSession =\n-              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(\"roleSessionName\");\n+              STSAssumeRoleSessionCredentialsProvider.class.getDeclaredField(ROLE_SESSION_NAME);\n           fieldSession.setAccessible(true);\n           String roleSessionName = (String) fieldSession.get(specificProvider);\n           jsonGenerator.writeStringField(ROLE_SESSION_NAME, roleSessionName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTExODE0Nw==", "url": "https://github.com/apache/beam/pull/12131#discussion_r449118147", "bodyText": "nit: word Wrapper is unnecessary in the test name.", "author": "aromanenko-dev", "createdAt": "2020-07-02T16:00:10Z", "path": "sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java", "diffHunk": "@@ -117,6 +118,29 @@ public void testClasspathPropertiesFileCredentialsProviderSerializationDeseriali\n     assertEquals(credentialsFilePath, deserializedCredentialsFilePath);\n   }\n \n+  @Test\n+  public void testSTSCredentialsProviderWrapperSerializationDeserialization() throws Exception {", "originalCommit": "10e038585729a8973229ad6d5778fc283934f271", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0c752def04fa45f45babac2c0e093e4d8332ab90", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\nindex 926ee6c9ab..b069f1eee1 100644\n--- a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n+++ b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n\n@@ -119,7 +119,8 @@ public class AwsModuleTest {\n   }\n \n   @Test\n-  public void testSTSCredentialsProviderWrapperSerializationDeserialization() throws Exception {\n+  public void testSTSAssumeRoleSessionCredentialsProviderSerializationDeserialization()\n+      throws Exception {\n     String roleArn = \"arn:aws:iam::000111222333:role/TestRole\";\n     String roleSessionName = \"roleSessionName\";\n     STSAssumeRoleSessionCredentialsProvider credentialsProvider =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTEzMDczMQ==", "url": "https://github.com/apache/beam/pull/12131#discussion_r449130731", "bodyText": "Please, leave org.junit.Assert.assertThat as it was before.", "author": "aromanenko-dev", "createdAt": "2020-07-02T16:20:51Z", "path": "sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java", "diffHunk": "@@ -17,9 +17,9 @@\n  */\n package org.apache.beam.sdk.io.aws.options;\n \n+import static org.hamcrest.MatcherAssert.assertThat;", "originalCommit": "10e038585729a8973229ad6d5778fc283934f271", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0c752def04fa45f45babac2c0e093e4d8332ab90", "chunk": "diff --git a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\nindex 926ee6c9ab..b069f1eee1 100644\n--- a/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n+++ b/sdks/java/io/amazon-web-services/src/test/java/org/apache/beam/sdk/io/aws/options/AwsModuleTest.java\n\n@@ -17,9 +17,9 @@\n  */\n package org.apache.beam.sdk.io.aws.options;\n \n-import static org.hamcrest.MatcherAssert.assertThat;\n import static org.hamcrest.Matchers.hasItem;\n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertThat;\n \n import com.amazonaws.ClientConfiguration;\n import com.amazonaws.auth.AWSCredentialsProvider;\n"}}, {"oid": "0c752def04fa45f45babac2c0e093e4d8332ab90", "url": "https://github.com/apache/beam/commit/0c752def04fa45f45babac2c0e093e4d8332ab90", "message": "[BEAM-10335] update as per review", "committedDate": "2020-07-02T16:30:56Z", "type": "commit"}]}