{"pr_number": 11933, "pr_title": "[BEAM-10204] @Ignore: re-enable LIKE operator related unit tests.", "pr_createdAt": "2020-06-05T17:23:31Z", "pr_url": "https://github.com/apache/beam/pull/11933", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3MTM1NQ==", "url": "https://github.com/apache/beam/pull/11933#discussion_r436071355", "bodyText": "This test name doesn't seem correct after these changes. What is it testing now? What about the previous assertions on throwing an exception for invalid utf8?", "author": "tysonjh", "createdAt": "2020-06-05T17:47:18Z", "path": "sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java", "diffHunk": "@@ -837,7 +834,6 @@ public void testLikeAllowsEscapingBackslash() {\n   }\n \n   @Test\n-  @Ignore(\"Currently non UTF-8 values are coerced to UTF-8\")\n   public void testThrowsErrorForNonUTF8() {", "originalCommit": "969ad26a785f8cad740e768fa3adf721b4a5eff4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA5NDE2NQ==", "url": "https://github.com/apache/beam/pull/11933#discussion_r436094165", "bodyText": "This is a good point. I will choose to remove this test.\nI tried to dig into ZetaSQL's documentation and internal tests suite, there was no clear explanation how to deal with nonUTF8 chars by LIKE operator (there are code-generated nonUTF8 test cases, but they don't have clear comments to demonstrate their purpose). So I will leave this part to be tested by internal test suite.", "author": "amaliujia", "createdAt": "2020-06-05T18:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3MTM1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEwMTk1Mg==", "url": "https://github.com/apache/beam/pull/11933#discussion_r436101952", "bodyText": "PR updated.", "author": "amaliujia", "createdAt": "2020-06-05T18:44:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA3MTM1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d11c34d0aaede321c2ede7f5961e40d59be9eb9b", "chunk": "diff --git a/sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java b/sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java\nindex 51c95b2ea5..8ccc1a4d74 100644\n--- a/sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java\n+++ b/sdks/java/extensions/sql/zetasql/src/test/java/org/apache/beam/sdk/extensions/sql/zetasql/ZetaSQLDialectSpecTest.java\n\n@@ -833,27 +833,6 @@ public class ZetaSQLDialectSpecTest {\n     pipeline.run().waitUntilFinish(Duration.standardMinutes(PIPELINE_EXECUTION_WAITTIME_MINUTES));\n   }\n \n-  @Test\n-  public void testThrowsErrorForNonUTF8() {\n-    String sql = \"SELECT @p0 LIKE  @p1 AS ColA\";\n-    byte[] bytes = {(byte) 0xe8, (byte) 0xb0};\n-    Value bad =\n-        Value.deserialize(\n-            TypeFactory.createSimpleType(TypeKind.TYPE_STRING),\n-            ValueProto.newBuilder().setStringValueBytes(ByteString.copyFrom(bytes)).build());\n-    ImmutableMap<String, Value> params =\n-        ImmutableMap.of(\"p0\", Value.createStringValue(\"abc\"), \"p1\", bad);\n-\n-    ZetaSQLQueryPlanner zetaSQLQueryPlanner = new ZetaSQLQueryPlanner(config);\n-    BeamRelNode beamRelNode = zetaSQLQueryPlanner.convertToBeamRel(sql, params);\n-    PCollection<Row> stream = BeamSqlRelUtils.toPCollection(pipeline, beamRelNode);\n-\n-    final Schema schema = Schema.builder().addNullableField(\"field1\", FieldType.BOOLEAN).build();\n-\n-    PAssert.that(stream).containsInAnyOrder(Row.withSchema(schema).addValues(false).build());\n-    pipeline.run().waitUntilFinish(Duration.standardMinutes(PIPELINE_EXECUTION_WAITTIME_MINUTES));\n-  }\n-\n   @Test\n   @Ignore(\"Does not support BYTES for like\")\n   public void testLikeBytes() {\n"}}, {"oid": "d11c34d0aaede321c2ede7f5961e40d59be9eb9b", "url": "https://github.com/apache/beam/commit/d11c34d0aaede321c2ede7f5961e40d59be9eb9b", "message": "[BEAM-10204] @Ignore: re-enable LIKE operator related unit tests.", "committedDate": "2020-06-05T18:38:07Z", "type": "commit"}, {"oid": "d11c34d0aaede321c2ede7f5961e40d59be9eb9b", "url": "https://github.com/apache/beam/commit/d11c34d0aaede321c2ede7f5961e40d59be9eb9b", "message": "[BEAM-10204] @Ignore: re-enable LIKE operator related unit tests.", "committedDate": "2020-06-05T18:38:07Z", "type": "forcePushed"}, {"oid": "1abc3f256c171edd8bb97a81e0ad01147a4fde17", "url": "https://github.com/apache/beam/commit/1abc3f256c171edd8bb97a81e0ad01147a4fde17", "message": "fixup! remove unused import.", "committedDate": "2020-06-05T20:36:45Z", "type": "commit"}]}