{"pr_number": 12505, "pr_title": "[BEAM-8106] Add version to java container image name", "pr_createdAt": "2020-08-07T23:00:33Z", "pr_url": "https://github.com/apache/beam/pull/12505", "timeline": [{"oid": "35ac254cda952071aa2becf06591cd4469aea0ba", "url": "https://github.com/apache/beam/commit/35ac254cda952071aa2becf06591cd4469aea0ba", "message": "use javaVersion argument to version Java container image", "committedDate": "2020-08-07T22:57:28Z", "type": "forcePushed"}, {"oid": "2c28eff493ab8d624ab1836ae84545dceb3dcd10", "url": "https://github.com/apache/beam/commit/2c28eff493ab8d624ab1836ae84545dceb3dcd10", "message": "rename java -> java8 in publish script", "committedDate": "2020-08-07T22:57:28Z", "type": "forcePushed"}, {"oid": "1c46a53229ff774529bca26598327a4e9ca51e50", "url": "https://github.com/apache/beam/commit/1c46a53229ff774529bca26598327a4e9ca51e50", "message": "rename java -> java8 in publish script", "committedDate": "2020-09-01T06:40:24Z", "type": "forcePushed"}, {"oid": "6595512941db96bb32024c96c1a88f5fc40ffe5f", "url": "https://github.com/apache/beam/commit/6595512941db96bb32024c96c1a88f5fc40ffe5f", "message": "use imageJavaVersion argument to Java Dockerfile and images", "committedDate": "2020-09-14T00:37:15Z", "type": "forcePushed"}, {"oid": "46f5df487e9759e5e38ad5ce14250f1084f00460", "url": "https://github.com/apache/beam/commit/46f5df487e9759e5e38ad5ce14250f1084f00460", "message": "add java_version arg for building Java harness container", "committedDate": "2020-09-14T01:43:28Z", "type": "forcePushed"}, {"oid": "48c1242ff51d11d68e2d070b19d6e112de96c554", "url": "https://github.com/apache/beam/commit/48c1242ff51d11d68e2d070b19d6e112de96c554", "message": "docs changes", "committedDate": "2020-09-14T22:41:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5ODkyNQ==", "url": "https://github.com/apache/beam/pull/12505#discussion_r488798925", "bodyText": "nit: could you make this an exact check for 8 and 11 and throw an exception for other (unsupported) versions", "author": "TheNeuralBit", "createdAt": "2020-09-15T16:23:47Z", "path": "runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java", "diffHunk": "@@ -357,4 +354,14 @@ private static File zipDirectory(File directory) throws IOException {\n       return env;\n     }\n   }\n+\n+  private static String getDefaultJavaSdkHarnessContainerUrl() {\n+    String javaVersionId =\n+        Float.parseFloat(System.getProperty(\"java.specification.version\")) >= 9 ? \"java11\" : \"java8\";", "originalCommit": "ba2a1fabec8ce7e0b09240e6f92df3ba4664f313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA5Mjc0MA==", "url": "https://github.com/apache/beam/pull/12505#discussion_r489092740", "bodyText": "I went ahead and added an Enum to Environments, and removed similar checks in DataflowRunner", "author": "emilymye", "createdAt": "2020-09-16T00:33:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc5ODkyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "00fb54357856ea443eebd691102190189f07b43f", "chunk": "diff --git a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java\nindex 2aaeadc28f..cfaacb5612 100644\n--- a/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java\n+++ b/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java\n\n@@ -356,12 +392,11 @@ public class Environments {\n   }\n \n   private static String getDefaultJavaSdkHarnessContainerUrl() {\n-    String javaVersionId =\n-        Float.parseFloat(System.getProperty(\"java.specification.version\")) >= 9 ? \"java11\" : \"java8\";\n-    return String.format(\"%s/%s_%s_sdk:%s\",\n+    return String.format(\n+        \"%s/%s_%s_sdk:%s\",\n         ReleaseInfo.getReleaseInfo().getDefaultDockerRepoRoot(),\n         ReleaseInfo.getReleaseInfo().getDefaultDockerRepoPrefix(),\n-        javaVersionId,\n+        getJavaSpecification().toString(),\n         ReleaseInfo.getReleaseInfo().getSdkVersion());\n   }\n }\n"}}, {"oid": "00fb54357856ea443eebd691102190189f07b43f", "url": "https://github.com/apache/beam/commit/00fb54357856ea443eebd691102190189f07b43f", "message": "add JavaVersion to Environments", "committedDate": "2020-09-16T00:32:25Z", "type": "forcePushed"}, {"oid": "61e90dfaf3d026db671cae9920c9a7469aeb6a48", "url": "https://github.com/apache/beam/commit/61e90dfaf3d026db671cae9920c9a7469aeb6a48", "message": "remove underscore", "committedDate": "2020-09-16T23:47:03Z", "type": "forcePushed"}, {"oid": "e4ed684d027abe333f20eae70f00b54a9c11ad0a", "url": "https://github.com/apache/beam/commit/e4ed684d027abe333f20eae70f00b54a9c11ad0a", "message": "remove underscore", "committedDate": "2020-09-17T06:26:36Z", "type": "forcePushed"}, {"oid": "023cb28bde318aba4cf9653b8ff833c18585612c", "url": "https://github.com/apache/beam/commit/023cb28bde318aba4cf9653b8ff833c18585612c", "message": "remove underscore", "committedDate": "2020-09-18T23:51:42Z", "type": "forcePushed"}, {"oid": "9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "url": "https://github.com/apache/beam/commit/9fa6ca542aa2b042babbbe522c4314011ad4c6d8", "message": "add java_version arg for building Java harness container", "committedDate": "2020-09-24T23:11:43Z", "type": "commit"}, {"oid": "59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "url": "https://github.com/apache/beam/commit/59bae74531a378f9e6a98ccfa0671795b3e1f3e7", "message": "change default java container name to java8", "committedDate": "2020-09-24T23:14:24Z", "type": "commit"}, {"oid": "205e56a5aed27b32899cf695c19cdbd0dc009fb3", "url": "https://github.com/apache/beam/commit/205e56a5aed27b32899cf695c19cdbd0dc009fb3", "message": "docs changes", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "url": "https://github.com/apache/beam/commit/49d4b6c4ff6305312e0f08d215ebe8f100d87bfb", "message": "delete Java11 Dockerfile", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "de808a11434510ecfaa63aa3f22d71cf676bae58", "url": "https://github.com/apache/beam/commit/de808a11434510ecfaa63aa3f22d71cf676bae58", "message": "fix typo", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "url": "https://github.com/apache/beam/commit/f2a0f08951b9520cb50a32f3eb62ca6ccb399dbd", "message": "add JavaVersion to Environments", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "url": "https://github.com/apache/beam/commit/4ec7a3cef306c6cfdac48ff603287c0a144c8d68", "message": "fix more references in documentation to beam_java_sdk", "committedDate": "2020-09-24T23:14:31Z", "type": "commit"}, {"oid": "69221f6bff47621c4a650944a2623bbd74c09c9c", "url": "https://github.com/apache/beam/commit/69221f6bff47621c4a650944a2623bbd74c09c9c", "message": "fix names of functions", "committedDate": "2020-09-24T23:14:32Z", "type": "commit"}, {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "message": "remove underscore", "committedDate": "2020-09-24T23:14:32Z", "type": "commit"}, {"oid": "d0ec608e846f519a4cbb607e89840381096fafbe", "url": "https://github.com/apache/beam/commit/d0ec608e846f519a4cbb607e89840381096fafbe", "message": "remove underscore", "committedDate": "2020-09-24T23:14:32Z", "type": "forcePushed"}]}