{"pr_number": 12830, "pr_title": "[BEAM-10716] TestPubsub/TestPubsubSignal clean up subscriptions", "pr_createdAt": "2020-09-11T21:44:23Z", "pr_url": "https://github.com/apache/beam/pull/12830", "timeline": [{"oid": "9c7ff88a703f184b8b3fb8588516548c57967871", "url": "https://github.com/apache/beam/commit/9c7ff88a703f184b8b3fb8588516548c57967871", "message": "TestPubsub deletes subscriptions created in the same project", "committedDate": "2020-09-11T21:43:41Z", "type": "commit"}, {"oid": "9c7ff88a703f184b8b3fb8588516548c57967871", "url": "https://github.com/apache/beam/commit/9c7ff88a703f184b8b3fb8588516548c57967871", "message": "TestPubsub deletes subscriptions created in the same project", "committedDate": "2020-09-11T21:43:41Z", "type": "forcePushed"}, {"oid": "665cc2677a0bac4f4823f6053dd9be94c91b13a9", "url": "https://github.com/apache/beam/commit/665cc2677a0bac4f4823f6053dd9be94c91b13a9", "message": "clean up TestPubsubSignal subscriptions", "committedDate": "2020-09-11T22:51:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMwMDA0OA==", "url": "https://github.com/apache/beam/pull/12830#discussion_r492300048", "bodyText": "nit: Will LOG.error make it easier to be discovered?", "author": "amaliujia", "createdAt": "2020-09-21T19:36:06Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsubSignal.java", "diffHunk": "@@ -239,6 +245,12 @@ public void waitForSuccess(Duration duration) throws IOException {\n \n     String result = pollForResultForDuration(resultSubscriptionPath, duration);\n \n+    try {\n+      pubsub.deleteSubscription(resultSubscriptionPath);\n+    } catch (IOException e) {\n+      LOG.warn(String.format(\"Leaked PubSub subscription '%s'\", resultSubscriptionPath));", "originalCommit": "665cc2677a0bac4f4823f6053dd9be94c91b13a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMzOTA4MQ==", "url": "https://github.com/apache/beam/pull/12830#discussion_r492339081", "bodyText": "Good idea, done", "author": "TheNeuralBit", "createdAt": "2020-09-21T20:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMwMDA0OA=="}], "type": "inlineReview", "revised_code": {"commit": "db7caf4d4b5900da5a8bd279755369bd79539486", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsubSignal.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsubSignal.java\nindex 186658d553..f9cfc0111a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsubSignal.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/TestPubsubSignal.java\n\n@@ -248,7 +248,7 @@ public class TestPubsubSignal implements TestRule {\n     try {\n       pubsub.deleteSubscription(resultSubscriptionPath);\n     } catch (IOException e) {\n-      LOG.warn(String.format(\"Leaked PubSub subscription '%s'\", resultSubscriptionPath));\n+      LOG.error(String.format(\"Leaked PubSub subscription '%s'\", resultSubscriptionPath));\n     }\n \n     if (!RESULT_SUCCESS_MESSAGE.equals(result)) {\n"}}, {"oid": "db7caf4d4b5900da5a8bd279755369bd79539486", "url": "https://github.com/apache/beam/commit/db7caf4d4b5900da5a8bd279755369bd79539486", "message": "Log subscription leak as error", "committedDate": "2020-09-21T20:51:18Z", "type": "commit"}]}