{"pr_number": 10862, "pr_title": "[BEAM-9320] Add AlwaysFetched annotation", "pr_createdAt": "2020-02-14T02:16:07Z", "pr_url": "https://github.com/apache/beam/pull/10862", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU2NjYzNA==", "url": "https://github.com/apache/beam/pull/10862#discussion_r379566634", "bodyText": "Add a comment that the annotation only works for ReadableState", "author": "dpmills", "createdAt": "2020-02-14T17:57:34Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java", "diffHunk": "@@ -397,6 +397,47 @@ public Duration getAllowedTimestampSkew() {\n     String value();\n   }\n \n+  /////////////////////////////////////////////////////////////////////////////\n+\n+  /**\n+   * Annotation for declaring that a state parameter is always fetched.\n+   *\n+   * <p>A DoFn might not fetch a state value on every element, and for that reason runners may\n+   * choose to defer fetching state until read() is called. Annotating a state argument with this\n+   * parameter provides a hint to the runner that the state is always fetched. This may cause the\n+   * runner to prefetch all the state before calling the processElement or processTimer method,\n+   * improving performance. See the following code for an example:", "originalCommit": "7404e24c654e36157a1cc272ba932849d8933f27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY1MDU5Ng==", "url": "https://github.com/apache/beam/pull/10862#discussion_r379650596", "bodyText": "done", "author": "reuvenlax", "createdAt": "2020-02-14T21:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU2NjYzNA=="}], "type": "inlineReview", "revised_code": {"commit": "ac98b62944e95b6fbea570bd5f79e1dc7c649c4c", "chunk": "diff --git a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java\nindex ad7f231b0f..34937fb1af 100644\n--- a/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java\n+++ b/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/DoFn.java\n\n@@ -406,7 +407,8 @@ public abstract class DoFn<InputT, OutputT> implements Serializable, HasDisplayD\n    * choose to defer fetching state until read() is called. Annotating a state argument with this\n    * parameter provides a hint to the runner that the state is always fetched. This may cause the\n    * runner to prefetch all the state before calling the processElement or processTimer method,\n-   * improving performance. See the following code for an example:\n+   * improving performance. This is a performance-only hint - it does not change semantics. See the\n+   * following code for an example:\n    *\n    * <pre><code>{@literal new DoFn<KV<Key, Foo>, Baz>()} {\n    *\n"}}, {"oid": "ac98b62944e95b6fbea570bd5f79e1dc7c649c4c", "url": "https://github.com/apache/beam/commit/ac98b62944e95b6fbea570bd5f79e1dc7c649c4c", "message": "address comments", "committedDate": "2020-02-14T21:23:22Z", "type": "forcePushed"}, {"oid": "72537149a330a53cf4baa778b9f9dd36897709e6", "url": "https://github.com/apache/beam/commit/72537149a330a53cf4baa778b9f9dd36897709e6", "message": "add AlwaysFetched annotation", "committedDate": "2020-02-14T22:06:01Z", "type": "commit"}, {"oid": "96a056697311ed8730af202be9be07183fe384df", "url": "https://github.com/apache/beam/commit/96a056697311ed8730af202be9be07183fe384df", "message": "foo", "committedDate": "2020-02-14T22:06:01Z", "type": "commit"}, {"oid": "e308cc1d914e2e83c315d0075d35d59280b16522", "url": "https://github.com/apache/beam/commit/e308cc1d914e2e83c315d0075d35d59280b16522", "message": "address comments", "committedDate": "2020-02-14T22:06:01Z", "type": "commit"}, {"oid": "59136a8ed9db1ab50e8a5196d8ce254326d822d0", "url": "https://github.com/apache/beam/commit/59136a8ed9db1ab50e8a5196d8ce254326d822d0", "message": "spotless", "committedDate": "2020-02-14T22:06:56Z", "type": "commit"}, {"oid": "59136a8ed9db1ab50e8a5196d8ce254326d822d0", "url": "https://github.com/apache/beam/commit/59136a8ed9db1ab50e8a5196d8ce254326d822d0", "message": "spotless", "committedDate": "2020-02-14T22:06:56Z", "type": "forcePushed"}]}