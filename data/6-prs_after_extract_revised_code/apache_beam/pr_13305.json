{"pr_number": 13305, "pr_title": "[BEAM-10925] Add interfaces for SQL Java scalar UDF.", "pr_createdAt": "2020-11-11T21:03:08Z", "pr_url": "https://github.com/apache/beam/pull/13305", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxMzYyNw==", "url": "https://github.com/apache/beam/pull/13305#discussion_r526513627", "bodyText": "Should this interface be nested within ScalarFn?", "author": "apilloud", "createdAt": "2020-11-19T00:32:24Z", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/ApplyMethod.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import org.apache.beam.sdk.annotations.Experimental;\n+\n+/**\n+ * Annotates the single method in {@link ScalarFn} that is to be applied to SQL function arguments.\n+ */\n+@Retention(RetentionPolicy.RUNTIME)\n+@Target(ElementType.METHOD)\n+@Experimental\n+public @interface ApplyMethod {}", "originalCommit": "5c04009d55cafe61d5878bb7c5eca8b103b4e33f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODAyOTUxMQ==", "url": "https://github.com/apache/beam/pull/13305#discussion_r528029511", "bodyText": "Yes (if we do decide to go with the annotations route).", "author": "ibzib", "createdAt": "2020-11-20T23:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgyNTQ0NQ==", "url": "https://github.com/apache/beam/pull/13305#discussion_r543825445", "bodyText": "Done.", "author": "ibzib", "createdAt": "2020-12-16T02:07:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUxMzYyNw=="}], "type": "inlineReview", "revised_code": {"commit": "eefc98c7f5af619fcf987da433666ade1cdc80ae", "chunk": "diff --git a/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/ApplyMethod.java b/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/package-info.java\nsimilarity index 63%\nrename from sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/ApplyMethod.java\nrename to sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/package-info.java\nindex 4b4176c43f..a530cc3221 100644\n--- a/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/ApplyMethod.java\n+++ b/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/package-info.java\n\n@@ -15,18 +15,12 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package org.apache.beam.sdk.extensions.sql;\n-\n-import java.lang.annotation.ElementType;\n-import java.lang.annotation.Retention;\n-import java.lang.annotation.RetentionPolicy;\n-import java.lang.annotation.Target;\n-import org.apache.beam.sdk.annotations.Experimental;\n \n /**\n- * Annotates the single method in {@link ScalarFn} that is to be applied to SQL function arguments.\n+ * Provides interfaces for defining user-defined functions in Beam SQL.\n+ *\n+ * <p>The contents of this package are <strong>experimental</strong>. (They are not marked\n+ * {@code @Experimental} as usual because that would require a dependency on the {@code\n+ * :sdks:java:core} module, which we want to avoid.)\n  */\n-@Retention(RetentionPolicy.RUNTIME)\n-@Target(ElementType.METHOD)\n-@Experimental\n-public @interface ApplyMethod {}\n+package org.apache.beam.sdk.extensions.sql.udf;\n"}}, {"oid": "eefc98c7f5af619fcf987da433666ade1cdc80ae", "url": "https://github.com/apache/beam/commit/eefc98c7f5af619fcf987da433666ade1cdc80ae", "message": "[BEAM-10925] Create new module for SQL UDF API.", "committedDate": "2020-12-16T02:39:35Z", "type": "commit"}, {"oid": "2c43ccb591427f67e7b476f0a5615d2f2b929b1c", "url": "https://github.com/apache/beam/commit/2c43ccb591427f67e7b476f0a5615d2f2b929b1c", "message": "[BEAM-10925] Add SQL ScalarFn interface.", "committedDate": "2020-12-16T02:39:59Z", "type": "commit"}, {"oid": "2c43ccb591427f67e7b476f0a5615d2f2b929b1c", "url": "https://github.com/apache/beam/commit/2c43ccb591427f67e7b476f0a5615d2f2b929b1c", "message": "[BEAM-10925] Add SQL ScalarFn interface.", "committedDate": "2020-12-16T02:39:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzkwOTI3OA==", "url": "https://github.com/apache/beam/pull/13305#discussion_r543909278", "bodyText": "Should be marked as @experimental?", "author": "amaliujia", "createdAt": "2020-12-16T03:59:21Z", "path": "sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/ScalarFn.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.extensions.sql.udf;\n+\n+import java.io.Serializable;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+/**\n+ * A scalar function that can be executed as part of a SQL query. Subclasses must contain exactly\n+ * one method annotated with {@link ApplyMethod}, which will be applied to the SQL function\n+ * arguments at runtime.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre><code>\n+ * public class IncrementFn extends ScalarFn {\n+ *  {@literal @ApplyMethod}\n+ *   public Long increment(Long i) {\n+ *     return i + 1;\n+ *   }\n+ * }\n+ * </code></pre>\n+ */\n+public abstract class ScalarFn implements Serializable {\n+  /**\n+   * Annotates the single method in a {@link ScalarFn} implementation that is to be applied to SQL\n+   * function arguments.\n+   */\n+  @Retention(RetentionPolicy.RUNTIME)\n+  @Target(ElementType.METHOD)\n+  public static @interface ApplyMethod {}", "originalCommit": "2c43ccb591427f67e7b476f0a5615d2f2b929b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ5MDcxMQ==", "url": "https://github.com/apache/beam/pull/13305#discussion_r544490711", "bodyText": "Experimental itself is a part of Beam java core: https://github.com/apache/beam/blob/486d23007dac513f9f90bb08c2a039cd72a7ec94/sdks/java/core/src/main/java/org/apache/beam/sdk/annotations/Experimental.java\nI added a note to the javadoc instead.", "author": "ibzib", "createdAt": "2020-12-16T17:35:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzkwOTI3OA=="}], "type": "inlineReview", "revised_code": {"commit": "30a04ceb138061cac482837b83724807f20de153", "chunk": "diff --git a/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/ScalarFn.java b/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/ScalarFn.java\nindex 10f559ea98..1c6482c800 100644\n--- a/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/ScalarFn.java\n+++ b/sdks/java/extensions/sql/udf/src/main/java/org/apache/beam/sdk/extensions/sql/udf/ScalarFn.java\n\n@@ -38,6 +38,9 @@ import java.lang.annotation.Target;\n  *   }\n  * }\n  * </code></pre>\n+ *\n+ * <p>ScalarFn is <strong>experimental</strong>. Compatibility is not guaranteed across Beam\n+ * versions.\n  */\n public abstract class ScalarFn implements Serializable {\n   /**\n"}}, {"oid": "30a04ceb138061cac482837b83724807f20de153", "url": "https://github.com/apache/beam/commit/30a04ceb138061cac482837b83724807f20de153", "message": "Add experimental notice to ScalarFn.", "committedDate": "2020-12-16T17:22:19Z", "type": "commit"}, {"oid": "eda8cecb04eb47eaea8925714a274ee52502d061", "url": "https://github.com/apache/beam/commit/eda8cecb04eb47eaea8925714a274ee52502d061", "message": "Comment about not adding dependencies to sql:udf.", "committedDate": "2020-12-16T17:31:29Z", "type": "commit"}, {"oid": "c7ea2724520c3005343612d7aef494127e46b179", "url": "https://github.com/apache/beam/commit/c7ea2724520c3005343612d7aef494127e46b179", "message": "Add newline at end of file.", "committedDate": "2020-12-16T17:33:58Z", "type": "commit"}]}