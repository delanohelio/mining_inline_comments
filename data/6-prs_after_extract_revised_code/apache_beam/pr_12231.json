{"pr_number": 12231, "pr_title": "[BEAM-9178] Support more EXTRACT functions", "pr_createdAt": "2020-07-11T02:13:50Z", "pr_url": "https://github.com/apache/beam/pull/12231", "timeline": [{"oid": "e00ba4427d0cbe81ac822953b433089cf18140d3", "url": "https://github.com/apache/beam/commit/e00ba4427d0cbe81ac822953b433089cf18140d3", "message": "Refactor time functions test out of giant ZetaSqlDialectSpecTest", "committedDate": "2020-07-10T18:16:35Z", "type": "commit"}, {"oid": "498cdb9c3309086939274946cdaa29ec1c1de451", "url": "https://github.com/apache/beam/commit/498cdb9c3309086939274946cdaa29ec1c1de451", "message": "Support more EXTRACT overloads", "committedDate": "2020-07-11T00:48:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NzQ1Ng==", "url": "https://github.com/apache/beam/pull/12231#discussion_r453757456", "bodyText": "nit: Looks like this should be set exactly once below? consider making it final SqlNode tz; instead.", "author": "apilloud", "createdAt": "2020-07-13T15:59:56Z", "path": "sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java", "diffHunk": "@@ -359,6 +267,43 @@ private void unparseFunctionsUsingInterval(\n     }\n   }\n \n+  private void unparseExtractFunctions(\n+      SqlWriter writer, SqlCall call, int leftPrec, int rightPrec) {\n+    String funName = call.getOperator().getName();\n+    int operandCount = call.operandCount();\n+    SqlNode tz = null;", "originalCommit": "5e05ffcef664c03aa15da99641d42e540b921e01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkyNDkxMw==", "url": "https://github.com/apache/beam/pull/12231#discussion_r453924913", "bodyText": "Actually we can't do this because tz is optional and there are cases in which it will not be set in the code below.", "author": "robinyqiu", "createdAt": "2020-07-13T20:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc1NzQ1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "507470b41a178ed71b2f7d0c0adc9d92ce0ed65b", "chunk": "diff --git a/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java b/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java\nindex 9a5618059c..b1ce1831d0 100644\n--- a/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java\n+++ b/sdks/java/extensions/sql/src/main/java/org/apache/beam/sdk/extensions/sql/meta/provider/bigquery/BeamBigQuerySqlDialect.java\n\n@@ -282,7 +282,7 @@ public class BeamBigQuerySqlDialect extends BigQuerySqlDialect {\n       if (operandCount == 2) {\n         tz = call.operand(1);\n       }\n-    } else if (operandCount == 2 || operandCount == 3) {\n+    } else if (funName.equals(\"$extract\") && (operandCount == 2 || operandCount == 3)) {\n       // EXTRACT(date_part FROM timestamp_expression [AT TIME ZONE tz])\n       // operand0: timestamp_expression\n       // operand1: date_part\n"}}, {"oid": "507470b41a178ed71b2f7d0c0adc9d92ce0ed65b", "url": "https://github.com/apache/beam/commit/507470b41a178ed71b2f7d0c0adc9d92ce0ed65b", "message": "Merge remote-tracking branch 'upstream/master' into extract", "committedDate": "2020-07-13T20:24:01Z", "type": "commit"}, {"oid": "507470b41a178ed71b2f7d0c0adc9d92ce0ed65b", "url": "https://github.com/apache/beam/commit/507470b41a178ed71b2f7d0c0adc9d92ce0ed65b", "message": "Merge remote-tracking branch 'upstream/master' into extract", "committedDate": "2020-07-13T20:24:01Z", "type": "forcePushed"}]}