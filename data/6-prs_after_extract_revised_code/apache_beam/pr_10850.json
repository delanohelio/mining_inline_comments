{"pr_number": 10850, "pr_title": "[BEAM-9299] Upgrade Flink Runner from 1.8.2 to 1.8.3", "pr_createdAt": "2020-02-13T11:52:59Z", "pr_url": "https://github.com/apache/beam/pull/10850", "timeline": [{"oid": "be3f280c3533ffe866cab8da3b8dd46b7bb81618", "url": "https://github.com/apache/beam/commit/be3f280c3533ffe866cab8da3b8dd46b7bb81618", "message": "[BEAM-9299] Upgrade Flink Runner 1.8x to 1.8.3 and 1.9x to 1.9.2", "committedDate": "2020-02-18T08:42:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc2NDYwMg==", "url": "https://github.com/apache/beam/pull/10850#discussion_r385764602", "bodyText": "We cannot remove this until we remove 1.7 support.", "author": "mxm", "createdAt": "2020-02-28T15:37:57Z", "path": "runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java", "diffHunk": "@@ -311,78 +306,4 @@ private static void applyLatencyTrackingInterval(\n     long latencyTrackingInterval = options.getLatencyTrackingInterval();\n     config.setLatencyTrackingInterval(latencyTrackingInterval);\n   }\n-\n-  /**\n-   * Remote stream environment that supports job execution with restore from savepoint.\n-   *\n-   * <p>This class can be removed once Flink provides this functionality.\n-   *\n-   * <p>TODO: https://issues.apache.org/jira/browse/BEAM-5396\n-   */\n-  private static class BeamFlinkRemoteStreamEnvironment extends RemoteStreamEnvironment {", "originalCommit": "be3f280c3533ffe866cab8da3b8dd46b7bb81618", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96d41d6782353b9eb2a82bbdedf0154d4eb1bd2b", "chunk": "diff --git a/runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java b/runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java\nindex 3d4d3af116..e01a5f6152 100644\n--- a/runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java\n+++ b/runners/flink/src/main/java/org/apache/beam/runners/flink/FlinkExecutionEnvironments.java\n\n@@ -306,4 +307,13 @@ public class FlinkExecutionEnvironments {\n     long latencyTrackingInterval = options.getLatencyTrackingInterval();\n     config.setLatencyTrackingInterval(latencyTrackingInterval);\n   }\n+\n+  private static void setManagedMemoryByFraction(final Configuration config) {\n+    if (!config.containsKey(\"taskmanager.memory.managed.size\")) {\n+      float managedMemoryFraction = config.getFloat(TaskManagerOptions.MANAGED_MEMORY_FRACTION);\n+      long freeHeapMemory = EnvironmentInformation.getSizeOfFreeHeapMemoryWithDefrag();\n+      long managedMemorySize = (long) (freeHeapMemory * managedMemoryFraction);\n+      config.setString(\"taskmanager.memory.managed.size\", String.valueOf(managedMemorySize));\n+    }\n+  }\n }\n"}}, {"oid": "96d41d6782353b9eb2a82bbdedf0154d4eb1bd2b", "url": "https://github.com/apache/beam/commit/96d41d6782353b9eb2a82bbdedf0154d4eb1bd2b", "message": "[BEAM-9299-PR]Upgrade Flink Runner 1.8x to 1.8.3 and 1.9x to 1.9.2", "committedDate": "2020-03-13T03:07:44Z", "type": "commit"}, {"oid": "96d41d6782353b9eb2a82bbdedf0154d4eb1bd2b", "url": "https://github.com/apache/beam/commit/96d41d6782353b9eb2a82bbdedf0154d4eb1bd2b", "message": "[BEAM-9299-PR]Upgrade Flink Runner 1.8x to 1.8.3 and 1.9x to 1.9.2", "committedDate": "2020-03-13T03:07:44Z", "type": "forcePushed"}]}