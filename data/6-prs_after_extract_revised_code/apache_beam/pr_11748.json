{"pr_number": 11748, "pr_title": "[BEAM-9339] Ensure that Dataflow's pipeline proto also contains the capabilities", "pr_createdAt": "2020-05-19T01:02:45Z", "pr_url": "https://github.com/apache/beam/pull/11748", "timeline": [{"oid": "a1a4cb362b35c204b2cb5ecfcfd379ecc65b6358", "url": "https://github.com/apache/beam/commit/a1a4cb362b35c204b2cb5ecfcfd379ecc65b6358", "message": "[BEAM-9339] Ensure that Dataflow's pipeline proto also contains the capabilities", "committedDate": "2020-05-19T01:02:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDI4Ng==", "url": "https://github.com/apache/beam/pull/11748#discussion_r426974286", "bodyText": "Is there some common utility we should be using here (rather than duplicating the code that's used in all the other portable runners)? What about requirements?", "author": "robertwb", "createdAt": "2020-05-19T01:11:50Z", "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/DataflowPipelineTranslator.java", "diffHunk": "@@ -183,7 +183,10 @@ public JobSpecification translate(\n     String workerHarnessContainerImageURL =\n         DataflowRunner.getContainerImageForJob(options.as(DataflowPipelineOptions.class));\n     RunnerApi.Environment defaultEnvironmentForDataflow =\n-        Environments.createDockerEnvironment(workerHarnessContainerImageURL);\n+        Environments.createDockerEnvironment(workerHarnessContainerImageURL)\n+            .toBuilder()\n+            .addAllCapabilities(Environments.getJavaCapabilities())", "originalCommit": "a1a4cb362b35c204b2cb5ecfcfd379ecc65b6358", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzAwNTAxMw==", "url": "https://github.com/apache/beam/pull/11748#discussion_r427005013", "bodyText": "Requirements is on the pipeline and that works.\nSince Dataflow is creating its own environment it is difficult to have common code because of the differences in the artifact staging and job APIs", "author": "lukecwik", "createdAt": "2020-05-19T03:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk3NDI4Ng=="}], "type": "inlineReview", "revised_code": null}]}