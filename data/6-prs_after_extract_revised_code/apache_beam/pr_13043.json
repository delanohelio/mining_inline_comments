{"pr_number": 13043, "pr_title": "[BEAM-11042] Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "pr_createdAt": "2020-10-07T20:39:34Z", "pr_url": "https://github.com/apache/beam/pull/13043", "timeline": [{"oid": "59c29354c572cf854aaab7f137c3278a1cff4557", "url": "https://github.com/apache/beam/commit/59c29354c572cf854aaab7f137c3278a1cff4557", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-07T22:30:06Z", "type": "forcePushed"}, {"oid": "fa8231d92ba8bfe0ffe059785a6644fa489fc998", "url": "https://github.com/apache/beam/commit/fa8231d92ba8bfe0ffe059785a6644fa489fc998", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-07T23:50:27Z", "type": "forcePushed"}, {"oid": "9c97490b7f00241b0edc44545ab00bf3339bfbcf", "url": "https://github.com/apache/beam/commit/9c97490b7f00241b0edc44545ab00bf3339bfbcf", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-07T23:55:09Z", "type": "forcePushed"}, {"oid": "45ac5734779e29b09dc34fd46724d00e1ac4216b", "url": "https://github.com/apache/beam/commit/45ac5734779e29b09dc34fd46724d00e1ac4216b", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T00:39:02Z", "type": "forcePushed"}, {"oid": "bb3000102ce342ea35005eb31f1c8e76c26924f7", "url": "https://github.com/apache/beam/commit/bb3000102ce342ea35005eb31f1c8e76c26924f7", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T00:44:14Z", "type": "forcePushed"}, {"oid": "00bdab34fb7ea54e5eef13daee3fd07351934bd0", "url": "https://github.com/apache/beam/commit/00bdab34fb7ea54e5eef13daee3fd07351934bd0", "message": "Tighten visibility of DirectRunner classes now that Java ReferenceRunner is removed", "committedDate": "2020-10-08T02:32:12Z", "type": "commit"}, {"oid": "d98ffe86d0595b3844d5fd26e2691e1ebfe4ca33", "url": "https://github.com/apache/beam/commit/d98ffe86d0595b3844d5fd26e2691e1ebfe4ca33", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T02:32:12Z", "type": "forcePushed"}, {"oid": "5d1e45f585883eb10d53691ec623a245cdc40489", "url": "https://github.com/apache/beam/commit/5d1e45f585883eb10d53691ec623a245cdc40489", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T02:33:49Z", "type": "forcePushed"}, {"oid": "c41581db436747523d6fe0bb42338b7c9b8d3de7", "url": "https://github.com/apache/beam/commit/c41581db436747523d6fe0bb42338b7c9b8d3de7", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T02:35:36Z", "type": "forcePushed"}, {"oid": "b7b51e48a070bc5932bd7f3c72fb4e4499d27582", "url": "https://github.com/apache/beam/commit/b7b51e48a070bc5932bd7f3c72fb4e4499d27582", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T03:06:43Z", "type": "forcePushed"}, {"oid": "de34ae4744a8fcce07bc6c4a9e3a45912aa673aa", "url": "https://github.com/apache/beam/commit/de34ae4744a8fcce07bc6c4a9e3a45912aa673aa", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-08T06:43:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxNDM2MQ==", "url": "https://github.com/apache/beam/pull/13043#discussion_r502014361", "bodyText": "Can we add some comments here to explain why we need a no-op here? Also can we attach a TODO here to clean it up in the future?", "author": "boyuanzz", "createdAt": "2020-10-08T21:10:16Z", "path": "runners/direct-java/src/main/java/org/apache/beam/runners/direct/CreateViewNoopEvaluatorFactory.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.runners.direct;\n+\n+import org.apache.beam.sdk.runners.AppliedPTransform;\n+import org.apache.beam.sdk.util.WindowedValue;\n+import org.checkerframework.checker.nullness.qual.Nullable;\n+\n+class CreateViewNoopEvaluatorFactory implements TransformEvaluatorFactory {", "originalCommit": "de34ae4744a8fcce07bc6c4a9e3a45912aa673aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU1NDk1NQ==", "url": "https://github.com/apache/beam/pull/13043#discussion_r502554955", "bodyText": "Added a big comment and BEAM-11049.", "author": "kennknowles", "createdAt": "2020-10-09T16:49:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjAxNDM2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "e2b129f283869b1cc580b40dcc00aa32352a3010", "chunk": "diff --git a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/CreateViewNoopEvaluatorFactory.java b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/CreateViewNoopEvaluatorFactory.java\nindex d9fcde73e4..48f8154a50 100644\n--- a/runners/direct-java/src/main/java/org/apache/beam/runners/direct/CreateViewNoopEvaluatorFactory.java\n+++ b/runners/direct-java/src/main/java/org/apache/beam/runners/direct/CreateViewNoopEvaluatorFactory.java\n\n@@ -18,9 +18,27 @@\n package org.apache.beam.runners.direct;\n \n import org.apache.beam.sdk.runners.AppliedPTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.transforms.View;\n import org.apache.beam.sdk.util.WindowedValue;\n import org.checkerframework.checker.nullness.qual.Nullable;\n \n+/**\n+ * A noop evaluator for {@link View.CreatePCollectionView}.\n+ *\n+ * <p>The direct runner does not need to execute anything, but the runner is designed so it is\n+ * difficult to remove from the graph (because it executes the graph without really translating it\n+ * to an intermediate form). So it is easier to ignore at runtime.\n+ *\n+ * <p>Each side input is materialized by inspecting the {@link ParDo} transforms that read them. But\n+ * until all runners are migrated off the deprecated {@link\n+ * org.apache.beam.sdk.transforms.View.CreatePCollectionView} it will remain in the expansion for\n+ * side input producing transforms.\n+ *\n+ * <p>See https://issues.apache.org/jira/browse/BEAM-11049\n+ */\n+// TODO(https://issues.apache.org/jira/browse/BEAM-11049): remove this when CreatePCollectionView is\n+// finally removed\n class CreateViewNoopEvaluatorFactory implements TransformEvaluatorFactory {\n   @Override\n   public @Nullable <InputT> TransformEvaluator<InputT> forApplication(\n"}}, {"oid": "e2b129f283869b1cc580b40dcc00aa32352a3010", "url": "https://github.com/apache/beam/commit/e2b129f283869b1cc580b40dcc00aa32352a3010", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-09T16:49:04Z", "type": "commit"}, {"oid": "e2b129f283869b1cc580b40dcc00aa32352a3010", "url": "https://github.com/apache/beam/commit/e2b129f283869b1cc580b40dcc00aa32352a3010", "message": "Remove DirectRunner dependency on deprecated CreatePCollectionView primitive", "committedDate": "2020-10-09T16:49:04Z", "type": "forcePushed"}]}