{"pr_number": 12695, "pr_title": "[BEAM-8758] Google-cloud-spanner upgrade to 1.59.0 and google_cloud_bigtable_client_core to 1.16.0", "pr_createdAt": "2020-08-27T00:38:30Z", "pr_url": "https://github.com/apache/beam/pull/12695", "timeline": [{"oid": "00bfdc662d2c0f5caa39ebe2bc5ab01d938c5523", "url": "https://github.com/apache/beam/commit/00bfdc662d2c0f5caa39ebe2bc5ab01d938c5523", "message": "Upgrade cloud spanner version to 1.59.0", "committedDate": "2020-07-30T21:36:27Z", "type": "commit"}, {"oid": "cec6e6dd13e8220a8ff95b671f522be9a557a957", "url": "https://github.com/apache/beam/commit/cec6e6dd13e8220a8ff95b671f522be9a557a957", "message": "Upgrade gax_version to 1.57.1", "committedDate": "2020-07-30T22:22:02Z", "type": "commit"}, {"oid": "5126f1898a59511d80d71250da4a8d9799a74a10", "url": "https://github.com/apache/beam/commit/5126f1898a59511d80d71250da4a8d9799a74a10", "message": "Upgrade google_cloud_core_version and google_cloud_bigtable_client_core", "committedDate": "2020-07-30T23:44:45Z", "type": "commit"}, {"oid": "597f6a992d5d33754ce468eb25200c56a003c7fa", "url": "https://github.com/apache/beam/commit/597f6a992d5d33754ce468eb25200c56a003c7fa", "message": "Bump gax_httpjson to 0.74.1", "committedDate": "2020-07-31T17:50:37Z", "type": "commit"}, {"oid": "899fa27b9c2037005d85c25a6622146531327b63", "url": "https://github.com/apache/beam/commit/899fa27b9c2037005d85c25a6622146531327b63", "message": "Bump com.google.cloud:google-cloud-core-http to 1.93.7", "committedDate": "2020-07-31T19:42:11Z", "type": "commit"}, {"oid": "d884c5feb851d22d8f5e181e1c91c1a5a324f22c", "url": "https://github.com/apache/beam/commit/d884c5feb851d22d8f5e181e1c91c1a5a324f22c", "message": "Revert version bump of google-cloud-core-http", "committedDate": "2020-08-01T14:58:56Z", "type": "commit"}, {"oid": "9eb74fb7836dafadbf6d741078b52ce2d07a056b", "url": "https://github.com/apache/beam/commit/9eb74fb7836dafadbf6d741078b52ce2d07a056b", "message": "Revert \"Bump gax_httpjson to 0.74.1\"\n\nThis reverts commit 597f6a99", "committedDate": "2020-08-01T15:00:58Z", "type": "commit"}, {"oid": "41c14ba96ebcad3d00f60810a99f19af725abfc7", "url": "https://github.com/apache/beam/commit/41c14ba96ebcad3d00f60810a99f19af725abfc7", "message": "Update bigtable-client-core to 1.14.1 (released version)", "committedDate": "2020-08-01T15:21:34Z", "type": "commit"}, {"oid": "b419e509609e0db4dea494b51ca1bd6017a3da4a", "url": "https://github.com/apache/beam/commit/b419e509609e0db4dea494b51ca1bd6017a3da4a", "message": "Update bigtable-client-core to 1.15.0", "committedDate": "2020-08-01T16:30:22Z", "type": "commit"}, {"oid": "5960b772c775ff5eea48d7b105a741ef889f0d95", "url": "https://github.com/apache/beam/commit/5960b772c775ff5eea48d7b105a741ef889f0d95", "message": "Bump google_cloud_bigtable_client_core to 1.15.1 (local build)", "committedDate": "2020-08-06T06:34:56Z", "type": "commit"}, {"oid": "c52d9b8edc98a78c3756649238e16c588b2e5163", "url": "https://github.com/apache/beam/commit/c52d9b8edc98a78c3756649238e16c588b2e5163", "message": "Add local maven repo", "committedDate": "2020-08-06T07:08:00Z", "type": "commit"}, {"oid": "17b67ae51d3a54285457bbfa08e67d5b250a3f6c", "url": "https://github.com/apache/beam/commit/17b67ae51d3a54285457bbfa08e67d5b250a3f6c", "message": "Revert \"Add local maven repo\"\n\nThis reverts commit c52d9b8e", "committedDate": "2020-08-06T07:13:16Z", "type": "commit"}, {"oid": "8113cebdfb5cd2d1a9092a143e6bc377571801c6", "url": "https://github.com/apache/beam/commit/8113cebdfb5cd2d1a9092a143e6bc377571801c6", "message": "Add local maven repo again", "committedDate": "2020-08-06T07:14:37Z", "type": "commit"}, {"oid": "f9154a8fafaa968ebaece9ca949029051e1a256d", "url": "https://github.com/apache/beam/commit/f9154a8fafaa968ebaece9ca949029051e1a256d", "message": "Update bigtable-client-core to 1.15.1-SNAPSHOT", "committedDate": "2020-08-06T07:19:03Z", "type": "commit"}, {"oid": "52cea2c27641d28639b373bf68da332a777a39e3", "url": "https://github.com/apache/beam/commit/52cea2c27641d28639b373bf68da332a777a39e3", "message": "Update bigtable-client-core to 1.16.0,\nalso update SpannerSchema to be able to parse NUMERIC type.", "committedDate": "2020-08-25T23:23:16Z", "type": "commit"}, {"oid": "260fe6f0dc86bbb24bd08e85ecbec88598454de2", "url": "https://github.com/apache/beam/commit/260fe6f0dc86bbb24bd08e85ecbec88598454de2", "message": "Revert change of adding mavenLocal", "committedDate": "2020-08-26T19:36:14Z", "type": "commit"}, {"oid": "1bfd4785d2bf5affb53d0058cc6be5a0b16d593c", "url": "https://github.com/apache/beam/commit/1bfd4785d2bf5affb53d0058cc6be5a0b16d593c", "message": "Fix test failure of GcpApiSurfaceTest", "committedDate": "2020-08-28T00:04:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NTM4Nw==", "url": "https://github.com/apache/beam/pull/12695#discussion_r479445387", "bodyText": "@terryxian78 Is this new?", "author": "suztomo", "createdAt": "2020-08-28T17:36:34Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/spanner/SpannerSchema.java", "diffHunk": "@@ -169,7 +169,9 @@ private static Type parseSpannerType(String spannerType) {\n       if (\"DATE\".equals(spannerType)) {\n         return Type.date();\n       }\n-\n+      if (\"NUMERIC\".equals(spannerType)) {\n+        return Type.numeric();\n+      }", "originalCommit": "1bfd4785d2bf5affb53d0058cc6be5a0b16d593c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMyMTIxMA==", "url": "https://github.com/apache/beam/pull/12695#discussion_r480321210", "bodyText": "No, This was included in my original pull request, I explained in the comment.", "author": "terryxian78", "createdAt": "2020-08-31T18:49:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ1MDU4MA==", "url": "https://github.com/apache/beam/pull/12695#discussion_r481450580", "bodyText": "Can we move this to a separate PR with tests ?", "author": "chamikaramj", "createdAt": "2020-09-01T21:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ3MTYxNQ==", "url": "https://github.com/apache/beam/pull/12695#discussion_r481471615", "bodyText": "sure. I will make it a separate PR.", "author": "terryxian78", "createdAt": "2020-09-01T22:40:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ3NTIzOA==", "url": "https://github.com/apache/beam/pull/12695#discussion_r481475238", "bodyText": "Done! I reverted the change of this file.", "author": "terryxian78", "createdAt": "2020-09-01T22:51:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NTM4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "4efc91b56d682bfc90a279b0652015226f973310", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/spanner/SpannerSchema.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/spanner/SpannerSchema.java\nindex 33c88fba63..7055314214 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/spanner/SpannerSchema.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/spanner/SpannerSchema.java\n\n@@ -169,9 +169,6 @@ abstract class SpannerSchema implements Serializable {\n       if (\"DATE\".equals(spannerType)) {\n         return Type.date();\n       }\n-      if (\"NUMERIC\".equals(spannerType)) {\n-        return Type.numeric();\n-      }\n       if (spannerType.startsWith(\"ARRAY\")) {\n         // Substring \"ARRAY<xxx>\"\n         String spannerArrayType = spannerType.substring(6, spannerType.length() - 1);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NjUwMA==", "url": "https://github.com/apache/beam/pull/12695#discussion_r479446500", "bodyText": "You may want to be more specific here. This includes all the classes in Guava's collection, ImmutableList, ImmutableSet, etc. I believe Beam team has intentionally avoided the classes to be exposed as APIs.", "author": "suztomo", "createdAt": "2020-08-28T17:39:05Z", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/GcpApiSurfaceTest.java", "diffHunk": "@@ -65,11 +65,13 @@ public void testGcpApiSurface() throws Exception {\n             classesInPackage(\"com.google.bigtable.v2\"),\n             classesInPackage(\"com.google.cloud.bigquery.storage.v1beta1\"),\n             classesInPackage(\"com.google.cloud.bigtable.config\"),\n+            classesInPackage(\"com.google.common.collect\"),", "originalCommit": "1bfd4785d2bf5affb53d0058cc6be5a0b16d593c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMyMjI4Nw==", "url": "https://github.com/apache/beam/pull/12695#discussion_r480322287", "bodyText": "Ack, I will send another iteration to make it more specific.", "author": "terryxian78", "createdAt": "2020-08-31T18:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NjUwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM0Nzc2OA==", "url": "https://github.com/apache/beam/pull/12695#discussion_r480347768", "bodyText": "Done!", "author": "terryxian78", "createdAt": "2020-08-31T19:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NjUwMA=="}], "type": "inlineReview", "revised_code": {"commit": "6d26c522625ecca0c1b2027d6494eafa1f89e40e", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/GcpApiSurfaceTest.java b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/GcpApiSurfaceTest.java\nindex fc31bf56aa..1a3e82480b 100644\n--- a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/GcpApiSurfaceTest.java\n+++ b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/GcpApiSurfaceTest.java\n\n@@ -65,7 +65,6 @@ public class GcpApiSurfaceTest {\n             classesInPackage(\"com.google.bigtable.v2\"),\n             classesInPackage(\"com.google.cloud.bigquery.storage.v1beta1\"),\n             classesInPackage(\"com.google.cloud.bigtable.config\"),\n-            classesInPackage(\"com.google.common.collect\"),\n             classesInPackage(\"com.google.spanner.v1\"),\n             classesInPackage(\"com.google.pubsub.v1\"),\n             classesInPackage(\"com.google.cloud.pubsublite\"),\n"}}, {"oid": "6d26c522625ecca0c1b2027d6494eafa1f89e40e", "url": "https://github.com/apache/beam/commit/6d26c522625ecca0c1b2027d6494eafa1f89e40e", "message": "Speficically call out exposed classes (instead of an entire package) in GcpApiSurfaceTest", "committedDate": "2020-08-31T19:16:36Z", "type": "commit"}, {"oid": "4efc91b56d682bfc90a279b0652015226f973310", "url": "https://github.com/apache/beam/commit/4efc91b56d682bfc90a279b0652015226f973310", "message": "Revert change of SpannerSchema and will make it a separate PR.", "committedDate": "2020-09-01T22:44:59Z", "type": "commit"}, {"oid": "a81c5a36485cc4838aa3fd5d563f86c009fde70b", "url": "https://github.com/apache/beam/commit/a81c5a36485cc4838aa3fd5d563f86c009fde70b", "message": "Add a separate blank line.", "committedDate": "2020-09-01T22:49:47Z", "type": "commit"}, {"oid": "f1c6846f1bcc15207927aa704a8091b768003c1a", "url": "https://github.com/apache/beam/commit/f1c6846f1bcc15207927aa704a8091b768003c1a", "message": "Add TODO in GcpApiSurfaceTest: TODO: remove newly-exposed clasess once spanner updates its APIs.", "committedDate": "2020-09-08T16:45:21Z", "type": "commit"}]}