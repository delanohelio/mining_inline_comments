{"pr_number": 13137, "pr_title": "[BEAM-11073] Dicom IO Connector for Java", "pr_createdAt": "2020-10-19T18:26:05Z", "pr_url": "https://github.com/apache/beam/pull/13137", "timeline": [{"oid": "0cf68a223ca1772e105028d129e4d848510e7d83", "url": "https://github.com/apache/beam/commit/0cf68a223ca1772e105028d129e4d848510e7d83", "message": "New Dicom IO connector", "committedDate": "2020-10-05T20:26:33Z", "type": "commit"}, {"oid": "49cb6ef4b738157ff19ad08bb0b82c7db0f3e155", "url": "https://github.com/apache/beam/commit/49cb6ef4b738157ff19ad08bb0b82c7db0f3e155", "message": "Revert \"New Dicom IO connector\"\n\nThis reverts commit 0cf68a223ca1772e105028d129e4d848510e7d83.", "committedDate": "2020-10-05T20:30:59Z", "type": "commit"}, {"oid": "d5ddcee9b6969f5df103c8aba63b1a551bbe6351", "url": "https://github.com/apache/beam/commit/d5ddcee9b6969f5df103c8aba63b1a551bbe6351", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-10-06T16:19:09Z", "type": "commit"}, {"oid": "02f6713f9c91e62fcf0ab5c2949e40b2882f52e5", "url": "https://github.com/apache/beam/commit/02f6713f9c91e62fcf0ab5c2949e40b2882f52e5", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-10-14T19:13:36Z", "type": "commit"}, {"oid": "5437fda63f2f598f650ddba1664382b72b683755", "url": "https://github.com/apache/beam/commit/5437fda63f2f598f650ddba1664382b72b683755", "message": "New Dicom IO connector", "committedDate": "2020-10-19T13:52:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzMzg0NQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509433845", "bodyText": "DICOM study metadata?", "author": "poojavenkatram", "createdAt": "2020-10-21T16:34:13Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {\n+\n+  /**\n+   * Read dicom study metadata from a PCollection of resource webpath.\n+   *\n+   * @return the read", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzNTA0Mg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509435042", "bodyText": "Read the DICOM study metadata from the resource path obtained from PubSub ?", "author": "poojavenkatram", "createdAt": "2020-10-21T16:36:01Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {\n+\n+  /**\n+   * Read dicom study metadata from a PCollection of resource webpath.", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzNTM2MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509435360", "bodyText": "Why not move this comment into the Class to show that the class does...this method is only returning an Object of the class..", "author": "poojavenkatram", "createdAt": "2020-10-21T16:36:30Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {\n+\n+  /**", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzNjk4Ng==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509436986", "bodyText": "this seems incomplete?", "author": "poojavenkatram", "createdAt": "2020-10-21T16:39:02Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {\n+\n+  /**\n+   * Read dicom study metadata from a PCollection of resource webpath.\n+   *\n+   * @return the read\n+   * @see ReadDicomStudyMetadata\n+   */\n+  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n+    return new ReadDicomStudyMetadata();\n+  }\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+\n+    /**\n+     * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n+     */\n+    static class FetchStudyMetadataFn extends DoFn<PubsubMessage, String> {\n+\n+      private HealthcareApiClient dicomStore;\n+\n+      /**\n+       * Instantiate the healthcare client.\n+       *\n+       * @throws IOException\n+       */\n+      @Setup\n+      public void instantiateHealthcareClient() throws IOException {\n+        this.dicomStore = new HttpHealthcareApiClient();\n+      }\n+\n+      /**\n+       * Process The Pub/Sub message.\n+       *\n+       * @param context The input containing the pub/sub message\n+       */\n+      @ProcessElement\n+      public void processElement(ProcessContext context) {\n+        PubsubMessage msg = context.element();\n+        byte[] msgPayload = msg.getPayload();\n+        try {\n+          String dicomWebPath = new String(msgPayload, \"UTF-8\");\n+          String responseData = dicomStore.retrieveDicomStudyMetadata(dicomWebPath);\n+          context.output(responseData);\n+        } catch (Exception e) {\n+          // IO exception, unsupported encoding exception\n+          System.out.println(e);\n+          if (e.getClass() == IOException.class) {\n+          } else if (e.getClass() == UnsupportedEncodingException.class) {\n+          } else {\n+          }\n+        }", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzNzUwOQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509437509", "bodyText": "nit: remove", "author": "poojavenkatram", "createdAt": "2020-10-21T16:39:51Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java", "diffHunk": "@@ -196,6 +197,64 @@ public Empty deleteFhirStore(String name) throws IOException {\n     return client.projects().locations().datasets().fhirStores().delete(name).execute();\n   }\n \n+  @Override\n+  public String retrieveDicomStudyMetadata(String dicomWebPath) throws IOException {\n+    String[] webPathSplit;\n+    webPathSplit = dicomWebPath.split(\"/dicomWeb/\");\n+    String dicomStorePath = webPathSplit[0];\n+\n+    String[] searchParameters;\n+    searchParameters = webPathSplit[1].split(\"/\");\n+    String studyId = searchParameters[1];\n+    //        String seriesId = searchParameters[3];\n+    //        String instanceId = searchParameters[5];", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\nindex 363c6cb07a..c23376caa3 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\n\n@@ -201,13 +201,18 @@ public class HttpHealthcareApiClient implements HealthcareApiClient, Serializabl\n   public String retrieveDicomStudyMetadata(String dicomWebPath) throws IOException {\n     String[] webPathSplit;\n     webPathSplit = dicomWebPath.split(\"/dicomWeb/\");\n+    if (webPathSplit.length != 2) {\n+      throw new IOException(\"Invalid Web Path\");\n+    }\n+\n     String dicomStorePath = webPathSplit[0];\n \n     String[] searchParameters;\n     searchParameters = webPathSplit[1].split(\"/\");\n+    if (searchParameters.length < 2) {\n+      throw new IOException(\"Invalid Web Path\");\n+    }\n     String studyId = searchParameters[1];\n-    //        String seriesId = searchParameters[3];\n-    //        String instanceId = searchParameters[5];\n \n     String searchQuery = String.format(\"studies/%s/metadata\", studyId);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzODYwMw==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509438603", "bodyText": "How about a test for the success case?", "author": "poojavenkatram", "createdAt": "2020-10-21T16:41:20Z", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.testing.PAssert;\n+import org.apache.beam.sdk.testing.TestPipeline;\n+import org.apache.beam.sdk.transforms.Create;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+@RunWith(JUnit4.class)\n+public class DicomIOTest {\n+  @Rule public final transient TestPipeline pipeline = TestPipeline.create();\n+\n+  @Test\n+  public void test_Dicom_failedMetadataRead() {", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\nindex c00db15a2f..d05d128d37 100644\n--- a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\n+++ b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\n\n@@ -23,7 +23,6 @@ import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.testing.PAssert;\n import org.apache.beam.sdk.testing.TestPipeline;\n import org.apache.beam.sdk.transforms.Create;\n-import org.apache.beam.sdk.values.PCollection;\n import org.junit.Rule;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ0MDExMg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509440112", "bodyText": "Right on the top of this page I would add some information on what this connector is and what it is doing. Somthing like this is used to connect Google Cloud Healthcare DICOM API with links to the API, how to configure pubsub, etc. to make it easy for a customer of the connector to get some context.", "author": "poojavenkatram", "createdAt": "2020-10-21T16:43:42Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"oid": "12d2257898f864000a24a846d3abda10839fda3a", "url": "https://github.com/apache/beam/commit/12d2257898f864000a24a846d3abda10839fda3a", "message": "Dicom IO connector output changed to a Result class", "committedDate": "2020-10-22T18:46:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU1OTQ5OQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r509559499", "bodyText": "We are not really doing much in this method, so we can remove it", "author": "Aliraza-N", "createdAt": "2020-10-21T18:32:53Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.TupleTag;\n+\n+public class DicomIO {\n+\n+  /**\n+   * Read dicom study metadata from a PCollection of resource webpath.\n+   *\n+   * @return the read\n+   * @see ReadDicomStudyMetadata\n+   */\n+  public static ReadDicomStudyMetadata retrieveStudyMetadata() {", "originalCommit": "5437fda63f2f598f650ddba1664382b72b683755", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12d2257898f864000a24a846d3abda10839fda3a", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 71527fa224..1ca70d9f75 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -18,33 +18,110 @@\n package org.apache.beam.sdk.io.gcp.healthcare;\n \n import java.io.IOException;\n-import java.io.UnsupportedEncodingException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n public class DicomIO {\n \n-  /**\n-   * Read dicom study metadata from a PCollection of resource webpath.\n-   *\n-   * @return the read\n-   * @see ReadDicomStudyMetadata\n-   */\n-  public static ReadDicomStudyMetadata retrieveStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n-  }\n-\n   /** The type ReadDicomStudyMetadata. */\n   public static class ReadDicomStudyMetadata\n-      extends PTransform<PCollection<PubsubMessage>, PCollection<String>> {\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n     public ReadDicomStudyMetadata() {}\n \n     public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(OUT).and(DEAD_LETTER))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.DEAD_LETTER tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(OUT);\n+        this.failedReads = pct.get(DEAD_LETTER);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(OUT, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n \n     /**\n      * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n"}}, {"oid": "7748e8a57d4394b2f627ea644100d470ef3efd7d", "url": "https://github.com/apache/beam/commit/7748e8a57d4394b2f627ea644100d470ef3efd7d", "message": "[BEAM-11073] Dicom IO connector output changed to a Result class", "committedDate": "2020-10-22T19:00:20Z", "type": "commit"}, {"oid": "c46c0c5f52134b7745e2b6f269c5396781102656", "url": "https://github.com/apache/beam/commit/c46c0c5f52134b7745e2b6f269c5396781102656", "message": "Merge branch 'master' of https://github.com/Aliraza-N/beam", "committedDate": "2020-10-22T19:03:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwNDEwNg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510404106", "bodyText": "add a link to the Dicom API here..", "author": "poojavenkatram", "createdAt": "2020-10-22T19:27:09Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwNDk3Ng==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510404976", "bodyText": "please be more descriptive in the comment", "author": "poojavenkatram", "createdAt": "2020-10-22T19:28:52Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    public static final TupleTag<String> OUT = new TupleTag<String>() {};\n+    public static final TupleTag<String> DEAD_LETTER = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+      /** The Pct. */", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwODAwMA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510408000", "bodyText": "why not give these both better names like \"Response\" and \"Error\"?", "author": "poojavenkatram", "createdAt": "2020-10-22T19:34:25Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    public static final TupleTag<String> OUT = new TupleTag<String>() {};", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQzMzM0MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510433340", "bodyText": "These were the names given in the fhir and hl7 IO connectors. I've used the same for consistency.", "author": "Aliraza-N", "createdAt": "2020-10-22T20:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwODAwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTA0NzY0Mg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r511047642", "bodyText": "That's ok these names make it difficult to read and understand what these values are without going through the code which is not ideal so we should rename them..", "author": "poojavenkatram", "createdAt": "2020-10-23T17:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwODAwMA=="}], "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwOTYxNg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510409616", "bodyText": "you can also check for the error in the result now?", "author": "poojavenkatram", "createdAt": "2020-10-22T19:37:33Z", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.testing.PAssert;\n+import org.apache.beam.sdk.testing.TestPipeline;\n+import org.apache.beam.sdk.transforms.Create;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+\n+@RunWith(JUnit4.class)\n+public class DicomIOTest {\n+  @Rule public final transient TestPipeline pipeline = TestPipeline.create();\n+\n+  @Test\n+  public void test_Dicom_failedMetadataRead() {\n+    PubsubMessage badMessage = createPubSubMessage(\"foo\");\n+\n+    DicomIO.ReadDicomStudyMetadata.Result retrievedData;\n+    retrievedData =\n+        pipeline.apply(Create.of(badMessage)).apply(new DicomIO.ReadDicomStudyMetadata());\n+\n+    PAssert.that(retrievedData.getReadResponse()).empty();", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQzNzQ2Nw==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510437467", "bodyText": "Yes, you can call retrievedData.getFailedReads() to get the error responses. But that PCollection will not be empty.", "author": "Aliraza-N", "createdAt": "2020-10-22T20:29:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQwOTYxNg=="}], "type": "inlineReview", "revised_code": {"commit": "85600b7580896cd77c029121292830a4bedce724", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\nindex d05d128d37..f77eaed05c 100644\n--- a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\n+++ b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOTest.java\n\n@@ -23,6 +23,7 @@ import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.testing.PAssert;\n import org.apache.beam.sdk.testing.TestPipeline;\n import org.apache.beam.sdk.transforms.Create;\n+import org.junit.Assert;\n import org.junit.Rule;\n import org.junit.Test;\n import org.junit.runner.RunWith;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxMzYwMA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510413600", "bodyText": "nit: read from the Google Cloud Healthcare DICOM API. ?", "author": "poojavenkatram", "createdAt": "2020-10-22T19:44:51Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQzNzc2MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510437760", "bodyText": "Would \"make calls\" be better?", "author": "Aliraza-N", "createdAt": "2020-10-22T20:29:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxMzYwMA=="}], "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxMzg3Mg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510413872", "bodyText": "DICOM study metadata can be read?", "author": "poojavenkatram", "createdAt": "2020-10-22T19:45:20Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxNDQxMQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510414411", "bodyText": "nit: contain the path to the study.", "author": "poojavenkatram", "createdAt": "2020-10-22T19:46:20Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxNDY5NA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510414694", "bodyText": "when a DICOM instance is stored by following..", "author": "poojavenkatram", "createdAt": "2020-10-22T19:46:52Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxNDk0MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510414940", "bodyText": "study encoded as a  json string?", "author": "poojavenkatram", "createdAt": "2020-10-22T19:47:19Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxNTMwNQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r510415305", "bodyText": "You can move the Description you gave for ReadStudyMetadata above here because we might add other methods to the same connector in the future..", "author": "poojavenkatram", "createdAt": "2020-10-22T19:47:58Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,172 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n+ * Healthcare.\n+ *\n+ * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n+ * PubSub message as input, where the message's body will contain the location of the Study. You can\n+ * learn how to configure PubSub messages to be published when an instance is stored in a data store\n+ * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n+ * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n+ * string\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */", "originalCommit": "c46c0c5f52134b7745e2b6f269c5396781102656", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1ca70d9f75..26740b363a 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,15 +35,8 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to read from the Dicom API from Google Cloud\n- * Healthcare.\n- *\n- * <p>Study-level metadata can be read using {@link ReadDicomStudyMetadata}. It is expecting a\n- * PubSub message as input, where the message's body will contain the location of the Study. You can\n- * learn how to configure PubSub messages to be published when an instance is stored in a data store\n- * by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output\n- * a {@link ReadDicomStudyMetadata.Result} which will contain metadata of a study encoded in json\n- * string\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n  */\n public class DicomIO {\n \n"}}, {"oid": "1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "url": "https://github.com/apache/beam/commit/1e2dcb44a51dea3dcef2b0ba388cc655b95ff969", "message": "Renamed tuple tags in DicomIO", "committedDate": "2020-10-23T19:43:18Z", "type": "commit"}, {"oid": "85600b7580896cd77c029121292830a4bedce724", "url": "https://github.com/apache/beam/commit/85600b7580896cd77c029121292830a4bedce724", "message": "[BEAM-11073] DicomIO - adjusted failure test case", "committedDate": "2020-10-23T20:28:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA3MTQ3MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512071470", "bodyText": "Need to update error message", "author": "Aliraza-N", "createdAt": "2020-10-26T15:54:57Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    /**\n+     * This class makes a call to the retrieve metadata endpoint\n+     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n+     * expecting a PubSub message as input, where the message's body will contain the path to the\n+     * study. You can learn how to configure PubSub messages to be published when an instance is\n+     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+     * encoded as a json array.\n+     */\n+    public ReadDicomStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(METADATA).and(ERROR_MESSAGE))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.OUT \"", "originalCommit": "85600b7580896cd77c029121292830a4bedce724", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6b117204174442d73f0657aedaac8b26c090038", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 26740b363a..cc6ec6bf60 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,24 +35,24 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n- * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n  */\n public class DicomIO {\n \n-  /** The type ReadDicomStudyMetadata. */\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n-    /**\n-     * This class makes a call to the retrieve metadata endpoint\n-     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n-     * expecting a PubSub message as input, where the message's body will contain the path to the\n-     * study. You can learn how to configure PubSub messages to be published when an instance is\n-     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-     * encoded as a json array.\n-     */\n     public ReadDicomStudyMetadata() {}\n \n     /** TupleTag for the main output. */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA2NTI4MQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512065281", "bodyText": "\"allows Beam pipelines to make calls to the DICOM API of the Google Cloud Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\" ? the link here is better because it links to the How-to guide which is much easier for someone to follow..", "author": "poojavenkatram", "createdAt": "2020-10-26T15:47:09Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom", "originalCommit": "85600b7580896cd77c029121292830a4bedce724", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6b117204174442d73f0657aedaac8b26c090038", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 26740b363a..cc6ec6bf60 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,24 +35,24 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n- * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n  */\n public class DicomIO {\n \n-  /** The type ReadDicomStudyMetadata. */\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n-    /**\n-     * This class makes a call to the retrieve metadata endpoint\n-     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n-     * expecting a PubSub message as input, where the message's body will contain the path to the\n-     * study. You can learn how to configure PubSub messages to be published when an instance is\n-     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-     * encoded as a json array.\n-     */\n     public ReadDicomStudyMetadata() {}\n \n     /** TupleTag for the main output. */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA2NzQ4Mg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512067482", "bodyText": "add the class documentation here...the general rule of thumb is you add the description and all details about the class with the class definition and then each method will have it's specific description..", "author": "poojavenkatram", "createdAt": "2020-10-26T15:49:55Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */", "originalCommit": "85600b7580896cd77c029121292830a4bedce724", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6b117204174442d73f0657aedaac8b26c090038", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 26740b363a..cc6ec6bf60 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,24 +35,24 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n- * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n  */\n public class DicomIO {\n \n-  /** The type ReadDicomStudyMetadata. */\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n-    /**\n-     * This class makes a call to the retrieve metadata endpoint\n-     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n-     * expecting a PubSub message as input, where the message's body will contain the path to the\n-     * study. You can learn how to configure PubSub messages to be published when an instance is\n-     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-     * encoded as a json array.\n-     */\n     public ReadDicomStudyMetadata() {}\n \n     /** TupleTag for the main output. */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA2ODMwNg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512068306", "bodyText": "add a ). after the link....", "author": "poojavenkatram", "createdAt": "2020-10-26T15:50:53Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    /**\n+     * This class makes a call to the retrieve metadata endpoint\n+     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is", "originalCommit": "85600b7580896cd77c029121292830a4bedce724", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6b117204174442d73f0657aedaac8b26c090038", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 26740b363a..cc6ec6bf60 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,24 +35,24 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n- * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n  */\n public class DicomIO {\n \n-  /** The type ReadDicomStudyMetadata. */\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n-    /**\n-     * This class makes a call to the retrieve metadata endpoint\n-     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n-     * expecting a PubSub message as input, where the message's body will contain the path to the\n-     * study. You can learn how to configure PubSub messages to be published when an instance is\n-     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-     * encoded as a json array.\n-     */\n     public ReadDicomStudyMetadata() {}\n \n     /** TupleTag for the main output. */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA3MDI0MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512070240", "bodyText": "It defines a function that can be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the specified study.", "author": "poojavenkatram", "createdAt": "2020-10-26T15:53:24Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n+ * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ */\n+public class DicomIO {\n+\n+  /** The type ReadDicomStudyMetadata. */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    /**\n+     * This class makes a call to the retrieve metadata endpoint\n+     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n+     * expecting a PubSub message as input, where the message's body will contain the path to the", "originalCommit": "85600b7580896cd77c029121292830a4bedce724", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6b117204174442d73f0657aedaac8b26c090038", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 26740b363a..cc6ec6bf60 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -35,24 +35,24 @@ import org.apache.beam.sdk.values.TupleTagList;\n import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n \n /**\n- * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API from Google Cloud\n- * Healthcare. https://cloud.google.com/healthcare/docs/concepts/dicom\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n  */\n public class DicomIO {\n \n-  /** The type ReadDicomStudyMetadata. */\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n \n-    /**\n-     * This class makes a call to the retrieve metadata endpoint\n-     * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata It is\n-     * expecting a PubSub message as input, where the message's body will contain the path to the\n-     * study. You can learn how to configure PubSub messages to be published when an instance is\n-     * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-     * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-     * encoded as a json array.\n-     */\n     public ReadDicomStudyMetadata() {}\n \n     /** TupleTag for the main output. */\n"}}, {"oid": "d6b117204174442d73f0657aedaac8b26c090038", "url": "https://github.com/apache/beam/commit/d6b117204174442d73f0657aedaac8b26c090038", "message": "Made changes to the documentation for DicomIO", "committedDate": "2020-10-26T16:23:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE0Mzg5MQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512143891", "bodyText": "from instead of form and change the names here too..", "author": "poojavenkatram", "createdAt": "2020-10-26T17:31:49Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n+ */\n+public class DicomIO {\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER", "originalCommit": "d6b117204174442d73f0657aedaac8b26c090038", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex cc6ec6bf60..1e27948db4 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -36,19 +36,19 @@ import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.Immutabl\n \n /**\n  * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n- * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n  */\n public class DicomIO {\n \n   /**\n    * This class makes a call to the retrieve metadata endpoint\n-   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n-   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n-   * specified study.\n-   * You can learn how to configure PubSub messages to be published when an instance is\n-   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-   * encoded as a json array.\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadDicomStudyMetadata.Result} which will contain metadata of the study encoded as a json\n+   * array.\n    */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE1OTM0MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512159340", "bodyText": "the PcollectionTuple which contains the response", "author": "poojavenkatram", "createdAt": "2020-10-26T17:55:13Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n+ */\n+public class DicomIO {\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n+   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n+   * specified study.\n+   * You can learn how to configure PubSub messages to be published when an instance is\n+   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n+   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n+   * encoded as a json array.\n+   */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result form PCollectionTuple with OUT and DEAD_LETTER\n+       * tags.\n+       *\n+       * @param pct the pct", "originalCommit": "d6b117204174442d73f0657aedaac8b26c090038", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex cc6ec6bf60..1e27948db4 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -36,19 +36,19 @@ import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.Immutabl\n \n /**\n  * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n- * Healthcare API: https://cloud.google.com/healthcare/docs/how-tos#dicom-guide\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n  */\n public class DicomIO {\n \n   /**\n    * This class makes a call to the retrieve metadata endpoint\n-   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a function that can\n-   * be used to process a Pubsub message from a DICOM store, read the DICOM study path and get the metadata of the\n-   * specified study.\n-   * You can learn how to configure PubSub messages to be published when an instance is\n-   * stored by following: https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector\n-   * will output a {@link ReadDicomStudyMetadata.Result} which will contain metadata of the study\n-   * encoded as a json array.\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadDicomStudyMetadata.Result} which will contain metadata of the study encoded as a json\n+   * array.\n    */\n   public static class ReadDicomStudyMetadata\n       extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE2MDczOQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r512160739", "bodyText": "invalid DICOM web path", "author": "poojavenkatram", "createdAt": "2020-10-26T17:57:27Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java", "diffHunk": "@@ -196,6 +197,69 @@ public Empty deleteFhirStore(String name) throws IOException {\n     return client.projects().locations().datasets().fhirStores().delete(name).execute();\n   }\n \n+  @Override\n+  public String retrieveDicomStudyMetadata(String dicomWebPath) throws IOException {\n+    String[] webPathSplit;\n+    webPathSplit = dicomWebPath.split(\"/dicomWeb/\");\n+    if (webPathSplit.length != 2) {\n+      throw new IOException(\"Invalid Web Path\");\n+    }\n+\n+    String dicomStorePath = webPathSplit[0];\n+\n+    String[] searchParameters;\n+    searchParameters = webPathSplit[1].split(\"/\");\n+    if (searchParameters.length < 2) {\n+      throw new IOException(\"Invalid Web Path\");", "originalCommit": "d6b117204174442d73f0657aedaac8b26c090038", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\nindex c23376caa3..f66a30f2de 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/HttpHealthcareApiClient.java\n\n@@ -210,7 +210,7 @@ public class HttpHealthcareApiClient implements HealthcareApiClient, Serializabl\n     String[] searchParameters;\n     searchParameters = webPathSplit[1].split(\"/\");\n     if (searchParameters.length < 2) {\n-      throw new IOException(\"Invalid Web Path\");\n+      throw new IOException(\"Invalid DICOM web path\");\n     }\n     String studyId = searchParameters[1];\n \n"}}, {"oid": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "url": "https://github.com/apache/beam/commit/af247509a78bd0821fa53bdaa12b6f454ea186ef", "message": "[BEAM-11073] DicomIO documentation fixes", "committedDate": "2020-10-26T18:30:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MDIxNg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r516950216", "bodyText": "Transforms in Beam almost never are meant to be created via their constructor. I would recommend using a static class-level function (e.g. DicomIO.readStudyMetadata()), and making the constructor private.", "author": "pabloem", "createdAt": "2020-11-03T20:55:57Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ */\n+public class DicomIO {\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadDicomStudyMetadata.Result} which will contain metadata of the study encoded as a json\n+   * array.\n+   */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}", "originalCommit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "66e5640e9f2a27d29156bad25c504fac388509a5", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1e27948db4..a67baa4b8f 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -21,7 +21,6 @@ import java.io.IOException;\n import java.util.Collection;\n import java.util.Map;\n import org.apache.beam.sdk.Pipeline;\n-import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MDgzNA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r516950834", "bodyText": "I recommend adding richer documentation here. Consider the FhirIO Javadoc:\nhttps://beam.apache.org/releases/javadoc/2.23.0/index.html?org/apache/beam/sdk/io/gcp/healthcare/FhirIO.html\nAnd the code:\nhttps://github.com/apache/beam/blob/master/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/FhirIO.java#L91-L200", "author": "pabloem", "createdAt": "2020-11-03T20:57:11Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ */", "originalCommit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "66e5640e9f2a27d29156bad25c504fac388509a5", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1e27948db4..a67baa4b8f 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -21,7 +21,6 @@ import java.io.IOException;\n import java.util.Collection;\n import java.util.Map;\n import org.apache.beam.sdk.Pipeline;\n-import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MTg5NA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r516951894", "bodyText": "Is it possible to read study metadata coming from a source other than Pubsub? Perhaps a batch pipeline that reads a set of files?\nI am wondering if it makes sense to fix the input to a Pubsub Message. It sounds like you need a String containing a web path - wouldn't it make sense to receive a PCollection of String, so that users don't have to always pass a Pubsub message?\nAnother option is to make this a PTransform<PCollection<T>, DicomIO.ReadDicomStudyMetadata.Result>, and have a configuration parameter SimpleFunction<T, String> dicomPathFunction that users can pass to obtain the dicom path from the input object, but that feels like overkill : )", "author": "pabloem", "createdAt": "2020-11-03T20:59:20Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ */\n+public class DicomIO {\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadDicomStudyMetadata.Result} which will contain metadata of the study encoded as a json\n+   * array.\n+   */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {", "originalCommit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "66e5640e9f2a27d29156bad25c504fac388509a5", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1e27948db4..a67baa4b8f 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -21,7 +21,6 @@ import java.io.IOException;\n import java.util.Collection;\n import java.util.Map;\n import org.apache.beam.sdk.Pipeline;\n-import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MzQyNg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r516953426", "bodyText": "I see that you're making individual blocking requests to the dicomStore - I have a couple questions:\n\nDoes dicom support batched requests?\nDoes it support concurrent requests?\n\nIn this case, you're issuing individual, blocking calls, which may give your transform a very low throughput. If you can use batching and/or async IO, you should be able to reach a higher throughput.", "author": "pabloem", "createdAt": "2020-11-03T21:02:35Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ */\n+public class DicomIO {\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadDicomStudyMetadata.Result} which will contain metadata of the study encoded as a json\n+   * array.\n+   */\n+  public static class ReadDicomStudyMetadata\n+      extends PTransform<PCollection<PubsubMessage>, DicomIO.ReadDicomStudyMetadata.Result> {\n+\n+    public ReadDicomStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadDicomStudyMetadata.Result from PCollectionTuple which contains the\n+       * response (with METADATA and ERROR_MESSAGE tags).\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static DicomIO.ReadDicomStudyMetadata.Result of(PCollectionTuple pct)\n+          throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(METADATA).and(ERROR_MESSAGE))) {\n+          return new DicomIO.ReadDicomStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadDicomStudyMetadata.METADATA \"\n+                  + \"and DicomIO.ReadDicomStudyMetadata.ERROR_MESSAGE tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(METADATA);\n+        this.failedReads = pct.get(ERROR_MESSAGE);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(METADATA, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n+\n+    /**\n+     * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n+     */\n+    static class FetchStudyMetadataFn extends DoFn<PubsubMessage, String> {\n+\n+      private HealthcareApiClient dicomStore;\n+\n+      /**\n+       * Instantiate the healthcare client.\n+       *\n+       * @throws IOException\n+       */\n+      @Setup\n+      public void instantiateHealthcareClient() throws IOException {\n+        this.dicomStore = new HttpHealthcareApiClient();\n+      }\n+\n+      /**\n+       * Process The Pub/Sub message.\n+       *\n+       * @param context The input containing the pub/sub message\n+       */\n+      @ProcessElement\n+      public void processElement(ProcessContext context) {\n+        PubsubMessage msg = context.element();\n+        byte[] msgPayload = msg.getPayload();\n+        try {\n+          String dicomWebPath = new String(msgPayload, \"UTF-8\");\n+          String responseData = dicomStore.retrieveDicomStudyMetadata(dicomWebPath);\n+          context.output(METADATA, responseData);", "originalCommit": "af247509a78bd0821fa53bdaa12b6f454ea186ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzU5MjU4OA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r517592588", "bodyText": "The Dicom API does support async calls. As you suggested, it is probably better to make use of this.\nHowever, the read metadata endpoint is generally very fast, as it is transferring little data. So in the interest of time, would it be okay to leave it for now, and return to this in a later feature request?", "author": "Aliraza-N", "createdAt": "2020-11-04T19:50:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MzQyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM5NDEzMQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r518394131", "bodyText": "okay can you add a TODO there?", "author": "pabloem", "createdAt": "2020-11-05T21:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MzQyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDIxOQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r518770219", "bodyText": "Sure thing", "author": "Aliraza-N", "createdAt": "2020-11-06T14:02:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1MzQyNg=="}], "type": "inlineReview", "revised_code": {"commit": "66e5640e9f2a27d29156bad25c504fac388509a5", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex 1e27948db4..a67baa4b8f 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -21,7 +21,6 @@ import java.io.IOException;\n import java.util.Collection;\n import java.util.Map;\n import org.apache.beam.sdk.Pipeline;\n-import org.apache.beam.sdk.io.gcp.pubsub.PubsubMessage;\n import org.apache.beam.sdk.transforms.DoFn;\n import org.apache.beam.sdk.transforms.PTransform;\n import org.apache.beam.sdk.transforms.ParDo;\n"}}, {"oid": "66e5640e9f2a27d29156bad25c504fac388509a5", "url": "https://github.com/apache/beam/commit/66e5640e9f2a27d29156bad25c504fac388509a5", "message": "DicomIO - New docs + connector requires a String input", "committedDate": "2020-11-04T20:10:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM5MzcxNw==", "url": "https://github.com/apache/beam/pull/13137#discussion_r518393717", "bodyText": "ok one more question - does it make sense to just call it readStudyMetadata since we're already in DicomIO? Up to you.", "author": "pabloem", "createdAt": "2020-11-05T21:56:34Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -37,9 +36,27 @@\n /**\n  * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n  * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ *\n+ * <h3>Reading Study-Level Metadata</h3>\n+ *\n+ * The study-level metadata for a dicom instance can be read with {@link ReadDicomStudyMetadata}.\n+ * Retrieve the metadata of a dicom instance given its store path as a string. This will return a\n+ * {@link ReadDicomStudyMetadata.Result}. You can fetch the successful calls using\n+ * getReadResponse(), and any failed reads using getFailedReads().\n+ *\n+ * <h3>Example</h3>\n+ *\n+ * {@code Pipeline p = ... String webPath = ... DicomIO.ReadDicomStudyMetadata.Result\n+ * readMetadataResult = p .apply(Create.of(webPath)) PCollection<String> goodRead =\n+ * readMetadataResult.getReadResponse() PCollection<String> failRead =\n+ * readMetadataResult.getFailedReads() }\n  */\n public class DicomIO {\n \n+  public static ReadDicomStudyMetadata readDicomStudyMetadata() {", "originalCommit": "66e5640e9f2a27d29156bad25c504fac388509a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc3MDM2MQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r518770361", "bodyText": "Makes sense to me", "author": "Aliraza-N", "createdAt": "2020-11-06T14:02:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODM5MzcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "7bcbfa392b47d5a7fc6e7723c21ccf21529c4c08", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex a67baa4b8f..18ad83651e 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -39,22 +39,22 @@ import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.Immutabl\n  *\n  * <h3>Reading Study-Level Metadata</h3>\n  *\n- * The study-level metadata for a dicom instance can be read with {@link ReadDicomStudyMetadata}.\n+ * The study-level metadata for a dicom instance can be read with {@link ReadStudyMetadata}.\n  * Retrieve the metadata of a dicom instance given its store path as a string. This will return a\n- * {@link ReadDicomStudyMetadata.Result}. You can fetch the successful calls using\n- * getReadResponse(), and any failed reads using getFailedReads().\n+ * {@link ReadStudyMetadata.Result}. You can fetch the successful calls using getReadResponse(), and\n+ * any failed reads using getFailedReads().\n  *\n  * <h3>Example</h3>\n  *\n- * {@code Pipeline p = ... String webPath = ... DicomIO.ReadDicomStudyMetadata.Result\n- * readMetadataResult = p .apply(Create.of(webPath)) PCollection<String> goodRead =\n+ * {@code Pipeline p = ... String webPath = ... DicomIO.ReadStudyMetadata.Result readMetadataResult\n+ * = p .apply(Create.of(webPath)) PCollection<String> goodRead =\n  * readMetadataResult.getReadResponse() PCollection<String> failRead =\n  * readMetadataResult.getFailedReads() }\n  */\n public class DicomIO {\n \n-  public static ReadDicomStudyMetadata readDicomStudyMetadata() {\n-    return new ReadDicomStudyMetadata();\n+  public static ReadStudyMetadata readStudyMetadata() {\n+    return new ReadStudyMetadata();\n   }\n \n   /**\n"}}, {"oid": "7bcbfa392b47d5a7fc6e7723c21ccf21529c4c08", "url": "https://github.com/apache/beam/commit/7bcbfa392b47d5a7fc6e7723c21ccf21529c4c08", "message": "DicomIO Integration test", "committedDate": "2020-11-06T18:44:57Z", "type": "commit"}, {"oid": "1f62e66d8eab39da8df57613d5fba77b09a2d6ef", "url": "https://github.com/apache/beam/commit/1f62e66d8eab39da8df57613d5fba77b09a2d6ef", "message": "DicomIO fix compatibility with DirectRunner", "committedDate": "2020-11-09T15:02:01Z", "type": "commit"}, {"oid": "d41b42e5f0faa0ccf55043414086dc0eec1cb1c8", "url": "https://github.com/apache/beam/commit/d41b42e5f0faa0ccf55043414086dc0eec1cb1c8", "message": "DicomIO compile checks fix", "committedDate": "2020-11-09T15:40:32Z", "type": "commit"}, {"oid": "1d575b18ea5593b2bc404cfe00c3662ab5b32670", "url": "https://github.com/apache/beam/commit/1d575b18ea5593b2bc404cfe00c3662ab5b32670", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-11-10T18:37:39Z", "type": "commit"}, {"oid": "164b36f344aa4ffb87c26ca8e318e57967476e63", "url": "https://github.com/apache/beam/commit/164b36f344aa4ffb87c26ca8e318e57967476e63", "message": "Merge branch 'master' of https://github.com/Aliraza-N/beam", "committedDate": "2020-11-10T18:44:37Z", "type": "commit"}, {"oid": "5bcaad787db9e98a239ef44d62c80a6b3ce42bf6", "url": "https://github.com/apache/beam/commit/5bcaad787db9e98a239ef44d62c80a6b3ce42bf6", "message": "DicomIO remove old constructor", "committedDate": "2020-11-10T18:46:24Z", "type": "commit"}, {"oid": "ac04754a56906de19b3f3467ee63adce9d94a847", "url": "https://github.com/apache/beam/commit/ac04754a56906de19b3f3467ee63adce9d94a847", "message": "DicomIO suppress warnings that contradict beam model", "committedDate": "2020-11-10T20:23:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMTU4NQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r522331585", "bodyText": "can you add a PAssert verification here? To verify that the expected message shows up?", "author": "pabloem", "createdAt": "2020-11-12T18:40:35Z", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import static org.apache.beam.sdk.io.gcp.healthcare.HL7v2IOTestUtil.HEALTHCARE_DATASET_TEMPLATE;\n+\n+import java.io.IOException;\n+import org.apache.beam.sdk.PipelineResult;\n+import org.apache.beam.sdk.testing.TestPipeline;\n+import org.apache.beam.sdk.transforms.Create;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@SuppressWarnings({\"nullness\", \"rawtypes\", \"uninitialized\"})\n+public class DicomIOReadIT {\n+  @Rule public transient TestPipeline pipeline = TestPipeline.create();\n+\n+  private String healthcareDataset;\n+  private String project;\n+  private HealthcareApiClient client;\n+  private String storeName = \"foo\";\n+\n+  @Before\n+  public void setup() throws IOException {\n+    project =\n+        TestPipeline.testingPipelineOptions()\n+            .as(HealthcareStoreTestPipelineOptions.class)\n+            .getStoreProjectId();\n+    healthcareDataset = String.format(HEALTHCARE_DATASET_TEMPLATE, project);\n+    client = new HttpHealthcareApiClient();\n+\n+    client.createDicomStore(healthcareDataset, storeName);\n+  }\n+\n+  @After\n+  public void deleteDicomStore() throws IOException {\n+    client.deleteDicomStore(healthcareDataset + \"/dicomStores/\" + storeName);\n+  }\n+\n+  @Test\n+  public void testDicomMetadataRead() throws IOException {\n+    String webPath =\n+        String.format(\"%s/dicomStores/%s/dicomWeb/studies/\", healthcareDataset, storeName);\n+\n+    DicomIO.ReadStudyMetadata.Result result =\n+        pipeline.apply(Create.of(webPath)).apply(DicomIO.readStudyMetadata());", "originalCommit": "ac04754a56906de19b3f3467ee63adce9d94a847", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6c4a87f1881256c1130aec2fb347f290e8efcc1b", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\nindex 297078609f..f6a562d658 100644\n--- a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\n+++ b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\n\n@@ -20,7 +20,9 @@ package org.apache.beam.sdk.io.gcp.healthcare;\n import static org.apache.beam.sdk.io.gcp.healthcare.HL7v2IOTestUtil.HEALTHCARE_DATASET_TEMPLATE;\n \n import java.io.IOException;\n+import java.net.URISyntaxException;\n import org.apache.beam.sdk.PipelineResult;\n+import org.apache.beam.sdk.testing.PAssert;\n import org.apache.beam.sdk.testing.TestPipeline;\n import org.apache.beam.sdk.transforms.Create;\n import org.junit.After;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMjA1OQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r522332059", "bodyText": "Maybe - can you create a JIRA issue, and add // TODO(BEAM-XXXX) Change to non-blocking async calls here?", "author": "pabloem", "createdAt": "2020-11-12T18:41:21Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ *\n+ * <h3>Reading Study-Level Metadata</h3>\n+ *\n+ * The study-level metadata for a dicom instance can be read with {@link ReadStudyMetadata}.\n+ * Retrieve the metadata of a dicom instance given its store path as a string. This will return a\n+ * {@link ReadStudyMetadata.Result}. You can fetch the successful calls using getReadResponse(), and\n+ * any failed reads using getFailedReads().\n+ *\n+ * <h3>Example</h3>\n+ *\n+ * {@code Pipeline p = ... String webPath = ... DicomIO.ReadStudyMetadata.Result readMetadataResult\n+ * = p .apply(Create.of(webPath)) PCollection<String> goodRead =\n+ * readMetadataResult.getReadResponse() PCollection<String> failRead =\n+ * readMetadataResult.getFailedReads() }\n+ */\n+public class DicomIO {\n+\n+  public static ReadStudyMetadata readStudyMetadata() {\n+    return new ReadStudyMetadata();\n+  }\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadStudyMetadata.Result} which will contain metadata of the study encoded as a json array.\n+   */\n+  public static class ReadStudyMetadata\n+      extends PTransform<PCollection<String>, ReadStudyMetadata.Result> {\n+\n+    private ReadStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadStudyMetadata.Result from PCollectionTuple which contains the response\n+       * (with METADATA and ERROR_MESSAGE tags).\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static ReadStudyMetadata.Result of(PCollectionTuple pct) throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(METADATA).and(ERROR_MESSAGE))) {\n+          return new ReadStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadStudyMetadata.METADATA \"\n+                  + \"and DicomIO.ReadStudyMetadata.ERROR_MESSAGE tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(METADATA);\n+        this.failedReads = pct.get(ERROR_MESSAGE);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(METADATA, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n+\n+    /**\n+     * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n+     */\n+    @SuppressWarnings({\"nullness\", \"rawtypes\"})\n+    static class FetchStudyMetadataFn extends DoFn<String, String> {\n+\n+      private HealthcareApiClient dicomStore;\n+\n+      /**\n+       * Instantiate the healthcare client.\n+       *\n+       * @throws IOException\n+       */\n+      @Setup\n+      public void instantiateHealthcareClient() throws IOException {\n+        if (dicomStore == null) {\n+          this.dicomStore = new HttpHealthcareApiClient();\n+        }\n+      }\n+\n+      /**\n+       * Process The Pub/Sub message.\n+       *\n+       * @param context The input containing the pub/sub message\n+       */\n+      @ProcessElement\n+      public void processElement(ProcessContext context) {\n+        String dicomWebPath = context.element();\n+        try {\n+          // TODO Change to non-blocking async calls", "originalCommit": "ac04754a56906de19b3f3467ee63adce9d94a847", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6c4a87f1881256c1130aec2fb347f290e8efcc1b", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex c653a32a39..bede5545d3 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -151,6 +151,8 @@ public class DicomIO {\n \n       private HealthcareApiClient dicomStore;\n \n+      FetchStudyMetadataFn() {}\n+\n       /**\n        * Instantiate the healthcare client.\n        *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMzY2Mw==", "url": "https://github.com/apache/beam/pull/13137#discussion_r522333663", "bodyText": "I suspect that if you do this, you can remove the nullness condition in SuppressWarnings?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  private HealthcareApiClient dicomStore;\n          \n          \n            \n                  private HealthcareApiClient dicomStore = new HttpHealthcareApiClient();", "author": "pabloem", "createdAt": "2020-11-12T18:44:07Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import java.io.IOException;\n+import java.util.Collection;\n+import java.util.Map;\n+import org.apache.beam.sdk.Pipeline;\n+import org.apache.beam.sdk.transforms.DoFn;\n+import org.apache.beam.sdk.transforms.PTransform;\n+import org.apache.beam.sdk.transforms.ParDo;\n+import org.apache.beam.sdk.values.PCollection;\n+import org.apache.beam.sdk.values.PCollectionTuple;\n+import org.apache.beam.sdk.values.PInput;\n+import org.apache.beam.sdk.values.POutput;\n+import org.apache.beam.sdk.values.PValue;\n+import org.apache.beam.sdk.values.TupleTag;\n+import org.apache.beam.sdk.values.TupleTagList;\n+import org.apache.beam.vendor.guava.v26_0_jre.com.google.common.collect.ImmutableMap;\n+\n+/**\n+ * The DicomIO connectors allows Beam pipelines to make calls to the Dicom API of the Google Cloud\n+ * Healthcare API (https://cloud.google.com/healthcare/docs/how-tos#dicom-guide).\n+ *\n+ * <h3>Reading Study-Level Metadata</h3>\n+ *\n+ * The study-level metadata for a dicom instance can be read with {@link ReadStudyMetadata}.\n+ * Retrieve the metadata of a dicom instance given its store path as a string. This will return a\n+ * {@link ReadStudyMetadata.Result}. You can fetch the successful calls using getReadResponse(), and\n+ * any failed reads using getFailedReads().\n+ *\n+ * <h3>Example</h3>\n+ *\n+ * {@code Pipeline p = ... String webPath = ... DicomIO.ReadStudyMetadata.Result readMetadataResult\n+ * = p .apply(Create.of(webPath)) PCollection<String> goodRead =\n+ * readMetadataResult.getReadResponse() PCollection<String> failRead =\n+ * readMetadataResult.getFailedReads() }\n+ */\n+public class DicomIO {\n+\n+  public static ReadStudyMetadata readStudyMetadata() {\n+    return new ReadStudyMetadata();\n+  }\n+\n+  /**\n+   * This class makes a call to the retrieve metadata endpoint\n+   * (https://cloud.google.com/healthcare/docs/how-tos/dicomweb#retrieving_metadata). It defines a\n+   * function that can be used to process a Pubsub message from a DICOM store, read the DICOM study\n+   * path and get the metadata of the specified study. You can learn how to configure PubSub\n+   * messages to be published when an instance is stored by following:\n+   * https://cloud.google.com/healthcare/docs/how-tos/pubsub. The connector will output a {@link\n+   * ReadStudyMetadata.Result} which will contain metadata of the study encoded as a json array.\n+   */\n+  public static class ReadStudyMetadata\n+      extends PTransform<PCollection<String>, ReadStudyMetadata.Result> {\n+\n+    private ReadStudyMetadata() {}\n+\n+    /** TupleTag for the main output. */\n+    public static final TupleTag<String> METADATA = new TupleTag<String>() {};\n+    /** TupleTag for any error response. */\n+    public static final TupleTag<String> ERROR_MESSAGE = new TupleTag<String>() {};\n+\n+    public static class Result implements POutput, PInput {\n+      private PCollection<String> readResponse;\n+\n+      private PCollection<String> failedReads;\n+\n+      /** Contains both the response and error outputs from the transformation. */\n+      PCollectionTuple pct;\n+\n+      /**\n+       * Create DicomIO.ReadStudyMetadata.Result from PCollectionTuple which contains the response\n+       * (with METADATA and ERROR_MESSAGE tags).\n+       *\n+       * @param pct the pct\n+       * @return the read result\n+       * @throws IllegalArgumentException the illegal argument exception\n+       */\n+      static ReadStudyMetadata.Result of(PCollectionTuple pct) throws IllegalArgumentException {\n+        if (pct.getAll()\n+            .keySet()\n+            .containsAll((Collection<?>) TupleTagList.of(METADATA).and(ERROR_MESSAGE))) {\n+          return new ReadStudyMetadata.Result(pct);\n+        } else {\n+          throw new IllegalArgumentException(\n+              \"The PCollection tuple must have the DicomIO.ReadStudyMetadata.METADATA \"\n+                  + \"and DicomIO.ReadStudyMetadata.ERROR_MESSAGE tuple tags\");\n+        }\n+      }\n+\n+      private Result(PCollectionTuple pct) {\n+        this.pct = pct;\n+        this.readResponse = pct.get(METADATA);\n+        this.failedReads = pct.get(ERROR_MESSAGE);\n+      }\n+\n+      /**\n+       * Gets failed reads.\n+       *\n+       * @return the failed reads\n+       */\n+      public PCollection<String> getFailedReads() {\n+        return failedReads;\n+      }\n+\n+      /**\n+       * Gets resources.\n+       *\n+       * @return the resources\n+       */\n+      public PCollection<String> getReadResponse() {\n+        return readResponse;\n+      }\n+\n+      @Override\n+      public Pipeline getPipeline() {\n+        return this.pct.getPipeline();\n+      }\n+\n+      @Override\n+      public Map<TupleTag<?>, PValue> expand() {\n+        return ImmutableMap.of(METADATA, readResponse);\n+      }\n+\n+      @Override\n+      public void finishSpecifyingOutput(\n+          String transformName, PInput input, PTransform<?, ?> transform) {}\n+    }\n+\n+    /**\n+     * DoFn to fetch the metadata of a study from a Dicom store based on it's location and study id.\n+     */\n+    @SuppressWarnings({\"nullness\", \"rawtypes\"})\n+    static class FetchStudyMetadataFn extends DoFn<String, String> {\n+\n+      private HealthcareApiClient dicomStore;", "originalCommit": "ac04754a56906de19b3f3467ee63adce9d94a847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzNDMwMQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r522334301", "bodyText": "Maybe you also need to add null checks in process... up to you.", "author": "pabloem", "createdAt": "2020-11-12T18:45:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMzY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ3NDI3NQ==", "url": "https://github.com/apache/beam/pull/13137#discussion_r522474275", "bodyText": "Hmm I'm still failing compileJava.", "author": "Aliraza-N", "createdAt": "2020-11-12T22:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjMzMzY2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6c4a87f1881256c1130aec2fb347f290e8efcc1b", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\nindex c653a32a39..bede5545d3 100644\n--- a/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n+++ b/sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIO.java\n\n@@ -151,6 +151,8 @@ public class DicomIO {\n \n       private HealthcareApiClient dicomStore;\n \n+      FetchStudyMetadataFn() {}\n+\n       /**\n        * Instantiate the healthcare client.\n        *\n"}}, {"oid": "6c4a87f1881256c1130aec2fb347f290e8efcc1b", "url": "https://github.com/apache/beam/commit/6c4a87f1881256c1130aec2fb347f290e8efcc1b", "message": "DicomIO - updated integration test + small fixes", "committedDate": "2020-11-12T22:35:23Z", "type": "commit"}, {"oid": "f923e67df39b119008be9ba8d0f83e1daf026a20", "url": "https://github.com/apache/beam/commit/f923e67df39b119008be9ba8d0f83e1daf026a20", "message": "DicomIO - added null checks after supressing warnings", "committedDate": "2020-11-13T15:54:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzExMDg3MA==", "url": "https://github.com/apache/beam/pull/13137#discussion_r523110870", "bodyText": "Does it make sense to add a positive PAssert as well? Verifying that the content you inserted is still there?", "author": "pabloem", "createdAt": "2020-11-13T17:30:15Z", "path": "sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.beam.sdk.io.gcp.healthcare;\n+\n+import static org.apache.beam.sdk.io.gcp.healthcare.HL7v2IOTestUtil.HEALTHCARE_DATASET_TEMPLATE;\n+\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import org.apache.beam.sdk.PipelineResult;\n+import org.apache.beam.sdk.testing.PAssert;\n+import org.apache.beam.sdk.testing.TestPipeline;\n+import org.apache.beam.sdk.transforms.Create;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Rule;\n+import org.junit.Test;\n+\n+@SuppressWarnings({\"nullness\", \"rawtypes\", \"uninitialized\"})\n+public class DicomIOReadIT {\n+  private static final String TEST_FILE_PATH = \"src/test/resources/DICOM/testDicomFile.dcm\";\n+  private static final String TEST_FILE_STUDY_ID = \"study_000000000\";\n+  @Rule public transient TestPipeline pipeline = TestPipeline.create();\n+\n+  private String healthcareDataset;\n+  private String project;\n+  private HealthcareApiClient client;\n+  private String storeName = \"foo\";\n+\n+  @Before\n+  public void setup() throws IOException, URISyntaxException {\n+    project =\n+        TestPipeline.testingPipelineOptions()\n+            .as(HealthcareStoreTestPipelineOptions.class)\n+            .getStoreProjectId();\n+    healthcareDataset = String.format(HEALTHCARE_DATASET_TEMPLATE, project);\n+    client = new HttpHealthcareApiClient();\n+\n+    client.createDicomStore(healthcareDataset, storeName);\n+    client.uploadToDicomStore(healthcareDataset + \"/dicomStores/\" + storeName, TEST_FILE_PATH);\n+  }\n+\n+  @After\n+  public void deleteDicomStore() throws IOException {\n+    client.deleteDicomStore(healthcareDataset + \"/dicomStores/\" + storeName);\n+  }\n+\n+  @Test\n+  public void testDicomMetadataRead() throws IOException {\n+    String webPath =\n+        String.format(\n+            \"%s/dicomStores/%s/dicomWeb/studies/%s\",\n+            healthcareDataset, storeName, TEST_FILE_STUDY_ID);\n+\n+    DicomIO.ReadStudyMetadata.Result result =\n+        pipeline.apply(Create.of(webPath)).apply(DicomIO.readStudyMetadata());\n+\n+    PAssert.that(result.getFailedReads()).empty();", "originalCommit": "f923e67df39b119008be9ba8d0f83e1daf026a20", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzExMzQyMg==", "url": "https://github.com/apache/beam/pull/13137#discussion_r523113422", "bodyText": "Makes sense to me!", "author": "Aliraza-N", "createdAt": "2020-11-13T17:33:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzExMDg3MA=="}], "type": "inlineReview", "revised_code": {"commit": "9b59713c663e0d53462d201d7104f37a43c088fa", "chunk": "diff --git a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\nindex f6a562d658..36fdb57af2 100644\n--- a/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\n+++ b/sdks/java/io/google-cloud-platform/src/test/java/org/apache/beam/sdk/io/gcp/healthcare/DicomIOReadIT.java\n\n@@ -26,6 +26,7 @@ import org.apache.beam.sdk.testing.PAssert;\n import org.apache.beam.sdk.testing.TestPipeline;\n import org.apache.beam.sdk.transforms.Create;\n import org.junit.After;\n+import org.junit.Assert;\n import org.junit.Before;\n import org.junit.Rule;\n import org.junit.Test;\n"}}, {"oid": "9b59713c663e0d53462d201d7104f37a43c088fa", "url": "https://github.com/apache/beam/commit/9b59713c663e0d53462d201d7104f37a43c088fa", "message": "Dicom IO - more checks in IT", "committedDate": "2020-11-13T20:03:46Z", "type": "commit"}, {"oid": "28ef111ea5d69d02286bf9aa54fdcdff1ef61d4b", "url": "https://github.com/apache/beam/commit/28ef111ea5d69d02286bf9aa54fdcdff1ef61d4b", "message": "GCP healthcare IO - new utility class for parsing webpaths", "committedDate": "2020-11-26T15:47:12Z", "type": "commit"}, {"oid": "63e22da3adcbc4ba61f0e194b674f2074b46aa8b", "url": "https://github.com/apache/beam/commit/63e22da3adcbc4ba61f0e194b674f2074b46aa8b", "message": "GCP Webpath parser - handle null warnings", "committedDate": "2020-11-26T18:53:38Z", "type": "commit"}, {"oid": "069a4e827431d2370520b18fd5126753672b0f3d", "url": "https://github.com/apache/beam/commit/069a4e827431d2370520b18fd5126753672b0f3d", "message": "Dicom API method uses Webpath parser", "committedDate": "2020-11-26T21:32:04Z", "type": "commit"}]}