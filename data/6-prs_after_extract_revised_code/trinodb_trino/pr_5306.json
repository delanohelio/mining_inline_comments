{"pr_number": 5306, "pr_title": "Used fixed session time/offset for time tests", "pr_createdAt": "2020-09-27T04:51:42Z", "pr_url": "https://github.com/trinodb/trino/pull/5306", "timeline": [{"oid": "dd92850b4a1f14ca5885fce56a9d982c947633a7", "url": "https://github.com/trinodb/trino/commit/dd92850b4a1f14ca5885fce56a9d982c947633a7", "message": "Used fixed session time for time test\n\nAT TIME ZONE for TIME is performed by converting the TIME value\nto TIME WITH TIME ZONE using the session time zone before applying\nAT TIME ZONE.  When the session time zone is a political time zone,\nthe offset is determined based on the rules at the session start time.\n\nThis change fixes the session start time to a known value to make\nthe conversion from political timezone to offset deterministic.", "committedDate": "2020-09-27T05:15:49Z", "type": "commit"}, {"oid": "8a77d4a20914ed1f43baab03973c8b135ee4acab", "url": "https://github.com/trinodb/trino/commit/8a77d4a20914ed1f43baab03973c8b135ee4acab", "message": "Use fixed offset for test\n\nThe conversion from TIMESTAMP to TIME WITH TIME ZONE relies on the\nsession time zone. When the session time zone is a political time zone,\nthe offset is determined based on the rules at the session start time.\n\nThis change uses a fixed offset to avoid an offset shift due to DST\nrules, which changes the values and affects the result of approx_distinct.", "committedDate": "2020-09-27T05:16:00Z", "type": "commit"}, {"oid": "8a77d4a20914ed1f43baab03973c8b135ee4acab", "url": "https://github.com/trinodb/trino/commit/8a77d4a20914ed1f43baab03973c8b135ee4acab", "message": "Use fixed offset for test\n\nThe conversion from TIMESTAMP to TIME WITH TIME ZONE relies on the\nsession time zone. When the session time zone is a political time zone,\nthe offset is determined based on the rules at the session start time.\n\nThis change uses a fixed offset to avoid an offset shift due to DST\nrules, which changes the values and affects the result of approx_distinct.", "committedDate": "2020-09-27T05:16:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5NzkyMA==", "url": "https://github.com/trinodb/trino/pull/5306#discussion_r495597920", "bodyText": "use same zone as used for setTimeZoneKey instead of assertions.getDefaultSession().getTimeZoneKey()\n(or use UTC if you want do not want to have the same)", "author": "findepi", "createdAt": "2020-09-27T17:54:57Z", "path": "presto-main/src/test/java/io/prestosql/operator/scalar/time/TestTime.java", "diffHunk": "@@ -1660,6 +1660,7 @@ public void testAtTimeZone()\n     {\n         Session session = assertions.sessionBuilder()\n                 .setTimeZoneKey(TimeZoneKey.getTimeZoneKey(\"Pacific/Apia\"))\n+                .setStart(Instant.from(ZonedDateTime.of(2020, 5, 1, 12, 0, 0, 0, assertions.getDefaultSession().getTimeZoneKey().getZoneId())))", "originalCommit": "dd92850b4a1f14ca5885fce56a9d982c947633a7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}