{"pr_number": 4457, "pr_title": "Ensure column type is always string for CSV tables", "pr_createdAt": "2020-07-15T13:52:21Z", "pr_url": "https://github.com/trinodb/trino/pull/4457", "timeline": [{"oid": "c78d90a6fb6528699c8cc1100193c4df7e5122bc", "url": "https://github.com/trinodb/trino/commit/c78d90a6fb6528699c8cc1100193c4df7e5122bc", "message": "Ensure column type is always string for CSV tables", "committedDate": "2020-07-16T08:45:00Z", "type": "commit"}, {"oid": "c78d90a6fb6528699c8cc1100193c4df7e5122bc", "url": "https://github.com/trinodb/trino/commit/c78d90a6fb6528699c8cc1100193c4df7e5122bc", "message": "Ensure column type is always string for CSV tables", "committedDate": "2020-07-16T08:45:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYzNTcyNA==", "url": "https://github.com/trinodb/trino/pull/4457#discussion_r455635724", "bodyText": "Also update https://prestosql.io/docs/current/connector/hive.html#metastore-configuration-for-avro-and-csv\nit's no longer required for CSV.", "author": "findepi", "createdAt": "2020-07-16T09:02:24Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/BridgingHiveMetastore.java", "diffHunk": "@@ -86,9 +87,12 @@ public BridgingHiveMetastore(ThriftMetastore delegate)\n     public Optional<Table> getTable(HiveIdentity identity, String databaseName, String tableName)\n     {\n         return delegate.getTable(identity, databaseName, tableName).map(table -> {\n-            if (isAvroTableWithSchemaSet(table) || isCsvTable(table)) {", "originalCommit": "c78d90a6fb6528699c8cc1100193c4df7e5122bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY4MjA2OQ==", "url": "https://github.com/trinodb/trino/pull/4457#discussion_r455682069", "bodyText": "\ud83d\udc4d", "author": "wendigo", "createdAt": "2020-07-16T10:20:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYzNTcyNA=="}], "type": "inlineReview", "revised_code": {"commit": "5729f90083cacc3ed038dfac64036a54a089e3c5", "chunk": "diff --git a/presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/BridgingHiveMetastore.java b/presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/BridgingHiveMetastore.java\nindex 2e663bf6ac..1cb15262a5 100644\n--- a/presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/BridgingHiveMetastore.java\n+++ b/presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/BridgingHiveMetastore.java\n\n@@ -88,7 +88,7 @@ public class BridgingHiveMetastore\n     {\n         return delegate.getTable(identity, databaseName, tableName).map(table -> {\n             if (isAvroTableWithSchemaSet(table)) {\n-                return fromMetastoreApiTable(table, delegate.getFields(identity, databaseName, tableName).get());\n+                return fromMetastoreApiTable(table, delegate.getFields(identity, databaseName, tableName).orElseThrow());\n             }\n             if (isCsvTable(table)) {\n                 return fromMetastoreApiTable(table, csvSchemaFields(table.getSd().getCols()));\n"}}, {"oid": "5729f90083cacc3ed038dfac64036a54a089e3c5", "url": "https://github.com/trinodb/trino/commit/5729f90083cacc3ed038dfac64036a54a089e3c5", "message": "Prefer orElseThrow over unguarded get on Optional", "committedDate": "2020-07-16T09:40:43Z", "type": "commit"}, {"oid": "dd5ad55cd63f16f6c7bf8050ad4351c524956842", "url": "https://github.com/trinodb/trino/commit/dd5ad55cd63f16f6c7bf8050ad4351c524956842", "message": "Update docs on requirements for CSV support", "committedDate": "2020-07-16T10:55:38Z", "type": "commit"}, {"oid": "dd5ad55cd63f16f6c7bf8050ad4351c524956842", "url": "https://github.com/trinodb/trino/commit/dd5ad55cd63f16f6c7bf8050ad4351c524956842", "message": "Update docs on requirements for CSV support", "committedDate": "2020-07-16T10:55:38Z", "type": "forcePushed"}]}