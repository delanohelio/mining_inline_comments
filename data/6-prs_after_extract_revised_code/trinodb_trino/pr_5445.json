{"pr_number": 5445, "pr_title": "Add more Oracle tests", "pr_createdAt": "2020-10-07T12:39:02Z", "pr_url": "https://github.com/trinodb/trino/pull/5445", "timeline": [{"oid": "1bae86424489cefdd4cd2554e14818e29f25c462", "url": "https://github.com/trinodb/trino/commit/1bae86424489cefdd4cd2554e14818e29f25c462", "message": "Make TestOracleDistributedQueries extensible", "committedDate": "2020-10-08T06:31:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU4NzEzMQ==", "url": "https://github.com/trinodb/trino/pull/5445#discussion_r501587131", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .map(columnName -> new Object[] {columnName})\n          \n          \n            \n                            .toArray(Object[][]::new);\n          \n          \n            \n                            .collect(toDataProvider());", "author": "losipiuk", "createdAt": "2020-10-08T09:44:26Z", "path": "presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java", "diffHunk": "@@ -1362,28 +1362,43 @@ private static boolean requiresDelimiting(String identifierName)\n     @DataProvider\n     public Object[][] testColumnNameDataProvider()\n     {\n-        return new Object[][] {\n-                {\"lowercase\"},\n-                {\"UPPERCASE\"},\n-                {\"MixedCase\"},\n-                {\"an_underscore\"},\n-                {\"a-hyphen-minus\"}, // ASCII '-' is HYPHEN-MINUS in Unicode\n-                {\"a space\"},\n-                {\"atrailingspace \"},\n-                {\" aleadingspace\"},\n-                {\"a.dot\"},\n-                {\"a,comma\"},\n-                {\"a:colon\"},\n-                {\"a;semicolon\"},\n-                {\"an@at\"},\n-                {\"a\\\"quote\"},\n-                {\"an'apostrophe\"},\n-                {\"a`backtick`\"},\n-                {\"a/slash`\"},\n-                {\"a\\\\backslash`\"},\n-                {\"adigit0\"},\n-                {\"0startwithdigit\"},\n-        };\n+        return testColumnNameTestData().stream()\n+                .map(this::filterColumnNameTestData)\n+                .filter(Optional::isPresent)\n+                .map(Optional::get)\n+                .map(columnName -> new Object[] {columnName})\n+                .toArray(Object[][]::new);", "originalCommit": "1bae86424489cefdd4cd2554e14818e29f25c462", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0a82e3c9fe2f7930f89961d2a060dd47343a9fcd", "chunk": "diff --git a/presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java b/presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java\nindex bbd3261303..a4e6c60600 100644\n--- a/presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java\n+++ b/presto-testing/src/main/java/io/prestosql/testing/AbstractTestDistributedQueries.java\n\n@@ -1366,8 +1367,7 @@ public abstract class AbstractTestDistributedQueries\n                 .map(this::filterColumnNameTestData)\n                 .filter(Optional::isPresent)\n                 .map(Optional::get)\n-                .map(columnName -> new Object[] {columnName})\n-                .toArray(Object[][]::new);\n+                .collect(toDataProvider());\n     }\n \n     private List<String> testColumnNameTestData()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5MDI3Nw==", "url": "https://github.com/trinodb/trino/pull/5445#discussion_r501590277", "bodyText": "why not\n    protected SqlExecutor createJdbcSqlExecutor()\n    {\n        return oracleServer::execute;\n    }", "author": "losipiuk", "createdAt": "2020-10-08T09:49:27Z", "path": "presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java", "diffHunk": "@@ -391,8 +395,17 @@ public void testInsertWithCoercion()\n     }\n \n     @Override\n-    public void testColumnName(String columnName)\n+    protected Optional<String> filterColumnNameTestData(String columnName)\n     {\n         // table names generated has more than 30chars, max size naming on oracle.\n+        return Optional.empty();\n+    }\n+\n+    protected JdbcSqlExecutor createJdbcSqlExecutor()\n+    {\n+        Properties properties = new Properties();\n+        properties.setProperty(\"user\", TEST_USER);\n+        properties.setProperty(\"password\", TEST_PASS);\n+        return new JdbcSqlExecutor(oracleServer.getJdbcUrl(), properties);", "originalCommit": "1bae86424489cefdd4cd2554e14818e29f25c462", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTYwMzk1Ng==", "url": "https://github.com/trinodb/trino/pull/5445#discussion_r501603956", "bodyText": "Changed as suggested.\nI can follow this up in a cleanup for all JDBC tests since all JDBC TestingServers do implement SqlExecutor's execute(sql) but don't explicitly implement that interface.\nWould be nice to be consistent and encapsulate the behavior where possible.", "author": "hashhar", "createdAt": "2020-10-08T10:11:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5MDI3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "0a82e3c9fe2f7930f89961d2a060dd47343a9fcd", "chunk": "diff --git a/presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java b/presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java\nindex 9d0134ec82..e5c1bca835 100644\n--- a/presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java\n+++ b/presto-oracle/src/test/java/io/prestosql/plugin/oracle/TestOracleDistributedQueries.java\n\n@@ -401,11 +398,8 @@ public class TestOracleDistributedQueries\n         return Optional.empty();\n     }\n \n-    protected JdbcSqlExecutor createJdbcSqlExecutor()\n+    protected SqlExecutor createJdbcSqlExecutor()\n     {\n-        Properties properties = new Properties();\n-        properties.setProperty(\"user\", TEST_USER);\n-        properties.setProperty(\"password\", TEST_PASS);\n-        return new JdbcSqlExecutor(oracleServer.getJdbcUrl(), properties);\n+        return oracleServer::execute;\n     }\n }\n"}}, {"oid": "0a82e3c9fe2f7930f89961d2a060dd47343a9fcd", "url": "https://github.com/trinodb/trino/commit/0a82e3c9fe2f7930f89961d2a060dd47343a9fcd", "message": "fixup! Make TestOracleDistributedQueries extensible", "committedDate": "2020-10-08T10:15:22Z", "type": "commit"}]}