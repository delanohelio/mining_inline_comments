{"pr_number": 5289, "pr_title": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit", "pr_createdAt": "2020-09-24T19:07:55Z", "pr_url": "https://github.com/trinodb/trino/pull/5289", "timeline": [{"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b", "url": "https://github.com/trinodb/trino/commit/22f06fa644b9a29681b2c5a324f15dbe2665d98b", "message": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit\n\nPrior to this change, if the HttpPageBufferClient caused a task to\nexceed its memory limit inside of addPages, the exception would bubble\nto the root of the exchange client callback executor without ever\nmarking the task as failed. If no other operator also saw the memory\nlimit exceeded condition, then the task would become stuck in a deadlocked\nstate.", "committedDate": "2020-09-25T12:23:02Z", "type": "commit"}, {"oid": "22f06fa644b9a29681b2c5a324f15dbe2665d98b", "url": "https://github.com/trinodb/trino/commit/22f06fa644b9a29681b2c5a324f15dbe2665d98b", "message": "Fix potential deadlock when HttpPageBufferClient exceeds memory limit\n\nPrior to this change, if the HttpPageBufferClient caused a task to\nexceed its memory limit inside of addPages, the exception would bubble\nto the root of the exchange client callback executor without ever\nmarking the task as failed. If no other operator also saw the memory\nlimit exceeded condition, then the task would become stuck in a deadlocked\nstate.", "committedDate": "2020-09-25T12:23:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NDg5MA==", "url": "https://github.com/trinodb/trino/pull/5289#discussion_r495764890", "bodyText": "nit: this could be separate commit", "author": "sopel39", "createdAt": "2020-09-28T08:17:12Z", "path": "presto-main/src/test/java/io/prestosql/operator/TestHttpPageBufferClient.java", "diffHunk": "@@ -237,7 +244,7 @@ public void testInvalidResponses()\n                 \"localhost\",\n                 new TestingHttpClient(processor, scheduler),\n                 DataIntegrityVerification.ABORT,\n-                DataSize.of(10, Unit.MEGABYTE),", "originalCommit": "22f06fa644b9a29681b2c5a324f15dbe2665d98b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}