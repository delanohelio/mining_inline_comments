{"pr_number": 5980, "pr_title": "Test Hive VIEW with JOIN and subquery", "pr_createdAt": "2020-11-16T16:46:31Z", "pr_url": "https://github.com/trinodb/trino/pull/5980", "timeline": [{"oid": "be4e463119cd254a62a1e3faecade3a389172814", "url": "https://github.com/trinodb/trino/commit/be4e463119cd254a62a1e3faecade3a389172814", "message": "Test Hive VIEW with JOIN and subquery", "committedDate": "2020-11-16T16:45:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NDQ5OQ==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524584499", "bodyText": "Why do you remove it? You are using nation table so it should be somehow provisioned. I guess in your case it was provisioned for other test.", "author": "kokosing", "createdAt": "2020-11-16T21:10:25Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */\n package io.prestosql.tests.hive;\n \n-import io.prestosql.tempto.Requirement;\n-import io.prestosql.tempto.RequirementsProvider;\n+import io.prestosql.tempto.Requires;\n import io.prestosql.tempto.assertions.QueryAssert;\n-import io.prestosql.tempto.configuration.Configuration;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableNationTable;\n+import io.prestosql.tempto.fulfillment.table.hive.tpch.ImmutableTpchTablesRequirements.ImmutableOrdersTable;\n import io.prestosql.tempto.query.QueryResult;\n import org.testng.annotations.Test;\n \n import java.math.BigDecimal;\n+import java.sql.Date;\n+import java.time.LocalDate;\n import java.util.function.Consumer;\n \n import static io.prestosql.tempto.assertions.QueryAssert.Row.row;\n import static io.prestosql.tempto.assertions.QueryAssert.assertThat;\n-import static io.prestosql.tempto.fulfillment.table.TableRequirements.immutableTable;\n-import static io.prestosql.tempto.fulfillment.table.hive.tpch.TpchTableDefinitions.NATION;\n import static io.prestosql.tempto.query.QueryExecutor.query;\n import static io.prestosql.tests.TestGroups.HIVE_VIEWS;\n import static io.prestosql.tests.utils.QueryExecutors.onHive;\n import static io.prestosql.tests.utils.QueryExecutors.onPresto;\n import static java.lang.String.format;\n import static org.testng.Assert.assertEquals;\n \n+@Requires({\n+        ImmutableNationTable.class,\n+        ImmutableOrdersTable.class,\n+})\n public class TestHiveViews\n         extends HiveProductTest\n-        implements RequirementsProvider\n {\n-    @Override\n-    public Requirement getRequirements(Configuration configuration)\n-    {\n-        return immutableTable(NATION);", "originalCommit": "be4e463119cd254a62a1e3faecade3a389172814", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3Nzk3OA==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524677978", "bodyText": "it's provided with a class-level annotation now", "author": "findepi", "createdAt": "2020-11-16T22:25:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NDQ5OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTEyNA==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524585124", "bodyText": "It would be nice to have #4510 implemented so we can have coverage as integration test.", "author": "kokosing", "createdAt": "2020-11-16T21:11:01Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -13,37 +13,34 @@\n  */", "originalCommit": "be4e463119cd254a62a1e3faecade3a389172814", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3OTA4Ng==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524679086", "bodyText": "Yes, but this i'd still want to have product tests, as they allow me to cross-check results between Presto and Hive, especially because of subtleties like #5978", "author": "findepi", "createdAt": "2020-11-16T22:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTEyNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTY2Nw==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524585667", "bodyText": "same comment as previously, it would be nice to have single test per case", "author": "kokosing", "createdAt": "2020-11-16T21:11:32Z", "path": "presto-product-tests/src/main/java/io/prestosql/tests/hive/TestHiveViews.java", "diffHunk": "@@ -172,19 +169,24 @@ public void testRichSqlSyntax()\n                 \"   CASE WHEN n_name = \\\"BRAZIL\\\" THEN 'is BRAZIL' WHEN n_name = \\\"ALGERIA\\\" THEN 'is ALGERIA' ELSE \\\"\\\" END is_something,\\n\" + // searched CASE, double quote string literals\n                 \"   COALESCE(IF(n_name LIKE 'A%', NULL, n_name), 'A%') AS coalesced_name, \\n\" + // coalesce\n                 \"   round(tan(n_nationkey), 3) AS rounded_tan, \\n\" + // functions\n+                \"   o_orderdate AS the_orderdate, \\n\" +\n                 \"   `n`.`n_nationkey` + `n_nationkey` + n.n_nationkey + n_nationkey + 10000 - -1 AS arithmetic--some comment without leading space \\n\" +\n-                \"FROM `default`.`nation` AS `n`\");\n+                \"FROM `default`.`nation` AS `n` \\n\" +\n+                // join, subquery\n+                \"LEFT JOIN (SELECT * FROM orders WHERE o_custkey > 1000) `o` ON `o`.`o_orderkey` = `n`.`n_nationkey` \");", "originalCommit": "be4e463119cd254a62a1e3faecade3a389172814", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDY3OTc2NQ==", "url": "https://github.com/trinodb/trino/pull/5980#discussion_r524679765", "bodyText": "You can give it a try. I did not because i strngly believe this would take prohibitively long time", "author": "findepi", "createdAt": "2020-11-16T22:27:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDU4NTY2Nw=="}], "type": "inlineReview", "revised_code": null}]}