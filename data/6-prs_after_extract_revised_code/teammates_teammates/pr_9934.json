{"pr_number": 9934, "pr_title": "[#9382] Add tests for RestoreFeedbackSessionAction", "pr_createdAt": "2020-01-31T02:47:50Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/9934", "timeline": [{"oid": "8b6e4a10668d1dd8b8853212191ba11cb85d3142", "url": "https://github.com/TEAMMATES/teammates/commit/8b6e4a10668d1dd8b8853212191ba11cb85d3142", "message": "Add tests for RestoreFeedbackSessionAction", "committedDate": "2020-01-31T02:44:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgxNDk1Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/9934#discussion_r373814957", "bodyText": "It could be a good practice to separate verifying output and verifying model by an empty line, or add comment, but it's fine to me and just a suggestion", "author": "Adoby7", "createdAt": "2020-02-02T02:44:59Z", "path": "src/test/java/teammates/test/cases/webapi/RestoreFeedbackSessionActionTest.java", "diffHunk": "@@ -23,13 +30,69 @@ protected String getRequestMethod() {\n     @Test\n     @Override\n     protected void testExecute() throws Exception {\n-        // TODO\n+        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n+        FeedbackSessionAttributes firstFeedbackSession = typicalBundle.feedbackSessions.get(\"session1InCourse1\");\n+\n+        String instructorId = instructor1OfCourse1.googleId;\n+        String courseId = instructor1OfCourse1.courseId;\n+        String feedbackSessionName = firstFeedbackSession.getFeedbackSessionName();\n+\n+        loginAsInstructor(instructorId);\n+\n+        String[] submissionParams = new String[] {\n+                Const.ParamsNames.COURSE_ID, courseId,\n+                Const.ParamsNames.FEEDBACK_SESSION_NAME, feedbackSessionName,\n+        };\n+\n+        ______TS(\"Not found in recycle bin\");\n+\n+        RestoreFeedbackSessionAction notFoundAction = getAction(submissionParams);\n+        EntityNotFoundException notFoundException = assertThrows(EntityNotFoundException.class, () -> {\n+            getJsonResult(notFoundAction);\n+        });\n+\n+        assertEquals(\"Feedback session is not in recycle bin\", notFoundException.getMessage());\n+\n+        ______TS(\"Typical case, restore a deleted feedback session from recycle bin\");\n+\n+        logic.moveFeedbackSessionToRecycleBin(feedbackSessionName, courseId);\n+\n+        RestoreFeedbackSessionAction action = getAction(submissionParams);\n+        JsonResult result = getJsonResult(action);\n+        FeedbackSessionData feedbackSessionMessage = (FeedbackSessionData) result.getOutput();\n+\n+        assertEquals(HttpStatus.SC_OK, result.getStatusCode());\n+        assertEquals(courseId, feedbackSessionMessage.getCourseId());\n+        assertEquals(feedbackSessionName, feedbackSessionMessage.getFeedbackSessionName());\n+        assertFalse(logic.getFeedbackSession(feedbackSessionName, courseId).isSessionDeleted());", "originalCommit": "8b6e4a10668d1dd8b8853212191ba11cb85d3142", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e52f229e73781382a786bf3bd463614549a3f56", "chunk": "diff --git a/src/test/java/teammates/test/cases/webapi/RestoreFeedbackSessionActionTest.java b/src/test/java/teammates/test/cases/webapi/RestoreFeedbackSessionActionTest.java\nindex 3c133babe4..873091358a 100644\n--- a/src/test/java/teammates/test/cases/webapi/RestoreFeedbackSessionActionTest.java\n+++ b/src/test/java/teammates/test/cases/webapi/RestoreFeedbackSessionActionTest.java\n\n@@ -30,49 +40,45 @@ public class RestoreFeedbackSessionActionTest extends BaseActionTest<RestoreFeed\n     @Test\n     @Override\n     protected void testExecute() throws Exception {\n-        InstructorAttributes instructor1OfCourse1 = typicalBundle.instructors.get(\"instructor1OfCourse1\");\n-        FeedbackSessionAttributes firstFeedbackSession = typicalBundle.feedbackSessions.get(\"session1InCourse1\");\n-\n-        String instructorId = instructor1OfCourse1.googleId;\n-        String courseId = instructor1OfCourse1.courseId;\n-        String feedbackSessionName = firstFeedbackSession.getFeedbackSessionName();\n+        // See test cases below.\n+    }\n \n+    @Test\n+    protected void testExecute_withSessionInBin_shouldRestoreSession() throws Exception {\n         loginAsInstructor(instructorId);\n-\n-        String[] submissionParams = new String[] {\n-                Const.ParamsNames.COURSE_ID, courseId,\n-                Const.ParamsNames.FEEDBACK_SESSION_NAME, feedbackSessionName,\n-        };\n-\n-        ______TS(\"Not found in recycle bin\");\n-\n-        RestoreFeedbackSessionAction notFoundAction = getAction(submissionParams);\n-        EntityNotFoundException notFoundException = assertThrows(EntityNotFoundException.class, () -> {\n-            getJsonResult(notFoundAction);\n-        });\n-\n-        assertEquals(\"Feedback session is not in recycle bin\", notFoundException.getMessage());\n-\n-        ______TS(\"Typical case, restore a deleted feedback session from recycle bin\");\n-\n         logic.moveFeedbackSessionToRecycleBin(feedbackSessionName, courseId);\n-\n         RestoreFeedbackSessionAction action = getAction(submissionParams);\n         JsonResult result = getJsonResult(action);\n         FeedbackSessionData feedbackSessionMessage = (FeedbackSessionData) result.getOutput();\n \n+        // Verify response\n         assertEquals(HttpStatus.SC_OK, result.getStatusCode());\n         assertEquals(courseId, feedbackSessionMessage.getCourseId());\n         assertEquals(feedbackSessionName, feedbackSessionMessage.getFeedbackSessionName());\n+\n+        // Verify model\n         assertFalse(logic.getFeedbackSession(feedbackSessionName, courseId).isSessionDeleted());\n+    }\n+\n+    @Test\n+    protected void testExecute_withSessionNotInBin_shouldFail() {\n+        loginAsInstructor(instructorId);\n+        RestoreFeedbackSessionAction notFoundAction = getAction(submissionParams);\n+\n+        EntityNotFoundException notFoundException = assertThrows(EntityNotFoundException.class, () -> {\n+            getJsonResult(notFoundAction);\n+        });\n+        assertEquals(\"Feedback session is not in recycle bin\", notFoundException.getMessage());\n+    }\n \n-        ______TS(\"Not enough parameters\");\n+    @Test\n+    protected void testExecute_withEmptyParameters_shouldFail() {\n+        loginAsInstructor(instructorId);\n \n         NullHttpParameterException emptyParamsException = assertThrows(NullHttpParameterException.class, () -> {\n             RestoreFeedbackSessionAction emptyParamsAction = getAction();\n             getJsonResult(emptyParamsAction);\n         });\n-\n         assertEquals(\n                 String.format(Const.StatusCodes.NULL_HTTP_PARAMETER, Const.ParamsNames.COURSE_ID),\n                 emptyParamsException.getMessage()\n"}}, {"oid": "2e52f229e73781382a786bf3bd463614549a3f56", "url": "https://github.com/TEAMMATES/teammates/commit/2e52f229e73781382a786bf3bd463614549a3f56", "message": "Improve test structure", "committedDate": "2020-02-02T08:35:52Z", "type": "commit"}, {"oid": "b1a50bf5a65709e495a3bea375ffdd93038764ff", "url": "https://github.com/TEAMMATES/teammates/commit/b1a50bf5a65709e495a3bea375ffdd93038764ff", "message": "Merge branch 'master' into 9382-add-restore-feedback-session-action-tests", "committedDate": "2020-02-06T04:45:47Z", "type": "commit"}, {"oid": "0d3bea5a7ebc26309f2f8a1ae6343e43bd578cfe", "url": "https://github.com/TEAMMATES/teammates/commit/0d3bea5a7ebc26309f2f8a1ae6343e43bd578cfe", "message": "Merge branch 'master' into 9382-add-restore-feedback-session-action-tests", "committedDate": "2020-02-06T08:10:44Z", "type": "commit"}]}