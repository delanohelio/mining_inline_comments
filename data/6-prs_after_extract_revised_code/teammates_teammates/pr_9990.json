{"pr_number": 9990, "pr_title": "[#9946] Add additional fields for Student Search Migration", "pr_createdAt": "2020-03-17T07:18:45Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/9990", "timeline": [{"oid": "a11bc8bc7d3233b9b10ee5beeca841afda100779", "url": "https://github.com/TEAMMATES/teammates/commit/a11bc8bc7d3233b9b10ee5beeca841afda100779", "message": "Fix str equality\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-03-20T13:17:01Z", "type": "forcePushed"}, {"oid": "e203a8fb2fa4bbd0d0e74b7283c36cff84f8db72", "url": "https://github.com/TEAMMATES/teammates/commit/e203a8fb2fa4bbd0d0e74b7283c36cff84f8db72", "message": "Fix str equality\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-03-21T14:34:06Z", "type": "forcePushed"}, {"oid": "f4ee3b0f3d99e59890a6442450143a347551188f", "url": "https://github.com/TEAMMATES/teammates/commit/f4ee3b0f3d99e59890a6442450143a347551188f", "message": "Add mapping for courseId to instructorId\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-03-23T02:44:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r396853159", "bodyText": "Why do we need institute  and courseIdToInstructorGoogleIdMap?\nAgain, we have already violated the principle that StudentData.java should only contains information related to a student. institute is technically yes but definitely not courseIdToInstructorGoogleIdMap/", "author": "xpdavid", "createdAt": "2020-03-24T01:26:05Z", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -19,6 +21,12 @@\n     private String lastName;\n     @Nullable\n     private String comments;\n+    @Nullable\n+    private String key;\n+    @Nullable\n+    private String institute;\n+    @Nullable\n+    private Map<String, String> courseIdToInstructorGoogleIdMap;", "originalCommit": "f4ee3b0f3d99e59890a6442450143a347551188f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzE1MjUwNQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397152505", "bodyText": "Yea my bad, we could just make a call on front end side for all courses. For institute however, I could not find any endpoint through which I could get institute, so i included it here. wdyt?", "author": "hcwong", "createdAt": "2020-03-24T13:30:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQxMjYzNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397412636", "bodyText": "Why do we need institute? The currently implementation is a bit expensive especially for the for each loop.", "author": "xpdavid", "createdAt": "2020-03-24T19:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2ODE3OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397568179", "bodyText": "I included it to match the current object being returned by the Admin endpoint, which has institute in it", "author": "hcwong", "createdAt": "2020-03-25T02:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2OTExNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397569116", "bodyText": "I think you should not consider \"what the old endpoint will return\". Rather, you should try to answer \"whether I need the data or not\".", "author": "xpdavid", "createdAt": "2020-03-25T02:08:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU3MzQwNA==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397573404", "bodyText": "Cool, that actually makes things easier for the search service \ud83d\ude06", "author": "hcwong", "createdAt": "2020-03-25T02:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzYzNTI1Mg==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r397635252", "bodyText": "Hmm, sorry, will include institute because it is being used on admin-search-page.html, but will cut whatever i can cut from the new endpoint", "author": "hcwong", "createdAt": "2020-03-25T06:38:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg1MzE1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "8976077987ee94e58b24acf8a643ed0a541d1132", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/output/StudentData.java b/src/main/java/teammates/ui/webapi/output/StudentData.java\nindex 94696ea903..faaea81b82 100644\n--- a/src/main/java/teammates/ui/webapi/output/StudentData.java\n+++ b/src/main/java/teammates/ui/webapi/output/StudentData.java\n\n@@ -21,12 +19,6 @@ public class StudentData extends ApiOutput {\n     private String lastName;\n     @Nullable\n     private String comments;\n-    @Nullable\n-    private String key;\n-    @Nullable\n-    private String institute;\n-    @Nullable\n-    private Map<String, String> courseIdToInstructorGoogleIdMap;\n \n     private JoinState joinState;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTcwMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r399765701", "bodyText": "I think we might want to improve this?\nIterating the whole array to find the corresponding element is not really attracting.", "author": "xpdavid", "createdAt": "2020-03-29T08:40:03Z", "path": "src/main/java/teammates/ui/webapi/output/StudentData.java", "diffHunk": "@@ -89,6 +106,16 @@ public void setJoinState(JoinState joinState) {\n         this.joinState = joinState;\n     }\n \n+    public void setKey(List<StudentAttributes> studentAttributes) {\n+        this.key = StringHelper.encrypt(studentAttributes.stream()\n+                .filter((StudentAttributes s) -> s.getGoogleId().equals(this.googleId))", "originalCommit": "2583b25cafc9a34b00658e780476f33aa90bdae7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTgwNjg3Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r399806876", "bodyText": "Hey Xiao Pu,\nI think there were two alternatives I considered when doing this.\nFirst, is to put the key generation inside the constructor. However, this will place the burden of hiding the key on the developer. Since Teammates has many contributors, I opted not to do this as people who use StudentsData in the future may not be aware of this and thus send the key.\nYea, theres a runtime issue, but I think this should be fine as its Java, so it should run faster and because the performance bottleneck is at the frontend side.\nWhat do you think?", "author": "hcwong", "createdAt": "2020-03-29T14:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTcwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0MDk3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r399840975", "bodyText": "since Teammates has many contributors, I opted not to do this as people who use StudentsData in the future may not be aware of this and thus send the key.\n\nI don't agree with this as RESTfuL endpoints are enforced by resources. Student is a resource and the only two places till now is search for the resource or get the resource directly.\nDespite this, there is a still a way to do this\nstudentsData = new StudentsData();\nList<StudentData> studentDataList = new ArrayList<>();\nfor (StudentAttributes student : studentAttributesList) {\n    // call constructor\n    // generate key depends on access control\n}\nstudentsData.setStudents(studentDataList)", "author": "xpdavid", "createdAt": "2020-03-29T19:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTcwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkxNzkzNA==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r399917934", "bodyText": "Hey Xiao Pu, that is a fair point about the two places thing. Will change \ud83d\udc4d", "author": "hcwong", "createdAt": "2020-03-30T04:13:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NTcwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "8976077987ee94e58b24acf8a643ed0a541d1132", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/output/StudentData.java b/src/main/java/teammates/ui/webapi/output/StudentData.java\nindex 79f7b090c9..faaea81b82 100644\n--- a/src/main/java/teammates/ui/webapi/output/StudentData.java\n+++ b/src/main/java/teammates/ui/webapi/output/StudentData.java\n\n@@ -106,16 +89,6 @@ public class StudentData extends ApiOutput {\n         this.joinState = joinState;\n     }\n \n-    public void setKey(List<StudentAttributes> studentAttributes) {\n-        this.key = StringHelper.encrypt(studentAttributes.stream()\n-                .filter((StudentAttributes s) -> s.getGoogleId().equals(this.googleId))\n-                .collect(Collectors.toList()).get(0).getKey());\n-    }\n-\n-    public void setInstitute(String institute) {\n-        this.institute = institute;\n-    }\n-\n     /**\n      * Hides last name.\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0NDgyMA==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r403644820", "bodyText": "Since it doesn't make sense to have a StudentsData object with no students, do you think we can make this constructor take List<StudentData> as an argument? Then we can leave students as final and remove the setter.", "author": "dvrylc", "createdAt": "2020-04-05T03:49:07Z", "path": "src/main/java/teammates/ui/webapi/output/StudentsData.java", "diffHunk": "@@ -10,7 +10,11 @@\n  */\n public class StudentsData extends ApiOutput {\n \n-    private final List<StudentData> students;\n+    private List<StudentData> students;\n+\n+    public StudentsData() {\n+        // Use this constructor if StudentData is to be sent with the key\n+    }", "originalCommit": "bf81370198af2d697e8f312333b1a251ae684e6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMzYzNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r403713636", "bodyText": "There's an issue of type erasure though (cue 2103 flashbacks), cos the other constructor takes in List<StudentAttributes>. I could make these constructor instantiate an empty List<StudentData> though, just in case", "author": "hcwong", "createdAt": "2020-04-05T15:01:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0NDgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNTc4MA==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r403715780", "bodyText": "Oh right I didn't consider that, let's just stick with this but maybe add a comment to explain/warn future devs? An empty list doesn't really solve the problem either \ud83d\ude1e", "author": "dvrylc", "createdAt": "2020-04-05T15:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0NDgyMA=="}], "type": "inlineReview", "revised_code": {"commit": "8976077987ee94e58b24acf8a643ed0a541d1132", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/output/StudentsData.java b/src/main/java/teammates/ui/webapi/output/StudentsData.java\nindex 6114f09881..2638756d76 100644\n--- a/src/main/java/teammates/ui/webapi/output/StudentsData.java\n+++ b/src/main/java/teammates/ui/webapi/output/StudentsData.java\n\n@@ -10,11 +10,7 @@ import teammates.common.datatransfer.attributes.StudentAttributes;\n  */\n public class StudentsData extends ApiOutput {\n \n-    private List<StudentData> students;\n-\n-    public StudentsData() {\n-        // Use this constructor if StudentData is to be sent with the key\n-    }\n+    private final List<StudentData> students;\n \n     public StudentsData(List<StudentAttributes> students) {\n         this.students = students.stream().map(StudentData::new).collect(Collectors.toList());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0NTUxNg==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r403645516", "bodyText": "Instead of creating the StudentsData > setting the students > getting the students > setting the institute data, could we do all the data manipulation (setting key and institute) on the studentDataList first? Then once we have a finalized studentDataList, pass it to the StudentsData constructor as mentioned above.", "author": "dvrylc", "createdAt": "2020-04-05T03:59:35Z", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -39,11 +88,28 @@ public ActionResult execute() {\n             List<InstructorAttributes> instructors = logic.getInstructorsForGoogleId(userInfo.id);\n             students = logic.searchStudents(searchKey, instructors).studentList;\n         }\n-        studentsData = new StudentsData(students);\n+\n+        for (StudentAttributes s : students) {\n+            courseIds.add(s.getCourse());\n+            StudentData studentData = new StudentData(s);\n+            if (userInfo.isAdmin) {\n+                studentData.setKey(StringHelper.encrypt(s.getKey()));\n+            }\n+\n+            studentDataList.add(studentData);\n+        }\n+        StudentsData studentsData = new StudentsData();\n+        studentsData.setStudents(studentDataList);\n+\n+        // Set Institute\n+        populateCourseIdToInstituteMap();\n+        studentsData.getStudents().forEach((StudentData student) -> {\n+            student.setInstitute(courseIdToInstituteMap.get(student.getCourseId()));\n+        });", "originalCommit": "bf81370198af2d697e8f312333b1a251ae684e6d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8976077987ee94e58b24acf8a643ed0a541d1132", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java b/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\nindex c5a8b3e477..1693e3f344 100644\n--- a/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\n+++ b/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\n\n@@ -88,28 +39,11 @@ public class SearchStudentsAction extends Action {\n             List<InstructorAttributes> instructors = logic.getInstructorsForGoogleId(userInfo.id);\n             students = logic.searchStudents(searchKey, instructors).studentList;\n         }\n-\n-        for (StudentAttributes s : students) {\n-            courseIds.add(s.getCourse());\n-            StudentData studentData = new StudentData(s);\n-            if (userInfo.isAdmin) {\n-                studentData.setKey(StringHelper.encrypt(s.getKey()));\n-            }\n-\n-            studentDataList.add(studentData);\n-        }\n-        StudentsData studentsData = new StudentsData();\n-        studentsData.setStudents(studentDataList);\n-\n-        // Set Institute\n-        populateCourseIdToInstituteMap();\n-        studentsData.getStudents().forEach((StudentData student) -> {\n-            student.setInstitute(courseIdToInstituteMap.get(student.getCourseId()));\n-        });\n+        studentsData = new StudentsData(students);\n \n         // Hide information\n         studentsData.getStudents().forEach(StudentData::hideLastName);\n-        if (userInfo.isInstructor) {\n+        if (!(userInfo.isAdmin)) {\n             studentsData.getStudents().forEach(StudentData::hideInformationForInstructor);\n         }\n \n"}}, {"oid": "8976077987ee94e58b24acf8a643ed0a541d1132", "url": "https://github.com/TEAMMATES/teammates/commit/8976077987ee94e58b24acf8a643ed0a541d1132", "message": "Implement search student endpoint", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "2d6dd4b482d3a686569db64006e20801bd2cb4a2", "url": "https://github.com/TEAMMATES/teammates/commit/2d6dd4b482d3a686569db64006e20801bd2cb4a2", "message": "Implement instructors search endpoint (#2)\n\n* Add instructor search endpoint\r\n\r\n* Add tests", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "7c20913529fcd6758d3ed0db4bc84b72beffd3db", "url": "https://github.com/TEAMMATES/teammates/commit/7c20913529fcd6758d3ed0db4bc84b72beffd3db", "message": "Switch from SearchInstructorsData to InstructorsData (#6)", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "169e85f31dac0ef61d147c0f0bc7f060af7678dc", "url": "https://github.com/TEAMMATES/teammates/commit/169e85f31dac0ef61d147c0f0bc7f060af7678dc", "message": "Switch from SearchStudentsData to StudentsData (#7)", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "d4398bc2ae0ea9ae3c794a8fc681d64d61f4b798", "url": "https://github.com/TEAMMATES/teammates/commit/d4398bc2ae0ea9ae3c794a8fc681d64d61f4b798", "message": "Allow travis to build search migration branch (#5)", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "75c88b484b25d8735e3328420e9cc20d08792d86", "url": "https://github.com/TEAMMATES/teammates/commit/75c88b484b25d8735e3328420e9cc20d08792d86", "message": "Implement sessions search endpoint (#3)\n\n* Add sessions search endpoint\r\n\r\n* Add tests\r\n\r\n* Fix lint errors", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "5fcfc517511a2059d6f7325f26fc821e13c84f2f", "url": "https://github.com/TEAMMATES/teammates/commit/5fcfc517511a2059d6f7325f26fc821e13c84f2f", "message": "Add course endpoint (#8)", "committedDate": "2020-04-05T14:11:56Z", "type": "commit"}, {"oid": "74ff704ea85e44ed76ae6e1f64e354fafedbd780", "url": "https://github.com/TEAMMATES/teammates/commit/74ff704ea85e44ed76ae6e1f64e354fafedbd780", "message": "Implement Links Endpoint (#4)", "committedDate": "2020-04-05T14:21:49Z", "type": "commit"}, {"oid": "154c779f231969915d19e08412f05a16d8c55923", "url": "https://github.com/TEAMMATES/teammates/commit/154c779f231969915d19e08412f05a16d8c55923", "message": "Add googleId  field to StudentData (#9)\n\n* Add googleid to studentdata\r\n\r\n* Add nullable to student data", "committedDate": "2020-04-05T14:21:49Z", "type": "commit"}, {"oid": "086e873f9aead5c20b0324fcbbcb52cd2d3fa4c4", "url": "https://github.com/TEAMMATES/teammates/commit/086e873f9aead5c20b0324fcbbcb52cd2d3fa4c4", "message": "Improve search response classes (#12)\n\n* Improve students endpoint classes\r\n\r\n* Move joinState attribute from common to student\r\n\r\n* Improve instructors endpoint classes\r\n\r\n* Revert \"Add googleId  field to StudentData (#9)\"\r\n\r\nThis reverts commit b5d46cabc092bf3bedc429ae1c771515bf149606.\r\n\r\n* Revert unnecessary InstructorData changes\r\n\r\n* Fix typo\r\n\r\n* Make joinState common\r\n\r\n* Make names sane again\r\n\r\n* Remove unused setters", "committedDate": "2020-04-05T14:21:50Z", "type": "commit"}, {"oid": "2411eb88b03ea1f1687445bbf097016fca4713d5", "url": "https://github.com/TEAMMATES/teammates/commit/2411eb88b03ea1f1687445bbf097016fca4713d5", "message": "Standardize search endpoints (#13)\n\n* Improve course endpoint class names\r\n\r\n* Improve links endpoint class names\r\n\r\n* Improve sessions endpoint class names\r\n\r\n* Standardize comments\r\n\r\n* Fix import order", "committedDate": "2020-04-05T14:21:50Z", "type": "commit"}, {"oid": "5ca329e9da254f5ea62d7c246a6728b81981ae4b", "url": "https://github.com/TEAMMATES/teammates/commit/5ca329e9da254f5ea62d7c246a6728b81981ae4b", "message": "Revert travis config", "committedDate": "2020-04-05T14:21:50Z", "type": "commit"}, {"oid": "416a40f1fc52664a0227da6709981e8ccfd3d6a7", "url": "https://github.com/TEAMMATES/teammates/commit/416a40f1fc52664a0227da6709981e8ccfd3d6a7", "message": "Split PR", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "67e554428fd8fbf1bdcde82aa0195136484f91b9", "url": "https://github.com/TEAMMATES/teammates/commit/67e554428fd8fbf1bdcde82aa0195136484f91b9", "message": "Revert to existing response classes", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "0a2be961c05168240b170de2a3e591c0a61235b4", "url": "https://github.com/TEAMMATES/teammates/commit/0a2be961c05168240b170de2a3e591c0a61235b4", "message": "Allow some attributes to be optional", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "c2835f3a95aefba40701f1ec21c3fbbd9f7c1012", "url": "https://github.com/TEAMMATES/teammates/commit/c2835f3a95aefba40701f1ec21c3fbbd9f7c1012", "message": "Improve information hiding logic", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "76ca309ec02780bef8ffcb531326c5d9964a7741", "url": "https://github.com/TEAMMATES/teammates/commit/76ca309ec02780bef8ffcb531326c5d9964a7741", "message": "Improve resource name", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "4e21e282429b46a399f876438773051dba808046", "url": "https://github.com/TEAMMATES/teammates/commit/4e21e282429b46a399f876438773051dba808046", "message": "Add key and institute field to students", "committedDate": "2020-04-05T14:22:11Z", "type": "commit"}, {"oid": "1aba3bd1835dd7fb25d1090d0368432e0fee6441", "url": "https://github.com/TEAMMATES/teammates/commit/1aba3bd1835dd7fb25d1090d0368432e0fee6441", "message": "Fix rebase issues", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "6bf05df5ce63af12af7eba81b57a5175dafa4139", "url": "https://github.com/TEAMMATES/teammates/commit/6bf05df5ce63af12af7eba81b57a5175dafa4139", "message": "lint", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "a6bac0ddf9cd55c0107ead7d3386c15df1d7a29a", "url": "https://github.com/TEAMMATES/teammates/commit/a6bac0ddf9cd55c0107ead7d3386c15df1d7a29a", "message": "Fix str equality\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "e380a3559e1b1c3ec6c99d12d595e03904a684a7", "url": "https://github.com/TEAMMATES/teammates/commit/e380a3559e1b1c3ec6c99d12d595e03904a684a7", "message": "Add mapping for courseId to instructorId\n\nCo-authored-by: Daryl Chan <6095637+dvrylc@users.noreply.github.com>", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "8d65409e57b0eb71762bb8961a4175968949409c", "url": "https://github.com/TEAMMATES/teammates/commit/8d65409e57b0eb71762bb8961a4175968949409c", "message": "Fix some comments", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "242581293cc995f174b7e37c864bd9dc90a5f9b5", "url": "https://github.com/TEAMMATES/teammates/commit/242581293cc995f174b7e37c864bd9dc90a5f9b5", "message": "Move key generation logic to studentData", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "7a7b65f9670437bbb4aa46509b16d798fb0a71f4", "url": "https://github.com/TEAMMATES/teammates/commit/7a7b65f9670437bbb4aa46509b16d798fb0a71f4", "message": "Modify to avoid O(n^2) calls", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "eeafd1f27ea7f9f99f74dbb710515f32ab02fd81", "url": "https://github.com/TEAMMATES/teammates/commit/eeafd1f27ea7f9f99f74dbb710515f32ab02fd81", "message": "Hide Key for instructor", "committedDate": "2020-04-05T14:22:12Z", "type": "commit"}, {"oid": "eeafd1f27ea7f9f99f74dbb710515f32ab02fd81", "url": "https://github.com/TEAMMATES/teammates/commit/eeafd1f27ea7f9f99f74dbb710515f32ab02fd81", "message": "Hide Key for instructor", "committedDate": "2020-04-05T14:22:12Z", "type": "forcePushed"}, {"oid": "f4545bd01230fce25bb3a1c10da0037a46b7b8ed", "url": "https://github.com/TEAMMATES/teammates/commit/f4545bd01230fce25bb3a1c10da0037a46b7b8ed", "message": "Fix comments", "committedDate": "2020-04-05T15:16:46Z", "type": "commit"}, {"oid": "ad1dcac1569e7a402b0eef3551a750df313f267a", "url": "https://github.com/TEAMMATES/teammates/commit/ad1dcac1569e7a402b0eef3551a750df313f267a", "message": "Add helpful comment", "committedDate": "2020-04-05T15:23:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUxNTE0Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r404515146", "bodyText": "I think there is no need to mention this.", "author": "xpdavid", "createdAt": "2020-04-07T03:32:18Z", "path": "src/main/java/teammates/ui/webapi/output/StudentsData.java", "diffHunk": "@@ -10,7 +11,13 @@\n  */\n public class StudentsData extends ApiOutput {\n \n-    private final List<StudentData> students;\n+    private List<StudentData> students;\n+\n+    public StudentsData() {\n+        // Only use this constructor for the SearchStudentsAction action,", "originalCommit": "ad1dcac1569e7a402b0eef3551a750df313f267a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "328f7a6f6aa388a7bb9ed78041bc3af186542052", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/output/StudentsData.java b/src/main/java/teammates/ui/webapi/output/StudentsData.java\nindex e6e3343e0d..e1aa6e7534 100644\n--- a/src/main/java/teammates/ui/webapi/output/StudentsData.java\n+++ b/src/main/java/teammates/ui/webapi/output/StudentsData.java\n\n@@ -14,8 +14,6 @@ public class StudentsData extends ApiOutput {\n     private List<StudentData> students;\n \n     public StudentsData() {\n-        // Only use this constructor for the SearchStudentsAction action,\n-        // or if you are certain that setStudents would be called after instantiating this object.\n         this.students = new ArrayList<>();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUxNTQzNA==", "url": "https://github.com/TEAMMATES/teammates/pull/9990#discussion_r404515434", "bodyText": "Please standardized the information hiding as mentioned in #9991", "author": "xpdavid", "createdAt": "2020-04-07T03:33:31Z", "path": "src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java", "diffHunk": "@@ -39,11 +90,23 @@ public ActionResult execute() {\n             List<InstructorAttributes> instructors = logic.getInstructorsForGoogleId(userInfo.id);\n             students = logic.searchStudents(searchKey, instructors).studentList;\n         }\n-        studentsData = new StudentsData(students);\n+\n+        for (StudentAttributes s : students) {\n+            courseIds.add(s.getCourse());\n+            StudentData studentData = new StudentData(s);\n+            if (userInfo.isAdmin) {\n+                studentData.setKey(StringHelper.encrypt(s.getKey()));\n+            }\n+            studentData.setInstitute(courseIdToInstituteMap.get(s.getCourse()));\n+\n+            studentDataList.add(studentData);\n+        }\n+        StudentsData studentsData = new StudentsData();\n+        studentsData.setStudents(studentDataList);\n \n         // Hide information\n         studentsData.getStudents().forEach(StudentData::hideLastName);\n-        if (!(userInfo.isAdmin)) {\n+        if (userInfo.isInstructor) {\n             studentsData.getStudents().forEach(StudentData::hideInformationForInstructor);", "originalCommit": "ad1dcac1569e7a402b0eef3551a750df313f267a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "328f7a6f6aa388a7bb9ed78041bc3af186542052", "chunk": "diff --git a/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java b/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\nindex d57bebf428..c64920b580 100644\n--- a/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\n+++ b/src/main/java/teammates/ui/webapi/action/SearchStudentsAction.java\n\n@@ -94,22 +94,23 @@ public class SearchStudentsAction extends Action {\n         for (StudentAttributes s : students) {\n             courseIds.add(s.getCourse());\n             StudentData studentData = new StudentData(s);\n+\n+            studentData.setInstitute(courseIdToInstituteMap.get(s.getCourse()));\n+\n             if (userInfo.isAdmin) {\n                 studentData.setKey(StringHelper.encrypt(s.getKey()));\n+            } else {\n+                studentData.setGoogleId(null);\n+                studentData.setComments(null);\n             }\n-            studentData.setInstitute(courseIdToInstituteMap.get(s.getCourse()));\n+\n+            studentData.setLastName(null);\n \n             studentDataList.add(studentData);\n         }\n         StudentsData studentsData = new StudentsData();\n         studentsData.setStudents(studentDataList);\n \n-        // Hide information\n-        studentsData.getStudents().forEach(StudentData::hideLastName);\n-        if (userInfo.isInstructor) {\n-            studentsData.getStudents().forEach(StudentData::hideInformationForInstructor);\n-        }\n-\n         return new JsonResult(studentsData);\n     }\n }\n"}}, {"oid": "328f7a6f6aa388a7bb9ed78041bc3af186542052", "url": "https://github.com/TEAMMATES/teammates/commit/328f7a6f6aa388a7bb9ed78041bc3af186542052", "message": "Fix comments", "committedDate": "2020-04-07T05:14:22Z", "type": "commit"}, {"oid": "2f907ce5c669ab0276779a67baa7d8f400816081", "url": "https://github.com/TEAMMATES/teammates/commit/2f907ce5c669ab0276779a67baa7d8f400816081", "message": "Fix comments again", "committedDate": "2020-04-07T05:49:23Z", "type": "commit"}, {"oid": "2f907ce5c669ab0276779a67baa7d8f400816081", "url": "https://github.com/TEAMMATES/teammates/commit/2f907ce5c669ab0276779a67baa7d8f400816081", "message": "Fix comments again", "committedDate": "2020-04-07T05:49:23Z", "type": "forcePushed"}, {"oid": "fc962f3e674b38e6c1028882cd701de6ddc311ac", "url": "https://github.com/TEAMMATES/teammates/commit/fc962f3e674b38e6c1028882cd701de6ddc311ac", "message": "Retrigger travis", "committedDate": "2020-04-07T10:16:26Z", "type": "forcePushed"}, {"oid": "be46296773e4b40da28def8df32b72876b86bcec", "url": "https://github.com/TEAMMATES/teammates/commit/be46296773e4b40da28def8df32b72876b86bcec", "message": "Rebuild travis", "committedDate": "2020-04-07T10:21:55Z", "type": "commit"}, {"oid": "be46296773e4b40da28def8df32b72876b86bcec", "url": "https://github.com/TEAMMATES/teammates/commit/be46296773e4b40da28def8df32b72876b86bcec", "message": "Rebuild travis", "committedDate": "2020-04-07T10:21:55Z", "type": "forcePushed"}, {"oid": "6f384bfc5ba47dfc0d1c5783afe17422dd9176c0", "url": "https://github.com/TEAMMATES/teammates/commit/6f384bfc5ba47dfc0d1c5783afe17422dd9176c0", "message": "Merge branch 'master' into 9946-search-migration-students-addons", "committedDate": "2020-04-07T11:09:01Z", "type": "commit"}]}