{"pr_number": 10707, "pr_title": "[#9536] Course Join Confirmation Page E2E Tests", "pr_createdAt": "2020-09-12T13:20:15Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10707", "timeline": [{"oid": "61572f39bee0c53af9af2264406fb7bda97fcea6", "url": "https://github.com/TEAMMATES/teammates/commit/61572f39bee0c53af9af2264406fb7bda97fcea6", "message": "Add InstructorCourseJoinConfirmationPageE2ETest", "committedDate": "2020-09-12T13:11:10Z", "type": "commit"}, {"oid": "4e5f5c5894e14ef32d13880c75c659f766d7b6a2", "url": "https://github.com/TEAMMATES/teammates/commit/4e5f5c5894e14ef32d13880c75c659f766d7b6a2", "message": "Add StudentCourseJoinConfirmationPageE2ETest", "committedDate": "2020-09-12T13:11:39Z", "type": "commit"}, {"oid": "21b8dae52ad0a0c3eb4c993d00587176cb7310a7", "url": "https://github.com/TEAMMATES/teammates/commit/21b8dae52ad0a0c3eb4c993d00587176cb7310a7", "message": "Merge branch 'master' into course-join-page-e2e", "committedDate": "2020-09-12T13:20:29Z", "type": "commit"}, {"oid": "85cee6be448b7707aa780c9f56e7f4108cb94622", "url": "https://github.com/TEAMMATES/teammates/commit/85cee6be448b7707aa780c9f56e7f4108cb94622", "message": "Update snapshots", "committedDate": "2020-09-12T13:49:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ3OTMxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487479318", "bodyText": "This should also be WebPageURIs#JOIN_PAGE. The only difference is the entity doing the join.", "author": "wkurniawan07", "createdAt": "2020-09-13T04:25:29Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package teammates.e2e.cases.e2e;\n+\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.CourseJoinConfirmationPage;\n+import teammates.e2e.pageobjects.ErrorReportingModal;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.", "originalCommit": "85cee6be448b7707aa780c9f56e7f4108cb94622", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "chunk": "diff --git a/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java b/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\nindex 519135f88a..a0f8e17b0f 100644\n--- a/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\n+++ b/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\n\n@@ -13,7 +13,7 @@ import teammates.e2e.pageobjects.ErrorReportingModal;\n import teammates.e2e.pageobjects.InstructorHomePage;\n \n /**\n- * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.\n+ * SUT: {@link Const.WebPageURIs#JOIN_PAGE}.\n  */\n public class InstructorCourseJoinConfirmationPageE2ETest extends BaseE2ETestCase {\n     InstructorAttributes newInstructor;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMDI5Ng==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487530296", "bodyText": "At this stage, we shouldn't have dependency on StringHelper.encrypt because this method has dependency to the encryption key set in the application. We need to either:\n\nSet up another encryption method that is configured via test.properties used by E2E tests. (not preferred)\nModify the API layer such that all keys that are returned are already encrypted. I am of the belief this is already the case for non-admin user-facing endpoints.", "author": "wkurniawan07", "createdAt": "2020-09-13T13:34:27Z", "path": "src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java", "diffHunk": "@@ -191,7 +192,7 @@ public InstructorAttributes run() {\n     }\n \n     protected String getKeyForInstructor(String courseId, String instructorEmail) {\n-        return null; // BackDoor.getEncryptedKeyForInstructor(courseId, instructorEmail);\n+        return StringHelper.encrypt(getInstructor(courseId, instructorEmail).getKey());", "originalCommit": "85cee6be448b7707aa780c9f56e7f4108cb94622", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU0MzUxOA==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487543518", "bodyText": "Changed to encrypting in GetInstructorsAction and GetStudentAction instead.", "author": "jtankw3", "createdAt": "2020-09-13T15:32:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMDI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU1NTU3NQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487555575", "bodyText": "@wkurniawan07 it seems that I have used StringHelper.encrypt to get student keys in other E2E tests. Should I change them all in another PR before/after merging this one?", "author": "jtankw3", "createdAt": "2020-09-13T17:31:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMDI5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU5MDkwMw==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487590903", "bodyText": "It's ok to change them here", "author": "wkurniawan07", "createdAt": "2020-09-13T23:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMDI5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2", "chunk": "diff --git a/src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java b/src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java\nindex 9f7aa033f0..c8d85c50c4 100644\n--- a/src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java\n+++ b/src/e2e/java/teammates/e2e/cases/BaseTestCaseWithBackDoorApiAccess.java\n\n@@ -192,7 +191,7 @@ public abstract class BaseTestCaseWithBackDoorApiAccess extends BaseTestCaseWith\n     }\n \n     protected String getKeyForInstructor(String courseId, String instructorEmail) {\n-        return StringHelper.encrypt(getInstructor(courseId, instructorEmail).getKey());\n+        return getInstructor(courseId, instructorEmail).getKey();\n     }\n \n     protected String getKeyForInstructorWithRetry(String courseId, String instructorEmail)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNTEzNg==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487535136", "bodyText": "This is not something specific to the course join page, though", "author": "wkurniawan07", "createdAt": "2020-09-13T14:17:55Z", "path": "src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package teammates.e2e.pageobjects;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+\n+/**\n+ * Page Object Model for the course join confirmation page.\n+ */\n+public class CourseJoinConfirmationPage extends AppPage {\n+    @FindBy(id = \"btn-confirm\")\n+    private WebElement confirmButton;\n+\n+    public CourseJoinConfirmationPage(Browser browser) {\n+        super(browser);\n+    }\n+\n+    @Override\n+    public boolean containsExpectedPageContents() {\n+        if (isElementPresent(By.className(\"modal-content\"))) {\n+            return waitForElementPresence(By.tagName(\"h2\")).getText().contains(\"Uh oh! Something went wrong.\");", "originalCommit": "85cee6be448b7707aa780c9f56e7f4108cb94622", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU0MzU3MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487543570", "bodyText": "Removed.", "author": "jtankw3", "createdAt": "2020-09-13T15:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNTEzNg=="}], "type": "inlineReview", "revised_code": {"commit": "1469746b852c4eb8e0365668e51985a4f61658c2", "chunk": "diff --git a/src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java b/src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java\nindex 03c598b622..eb12a50904 100644\n--- a/src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java\n+++ b/src/e2e/java/teammates/e2e/pageobjects/CourseJoinConfirmationPage.java\n\n@@ -19,9 +19,6 @@ public class CourseJoinConfirmationPage extends AppPage {\n \n     @Override\n     public boolean containsExpectedPageContents() {\n-        if (isElementPresent(By.className(\"modal-content\"))) {\n-            return waitForElementPresence(By.tagName(\"h2\")).getText().contains(\"Uh oh! Something went wrong.\");\n-        }\n         return waitForElementPresence(By.tagName(\"h3\")).getText().contains(\"Confirm your Google account\");\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNjIyNA==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487536224", "bodyText": "I'm aware that this is from previous UI test, but is this necessary? I don't think cookies are carried over to browsers initialized by Selenium.", "author": "wkurniawan07", "createdAt": "2020-09-13T14:27:14Z", "path": "src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package teammates.e2e.cases.e2e;\n+\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import teammates.common.datatransfer.attributes.InstructorAttributes;\n+import teammates.common.util.AppUrl;\n+import teammates.common.util.Const;\n+import teammates.common.util.StringHelper;\n+import teammates.e2e.pageobjects.AppPage;\n+import teammates.e2e.pageobjects.CourseJoinConfirmationPage;\n+import teammates.e2e.pageobjects.ErrorReportingModal;\n+import teammates.e2e.pageobjects.InstructorHomePage;\n+\n+/**\n+ * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.\n+ */\n+public class InstructorCourseJoinConfirmationPageE2ETest extends BaseE2ETestCase {\n+    InstructorAttributes newInstructor;\n+\n+    @Override\n+    protected void prepareTestData() {\n+        testData = loadDataBundle(\"/InstructorCourseJoinConfirmationPageE2ETest.json\");\n+        removeAndRestoreDataBundle(testData);\n+\n+        newInstructor = testData.instructors.get(\"ICJConfirmationE2eT.instr.CS1101\");\n+        newInstructor.googleId = \"ICJConfirmationE2eT.instr2\";\n+    }\n+\n+    @BeforeClass\n+    public void classSetup() {\n+        browser.driver.manage().deleteAllCookies();", "originalCommit": "85cee6be448b7707aa780c9f56e7f4108cb94622", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU0MzY0OQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10707#discussion_r487543649", "bodyText": "I think it may be needed for testing with staging server as user info is copied from tester's browser.", "author": "jtankw3", "createdAt": "2020-09-13T15:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzNjIyNA=="}], "type": "inlineReview", "revised_code": {"commit": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "chunk": "diff --git a/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java b/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\nindex 519135f88a..a0f8e17b0f 100644\n--- a/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\n+++ b/src/e2e/java/teammates/e2e/cases/e2e/InstructorCourseJoinConfirmationPageE2ETest.java\n\n@@ -13,7 +13,7 @@ import teammates.e2e.pageobjects.ErrorReportingModal;\n import teammates.e2e.pageobjects.InstructorHomePage;\n \n /**\n- * SUT: {@link Const.LegacyURIs#INSTRUCTOR_COURSE_JOIN}.\n+ * SUT: {@link Const.WebPageURIs#JOIN_PAGE}.\n  */\n public class InstructorCourseJoinConfirmationPageE2ETest extends BaseE2ETestCase {\n     InstructorAttributes newInstructor;\n"}}, {"oid": "8af920a2c2db6f743990a654fff7fd0e5b447d45", "url": "https://github.com/TEAMMATES/teammates/commit/8af920a2c2db6f743990a654fff7fd0e5b447d45", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into course-join-page-e2e", "committedDate": "2020-09-13T15:18:17Z", "type": "commit"}, {"oid": "1469746b852c4eb8e0365668e51985a4f61658c2", "url": "https://github.com/TEAMMATES/teammates/commit/1469746b852c4eb8e0365668e51985a4f61658c2", "message": "Remove unneeded expected page content in CourseJoinConfirmationPage", "committedDate": "2020-09-13T15:29:25Z", "type": "commit"}, {"oid": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "url": "https://github.com/TEAMMATES/teammates/commit/6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "message": "Fix wrong javadoc comment", "committedDate": "2020-09-13T17:28:25Z", "type": "commit"}, {"oid": "6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "url": "https://github.com/TEAMMATES/teammates/commit/6623eeac5c5d95d98e9c06a8d20c22c5aa70bf89", "message": "Fix wrong javadoc comment", "committedDate": "2020-09-13T17:28:25Z", "type": "forcePushed"}, {"oid": "7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2", "url": "https://github.com/TEAMMATES/teammates/commit/7aa9d1de7ae24bd92cf7a344cb931b18a7dc38f2", "message": "Remove StringHelper encryption from E2E", "committedDate": "2020-09-14T02:56:18Z", "type": "commit"}]}