{"pr_number": 10236, "pr_title": "[#9536] Instructor Feedback Edit Page E2E Test", "pr_createdAt": "2020-06-25T16:50:29Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10236", "timeline": [{"oid": "41e3fce1faf873acf0a76c1d40a6d52324416da0", "url": "https://github.com/TEAMMATES/teammates/commit/41e3fce1faf873acf0a76c1d40a6d52324416da0", "message": "Add InstructorFeedbackEditPage and FeedbackSubmitPage", "committedDate": "2020-06-25T16:36:21Z", "type": "commit"}, {"oid": "3cf531748835d17991616aa6f1b44269f901bd97", "url": "https://github.com/TEAMMATES/teammates/commit/3cf531748835d17991616aa6f1b44269f901bd97", "message": "Add Backdoor methods for FeedbackSessions", "committedDate": "2020-06-25T16:36:58Z", "type": "commit"}, {"oid": "bec0928e2828193f32b0f909eea6eeb52e2b8d02", "url": "https://github.com/TEAMMATES/teammates/commit/bec0928e2828193f32b0f909eea6eeb52e2b8d02", "message": "Add InstructorFeedbackEditPageE2ETest", "committedDate": "2020-06-25T16:37:20Z", "type": "commit"}, {"oid": "637275683b13daa17854e7714d8c7940bcedecab", "url": "https://github.com/TEAMMATES/teammates/commit/637275683b13daa17854e7714d8c7940bcedecab", "message": "Update snapshots", "committedDate": "2020-06-25T17:13:56Z", "type": "commit"}, {"oid": "4a91020f7a64e69f00aedf883e78ddacd14d0e88", "url": "https://github.com/TEAMMATES/teammates/commit/4a91020f7a64e69f00aedf883e78ddacd14d0e88", "message": "Merge branch 'master' into instructor-feedback-edit-e2e", "committedDate": "2020-06-28T12:20:41Z", "type": "commit"}, {"oid": "37d3fd13e34a5cfbdae314f6d14b28856d197ba4", "url": "https://github.com/TEAMMATES/teammates/commit/37d3fd13e34a5cfbdae314f6d14b28856d197ba4", "message": "Add retry to reduce flakiness", "committedDate": "2020-06-28T14:53:19Z", "type": "commit"}, {"oid": "37d3fd13e34a5cfbdae314f6d14b28856d197ba4", "url": "https://github.com/TEAMMATES/teammates/commit/37d3fd13e34a5cfbdae314f6d14b28856d197ba4", "message": "Add retry to reduce flakiness", "committedDate": "2020-06-28T14:53:19Z", "type": "forcePushed"}, {"oid": "1499b30b196caf48eab93534f9e3822e28865973", "url": "https://github.com/TEAMMATES/teammates/commit/1499b30b196caf48eab93534f9e3822e28865973", "message": "Fix submission status bug", "committedDate": "2020-06-30T10:38:24Z", "type": "commit"}, {"oid": "315cf71bc1c394873701bb0f70c43520898c5970", "url": "https://github.com/TEAMMATES/teammates/commit/315cf71bc1c394873701bb0f70c43520898c5970", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html", "committedDate": "2020-07-05T10:47:53Z", "type": "commit"}, {"oid": "315cf71bc1c394873701bb0f70c43520898c5970", "url": "https://github.com/TEAMMATES/teammates/commit/315cf71bc1c394873701bb0f70c43520898c5970", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html", "committedDate": "2020-07-05T10:47:53Z", "type": "forcePushed"}, {"oid": "98ab5c634cf1ada81ab26eefe35673048688fc11", "url": "https://github.com/TEAMMATES/teammates/commit/98ab5c634cf1ada81ab26eefe35673048688fc11", "message": "Update snapshot", "committedDate": "2020-07-05T11:03:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYzMDI3NA==", "url": "https://github.com/TEAMMATES/teammates/pull/10236#discussion_r451630274", "bodyText": "Minor point:\nI realise this is a common pattern within the BackDoor. I am personally not a fan of sweeping through a list to find and return an item inside. The happy path is not very clear either :P\nThis is an alternate way of doing it:\nFeedbackSessionData feedbackSession =  \n    sessionsData.getFeedbackSessions()\n                .stream()\n                .filter(fs -> fs.getFeedbackSessionName().equals(feedbackSessionName))\n                .findFirst()\n                .orElse(null);\n\nif (feedbackSession == null) {\n    return null;\n}\n\nreturn FeedbackSessionAttributes\n        .builder(feedbackSession.getCourseId(), \n                 feedbackSession.getFeedbackSessionName())\n        .build();", "author": "rrtheonlyone", "createdAt": "2020-07-08T15:24:20Z", "path": "src/e2e/java/teammates/e2e/util/BackDoor.java", "diffHunk": "@@ -425,6 +440,151 @@ public static StudentAttributes getStudent(String courseId, String studentEmail)\n         return student.build();\n     }\n \n+    /**\n+     * Get feedback session data from datastore.\n+     */\n+    public static FeedbackSessionData getFeedbackSessionData(String courseId, String feedbackSessionName) {\n+        Map<String, String[]> params = new HashMap<>();\n+        params.put(Const.ParamsNames.COURSE_ID, new String[] { courseId });\n+        params.put(Const.ParamsNames.FEEDBACK_SESSION_NAME, new String[] { feedbackSessionName });\n+        params.put(Const.ParamsNames.INTENT, new String[] { Intent.FULL_DETAIL.toString() });\n+        ResponseBodyAndCode response = executeGetRequest(Const.ResourceURIs.SESSION, params);\n+        if (response.responseCode == HttpStatus.SC_NOT_FOUND) {\n+            return null;\n+        }\n+        return JsonUtils.fromJson(response.responseBody, FeedbackSessionData.class);\n+    }\n+\n+    /**\n+     * Get feedback session from datastore.\n+     */\n+    public static FeedbackSessionAttributes getFeedbackSession(String courseId, String feedbackSessionName) {\n+        FeedbackSessionData sessionData = getFeedbackSessionData(courseId, feedbackSessionName);\n+\n+        FeedbackSessionAttributes sessionAttributes = FeedbackSessionAttributes\n+                .builder(sessionData.getFeedbackSessionName(), sessionData.getCourseId())\n+                .withInstructions(sessionData.getInstructions())\n+                .withStartTime(Instant.ofEpochMilli(sessionData.getSubmissionStartTimestamp()))\n+                .withEndTime(Instant.ofEpochMilli(sessionData.getSubmissionEndTimestamp()))\n+                .withTimeZone(ZoneId.of(sessionData.getTimeZone()))\n+                .withGracePeriod(Duration.ofMinutes(sessionData.getGracePeriod()))\n+                .withIsClosingEmailEnabled(sessionData.getIsClosingEmailEnabled())\n+                .withIsPublishedEmailEnabled(sessionData.getIsPublishedEmailEnabled())\n+                .build();\n+\n+        sessionAttributes.setCreatedTime(Instant.ofEpochMilli(sessionData.getCreatedAtTimestamp()));\n+\n+        if (sessionData.getSessionVisibleSetting().equals(SessionVisibleSetting.AT_OPEN)) {\n+            sessionAttributes.setSessionVisibleFromTime(Const.TIME_REPRESENTS_FOLLOW_OPENING);\n+        } else {\n+            sessionAttributes.setSessionVisibleFromTime(Instant.ofEpochMilli(\n+                    sessionData.getCustomSessionVisibleTimestamp()));\n+        }\n+\n+        if (sessionData.getResponseVisibleSetting().equals(ResponseVisibleSetting.AT_VISIBLE)) {\n+            sessionAttributes.setResultsVisibleFromTime(Const.TIME_REPRESENTS_FOLLOW_VISIBLE);\n+        } else if (sessionData.getResponseVisibleSetting().equals(ResponseVisibleSetting.LATER)) {\n+            sessionAttributes.setResultsVisibleFromTime(Const.TIME_REPRESENTS_LATER);\n+        } else {\n+            sessionAttributes.setResultsVisibleFromTime(Instant.ofEpochMilli(\n+                    sessionData.getCustomResponseVisibleTimestamp()));\n+        }\n+\n+        return sessionAttributes;\n+    }\n+\n+    /**\n+     * Get soft deleted feedback session from datastore.\n+     */\n+    public static FeedbackSessionAttributes getSoftDeletedSession(String feedbackSessionName, String instructorId) {\n+        Map<String, String[]> params = new HashMap<>();\n+        params.put(Const.ParamsNames.ENTITY_TYPE, new String[] { Const.EntityType.INSTRUCTOR });\n+        params.put(Const.ParamsNames.IS_IN_RECYCLE_BIN, new String[] { \"true\" });\n+        params.put(Const.ParamsNames.USER_ID, new String[] { instructorId });\n+        ResponseBodyAndCode response = executeGetRequest(Const.ResourceURIs.SESSIONS, params);\n+        if (response.responseCode == HttpStatus.SC_NOT_FOUND) {\n+            return null;\n+        }\n+\n+        FeedbackSessionsData sessionsData = JsonUtils.fromJson(response.responseBody, FeedbackSessionsData.class);\n+        List<FeedbackSessionData> sessionsDataList = sessionsData.getFeedbackSessions();\n+        for (FeedbackSessionData feedbackSession : sessionsDataList) {", "originalCommit": "98ab5c634cf1ada81ab26eefe35673048688fc11", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9e159edcaae1fda531875e8adda9497836b32db6", "chunk": "diff --git a/src/e2e/java/teammates/e2e/util/BackDoor.java b/src/e2e/java/teammates/e2e/util/BackDoor.java\nindex 4bb84e4b48..00233e37c9 100644\n--- a/src/e2e/java/teammates/e2e/util/BackDoor.java\n+++ b/src/e2e/java/teammates/e2e/util/BackDoor.java\n\n@@ -460,6 +469,9 @@ public final class BackDoor {\n      */\n     public static FeedbackSessionAttributes getFeedbackSession(String courseId, String feedbackSessionName) {\n         FeedbackSessionData sessionData = getFeedbackSessionData(courseId, feedbackSessionName);\n+        if (sessionData == null) {\n+            return null;\n+        }\n \n         FeedbackSessionAttributes sessionAttributes = FeedbackSessionAttributes\n                 .builder(sessionData.getFeedbackSessionName(), sessionData.getCourseId())\n"}}, {"oid": "daaddc0cd698c0ba8396e648cd0c48eea0cdef2d", "url": "https://github.com/TEAMMATES/teammates/commit/daaddc0cd698c0ba8396e648cd0c48eea0cdef2d", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/copy-session-modal/copy-session-modal.component.html\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html", "committedDate": "2020-07-11T05:39:46Z", "type": "commit"}, {"oid": "9e159edcaae1fda531875e8adda9497836b32db6", "url": "https://github.com/TEAMMATES/teammates/commit/9e159edcaae1fda531875e8adda9497836b32db6", "message": "Improve readability of backdoor methods", "committedDate": "2020-07-11T06:58:52Z", "type": "commit"}, {"oid": "22c3357eee1293cca3a6a887f64ce12847d252ef", "url": "https://github.com/TEAMMATES/teammates/commit/22c3357eee1293cca3a6a887f64ce12847d252ef", "message": "Update snapshots", "committedDate": "2020-07-11T07:38:17Z", "type": "forcePushed"}, {"oid": "82d668cb671f2db7f00f3c1be270ef28b9d18fe0", "url": "https://github.com/TEAMMATES/teammates/commit/82d668cb671f2db7f00f3c1be270ef28b9d18fe0", "message": "Update snapshots", "committedDate": "2020-07-11T08:10:05Z", "type": "commit"}, {"oid": "ff5fabbbc5928e2a1aad9cc74381376c6faa8602", "url": "https://github.com/TEAMMATES/teammates/commit/ff5fabbbc5928e2a1aad9cc74381376c6faa8602", "message": "Add wait for async data loading", "committedDate": "2020-07-11T08:10:19Z", "type": "forcePushed"}, {"oid": "e1d07ab660bfcdb38129e8161f0df9a042a96a9a", "url": "https://github.com/TEAMMATES/teammates/commit/e1d07ab660bfcdb38129e8161f0df9a042a96a9a", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e", "committedDate": "2020-07-13T08:50:36Z", "type": "forcePushed"}, {"oid": "501bc06a323eb3831511125902216e11bdc4ab34", "url": "https://github.com/TEAMMATES/teammates/commit/501bc06a323eb3831511125902216e11bdc4ab34", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/test/java/teammates/test/cases/browsertests/InstructorFeedbackEditCopyUiTest.java\n#\tsrc/test/java/teammates/test/cases/browsertests/InstructorFeedbackEditPageUiTest.java\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html\n#\tsrc/web/app/components/session-edit-form/session-edit-form.component.html\n#\tsrc/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.html", "committedDate": "2020-07-24T08:16:06Z", "type": "commit"}, {"oid": "fcb10e6c3050af4217ca94aba298939eb7ff2a1c", "url": "https://github.com/TEAMMATES/teammates/commit/fcb10e6c3050af4217ca94aba298939eb7ff2a1c", "message": "Account for added rich text editors", "committedDate": "2020-07-24T09:41:36Z", "type": "commit"}, {"oid": "7cb0cd0ea9f0b5a25fdadf00cb1c84bb31cc8924", "url": "https://github.com/TEAMMATES/teammates/commit/7cb0cd0ea9f0b5a25fdadf00cb1c84bb31cc8924", "message": "Adjust wait for async data", "committedDate": "2020-07-24T09:41:54Z", "type": "commit"}, {"oid": "7cb0cd0ea9f0b5a25fdadf00cb1c84bb31cc8924", "url": "https://github.com/TEAMMATES/teammates/commit/7cb0cd0ea9f0b5a25fdadf00cb1c84bb31cc8924", "message": "Adjust wait for async data", "committedDate": "2020-07-24T09:41:54Z", "type": "forcePushed"}, {"oid": "8d9b8467a5b3c4842dbe20c375fc1a669d169412", "url": "https://github.com/TEAMMATES/teammates/commit/8d9b8467a5b3c4842dbe20c375fc1a669d169412", "message": "Fix snapshot and lint", "committedDate": "2020-07-24T10:03:57Z", "type": "commit"}, {"oid": "697fb97674f49764d9917feb0a254f104da3232d", "url": "https://github.com/TEAMMATES/teammates/commit/697fb97674f49764d9917feb0a254f104da3232d", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html\n#\tsrc/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.html", "committedDate": "2020-08-02T05:43:48Z", "type": "commit"}, {"oid": "a34ee5de13b9442bdb42342457f5eae5782d4fcb", "url": "https://github.com/TEAMMATES/teammates/commit/a34ee5de13b9442bdb42342457f5eae5782d4fcb", "message": "Refactor code that uses waitForElementPresence", "committedDate": "2020-08-02T06:34:39Z", "type": "commit"}, {"oid": "1331aa2161ce491a4add805d29e0005d2dc4937f", "url": "https://github.com/TEAMMATES/teammates/commit/1331aa2161ce491a4add805d29e0005d2dc4937f", "message": "Adjust access levels to hide more details", "committedDate": "2020-08-02T06:35:11Z", "type": "commit"}, {"oid": "e87fce791bc029a5701204a993f8f1a0d5e048ea", "url": "https://github.com/TEAMMATES/teammates/commit/e87fce791bc029a5701204a993f8f1a0d5e048ea", "message": "Add wait for data loading", "committedDate": "2020-08-02T06:52:03Z", "type": "commit"}, {"oid": "18a49b023b3539d5ef8f7da40c3420d6fe095564", "url": "https://github.com/TEAMMATES/teammates/commit/18a49b023b3539d5ef8f7da40c3420d6fe095564", "message": "Update snapshot", "committedDate": "2020-08-02T07:38:30Z", "type": "commit"}, {"oid": "18a49b023b3539d5ef8f7da40c3420d6fe095564", "url": "https://github.com/TEAMMATES/teammates/commit/18a49b023b3539d5ef8f7da40c3420d6fe095564", "message": "Update snapshot", "committedDate": "2020-08-02T07:38:30Z", "type": "forcePushed"}, {"oid": "ff5c4fe543881ed5a1782fec3c2b9dd9d4168f04", "url": "https://github.com/TEAMMATES/teammates/commit/ff5c4fe543881ed5a1782fec3c2b9dd9d4168f04", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/session-edit-form/session-edit-form.component.html\n#\tsrc/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.html", "committedDate": "2020-08-02T09:44:46Z", "type": "commit"}, {"oid": "ff5c4fe543881ed5a1782fec3c2b9dd9d4168f04", "url": "https://github.com/TEAMMATES/teammates/commit/ff5c4fe543881ed5a1782fec3c2b9dd9d4168f04", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/session-edit-form/session-edit-form.component.html\n#\tsrc/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.html", "committedDate": "2020-08-02T09:44:46Z", "type": "forcePushed"}, {"oid": "d29f1451f1a19d5ef61a2e7088f30a40387c5e52", "url": "https://github.com/TEAMMATES/teammates/commit/d29f1451f1a19d5ef61a2e7088f30a40387c5e52", "message": "Adjust wait", "committedDate": "2020-08-02T11:08:53Z", "type": "forcePushed"}, {"oid": "34b1fbea909e0ee51fe0dcb09a4a40a0b88287f3", "url": "https://github.com/TEAMMATES/teammates/commit/34b1fbea909e0ee51fe0dcb09a4a40a0b88287f3", "message": "Adjust wait", "committedDate": "2020-08-02T11:46:37Z", "type": "forcePushed"}, {"oid": "95aededa9468674fbac05817657370f0d66f6f46", "url": "https://github.com/TEAMMATES/teammates/commit/95aededa9468674fbac05817657370f0d66f6f46", "message": "Adjust wait", "committedDate": "2020-08-02T13:16:03Z", "type": "commit"}, {"oid": "95aededa9468674fbac05817657370f0d66f6f46", "url": "https://github.com/TEAMMATES/teammates/commit/95aededa9468674fbac05817657370f0d66f6f46", "message": "Adjust wait", "committedDate": "2020-08-02T13:16:03Z", "type": "forcePushed"}, {"oid": "2f91623445b5cee5cffe8c3511c8871f6ea2b9ca", "url": "https://github.com/TEAMMATES/teammates/commit/2f91623445b5cee5cffe8c3511c8871f6ea2b9ca", "message": "Fix writeToRichTextEditor method", "committedDate": "2020-08-06T10:15:35Z", "type": "commit"}, {"oid": "f24d1c5b3793e7c044a68ae2fdae49ffeb8bcf26", "url": "https://github.com/TEAMMATES/teammates/commit/f24d1c5b3793e7c044a68ae2fdae49ffeb8bcf26", "message": "Merge branch 'master' of https://github.com/TEAMMATES/teammates into instructor-feedback-edit-e2e\n\n# Conflicts:\n#\tsrc/web/app/components/question-edit-form/__snapshots__/question-edit-form.component.spec.ts.snap\n#\tsrc/web/app/components/question-edit-form/question-edit-form.component.html\n#\tsrc/web/app/components/session-edit-form/session-edit-form.component.html\n#\tsrc/web/app/pages-instructor/instructor-session-edit-page/instructor-session-edit-page.component.html", "committedDate": "2020-08-11T05:38:02Z", "type": "commit"}, {"oid": "97efd18ac223d62c65e797fd7381c4511de021ef", "url": "https://github.com/TEAMMATES/teammates/commit/97efd18ac223d62c65e797fd7381c4511de021ef", "message": "Scroll iframe into view before verifying question details", "committedDate": "2020-08-11T08:36:24Z", "type": "commit"}, {"oid": "19b42bcad3bc4406598c77d41ed351b485d2b3ca", "url": "https://github.com/TEAMMATES/teammates/commit/19b42bcad3bc4406598c77d41ed351b485d2b3ca", "message": "Add wait for new questions", "committedDate": "2020-08-11T08:37:06Z", "type": "commit"}, {"oid": "520c9cc2ba1b0dad888c417e20cfdc194ffb9c93", "url": "https://github.com/TEAMMATES/teammates/commit/520c9cc2ba1b0dad888c417e20cfdc194ffb9c93", "message": "Update snapshot", "committedDate": "2020-08-11T08:44:12Z", "type": "commit"}, {"oid": "520c9cc2ba1b0dad888c417e20cfdc194ffb9c93", "url": "https://github.com/TEAMMATES/teammates/commit/520c9cc2ba1b0dad888c417e20cfdc194ffb9c93", "message": "Update snapshot", "committedDate": "2020-08-11T08:44:12Z", "type": "forcePushed"}, {"oid": "e36cfbc19997d5824afe124a1e5fd04f67a81ab9", "url": "https://github.com/TEAMMATES/teammates/commit/e36cfbc19997d5824afe124a1e5fd04f67a81ab9", "message": "Minimize reference to iframe", "committedDate": "2020-08-11T09:52:37Z", "type": "commit"}, {"oid": "ed6c09e371b294fcfc63fdc5fba730a8c1aadead", "url": "https://github.com/TEAMMATES/teammates/commit/ed6c09e371b294fcfc63fdc5fba730a8c1aadead", "message": "Merge branch 'master' into instructor-feedback-edit-e2e", "committedDate": "2020-08-13T03:16:17Z", "type": "commit"}, {"oid": "85ba5ae71575cf61c02a7e9d17726a215022257b", "url": "https://github.com/TEAMMATES/teammates/commit/85ba5ae71575cf61c02a7e9d17726a215022257b", "message": "Merge branch 'master' into instructor-feedback-edit-e2e", "committedDate": "2020-08-13T04:05:58Z", "type": "commit"}]}