{"pr_number": 10316, "pr_title": "[#10299] UAT round 3 fixes", "pr_createdAt": "2020-07-15T13:58:41Z", "pr_url": "https://github.com/TEAMMATES/teammates/pull/10316", "timeline": [{"oid": "1ec1ccdadbac940a34713eb24fdde71cb9edb363", "url": "https://github.com/TEAMMATES/teammates/commit/1ec1ccdadbac940a34713eb24fdde71cb9edb363", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-20T05:29:29Z", "type": "forcePushed"}, {"oid": "35e75227aa3bd527d07df82fd2a07f56091677d6", "url": "https://github.com/TEAMMATES/teammates/commit/35e75227aa3bd527d07df82fd2a07f56091677d6", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-20T05:59:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzA5MzQ0MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457093440", "bodyText": "Let's take this time to also fix the validation logic: recommendedLength should always be more than 0, because recommendedLength = 0 doesn't make sense.", "author": "wkurniawan07", "createdAt": "2020-07-20T06:28:26Z", "path": "src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java", "diffHunk": "@@ -28,7 +31,7 @@ public boolean shouldChangesRequireResponseDeletion(FeedbackQuestionDetails newD\n     @Override\n     public List<String> validateQuestionDetails() {\n         List<String> errors = new ArrayList<>();\n-        if (recommendedLength < 0) {\n+        if (recommendedLength != null && recommendedLength < 0) {\n             errors.add(Const.FeedbackQuestion.TEXT_ERROR_INVALID_RECOMMENDED_LENGTH);", "originalCommit": "35e75227aa3bd527d07df82fd2a07f56091677d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "chunk": "diff --git a/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java b/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\nindex 41518356f2..a8cbf1e0f3 100644\n--- a/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\n+++ b/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\n\n@@ -31,7 +31,7 @@ public class FeedbackTextQuestionDetails extends FeedbackQuestionDetails {\n     @Override\n     public List<String> validateQuestionDetails() {\n         List<String> errors = new ArrayList<>();\n-        if (recommendedLength != null && recommendedLength < 0) {\n+        if (recommendedLength != null && recommendedLength < 1) {\n             errors.add(Const.FeedbackQuestion.TEXT_ERROR_INVALID_RECOMMENDED_LENGTH);\n         }\n         return errors;\n"}}, {"oid": "f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "url": "https://github.com/TEAMMATES/teammates/commit/f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-21T04:34:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMTY3Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457831677", "bodyText": "Shouldn't this just be assertNull?", "author": "xpdavid", "createdAt": "2020-07-21T04:40:15Z", "path": "src/test/java/teammates/test/cases/webapi/UpdateFeedbackQuestionActionTest.java", "diffHunk": "@@ -297,7 +297,7 @@ public void testExecute_invalidRecommendedLength_shouldThrowException() {\n                 logic.getFeedbackQuestion(typicalQuestion.getId()).getQuestionDescription());\n \n         // recommended length does not change\n-        assertEquals(0, ((FeedbackTextQuestionDetails) typicalQuestion.getQuestionDetails())\n+        assertEquals(null, ((FeedbackTextQuestionDetails) typicalQuestion.getQuestionDetails())", "originalCommit": "f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "846e821f29f8cfb69750baf55109a139d81fbcca", "chunk": "diff --git a/src/test/java/teammates/test/cases/webapi/UpdateFeedbackQuestionActionTest.java b/src/test/java/teammates/test/cases/webapi/UpdateFeedbackQuestionActionTest.java\nindex 3ffae385b9..dffbf71713 100644\n--- a/src/test/java/teammates/test/cases/webapi/UpdateFeedbackQuestionActionTest.java\n+++ b/src/test/java/teammates/test/cases/webapi/UpdateFeedbackQuestionActionTest.java\n\n@@ -297,8 +297,7 @@ public class UpdateFeedbackQuestionActionTest extends BaseActionTest<UpdateFeedb\n                 logic.getFeedbackQuestion(typicalQuestion.getId()).getQuestionDescription());\n \n         // recommended length does not change\n-        assertEquals(null, ((FeedbackTextQuestionDetails) typicalQuestion.getQuestionDetails())\n-                .getRecommendedLength());\n+        assertNull(((FeedbackTextQuestionDetails) typicalQuestion.getQuestionDetails()).getRecommendedLength());\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMjEzMA==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457832130", "bodyText": "And in other places.", "author": "xpdavid", "createdAt": "2020-07-21T04:42:07Z", "path": "src/test/java/teammates/test/cases/datatransfer/FeedbackQuestionAttributesTest.java", "diffHunk": "@@ -187,14 +187,14 @@ public void testValueOf_textQuestions_shouldDeserializeCorrectly() throws Invali\n \n         FeedbackQuestionAttributes fqa = FeedbackQuestionAttributes.valueOf(qn);\n         assertEquals(\"singleWord\", fqa.questionDetails.getQuestionText());\n-        assertEquals(0, ((FeedbackTextQuestionDetails) fqa.questionDetails).getRecommendedLength());\n+        assertEquals(null, ((FeedbackTextQuestionDetails) fqa.questionDetails).getRecommendedLength());\n \n         ______TS(\"legacy data: plain text: multiple words, should deserialize correctly\");\n         qn.setQuestionText(\"multiple words text\");\n \n         FeedbackQuestionAttributes fqaMulti = FeedbackQuestionAttributes.valueOf(qn);\n         assertEquals(\"multiple words text\", fqaMulti.questionDetails.getQuestionText());\n-        assertEquals(0, ((FeedbackTextQuestionDetails) fqaMulti.questionDetails).getRecommendedLength());\n+        assertEquals(null, ((FeedbackTextQuestionDetails) fqaMulti.questionDetails).getRecommendedLength());", "originalCommit": "f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "846e821f29f8cfb69750baf55109a139d81fbcca", "chunk": "diff --git a/src/test/java/teammates/test/cases/datatransfer/FeedbackQuestionAttributesTest.java b/src/test/java/teammates/test/cases/datatransfer/FeedbackQuestionAttributesTest.java\nindex a97150c8bc..819be621e6 100644\n--- a/src/test/java/teammates/test/cases/datatransfer/FeedbackQuestionAttributesTest.java\n+++ b/src/test/java/teammates/test/cases/datatransfer/FeedbackQuestionAttributesTest.java\n\n@@ -187,14 +187,14 @@ public class FeedbackQuestionAttributesTest extends BaseAttributesTest {\n \n         FeedbackQuestionAttributes fqa = FeedbackQuestionAttributes.valueOf(qn);\n         assertEquals(\"singleWord\", fqa.questionDetails.getQuestionText());\n-        assertEquals(null, ((FeedbackTextQuestionDetails) fqa.questionDetails).getRecommendedLength());\n+        assertNull(((FeedbackTextQuestionDetails) fqa.questionDetails).getRecommendedLength());\n \n         ______TS(\"legacy data: plain text: multiple words, should deserialize correctly\");\n         qn.setQuestionText(\"multiple words text\");\n \n         FeedbackQuestionAttributes fqaMulti = FeedbackQuestionAttributes.valueOf(qn);\n         assertEquals(\"multiple words text\", fqaMulti.questionDetails.getQuestionText());\n-        assertEquals(null, ((FeedbackTextQuestionDetails) fqaMulti.questionDetails).getRecommendedLength());\n+        assertNull(((FeedbackTextQuestionDetails) fqaMulti.questionDetails).getRecommendedLength());\n \n         ______TS(\"json text: should deserialize as json\");\n         String jsonQuestionText = \"{\\n\"\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMjQ2MQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457832461", "bodyText": "Just a note. This will change the things stored in database (should be backward-compatible though)", "author": "xpdavid", "createdAt": "2020-07-21T04:43:21Z", "path": "src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java", "diffHunk": "@@ -3,21 +3,24 @@\n import java.util.ArrayList;\n import java.util.List;\n \n+import javax.annotation.Nullable;\n+\n import teammates.common.datatransfer.attributes.FeedbackQuestionAttributes;\n import teammates.common.util.Const;\n \n public class FeedbackTextQuestionDetails extends FeedbackQuestionDetails {\n \n-    private int recommendedLength;\n+    @Nullable\n+    private Integer recommendedLength;", "originalCommit": "f7219fbfcdf4a6e0a1aac3ff521d8e4ccada5121", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg0MDU4MA==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457840580", "bodyText": "I added this line if (recommendedLength != null && recommendedLength < 1) which would make all forms using the previous default value show an error if they tried to save. Would this be an issue?", "author": "ccyccyccy", "createdAt": "2020-07-21T05:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMjQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg0MzczMQ==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r457843731", "bodyText": "This is fine as the frontend is bundled with the backend in production.", "author": "xpdavid", "createdAt": "2020-07-21T05:23:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMjQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTgzNjU1Nw==", "url": "https://github.com/TEAMMATES/teammates/pull/10316#discussion_r459836557", "bodyText": "This should be backward compatible because it's equivalent to removing a field. If it's adding a field then we need to worry.", "author": "wkurniawan07", "createdAt": "2020-07-24T03:32:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzgzMjQ2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f13dea5b71af275e26191dd6473e0877f7739e18", "chunk": "diff --git a/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java b/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\nindex a8cbf1e0f3..7336b8ecaa 100644\n--- a/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\n+++ b/src/main/java/teammates/common/datatransfer/questions/FeedbackTextQuestionDetails.java\n\n@@ -3,24 +3,21 @@ package teammates.common.datatransfer.questions;\n import java.util.ArrayList;\n import java.util.List;\n \n-import javax.annotation.Nullable;\n-\n import teammates.common.datatransfer.attributes.FeedbackQuestionAttributes;\n import teammates.common.util.Const;\n \n public class FeedbackTextQuestionDetails extends FeedbackQuestionDetails {\n \n-    @Nullable\n-    private Integer recommendedLength;\n+    private int recommendedLength;\n \n     public FeedbackTextQuestionDetails() {\n         super(FeedbackQuestionType.TEXT);\n-        recommendedLength = null;\n+        recommendedLength = 0;\n     }\n \n     public FeedbackTextQuestionDetails(String questionText) {\n         super(FeedbackQuestionType.TEXT, questionText);\n-        recommendedLength = null;\n+        recommendedLength = 0;\n     }\n \n     @Override\n"}}, {"oid": "846e821f29f8cfb69750baf55109a139d81fbcca", "url": "https://github.com/TEAMMATES/teammates/commit/846e821f29f8cfb69750baf55109a139d81fbcca", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-21T05:13:41Z", "type": "forcePushed"}, {"oid": "f13dea5b71af275e26191dd6473e0877f7739e18", "url": "https://github.com/TEAMMATES/teammates/commit/f13dea5b71af275e26191dd6473e0877f7739e18", "message": "Fix clicking on the menu items collapsing table", "committedDate": "2020-07-21T07:31:01Z", "type": "commit"}, {"oid": "95535b196ec6e877ef044f4bcedd9f13b8f4b382", "url": "https://github.com/TEAMMATES/teammates/commit/95535b196ec6e877ef044f4bcedd9f13b8f4b382", "message": "Empty recommended words box if 0", "committedDate": "2020-07-21T07:31:01Z", "type": "commit"}, {"oid": "41059f3100ff095dc90d106f9169a535100453b9", "url": "https://github.com/TEAMMATES/teammates/commit/41059f3100ff095dc90d106f9169a535100453b9", "message": "Set floating point calculation for statistics table to 2dp", "committedDate": "2020-07-21T07:31:01Z", "type": "commit"}, {"oid": "c4e70cf0297447205b9b945f7c3e906679824d9d", "url": "https://github.com/TEAMMATES/teammates/commit/c4e70cf0297447205b9b945f7c3e906679824d9d", "message": "Update snapshot", "committedDate": "2020-07-21T07:31:01Z", "type": "commit"}, {"oid": "608fd6cd4247ae47b1ad5737cf75c545ca704573", "url": "https://github.com/TEAMMATES/teammates/commit/608fd6cd4247ae47b1ad5737cf75c545ca704573", "message": "Show integers without dp, truncate fractions to 2dp", "committedDate": "2020-07-21T07:31:01Z", "type": "commit"}, {"oid": "04495ee4f728657d4fa54192806936687d131be1", "url": "https://github.com/TEAMMATES/teammates/commit/04495ee4f728657d4fa54192806936687d131be1", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-21T07:31:01Z", "type": "forcePushed"}, {"oid": "7d242656171d38690309abd333abcb4530a0f571", "url": "https://github.com/TEAMMATES/teammates/commit/7d242656171d38690309abd333abcb4530a0f571", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-21T12:40:02Z", "type": "commit"}, {"oid": "7d242656171d38690309abd333abcb4530a0f571", "url": "https://github.com/TEAMMATES/teammates/commit/7d242656171d38690309abd333abcb4530a0f571", "message": "Change default value of recommendedLength for text questions to be undefined instead of 0", "committedDate": "2020-07-21T12:40:02Z", "type": "forcePushed"}, {"oid": "189b4101ac9a55cca03d7fedcd3c89a150c7923d", "url": "https://github.com/TEAMMATES/teammates/commit/189b4101ac9a55cca03d7fedcd3c89a150c7923d", "message": "Merge branch 'master' into 10299-uat-fixes", "committedDate": "2020-07-24T04:53:21Z", "type": "commit"}]}