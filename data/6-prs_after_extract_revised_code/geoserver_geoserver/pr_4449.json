{"pr_number": 4449, "pr_title": "Remove dependency on a wicket class from jdbcconfig.internal.ConfigDatabase", "pr_createdAt": "2020-08-07T03:13:40Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4449", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4MDg5OA==", "url": "https://github.com/geoserver/geoserver/pull/4449#discussion_r467080898", "bodyText": "Is it correct to remove the \" - 1\" here?  If localPropertyName is \"a.b.c.d\", then the backPropName values should be \"a.b.c\", \"a.b\" and \"a\".", "author": "sikeoka", "createdAt": "2020-08-07T14:36:02Z", "path": "src/community/jdbcconfig/src/main/java/org/geoserver/jdbcconfig/internal/ConfigDatabase.java", "diffHunk": "@@ -677,8 +677,8 @@ private Info lookUpRelatedObject(\n         String[] steps = localPropertyName.split(\"\\\\.\");\n         // Step back through ancestor property references If starting at a.b.c.d, then look at\n         // a.b.c, then a.b, then a\n-        for (int i = steps.length - 1; i >= 0; i--) {\n-            String backPropName = Strings.join(\".\", Arrays.copyOfRange(steps, 0, i));\n+        for (int len = steps.length; len > 0; len--) {", "originalCommit": "03858d5ca2f481dacb79bd68539217c2b7479bc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0MTMyMw==", "url": "https://github.com/geoserver/geoserver/pull/4449#discussion_r468241323", "bodyText": "Hey, as far as I can see, it's doing exactly the same than before:\nInstead of\nString backPropName = Strings.join(\".\", Arrays.copyOfRange(steps, 0, i));\nit does:\nString backPropName = Arrays.stream(steps).limit(len).collect(Collectors.joining(\".\"));\nThe key being Stream.limit(), which for the left-most step must be 1, not 0.", "author": "groldan", "createdAt": "2020-08-10T23:31:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4MDg5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgwNTM2MQ==", "url": "https://github.com/geoserver/geoserver/pull/4449#discussion_r468805361", "bodyText": "Running the old code on \"a.b.c.d\" would get [ \"a.b.c\", \"a.b\", \"a\", \"\" ] while your code gets [ \"a.b.c.d\", \"a.b.c\", \"a.b\", \"a\" ].  The empty string in the old code is useless and shouldn't be there.  Adding back the \"- 1\" to your changes gets the desired result of [ \"a.b.c\", \"a.b\", \"a\" ].", "author": "sikeoka", "createdAt": "2020-08-11T19:10:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4MDg5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDE4Njg4OQ==", "url": "https://github.com/geoserver/geoserver/pull/4449#discussion_r474186889", "bodyText": "you're correct. Should be fixed now, thanks.", "author": "groldan", "createdAt": "2020-08-20T18:27:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA4MDg5OA=="}], "type": "inlineReview", "revised_code": {"commit": "7872e1a87bf751976a1e2ad401fec4bcf647c105", "chunk": "diff --git a/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcconfig/internal/ConfigDatabase.java b/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcconfig/internal/ConfigDatabase.java\nindex 716d6e3ab0..75269f4bd5 100644\n--- a/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcconfig/internal/ConfigDatabase.java\n+++ b/src/community/jdbcconfig/src/main/java/org/geoserver/jdbcconfig/internal/ConfigDatabase.java\n\n@@ -677,7 +677,7 @@ public class ConfigDatabase {\n         String[] steps = localPropertyName.split(\"\\\\.\");\n         // Step back through ancestor property references If starting at a.b.c.d, then look at\n         // a.b.c, then a.b, then a\n-        for (int len = steps.length; len > 0; len--) {\n+        for (int len = steps.length - 1; len > 0; len--) {\n             String backPropName = Arrays.stream(steps).limit(len).collect(Collectors.joining(\".\"));\n             Object backProp = ff.property(backPropName).evaluate(info);\n             if (backProp != null) {\n"}}, {"oid": "7872e1a87bf751976a1e2ad401fec4bcf647c105", "url": "https://github.com/geoserver/geoserver/commit/7872e1a87bf751976a1e2ad401fec4bcf647c105", "message": "Remove dependency on a wicket class from jdbcconfig.internal.ConfigDatabase\n\nRemoving usage of wicket's `Strings` utility class from jdbcconfig's\ninternal code, so it the module can/could be used even if web-core is\nexcluded as a dependency.", "committedDate": "2020-08-20T18:27:49Z", "type": "commit"}, {"oid": "d941df92b3212243e5c57022a86ccaab96406a52", "url": "https://github.com/geoserver/geoserver/commit/d941df92b3212243e5c57022a86ccaab96406a52", "message": "Remove unused dependency on com.ning:compress-lzf from gs-jdbcconfig", "committedDate": "2020-08-20T18:29:14Z", "type": "commit"}, {"oid": "d941df92b3212243e5c57022a86ccaab96406a52", "url": "https://github.com/geoserver/geoserver/commit/d941df92b3212243e5c57022a86ccaab96406a52", "message": "Remove unused dependency on com.ning:compress-lzf from gs-jdbcconfig", "committedDate": "2020-08-20T18:29:14Z", "type": "forcePushed"}]}