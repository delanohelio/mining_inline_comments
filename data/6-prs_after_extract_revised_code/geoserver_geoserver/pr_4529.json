{"pr_number": 4529, "pr_title": "MapPreviewPage performance improvement with less catalog queries", "pr_createdAt": "2020-10-08T02:39:49Z", "pr_url": "https://github.com/geoserver/geoserver/pull/4529", "timeline": [{"oid": "1a79e3490047db321b731a5361174dd164e65975", "url": "https://github.com/geoserver/geoserver/commit/1a79e3490047db321b731a5361174dd164e65975", "message": "GEOS-9762: MapPreviewPage performance improvement with less catalog requests\n\nUse the held reference to LayerInfo inside\nPreviewLayer.hasServiceSupport(String serviceName) instead of re-loading\nthe layer from the Catalog on each call.\n\nWith 25 rows per page and 3 CommonFormatLink implementations available,\nit's 75 less queries to the Catalog.", "committedDate": "2020-10-08T02:34:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NjAzMw==", "url": "https://github.com/geoserver/geoserver/pull/4529#discussion_r503076033", "bodyText": "This looks correct, I am not sure why the previous implementation wanted to do a new layer lookup?", "author": "jodygarnett", "createdAt": "2020-10-12T06:58:07Z", "path": "src/web/demo/src/main/java/org/geoserver/web/demo/PreviewLayer.java", "diffHunk": "@@ -339,10 +339,9 @@ private String findFeatureTypeGmlVersion(AttributeType featureType) {\n      * @param serviceName \"WFS\" or \"WMS\"\n      */\n     public boolean hasServiceSupport(String serviceName) {\n-        LayerInfo linfo = GeoServerApplication.get().getCatalog().getLayerByName(this.getName());\n-        if (linfo != null && linfo.getResource() != null && serviceName != null) {\n+        if (layerInfo != null && layerInfo.getResource() != null && serviceName != null) {", "originalCommit": "1a79e3490047db321b731a5361174dd164e65975", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyMDY4Ng==", "url": "https://github.com/geoserver/geoserver/pull/4529#discussion_r503120686", "bodyText": "Refactor happened last year, this bit of code was moved from another class that did not have the layerInfo field, but just the name: https://github.com/geoserver/geoserver/pull/3521/files", "author": "aaime", "createdAt": "2020-10-12T08:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NjAzMw=="}], "type": "inlineReview", "revised_code": null}]}