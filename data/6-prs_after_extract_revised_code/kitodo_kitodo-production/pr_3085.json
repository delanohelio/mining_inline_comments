{"pr_number": 3085, "pr_title": "force page refresh after deletion and copy", "pr_createdAt": "2020-01-22T13:33:55Z", "pr_url": "https://github.com/kitodo/kitodo-production/pull/3085", "timeline": [{"oid": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "url": "https://github.com/kitodo/kitodo-production/commit/e4a8452d977a9bf634928ae7aae7c499e66f10dc", "message": "force page refresh after deletion and copy", "committedDate": "2020-01-22T13:33:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0NTgwNw==", "url": "https://github.com/kitodo/kitodo-production/pull/3085#discussion_r369645807", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import javax.faces.context.ExternalContext;\n          \n          \n            \n            \n          \n          \n            \n            import javax.faces.context.ExternalContext;", "author": "oliver-stoehr", "createdAt": "2020-01-22T15:56:16Z", "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java", "diffHunk": "@@ -11,18 +11,24 @@\n \n package org.kitodo.production.forms.createprocess;\n \n+import java.io.IOException;\n import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import javax.faces.context.ExternalContext;", "originalCommit": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\nindex d8d3d7b0e..566a0c6d2 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n\n@@ -16,19 +16,19 @@ import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import java.util.Objects;\n+\n import javax.faces.context.ExternalContext;\n import javax.faces.context.FacesContext;\n import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang3.tuple.Pair;\n-import org.jboss.weld.context.RequestContext;\n import org.kitodo.api.MdSec;\n import org.kitodo.api.Metadata;\n import org.kitodo.api.dataeditor.rulesetmanagement.Domain;\n import org.kitodo.api.dataformat.IncludedStructuralElement;\n import org.kitodo.exceptions.InvalidMetadataValueException;\n import org.kitodo.exceptions.NoSuchMetadataFieldException;\n-import org.primefaces.PrimeFaces;\n \n public abstract class ProcessDetail implements Serializable {\n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0NjE0NQ==", "url": "https://github.com/kitodo/kitodo-production/pull/3085#discussion_r369646145", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.jboss.weld.context.RequestContext;", "author": "oliver-stoehr", "createdAt": "2020-01-22T15:56:44Z", "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java", "diffHunk": "@@ -11,18 +11,24 @@\n \n package org.kitodo.production.forms.createprocess;\n \n+import java.io.IOException;\n import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import javax.faces.context.ExternalContext;\n+import javax.faces.context.FacesContext;\n+import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang3.tuple.Pair;\n+import org.jboss.weld.context.RequestContext;", "originalCommit": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\nindex d8d3d7b0e..566a0c6d2 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n\n@@ -16,19 +16,19 @@ import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import java.util.Objects;\n+\n import javax.faces.context.ExternalContext;\n import javax.faces.context.FacesContext;\n import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang3.tuple.Pair;\n-import org.jboss.weld.context.RequestContext;\n import org.kitodo.api.MdSec;\n import org.kitodo.api.Metadata;\n import org.kitodo.api.dataeditor.rulesetmanagement.Domain;\n import org.kitodo.api.dataformat.IncludedStructuralElement;\n import org.kitodo.exceptions.InvalidMetadataValueException;\n import org.kitodo.exceptions.NoSuchMetadataFieldException;\n-import org.primefaces.PrimeFaces;\n \n public abstract class ProcessDetail implements Serializable {\n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0NjI2NQ==", "url": "https://github.com/kitodo/kitodo-production/pull/3085#discussion_r369646265", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            import org.primefaces.PrimeFaces;", "author": "oliver-stoehr", "createdAt": "2020-01-22T15:56:55Z", "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java", "diffHunk": "@@ -11,18 +11,24 @@\n \n package org.kitodo.production.forms.createprocess;\n \n+import java.io.IOException;\n import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import javax.faces.context.ExternalContext;\n+import javax.faces.context.FacesContext;\n+import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang3.tuple.Pair;\n+import org.jboss.weld.context.RequestContext;\n import org.kitodo.api.MdSec;\n import org.kitodo.api.Metadata;\n import org.kitodo.api.dataeditor.rulesetmanagement.Domain;\n import org.kitodo.api.dataformat.IncludedStructuralElement;\n import org.kitodo.exceptions.InvalidMetadataValueException;\n import org.kitodo.exceptions.NoSuchMetadataFieldException;\n+import org.primefaces.PrimeFaces;", "originalCommit": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\nindex d8d3d7b0e..566a0c6d2 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n\n@@ -16,19 +16,19 @@ import java.io.Serializable;\n import java.lang.reflect.Method;\n import java.util.Collection;\n import java.util.EnumMap;\n+import java.util.Objects;\n+\n import javax.faces.context.ExternalContext;\n import javax.faces.context.FacesContext;\n import javax.servlet.http.HttpServletRequest;\n \n import org.apache.commons.lang3.tuple.Pair;\n-import org.jboss.weld.context.RequestContext;\n import org.kitodo.api.MdSec;\n import org.kitodo.api.Metadata;\n import org.kitodo.api.dataeditor.rulesetmanagement.Domain;\n import org.kitodo.api.dataformat.IncludedStructuralElement;\n import org.kitodo.exceptions.InvalidMetadataValueException;\n import org.kitodo.exceptions.NoSuchMetadataFieldException;\n-import org.primefaces.PrimeFaces;\n \n public abstract class ProcessDetail implements Serializable {\n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0NjgwOA==", "url": "https://github.com/kitodo/kitodo-production/pull/3085#discussion_r369646808", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ExternalContext ec = FacesContext.getCurrentInstance().getExternalContext();\n          \n          \n            \n                    ExternalContext externalContext = FacesContext.getCurrentInstance().getExternalContext();", "author": "oliver-stoehr", "createdAt": "2020-01-22T15:57:46Z", "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java", "diffHunk": "@@ -63,15 +69,22 @@\n     /**\n      * This method is triggered when the user clicks the copy metadata button.\n      */\n-    public void copy() {\n+    public void copy() throws IOException {\n         container.copy(this);\n+        refreshPage();\n     }\n \n     /**\n      * This method is triggered when the user clicks the delete metadata button.\n      */\n-    public void delete() {\n+    public void delete() throws IOException {\n         container.remove(this);\n+        refreshPage();\n+    }\n+\n+    private void refreshPage() throws IOException {\n+        ExternalContext ec = FacesContext.getCurrentInstance().getExternalContext();", "originalCommit": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\nindex d8d3d7b0e..566a0c6d2 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n\n@@ -83,8 +83,11 @@ public abstract class ProcessDetail implements Serializable {\n     }\n \n     private void refreshPage() throws IOException {\n-        ExternalContext ec = FacesContext.getCurrentInstance().getExternalContext();\n-        ec.redirect(((HttpServletRequest) ec.getRequest()).getRequestURI());\n+        FacesContext currentInstance = FacesContext.getCurrentInstance();\n+        if (Objects.nonNull(currentInstance)) {\n+            ExternalContext externalContext = currentInstance.getExternalContext();\n+            externalContext.redirect(((HttpServletRequest) externalContext.getRequest()).getRequestURI());\n+        }\n     }\n \n     public abstract String getMetadataID();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTY0NzA4Nw==", "url": "https://github.com/kitodo/kitodo-production/pull/3085#discussion_r369647087", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    ec.redirect(((HttpServletRequest) ec.getRequest()).getRequestURI());\n          \n          \n            \n                    externalContext.redirect(((HttpServletRequest) externalContext.getRequest()).getRequestURI());", "author": "oliver-stoehr", "createdAt": "2020-01-22T15:58:13Z", "path": "Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java", "diffHunk": "@@ -63,15 +69,22 @@\n     /**\n      * This method is triggered when the user clicks the copy metadata button.\n      */\n-    public void copy() {\n+    public void copy() throws IOException {\n         container.copy(this);\n+        refreshPage();\n     }\n \n     /**\n      * This method is triggered when the user clicks the delete metadata button.\n      */\n-    public void delete() {\n+    public void delete() throws IOException {\n         container.remove(this);\n+        refreshPage();\n+    }\n+\n+    private void refreshPage() throws IOException {\n+        ExternalContext ec = FacesContext.getCurrentInstance().getExternalContext();\n+        ec.redirect(((HttpServletRequest) ec.getRequest()).getRequestURI());", "originalCommit": "e4a8452d977a9bf634928ae7aae7c499e66f10dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\nindex d8d3d7b0e..566a0c6d2 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/forms/createprocess/ProcessDetail.java\n\n@@ -83,8 +83,11 @@ public abstract class ProcessDetail implements Serializable {\n     }\n \n     private void refreshPage() throws IOException {\n-        ExternalContext ec = FacesContext.getCurrentInstance().getExternalContext();\n-        ec.redirect(((HttpServletRequest) ec.getRequest()).getRequestURI());\n+        FacesContext currentInstance = FacesContext.getCurrentInstance();\n+        if (Objects.nonNull(currentInstance)) {\n+            ExternalContext externalContext = currentInstance.getExternalContext();\n+            externalContext.redirect(((HttpServletRequest) externalContext.getRequest()).getRequestURI());\n+        }\n     }\n \n     public abstract String getMetadataID();\n"}}, {"oid": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "url": "https://github.com/kitodo/kitodo-production/commit/8f8de335117402b7d7b0fd5052e1524bf61f2294", "message": "add nullcheck", "committedDate": "2020-01-23T09:38:36Z", "type": "commit"}, {"oid": "8f8de335117402b7d7b0fd5052e1524bf61f2294", "url": "https://github.com/kitodo/kitodo-production/commit/8f8de335117402b7d7b0fd5052e1524bf61f2294", "message": "add nullcheck", "committedDate": "2020-01-23T09:38:36Z", "type": "forcePushed"}]}