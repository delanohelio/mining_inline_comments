{"pr_number": 4118, "pr_title": "enable configuration of delimiter", "pr_createdAt": "2020-12-03T18:23:34Z", "pr_url": "https://github.com/kitodo/kitodo-production/pull/4118", "timeline": [{"oid": "dcf0c6a6f5ee64c26e1a61a27294f2902fcd7f87", "url": "https://github.com/kitodo/kitodo-production/commit/dcf0c6a6f5ee64c26e1a61a27294f2902fcd7f87", "message": "add sampleConfiguration", "committedDate": "2020-12-08T10:06:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE1NTU2OQ==", "url": "https://github.com/kitodo/kitodo-production/pull/4118#discussion_r543155569", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return configration for catalog's \"queryDelimiter\"\n          \n          \n            \n                 * @return configuration for catalog's \"queryDelimiter\"", "author": "solth", "createdAt": "2020-12-15T08:50:42Z", "path": "Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java", "diffHunk": "@@ -113,6 +113,15 @@ public static HierarchicalConfiguration getUrlParameters(String catalogName) {\n                 .map(c -> c.getRoot().getValue().toString()).collect(Collectors.toList());\n     }\n \n+    /**\n+     * Retrieve the \"queryDelimiter\" of the catalog identified by its title.\n+     * @param catalogName String identifying the catalog by its title\n+     * @return configration for catalog's \"queryDelimiter\"", "originalCommit": "e69b95b9a211b4eb358a21dd5697964aa6aeb9dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d686f7d225a08ffaae79eb6eaf2374cfd3786566", "chunk": "diff --git a/Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java b/Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java\nindex 0f11a5c08..3ee9723ef 100644\n--- a/Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java\n+++ b/Kitodo-API/src/main/java/org/kitodo/config/OPACConfig.java\n\n@@ -104,19 +103,18 @@ public class OPACConfig {\n     }\n \n     /**\n-     * Retrieve list of \"mappingFiles\" of the catalog identified by its title.\n+     * Retrieve the \"mappingFile\" of the catalog identified by its title.\n      * @param catalogName String identifying the catalog by its title\n-     * @return List of Strings containing mapping files names for catalog\n+     * @return HierarchicalConfiguration for catalog's \"mappingFile\"\n      */\n-    public static List<String> getXsltMappingFiles(String catalogName) {\n-        return getCatalog(catalogName).configurationAt(\"mappingFiles\").configurationsAt(\"file\").stream()\n-                .map(c -> c.getRoot().getValue().toString()).collect(Collectors.toList());\n+    public static String getXsltMappingFile(String catalogName) {\n+        return getCatalog(catalogName).getString(\"mappingFile\");\n     }\n \n     /**\n      * Retrieve the \"queryDelimiter\" of the catalog identified by its title.\n      * @param catalogName String identifying the catalog by its title\n-     * @return configration for catalog's \"queryDelimiter\"\n+     * @return configuration for catalog's \"queryDelimiter\"\n      */\n     public static String getQueryDelimiter(String catalogName) {\n         return getCatalog(catalogName).getString(\"queryDelimiter\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE1ODkzMw==", "url": "https://github.com/kitodo/kitodo-production/pull/4118#discussion_r543158933", "bodyText": "Could this method be moved to ImportService and be called inside performSearch there instead? ImportService already imports OPACConfig and I think it would be cleaner if the LazyHitModel itself wouldnt need to manipulate any of the search parameters passed by the user but instead would let the ImportService` handle all that (which is already the case with all other catalog specific settings).", "author": "solth", "createdAt": "2020-12-15T08:55:37Z", "path": "Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java", "diffHunk": "@@ -54,14 +55,28 @@ public int getRowCount() {\n     public List<Object> load(int first, int resultSize, String sortField, SortOrder sortOrder, Map filters) {\n \n         searchResult = ServiceManager.getImportService().performSearch(\n-                this.selectedField, this.searchTerm, this.selectedCatalog, first, resultSize);\n+                this.selectedField, getSearchTermWithDelimiter(this.searchTerm), this.selectedCatalog, first, resultSize);\n \n         if (Objects.isNull(searchResult) || Objects.isNull(searchResult.getHits())) {\n             return Collections.emptyList();\n         }\n         return searchResult.getHits().stream().map(r -> (Object)r).collect(Collectors.toList());\n     }\n \n+    /**\n+     * Returns the searchTerm with configured Delimiter.\n+     * @param searchTerm the searchterm to add delimiters.\n+     * @return searchTermWithDelimiter\n+     */\n+    public String getSearchTermWithDelimiter(String searchTerm) {", "originalCommit": "e69b95b9a211b4eb358a21dd5697964aa6aeb9dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d686f7d225a08ffaae79eb6eaf2374cfd3786566", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java b/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\nindex 2ffc8c7f3..d2da35317 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\n\n@@ -65,16 +65,11 @@ public class LazyHitModel extends LazyDataModel<Object> {\n \n     /**\n      * Returns the searchTerm with configured Delimiter.\n-     * @param searchTerm the searchterm to add delimiters.\n+     * @param searchTerm the search term to add delimiters.\n      * @return searchTermWithDelimiter\n      */\n     public String getSearchTermWithDelimiter(String searchTerm) {\n-        String searchTermWithDelimiter = searchTerm;\n-        String queryDelimiter = OPACConfig.getQueryDelimiter(this.selectedCatalog);\n-        if (Objects.nonNull(queryDelimiter)) {\n-            searchTermWithDelimiter = queryDelimiter + searchTermWithDelimiter + queryDelimiter;\n-        }\n-        return searchTermWithDelimiter;\n+       return OPACConfig.getSearchTermWithDelimiter(searchTerm, this.selectedCatalog);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE1OTAxNw==", "url": "https://github.com/kitodo/kitodo-production/pull/4118#discussion_r543159017", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param searchTerm the searchterm to add delimiters.\n          \n          \n            \n                 * @param searchTerm the search term to add delimiters.", "author": "solth", "createdAt": "2020-12-15T08:55:45Z", "path": "Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java", "diffHunk": "@@ -54,14 +55,28 @@ public int getRowCount() {\n     public List<Object> load(int first, int resultSize, String sortField, SortOrder sortOrder, Map filters) {\n \n         searchResult = ServiceManager.getImportService().performSearch(\n-                this.selectedField, this.searchTerm, this.selectedCatalog, first, resultSize);\n+                this.selectedField, getSearchTermWithDelimiter(this.searchTerm), this.selectedCatalog, first, resultSize);\n \n         if (Objects.isNull(searchResult) || Objects.isNull(searchResult.getHits())) {\n             return Collections.emptyList();\n         }\n         return searchResult.getHits().stream().map(r -> (Object)r).collect(Collectors.toList());\n     }\n \n+    /**\n+     * Returns the searchTerm with configured Delimiter.\n+     * @param searchTerm the searchterm to add delimiters.", "originalCommit": "e69b95b9a211b4eb358a21dd5697964aa6aeb9dc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d686f7d225a08ffaae79eb6eaf2374cfd3786566", "chunk": "diff --git a/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java b/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\nindex 2ffc8c7f3..d2da35317 100644\n--- a/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\n+++ b/Kitodo/src/main/java/org/kitodo/production/model/LazyHitModel.java\n\n@@ -65,16 +65,11 @@ public class LazyHitModel extends LazyDataModel<Object> {\n \n     /**\n      * Returns the searchTerm with configured Delimiter.\n-     * @param searchTerm the searchterm to add delimiters.\n+     * @param searchTerm the search term to add delimiters.\n      * @return searchTermWithDelimiter\n      */\n     public String getSearchTermWithDelimiter(String searchTerm) {\n-        String searchTermWithDelimiter = searchTerm;\n-        String queryDelimiter = OPACConfig.getQueryDelimiter(this.selectedCatalog);\n-        if (Objects.nonNull(queryDelimiter)) {\n-            searchTermWithDelimiter = queryDelimiter + searchTermWithDelimiter + queryDelimiter;\n-        }\n-        return searchTermWithDelimiter;\n+       return OPACConfig.getSearchTermWithDelimiter(searchTerm, this.selectedCatalog);\n     }\n \n     /**\n"}}, {"oid": "d686f7d225a08ffaae79eb6eaf2374cfd3786566", "url": "https://github.com/kitodo/kitodo-production/commit/d686f7d225a08ffaae79eb6eaf2374cfd3786566", "message": "add review", "committedDate": "2020-12-15T16:52:31Z", "type": "forcePushed"}, {"oid": "bfb41e62247b2ebf3b0eae1592350f016320ce91", "url": "https://github.com/kitodo/kitodo-production/commit/bfb41e62247b2ebf3b0eae1592350f016320ce91", "message": "enable configuration of delimiter", "committedDate": "2020-12-15T16:53:24Z", "type": "commit"}, {"oid": "f3aa92786aaee5fafa7dac887e679df46d88f91a", "url": "https://github.com/kitodo/kitodo-production/commit/f3aa92786aaee5fafa7dac887e679df46d88f91a", "message": "add delimiter to recordQuery", "committedDate": "2020-12-15T16:53:24Z", "type": "commit"}, {"oid": "355c092762201d5c73b38ffc2f96a16431f9b66a", "url": "https://github.com/kitodo/kitodo-production/commit/355c092762201d5c73b38ffc2f96a16431f9b66a", "message": "add delimiter", "committedDate": "2020-12-15T16:53:24Z", "type": "commit"}, {"oid": "f662608b514f3189ae0572f7155fd478fc7b62f6", "url": "https://github.com/kitodo/kitodo-production/commit/f662608b514f3189ae0572f7155fd478fc7b62f6", "message": "add sampleConfiguration", "committedDate": "2020-12-15T16:54:19Z", "type": "commit"}, {"oid": "0fd05443e75465482f17c67052e787dd118e57d7", "url": "https://github.com/kitodo/kitodo-production/commit/0fd05443e75465482f17c67052e787dd118e57d7", "message": "add delimiters to parent search", "committedDate": "2020-12-15T16:54:19Z", "type": "commit"}, {"oid": "11ef01441c76afca3cda63fe0cd8ceaab31668b5", "url": "https://github.com/kitodo/kitodo-production/commit/11ef01441c76afca3cda63fe0cd8ceaab31668b5", "message": "add review", "committedDate": "2020-12-15T16:54:20Z", "type": "forcePushed"}, {"oid": "14bc2cdd4b771ef00c893f3a2e6b79f27d43b0c2", "url": "https://github.com/kitodo/kitodo-production/commit/14bc2cdd4b771ef00c893f3a2e6b79f27d43b0c2", "message": "add review", "committedDate": "2020-12-15T17:06:05Z", "type": "forcePushed"}, {"oid": "764fe500488602e1534669e66ad820fe89655f22", "url": "https://github.com/kitodo/kitodo-production/commit/764fe500488602e1534669e66ad820fe89655f22", "message": "add review", "committedDate": "2020-12-15T17:18:25Z", "type": "commit"}, {"oid": "764fe500488602e1534669e66ad820fe89655f22", "url": "https://github.com/kitodo/kitodo-production/commit/764fe500488602e1534669e66ad820fe89655f22", "message": "add review", "committedDate": "2020-12-15T17:18:25Z", "type": "forcePushed"}, {"oid": "b0512db69b7c4b1587b86efcbe93368a3ea7a077", "url": "https://github.com/kitodo/kitodo-production/commit/b0512db69b7c4b1587b86efcbe93368a3ea7a077", "message": "move delimiter adding to importService", "committedDate": "2020-12-18T10:38:23Z", "type": "forcePushed"}, {"oid": "56585ea556e6acfa50529faeb29a843e473f9eef", "url": "https://github.com/kitodo/kitodo-production/commit/56585ea556e6acfa50529faeb29a843e473f9eef", "message": "move delimiter adding to importService", "committedDate": "2020-12-18T10:39:27Z", "type": "commit"}, {"oid": "56585ea556e6acfa50529faeb29a843e473f9eef", "url": "https://github.com/kitodo/kitodo-production/commit/56585ea556e6acfa50529faeb29a843e473f9eef", "message": "move delimiter adding to importService", "committedDate": "2020-12-18T10:39:27Z", "type": "forcePushed"}]}