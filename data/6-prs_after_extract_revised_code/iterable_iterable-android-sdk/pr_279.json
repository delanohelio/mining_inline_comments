{"pr_number": 279, "pr_title": "[MOB-2186] Extract ApiClient", "pr_createdAt": "2020-11-05T05:44:25Z", "pr_url": "https://github.com/Iterable/iterable-android-sdk/pull/279", "timeline": [{"oid": "05838e96feb4fda9c95865f78d9cccbc7171518f", "url": "https://github.com/Iterable/iterable-android-sdk/commit/05838e96feb4fda9c95865f78d9cccbc7171518f", "message": "API Client extraction (WIP)", "committedDate": "2020-11-06T06:17:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ2ODQ5Nw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r521468497", "bodyText": "indentation", "author": "Ayyanchira", "createdAt": "2020-11-11T16:12:21Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -62,13 +59,20 @@\n \n //region Constructor\n //---------------------------------------------------------------------------------------\n-    IterableApi() {\n+IterableApi() {\n+    config = new IterableConfig.Builder().build();\n+}", "originalCommit": "05838e96feb4fda9c95865f78d9cccbc7171518f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwMzE2OA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r526603168", "bodyText": "Huh.. looks like an IntelliJ/Android Studio formatter bug.. It forced this indentation until I added an empty line above.", "author": "vbabenkoru", "createdAt": "2020-11-19T05:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ2ODQ5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "3701bcbd06a34f947c8c560bd2ccd5f47d25d734", "chunk": "diff --git a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\nindex 67410b9..e9f1890 100644\n--- a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n+++ b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n\n@@ -59,9 +59,10 @@ private static final String TAG = \"IterableApi\";\n \n //region Constructor\n //---------------------------------------------------------------------------------------\n-IterableApi() {\n-    config = new IterableConfig.Builder().build();\n-}\n+\n+    IterableApi() {\n+        config = new IterableConfig.Builder().build();\n+    }\n \n     @VisibleForTesting\n     IterableApi(IterableInAppManager inAppManager) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ5Mzc4Nw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r521493787", "bodyText": "Can checkSDKInitialization be also refactored somehow?\nIts been called at start of many Api calls...", "author": "Ayyanchira", "createdAt": "2020-11-11T16:47:41Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -474,23 +481,7 @@ public void track(@NonNull String eventName, int campaignId, int templateId, @Nu\n             return;", "originalCommit": "05838e96feb4fda9c95865f78d9cccbc7171518f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjYwNDYwMg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r522604602", "bodyText": "Hmm, I don't think so... short of doing OOP shenanigans with an interface and 'initialized' and 'non-initialized' implementations.", "author": "vbabenkoru", "createdAt": "2020-11-13T04:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ5Mzc4Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ5MzgwNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r521493805", "bodyText": "Wondering what would be a good case where IterableApi itself is initializing and IterableInAppManager wont be null? \ud83e\udd14", "author": "Ayyanchira", "createdAt": "2020-11-11T16:47:43Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -296,7 +301,9 @@ public static void initialize(@NonNull Context context, @NonNull String apiKey,\n         sharedInstance.checkForDeferredDeeplink();\n         IterableActivityMonitor.getInstance().registerLifecycleCallbacks(context);\n         IterableActivityMonitor.getInstance().addCallback(sharedInstance.activityMonitorListener);\n-        sharedInstance.inAppManager = new IterableInAppManager(sharedInstance, sharedInstance.config.inAppHandler, sharedInstance.config.inAppDisplayInterval);\n+        if (sharedInstance.inAppManager == null) {", "originalCommit": "05838e96feb4fda9c95865f78d9cccbc7171518f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjYwMjY5Ng==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/279#discussion_r522602696", "bodyText": "There is a special constructor for tests where you can inject an inAppManager instance.", "author": "vbabenkoru", "createdAt": "2020-11-13T04:13:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ5MzgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "06888274345669bd35a1a765be8fc5a6ae2a5842", "chunk": "diff --git a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\nindex 67410b9..e26ded1 100644\n--- a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n+++ b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n\n@@ -302,7 +302,8 @@ IterableApi() {\n         IterableActivityMonitor.getInstance().registerLifecycleCallbacks(context);\n         IterableActivityMonitor.getInstance().addCallback(sharedInstance.activityMonitorListener);\n         if (sharedInstance.inAppManager == null) {\n-            sharedInstance.inAppManager = new IterableInAppManager(sharedInstance, sharedInstance.config.inAppHandler, sharedInstance.config.inAppDisplayInterval);\n+            sharedInstance.inAppManager = new IterableInAppManager(sharedInstance, sharedInstance.config.inAppHandler,\n+                    sharedInstance.config.inAppDisplayInterval);\n         }\n         IterablePushActionReceiver.processPendingAction(context);\n     }\n"}}, {"oid": "06888274345669bd35a1a765be8fc5a6ae2a5842", "url": "https://github.com/Iterable/iterable-android-sdk/commit/06888274345669bd35a1a765be8fc5a6ae2a5842", "message": "API Client extraction (WIP)", "committedDate": "2020-11-13T04:10:18Z", "type": "commit"}, {"oid": "06888274345669bd35a1a765be8fc5a6ae2a5842", "url": "https://github.com/Iterable/iterable-android-sdk/commit/06888274345669bd35a1a765be8fc5a6ae2a5842", "message": "API Client extraction (WIP)", "committedDate": "2020-11-13T04:10:18Z", "type": "forcePushed"}, {"oid": "bccb341e58972d9dae7f397545c949d3b3287cf1", "url": "https://github.com/Iterable/iterable-android-sdk/commit/bccb341e58972d9dae7f397545c949d3b3287cf1", "message": "Fix tests by removing partial mocking of IterableApi", "committedDate": "2020-11-19T04:31:51Z", "type": "commit"}, {"oid": "b3b286a07f36dfb2af42e0aeb8cf2f389e0867de", "url": "https://github.com/Iterable/iterable-android-sdk/commit/b3b286a07f36dfb2af42e0aeb8cf2f389e0867de", "message": "Insert additional layer in push registration for easier mocking in tests", "committedDate": "2020-11-19T05:26:33Z", "type": "commit"}, {"oid": "3701bcbd06a34f947c8c560bd2ccd5f47d25d734", "url": "https://github.com/Iterable/iterable-android-sdk/commit/3701bcbd06a34f947c8c560bd2ccd5f47d25d734", "message": "Fix indentation", "committedDate": "2020-11-19T05:28:01Z", "type": "commit"}]}