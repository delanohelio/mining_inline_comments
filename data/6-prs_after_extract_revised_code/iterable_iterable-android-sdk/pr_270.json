{"pr_number": 270, "pr_title": "Fixed the check for string equality by DT", "pr_createdAt": "2020-10-13T16:06:23Z", "pr_url": "https://github.com/Iterable/iterable-android-sdk/pull/270", "timeline": [{"oid": "ad171b9c24815851be43d1cae97bb422715f5779", "url": "https://github.com/Iterable/iterable-android-sdk/commit/ad171b9c24815851be43d1cae97bb422715f5779", "message": "Fixed the check for string equality\nDoesn't call login logic if the auth token has not changed", "committedDate": "2020-10-12T17:35:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504136001", "bodyText": "I think we can just leave the first part of the check (authToken != null && !authToken.equalsIgnoreCase(_authToken)).\nIt will return true if the new token is not null and is different from the current one. The second condition enables one case: when the new token is null and the old token is not null. I'm not sure when we could encounter that and not sure if we want to run login in that case.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:32:52Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java", "diffHunk": "@@ -221,11 +221,11 @@ void setNotificationData(IterableNotificationData data) {\n \n     void setAuthToken(String authToken) {\n         if (isInitialized()) {\n-            if (_authToken != authToken) {\n+            if ((authToken != null && !authToken.equalsIgnoreCase(_authToken)) || (_authToken != null && !_authToken.equalsIgnoreCase(authToken))) {", "originalCommit": "ad171b9c24815851be43d1cae97bb422715f5779", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0MTc1OQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504141759", "bodyText": "Don't we need the second case for the logout case?\nWhen setting the email to null, shouldn't we also be removing the authToken.", "author": "davidtruong", "createdAt": "2020-10-13T17:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE0ODczOQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504148739", "bodyText": "If email is null, isInitialized() will be false and the inner conditional won't be executed.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:54:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5MTIxNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504191215", "bodyText": "Does this flow allow us to set authToken to null?", "author": "Ayyanchira", "createdAt": "2020-10-13T19:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5MTY3NQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504191675", "bodyText": "It does...", "author": "Ayyanchira", "createdAt": "2020-10-13T19:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE5MzA5MA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504193090", "bodyText": "Oh yeah, you're right. If current token is not null, we can set it to null. If it's already null, we don't do anything.", "author": "vbabenkoru", "createdAt": "2020-10-13T19:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwNDMwOQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/270#discussion_r504204309", "bodyText": "But then we will never be able to set it to null...", "author": "Ayyanchira", "createdAt": "2020-10-13T19:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzNjAwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "2654731cc1c5690d59792708a341d4931f17bba6", "chunk": "diff --git a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\nindex 576e838..279bbda 100644\n--- a/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n+++ b/iterableapi/src/main/java/com/iterable/iterableapi/IterableApi.java\n\n@@ -220,11 +220,17 @@ private static final String TAG = \"IterableApi\";\n     }\n \n     void setAuthToken(String authToken) {\n+        setAuthToken(authToken, false);\n+    }\n+\n+    void setAuthToken(String authToken, boolean bypassAuth) {\n         if (isInitialized()) {\n             if ((authToken != null && !authToken.equalsIgnoreCase(_authToken)) || (_authToken != null && !_authToken.equalsIgnoreCase(authToken))) {\n                 _authToken = authToken;\n                 storeAuthData();\n                 onLogIn();\n+            } else if (bypassAuth) {\n+                onLogIn();\n             }\n         }\n     }\n"}}, {"oid": "2654731cc1c5690d59792708a341d4931f17bba6", "url": "https://github.com/Iterable/iterable-android-sdk/commit/2654731cc1c5690d59792708a341d4931f17bba6", "message": "calls login if the auth handler is not implemented.", "committedDate": "2020-10-13T20:23:49Z", "type": "commit"}]}