{"pr_number": 549, "pr_title": "\"scopeFilter\" return wrong data in getPattern APIs #545", "pr_createdAt": "2020-05-13T05:44:10Z", "pr_url": "https://github.com/vmware/singleton/pull/549", "timeline": [{"oid": "ab84740c9b6c9430fbed173b0ae963cc62932d7d", "url": "https://github.com/vmware/singleton/commit/ab84740c9b6c9430fbed173b0ae963cc62932d7d", "message": " Add a new query parameter scopeFilter to the pattern API", "committedDate": "2020-04-16T07:11:22Z", "type": "commit"}, {"oid": "dea6d29146c43096b956fc991aec96b851a27608", "url": "https://github.com/vmware/singleton/commit/dea6d29146c43096b956fc991aec96b851a27608", "message": "fix comment: grammar error", "committedDate": "2020-04-20T02:11:27Z", "type": "commit"}, {"oid": "585be5a264a897e40b4ff5c434b53c1ca1f00e1e", "url": "https://github.com/vmware/singleton/commit/585be5a264a897e40b4ff5c434b53c1ca1f00e1e", "message": "Merge branch 'master' into master", "committedDate": "2020-04-20T02:19:19Z", "type": "commit"}, {"oid": "6ac143eaae77141795637472d30aa8797c570f1d", "url": "https://github.com/vmware/singleton/commit/6ac143eaae77141795637472d30aa8797c570f1d", "message": "Merge branch 'master' into master", "committedDate": "2020-04-28T06:29:31Z", "type": "commit"}, {"oid": "17c3aade7039a525d88125d4f85352ab3369c684", "url": "https://github.com/vmware/singleton/commit/17c3aade7039a525d88125d4f85352ab3369c684", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-05-13T05:13:46Z", "type": "commit"}, {"oid": "cf1ac7a2fefe634b41d06df28df94e64efc09c3e", "url": "https://github.com/vmware/singleton/commit/cf1ac7a2fefe634b41d06df28df94e64efc09c3e", "message": "\"scopeFilter\" return wrong data in getPattern APIs(#545)", "committedDate": "2020-05-13T05:22:55Z", "type": "commit"}, {"oid": "ecb3236f9aae6dda9b05fe7baeeb7e8b5016b6bf", "url": "https://github.com/vmware/singleton/commit/ecb3236f9aae6dda9b05fe7baeeb7e8b5016b6bf", "message": "Confuse description for scopeFilter in getPattern APIs(#546)", "committedDate": "2020-05-13T05:28:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwMjYzMA==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r426402630", "bodyText": "Is it more convenient to filter data when get categorie\u2018s data?", "author": "huihuiw01", "createdAt": "2020-05-18T06:51:02Z", "path": "g11n-ws/modules/md-service-i18n-l2/src/main/java/com/vmware/i18n/l2/service/pattern/PatternServiceImpl.java", "diffHunk": "@@ -240,10 +240,23 @@ private void filterScope(Map<String, Object> patternMap, String scopeFilter) {\n \t\t\treturn;\n \t\t}\n \n-\t\tArrays.asList(scopeFilter.split(ConstantsChar.COMMA)).stream().forEach(scopeNode -> {\n-\t\t\tList<String> scopeFilters = Arrays.asList(scopeNode.split(ConstantsChar.UNDERLINE));\n-\t\t\tremoveData(patternMap, scopeFilters, 0);\n-\t\t});\n+\t\t// If scopeFilter starts with ^, it means deleting the data under the node", "originalCommit": "ecb3236f9aae6dda9b05fe7baeeb7e8b5016b6bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NjQ4Mg==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r426476482", "bodyText": "In the buildPatternMap method, after obtaining the data of categories, there are other processing logics in the follow-up, so it is not recommended to put in the getCategories method.", "author": "chaoq0318", "createdAt": "2020-05-18T09:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwMjYzMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwMzUxNg==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r426403516", "bodyText": "What's the usage of 'scopeFilter'?\nIs it possible to have such value: currency_CNY, measurements_volume-liter, ^(dates_dateTimeFormats_intervalFormats )?\nIf yes, looks like the logic doesn't handle this.", "author": "huihuiw01", "createdAt": "2020-05-18T06:53:08Z", "path": "g11n-ws/modules/md-service-i18n-l2/src/main/java/com/vmware/i18n/l2/service/pattern/PatternServiceImpl.java", "diffHunk": "@@ -240,10 +240,23 @@ private void filterScope(Map<String, Object> patternMap, String scopeFilter) {\n \t\t\treturn;\n \t\t}\n \n-\t\tArrays.asList(scopeFilter.split(ConstantsChar.COMMA)).stream().forEach(scopeNode -> {\n-\t\t\tList<String> scopeFilters = Arrays.asList(scopeNode.split(ConstantsChar.UNDERLINE));\n-\t\t\tremoveData(patternMap, scopeFilters, 0);\n-\t\t});\n+\t\t// If scopeFilter starts with ^, it means deleting the data under the node\n+\t\tif (scopeFilter.startsWith(ConstantsChar.REVERSE)) {", "originalCommit": "ecb3236f9aae6dda9b05fe7baeeb7e8b5016b6bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQyNDA3NA==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r428424074", "bodyText": "Currently only supports forward or reverse, this format is temporarily not supported.", "author": "chaoq0318", "createdAt": "2020-05-21T03:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwMzUxNg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwODc0NA==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r426408744", "bodyText": "scope filter should be 'scopeFilter'", "author": "huihuiw01", "createdAt": "2020-05-18T07:05:24Z", "path": "g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ConstantsMsg.java", "diffHunk": "@@ -27,6 +27,7 @@\n    public static final String PARAM_NOT_VALIDATE = \"The parameter is not pass the validate\";\n    public static final String PATTERN_NOT_VALIDATE = \"The request pattern name is invalid\";\n    public static final String FIFE_NOT_FOUND= \"File is not existing\";\n+   public static final String SCOPE_FILTER_NOT_VALIDATE = \"The request parameter scope filter is invalid, only one filtering method is supported\";", "originalCommit": "ecb3236f9aae6dda9b05fe7baeeb7e8b5016b6bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ3NzExMA==", "url": "https://github.com/vmware/singleton/pull/549#discussion_r426477110", "bodyText": "fixed", "author": "chaoq0318", "createdAt": "2020-05-18T09:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwODc0NA=="}], "type": "inlineReview", "revised_code": {"commit": "b97bf991ebae2ab96c7c066bfb43fa376adcbd46", "chunk": "diff --git a/g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ConstantsMsg.java b/g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ConstantsMsg.java\nindex e3e050e7..2b567ab3 100644\n--- a/g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ConstantsMsg.java\n+++ b/g11n-ws/vip-common/src/main/java/com/vmware/vip/common/constants/ConstantsMsg.java\n\n@@ -27,7 +27,7 @@ public class ConstantsMsg {\n    public static final String PARAM_NOT_VALIDATE = \"The parameter is not pass the validate\";\n    public static final String PATTERN_NOT_VALIDATE = \"The request pattern name is invalid\";\n    public static final String FIFE_NOT_FOUND= \"File is not existing\";\n-   public static final String SCOPE_FILTER_NOT_VALIDATE = \"The request parameter scope filter is invalid, only one filtering method is supported\";\n+   public static final String SCOPE_FILTER_NOT_VALIDATE = \"The request parameter scopeFilter is invalid, only one filtering method is supported\";\n \n    private ConstantsMsg() {\n    }\n"}}, {"oid": "b97bf991ebae2ab96c7c066bfb43fa376adcbd46", "url": "https://github.com/vmware/singleton/commit/b97bf991ebae2ab96c7c066bfb43fa376adcbd46", "message": "fix comment:scope filter should be \"scopeFilter\"", "committedDate": "2020-05-18T09:02:44Z", "type": "commit"}, {"oid": "4113b653e65f2c25a1ca9ee76663d44b442e341c", "url": "https://github.com/vmware/singleton/commit/4113b653e65f2c25a1ca9ee76663d44b442e341c", "message": "Merge branch 'master' into master", "committedDate": "2020-05-21T02:01:30Z", "type": "commit"}]}