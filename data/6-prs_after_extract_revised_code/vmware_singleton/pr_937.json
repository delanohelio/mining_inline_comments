{"pr_number": 937, "pr_title": "fix version api bugs: 933, 935", "pr_createdAt": "2020-12-25T03:19:16Z", "pr_url": "https://github.com/vmware/singleton/pull/937", "timeline": [{"oid": "308c3f752bd570b85e8b26ef303f36a3f34ad244", "url": "https://github.com/vmware/singleton/commit/308c3f752bd570b85e8b26ef303f36a3f34ad244", "message": "fix bug 933: Service name should be singleton-i18n-manager instead of vip-i18n-manager", "committedDate": "2020-12-25T03:09:00Z", "type": "commit"}, {"oid": "f03ea285ca3b582d9844bc4a91c42e923b930556", "url": "https://github.com/vmware/singleton/commit/f03ea285ca3b582d9844bc4a91c42e923b930556", "message": "fix bug 935: Bundle version fallback doesn't work", "committedDate": "2020-12-25T03:10:02Z", "type": "commit"}, {"oid": "f03ea285ca3b582d9844bc4a91c42e923b930556", "url": "https://github.com/vmware/singleton/commit/f03ea285ca3b582d9844bc4a91c42e923b930556", "message": "fix bug 935: Bundle version fallback doesn't work", "committedDate": "2020-12-25T03:10:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzAwNzkyOQ==", "url": "https://github.com/vmware/singleton/pull/937#discussion_r557007929", "bodyText": "In this block, there must be this case: either productname or version is empty. How to get build version in this case?", "author": "Xiaochao8", "createdAt": "2021-01-14T02:42:07Z", "path": "g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/v2/about/AboutVersionAPI.java", "diffHunk": "@@ -44,6 +45,11 @@\n     public APIResponseDTO getVersionInfo(\n             @ApiParam(name = APIParamName.PRODUCT_NAME, required = false, value = APIParamValue.PRODUCT_NAME) @RequestParam(required = false) String productName,\n             @ApiParam(name = APIParamName.VERSION, required = false, value = APIParamValue.VERSION) @RequestParam(required = false) String version) throws AboutAPIException {\n-        return super.handleResponse(APIResponseStatus.OK, versionService.getBuildVersion(productName, version));\n+        if(!StringUtils.isEmpty(productName) && !StringUtils.isEmpty(version)) {\n+            String availableVersion = super.getAvailableVersion(productName, version);\n+            return super.handleVersionFallbackResponse(version, availableVersion, versionService.getBuildVersion(productName, availableVersion));\n+        }else{\n+            return super.handleResponse(APIResponseStatus.OK, versionService.getBuildVersion(productName, version));", "originalCommit": "f03ea285ca3b582d9844bc4a91c42e923b930556", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzAyNjc0OA==", "url": "https://github.com/vmware/singleton/pull/937#discussion_r557026748", "bodyText": "Only return service version.", "author": "huihuiw01", "createdAt": "2021-01-14T03:49:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzAwNzkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzMwMDAzNg==", "url": "https://github.com/vmware/singleton/pull/937#discussion_r557300036", "bodyText": "After change it will return error message.", "author": "huihuiw01", "createdAt": "2021-01-14T10:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzAwNzkyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "b7638d41b17c5ba569ffea327f0dc16013d1b777", "chunk": "diff --git a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/v2/about/AboutVersionAPI.java b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/v2/about/AboutVersionAPI.java\nindex e3a8d8c0..3782d782 100644\n--- a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/v2/about/AboutVersionAPI.java\n+++ b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/v2/about/AboutVersionAPI.java\n\n@@ -45,11 +47,16 @@ public class AboutVersionAPI extends BaseAction {\n     public APIResponseDTO getVersionInfo(\n             @ApiParam(name = APIParamName.PRODUCT_NAME, required = false, value = APIParamValue.PRODUCT_NAME) @RequestParam(required = false) String productName,\n             @ApiParam(name = APIParamName.VERSION, required = false, value = APIParamValue.VERSION) @RequestParam(required = false) String version) throws AboutAPIException {\n-        if(!StringUtils.isEmpty(productName) && !StringUtils.isEmpty(version)) {\n-            String availableVersion = super.getAvailableVersion(productName, version);\n-            return super.handleVersionFallbackResponse(version, availableVersion, versionService.getBuildVersion(productName, availableVersion));\n+        BuildVersionDTO buildVersionDTO = new BuildVersionDTO();\n+        ServiceVersionDTO serviceVersionDTO = versionService.getServiceVersion();\n+        buildVersionDTO.setService(serviceVersionDTO);\n+        if(StringUtils.isEmpty(productName) && StringUtils.isEmpty(version)) {\n+            return super.handleResponse(APIResponseStatus.OK, buildVersionDTO);\n         }else{\n-            return super.handleResponse(APIResponseStatus.OK, versionService.getBuildVersion(productName, version));\n+            String availableVersion = super.getAvailableVersion(productName, version);\n+            BundleVersionDTO bundleVersionDTO = versionService.getBundleVersion(productName, availableVersion);\n+            buildVersionDTO.setBundle(bundleVersionDTO);\n+            return super.handleVersionFallbackResponse(version, availableVersion, buildVersionDTO);\n         }\n     }\n }\n"}}, {"oid": "b7638d41b17c5ba569ffea327f0dc16013d1b777", "url": "https://github.com/vmware/singleton/commit/b7638d41b17c5ba569ffea327f0dc16013d1b777", "message": "change according to review comments", "committedDate": "2021-01-14T10:35:53Z", "type": "commit"}, {"oid": "6c084d6c5125b5065b39672dfc2e01910050a171", "url": "https://github.com/vmware/singleton/commit/6c084d6c5125b5065b39672dfc2e01910050a171", "message": "Merge branch 'master' into master_fixVersionAPIBugs", "committedDate": "2021-01-15T01:09:16Z", "type": "commit"}]}