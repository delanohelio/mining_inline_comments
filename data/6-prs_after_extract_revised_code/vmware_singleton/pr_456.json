{"pr_number": 456, "pr_title": "add parameter verification for get translation with pattern API", "pr_createdAt": "2020-03-16T05:02:23Z", "pr_url": "https://github.com/vmware/singleton/pull/456", "timeline": [{"oid": "4596ca7e006d27e23c267d7e03b9db1c08ec018f", "url": "https://github.com/vmware/singleton/commit/4596ca7e006d27e23c267d7e03b9db1c08ec018f", "message": "add and format the version fallback APIs", "committedDate": "2020-02-26T02:37:41Z", "type": "commit"}, {"oid": "061c835dea17a65f9951a5bf77606b206d1c9b41", "url": "https://github.com/vmware/singleton/commit/061c835dea17a65f9951a5bf77606b206d1c9b41", "message": "update the bug of version fallback", "committedDate": "2020-02-26T07:07:39Z", "type": "commit"}, {"oid": "6443a0b37304cca42b0309c997461fd7850f1066", "url": "https://github.com/vmware/singleton/commit/6443a0b37304cca42b0309c997461fd7850f1066", "message": "Merge branch 'master' into master", "committedDate": "2020-03-04T07:02:29Z", "type": "commit"}, {"oid": "b427f7077007a8f5b388da54a75c2c8ca5048439", "url": "https://github.com/vmware/singleton/commit/b427f7077007a8f5b388da54a75c2c8ca5048439", "message": "Merge branch 'master' into master", "committedDate": "2020-03-04T10:17:15Z", "type": "commit"}, {"oid": "fa519d432220423f9ea23d2ed5f8b9c030c45e8c", "url": "https://github.com/vmware/singleton/commit/fa519d432220423f9ea23d2ed5f8b9c030c45e8c", "message": "add support languager version fallback", "committedDate": "2020-03-04T10:39:46Z", "type": "commit"}, {"oid": "aabccda0c997a31b570c686fc22584c698d2e93c", "url": "https://github.com/vmware/singleton/commit/aabccda0c997a31b570c686fc22584c698d2e93c", "message": "add the unit test for version fallback", "committedDate": "2020-03-05T07:21:13Z", "type": "commit"}, {"oid": "71843b50f42576845956b8370e367ce320a7efde", "url": "https://github.com/vmware/singleton/commit/71843b50f42576845956b8370e367ce320a7efde", "message": "Merge branch 'master' into master", "committedDate": "2020-03-05T09:00:23Z", "type": "commit"}, {"oid": "fe96fd7227b2e529c6965e39bd543433c47dee3d", "url": "https://github.com/vmware/singleton/commit/fe96fd7227b2e529c6965e39bd543433c47dee3d", "message": "fixed the comment", "committedDate": "2020-03-09T08:51:27Z", "type": "commit"}, {"oid": "ffea6c114cf4c561fec9e60093fd5c31614a9f34", "url": "https://github.com/vmware/singleton/commit/ffea6c114cf4c561fec9e60093fd5c31614a9f34", "message": "fixed the comment", "committedDate": "2020-03-09T09:03:38Z", "type": "commit"}, {"oid": "afaeb215805b29774a4da9f01b4e79f778ea65d9", "url": "https://github.com/vmware/singleton/commit/afaeb215805b29774a4da9f01b4e79f778ea65d9", "message": "fixed the comment of the colin", "committedDate": "2020-03-10T01:24:35Z", "type": "commit"}, {"oid": "c179a31b5029d60f5144ae5fd3b713403be072bf", "url": "https://github.com/vmware/singleton/commit/c179a31b5029d60f5144ae5fd3b713403be072bf", "message": "Miss copyright and license headers", "committedDate": "2020-03-10T10:46:10Z", "type": "commit"}, {"oid": "d0d390f925fa0bc9d60809408d82c0d494b637ca", "url": "https://github.com/vmware/singleton/commit/d0d390f925fa0bc9d60809408d82c0d494b637ca", "message": "Merge branch 'master' into master", "committedDate": "2020-03-10T11:12:45Z", "type": "commit"}, {"oid": "1d682f53993f10d3f7e3a6f0f0816e0d160fc43a", "url": "https://github.com/vmware/singleton/commit/1d682f53993f10d3f7e3a6f0f0816e0d160fc43a", "message": "Merge branch 'master' into master", "committedDate": "2020-03-11T01:59:50Z", "type": "commit"}, {"oid": "b612e7b05721d299951e3d6fc739d511a4db4c3f", "url": "https://github.com/vmware/singleton/commit/b612e7b05721d299951e3d6fc739d511a4db4c3f", "message": "add the validate for get translation and pattern", "committedDate": "2020-03-16T03:59:30Z", "type": "commit"}, {"oid": "6dce6df105fedb70301f2fb8c65e37d8ed301a75", "url": "https://github.com/vmware/singleton/commit/6dce6df105fedb70301f2fb8c65e37d8ed301a75", "message": "Merge branch 'master' into master", "committedDate": "2020-03-16T05:03:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUyMDg4NQ==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r393520885", "bodyText": "Don't use RuntimeException, it will cause thread exit.", "author": "linr211", "createdAt": "2020-03-17T08:46:17Z", "path": "g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java", "diffHunk": "@@ -51,6 +52,12 @@\n \t    */\n \t   public APIResponseDTO getTransPattern(TranslationWithPatternDTO data) throws Exception {\n \t      logger.info(\"begin getTransPattern\");\n+\t      try {\n+\t    \t  ParameterValidationUtility.validateTranslationWithPatternAPI(data);\n+\t      }catch(RuntimeException excep) {", "originalCommit": "6dce6df105fedb70301f2fb8c65e37d8ed301a75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMzk1Ng==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394133956", "bodyText": "done", "author": "tigershi", "createdAt": "2020-03-18T06:46:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUyMDg4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "5e5feec50643be5fd9fcce9bd823d5e1bf2a0749", "chunk": "diff --git a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\nindex ec522b8c..620c7fdc 100644\n--- a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\n+++ b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\n\n@@ -52,12 +53,6 @@ public class TranslationWithPatternAction extends BaseAction {\n \t    */\n \t   public APIResponseDTO getTransPattern(TranslationWithPatternDTO data) throws Exception {\n \t      logger.info(\"begin getTransPattern\");\n-\t      try {\n-\t    \t  ParameterValidationUtility.validateTranslationWithPatternAPI(data);\n-\t      }catch(RuntimeException excep) {\n-\t    \t  return super.handleResponse(APIResponseStatus.BAD_REQUEST.getCode(),\n-\t    \t\t\t  excep.getMessage(), null);\n-\t      }\n \t      if (validate(data)) {\n \t    \t  List<String> availableVersions = null;\n \t          try {\n"}}, {"oid": "82184100744be4207fa48621c32baf4d5bf478bc", "url": "https://github.com/vmware/singleton/commit/82184100744be4207fa48621c32baf4d5bf478bc", "message": "Merge branch 'master' into master", "committedDate": "2020-03-18T06:46:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNjQ1MA==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394206450", "bodyText": "put the validation in 'validate' function\ndon't need the catch since the function will throw it.", "author": "linr211", "createdAt": "2020-03-18T09:25:15Z", "path": "g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java", "diffHunk": "@@ -51,6 +53,12 @@\n \t    */\n \t   public APIResponseDTO getTransPattern(TranslationWithPatternDTO data) throws Exception {\n \t      logger.info(\"begin getTransPattern\");\n+\t      try {\n+\t    \t  ParameterValidationUtility.validateTranslationWithPatternAPI(data);\n+\t      }catch(VIPAPIException excep) {\n+\t    \t  return super.handleResponse(APIResponseStatus.BAD_REQUEST.getCode(),\n+\t    \t\t\t  excep.getMessage(), null);\n+\t      }", "originalCommit": "69ff42f6d8bd930b7f77d00bb51269bc52ac0081", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3NTEzMg==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394775132", "bodyText": "2, if don't catch the exception, the default http response code is 520", "author": "tigershi", "createdAt": "2020-03-19T03:44:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNjQ1MA=="}], "type": "inlineReview", "revised_code": {"commit": "5e5feec50643be5fd9fcce9bd823d5e1bf2a0749", "chunk": "diff --git a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\nindex 0bd5fb42..620c7fdc 100644\n--- a/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\n+++ b/g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java\n\n@@ -53,12 +53,6 @@ public class TranslationWithPatternAction extends BaseAction {\n \t    */\n \t   public APIResponseDTO getTransPattern(TranslationWithPatternDTO data) throws Exception {\n \t      logger.info(\"begin getTransPattern\");\n-\t      try {\n-\t    \t  ParameterValidationUtility.validateTranslationWithPatternAPI(data);\n-\t      }catch(VIPAPIException excep) {\n-\t    \t  return super.handleResponse(APIResponseStatus.BAD_REQUEST.getCode(),\n-\t    \t\t\t  excep.getMessage(), null);\n-\t      }\n \t      if (validate(data)) {\n \t    \t  List<String> availableVersions = null;\n \t          try {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNjk4Ng==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394206986", "bodyText": "remove 'private ParameterValidationUtility() {}', it's not required.", "author": "linr211", "createdAt": "2020-03-18T09:26:05Z", "path": "g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/utils/ParameterValidationUtility.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 VMware, Inc.\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package com.vmware.vip.i18n.api.base.utils;\n+\n+\n+import org.apache.commons.lang3.StringUtils;\n+import com.vmware.vip.common.constants.ValidationMsg;\n+import com.vmware.vip.common.exceptions.VIPAPIException;\n+import com.vmware.vip.common.i18n.dto.TranslationWithPatternDTO;\n+import com.vmware.vip.common.utils.RegExpValidatorUtils;\n+\n+public class ParameterValidationUtility{\n+\tprivate ParameterValidationUtility() {}", "originalCommit": "69ff42f6d8bd930b7f77d00bb51269bc52ac0081", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc0NzEwNg==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394747106", "bodyText": "Yes, I agree with you. But the Sonarqube scan it as a issue", "author": "tigershi", "createdAt": "2020-03-19T01:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNjk4Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5e5feec50643be5fd9fcce9bd823d5e1bf2a0749", "url": "https://github.com/vmware/singleton/commit/5e5feec50643be5fd9fcce9bd823d5e1bf2a0749", "message": "fixed the comment of the validate parameters", "committedDate": "2020-03-19T02:07:20Z", "type": "commit"}, {"oid": "c881bb76eee0f154f4dff52b1f601fb77c265ddc", "url": "https://github.com/vmware/singleton/commit/c881bb76eee0f154f4dff52b1f601fb77c265ddc", "message": "fixed the comment of the validate parameters", "committedDate": "2020-03-19T03:54:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1NjI5OA==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394956298", "bodyText": "Is this duplicate validation because there has already called validate in TranslationWithPatternAction.java ?", "author": "Xiaochao8", "createdAt": "2020-03-19T11:23:40Z", "path": "g11n-ws/modules/md-service-authen/src/main/java/com/vmware/vip/core/validation/ParameterValidation.java", "diffHunk": "@@ -34,6 +33,7 @@ public void validate() throws ValidationException {\n \t\tvalidateComponent(request);\n \t\tvalidateKey(request);\n \t\tvalidateLocale(request);\n+\t\tvalidateLanguage(request);", "originalCommit": "c881bb76eee0f154f4dff52b1f601fb77c265ddc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk5ODczMQ==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394998731", "bodyText": "it only can validate the path variable or query parameter, can't validate the post content", "author": "tigershi", "createdAt": "2020-03-19T12:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1NjI5OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2NTUxOQ==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r394965519", "bodyText": "How about change validate throwing VIPAPIException for other conditions to unify the process?", "author": "Xiaochao8", "createdAt": "2020-03-19T11:41:42Z", "path": "g11n-ws/modules/md-restful-api-i18n/src/main/java/com/vmware/vip/i18n/api/base/TranslationWithPatternAction.java", "diffHunk": "@@ -51,7 +53,14 @@\n \t    */\n \t   public APIResponseDTO getTransPattern(TranslationWithPatternDTO data) throws Exception {\n \t      logger.info(\"begin getTransPattern\");\n-\t      if (validate(data)) {\n+\t      boolean validateResult;\n+\t      try {\n+\t    \t  validateResult = validate(data);\n+\t      }catch(VIPAPIException excep) {\n+\t    \t  return super.handleResponse(APIResponseStatus.BAD_REQUEST.getCode(),\n+\t    \t\t\t  excep.getMessage(), null);\n+\t      }\n+\t      if (validateResult) {", "originalCommit": "c881bb76eee0f154f4dff52b1f601fb77c265ddc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAwMzE2Ng==", "url": "https://github.com/vmware/singleton/pull/456#discussion_r395003166", "bodyText": "I agree with you, But need to change a lot other business code and this API will delete after JS client change to get API", "author": "tigershi", "createdAt": "2020-03-19T12:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk2NTUxOQ=="}], "type": "inlineReview", "revised_code": null}]}