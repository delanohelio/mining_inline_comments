{"pr_number": 569, "pr_title": "No cache update in GetProductTranslationAPI", "pr_createdAt": "2020-05-20T06:53:59Z", "pr_url": "https://github.com/vmware/singleton/pull/569", "timeline": [{"oid": "5569ee8a69dbbd23c2aeb8c15f8549596dc1868b", "url": "https://github.com/vmware/singleton/commit/5569ee8a69dbbd23c2aeb8c15f8549596dc1868b", "message": "Check parameter scope for APIs", "committedDate": "2020-04-08T04:12:47Z", "type": "commit"}, {"oid": "ed53f30249e75daed5aea5094163c303b3343367", "url": "https://github.com/vmware/singleton/commit/ed53f30249e75daed5aea5094163c303b3343367", "message": "Merge branch 'master' into master", "committedDate": "2020-04-08T07:30:02Z", "type": "commit"}, {"oid": "d8c075699556f3b19122afe1f97c9b708eb82710", "url": "https://github.com/vmware/singleton/commit/d8c075699556f3b19122afe1f97c9b708eb82710", "message": "Add Deprecated for post method get translation and patterns hasno dependencies", "committedDate": "2020-04-09T00:43:59Z", "type": "commit"}, {"oid": "52b529e8ebe8ea1e9b34cd7d2a2a64499827a286", "url": "https://github.com/vmware/singleton/commit/52b529e8ebe8ea1e9b34cd7d2a2a64499827a286", "message": "split the source collect from singleton server", "committedDate": "2020-04-20T09:57:03Z", "type": "commit"}, {"oid": "b2c0a2156d3a750ff4628d12ed3b490e772c080a", "url": "https://github.com/vmware/singleton/commit/b2c0a2156d3a750ff4628d12ed3b490e772c080a", "message": "fixed the validate of source collect", "committedDate": "2020-04-21T02:02:06Z", "type": "commit"}, {"oid": "d60de4d3fbfaa4995075b096cd4f7c1074efb30e", "url": "https://github.com/vmware/singleton/commit/d60de4d3fbfaa4995075b096cd4f7c1074efb30e", "message": "update the api description", "committedDate": "2020-04-21T06:46:36Z", "type": "commit"}, {"oid": "f3d29219b443356be7db1e66eed8ab7f5047e4c5", "url": "https://github.com/vmware/singleton/commit/f3d29219b443356be7db1e66eed8ab7f5047e4c5", "message": "fixed the source collect url and ignore the v1 apis", "committedDate": "2020-04-22T01:51:23Z", "type": "commit"}, {"oid": "0e8f805c75c27a96fa75a49f0e0ab8d64a7a328f", "url": "https://github.com/vmware/singleton/commit/0e8f805c75c27a96fa75a49f0e0ab8d64a7a328f", "message": "fixed the source api comment", "committedDate": "2020-04-23T02:12:38Z", "type": "commit"}, {"oid": "6e0663cc18eface60cc6762c4d7ce69243fff393", "url": "https://github.com/vmware/singleton/commit/6e0663cc18eface60cc6762c4d7ce69243fff393", "message": "add licence header for build file", "committedDate": "2020-04-23T06:33:37Z", "type": "commit"}, {"oid": "7790a57a730e216779eeb9d3627a9e12ad9df0be", "url": "https://github.com/vmware/singleton/commit/7790a57a730e216779eeb9d3627a9e12ad9df0be", "message": "fixed the pip line", "committedDate": "2020-04-28T01:40:02Z", "type": "commit"}, {"oid": "9a88371ca7587b899cf0e575d22267b143807476", "url": "https://github.com/vmware/singleton/commit/9a88371ca7587b899cf0e575d22267b143807476", "message": "Merge branch 'master' into master", "committedDate": "2020-04-28T02:31:11Z", "type": "commit"}, {"oid": "d4e4bf0203f13177854f663f4da1bd803139b770", "url": "https://github.com/vmware/singleton/commit/d4e4bf0203f13177854f663f4da1bd803139b770", "message": "fixed the pip line", "committedDate": "2020-04-28T02:58:31Z", "type": "commit"}, {"oid": "e46e0aa513828045b2bcb661de4c3dd4dd7d15fa", "url": "https://github.com/vmware/singleton/commit/e46e0aa513828045b2bcb661de4c3dd4dd7d15fa", "message": "fixed the pip line", "committedDate": "2020-04-28T04:15:06Z", "type": "commit"}, {"oid": "44f27a31484c6b1770a7aeae4091b4014636c033", "url": "https://github.com/vmware/singleton/commit/44f27a31484c6b1770a7aeae4091b4014636c033", "message": "fixed the pip line", "committedDate": "2020-04-28T04:19:49Z", "type": "commit"}, {"oid": "e6db5d17622b93901eac6443c5f501efffb745f8", "url": "https://github.com/vmware/singleton/commit/e6db5d17622b93901eac6443c5f501efffb745f8", "message": "fixed the source collection response status", "committedDate": "2020-05-06T06:40:59Z", "type": "commit"}, {"oid": "0388f06c6e944191dd4629ea0a6529221de298d9", "url": "https://github.com/vmware/singleton/commit/0388f06c6e944191dd4629ea0a6529221de298d9", "message": "revert the i18n codes", "committedDate": "2020-05-13T02:34:44Z", "type": "commit"}, {"oid": "2f47478208a42eccfc46b18a442435e95341206e", "url": "https://github.com/vmware/singleton/commit/2f47478208a42eccfc46b18a442435e95341206e", "message": "fixed the comment", "committedDate": "2020-05-13T07:19:44Z", "type": "commit"}, {"oid": "03a2db28198da42c12129f582a79cc2a21f66ac9", "url": "https://github.com/vmware/singleton/commit/03a2db28198da42c12129f582a79cc2a21f66ac9", "message": "Merge branch 'master' into master", "committedDate": "2020-05-14T03:15:10Z", "type": "commit"}, {"oid": "dafe39705c0e5f8e9231c8beb9178bccecdb2da7", "url": "https://github.com/vmware/singleton/commit/dafe39705c0e5f8e9231c8beb9178bccecdb2da7", "message": "Merge branch 'master' into master", "committedDate": "2020-05-19T02:14:51Z", "type": "commit"}, {"oid": "63c9342429589137e1bbe0e259f63d5a8ef14fc0", "url": "https://github.com/vmware/singleton/commit/63c9342429589137e1bbe0e259f63d5a8ef14fc0", "message": "Merge branch 'master' into master", "committedDate": "2020-05-20T06:54:33Z", "type": "commit"}, {"oid": "a208326e1421ecd2d2a060cdd5b644f8ea9a3e2d", "url": "https://github.com/vmware/singleton/commit/a208326e1421ecd2d2a060cdd5b644f8ea9a3e2d", "message": "No cache update in GetProductTranslationAPI", "committedDate": "2020-05-20T06:59:11Z", "type": "commit"}, {"oid": "d83072b1228c42405fab594a705e5343c3f5bbe5", "url": "https://github.com/vmware/singleton/commit/d83072b1228c42405fab594a705e5343c3f5bbe5", "message": "No cache update in GetProductTranslationAPI", "committedDate": "2020-05-20T07:07:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1OTU1MA==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r427859550", "bodyText": "Why delete the cache\uff1f", "author": "Xiaochao8", "createdAt": "2020-05-20T09:12:04Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,6 +171,19 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n+\t\tmultComp.setProductName(productName);\n+\t\tmultComp.setVersion(version);\n+\t\tmultComp.setLocales(getSupportedLocaleList(productName, version));\n+\t\tmultComp.setComponents(getComponentNameList(productName, version));\n+\t\tString multKey = CachedKeyGetter.getMultiComponentsCachedKey(multComp);\n+\t\ttry {\n+\t\t\tTranslationCache3.deleteCachedObject(CacheName.MULTCOMPONENT, multKey, com.vmware.vip.core.messages.service.multcomponent.TranslationDTO.class);\n+\t\t} catch (VIPCacheException e) {\n+\t\t\t// TODO Auto-generated catch block\n+\t\t\tthrow new L3APIException(\n+\t\t\t\t\t\"MULTCOMPONENT cache occurs error when update translation.\", e);\n+\t\t}", "originalCommit": "d83072b1228c42405fab594a705e5343c3f5bbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5NDQ4NQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428394485", "bodyText": "Delete cache content that have updated translation", "author": "tigershi", "createdAt": "2020-05-21T01:20:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1OTU1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM5NzQwNw==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428397407", "bodyText": "This use the deleteCachedObject method,  not delete cache", "author": "tigershi", "createdAt": "2020-05-21T01:32:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg1OTU1MA=="}], "type": "inlineReview", "revised_code": {"commit": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "chunk": "diff --git a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\nindex 3d84a228..e9541d3e 100644\n--- a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n+++ b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n\n@@ -171,6 +167,18 @@ public class ProductService implements IProductService {\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());\n+\t\treturn translationDTOList;\n+\t}\n+\t\n+\t/**\n+\t * update the MultComponent Cache project when update translations\n+\t * \n+\t * @param productName\n+\t * @param version\n+\t * @throws L3APIException\n+\t */\n+\tprivate void updateMultComponentCache(String productName, String version) throws L3APIException {\n \t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n \t\tmultComp.setProductName(productName);\n \t\tmultComp.setVersion(version);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ4OTk2NQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428489965", "bodyText": "Delete todo", "author": "Xiaochao8", "createdAt": "2020-05-21T07:25:51Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,6 +171,19 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n+\t\tmultComp.setProductName(productName);\n+\t\tmultComp.setVersion(version);\n+\t\tmultComp.setLocales(getSupportedLocaleList(productName, version));\n+\t\tmultComp.setComponents(getComponentNameList(productName, version));\n+\t\tString multKey = CachedKeyGetter.getMultiComponentsCachedKey(multComp);\n+\t\ttry {\n+\t\t\tTranslationCache3.deleteCachedObject(CacheName.MULTCOMPONENT, multKey, com.vmware.vip.core.messages.service.multcomponent.TranslationDTO.class);\n+\t\t} catch (VIPCacheException e) {\n+\t\t\t// TODO Auto-generated catch block", "originalCommit": "d83072b1228c42405fab594a705e5343c3f5bbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MjAzNA==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428492034", "bodyText": "done", "author": "tigershi", "createdAt": "2020-05-21T07:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ4OTk2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "chunk": "diff --git a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\nindex 3d84a228..e9541d3e 100644\n--- a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n+++ b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n\n@@ -171,6 +167,18 @@ public class ProductService implements IProductService {\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());\n+\t\treturn translationDTOList;\n+\t}\n+\t\n+\t/**\n+\t * update the MultComponent Cache project when update translations\n+\t * \n+\t * @param productName\n+\t * @param version\n+\t * @throws L3APIException\n+\t */\n+\tprivate void updateMultComponentCache(String productName, String version) throws L3APIException {\n \t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n \t\tmultComp.setProductName(productName);\n \t\tmultComp.setVersion(version);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MDkyNQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428490925", "bodyText": "Does this error return to user?\nIf so, it's wrong because updating has been successful.", "author": "Xiaochao8", "createdAt": "2020-05-21T07:28:22Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,6 +171,19 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n+\t\tmultComp.setProductName(productName);\n+\t\tmultComp.setVersion(version);\n+\t\tmultComp.setLocales(getSupportedLocaleList(productName, version));\n+\t\tmultComp.setComponents(getComponentNameList(productName, version));\n+\t\tString multKey = CachedKeyGetter.getMultiComponentsCachedKey(multComp);\n+\t\ttry {\n+\t\t\tTranslationCache3.deleteCachedObject(CacheName.MULTCOMPONENT, multKey, com.vmware.vip.core.messages.service.multcomponent.TranslationDTO.class);\n+\t\t} catch (VIPCacheException e) {\n+\t\t\t// TODO Auto-generated catch block\n+\t\t\tthrow new L3APIException(\n+\t\t\t\t\t\"MULTCOMPONENT cache occurs error when update translation.\", e);", "originalCommit": "d83072b1228c42405fab594a705e5343c3f5bbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5NTE0NQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r428495145", "bodyText": "This is just to remind that the cache occurs error", "author": "tigershi", "createdAt": "2020-05-21T07:38:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ5MDkyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "chunk": "diff --git a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\nindex 3d84a228..e9541d3e 100644\n--- a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n+++ b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n\n@@ -171,6 +167,18 @@ public class ProductService implements IProductService {\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());\n+\t\treturn translationDTOList;\n+\t}\n+\t\n+\t/**\n+\t * update the MultComponent Cache project when update translations\n+\t * \n+\t * @param productName\n+\t * @param version\n+\t * @throws L3APIException\n+\t */\n+\tprivate void updateMultComponentCache(String productName, String version) throws L3APIException {\n \t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n \t\tmultComp.setProductName(productName);\n \t\tmultComp.setVersion(version);\n"}}, {"oid": "6df5c6744e69a881f6d969f5d94e23960d76ff4c", "url": "https://github.com/vmware/singleton/commit/6df5c6744e69a881f6d969f5d94e23960d76ff4c", "message": "Merge branch 'master' into master", "committedDate": "2020-05-25T02:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3ODcxOA==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429778718", "bodyText": "not good in the loop.", "author": "linr211", "createdAt": "2020-05-25T07:38:08Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -145,9 +146,13 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\tList<ComponentMessagesDTO> componentMessagesDTOList)\n \t\t\tthrows L3APIException {\n \t\tList<TranslationDTO> translationDTOList = new ArrayList<TranslationDTO>();\n+\t\tString productName = null;\n+\t\tString version = null;\n \t\tfor (ComponentMessagesDTO componentMessagesDTO : componentMessagesDTOList) {\n \t\t\ttry {\n \t\t\t\tupdateTranslation(componentMessagesDTO);\n+\t\t\t\tproductName = componentMessagesDTO.getProductName();", "originalCommit": "da8eefa7da0437afaf4abc152d5db6e72ba17cbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzQyOQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429793429", "bodyText": "done", "author": "tigershi", "createdAt": "2020-05-25T08:08:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3ODcxOA=="}], "type": "inlineReview", "revised_code": {"commit": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "chunk": "diff --git a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\nindex 3d84a228..e9541d3e 100644\n--- a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n+++ b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n\n@@ -146,13 +146,9 @@ public class ProductService implements IProductService {\n \t\t\tList<ComponentMessagesDTO> componentMessagesDTOList)\n \t\t\tthrows L3APIException {\n \t\tList<TranslationDTO> translationDTOList = new ArrayList<TranslationDTO>();\n-\t\tString productName = null;\n-\t\tString version = null;\n \t\tfor (ComponentMessagesDTO componentMessagesDTO : componentMessagesDTOList) {\n \t\t\ttry {\n \t\t\t\tupdateTranslation(componentMessagesDTO);\n-\t\t\t\tproductName = componentMessagesDTO.getProductName();\n-\t\t\t\tversion = componentMessagesDTO.getVersion();\n \t\t\t} catch (VIPCacheException e) {\n \t\t\t\tthrow new L3APIException(\n \t\t\t\t\t\t\"Cache occurs error when update translation.\", e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3OTIyNw==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429779227", "bodyText": "put them in a private method.", "author": "linr211", "createdAt": "2020-05-25T07:39:13Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,6 +171,19 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n+\t\tmultComp.setProductName(productName);\n+\t\tmultComp.setVersion(version);\n+\t\tmultComp.setLocales(getSupportedLocaleList(productName, version));\n+\t\tmultComp.setComponents(getComponentNameList(productName, version));\n+\t\tString multKey = CachedKeyGetter.getMultiComponentsCachedKey(multComp);", "originalCommit": "da8eefa7da0437afaf4abc152d5db6e72ba17cbc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5MzMyOA==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429793328", "bodyText": "done", "author": "tigershi", "createdAt": "2020-05-25T08:08:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3OTIyNw=="}], "type": "inlineReview", "revised_code": {"commit": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "chunk": "diff --git a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\nindex 3d84a228..e9541d3e 100644\n--- a/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n+++ b/g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java\n\n@@ -171,6 +167,18 @@ public class ProductService implements IProductService {\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());\n+\t\treturn translationDTOList;\n+\t}\n+\t\n+\t/**\n+\t * update the MultComponent Cache project when update translations\n+\t * \n+\t * @param productName\n+\t * @param version\n+\t * @throws L3APIException\n+\t */\n+\tprivate void updateMultComponentCache(String productName, String version) throws L3APIException {\n \t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n \t\tmultComp.setProductName(productName);\n \t\tmultComp.setVersion(version);\n"}}, {"oid": "864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "url": "https://github.com/vmware/singleton/commit/864ebe2ef31b45d323e3595f17e9d9f3080e5dea", "message": "format code for update multcomponent cache", "committedDate": "2020-05-25T08:37:51Z", "type": "commit"}, {"oid": "84f0f520a6fee0e89781b5ae144cdecb2228462d", "url": "https://github.com/vmware/singleton/commit/84f0f520a6fee0e89781b5ae144cdecb2228462d", "message": "Merge branch 'master' into master", "committedDate": "2020-05-25T09:15:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0NjM2Ng==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429846366", "bodyText": "Is it necessary to judge length of componentMessagesDTOList greater than 0?", "author": "Xiaochao8", "createdAt": "2020-05-25T09:54:27Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,8 +167,31 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());", "originalCommit": "84f0f520a6fee0e89781b5ae144cdecb2228462d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDEwODQ5Mw==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r430108493", "bodyText": "It is not necessary. because have not null validation", "author": "tigershi", "createdAt": "2020-05-26T00:54:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0NjM2Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0Njc0MQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429846741", "bodyText": "Here should log an error message rather than throwing an exception because translation has been updated successfully.", "author": "Xiaochao8", "createdAt": "2020-05-25T09:55:19Z", "path": "g11n-ws/modules/md-service-i18n-l3/src/main/java/com/vmware/vip/core/messages/service/product/ProductService.java", "diffHunk": "@@ -166,8 +167,31 @@ private DropVersionDTO getDropVersion(DropVersionDTO versioninfo,JSONObject jo,\n \t\t\t\t\t\t+ componentMessagesDTO.getVersion(), e);\n \t\t\t}\n \t\t}\n+\t\tupdateMultComponentCache(componentMessagesDTOList.get(0).getProductName(), componentMessagesDTOList.get(0).getVersion());\n \t\treturn translationDTOList;\n \t}\n+\t\n+\t/**\n+\t * update the MultComponent Cache project when update translations\n+\t * \n+\t * @param productName\n+\t * @param version\n+\t * @throws L3APIException\n+\t */\n+\tprivate void updateMultComponentCache(String productName, String version) throws L3APIException {\n+\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO multComp = new com.vmware.vip.core.messages.service.multcomponent.TranslationDTO();\n+\t\tmultComp.setProductName(productName);\n+\t\tmultComp.setVersion(version);\n+\t\tmultComp.setLocales(getSupportedLocaleList(productName, version));\n+\t\tmultComp.setComponents(getComponentNameList(productName, version));\n+\t\tString multKey = CachedKeyGetter.getMultiComponentsCachedKey(multComp);\n+\t\ttry {\n+\t\t\tTranslationCache3.deleteCachedObject(CacheName.MULTCOMPONENT, multKey,\n+\t\t\t\t\tcom.vmware.vip.core.messages.service.multcomponent.TranslationDTO.class);\n+\t\t} catch (VIPCacheException e) {\n+\t\t\tthrow new L3APIException(\"MULTCOMPONENT cache occurs error when update translation.\", e);", "originalCommit": "84f0f520a6fee0e89781b5ae144cdecb2228462d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0OTI3OQ==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r429849279", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tthrow new L3APIException(\"MULTCOMPONENT cache occurs error when update translation.\", e);\n          \n          \n            \n            \t\t\tlogger.Error(\"Error occurs when deleting MULTCOMPONENT cache.\");", "author": "Xiaochao8", "createdAt": "2020-05-25T10:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0Njc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExMTI1Mg==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r430111252", "bodyText": "Here we should throw an exception. Because we have an ExceptionHandle class to Unify handling the level3 error", "author": "tigershi", "createdAt": "2020-05-26T01:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0Njc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDExMTk2Mw==", "url": "https://github.com/vmware/singleton/pull/569#discussion_r430111963", "bodyText": "We should keep this error internally because translation has been updated successfully. If users get this error, they will be confused.", "author": "Xiaochao8", "createdAt": "2020-05-26T01:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg0Njc0MQ=="}], "type": "inlineReview", "revised_code": null}]}