{"pr_number": 753, "pr_title": "Make MIN and MAX return LONG for Counters", "pr_createdAt": "2020-05-05T14:23:35Z", "pr_url": "https://github.com/senx/warp10-platform/pull/753", "timeline": [{"oid": "8d9489727ccce4e8274bb0b6146b3a035d46e805", "url": "https://github.com/senx/warp10-platform/commit/8d9489727ccce4e8274bb0b6146b3a035d46e805", "message": "Make MIN and MAX return LONG for Counters", "committedDate": "2020-05-05T14:10:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzMyNw==", "url": "https://github.com/senx/warp10-platform/pull/753#discussion_r420237327", "bodyText": "How about renaming min in max as part of this PR?", "author": "hbs", "createdAt": "2020-05-05T16:21:06Z", "path": "warp10/src/main/java/io/warp10/script/functions/math/MAX.java", "diffHunk": "@@ -47,16 +48,16 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n         }\n \n         if (null == min) {\n-          if (element instanceof Long || element instanceof Integer) {\n-            min = ((Number) element).longValue();\n-          } else {\n+          if (element instanceof Double || element instanceof BigDecimal) {", "originalCommit": "8d9489727ccce4e8274bb0b6146b3a035d46e805", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1880ec119027ad9c3cf3cb0754978783b1e0c3d5", "chunk": "diff --git a/warp10/src/main/java/io/warp10/script/functions/math/MAX.java b/warp10/src/main/java/io/warp10/script/functions/math/NumericBinaryFunction.java\nsimilarity index 63%\nrename from warp10/src/main/java/io/warp10/script/functions/math/MAX.java\nrename to warp10/src/main/java/io/warp10/script/functions/math/NumericBinaryFunction.java\nindex cafe48ce..ca783b14 100644\n--- a/warp10/src/main/java/io/warp10/script/functions/math/MAX.java\n+++ b/warp10/src/main/java/io/warp10/script/functions/math/NumericBinaryFunction.java\n\n@@ -40,29 +46,29 @@ public class MAX extends NamedWarpScriptFunction implements WarpScriptStackFunct\n     Object op0 = stack.pop();\n \n     if (op0 instanceof List) {\n-      Number min = null;\n+      Number result = null;\n \n       for (Object element: (List) op0) {\n         if (!(element instanceof Number)) {\n           throw new WarpScriptException(getName() + \" can only operate on numerical values.\");\n         }\n \n-        if (null == min) {\n+        if (null == result) {\n           if (element instanceof Double || element instanceof BigDecimal) {\n-            min = ((Number) element).doubleValue();\n+            result = ((Number) element).doubleValue();\n           } else {\n-            min = ((Number) element).longValue();\n+            result = ((Number) element).longValue();\n           }\n         } else {\n-          if (element instanceof Double || element instanceof BigDecimal || min instanceof Double) {\n-            min = Math.max(((Number) element).doubleValue(), min.doubleValue());\n+          if (element instanceof Double || element instanceof BigDecimal || result instanceof Double) {\n+            result = opD.applyAsDouble(((Number) element).doubleValue(), result.doubleValue());\n           } else {\n-            min = Math.max(((Number) element).longValue(), min.longValue());\n+            result = opL.applyAsLong (((Number) element).longValue(), result.longValue());\n           }\n         }\n       }\n \n-      stack.push(min);\n+      stack.push(result);\n     } else {\n \n       if (!(op0 instanceof Number)) {\n"}}, {"oid": "1880ec119027ad9c3cf3cb0754978783b1e0c3d5", "url": "https://github.com/senx/warp10-platform/commit/1880ec119027ad9c3cf3cb0754978783b1e0c3d5", "message": "Merge MIN and MAX", "committedDate": "2020-05-06T19:40:41Z", "type": "commit"}]}