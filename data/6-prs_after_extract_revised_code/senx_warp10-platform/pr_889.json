{"pr_number": 889, "pr_title": "Fix current tick for mappers when GTS has duplicate ticks", "pr_createdAt": "2020-12-09T15:36:00Z", "pr_url": "https://github.com/senx/warp10-platform/pull/889", "timeline": [{"oid": "46003bb3ee8584cff42a0ddcff295e71f8340267", "url": "https://github.com/senx/warp10-platform/commit/46003bb3ee8584cff42a0ddcff295e71f8340267", "message": "Fix current tick for mappers when GTS has duplicate ticks", "committedDate": "2020-12-09T15:35:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY3NjQyNw==", "url": "https://github.com/senx/warp10-platform/pull/889#discussion_r539676427", "bodyText": "Maybe add a comment why reversed is checked here, from the code it is not obvious.", "author": "hbs", "createdAt": "2020-12-09T21:53:44Z", "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -5484,11 +5493,17 @@ public static void reset(GeoTimeSerie gts) {\n \n         for (int j = 0; j < subgts.values; j++) {\n           ((Object[]) parms[6])[j] = valueAtIndex(subgts, j);\n-          if (-1 == tickidx && tick == tickAtIndex(subgts, j)) {\n+          if ((-1 == tickidx || reversed) && tick == tickAtIndex(subgts, j)) {", "originalCommit": "46003bb3ee8584cff42a0ddcff295e71f8340267", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8be7c7a374a8ed4a4d7c0317494c9a6565590994", "chunk": "diff --git a/warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java b/warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java\nindex d10330b2..0dae2d1a 100644\n--- a/warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java\n+++ b/warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java\n\n@@ -5493,6 +5493,8 @@ public class GTSHelper {\n \n         for (int j = 0; j < subgts.values; j++) {\n           ((Object[]) parms[6])[j] = valueAtIndex(subgts, j);\n+          // Find the first index of the current tick or the last one in case we map in reverse.\n+          // This is because subgts is always sorted but never in reverse.\n           if ((-1 == tickidx || reversed) && tick == tickAtIndex(subgts, j)) {\n             tickidx = j;\n           }\n"}}, {"oid": "8be7c7a374a8ed4a4d7c0317494c9a6565590994", "url": "https://github.com/senx/warp10-platform/commit/8be7c7a374a8ed4a4d7c0317494c9a6565590994", "message": "Add comment to explain condition", "committedDate": "2021-01-04T09:53:38Z", "type": "commit"}]}