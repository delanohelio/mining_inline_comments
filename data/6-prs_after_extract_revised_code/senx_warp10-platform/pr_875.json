{"pr_number": 875, "pr_title": "Precise error message when conf files contain invalid lines, fixes #872", "pr_createdAt": "2020-11-19T15:47:37Z", "pr_url": "https://github.com/senx/warp10-platform/pull/875", "timeline": [{"oid": "04f254362cfe4d1a94d4798240bef56ec85bdda2", "url": "https://github.com/senx/warp10-platform/commit/04f254362cfe4d1a94d4798240bef56ec85bdda2", "message": "Add clearer error messages when reading conf files", "committedDate": "2020-11-18T13:58:00Z", "type": "commit"}, {"oid": "3bb6de1dddc0079d2f824cbd9629793e48842f46", "url": "https://github.com/senx/warp10-platform/commit/3bb6de1dddc0079d2f824cbd9629793e48842f46", "message": "Avoid multiple var expansion and fixed WarpURLDecoded exception handling", "committedDate": "2020-11-19T15:43:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTc4OTU4OQ==", "url": "https://github.com/senx/warp10-platform/pull/875#discussion_r531789589", "bodyText": "Rename parameter since it can now contain multiple files.", "author": "hbs", "createdAt": "2020-11-27T21:28:52Z", "path": "warp10/src/main/java/io/warp10/WarpConfig.java", "diffHunk": "@@ -122,62 +126,63 @@ public static void clearThreadProperties() {\n     threadProperties.remove();\n   }\n   \n-  public static void safeSetProperties(String file) throws IOException {\n+  public static void safeSetProperties(String... file) throws IOException {", "originalCommit": "3bb6de1dddc0079d2f824cbd9629793e48842f46", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "61658d70c439cd2a491f468229b2091aa8567f9b", "chunk": "diff --git a/warp10/src/main/java/io/warp10/WarpConfig.java b/warp10/src/main/java/io/warp10/WarpConfig.java\nindex dc10c5dc..e20d2e17 100644\n--- a/warp10/src/main/java/io/warp10/WarpConfig.java\n+++ b/warp10/src/main/java/io/warp10/WarpConfig.java\n\n@@ -125,16 +125,24 @@ public class WarpConfig {\n   public static void clearThreadProperties() {\n     threadProperties.remove();\n   }\n+\n+  public static void safeSetProperties(String... files) throws IOException {\n+    safeSetProperties(true, files);\n+  }\n   \n-  public static void safeSetProperties(String... file) throws IOException {\n+  public static void safeSetProperties(boolean exitOnError, String... files) throws IOException {\n     if (null != properties) {\n       return;\n     }\n \n-    safeSetProperties(file);\n+    setProperties(exitOnError, files);\n   }\n \n   public static void setProperties(String... files) throws IOException {\n+    setProperties(true, files);\n+  }\n+\n+  public static void setProperties(boolean exitOnError, String... files) throws IOException {\n     if (null != properties) {\n       throw new RuntimeException(\"Properties already set.\");\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTc5MTkxOQ==", "url": "https://github.com/senx/warp10-platform/pull/875#discussion_r531791919", "bodyText": "Removing the System.exit call changes the behavior for callers other than the main method of WarpConfig, this will most likely break the behavior of many environment which initialize the Warp 10 config through this method, including the integration in Spark/Flink/Pig/KafkaStreams/NiFi and probably others.", "author": "hbs", "createdAt": "2020-11-27T21:41:55Z", "path": "warp10/src/main/java/io/warp10/WarpConfig.java", "diffHunk": "@@ -316,13 +327,16 @@ public static Properties readConfig(Reader reader, Properties properties, boolea\n \n     br.close();\n \n-    if (errorcount > 0) {\n-      System.err.println(\"Aborting due to \" + errorcount + \" error\" + (errorcount > 1 ? \"s\" : \"\") + \".\");\n-      System.exit(-1);\n+    if (!linesInError.isEmpty()) {\n+      throw new IOException(\"Malformed lines \" + linesInError.toString() + \".\");", "originalCommit": "3bb6de1dddc0079d2f824cbd9629793e48842f46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIxMDkyOQ==", "url": "https://github.com/senx/warp10-platform/pull/875#discussion_r534210929", "bodyText": "Changed the methods to take an extra parameter to do a System.exit or throw. If not specified, defaults to System.exit for backward-compatibility.\nThis parameter is the first in the methods because of the varargs and consistency between methods.", "author": "ftence", "createdAt": "2020-12-02T14:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTc5MTkxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "61658d70c439cd2a491f468229b2091aa8567f9b", "chunk": "diff --git a/warp10/src/main/java/io/warp10/WarpConfig.java b/warp10/src/main/java/io/warp10/WarpConfig.java\nindex dc10c5dc..e20d2e17 100644\n--- a/warp10/src/main/java/io/warp10/WarpConfig.java\n+++ b/warp10/src/main/java/io/warp10/WarpConfig.java\n\n@@ -328,7 +348,12 @@ public class WarpConfig {\n     br.close();\n \n     if (!linesInError.isEmpty()) {\n-      throw new IOException(\"Malformed lines \" + linesInError.toString() + \".\");\n+      if (exitOnError) {\n+        LOG.error(\"Malformed lines \" + linesInError.toString() + \" in configuration.\");\n+        System.exit(-1);\n+      } else {\n+        throw new IOException(\"Malformed lines \" + linesInError.toString() + \".\");\n+      }\n     }\n \n     return properties;\n"}}, {"oid": "61658d70c439cd2a491f468229b2091aa8567f9b", "url": "https://github.com/senx/warp10-platform/commit/61658d70c439cd2a491f468229b2091aa8567f9b", "message": "Make WarpConfig exit on error by default, fix recursive safeSetProperties", "committedDate": "2020-12-02T14:28:31Z", "type": "commit"}]}