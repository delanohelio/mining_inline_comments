{"pr_number": 871, "pr_title": "More detailed error messages for /update", "pr_createdAt": "2020-11-10T16:21:48Z", "pr_url": "https://github.com/senx/warp10-platform/pull/871", "timeline": [{"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "url": "https://github.com/senx/warp10-platform/commit/7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "message": "More detailled error messages for /update", "committedDate": "2020-11-10T16:18:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523942287", "bodyText": "The actual incorrect line is no longer shown.", "author": "hbs", "createdAt": "2020-11-16T07:35:29Z", "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2535,14 +2543,22 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n     idx2 = UnsafeString.indexOf(str, ' ', idx);\n     \n     if (-1 == idx2){\n-      throw new ParseException(str, idx);\n+      if(0 == tsoffset) {\n+        throw new ParseException(\"Missing GTS name, labels and value.\", idx);", "originalCommit": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA1MzI3NA==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r525053274", "bodyText": "Ingress and its declination already include the offending line when catching the ParseException.\nI think it's a good way of doing things: the ParseException only tells where on the line there is a problem and what is the problem and the caller knows which lines caused the problem, so it's up to the caller to include the line in the Exception or error message.\nI updated the error messages to include the offset where is was not and better handled the errors in PARSE.", "author": "ftence", "createdAt": "2020-11-17T10:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTExNjg5Mg==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r525116892", "bodyText": "GTSHelper#parse is used in PARSE also where the offending line is not reported in case of error, this could be a nice addition to this PR. Same with StreamingUpdate endpoints if that is not already the case.", "author": "hbs", "createdAt": "2020-11-17T12:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE0NTc3NA==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r525145774", "bodyText": "Those are exactly the changes in a433a5d.", "author": "ftence", "createdAt": "2020-11-17T13:18:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE1NTg0OQ==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r525155849", "bodyText": "My bad, sorry.", "author": "hbs", "createdAt": "2020-11-17T13:34:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjkxMg==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523942912", "bodyText": "Ditto, dropping the invalid line.", "author": "hbs", "createdAt": "2020-11-16T07:37:03Z", "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2574,7 +2590,7 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n       // No class+labels, assume same class+labels as those in encoder, except\n       // if encoder is null in which case we throw a parse exception\n       if (null == encoder) {\n-        throw new ParseException(str, idx);\n+        throw new ParseException(\"Missing or invalid GTS name and labels.\", idx);", "originalCommit": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MzAxOA==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523943018", "bodyText": "Invalid line no longer shown.", "author": "hbs", "createdAt": "2020-11-16T07:37:19Z", "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2591,14 +2607,20 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n       idx2 = UnsafeString.indexOf(str, '}', idx);\n       \n       if (-1 == idx2){\n-        throw new ParseException(str, idx);\n+        throw new ParseException(\"Missing end of labels '}'.\", str.length() - 1);", "originalCommit": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0NTcyMQ==", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523945721", "bodyText": "Now that we have a mechanism to control the error message size I think it would be a good idea to include the invalid line whenever possible, it makes the diagnosis of the issue way easier.", "author": "hbs", "createdAt": "2020-11-16T07:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MzAxOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a433a5d15474ee1d13f529d460969ac7775ac917", "url": "https://github.com/senx/warp10-platform/commit/a433a5d15474ee1d13f529d460969ac7775ac917", "message": "Catch and nicely format ParseExceptions thrown by GTSHelper.parse", "committedDate": "2020-11-17T10:33:09Z", "type": "commit"}]}