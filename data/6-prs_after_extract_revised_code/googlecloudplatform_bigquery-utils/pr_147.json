{"pr_number": 147, "pr_title": "Query_Breakdown/VSCode_Query_Breakdown: Integration Complete", "pr_createdAt": "2020-08-12T21:00:42Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147", "timeline": [{"oid": "47fb2dd731d8c71e8c4b13f68013144a7649ccae", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/47fb2dd731d8c71e8c4b13f68013144a7649ccae", "message": "query_breakdown locationtracker now works with replacement", "committedDate": "2020-08-06T18:13:55Z", "type": "commit"}, {"oid": "2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/2a6891f58d9a0a03b8b9eaecaa5327f9c7d4eec3", "message": "stack now works to rearrange output order", "committedDate": "2020-08-06T18:38:48Z", "type": "commit"}, {"oid": "c0d19792754f5177368bacf2c55a75a5d4596678", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c0d19792754f5177368bacf2c55a75a5d4596678", "message": "test case for deletion and replacement at the same time added", "committedDate": "2020-08-06T18:57:59Z", "type": "commit"}, {"oid": "9b61ddfd58872dfa15216cc9081d4b13625b407f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/9b61ddfd58872dfa15216cc9081d4b13625b407f", "message": "json flag added as well as variable programmed", "committedDate": "2020-08-07T19:57:40Z", "type": "commit"}, {"oid": "23d74ba6069588f7872edf9aaccf5554752120c6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/23d74ba6069588f7872edf9aaccf5554752120c6", "message": "added json support", "committedDate": "2020-08-08T00:02:06Z", "type": "commit"}, {"oid": "e2b01b2974c41063a72be65ce740109e8e9081a6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e2b01b2974c41063a72be65ce740109e8e9081a6", "message": "works as a stand-alone jar file now", "committedDate": "2020-08-08T00:21:26Z", "type": "commit"}, {"oid": "01553a8c80f0d1534bf127d41acda6be31637325", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/01553a8c80f0d1534bf127d41acda6be31637325", "message": "Merge branch 'master' into milestone3_1", "committedDate": "2020-08-08T01:40:59Z", "type": "commit"}, {"oid": "feb8a2f20f36a6807706d4e5c4e6614547439ded", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/feb8a2f20f36a6807706d4e5c4e6614547439ded", "message": "created query_breakdown_runner.ts", "committedDate": "2020-08-10T20:43:20Z", "type": "commit"}, {"oid": "1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1b2f48263a2a9a2e4e19cc73847b4395f2c3ad2a", "message": "query breakdown runner sketched", "committedDate": "2020-08-10T22:35:27Z", "type": "commit"}, {"oid": "acb043fc61f541bd846e645df84c4219a4f0c215", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/acb043fc61f541bd846e645df84c4219a4f0c215", "message": "methods sketched", "committedDate": "2020-08-11T19:18:38Z", "type": "commit"}, {"oid": "b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b1cde39f3c6d666cf44dc64f6a2f5187ed423db5", "message": "result json file sketched", "committedDate": "2020-08-11T19:19:07Z", "type": "commit"}, {"oid": "a6dbb8ea4a81643af8785045b849a843a226d61e", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a6dbb8ea4a81643af8785045b849a843a226d61e", "message": "resultJson integrated", "committedDate": "2020-08-11T19:51:35Z", "type": "commit"}, {"oid": "88a811d7eae4a15eea543fb24ddfadbc7b242d81", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/88a811d7eae4a15eea543fb24ddfadbc7b242d81", "message": "debugging-1", "committedDate": "2020-08-11T21:55:44Z", "type": "commit"}, {"oid": "306b21633cbc6fac9e794ab763a66b63c3628114", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/306b21633cbc6fac9e794ab763a66b63c3628114", "message": "integration is now finished and working!", "committedDate": "2020-08-12T00:17:53Z", "type": "commit"}, {"oid": "25c92eae4bed225450b0878bcb243d1a512a5bf2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/25c92eae4bed225450b0878bcb243d1a512a5bf2", "message": "merge conflicts resolved", "committedDate": "2020-08-12T18:51:15Z", "type": "commit"}, {"oid": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/751716ca54416ef54ba970e83eb373ecb62b7dd0", "message": "code cleaned up for pull request", "committedDate": "2020-08-12T20:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzMTE2NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473231164", "bodyText": "Seems , PATH should not be here?", "author": "feiling", "createdAt": "2020-08-19T18:16:56Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -2,34 +2,31 @@\n \n import static java.lang.System.exit;\n \n-import java.io.File;\n import org.apache.commons.cli.*;\n \n import java.io.IOException;\n-import java.util.Comparator;\n \n /**\n  * This file is the main file for the command line tool.\n- * Usage: query_breakdown -i <PATH> [-o <PATH>] [-l <INTEGER>]\n+ * Usage: query_breakdown -i <PATH> [-j] [-l <INTEGER>]\n  * -i, --inputFile, PATH: this command specifies the path to the file containing queries to be\n  *                    inputted into the tool. It is therefore mandatory\n- * -o, --outputFile, PATH: this command specifies the path to the file that the tool can write\n- *                    its results to. If not specified, the tool will simply print results on the\n- *                    console. It is therefore optional\n+ * -j, --json, PATH: this command specifies whether the program should output the results in a", "originalCommit": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM2NTE5Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473365192", "bodyText": "yup, changed", "author": "subinbean", "createdAt": "2020-08-19T21:59:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzMTE2NA=="}], "type": "inlineReview", "revised_code": {"commit": "717a8085c271daf6a9be0975bd30b9fd6f7a2c8d", "chunk": "diff --git a/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java b/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\nindex 0938c35..352d4e9 100644\n--- a/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\n+++ b/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\n\n@@ -11,9 +11,9 @@ import java.io.IOException;\n  * Usage: query_breakdown -i <PATH> [-j] [-l <INTEGER>]\n  * -i, --inputFile, PATH: this command specifies the path to the file containing queries to be\n  *                    inputted into the tool. It is therefore mandatory\n- * -j, --json, PATH: this command specifies whether the program should output the results in a\n+ * -j, --json: this command specifies whether the program should output the results in a\n  *                   json format. It is therefore optional\n- * -l, --limit, PATH: this command specifies the path to an integer that the tool takes as a\n+ * -l, --limit, INTEGER: this command specifies the path to an integer that the tool takes as a\n  *                    limit for the number of errors to be explored, thereby controlling the\n  *                    runtime. It is therefore optional\n  *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzMTk5OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473231998", "bodyText": "Seems PATH should be INTEGER", "author": "feiling", "createdAt": "2020-08-19T18:18:35Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -2,34 +2,31 @@\n \n import static java.lang.System.exit;\n \n-import java.io.File;\n import org.apache.commons.cli.*;\n \n import java.io.IOException;\n-import java.util.Comparator;\n \n /**\n  * This file is the main file for the command line tool.\n- * Usage: query_breakdown -i <PATH> [-o <PATH>] [-l <INTEGER>]\n+ * Usage: query_breakdown -i <PATH> [-j] [-l <INTEGER>]\n  * -i, --inputFile, PATH: this command specifies the path to the file containing queries to be\n  *                    inputted into the tool. It is therefore mandatory\n- * -o, --outputFile, PATH: this command specifies the path to the file that the tool can write\n- *                    its results to. If not specified, the tool will simply print results on the\n- *                    console. It is therefore optional\n+ * -j, --json, PATH: this command specifies whether the program should output the results in a\n+ *                   json format. It is therefore optional\n  * -l, --limit, PATH: this command specifies the path to an integer that the tool takes as a", "originalCommit": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM2NTMxNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473365317", "bodyText": "yup, changed!", "author": "subinbean", "createdAt": "2020-08-19T21:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzMTk5OA=="}], "type": "inlineReview", "revised_code": {"commit": "717a8085c271daf6a9be0975bd30b9fd6f7a2c8d", "chunk": "diff --git a/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java b/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\nindex 0938c35..352d4e9 100644\n--- a/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\n+++ b/tools/query_breakdown/src/main/java/com/google/bigquery/Main.java\n\n@@ -11,9 +11,9 @@ import java.io.IOException;\n  * Usage: query_breakdown -i <PATH> [-j] [-l <INTEGER>]\n  * -i, --inputFile, PATH: this command specifies the path to the file containing queries to be\n  *                    inputted into the tool. It is therefore mandatory\n- * -j, --json, PATH: this command specifies whether the program should output the results in a\n+ * -j, --json: this command specifies whether the program should output the results in a\n  *                   json format. It is therefore optional\n- * -l, --limit, PATH: this command specifies the path to an integer that the tool takes as a\n+ * -l, --limit, INTEGER: this command specifies the path to an integer that the tool takes as a\n  *                    limit for the number of errors to be explored, thereby controlling the\n  *                    runtime. It is therefore optional\n  *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNTI1Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473235257", "bodyText": "You should be able to simplify this by using a library like Jackson (https://en.wikipedia.org/wiki/Jackson_(API)). You can choose to do that in a future PR.", "author": "feiling", "createdAt": "2020-08-19T18:24:45Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -62,23 +64,51 @@ public void run(String originalQuery, String outputFile, int errorLimit,\n       stack.push(current);\n       current = current.getParent();\n     }\n-\n-    // we then pop the stack and output results one by one\n-    while (!stack.empty()) {\n-      current = stack.pop();\n-      if (current.getErrorHandlingType().equals(\"DELETION\")) {\n-        // print out the result\n-        System.out.println(String.format(\"Unparseable portion: Start Line %1$s, End Line %2$s, \"\n-                + \"Start Column %3$s, End Column %4$s, %5$s\", current.getStartLine(),\n-            current.getEndLine(), current.getStartColumn(), current.getEndColumn(),\n-            current.getErrorHandlingType()));\n+    \n+    if (jsonOutput) {\n+      JSONArray jsonArray = new JSONArray();\n+      while(!stack.empty()) {\n+        current = stack.pop();\n+        JSONObject errorPosition = new JSONObject();\n+        errorPosition.put(\"startLine\", current.getStartLine());", "originalCommit": "751716ca54416ef54ba970e83eb373ecb62b7dd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM2ODE3NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r473368174", "bodyText": "Got it, yup. Right now I might still add more to the JSON schema so I will address this in a future PR!", "author": "subinbean", "createdAt": "2020-08-19T22:03:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNTI1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkzMTY4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/147#discussion_r474931680", "bodyText": "Upon looking into it, the Jackson API is not too good for the current use case since we are only selecting a subset of fields from the node object instead of turning the entire object into a JSON. The org.json.simple library seems to be better I think--will use that one instead", "author": "subinbean", "createdAt": "2020-08-21T20:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzNTI1Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "717a8085c271daf6a9be0975bd30b9fd6f7a2c8d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/717a8085c271daf6a9be0975bd30b9fd6f7a2c8d", "message": "PR comments addressed", "committedDate": "2020-08-19T21:58:42Z", "type": "commit"}, {"oid": "5c87053ff3ea41a1b89fc863e50db4038db3b743", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/5c87053ff3ea41a1b89fc863e50db4038db3b743", "message": "Merge branch 'master' into milestone3_1", "committedDate": "2020-08-20T16:22:55Z", "type": "commit"}, {"oid": "d9dfd423c84a29272b0be710a64003646fa11ad8", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d9dfd423c84a29272b0be710a64003646fa11ad8", "message": "Merge branch 'master' into milestone3_1", "committedDate": "2020-08-21T20:33:46Z", "type": "commit"}]}