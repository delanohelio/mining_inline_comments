{"pr_number": 532, "pr_title": "CLDR-13918 Moving old (used once) PathUtilities file to make way for new version.", "pr_createdAt": "2020-06-29T21:09:30Z", "pr_url": "https://github.com/unicode-org/cldr/pull/532", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2MTI1Mg==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r447261252", "bodyText": "Ordering is very very odd here. The array is being defined before the constants in it are defined.\nNormally IntelliJ would warn about this, but it wasn't. Maybe array initialization is different.\nI reordered the constants to ensure everything is defined top-to-bottom.", "author": "hagbard", "createdAt": "2020-06-29T21:21:24Z", "path": "tools/java/org/unicode/cldr/test/XPathToMenu.java", "diffHunk": "@@ -1,37 +1,40 @@\n-package org.unicode.cldr.util;\n+package org.unicode.cldr.test;\n \n import java.util.HashMap;\n import java.util.Map;\n \n import org.unicode.cldr.icu.LDMLConstants;\n+import org.unicode.cldr.util.XPathParts;\n \n /**\n- * @deprecated\n+ * Deprecated utility class only used by ConsoleCheckCLDR.\n+ *\n+ * @deprecated Do not use.\n  */\n @Deprecated\n-public class PathUtilities {\n-\n+final class XPathToMenu {\n     // ===== types of data and menu names\n-    public static final String LOCALEDISPLAYNAMES = \"//ldml/localeDisplayNames/\";\n+    private static final String LOCALEDISPLAYNAMES = \"//ldml/localeDisplayNames/\";\n+    private static final String OTHER_CALENDARS_XPATH = \"//ldml/dates/calendars/calendar\";\n+\n+    private static final String CURRENCIES = \"currencies\";\n+    private static final String TIMEZONES = \"timezones\";\n+    private static final String METAZONES = \"metazones\";\n+    private static final String MISC = \"misc\";\n+    private static final String CODEPATTERNS = \"codePatterns\";\n+    private static final String MEASNAMES = \"measurementSystemNames\";\n+\n+    private static final String LOCALEDISPLAYPATTERN_XPATH =\n+            LOCALEDISPLAYNAMES + LDMLConstants.LOCALEDISPLAYPATTERN;\n+    private static final String NUMBERSCURRENCIES =\n+            LDMLConstants.NUMBERS + \"/\" + CURRENCIES;\n+\n     /**\n      * All of the data items under LOCALEDISPLAYNAMES (menu items)\n      */\n-    public static final String LOCALEDISPLAYNAMES_ITEMS[] = { LDMLConstants.LANGUAGES,\n+    private static final String[] LOCALEDISPLAYNAMES_ITEMS = { LDMLConstants.LANGUAGES,\n         LDMLConstants.SCRIPTS, LDMLConstants.TERRITORIES, LDMLConstants.VARIANTS, LDMLConstants.KEYS,\n-        LDMLConstants.TYPES, PathUtilities.CURRENCIES, PathUtilities.TIMEZONES,", "originalCommit": "e0d57023a2edf54fef3cb279a77d0eab9bf72ca8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2MTQ5OQ==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r447261499", "bodyText": "This is the only method called from outside this class. Everything else can be made private (or deleted because it's unused).", "author": "hagbard", "createdAt": "2020-06-29T21:21:53Z", "path": "tools/java/org/unicode/cldr/test/XPathToMenu.java", "diffHunk": "@@ -1,37 +1,40 @@\n-package org.unicode.cldr.util;\n+package org.unicode.cldr.test;\n \n import java.util.HashMap;\n import java.util.Map;\n \n import org.unicode.cldr.icu.LDMLConstants;\n+import org.unicode.cldr.util.XPathParts;\n \n /**\n- * @deprecated\n+ * Deprecated utility class only used by ConsoleCheckCLDR.\n+ *\n+ * @deprecated Do not use.\n  */\n @Deprecated\n-public class PathUtilities {\n-\n+final class XPathToMenu {\n     // ===== types of data and menu names\n-    public static final String LOCALEDISPLAYNAMES = \"//ldml/localeDisplayNames/\";\n+    private static final String LOCALEDISPLAYNAMES = \"//ldml/localeDisplayNames/\";\n+    private static final String OTHER_CALENDARS_XPATH = \"//ldml/dates/calendars/calendar\";\n+\n+    private static final String CURRENCIES = \"currencies\";\n+    private static final String TIMEZONES = \"timezones\";\n+    private static final String METAZONES = \"metazones\";\n+    private static final String MISC = \"misc\";\n+    private static final String CODEPATTERNS = \"codePatterns\";\n+    private static final String MEASNAMES = \"measurementSystemNames\";\n+\n+    private static final String LOCALEDISPLAYPATTERN_XPATH =\n+            LOCALEDISPLAYNAMES + LDMLConstants.LOCALEDISPLAYPATTERN;\n+    private static final String NUMBERSCURRENCIES =\n+            LDMLConstants.NUMBERS + \"/\" + CURRENCIES;\n+\n     /**\n      * All of the data items under LOCALEDISPLAYNAMES (menu items)\n      */\n-    public static final String LOCALEDISPLAYNAMES_ITEMS[] = { LDMLConstants.LANGUAGES,\n+    private static final String[] LOCALEDISPLAYNAMES_ITEMS = { LDMLConstants.LANGUAGES,\n         LDMLConstants.SCRIPTS, LDMLConstants.TERRITORIES, LDMLConstants.VARIANTS, LDMLConstants.KEYS,\n-        LDMLConstants.TYPES, PathUtilities.CURRENCIES, PathUtilities.TIMEZONES,\n-        PathUtilities.CODEPATTERNS, PathUtilities.MEASNAMES };\n-    public static final String OTHER_CALENDARS_XPATH = \"//ldml/dates/calendars/calendar\";\n-\n-    public static final String LOCALEDISPLAYPATTERN_XPATH = LOCALEDISPLAYNAMES\n-        + LDMLConstants.LOCALEDISPLAYPATTERN;\n-    public static final String NUMBERSCURRENCIES = LDMLConstants.NUMBERS + \"/\"\n-        + PathUtilities.CURRENCIES;\n-    public static final String CURRENCIES = \"currencies\";\n-    public static final String TIMEZONES = \"timezones\";\n-    public static final String METAZONES = \"metazones\";\n-    public static String xOTHER = \"misc\";\n-    public static final String CODEPATTERNS = \"codePatterns\";\n-    public static final String MEASNAMES = \"measurementSystemNames\";\n+        LDMLConstants.TYPES, CURRENCIES, TIMEZONES, CODEPATTERNS, MEASNAMES };\n \n     public static String xpathToMenu(String path) {", "originalCommit": "e0d57023a2edf54fef3cb279a77d0eab9bf72ca8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2MjQ3Mg==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r447262472", "bodyText": "This was all kinds of weird since the map is never written to so was always empty.\nIt'd have more thoughts on this if I wasn't able to just delete the whole method.", "author": "hagbard", "createdAt": "2020-06-29T21:23:56Z", "path": "tools/java/org/unicode/cldr/test/XPathToMenu.java", "diffHunk": "@@ -98,24 +101,13 @@ public static String xpathToMenu(String path) {\n         // }\n     }\n \n-    public static String[] getMetazonesItems() {\n-        String defaultMetazonesItems = \"Africa America Antarctica Asia Australia Europe Atlantic Indian Pacific\";\n-        return (defaultMetazonesItems.split(\" \"));\n+    private static String getMetazoneContinent(String xpath) {\n+        XPathParts parts = XPathParts.getFrozenInstance(xpath);\n+        String thisMetazone = parts.getAttributeValue(3, \"type\");\n+        return getMetazoneToContinentMap().get(thisMetazone);\n     }\n \n-    private static Map<String, String> mzXpathToContinent = new HashMap<>();", "originalCommit": "e0d57023a2edf54fef3cb279a77d0eab9bf72ca8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI2MzA4MA==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r447263080", "bodyText": "We could adapt the API so it handled \"null\" and returned \"general\" as a default, but I'm not even sure if this code is being used.", "author": "hagbard", "createdAt": "2020-06-29T21:25:04Z", "path": "tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java", "diffHunk": "@@ -1068,7 +1068,7 @@ private static void addDataToErrorFile(String localeID, String path, ErrorType s\n             Subtype subType) {\n             String section = path == null", "originalCommit": "e0d57023a2edf54fef3cb279a77d0eab9bf72ca8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "67cf19cc7ec7b871fab1a5e625bed6a4cae741d9", "chunk": "diff --git a/tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java b/tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java\nindex d286222500..6cc06232a5 100644\n--- a/tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java\n+++ b/tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java\n\n@@ -1066,9 +1078,7 @@ public class ConsoleCheckCLDR {\n \n         private static void addDataToErrorFile(String localeID, String path, ErrorType shortStatus,\n             Subtype subType) {\n-            String section = path == null\n-                ? null\n-                : XPathToMenu.xpathToMenu(path);\n+            String section = path == null ? null : XPathToMenu.xpathToMenu(path);\n             if (section == null) {\n                 section = \"general\";\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3OTM4MA==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r447279380", "bodyText": "I search all Java files in the CLDR project and these strings aren't referenced anywhere.", "author": "hagbard", "createdAt": "2020-06-29T22:02:04Z", "path": "tools/cldr-apps/src/org/unicode/cldr/web/SurveyMain.java", "diffHunk": "@@ -370,9 +369,6 @@ public static String modifyThing(WebContext ctx) {\n \n     public static String xMAIN = \"general\";\n \n-    public static String CALENDARS_ITEMS[] = PathUtilities.getCalendarsItems();", "originalCommit": "61e64e810c0b10dfe05d5ec23c71be81e88cf886", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA5MDk5Nw==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r473090997", "bodyText": "Actually they are referenced in menu_top.jsp. I'm not sure whether there is any ill-effect other than these \"problems\" reported by Eclipse:\nCALENDARS_ITEMS cannot be resolved or is not a field\tmenu_top.jsp\t/cldr-apps/WebContent/WEB-INF/tmpl\tline 5\tJSP Problem\nMETAZONES_ITEMS cannot be resolved or is not a field\tmenu_top.jsp\t/cldr-apps/WebContent/WEB-INF/tmpl\tline 6\tJSP Problem\n\nIdeally we should stop using jsp files entirely. In the meantime we should clean up menu_top.jsp by removing the useless references to CALENDARS_ITEMS and METAZONES_ITEMS.", "author": "btangmu", "createdAt": "2020-08-19T14:52:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3OTM4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzEwNTQxMA==", "url": "https://github.com/unicode-org/cldr/pull/532#discussion_r473105410", "bodyText": "Ahh good spot, thanks. JSP strikes again.\nI'll have a look and see about putting another PR together.", "author": "hagbard", "createdAt": "2020-08-19T15:12:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3OTM4MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ee448705fcbc12ebaad2eedacefbdb477c6e1f97", "url": "https://github.com/unicode-org/cldr/commit/ee448705fcbc12ebaad2eedacefbdb477c6e1f97", "message": "CLDR-13918 Moving old (used once) PathUtilities file to make way for new version.", "committedDate": "2020-06-30T10:28:03Z", "type": "forcePushed"}, {"oid": "67cf19cc7ec7b871fab1a5e625bed6a4cae741d9", "url": "https://github.com/unicode-org/cldr/commit/67cf19cc7ec7b871fab1a5e625bed6a4cae741d9", "message": "CLDR-13918 Moving old (used once) PathUtilities file to make way for new version.", "committedDate": "2020-08-17T16:07:19Z", "type": "forcePushed"}, {"oid": "8316da01fe9cc6adf045897f12f2f86986d4a9bb", "url": "https://github.com/unicode-org/cldr/commit/8316da01fe9cc6adf045897f12f2f86986d4a9bb", "message": "CLDR-13918 Moving old (used once) PathUtilities file to make way for new version.\n\nSee #532", "committedDate": "2020-08-17T16:26:48Z", "type": "commit"}, {"oid": "8316da01fe9cc6adf045897f12f2f86986d4a9bb", "url": "https://github.com/unicode-org/cldr/commit/8316da01fe9cc6adf045897f12f2f86986d4a9bb", "message": "CLDR-13918 Moving old (used once) PathUtilities file to make way for new version.\n\nSee #532", "committedDate": "2020-08-17T16:26:48Z", "type": "forcePushed"}]}