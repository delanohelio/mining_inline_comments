{"pr_number": 2499, "pr_title": "Support cl.exe detection for Simplified-Chinese and other languages", "pr_createdAt": "2020-05-25T09:32:14Z", "pr_url": "https://github.com/oracle/graal/pull/2499", "timeline": [{"oid": "aa7ee788d7861b59095ae0f1d26b1f037ddfc769", "url": "https://github.com/oracle/graal/commit/aa7ee788d7861b59095ae0f1d26b1f037ddfc769", "message": "Support cl.exe detection for Simplified-Chinese and other languages", "committedDate": "2020-05-25T09:23:29Z", "type": "commit"}, {"oid": "a52d69d62812cc3a3e5cb596ac6d82a15af952cb", "url": "https://github.com/oracle/graal/commit/a52d69d62812cc3a3e5cb596ac6d82a15af952cb", "message": "Checkstyle fix", "committedDate": "2020-05-25T09:59:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg5NTMxMA==", "url": "https://github.com/oracle/graal/pull/2499#discussion_r429895310", "bodyText": "Should we encode these with \\u to avoid encoding issues somewhere down the line?", "author": "peter-hofer", "createdAt": "2020-05-25T11:55:29Z", "path": "substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/c/codegen/CCompilerInvoker.java", "diffHunk": "@@ -124,15 +124,33 @@ protected InputStream getCompilerErrorStream(Process compilingProcess) {\n         @Override\n         protected CompilerInfo createCompilerInfo(Path compilerPath, Scanner scanner) {\n             try {\n+                String targetArch = null;\n                 /* For cl.exe the first line holds all necessary information */\n-                scanner.findInLine(\"Microsoft.?\\\\(R\\\\) C/C\\\\+\\\\+ Optimizing Compiler Version \");\n+                // Checkstyle: stop\n+                String forToken = \"\u7528\u4e8e\";", "originalCommit": "30fdf5c7f601ce07ff31fb7418ae42c1f3a4309f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f5992cc615f943d4a7f5f62263efbcf7db26fa96", "chunk": "diff --git a/substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/c/codegen/CCompilerInvoker.java b/substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/c/codegen/CCompilerInvoker.java\nindex f0ebcaa1bcf..9ab5e8c0b9d 100644\n--- a/substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/c/codegen/CCompilerInvoker.java\n+++ b/substratevm/src/com.oracle.svm.hosted/src/com/oracle/svm/hosted/c/codegen/CCompilerInvoker.java\n\n@@ -122,14 +122,11 @@ public abstract class CCompilerInvoker {\n         }\n \n         @Override\n-        protected CompilerInfo createCompilerInfo(Path compilerPath, Scanner scanner) {\n-            try {\n+        protected CompilerInfo createCompilerInfo(Path compilerPath, Scanner outerScanner) {\n+            try (Scanner scanner = new Scanner(outerScanner.nextLine())) {\n                 String targetArch = null;\n                 /* For cl.exe the first line holds all necessary information */\n-                // Checkstyle: stop\n-                String forToken = \"\u7528\u4e8e\";\n-                // Checkstyle: resume\n-                if (scanner.hasNext(forToken)) {\n+                if (scanner.hasNext(\"\\u7528\\u4E8E\")) {\n                     /* Simplified-Chinese has targetArch first */\n                     scanner.next();\n                     targetArch = scanner.next();\n"}}, {"oid": "f5992cc615f943d4a7f5f62263efbcf7db26fa96", "url": "https://github.com/oracle/graal/commit/f5992cc615f943d4a7f5f62263efbcf7db26fa96", "message": "cl.exe detection: targetArch is last token in line", "committedDate": "2020-05-25T13:45:36Z", "type": "commit"}]}