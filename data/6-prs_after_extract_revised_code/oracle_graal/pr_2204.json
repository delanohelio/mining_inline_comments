{"pr_number": 2204, "pr_title": "Replace java.lang.Compiler.command usage with proper native-image API methods", "pr_createdAt": "2020-03-02T11:50:55Z", "pr_url": "https://github.com/oracle/graal/pull/2204", "timeline": [{"oid": "3bac0ff3186d95573d3f1617dc9f99674a91fdc7", "url": "https://github.com/oracle/graal/commit/3bac0ff3186d95573d3f1617dc9f99674a91fdc7", "message": "Remove obsolete CompilerCommandPlugin infrastructure", "committedDate": "2020-02-25T17:52:21Z", "type": "commit"}, {"oid": "67817e29da48197f6233954acd0976d6541b58b0", "url": "https://github.com/oracle/graal/commit/67817e29da48197f6233954acd0976d6541b58b0", "message": "Support @AutomaticFeature subclassing", "committedDate": "2020-02-25T17:52:21Z", "type": "commit"}, {"oid": "d76d17d7ce1eaf378bb0cc010f6799842536f1a7", "url": "https://github.com/oracle/graal/commit/d76d17d7ce1eaf378bb0cc010f6799842536f1a7", "message": "Provide replacement for HeapDump CompilerCommandPlugin", "committedDate": "2020-02-26T12:02:12Z", "type": "commit"}, {"oid": "6830a306e474be74d531475f2ef35018107d5d80", "url": "https://github.com/oracle/graal/commit/6830a306e474be74d531475f2ef35018107d5d80", "message": "Provide replacement for CompilerCommandPlugin based ArgumentVector functions", "committedDate": "2020-02-26T12:02:12Z", "type": "commit"}, {"oid": "c322499fb4a985085a59948016810b79bb89f326", "url": "https://github.com/oracle/graal/commit/c322499fb4a985085a59948016810b79bb89f326", "message": "Revert \"Remove obsolete CompilerCommandPlugin infrastructure\"\n\nThis reverts commit 740a43e8a1893c1064f67391b3584699390daa27.\n\nOnce all use of this undocumented interface is removed everywhere this\ncommit can be reverted thus finally the obsolete CompilerCommandPlugin\ninfrastructure will be gone.", "committedDate": "2020-02-26T12:02:12Z", "type": "commit"}, {"oid": "a8537f97afdcc0f7ead58ca2a5049b5e0df204ff", "url": "https://github.com/oracle/graal/commit/a8537f97afdcc0f7ead58ca2a5049b5e0df204ff", "message": "Add new native-image API methods", "committedDate": "2020-02-26T12:02:12Z", "type": "commit"}, {"oid": "b374b1feeaa0197c6b64881834ea264e0c2b8e11", "url": "https://github.com/oracle/graal/commit/b374b1feeaa0197c6b64881834ea264e0c2b8e11", "message": "Throw UnsupportedOperationException if argument-vector methods are called from shared library image", "committedDate": "2020-02-28T17:25:54Z", "type": "commit"}, {"oid": "7244a95140c418676893a711b7e269cb21d1416a", "url": "https://github.com/oracle/graal/commit/7244a95140c418676893a711b7e269cb21d1416a", "message": "Provide HeapDumpSupport and use same signature as in HotSpotDiagnosticMXBean", "committedDate": "2020-02-28T17:25:54Z", "type": "commit"}, {"oid": "10bfae725ae580afe112faa73d3efcff4ca5e38f", "url": "https://github.com/oracle/graal/commit/10bfae725ae580afe112faa73d3efcff4ca5e38f", "message": "Revert \"Support @AutomaticFeature subclassing\"\n\nThis reverts commit 67817e29", "committedDate": "2020-02-28T17:25:54Z", "type": "commit"}, {"oid": "63ebe5a7ecae1b3c778456c978346520be1eff7b", "url": "https://github.com/oracle/graal/commit/63ebe5a7ecae1b3c778456c978346520be1eff7b", "message": "Explicitly exclude non-posix platforms from argument vector support", "committedDate": "2020-03-02T16:06:40Z", "type": "commit"}, {"oid": "6d3d30972b31d42b50cf9e9514523e56946beb54", "url": "https://github.com/oracle/graal/commit/6d3d30972b31d42b50cf9e9514523e56946beb54", "message": "Import IOException instead of using java.io.IOException", "committedDate": "2020-03-03T11:22:51Z", "type": "commit"}, {"oid": "58abafca2f6f9433bd8b8c77d1536449eb0c6f48", "url": "https://github.com/oracle/graal/commit/58abafca2f6f9433bd8b8c77d1536449eb0c6f48", "message": "Make getArgumentVectorBlockSize() usable for argument vector support checking", "committedDate": "2020-03-03T11:40:41Z", "type": "commit"}, {"oid": "8564e018069a6034c2d758f06efbe77e095bf5cb", "url": "https://github.com/oracle/graal/commit/8564e018069a6034c2d758f06efbe77e095bf5cb", "message": "Fix typo", "committedDate": "2020-03-03T12:28:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM0ODYxOA==", "url": "https://github.com/oracle/graal/pull/2204#discussion_r387348618", "bodyText": "I don't like catching exceptions as normal control flow (and on Windows this is normal control flow). Better would be to make the check method return a boolean and in the callers either return -1 or throw an exception.", "author": "christianwimmer", "createdAt": "2020-03-03T23:05:22Z", "path": "substratevm/src/com.oracle.svm.core/src/com/oracle/svm/core/JavaMainWrapper.java", "diffHunk": "@@ -200,8 +209,12 @@ public static int run(int paramArgc, CCharPointerPointer paramArgv) {\n      * @return maximum length of C chars that can be stored in the program argument part of the\n      *         contiguous memory block without writing into the environment variables part.\n      */\n-    public static long getCRuntimeArgumentBlockLength() {\n-        VMError.guarantee(argv.notEqual(WordFactory.zero()) && argc > 0, \"Requires JavaMainWrapper.run(int, CCharPointerPointer) entry point!\");\n+    public static int getCRuntimeArgumentBlockLength() {\n+        try {\n+            checkArgumentBlockSupported();\n+        } catch (UnsupportedOperationException e) {", "originalCommit": "8564e018069a6034c2d758f06efbe77e095bf5cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MjI2Nw==", "url": "https://github.com/oracle/graal/pull/2204#discussion_r387552267", "bodyText": "Will do that in the follow up PR (where I remove the CompilerCommandPlugin stuff). The reason I didn't do that was to keep separate UnsupportedOperationException message strings (\"Argument vector not accessible (called from shared library image?)\" vs. \"Argument vector manipulation unsupported for platform \" + ...).", "author": "olpaw", "createdAt": "2020-03-04T09:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzM0ODYxOA=="}], "type": "inlineReview", "revised_code": null}]}