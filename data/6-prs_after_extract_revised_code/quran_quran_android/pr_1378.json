{"pr_number": 1378, "pr_title": "Add widgets", "pr_createdAt": "2020-06-12T22:32:13Z", "pr_url": "https://github.com/quran/quran_android/pull/1378", "timeline": [{"oid": "4c32dda83bf1c6d8120f3fb519e659972107ed09", "url": "https://github.com/quran/quran_android/commit/4c32dda83bf1c6d8120f3fb519e659972107ed09", "message": "Bookmarks Widget\n\nAdd bookmarks widget.", "committedDate": "2020-03-07T22:50:19Z", "type": "commit"}, {"oid": "3db2fa18a198ff66a8145cc7a3f1a45de7c9a5f7", "url": "https://github.com/quran/quran_android/commit/3db2fa18a198ff66a8145cc7a3f1a45de7c9a5f7", "message": "Add two Widgets\n\nAdd search and bookmarks widgets", "committedDate": "2020-03-07T23:13:07Z", "type": "commit"}, {"oid": "da447234db3f399ebf8d2e56e50b680a19d00ac9", "url": "https://github.com/quran/quran_android/commit/da447234db3f399ebf8d2e56e50b680a19d00ac9", "message": "Fix format\n\nsuggestions thanks to Shuhrat", "committedDate": "2020-03-07T23:24:32Z", "type": "commit"}, {"oid": "9db65ba547b17fc314798b3a348672d36eb9cf9e", "url": "https://github.com/quran/quran_android/commit/9db65ba547b17fc314798b3a348672d36eb9cf9e", "message": "Rename variables and format code #845", "committedDate": "2020-03-07T23:29:51Z", "type": "commit"}, {"oid": "69afc2cb36a297348c5f9b9edb7dc03f78881d7a", "url": "https://github.com/quran/quran_android/commit/69afc2cb36a297348c5f9b9edb7dc03f78881d7a", "message": "Fix jump to last page", "committedDate": "2020-06-10T18:54:13Z", "type": "commit"}, {"oid": "f8aa942cf10a23b133445e51562cebe3a23a3926", "url": "https://github.com/quran/quran_android/commit/f8aa942cf10a23b133445e51562cebe3a23a3926", "message": "Tidy up code", "committedDate": "2020-06-10T19:06:04Z", "type": "commit"}, {"oid": "23d5a47603676bfb861f4dfac57472608f0446e3", "url": "https://github.com/quran/quran_android/commit/23d5a47603676bfb861f4dfac57472608f0446e3", "message": "Make method public, call getter", "committedDate": "2020-06-10T19:07:50Z", "type": "commit"}, {"oid": "ad800efaef87a9e1527771423322d5267a89e944", "url": "https://github.com/quran/quran_android/commit/ad800efaef87a9e1527771423322d5267a89e944", "message": "Inject QuranInfo into WidgetListProvider", "committedDate": "2020-06-10T19:09:21Z", "type": "commit"}, {"oid": "926e7ccec1d344d70cb384834d1e198abd83da74", "url": "https://github.com/quran/quran_android/commit/926e7ccec1d344d70cb384834d1e198abd83da74", "message": "Add missing search activity xml changes", "committedDate": "2020-06-10T19:12:09Z", "type": "commit"}, {"oid": "074e3643ffed19c55337eaffe57f5f943664e59e", "url": "https://github.com/quran/quran_android/commit/074e3643ffed19c55337eaffe57f5f943664e59e", "message": "Minor code tidy up", "committedDate": "2020-06-10T19:12:35Z", "type": "commit"}, {"oid": "e6ec9604c714e2126456cfa3dd1db6545a738369", "url": "https://github.com/quran/quran_android/commit/e6ec9604c714e2126456cfa3dd1db6545a738369", "message": "Make search widget have round corners", "committedDate": "2020-06-10T19:14:02Z", "type": "commit"}, {"oid": "0597ccc1affaa8f4e54ecbbbb943a768857e1482", "url": "https://github.com/quran/quran_android/commit/0597ccc1affaa8f4e54ecbbbb943a768857e1482", "message": "Add preview image", "committedDate": "2020-06-10T19:14:49Z", "type": "commit"}, {"oid": "aeeddff433ce4ceb09ba365a859ef3d1cf1da98f", "url": "https://github.com/quran/quran_android/commit/aeeddff433ce4ceb09ba365a859ef3d1cf1da98f", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets", "committedDate": "2020-06-10T20:39:13Z", "type": "commit"}, {"oid": "aeff390d3922d438a5d1de2485fd652009468f80", "url": "https://github.com/quran/quran_android/commit/aeff390d3922d438a5d1de2485fd652009468f80", "message": "Fix case of ids", "committedDate": "2020-06-10T21:12:09Z", "type": "commit"}, {"oid": "ed94d940e03574f8b7bacc4f10f89f76c1ed7884", "url": "https://github.com/quran/quran_android/commit/ed94d940e03574f8b7bacc4f10f89f76c1ed7884", "message": "Convert files to Kotlin", "committedDate": "2020-06-11T18:41:52Z", "type": "commit"}, {"oid": "77a1e4eae306af873063d9471a7f1b7524126415", "url": "https://github.com/quran/quran_android/commit/77a1e4eae306af873063d9471a7f1b7524126415", "message": "Use SearchView, fix app crashing sometimes when searching", "committedDate": "2020-06-12T21:21:41Z", "type": "commit"}, {"oid": "6757b767d4ea649e19b2e60d582340b428c22e8c", "url": "https://github.com/quran/quran_android/commit/6757b767d4ea649e19b2e60d582340b428c22e8c", "message": "Remove unused variable & parameter", "committedDate": "2020-06-12T21:25:41Z", "type": "commit"}, {"oid": "5ab499dae202a6f170c073fb691f0c461606e189", "url": "https://github.com/quran/quran_android/commit/5ab499dae202a6f170c073fb691f0c461606e189", "message": "Remove line in bookmarks widget", "committedDate": "2020-06-12T21:26:54Z", "type": "commit"}, {"oid": "ce3a7912baa16e08fda881093e2599fccb528744", "url": "https://github.com/quran/quran_android/commit/ce3a7912baa16e08fda881093e2599fccb528744", "message": "Include only page bookmarks in bookmarks widget", "committedDate": "2020-06-12T22:12:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTgwNw==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439671807", "bodyText": "This took me a bunch of debugging and going through Android docs to figure out to add this code. Without it, if you do a search with results and then a search without results, the second search causes the app to crash (wasn't an issue before as there wasn't a search box in this activity then).", "author": "ismail-s", "createdAt": "2020-06-12T22:52:11Z", "path": "app/src/main/java/com/quran/labs/androidquran/SearchActivity.java", "diffHunk": "@@ -169,6 +174,9 @@ public void onLoadFinished(@NonNull Loader<Cursor> loader, Cursor cursor) {\n         buttonGetTranslations.setText(R.string.get_translations);\n         buttonGetTranslations.setVisibility(View.VISIBLE);\n       }\n+      if (adapter != null) {\n+        adapter.swapCursor(null);", "originalCommit": "ce3a7912baa16e08fda881093e2599fccb528744", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MzkyMg==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450493922", "bodyText": "wow, great catch!\nto be honest we should stop using CursorAdapter here completely :( this whole class should be rewritten at some point :(", "author": "ahmedre", "createdAt": "2020-07-06T21:39:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTgwNw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439672587", "bodyText": "I don't like this class being coupled to BookmarksWidget. It feels to me like there should be something in between, maybe something where this adapter fires out some stream of events and BookmarksWidget subscribes to that stream.\n@ahmedre do you have some ideas on the best way to do this (that also fits with how things are done in the rest of the app)?", "author": "ismail-s", "createdAt": "2020-06-12T22:56:08Z", "path": "app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java", "diffHunk": "@@ -144,6 +147,7 @@ public void replaceRecentRangeWithPage(int deleteRangeStart, int deleteRangeEnd,\n   }\n \n   public void addRecentPage(int page) {\n+    BookmarksWidget.updateWidget(context);", "originalCommit": "ce3a7912baa16e08fda881093e2599fccb528744", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NTQyOQ==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450495429", "bodyText": "take a look at BookmarkPresenter i think - there's an rx observable there. we can just subscribe to it and refresh then - not sure what the right place to subscribe is, but in worst case, some object that subscribes whenever there is at least one active widget", "author": "ahmedre", "createdAt": "2020-07-06T21:43:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA3Nzg3NQ==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r464077875", "bodyText": "Did some thinking around this and tried one or two different things, ended up doing this.\nWidgets don't seem to keep their apps running in the background (I think you essentially give a list of instructions to the launchers and they create the views that make up the widgets for you), so on app startup, at some point I think the app needs to subscribe BookmarksWidget up to any updates to bookmarks (if such widgets are being used). I've tried to do this in the simplest/minimal way possible.", "author": "ismail-s", "createdAt": "2020-08-02T13:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE0MDQ5MA==", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r464140490", "bodyText": "i think this is good but not sure this should live in BookmarksModel - seems like bookmarks model should only deal with bookmarks, and the widget updater is something that should (and does) subscribe to it so should not live in this class (but should live in its own class). though this way, you'd have to \"start up\" that class whenever the app starts if widgets are enabled as you mentioned.", "author": "ahmedre", "createdAt": "2020-08-03T00:06:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "148a9d0fe1aa426ec02fd1226cc2d9aaa5fe7ceb", "chunk": "diff --git a/app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java b/app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java\nindex 7fe5714e..bffb28d2 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java\n\n@@ -147,7 +146,6 @@ public class BookmarksDBAdapter {\n   }\n \n   public void addRecentPage(int page) {\n-    BookmarksWidget.updateWidget(context);\n     addRecentPage(page, true);\n   }\n \n"}}, {"oid": "60fb32d21a029a340a8c867dadb0203fb5152e35", "url": "https://github.com/quran/quran_android/commit/60fb32d21a029a340a8c867dadb0203fb5152e35", "message": "Use RelativeLayout instead of nested LinearLayouts", "committedDate": "2020-06-20T21:38:10Z", "type": "commit"}, {"oid": "7d7735c705dd8b3311a2edbf30cb238212dbca8b", "url": "https://github.com/quran/quran_android/commit/7d7735c705dd8b3311a2edbf30cb238212dbca8b", "message": "Remove unused strings", "committedDate": "2020-06-20T21:38:31Z", "type": "commit"}, {"oid": "c7400723d3f57a75d0524113cafd626d8c2d9370", "url": "https://github.com/quran/quran_android/commit/c7400723d3f57a75d0524113cafd626d8c2d9370", "message": "Revert changes to colour codes", "committedDate": "2020-06-20T21:38:46Z", "type": "commit"}, {"oid": "95b7ccb090a04009f9f884ed23419a8b8d8ada3a", "url": "https://github.com/quran/quran_android/commit/95b7ccb090a04009f9f884ed23419a8b8d8ada3a", "message": "Remove unnecessary onReceive method", "committedDate": "2020-07-06T22:41:39Z", "type": "commit"}, {"oid": "148a9d0fe1aa426ec02fd1226cc2d9aaa5fe7ceb", "url": "https://github.com/quran/quran_android/commit/148a9d0fe1aa426ec02fd1226cc2d9aaa5fe7ceb", "message": "Use rx observable for handling bookmarks changes", "committedDate": "2020-07-09T22:38:24Z", "type": "commit"}, {"oid": "8d0174be051ca80813a348c9af404d9e9ab40d7b", "url": "https://github.com/quran/quran_android/commit/8d0174be051ca80813a348c9af404d9e9ab40d7b", "message": "Update observable when bookmark is removed", "committedDate": "2020-07-09T22:39:32Z", "type": "commit"}, {"oid": "8976ec0741a6ecdc2d43ab99f93d23f0c462c2fd", "url": "https://github.com/quran/quran_android/commit/8976ec0741a6ecdc2d43ab99f93d23f0c462c2fd", "message": "Improve display of bookmarks and behaviour when clicked\n\nAlso display Ayah bookmarks in addition to page bookmarks", "committedDate": "2020-07-22T21:32:20Z", "type": "commit"}, {"oid": "b5dc64331231d326f49dd98770762d5461fd4164", "url": "https://github.com/quran/quran_android/commit/b5dc64331231d326f49dd98770762d5461fd4164", "message": "Move files to subpackage", "committedDate": "2020-07-22T23:48:59Z", "type": "commit"}, {"oid": "c5966731fb8ae1bd2bc75e4fc030f685762242e3", "url": "https://github.com/quran/quran_android/commit/c5966731fb8ae1bd2bc75e4fc030f685762242e3", "message": "Populate search view with initial query, set focus correctly", "committedDate": "2020-07-23T21:07:22Z", "type": "commit"}, {"oid": "3b7df4e520755ac14bb94071c8cc34443c34070d", "url": "https://github.com/quran/quran_android/commit/3b7df4e520755ac14bb94071c8cc34443c34070d", "message": "Fix bug with bookmark colors", "committedDate": "2020-07-23T21:40:06Z", "type": "commit"}, {"oid": "ca9efb1c94c1dfc5d35a46917b62b016b6d1801f", "url": "https://github.com/quran/quran_android/commit/ca9efb1c94c1dfc5d35a46917b62b016b6d1801f", "message": "Add button to search widget for jumping to location", "committedDate": "2020-08-02T12:56:57Z", "type": "commit"}, {"oid": "c26933d0a31e41e12f4fc38df29a746c304d5e8c", "url": "https://github.com/quran/quran_android/commit/c26933d0a31e41e12f4fc38df29a746c304d5e8c", "message": "Remove unnecessary attribute", "committedDate": "2020-08-02T12:58:06Z", "type": "commit"}, {"oid": "e053590d33e33f3ded28ec05c85d9bd706f3a7b2", "url": "https://github.com/quran/quran_android/commit/e053590d33e33f3ded28ec05c85d9bd706f3a7b2", "message": "Collapse tags", "committedDate": "2020-08-02T12:58:25Z", "type": "commit"}, {"oid": "426380bebc6f7f8029176fa22b2dd2a0bc048a76", "url": "https://github.com/quran/quran_android/commit/426380bebc6f7f8029176fa22b2dd2a0bc048a76", "message": "Change text when no bookmarks to display in widget", "committedDate": "2020-08-02T12:58:52Z", "type": "commit"}, {"oid": "973f90f38f917807e14f8ea0a2ec0664ae977a88", "url": "https://github.com/quran/quran_android/commit/973f90f38f917807e14f8ea0a2ec0664ae977a88", "message": "Fix exception on removing all bookmark widgets", "committedDate": "2020-08-04T22:04:49Z", "type": "commit"}, {"oid": "6a932afb97a52992ea60849d0de628add9f25654", "url": "https://github.com/quran/quran_android/commit/6a932afb97a52992ea60849d0de628add9f25654", "message": "Add margin to text in widget", "committedDate": "2020-09-14T22:23:24Z", "type": "commit"}, {"oid": "919c68f59a102d3200d06bfc0d209513e87d7bee", "url": "https://github.com/quran/quran_android/commit/919c68f59a102d3200d06bfc0d209513e87d7bee", "message": "Refactor code into BookmarksWidgetSubscriber", "committedDate": "2020-09-14T22:43:49Z", "type": "commit"}, {"oid": "22c48444a6ea1f2defe93e863d680cc9e3b6f876", "url": "https://github.com/quran/quran_android/commit/22c48444a6ea1f2defe93e863d680cc9e3b6f876", "message": "Rename classes", "committedDate": "2020-09-19T20:56:22Z", "type": "commit"}, {"oid": "3c7a4798547f9dab503f9bc02cf978e80752dcfa", "url": "https://github.com/quran/quran_android/commit/3c7a4798547f9dab503f9bc02cf978e80752dcfa", "message": "Add docstrings", "committedDate": "2020-09-19T20:57:48Z", "type": "commit"}, {"oid": "e43d6223823073f073fe2122c1aa59fd5f2f7d5c", "url": "https://github.com/quran/quran_android/commit/e43d6223823073f073fe2122c1aa59fd5f2f7d5c", "message": "Update widget preview images", "committedDate": "2020-09-19T22:13:20Z", "type": "commit"}, {"oid": "043117d1a4a2c4c00040f8b7bab039bece3938e8", "url": "https://github.com/quran/quran_android/commit/043117d1a4a2c4c00040f8b7bab039bece3938e8", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets", "committedDate": "2020-09-20T13:21:43Z", "type": "commit"}, {"oid": "07218246e4557bd7f8d5b220753586a703823e06", "url": "https://github.com/quran/quran_android/commit/07218246e4557bd7f8d5b220753586a703823e06", "message": "Fix flaky unittest", "committedDate": "2020-09-20T13:21:58Z", "type": "commit"}, {"oid": "f72bc5bd7a1e3dd6d4f160547ec87642750540e7", "url": "https://github.com/quran/quran_android/commit/f72bc5bd7a1e3dd6d4f160547ec87642750540e7", "message": "Move SearchView to be in toolbar", "committedDate": "2020-09-26T14:22:05Z", "type": "commit"}, {"oid": "f82d46189d64ccd90ce62cac53803609e69a52cf", "url": "https://github.com/quran/quran_android/commit/f82d46189d64ccd90ce62cac53803609e69a52cf", "message": "Consolidate code for handling action view", "committedDate": "2020-09-26T14:43:25Z", "type": "commit"}, {"oid": "92bde9bdb5dc7617ba8fff6d1bd35549cc37bc72", "url": "https://github.com/quran/quran_android/commit/92bde9bdb5dc7617ba8fff6d1bd35549cc37bc72", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets", "committedDate": "2020-09-27T20:14:07Z", "type": "commit"}, {"oid": "230e3b082a08fcadf2297dba5e1451838d42c3ac", "url": "https://github.com/quran/quran_android/commit/230e3b082a08fcadf2297dba5e1451838d42c3ac", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets", "committedDate": "2020-09-27T20:14:45Z", "type": "commit"}, {"oid": "67aa22598ca63dbb0d0d3bb18ae193c60edd5594", "url": "https://github.com/quran/quran_android/commit/67aa22598ca63dbb0d0d3bb18ae193c60edd5594", "message": "Consolidate bookmarks empty strings", "committedDate": "2020-09-28T20:33:31Z", "type": "commit"}, {"oid": "b930b85c4e47dfd2e2845c4ad416c0d2f6af0957", "url": "https://github.com/quran/quran_android/commit/b930b85c4e47dfd2e2845c4ad416c0d2f6af0957", "message": "Add jump button to bookmarks widget", "committedDate": "2020-09-28T22:41:20Z", "type": "commit"}, {"oid": "d208eefe78d0056c15b015ba7132364d459d379f", "url": "https://github.com/quran/quran_android/commit/d208eefe78d0056c15b015ba7132364d459d379f", "message": "Increase range of widget resizing", "committedDate": "2020-09-28T22:42:20Z", "type": "commit"}]}