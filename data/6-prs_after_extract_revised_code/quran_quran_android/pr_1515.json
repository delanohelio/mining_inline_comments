{"pr_number": 1515, "pr_title": "Add a fallback url for when main urls don't work", "pr_createdAt": "2020-12-27T13:28:36Z", "pr_url": "https://github.com/quran/quran_android/pull/1515", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTcwMA==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549185700", "bodyText": "You could directly use replace without if block/check, because with contains and replace you are doing double look-up anyway.", "author": "ozbek", "createdAt": "2020-12-28T01:18:32Z", "path": "app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java", "diffHunk": "@@ -464,10 +466,11 @@ private boolean downloadFileWrapper(String urlString, String destination,\n       }\n \n       String url = urlString;\n-      if (i > 0) {\n-        // let's try http instead of https?\n-        if (urlString.contains(\"quran.com\") || urlString.contains(\"quranicaudio.com\")) {\n-          url = urlString.replace(\"https://\", \"http://\");\n+      if (fallbackByDefault || i > 0) {\n+        if (urlString.contains(\"android.quran.com\")) {", "originalCommit": "cff2450970199f94d17426d4c23d3e4b144524d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2NDAxMg==", "url": "https://github.com/quran/quran_android/pull/1515#discussion_r549764012", "bodyText": "jazakAllah khairan - done", "author": "ahmedre", "createdAt": "2020-12-29T16:18:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTE4NTcwMA=="}], "type": "inlineReview", "revised_code": {"commit": "77afd0986811ab5c91e5616a6d83e26f2f3be393", "chunk": "diff --git a/app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java b/app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java\nindex a87fb55e..d07b89c7 100644\n--- a/app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java\n+++ b/app/src/main/java/com/quran/labs/androidquran/service/QuranDownloadService.java\n\n@@ -467,11 +469,7 @@ public class QuranDownloadService extends Service implements\n \n       String url = urlString;\n       if (fallbackByDefault || i > 0) {\n-        if (urlString.contains(\"android.quran.com\")) {\n-          url = urlString.replace(\"android.quran.com\", \"quran.app\");\n-        } else if (urlString.contains(\"quranicaudio.com\")) {\n-          url = urlString.replace(\"quranicaudio.com\", \"quranicaudio.org\");\n-        }\n+        url = urlUtil.fallbackUrl(url);\n \n         // want to wait before retrying again\n         try {\n"}}, {"oid": "77afd0986811ab5c91e5616a6d83e26f2f3be393", "url": "https://github.com/quran/quran_android/commit/77afd0986811ab5c91e5616a6d83e26f2f3be393", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:14:13Z", "type": "forcePushed"}, {"oid": "ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "url": "https://github.com/quran/quran_android/commit/ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:55:22Z", "type": "commit"}, {"oid": "ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "url": "https://github.com/quran/quran_android/commit/ef8005a46d036c86ef0ec112e5bc9d7051b0d529", "message": "Add a fallback url for when main urls don't work", "committedDate": "2020-12-29T16:55:22Z", "type": "forcePushed"}]}