{"pr_number": 3577, "pr_title": "[Fix]SlotRef.tosql() is the same as the SQL returned by different sql", "pr_createdAt": "2020-05-13T07:27:47Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3577", "timeline": [{"oid": "f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589", "url": "https://github.com/apache/incubator-doris/commit/f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589", "message": "fixed bug:SlotRef.tosql() is the same as the SQL returned by different SQL", "committedDate": "2020-05-13T07:06:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE3MDg0OA==", "url": "https://github.com/apache/incubator-doris/pull/3577#discussion_r425170848", "bodyText": "How about return both slot id and expr. I'm afraid that slot id may be used for some tracing debug.\nAnd please fix all related unit tests after you change here.", "author": "morningman", "createdAt": "2020-05-14T14:15:19Z", "path": "fe/src/main/java/org/apache/doris/analysis/SlotRef.java", "diffHunk": "@@ -162,6 +162,12 @@ public String toSqlImpl() {\n             return tblName.toSql() + \".\" + label + sb.toString();\n         } else if (label != null) {\n             return label + sb.toString();\n+        } else if (desc.getSourceExprs() != null) {\n+            for (Expr expr : desc.getSourceExprs()) {\n+                sb.append(expr.toSql());\n+                sb.append(\" \");\n+            }\n+            return sb.toString();", "originalCommit": "f9f3a84e9d54cbe0d97d6d65bfc2fa9fa166b589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0MTgyMg==", "url": "https://github.com/apache/incubator-doris/pull/3577#discussion_r425241822", "bodyText": "How about slot ID and expr? I need MD5 of SQL as the key of cache instead of slot ID. I'm trying to fix the other unit tests", "author": "marising", "createdAt": "2020-05-14T15:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE3MDg0OA=="}], "type": "inlineReview", "revised_code": {"commit": "4217db00d3a7fa912492d1edb2fbd9ef314bf5fc", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/analysis/SlotRef.java b/fe/src/main/java/org/apache/doris/analysis/SlotRef.java\nindex 0fe5cd561..572be393f 100644\n--- a/fe/src/main/java/org/apache/doris/analysis/SlotRef.java\n+++ b/fe/src/main/java/org/apache/doris/analysis/SlotRef.java\n\n@@ -163,9 +163,12 @@ public class SlotRef extends Expr {\n         } else if (label != null) {\n             return label + sb.toString();\n         } else if (desc.getSourceExprs() != null) {\n+            if (desc.getId().asInt() != 1) {\n+                sb.append(\"<slot \" + Integer.toString(desc.getId().asInt()) + \">\");\n+            }\n             for (Expr expr : desc.getSourceExprs()) {\n-                sb.append(expr.toSql());\n                 sb.append(\" \");\n+                sb.append(expr.toSql());\n             }\n             return sb.toString();\n         } else {\n"}}, {"oid": "4217db00d3a7fa912492d1edb2fbd9ef314bf5fc", "url": "https://github.com/apache/incubator-doris/commit/4217db00d3a7fa912492d1edb2fbd9ef314bf5fc", "message": "Tosql method returns slot index and column name", "committedDate": "2020-05-15T09:31:25Z", "type": "commit"}]}