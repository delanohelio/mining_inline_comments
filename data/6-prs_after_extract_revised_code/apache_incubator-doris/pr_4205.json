{"pr_number": 4205, "pr_title": "[Bug] Fix fe meta version problem, make drop meta check code easy to read and add doc content for drop meta check", "pr_createdAt": "2020-07-29T11:56:13Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4205", "timeline": [{"oid": "7ec5a31eed2ea8b93b3aacde06a9dff3cb2dc34c", "url": "https://github.com/apache/incubator-doris/commit/7ec5a31eed2ea8b93b3aacde06a9dff3cb2dc34c", "message": "This PR is to fix Fe meta problem, make drop check code easy to read and add doc content for drop meta check", "committedDate": "2020-07-29T11:45:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0NzA4Mg==", "url": "https://github.com/apache/incubator-doris/pull/4205#discussion_r462247082", "bodyText": "I suggest to modify it like this:\nDropDbInfo info = new DropDbInfo(dbName, stmt.isForceDrop());\neditLog.logDropDb(info);\n\nJust like other editLog.logxxx()", "author": "morningman", "createdAt": "2020-07-29T12:04:50Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/Catalog.java", "diffHunk": "@@ -2733,12 +2733,12 @@ public void dropDb(DropDbStmt stmt) throws DdlException {\n             fullNameToDb.remove(db.getFullName());\n             final Cluster cluster = nameToCluster.get(db.getClusterName());\n             cluster.removeDb(dbName, db.getId());\n-            editLog.logDropDb(dbName, !stmt.isNeedCheckCommittedTxns());\n+            editLog.logDropDb(dbName, stmt.isForceDrop());", "originalCommit": "7ec5a31eed2ea8b93b3aacde06a9dff3cb2dc34c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1MDk0OQ==", "url": "https://github.com/apache/incubator-doris/pull/4205#discussion_r462250949", "bodyText": "fix done", "author": "caiconghui", "createdAt": "2020-07-29T12:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI0NzA4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "4bc2a21ed1131a1aeebee2bf1cc7dde64455e0ec", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/Catalog.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/Catalog.java\nindex c4ef9fa72..d269ce102 100755\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/Catalog.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/Catalog.java\n\n@@ -2733,7 +2734,8 @@ public class Catalog {\n             fullNameToDb.remove(db.getFullName());\n             final Cluster cluster = nameToCluster.get(db.getClusterName());\n             cluster.removeDb(dbName, db.getId());\n-            editLog.logDropDb(dbName, stmt.isForceDrop());\n+            DropDbInfo info = new DropDbInfo(dbName, stmt.isForceDrop());\n+            editLog.logDropDb(info);\n         } finally {\n             unlock();\n         }\n"}}, {"oid": "4bc2a21ed1131a1aeebee2bf1cc7dde64455e0ec", "url": "https://github.com/apache/incubator-doris/commit/4bc2a21ed1131a1aeebee2bf1cc7dde64455e0ec", "message": "fix by review", "committedDate": "2020-07-29T12:11:26Z", "type": "commit"}]}