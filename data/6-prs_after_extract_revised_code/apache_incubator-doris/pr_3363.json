{"pr_number": 3363, "pr_title": "[Bug]Use OlapTableSink::close to replace OlapTableSink::finalize method to avoid OOM", "pr_createdAt": "2020-04-21T07:34:53Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3363", "timeline": [{"oid": "c81d8c836dea4bfcd81f17e840a030ea81328ad1", "url": "https://github.com/apache/incubator-doris/commit/c81d8c836dea4bfcd81f17e840a030ea81328ad1", "message": "[Bug]Use `close` to replace `finalize` method to avoid OOM\n\nThis CL mainly solve the problem that when recycle `OlapTableSink`\nobject, GC thread will not do it immediately because the class override\nthe `finalize` method, and it will cause OOM.", "committedDate": "2020-04-21T07:30:48Z", "type": "commit"}, {"oid": "da70a0ae6e045f93c2c7b7f48c94081184f2c7e0", "url": "https://github.com/apache/incubator-doris/commit/da70a0ae6e045f93c2c7b7f48c94081184f2c7e0", "message": "fix", "committedDate": "2020-04-21T15:06:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYwMDEzMg==", "url": "https://github.com/apache/incubator-doris/pull/3363#discussion_r412600132", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void completeq() throws UserException {\n          \n          \n            \n                public void complete() throws UserException {", "author": "kangkaisen", "createdAt": "2020-04-22T01:22:25Z", "path": "fe/src/main/java/org/apache/doris/planner/OlapTableSink.java", "diffHunk": "@@ -118,7 +118,7 @@ public void updateLoadId(TUniqueId newLoadId) {\n     }\n \n     // must called after tupleDescriptor is computed\n-    public void finalize() throws UserException {\n+    public void completeq() throws UserException {", "originalCommit": "da70a0ae6e045f93c2c7b7f48c94081184f2c7e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "483f971a48e7e4c22d60da33f8b60d43c5f9d398", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/planner/OlapTableSink.java b/fe/src/main/java/org/apache/doris/planner/OlapTableSink.java\nindex dd2c37330..71fb975a5 100644\n--- a/fe/src/main/java/org/apache/doris/planner/OlapTableSink.java\n+++ b/fe/src/main/java/org/apache/doris/planner/OlapTableSink.java\n\n@@ -118,7 +118,7 @@ public class OlapTableSink extends DataSink {\n     }\n \n     // must called after tupleDescriptor is computed\n-    public void completeq() throws UserException {\n+    public void complete() throws UserException {\n         TOlapTableSink tSink = tDataSink.getOlap_table_sink();\n \n         tSink.setTable_id(dstTable.getId());\n"}}, {"oid": "483f971a48e7e4c22d60da33f8b60d43c5f9d398", "url": "https://github.com/apache/incubator-doris/commit/483f971a48e7e4c22d60da33f8b60d43c5f9d398", "message": "fix", "committedDate": "2020-04-22T01:47:36Z", "type": "commit"}]}