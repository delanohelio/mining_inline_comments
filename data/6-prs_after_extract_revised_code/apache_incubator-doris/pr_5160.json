{"pr_number": 5160, "pr_title": "[BUG] Follower shouldn't forward non-query statement to master repeatedly", "pr_createdAt": "2020-12-28T06:55:37Z", "pr_url": "https://github.com/apache/incubator-doris/pull/5160", "timeline": [{"oid": "aced136906424ed2e5c02fbe2f8a53153735947a", "url": "https://github.com/apache/incubator-doris/commit/aced136906424ed2e5c02fbe2f8a53153735947a", "message": "Follower don't forward non-query statement to master repeatedly", "committedDate": "2020-12-28T06:41:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549243551", "bodyText": "isQuery rename to shouldRetry? and variable 'shouldNotRetry' in MasterOpExecutor rename to \"shouldRetry\"? I think it is more readable. and then we just need to think when need to retry", "author": "caiconghui", "createdAt": "2020-12-28T07:27:25Z", "path": "fe/fe-core/src/main/java/org/apache/doris/qe/MasterOpExecutor.java", "diffHunk": "@@ -42,7 +42,9 @@\n     // the total time of thrift connectTime add readTime and writeTime\n     private int thriftTimeoutMs;\n \n-    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status) {\n+    private boolean shouldNotRetry;\n+\n+    public MasterOpExecutor(OriginStatement originStmt, ConnectContext ctx, RedirectStatus status, boolean isQuery) {", "originalCommit": "aced136906424ed2e5c02fbe2f8a53153735947a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0NTQ3Ng==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549245476", "bodyText": "I was discussed this name with my colleague, the constructor of MasterOpExecutor expose 'shouldRetry' could lead to misuse, because could not remember the retry related to statement type when invoke new MasterOpExecutor().\nAlthough isQuery doesn't look good, but it always write collect.\nAnd shouldNotRetry means exactly that: we should not retry forward to master. shouldRetry mismatch  the case that QueryStatement timeout.", "author": "924060929", "createdAt": "2020-12-28T07:36:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0OTg3OA==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549249878", "bodyText": "If we want retry a statement, just need it is a idempotent operation, not just query, right?", "author": "caiconghui", "createdAt": "2020-12-28T07:53:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI1MTg3MQ==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549251871", "bodyText": "yes\uff0cthe condition isQuery is conservative & convenient", "author": "924060929", "createdAt": "2020-12-28T08:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI1NDY5Ng==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549254696", "bodyText": "the principle is\uff1awe must ensure non-idempotent operation execute at-most-once if we has not a same label", "author": "924060929", "createdAt": "2020-12-28T08:12:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI4MjcwMA==", "url": "https://github.com/apache/incubator-doris/pull/5160#discussion_r549282700", "bodyText": "Thank You, I see", "author": "caiconghui", "createdAt": "2020-12-28T09:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTI0MzU1MQ=="}], "type": "inlineReview", "revised_code": null}]}