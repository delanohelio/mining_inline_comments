{"pr_number": 4872, "pr_title": "[Bug] Make 'LastStartTime' in backends list as the actual BE start time", "pr_createdAt": "2020-11-09T10:57:59Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4872", "timeline": [{"oid": "cec81e334313cb45e31bce2806c266348974554d", "url": "https://github.com/apache/incubator-doris/commit/cec81e334313cb45e31bce2806c266348974554d", "message": "[Enhanced] Make 'LastStartTime' in backends list as the actual BE start time\n\nWe use 'LastStartTime' in backends list to check whether there is an unexpected\nrestart of BE, but it will be changed as BE's first heartbeat time after FE\nrestarted, it would be better to set it to BE's actual start time.", "committedDate": "2020-11-09T10:43:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDMyODU4Mg==", "url": "https://github.com/apache/incubator-doris/pull/4872#discussion_r520328582", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                long beStartTime = System.currentTimeMillis();\n          \n          \n            \n                                long beStartTime = tBackendInfo.isSetBeStartTime() ? tBackendInfo.getBeStartTime() : System.currentTimeMillis();", "author": "caiconghui", "createdAt": "2020-11-10T06:48:23Z", "path": "fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java", "diffHunk": "@@ -242,9 +242,12 @@ public HeartbeatResponse call() {\n                     if (tBackendInfo.isSetVersion()) {\n                         version = tBackendInfo.getVersion();\n                     }\n-\n+                    long beStartTime = System.currentTimeMillis();", "originalCommit": "cec81e334313cb45e31bce2806c266348974554d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0363fd424793c2cdbeed49f0e18bc8dfdb498730", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java b/fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java\nindex fab1451a9..cb6363203 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/system/HeartbeatMgr.java\n\n@@ -242,10 +242,7 @@ public class HeartbeatMgr extends MasterDaemon {\n                     if (tBackendInfo.isSetVersion()) {\n                         version = tBackendInfo.getVersion();\n                     }\n-                    long beStartTime = System.currentTimeMillis();\n-                    if (tBackendInfo.isSetBeStartTime()) {\n-                        beStartTime = tBackendInfo.getBeStartTime();\n-                    }\n+                    long beStartTime = tBackendInfo.isSetBeStartTime() ? tBackendInfo.getBeStartTime() : System.currentTimeMillis();\n                     // backend.updateOnce(bePort, httpPort, beRpcPort, brpcPort);\n                     return new BackendHbResponse(backendId, bePort, httpPort, brpcPort, System.currentTimeMillis(), beStartTime, version);\n                 } else {\n"}}, {"oid": "0363fd424793c2cdbeed49f0e18bc8dfdb498730", "url": "https://github.com/apache/incubator-doris/commit/0363fd424793c2cdbeed49f0e18bc8dfdb498730", "message": "fix", "committedDate": "2020-11-10T06:53:03Z", "type": "commit"}]}