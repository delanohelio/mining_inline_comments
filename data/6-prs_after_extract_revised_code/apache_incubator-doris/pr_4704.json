{"pr_number": 4704, "pr_title": "[Feature][Config] Support persistence of configuration items modified at runtime", "pr_createdAt": "2020-10-07T07:10:16Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4704", "timeline": [{"oid": "02e5de2a4f9fc5da2f3341ed28096bceab284948", "url": "https://github.com/apache/incubator-doris/commit/02e5de2a4f9fc5da2f3341ed28096bceab284948", "message": "fix ut", "committedDate": "2020-10-08T13:58:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxNDYwMg==", "url": "https://github.com/apache/incubator-doris/pull/4704#discussion_r502414602", "bodyText": "I think users can edit this file if they need to.", "author": "xy720", "createdAt": "2020-10-09T13:08:23Z", "path": "fe/fe-core/src/main/java/org/apache/doris/common/ConfigBase.java", "diffHunk": "@@ -284,4 +308,31 @@ public synchronized static boolean checkIsMasterOnly(String key) {\n \n         return anno.masterOnly();\n     }\n+\n+    // overwrite configs to customConfFile.\n+    // use synchronized to make sure only one thread modify this file\n+    public synchronized static void persistConfig(Map<String, String> customConf) throws IOException {\n+        File file = new File(customConfFile);\n+        if (!file.exists()) {\n+            file.createNewFile();\n+        } else {\n+            // clear the file content\n+            try (PrintWriter writer = new PrintWriter(file)) {\n+                writer.print(\"\");\n+            }\n+        }\n+\n+        Properties props = new Properties();\n+        props.load(new FileReader(customConfFile));\n+\n+        for (Map.Entry<String, String> entry : customConf.entrySet()) {\n+            props.setProperty(entry.getKey(), entry.getValue());\n+        }\n+\n+        try (FileOutputStream fos = new FileOutputStream(file)) {\n+            props.store(fos, \"THIS IS AN AUTO GENERATED CONFIG FILE. DO NOT EDIT IT!\\n\\n\" +", "originalCommit": "02e5de2a4f9fc5da2f3341ed28096bceab284948", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc0MjUwNw==", "url": "https://github.com/apache/incubator-doris/pull/4704#discussion_r502742507", "bodyText": "OK", "author": "morningman", "createdAt": "2020-10-10T04:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxNDYwMg=="}], "type": "inlineReview", "revised_code": {"commit": "330e656407314e24fa3544cc90336eda3be4b1f3", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/common/ConfigBase.java b/fe/fe-core/src/main/java/org/apache/doris/common/ConfigBase.java\nindex 009a3ff47..6378c3526 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/common/ConfigBase.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/common/ConfigBase.java\n\n@@ -330,8 +330,9 @@ public class ConfigBase {\n         }\n \n         try (FileOutputStream fos = new FileOutputStream(file)) {\n-            props.store(fos, \"THIS IS AN AUTO GENERATED CONFIG FILE. DO NOT EDIT IT!\\n\\n\" +\n-                    \"The configurations in this file will overwrite the configurations in fe.conf\");\n+            props.store(fos, \"THIS IS AN AUTO GENERATED CONFIG FILE.\\n\"\n+                    + \"You can modify this file manually, and the configurations in this file\\n\"\n+                    + \"will overwrite the configurations in fe.conf\");\n         }\n     }\n }\n"}}, {"oid": "330e656407314e24fa3544cc90336eda3be4b1f3", "url": "https://github.com/apache/incubator-doris/commit/330e656407314e24fa3544cc90336eda3be4b1f3", "message": "fix by review", "committedDate": "2020-10-12T04:25:56Z", "type": "forcePushed"}, {"oid": "a67bb896fcce539f7a49a54d89135e55118b8828", "url": "https://github.com/apache/incubator-doris/commit/a67bb896fcce539f7a49a54d89135e55118b8828", "message": "first", "committedDate": "2020-10-20T03:59:04Z", "type": "commit"}, {"oid": "f43137e5d17208ad94fe9bed704375581b49a646", "url": "https://github.com/apache/incubator-doris/commit/f43137e5d17208ad94fe9bed704375581b49a646", "message": "second", "committedDate": "2020-10-20T03:59:04Z", "type": "commit"}, {"oid": "3e81d43a1571f37a73e35e1049a1efc841845876", "url": "https://github.com/apache/incubator-doris/commit/3e81d43a1571f37a73e35e1049a1efc841845876", "message": "be config", "committedDate": "2020-10-20T03:59:04Z", "type": "commit"}, {"oid": "e976d464147025ef197b090e7d52bf9b922aeeaa", "url": "https://github.com/apache/incubator-doris/commit/e976d464147025ef197b090e7d52bf9b922aeeaa", "message": "doc", "committedDate": "2020-10-20T03:59:05Z", "type": "commit"}, {"oid": "ebf4216ab5a946a8527962b641aa3ac6ffde0127", "url": "https://github.com/apache/incubator-doris/commit/ebf4216ab5a946a8527962b641aa3ac6ffde0127", "message": "fix ut", "committedDate": "2020-10-20T03:59:05Z", "type": "commit"}, {"oid": "4c71bf55b2dedb55af79a74037c33c511b602344", "url": "https://github.com/apache/incubator-doris/commit/4c71bf55b2dedb55af79a74037c33c511b602344", "message": "fix by review", "committedDate": "2020-10-20T03:59:05Z", "type": "commit"}, {"oid": "4c71bf55b2dedb55af79a74037c33c511b602344", "url": "https://github.com/apache/incubator-doris/commit/4c71bf55b2dedb55af79a74037c33c511b602344", "message": "fix by review", "committedDate": "2020-10-20T03:59:05Z", "type": "forcePushed"}, {"oid": "3c9190cdba43e34fbb374ecf555215c0fe0e1c38", "url": "https://github.com/apache/incubator-doris/commit/3c9190cdba43e34fbb374ecf555215c0fe0e1c38", "message": "add custom config dir config", "committedDate": "2020-10-20T04:24:27Z", "type": "commit"}, {"oid": "88a5b19cf0b28d0cf89916e388739169f8e46a06", "url": "https://github.com/apache/incubator-doris/commit/88a5b19cf0b28d0cf89916e388739169f8e46a06", "message": "add custom_conf_dir config", "committedDate": "2020-10-20T15:58:50Z", "type": "commit"}]}