{"pr_number": 4502, "pr_title": "[SQL] Support where, limit, order clause in show resourcestmt.", "pr_createdAt": "2020-09-01T13:01:46Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4502", "timeline": [{"oid": "955232997159e4a089c6376a354a80e153c63d29", "url": "https://github.com/apache/incubator-doris/commit/955232997159e4a089c6376a354a80e153c63d29", "message": "[SQL] Support where, limit, order clause in show resourcestmt.\n\nGrammar\n\n    SHOW RESOURCES\n    [\n        WHERE\n        [NAME [ = \"your_resource_name\" | LIKE \"name_matcher\"]]\n        [RESOURCETYPE = [\"SPARK\"]]\n    ]\n    [ORDER BY ...]\n    [LIMIT limit][OFFSET offset];\n\nissue #4501", "committedDate": "2020-09-01T12:58:16Z", "type": "commit"}, {"oid": "39dd11b8ebef521a42274087a93dab9a7b45208d", "url": "https://github.com/apache/incubator-doris/commit/39dd11b8ebef521a42274087a93dab9a7b45208d", "message": "change log back", "committedDate": "2020-09-01T13:03:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3MzYwMw==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481573603", "bodyText": "the ResourceType has two definations but has different meanings\uff1a\n1\u3001org.apache.doris.catalog.Resource.ResourceType\n2\u3001org.apache.doris.catalog.ResourceType\nshould be fix", "author": "wutiangan", "createdAt": "2020-09-02T02:40:56Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -17,9 +17,11 @@\n \n package org.apache.doris.catalog;\n \n+import com.google.common.collect.Lists;\n import org.apache.doris.analysis.CreateResourceStmt;\n import org.apache.doris.analysis.DropResourceStmt;\n import org.apache.doris.catalog.Resource.ResourceType;", "originalCommit": "39dd11b8ebef521a42274087a93dab9a7b45208d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjc4Nw==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r482016787", "bodyText": "org.apache.doris.catalog.ResourceType is deprecated. It will be deleted in the future", "author": "HappenLee", "createdAt": "2020-09-02T12:05:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3MzYwMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NTE3Mw==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481575173", "bodyText": "equalsIgnore()", "author": "wutiangan", "createdAt": "2020-09-02T02:43:28Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -109,8 +112,41 @@ public int getResourceNum() {\n         return nameToResource.size();\n     }\n \n-    public List<List<String>> getResourcesInfo() {\n-        return procNode.fetchResult().getRows();\n+    public List<List<Comparable>> getResourcesInfo(String name, boolean accurateMatch, Set<String> typeSets) {\n+        List<List<String>> targetRows = procNode.fetchResult().getRows();\n+        List<List<Comparable>> returnRows = Lists.newArrayList();\n+\n+        for (List<String> row : targetRows) {\n+            if (row == null || row.size() < 2) {\n+                continue;\n+            }\n+\n+            String resourceName = row.get(0);\n+            String resourceType = row.get(1);\n+\n+            if (name != null) {\n+                if (accurateMatch && !resourceName.equals(name)) {", "originalCommit": "39dd11b8ebef521a42274087a93dab9a7b45208d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjA3Ng==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r482016076", "bodyText": "There is need need ignore. The Name should be case sensitive", "author": "HappenLee", "createdAt": "2020-09-02T12:04:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NTE3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\nindex 79f346344..3cc370170 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n\n@@ -140,8 +140,8 @@ public class ResourceMgr implements Writable {\n             }\n \n             List<Comparable> comparableRow = Lists.newArrayList();\n-            for (Comparable solt : row) {\n-                comparableRow.add(solt);\n+            for (Comparable slot : row) {\n+                comparableRow.add(slot);\n             }\n             returnRows.add(comparableRow);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NjQ1Mw==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r481576453", "bodyText": "solt --> slot", "author": "wutiangan", "createdAt": "2020-09-02T02:45:24Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -109,8 +112,41 @@ public int getResourceNum() {\n         return nameToResource.size();\n     }\n \n-    public List<List<String>> getResourcesInfo() {\n-        return procNode.fetchResult().getRows();\n+    public List<List<Comparable>> getResourcesInfo(String name, boolean accurateMatch, Set<String> typeSets) {\n+        List<List<String>> targetRows = procNode.fetchResult().getRows();\n+        List<List<Comparable>> returnRows = Lists.newArrayList();\n+\n+        for (List<String> row : targetRows) {\n+            if (row == null || row.size() < 2) {\n+                continue;\n+            }\n+\n+            String resourceName = row.get(0);\n+            String resourceType = row.get(1);\n+\n+            if (name != null) {\n+                if (accurateMatch && !resourceName.equals(name)) {\n+                    continue;\n+                }\n+                if (!accurateMatch && !resourceName.contains(name)) {\n+                    continue;\n+                }\n+            }\n+\n+            if (typeSets != null) {\n+                if (!typeSets.contains(resourceType.toUpperCase())) {\n+                    continue;\n+                }\n+            }\n+\n+            List<Comparable> comparableRow = Lists.newArrayList();\n+            for (Comparable solt : row) {", "originalCommit": "39dd11b8ebef521a42274087a93dab9a7b45208d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNTUxMQ==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r482015511", "bodyText": "i will change it", "author": "HappenLee", "createdAt": "2020-09-02T12:03:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTU3NjQ1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\nindex 79f346344..3cc370170 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n\n@@ -140,8 +140,8 @@ public class ResourceMgr implements Writable {\n             }\n \n             List<Comparable> comparableRow = Lists.newArrayList();\n-            for (Comparable solt : row) {\n-                comparableRow.add(solt);\n+            for (Comparable slot : row) {\n+                comparableRow.add(slot);\n             }\n             returnRows.add(comparableRow);\n         }\n"}}, {"oid": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "url": "https://github.com/apache/incubator-doris/commit/2e2ded6d8f276f437dfc28c79a7475f4508520fd", "message": "revise some code", "committedDate": "2020-09-02T12:26:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAwODc0Mg==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r484008742", "bodyText": "Better don't use 'key' annd 'value' because they are keywords in doris.\nFor example , show resources where name like \"test\" and resourcetype = \"spark\" order by KEY; will report an error", "author": "xy720", "createdAt": "2020-09-06T01:48:21Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -52,7 +55,7 @@\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"Name\").add(\"ResourceType\").add(\"Key\").add(\"Value\")", "originalCommit": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAzOTM0Nw==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r484039347", "bodyText": "Hi,xy720. I keep the older name of the Resource. The key and value is the keyword in doris. The only way to use it is to add operator ` to prevent the error of doris.\nMaybe we should change the name.", "author": "HappenLee", "createdAt": "2020-09-06T08:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAwODc0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "00420ce8e33841430e1b5b710f799567c65b635d", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\nindex 3cc370170..e8aa5d17c 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n\n@@ -55,7 +55,7 @@ public class ResourceMgr implements Writable {\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"NAME\").add(\"RESOURCETYPE\").add(\"KEY\").add(\"VALUE\")\n+            .add(\"Name\").add(\"ResourceType\").add(\"Item\").add(\"Value\")\n             .build();\n \n     // { resourceName -> Resource}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUyNTk0OQ==", "url": "https://github.com/apache/incubator-doris/pull/4502#discussion_r487525949", "bodyText": "Why changing them to uppercase?\nAnd as @xy720 said, better not using KEY, I prefer Item.", "author": "morningman", "createdAt": "2020-09-13T12:50:50Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java", "diffHunk": "@@ -52,7 +55,7 @@\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"Name\").add(\"ResourceType\").add(\"Key\").add(\"Value\")\n+            .add(\"NAME\").add(\"RESOURCETYPE\").add(\"KEY\").add(\"VALUE\")", "originalCommit": "2e2ded6d8f276f437dfc28c79a7475f4508520fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "00420ce8e33841430e1b5b710f799567c65b635d", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\nindex 3cc370170..e8aa5d17c 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/ResourceMgr.java\n\n@@ -55,7 +55,7 @@ public class ResourceMgr implements Writable {\n     private static final Logger LOG = LogManager.getLogger(ResourceMgr.class);\n \n     public static final ImmutableList<String> RESOURCE_PROC_NODE_TITLE_NAMES = new ImmutableList.Builder<String>()\n-            .add(\"NAME\").add(\"RESOURCETYPE\").add(\"KEY\").add(\"VALUE\")\n+            .add(\"Name\").add(\"ResourceType\").add(\"Item\").add(\"Value\")\n             .build();\n \n     // { resourceName -> Resource}\n"}}, {"oid": "00420ce8e33841430e1b5b710f799567c65b635d", "url": "https://github.com/apache/incubator-doris/commit/00420ce8e33841430e1b5b710f799567c65b635d", "message": "change resource title name", "committedDate": "2020-09-13T16:31:53Z", "type": "commit"}]}