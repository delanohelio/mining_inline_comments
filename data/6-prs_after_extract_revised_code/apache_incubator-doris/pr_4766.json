{"pr_number": 4766, "pr_title": " Make some debug log settings configurable and change some log level from info to debug to avoid performance bottlenecks", "pr_createdAt": "2020-10-19T12:10:59Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4766", "timeline": [{"oid": "585c53c3bce16ab57178de2712d2d4579bfe86c5", "url": "https://github.com/apache/incubator-doris/commit/585c53c3bce16ab57178de2712d2d4579bfe86c5", "message": "Make some debug log settings configurable and change some log level from info to debug to escape performance bottlenecks", "committedDate": "2020-10-19T11:45:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxODU5OQ==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509018599", "bodyText": "line 637, 638 LOG.debug can merged.", "author": "chaoyli", "createdAt": "2020-10-21T06:26:45Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -634,7 +634,7 @@ public TFeResult loadCheck(TLoadCheckRequest request) throws TException {\n     @Override\n     public TLoadTxnBeginResult loadTxnBegin(TLoadTxnBeginRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.info(\"receive txn begin request, db: {}, tbl: {}, label: {}, backend: {}\",\n+        LOG.debug(\"receive txn begin request, db: {}, tbl: {}, label: {}, backend: {}\",", "originalCommit": "585c53c3bce16ab57178de2712d2d4579bfe86c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNjAxNA==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509026014", "bodyText": "done", "author": "caiconghui", "createdAt": "2020-10-21T06:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxODU5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\nindex 170a61495..1d2782d10 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n\n@@ -634,9 +634,7 @@ public class FrontendServiceImpl implements FrontendService.Iface {\n     @Override\n     public TLoadTxnBeginResult loadTxnBegin(TLoadTxnBeginRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.debug(\"receive txn begin request, db: {}, tbl: {}, label: {}, backend: {}\",\n-                request.getDb(), request.getTbl(), request.getLabel(), clientAddr);\n-        LOG.debug(\"txn begin request: {}\", request);\n+        LOG.debug(\"receive txn begin request: {}, backend: {}\", request, clientAddr);\n \n         TLoadTxnBeginResult result = new TLoadTxnBeginResult();\n         TStatus status = new TStatus(TStatusCode.OK);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxODczOQ==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509018739", "bodyText": "line 715, 716 can be merged.", "author": "chaoyli", "createdAt": "2020-10-21T06:27:05Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -712,7 +712,7 @@ private long loadTxnBeginImpl(TLoadTxnBeginRequest request, String clientIp) thr\n     @Override\n     public TLoadTxnCommitResult loadTxnCommit(TLoadTxnCommitRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.info(\"receive txn commit request. db: {}, tbl: {}, txn id: {}, backend: {}\",\n+        LOG.debug(\"receive txn commit request. db: {}, tbl: {}, txn id: {}, backend: {}\",", "originalCommit": "585c53c3bce16ab57178de2712d2d4579bfe86c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAyNjA3MA==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509026070", "bodyText": "done", "author": "caiconghui", "createdAt": "2020-10-21T06:43:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxODczOQ=="}], "type": "inlineReview", "revised_code": {"commit": "5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\nindex 170a61495..1d2782d10 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n\n@@ -712,9 +710,7 @@ public class FrontendServiceImpl implements FrontendService.Iface {\n     @Override\n     public TLoadTxnCommitResult loadTxnCommit(TLoadTxnCommitRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.debug(\"receive txn commit request. db: {}, tbl: {}, txn id: {}, backend: {}\",\n-                request.getDb(), request.getTbl(), request.getTxnId(), clientAddr);\n-        LOG.debug(\"txn commit request: {}\", request);\n+        LOG.debug(\"receive txn commit request: {}, backend: {}\", request, clientAddr);\n \n         TLoadTxnCommitResult result = new TLoadTxnCommitResult();\n         TStatus status = new TStatus(TStatusCode.OK);\n"}}, {"oid": "5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "url": "https://github.com/apache/incubator-doris/commit/5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "message": "merge debug log by review", "committedDate": "2020-10-21T06:43:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgzMzMzOA==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509833338", "bodyText": "I am sorry to point here to merge the two logs.", "author": "chaoyli", "createdAt": "2020-10-22T01:55:04Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -778,7 +774,7 @@ private boolean loadTxnCommitImpl(TLoadTxnCommitRequest request) throws UserExce\n     @Override\n     public TLoadTxnRollbackResult loadTxnRollback(TLoadTxnRollbackRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.info(\"receive txn rollback request. db: {}, tbl: {}, txn id: {}, reason: {}, backend: {}\",\n+        LOG.debug(\"receive txn rollback request. db: {}, tbl: {}, txn id: {}, reason: {}, backend: {}\",", "originalCommit": "5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1MzA4NQ==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509853085", "bodyText": "done", "author": "caiconghui", "createdAt": "2020-10-22T03:09:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgzMzMzOA=="}], "type": "inlineReview", "revised_code": {"commit": "4eb90d3f259b6bf2efcc162ded85e364c07661d2", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\nindex 1d2782d10..e29aa96a2 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n\n@@ -774,10 +774,7 @@ public class FrontendServiceImpl implements FrontendService.Iface {\n     @Override\n     public TLoadTxnRollbackResult loadTxnRollback(TLoadTxnRollbackRequest request) throws TException {\n         String clientAddr = getClientAddrAsString();\n-        LOG.debug(\"receive txn rollback request. db: {}, tbl: {}, txn id: {}, reason: {}, backend: {}\",\n-                request.getDb(), request.getTbl(), request.getTxnId(), request.getReason(), clientAddr);\n-        LOG.debug(\"txn rollback request: {}\", request);\n-\n+        LOG.debug(\"receive txn rollback request: {}, backend: {}\", request, clientAddr);\n         TLoadTxnRollbackResult result = new TLoadTxnRollbackResult();\n         TStatus status = new TStatus(TStatusCode.OK);\n         result.setStatus(status);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgzMzM4NQ==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509833385", "bodyText": "The same as the above.", "author": "chaoyli", "createdAt": "2020-10-22T01:55:16Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -827,7 +823,7 @@ private void loadTxnRollbackImpl(TLoadTxnRollbackRequest request) throws UserExc\n     @Override\n     public TStreamLoadPutResult streamLoadPut(TStreamLoadPutRequest request) {\n         String clientAddr = getClientAddrAsString();\n-        LOG.info(\"receive stream load put request. db:{}, tbl: {}, txn id: {}, load id: {}, backend: {}\",\n+        LOG.debug(\"receive stream load put request. db:{}, tbl: {}, txn id: {}, load id: {}, backend: {}\",", "originalCommit": "5c9fe4def6210ccf8ccc9f8c41a14e113cd656ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg1MzA1OA==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r509853058", "bodyText": "done", "author": "caiconghui", "createdAt": "2020-10-22T03:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgzMzM4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "4eb90d3f259b6bf2efcc162ded85e364c07661d2", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\nindex 1d2782d10..e29aa96a2 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java\n\n@@ -823,10 +820,7 @@ public class FrontendServiceImpl implements FrontendService.Iface {\n     @Override\n     public TStreamLoadPutResult streamLoadPut(TStreamLoadPutRequest request) {\n         String clientAddr = getClientAddrAsString();\n-        LOG.debug(\"receive stream load put request. db:{}, tbl: {}, txn id: {}, load id: {}, backend: {}\",\n-                 request.getDb(), request.getTbl(), request.getTxnId(), DebugUtil.printId(request.getLoadId()),\n-                 clientAddr);\n-        LOG.debug(\"stream load put request: {}\", request);\n+        LOG.debug(\"receive stream load put request: {}, backend: {}\", request, clientAddr);\n \n         TStreamLoadPutResult result = new TStreamLoadPutResult();\n         TStatus status = new TStatus(TStatusCode.OK);\n"}}, {"oid": "4eb90d3f259b6bf2efcc162ded85e364c07661d2", "url": "https://github.com/apache/incubator-doris/commit/4eb90d3f259b6bf2efcc162ded85e364c07661d2", "message": "merge debug log by review", "committedDate": "2020-10-22T03:04:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3NTc2MQ==", "url": "https://github.com/apache/incubator-doris/pull/4766#discussion_r510575761", "bodyText": "I think all txn related logs should be info level, not debug.", "author": "kangkaisen", "createdAt": "2020-10-23T03:38:46Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -634,9 +634,7 @@ public TFeResult loadCheck(TLoadCheckRequest request) throws TException {\n     @Override\n     public TLoadTxnBeginResult loadTxnBegin(TLoadTxnBeginRequest request) throws TException {", "originalCommit": "4eb90d3f259b6bf2efcc162ded85e364c07661d2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}