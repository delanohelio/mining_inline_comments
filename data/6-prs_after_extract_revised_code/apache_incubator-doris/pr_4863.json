{"pr_number": 4863, "pr_title": "[New Feature]Support udf  when loading data", "pr_createdAt": "2020-11-07T13:36:43Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4863", "timeline": [{"oid": "1a15f533098eec6708121004ef835d111dc374f3", "url": "https://github.com/apache/incubator-doris/commit/1a15f533098eec6708121004ef835d111dc374f3", "message": "udf: replace function", "committedDate": "2020-08-13T14:09:31Z", "type": "commit"}, {"oid": "7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "url": "https://github.com/apache/incubator-doris/commit/7d072b9a65d555e7e710cb5140435e00a8ff7bdc", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-14T01:37:05Z", "type": "commit"}, {"oid": "391158f52190755b5fc621c31bf703835c0a7b3b", "url": "https://github.com/apache/incubator-doris/commit/391158f52190755b5fc621c31bf703835c0a7b3b", "message": "udf: replace function", "committedDate": "2020-08-14T02:11:25Z", "type": "commit"}, {"oid": "5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "url": "https://github.com/apache/incubator-doris/commit/5eb52e1e5742d2e9f7aae5ac8da81545ae5f3df2", "message": "udf: replace function", "committedDate": "2020-08-14T03:58:30Z", "type": "commit"}, {"oid": "a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "url": "https://github.com/apache/incubator-doris/commit/a79ea91cf36eec54a4ca54018b92a6fa4baa98cc", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-18T02:31:52Z", "type": "commit"}, {"oid": "86f841f29fa4ee19773d6c5922465194a2887cf6", "url": "https://github.com/apache/incubator-doris/commit/86f841f29fa4ee19773d6c5922465194a2887cf6", "message": "udf: replace function", "committedDate": "2020-08-18T03:56:14Z", "type": "commit"}, {"oid": "ade1afa75c94a178a6801ba1324acf25ad8b16fe", "url": "https://github.com/apache/incubator-doris/commit/ade1afa75c94a178a6801ba1324acf25ad8b16fe", "message": "udf: replace function", "committedDate": "2020-08-18T03:59:59Z", "type": "commit"}, {"oid": "1d95a491115064c9753694ad4d45c2f72b8d2645", "url": "https://github.com/apache/incubator-doris/commit/1d95a491115064c9753694ad4d45c2f72b8d2645", "message": "udf: replace function", "committedDate": "2020-08-18T08:01:45Z", "type": "commit"}, {"oid": "433eb87f02cfa6740e80b0e4157d916ab5aca400", "url": "https://github.com/apache/incubator-doris/commit/433eb87f02cfa6740e80b0e4157d916ab5aca400", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-24T02:03:34Z", "type": "commit"}, {"oid": "c62d239792b174fbc56ab311f0bc5337de971d96", "url": "https://github.com/apache/incubator-doris/commit/c62d239792b174fbc56ab311f0bc5337de971d96", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-25T03:17:32Z", "type": "commit"}, {"oid": "0a8db8cc4e7e72ebad4491a2cd48c758a435ba5c", "url": "https://github.com/apache/incubator-doris/commit/0a8db8cc4e7e72ebad4491a2cd48c758a435ba5c", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-08-25T08:21:34Z", "type": "commit"}, {"oid": "02d3f863c8556463c8dea903abdc4d21bf1eb19b", "url": "https://github.com/apache/incubator-doris/commit/02d3f863c8556463c8dea903abdc4d21bf1eb19b", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-01T01:25:42Z", "type": "commit"}, {"oid": "41da0ba0109414c47239f3fb926da48540059018", "url": "https://github.com/apache/incubator-doris/commit/41da0ba0109414c47239f3fb926da48540059018", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-08T08:25:12Z", "type": "commit"}, {"oid": "de4e523b505f0d628a16199b88d4bb5a0419fef6", "url": "https://github.com/apache/incubator-doris/commit/de4e523b505f0d628a16199b88d4bb5a0419fef6", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-11T02:42:20Z", "type": "commit"}, {"oid": "a863b0dfc7f909bf1ca8ad176ef8f82b1346924f", "url": "https://github.com/apache/incubator-doris/commit/a863b0dfc7f909bf1ca8ad176ef8f82b1346924f", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-17T09:37:21Z", "type": "commit"}, {"oid": "024c422b74829efe4c4b715a014517c7eee1a80a", "url": "https://github.com/apache/incubator-doris/commit/024c422b74829efe4c4b715a014517c7eee1a80a", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-22T09:15:31Z", "type": "commit"}, {"oid": "e1656c7a8bdc137261505d8b384dddb1c9bf5a72", "url": "https://github.com/apache/incubator-doris/commit/e1656c7a8bdc137261505d8b384dddb1c9bf5a72", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-23T11:48:49Z", "type": "commit"}, {"oid": "837e037057936e933fd79cbbdb432047be2bba5e", "url": "https://github.com/apache/incubator-doris/commit/837e037057936e933fd79cbbdb432047be2bba5e", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-09-27T06:37:32Z", "type": "commit"}, {"oid": "a36d3e78136a3fefb62f2513d20773479904cb6b", "url": "https://github.com/apache/incubator-doris/commit/a36d3e78136a3fefb62f2513d20773479904cb6b", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-17T10:32:25Z", "type": "commit"}, {"oid": "43cfa2b2ca752118c43a0212cf074f09cb311a7a", "url": "https://github.com/apache/incubator-doris/commit/43cfa2b2ca752118c43a0212cf074f09cb311a7a", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-23T14:34:47Z", "type": "commit"}, {"oid": "641efb587d2e9ac9a9e9771e7648a299a66f3992", "url": "https://github.com/apache/incubator-doris/commit/641efb587d2e9ac9a9e9771e7648a299a66f3992", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-24T12:49:28Z", "type": "commit"}, {"oid": "5066131b9017910473554dfa298b16224c1977da", "url": "https://github.com/apache/incubator-doris/commit/5066131b9017910473554dfa298b16224c1977da", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-26T11:49:19Z", "type": "commit"}, {"oid": "dde044ba251c85b7f0a8a388af71331553208a05", "url": "https://github.com/apache/incubator-doris/commit/dde044ba251c85b7f0a8a388af71331553208a05", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-27T08:38:35Z", "type": "commit"}, {"oid": "8f8c8234c052720bc65e316a305a3297318bd481", "url": "https://github.com/apache/incubator-doris/commit/8f8c8234c052720bc65e316a305a3297318bd481", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-10-28T07:25:25Z", "type": "commit"}, {"oid": "f7704ba989ab5b903e407f7b02c5a9b6c03b4588", "url": "https://github.com/apache/incubator-doris/commit/f7704ba989ab5b903e407f7b02c5a9b6c03b4588", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-11-01T13:04:30Z", "type": "commit"}, {"oid": "8726e7aefed64e62b1bbf6f56278274f11c8b0fa", "url": "https://github.com/apache/incubator-doris/commit/8726e7aefed64e62b1bbf6f56278274f11c8b0fa", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-11-04T09:31:42Z", "type": "commit"}, {"oid": "4dfc785c8a97549fb9c38b6dd8ea938d1bb50db4", "url": "https://github.com/apache/incubator-doris/commit/4dfc785c8a97549fb9c38b6dd8ea938d1bb50db4", "message": "Merge remote-tracking branch 'upstream/master' into str_replace", "committedDate": "2020-11-06T07:45:49Z", "type": "commit"}, {"oid": "51f81969401aa58ea262086cc796e900e68cd62b", "url": "https://github.com/apache/incubator-doris/commit/51f81969401aa58ea262086cc796e900e68cd62b", "message": "support using udf when loading data", "committedDate": "2020-11-07T13:21:59Z", "type": "commit"}, {"oid": "9a3ae2df22d9a0782515c4b8a69a4d70b89d1f24", "url": "https://github.com/apache/incubator-doris/commit/9a3ae2df22d9a0782515c4b8a69a4d70b89d1f24", "message": "update", "committedDate": "2020-11-08T12:38:55Z", "type": "commit"}, {"oid": "6db8e749dbdf3fc619127ae083d4679dfa61420f", "url": "https://github.com/apache/incubator-doris/commit/6db8e749dbdf3fc619127ae083d4679dfa61420f", "message": "support udf when loading data", "committedDate": "2020-11-09T11:40:47Z", "type": "commit"}, {"oid": "0f008491c48795f84ca50817f5af7c4016b1f611", "url": "https://github.com/apache/incubator-doris/commit/0f008491c48795f84ca50817f5af7c4016b1f611", "message": "support udf when loading data", "committedDate": "2020-11-09T11:44:11Z", "type": "commit"}, {"oid": "080a9142b864fd8d0c00d3d1baf6f1a44862de53", "url": "https://github.com/apache/incubator-doris/commit/080a9142b864fd8d0c00d3d1baf6f1a44862de53", "message": "support udf when loading data", "committedDate": "2020-11-09T11:47:15Z", "type": "commit"}, {"oid": "07fa6e2c3673d2d39eebaedf7c6b57b5371cc9ad", "url": "https://github.com/apache/incubator-doris/commit/07fa6e2c3673d2d39eebaedf7c6b57b5371cc9ad", "message": "Merge remote-tracking branch 'upstream/master' into support_udf_load", "committedDate": "2020-11-09T11:48:04Z", "type": "commit"}, {"oid": "eabea85532c6a021b97d770d0a7ee33cb7df3350", "url": "https://github.com/apache/incubator-doris/commit/eabea85532c6a021b97d770d0a7ee33cb7df3350", "message": "support udf when loading data", "committedDate": "2020-11-09T11:50:08Z", "type": "commit"}, {"oid": "134b0365750cbe64a26baabd28b7e103cf52c8c9", "url": "https://github.com/apache/incubator-doris/commit/134b0365750cbe64a26baabd28b7e103cf52c8c9", "message": "update", "committedDate": "2020-11-10T09:27:55Z", "type": "commit"}, {"oid": "74c37133c9007afa2a3d4af8130c63a633a43469", "url": "https://github.com/apache/incubator-doris/commit/74c37133c9007afa2a3d4af8130c63a633a43469", "message": "support udf", "committedDate": "2020-11-10T09:59:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY3MDgxNw==", "url": "https://github.com/apache/incubator-doris/pull/4863#discussion_r520670817", "bodyText": "Modify the read() function, you have to update the meta version in FeMetaVersion.java", "author": "morningman", "createdAt": "2020-11-10T15:53:19Z", "path": "fe/fe-core/src/main/java/org/apache/doris/load/loadv2/BulkLoadJob.java", "diffHunk": "@@ -324,7 +329,7 @@ public void readFields(DataInput in) throws IOException {\n         // The origin stmt does not be analyzed in here.\n         // The reason is that it will thrown MetaNotFoundException when the tableId could not be found by tableName.\n         // The origin stmt will be analyzed after the replay is completed.\n-\n+        userInfo = UserIdentity.read(in);", "originalCommit": "74c37133c9007afa2a3d4af8130c63a633a43469", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkzNTAyNg==", "url": "https://github.com/apache/incubator-doris/pull/4863#discussion_r521935026", "bodyText": "Modify the read() function, you have to update the meta version in FeMetaVersion.java\n\ndone", "author": "xinghuayu007", "createdAt": "2020-11-12T08:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY3MDgxNw=="}], "type": "inlineReview", "revised_code": {"commit": "e3d94f4ddfe1dba02372483a4666c482d4c79b2a", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/load/loadv2/BulkLoadJob.java b/fe/fe-core/src/main/java/org/apache/doris/load/loadv2/BulkLoadJob.java\nindex b8ee0cf57..d9edca1b6 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/load/loadv2/BulkLoadJob.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/load/loadv2/BulkLoadJob.java\n\n@@ -329,7 +329,12 @@ public abstract class BulkLoadJob extends LoadJob {\n         // The origin stmt does not be analyzed in here.\n         // The reason is that it will thrown MetaNotFoundException when the tableId could not be found by tableName.\n         // The origin stmt will be analyzed after the replay is completed.\n-        userInfo = UserIdentity.read(in);\n+\n+        if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_93) {\n+            userInfo = UserIdentity.read(in);\n+        } else {\n+            userInfo = new UserIdentity(\"\",\"\");\n+        }\n         if (Catalog.getCurrentCatalogJournalVersion() >= FeMetaVersion.VERSION_66) {\n             int size = in.readInt();\n             for (int i = 0; i < size; i++) {\n"}}, {"oid": "e3d94f4ddfe1dba02372483a4666c482d4c79b2a", "url": "https://github.com/apache/incubator-doris/commit/e3d94f4ddfe1dba02372483a4666c482d4c79b2a", "message": "update", "committedDate": "2020-11-11T06:05:37Z", "type": "commit"}]}