{"pr_number": 3755, "pr_title": "[Plugin] Add timeout of connection when downloading the plugins from URL", "pr_createdAt": "2020-06-03T04:19:33Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3755", "timeline": [{"oid": "377ccac1ee6dbb45d6df83c2a6c9c8dee97c038a", "url": "https://github.com/apache/incubator-doris/commit/377ccac1ee6dbb45d6df83c2a6c9c8dee97c038a", "message": "[Plugin] Add timeout of connection when downloading the plugins from HTTP.\n\nIf no timeout is set, the download process may be blocked forever.", "committedDate": "2020-06-03T03:27:31Z", "type": "commit"}, {"oid": "2865eae2c03ee77126338e863270e192bb10f7e8", "url": "https://github.com/apache/incubator-doris/commit/2865eae2c03ee77126338e863270e192bb10f7e8", "message": "fix ut", "committedDate": "2020-06-03T04:06:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMwNTEzOQ==", "url": "https://github.com/apache/incubator-doris/pull/3755#discussion_r434305139", "bodyText": "Should be static const value.\nIf the timeout isn't a config, I think set a larger value maybe better when the plugin resource is big and network is poor.", "author": "kangkaisen", "createdAt": "2020-06-03T04:46:48Z", "path": "fe/src/main/java/org/apache/doris/plugin/PluginZip.java", "diffHunk": "@@ -113,13 +113,13 @@ Path downloadRemoteZip(Path targetPath) throws IOException, UserException {\n         cleanPathList.add(zip);\n \n         // download zip\n-        try (InputStream in = openUrlInputStream(source)) {\n+        try (InputStream in = Util.getInputStreamFromUrl(source, null, 5000, 5000)) {", "originalCommit": "2865eae2c03ee77126338e863270e192bb10f7e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyNTMyNA==", "url": "https://github.com/apache/incubator-doris/pull/3755#discussion_r434325324", "bodyText": "I change it to a config", "author": "morningman", "createdAt": "2020-06-03T05:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMwNTEzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "7f7b4217d78444b9d785d0eb51141db607ea2c79", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/plugin/PluginZip.java b/fe/src/main/java/org/apache/doris/plugin/PluginZip.java\nindex ccc65ab45..e8e52410e 100644\n--- a/fe/src/main/java/org/apache/doris/plugin/PluginZip.java\n+++ b/fe/src/main/java/org/apache/doris/plugin/PluginZip.java\n\n@@ -113,13 +116,13 @@ class PluginZip {\n         cleanPathList.add(zip);\n \n         // download zip\n-        try (InputStream in = Util.getInputStreamFromUrl(source, null, 5000, 5000)) {\n+        try (InputStream in = Util.getInputStreamFromUrl(source, null, HTTP_TIMEOUT_MS, HTTP_TIMEOUT_MS)) {\n             Files.copy(in, zip, StandardCopyOption.REPLACE_EXISTING);\n         }\n \n         // .md5 check\n         String expectedChecksum;\n-        try (InputStream in = Util.getInputStreamFromUrl(source + \".md5\", null, 5000, 5000)) {\n+        try (InputStream in = Util.getInputStreamFromUrl(source + \".md5\", null, HTTP_TIMEOUT_MS, HTTP_TIMEOUT_MS)) {\n             BufferedReader br = new BufferedReader(new InputStreamReader(in));\n             expectedChecksum = br.readLine();\n         } catch (IOException e) {\n"}}, {"oid": "7f7b4217d78444b9d785d0eb51141db607ea2c79", "url": "https://github.com/apache/incubator-doris/commit/7f7b4217d78444b9d785d0eb51141db607ea2c79", "message": "fix by review", "committedDate": "2020-06-03T06:03:51Z", "type": "commit"}, {"oid": "ceef7335c5303239279c9823c2c158d2e5cb51ab", "url": "https://github.com/apache/incubator-doris/commit/ceef7335c5303239279c9823c2c158d2e5cb51ab", "message": "fix ut", "committedDate": "2020-06-03T15:47:12Z", "type": "commit"}]}