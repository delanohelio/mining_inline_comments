{"pr_number": 3216, "pr_title": "fix 'Filesystem closed' in broker load", "pr_createdAt": "2020-03-27T10:12:16Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3216", "timeline": [{"oid": "b1f5782b53bc7aedf266b5f0a18ffd09b6800462", "url": "https://github.com/apache/incubator-doris/commit/b1f5782b53bc7aedf266b5f0a18ffd09b6800462", "message": "fix 'Filesystem closed' in broker load", "committedDate": "2020-03-27T09:05:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTg1Ng==", "url": "https://github.com/apache/incubator-doris/pull/3216#discussion_r399165856", "bodyText": "Please use constant value. Add add a comment to explain why need this config.", "author": "kangkaisen", "createdAt": "2020-03-27T10:23:52Z", "path": "fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java", "diffHunk": "@@ -383,6 +384,7 @@ public BrokerFileSystem getS3AFileSystem(String path, Map<String, String> proper\n                 conf.set(FS_S3A_ACCESS_KEY, accessKey);\n                 conf.set(FS_S3A_SECRET_KEY, secretKey);\n                 conf.set(FS_S3A_ENDPOINT, endpoint);\n+                conf.set(\"fs.s3a.impl.disable.cache\", \"true\");", "originalCommit": "b1f5782b53bc7aedf266b5f0a18ffd09b6800462", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4OTc3Mw==", "url": "https://github.com/apache/incubator-doris/pull/3216#discussion_r399189773", "bodyText": "If this property is not set to \"true\", FileSystem instance will be returned from cache which is not thread-safe and may cause 'Filesystem closed' exception when it is closed by other thread.", "author": "frwrdt", "createdAt": "2020-03-27T11:09:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTg1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5MDgzNQ==", "url": "https://github.com/apache/incubator-doris/pull/3216#discussion_r399190835", "bodyText": "@frwrdt\nYou should add this comment in the source file to let others known not just the reviewer.", "author": "imay", "createdAt": "2020-03-27T11:11:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTg1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMDkwNA==", "url": "https://github.com/apache/incubator-doris/pull/3216#discussion_r399200904", "bodyText": "ok", "author": "frwrdt", "createdAt": "2020-03-27T11:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTg1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "4dea2d0bf91ec7eb56ca0db4abda21cb48c4c3c1", "chunk": "diff --git a/fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java b/fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java\nindex aac69c604..e468a29d9 100644\n--- a/fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java\n+++ b/fs_brokers/apache_hdfs_broker/src/main/java/org/apache/doris/broker/hdfs/FileSystemManager.java\n\n@@ -384,7 +386,7 @@ public class FileSystemManager {\n                 conf.set(FS_S3A_ACCESS_KEY, accessKey);\n                 conf.set(FS_S3A_SECRET_KEY, secretKey);\n                 conf.set(FS_S3A_ENDPOINT, endpoint);\n-                conf.set(\"fs.s3a.impl.disable.cache\", \"true\");\n+                conf.set(FS_S3A_IMPL_DISABLE_CACHE, \"true\");\n                 FileSystem s3AFileSystem = FileSystem.get(pathUri.getUri(), conf);\n                 fileSystem.setFileSystem(s3AFileSystem);\n             }\n"}}, {"oid": "4dea2d0bf91ec7eb56ca0db4abda21cb48c4c3c1", "url": "https://github.com/apache/incubator-doris/commit/4dea2d0bf91ec7eb56ca0db4abda21cb48c4c3c1", "message": "conf properties use constant value", "committedDate": "2020-03-27T10:59:50Z", "type": "commit"}, {"oid": "00d8f20c5b521fdea650a14082fded89cf293992", "url": "https://github.com/apache/incubator-doris/commit/00d8f20c5b521fdea650a14082fded89cf293992", "message": "add comment", "committedDate": "2020-03-27T11:17:34Z", "type": "commit"}]}