{"pr_number": 4582, "pr_title": "[Feature] Support alter table syntax for sequence column ", "pr_createdAt": "2020-09-10T10:03:49Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4582", "timeline": [{"oid": "e93c3afadad05fa16ae42de0097facf425971370", "url": "https://github.com/apache/incubator-doris/commit/e93c3afadad05fa16ae42de0097facf425971370", "message": "enable sequence col", "committedDate": "2020-09-10T02:17:10Z", "type": "commit"}, {"oid": "0fca435eff2b2b3c87c95ef633d539f6dcd5d589", "url": "https://github.com/apache/incubator-doris/commit/0fca435eff2b2b3c87c95ef633d539f6dcd5d589", "message": "fix for materialized view", "committedDate": "2020-09-10T05:10:48Z", "type": "commit"}, {"oid": "4891534a9607a72c579ca451dc7644f1136a8d7a", "url": "https://github.com/apache/incubator-doris/commit/4891534a9607a72c579ca451dc7644f1136a8d7a", "message": "add some test", "committedDate": "2020-09-10T07:52:27Z", "type": "commit"}, {"oid": "98a646e6c6bddc6c2c2d344142424cffe714cf9d", "url": "https://github.com/apache/incubator-doris/commit/98a646e6c6bddc6c2c2d344142424cffe714cf9d", "message": "remove unuse", "committedDate": "2020-09-10T09:27:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNzI3Mg==", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486237272", "bodyText": "I think SEQUENCE_LOAD is better", "author": "yangzhg", "createdAt": "2020-09-10T10:37:15Z", "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java", "diffHunk": "@@ -21,25 +21,35 @@\n import org.apache.doris.common.AnalysisException;\n import org.apache.doris.common.UserException;\n \n+import org.apache.doris.common.util.PrintableMap;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n \n+import java.util.Map;\n+\n public class EnableFeatureClause extends AlterTableClause {\n     private static final Logger LOG = LogManager.getLogger(EnableFeatureClause.class);\n \n     public enum Features {\n         BATCH_DELETE,\n+        SEQUENCE_COLUMN,", "originalCommit": "98a646e6c6bddc6c2c2d344142424cffe714cf9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjQ0NDcxMQ==", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486444711", "bodyText": "Done", "author": "Youngwb", "createdAt": "2020-09-10T15:41:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzNzI3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8214cd739c101124e8bf03a5baa27bd03252daf7", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java b/fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java\nindex 6adbe0a6c..b145af560 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/analysis/EnableFeatureClause.java\n\n@@ -32,7 +32,7 @@ public class EnableFeatureClause extends AlterTableClause {\n \n     public enum Features {\n         BATCH_DELETE,\n-        SEQUENCE_COLUMN,\n+        SEQUENCE_LOAD,\n         UNKNOWN\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODg3Mg==", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486238872", "bodyText": "batch delete only  support UNIQUE_KEYS but other may support all tables", "author": "yangzhg", "createdAt": "2020-09-10T10:40:29Z", "path": "fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java", "diffHunk": "@@ -79,11 +82,28 @@ public void analyze(Analyzer analyzer) throws UserException {\n     public void rewriteAlterClause(OlapTable table) throws UserException {\n         List<AlterClause> clauses = new ArrayList<>();\n         for (AlterClause alterClause : ops) {\n-            if (alterClause instanceof EnableFeatureClause\n-                    && ((EnableFeatureClause) alterClause).getFeature() == EnableFeatureClause.Features.BATCH_DELETE) {\n+            if (alterClause instanceof EnableFeatureClause) {\n+                EnableFeatureClause.Features alterFeature  = ((EnableFeatureClause) alterClause).getFeature();\n+                if (alterFeature == null || alterFeature == EnableFeatureClause.Features.UNKNOWN) {\n+                    throw new AnalysisException(\"unknown feature for alter clause\");\n+                }\n                 if (table.getKeysType() != KeysType.UNIQUE_KEYS) {\n-                    throw new AnalysisException(\"Batch delete only supported in unique tables.\");\n+                    throw new AnalysisException(\"enable feature only supported in unique tables now.\");", "originalCommit": "98a646e6c6bddc6c2c2d344142424cffe714cf9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI0NzY5NQ==", "url": "https://github.com/apache/incubator-doris/pull/4582#discussion_r486247695", "bodyText": "sequence column also only support UNIQUE_KEYS, and I add \"now\" in the exception for current  implementation, i think if we have feature for other tables in the future, we can change this check", "author": "Youngwb", "createdAt": "2020-09-10T10:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzODg3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8214cd739c101124e8bf03a5baa27bd03252daf7", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java b/fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java\nindex 0187a58db..0706a3ecd 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/analysis/AlterTableStmt.java\n\n@@ -92,7 +92,7 @@ public class AlterTableStmt extends DdlStmt {\n                 }\n                 // analyse sequence column\n                 Type sequenceColType = null;\n-                if (alterFeature == EnableFeatureClause.Features.SEQUENCE_COLUMN) {\n+                if (alterFeature == EnableFeatureClause.Features.SEQUENCE_LOAD) {\n                     Map<String, String> propertyMap = alterClause.getProperties();\n                     try {\n                         sequenceColType = PropertyAnalyzer.analyzeSequenceType(propertyMap, table.getKeysType());\n"}}, {"oid": "8214cd739c101124e8bf03a5baa27bd03252daf7", "url": "https://github.com/apache/incubator-doris/commit/8214cd739c101124e8bf03a5baa27bd03252daf7", "message": "fix by comment", "committedDate": "2020-09-10T13:35:00Z", "type": "commit"}, {"oid": "afdb402561c2923e5f158ca167ed7453588f055f", "url": "https://github.com/apache/incubator-doris/commit/afdb402561c2923e5f158ca167ed7453588f055f", "message": "fix by comment", "committedDate": "2020-09-11T09:48:08Z", "type": "commit"}, {"oid": "404ca600718bdf00a1806e0cb8bc1ec269ee191b", "url": "https://github.com/apache/incubator-doris/commit/404ca600718bdf00a1806e0cb8bc1ec269ee191b", "message": "add doc", "committedDate": "2020-09-12T08:35:31Z", "type": "commit"}]}