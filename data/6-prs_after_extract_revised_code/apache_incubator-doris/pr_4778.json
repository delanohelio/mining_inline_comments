{"pr_number": 4778, "pr_title": "Error happened when open a view in DBeaver", "pr_createdAt": "2020-10-22T07:57:43Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4778", "timeline": [{"oid": "bfaf1b684a3c8649d74f9a5e38935dc2c1266d18", "url": "https://github.com/apache/incubator-doris/commit/bfaf1b684a3c8649d74f9a5e38935dc2c1266d18", "message": "Error happened when open a view in DBeaver", "committedDate": "2020-10-22T07:27:17Z", "type": "commit"}, {"oid": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "url": "https://github.com/apache/incubator-doris/commit/bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-22T08:00:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE3MTYxMQ==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r510171611", "bodyText": "Add comment for this new field", "author": "morningman", "createdAt": "2020-10-22T13:42:29Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java", "diffHunk": "@@ -95,6 +95,8 @@\n     // table(view)'s comment\n     protected String comment = \"\";\n \n+    protected String ddlSql = \"\";", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c58f31bfa130c6a9ebb2ca0c85fa85fc2d4174e7", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java\nindex fa2cbc951..cda8491d3 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/Table.java\n\n@@ -94,7 +94,7 @@ public class Table extends MetaObject implements Writable {\n     protected boolean isTypeRead = false;\n     // table(view)'s comment\n     protected String comment = \"\";\n-\n+    // sql for creating this table, default is \"\";\n     protected String ddlSql = \"\";\n \n     public Table(TableType type) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTE2Mg==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511699162", "bodyText": "why this column length is 77, you should add a comment, this column in mysql is 288", "author": "yangzhg", "createdAt": "2020-10-26T03:09:13Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java", "diffHunk": "@@ -281,6 +281,23 @@ public static Builder builder() {\n                                                  .column(\"XA\", ScalarType.createVarchar(3))\n                                                  .column(\"SAVEPOINTS\", ScalarType.createVarchar(3))\n                                                  .build()))\n+                    .put(\"views\",\n+                        new SchemaTable(\n+                                SystemIdGenerator.getNextId(),\n+                                \"views\",\n+                                TableType.SCHEMA,\n+                                builder()\n+                                        .column(\"TABLE_CATALOG\", ScalarType.createVarchar(512))\n+                                        .column(\"TABLE_SCHEMA\", ScalarType.createVarchar(64))\n+                                        .column(\"TABLE_NAME\", ScalarType.createVarchar(64))\n+                                        .column(\"VIEW_DEFINITION\", ScalarType.createVarchar(8096))\n+                                        .column(\"CHECK_OPTION\", ScalarType.createVarchar(8))\n+                                        .column(\"IS_UPDATABLE\", ScalarType.createVarchar(3))\n+                                        .column(\"DEFINER\", ScalarType.createVarchar(77))\n+                                        .column(\"SECURITY_TYPE\", ScalarType.createVarchar(7))", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxMTExOA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512511118", "bodyText": "Maybe you get another version of mysql. the sql I got is like this.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTE2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "79be4f098fbffb793193aac8246cedd48cff56bf", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\nindex 0ffe3d11f..97ec5be31 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\n\n@@ -299,6 +299,7 @@ public class SchemaTable extends Table {\n                                         .column(\"COLLATION_CONNECTION\", ScalarType.createVarchar(32))\n                                         .build()))\n                     .build();\n+    // views column is from show create table views in mysql: 5.5.6\n \n     public static class Builder {\n         List<Column> columns;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTIxOA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511699218", "bodyText": "why 32", "author": "yangzhg", "createdAt": "2020-10-26T03:09:25Z", "path": "fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java", "diffHunk": "@@ -281,6 +281,23 @@ public static Builder builder() {\n                                                  .column(\"XA\", ScalarType.createVarchar(3))\n                                                  .column(\"SAVEPOINTS\", ScalarType.createVarchar(3))\n                                                  .build()))\n+                    .put(\"views\",\n+                        new SchemaTable(\n+                                SystemIdGenerator.getNextId(),\n+                                \"views\",\n+                                TableType.SCHEMA,\n+                                builder()\n+                                        .column(\"TABLE_CATALOG\", ScalarType.createVarchar(512))\n+                                        .column(\"TABLE_SCHEMA\", ScalarType.createVarchar(64))\n+                                        .column(\"TABLE_NAME\", ScalarType.createVarchar(64))\n+                                        .column(\"VIEW_DEFINITION\", ScalarType.createVarchar(8096))\n+                                        .column(\"CHECK_OPTION\", ScalarType.createVarchar(8))\n+                                        .column(\"IS_UPDATABLE\", ScalarType.createVarchar(3))\n+                                        .column(\"DEFINER\", ScalarType.createVarchar(77))\n+                                        .column(\"SECURITY_TYPE\", ScalarType.createVarchar(7))\n+                                        .column(\"CHARACTER_SET_CLIENT\", ScalarType.createVarchar(32))\n+                                        .column(\"COLLATION_CONNECTION\", ScalarType.createVarchar(32))", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxMTM0OA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512511348", "bodyText": "the sql I got is like this.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTY5OTIxOA=="}], "type": "inlineReview", "revised_code": {"commit": "79be4f098fbffb793193aac8246cedd48cff56bf", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java b/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\nindex 0ffe3d11f..97ec5be31 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/catalog/SchemaTable.java\n\n@@ -299,6 +299,7 @@ public class SchemaTable extends Table {\n                                         .column(\"COLLATION_CONNECTION\", ScalarType.createVarchar(32))\n                                         .build()))\n                     .build();\n+    // views column is from show create table views in mysql: 5.5.6\n \n     public static class Builder {\n         List<Column> columns;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcwMDU1NA==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r511700554", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            }\n          \n          \n            \n                           List<Table> tables = db.getTables();\n          \n          \n            \n                            if (params.isSetType() && \"VIEW\".equals(params.getType())) {\n          \n          \n            \n                                tables = db. getViews();\n          \n          \n            \n                            }", "author": "yangzhg", "createdAt": "2020-10-26T03:16:09Z", "path": "fe/fe-core/src/main/java/org/apache/doris/service/FrontendServiceImpl.java", "diffHunk": "@@ -248,7 +248,19 @@ public TListTableStatusResult listTableStatus(TGetTablesParams params) throws TE\n         if (db != null) {\n             db.readLock();\n             try {\n-                for (Table table : db.getTables()) {\n+                List<Table> tables = null;\n+                if (!params.isSetType() || params.getType() == null || params.getType().isEmpty()) {\n+                    tables = db.getTables();\n+                } else {\n+                    switch (params.getType()) {\n+                        case \"VIEW\":\n+                            tables = db.getViews();\n+                            break;\n+                        default:\n+                            tables = db.getTables();\n+                    }\n+                }", "originalCommit": "bff46c5e55d6117b1e4c27a3abd74d3d42548a3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUxNDQyMg==", "url": "https://github.com/apache/incubator-doris/pull/4778#discussion_r512514422", "bodyText": "If type is view, this will call getTables() which is not required. When the count of tables in this db is too many, this will take more time.", "author": "pengxiangyu", "createdAt": "2020-10-27T08:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTcwMDU1NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c58f31bfa130c6a9ebb2ca0c85fa85fc2d4174e7", "url": "https://github.com/apache/incubator-doris/commit/c58f31bfa130c6a9ebb2ca0c85fa85fc2d4174e7", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-27T09:08:43Z", "type": "commit"}, {"oid": "79be4f098fbffb793193aac8246cedd48cff56bf", "url": "https://github.com/apache/incubator-doris/commit/79be4f098fbffb793193aac8246cedd48cff56bf", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-27T09:18:41Z", "type": "commit"}, {"oid": "59066ea666b95e753bd92869a5ea361e9c65c916", "url": "https://github.com/apache/incubator-doris/commit/59066ea666b95e753bd92869a5ea361e9c65c916", "message": "Fix bug: Error happened when open a view in DBeaver", "committedDate": "2020-10-29T02:14:11Z", "type": "commit"}]}