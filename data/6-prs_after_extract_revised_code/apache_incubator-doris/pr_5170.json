{"pr_number": 5170, "pr_title": "For #5169 Add publish timout param when exec insert", "pr_createdAt": "2020-12-29T10:51:46Z", "pr_url": "https://github.com/apache/incubator-doris/pull/5170", "timeline": [{"oid": "5a082e87fe655d0a3eb9c744e39e6064f35d11e1", "url": "https://github.com/apache/incubator-doris/commit/5a082e87fe655d0a3eb9c744e39e6064f35d11e1", "message": "For #5169 Add publish timout param when exec insert", "committedDate": "2020-12-29T10:52:26Z", "type": "forcePushed"}, {"oid": "0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "url": "https://github.com/apache/incubator-doris/commit/0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "message": "For #5169 Add publish timout param when exec insert", "committedDate": "2020-12-29T15:53:47Z", "type": "commit"}, {"oid": "0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "url": "https://github.com/apache/incubator-doris/commit/0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "message": "For #5169 Add publish timout param when exec insert", "committedDate": "2020-12-29T15:53:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk3MzQwMg==", "url": "https://github.com/apache/incubator-doris/pull/5170#discussion_r550973402", "bodyText": "If we use session variable, there is no need to add this config.\nI think session variable is enough.", "author": "morningman", "createdAt": "2021-01-03T08:21:23Z", "path": "fe/fe-core/src/main/java/org/apache/doris/common/Config.java", "diffHunk": "@@ -1311,4 +1311,9 @@\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean enable_fe_heartbeat_by_thrift = false;\n+\n+    /**\n+     * default value for insert_visible_timeout_ms\n+     */\n+    public static long default_insert_visible_timeout_ms = 10000;", "originalCommit": "0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5f047f946f5621e6c0a692fdd966f1f05e282b4", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/common/Config.java b/fe/fe-core/src/main/java/org/apache/doris/common/Config.java\nindex 4409089e5..c3ba37afa 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/common/Config.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/common/Config.java\n\n@@ -1311,9 +1311,4 @@ public class Config extends ConfigBase {\n      */\n     @ConfField(mutable = true, masterOnly = true)\n     public static boolean enable_fe_heartbeat_by_thrift = false;\n-\n-    /**\n-     * default value for insert_visible_timeout_ms\n-     */\n-    public static long default_insert_visible_timeout_ms = 10000;\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk3MzQzNQ==", "url": "https://github.com/apache/incubator-doris/pull/5170#discussion_r550973435", "bodyText": "Set default to 10000, and the config is not used any more.", "author": "morningman", "createdAt": "2021-01-03T08:21:45Z", "path": "fe/fe-core/src/main/java/org/apache/doris/qe/SessionVariable.java", "diffHunk": "@@ -112,6 +112,12 @@\n     // when true, the partition column must be set to NOT NULL.\n     public static final String ALLOW_PARTITION_COLUMN_NULLABLE = \"allow_partition_column_nullable\";\n \n+    // max ms to wait transaction publish finish when exec insert stmt.\n+    public static final String INSERT_VISIBLE_TIMEOUT_MS = \"insert_visible_timeout_ms\";\n+\n+    @VariableMgr.VarAttr(name = INSERT_VISIBLE_TIMEOUT_MS)\n+    private long insertVisibleTimeoutMs = -1;", "originalCommit": "0f78cfac6d67974ae9a8c4e16aa7ca682d1c92d0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b5f047f946f5621e6c0a692fdd966f1f05e282b4", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/qe/SessionVariable.java b/fe/fe-core/src/main/java/org/apache/doris/qe/SessionVariable.java\nindex fb33aef0b..885c543ed 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/qe/SessionVariable.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/qe/SessionVariable.java\n\n@@ -114,9 +114,11 @@ public class SessionVariable implements Serializable, Writable {\n \n     // max ms to wait transaction publish finish when exec insert stmt.\n     public static final String INSERT_VISIBLE_TIMEOUT_MS = \"insert_visible_timeout_ms\";\n+    public static final long DEFAULT_INSERT_VISIBLE_TIMEOUT_MS = 10_000;\n+    public static final long MIN_INSERT_VISIBLE_TIMEOUT_MS = 1000; // If user set a very small value, use this value instead.\n \n     @VariableMgr.VarAttr(name = INSERT_VISIBLE_TIMEOUT_MS)\n-    private long insertVisibleTimeoutMs = -1;\n+    private long insertVisibleTimeoutMs = DEFAULT_INSERT_VISIBLE_TIMEOUT_MS;\n \n     // max memory used on every backend.\n     @VariableMgr.VarAttr(name = EXEC_MEM_LIMIT)\n"}}, {"oid": "b5f047f946f5621e6c0a692fdd966f1f05e282b4", "url": "https://github.com/apache/incubator-doris/commit/b5f047f946f5621e6c0a692fdd966f1f05e282b4", "message": "Remove default insert visible timeout in Config & add min insert visible timeout", "committedDate": "2021-01-07T10:47:20Z", "type": "commit"}, {"oid": "f09339912bd5177b6f33ccb9a2f5460cbaa81da5", "url": "https://github.com/apache/incubator-doris/commit/f09339912bd5177b6f33ccb9a2f5460cbaa81da5", "message": "Add insert_visible_timeout_ms to doc.", "committedDate": "2021-01-07T11:11:39Z", "type": "commit"}]}