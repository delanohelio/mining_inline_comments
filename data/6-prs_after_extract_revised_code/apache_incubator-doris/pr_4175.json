{"pr_number": 4175, "pr_title": "[Bug][UpdateDataQuota] Skip update used data quota for information_schema db and fix bug for wrong time interval for  UpdateDbUsedDataQuotaDaemon", "pr_createdAt": "2020-07-24T07:58:23Z", "pr_url": "https://github.com/apache/incubator-doris/pull/4175", "timeline": [{"oid": "f103898b3a67c8aa4be2b1c432f363c5a8a4fdbf", "url": "https://github.com/apache/incubator-doris/commit/f103898b3a67c8aa4be2b1c432f363c5a8a4fdbf", "message": "Skip check for information_schema db and fix bug for wrong time interval", "committedDate": "2020-07-24T07:38:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA1MjYyMA==", "url": "https://github.com/apache/incubator-doris/pull/4175#discussion_r460052620", "bodyText": "Not sure about it, better to judge it by db.isInfoSchemaDb();", "author": "morningman", "createdAt": "2020-07-24T13:30:05Z", "path": "fe/fe-core/src/main/java/org/apache/doris/transaction/UpdateDbUsedDataQuotaDaemon.java", "diffHunk": "@@ -44,6 +44,10 @@ private void updateAllDatabaseUsedDataQuota() {\n         List<Long> dbIdList = catalog.getDbIds();\n         GlobalTransactionMgr globalTransactionMgr = catalog.getGlobalTransactionMgr();\n         for (Long dbId : dbIdList) {\n+            if (dbId == 0) {", "originalCommit": "f103898b3a67c8aa4be2b1c432f363c5a8a4fdbf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA2NTYwOQ==", "url": "https://github.com/apache/incubator-doris/pull/4175#discussion_r460065609", "bodyText": "ok", "author": "caiconghui", "createdAt": "2020-07-24T13:52:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA1MjYyMA=="}], "type": "inlineReview", "revised_code": {"commit": "75621ae64131ad4a1295a165441214528ad5edc6", "chunk": "diff --git a/fe/fe-core/src/main/java/org/apache/doris/transaction/UpdateDbUsedDataQuotaDaemon.java b/fe/fe-core/src/main/java/org/apache/doris/transaction/UpdateDbUsedDataQuotaDaemon.java\nindex 673fb3f17..ffe073df8 100644\n--- a/fe/fe-core/src/main/java/org/apache/doris/transaction/UpdateDbUsedDataQuotaDaemon.java\n+++ b/fe/fe-core/src/main/java/org/apache/doris/transaction/UpdateDbUsedDataQuotaDaemon.java\n\n@@ -44,15 +44,14 @@ public class UpdateDbUsedDataQuotaDaemon extends MasterDaemon {\n         List<Long> dbIdList = catalog.getDbIds();\n         GlobalTransactionMgr globalTransactionMgr = catalog.getGlobalTransactionMgr();\n         for (Long dbId : dbIdList) {\n-            if (dbId == 0) {\n-                // skip information_schema db\n-                continue;\n-            }\n             Database db = catalog.getDb(dbId);\n             if (db == null) {\n                 LOG.warn(\"Database [\" + dbId + \"] doese not exist, skip to update database used data quota\");\n                 continue;\n             }\n+            if (db.isInfoSchemaDb()) {\n+                continue;\n+            }\n             try {\n                 long usedDataQuotaBytes = db.getUsedDataQuotaWithLock();\n                 globalTransactionMgr.updateDatabaseUsedQuotaData(dbId, usedDataQuotaBytes);\n"}}, {"oid": "75621ae64131ad4a1295a165441214528ad5edc6", "url": "https://github.com/apache/incubator-doris/commit/75621ae64131ad4a1295a165441214528ad5edc6", "message": "fix skip information_shema db", "committedDate": "2020-07-24T13:31:52Z", "type": "commit"}]}