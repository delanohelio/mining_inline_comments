{"pr_number": 3336, "pr_title": "fix cooldown timestamp bug", "pr_createdAt": "2020-04-16T09:28:40Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3336", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTU2MDUzMg==", "url": "https://github.com/apache/incubator-doris/pull/3336#discussion_r409560532", "bodyText": "Please add a UT for this bug", "author": "kangkaisen", "createdAt": "2020-04-16T13:35:50Z", "path": "fe/src/main/java/org/apache/doris/common/util/PropertyAnalyzer.java", "diffHunk": "@@ -110,7 +110,7 @@ public static DataProperty analyzeDataProperty(Map<String, String> properties, D\n             } else if (!hasCooldown && key.equalsIgnoreCase(PROPERTIES_STORAGE_COLDOWN_TIME)) {\n                 hasCooldown = true;\n                 DateLiteral dateLiteral = new DateLiteral(value, Type.DATETIME);\n-                coolDownTimeStamp = dateLiteral.getLongValue();\n+                coolDownTimeStamp = dateLiteral.unixTimestamp(TimeUtils.getTimeZone());", "originalCommit": "39434ff3e4a8026e90e223fcf100c5984d7ae9e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "f5dd6e90cbfdbd6e0475a35f536c78628d4ac148", "url": "https://github.com/apache/incubator-doris/commit/f5dd6e90cbfdbd6e0475a35f536c78628d4ac148", "message": "fix cooldown timestamp bug\n\nwhen add a parition with storage_cooldown_time property like this:\nalter table tablexxx ADD PARTITION p20200421 VALUES LESS THAN(\"1588262400\") (\"storage_medium\" = \"SSD\", \"storage_cooldown_time\" = \"2020-05-01 00:00:00\");\nand show partitions from tablexxx;\nthe CooldownTime is wrong: 2610-02-17 10:16:40, and what is more, the storage migration is based on the wrong timestamp.\nThe reason is that the result of DateLiteral.getLongValue is not timestamp.", "committedDate": "2020-04-17T11:40:42Z", "type": "commit"}, {"oid": "3672a23425043b4902e971ead4e476134dd56e66", "url": "https://github.com/apache/incubator-doris/commit/3672a23425043b4902e971ead4e476134dd56e66", "message": "add unit test for cool down time", "committedDate": "2020-04-17T11:52:52Z", "type": "commit"}, {"oid": "3672a23425043b4902e971ead4e476134dd56e66", "url": "https://github.com/apache/incubator-doris/commit/3672a23425043b4902e971ead4e476134dd56e66", "message": "add unit test for cool down time", "committedDate": "2020-04-17T11:52:52Z", "type": "forcePushed"}]}