{"pr_number": 3872, "pr_title": "[Bug] Fix bug that BE crash when doing Insert Operation", "pr_createdAt": "2020-06-15T09:38:02Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3872", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440114459", "bodyText": "black list  --> blacklist", "author": "wutiangan", "createdAt": "2020-06-15T11:38:52Z", "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -1469,8 +1470,41 @@ public boolean isBackendStateHealthy() {\n             try {\n                 return BackendServiceProxy.getInstance().execPlanFragmentAsync(brpcAddress, rpcParams);\n             } catch (RpcException e) {\n-                SimpleScheduler.addToBlacklist(backend.getId());\n-                throw e;\n+                // Do not throw exception here.\n+                // return a completed future, the caller will check the result and do the cancel process.\n+                PExecPlanFragmentResult result = new PExecPlanFragmentResult();\n+                PStatus pStatus = new PStatus();\n+                pStatus.error_msgs.add(e.getMessage());\n+                // use THRIFT_RPC_ERROR so that this BE will be added to the black list later.", "originalCommit": "ce38590182edb0771ec7166069a2467c66a07345", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYxNjUwMA==", "url": "https://github.com/apache/incubator-doris/pull/3872#discussion_r440616500", "bodyText": "done", "author": "morningman", "createdAt": "2020-06-16T06:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDExNDQ1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "b0cb04ec83fcd571b699759c0431f3ad3e2c77d3", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/qe/Coordinator.java b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\nindex 6dc2ea7ec..c0b2e8580 100644\n--- a/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n+++ b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n\n@@ -1470,41 +1469,8 @@ public class Coordinator {\n             try {\n                 return BackendServiceProxy.getInstance().execPlanFragmentAsync(brpcAddress, rpcParams);\n             } catch (RpcException e) {\n-                // Do not throw exception here.\n-                // return a completed future, the caller will check the result and do the cancel process.\n-                PExecPlanFragmentResult result = new PExecPlanFragmentResult();\n-                PStatus pStatus = new PStatus();\n-                pStatus.error_msgs.add(e.getMessage());\n-                // use THRIFT_RPC_ERROR so that this BE will be added to the black list later.\n-                pStatus.status_code = TStatusCode.THRIFT_RPC_ERROR.getValue();\n-                result.status = pStatus;\n-                return new Future<PExecPlanFragmentResult>() {\n-                    @Override\n-                    public boolean cancel(boolean mayInterruptIfRunning) {\n-                        return false;\n-                    }\n-\n-                    @Override\n-                    public boolean isCancelled() {\n-                        return false;\n-                    }\n-\n-                    @Override\n-                    public boolean isDone() {\n-                        return true;\n-                    }\n-\n-                    @Override\n-                    public PExecPlanFragmentResult get() throws InterruptedException, ExecutionException {\n-                        return result;\n-                    }\n-\n-                    @Override\n-                    public PExecPlanFragmentResult get(long timeout, TimeUnit unit)\n-                            throws InterruptedException, ExecutionException, TimeoutException {\n-                        return result;\n-                    }\n-                };\n+                SimpleScheduler.addToBlacklist(backend.getId());\n+                throw e;\n             }\n         }\n \n"}}, {"oid": "b0cb04ec83fcd571b699759c0431f3ad3e2c77d3", "url": "https://github.com/apache/incubator-doris/commit/b0cb04ec83fcd571b699759c0431f3ad3e2c77d3", "message": "remerge", "committedDate": "2020-06-15T12:48:56Z", "type": "forcePushed"}, {"oid": "4d08fc023cb3e8925283582db4c6cf49dc41b4dc", "url": "https://github.com/apache/incubator-doris/commit/4d08fc023cb3e8925283582db4c6cf49dc41b4dc", "message": "remerge", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "6870491338a46ce2ce5d15cfab356f3e6d02f56e", "url": "https://github.com/apache/incubator-doris/commit/6870491338a46ce2ce5d15cfab356f3e6d02f56e", "message": "add missing code", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "a9201abf538f2a86520ccd4a244a324cb7dc251c", "url": "https://github.com/apache/incubator-doris/commit/a9201abf538f2a86520ccd4a244a324cb7dc251c", "message": "fix ut", "committedDate": "2020-06-18T13:11:11Z", "type": "commit"}, {"oid": "a9201abf538f2a86520ccd4a244a324cb7dc251c", "url": "https://github.com/apache/incubator-doris/commit/a9201abf538f2a86520ccd4a244a324cb7dc251c", "message": "fix ut", "committedDate": "2020-06-18T13:11:11Z", "type": "forcePushed"}]}