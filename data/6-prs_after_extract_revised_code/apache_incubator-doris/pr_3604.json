{"pr_number": 3604, "pr_title": "(#3464) fix Query failed when fact table has no data in join case", "pr_createdAt": "2020-05-16T09:52:59Z", "pr_url": "https://github.com/apache/incubator-doris/pull/3604", "timeline": [{"oid": "cfafdb7beddbac0d1e4cc4993a0229ee59cca07c", "url": "https://github.com/apache/incubator-doris/commit/cfafdb7beddbac0d1e4cc4993a0229ee59cca07c", "message": "(#3464) fix Query failed when fact table has no data in join case", "committedDate": "2020-05-16T09:45:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0MTU1MQ==", "url": "https://github.com/apache/incubator-doris/pull/3604#discussion_r427441551", "bodyText": "Please also update the comment.", "author": "kangkaisen", "createdAt": "2020-05-19T16:35:44Z", "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -914,17 +914,29 @@ private void computeFragmentHosts() throws Exception {\n                 // there is no leftmost scan; we assign the same hosts as those of our\n                 // leftmost input fragment (so that a partitioned aggregation\n                 // fragment runs on the hosts that provide the input data)", "originalCommit": "cfafdb7beddbac0d1e4cc4993a0229ee59cca07c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjkzMw==", "url": "https://github.com/apache/incubator-doris/pull/3604#discussion_r428576933", "bodyText": "\ud83d\udc4c", "author": "wangbo", "createdAt": "2020-05-21T10:41:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0MTU1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4283525ac5cd7061fd79f4d9c262ca7d79ac67a", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/qe/Coordinator.java b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\nindex 64270ae47..50872ee93 100644\n--- a/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n+++ b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n\n@@ -912,10 +912,8 @@ public class Coordinator {\n             if (!(leftMostNode instanceof ScanNode)) {\n                 // (Case B)\n                 // there is no leftmost scan; we assign the same hosts as those of our\n-                // leftmost input fragment (so that a partitioned aggregation\n-                // fragment runs on the hosts that provide the input data)\n+                //  input fragment which has a higher instance_number\n \n-                // find a input fragment which has a higher parallelism\n                 int inputFragmentIndex = 0;\n                 int maxParallelism = 0;\n                 for (int j = 0; j < fragment.getChildren().size(); j++) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NDQzNg==", "url": "https://github.com/apache/incubator-doris/pull/3604#discussion_r427444436", "bodyText": "I think parallelism rename  to  instance_number is better.", "author": "kangkaisen", "createdAt": "2020-05-19T16:40:20Z", "path": "fe/src/main/java/org/apache/doris/qe/Coordinator.java", "diffHunk": "@@ -914,17 +914,29 @@ private void computeFragmentHosts() throws Exception {\n                 // there is no leftmost scan; we assign the same hosts as those of our\n                 // leftmost input fragment (so that a partitioned aggregation\n                 // fragment runs on the hosts that provide the input data)\n-                PlanFragmentId inputFragmentIdx = fragments.get(i).getChild(0).getFragmentId();\n+\n+                // find a input fragment which has a higher parallelism\n+                int inputFragmentIndex = 0;\n+                int maxParallelism = 0;", "originalCommit": "cfafdb7beddbac0d1e4cc4993a0229ee59cca07c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjgxNg==", "url": "https://github.com/apache/incubator-doris/pull/3604#discussion_r428576816", "bodyText": "\ud83d\udc4c", "author": "wangbo", "createdAt": "2020-05-21T10:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ0NDQzNg=="}], "type": "inlineReview", "revised_code": {"commit": "b4283525ac5cd7061fd79f4d9c262ca7d79ac67a", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/qe/Coordinator.java b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\nindex 64270ae47..50872ee93 100644\n--- a/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n+++ b/fe/src/main/java/org/apache/doris/qe/Coordinator.java\n\n@@ -912,10 +912,8 @@ public class Coordinator {\n             if (!(leftMostNode instanceof ScanNode)) {\n                 // (Case B)\n                 // there is no leftmost scan; we assign the same hosts as those of our\n-                // leftmost input fragment (so that a partitioned aggregation\n-                // fragment runs on the hosts that provide the input data)\n+                //  input fragment which has a higher instance_number\n \n-                // find a input fragment which has a higher parallelism\n                 int inputFragmentIndex = 0;\n                 int maxParallelism = 0;\n                 for (int j = 0; j < fragment.getChildren().size(); j++) {\n"}}, {"oid": "b4283525ac5cd7061fd79f4d9c262ca7d79ac67a", "url": "https://github.com/apache/incubator-doris/commit/b4283525ac5cd7061fd79f4d9c262ca7d79ac67a", "message": "update comment", "committedDate": "2020-05-21T10:44:01Z", "type": "commit"}, {"oid": "cc71ab33e7e13c174209e588653285a76fcf7825", "url": "https://github.com/apache/incubator-doris/commit/cc71ab33e7e13c174209e588653285a76fcf7825", "message": "set partition join as default", "committedDate": "2020-06-02T14:10:03Z", "type": "commit"}, {"oid": "cc71ab33e7e13c174209e588653285a76fcf7825", "url": "https://github.com/apache/incubator-doris/commit/cc71ab33e7e13c174209e588653285a76fcf7825", "message": "set partition join as default", "committedDate": "2020-06-02T14:10:03Z", "type": "forcePushed"}]}