{"pr_number": 2941, "pr_title": "drop index when index column is dropped", "pr_createdAt": "2020-02-19T03:16:13Z", "pr_url": "https://github.com/apache/incubator-doris/pull/2941", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1ODQ5Mg==", "url": "https://github.com/apache/incubator-doris/pull/2941#discussion_r381058492", "bodyText": "If the column is dropped, all type of index should be dropped, so here should not add this if clause.", "author": "kangpinghuang", "createdAt": "2020-02-19T03:23:51Z", "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java", "diffHunk": "@@ -224,7 +225,17 @@ private void processDropColumn(DropColumnClause alterClause, OlapTable olapTable\n                 }\n             }\n         }\n-        \n+\n+        Iterator<Index> it = indexes.iterator();\n+        while(it.hasNext()){\n+            Index index = it.next();\n+            if(index.getIndexType() == IndexDef.IndexType.BITMAP", "originalCommit": "319d19cd03f724e4bf87f0bcd08cd399a42092cf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "aedc403f55206c0c50e75afa58643afeb803ef77", "chunk": "diff --git a/fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java b/fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java\nindex 75607ef5e..966f26662 100644\n--- a/fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java\n+++ b/fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java\n\n@@ -229,10 +229,11 @@ public class SchemaChangeHandler extends AlterHandler {\n         Iterator<Index> it = indexes.iterator();\n         while(it.hasNext()){\n             Index index = it.next();\n-            if(index.getIndexType() == IndexDef.IndexType.BITMAP\n-                    // because bitmap index only can applied on single column so get first column.\n-                    && dropColName.equalsIgnoreCase(index.getColumns().get(0))){\n-                it.remove();\n+            for (String indexCol : index.getColumns()) {\n+                if (dropColName.equalsIgnoreCase(indexCol)) {\n+                    it.remove();\n+                    break;\n+                }\n             }\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1ODU2Ng==", "url": "https://github.com/apache/incubator-doris/pull/2941#discussion_r381058566", "bodyText": "add some comment for this argments.", "author": "kangpinghuang", "createdAt": "2020-02-19T03:24:10Z", "path": "fe/src/main/java/org/apache/doris/alter/SchemaChangeHandler.java", "diffHunk": "@@ -157,7 +158,7 @@ private void processAddColumns(AddColumnsClause alterClause, OlapTable olapTable\n     }\n \n     private void processDropColumn(DropColumnClause alterClause, OlapTable olapTable,\n-                                  Map<Long, LinkedList<Column>> indexSchemaMap) throws DdlException {\n+                                  Map<Long, LinkedList<Column>> indexSchemaMap, List<Index> indexes) throws DdlException {", "originalCommit": "319d19cd03f724e4bf87f0bcd08cd399a42092cf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "aedc403f55206c0c50e75afa58643afeb803ef77", "url": "https://github.com/apache/incubator-doris/commit/aedc403f55206c0c50e75afa58643afeb803ef77", "message": "drop index when index column is dropped", "committedDate": "2020-02-19T03:28:10Z", "type": "forcePushed"}, {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "url": "https://github.com/apache/incubator-doris/commit/d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "message": "drop index when index column is dropped", "committedDate": "2020-02-19T03:32:12Z", "type": "commit"}, {"oid": "d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "url": "https://github.com/apache/incubator-doris/commit/d6e36075a617a3da2ab203537e31a9d54fbf0ed4", "message": "drop index when index column is dropped", "committedDate": "2020-02-19T03:32:12Z", "type": "forcePushed"}]}