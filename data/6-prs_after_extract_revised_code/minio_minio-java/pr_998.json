{"pr_number": 998, "pr_title": "Return higher level object GetObjectResponse for getObject API", "pr_createdAt": "2020-06-30T17:16:23Z", "pr_url": "https://github.com/minio/minio-java/pull/998", "timeline": [{"oid": "d6a3aeefdb1f833c8fdb3642604a636330b74e76", "url": "https://github.com/minio/minio-java/commit/d6a3aeefdb1f833c8fdb3642604a636330b74e76", "message": "Return higher level object GetObjectResponse for getObject API", "committedDate": "2020-07-02T04:59:45Z", "type": "commit"}, {"oid": "d6a3aeefdb1f833c8fdb3642604a636330b74e76", "url": "https://github.com/minio/minio-java/commit/d6a3aeefdb1f833c8fdb3642604a636330b74e76", "message": "Return higher level object GetObjectResponse for getObject API", "committedDate": "2020-07-02T04:59:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE1MDI3Nw==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449150277", "bodyText": "Why not extend from GenericResponse and have just one instance variable for InputStream body ?", "author": "anjalshireesh", "createdAt": "2020-07-02T16:55:30Z", "path": "api/src/main/java/io/minio/GetObjectResponse.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import okhttp3.Headers;\n+\n+public class GetObjectResponse extends InputStream {", "originalCommit": "d6a3aeefdb1f833c8fdb3642604a636330b74e76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM0ODg5Mg==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449348892", "bodyText": "InputStream body by public InputStream body() is already there.\nWe want GetObjectResponse needs to be an InputStream and have functionality of GenericResponse. As GenericResponse and InputStream are abstract classes, I cannot inherit both the classes, but inherit one class (InputStream) and have instance of another class (GenericResponse); if we do other way around; InputStream capability is lost.", "author": "balamurugana", "createdAt": "2020-07-03T02:41:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE1MDI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQzMjU1Ng==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449432556", "bodyText": "@balamurugana the InputStream capability won't be lost. We can get the InputStream by calling body() from the instance of GetObjectResponse to get the input stream.", "author": "anjalshireesh", "createdAt": "2020-07-03T07:51:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE1MDI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2OTM0Nw==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449469347", "bodyText": "The idea here is to GetObjectResponse be an InputStream which is most common usage and it doesn't break backward compatibility.", "author": "balamurugana", "createdAt": "2020-07-03T09:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE1MDI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxNzU3Mw==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449517573", "bodyText": "Backward compatibility with the previous return type of the method - understood \ud83d\udc4d\nIn that case, may I suggest to remove all the wrapper methods that call the same method on the response object, and expect the client to call response() method to get the object of BaseResponse and then use it to get further details? We can also consider making the GenericResponse non-abstract and using it directly.", "author": "anjalshireesh", "createdAt": "2020-07-03T10:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE1MDI3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6e31a6d717891d018af8aadb8b507b007615756b", "chunk": "diff --git a/api/src/main/java/io/minio/GetObjectResponse.java b/api/src/main/java/io/minio/GetObjectResponse.java\nindex 7cf54cfc..15a50724 100644\n--- a/api/src/main/java/io/minio/GetObjectResponse.java\n+++ b/api/src/main/java/io/minio/GetObjectResponse.java\n\n@@ -16,18 +16,17 @@\n \n package io.minio;\n \n-import java.io.IOException;\n+import java.io.FilterInputStream;\n import java.io.InputStream;\n import okhttp3.Headers;\n \n-public class GetObjectResponse extends InputStream {\n-  private BaseResponse response;\n-  private InputStream body;\n+public class GetObjectResponse extends FilterInputStream {\n+  private GenericResponse response;\n \n   public GetObjectResponse(\n       Headers headers, String bucket, String region, String object, InputStream body) {\n-    this.response = new BaseResponse(headers, bucket, region, object);\n-    this.body = body;\n+    super(body);\n+    this.response = new GenericResponse(headers, bucket, region, object);\n   }\n \n   public Headers headers() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxODU1NA==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449518554", "bodyText": "GetObjectResponse can extend from BufferedInputStream and then call super(body) here inside the constructor.\nWith this, The class would authentically become an InputStream and would not need to store the body variable and write wrapper methods for it.", "author": "anjalshireesh", "createdAt": "2020-07-03T10:48:49Z", "path": "api/src/main/java/io/minio/GetObjectResponse.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import okhttp3.Headers;\n+\n+public class GetObjectResponse extends InputStream {\n+  private BaseResponse response;\n+  private InputStream body;\n+\n+  public GetObjectResponse(\n+      Headers headers, String bucket, String region, String object, InputStream body) {\n+    this.response = new BaseResponse(headers, bucket, region, object);\n+    this.body = body;", "originalCommit": "d6a3aeefdb1f833c8fdb3642604a636330b74e76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU4NjMzNQ==", "url": "https://github.com/minio/minio-java/pull/998#discussion_r449586335", "bodyText": "We would need to keep proxying methods in GenericResponse here to comply with other Response classes; else GetObjectResponse looks different. The idea is GetObjectResponse is same as GenericResponse but also an InputStream.\n\n\nYes. Making GenericResponse as non-abstract class.\n\n\nI am going to use FilterInputStream which is more appropriate than BufferedInputStream", "author": "balamurugana", "createdAt": "2020-07-03T13:33:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUxODU1NA=="}], "type": "inlineReview", "revised_code": {"commit": "6e31a6d717891d018af8aadb8b507b007615756b", "chunk": "diff --git a/api/src/main/java/io/minio/GetObjectResponse.java b/api/src/main/java/io/minio/GetObjectResponse.java\nindex 7cf54cfc..15a50724 100644\n--- a/api/src/main/java/io/minio/GetObjectResponse.java\n+++ b/api/src/main/java/io/minio/GetObjectResponse.java\n\n@@ -16,18 +16,17 @@\n \n package io.minio;\n \n-import java.io.IOException;\n+import java.io.FilterInputStream;\n import java.io.InputStream;\n import okhttp3.Headers;\n \n-public class GetObjectResponse extends InputStream {\n-  private BaseResponse response;\n-  private InputStream body;\n+public class GetObjectResponse extends FilterInputStream {\n+  private GenericResponse response;\n \n   public GetObjectResponse(\n       Headers headers, String bucket, String region, String object, InputStream body) {\n-    this.response = new BaseResponse(headers, bucket, region, object);\n-    this.body = body;\n+    super(body);\n+    this.response = new GenericResponse(headers, bucket, region, object);\n   }\n \n   public Headers headers() {\n"}}, {"oid": "6e31a6d717891d018af8aadb8b507b007615756b", "url": "https://github.com/minio/minio-java/commit/6e31a6d717891d018af8aadb8b507b007615756b", "message": "address review comments", "committedDate": "2020-07-03T13:39:54Z", "type": "commit"}, {"oid": "6e31a6d717891d018af8aadb8b507b007615756b", "url": "https://github.com/minio/minio-java/commit/6e31a6d717891d018af8aadb8b507b007615756b", "message": "address review comments", "committedDate": "2020-07-03T13:39:54Z", "type": "forcePushed"}]}