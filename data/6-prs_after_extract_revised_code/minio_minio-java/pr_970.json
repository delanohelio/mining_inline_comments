{"pr_number": 970, "pr_title": "add arg builder support to copyObject API", "pr_createdAt": "2020-06-05T04:03:03Z", "pr_url": "https://github.com/minio/minio-java/pull/970", "timeline": [{"oid": "8ca47d49b471929d6e0c028120fd4cfcd63dd53b", "url": "https://github.com/minio/minio-java/commit/8ca47d49b471929d6e0c028120fd4cfcd63dd53b", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-05T09:11:54Z", "type": "forcePushed"}, {"oid": "ced722acb1313e91512f0a4bf4d2a3dc3e76f349", "url": "https://github.com/minio/minio-java/commit/ced722acb1313e91512f0a4bf4d2a3dc3e76f349", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-05T10:13:17Z", "type": "forcePushed"}, {"oid": "7da0c76f5bc800e781e68c918867510721804838", "url": "https://github.com/minio/minio-java/commit/7da0c76f5bc800e781e68c918867510721804838", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-05T12:57:04Z", "type": "forcePushed"}, {"oid": "0ccfcdb5f2e5eb3c65ab0069aacefd4b09c0518d", "url": "https://github.com/minio/minio-java/commit/0ccfcdb5f2e5eb3c65ab0069aacefd4b09c0518d", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-05T16:27:24Z", "type": "forcePushed"}, {"oid": "c894892ce4dd531f7608e27ce64a570863de2123", "url": "https://github.com/minio/minio-java/commit/c894892ce4dd531f7608e27ce64a570863de2123", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-05T18:15:50Z", "type": "forcePushed"}, {"oid": "863479ec18df268cd1997e4acf40863924ed2ead", "url": "https://github.com/minio/minio-java/commit/863479ec18df268cd1997e4acf40863924ed2ead", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-06T03:16:34Z", "type": "forcePushed"}, {"oid": "c296d1af5bf5ba3f74ba5ccb54c2894ecc621494", "url": "https://github.com/minio/minio-java/commit/c296d1af5bf5ba3f74ba5ccb54c2894ecc621494", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-06T11:05:10Z", "type": "forcePushed"}, {"oid": "4543874bfdaf1dd1b658ea88e28f2062a3fc2ab4", "url": "https://github.com/minio/minio-java/commit/4543874bfdaf1dd1b658ea88e28f2062a3fc2ab4", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-06T11:49:35Z", "type": "forcePushed"}, {"oid": "030788ec234ba98f61bfeb620e8547279e4fc4fe", "url": "https://github.com/minio/minio-java/commit/030788ec234ba98f61bfeb620e8547279e4fc4fe", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-06T14:56:38Z", "type": "forcePushed"}, {"oid": "466aded95e43f484bb29bfc165a54dbc8a70850f", "url": "https://github.com/minio/minio-java/commit/466aded95e43f484bb29bfc165a54dbc8a70850f", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-07T03:02:48Z", "type": "forcePushed"}, {"oid": "3a9281d2896a3c810eb3f023c3c1a5feddce58fa", "url": "https://github.com/minio/minio-java/commit/3a9281d2896a3c810eb3f023c3c1a5feddce58fa", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-07T03:39:01Z", "type": "forcePushed"}, {"oid": "69e9f8887434752e973f30b7b03cd5b1a0711e95", "url": "https://github.com/minio/minio-java/commit/69e9f8887434752e973f30b7b03cd5b1a0711e95", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-07T12:55:37Z", "type": "forcePushed"}, {"oid": "a99429e7da0691bca9759c00d1883d67881a1fa5", "url": "https://github.com/minio/minio-java/commit/a99429e7da0691bca9759c00d1883d67881a1fa5", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-07T13:22:12Z", "type": "forcePushed"}, {"oid": "82d45dc2e9e745da61ec8c963479909654d0a112", "url": "https://github.com/minio/minio-java/commit/82d45dc2e9e745da61ec8c963479909654d0a112", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-08T09:44:38Z", "type": "forcePushed"}, {"oid": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "url": "https://github.com/minio/minio-java/commit/6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-09T02:14:41Z", "type": "commit"}, {"oid": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "url": "https://github.com/minio/minio-java/commit/6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "message": "add arg builder support to copyObject API", "committedDate": "2020-06-09T02:14:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzNzM4MQ==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437337381", "bodyText": "Might be a good idea to add this as a method in the Tags class. Something like Tag#getTagging()", "author": "anjalshireesh", "createdAt": "2020-06-09T11:30:06Z", "path": "api/src/main/java/io/minio/ObjectWriteArgs.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import com.google.common.collect.HashMultimap;\n+import com.google.common.collect.Multimap;\n+import com.google.common.collect.Multimaps;\n+import io.minio.messages.Retention;\n+import io.minio.messages.Tags;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import okhttp3.HttpUrl;\n+\n+public abstract class ObjectWriteArgs extends ObjectArgs {\n+  protected Multimap<String, String> headers =\n+      Multimaps.unmodifiableMultimap(HashMultimap.create());\n+  protected Multimap<String, String> userMetadata =\n+      Multimaps.unmodifiableMultimap(HashMultimap.create());\n+  protected ServerSideEncryption sse;\n+  protected Tags tags = new Tags();\n+  protected Retention retention;\n+  protected boolean legalHold;\n+\n+  public Multimap<String, String> headers() {\n+    return headers;\n+  }\n+\n+  public Multimap<String, String> userMetadata() {\n+    return userMetadata;\n+  }\n+\n+  public ServerSideEncryption sse() {\n+    return sse;\n+  }\n+\n+  public Tags tags() {\n+    return tags;\n+  }\n+\n+  public Retention retention() {\n+    return retention;\n+  }\n+\n+  public boolean legalHold() {\n+    return legalHold;\n+  }\n+\n+  public Multimap<String, String> genHeaders() {\n+    Multimap<String, String> headers = HashMultimap.create();\n+\n+    headers.putAll(this.headers);\n+    headers.putAll(userMetadata);\n+\n+    if (sse != null) {\n+      headers.putAll(Multimaps.forMap(sse.headers()));\n+    }\n+\n+    String tagging =\n+        tags.get().entrySet().stream()\n+            .map(e -> S3Escaper.encode(e.getKey()) + \"=\" + S3Escaper.encode(e.getValue()))\n+            .collect(Collectors.joining(\"&\"));", "originalCommit": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2NDk5NA==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437464994", "bodyText": "ATM io.minio.S3Escaper is private and not available to io.minio.messages package.", "author": "balamurugana", "createdAt": "2020-06-09T14:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzMzNzM4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "chunk": "diff --git a/api/src/main/java/io/minio/ObjectWriteArgs.java b/api/src/main/java/io/minio/ObjectWriteArgs.java\nindex 7fa9a936..fc941cef 100644\n--- a/api/src/main/java/io/minio/ObjectWriteArgs.java\n+++ b/api/src/main/java/io/minio/ObjectWriteArgs.java\n\n@@ -96,28 +96,25 @@ public abstract class ObjectWriteArgs extends ObjectArgs {\n     checkSse(sse, url);\n   }\n \n+  @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n   public abstract static class Builder<B extends Builder<B, A>, A extends ObjectWriteArgs>\n       extends ObjectArgs.Builder<B, A> {\n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B headers(Map<String, String> headers) {\n       final Multimap<String, String> headersCopy = toMultimap(headers);\n       operations.add(args -> args.headers = headersCopy);\n       return (B) this;\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B headers(Multimap<String, String> headers) {\n       final Multimap<String, String> headersCopy = copyMultimap(headers);\n       operations.add(args -> args.headers = headersCopy);\n       return (B) this;\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B userMetadata(Map<String, String> userMetadata) {\n       return userMetadata((userMetadata == null) ? null : Multimaps.forMap(userMetadata));\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B userMetadata(Multimap<String, String> userMetadata) {\n       Multimap<String, String> userMetadataCopy = HashMultimap.create();\n       if (userMetadata != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MTcxNQ==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437341715", "bodyText": "It might be better to add this annotation to the Builder class itself instead of one each and every setter method.", "author": "anjalshireesh", "createdAt": "2020-06-09T11:38:40Z", "path": "api/src/main/java/io/minio/ObjectWriteArgs.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage, (C) 2020 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import com.google.common.collect.HashMultimap;\n+import com.google.common.collect.Multimap;\n+import com.google.common.collect.Multimaps;\n+import io.minio.messages.Retention;\n+import io.minio.messages.Tags;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+import okhttp3.HttpUrl;\n+\n+public abstract class ObjectWriteArgs extends ObjectArgs {\n+  protected Multimap<String, String> headers =\n+      Multimaps.unmodifiableMultimap(HashMultimap.create());\n+  protected Multimap<String, String> userMetadata =\n+      Multimaps.unmodifiableMultimap(HashMultimap.create());\n+  protected ServerSideEncryption sse;\n+  protected Tags tags = new Tags();\n+  protected Retention retention;\n+  protected boolean legalHold;\n+\n+  public Multimap<String, String> headers() {\n+    return headers;\n+  }\n+\n+  public Multimap<String, String> userMetadata() {\n+    return userMetadata;\n+  }\n+\n+  public ServerSideEncryption sse() {\n+    return sse;\n+  }\n+\n+  public Tags tags() {\n+    return tags;\n+  }\n+\n+  public Retention retention() {\n+    return retention;\n+  }\n+\n+  public boolean legalHold() {\n+    return legalHold;\n+  }\n+\n+  public Multimap<String, String> genHeaders() {\n+    Multimap<String, String> headers = HashMultimap.create();\n+\n+    headers.putAll(this.headers);\n+    headers.putAll(userMetadata);\n+\n+    if (sse != null) {\n+      headers.putAll(Multimaps.forMap(sse.headers()));\n+    }\n+\n+    String tagging =\n+        tags.get().entrySet().stream()\n+            .map(e -> S3Escaper.encode(e.getKey()) + \"=\" + S3Escaper.encode(e.getValue()))\n+            .collect(Collectors.joining(\"&\"));\n+    if (!tagging.isEmpty()) {\n+      headers.put(\"x-amz-tagging\", tagging);\n+    }\n+\n+    if (retention != null && retention.mode() != null) {\n+      headers.put(\"x-amz-object-lock-mode\", retention.mode().name());\n+      headers.put(\n+          \"x-amz-object-lock-retain-until-date\",\n+          retention.retainUntilDate().format(Time.HTTP_HEADER_DATE_FORMAT));\n+    }\n+\n+    if (legalHold) {\n+      headers.put(\"x-amz-object-lock-legal-hold\", \"ON\");\n+    }\n+\n+    return headers;\n+  }\n+\n+  protected void validateSse(HttpUrl url) {\n+    checkSse(sse, url);\n+  }\n+\n+  public abstract static class Builder<B extends Builder<B, A>, A extends ObjectWriteArgs>\n+      extends ObjectArgs.Builder<B, A> {\n+    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class", "originalCommit": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ2ODQxOQ==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437468419", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-06-09T14:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM0MTcxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "chunk": "diff --git a/api/src/main/java/io/minio/ObjectWriteArgs.java b/api/src/main/java/io/minio/ObjectWriteArgs.java\nindex 7fa9a936..fc941cef 100644\n--- a/api/src/main/java/io/minio/ObjectWriteArgs.java\n+++ b/api/src/main/java/io/minio/ObjectWriteArgs.java\n\n@@ -96,28 +96,25 @@ public abstract class ObjectWriteArgs extends ObjectArgs {\n     checkSse(sse, url);\n   }\n \n+  @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n   public abstract static class Builder<B extends Builder<B, A>, A extends ObjectWriteArgs>\n       extends ObjectArgs.Builder<B, A> {\n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B headers(Map<String, String> headers) {\n       final Multimap<String, String> headersCopy = toMultimap(headers);\n       operations.add(args -> args.headers = headersCopy);\n       return (B) this;\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B headers(Multimap<String, String> headers) {\n       final Multimap<String, String> headersCopy = copyMultimap(headers);\n       operations.add(args -> args.headers = headersCopy);\n       return (B) this;\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B userMetadata(Map<String, String> userMetadata) {\n       return userMetadata((userMetadata == null) ? null : Multimaps.forMap(userMetadata));\n     }\n \n-    @SuppressWarnings(\"unchecked\") // Its safe to type cast to B as B is inherited by this class\n     public B userMetadata(Multimap<String, String> userMetadata) {\n       Multimap<String, String> userMetadataCopy = HashMultimap.create();\n       if (userMetadata != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1ODc5Mw==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437358793", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    builder.metadataDirective(Directive.REPLACE);\n          \n          \n            \n                    builder.metadataDirective(value);", "author": "anjalshireesh", "createdAt": "2020-06-09T12:11:10Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -2321,48 +2323,184 @@ public void copyObject(\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, ServerException,\n           XmlParserException {\n-    if ((bucketName == null) || (bucketName.isEmpty())) {\n-      throw new IllegalArgumentException(\"bucket name cannot be empty\");\n+    ServerSideEncryptionCustomerKey srcSsec = null;\n+    if (srcSse instanceof ServerSideEncryptionCustomerKey) {\n+      srcSsec = (ServerSideEncryptionCustomerKey) srcSse;\n     }\n+    checkReadRequestSse(srcSse);\n \n-    checkObjectName(objectName);\n+    CopyObjectArgs.Builder builder =\n+        CopyObjectArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .headers(headerMap)\n+            .sse(sse)\n+            .srcBucket(srcBucketName)\n+            .srcObject(srcObjectName)\n+            .srcSsec(srcSsec);\n \n-    checkWriteRequestSse(sse);\n+    if (copyConditions != null) {\n+      Map<String, String> map = copyConditions.getConditions();\n+      String value;\n+\n+      builder.srcMatchETag(map.get(\"x-amz-copy-source-if-match\"));\n+      builder.srcNotMatchETag(map.get(\"x-amz-copy-source-if-none-match\"));\n \n-    if ((srcBucketName == null) || (srcBucketName.isEmpty())) {\n-      throw new IllegalArgumentException(\"Source bucket name cannot be empty\");\n+      value = map.get(\"x-amz-copy-source-if-modified-since\");\n+      if (value != null) {\n+        builder.srcModifiedSince(ZonedDateTime.parse(value, Time.HTTP_HEADER_DATE_FORMAT));\n+      }\n+\n+      value = map.get(\"x-amz-copy-source-if-unmodified-since\");\n+      if (value != null) {\n+        builder.srcUnmodifiedSince(ZonedDateTime.parse(value, Time.HTTP_HEADER_DATE_FORMAT));\n+      }\n+\n+      value = map.get(\"x-amz-metadata-directive\");\n+      if (value != null) {\n+        builder.metadataDirective(Directive.REPLACE);", "originalCommit": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MDc5NQ==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437470795", "bodyText": "No. CopyConditions sets only \"REPLACE\" string. Hence Directive.REPLACE", "author": "balamurugana", "createdAt": "2020-06-09T14:33:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1ODc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyMDk0NQ==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437520945", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    builder.metadataDirective(Directive.REPLACE);\n          \n          \n            \n                    builder.metadataDirective(Directive.valueOf(value));", "author": "anjalshireesh", "createdAt": "2020-06-09T15:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1ODc5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "chunk": "diff --git a/api/src/main/java/io/minio/MinioClient.java b/api/src/main/java/io/minio/MinioClient.java\nindex e9aa0609..f1d5fa8e 100755\n--- a/api/src/main/java/io/minio/MinioClient.java\n+++ b/api/src/main/java/io/minio/MinioClient.java\n\n@@ -2445,10 +2446,7 @@ public class MinioClient {\n     Multimap<String, String> headers = args.genHeaders();\n \n     // Source object name is optional, if empty default to object name.\n-    String srcObject = args.object();\n-    if (args.srcObject() != null) {\n-      srcObject = args.srcObject();\n-    }\n+    String srcObject = Optional.ofNullable(args.srcObject()).orElse(args.object());\n \n     String copySource = S3Escaper.encodePath(\"/\" + args.srcBucket() + \"/\" + srcObject);\n     if (args.srcVersionId() != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3MTIyNA==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437371224", "bodyText": "Can be simplified using the Optional class as follows:\nString srcObject = Optional.ofNullable(args.srcObject()).orElse(args.object());", "author": "anjalshireesh", "createdAt": "2020-06-09T12:27:57Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -2321,48 +2323,184 @@ public void copyObject(\n           InternalException, InvalidBucketNameException, InvalidKeyException,\n           InvalidResponseException, IOException, NoSuchAlgorithmException, ServerException,\n           XmlParserException {\n-    if ((bucketName == null) || (bucketName.isEmpty())) {\n-      throw new IllegalArgumentException(\"bucket name cannot be empty\");\n+    ServerSideEncryptionCustomerKey srcSsec = null;\n+    if (srcSse instanceof ServerSideEncryptionCustomerKey) {\n+      srcSsec = (ServerSideEncryptionCustomerKey) srcSse;\n     }\n+    checkReadRequestSse(srcSse);\n \n-    checkObjectName(objectName);\n+    CopyObjectArgs.Builder builder =\n+        CopyObjectArgs.builder()\n+            .bucket(bucketName)\n+            .object(objectName)\n+            .headers(headerMap)\n+            .sse(sse)\n+            .srcBucket(srcBucketName)\n+            .srcObject(srcObjectName)\n+            .srcSsec(srcSsec);\n \n-    checkWriteRequestSse(sse);\n+    if (copyConditions != null) {\n+      Map<String, String> map = copyConditions.getConditions();\n+      String value;\n+\n+      builder.srcMatchETag(map.get(\"x-amz-copy-source-if-match\"));\n+      builder.srcNotMatchETag(map.get(\"x-amz-copy-source-if-none-match\"));\n \n-    if ((srcBucketName == null) || (srcBucketName.isEmpty())) {\n-      throw new IllegalArgumentException(\"Source bucket name cannot be empty\");\n+      value = map.get(\"x-amz-copy-source-if-modified-since\");\n+      if (value != null) {\n+        builder.srcModifiedSince(ZonedDateTime.parse(value, Time.HTTP_HEADER_DATE_FORMAT));\n+      }\n+\n+      value = map.get(\"x-amz-copy-source-if-unmodified-since\");\n+      if (value != null) {\n+        builder.srcUnmodifiedSince(ZonedDateTime.parse(value, Time.HTTP_HEADER_DATE_FORMAT));\n+      }\n+\n+      value = map.get(\"x-amz-metadata-directive\");\n+      if (value != null) {\n+        builder.metadataDirective(Directive.REPLACE);\n+      }\n     }\n \n+    copyObject(builder.build());\n+  }\n+\n+  /**\n+   * Creates an object by server-side copying data from another object.\n+   *\n+   * <pre>Example:{@code\n+   * // Create object \"my-objectname\" in bucket \"my-bucketname\" by copying from object\n+   * // \"my-objectname\" in bucket \"my-source-bucketname\".\n+   * minioClient.copyObject(\n+   *     CopyObjectArgs.builder()\n+   *         .bucket(\"my-bucketname\")\n+   *         .object(\"my-objectname\")\n+   *         .srcBucket(\"my-source-bucketname\")\n+   *         .build());\n+   *\n+   * // Create object \"my-objectname\" in bucket \"my-bucketname\" by copying from object\n+   * // \"my-source-objectname\" in bucket \"my-source-bucketname\".\n+   * minioClient.copyObject(\n+   *     CopyObjectArgs.builder()\n+   *         .bucket(\"my-bucketname\")\n+   *         .object(\"my-objectname\")\n+   *         .srcBucket(\"my-source-bucketname\")\n+   *         .srcObject(\"my-source-objectname\")\n+   *         .build());\n+   *\n+   * // Create object \"my-objectname\" in bucket \"my-bucketname\" with server-side encryption by\n+   * // copying from object \"my-objectname\" in bucket \"my-source-bucketname\".\n+   * minioClient.copyObject(\n+   *     CopyObjectArgs.builder()\n+   *         .bucket(\"my-bucketname\")\n+   *         .object(\"my-objectname\")\n+   *         .srcBucket(\"my-source-bucketname\")\n+   *         .sse(sse)\n+   *         .build());\n+   *\n+   * // Create object \"my-objectname\" in bucket \"my-bucketname\" by copying from SSE-C encrypted\n+   * // object \"my-source-objectname\" in bucket \"my-source-bucketname\".\n+   * minioClient.copyObject(\n+   *     CopyObjectArgs.builder()\n+   *         .bucket(\"my-bucketname\")\n+   *         .object(\"my-objectname\")\n+   *         .srcBucket(\"my-source-bucketname\")\n+   *         .srcObject(\"my-source-objectname\")\n+   *         .srcSsec(ssec)\n+   *         .build());\n+   *\n+   * // Create object \"my-objectname\" in bucket \"my-bucketname\" with custom headers by copying from\n+   * // object \"my-objectname\" in bucket \"my-source-bucketname\" using conditions.\n+   * minioClient.copyObject(\n+   *     CopyObjectArgs.builder()\n+   *         .bucket(\"my-bucketname\")\n+   *         .object(\"my-objectname\")\n+   *         .srcBucket(\"my-source-bucketname\")\n+   *         .headers(headers)\n+   *         .srcMatchETag(etag)\n+   *         .build());\n+   * }</pre>\n+   *\n+   * @param args {@link CopyObjectArgs} object.\n+   * @throws ErrorResponseException thrown to indicate S3 service returned an error response.\n+   * @throws IllegalArgumentException throws to indicate invalid argument passed.\n+   * @throws InsufficientDataException thrown to indicate not enough data available in InputStream.\n+   * @throws InternalException thrown to indicate internal library error.\n+   * @throws InvalidBucketNameException thrown to indicate invalid bucket name passed.\n+   * @throws InvalidKeyException thrown to indicate missing of HMAC SHA-256 library.\n+   * @throws InvalidResponseException thrown to indicate S3 service returned invalid or no error\n+   *     response.\n+   * @throws IOException thrown to indicate I/O error on S3 operation.\n+   * @throws NoSuchAlgorithmException thrown to indicate missing of MD5 or SHA-256 digest library.\n+   * @throws XmlParserException thrown to indicate XML parsing error.\n+   */\n+  public void copyObject(CopyObjectArgs args)\n+      throws ErrorResponseException, IllegalArgumentException, InsufficientDataException,\n+          InternalException, InvalidBucketNameException, InvalidKeyException,\n+          InvalidResponseException, IOException, NoSuchAlgorithmException, ServerException,\n+          XmlParserException {\n+    checkArgs(args);\n+    args.validateSse(this.baseUrl);\n+\n+    Multimap<String, String> headers = args.genHeaders();\n+\n     // Source object name is optional, if empty default to object name.\n-    if (srcObjectName == null) {\n-      srcObjectName = objectName;\n+    String srcObject = args.object();\n+    if (args.srcObject() != null) {\n+      srcObject = args.srcObject();", "originalCommit": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NDUxNg==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437474516", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-06-09T14:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3MTIyNA=="}], "type": "inlineReview", "revised_code": {"commit": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "chunk": "diff --git a/api/src/main/java/io/minio/MinioClient.java b/api/src/main/java/io/minio/MinioClient.java\nindex e9aa0609..f1d5fa8e 100755\n--- a/api/src/main/java/io/minio/MinioClient.java\n+++ b/api/src/main/java/io/minio/MinioClient.java\n\n@@ -2445,10 +2446,7 @@ public class MinioClient {\n     Multimap<String, String> headers = args.genHeaders();\n \n     // Source object name is optional, if empty default to object name.\n-    String srcObject = args.object();\n-    if (args.srcObject() != null) {\n-      srcObject = args.srcObject();\n-    }\n+    String srcObject = Optional.ofNullable(args.srcObject()).orElse(args.object());\n \n     String copySource = S3Escaper.encodePath(\"/\" + args.srcBucket() + \"/\" + srcObject);\n     if (args.srcVersionId() != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3NzEzNA==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437377134", "bodyText": "Can be simplified using Optional class as follows:\nString srcObject = Optional.ofNullable(args.srcObject()).orElse(args.object());", "author": "anjalshireesh", "createdAt": "2020-06-09T12:34:51Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -2299,660 +2307,368 @@ public static void threadedPutObject() throws Exception {\n     }\n   }\n \n-  /** Test: copyObject(String bucketName, String objectName, String destBucketName). */\n-  public static void copyObject_test1() throws Exception {\n-    String methodName = \"copyObject(String bucketName, String objectName, String destBucketName)\";\n+  public static void testCopyObject(\n+      String testTags, ServerSideEncryption sse, CopyObjectArgs args, boolean negativeCase)\n+      throws Exception {\n+    String methodName = \"copyObject()\";\n     if (!mintEnv) {\n-      System.out.println(\"Test: \" + methodName);\n-    }\n-\n-    long startTime = System.currentTimeMillis();\n-    try {\n-      String objectName = getRandomName();\n-      try (final InputStream is = new ContentInputStream(1 * KB)) {\n-        client.putObject(bucketName, objectName, is, new PutObjectOptions(1 * KB, -1));\n-      }\n-\n-      String destBucketName = getRandomName();\n-      client.makeBucket(MakeBucketArgs.builder().bucket(destBucketName).build());\n-      client.copyObject(destBucketName, objectName, null, null, bucketName, null, null, null);\n-      client\n-          .getObject(GetObjectArgs.builder().bucket(bucketName).object(objectName).build())\n-          .close();\n-\n-      client.removeObject(RemoveObjectArgs.builder().bucket(bucketName).object(objectName).build());\n-      client.removeObject(\n-          RemoveObjectArgs.builder().bucket(destBucketName).object(objectName).build());\n-      client.removeBucket(RemoveBucketArgs.builder().bucket(destBucketName).build());\n-      mintSuccessLog(methodName, null, startTime);\n-    } catch (Exception e) {\n-      handleException(methodName, null, startTime, e);\n+      System.out.println(\"Test: \" + methodName + \" \" + testTags);\n     }\n-  }\n \n-  /**\n-   * Test: copyObject(String bucketName, String objectName, String destBucketName, CopyConditions\n-   * copyConditions) with ETag to match.\n-   */\n-  public static void copyObject_test2() throws Exception {\n-    if (!mintEnv) {\n-      System.out.println(\n-          \"Test: copyObject(String bucketName, String objectName, String destBucketName,\"\n-              + \"CopyConditions copyConditions) with Matching ETag (Negative Case)\");\n+    String srcObject = args.object();\n+    if (args.srcObject() != null) {\n+      srcObject = args.srcObject();", "originalCommit": "6288dcbb2d0940d3b54ac4da784d6cb35dcfa19f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3NzQzOA==", "url": "https://github.com/minio/minio-java/pull/970#discussion_r437477438", "bodyText": "Done", "author": "balamurugana", "createdAt": "2020-06-09T14:41:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM3NzEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex 1dc9fd83..d1da729b 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -2315,10 +2316,7 @@ public class FunctionalTest {\n       System.out.println(\"Test: \" + methodName + \" \" + testTags);\n     }\n \n-    String srcObject = args.object();\n-    if (args.srcObject() != null) {\n-      srcObject = args.srcObject();\n-    }\n+    String srcObject = Optional.ofNullable(args.srcObject()).orElse(args.object());\n \n     long startTime = System.currentTimeMillis();\n     try {\n"}}, {"oid": "d4ccd41e74b329a0ca0136af682b2112d72f957d", "url": "https://github.com/minio/minio-java/commit/d4ccd41e74b329a0ca0136af682b2112d72f957d", "message": "address review comments", "committedDate": "2020-06-09T14:43:43Z", "type": "commit"}, {"oid": "3fd11fea7244b2f2ef7893e6d1a901f1e3b1a483", "url": "https://github.com/minio/minio-java/commit/3fd11fea7244b2f2ef7893e6d1a901f1e3b1a483", "message": "address review comments", "committedDate": "2020-06-09T16:07:32Z", "type": "commit"}]}