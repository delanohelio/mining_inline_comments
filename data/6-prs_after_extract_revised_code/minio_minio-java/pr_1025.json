{"pr_number": 1025, "pr_title": "fix canonical header computation for multi-spaced header values", "pr_createdAt": "2020-07-22T10:51:28Z", "pr_url": "https://github.com/minio/minio-java/pull/1025", "timeline": [{"oid": "0fa51131cc4dccff7efcbef2bdfb9c9e4b5677f4", "url": "https://github.com/minio/minio-java/commit/0fa51131cc4dccff7efcbef2bdfb9c9e4b5677f4", "message": "fix canonical header computation for multi-spaced header values", "committedDate": "2020-07-22T10:54:02Z", "type": "forcePushed"}, {"oid": "c6a98c443352a6f0f24b01c5ceebad0cc92e12c0", "url": "https://github.com/minio/minio-java/commit/c6a98c443352a6f0f24b01c5ceebad0cc92e12c0", "message": "fix canonical header computation for multi-spaced header values", "committedDate": "2020-07-22T11:00:38Z", "type": "forcePushed"}, {"oid": "05aa0218aa12971214df256713d4105e1988aebc", "url": "https://github.com/minio/minio-java/commit/05aa0218aa12971214df256713d4105e1988aebc", "message": "fix canonical header computation for multi-spaced header values", "committedDate": "2020-07-22T11:04:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk5MzAyOA==", "url": "https://github.com/minio/minio-java/pull/1025#discussion_r458993028", "bodyText": "I am still unable to understand why this type of code is needed for canonicalHeaders, is the okhttp manipulating headers after they are set?\nNo other language SDK needs this type of handling - HTTP header values are opaque and should be kept opaque without any escaping etc unless specified with the protocol/server.\nI wonder if this is the correct fix here.", "author": "harshavardhana", "createdAt": "2020-07-22T18:21:01Z", "path": "api/src/main/java/io/minio/Signer.java", "diffHunk": "@@ -142,7 +143,14 @@ private void setCanonicalHeaders() {\n     for (String name : headers.names()) {\n       String signedHeader = name.toLowerCase(Locale.US);\n       if (!IGNORED_HEADERS.contains(signedHeader)) {\n-        this.canonicalHeaders.put(signedHeader, headers.get(name));\n+        this.canonicalHeaders.put(", "originalCommit": "05aa0218aa12971214df256713d4105e1988aebc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "84d4a72a3e9e713e4bd9655b3cfb2629825ab285", "chunk": "diff --git a/api/src/main/java/io/minio/Signer.java b/api/src/main/java/io/minio/Signer.java\nindex eddb6ce1..e7154cd2 100644\n--- a/api/src/main/java/io/minio/Signer.java\n+++ b/api/src/main/java/io/minio/Signer.java\n\n@@ -143,6 +143,10 @@ class Signer {\n     for (String name : headers.names()) {\n       String signedHeader = name.toLowerCase(Locale.US);\n       if (!IGNORED_HEADERS.contains(signedHeader)) {\n+        // Convert and add header values as per\n+        // https://docs.aws.amazon.com/general/latest/gr/sigv4-create-canonical-request.html\n+        // * Header having multiple values should be converted to comma separated values.\n+        // * Multi-spaced value of header should be trimmed to single spaced value.\n         this.canonicalHeaders.put(\n             signedHeader,\n             headers.values(name).stream()\n"}}, {"oid": "84d4a72a3e9e713e4bd9655b3cfb2629825ab285", "url": "https://github.com/minio/minio-java/commit/84d4a72a3e9e713e4bd9655b3cfb2629825ab285", "message": "fix canonical header computation for multi-spaced header values", "committedDate": "2020-07-22T19:02:48Z", "type": "commit"}, {"oid": "84d4a72a3e9e713e4bd9655b3cfb2629825ab285", "url": "https://github.com/minio/minio-java/commit/84d4a72a3e9e713e4bd9655b3cfb2629825ab285", "message": "fix canonical header computation for multi-spaced header values", "committedDate": "2020-07-22T19:02:48Z", "type": "forcePushed"}]}