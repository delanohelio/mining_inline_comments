{"pr_number": 844, "pr_title": "optimize putObject() to avoid reading data for known object size", "pr_createdAt": "2020-02-13T11:39:25Z", "pr_url": "https://github.com/minio/minio-java/pull/844", "timeline": [{"oid": "f86aac6d785af8f89f4bb0b1ce4679932abaeeec", "url": "https://github.com/minio/minio-java/commit/f86aac6d785af8f89f4bb0b1ce4679932abaeeec", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-14T05:45:52Z", "type": "forcePushed"}, {"oid": "5e1409e264f5b73ecd030737b8a46e5aa57b5726", "url": "https://github.com/minio/minio-java/commit/5e1409e264f5b73ecd030737b8a46e5aa57b5726", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-14T14:59:44Z", "type": "forcePushed"}, {"oid": "c3f01aa7b77fcd17582a1637a931e3d7511c65e3", "url": "https://github.com/minio/minio-java/commit/c3f01aa7b77fcd17582a1637a931e3d7511c65e3", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-15T01:28:45Z", "type": "forcePushed"}, {"oid": "7891a19de4a14ebf20b08de3abe15e92d22cf3d2", "url": "https://github.com/minio/minio-java/commit/7891a19de4a14ebf20b08de3abe15e92d22cf3d2", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-15T01:51:06Z", "type": "forcePushed"}, {"oid": "3af8457e30cf7c0bb280043fb4d9890de896c75f", "url": "https://github.com/minio/minio-java/commit/3af8457e30cf7c0bb280043fb4d9890de896c75f", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-15T02:19:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzYzNg==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r381093636", "bodyText": "can we have few tests with partSize set to specific numbers  e.g. here with new PutObjectOptions(9 * MB, 3)", "author": "nitisht", "createdAt": "2020-02-19T06:09:55Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -1623,7 +1656,7 @@ public static void listIncompleteUploads_test1() throws Exception {\n     try {\n       String objectName = getRandomName();\n       try (final InputStream is = new ContentInputStream(6 * MB)) {\n-        client.putObject(bucketName, objectName, is, Long.valueOf( 9 * MB), null, null, nullContentType);\n+        client.putObject(bucketName, objectName, is, new PutObjectOptions(9 * MB, -1));", "originalCommit": "564766d44baee332b6456ed190e830c14854f05a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEwNzM3OA==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r381107378", "bodyText": "listIncompleteUploads_test1() requires to have an incomplete (partial uploads). What do you mean by PutObjectOptions(9 * MB, 3)? Have you checked how those parameters mean to PutObjectOptions()?", "author": "balamurugana", "createdAt": "2020-02-19T07:01:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzYzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk5NTUzNA==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r381995534", "bodyText": "Have you checked how those parameters mean to PutObjectOptions()?\n\nI have checked. What I mean to say is I don't see a test case with partSize set to anything other than -1. We should have few tests where we pass partSize value to confirm if uploads work fine", "author": "nitisht", "createdAt": "2020-02-20T13:25:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzYzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAyMjg0NQ==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r382022845", "bodyText": "I am going to change few PutObjectOptions() with valid partSize on existing tests.", "author": "balamurugana", "createdAt": "2020-02-20T14:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzYzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA0ODY2NQ==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r382048665", "bodyText": "thanks", "author": "nitisht", "createdAt": "2020-02-20T14:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA5MzYzNg=="}], "type": "inlineReview", "revised_code": {"commit": "24c2eebaf9589a59382d6e9ccb4d6646d47543ce", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex 49f86439..e435cad7 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -1661,7 +1855,7 @@ public class FunctionalTest {\n         if (!e.errorResponse().code().equals(\"IncompleteBody\")) {\n           throw e;\n         }\n-      } catch (java.net.ProtocolException e) {\n+      } catch (java.io.IOException e) {\n         ignore();\n       }\n \n"}}, {"oid": "b44e0db2f945695a880b24d4389639d6c502c5e8", "url": "https://github.com/minio/minio-java/commit/b44e0db2f945695a880b24d4389639d6c502c5e8", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-20T14:16:51Z", "type": "forcePushed"}, {"oid": "2a93e3cfa8a48c58e9ca9cd5290a018bd5904932", "url": "https://github.com/minio/minio-java/commit/2a93e3cfa8a48c58e9ca9cd5290a018bd5904932", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-02-22T02:54:29Z", "type": "forcePushed"}, {"oid": "66870f3057c0ad4cd3c21b2bb1f5853805241f7a", "url": "https://github.com/minio/minio-java/commit/66870f3057c0ad4cd3c21b2bb1f5853805241f7a", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-06T14:31:00Z", "type": "forcePushed"}, {"oid": "0822114438ee36ef0b79dc7c388b1aaa3eb019a0", "url": "https://github.com/minio/minio-java/commit/0822114438ee36ef0b79dc7c388b1aaa3eb019a0", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-09T05:59:50Z", "type": "forcePushed"}, {"oid": "59b58a54f62e7a6d8687d9c5e946ffa919b8ffa1", "url": "https://github.com/minio/minio-java/commit/59b58a54f62e7a6d8687d9c5e946ffa919b8ffa1", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-09T07:16:10Z", "type": "forcePushed"}, {"oid": "8eacaf2100c75ea861ade0656a91efe2168ee43b", "url": "https://github.com/minio/minio-java/commit/8eacaf2100c75ea861ade0656a91efe2168ee43b", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-13T04:00:17Z", "type": "forcePushed"}, {"oid": "4c1f547ffaa659a7c8941949489ecd7cb286bfb6", "url": "https://github.com/minio/minio-java/commit/4c1f547ffaa659a7c8941949489ecd7cb286bfb6", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-14T10:45:55Z", "type": "forcePushed"}, {"oid": "24c2eebaf9589a59382d6e9ccb4d6646d47543ce", "url": "https://github.com/minio/minio-java/commit/24c2eebaf9589a59382d6e9ccb4d6646d47543ce", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-15T18:31:52Z", "type": "forcePushed"}, {"oid": "fa188b2a4bd610573ed2f5b953f418d79a68e393", "url": "https://github.com/minio/minio-java/commit/fa188b2a4bd610573ed2f5b953f418d79a68e393", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-15T18:32:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMjY1Mg==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r392702652", "bodyText": "Content-Type is passed as part of options' header will be overwritten by this. Is this the expected behavior?", "author": "kannappanr", "createdAt": "2020-03-15T19:07:10Z", "path": "api/src/main/java/io/minio/MinioClient.java", "diffHunk": "@@ -4163,9 +4163,7 @@ private void putObject(\n       headerMap.putAll(options.sse().headers());\n     }\n \n-    if (headerMap.get(\"Content-Type\") == null) {\n-      headerMap.put(\"Content-Type\", options.contentType());\n-    }\n+    headerMap.put(\"Content-Type\", options.contentType());", "originalCommit": "fa188b2a4bd610573ed2f5b953f418d79a68e393", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjczNTM0Mw==", "url": "https://github.com/minio/minio-java/pull/844#discussion_r392735343", "bodyText": "Please check PutObjectOptions.contentType() method for precedence.", "author": "balamurugana", "createdAt": "2020-03-16T00:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjcwMjY1Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c19d4bb7d6d6528d6e51ecde1fdb8032a6e15a53", "url": "https://github.com/minio/minio-java/commit/c19d4bb7d6d6528d6e51ecde1fdb8032a6e15a53", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-18T03:47:10Z", "type": "forcePushed"}, {"oid": "a6ce2c7d77152870c52ecd1b3498f97ec6ff5253", "url": "https://github.com/minio/minio-java/commit/a6ce2c7d77152870c52ecd1b3498f97ec6ff5253", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-19T16:32:55Z", "type": "commit"}, {"oid": "a6ce2c7d77152870c52ecd1b3498f97ec6ff5253", "url": "https://github.com/minio/minio-java/commit/a6ce2c7d77152870c52ecd1b3498f97ec6ff5253", "message": "optimize putObject() to avoid reading data for known object size", "committedDate": "2020-03-19T16:32:55Z", "type": "forcePushed"}]}