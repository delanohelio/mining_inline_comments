{"pr_number": 1021, "pr_title": "fix: use separate config dir for running local minio server in functional tests", "pr_createdAt": "2020-07-16T00:27:04Z", "pr_url": "https://github.com/minio/minio-java/pull/1021", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4OTEzOQ==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455489139", "bodyText": "Can we remove this environment variable? Since this is a breaking change or should we keep this for backward compatibility?", "author": "kannappanr", "createdAt": "2020-07-16T03:33:23Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3558,9 +3559,8 @@ public static void main(String[] args) throws Exception {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");", "originalCommit": "f8284d7a458b7a50ec5853506e21d54056694cf5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NTQzOQ==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455495439", "bodyText": "I don't why it is useful though @kannappanr", "author": "harshavardhana", "createdAt": "2020-07-16T03:58:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ4OTEzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex bcb60d74..59c9ee03 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -3559,8 +3558,9 @@ public class FunctionalTest {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");\n       if (kmsKeyName == null) {\n-        kmsKeyName = System.getenv(\"MINT_KMS_KEY_NAME\");\n+        kmsKeyName = System.getenv(\"MINT_KEY_ID\");\n       }\n+      sqsArn = System.getenv(\"MINIO_JAVA_TEST_SQS_ARN\");\n       endpoint = args[0];\n       accessKey = args[1];\n       secretKey = args[2];\n"}}, {"oid": "816fee21f380614c79152f11783a94159a414491", "url": "https://github.com/minio/minio-java/commit/816fee21f380614c79152f11783a94159a414491", "message": "fix: set region to empty to avoid loading local ENVs", "committedDate": "2020-07-16T04:29:14Z", "type": "forcePushed"}, {"oid": "e2cf3027efbaeaad20c0beb49d51643df18e90ca", "url": "https://github.com/minio/minio-java/commit/e2cf3027efbaeaad20c0beb49d51643df18e90ca", "message": "fix: set region to empty to avoid loading local ENVs", "committedDate": "2020-07-16T04:33:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455509342", "bodyText": "Any reason for removing this?", "author": "balamurugana", "createdAt": "2020-07-16T04:54:20Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3558,9 +3559,8 @@ public static void main(String[] args) throws Exception {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");\n       if (kmsKeyName == null) {\n-        kmsKeyName = System.getenv(\"MINT_KEY_ID\");\n+        kmsKeyName = System.getenv(\"MINT_KMS_KEY_NAME\");\n       }\n-      sqsArn = System.getenv(\"MINIO_JAVA_TEST_SQS_ARN\");", "originalCommit": "e2cf3027efbaeaad20c0beb49d51643df18e90ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUxMDg5OA==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455510898", "bodyText": "There is no purpose for this @balamurugana - can you explain why this exists?", "author": "harshavardhana", "createdAt": "2020-07-16T05:00:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUxNDkzNw==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455514937", "bodyText": "It is needed when running functional tests manually ./gradlew runFunctionalTest -Pendpoint=ENDPOINT -PaccessKey=ACCESSKEY -PsecretKey=SECRETKEY -Pregion=REGION; otherwise tests depend on sqsArn wouldn't run. There is no code without its purpose.", "author": "balamurugana", "createdAt": "2020-07-16T05:16:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUyODM2NA==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455528364", "bodyText": "Are you expecting users to know all of this run functional tests?", "author": "harshavardhana", "createdAt": "2020-07-16T06:01:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzMTA3Mg==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455531072", "bodyText": "Yes. In fact users never run functional tests, but developers do. If a developer is indented to test minio-java himself apart from CI, he has an option to do so. Also note that, Mint runs functional tests to test minio server by this way.", "author": "balamurugana", "createdAt": "2020-07-16T06:10:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUzNDE4MA==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455534180", "bodyText": "Yes but this is completely wrong,  one way is env, and another way is command line. It looks clunky way to test things. Why have this option in the first place?", "author": "harshavardhana", "createdAt": "2020-07-16T06:19:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTM0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex a9fad4c9..59c9ee03 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -3559,8 +3558,9 @@ public class FunctionalTest {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");\n       if (kmsKeyName == null) {\n-        kmsKeyName = System.getenv(\"MINT_KMS_KEY_NAME\");\n+        kmsKeyName = System.getenv(\"MINT_KEY_ID\");\n       }\n+      sqsArn = System.getenv(\"MINIO_JAVA_TEST_SQS_ARN\");\n       endpoint = args[0];\n       accessKey = args[1];\n       secretKey = args[2];\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTQ4OQ==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455509489", "bodyText": "Are you sure the env is changed from \"MINT_KEY_ID\" to \"MINT_KMS_KEY_NAME\"?", "author": "balamurugana", "createdAt": "2020-07-16T04:54:58Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -3558,9 +3559,8 @@ public static void main(String[] args) throws Exception {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");\n       if (kmsKeyName == null) {\n-        kmsKeyName = System.getenv(\"MINT_KEY_ID\");", "originalCommit": "e2cf3027efbaeaad20c0beb49d51643df18e90ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUxMDc4Mg==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455510782", "bodyText": "there is no MINT_KEY_ID env in mint @balamurugana - I just added this to make sure we keep it the same as MINIO_JAVA_TEST_KMS_KEY_NAME", "author": "harshavardhana", "createdAt": "2020-07-16T05:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTQ4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUxNDA1NQ==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455514055", "bodyText": "MINT_KEY_ID was introduced in #694 and available since last two years. Do you say it was a mistake in the PR?", "author": "balamurugana", "createdAt": "2020-07-16T05:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTQ4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUyODQ5Ng==", "url": "https://github.com/minio/minio-java/pull/1021#discussion_r455528496", "bodyText": "Yes it is not at all present in mint, it has been long removed.", "author": "harshavardhana", "createdAt": "2020-07-16T06:02:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTUwOTQ4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex a9fad4c9..59c9ee03 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -3559,8 +3558,9 @@ public class FunctionalTest {\n     } else {\n       kmsKeyName = System.getenv(\"MINIO_JAVA_TEST_KMS_KEY_NAME\");\n       if (kmsKeyName == null) {\n-        kmsKeyName = System.getenv(\"MINT_KMS_KEY_NAME\");\n+        kmsKeyName = System.getenv(\"MINT_KEY_ID\");\n       }\n+      sqsArn = System.getenv(\"MINIO_JAVA_TEST_SQS_ARN\");\n       endpoint = args[0];\n       accessKey = args[1];\n       secretKey = args[2];\n"}}, {"oid": "69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "url": "https://github.com/minio/minio-java/commit/69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "message": "fix: set region to empty to avoid loading local ENVs", "committedDate": "2020-07-16T06:34:21Z", "type": "commit"}, {"oid": "69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "url": "https://github.com/minio/minio-java/commit/69d8aa3fbd5f479691d2e6cbe585c4ecec0e4a83", "message": "fix: set region to empty to avoid loading local ENVs", "committedDate": "2020-07-16T06:34:21Z", "type": "forcePushed"}]}