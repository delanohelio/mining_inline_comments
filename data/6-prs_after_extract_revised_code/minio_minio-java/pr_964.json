{"pr_number": 964, "pr_title": "Implement args builder for selectObjectContent API", "pr_createdAt": "2020-06-01T06:17:32Z", "pr_url": "https://github.com/minio/minio-java/pull/964", "timeline": [{"oid": "27507a4b84f9f1bf6eff27a521e568edc3204e41", "url": "https://github.com/minio/minio-java/commit/27507a4b84f9f1bf6eff27a521e568edc3204e41", "message": "Implement args builder for selectObjectContent API\n\nIntroduced new args class SelectObjectContentArgs that extends from\nSsecObjectArgs and has the following attributes:\n  - bucket (inherited)\n  - object (inherited)\n  - ssec (inherited)\n  - sqlExpression\n  - inputSerialization\n  - outputSerialization\n  - requestProgress\n  - scanStartRange\n  - scanEndRange", "committedDate": "2020-06-01T06:36:53Z", "type": "forcePushed"}, {"oid": "8fb642c42500ba91198865280739e734dab5c414", "url": "https://github.com/minio/minio-java/commit/8fb642c42500ba91198865280739e734dab5c414", "message": "Implement args builder for selectObjectContent API\n\nIntroduced new args class SelectObjectContentArgs that extends from\nSsecObjectArgs and has the following attributes:\n  - bucket (inherited)\n  - object (inherited)\n  - ssec (inherited)\n  - sqlExpression\n  - inputSerialization\n  - outputSerialization\n  - requestProgress\n  - scanStartRange\n  - scanEndRange", "committedDate": "2020-06-01T06:48:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MjkyMQ==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433292921", "bodyText": "We would need to validate sqlExpression is not null and not empty.", "author": "balamurugana", "createdAt": "2020-06-01T15:10:39Z", "path": "api/src/main/java/io/minio/SelectObjectContentArgs.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage,\n+ * (C) 2015, 2016, 2017, 2018, 2019 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.InputSerialization;\n+import io.minio.messages.OutputSerialization;\n+\n+public class SelectObjectContentArgs extends SsecObjectArgs {\n+  private String sqlExpression;\n+  private InputSerialization inputSerialization;\n+  private OutputSerialization outputSerialization;\n+  private Boolean requestProgress;\n+  private Long scanStartRange;\n+  private Long scanEndRange;\n+\n+  public Long scanEndRange() {\n+    return scanEndRange;\n+  }\n+\n+  public Long scanStartRange() {\n+    return scanStartRange;\n+  }\n+\n+  public Boolean requestProgress() {\n+    return requestProgress;\n+  }\n+\n+  public OutputSerialization outputSerialization() {\n+    return outputSerialization;\n+  }\n+\n+  public InputSerialization inputSerialization() {\n+    return inputSerialization;\n+  }\n+\n+  public String sqlExpression() {\n+    return sqlExpression;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static final class Builder\n+      extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    public Builder sqlExpression(String sqlExpression) {", "originalCommit": "8fb642c42500ba91198865280739e734dab5c414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM0MzU0Ng==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433343546", "bodyText": "Will add the validation", "author": "anjalshireesh", "createdAt": "2020-06-01T16:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MjkyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "chunk": "diff --git a/api/src/main/java/io/minio/SelectObjectContentArgs.java b/api/src/main/java/io/minio/SelectObjectContentArgs.java\nindex 6ccf452f..d7cce2d2 100644\n--- a/api/src/main/java/io/minio/SelectObjectContentArgs.java\n+++ b/api/src/main/java/io/minio/SelectObjectContentArgs.java\n\n@@ -58,17 +58,32 @@ public class SelectObjectContentArgs extends SsecObjectArgs {\n \n   public static final class Builder\n       extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    private void validateSqlExpression(String se) {\n+      validateNotEmptyString(se, \"sqlExpression\");\n+    }\n+\n     public Builder sqlExpression(String sqlExpression) {\n+      validateSqlExpression(sqlExpression);\n       operations.add(args -> args.sqlExpression = sqlExpression);\n       return this;\n     }\n \n+    private void validateInputSerialization(InputSerialization is) {\n+      validateNotNull(is, \"inputSerialization\");\n+    }\n+\n     public Builder inputSerialization(InputSerialization inputSerialization) {\n+      validateInputSerialization(inputSerialization);\n       operations.add(args -> args.inputSerialization = inputSerialization);\n       return this;\n     }\n \n+    private void validateOutputSerialization(OutputSerialization os) {\n+      validateNotNull(os, \"outputSerialization\");\n+    }\n+\n     public Builder outputSerialization(OutputSerialization outputSerialization) {\n+      validateOutputSerialization(outputSerialization);\n       operations.add(args -> args.outputSerialization = outputSerialization);\n       return this;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MzM0NA==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433293344", "bodyText": "inputSerialization can be validated to non-null.", "author": "balamurugana", "createdAt": "2020-06-01T15:11:20Z", "path": "api/src/main/java/io/minio/SelectObjectContentArgs.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage,\n+ * (C) 2015, 2016, 2017, 2018, 2019 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.InputSerialization;\n+import io.minio.messages.OutputSerialization;\n+\n+public class SelectObjectContentArgs extends SsecObjectArgs {\n+  private String sqlExpression;\n+  private InputSerialization inputSerialization;\n+  private OutputSerialization outputSerialization;\n+  private Boolean requestProgress;\n+  private Long scanStartRange;\n+  private Long scanEndRange;\n+\n+  public Long scanEndRange() {\n+    return scanEndRange;\n+  }\n+\n+  public Long scanStartRange() {\n+    return scanStartRange;\n+  }\n+\n+  public Boolean requestProgress() {\n+    return requestProgress;\n+  }\n+\n+  public OutputSerialization outputSerialization() {\n+    return outputSerialization;\n+  }\n+\n+  public InputSerialization inputSerialization() {\n+    return inputSerialization;\n+  }\n+\n+  public String sqlExpression() {\n+    return sqlExpression;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static final class Builder\n+      extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    public Builder sqlExpression(String sqlExpression) {\n+      operations.add(args -> args.sqlExpression = sqlExpression);\n+      return this;\n+    }\n+\n+    public Builder inputSerialization(InputSerialization inputSerialization) {", "originalCommit": "8fb642c42500ba91198865280739e734dab5c414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM0MzY1OQ==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433343659", "bodyText": "Will add the validation", "author": "anjalshireesh", "createdAt": "2020-06-01T16:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5MzM0NA=="}], "type": "inlineReview", "revised_code": {"commit": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "chunk": "diff --git a/api/src/main/java/io/minio/SelectObjectContentArgs.java b/api/src/main/java/io/minio/SelectObjectContentArgs.java\nindex 6ccf452f..d7cce2d2 100644\n--- a/api/src/main/java/io/minio/SelectObjectContentArgs.java\n+++ b/api/src/main/java/io/minio/SelectObjectContentArgs.java\n\n@@ -58,17 +58,32 @@ public class SelectObjectContentArgs extends SsecObjectArgs {\n \n   public static final class Builder\n       extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    private void validateSqlExpression(String se) {\n+      validateNotEmptyString(se, \"sqlExpression\");\n+    }\n+\n     public Builder sqlExpression(String sqlExpression) {\n+      validateSqlExpression(sqlExpression);\n       operations.add(args -> args.sqlExpression = sqlExpression);\n       return this;\n     }\n \n+    private void validateInputSerialization(InputSerialization is) {\n+      validateNotNull(is, \"inputSerialization\");\n+    }\n+\n     public Builder inputSerialization(InputSerialization inputSerialization) {\n+      validateInputSerialization(inputSerialization);\n       operations.add(args -> args.inputSerialization = inputSerialization);\n       return this;\n     }\n \n+    private void validateOutputSerialization(OutputSerialization os) {\n+      validateNotNull(os, \"outputSerialization\");\n+    }\n+\n     public Builder outputSerialization(OutputSerialization outputSerialization) {\n+      validateOutputSerialization(outputSerialization);\n       operations.add(args -> args.outputSerialization = outputSerialization);\n       return this;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5Mzc3Nw==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433293777", "bodyText": "outputSerialization can be validated to non-null.\nAlso we need to have validate() method to validate sqlExpression, inputSerialization and outputSerialization", "author": "balamurugana", "createdAt": "2020-06-01T15:12:07Z", "path": "api/src/main/java/io/minio/SelectObjectContentArgs.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage,\n+ * (C) 2015, 2016, 2017, 2018, 2019 MinIO, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.minio;\n+\n+import io.minio.messages.InputSerialization;\n+import io.minio.messages.OutputSerialization;\n+\n+public class SelectObjectContentArgs extends SsecObjectArgs {\n+  private String sqlExpression;\n+  private InputSerialization inputSerialization;\n+  private OutputSerialization outputSerialization;\n+  private Boolean requestProgress;\n+  private Long scanStartRange;\n+  private Long scanEndRange;\n+\n+  public Long scanEndRange() {\n+    return scanEndRange;\n+  }\n+\n+  public Long scanStartRange() {\n+    return scanStartRange;\n+  }\n+\n+  public Boolean requestProgress() {\n+    return requestProgress;\n+  }\n+\n+  public OutputSerialization outputSerialization() {\n+    return outputSerialization;\n+  }\n+\n+  public InputSerialization inputSerialization() {\n+    return inputSerialization;\n+  }\n+\n+  public String sqlExpression() {\n+    return sqlExpression;\n+  }\n+\n+  public static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  public static final class Builder\n+      extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    public Builder sqlExpression(String sqlExpression) {\n+      operations.add(args -> args.sqlExpression = sqlExpression);\n+      return this;\n+    }\n+\n+    public Builder inputSerialization(InputSerialization inputSerialization) {\n+      operations.add(args -> args.inputSerialization = inputSerialization);\n+      return this;\n+    }\n+\n+    public Builder outputSerialization(OutputSerialization outputSerialization) {", "originalCommit": "8fb642c42500ba91198865280739e734dab5c414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM0Mzg3NQ==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433343875", "bodyText": "Will add", "author": "anjalshireesh", "createdAt": "2020-06-01T16:21:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5Mzc3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "chunk": "diff --git a/api/src/main/java/io/minio/SelectObjectContentArgs.java b/api/src/main/java/io/minio/SelectObjectContentArgs.java\nindex 6ccf452f..d7cce2d2 100644\n--- a/api/src/main/java/io/minio/SelectObjectContentArgs.java\n+++ b/api/src/main/java/io/minio/SelectObjectContentArgs.java\n\n@@ -58,17 +58,32 @@ public class SelectObjectContentArgs extends SsecObjectArgs {\n \n   public static final class Builder\n       extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n+    private void validateSqlExpression(String se) {\n+      validateNotEmptyString(se, \"sqlExpression\");\n+    }\n+\n     public Builder sqlExpression(String sqlExpression) {\n+      validateSqlExpression(sqlExpression);\n       operations.add(args -> args.sqlExpression = sqlExpression);\n       return this;\n     }\n \n+    private void validateInputSerialization(InputSerialization is) {\n+      validateNotNull(is, \"inputSerialization\");\n+    }\n+\n     public Builder inputSerialization(InputSerialization inputSerialization) {\n+      validateInputSerialization(inputSerialization);\n       operations.add(args -> args.inputSerialization = inputSerialization);\n       return this;\n     }\n \n+    private void validateOutputSerialization(OutputSerialization os) {\n+      validateNotNull(os, \"outputSerialization\");\n+    }\n+\n     public Builder outputSerialization(OutputSerialization outputSerialization) {\n+      validateOutputSerialization(outputSerialization);\n       operations.add(args -> args.outputSerialization = outputSerialization);\n       return this;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NTY3OQ==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433295679", "bodyText": "We can use handleException() here.", "author": "balamurugana", "createdAt": "2020-06-01T15:15:09Z", "path": "functional/FunctionalTest.java", "diffHunk": "@@ -4287,11 +4293,11 @@ public static void selectObjectContent_test1() throws Exception {\n             \"stats.bytesReturned mismatch; expected: 222, got: \" + stats.bytesReturned());\n       }\n \n-      mintSuccessLog(testName, null, startTime);\n+      mintSuccessLog(methodName, args, startTime);\n     } catch (Exception e) {\n       mintFailedLog(", "originalCommit": "8fb642c42500ba91198865280739e734dab5c414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM0NjQwNA==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433346404", "bodyText": "Will do", "author": "anjalshireesh", "createdAt": "2020-06-01T16:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI5NTY3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "chunk": "diff --git a/functional/FunctionalTest.java b/functional/FunctionalTest.java\nindex 19453b49..2eca4cbb 100644\n--- a/functional/FunctionalTest.java\n+++ b/functional/FunctionalTest.java\n\n@@ -4295,13 +4295,7 @@ public class FunctionalTest {\n \n       mintSuccessLog(methodName, args, startTime);\n     } catch (Exception e) {\n-      mintFailedLog(\n-          methodName,\n-          args,\n-          startTime,\n-          null,\n-          e.toString() + \" >>> \" + Arrays.toString(e.getStackTrace()));\n-      throw e;\n+      handleException(methodName, args, startTime, e);\n     } finally {\n       if (responseStream != null) {\n         responseStream.close();\n"}}, {"oid": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "url": "https://github.com/minio/minio-java/commit/3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "message": "Add validations in SelectObjectContentArgs\n\n- SQL Expression must be non-null and not empty\n- inputSerialization must not be null\n- outputSerialization must not be null\n\nAs part of this, added a couple of validation methods in `BaseArgs` that\ncan be used in any of the subclasses:\n\n- validateNotNull(Object arg, String argName)\n- validateNotEmptyString(String arg, String argName)", "committedDate": "2020-06-01T16:43:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NzA2Ng==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433657066", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * (C) 2015, 2016, 2017, 2018, 2019 MinIO, Inc.\n          \n          \n            \n             * (C) 2020 MinIO, Inc.", "author": "kannappanr", "createdAt": "2020-06-02T06:52:07Z", "path": "api/src/main/java/io/minio/SelectObjectContentArgs.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * MinIO Java SDK for Amazon S3 Compatible Cloud Storage,\n+ * (C) 2015, 2016, 2017, 2018, 2019 MinIO, Inc.", "originalCommit": "3486d8e17d2f62fb3f491c63efecfec0aa4a333d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgzNTk0MQ==", "url": "https://github.com/minio/minio-java/pull/964#discussion_r433835941", "bodyText": "Will change", "author": "anjalshireesh", "createdAt": "2020-06-02T12:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY1NzA2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "1596ebc6b257b6e0864bcde97e1c5aa0734fccb9", "chunk": "diff --git a/api/src/main/java/io/minio/SelectObjectContentArgs.java b/api/src/main/java/io/minio/SelectObjectContentArgs.java\nindex d7cce2d2..6ccf452f 100644\n--- a/api/src/main/java/io/minio/SelectObjectContentArgs.java\n+++ b/api/src/main/java/io/minio/SelectObjectContentArgs.java\n\n@@ -58,32 +58,17 @@ public class SelectObjectContentArgs extends SsecObjectArgs {\n \n   public static final class Builder\n       extends SsecObjectArgs.Builder<Builder, SelectObjectContentArgs> {\n-    private void validateSqlExpression(String se) {\n-      validateNotEmptyString(se, \"sqlExpression\");\n-    }\n-\n     public Builder sqlExpression(String sqlExpression) {\n-      validateSqlExpression(sqlExpression);\n       operations.add(args -> args.sqlExpression = sqlExpression);\n       return this;\n     }\n \n-    private void validateInputSerialization(InputSerialization is) {\n-      validateNotNull(is, \"inputSerialization\");\n-    }\n-\n     public Builder inputSerialization(InputSerialization inputSerialization) {\n-      validateInputSerialization(inputSerialization);\n       operations.add(args -> args.inputSerialization = inputSerialization);\n       return this;\n     }\n \n-    private void validateOutputSerialization(OutputSerialization os) {\n-      validateNotNull(os, \"outputSerialization\");\n-    }\n-\n     public Builder outputSerialization(OutputSerialization outputSerialization) {\n-      validateOutputSerialization(outputSerialization);\n       operations.add(args -> args.outputSerialization = outputSerialization);\n       return this;\n     }\n"}}, {"oid": "1596ebc6b257b6e0864bcde97e1c5aa0734fccb9", "url": "https://github.com/minio/minio-java/commit/1596ebc6b257b6e0864bcde97e1c5aa0734fccb9", "message": "Implement args builder for selectObjectContent API\n\nIntroduced new args class SelectObjectContentArgs that extends from\nSsecObjectArgs and has the following attributes:\n  - bucket (inherited)\n  - object (inherited)\n  - ssec (inherited)\n  - sqlExpression\n  - inputSerialization\n  - outputSerialization\n  - requestProgress\n  - scanStartRange\n  - scanEndRange", "committedDate": "2020-06-02T12:27:35Z", "type": "commit"}, {"oid": "dd42f8747f28e3069f8be1afc11038df46d11add", "url": "https://github.com/minio/minio-java/commit/dd42f8747f28e3069f8be1afc11038df46d11add", "message": "Add validations in SelectObjectContentArgs\n\n- SQL Expression must be non-null and not empty\n- inputSerialization must not be null\n- outputSerialization must not be null\n\nAs part of this, added a couple of validation methods in `BaseArgs` that\ncan be used in any of the subclasses:\n\n- validateNotNull(Object arg, String argName)\n- validateNotEmptyString(String arg, String argName)", "committedDate": "2020-06-02T12:27:35Z", "type": "commit"}, {"oid": "422fb095e7c886ccc3354be16f24bd7f40abb71d", "url": "https://github.com/minio/minio-java/commit/422fb095e7c886ccc3354be16f24bd7f40abb71d", "message": "Change copyright year to just 2020 in new file", "committedDate": "2020-06-02T12:28:00Z", "type": "commit"}, {"oid": "422fb095e7c886ccc3354be16f24bd7f40abb71d", "url": "https://github.com/minio/minio-java/commit/422fb095e7c886ccc3354be16f24bd7f40abb71d", "message": "Change copyright year to just 2020 in new file", "committedDate": "2020-06-02T12:28:00Z", "type": "forcePushed"}]}