{"pr_number": 2897, "pr_title": "Fix sonar cloud 2020 03 06", "pr_createdAt": "2020-03-17T10:51:45Z", "pr_url": "https://github.com/eclipse/kapua/pull/2897", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYxMzU0Ng==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r393613546", "bodyText": "did you change the loadConnectionUserCouplingModeFromConfig?\nisn't it no more bound to a scope?", "author": "riccardomodanese", "createdAt": "2020-03-17T11:33:12Z", "path": "broker-core/src/main/java/org/eclipse/kapua/broker/core/plugin/authentication/AuthenticationLogic.java", "diffHunk": "@@ -165,12 +166,12 @@ protected void enforceDeviceConnectionUserBound(Map<String, Object> options, Dev\n         if (deviceConnection != null) {\n             ConnectionUserCouplingMode connectionUserCouplingMode = deviceConnection.getUserCouplingMode();\n             if (ConnectionUserCouplingMode.INHERITED.equals(deviceConnection.getUserCouplingMode())) {\n-                connectionUserCouplingMode = loadConnectionUserCouplingModeFromConfig(scopeId, options);\n+                connectionUserCouplingMode = loadConnectionUserCouplingModeFromConfig(options);", "originalCommit": "54ceb127c3d7fdaef5d21df8dd436b764bedd736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY0NDQ1NQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r393644455", "bodyText": "scopeId is not used in loadConnectionUserCouplingModeFromConfig(), so it has been removed from the method signature.\nSee AuthenticationLogic.java:246", "author": "lorthirk", "createdAt": "2020-03-17T12:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYxMzU0Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyNjkwMg==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r393626902", "bodyText": "I dont' recall why we commented this code but, looking at it, I would leave it here for a while, waiting for a proper analysis about its role", "author": "riccardomodanese", "createdAt": "2020-03-17T11:58:49Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/event/ServiceInspector.java", "diffHunk": "@@ -108,121 +108,36 @@ private ServiceInspector() {}\n \n         return configurations;\n     }\n-//", "originalCommit": "54ceb127c3d7fdaef5d21df8dd436b764bedd736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzY0Njc4MQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r393646781", "bodyText": "That code is commented since 1620737 (committed on 22/12/2017), which is the first commit containing this file. This means that this code has always been a comment in its entire life.", "author": "lorthirk", "createdAt": "2020-03-17T12:36:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYyNjkwMg=="}], "type": "inlineReview", "revised_code": {"commit": "16842a239b105375d01c52d2b72bbe734292d2dc", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/event/ServiceInspector.java b/commons/src/main/java/org/eclipse/kapua/commons/event/ServiceInspector.java\nindex cb24418040..f77fd16301 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/event/ServiceInspector.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/event/ServiceInspector.java\n\n@@ -108,36 +108,121 @@ public class ServiceInspector {\n \n         return configurations;\n     }\n+//\n+//    public static List<ServiceEventListenerConfiguration> getEventBusListeners(KapuaService aService, Class<? extends KapuaService> clazz) {\n+//\n+//        String subAddress = clazz.getName();\n+//\n+//        Method[] methods;\n+//        boolean isEnhancedClass = isEnhancedClass(aService);\n+//        if (isEnhancedClass) {\n+//            methods = getSuperMethods(aService);\n+//        } else {\n+//            methods = getMethods(aService);\n+//        }\n+//\n+//        List<ServiceEventListenerConfiguration> configurations = new ArrayList<>();\n+//        for (Method method : methods) {\n+//            ListenServiceEvent[] listenAnnotations = method.getAnnotationsByType(ListenServiceEvent.class);\n+//            if (listenAnnotations != null) {\n+//\n+//                Method enhancedMethod = null;\n+//                try {\n+//                    enhancedMethod = aService.getClass().getMethod(method.getName(), method.getParameterTypes());\n+//                    if (!enhancedMethod.getReturnType().equals(Void.class)) {\n+//                        KapuaRuntimeException.internalError(\"Invalid method signature: return type, expected Void\");\n+//                    }\n+//                    int paramsSize = enhancedMethod.getParameterTypes().length;\n+//                    if (paramsSize != 1) {\n+//                        KapuaRuntimeException.internalError(String.format(\"Invalid method signature: number of parameters %d, expected 1\", paramsSize));\n+//                    }\n+//                    Class<?> paramClazz = enhancedMethod.getParameterTypes()[0];\n+//                    if (enhancedMethod.getParameterTypes()[0].equals(ServiceEvent.class)) {\n+//                        KapuaRuntimeException.internalError(String.format(\"Invalid method signature: type of parameters %s, expected ServiceEvent\", paramClazz));\n+//                    }\n+//                } catch (NoSuchMethodException | SecurityException e1) {\n+//                    KapuaRuntimeException.internalError(e1, String.format(\"Unable to get the annotated method: annotation %s\", ListenServiceEvent.class));\n+//                }\n+//\n+//                for (ListenServiceEvent listenAnnotation:listenAnnotations) {\n+//                    final Method listenerMethod = enhancedMethod;\n+//                    configurations.add(\n+//                        new ServiceEventListenerConfiguration(\n+//                                listenAnnotation.fromAddress(),\n+//                                subAddress,\n+//                                (serviceEvent) -> {\n+//                                    try {\n+//                                        listenerMethod.invoke(aService, new Object[] { serviceEvent });\n+//                                    } catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {\n+//                                        KapuaException.internalError(e, String.format(\"Error invoking method %s\", method.getName()));\n+//                                    }\n+//                                }));\n+//                }\n+//            }\n+//        }\n+//\n+//        return configurations;\n+//    }\n+//\n+\n+    private static boolean isEnhancedClass(Object obj) {\n+        String canonicalName = obj.getClass().getCanonicalName();\n+        boolean isEnhanced = canonicalName.contains(GUICE_ENHANCER_TAG);\n+        return isEnhanced;\n+    }\n+\n+    private static Class<?> getSuperClass(Object obj) {\n+        return obj.getClass().getSuperclass();\n+    }\n+\n+    private static Method[] getSuperMethods(Object obj) {\n+        Class<?> superclass = obj.getClass().getSuperclass();\n+        Method[] superMethod = superclass.getMethods();\n+        return superMethod;\n+    }\n+\n+    private static Method[] getMethods(Object obj) {\n+        Method[] superMethod = obj.getClass().getMethods();\n+        return superMethod;\n+    }\n \n     private static Method getMatchingMethod(Class<?> clazz, Method method) throws NoSuchMethodException {\n         Method[] methods = clazz.getMethods();\n-        Method matchingMethod = null;\n-\n-        if (methods.length > 0) {\n-            List<Class<?>> methodParamTypes = Arrays.asList(method.getParameterTypes());\n+        if (methods == null || methods.length == 0) {\n+            return null;\n+        }\n \n-            for (Method candidate : methods) {\n-                if (!candidate.getName().equals(method.getName())) {\n-                    continue;\n-                }\n-                if (!candidate.getReturnType().equals(method.getReturnType())) {\n-                    continue;\n-                }\n+        List<Class<?>> methodParamTypes = Arrays.asList(method.getParameterTypes());\n \n-                List<Class<?>> candidateParamTypes = Arrays.asList(method.getParameterTypes());\n+        Method matchingMethod = null;\n+        for (Method candidate:methods) {\n+            if (!candidate.getName().equals(method.getName())) {\n+                continue;\n+            }\n+            if (!candidate.getReturnType().equals(method.getReturnType())) {\n+                continue;\n+            }\n \n-                if (candidateParamTypes.size() != methodParamTypes.size() || !candidateParamTypes.containsAll(methodParamTypes)) {\n-                    continue;\n-                }\n+            List<Class<?>> candidateParamTypes = Arrays.asList(method.getParameterTypes());\n \n-                matchingMethod = candidate;\n-                break;\n+            if (candidateParamTypes.size() != methodParamTypes.size() || !candidateParamTypes.containsAll(methodParamTypes)) {\n+                continue;\n             }\n+\n+            matchingMethod = candidate;\n+            break;\n         }\n+\n         if (matchingMethod == null) {\n             throw new NoSuchMethodException(method.getName());\n         }\n         return matchingMethod;\n     }\n \n+    private static boolean isNullOrEmpty(Object[] array) {\n+        if (array == null || array.length == 0) {\n+            return true;\n+        }\n+        return false;\n+    }\n }\n"}}, {"oid": "215273fb5d8bdf5f7a9b39560d89f63d0f928305", "url": "https://github.com/eclipse/kapua/commit/215273fb5d8bdf5f7a9b39560d89f63d0f928305", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-18T08:34:56Z", "type": "forcePushed"}, {"oid": "c64cd20870498b5c0f8a449ed4e71002109c9e0a", "url": "https://github.com/eclipse/kapua/commit/c64cd20870498b5c0f8a449ed4e71002109c9e0a", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-18T10:06:30Z", "type": "forcePushed"}, {"oid": "6fea97e334f937102ab8c8f4f429623c1d145615", "url": "https://github.com/eclipse/kapua/commit/6fea97e334f937102ab8c8f4f429623c1d145615", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-18T10:20:23Z", "type": "forcePushed"}, {"oid": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "url": "https://github.com/eclipse/kapua/commit/c3a8a5028ff956414f2624efd0937f7f634d4bbd", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-18T12:17:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA3ODIxOQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395078219", "bodyText": "\ud83d\ude0d", "author": "Coduz", "createdAt": "2020-03-19T14:41:59Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java", "diffHunk": "@@ -92,16 +98,10 @@ private static KapuaTmetadata readMetadata(String pid) throws Exception {\n      * @param parentId\n      * @throws KapuaException\n      */\n-    private void validateConfigurations(String pid, KapuaTocd ocd, Map<String, Object> updatedProps, KapuaId scopeId, KapuaId parentId)\n+    private void validateConfigurations(KapuaTocd ocd, Map<String, Object> updatedProps, KapuaId scopeId, KapuaId parentId)\n             throws KapuaException {\n         if (ocd != null) {\n-\n-            // build a map of all the attribute definitions\n-            Map<String, KapuaTad> attrDefs = new HashMap<>();\n-            List<KapuaTad> defs = ocd.getAD();\n-            for (KapuaTad def : defs) {\n-                attrDefs.put(def.getId(), def);\n-            }\n+            Map<String, KapuaTad> attrDefs = ocd.getAD().stream().collect(Collectors.toMap(KapuaTad::getId, def -> def));", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3efcdb4695d5693194550a7da8ddee4830a595bc", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java b/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\nindex be31f1c526..9be82cfec6 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\n\n@@ -101,7 +134,20 @@ public abstract class AbstractKapuaConfigurableService extends AbstractKapuaServ\n     private void validateConfigurations(KapuaTocd ocd, Map<String, Object> updatedProps, KapuaId scopeId, KapuaId parentId)\n             throws KapuaException {\n         if (ocd != null) {\n-            Map<String, KapuaTad> attrDefs = ocd.getAD().stream().collect(Collectors.toMap(KapuaTad::getId, def -> def));\n+\n+            // Get Disabled Properties\n+            List<KapuaTad> disabledProperties = ocd.getAD().stream().filter(ad -> !isPropertyEnabled(ad, scopeId)).collect(Collectors.toList());\n+\n+            if (!disabledProperties.isEmpty()) {\n+                // If there's any disabled property, read current values to overwrite the proposed ones\n+                Map<String, Object> originalValues = getConfigValues(scopeId, false);\n+                if (originalValues != null) {\n+                    disabledProperties.forEach(disabledProp -> updatedProps.put(disabledProp.getId(), originalValues.get(disabledProp.getId())));\n+                }\n+            }\n+\n+            // build a map of all the attribute definitions\n+            Map<String, KapuaTad> attrDefs = ocd.getAD().stream().collect(Collectors.toMap(KapuaTad::getId, ad -> ad));\n \n             // loop over the proposed property values\n             // and validate them against the definition\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA3ODM2Mg==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395078362", "bodyText": "\ud83d\ude0d", "author": "Coduz", "createdAt": "2020-03-19T14:42:10Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java", "diffHunk": "@@ -133,22 +133,34 @@ private void validateConfigurations(String pid, KapuaTocd ocd, Map<String, Objec\n                 }\n             }\n \n-            // make sure all required properties are set\n-            for (KapuaTad attrDef : ocd.getAD()) {\n-                // to the required attributes make sure a value is defined.\n-                if (attrDef.isRequired()) {\n-                    if (updatedProps.get(attrDef.getId()) == null) {\n-                        // if the default one is not defined, throw\n-                        // exception.\n-                        throw new KapuaConfigurationException(KapuaConfigurationErrorCodes.REQUIRED_ATTRIBUTE_MISSING, attrDef.getId());\n-                    }\n-                }\n-            }\n+            checkRequiredProperties(ocd, updatedProps);", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "16842a239b105375d01c52d2b72bbe734292d2dc", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java b/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\nindex be31f1c526..8aeb09a966 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/configuration/AbstractKapuaConfigurableService.java\n\n@@ -133,34 +174,22 @@ public abstract class AbstractKapuaConfigurableService extends AbstractKapuaServ\n                 }\n             }\n \n-            checkRequiredProperties(ocd, updatedProps);\n+            // make sure all required properties are set\n+            for (KapuaTad attrDef : ocd.getAD()) {\n+                // to the required attributes make sure a value is defined.\n+                if (attrDef.isRequired()) {\n+                    if (updatedProps.get(attrDef.getId()) == null) {\n+                        // if the default one is not defined, throw\n+                        // exception.\n+                        throw new KapuaConfigurationException(KapuaConfigurationErrorCodes.REQUIRED_ATTRIBUTE_MISSING, attrDef.getId());\n+                    }\n+                }\n+            }\n \n             validateNewConfigValuesCoherence(ocd, updatedProps, scopeId, parentId);\n         }\n     }\n \n-    private void checkRequiredProperties(KapuaTocd ocd, Map<String, Object> updatedProps) throws KapuaConfigurationException {\n-        // make sure all required properties are set\n-        for (KapuaTad attrDef : ocd.getAD()) {\n-            // to the required attributes make sure a value is defined.\n-            if (Boolean.TRUE.equals(attrDef.isRequired()) && updatedProps.get(attrDef.getId()) == null) {\n-                // if the default one is not defined, throw\n-                // exception.\n-                throw new KapuaConfigurationException(KapuaConfigurationErrorCodes.REQUIRED_ATTRIBUTE_MISSING, attrDef.getId());\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Validates that the configurations is coherent. By default returns true, but an extending {@link org.eclipse.kapua.service.KapuaService}\n-     * may have its own logic\n-     * @param ocd               The {@link KapuaTocd} containing the definition of the service configurations\n-     * @param updatedProps      A {@link Map} containing the new values for the service\n-     * @param scopeId           The Scope ID of the current configuration\n-     * @param parentId          The ID of the Parent Scope\n-     * @return                  {@literal true} if the configuration is valid, {@literal false} otherwise\n-     * @throws KapuaException   When something goes wrong\n-     */\n     protected boolean validateNewConfigValuesCoherence(KapuaTocd ocd, Map<String, Object> updatedProps, KapuaId scopeId, KapuaId parentId) throws KapuaException {\n         return true;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4NDkyNw==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395084927", "bodyText": "For all of this class I would use scopeId and id for as argument names so we can fall back on values coming from the EntityAttributes", "author": "Coduz", "createdAt": "2020-03-19T14:50:44Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/service/event/store/internal/EventStoreServiceImpl.java", "diffHunk": "@@ -42,6 +42,7 @@\n     private static final AuthorizationService AUTHORIZATION_SERVICE = LOCATOR.getService(AuthorizationService.class);\n     private static final PermissionFactory PERMISSION_FACTORY = LOCATOR.getFactory(PermissionFactory.class);\n \n+    private static final String KAPUA_EVENT_ID = \"kapuaEventId\";", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/service/event/store/internal/EventStoreServiceImpl.java b/commons/src/main/java/org/eclipse/kapua/commons/service/event/store/internal/EventStoreServiceImpl.java\nindex 0706e12963..8b36ed7618 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/service/event/store/internal/EventStoreServiceImpl.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/service/event/store/internal/EventStoreServiceImpl.java\n\n@@ -42,7 +43,6 @@ public class EventStoreServiceImpl extends AbstractKapuaService implements Event\n     private static final AuthorizationService AUTHORIZATION_SERVICE = LOCATOR.getService(AuthorizationService.class);\n     private static final PermissionFactory PERMISSION_FACTORY = LOCATOR.getFactory(PermissionFactory.class);\n \n-    private static final String KAPUA_EVENT_ID = \"kapuaEventId\";\n     /**\n      * Constructor.\n      *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4NjIxNw==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395086217", "bodyText": "It is possibile to change this to use Pattern?", "author": "Coduz", "createdAt": "2020-03-19T14:52:24Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java", "diffHunk": "@@ -37,7 +37,7 @@ private SystemSetting() {\n         super(CONFIG_RESOURCE_NAME);\n     }\n \n-    public String getMessageClassifier() throws KapuaRuntimeException {\n+    public String getMessageClassifier() {\n         String classifier = config.getString(COMMONS_CONTROL_MESSAGE_CLASSIFIER);\n         if (classifier.matches(\"([#>\\\\./\\\\+\\\\*\u200c\u200b])\")) {", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java b/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\nindex e0ac2a45f0..318a013160 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\n\n@@ -31,6 +34,7 @@ public class SystemSetting extends AbstractKapuaSetting<SystemSettingKey> {\n     private static final SystemSetting INSTANCE = new SystemSetting();\n     private static final String COMMONS_CONTROL_MESSAGE_CLASSIFIER = \"commons.control_message.classifier\";\n \n+    private static final Pattern PATTERN = Pattern.compile(\"([#>./+*\u200c\u200b])\");\n     // Constructors\n \n     private SystemSetting() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA4NzI3NQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395087275", "bodyText": "Get this from ConsoleMessages.error().\nAlso for other occurrencies on this class", "author": "Coduz", "createdAt": "2020-03-19T14:53:45Z", "path": "console/core/src/main/java/org/eclipse/kapua/app/console/core/client/ChangePasswordDialog.java", "diffHunk": "@@ -103,14 +104,14 @@ public void onFailure(Throwable caught) {\n                 if (caught instanceof GwtKapuaException) {\n                     GwtKapuaException gwtCaught = (GwtKapuaException) caught;\n                     if (gwtCaught.getCode().equals(GwtKapuaErrorCode.INVALID_USERNAME_PASSWORD)) {\n-                        ConsoleInfo.display(\"Error\", ActionDialog.MSGS.changePasswordError(MSGS.changePasswordErrorWrongOldPassword()));\n+                        ConsoleInfo.display(ERROR, ActionDialog.MSGS.changePasswordError(MSGS.changePasswordErrorWrongOldPassword()));", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "chunk": "diff --git a/console/core/src/main/java/org/eclipse/kapua/app/console/core/client/ChangePasswordDialog.java b/console/core/src/main/java/org/eclipse/kapua/app/console/core/client/ChangePasswordDialog.java\nindex abab4106f1..ab9b5f86f5 100644\n--- a/console/core/src/main/java/org/eclipse/kapua/app/console/core/client/ChangePasswordDialog.java\n+++ b/console/core/src/main/java/org/eclipse/kapua/app/console/core/client/ChangePasswordDialog.java\n\n@@ -104,14 +104,14 @@ public class ChangePasswordDialog extends SimpleDialog {\n                 if (caught instanceof GwtKapuaException) {\n                     GwtKapuaException gwtCaught = (GwtKapuaException) caught;\n                     if (gwtCaught.getCode().equals(GwtKapuaErrorCode.INVALID_USERNAME_PASSWORD)) {\n-                        ConsoleInfo.display(ERROR, ActionDialog.MSGS.changePasswordError(MSGS.changePasswordErrorWrongOldPassword()));\n+                        ConsoleInfo.display(CONSOLE_MSGS.error(), ActionDialog.MSGS.changePasswordError(MSGS.changePasswordErrorWrongOldPassword()));\n                         oldPassword.markInvalid(MSGS.changePasswordErrorWrongOldPassword());\n                     } else if (gwtCaught.getCode().equals(GwtKapuaErrorCode.UNAUTHENTICATED)) {\n-                        ConsoleInfo.display(ERROR, ActionDialog.MSGS.changePasswordError(caught.getLocalizedMessage()));\n+                        ConsoleInfo.display(CONSOLE_MSGS.error(), ActionDialog.MSGS.changePasswordError(caught.getLocalizedMessage()));\n                         hide();\n                         Logout.logout();\n                     } else {\n-                        ConsoleInfo.display(ERROR, ActionDialog.MSGS.changePasswordError(caught.getLocalizedMessage()));\n+                        ConsoleInfo.display(CONSOLE_MSGS.error(), ActionDialog.MSGS.changePasswordError(caught.getLocalizedMessage()));\n                     }\n                 }\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTA5Mzg3Mw==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395093873", "bodyText": "Get this from ConsoleMessages.error()", "author": "Coduz", "createdAt": "2020-03-19T15:02:17Z", "path": "console/module/account/src/main/java/org/eclipse/kapua/app/console/module/account/client/toolbar/AccountAddDialog.java", "diffHunk": "@@ -289,13 +291,13 @@ public void handleEvent(BaseEvent be) {\n \n     public void validateAccount() {\n         if (accountNameField.getValue() == null || organizationName.getValue() == null || organizationEmail.getValue() == null) {\n-            ConsoleInfo.display(\"Error\", CMSGS.allFieldsRequired());\n+            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());", "originalCommit": "c3a8a5028ff956414f2624efd0937f7f634d4bbd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "chunk": "diff --git a/console/module/account/src/main/java/org/eclipse/kapua/app/console/module/account/client/toolbar/AccountAddDialog.java b/console/module/account/src/main/java/org/eclipse/kapua/app/console/module/account/client/toolbar/AccountAddDialog.java\nindex 51ad382c63..47f2f31213 100644\n--- a/console/module/account/src/main/java/org/eclipse/kapua/app/console/module/account/client/toolbar/AccountAddDialog.java\n+++ b/console/module/account/src/main/java/org/eclipse/kapua/app/console/module/account/client/toolbar/AccountAddDialog.java\n\n@@ -291,13 +288,13 @@ public class AccountAddDialog extends EntityAddEditDialog {\n \n     public void validateAccount() {\n         if (accountNameField.getValue() == null || organizationName.getValue() == null || organizationEmail.getValue() == null) {\n-            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());\n+            ConsoleInfo.display(CMSGS.error(), CMSGS.allFieldsRequired());\n         } else if (!expirationDateField.isValid()) {\n-            ConsoleInfo.display(ERROR, KapuaSafeHtmlUtils.htmlUnescape(expirationDateField.getErrorMessage()));\n+            ConsoleInfo.display(CMSGS.error(), KapuaSafeHtmlUtils.htmlUnescape(expirationDateField.getErrorMessage()));\n         } else if (!organizationEmail.isValid()) {\n-            ConsoleInfo.display(ERROR, organizationEmail.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), organizationEmail.getErrorMessage());\n         } else if (!organizationPhoneNumber.isValid()) {\n-            ConsoleInfo.display(ERROR, organizationPhoneNumber.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), organizationPhoneNumber.getErrorMessage());\n         }\n     }\n \n"}}, {"oid": "fd68a0e3ea605b52f025831a72d897ea6e64e188", "url": "https://github.com/eclipse/kapua/commit/fd68a0e3ea605b52f025831a72d897ea6e64e188", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-19T16:39:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE2ODAxNQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395168015", "bodyText": "Make this static \ud83d\ude01", "author": "Coduz", "createdAt": "2020-03-19T16:43:33Z", "path": "commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java", "diffHunk": "@@ -37,9 +40,11 @@ private SystemSetting() {\n         super(CONFIG_RESOURCE_NAME);\n     }\n \n-    public String getMessageClassifier() throws KapuaRuntimeException {\n+    public String getMessageClassifier() {\n         String classifier = config.getString(COMMONS_CONTROL_MESSAGE_CLASSIFIER);\n-        if (classifier.matches(\"([#>\\\\./\\\\+\\\\*\u200c\u200b])\")) {\n+        Pattern pattern = Pattern.compile(\"([#>./+*\u200c\u200b])\");", "originalCommit": "cac6b7053940d88b075dfad79f9e546cb5c43672", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "chunk": "diff --git a/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java b/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\nindex 114fa0631f..318a013160 100644\n--- a/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\n+++ b/commons/src/main/java/org/eclipse/kapua/commons/setting/system/SystemSetting.java\n\n@@ -34,6 +34,7 @@ public class SystemSetting extends AbstractKapuaSetting<SystemSettingKey> {\n     private static final SystemSetting INSTANCE = new SystemSetting();\n     private static final String COMMONS_CONTROL_MESSAGE_CLASSIFIER = \"commons.control_message.classifier\";\n \n+    private static final Pattern PATTERN = Pattern.compile(\"([#>./+*\u200c\u200b])\");\n     // Constructors\n \n     private SystemSetting() {\n"}}, {"oid": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "url": "https://github.com/eclipse/kapua/commit/6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-19T16:46:55Z", "type": "forcePushed"}, {"oid": "522c358bd1151fd9d52c9964455aa49ad7edb989", "url": "https://github.com/eclipse/kapua/commit/522c358bd1151fd9d52c9964455aa49ad7edb989", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-19T17:20:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3NDg3Ng==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395174876", "bodyText": "Can we add try finally closing the Writer?", "author": "Coduz", "createdAt": "2020-03-19T16:53:29Z", "path": "console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceEventExporterCsv.java", "diffHunk": "@@ -50,11 +51,11 @@ public void init(final String scopeId, String clientId)\n         dateFormat = new SimpleDateFormat(\"MM/dd/yyyy HH:mm:ss.SSS\");\n \n         response.setContentType(\"text/csv\");\n-        response.setCharacterEncoding(\"UTF-8\");\n-        response.setHeader(\"Content-Disposition\", \"attachment; filename*=UTF-8''\" + URLEncoder.encode(clientId, \"UTF-8\") + \"_device_events.csv\");\n+        response.setCharacterEncoding(CharEncoding.UTF_8);\n+        response.setHeader(\"Content-Disposition\", \"attachment; filename*=UTF-8''\" + URLEncoder.encode(clientId, CharEncoding.UTF_8) + \"_device_events.csv\");\n         response.setHeader(\"Cache-Control\", \"no-transform, max-age=0\");\n \n-        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(\"UTF-8\"));\n+        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(CharEncoding.UTF_8));", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceEventExporterCsv.java b/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceEventExporterCsv.java\nindex 9d9cfbda5a..7a1c5eb17b 100644\n--- a/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceEventExporterCsv.java\n+++ b/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceEventExporterCsv.java\n\n@@ -45,7 +43,7 @@ public class DeviceEventExporterCsv extends DeviceEventExporter {\n \n     @Override\n     public void init(final String scopeId, String clientId)\n-            throws ServletException, IOException, KapuaException {\n+            throws IOException {\n         this.scopeId = scopeId;\n         this.clientId = clientId;\n         dateFormat = new SimpleDateFormat(\"MM/dd/yyyy HH:mm:ss.SSS\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3NTA2MA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395175060", "bodyText": "Can we add try finally closing the Writer?", "author": "Coduz", "createdAt": "2020-03-19T16:53:43Z", "path": "console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceExporterCsv.java", "diffHunk": "@@ -56,7 +57,7 @@ public void init(String accountId, String accountName)\n         this.accountName = accountName;\n         dateFormat = new SimpleDateFormat(\"MM/dd/yyyy HH:mm:ss.SSS\");\n \n-        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(\"UTF-8\"));\n+        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(CharEncoding.UTF_8));", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceExporterCsv.java b/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceExporterCsv.java\nindex 3dcb076d28..9e8712fbc9 100644\n--- a/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceExporterCsv.java\n+++ b/console/module/device/src/main/java/org/eclipse/kapua/app/console/module/device/servlet/DeviceExporterCsv.java\n\n@@ -52,24 +51,27 @@ public class DeviceExporterCsv extends DeviceExporter {\n \n     @Override\n     public void init(String accountId, String accountName)\n-            throws ServletException, IOException {\n+            throws IOException {\n         this.accountId = accountId;\n         this.accountName = accountName;\n         dateFormat = new SimpleDateFormat(\"MM/dd/yyyy HH:mm:ss.SSS\");\n \n         OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(CharEncoding.UTF_8));\n-        writer = new CSVWriter(osw);\n+        try {\n+            writer = new CSVWriter(osw);\n \n-        List<String> cols = new ArrayList<String>();\n-        Collections.addAll(cols, DEVICE_PROPERTIES);\n-        writer.writeNext(cols.toArray(new String[] {}));\n+            List<String> cols = new ArrayList<String>(Arrays.asList(DEVICE_PROPERTIES));\n+            writer.writeNext(cols.toArray(new String[]{ }));\n+        } finally {\n+            osw.close();\n+        }\n     }\n \n     @Override\n     public void append(KapuaListResult<Device> devices)\n-            throws ServletException, IOException, KapuaException {\n+            throws KapuaException {\n \n-        Account account = null;\n+        Account account;\n         try {\n             account = KapuaSecurityUtils.doPrivileged(new Callable<Account>() {\n                 @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3NjQ1NA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395176454", "bodyText": "Please use ConsoleMessages.error()", "author": "Coduz", "createdAt": "2020-03-19T16:55:42Z", "path": "console/module/endpoint/src/main/java/org/eclipse/kapua/app/console/module/endpoint/client/EndpointAddDialog.java", "diffHunk": "@@ -101,15 +103,15 @@ public void createBody() {\n \n     public void validateEndPoint() {\n         if (endpointSchemaField.getValue() == null || endpointDnsField.getValue() == null) {\n-            ConsoleInfo.display(\"Error\", CMSGS.allFieldsRequired());\n+            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/endpoint/src/main/java/org/eclipse/kapua/app/console/module/endpoint/client/EndpointAddDialog.java b/console/module/endpoint/src/main/java/org/eclipse/kapua/app/console/module/endpoint/client/EndpointAddDialog.java\nindex 1b0d9c3d39..cf93aae755 100644\n--- a/console/module/endpoint/src/main/java/org/eclipse/kapua/app/console/module/endpoint/client/EndpointAddDialog.java\n+++ b/console/module/endpoint/src/main/java/org/eclipse/kapua/app/console/module/endpoint/client/EndpointAddDialog.java\n\n@@ -103,15 +101,15 @@ public class EndpointAddDialog extends EntityAddEditDialog {\n \n     public void validateEndPoint() {\n         if (endpointSchemaField.getValue() == null || endpointDnsField.getValue() == null) {\n-            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());\n+            ConsoleInfo.display(CMSGS.error(), CMSGS.allFieldsRequired());\n         } else if (endpointPortField.getValue() == null) {\n-            ConsoleInfo.display(ERROR, MSGS.portFieldEmptyOrInvalid());\n+            ConsoleInfo.display(CMSGS.error(), MSGS.portFieldEmptyOrInvalid());\n         } else if (!endpointSchemaField.isValid()) {\n-            ConsoleInfo.display(ERROR, endpointSchemaField.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), endpointSchemaField.getErrorMessage());\n         } else if (!endpointDnsField.isValid()) {\n-            ConsoleInfo.display(ERROR, endpointDnsField.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), endpointDnsField.getErrorMessage());\n         } else if (!endpointPortField.isValid()) {\n-            ConsoleInfo.display(ERROR, endpointPortField.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), endpointPortField.getErrorMessage());\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3NzU4Mg==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395177582", "bodyText": "Can we add try finally closing the Writer?", "author": "Coduz", "createdAt": "2020-03-19T16:57:18Z", "path": "console/module/job/src/main/java/org/eclipse/kapua/app/console/module/job/servlet/JobTargetExporterCsv.java", "diffHunk": "@@ -59,11 +60,11 @@ public void init(final String scopeId, String jobId)\n         dateFormat = new SimpleDateFormat(\"MM/dd/yyyy HH:mm:ss.SSS\");\n \n         response.setContentType(\"text/csv\");\n-        response.setCharacterEncoding(\"UTF-8\");\n-        response.setHeader(\"Content-Disposition\", \"attachment; filename*=UTF-8''\" + URLEncoder.encode(jobId, \"UTF-8\") + \"_job_targets.csv\");\n+        response.setCharacterEncoding(CharEncoding.UTF_8);\n+        response.setHeader(\"Content-Disposition\", \"attachment; filename*=UTF-8''\" + URLEncoder.encode(jobId, CharEncoding.UTF_8) + \"_job_targets.csv\");\n         response.setHeader(\"Cache-Control\", \"no-transform, max-age=0\");\n \n-        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(\"UTF-8\"));\n+        OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(CharEncoding.UTF_8));", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/job/src/main/java/org/eclipse/kapua/app/console/module/job/servlet/JobTargetExporterCsv.java b/console/module/job/src/main/java/org/eclipse/kapua/app/console/module/job/servlet/JobTargetExporterCsv.java\nindex 57e6adab89..b57a191917 100644\n--- a/console/module/job/src/main/java/org/eclipse/kapua/app/console/module/job/servlet/JobTargetExporterCsv.java\n+++ b/console/module/job/src/main/java/org/eclipse/kapua/app/console/module/job/servlet/JobTargetExporterCsv.java\n\n@@ -65,11 +66,14 @@ public class JobTargetExporterCsv extends JobTargetExporter {\n         response.setHeader(\"Cache-Control\", \"no-transform, max-age=0\");\n \n         OutputStreamWriter osw = new OutputStreamWriter(response.getOutputStream(), Charset.forName(CharEncoding.UTF_8));\n-        writer = new CSVWriter(osw);\n+        try {\n+            writer = new CSVWriter(osw);\n \n-        List<String> cols = new ArrayList<String>();\n-        Collections.addAll(cols, JOB_TARGET_PROPERTIES);\n-        writer.writeNext(cols.toArray(new String[] {}));\n+            List<String> cols = new ArrayList<String>(Arrays.asList(JOB_TARGET_PROPERTIES));\n+            writer.writeNext(cols.toArray(new String[]{ }));\n+        } finally {\n+            osw.close();\n+        }\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3ODAyMA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395178020", "bodyText": "Please use ConsoleMessages.error()", "author": "Coduz", "createdAt": "2020-03-19T16:57:58Z", "path": "console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserAddDialog.java", "diffHunk": "@@ -234,17 +236,17 @@ public void handleEvent(BaseEvent be) {\n \n     public void validateUser() {\n         if (username.getValue() == null || (passwordIsShown && password.getValue() == null) || (passwordIsShown && confirmPassword.getValue() == null)) {\n-            ConsoleInfo.display(\"Error\", CMSGS.allFieldsRequired());\n+            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserAddDialog.java b/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserAddDialog.java\nindex c42b1c63ca..f600c78fd0 100644\n--- a/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserAddDialog.java\n+++ b/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserAddDialog.java\n\n@@ -236,17 +234,17 @@ public class UserAddDialog extends EntityAddEditDialog {\n \n     public void validateUser() {\n         if (username.getValue() == null || (passwordIsShown && password.getValue() == null) || (passwordIsShown && confirmPassword.getValue() == null)) {\n-            ConsoleInfo.display(ERROR, CMSGS.allFieldsRequired());\n-        } else if (passwordIsShown && !password.isValid()) {\n-            ConsoleInfo.display(ERROR, password.getErrorMessage());\n-        } else if (passwordIsShown && !password.getValue().equals(confirmPassword.getValue())) {\n-            ConsoleInfo.display(ERROR, confirmPassword.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), CMSGS.allFieldsRequired());\n+        } else if (Boolean.TRUE.equals(passwordIsShown) && !password.isValid()) {\n+            ConsoleInfo.display(CMSGS.error(), password.getErrorMessage());\n+        } else if (Boolean.TRUE.equals(passwordIsShown) && !password.getValue().equals(confirmPassword.getValue())) {\n+            ConsoleInfo.display(CMSGS.error(), confirmPassword.getErrorMessage());\n         } else if (!email.isValid()) {\n-            ConsoleInfo.display(ERROR, email.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), email.getErrorMessage());\n         } else if (!phoneNumber.isValid()) {\n-            ConsoleInfo.display(ERROR, phoneNumber.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), phoneNumber.getErrorMessage());\n         } else if (!expirationDate.isValid()) {\n-            ConsoleInfo.display(ERROR, KapuaSafeHtmlUtils.htmlUnescape(expirationDate.getErrorMessage()));\n+            ConsoleInfo.display(CMSGS.error(), KapuaSafeHtmlUtils.htmlUnescape(expirationDate.getErrorMessage()));\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3ODIxMA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395178210", "bodyText": "Please use ConsoleMessages.error()", "author": "Coduz", "createdAt": "2020-03-19T16:58:15Z", "path": "console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserEditDialog.java", "diffHunk": "@@ -79,11 +81,11 @@ public void onFailure(Throwable cause) {\n     @Override\n     public void validateUser() {\n         if (!email.isValid()) {\n-            ConsoleInfo.display(\"Error\", email.getErrorMessage());\n+            ConsoleInfo.display(ERROR, email.getErrorMessage());", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserEditDialog.java b/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserEditDialog.java\nindex 0d8f231943..0f001fd922 100644\n--- a/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserEditDialog.java\n+++ b/console/module/user/src/main/java/org/eclipse/kapua/app/console/module/user/client/dialog/UserEditDialog.java\n\n@@ -81,11 +82,11 @@ public class UserEditDialog extends UserAddDialog {\n     @Override\n     public void validateUser() {\n         if (!email.isValid()) {\n-            ConsoleInfo.display(ERROR, email.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), email.getErrorMessage());\n         } else if (!phoneNumber.isValid()) {\n-            ConsoleInfo.display(ERROR, phoneNumber.getErrorMessage());\n+            ConsoleInfo.display(CMSGS.error(), phoneNumber.getErrorMessage());\n         } else if (!expirationDate.isValid()) {\n-            ConsoleInfo.display(ERROR, KapuaSafeHtmlUtils.htmlUnescape(expirationDate.getErrorMessage()));\n+            ConsoleInfo.display(CMSGS.error(), KapuaSafeHtmlUtils.htmlUnescape(expirationDate.getErrorMessage()));\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4MDM4OA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395180388", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-19T17:01:23Z", "path": "job-engine/jbatch/src/main/java/org/eclipse/kapua/job/engine/jbatch/JobEngineServiceJbatch.java", "diffHunk": "@@ -66,6 +66,10 @@\n     private static final JobTargetService JOB_TARGET_SERVICE = LOCATOR.getService(JobTargetService.class);\n     private static final JobTargetFactory JOB_TARGET_FACTORY = LOCATOR.getFactory(JobTargetFactory.class);\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/job-engine/jbatch/src/main/java/org/eclipse/kapua/job/engine/jbatch/JobEngineServiceJbatch.java b/job-engine/jbatch/src/main/java/org/eclipse/kapua/job/engine/jbatch/JobEngineServiceJbatch.java\nindex 7becfc2db5..5712e6488f 100644\n--- a/job-engine/jbatch/src/main/java/org/eclipse/kapua/job/engine/jbatch/JobEngineServiceJbatch.java\n+++ b/job-engine/jbatch/src/main/java/org/eclipse/kapua/job/engine/jbatch/JobEngineServiceJbatch.java\n\n@@ -66,8 +65,6 @@ public class JobEngineServiceJbatch implements JobEngineService {\n     private static final JobTargetService JOB_TARGET_SERVICE = LOCATOR.getService(JobTargetService.class);\n     private static final JobTargetFactory JOB_TARGET_FACTORY = LOCATOR.getFactory(JobTargetFactory.class);\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-    private static final String JOB_ID = \"jobId\";\n     private static final String JOB_EXECUTION_ID = \"jobExecutionId\";\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4MDg3OA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395180878", "bodyText": "\ud83d\ude0d", "author": "Coduz", "createdAt": "2020-03-19T17:02:11Z", "path": "qa/common/src/main/java/org/eclipse/kapua/qa/common/DBHelper.java", "diffHunk": "@@ -166,7 +167,9 @@ public void dropAll() throws SQLException {\n \n         while (sqlResults.next()) {\n             String sqlStatement = String.format(\"DROP TABLE %s\", sqlResults.getString(\"TABLE_NAME\").toUpperCase());\n-            connection.prepareStatement(sqlStatement).execute();\n+            try (PreparedStatement preparedStatement = connection.prepareStatement(sqlStatement)) {", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3efcdb4695d5693194550a7da8ddee4830a595bc", "chunk": "diff --git a/qa/common/src/main/java/org/eclipse/kapua/qa/common/DBHelper.java b/qa/common/src/main/java/org/eclipse/kapua/qa/common/DBHelper.java\nindex 128058e2da..318b1ffad5 100644\n--- a/qa/common/src/main/java/org/eclipse/kapua/qa/common/DBHelper.java\n+++ b/qa/common/src/main/java/org/eclipse/kapua/qa/common/DBHelper.java\n\n@@ -173,5 +175,6 @@ public class DBHelper {\n         }\n \n         this.close();\n+        KapuaCacheManager.invalidateAll();\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE4MjU3Ng==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395182576", "bodyText": "Make use of KapuaEntityAttributes.scopeId, KapuaEntityAttributes.id, and AccountAttributes.expirationDate", "author": "Coduz", "createdAt": "2020-03-19T17:04:43Z", "path": "service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountServiceImpl.java", "diffHunk": "@@ -63,6 +63,11 @@\n     @Inject\n     private PermissionFactory permissionFactory;\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountServiceImpl.java b/service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountServiceImpl.java\nindex 05881e44cc..476455a85b 100644\n--- a/service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountServiceImpl.java\n+++ b/service/account/internal/src/main/java/org/eclipse/kapua/service/account/internal/AccountServiceImpl.java\n\n@@ -63,10 +65,7 @@ public class AccountServiceImpl extends AbstractKapuaConfigurableResourceLimited\n     @Inject\n     private PermissionFactory permissionFactory;\n \n-    private static final String SCOPE_ID = \"scopeId\";\n     private static final String NO_EXPIRATION_DATE_SET = \"no expiration date set\";\n-    private static final String EXPIRATION_DATE = \"expirationDate\";\n-    private static final String ACCOUNT_ID = \"accountId\";\n \n     /**\n      * Constructor.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5MTY4MA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395191680", "bodyText": "Make use of KapuaEntityAttributes.scopeId", "author": "Coduz", "createdAt": "2020-03-19T17:18:30Z", "path": "service/device/registry/internal/src/main/java/org/eclipse/kapua/service/device/registry/common/DeviceValidation.java", "diffHunk": "@@ -55,6 +55,9 @@\n     private static DeviceRegistryService deviceRegistryService;\n     private static DeviceFactory deviceFactory;\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "6d10d144475e32f45a5de0a7011df2a7a1ce13bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/device/registry/internal/src/main/java/org/eclipse/kapua/service/device/registry/common/DeviceValidation.java b/service/device/registry/internal/src/main/java/org/eclipse/kapua/service/device/registry/common/DeviceValidation.java\nindex 491bc7306b..31d393a91a 100644\n--- a/service/device/registry/internal/src/main/java/org/eclipse/kapua/service/device/registry/common/DeviceValidation.java\n+++ b/service/device/registry/internal/src/main/java/org/eclipse/kapua/service/device/registry/common/DeviceValidation.java\n\n@@ -47,51 +47,16 @@ public final class DeviceValidation {\n \n     private static final DeviceDomain DEVICE_DOMAIN = new DeviceDomain();\n \n-    private static AuthorizationService authorizationService;\n-    private static GroupService groupService;\n-    private static TagService tagService;\n-    private static PermissionFactory permissionFactory;\n+    private static final AuthorizationService AUTHORIZATION_SERVICE = KapuaLocator.getInstance().getService(AuthorizationService.class);\n+    private static final GroupService GROUP_SERVICE = KapuaLocator.getInstance().getService(GroupService.class);\n+    private static final TagService TAG_SERVICE = KapuaLocator.getInstance().getService(TagService.class);\n+    private static final PermissionFactory PERMISSION_FACTORY = KapuaLocator.getInstance().getFactory(PermissionFactory.class);\n \n-    private static DeviceRegistryService deviceRegistryService;\n-    private static DeviceFactory deviceFactory;\n+    private static final DeviceRegistryService DEVICE_REGISTRY_SERVICE = KapuaLocator.getInstance().getService(DeviceRegistryService.class);\n+    private static final DeviceFactory DEVICE_FACTORY = KapuaLocator.getInstance().getFactory(DeviceFactory.class);\n \n-    private static final String SCOPE_ID = \"scopeId\";\n     private static final String DEVICE_CREATOR_CLIENT_ID = \"deviceCreator.clientId\";\n \n-    static {\n-        try {\n-            authorizationService = KapuaLocator.getInstance().getService(AuthorizationService.class);\n-            groupService = KapuaLocator.getInstance().getService(GroupService.class);\n-            tagService = KapuaLocator.getInstance().getService(TagService.class);\n-            permissionFactory = KapuaLocator.getInstance().getFactory(PermissionFactory.class);\n-\n-            deviceRegistryService = KapuaLocator.getInstance().getService(DeviceRegistryService.class);\n-            deviceFactory = KapuaLocator.getInstance().getFactory(DeviceFactory.class);\n-        } catch (ExceptionInInitializerError e) {\n-\n-        }\n-    }\n-\n-    public static void authorizationService(AuthorizationService authorizationService) {\n-        DeviceValidation.authorizationService = authorizationService;\n-    }\n-\n-    public static void groupService(GroupService groupService) {\n-        DeviceValidation.groupService = groupService;\n-    }\n-\n-    public static void permissionFactory(PermissionFactory permissionFactory) {\n-        DeviceValidation.permissionFactory = permissionFactory;\n-    }\n-\n-    public static void deviceRegistryService(DeviceRegistryService deviceRegistryService) {\n-        DeviceValidation.deviceRegistryService = deviceRegistryService;\n-    }\n-\n-    public static void deviceFactory(DeviceFactory deviceFactory) {\n-        DeviceValidation.deviceFactory = deviceFactory;\n-    }\n-\n     private DeviceValidation() {\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE5NzU3NQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395197575", "bodyText": "Make user of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-19T17:27:11Z", "path": "service/scheduler/quartz/src/main/java/org/eclipse/kapua/service/scheduler/trigger/definition/quartz/TriggerDefinitionServiceImpl.java", "diffHunk": "@@ -45,6 +45,8 @@\n     @Inject\n     private PermissionFactory permissionFactory;\n \n+    private static final String STEP_DEFINITION_ID = \"stepDefinitionId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/scheduler/quartz/src/main/java/org/eclipse/kapua/service/scheduler/trigger/definition/quartz/TriggerDefinitionServiceImpl.java b/service/scheduler/quartz/src/main/java/org/eclipse/kapua/service/scheduler/trigger/definition/quartz/TriggerDefinitionServiceImpl.java\nindex 6e52894ace..c7ac0cde5f 100755\n--- a/service/scheduler/quartz/src/main/java/org/eclipse/kapua/service/scheduler/trigger/definition/quartz/TriggerDefinitionServiceImpl.java\n+++ b/service/scheduler/quartz/src/main/java/org/eclipse/kapua/service/scheduler/trigger/definition/quartz/TriggerDefinitionServiceImpl.java\n\n@@ -45,8 +46,6 @@ public class TriggerDefinitionServiceImpl extends AbstractKapuaService implement\n     @Inject\n     private PermissionFactory permissionFactory;\n \n-    private static final String STEP_DEFINITION_ID = \"stepDefinitionId\";\n-\n     public TriggerDefinitionServiceImpl() {\n         super(SchedulerEntityManagerFactory.getInstance());\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUxNjgzNQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395516835", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:22:33Z", "path": "service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobServiceImpl.java", "diffHunk": "@@ -59,6 +59,8 @@\n \n     private static final KapuaLocator LOCATOR = KapuaLocator.getInstance();\n \n+    private static final String JOB_ID = \"jobId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobServiceImpl.java b/service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobServiceImpl.java\nindex d3caa45065..6ee6666e56 100755\n--- a/service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobServiceImpl.java\n+++ b/service/job/internal/src/main/java/org/eclipse/kapua/service/job/internal/JobServiceImpl.java\n\n@@ -59,8 +60,6 @@ public class JobServiceImpl extends AbstractKapuaConfigurableResourceLimitedServ\n \n     private static final KapuaLocator LOCATOR = KapuaLocator.getInstance();\n \n-    private static final String JOB_ID = \"jobId\";\n-\n     @Inject\n     private AuthorizationService authorizationService;\n     @Inject\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUxOTg1OA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395519858", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:28:33Z", "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/credential/shiro/CredentialServiceImpl.java", "diffHunk": "@@ -64,6 +64,8 @@ public CredentialServiceImpl() {\n         super(CredentialService.class.getName(), AuthenticationDomains.CREDENTIAL_DOMAIN, AuthenticationEntityManagerFactory.getInstance());\n     }\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/credential/shiro/CredentialServiceImpl.java b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/credential/shiro/CredentialServiceImpl.java\nindex da55a922ed..5af37a4c28 100644\n--- a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/credential/shiro/CredentialServiceImpl.java\n+++ b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/credential/shiro/CredentialServiceImpl.java\n\n@@ -64,8 +65,6 @@ public class CredentialServiceImpl extends AbstractKapuaConfigurableService impl\n         super(CredentialService.class.getName(), AuthenticationDomains.CREDENTIAL_DOMAIN, AuthenticationEntityManagerFactory.getInstance());\n     }\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-\n     @Override\n     public Credential create(CredentialCreator credentialCreator)\n             throws KapuaException {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyMDIyMA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395520220", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:29:17Z", "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/token/shiro/AccessTokenServiceImpl.java", "diffHunk": "@@ -50,6 +50,9 @@\n     private static final AuthorizationService AUTHORIZATION_SERVICE = LOCATOR.getService(AuthorizationService.class);\n     private static final PermissionFactory PERMISSION_FACTORY = LOCATOR.getFactory(PermissionFactory.class);\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/token/shiro/AccessTokenServiceImpl.java b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/token/shiro/AccessTokenServiceImpl.java\nindex 54cd80db99..364c5f62b1 100644\n--- a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/token/shiro/AccessTokenServiceImpl.java\n+++ b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authentication/token/shiro/AccessTokenServiceImpl.java\n\n@@ -50,9 +51,6 @@ public class AccessTokenServiceImpl extends AbstractKapuaService implements Acce\n     private static final AuthorizationService AUTHORIZATION_SERVICE = LOCATOR.getService(AuthorizationService.class);\n     private static final PermissionFactory PERMISSION_FACTORY = LOCATOR.getFactory(PermissionFactory.class);\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-    private static final String ACCESS_TOKEN_ID = \"accessTokenId\";\n-\n     /**\n      * Constructor\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyMDQ3MA==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395520470", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:29:51Z", "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessPermissionServiceImpl.java", "diffHunk": "@@ -48,6 +48,8 @@\n @KapuaProvider\n public class AccessPermissionServiceImpl extends AbstractKapuaService implements AccessPermissionService {\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessPermissionServiceImpl.java b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessPermissionServiceImpl.java\nindex e26d350aab..785e6c55ab 100644\n--- a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessPermissionServiceImpl.java\n+++ b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessPermissionServiceImpl.java\n\n@@ -48,8 +49,6 @@ import java.util.Map;\n @KapuaProvider\n public class AccessPermissionServiceImpl extends AbstractKapuaService implements AccessPermissionService {\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-\n     public AccessPermissionServiceImpl() {\n         super(AuthorizationEntityManagerFactory.getInstance());\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyMDc5Mw==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395520793", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:30:29Z", "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessRoleServiceImpl.java", "diffHunk": "@@ -46,6 +46,8 @@\n @KapuaProvider\n public class AccessRoleServiceImpl extends AbstractKapuaService implements AccessRoleService {\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessRoleServiceImpl.java b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessRoleServiceImpl.java\nindex a6ddbfe5fa..713acfad0f 100644\n--- a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessRoleServiceImpl.java\n+++ b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/access/shiro/AccessRoleServiceImpl.java\n\n@@ -46,8 +47,6 @@ import org.eclipse.kapua.service.authorization.shiro.exception.KapuaAuthorizatio\n @KapuaProvider\n public class AccessRoleServiceImpl extends AbstractKapuaService implements AccessRoleService {\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-\n     public AccessRoleServiceImpl() {\n         super(AuthorizationEntityManagerFactory.getInstance());\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTUyMzA5NQ==", "url": "https://github.com/eclipse/kapua/pull/2897#discussion_r395523095", "bodyText": "Make use of KapuaEntityAttributes.scopeId and KapuaEntityAttributes.id", "author": "Coduz", "createdAt": "2020-03-20T09:35:11Z", "path": "service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/role/shiro/RolePermissionServiceImpl.java", "diffHunk": "@@ -52,6 +52,8 @@\n \n     private static final RoleService ROLE_SERVICE = KapuaLocator.getInstance().getService(RoleService.class);\n \n+    private static final String SCOPE_ID = \"scopeId\";", "originalCommit": "522c358bd1151fd9d52c9964455aa49ad7edb989", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "chunk": "diff --git a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/role/shiro/RolePermissionServiceImpl.java b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/role/shiro/RolePermissionServiceImpl.java\nindex 0bfa695b5e..149b39194c 100644\n--- a/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/role/shiro/RolePermissionServiceImpl.java\n+++ b/service/security/shiro/src/main/java/org/eclipse/kapua/service/authorization/role/shiro/RolePermissionServiceImpl.java\n\n@@ -52,8 +53,6 @@ public class RolePermissionServiceImpl extends AbstractKapuaService implements R\n \n     private static final RoleService ROLE_SERVICE = KapuaLocator.getInstance().getService(RoleService.class);\n \n-    private static final String SCOPE_ID = \"scopeId\";\n-\n     public RolePermissionServiceImpl() {\n         super(AuthorizationEntityManagerFactory.getInstance());\n     }\n"}}, {"oid": "1e46380a55a14a3176eb9b0439678cc45c28dce5", "url": "https://github.com/eclipse/kapua/commit/1e46380a55a14a3176eb9b0439678cc45c28dce5", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-20T11:51:32Z", "type": "forcePushed"}, {"oid": "286883ec6db2879fcd5b1d1040286e4224f3f78e", "url": "https://github.com/eclipse/kapua/commit/286883ec6db2879fcd5b1d1040286e4224f3f78e", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-20T13:51:09Z", "type": "forcePushed"}, {"oid": "307ef9713f4cee5f45c8a239034e2281bd022d23", "url": "https://github.com/eclipse/kapua/commit/307ef9713f4cee5f45c8a239034e2281bd022d23", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-23T08:32:44Z", "type": "forcePushed"}, {"oid": "0ea22a6969a99cdad118f1f93cd9041632892b43", "url": "https://github.com/eclipse/kapua/commit/0ea22a6969a99cdad118f1f93cd9041632892b43", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-23T10:41:04Z", "type": "forcePushed"}, {"oid": "2d7157b6cb40d09eb5bfe6feee69bd5cc96cea05", "url": "https://github.com/eclipse/kapua/commit/2d7157b6cb40d09eb5bfe6feee69bd5cc96cea05", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-03-23T11:41:03Z", "type": "forcePushed"}, {"oid": "88e993db8113b3890f4035c766f92cf451fc7285", "url": "https://github.com/eclipse/kapua/commit/88e993db8113b3890f4035c766f92cf451fc7285", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-01T12:04:51Z", "type": "forcePushed"}, {"oid": "4e0cfa75af0a6d400eb2df159c27f9a114ecc4a9", "url": "https://github.com/eclipse/kapua/commit/4e0cfa75af0a6d400eb2df159c27f9a114ecc4a9", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-04-09T10:58:32Z", "type": "forcePushed"}, {"oid": "3efcdb4695d5693194550a7da8ddee4830a595bc", "url": "https://github.com/eclipse/kapua/commit/3efcdb4695d5693194550a7da8ddee4830a595bc", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-10T13:55:30Z", "type": "forcePushed"}, {"oid": "a8c7544c7d897c33d9c5780b8a4d145de5ad544f", "url": "https://github.com/eclipse/kapua/commit/a8c7544c7d897c33d9c5780b8a4d145de5ad544f", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-10T14:11:30Z", "type": "forcePushed"}, {"oid": "16842a239b105375d01c52d2b72bbe734292d2dc", "url": "https://github.com/eclipse/kapua/commit/16842a239b105375d01c52d2b72bbe734292d2dc", "message": "Remove multiple string occurrences (Sonar rule java:S1192)\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:37Z", "type": "commit"}, {"oid": "fa3ff0873c3aa1e60b96218f7f8089ac32c91ef0", "url": "https://github.com/eclipse/kapua/commit/fa3ff0873c3aa1e60b96218f7f8089ac32c91ef0", "message": "Add try-with-resource and other minor Sonar bug fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:38Z", "type": "commit"}, {"oid": "8a55c4a23c9b11ff5e4ba358002eea6f035be3a7", "url": "https://github.com/eclipse/kapua/commit/8a55c4a23c9b11ff5e4ba358002eea6f035be3a7", "message": "Renamed Button to KapuaButton, and other minor Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:39Z", "type": "commit"}, {"oid": "108a2e9b0d958e7e9c02d5fb685eecce8ba9d38d", "url": "https://github.com/eclipse/kapua/commit/108a2e9b0d958e7e9c02d5fb685eecce8ba9d38d", "message": "More minor Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:39Z", "type": "commit"}, {"oid": "d3ec7cb9af8f2479870eaaa5e26ee3fcefc6e7e1", "url": "https://github.com/eclipse/kapua/commit/d3ec7cb9af8f2479870eaaa5e26ee3fcefc6e7e1", "message": "A few more Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:40Z", "type": "commit"}, {"oid": "8a27285825eca4fe6e79b557d7a4473aef6fb47c", "url": "https://github.com/eclipse/kapua/commit/8a27285825eca4fe6e79b557d7a4473aef6fb47c", "message": "More Sonar issues fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:40Z", "type": "commit"}, {"oid": "c97c2ea67582a6cdc6cba20202fe34f13ba86ddc", "url": "https://github.com/eclipse/kapua/commit/c97c2ea67582a6cdc6cba20202fe34f13ba86ddc", "message": "Security issues for Sonar java:S2755 and javasecurity:S2083\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:40Z", "type": "commit"}, {"oid": "2ed5694d027625e421474ceafd94438d6ec8bbcb", "url": "https://github.com/eclipse/kapua/commit/2ed5694d027625e421474ceafd94438d6ec8bbcb", "message": "KapuaSecurityBrokerFilter Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:01:41Z", "type": "commit"}, {"oid": "b7498e126af370e4eecccc236fa57048f4829b6b", "url": "https://github.com/eclipse/kapua/commit/b7498e126af370e4eecccc236fa57048f4829b6b", "message": "More Sonar issues fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:02:20Z", "type": "commit"}, {"oid": "ac5f5551b6c342dc9eae882f15350444524ce83f", "url": "https://github.com/eclipse/kapua/commit/ac5f5551b6c342dc9eae882f15350444524ce83f", "message": "Removed KapuaQuery type parameter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:02:56Z", "type": "commit"}, {"oid": "de6efb32371a63cf8a25b0e6901c6543572ebb3d", "url": "https://github.com/eclipse/kapua/commit/de6efb32371a63cf8a25b0e6901c6543572ebb3d", "message": "More minor Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:03:00Z", "type": "commit"}, {"oid": "97cfd5fa3c9102ae023d8920f1daca2a322c3550", "url": "https://github.com/eclipse/kapua/commit/97cfd5fa3c9102ae023d8920f1daca2a322c3550", "message": "More minor Sonar fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:04:48Z", "type": "commit"}, {"oid": "0426da2544ff4c8fdfc834d06f411995e3ac0d36", "url": "https://github.com/eclipse/kapua/commit/0426da2544ff4c8fdfc834d06f411995e3ac0d36", "message": "Final SonarCloud fixes\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:04:53Z", "type": "commit"}, {"oid": "7a728a1d5b0af2368de87aeff39497ec030f806f", "url": "https://github.com/eclipse/kapua/commit/7a728a1d5b0af2368de87aeff39497ec030f806f", "message": "Address PR comments\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:05:16Z", "type": "commit"}, {"oid": "c57bbc45e5a138c539b1f17598f460cf2f1f1472", "url": "https://github.com/eclipse/kapua/commit/c57bbc45e5a138c539b1f17598f460cf2f1f1472", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:05:21Z", "type": "commit"}, {"oid": "c57bbc45e5a138c539b1f17598f460cf2f1f1472", "url": "https://github.com/eclipse/kapua/commit/c57bbc45e5a138c539b1f17598f460cf2f1f1472", "message": "Removed useless log call in KapuaSecurityBrokerFilter\n\nSigned-off-by: Claudio Mezzasalma <claudio.mezzasalma@eurotech.com>", "committedDate": "2020-08-26T14:05:21Z", "type": "forcePushed"}]}