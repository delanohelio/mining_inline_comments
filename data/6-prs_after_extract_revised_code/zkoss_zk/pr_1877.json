{"pr_number": 1877, "pr_title": "ZK-4504: Merge successive setAttrs in one zAu response", "pr_createdAt": "2020-02-12T10:55:03Z", "pr_url": "https://github.com/zkoss/zk/pull/1877", "timeline": [{"oid": "ca6cbd4d047c98a8db5d84c333cb32be640015a9", "url": "https://github.com/zkoss/zk/commit/ca6cbd4d047c98a8db5d84c333cb32be640015a9", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-12T10:55:56Z", "type": "forcePushed"}, {"oid": "9771dd62fc6a39c853071d811e684afe4c27874b", "url": "https://github.com/zkoss/zk/commit/9771dd62fc6a39c853071d811e684afe4c27874b", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T02:01:26Z", "type": "forcePushed"}, {"oid": "a96d0c72c8d06e9ce161b6293496a37447b29020", "url": "https://github.com/zkoss/zk/commit/a96d0c72c8d06e9ce161b6293496a37447b29020", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T02:55:29Z", "type": "forcePushed"}, {"oid": "2940c4294e6b842b581bf5fe0ab3484077153f63", "url": "https://github.com/zkoss/zk/commit/2940c4294e6b842b581bf5fe0ab3484077153f63", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T08:04:35Z", "type": "forcePushed"}, {"oid": "878f67fe07081ffc9c210ae42108483cf3a589ba", "url": "https://github.com/zkoss/zk/commit/878f67fe07081ffc9c210ae42108483cf3a589ba", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T10:53:40Z", "type": "forcePushed"}, {"oid": "5ac1e15e1a1e6543cf724b1c2de9cc539ff20946", "url": "https://github.com/zkoss/zk/commit/5ac1e15e1a1e6543cf724b1c2de9cc539ff20946", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T10:59:32Z", "type": "forcePushed"}, {"oid": "6b475983c8c2b2dfbb7369fe30910450a55a441f", "url": "https://github.com/zkoss/zk/commit/6b475983c8c2b2dfbb7369fe30910450a55a441f", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-13T11:03:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIxNjc0OA==", "url": "https://github.com/zkoss/zk/pull/1877#discussion_r379216748", "bodyText": "StringBuilder", "author": "DevChu", "createdAt": "2020-02-14T01:57:35Z", "path": "zk/src/org/zkoss/zk/au/out/AuSetAttributes.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/* AuSetAttributes.java\n+\n+\tPurpose:\n+\t\t\n+\tDescription:\n+\t\t\n+\tHistory:\n+\t\tWed Feb 12 15:48:05     2020, Created by rudyhuang\n+\n+Copyright (C) 2020 Potix Corporation. All Rights Reserved.\n+\n+*/\n+package org.zkoss.zk.au.out;\n+\n+import java.util.Date;\n+import java.util.List;\n+\n+import org.zkoss.json.JSONArray;\n+import org.zkoss.zk.au.AuResponse;\n+import org.zkoss.zk.au.DeferredValue;\n+import org.zkoss.zk.ui.Component;\n+\n+/**\n+ * A response to set successive attributes of the specified component at the client.\n+ * <p>data[0]: the uuid of the component<br/>\n+ * data[1]: the array of attribute name and attribute value\n+ *\n+ * @since 9.0.1\n+ * @author rudyhuang\n+ * @see org.zkoss.zk.au.out.AuSetAttribute\n+ */\n+public class AuSetAttributes extends AuResponse {\n+\t/**\n+\t * Construct an instance for miscellaneous values, such as Boolean,\n+\t * Integer and so on.\n+\t */\n+\tpublic AuSetAttributes(Component comp, AuSetAttribute... attrs) {\n+\t\tsuper(\"setAttrs\", comp, attrs);\n+\t}\n+\n+\t@Override\n+\tpublic List<Object> getEncodedData() {\n+\t\tif (_data == null)\n+\t\t\treturn null;\n+\n+\t\tfinal JSONArray encdata = new JSONArray();\n+\t\tencdata.add(new JSONComponent((Component) getDepends()));\n+\t\tfinal JSONArray subdata = new JSONArray();\n+\t\tfor (AuSetAttribute setAttr : (AuSetAttribute[]) _data) {\n+\t\t\tObject[] setAttrData = setAttr.getRawData();\n+\t\t\tfor (int j = 1, len = setAttrData.length; j < len; ++j) { // skip 0\n+\t\t\t\tObject d = setAttrData[j];\n+\t\t\t\tif (d instanceof DeferredValue)\n+\t\t\t\t\td = ((DeferredValue) d).getValue();\n+\t\t\t\tif (d instanceof Component)\n+\t\t\t\t\td = new JSONComponent((Component) d);\n+\t\t\t\tif (d instanceof Date)\n+\t\t\t\t\td = new JSONDate((Date) d);\n+\t\t\t\tsubdata.add(d);\n+\t\t\t}\n+\t\t}\n+\t\tencdata.add(subdata);\n+\t\treturn encdata;\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\t//Don't call getCommand and getData since it causes\n+\t\t//AuSetDeferredAttribute to evaluate the deferred value\n+\t\tfinal StringBuffer sb = new StringBuffer(60).append(\"[cmd=\").append(_cmd);", "originalCommit": "6b475983c8c2b2dfbb7369fe30910450a55a441f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ed24e88a32abedc48e3c0c24bfd2be8b19e0446f", "chunk": "diff --git a/zk/src/org/zkoss/zk/au/out/AuSetAttributes.java b/zk/src/org/zkoss/zk/au/out/AuSetAttributes.java\nindex 2c53dced6c..3e8dad7f15 100644\n--- a/zk/src/org/zkoss/zk/au/out/AuSetAttributes.java\n+++ b/zk/src/org/zkoss/zk/au/out/AuSetAttributes.java\n\n@@ -65,9 +65,7 @@ public class AuSetAttributes extends AuResponse {\n \n \t@Override\n \tpublic String toString() {\n-\t\t//Don't call getCommand and getData since it causes\n-\t\t//AuSetDeferredAttribute to evaluate the deferred value\n-\t\tfinal StringBuffer sb = new StringBuffer(60).append(\"[cmd=\").append(_cmd);\n+\t\tfinal StringBuilder sb = new StringBuilder(60).append(\"[cmd=\").append(_cmd);\n \t\tif (_data != null && _data.length > 0) {\n \t\t\tsb.append(\", {\");\n \t\t\tfor (AuSetAttribute d : (AuSetAttribute[]) _data) {\n"}}, {"oid": "ed24e88a32abedc48e3c0c24bfd2be8b19e0446f", "url": "https://github.com/zkoss/zk/commit/ed24e88a32abedc48e3c0c24bfd2be8b19e0446f", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-14T01:59:11Z", "type": "commit"}, {"oid": "ed24e88a32abedc48e3c0c24bfd2be8b19e0446f", "url": "https://github.com/zkoss/zk/commit/ed24e88a32abedc48e3c0c24bfd2be8b19e0446f", "message": "ZK-4504: Merge successive setAttrs in one zAu response", "committedDate": "2020-02-14T01:59:11Z", "type": "forcePushed"}]}