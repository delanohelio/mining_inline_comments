{"pr_number": 1903, "pr_title": "ZK-4519: datebox constraint parsing errors if there are numbers in me\u2026", "pr_createdAt": "2020-03-04T09:06:41Z", "pr_url": "https://github.com/zkoss/zk/pull/1903", "timeline": [{"oid": "0abc6aa3c50c2af01edb4dc9832fa4719ad3640b", "url": "https://github.com/zkoss/zk/commit/0abc6aa3c50c2af01edb4dc9832fa4719ad3640b", "message": "ZK-4519: datebox constraint parsing errors if there are numbers in message", "committedDate": "2020-03-04T09:24:55Z", "type": "forcePushed"}, {"oid": "bd17e41e29b3b6920e782974208c8c62ae0cbf9e", "url": "https://github.com/zkoss/zk/commit/bd17e41e29b3b6920e782974208c8c62ae0cbf9e", "message": "ZK-4519: datebox constraint parsing errors if there are numbers in message", "committedDate": "2020-03-04T09:26:49Z", "type": "forcePushed"}, {"oid": "ae283ef87e265a8443a8c4601532d3b1a0a8b410", "url": "https://github.com/zkoss/zk/commit/ae283ef87e265a8443a8c4601532d3b1a0a8b410", "message": "ZK-4519: datebox constraint parsing errors if there are numbers in message", "committedDate": "2020-03-04T09:30:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0ODQ0Ng==", "url": "https://github.com/zkoss/zk/pull/1903#discussion_r387548446", "bodyText": "use split(\":\") get0", "author": "plijyfes", "createdAt": "2020-03-04T09:39:19Z", "path": "zul/src/org/zkoss/zul/SimpleDateConstraint.java", "diffHunk": "@@ -119,19 +119,24 @@ public SimpleDateConstraint(int flags, Date begin, Date end, String errmsg) {\n \t */\n \tpublic SimpleDateConstraint(String constraint) {\n \t\tsuper(constraint);\n-\t\tif (!isValidConstraint(constraint))\n-\t\t\tthrow new UiException(\"Invalid constraint: \" + constraint + \" (the constraint should be formatted in yyyyMMdd)\");\n+\t\tcheckValidConstraint(constraint);\n \t}\n \n-\tprivate boolean isValidConstraint(String constraint) {\n+\tprivate void checkValidConstraint(String constraint) {\n \t\tint constraintFormatLength = \"yyyyMMdd\".length(); // default constraint format is yyyyMMdd\n-\t\tPattern numberOnly = Pattern.compile(\"\\\\d+\");\n-\t\tMatcher matcher = numberOnly.matcher(constraint);\n-\t\twhile (matcher.find()) {\n-\t\t\tif (matcher.group().length() != constraintFormatLength)\n-\t\t\t\treturn false;\n+\t\tString[] constraintParts = constraint.split(\",\");\n+\t\tPattern numberStartWithKeyword;\n+\t\tfor (String part: constraintParts) {\n+\t\t\tif (part.contains(\":\")) // should ignore message", "originalCommit": "ae283ef87e265a8443a8c4601532d3b1a0a8b410", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "aaae813a746f074fcaa9299530913eff1740d529", "chunk": "diff --git a/zul/src/org/zkoss/zul/SimpleDateConstraint.java b/zul/src/org/zkoss/zul/SimpleDateConstraint.java\nindex d83f5a7725..ac9343a7a5 100644\n--- a/zul/src/org/zkoss/zul/SimpleDateConstraint.java\n+++ b/zul/src/org/zkoss/zul/SimpleDateConstraint.java\n\n@@ -125,13 +125,10 @@ public class SimpleDateConstraint extends AbstractSimpleDateTimeConstraint<Date>\n \tprivate void checkValidConstraint(String constraint) {\n \t\tint constraintFormatLength = \"yyyyMMdd\".length(); // default constraint format is yyyyMMdd\n \t\tString[] constraintParts = constraint.split(\",\");\n-\t\tPattern numberStartWithKeyword;\n+\t\tPattern numberStartWithKeyword = Pattern.compile(\"((?<=before |after |between |and )(\\\\d+))\");\n \t\tfor (String part: constraintParts) {\n-\t\t\tif (part.contains(\":\")) // should ignore message\n-\t\t\t\tnumberStartWithKeyword = Pattern.compile(\"((?<=before |after |between |and )(\\\\d+))(?=.*:)\");\n-\t\t\telse\n-\t\t\t\tnumberStartWithKeyword = Pattern.compile(\"((?<=before |after |between |and )(\\\\d+))\");\n-\t\t\tMatcher matcher = numberStartWithKeyword.matcher(part);\n+\t\t\tString partWithoutMessage = part.split(\":\")[0];\n+\t\t\tMatcher matcher = numberStartWithKeyword.matcher(partWithoutMessage);\n \t\t\twhile (matcher.find()) {\n \t\t\t\tif (matcher.group().length() != constraintFormatLength)\n \t\t\t\t\tthrow new UiException(\"Invalid constraint: \" + part + \" (the constraint should be formatted in yyyyMMdd)\");\n"}}, {"oid": "aaae813a746f074fcaa9299530913eff1740d529", "url": "https://github.com/zkoss/zk/commit/aaae813a746f074fcaa9299530913eff1740d529", "message": "ZK-4519: datebox constraint parsing errors if there are numbers in message", "committedDate": "2020-03-04T09:55:49Z", "type": "commit"}, {"oid": "aaae813a746f074fcaa9299530913eff1740d529", "url": "https://github.com/zkoss/zk/commit/aaae813a746f074fcaa9299530913eff1740d529", "message": "ZK-4519: datebox constraint parsing errors if there are numbers in message", "committedDate": "2020-03-04T09:55:49Z", "type": "forcePushed"}]}