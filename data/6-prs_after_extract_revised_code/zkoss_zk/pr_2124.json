{"pr_number": 2124, "pr_title": "ZK-4629: Avoid exposing technical internal error details (allow custo\u2026", "pr_createdAt": "2020-08-20T09:09:02Z", "pr_url": "https://github.com/zkoss/zk/pull/2124", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg2MTc4OQ==", "url": "https://github.com/zkoss/zk/pull/2124#discussion_r473861789", "bodyText": "keep \"Illegal request\"", "author": "plijyfes", "createdAt": "2020-08-20T10:29:47Z", "path": "zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java", "diffHunk": "@@ -602,7 +603,7 @@ private void sessionTimeout(HttpServletRequest request, HttpServletResponse resp\n \t\t\ttry {\n \t\t\t\tInteger.parseInt(sid);\n \t\t\t} catch (NumberFormatException e) {\n-\t\t\t\tresponseError(request, response, \"Illegal request\");\n+\t\t\t\tresponseError(request, response, null);", "originalCommit": "9c9bc2a68e274df016a0b302334b1dfd825f7cb1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0052ea94410de9484b0448d69db8eaca9b26ba3", "chunk": "diff --git a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\nindex 792c88ebeb..057b5dd6ce 100644\n--- a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n+++ b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n\n@@ -603,7 +601,8 @@ public class DHtmlUpdateServlet extends HttpServlet {\n \t\t\ttry {\n \t\t\t\tInteger.parseInt(sid);\n \t\t\t} catch (NumberFormatException e) {\n-\t\t\t\tresponseError(request, response, null);\n+\t\t\t\tlog.warn(\"\", e);\n+\t\t\t\tresponseError(request, response, \"Invalid Request (see: Server logs for details)\");\n \t\t\t\treturn;\n \t\t\t}\n \t\t\tresponse.setHeader(\"ZK-SID\", sid);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg2MjI3Mg==", "url": "https://github.com/zkoss/zk/pull/2124#discussion_r473862272", "bodyText": "remove", "author": "plijyfes", "createdAt": "2020-08-20T10:30:21Z", "path": "zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java", "diffHunk": "@@ -686,10 +687,9 @@ protected Desktop recoverDesktop(Session sess, HttpServletRequest request, HttpS\n \t */\n \tprivate static void responseError(HttpServletRequest request, HttpServletResponse response, String errmsg)\n \t\t\tthrows IOException {\n-\t\t//Don't use sendError because Browser cannot handle UTF-8\n-\t\tAuWriter out = AuWriters.newInstance().open(request, response);\n-\t\tout.write(new AuAlert(errmsg, true));\n-\t\tout.close(request, response);\n+\t\tif (errmsg == null || errmsg.length() == 0)", "originalCommit": "9c9bc2a68e274df016a0b302334b1dfd825f7cb1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0052ea94410de9484b0448d69db8eaca9b26ba3", "chunk": "diff --git a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\nindex 792c88ebeb..057b5dd6ce 100644\n--- a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n+++ b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n\n@@ -687,9 +686,7 @@ public class DHtmlUpdateServlet extends HttpServlet {\n \t */\n \tprivate static void responseError(HttpServletRequest request, HttpServletResponse response, String errmsg)\n \t\t\tthrows IOException {\n-\t\tif (errmsg == null || errmsg.length() == 0)\n-\t\t\terrmsg = \"Invalid Request (see: Server logs for details)\";\n-\t\tresponse.sendError(400, errmsg);\n+\t\tresponse.sendError(HttpServletResponse.SC_BAD_REQUEST, errmsg);\n \t}\n \n \tprivate static final AuDecoder getAuDecoder(WebApp wapp) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg2NDMwOA==", "url": "https://github.com/zkoss/zk/pull/2124#discussion_r473864308", "bodyText": "int SC_BAD_REQUEST = 400;", "author": "plijyfes", "createdAt": "2020-08-20T10:32:53Z", "path": "zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java", "diffHunk": "@@ -686,10 +687,9 @@ protected Desktop recoverDesktop(Session sess, HttpServletRequest request, HttpS\n \t */\n \tprivate static void responseError(HttpServletRequest request, HttpServletResponse response, String errmsg)\n \t\t\tthrows IOException {\n-\t\t//Don't use sendError because Browser cannot handle UTF-8\n-\t\tAuWriter out = AuWriters.newInstance().open(request, response);\n-\t\tout.write(new AuAlert(errmsg, true));\n-\t\tout.close(request, response);\n+\t\tif (errmsg == null || errmsg.length() == 0)\n+\t\t\terrmsg = \"Invalid Request (see: Server logs for details)\";\n+\t\tresponse.sendError(400, errmsg);", "originalCommit": "9c9bc2a68e274df016a0b302334b1dfd825f7cb1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0052ea94410de9484b0448d69db8eaca9b26ba3", "chunk": "diff --git a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\nindex 792c88ebeb..057b5dd6ce 100644\n--- a/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n+++ b/zk/src/org/zkoss/zk/au/http/DHtmlUpdateServlet.java\n\n@@ -687,9 +686,7 @@ public class DHtmlUpdateServlet extends HttpServlet {\n \t */\n \tprivate static void responseError(HttpServletRequest request, HttpServletResponse response, String errmsg)\n \t\t\tthrows IOException {\n-\t\tif (errmsg == null || errmsg.length() == 0)\n-\t\t\terrmsg = \"Invalid Request (see: Server logs for details)\";\n-\t\tresponse.sendError(400, errmsg);\n+\t\tresponse.sendError(HttpServletResponse.SC_BAD_REQUEST, errmsg);\n \t}\n \n \tprivate static final AuDecoder getAuDecoder(WebApp wapp) {\n"}}, {"oid": "d0052ea94410de9484b0448d69db8eaca9b26ba3", "url": "https://github.com/zkoss/zk/commit/d0052ea94410de9484b0448d69db8eaca9b26ba3", "message": "ZK-4629: Avoid exposing technical internal error details (allow custom error handling)", "committedDate": "2020-08-20T10:38:32Z", "type": "forcePushed"}, {"oid": "694cddf3089a052f11121261e61fa9ee0910eacc", "url": "https://github.com/zkoss/zk/commit/694cddf3089a052f11121261e61fa9ee0910eacc", "message": "ZK-4629: Avoid exposing technical internal error details (allow custom error handling)", "committedDate": "2020-08-20T10:41:57Z", "type": "forcePushed"}, {"oid": "ea1cc1e5b308b36f7bcae95714f8ab1090698be1", "url": "https://github.com/zkoss/zk/commit/ea1cc1e5b308b36f7bcae95714f8ab1090698be1", "message": "ZK-4629: Avoid exposing technical internal error details (allow custom error handling)", "committedDate": "2020-08-20T10:46:20Z", "type": "forcePushed"}, {"oid": "e3668f3ffd122bf3d3241072760e5a9f14aacdf8", "url": "https://github.com/zkoss/zk/commit/e3668f3ffd122bf3d3241072760e5a9f14aacdf8", "message": "ZK-4629: Avoid exposing technical internal error details (allow custom error handling)", "committedDate": "2020-08-21T01:51:05Z", "type": "commit"}, {"oid": "e3668f3ffd122bf3d3241072760e5a9f14aacdf8", "url": "https://github.com/zkoss/zk/commit/e3668f3ffd122bf3d3241072760e5a9f14aacdf8", "message": "ZK-4629: Avoid exposing technical internal error details (allow custom error handling)", "committedDate": "2020-08-21T01:51:05Z", "type": "forcePushed"}]}