{"pr_number": 2910, "pr_title": "NMS-12573: Refine Parameter handling of Telemetryd", "pr_createdAt": "2020-03-05T12:25:04Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/2910", "timeline": [{"oid": "b939e067c963615ea678c46580f4644198b0e2b4", "url": "https://github.com/OpenNMS/opennms/commit/b939e067c963615ea678c46580f4644198b0e2b4", "message": "NMS-12573: Refine Parameter handling of Telemetryd\n\nThis allows Telemetryd {Adapter,Parser,Listener} Factories to modify the\nparameter set during construction before applying the parameters to the\ncreated beans. Each Factory implementation can implement custom\nparameter handling and modify/remove parameters for the according\ndefinition. The modified parameters are then applyed using BeanWrapper.\n\nIn addition this contains some cleanup. It simplyfies all factory\nimplementations be removing duplicated BeanWrapper calls, refines the\nBmpIntegrationAdapter initialisation to leverage the modifiable\nparameters and renames a couple of things to make projects structure mor\nconcise.", "committedDate": "2020-03-05T12:18:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwNjgzMg==", "url": "https://github.com/OpenNMS/opennms/pull/2910#discussion_r388306832", "bodyText": "I believe this was done within the factory itself rather that outside because of reflection issues with the OSGi proxy classes.\nDoes this work differently now?", "author": "j-white", "createdAt": "2020-03-05T13:55:05Z", "path": "features/telemetry/listeners/src/main/java/org/opennms/netmgt/telemetry/listeners/factory/TcpListenerFactory.java", "diffHunk": "@@ -68,9 +66,6 @@ public Listener createBean(ListenerDefinition listenerDefinition) {\n         if (parser.size() != listenerDefinition.getParsers().size()) {\n             throw new IllegalArgumentException(\"Each parser must be of type TcpParser but was not.\");\n         }\n-        final TcpListener listener = new TcpListener(listenerDefinition.getName(), parser.iterator().next(), telemetryRegistry.getMetricRegistry());\n-        final BeanWrapper wrapper = PropertyAccessorFactory.forBeanPropertyAccess(listener);", "originalCommit": "b939e067c963615ea678c46580f4644198b0e2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM1NTk4Mg==", "url": "https://github.com/OpenNMS/opennms/pull/2910#discussion_r388355982", "bodyText": "I don't know if this has been the case before. But I verified that it works on standalone OpenNMS and on Minion.\nThe instances returned from the factories are not proxied (whereas the factories itself are). Therefore the BeanWrapper should work just fine.", "author": "fooker", "createdAt": "2020-03-05T15:10:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwNjgzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM1Nzc2Mw==", "url": "https://github.com/OpenNMS/opennms/pull/2910#discussion_r388357763", "bodyText": "Sounds good. Thanks for the confirmation.", "author": "j-white", "createdAt": "2020-03-05T15:13:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMwNjgzMg=="}], "type": "inlineReview", "revised_code": null}]}