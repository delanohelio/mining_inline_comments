{"pr_number": 2890, "pr_title": "NMS-12513: Fix HQL Injection issue", "pr_createdAt": "2020-02-17T14:48:22Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/2890", "timeline": [{"oid": "167f78221e50d954c8a465dd75ec23f9f206c726", "url": "https://github.com/OpenNMS/opennms/commit/167f78221e50d954c8a465dd75ec23f9f206c726", "message": "NMS-12513: Fix HQL injection issue", "committedDate": "2020-02-17T16:27:30Z", "type": "forcePushed"}, {"oid": "d09e0618cc732aa922384143553fc0c0c4496eda", "url": "https://github.com/OpenNMS/opennms/commit/d09e0618cc732aa922384143553fc0c0c4496eda", "message": "NMS-12513: Fix HQL injection issue", "committedDate": "2020-02-18T08:37:49Z", "type": "commit"}, {"oid": "d09e0618cc732aa922384143553fc0c0c4496eda", "url": "https://github.com/OpenNMS/opennms/commit/d09e0618cc732aa922384143553fc0c0c4496eda", "message": "NMS-12513: Fix HQL injection issue", "committedDate": "2020-02-18T08:37:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjI2NTc4OA==", "url": "https://github.com/OpenNMS/opennms/pull/2890#discussion_r382265788", "bodyText": "Using a Set here instead of a list would be more efficient for lookups.\nWe should also move to a static constant rather than defining it in the function here.", "author": "j-white", "createdAt": "2020-02-20T21:24:20Z", "path": "opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultNodeListService.java", "diffHunk": "@@ -189,8 +191,16 @@ private static void addCriteriaForSnmpParm(OnmsCriteria criteria,\n         if(snmpParmMatchType.equals(\"contains\")) {\n             criteria.add(Restrictions.ilike(\"snmpInterface.\".concat(snmpParm), snmpParmValue, MatchMode.ANYWHERE));\n         } else if(snmpParmMatchType.equals(\"equals\")) {\n+            final List<String> acceptedParamNames = Lists.newArrayList(", "originalCommit": "d09e0618cc732aa922384143553fc0c0c4496eda", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9f163c203082c5100ef14610716c1f654a71adc1", "chunk": "diff --git a/opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultNodeListService.java b/opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultNodeListService.java\nindex 55188ae2fe3..7a4e3fec886 100644\n--- a/opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultNodeListService.java\n+++ b/opennms-web-api/src/main/java/org/opennms/web/svclayer/support/DefaultNodeListService.java\n\n@@ -191,12 +196,8 @@ public class DefaultNodeListService implements NodeListService, InitializingBean\n         if(snmpParmMatchType.equals(\"contains\")) {\n             criteria.add(Restrictions.ilike(\"snmpInterface.\".concat(snmpParm), snmpParmValue, MatchMode.ANYWHERE));\n         } else if(snmpParmMatchType.equals(\"equals\")) {\n-            final List<String> acceptedParamNames = Lists.newArrayList(\n-                    \"snmpphysaddr\", \"snmpifindex\", \"snmpifdescr\", \"snmpiftype\", \"snmpifname\",\n-                    \"snmpifspeed\", \"snmpifadminstatus\", \"snmpifoperstatus\", \"snmpifalias\", \"snmpcollect\",\n-                    \"snmplastcapsdpoll\", \"snmppoll\", \"snmplastsnmppoll\");\n             final String snmpParameterName = (\"snmp\" + snmpParm).toLowerCase();\n-            if (!acceptedParamNames.contains(snmpParameterName)) {\n+            if (!ACCEPTED_SNMP_PARAM_NAMES.contains(snmpParameterName)) {\n                 throw new IllegalArgumentException(\"Provided parameter '\" + snmpParm + \"' is not supported\");\n             }\n             snmpParmValue = snmpParmValue.toLowerCase();\n"}}, {"oid": "9f163c203082c5100ef14610716c1f654a71adc1", "url": "https://github.com/OpenNMS/opennms/commit/9f163c203082c5100ef14610716c1f654a71adc1", "message": "NMS-12513: Use Set instead of List and make it static", "committedDate": "2020-02-21T09:28:04Z", "type": "commit"}, {"oid": "7470ad24e26a8d53b7d53e8a6e6d4b825672e26f", "url": "https://github.com/OpenNMS/opennms/commit/7470ad24e26a8d53b7d53e8a6e6d4b825672e26f", "message": "Merge remote-tracking branch 'origin/foundation-2019' into jira/NMS-12513-smoke-hql", "committedDate": "2020-02-21T21:09:02Z", "type": "commit"}]}