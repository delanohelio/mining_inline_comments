{"pr_number": 3178, "pr_title": "NMS-12980: handle all ifOperStatus values in SNMP interface poller", "pr_createdAt": "2020-10-06T23:01:28Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/3178", "timeline": [{"oid": "f5d8811b402ce2123371f2c3a1e1ec54463cce43", "url": "https://github.com/OpenNMS/opennms/commit/f5d8811b402ce2123371f2c3a1e1ec54463cce43", "message": "refactor interface statuses to an enum", "committedDate": "2020-07-28T02:48:17Z", "type": "commit"}, {"oid": "66e6c93ffee560855270b2d1c46d392cd2b98323", "url": "https://github.com/OpenNMS/opennms/commit/66e6c93ffee560855270b2d1c46d392cd2b98323", "message": "test, too", "committedDate": "2020-07-28T03:06:48Z", "type": "commit"}, {"oid": "c572a07882cd7ef518afd5b437ee1dc0ca92c0e5", "url": "https://github.com/OpenNMS/opennms/commit/c572a07882cd7ef518afd5b437ee1dc0ca92c0e5", "message": "moar", "committedDate": "2020-07-28T03:14:57Z", "type": "commit"}, {"oid": "8cf8cb1ad49e0cbc6a185dd8f52eb0e98fec46e3", "url": "https://github.com/OpenNMS/opennms/commit/8cf8cb1ad49e0cbc6a185dd8f52eb0e98fec46e3", "message": "WIP but this laptop keeps blue screening", "committedDate": "2020-07-29T03:15:01Z", "type": "commit"}, {"oid": "2297d66bc86290dad34ecb1831346d355b4c45f5", "url": "https://github.com/OpenNMS/opennms/commit/2297d66bc86290dad34ecb1831346d355b4c45f5", "message": "WIP", "committedDate": "2020-07-30T21:52:22Z", "type": "commit"}, {"oid": "e63187b8bd843667ca4d065ace686ffc140eef4e", "url": "https://github.com/OpenNMS/opennms/commit/e63187b8bd843667ca4d065ace686ffc140eef4e", "message": "i think perhaps if you are not using criteria then interface elements do\nnothing so somehow this has to get configured somewhere else", "committedDate": "2020-07-31T02:15:16Z", "type": "commit"}, {"oid": "95b876f1ff69ed95aca8fb64071ec2a4fe5711b0", "url": "https://github.com/OpenNMS/opennms/commit/95b876f1ff69ed95aca8fb64071ec2a4fe5711b0", "message": "fixes p1", "committedDate": "2020-07-31T03:39:15Z", "type": "commit"}, {"oid": "1df6f6bf917084536d8819dd0e634867a35210fd", "url": "https://github.com/OpenNMS/opennms/commit/1df6f6bf917084536d8819dd0e634867a35210fd", "message": "missing annotation; moar logs", "committedDate": "2020-07-31T04:17:22Z", "type": "commit"}, {"oid": "2f6bf099094c01ae748d61a1106dc28239207717", "url": "https://github.com/OpenNMS/opennms/commit/2f6bf099094c01ae748d61a1106dc28239207717", "message": "let's document the SNMP interface poller!", "committedDate": "2020-08-01T04:13:52Z", "type": "commit"}, {"oid": "e7fca07324a6a8a8891ccfdffd2b133df93002bc", "url": "https://github.com/OpenNMS/opennms/commit/e7fca07324a6a8a8891ccfdffd2b133df93002bc", "message": "mumble", "committedDate": "2020-08-02T03:18:02Z", "type": "commit"}, {"oid": "9809906b05d9a397ec507466d875c5e34a67ee24", "url": "https://github.com/OpenNMS/opennms/commit/9809906b05d9a397ec507466d875c5e34a67ee24", "message": "test config", "committedDate": "2020-08-07T03:13:42Z", "type": "commit"}, {"oid": "85a782ca4882f76a791964a8830f9079c0a76307", "url": "https://github.com/OpenNMS/opennms/commit/85a782ca4882f76a791964a8830f9079c0a76307", "message": "refactor so effective up/down values get returned when requested", "committedDate": "2020-08-07T03:42:31Z", "type": "commit"}, {"oid": "e8c930384537c016b082208db0dac4193738d313", "url": "https://github.com/OpenNMS/opennms/commit/e8c930384537c016b082208db0dac4193738d313", "message": "cleanup", "committedDate": "2020-08-08T02:54:59Z", "type": "commit"}, {"oid": "fcffedf466c9d3fc1cf325a9c954c02bdf872dd6", "url": "https://github.com/OpenNMS/opennms/commit/fcffedf466c9d3fc1cf325a9c954c02bdf872dd6", "message": "Merge branch 'feature/enhanceSnmpIfacePoller' of github.com:dschlenk/opennms into feature/enhanceSnmpIfacePoller", "committedDate": "2020-08-11T16:04:02Z", "type": "commit"}, {"oid": "591cf3283d95f95ba437a0da39b0d17f8697da55", "url": "https://github.com/OpenNMS/opennms/commit/591cf3283d95f95ba437a0da39b0d17f8697da55", "message": "WIP", "committedDate": "2020-08-14T19:51:10Z", "type": "commit"}, {"oid": "ce4d2d98e857766526bc25938ec8edc9a1f78e01", "url": "https://github.com/OpenNMS/opennms/commit/ce4d2d98e857766526bc25938ec8edc9a1f78e01", "message": "Revert \"WIP\"\n\nThis reverts commit 591cf3283d95f95ba437a0da39b0d17f8697da55.", "committedDate": "2020-10-06T16:54:29Z", "type": "commit"}, {"oid": "a5e82bbfac5416b242e39da839a9c05555b1eeaa", "url": "https://github.com/OpenNMS/opennms/commit/a5e82bbfac5416b242e39da839a9c05555b1eeaa", "message": "events for down-ish states of ifOperStatus; update docs", "committedDate": "2020-10-06T20:12:38Z", "type": "commit"}, {"oid": "5962813edc4bc4fb1cab531d86505e614a46aaac", "url": "https://github.com/OpenNMS/opennms/commit/5962813edc4bc4fb1cab531d86505e614a46aaac", "message": "Merge branch 'develop' into feature/enhanceSnmpIfacePoller", "committedDate": "2020-10-06T22:03:37Z", "type": "commit"}, {"oid": "a9f557fb0833f8240963cbf64b634b953a5c0ca3", "url": "https://github.com/OpenNMS/opennms/commit/a9f557fb0833f8240963cbf64b634b953a5c0ca3", "message": "explicit default values for attributes with default values", "committedDate": "2020-10-07T19:49:07Z", "type": "commit"}, {"oid": "1643764acc78831e870b03889effaf709026313c", "url": "https://github.com/OpenNMS/opennms/commit/1643764acc78831e870b03889effaf709026313c", "message": "Merge branch 'feature/enhanceSnmpIfacePoller' of github.com:dschlenk/opennms into feature/enhanceSnmpIfacePoller", "committedDate": "2020-10-07T19:49:45Z", "type": "commit"}, {"oid": "29eca1ad5aa5f2c0ed234e5d22b72c6db7a53662", "url": "https://github.com/OpenNMS/opennms/commit/29eca1ad5aa5f2c0ed234e5d22b72c6db7a53662", "message": "reduce interface down alarms from polling & traps", "committedDate": "2020-10-07T22:48:59Z", "type": "commit"}, {"oid": "ad27a87734280737aa86ba036f169959c614bec3", "url": "https://github.com/OpenNMS/opennms/commit/ad27a87734280737aa86ba036f169959c614bec3", "message": "forgot to remove interface from reduction key to make it possible to reduce SNMP_Link_Down and interfaceOperDown alarms", "committedDate": "2020-10-30T16:52:07Z", "type": "commit"}, {"oid": "6e726f91f246126711e459bd3f31964676daf9b7", "url": "https://github.com/OpenNMS/opennms/commit/6e726f91f246126711e459bd3f31964676daf9b7", "message": "spelling", "committedDate": "2020-10-30T17:23:06Z", "type": "commit"}, {"oid": "b7d68b8a2d11f2699f426be0830fb8052bf9990c", "url": "https://github.com/OpenNMS/opennms/commit/b7d68b8a2d11f2699f426be0830fb8052bf9990c", "message": "if now in a down state, send down event(s) when prior value was not down instead of explicitly only an up value", "committedDate": "2020-10-30T18:41:26Z", "type": "commit"}, {"oid": "57d70435c2fc3766f6f34f2c9f4fb3e03fc6beb0", "url": "https://github.com/OpenNMS/opennms/commit/57d70435c2fc3766f6f34f2c9f4fb3e03fc6beb0", "message": "Merge branch 'develop' into feature/enhanceSnmpIfacePoller", "committedDate": "2020-10-30T18:45:47Z", "type": "commit"}, {"oid": "960493e6356c407f6441c591362024acd0987426", "url": "https://github.com/OpenNMS/opennms/commit/960493e6356c407f6441c591362024acd0987426", "message": "simplify and correct behavior for sending up after any non-up state", "committedDate": "2020-10-30T22:39:36Z", "type": "commit"}, {"oid": "f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "url": "https://github.com/OpenNMS/opennms/commit/f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "message": "updated for accuracy", "committedDate": "2020-10-31T00:21:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4MzY5NA==", "url": "https://github.com/OpenNMS/opennms/pull/3178#discussion_r516483694", "bodyText": "Good catch!", "author": "christianpape", "createdAt": "2020-11-03T08:11:11Z", "path": "opennms-config-model/src/main/java/org/opennms/netmgt/config/snmpinterfacepoller/Package.java", "diffHunk": "@@ -231,7 +231,7 @@ public boolean equals(final Object obj) {\n \n         if (obj instanceof Package) {\n             final Package that = (Package)obj;\n-            return Objects.equals(this.m_name, this.m_name)", "originalCommit": "f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4NjMzMw==", "url": "https://github.com/OpenNMS/opennms/pull/3178#discussion_r516486333", "bodyText": "Copyright (C) 2020 The OpenNMS Group, Inc.", "author": "christianpape", "createdAt": "2020-11-03T08:16:49Z", "path": "opennms-config/src/test/java/org/opennms/netmgt/config/SnmpInterfacePollerConfigFactoryTest.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*******************************************************************************\n+ * This file is part of OpenNMS(R).\n+ *\n+ * Copyright (C) 2006-2014 The OpenNMS Group, Inc.", "originalCommit": "f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6f2553aa96aa541f2be0829e0a60a095fab2013d", "chunk": "diff --git a/opennms-config/src/test/java/org/opennms/netmgt/config/SnmpInterfacePollerConfigFactoryTest.java b/opennms-config/src/test/java/org/opennms/netmgt/config/SnmpInterfacePollerConfigFactoryTest.java\nindex c81b580718a..3c8b3408216 100644\n--- a/opennms-config/src/test/java/org/opennms/netmgt/config/SnmpInterfacePollerConfigFactoryTest.java\n+++ b/opennms-config/src/test/java/org/opennms/netmgt/config/SnmpInterfacePollerConfigFactoryTest.java\n\n@@ -1,7 +1,7 @@\n /*******************************************************************************\n  * This file is part of OpenNMS(R).\n  *\n- * Copyright (C) 2006-2014 The OpenNMS Group, Inc.\n+ * Copyright (C) 2006-2020 The OpenNMS Group, Inc.\n  * OpenNMS(R) is Copyright (C) 1999-2020 The OpenNMS Group, Inc.\n  *\n  * OpenNMS(R) is a registered trademark of The OpenNMS Group, Inc.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NDg1Mg==", "url": "https://github.com/OpenNMS/opennms/pull/3178#discussion_r516494852", "bodyText": "Please use .* imports only for static imports.", "author": "christianpape", "createdAt": "2020-11-03T08:33:26Z", "path": "opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java", "diffHunk": "@@ -28,23 +28,21 @@\n \n package org.opennms.netmgt.snmpinterfacepoller.pollable;\n \n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Date;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.Map;\n+import java.util.*;\n \n import org.opennms.netmgt.events.api.EventConstants;\n import org.opennms.netmgt.model.OnmsSnmpInterface;\n import org.opennms.netmgt.poller.PollStatus;\n+import org.opennms.netmgt.snmpinterfacepoller.pollable.SnmpInterfaceStatus.*;", "originalCommit": "f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6f2553aa96aa541f2be0829e0a60a095fab2013d", "chunk": "diff --git a/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java b/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\nindex 1edcac22951..68034152ac4 100644\n--- a/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\n+++ b/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\n\n@@ -33,7 +33,6 @@ import java.util.*;\n import org.opennms.netmgt.events.api.EventConstants;\n import org.opennms.netmgt.model.OnmsSnmpInterface;\n import org.opennms.netmgt.poller.PollStatus;\n-import org.opennms.netmgt.snmpinterfacepoller.pollable.SnmpInterfaceStatus.*;\n import org.opennms.netmgt.scheduler.ReadyRunnable;\n import org.opennms.netmgt.scheduler.Schedule;\n import org.opennms.netmgt.snmp.SnmpAgentConfig;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5NjE2OQ==", "url": "https://github.com/OpenNMS/opennms/pull/3178#discussion_r516496169", "bodyText": "Please use { ... } for blocks, even for one-line blocks.", "author": "christianpape", "createdAt": "2020-11-03T08:35:55Z", "path": "opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java", "diffHunk": "@@ -66,75 +64,105 @@\n     private String m_name;\n         \n     private String m_criteria;\n+\n+    private Set<SnmpInterfaceStatus> m_upValues;\n+\n+    private Set<SnmpInterfaceStatus> m_downValues;\n         \n     private SnmpAgentConfig m_agentConfig;\n     \n     public static class SnmpMinimalPollInterface {\n-        \n-    \tstatic final int IF_UP=1;\n-    \tstatic final int IF_DOWN=2;\n-    \tstatic final int IF_UNKNOWN=0;\n-        \n-        private final String[] s_statusNames = {\"Unknown\",\"InterfaceUp\", \"InterfaceDown\"}; \n-        \n+\n         int ifindex;\n-        int adminstatus;\n-        int operstatus;\n-        \n+        SnmpInterfaceStatus adminstatus;\n+        SnmpInterfaceStatus operstatus;\n+\n         PollStatus m_status;\n-        \n-        public SnmpMinimalPollInterface(int ifindex, int adminstatus,\n-                int operstatus) {\n+\n+        PollStatus m_operPollStatus;\n+        PollStatus m_adminPollStatus;\n+\n+        public SnmpMinimalPollInterface(int ifindex, SnmpInterfaceStatus adminstatus,\n+                SnmpInterfaceStatus operstatus) {\n             this.ifindex = ifindex;\n             this.adminstatus = adminstatus;\n             this.operstatus = operstatus;\n             m_status = PollStatus.unknown();\n         }\n \n-        public String decodeStatus(int status) {\n-            if (status >= 0 && status <= 2) {\n-                return s_statusNames[status];\n-            }\n-            return s_statusNames[0];\n-        }\n-\n         public int getIfindex() {\n             return ifindex;\n         }\n         public void setIfindex(int ifindex) {\n             this.ifindex = ifindex;\n         }\n-        public int getAdminstatus() {\n+        public SnmpInterfaceStatus getAdminstatus() {\n             return adminstatus;\n         }\n-        \n-        public void setAdminstatus(int adminstatus) {\n-            if (adminstatus > 2 )\n-                this.adminstatus = IF_UNKNOWN;\n-            else this.adminstatus = adminstatus;\n+\n+        /**\n+         *\n+         * @param adminstatus valid values are up(1), down(2), testing(3) according to RFC 2863. Value will be set to\n+         *                    invalid(0) in the case where an improper value is attempted to be set.\n+         */\n+        public void setAdminstatus(SnmpInterfaceStatus adminstatus) {\n+            if (adminstatus.getMibValue() > 3 )", "originalCommit": "f43b9147d2aa19a23d2eccb5b475c3d8f68dce6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6f2553aa96aa541f2be0829e0a60a095fab2013d", "chunk": "diff --git a/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java b/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\nindex 1edcac22951..68034152ac4 100644\n--- a/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\n+++ b/opennms-services/src/main/java/org/opennms/netmgt/snmpinterfacepoller/pollable/PollableSnmpInterface.java\n\n@@ -106,10 +105,11 @@ public class PollableSnmpInterface implements ReadyRunnable {\n          *                    invalid(0) in the case where an improper value is attempted to be set.\n          */\n         public void setAdminstatus(SnmpInterfaceStatus adminstatus) {\n-            if (adminstatus.getMibValue() > 3 )\n+            if (adminstatus.getMibValue() > 3 ) {\n                 this.adminstatus = INVALID;\n-            else\n+            } else {\n                 this.adminstatus = adminstatus;\n+            }\n         }\n \n         public SnmpInterfaceStatus getOperstatus() {\n"}}, {"oid": "6f2553aa96aa541f2be0829e0a60a095fab2013d", "url": "https://github.com/OpenNMS/opennms/commit/6f2553aa96aa541f2be0829e0a60a095fab2013d", "message": "fixes per review from @christianpape", "committedDate": "2020-11-03T14:46:41Z", "type": "commit"}]}