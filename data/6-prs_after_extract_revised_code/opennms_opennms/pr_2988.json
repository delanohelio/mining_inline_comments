{"pr_number": 2988, "pr_title": "NMS-12681: Fix  Reloading the Pollerd daemon causes multiple nodeDown messages", "pr_createdAt": "2020-04-29T13:42:16Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/2988", "timeline": [{"oid": "f0aa72f92798caa33344308f83008cc5c505d9de", "url": "https://github.com/OpenNMS/opennms/commit/f0aa72f92798caa33344308f83008cc5c505d9de", "message": "NMS-12681: Update node status in rescheduling for existing nodes.\n\n(cherry picked from commit 8ca00f2b55c8474aebcfb1827157c706191aa843)", "committedDate": "2020-05-01T21:11:24Z", "type": "commit"}, {"oid": "f0aa72f92798caa33344308f83008cc5c505d9de", "url": "https://github.com/OpenNMS/opennms/commit/f0aa72f92798caa33344308f83008cc5c505d9de", "message": "NMS-12681: Update node status in rescheduling for existing nodes.\n\n(cherry picked from commit 8ca00f2b55c8474aebcfb1827157c706191aa843)", "committedDate": "2020-05-01T21:11:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc0MDc3OQ==", "url": "https://github.com/OpenNMS/opennms/pull/2988#discussion_r418740779", "bodyText": "Explain the purpose of the pollableNode argument.", "author": "j-white", "createdAt": "2020-05-01T21:14:18Z", "path": "opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java", "diffHunk": "@@ -421,14 +421,14 @@ private void scheduleExistingServices() throws Exception {\n \n     /**\n      * <p>scheduleService</p>\n-     *\n      * @param nodeId a int.\n-     * @param nodeLabel a {@link java.lang.String} object.\n-     * @param nodeLocation a {@link java.lang.String} object.\n-     * @param ipAddr a {@link java.lang.String} object.\n-     * @param svcName a {@link java.lang.String} object.\n+     * @param nodeLabel a {@link String} object.\n+     * @param nodeLocation a {@link String} object.\n+     * @param ipAddr a {@link String} object.\n+     * @param svcName a {@link String} object.\n+     * @param pollableNode", "originalCommit": "f0aa72f92798caa33344308f83008cc5c505d9de", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dc3d858cde36390b5e77ada1a0f40f1031619756", "chunk": "diff --git a/opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java b/opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java\nindex 5ca1ba2ecc3..808a2fa3874 100644\n--- a/opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java\n+++ b/opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java\n\n@@ -426,7 +426,7 @@ public class Poller extends AbstractServiceDaemon {\n      * @param nodeLocation a {@link String} object.\n      * @param ipAddr a {@link String} object.\n      * @param svcName a {@link String} object.\n-     * @param pollableNode\n+     * @param pollableNode a {@link PollableNode} object\n      */\n     public void scheduleService(final int nodeId, final String nodeLabel, final String nodeLocation, final String ipAddr, final String svcName, PollableNode pollableNode) {\n         final String normalizedAddress = InetAddressUtils.normalize(ipAddr);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc0MDg4Mw==", "url": "https://github.com/OpenNMS/opennms/pull/2988#discussion_r418740883", "bodyText": "This value used?", "author": "j-white", "createdAt": "2020-05-01T21:14:35Z", "path": "opennms-services/src/main/java/org/opennms/netmgt/poller/PollerEventProcessor.java", "diffHunk": "@@ -754,6 +754,7 @@ private void serviceReschedule(Long nodeId, String nodeLabel, String nodeLocatio\n             }\n         }\n \n+        PollStatus pollStatus = pnode != null ? pnode.getStatus() : null;", "originalCommit": "f0aa72f92798caa33344308f83008cc5c505d9de", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dc3d858cde36390b5e77ada1a0f40f1031619756", "chunk": "diff --git a/opennms-services/src/main/java/org/opennms/netmgt/poller/PollerEventProcessor.java b/opennms-services/src/main/java/org/opennms/netmgt/poller/PollerEventProcessor.java\nindex 91c5b8eba82..8fe6930374c 100644\n--- a/opennms-services/src/main/java/org/opennms/netmgt/poller/PollerEventProcessor.java\n+++ b/opennms-services/src/main/java/org/opennms/netmgt/poller/PollerEventProcessor.java\n\n@@ -754,7 +754,6 @@ final class PollerEventProcessor implements EventListener {\n             }\n         }\n \n-        PollStatus pollStatus = pnode != null ? pnode.getStatus() : null;\n         // Schedule all of the services, if they are not already\n         for (final Service databaseService : databaseServices) {\n             if (polledServices.contains(databaseService)) {\n"}}, {"oid": "dc3d858cde36390b5e77ada1a0f40f1031619756", "url": "https://github.com/OpenNMS/opennms/commit/dc3d858cde36390b5e77ada1a0f40f1031619756", "message": "NMS-12681: Update test to check nodeUp\n\nAlso address review comments", "committedDate": "2020-05-03T14:21:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEzMDE3MQ==", "url": "https://github.com/OpenNMS/opennms/pull/2988#discussion_r419130171", "bodyText": "Not quite what I had in mind :)", "author": "j-white", "createdAt": "2020-05-03T16:56:13Z", "path": "opennms-services/src/main/java/org/opennms/netmgt/poller/Poller.java", "diffHunk": "@@ -426,7 +426,7 @@ private void scheduleExistingServices() throws Exception {\n      * @param nodeLocation a {@link String} object.\n      * @param ipAddr a {@link String} object.\n      * @param svcName a {@link String} object.\n-     * @param pollableNode\n+     * @param pollableNode a {@link PollableNode} object", "originalCommit": "dc3d858cde36390b5e77ada1a0f40f1031619756", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2MDA3OQ==", "url": "https://github.com/OpenNMS/opennms/pull/2988#discussion_r419160079", "bodyText": "Of course not, I have added this comment. I can extend it bit more in detail. dc3d858#diff-ce272af2d0a2ea89b38de1d671441e79R443", "author": "cgorantla", "createdAt": "2020-05-03T21:05:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEzMDE3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NzI4MA==", "url": "https://github.com/OpenNMS/opennms/pull/2988#discussion_r419497280", "bodyText": "Added more detailed comment.", "author": "cgorantla", "createdAt": "2020-05-04T14:53:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTEzMDE3MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "be7651e5b3b7b916f5a58287dc9d4f72cb14d874", "url": "https://github.com/OpenNMS/opennms/commit/be7651e5b3b7b916f5a58287dc9d4f72cb14d874", "message": "NMS-12681: Add more detailed comment [skip ci]", "committedDate": "2020-05-04T14:52:11Z", "type": "commit"}]}