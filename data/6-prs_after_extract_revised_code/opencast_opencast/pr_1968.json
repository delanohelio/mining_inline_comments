{"pr_number": 1968, "pr_title": "Allow addMediaPackage to Accept ACLs", "pr_createdAt": "2020-10-15T21:16:28Z", "pr_url": "https://github.com/opencast/opencast/pull/1968", "timeline": [{"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "url": "https://github.com/opencast/opencast/commit/3ef7205f930a0e228f41f44618b9ebb4246f6e08", "message": "Allow addMediaPackage to Accept ACLs\n\nThis patch allows the single request ingest to accept access control\nlists:\n\n    curl http://localhost:8080/ingest/addMediaPackage/fast \\\n      -u admin:opencast \\\n      -F 'flavor=presentation/source' \\\n      -F 'BODY=@sintel_trailer-1080p.mp4' \\\n      -F title=test \\\n      -F acl='{\"acl\": {\"ace\": [\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n          {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'", "committedDate": "2020-10-15T21:46:53Z", "type": "commit"}, {"oid": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "url": "https://github.com/opencast/opencast/commit/3ef7205f930a0e228f41f44618b9ebb4246f6e08", "message": "Allow addMediaPackage to Accept ACLs\n\nThis patch allows the single request ingest to accept access control\nlists:\n\n    curl http://localhost:8080/ingest/addMediaPackage/fast \\\n      -u admin:opencast \\\n      -F 'flavor=presentation/source' \\\n      -F 'BODY=@sintel_trailer-1080p.mp4' \\\n      -F title=test \\\n      -F acl='{\"acl\": {\"ace\": [\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"read\"},\n          {\"allow\": true,\"role\": \"ROLE_ADMIN\",\"action\": \"write\"},\n          {\"allow\": true,\"role\": \"ROLE_USER\",\"action\": \"read\"}]}}'", "committedDate": "2020-10-15T21:46:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwODM5OA==", "url": "https://github.com/opencast/opencast/pull/1968#discussion_r525208398", "bodyText": "maybe a variable, longer then two chars would be nice? \"inputstream\"", "author": "CGreweling", "createdAt": "2020-11-17T14:44:21Z", "path": "modules/ingest-service-impl/src/main/java/org/opencastproject/ingest/endpoint/IngestRestService.java", "diffHunk": "@@ -796,6 +804,19 @@ public Response addMediaPackage(@Context HttpServletRequest request, @PathParam(\n               InputStream is = new ByteArrayInputStream(value.getBytes(\"UTF-8\"));\n               ingestService.addCatalog(is, fileName, MediaPackageElements.SERIES, mp);\n \n+              // Add ACL in JSON, XML or XACML format\n+            } else if (\"acl\".equals(fieldName)) {\n+              InputStream is = new ByteArrayInputStream(value.getBytes(StandardCharsets.UTF_8));", "originalCommit": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIwOTAwMA==", "url": "https://github.com/opencast/opencast/pull/1968#discussion_r525209000", "bodyText": "logger.debug would be nice here. instead of a comentar in the code", "author": "CGreweling", "createdAt": "2020-11-17T14:45:02Z", "path": "modules/ingest-service-impl/src/main/java/org/opencastproject/ingest/endpoint/IngestRestService.java", "diffHunk": "@@ -796,6 +804,19 @@ public Response addMediaPackage(@Context HttpServletRequest request, @PathParam(\n               InputStream is = new ByteArrayInputStream(value.getBytes(\"UTF-8\"));\n               ingestService.addCatalog(is, fileName, MediaPackageElements.SERIES, mp);\n \n+              // Add ACL in JSON, XML or XACML format\n+            } else if (\"acl\".equals(fieldName)) {\n+              InputStream is = new ByteArrayInputStream(value.getBytes(StandardCharsets.UTF_8));\n+              AccessControlList acl;\n+              try {\n+                acl = AccessControlParser.parseAcl(is);\n+                is = new ByteArrayInputStream(XACMLUtils.getXacml(mp, acl).getBytes(StandardCharsets.UTF_8));\n+              } catch (AccessControlParsingException e) {\n+                // Couldn't parse this \u2192 already XACML. Why again are we using three different formats?\n+                is.reset();", "originalCommit": "3ef7205f930a0e228f41f44618b9ebb4246f6e08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}