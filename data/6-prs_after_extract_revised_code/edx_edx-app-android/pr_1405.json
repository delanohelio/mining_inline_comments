{"pr_number": 1405, "pr_title": "Fix crash while showing the cast IntroductoryOverlay", "pr_createdAt": "2020-04-22T07:58:06Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1405", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NTk5Nw==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412785997", "bodyText": "Nits:\n\nUse a block comment instead of single-line comments.\nPlease create a ticket for updating google services specifically mentioning the cast SDK in it.\nOnce the ticket is created add an item in its acceptance criteria to revisit this part of code in it.\nAlso the add the ticket's link to this TODO item.", "author": "miankhalid", "createdAt": "2020-04-22T08:36:55Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java", "diffHunk": "@@ -78,9 +81,19 @@ public boolean showGoogleCastButton() {\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        if (mediaRouteMenuItem != null) {\n-            googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n+        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n+        // check following issue tracker for more details (still open).\n+        // Ref: https://issuetracker.google.com/issues/36191274\n+        // TODO: Replace the try-catch block with more appropriate logic / by updating the cast library", "originalCommit": "b8a1932d41f17927aefa0cde17c4cfd1e7d726ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAxNTg5MQ==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r413015891", "bodyText": "done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-22T14:09:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc4NTk5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b6ce70937419b25318938ad5758feca3e49d3002", "chunk": "diff --git a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\nindex 87759335..cbb62263 100644\n--- a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n+++ b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n\n@@ -81,10 +81,12 @@ public abstract class BaseAppActivity extends RoboAppCompatActivity implements C\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n-        // check following issue tracker for more details (still open).\n-        // Ref: https://issuetracker.google.com/issues/36191274\n-        // TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+        /* App throws `IllegalArgumentException` when showing the Introductory Overlay in some cases.\n+         * Check the following issue for more details (still open).\n+         * Ref: https://issuetracker.google.com/issues/36191274\n+         * TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+         * as part of the Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n+         */\n         try {\n             if (isInForeground()) {\n                 if (mediaRouteMenuItem != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5MzQ4OA==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412793488", "bodyText": "This won't log the exception to Crashlytics as a non-fatal, you'll have to call the function as follows:\n logger.error(e, true);", "author": "miankhalid", "createdAt": "2020-04-22T08:47:14Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java", "diffHunk": "@@ -49,7 +51,8 @@ public boolean onCreateOptionsMenu(Menu menu) {\n                     googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n                 }\n             }\n-        } catch (Exception ignore) {\n+        } catch (Exception e) {\n+            logger.error(e);", "originalCommit": "b8a1932d41f17927aefa0cde17c4cfd1e7d726ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk3ODYyMQ==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412978621", "bodyText": "Done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-22T13:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5MzQ4OA=="}], "type": "inlineReview", "revised_code": {"commit": "b6ce70937419b25318938ad5758feca3e49d3002", "chunk": "diff --git a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\nindex 87759335..cbb62263 100644\n--- a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n+++ b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n\n@@ -52,7 +52,7 @@ public abstract class BaseAppActivity extends RoboAppCompatActivity implements C\n                 }\n             }\n         } catch (Exception e) {\n-            logger.error(e);\n+            logger.error(e, true);\n         }\n         return super.onCreateOptionsMenu(menu);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5ODQxNg==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412798416", "bodyText": "This won't log the exception to Crashlytics as a non-fatal, you'll have to call the function as follows:\n logger.error(e, true);", "author": "miankhalid", "createdAt": "2020-04-22T08:53:53Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java", "diffHunk": "@@ -78,9 +81,19 @@ public boolean showGoogleCastButton() {\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        if (mediaRouteMenuItem != null) {\n-            googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n+        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n+        // check following issue tracker for more details (still open).\n+        // Ref: https://issuetracker.google.com/issues/36191274\n+        // TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+        try {\n+            if (isInForeground()) {\n+                if (mediaRouteMenuItem != null) {\n+                    googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n+                }\n+                invalidateOptionsMenu();\n+            }\n+        } catch (Exception e) {\n+            logger.error(e);", "originalCommit": "b8a1932d41f17927aefa0cde17c4cfd1e7d726ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk4MDQzNw==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412980437", "bodyText": "done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-22T13:26:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5ODQxNg=="}], "type": "inlineReview", "revised_code": {"commit": "b6ce70937419b25318938ad5758feca3e49d3002", "chunk": "diff --git a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\nindex 87759335..cbb62263 100644\n--- a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n+++ b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n\n@@ -81,10 +81,12 @@ public abstract class BaseAppActivity extends RoboAppCompatActivity implements C\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n-        // check following issue tracker for more details (still open).\n-        // Ref: https://issuetracker.google.com/issues/36191274\n-        // TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+        /* App throws `IllegalArgumentException` when showing the Introductory Overlay in some cases.\n+         * Check the following issue for more details (still open).\n+         * Ref: https://issuetracker.google.com/issues/36191274\n+         * TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+         * as part of the Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n+         */\n         try {\n             if (isInForeground()) {\n                 if (mediaRouteMenuItem != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5OTgzNQ==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412799835", "bodyText": "issue instead of issue tracker", "author": "miankhalid", "createdAt": "2020-04-22T08:55:43Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java", "diffHunk": "@@ -78,9 +81,19 @@ public boolean showGoogleCastButton() {\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        if (mediaRouteMenuItem != null) {\n-            googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n+        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n+        // check following issue tracker for more details (still open).", "originalCommit": "b8a1932d41f17927aefa0cde17c4cfd1e7d726ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk4MDU4OQ==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r412980589", "bodyText": "Done.", "author": "farhan-arshad-dev", "createdAt": "2020-04-22T13:26:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc5OTgzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "b6ce70937419b25318938ad5758feca3e49d3002", "chunk": "diff --git a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\nindex 87759335..cbb62263 100644\n--- a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n+++ b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n\n@@ -81,10 +81,12 @@ public abstract class BaseAppActivity extends RoboAppCompatActivity implements C\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        // App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n-        // check following issue tracker for more details (still open).\n-        // Ref: https://issuetracker.google.com/issues/36191274\n-        // TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+        /* App throws `IllegalArgumentException` when showing the Introductory Overlay in some cases.\n+         * Check the following issue for more details (still open).\n+         * Ref: https://issuetracker.google.com/issues/36191274\n+         * TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n+         * as part of the Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n+         */\n         try {\n             if (isInForeground()) {\n                 if (mediaRouteMenuItem != null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzAyOTg0Mg==", "url": "https://github.com/edx/edx-app-android/pull/1405#discussion_r413029842", "bodyText": "/* App throws `IllegalArgumentException` when showing the Introductory Overlay in some cases.\n         * Check the following issue for more details (still open).\n         * Ref: https://issuetracker.google.com/issues/36191274\n         * TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n         * as part of the Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n         */", "author": "miankhalid", "createdAt": "2020-04-22T14:25:54Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java", "diffHunk": "@@ -78,9 +81,21 @@ public boolean showGoogleCastButton() {\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        if (mediaRouteMenuItem != null) {\n-            googleCastDelegate.showIntroductoryOverlay(this, mediaRouteMenuItem);\n+        /* App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n+         * check following issue for more details (still open).", "originalCommit": "888888513744935475067bcfd24052b516b80f90", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b6ce70937419b25318938ad5758feca3e49d3002", "chunk": "diff --git a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\nindex d27e410f..cbb62263 100644\n--- a/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n+++ b/OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseAppActivity.java\n\n@@ -81,11 +81,11 @@ public abstract class BaseAppActivity extends RoboAppCompatActivity implements C\n \n     @Override\n     public void onCastStateChanged(int newState) {\n-        /* App initiate `IllegalArgumentException` when showing the IntroductoryOverlay in some cases,\n-         * check following issue for more details (still open).\n+        /* App throws `IllegalArgumentException` when showing the Introductory Overlay in some cases.\n+         * Check the following issue for more details (still open).\n          * Ref: https://issuetracker.google.com/issues/36191274\n          * TODO: Replace the try-catch block with more appropriate logic / by updating the cast library\n-         *  as part of Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n+         * as part of the Jira story: https://openedx.atlassian.net/browse/LEARNER-7722\n          */\n         try {\n             if (isInForeground()) {\n"}}, {"oid": "b6ce70937419b25318938ad5758feca3e49d3002", "url": "https://github.com/edx/edx-app-android/commit/b6ce70937419b25318938ad5758feca3e49d3002", "message": "Fix crash while showing the cast IntroductoryOverlay\n- LEARNER-7717\n- Ignore the crash by using try-catch block and print exception\n  logs on Crashlytics, as this  issue is already reported but still open.\n  ref: https://issuetracker.google.com/issues/36191274", "committedDate": "2020-04-22T14:53:35Z", "type": "commit"}, {"oid": "b6ce70937419b25318938ad5758feca3e49d3002", "url": "https://github.com/edx/edx-app-android/commit/b6ce70937419b25318938ad5758feca3e49d3002", "message": "Fix crash while showing the cast IntroductoryOverlay\n- LEARNER-7717\n- Ignore the crash by using try-catch block and print exception\n  logs on Crashlytics, as this  issue is already reported but still open.\n  ref: https://issuetracker.google.com/issues/36191274", "committedDate": "2020-04-22T14:53:35Z", "type": "forcePushed"}]}