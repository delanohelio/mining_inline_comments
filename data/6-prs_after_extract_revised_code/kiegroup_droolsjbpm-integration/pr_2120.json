{"pr_number": 2120, "pr_title": "[Drools 5321] Failing test org.kie.hacep.LocalStorageKieSessionTest.fireUntilHaltTest on timeout", "pr_createdAt": "2020-06-04T08:40:14Z", "pr_url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2120", "timeline": [{"oid": "fc1e439b24fe5ed9bd4bc1f289e63a9c94747d98", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/fc1e439b24fe5ed9bd4bc1f289e63a9c94747d98", "message": "increased timeout", "committedDate": "2020-05-12T10:59:06Z", "type": "commit"}, {"oid": "a6a5277a61be7932e17e9061f3ac5a23f22f07bf", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/a6a5277a61be7932e17e9061f3ac5a23f22f07bf", "message": "debug messages", "committedDate": "2020-05-20T11:36:31Z", "type": "commit"}, {"oid": "2bed621b860ce1ed0c382709d9bb7094ed34807c", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/2bed621b860ce1ed0c382709d9bb7094ed34807c", "message": "increased timeout to compensate the time spent using debug loglevel", "committedDate": "2020-05-21T08:30:54Z", "type": "commit"}, {"oid": "120fe86045050df12713bdb43509b88b83e796bf", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/120fe86045050df12713bdb43509b88b83e796bf", "message": "removed timout to see the behaviour", "committedDate": "2020-05-22T09:01:58Z", "type": "commit"}, {"oid": "8d89a9a1f51f76686a9361fd8478e22416e4c67d", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/8d89a9a1f51f76686a9361fd8478e22416e4c67d", "message": "Merge branch 'master' into drools-5321", "committedDate": "2020-05-22T09:02:55Z", "type": "commit"}, {"oid": "8d96c7dbaaabba3d22437d81dacde56e7717fefa", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/8d96c7dbaaabba3d22437d81dacde56e7717fefa", "message": "logging in the local producer", "committedDate": "2020-06-04T08:25:52Z", "type": "commit"}, {"oid": "847a6455e77ed3cf0a8bd0a2a20ae8fd1b71b13e", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/847a6455e77ed3cf0a8bd0a2a20ae8fd1b71b13e", "message": "Merge branch 'drools-5321' of github.com:desmax74/droolsjbpm-integration into drools-5321", "committedDate": "2020-06-04T08:26:50Z", "type": "commit"}, {"oid": "80adb2afbf502a5c1708dfe116fe3eb207e97e52", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/80adb2afbf502a5c1708dfe116fe3eb207e97e52", "message": "changed Map implementation", "committedDate": "2020-06-04T08:35:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTExMDk2Ng==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2120#discussion_r435110966", "bodyText": "this timeout removal caused deadlock in previous reverted PR", "author": "mareknovotny", "createdAt": "2020-06-04T09:17:18Z", "path": "drools-ha/ha-core-infra/src/test/java/org/kie/hacep/LocalStorageKieSessionTest.java", "diffHunk": "@@ -127,7 +127,7 @@ public void deleteTest() throws ExecutionException, InterruptedException {\n         assertEquals((Long) 0L, session.getFactCount().get());\n     }\n \n-    @Test(timeout = 20000)\n+    @Test", "originalCommit": "80adb2afbf502a5c1708dfe116fe3eb207e97e52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA1OTQ2NA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2120#discussion_r438059464", "bodyText": "do we really think this will work at the end?\nWDYT @danielezonca @mariofusco ?", "author": "mareknovotny", "createdAt": "2020-06-10T11:44:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTExMDk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODA3NDc5Mg==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2120#discussion_r438074792", "bodyText": "The current code has no reason to deadlock any more so it should be safe, btw fine for me to keep the timeout too. In the best case scenario it is not needed but it should not be a problem :)\n@desmax74 can you please restore the timeout?", "author": "danielezonca", "createdAt": "2020-06-10T12:14:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTExMDk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODExMjIzOQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2120#discussion_r438112239", "bodyText": "thanks @danielezonca for explanation. IF there is no potential race condition we try without timeout, but if we see that we need to react quickly and add it there", "author": "mareknovotny", "createdAt": "2020-06-10T13:15:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTExMDk2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f87d7d66703fb241262152380559b4a5c956bb2d", "chunk": "diff --git a/drools-ha/ha-core-infra/src/test/java/org/kie/hacep/LocalStorageKieSessionTest.java b/drools-ha/ha-core-infra/src/test/java/org/kie/hacep/LocalStorageKieSessionTest.java\nindex 7d82689da..0a379f6e8 100644\n--- a/drools-ha/ha-core-infra/src/test/java/org/kie/hacep/LocalStorageKieSessionTest.java\n+++ b/drools-ha/ha-core-infra/src/test/java/org/kie/hacep/LocalStorageKieSessionTest.java\n\n@@ -127,7 +127,7 @@ public class LocalStorageKieSessionTest {\n         assertEquals((Long) 0L, session.getFactCount().get());\n     }\n \n-    @Test\n+    @Test(timeout = 20000)\n     public void fireUntilHaltTest() throws ExecutionException, InterruptedException {\n \n         assertEquals((Long) 0L, session.getFactCount().get());\n"}}, {"oid": "ece5bd04dd3211b21beeacf06f9e60d16c5accea", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/ece5bd04dd3211b21beeacf06f9e60d16c5accea", "message": "lower log level", "committedDate": "2020-06-04T12:56:05Z", "type": "commit"}, {"oid": "68ca6922c6d02e926bdd74df9e3d236f67c295c0", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/68ca6922c6d02e926bdd74df9e3d236f67c295c0", "message": "Fix sonarcloud", "committedDate": "2020-06-10T07:34:44Z", "type": "commit"}, {"oid": "48bd6826dd57aee34090023d62ed37c44757391e", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/48bd6826dd57aee34090023d62ed37c44757391e", "message": "Remove logger", "committedDate": "2020-06-10T08:32:42Z", "type": "commit"}, {"oid": "831b88e14a0c195912da3f63757e9b859e2eda57", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/831b88e14a0c195912da3f63757e9b859e2eda57", "message": "remove logger", "committedDate": "2020-06-10T08:33:19Z", "type": "commit"}, {"oid": "b359b1f88e3652331c6786c606e88b1d17bd8733", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/b359b1f88e3652331c6786c606e88b1d17bd8733", "message": "removed debug logger", "committedDate": "2020-06-10T08:34:04Z", "type": "commit"}, {"oid": "f87d7d66703fb241262152380559b4a5c956bb2d", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f87d7d66703fb241262152380559b4a5c956bb2d", "message": "restored timeout", "committedDate": "2020-06-10T13:37:33Z", "type": "commit"}]}