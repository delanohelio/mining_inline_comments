{"pr_number": 2342, "pr_title": "[JBPM-9520] KafkaServerExtension poll is not freed", "pr_createdAt": "2020-12-16T16:08:47Z", "pr_url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342", "timeline": [{"oid": "49536454b1c056c7fe404c66bee1c107aefcac0b", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/49536454b1c056c7fe404c66bee1c107aefcac0b", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock", "committedDate": "2020-12-16T16:47:48Z", "type": "forcePushed"}, {"oid": "9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/9e4424e9ce1d9a03dcbd6fd2fae00f8a86981c4f", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock", "committedDate": "2020-12-16T17:11:40Z", "type": "forcePushed"}, {"oid": "79a13347f80402d68fdae1cf612fb2b8f61001ff", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/79a13347f80402d68fdae1cf612fb2b8f61001ff", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock", "committedDate": "2020-12-16T17:14:08Z", "type": "forcePushed"}, {"oid": "f45cffe58cc2ba9757699d3480d446c8da785100", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f45cffe58cc2ba9757699d3480d446c8da785100", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nUsing read write lock", "committedDate": "2020-12-16T17:15:32Z", "type": "forcePushed"}, {"oid": "2b33b675edfbc3bb83ba3d4556ab946faab1132c", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/2b33b675edfbc3bb83ba3d4556ab946faab1132c", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-16T17:55:24Z", "type": "forcePushed"}, {"oid": "827026d7e6669e13f474ebc0606196a5d5bb556a", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/827026d7e6669e13f474ebc0606196a5d5bb556a", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-16T17:56:47Z", "type": "forcePushed"}, {"oid": "f836b0faf2bd27c7ea85278de21cbf3158b41644", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/f836b0faf2bd27c7ea85278de21cbf3158b41644", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-16T17:59:52Z", "type": "forcePushed"}, {"oid": "b51199c28b28b0ba4499180d6a356070dfbcd0a6", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/b51199c28b28b0ba4499180d6a356070dfbcd0a6", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-16T18:06:56Z", "type": "forcePushed"}, {"oid": "349283d4cd378f75d2d5731528375ee44caec570", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/349283d4cd378f75d2d5731528375ee44caec570", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-17T09:44:10Z", "type": "commit"}, {"oid": "349283d4cd378f75d2d5731528375ee44caec570", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/349283d4cd378f75d2d5731528375ee44caec570", "message": "[JBPM-9520] KafkaServerExtension poll is not freed\n\nChanging lock policy", "committedDate": "2020-12-17T09:44:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk1MDI5NQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#discussion_r544950295", "bodyText": "This change tries to cover an edge case. System property enable when onDeploy/onActivate is called, but disable when onUndeploy/onDeactivate is invoked. This will  leak to a subscripton \"leak\". In order to avoid that, at the cost of sacrificing a bit of performance (not much in any case), it is better to clean always", "author": "fjtirado", "createdAt": "2020-12-17T09:46:21Z", "path": "kie-server-parent/kie-server-services/kie-server-services-kafka/src/main/java/org/kie/server/services/jbpm/kafka/KafkaServerExtension.java", "diffHunk": "@@ -272,12 +264,8 @@ private void updateTopics(String deploymentId, ProcessDefinition processDefiniti\n     }\n \n     private void removeTopics(String deploymentId, ProcessDefinition processDefinition) {\n-        if (processSignals()) {\n-            removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());\n-        }\n-        if (processMessages()) {\n-            removeTopics(topic2Message, deploymentId, processDefinition.getMessagesDesc());\n-        }\n+        removeTopics(topic2Signal, deploymentId, processDefinition.getSignalsDesc());", "originalCommit": "349283d4cd378f75d2d5731528375ee44caec570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIzMTMyMw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2342#discussion_r545231323", "bodyText": "OK, agreed; it's very weird but not impossible. Anyway, performance impact is minimum and removing topics is during undeployment.", "author": "gmunozfe", "createdAt": "2020-12-17T16:36:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDk1MDI5NQ=="}], "type": "inlineReview", "revised_code": null}]}