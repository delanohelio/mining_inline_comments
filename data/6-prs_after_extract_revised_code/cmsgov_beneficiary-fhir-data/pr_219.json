{"pr_number": 219, "pr_title": "BLUEBUTTON-1593 Refactor to simplify paging parameters", "pr_createdAt": "2020-02-13T18:02:14Z", "pr_url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219", "timeline": [{"oid": "54a43c15f1a7c8f6d5408ea7fcc21f98beeba640", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/54a43c15f1a7c8f6d5408ea7fcc21f98beeba640", "message": "Refactor to simplify paging parameters\n\n- Refactor of createPageLink() URL parameter building.\n\n- Remove method params not related to paging.\n\n- Retain original params from RequestDetails.", "committedDate": "2020-02-13T17:31:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzNzg2Nw==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379037867", "bodyText": "It looks like these can be removed, I don't see them being used anywhere.", "author": "whytheplatypus", "createdAt": "2020-02-13T18:23:45Z", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java", "diffHunk": "@@ -28,36 +28,17 @@\n   private final String resource;\n   private final String searchByDesc;\n   private final String identifier;\n-  private final DateRangeParam lastUpdated;\n-  private final String excludeSamhsa;\n-  private final Set<ClaimType> claimTypes;\n+  private final RequestDetails requestDetails;\n \n   public PageLinkBuilder(\n-      RequestDetails requestDetails,\n-      String resource,\n-      String searchByDesc,\n-      String identifier,\n-      DateRangeParam lastUpdated,\n-      Set<ClaimType> claimTypes,\n-      String excludeSamhsa) {\n+      RequestDetails requestDetails, String resource, String searchByDesc, String identifier) {\n     this.pageSize = parseIntegerParameters(requestDetails, Constants.PARAM_COUNT);\n     this.startIndex = parseIntegerParameters(requestDetails, \"startIndex\");\n     this.serverBase = requestDetails.getServerBaseForRequest();\n     this.resource = resource;\n     this.searchByDesc = searchByDesc;\n     this.identifier = identifier;", "originalCommit": "54a43c15f1a7c8f6d5408ea7fcc21f98beeba640", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzOTI3MQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379039271", "bodyText": "Good catch. Will verify and remove them.", "author": "dtisza1", "createdAt": "2020-02-13T18:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTAzNzg2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "cb7a7c7357b3f826fec2627e793bc9059b2d73de", "chunk": "diff --git a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\nindex 90fdf9710..afb2118e2 100644\n--- a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n+++ b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n\n@@ -24,20 +24,14 @@ public final class PageLinkBuilder {\n   private final Optional<Integer> pageSize;\n   private final Optional<Integer> startIndex;\n   private final String serverBase;\n-\n   private final String resource;\n-  private final String searchByDesc;\n-  private final String identifier;\n   private final RequestDetails requestDetails;\n \n-  public PageLinkBuilder(\n-      RequestDetails requestDetails, String resource, String searchByDesc, String identifier) {\n+  public PageLinkBuilder(RequestDetails requestDetails, String resource) {\n     this.pageSize = parseIntegerParameters(requestDetails, Constants.PARAM_COUNT);\n     this.startIndex = parseIntegerParameters(requestDetails, \"startIndex\");\n     this.serverBase = requestDetails.getServerBaseForRequest();\n     this.resource = resource;\n-    this.searchByDesc = searchByDesc;\n-    this.identifier = identifier;\n     this.requestDetails = requestDetails;\n   }\n \n"}}, {"oid": "cb7a7c7357b3f826fec2627e793bc9059b2d73de", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/cb7a7c7357b3f826fec2627e793bc9059b2d73de", "message": "Remove two unused variables.", "committedDate": "2020-02-13T19:08:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MjA3OA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379072078", "bodyText": "Small suggestion. You can make this read simpler by removing...\nMap<String, String> param = new HashMap<>(requestDetails...", "author": "RickHawesUSDS", "createdAt": "2020-02-13T19:28:47Z", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java", "diffHunk": "@@ -179,41 +155,27 @@ public void addPageLinks(Bundle toBundle, int numTotalResults) {\n    */\n   private String createPageLink(int startIndex) {\n     StringBuilder b = new StringBuilder();\n+\n+    // Setup URL base and resource.\n     b.append(serverBase);\n     b.append(resource);\n-    b.append(Constants.PARAM_COUNT + \"=\" + getPageSize());\n-    b.append(\"&startIndex=\" + startIndex);\n-    b.append(\"&\" + searchByDesc + \"=\" + identifier);\n-\n-    // Add the lastUpdated parameters if present\n-    if (lastUpdated != null) {\n-      DateParam lowerBound = lastUpdated.getLowerBound();\n-      if (lowerBound != null && !lowerBound.isEmpty()) {\n-        b.append(\n-            \"&\"\n-                + Constants.PARAM_LASTUPDATED\n-                + \"=\"\n-                + lowerBound.getPrefix().getValue()\n-                + lowerBound.getValueAsString());\n-      }\n-      DateParam upperBound = lastUpdated.getUpperBound();\n-      if (upperBound != null && !upperBound.isEmpty()) {\n-        b.append(\n-            \"&\"\n-                + Constants.PARAM_LASTUPDATED\n-                + \"=\"\n-                + upperBound.getPrefix().getValue()\n-                + upperBound.getValueAsString());\n-      }\n-    }\n \n-    // Add the \"type\" parameter if present\n-    if (claimTypes != null) {\n-      b.append(\"&type=\" + claimTypes.toString().toLowerCase().replaceAll(\"[\\\\[\\\\] ]\", \"\"));\n-    }\n+    // Get a copy of all request parameters.\n+    Map<String, String[]> params = new HashMap<String, String[]>(requestDetails.getParameters());", "originalCommit": "cb7a7c7357b3f826fec2627e793bc9059b2d73de", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b62a3ef437c911a2661a99313eb8df53a1d2f84", "chunk": "diff --git a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\nindex afb2118e2..594ff62bf 100644\n--- a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n+++ b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n\n@@ -161,9 +161,9 @@ public final class PageLinkBuilder {\n     b.append(resource);\n \n     // Get a copy of all request parameters.\n-    Map<String, String[]> params = new HashMap<String, String[]>(requestDetails.getParameters());\n+    Map<String, String[]> params = new HashMap<>(requestDetails.getParameters());\n \n-    // Add in paging related changes. Note: _lastUpdated is already in params.\n+    // Add in paging related changes.\n     params.put(\"startIndex\", new String[] {String.valueOf(startIndex)});\n     params.put(\"_count\", new String[] {String.valueOf(getPageSize())});\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3NTk0OQ==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379075949", "bodyText": "Now that we are really improving this method. I'm wondering if we could use UriBuilder instead of StringBuilder here.", "author": "RickHawesUSDS", "createdAt": "2020-02-13T19:36:30Z", "path": "apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java", "diffHunk": "@@ -179,41 +155,27 @@ public void addPageLinks(Bundle toBundle, int numTotalResults) {\n    */\n   private String createPageLink(int startIndex) {\n     StringBuilder b = new StringBuilder();\n+", "originalCommit": "cb7a7c7357b3f826fec2627e793bc9059b2d73de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA4NzE2Ng==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379087166", "bodyText": "That sounds interesting. Will check that out :-)", "author": "dtisza1", "createdAt": "2020-02-13T19:58:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3NTk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ4MTg3OA==", "url": "https://github.com/CMSgov/beneficiary-fhir-data/pull/219#discussion_r379481878", "bodyText": "@RickHawesUSDS I changed it to use the URIBuilder. This worked out well. I'll update how the links now look in the change details.  TY!", "author": "dtisza1", "createdAt": "2020-02-14T15:10:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3NTk0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "1b62a3ef437c911a2661a99313eb8df53a1d2f84", "chunk": "diff --git a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\nindex afb2118e2..594ff62bf 100644\n--- a/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n+++ b/apps/bfd-server/bfd-server-war/src/main/java/gov/cms/bfd/server/war/stu3/providers/PageLinkBuilder.java\n\n@@ -161,9 +161,9 @@ public final class PageLinkBuilder {\n     b.append(resource);\n \n     // Get a copy of all request parameters.\n-    Map<String, String[]> params = new HashMap<String, String[]>(requestDetails.getParameters());\n+    Map<String, String[]> params = new HashMap<>(requestDetails.getParameters());\n \n-    // Add in paging related changes. Note: _lastUpdated is already in params.\n+    // Add in paging related changes.\n     params.put(\"startIndex\", new String[] {String.valueOf(startIndex)});\n     params.put(\"_count\", new String[] {String.valueOf(getPageSize())});\n \n"}}, {"oid": "1b62a3ef437c911a2661a99313eb8df53a1d2f84", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/1b62a3ef437c911a2661a99313eb8df53a1d2f84", "message": "Refactor HashMap to be more readable", "committedDate": "2020-02-13T20:04:33Z", "type": "commit"}, {"oid": "954103da75674a280440181f5ac07b9970b18eb8", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/954103da75674a280440181f5ac07b9970b18eb8", "message": "Refactor createPageLink() to use URIBuilder", "committedDate": "2020-02-14T15:07:10Z", "type": "commit"}, {"oid": "a32ed3d709e244f845878227954dab07fafee8c1", "url": "https://github.com/CMSgov/beneficiary-fhir-data/commit/a32ed3d709e244f845878227954dab07fafee8c1", "message": "Merge remote-tracking branch 'origin/master' into BLUEBUTTON-1593-refactor-paging-for-type-excludesamhsa", "committedDate": "2020-02-14T17:22:42Z", "type": "commit"}]}