{"pr_number": 855, "pr_title": "Refactor project reference file page", "pr_createdAt": "2020-11-10T20:13:34Z", "pr_url": "https://github.com/phac-nml/irida/pull/855", "timeline": [{"oid": "aa2695e6eee1b916fe6a6ed64d2bfb0ef857db54", "url": "https://github.com/phac-nml/irida/commit/aa2695e6eee1b916fe6a6ed64d2bfb0ef857db54", "message": "Refactored Project reference files page", "committedDate": "2020-11-10T16:44:02Z", "type": "commit"}, {"oid": "712cb41d0470f28aa74afedfa00273fd1bed6655", "url": "https://github.com/phac-nml/irida/commit/712cb41d0470f28aa74afedfa00273fd1bed6655", "message": "Added translation. Added space between download and remove buttons for reference files. Updated ProjectReferenceFileController to return file size in a human readable format", "committedDate": "2020-11-10T20:08:15Z", "type": "commit"}, {"oid": "a0be93d886619460cd23b01ef845f08f831064c7", "url": "https://github.com/phac-nml/irida/commit/a0be93d886619460cd23b01ef845f08f831064c7", "message": "Added service for project reference files. Updated reference file react component to use drag and drop for file uploads. Added comments", "committedDate": "2020-11-10T21:41:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzI0OQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522027249", "bodyText": "Why are you using a custom class for this, it looks pretty much identical to AjaxSuccessResponse", "author": "joshsadam", "createdAt": "2020-11-12T11:13:33Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/ajax/AjaxRemoveItemSuccessResponse.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax;\n+\n+/**\n+ * UI Response for successfully removing an item. Will return the internationalized\n+ * success text.\n+ */\n+public class AjaxRemoveItemSuccessResponse extends AjaxResponse {", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzc3OA==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522027778", "bodyText": "Which extends to AjaxUpdateItemSuccessResponse, they are all the same.", "author": "joshsadam", "createdAt": "2020-11-12T11:14:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjgyNQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522352825", "bodyText": "Updated in 4e0f1cd", "author": "deepsidhu85", "createdAt": "2020-11-12T19:13:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyNzI0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/ajax/AjaxRemoveItemSuccessResponse.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/ajax/AjaxRemoveItemSuccessResponse.java\ndeleted file mode 100644\nindex bb6185c84d..0000000000\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/ajax/AjaxRemoveItemSuccessResponse.java\n+++ /dev/null\n\n@@ -1,22 +0,0 @@\n-package ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax;\n-\n-/**\n- * UI Response for successfully removing an item. Will return the internationalized\n- * success text.\n- */\n-public class AjaxRemoveItemSuccessResponse extends AjaxResponse {\n-\tpublic String responseMessage;\n-\n-\tpublic AjaxRemoveItemSuccessResponse(String responseMessage) {\n-\t\tthis.responseMessage = responseMessage;\n-\t}\n-\n-\tpublic String getResponseMessage() {\n-\t\treturn responseMessage;\n-\t}\n-\n-\tpublic void setResponseMessage(String responseMessage) {\n-\t\tthis.responseMessage = responseMessage;\n-\t}\n-}\n-\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMDQ3Nw==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522030477", "bodyText": "I thought this would not work without a leading /, surprised this works.", "author": "joshsadam", "createdAt": "2020-11-12T11:18:55Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.http.HttpStatus;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.exceptions.UnsupportedReferenceFileContentError;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UIProjectReferenceFileService;\n+\n+/**\n+ * Controller for ajax actions for reference files\n+ */\n+\n+@RestController\n+@RequestMapping(\"ajax/referenceFiles\")", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjkzMg==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522352932", "bodyText": "Yeah I was surprised too. Updated in 4e0f1cd", "author": "deepsidhu85", "createdAt": "2020-11-12T19:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMDQ3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\nindex 80cbe1002b..f2631e7b0c 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n\n@@ -7,6 +7,8 @@ import java.util.Locale;\n import javax.servlet.http.HttpServletResponse;\n \n import org.apache.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.ResponseEntity;\n import org.springframework.web.bind.annotation.*;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTExNQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522031115", "bodyText": "Because this is a post mapping, which means you are creating a new item, can you drop the /new from the end of the mapping?", "author": "joshsadam", "createdAt": "2020-11-12T11:20:00Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.http.HttpStatus;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.exceptions.UnsupportedReferenceFileContentError;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UIProjectReferenceFileService;\n+\n+/**\n+ * Controller for ajax actions for reference files\n+ */\n+\n+@RestController\n+@RequestMapping(\"ajax/referenceFiles\")\n+public class ReferenceFileAjaxController {\n+\n+\tprivate final UIProjectReferenceFileService uiProjectReferenceFileService;\n+\n+\t@Autowired\n+\tpublic ReferenceFileAjaxController(UIProjectReferenceFileService uiProjectReferenceFileService) {\n+\t\tthis.uiProjectReferenceFileService = uiProjectReferenceFileService;\n+\t}\n+\n+\t/**\n+\t * Add a new reference file to a project.\n+\t *\n+\t * @param projectId The id of the project to add the file to.\n+\t * @param files     {@link List} of {@link MultipartFile} file being uploaded.\n+\t * @param locale    locale of the logged in user\n+\t * @return Success message if file was successfully uploaded\n+\t */\n+\t@PostMapping(\"/project/{projectId}/new\")", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1Mjk5Ng==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522352996", "bodyText": "Updated in 4e0f1cd", "author": "deepsidhu85", "createdAt": "2020-11-12T19:14:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTExNQ=="}], "type": "inlineReview", "revised_code": {"commit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\nindex 80cbe1002b..f2631e7b0c 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n\n@@ -7,6 +7,8 @@ import java.util.Locale;\n import javax.servlet.http.HttpServletResponse;\n \n import org.apache.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.ResponseEntity;\n import org.springframework.web.bind.annotation.*;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTY2Ng==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522031666", "bodyText": "Same here, since this is a delete mapping just map to @DeleteMapping(\"\")", "author": "joshsadam", "createdAt": "2020-11-12T11:20:54Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.apache.http.HttpStatus;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.exceptions.UnsupportedReferenceFileContentError;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UIProjectReferenceFileService;\n+\n+/**\n+ * Controller for ajax actions for reference files\n+ */\n+\n+@RestController\n+@RequestMapping(\"ajax/referenceFiles\")\n+public class ReferenceFileAjaxController {\n+\n+\tprivate final UIProjectReferenceFileService uiProjectReferenceFileService;\n+\n+\t@Autowired\n+\tpublic ReferenceFileAjaxController(UIProjectReferenceFileService uiProjectReferenceFileService) {\n+\t\tthis.uiProjectReferenceFileService = uiProjectReferenceFileService;\n+\t}\n+\n+\t/**\n+\t * Add a new reference file to a project.\n+\t *\n+\t * @param projectId The id of the project to add the file to.\n+\t * @param files     {@link List} of {@link MultipartFile} file being uploaded.\n+\t * @param locale    locale of the logged in user\n+\t * @return Success message if file was successfully uploaded\n+\t */\n+\t@PostMapping(\"/project/{projectId}/new\")\n+\tpublic ResponseEntity<AjaxResponse> addReferenceFileToProject(@PathVariable Long projectId,\n+\t\t\t@RequestParam(value = \"file\") List<MultipartFile> files, final Locale locale) {\n+\t\ttry\n+\t\t{\n+\t\t\treturn ResponseEntity.ok(uiProjectReferenceFileService.addReferenceFileToProject(projectId, files, locale));\n+\t\t} catch (UnsupportedReferenceFileContentError e) {\n+\t\t\treturn ResponseEntity.status(HttpServletResponse.SC_UNSUPPORTED_MEDIA_TYPE)\n+\t\t\t\t\t.body(new AjaxErrorResponse(e.getMessage()));\n+\t\t} catch (IOException e) {\n+\t\t\treturn ResponseEntity.status(HttpServletResponse.SC_UNSUPPORTED_MEDIA_TYPE)\n+\t\t\t\t\t.body(new AjaxErrorResponse(\n+\t\t\t\t\t\t\te.getMessage()));\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Delete a reference file. This will remove it from the project.\n+\t *\n+\t * @param fileId    The id of the file to remove.\n+\t * @param projectId the project to delete the reference file for.\n+\t * @param locale    the locale specified by the browser.\n+\t * @return Success or error based on the result of deleting the file.\n+\t */\n+\t@DeleteMapping(\"/delete\")", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MzA2NQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522353065", "bodyText": "Updated in 4e0f1cd", "author": "deepsidhu85", "createdAt": "2020-11-12T19:14:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzMTY2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\nindex 80cbe1002b..f2631e7b0c 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n\n@@ -7,6 +7,8 @@ import java.util.Locale;\n import javax.servlet.http.HttpServletResponse;\n \n import org.apache.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.ResponseEntity;\n import org.springframework.web.bind.annotation.*;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDU4OQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522034589", "bodyText": "This should be moved over to the ajax controller", "author": "joshsadam", "createdAt": "2020-11-12T11:25:56Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java", "diffHunk": "@@ -60,71 +51,19 @@ public ReferenceFileController(ProjectService projectService, ReferenceFileServi\n \t/**\n \t * Download a reference file based on the id passed.\n \t *\n-\t * @param fileId\n-\t *            The id of the file to download\n-\t * @param response\n-\t *            {@link HttpServletResponse} to write to file to\n-\t *\n-\t * @throws IOException\n-\t *             if we fail to read the file from disk.\n+\t * @param fileId   The id of the file to download\n+\t * @param response {@link HttpServletResponse} to write to file to\n+\t * @throws IOException if we fail to read the file from disk.\n \t */\n \t@RequestMapping(value = \"/download/{fileId}\")\n-\tpublic void downloadReferenceFile(@PathVariable Long fileId,\n-\t\t\tHttpServletResponse response) throws IOException {\n+\tpublic void downloadReferenceFile(@PathVariable Long fileId, HttpServletResponse response) throws IOException {", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MzI2MA==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522353260", "bodyText": "Moved in 4e0f1cd", "author": "deepsidhu85", "createdAt": "2020-11-12T19:14:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDU4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java\nindex 7584a59573..0dfc8917e0 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java\n\n@@ -48,22 +48,6 @@ public class ReferenceFileController {\n \t\tthis.dateFormatter = new DateFormatter();\n \t}\n \n-\t/**\n-\t * Download a reference file based on the id passed.\n-\t *\n-\t * @param fileId   The id of the file to download\n-\t * @param response {@link HttpServletResponse} to write to file to\n-\t * @throws IOException if we fail to read the file from disk.\n-\t */\n-\t@RequestMapping(value = \"/download/{fileId}\")\n-\tpublic void downloadReferenceFile(@PathVariable Long fileId, HttpServletResponse response) throws IOException {\n-\t\tReferenceFile file = referenceFileService.read(fileId);\n-\t\tPath path = file.getFile();\n-\t\tresponse.setHeader(\"Content-Disposition\", \"attachment; filename=\\\"\" + file.getLabel() + \"\\\"\");\n-\t\tFiles.copy(path, response.getOutputStream());\n-\t\tresponse.flushBuffer();\n-\t}\n-\n \t/**\n \t * Upload a transient reference file, to be used for a single analysis.\n \t *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDg5Mg==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522034892", "bodyText": "Don't you have this in the ajax cntroller?  Or is it here for other old requests?", "author": "joshsadam", "createdAt": "2020-11-12T11:26:28Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileController.java", "diffHunk": "@@ -135,8 +74,8 @@ public void downloadReferenceFile(@PathVariable Long fileId,\n \t * @throws IOException if the new reference file cannot be saved\n \t */\n \t@RequestMapping(\"/new\")\n-\tpublic Map<String, Object> addIndependentReferenceFile(\n-\t\t\tfinal @RequestParam(value = \"file\") MultipartFile file, final HttpServletResponse response, final Locale locale) throws IOException {\n+\tpublic Map<String, Object> addIndependentReferenceFile(final @RequestParam(value = \"file\") MultipartFile file,", "originalCommit": "a0be93d886619460cd23b01ef845f08f831064c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjExNTE1MQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522115151", "bodyText": "This is for other old requests. It's not being used by the stuff I refactored", "author": "deepsidhu85", "createdAt": "2020-11-12T13:44:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEzMDY0MA==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522130640", "bodyText": "Looks like it was for the generic_pipeline page which you are refactoring. I will leave it in there for now", "author": "deepsidhu85", "createdAt": "2020-11-12T14:06:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDg5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE2NzI1Mg==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522167252", "bodyText": "Sounds good, I will clean it up.", "author": "joshsadam", "createdAt": "2020-11-12T14:54:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzNDg5Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "url": "https://github.com/phac-nml/irida/commit/4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "message": "Added tests, refactored mappings, made react component for drag and drop upload, moved downloading of reference file to ajax controller", "committedDate": "2020-11-12T15:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3ODk5Nw==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522178997", "bodyText": "This file should be in the ajax package right?", "author": "joshsadam", "createdAt": "2020-11-12T15:10:09Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+import java.util.List;", "originalCommit": "4e0f1cd19cfb95ba3af35a86f7e3a2271d907412", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1NDY4OQ==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522354689", "bodyText": "Moved in 219a5fb", "author": "deepsidhu85", "createdAt": "2020-11-12T19:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjE3ODk5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "785d3502ec369bf251a95de39b1c8cb166e6327d", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/ReferenceFileAjaxController.java\nsimilarity index 97%\nrename from src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\nrename to src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/ReferenceFileAjaxController.java\nindex f2631e7b0c..6bdb528948 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/ReferenceFileAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/ReferenceFileAjaxController.java\n\n@@ -1,4 +1,4 @@\n-package ca.corefacility.bioinformatics.irida.ria.web.files;\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax;\n \n import java.io.IOException;\n import java.util.List;\n"}}, {"oid": "785d3502ec369bf251a95de39b1c8cb166e6327d", "url": "https://github.com/phac-nml/irida/commit/785d3502ec369bf251a95de39b1c8cb166e6327d", "message": "Changed request mapping url to not use camelcase. Removed dependency on page variables", "committedDate": "2020-11-12T16:21:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NTcwMg==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522265702", "bodyText": "Your controllers should return the ajax response not your services.", "author": "joshsadam", "createdAt": "2020-11-12T17:02:29Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIProjectReferenceFileService.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import javax.servlet.http.HttpServletResponse;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.MessageSource;\n+import org.springframework.stereotype.Component;\n+import org.springframework.web.multipart.MultipartFile;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.exceptions.UnsupportedReferenceFileContentError;\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.project.ReferenceFile;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax.AjaxResponse;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.ajax.AjaxUpdateItemSuccessResponse;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.ReferenceFileService;\n+\n+/**\n+ * A utility class for formatting responses for the project reference files page UI.\n+ */\n+\n+@Component\n+public class UIProjectReferenceFileService {\n+\tprivate static final Logger logger = LoggerFactory.getLogger(UIProjectReferenceFileService.class);\n+\n+\tprivate final ProjectService projectService;\n+\tprivate final ReferenceFileService referenceFileService;\n+\tprivate final MessageSource messageSource;\n+\n+\t@Autowired\n+\tpublic UIProjectReferenceFileService(ProjectService projectService, ReferenceFileService referenceFileService, MessageSource messageSource) {\n+\t\tthis.projectService = projectService;\n+\t\tthis.referenceFileService = referenceFileService;\n+\t\tthis.messageSource = messageSource;\n+\t}\n+\n+\t/**\n+\t * Add a new reference file to a project.\n+\t *\n+\t * @param projectId The id of the project to add the file to.\n+\t * @param files     {@link List} of {@link MultipartFile} file being uploaded.\n+\t * @param locale    locale of the logged in user\n+\t * @return Return success or error message if file was successfully uploaded or not\n+\t * @throws UnsupportedReferenceFileContentError if content is invalid\n+\t * @throws IOException if there is an I/O error\n+\t */\n+\tpublic AjaxResponse addReferenceFileToProject(Long projectId, List<MultipartFile> files, final Locale locale) throws UnsupportedReferenceFileContentError, IOException {", "originalCommit": "785d3502ec369bf251a95de39b1c8cb166e6327d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1NDQ2Nw==", "url": "https://github.com/phac-nml/irida/pull/855#discussion_r522354467", "bodyText": "Updated in 219a5fb", "author": "deepsidhu85", "createdAt": "2020-11-12T19:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2NTcwMg=="}], "type": "inlineReview", "revised_code": {"commit": "219a5fbdd6a0ee0e31fd61c6c443e0020191c82d", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIProjectReferenceFileService.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIProjectReferenceFileService.java\nindex 1b99d8651a..c06cc6e3cd 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIProjectReferenceFileService.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UIProjectReferenceFileService.java\n\n@@ -49,11 +49,11 @@ public class UIProjectReferenceFileService {\n \t * @param projectId The id of the project to add the file to.\n \t * @param files     {@link List} of {@link MultipartFile} file being uploaded.\n \t * @param locale    locale of the logged in user\n-\t * @return Return success or error message if file was successfully uploaded or not\n+\t * @return Return success message or error if file was successfully uploaded or not\n \t * @throws UnsupportedReferenceFileContentError if content is invalid\n \t * @throws IOException if there is an I/O error\n \t */\n-\tpublic AjaxResponse addReferenceFileToProject(Long projectId, List<MultipartFile> files, final Locale locale) throws UnsupportedReferenceFileContentError, IOException {\n+\tpublic String addReferenceFileToProject(Long projectId, List<MultipartFile> files, final Locale locale) throws UnsupportedReferenceFileContentError, IOException {\n \t\tProject project = projectService.read(projectId);\n \t\tlogger.debug(\"Adding reference file to project \" + projectId);\n \n"}}, {"oid": "219a5fbdd6a0ee0e31fd61c6c443e0020191c82d", "url": "https://github.com/phac-nml/irida/commit/219a5fbdd6a0ee0e31fd61c6c443e0020191c82d", "message": "Removed referencefilecontrollertest as nothing is left in it. Updated service to return string and left to the ajax controller to return the ajaxresponse. Added Space to components on page", "committedDate": "2020-11-12T19:03:59Z", "type": "commit"}, {"oid": "dd183da083913b40b274aa6bcd507cdd745f8ae4", "url": "https://github.com/phac-nml/irida/commit/dd183da083913b40b274aa6bcd507cdd745f8ae4", "message": "Ran prettier on jsx file. Updated ui tests", "committedDate": "2020-11-12T19:46:20Z", "type": "commit"}, {"oid": "c5c49bbd44d984b4dad37fe3f6a1ccb9637a66c3", "url": "https://github.com/phac-nml/irida/commit/c5c49bbd44d984b4dad37fe3f6a1ccb9637a66c3", "message": "Updated CHANGELOG", "committedDate": "2020-11-12T19:47:04Z", "type": "commit"}, {"oid": "19f6e069b671f932cb6a0b9c4ccab524ce6f00fb", "url": "https://github.com/phac-nml/irida/commit/19f6e069b671f932cb6a0b9c4ccab524ce6f00fb", "message": "Updated user docs. Added accept type to reference file uploads", "committedDate": "2020-11-12T20:11:15Z", "type": "commit"}, {"oid": "edc22ae70cb2b0a646f5d729f1ac81c0425a27b1", "url": "https://github.com/phac-nml/irida/commit/edc22ae70cb2b0a646f5d729f1ac81c0425a27b1", "message": "Removed margin. Added props to DragUpload for uploadText and uploadHint", "committedDate": "2020-11-12T21:15:34Z", "type": "commit"}, {"oid": "b305499a798856ef177a492a2b9cd4df39c349d3", "url": "https://github.com/phac-nml/irida/commit/b305499a798856ef177a492a2b9cd4df39c349d3", "message": "Removed functions for creating reference file upload and table components and rather have them created directly in the render", "committedDate": "2020-11-12T21:24:08Z", "type": "commit"}, {"oid": "ceef874df3c475b5b763e494f15671c13c999030", "url": "https://github.com/phac-nml/irida/commit/ceef874df3c475b5b763e494f15671c13c999030", "message": "Updated comment", "committedDate": "2020-11-12T21:27:33Z", "type": "commit"}, {"oid": "4a2d4c699672f6a2c38bf4f177a64ae825ca9658", "url": "https://github.com/phac-nml/irida/commit/4a2d4c699672f6a2c38bf4f177a64ae825ca9658", "message": "Fixed javadoc", "committedDate": "2020-11-13T13:54:04Z", "type": "commit"}, {"oid": "5112105d98612e0a0656bdd585c5a1ad92c8ecf7", "url": "https://github.com/phac-nml/irida/commit/5112105d98612e0a0656bdd585c5a1ad92c8ecf7", "message": "Removed unused imports. Updated reference file page disable download button if a file is not found", "committedDate": "2020-11-13T16:47:26Z", "type": "commit"}, {"oid": "cc413c0effe38359e560f4dd5c97bbc8d4329c35", "url": "https://github.com/phac-nml/irida/commit/cc413c0effe38359e560f4dd5c97bbc8d4329c35", "message": "Updated get project reference files method to use a dto rather than return a map", "committedDate": "2020-11-14T01:39:07Z", "type": "commit"}, {"oid": "f3af72056f2da88f0f5b79e3e8d4ef85049f36bd", "url": "https://github.com/phac-nml/irida/commit/f3af72056f2da88f0f5b79e3e8d4ef85049f36bd", "message": "Changed uireferencefile constructor call for project reference files", "committedDate": "2020-11-15T22:24:14Z", "type": "commit"}, {"oid": "2b53d25bdf53898412ff91c4160541bf5660d4f2", "url": "https://github.com/phac-nml/irida/commit/2b53d25bdf53898412ff91c4160541bf5660d4f2", "message": "Added missing javadoc throws", "committedDate": "2020-11-15T22:26:03Z", "type": "commit"}, {"oid": "ed8e5bab8e42c96cf189f818ab0edbf26f352e18", "url": "https://github.com/phac-nml/irida/commit/ed8e5bab8e42c96cf189f818ab0edbf26f352e18", "message": "Updated UIReferenceFile dto constructor to accept a file size (this was needed to fix testing as well as if there is an exception caught in which the size needs to be set to an error string)", "committedDate": "2020-11-16T16:16:10Z", "type": "commit"}, {"oid": "5f6f981abe63b6bd54d9bfd72be4599dd6ddc716", "url": "https://github.com/phac-nml/irida/commit/5f6f981abe63b6bd54d9bfd72be4599dd6ddc716", "message": "Updated dto to accept size and not attempt to get size inside of constructor", "committedDate": "2020-11-16T17:02:31Z", "type": "commit"}]}