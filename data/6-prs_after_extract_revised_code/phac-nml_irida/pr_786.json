{"pr_number": 786, "pr_title": "Auto update analysis progress", "pr_createdAt": "2020-08-24T22:27:02Z", "pr_url": "https://github.com/phac-nml/irida/pull/786", "timeline": [{"oid": "c1987b0e838897d697b0333f4247107092beb292", "url": "https://github.com/phac-nml/irida/commit/c1987b0e838897d697b0333f4247107092beb292", "message": "Updated analysis results page to auto update the progression of the analysis using polling", "committedDate": "2020-08-24T22:25:27Z", "type": "commit"}, {"oid": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651", "url": "https://github.com/phac-nml/irida/commit/ad227bb2e037c54e6e4f16e7cda701b6d2c65651", "message": "Removed unused imports", "committedDate": "2020-08-24T22:28:36Z", "type": "commit"}, {"oid": "a48aa588b48496b26293670142239f3ee580ef13", "url": "https://github.com/phac-nml/irida/commit/a48aa588b48496b26293670142239f3ee580ef13", "message": "Updated AnalysisContext to use custom useInterval hook for polling. Updated useInterval hook to return an id which can be used to clear an interval rather than waiting for a component to unmount", "committedDate": "2020-08-25T16:22:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTExNw==", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476665117", "bodyText": "Wrap this in a ResponseEntity so you can return an error state if you need to.", "author": "joshsadam", "createdAt": "2020-08-25T18:49:53Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody\n+\tpublic UpdatedAnalysisProgress getProvenanceByFile(@PathVariable Long submissionId) {", "originalCommit": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzA3OQ==", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697079", "bodyText": "Updated in c64a856", "author": "deepsidhu85", "createdAt": "2020-08-25T19:48:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTExNw=="}], "type": "inlineReview", "revised_code": {"commit": "c64a856128d212fdda1bcab36dbf56b78cef8399", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\nindex 0b410acb68..84ead2c007 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\n\n@@ -1156,8 +1156,7 @@ public class AnalysisAjaxController {\n \t * @return dto which contains the updated analysis state and duration\n \t */\n \t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n-\t@ResponseBody\n-\tpublic UpdatedAnalysisProgress getProvenanceByFile(@PathVariable Long submissionId) {\n+\tpublic ResponseEntity<UpdatedAnalysisProgress> getUpdatedProgress(@PathVariable Long submissionId) {\n \t\tlogger.trace(\"reading analysis submission \" + submissionId);\n \t\tAnalysisSubmission submission = analysisSubmissionService.read(submissionId);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTYyMA==", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476665620", "bodyText": "Because this is a RestController you don't have to annotate methods with ResponseBody", "author": "joshsadam", "createdAt": "2020-08-25T18:50:44Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java", "diffHunk": "@@ -1148,6 +1149,36 @@ public AnalysisProvenanceResponse getProvenanceByFile(@PathVariable Long submiss\n \t\treturn analysisProvenance;\n \t}\n \n+\t/**\n+\t * Get the updated state and duration of an analysis\n+\t *\n+\t * @param submissionId The analysis submission id\n+\t * @return dto which contains the updated analysis state and duration\n+\t */\n+\t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n+\t@ResponseBody", "originalCommit": "ad227bb2e037c54e6e4f16e7cda701b6d2c65651", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NzAzMg==", "url": "https://github.com/phac-nml/irida/pull/786#discussion_r476697032", "bodyText": "Removed in c64a856", "author": "deepsidhu85", "createdAt": "2020-08-25T19:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2NTYyMA=="}], "type": "inlineReview", "revised_code": {"commit": "c64a856128d212fdda1bcab36dbf56b78cef8399", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\nindex 0b410acb68..84ead2c007 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/analysis/AnalysisAjaxController.java\n\n@@ -1156,8 +1156,7 @@ public class AnalysisAjaxController {\n \t * @return dto which contains the updated analysis state and duration\n \t */\n \t@RequestMapping(value = \"/{submissionId}/updated-progress\")\n-\t@ResponseBody\n-\tpublic UpdatedAnalysisProgress getProvenanceByFile(@PathVariable Long submissionId) {\n+\tpublic ResponseEntity<UpdatedAnalysisProgress> getUpdatedProgress(@PathVariable Long submissionId) {\n \t\tlogger.trace(\"reading analysis submission \" + submissionId);\n \t\tAnalysisSubmission submission = analysisSubmissionService.read(submissionId);\n \n"}}, {"oid": "c64a856128d212fdda1bcab36dbf56b78cef8399", "url": "https://github.com/phac-nml/irida/commit/c64a856128d212fdda1bcab36dbf56b78cef8399", "message": "Updated useInterval in AnalysisContext to only update state and/or duration values if they have changed and to catch any server errors. Updated docs. Removed @ResponseBody annotation as the AnalysisAjaxController is a RESTController. Wrapped return value of getUpdatedProgress in a ResponseEntity.", "committedDate": "2020-08-25T19:47:58Z", "type": "commit"}]}