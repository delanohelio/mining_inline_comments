{"pr_number": 835, "pr_title": "Refactor fastqc page", "pr_createdAt": "2020-10-23T16:16:40Z", "pr_url": "https://github.com/phac-nml/irida/pull/835", "timeline": [{"oid": "139845ae0399cc73ea9aa42936a8341d24590480", "url": "https://github.com/phac-nml/irida/commit/139845ae0399cc73ea9aa42936a8341d24590480", "message": "Added react pages for fastqc images, overrepresented sequences, fastqc details. Added ajax controller. Added dto for FastQCDetails", "committedDate": "2020-10-21T21:16:26Z", "type": "commit"}, {"oid": "9c271d4180ce305d7639fd449fdbb787a7c5c0a1", "url": "https://github.com/phac-nml/irida/commit/9c271d4180ce305d7639fd449fdbb787a7c5c0a1", "message": "Added overrepresented sequences and details retrieved from server", "committedDate": "2020-10-22T20:59:28Z", "type": "commit"}, {"oid": "8ecefccb0e9e2961e6ce5ffd20787ae36f33927d", "url": "https://github.com/phac-nml/irida/commit/8ecefccb0e9e2961e6ce5ffd20787ae36f33927d", "message": "Removed tests no longer required. Added translations. Updated to remove page variables and rather get ids from the url. Updated FastQCCharts to display the fastqc images. Cleaned up SequenceFileController.", "committedDate": "2020-10-23T16:15:39Z", "type": "commit"}, {"oid": "b20999bdbf3c3bce317d11edf61c466f7083b3a1", "url": "https://github.com/phac-nml/irida/commit/b20999bdbf3c3bce317d11edf61c466f7083b3a1", "message": "Added javadocs", "committedDate": "2020-10-23T16:19:10Z", "type": "commit"}, {"oid": "aea11c08be634c86b5b177f25280996297aeb657", "url": "https://github.com/phac-nml/irida/commit/aea11c08be634c86b5b177f25280996297aeb657", "message": "Added missing translations. Removed page variables from template", "committedDate": "2020-10-23T16:23:37Z", "type": "commit"}, {"oid": "b6516176996f03c807f5960c3194a18a684f7197", "url": "https://github.com/phac-nml/irida/commit/b6516176996f03c807f5960c3194a18a684f7197", "message": "Removed logging statement. Added badge with count of overrepresented sequences to link", "committedDate": "2020-10-23T17:49:41Z", "type": "commit"}, {"oid": "aa089ab37952a4ebcf277819445c3feea764e695", "url": "https://github.com/phac-nml/irida/commit/aa089ab37952a4ebcf277819445c3feea764e695", "message": "Refactored constants into separate file. Added showZero to badge so it displays if the count is 0", "committedDate": "2020-10-23T18:13:25Z", "type": "commit"}, {"oid": "40188c965764cf3e382cb55d195a234273838ed4", "url": "https://github.com/phac-nml/irida/commit/40188c965764cf3e382cb55d195a234273838ed4", "message": "Removed translations no longer required. Added info alert to fastqc component.", "committedDate": "2020-10-23T21:29:27Z", "type": "commit"}, {"oid": "ed4f2289929a35edd9e10b1dd6a7764021712b52", "url": "https://github.com/phac-nml/irida/commit/ed4f2289929a35edd9e10b1dd6a7764021712b52", "message": "Added sequencefileajaxcontroller test. Updated display of sequences and percentages on the overrepresented sequences page.", "committedDate": "2020-10-26T21:07:06Z", "type": "commit"}, {"oid": "4372be3feec2c4a30cd9973883f6d7e8fa1df2a3", "url": "https://github.com/phac-nml/irida/commit/4372be3feec2c4a30cd9973883f6d7e8fa1df2a3", "message": "Updated to use img tag. Removed extra alert.", "committedDate": "2020-10-27T15:19:19Z", "type": "commit"}, {"oid": "c33e7333361fdde4e1c61a410be57178c84f08d8", "url": "https://github.com/phac-nml/irida/commit/c33e7333361fdde4e1c61a410be57178c84f08d8", "message": "Added requestmapping to view fastqc results when clicking on link on samples/ page. Updated to check if window.location.pathname matches the url", "committedDate": "2020-10-27T16:11:50Z", "type": "commit"}, {"oid": "3f4c4e79be23142a33d27757ab5eb740af7ebfa3", "url": "https://github.com/phac-nml/irida/commit/3f4c4e79be23142a33d27757ab5eb740af7ebfa3", "message": "Updated percentage column to show 1 decimal place", "committedDate": "2020-10-27T17:53:23Z", "type": "commit"}, {"oid": "c0d7464e4db3696ee5f20fc7bf3866166c569e46", "url": "https://github.com/phac-nml/irida/commit/c0d7464e4db3696ee5f20fc7bf3866166c569e46", "message": "Added tests. Added class names for tests", "committedDate": "2020-10-27T20:33:34Z", "type": "commit"}, {"oid": "03c9b4b52376da0f42147a4f23efbd300ad0cbdd", "url": "https://github.com/phac-nml/irida/commit/03c9b4b52376da0f42147a4f23efbd300ad0cbdd", "message": "Updated CHANGELOG", "committedDate": "2020-10-27T21:11:08Z", "type": "commit"}, {"oid": "b5ecc8e7816d5049359e352b93fc4c70c6602b08", "url": "https://github.com/phac-nml/irida/commit/b5ecc8e7816d5049359e352b93fc4c70c6602b08", "message": "Merged dev and fixed merge conflicts", "committedDate": "2020-10-28T13:45:54Z", "type": "commit"}, {"oid": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "url": "https://github.com/phac-nml/irida/commit/cf58113ebe4c86d6272c27a0db02788cfa80a470", "message": "Changed image column widths and added borders. Added comments. Fixed test", "committedDate": "2020-10-29T14:57:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1OTUyMA==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514459520", "bodyText": "Why are you not creating a UI service to handle this stuff?", "author": "joshsadam", "createdAt": "2020-10-29T17:59:29Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java", "diffHunk": "@@ -0,0 +1,117 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.files;\n+\n+import java.io.IOException;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+import ca.corefacility.bioinformatics.irida.exceptions.EntityNotFoundException;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequenceFile;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequencingObject;\n+import ca.corefacility.bioinformatics.irida.model.workflow.analysis.AnalysisFastQC;\n+import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCDetailsResponse;\n+import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCImagesResponse;\n+import ca.corefacility.bioinformatics.irida.service.AnalysisService;\n+import ca.corefacility.bioinformatics.irida.service.SequencingObjectService;\n+\n+/**\n+ * Ajax controller to get data for the fastqc page.\n+ */\n+@RestController\n+@Scope(\"session\")\n+@RequestMapping(\"/ajax/sequenceFiles\")\n+public class SequenceFileAjaxController {\n+\n+\tprivate AnalysisService analysisService;\n+\tprivate SequencingObjectService sequencingObjectService;\n+\n+\tpublic static final String IMG_PERBASE = \"perbase\";\n+\tpublic static final String IMG_PERSEQUENCE = \"persequence\";\n+\tpublic static final String IMG_DUPLICATION_LEVEL = \"duplicationlevel\";\n+\n+\tpublic static final String[] qcFileTypes = { \"perbase\", \"persequence\", \"duplicationlevel\" };\n+\n+\t@Autowired\n+\tpublic SequenceFileAjaxController(AnalysisService analysisService,\n+\t\t\tSequencingObjectService sequencingObjectService) {", "originalCommit": "cf58113ebe4c86d6272c27a0db02788cfa80a470", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUxMTE0OQ==", "url": "https://github.com/phac-nml/irida/pull/835#discussion_r514511149", "bodyText": "Added in 8d915d2", "author": "deepsidhu85", "createdAt": "2020-10-29T19:26:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ1OTUyMA=="}], "type": "inlineReview", "revised_code": {"commit": "8d915d2b5135ef05b2f4eafaebe586d755b13903", "chunk": "diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java\nindex b91376622c..f3364a5f92 100644\n--- a/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java\n+++ b/src/main/java/ca/corefacility/bioinformatics/irida/ria/web/files/SequenceFileAjaxController.java\n\n@@ -16,6 +16,7 @@ import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequencingObject;\n import ca.corefacility.bioinformatics.irida.model.workflow.analysis.AnalysisFastQC;\n import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCDetailsResponse;\n import ca.corefacility.bioinformatics.irida.ria.web.files.dto.FastQCImagesResponse;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UISequenceFileService;\n import ca.corefacility.bioinformatics.irida.service.AnalysisService;\n import ca.corefacility.bioinformatics.irida.service.SequencingObjectService;\n \n"}}, {"oid": "8d915d2b5135ef05b2f4eafaebe586d755b13903", "url": "https://github.com/phac-nml/irida/commit/8d915d2b5135ef05b2f4eafaebe586d755b13903", "message": "Added UISequenceFileService. Added tests for service. Moved logic testing services into the service from the ajax controller. Updated sequence-files.js functions to throw an error if one is returned from the server. Removed customclassnames attribute from BasicList and instead added a props attribute to list items which contain the classname", "committedDate": "2020-10-29T19:20:09Z", "type": "commit"}, {"oid": "4b52f05043bb4bb15953598aa6e56c89c22c1868", "url": "https://github.com/phac-nml/irida/commit/4b52f05043bb4bb15953598aa6e56c89c22c1868", "message": "Updated tests. Added fastqc images which are used by tests. Updated db xml file", "committedDate": "2020-10-29T21:59:15Z", "type": "commit"}, {"oid": "1cd2bb91f0ce4d5cd0757f35c21a315e7857255a", "url": "https://github.com/phac-nml/irida/commit/1cd2bb91f0ce4d5cd0757f35c21a315e7857255a", "message": "Merged dev and fixed merge conflicts. Removed unused imports", "committedDate": "2020-10-30T13:30:41Z", "type": "commit"}, {"oid": "29661f39cf76d74a123e58c121692176ca981352", "url": "https://github.com/phac-nml/irida/commit/29661f39cf76d74a123e58c121692176ca981352", "message": "Instead of erroring out on a page if an image is not found we return a byte array of 0 length", "committedDate": "2020-10-30T15:34:27Z", "type": "commit"}, {"oid": "bd98a62546c41717b65cb512346c2168aaf55caa", "url": "https://github.com/phac-nml/irida/commit/bd98a62546c41717b65cb512346c2168aaf55caa", "message": "Reverted to throwing IOException if file can't be read", "committedDate": "2020-10-30T18:56:05Z", "type": "commit"}, {"oid": "5409253747a2803d9b82d025e5cc3d6463c51b38", "url": "https://github.com/phac-nml/irida/commit/5409253747a2803d9b82d025e5cc3d6463c51b38", "message": ":recycle: Refactored the way the navigation system gets its information\n\nMade better use of reach router Location and useParams to get details.", "committedDate": "2020-10-30T19:20:10Z", "type": "commit"}, {"oid": "dc73c84f466bc22f03937f4764485ea02ae5acf3", "url": "https://github.com/phac-nml/irida/commit/dc73c84f466bc22f03937f4764485ea02ae5acf3", "message": "That should not have been comiited", "committedDate": "2020-10-30T19:23:16Z", "type": "commit"}, {"oid": "f61b1fb6afaddb5375092df0d5c72e2bc3856932", "url": "https://github.com/phac-nml/irida/commit/f61b1fb6afaddb5375092df0d5c72e2bc3856932", "message": "Merge branch 'refactor-fastqc-page' into refactor-fastqc-page-NAVIGATION\n\n# Conflicts:\n#\tsrc/main/webapp/resources/js/pages/sequence-files/components/FastQCCharts.jsx", "committedDate": "2020-10-30T19:25:08Z", "type": "commit"}, {"oid": "74e15c6cdcb164727067122fe09ac609ba4800f8", "url": "https://github.com/phac-nml/irida/commit/74e15c6cdcb164727067122fe09ac609ba4800f8", "message": "Fixed merge conflict", "committedDate": "2020-10-30T19:26:06Z", "type": "commit"}, {"oid": "26b3d5154592fdf9046c63698c4f24bd17f66a1c", "url": "https://github.com/phac-nml/irida/commit/26b3d5154592fdf9046c63698c4f24bd17f66a1c", "message": "Merge pull request #7 from phac-nml/refactor-fastqc-page-NAVIGATION\n\nRefactor fastqc page navigation", "committedDate": "2020-10-30T19:48:43Z", "type": "commit"}, {"oid": "90442eb01dc259d9118a5554483e3e8cc596c138", "url": "https://github.com/phac-nml/irida/commit/90442eb01dc259d9118a5554483e3e8cc596c138", "message": "Fixed issue with old 'summary' link", "committedDate": "2020-10-31T01:41:50Z", "type": "commit"}, {"oid": "77c80997391eb93f68383dc8125d99394691933b", "url": "https://github.com/phac-nml/irida/commit/77c80997391eb93f68383dc8125d99394691933b", "message": ":construction: Initial context work", "committedDate": "2020-10-31T02:49:38Z", "type": "commit"}, {"oid": "9cc6b1dddc584be334b30aff67502a497c5ff5cf", "url": "https://github.com/phac-nml/irida/commit/9cc6b1dddc584be334b30aff67502a497c5ff5cf", "message": "Images don't need to be in the context", "committedDate": "2020-10-31T03:17:30Z", "type": "commit"}, {"oid": "45da767fdd65002973f401bbf2ff3e57a9564e45", "url": "https://github.com/phac-nml/irida/commit/45da767fdd65002973f401bbf2ff3e57a9564e45", "message": "Merge pull request #8 from phac-nml/refactor-fastqc-context\n\n:construction: Initial context work", "committedDate": "2020-10-31T16:55:34Z", "type": "commit"}, {"oid": "83628c4c636c9c4a49099e94d1317e0658983acf", "url": "https://github.com/phac-nml/irida/commit/83628c4c636c9c4a49099e94d1317e0658983acf", "message": "Added redirect from summary pages. Images not found/readable will not throw an exception and cause page to error but will instead return an empty byte array.", "committedDate": "2020-10-31T19:11:57Z", "type": "commit"}, {"oid": "4bf3f04cbf9174990aa7295b204fb32407ea5552", "url": "https://github.com/phac-nml/irida/commit/4bf3f04cbf9174990aa7295b204fb32407ea5552", "message": "Added logger error messages for when reading an image file throws an exception. Updated fastqc page navigation to work in all cases", "committedDate": "2020-10-31T19:55:16Z", "type": "commit"}, {"oid": "85d60a0d09e1e228eee49a6f7d9ea5ac73ee4266", "url": "https://github.com/phac-nml/irida/commit/85d60a0d09e1e228eee49a6f7d9ea5ac73ee4266", "message": "Removed unused import and added missing @param to javadoc", "committedDate": "2020-10-31T21:02:59Z", "type": "commit"}, {"oid": "9c7fa82231b64cb0e1c30639ccd54cf07739b842", "url": "https://github.com/phac-nml/irida/commit/9c7fa82231b64cb0e1c30639ccd54cf07739b842", "message": "Refactored redirect", "committedDate": "2020-11-01T16:55:36Z", "type": "commit"}, {"oid": "953ffeb24c1ac1fa655c273ddc6676d57bf944a7", "url": "https://github.com/phac-nml/irida/commit/953ffeb24c1ac1fa655c273ddc6676d57bf944a7", "message": "Fixed uri for sequencingruns", "committedDate": "2020-11-01T17:03:34Z", "type": "commit"}, {"oid": "0c555c85911915a623406911392d51757e549023", "url": "https://github.com/phac-nml/irida/commit/0c555c85911915a623406911392d51757e549023", "message": "Merge branch 'development' into refactor-fastqc-page", "committedDate": "2020-11-02T12:54:34Z", "type": "commit"}]}