{"pr_number": 19685, "pr_title": "#19652 Ability to query related content in GraphQL", "pr_createdAt": "2020-12-10T00:20:52Z", "pr_url": "https://github.com/dotCMS/core/pull/19685", "timeline": [{"oid": "842562a04f76f35fbefc4f0e2f73aacf27a65be2", "url": "https://github.com/dotCMS/core/commit/842562a04f76f35fbefc4f0e2f73aacf27a65be2", "message": "#19652 first draft", "committedDate": "2020-12-10T00:20:14Z", "type": "commit"}, {"oid": "9396c994dc4639ae2da4dd8649c6aa006b5a404e", "url": "https://github.com/dotCMS/core/commit/9396c994dc4639ae2da4dd8649c6aa006b5a404e", "message": "Merge branch 'master' of github.com:dotCMS/core into 19652-allow-filtering-rels-graphql", "committedDate": "2020-12-11T00:39:47Z", "type": "commit"}, {"oid": "967069e292cd666b9d0f2592ea2e0dc83cdab596", "url": "https://github.com/dotCMS/core/commit/967069e292cd666b9d0f2592ea2e0dc83cdab596", "message": "#19652 Add new params to graphql field", "committedDate": "2020-12-11T01:01:56Z", "type": "commit"}, {"oid": "f9ab90296a9d468d3f1eb638c44a6f74e9639426", "url": "https://github.com/dotCMS/core/commit/f9ab90296a9d468d3f1eb638c44a6f74e9639426", "message": "#19652 postman test", "committedDate": "2020-12-11T23:35:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQzMzQ0Ng==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r541433446", "bodyText": "You can use this apache commons 3 function and code will be cleaner\nfinal String query = StringUtils.defaultString(environment.getArgument(\"query\"), \"\");", "author": "victoralfaro-dotcms", "createdAt": "2020-12-11T23:59:13Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java", "diffHunk": "@@ -55,8 +56,29 @@ public Object get(final DataFetchingEnvironment environment) throws Exception {\n \n             Object objectToReturn = records.doesAllowOnlyOne() ? null : Collections.emptyList();\n \n-            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,\n-                    true, isChildField, contentlet.getLanguageId(), contentlet.isLive());\n+//            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,\n+//                    true, isChildField, contentlet.getLanguageId(), contentlet.isLive());\n+\n+            final String query = environment.getArgument(\"query\")!=null", "originalCommit": "f9ab90296a9d468d3f1eb638c44a6f74e9639426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQzOTUwMQ==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r541439501", "bodyText": "Same for the rest of String variables.", "author": "victoralfaro-dotcms", "createdAt": "2020-12-12T00:06:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQzMzQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU4NDE2MQ==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542584161", "bodyText": "I like it! will do", "author": "dsilvam", "createdAt": "2020-12-14T17:50:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQzMzQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNDU5Nw==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542924597", "bodyText": "done", "author": "dsilvam", "createdAt": "2020-12-14T23:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQzMzQ0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "e15124dcc24e77e3452b8e79abc8687f1f007715", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java b/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\nindex 261e78fb6e..1ca9a29d79 100644\n--- a/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\n+++ b/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\n\n@@ -56,11 +57,7 @@ public class RelationshipFieldDataFetcher implements DataFetcher<Object> {\n \n             Object objectToReturn = records.doesAllowOnlyOne() ? null : Collections.emptyList();\n \n-//            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,\n-//                    true, isChildField, contentlet.getLanguageId(), contentlet.isLive());\n-\n-            final String query = environment.getArgument(\"query\")!=null\n-                    ? environment.getArgument(\"query\") : \"\";\n+            final String query = StringUtils.defaultString(environment.getArgument(\"query\"), \"\");\n \n             final int limit = environment.getArgument(\"limit\")!=null\n                     ? environment.getArgument(\"limit\") : -1;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQ0MDYwMA==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r541440600", "bodyText": "Use a StringBuilder instead.", "author": "victoralfaro-dotcms", "createdAt": "2020-12-12T00:07:46Z", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/content/util/ContentUtils.java", "diffHunk": "@@ -674,5 +676,34 @@ public static long count(String query, User user, String tmDate) {\n         return getPullResults(relationship, contentletIdentifier, condition, limit, offset, sort,\n                 user, tmDate, pullParents, -1, null);\n     }\n+\n+\tpublic static String addDefaultsToQuery(String query, final boolean editOrPreviewMode, final\n+\t\t\tHttpServletRequest request){\n+\t\tString q = \"\";\n+\n+\t\tif(query != null)", "originalCommit": "f9ab90296a9d468d3f1eb638c44a6f74e9639426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQyOTA0Mw==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542429043", "bodyText": "agree", "author": "erickgonzalez", "createdAt": "2020-12-14T14:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQ0MDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNDAxNA==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542924014", "bodyText": "Java optimizes this under the covers. It's not an advantage anymore.", "author": "dsilvam", "createdAt": "2020-12-14T23:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTQ0MDYwMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQyODAzNA==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542428034", "bodyText": "Remove unused code", "author": "erickgonzalez", "createdAt": "2020-12-14T14:30:22Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java", "diffHunk": "@@ -55,8 +56,29 @@ public Object get(final DataFetchingEnvironment environment) throws Exception {\n \n             Object objectToReturn = records.doesAllowOnlyOne() ? null : Collections.emptyList();\n \n-            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,\n-                    true, isChildField, contentlet.getLanguageId(), contentlet.isLive());\n+//            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,", "originalCommit": "f9ab90296a9d468d3f1eb638c44a6f74e9639426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNDA4OQ==", "url": "https://github.com/dotCMS/core/pull/19685#discussion_r542924089", "bodyText": "Done", "author": "dsilvam", "createdAt": "2020-12-14T23:34:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQyODAzNA=="}], "type": "inlineReview", "revised_code": {"commit": "e15124dcc24e77e3452b8e79abc8687f1f007715", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java b/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\nindex 261e78fb6e..1ca9a29d79 100644\n--- a/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\n+++ b/dotCMS/src/main/java/com/dotcms/graphql/datafetcher/RelationshipFieldDataFetcher.java\n\n@@ -56,11 +57,7 @@ public class RelationshipFieldDataFetcher implements DataFetcher<Object> {\n \n             Object objectToReturn = records.doesAllowOnlyOne() ? null : Collections.emptyList();\n \n-//            List<Contentlet> relatedContent = contentlet.getRelated(fieldVar, user,\n-//                    true, isChildField, contentlet.getLanguageId(), contentlet.isLive());\n-\n-            final String query = environment.getArgument(\"query\")!=null\n-                    ? environment.getArgument(\"query\") : \"\";\n+            final String query = StringUtils.defaultString(environment.getArgument(\"query\"), \"\");\n \n             final int limit = environment.getArgument(\"limit\")!=null\n                     ? environment.getArgument(\"limit\") : -1;\n"}}, {"oid": "e15124dcc24e77e3452b8e79abc8687f1f007715", "url": "https://github.com/dotCMS/core/commit/e15124dcc24e77e3452b8e79abc8687f1f007715", "message": "#19652 code review", "committedDate": "2020-12-14T17:56:37Z", "type": "commit"}]}