{"pr_number": 18493, "pr_title": "Additional fix for issue 14385", "pr_createdAt": "2020-05-13T22:07:15Z", "pr_url": "https://github.com/dotCMS/core/pull/18493", "timeline": [{"oid": "93fa172c3d2c87fa613db9ec79ae47ef199a1bdd", "url": "https://github.com/dotCMS/core/commit/93fa172c3d2c87fa613db9ec79ae47ef199a1bdd", "message": "#14385 Initializing Hikari datasource in a cleaner way", "committedDate": "2020-05-13T22:02:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc2MDk5MQ==", "url": "https://github.com/dotCMS/core/pull/18493#discussion_r424760991", "bodyText": "I guess you can just simply call:\ndbType = System.getProperty(\"databaseType\", System.getenv(\"databaseType\"))", "author": "victoralfaro-dotcms", "createdAt": "2020-05-13T22:12:45Z", "path": "dotCMS/src/integration-test/java/com/dotcms/util/TestDataSourceProvider.java", "diffHunk": "@@ -63,18 +26,26 @@ public DataSource apply() {\n      * Load properties file with DB connection details\n      * @throws NamingException\n      */\n-    private void loadProperties()  {\n-        ClassLoader loader = Thread.currentThread().getContextClassLoader();\n-        prop = new Properties();\n+    private Properties getProperties()  {\n+        final ClassLoader loader = Thread.currentThread().getContextClassLoader();\n+        final Properties properties = new Properties();\n \n-        try (InputStream resourceStream = loader.getResourceAsStream(\"db-config.properties\")) {\n-            prop.load(resourceStream);\n-        } catch (Exception e) {\n-            Logger.info(this.getClass(), \"Unable to get properties from file db-config.properties - let's try the environment\");\n+        String dbType = \"postgres\";\n+\n+        if (System.getProperty(\"databaseType\")!=null){", "originalCommit": "93fa172c3d2c87fa613db9ec79ae47ef199a1bdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc3NTkzMA==", "url": "https://github.com/dotCMS/core/pull/18493#discussion_r424775930", "bodyText": "Done", "author": "nollymar", "createdAt": "2020-05-13T22:52:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDc2MDk5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "642ef3a2eb8a6c827007505e1db5727578eff7a2", "chunk": "diff --git a/dotCMS/src/integration-test/java/com/dotcms/util/TestDataSourceProvider.java b/dotCMS/src/integration-test/java/com/dotcms/util/TestDataSourceProvider.java\nindex b6f4561d8f..2d002eca02 100644\n--- a/dotCMS/src/integration-test/java/com/dotcms/util/TestDataSourceProvider.java\n+++ b/dotCMS/src/integration-test/java/com/dotcms/util/TestDataSourceProvider.java\n\n@@ -30,13 +30,9 @@ public class TestDataSourceProvider implements DotDataSourceStrategy {\n         final ClassLoader loader = Thread.currentThread().getContextClassLoader();\n         final Properties properties = new Properties();\n \n-        String dbType = \"postgres\";\n-\n-        if (System.getProperty(\"databaseType\")!=null){\n-            dbType = System.getProperty(\"databaseType\");\n-        } else if(System.getenv(\"databaseType\")!=null){\n-            dbType = System.getenv(\"databaseType\");\n-        }\n+        final String dbType = System.getProperty(\"databaseType\",\n+                (System.getenv(\"databaseType\") != null ? System.getenv(\"databaseType\")\n+                        : \"postgres\"));\n \n         try (InputStream resourceStream = loader.getResourceAsStream(dbType + \"-db-config.properties\")) {\n             properties.load(resourceStream);\n"}}, {"oid": "642ef3a2eb8a6c827007505e1db5727578eff7a2", "url": "https://github.com/dotCMS/core/commit/642ef3a2eb8a6c827007505e1db5727578eff7a2", "message": "#14385 Applying code review suggestion: https://github.com/dotCMS/core/pull/18493#pullrequestreview-411336143", "committedDate": "2020-05-13T22:52:44Z", "type": "commit"}, {"oid": "f7e80527abbe5b568b6665d48c28bedc3ad30d84", "url": "https://github.com/dotCMS/core/commit/f7e80527abbe5b568b6665d48c28bedc3ad30d84", "message": "Merge branch 'release-5.3.0' of https://github.com/dotCMS/core into additional-fix-for-issue-14385", "committedDate": "2020-05-13T23:59:12Z", "type": "commit"}]}