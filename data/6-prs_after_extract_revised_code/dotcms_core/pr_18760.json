{"pr_number": 18760, "pr_title": "Issue 18563 create resource for bundle operations", "pr_createdAt": "2020-06-24T00:16:03Z", "pr_url": "https://github.com/dotCMS/core/pull/18760", "timeline": [{"oid": "4a9fc5d487eb618678e0761ceddc99340cff26a9", "url": "https://github.com/dotCMS/core/commit/4a9fc5d487eb618678e0761ceddc99340cff26a9", "message": "18563 Endpoint for upload bundles", "committedDate": "2020-06-24T00:13:09Z", "type": "commit"}, {"oid": "e35680713d77a9df6e354ae932ada320064b2a24", "url": "https://github.com/dotCMS/core/commit/e35680713d77a9df6e354ae932ada320064b2a24", "message": "18563 clean imports", "committedDate": "2020-06-24T00:15:42Z", "type": "commit"}, {"oid": "5e6e78731c93380edc9f3768933ea1b5fc95922c", "url": "https://github.com/dotCMS/core/commit/5e6e78731c93380edc9f3768933ea1b5fc95922c", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations", "committedDate": "2020-06-24T00:16:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyNzIxNw==", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r444927217", "bodyText": "postman test?", "author": "freddyucv", "createdAt": "2020-06-24T14:17:26Z", "path": "dotCMS/src/main/java/com/dotcms/rest/BundleResource.java", "diffHunk": "@@ -588,4 +620,71 @@ public Response deleteAllSuccess(@Context final HttpServletRequest request,\n                 \"Removing bundles in a separated process, the result of the operation will be notified\")).build();\n     } // deleteAllSuccess.\n \n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML, MediaType.TEXT_PLAIN})\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public final Response postMultipart(@Context final HttpServletRequest request, @Context final HttpServletResponse response,", "originalCommit": "5e6e78731c93380edc9f3768933ea1b5fc95922c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODAzMDIzNw==", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r448030237", "bodyText": "Done", "author": "dsilvam", "createdAt": "2020-06-30T23:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyNzIxNw=="}], "type": "inlineReview", "revised_code": {"commit": "5df8f1a14d36cf01fd553b655b39b90bc9af869d", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/rest/BundleResource.java b/dotCMS/src/main/java/com/dotcms/rest/BundleResource.java\nindex adeac84f94..00bef36f8b 100644\n--- a/dotCMS/src/main/java/com/dotcms/rest/BundleResource.java\n+++ b/dotCMS/src/main/java/com/dotcms/rest/BundleResource.java\n\n@@ -625,7 +625,7 @@ public class BundleResource {\n     @NoCache\n     @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML, MediaType.TEXT_PLAIN})\n     @Consumes(MediaType.MULTIPART_FORM_DATA)\n-    public final Response postMultipart(@Context final HttpServletRequest request, @Context final HttpServletResponse response,\n+    public final Response uploadBundle(@Context final HttpServletRequest request, @Context final HttpServletResponse response,\n             FormDataMultiPart multipart,\n             @Context UriInfo uriInfo, @QueryParam(\"sync\") boolean sync) throws DotPublisherException {\n \n"}}, {"oid": "5df8f1a14d36cf01fd553b655b39b90bc9af869d", "url": "https://github.com/dotCMS/core/commit/5df8f1a14d36cf01fd553b655b39b90bc9af869d", "message": "#18563 fixes for page resource tests", "committedDate": "2020-06-25T00:06:52Z", "type": "commit"}, {"oid": "82f976aa9d132c6f372441f08bfcda3fd8626dca", "url": "https://github.com/dotCMS/core/commit/82f976aa9d132c6f372441f08bfcda3fd8626dca", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations", "committedDate": "2020-06-25T16:48:44Z", "type": "commit"}, {"oid": "847b87ecd70876547d8dcc8d37f495d2206ae492", "url": "https://github.com/dotCMS/core/commit/847b87ecd70876547d8dcc8d37f495d2206ae492", "message": "#18563 rename page resource postman tests, include new bundle with context", "committedDate": "2020-06-26T00:10:21Z", "type": "commit"}, {"oid": "453cf5445a491b467617f39ab0abf276c714a38b", "url": "https://github.com/dotCMS/core/commit/453cf5445a491b467617f39ab0abf276c714a38b", "message": "#18563 more fixing to Page-Resource postman tests", "committedDate": "2020-06-27T00:08:20Z", "type": "commit"}, {"oid": "0591dccddd1fbd47c55832cf44cd579150af5806", "url": "https://github.com/dotCMS/core/commit/0591dccddd1fbd47c55832cf44cd579150af5806", "message": "#18563 More fixes for Page API Postman tests", "committedDate": "2020-06-29T23:20:22Z", "type": "commit"}, {"oid": "b300ae9a478ff71de90c4afbfdb50fccba802a5b", "url": "https://github.com/dotCMS/core/commit/b300ae9a478ff71de90c4afbfdb50fccba802a5b", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations", "committedDate": "2020-06-30T15:44:56Z", "type": "commit"}, {"oid": "8fcae847b760ca8f47ac7da41be978c6449cbf40", "url": "https://github.com/dotCMS/core/commit/8fcae847b760ca8f47ac7da41be978c6449cbf40", "message": "* More tests and fixes for PageResource\n* Postman tests for BundleResource uploadBundle\n* Postman tests for GraphQL Page API - page properties\n* Other fixes", "committedDate": "2020-06-30T23:13:36Z", "type": "commit"}, {"oid": "a9b222b9df641e494d4786285593e37bb14ff12b", "url": "https://github.com/dotCMS/core/commit/a9b222b9df641e494d4786285593e37bb14ff12b", "message": "#18563 missed Postman tests in previous commit", "committedDate": "2020-06-30T23:18:29Z", "type": "commit"}, {"oid": "6a3e187da237d71f5cd1a627f6e13f6510945c7e", "url": "https://github.com/dotCMS/core/commit/6a3e187da237d71f5cd1a627f6e13f6510945c7e", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations", "committedDate": "2020-07-01T04:40:42Z", "type": "commit"}, {"oid": "66d5df2f12ee1d14ceae2fc61a64c4645e785088", "url": "https://github.com/dotCMS/core/commit/66d5df2f12ee1d14ceae2fc61a64c4645e785088", "message": "#18563 More mods for Page Resource Postman tests", "committedDate": "2020-07-01T05:06:25Z", "type": "commit"}, {"oid": "6d4fddeb85ca19ebe0f9bb6f78cd82b3bd4181f7", "url": "https://github.com/dotCMS/core/commit/6d4fddeb85ca19ebe0f9bb6f78cd82b3bd4181f7", "message": "#18563 codacy feedback", "committedDate": "2020-07-01T15:35:00Z", "type": "commit"}, {"oid": "42ef4b6e2f50b2e1ab1bdd438742b402a8d9be26", "url": "https://github.com/dotCMS/core/commit/42ef4b6e2f50b2e1ab1bdd438742b402a8d9be26", "message": "#18563 force tests to run", "committedDate": "2020-07-01T16:18:31Z", "type": "commit"}, {"oid": "e78b09dc3921988c593089808d69bea99d1b4c13", "url": "https://github.com/dotCMS/core/commit/e78b09dc3921988c593089808d69bea99d1b4c13", "message": "#18563 more fixes for postman", "committedDate": "2020-07-01T17:04:58Z", "type": "commit"}, {"oid": "e61b31745e3fc16c3bb47d803951c7a5620cbbe4", "url": "https://github.com/dotCMS/core/commit/e61b31745e3fc16c3bb47d803951c7a5620cbbe4", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations", "committedDate": "2020-07-01T17:50:05Z", "type": "commit"}, {"oid": "945544aa3b7c374050c1379dd76d9ef7f9231764", "url": "https://github.com/dotCMS/core/commit/945544aa3b7c374050c1379dd76d9ef7f9231764", "message": "$18563 Fix htmlpage tests and FieldBuilderTest. testValuesCheck", "committedDate": "2020-07-02T16:02:47Z", "type": "commit"}, {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319", "url": "https://github.com/dotCMS/core/commit/9fcf743d7a5e4ff07daef9682650befa28d41319", "message": "#18563 remove space at the end of url", "committedDate": "2020-07-02T18:01:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODMxNg==", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r449188316", "bodyText": "Codacy found an issue: This call to String.startsWith can be rewritten using String.charAt(0)", "author": "dev-dotcms", "createdAt": "2020-07-02T18:08:22Z", "path": "dotCMS/src/main/java/com/dotcms/rest/BundleResource.java", "diffHunk": "@@ -588,4 +621,77 @@ public Response deleteAllSuccess(@Context final HttpServletRequest request,\n                 \"Removing bundles in a separated process, the result of the operation will be notified\")).build();\n     } // deleteAllSuccess.\n \n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML, MediaType.TEXT_PLAIN})\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public final Response uploadBundle(@Context final HttpServletRequest request, @Context final HttpServletResponse response,\n+            FormDataMultiPart multipart,\n+            @Context UriInfo uriInfo, @QueryParam(\"sync\") boolean sync) throws DotPublisherException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredBackendUser(true)\n+                .requiredFrontendUser(false)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(true)\n+                .init();\n+\n+        for (final BodyPart part : multipart.getBodyParts()) {\n+            try(InputStream inputStream = part.getEntity() instanceof InputStream ? (InputStream) part\n+                    .getEntity()\n+                    : Try.of(() -> part.getEntityAs(InputStream.class)).getOrNull()) {\n+\n+                if (inputStream == null) {\n+                    continue;\n+                }\n+                final ContentDisposition meta = part.getContentDisposition();\n+                if (meta == null) {\n+                    continue;\n+                }\n+                final String fileName = meta.getFileName();\n+                if (UtilMethods.isNotSet(fileName) || fileName.startsWith(\".\") || fileName", "originalCommit": "9fcf743d7a5e4ff07daef9682650befa28d41319", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODMyNQ==", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r449188325", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "author": "dev-dotcms", "createdAt": "2020-07-02T18:08:23Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/page/PageResource.java", "diffHunk": "@@ -406,12 +407,12 @@ public final Response addContent(@Context final HttpServletRequest request,\n         Logger.debug(this, ()->String.format(\"Saving page's content: %s\",\n                 pageContainerForm != null ? pageContainerForm.getRequestJson() : null));\n \n+        final InitDataObject initData = webResource.init(request, response,true);", "originalCommit": "9fcf743d7a5e4ff07daef9682650befa28d41319", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}