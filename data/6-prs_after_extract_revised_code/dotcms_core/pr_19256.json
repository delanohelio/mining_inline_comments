{"pr_number": 19256, "pr_title": "#19255 cache region for graphql schema", "pr_createdAt": "2020-09-10T23:10:28Z", "pr_url": "https://github.com/dotCMS/core/pull/19256", "timeline": [{"oid": "a373b12a137033508a9a526a8c77208534ec8fff", "url": "https://github.com/dotCMS/core/commit/a373b12a137033508a9a526a8c77208534ec8fff", "message": "#19255 cache region for graphql schema", "committedDate": "2020-09-10T23:09:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4ODU3Ng==", "url": "https://github.com/dotCMS/core/pull/19256#discussion_r486688576", "bodyText": "Does cache.get() throw a DotCacheException?", "author": "victoralfaro-dotcms", "createdAt": "2020-09-10T23:30:14Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.dotcms.graphql.business;\n+\n+import com.dotmarketing.business.Cachable;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheAdministrator;\n+import com.dotmarketing.business.DotCacheException;\n+import graphql.schema.GraphQLSchema;\n+import java.util.Arrays;\n+import java.util.Optional;\n+\n+public class GraphQLSchemaCache implements Cachable {\n+    private final static String GRAPHQL_SCHEMA_GROUP = GraphQLSchemaCache.class.getSimpleName().toLowerCase();\n+\n+    private final static String[] GROUPS = {GRAPHQL_SCHEMA_GROUP};\n+\n+    private final static String SCHEMA_KEY = \"graphqlschema\";\n+\n+    final private DotCacheAdministrator cache = CacheLocator.getCacheAdministrator();\n+\n+    @Override\n+    public String getPrimaryGroup() {\n+        return GRAPHQL_SCHEMA_GROUP;\n+    }\n+\n+    public Optional<GraphQLSchema> getSchema() {\n+        try {\n+            return Optional.ofNullable((GraphQLSchema) cache.get(SCHEMA_KEY, GRAPHQL_SCHEMA_GROUP));", "originalCommit": "a373b12a137033508a9a526a8c77208534ec8fff", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "36d0578611648d37396f313bb4e443b4e25f314c", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java b/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\nindex 418cec7ed6..8f0d0dbccb 100644\n--- a/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\n+++ b/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\n\n@@ -8,6 +8,10 @@ import graphql.schema.GraphQLSchema;\n import java.util.Arrays;\n import java.util.Optional;\n \n+/**\n+ * Cache implementation used to store the generated {@link GraphQLSchema}\n+ */\n+\n public class GraphQLSchemaCache implements Cachable {\n     private final static String GRAPHQL_SCHEMA_GROUP = GraphQLSchemaCache.class.getSimpleName().toLowerCase();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2MTE0OQ==", "url": "https://github.com/dotCMS/core/pull/19256#discussion_r487061149", "bodyText": "doc", "author": "freddyucv", "createdAt": "2020-09-11T13:54:39Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.dotcms.graphql.business;\n+\n+import com.dotmarketing.business.Cachable;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheAdministrator;\n+import com.dotmarketing.business.DotCacheException;\n+import graphql.schema.GraphQLSchema;\n+import java.util.Arrays;\n+import java.util.Optional;\n+\n+public class GraphQLSchemaCache implements Cachable {", "originalCommit": "a373b12a137033508a9a526a8c77208534ec8fff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3ODU3Mg==", "url": "https://github.com/dotCMS/core/pull/19256#discussion_r487178572", "bodyText": "done", "author": "dsilvam", "createdAt": "2020-09-11T17:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2MTE0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "36d0578611648d37396f313bb4e443b4e25f314c", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java b/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\nindex 418cec7ed6..8f0d0dbccb 100644\n--- a/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\n+++ b/dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java\n\n@@ -8,6 +8,10 @@ import graphql.schema.GraphQLSchema;\n import java.util.Arrays;\n import java.util.Optional;\n \n+/**\n+ * Cache implementation used to store the generated {@link GraphQLSchema}\n+ */\n+\n public class GraphQLSchemaCache implements Cachable {\n     private final static String GRAPHQL_SCHEMA_GROUP = GraphQLSchemaCache.class.getSimpleName().toLowerCase();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzA2MzIyMA==", "url": "https://github.com/dotCMS/core/pull/19256#discussion_r487063220", "bodyText": "I think we are missing a test here", "author": "freddyucv", "createdAt": "2020-09-11T13:57:45Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/DotGraphQLSchemaProvider.java", "diffHunk": "@@ -23,6 +23,7 @@ public GraphQLSchema getSchema(HandshakeRequest request) {\n     @Override\n     public GraphQLSchema getSchema() {\n         try {\n+            APILocator.getGraphqlAPI().printSchema();", "originalCommit": "a373b12a137033508a9a526a8c77208534ec8fff", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "36d0578611648d37396f313bb4e443b4e25f314c", "url": "https://github.com/dotCMS/core/commit/36d0578611648d37396f313bb4e443b4e25f314c", "message": "#19255 rename prop. javadoc", "committedDate": "2020-09-11T17:10:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE4MTkxMQ==", "url": "https://github.com/dotCMS/core/pull/19256#discussion_r487181911", "bodyText": "Codacy found an issue: Returning 'GROUPS' may expose an internal array.", "author": "dev-dotcms", "createdAt": "2020-09-11T17:17:36Z", "path": "dotCMS/src/main/java/com/dotcms/graphql/business/GraphQLSchemaCache.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.dotcms.graphql.business;\n+\n+import com.dotmarketing.business.Cachable;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheAdministrator;\n+import com.dotmarketing.business.DotCacheException;\n+import graphql.schema.GraphQLSchema;\n+import java.util.Arrays;\n+import java.util.Optional;\n+\n+/**\n+ * Cache implementation used to store the generated {@link GraphQLSchema}\n+ */\n+\n+public class GraphQLSchemaCache implements Cachable {\n+    private final static String GRAPHQL_SCHEMA_GROUP = GraphQLSchemaCache.class.getSimpleName().toLowerCase();\n+\n+    private final static String[] GROUPS = {GRAPHQL_SCHEMA_GROUP};\n+\n+    private final static String SCHEMA_KEY = \"graphqlschema\";\n+\n+    final private DotCacheAdministrator cache = CacheLocator.getCacheAdministrator();\n+\n+    @Override\n+    public String getPrimaryGroup() {\n+        return GRAPHQL_SCHEMA_GROUP;\n+    }\n+\n+    public Optional<GraphQLSchema> getSchema() {\n+        try {\n+            return Optional.ofNullable((GraphQLSchema) cache.get(SCHEMA_KEY, GRAPHQL_SCHEMA_GROUP));\n+        } catch (DotCacheException e) {\n+            return Optional.empty();\n+        }\n+    }\n+\n+    public void putSchema(final GraphQLSchema schema) {\n+        cache.put(SCHEMA_KEY, schema, GRAPHQL_SCHEMA_GROUP);\n+    }\n+\n+    public void removeSchema() {\n+        cache.remove(SCHEMA_KEY, GRAPHQL_SCHEMA_GROUP);\n+    }\n+\n+    @Override\n+    public String[] getGroups() {\n+        return GROUPS;", "originalCommit": "36d0578611648d37396f313bb4e443b4e25f314c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}