{"pr_number": 18307, "pr_title": "Fix method", "pr_createdAt": "2020-04-14T23:48:08Z", "pr_url": "https://github.com/dotCMS/core/pull/18307", "timeline": [{"oid": "2746197033d54e3172aea718fcadc5bed85d1672", "url": "https://github.com/dotCMS/core/commit/2746197033d54e3172aea718fcadc5bed85d1672", "message": "Fix method", "committedDate": "2020-04-14T23:47:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODU3MjgxOA==", "url": "https://github.com/dotCMS/core/pull/18307#discussion_r408572818", "bodyText": "I am wondering if this should be something like\n        return info == null || !key.mode.showLive || !UtilMethods.isSet(info.getLiveInode());\n\nAlso set final the parameters", "author": "jdotcms", "createdAt": "2020-04-15T04:24:38Z", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java", "diffHunk": "@@ -581,8 +581,8 @@ public InputStream writeObject(final VelocityResourceKey key)\n \n     }\n \n-    private boolean isLiveVersionAvailable(VelocityResourceKey key, ContentletVersionInfo info) {\n-        return info != null && key.mode.showLive && UtilMethods.isSet(info.getLiveInode());\n+    private boolean isLiveVersionNotAvailable(VelocityResourceKey key, ContentletVersionInfo info) {\n+        return info == null || key.mode.showLive && !UtilMethods.isSet(info.getLiveInode());", "originalCommit": "2746197033d54e3172aea718fcadc5bed85d1672", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "21cbf7c62efd13353840c16bfdc6170b68291d46", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\nindex cf77f26b09..0c5bacca50 100644\n--- a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n+++ b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n\n@@ -581,6 +582,11 @@ public class ContentletLoader implements DotLoader {\n \n     }\n \n+    private boolean shouldCheckForVersionInfoInDefaultLanguage(long language) {\n+        return language != defaultLang && APILocator.getLanguageAPI()\n+                .canDefaultContentToDefaultLanguage();\n+    }\n+\n     private boolean isLiveVersionNotAvailable(VelocityResourceKey key, ContentletVersionInfo info) {\n         return info == null || key.mode.showLive && !UtilMethods.isSet(info.getLiveInode());\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2ODk4NA==", "url": "https://github.com/dotCMS/core/pull/18307#discussion_r408868984", "bodyText": "maybe we should move this condition to a private method, this way the method name could give us more information about what it is doing here", "author": "freddyucv", "createdAt": "2020-04-15T14:05:56Z", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java", "diffHunk": "@@ -561,11 +561,11 @@ public InputStream writeObject(final VelocityResourceKey key)\n         long language = new Long(key.language);\n         ContentletVersionInfo info = APILocator.getVersionableAPI().getContentletVersionInfo(key.id1, language);\n \n-        if (!isLiveVersionAvailable(key, info) && language != defaultLang && APILocator.getLanguageAPI().canDefaultContentToDefaultLanguage()) {\n+        if (isLiveVersionNotAvailable(key, info) && language != defaultLang && APILocator.getLanguageAPI().canDefaultContentToDefaultLanguage()) {", "originalCommit": "2746197033d54e3172aea718fcadc5bed85d1672", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "21cbf7c62efd13353840c16bfdc6170b68291d46", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\nindex cf77f26b09..0c5bacca50 100644\n--- a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n+++ b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n\n@@ -561,7 +561,8 @@ public class ContentletLoader implements DotLoader {\n         long language = new Long(key.language);\n         ContentletVersionInfo info = APILocator.getVersionableAPI().getContentletVersionInfo(key.id1, language);\n \n-        if (isLiveVersionNotAvailable(key, info) && language != defaultLang && APILocator.getLanguageAPI().canDefaultContentToDefaultLanguage()) {\n+        if (isLiveVersionNotAvailable(key, info) && shouldCheckForVersionInfoInDefaultLanguage(\n+                language)) {\n             info = APILocator.getVersionableAPI().getContentletVersionInfo(key.id1, defaultLang);\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg3NDQwNw==", "url": "https://github.com/dotCMS/core/pull/18307#discussion_r408874407", "bodyText": "I think we need test to these changes.", "author": "freddyucv", "createdAt": "2020-04-15T14:13:23Z", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java", "diffHunk": "@@ -561,11 +561,11 @@ public InputStream writeObject(final VelocityResourceKey key)\n         long language = new Long(key.language);", "originalCommit": "2746197033d54e3172aea718fcadc5bed85d1672", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "21cbf7c62efd13353840c16bfdc6170b68291d46", "chunk": "diff --git a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\nindex cf77f26b09..0c5bacca50 100644\n--- a/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n+++ b/dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContentletLoader.java\n\n@@ -561,7 +561,8 @@ public class ContentletLoader implements DotLoader {\n         long language = new Long(key.language);\n         ContentletVersionInfo info = APILocator.getVersionableAPI().getContentletVersionInfo(key.id1, language);\n \n-        if (isLiveVersionNotAvailable(key, info) && language != defaultLang && APILocator.getLanguageAPI().canDefaultContentToDefaultLanguage()) {\n+        if (isLiveVersionNotAvailable(key, info) && shouldCheckForVersionInfoInDefaultLanguage(\n+                language)) {\n             info = APILocator.getVersionableAPI().getContentletVersionInfo(key.id1, defaultLang);\n         }\n \n"}}, {"oid": "21cbf7c62efd13353840c16bfdc6170b68291d46", "url": "https://github.com/dotCMS/core/commit/21cbf7c62efd13353840c16bfdc6170b68291d46", "message": "applying code-review suggestions", "committedDate": "2020-04-15T15:17:39Z", "type": "commit"}]}