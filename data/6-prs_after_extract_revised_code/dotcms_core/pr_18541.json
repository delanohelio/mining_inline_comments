{"pr_number": 18541, "pr_title": "Issue 18501 noisy felix", "pr_createdAt": "2020-05-22T16:44:50Z", "pr_url": "https://github.com/dotCMS/core/pull/18541", "timeline": [{"oid": "ee52207f57d7b4a69e7ec41019fd829b75d29396", "url": "https://github.com/dotCMS/core/commit/ee52207f57d7b4a69e7ec41019fd829b75d29396", "message": "#18501 sets felix to info and turns the osgiproxyservlet off by defualt", "committedDate": "2020-05-14T20:41:57Z", "type": "commit"}, {"oid": "b86c5ec76438fa0c9d0e85ad2f7f0d6af180fdc1", "url": "https://github.com/dotCMS/core/commit/b86c5ec76438fa0c9d0e85ad2f7f0d6af180fdc1", "message": "Merge remote-tracking branch 'origin/master' into issue-18501-noisy-felix", "committedDate": "2020-05-22T14:48:09Z", "type": "commit"}, {"oid": "af65dbeec3cc98b31b8f9cbb94c6fdec05d1d4d6", "url": "https://github.com/dotCMS/core/commit/af65dbeec3cc98b31b8f9cbb94c6fdec05d1d4d6", "message": "#18501 making felix init once", "committedDate": "2020-05-22T16:38:00Z", "type": "commit"}, {"oid": "a7b71ead3f3e6d1811d1a63073c7ee421ecbf550", "url": "https://github.com/dotCMS/core/commit/a7b71ead3f3e6d1811d1a63073c7ee421ecbf550", "message": "##18501 better defaults", "committedDate": "2020-05-22T16:43:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NTQ4MA==", "url": "https://github.com/dotCMS/core/pull/18541#discussion_r430455480", "bodyText": "this is not thread safe, is it suppose to be thread safe?", "author": "freddyucv", "createdAt": "2020-05-26T14:27:54Z", "path": "dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java", "diffHunk": "@@ -76,28 +76,28 @@\n \n     public static OSGIUtil getInstance() {\n         if (instance == null) {\n-            instance = new OSGIUtil();\n+            instance = new OSGIUtil(Config.CONTEXT);", "originalCommit": "a7b71ead3f3e6d1811d1a63073c7ee421ecbf550", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1ODkxOQ==", "url": "https://github.com/dotCMS/core/pull/18541#discussion_r430458919", "bodyText": "meaning, we need something like a sync block and a double null check here?", "author": "wezell", "createdAt": "2020-05-26T14:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NTQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY0NTU0OA==", "url": "https://github.com/dotCMS/core/pull/18541#discussion_r430645548", "bodyText": "sync block and a double null check are bad for performance\nI think the Bill Pugh Singleton is better\nhttps://www.harinathk.com/java/singleton-bill-pugh-solution-enum/", "author": "freddyucv", "createdAt": "2020-05-26T19:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NTQ4MA=="}], "type": "inlineReview", "revised_code": {"commit": "d8fd5e9c219cd4ff649008b1e9d4186800a0538b", "chunk": "diff --git a/dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java b/dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java\nindex 5feaba0e29..4d83f8cc93 100644\n--- a/dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java\n+++ b/dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java\n\n@@ -72,17 +71,17 @@ public class OSGIUtil {\n     private String FELIX_EXTRA_PACKAGES_FILE_GENERATED;\n     public String FELIX_EXTRA_PACKAGES_FILE;\n \n-    private static OSGIUtil instance;\n \n     public static OSGIUtil getInstance() {\n-        if (instance == null) {\n-            instance = new OSGIUtil(Config.CONTEXT);\n-        }\n-        return instance;\n+        return OSGIUtilHolder.instance;\n     }\n \n-    private OSGIUtil (ServletContext servletContext) {\n-        this.servletContext = servletContext;\n+    private static class OSGIUtilHolder{\n+        private static OSGIUtil instance = new OSGIUtil();\n+    }\n+    \n+    private OSGIUtil () {\n+        this.servletContext = Config.CONTEXT;\n     }\n \n     private Framework felixFramework;\n"}}, {"oid": "d8fd5e9c219cd4ff649008b1e9d4186800a0538b", "url": "https://github.com/dotCMS/core/commit/d8fd5e9c219cd4ff649008b1e9d4186800a0538b", "message": "#18501 taking Freddy's suggestion", "committedDate": "2020-05-27T13:35:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MTM0OA==", "url": "https://github.com/dotCMS/core/pull/18541#discussion_r431141348", "bodyText": "Issue found: Use block level rather than method level synchronization", "author": "dev-dotcms", "createdAt": "2020-05-27T13:43:39Z", "path": "dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java", "diffHunk": "@@ -141,12 +140,13 @@ private Properties defaultProperties() {\n      * @param context The servlet context\n      * @return Framework\n      */\n-    public Framework initializeFramework(ServletContext context) {\n+    public synchronized Framework initializeFramework(ServletContext context) {", "originalCommit": "d8fd5e9c219cd4ff649008b1e9d4186800a0538b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MTM3MA==", "url": "https://github.com/dotCMS/core/pull/18541#discussion_r431141370", "bodyText": "Issue found: Avoid unused imports such as 'com.dotcms.util.CollectionsUtils'", "author": "dev-dotcms", "createdAt": "2020-05-27T13:43:40Z", "path": "dotCMS/src/main/java/org/apache/felix/framework/OSGIUtil.java", "diffHunk": "@@ -40,6 +29,17 @@\n import org.osgi.framework.BundleContext;\n import org.osgi.framework.ServiceReference;\n import org.osgi.framework.launch.Framework;\n+import com.dotcms.repackage.org.apache.commons.io.IOUtils;\n+import com.dotcms.util.CollectionsUtils;", "originalCommit": "d8fd5e9c219cd4ff649008b1e9d4186800a0538b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}