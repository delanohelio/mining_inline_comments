{"pr_number": 18067, "pr_title": "#18064 fix to support temporal file id on the binary field to discove\u2026", "pr_createdAt": "2020-02-28T20:07:18Z", "pr_url": "https://github.com/dotCMS/core/pull/18067", "timeline": [{"oid": "5cf909f164b33792d7e6d76e3ac343e333688f8a", "url": "https://github.com/dotCMS/core/commit/5cf909f164b33792d7e6d76e3ac343e333688f8a", "message": "#18064 fix to support temporal file id on the binary field to discover the mime type", "committedDate": "2020-02-28T20:06:59Z", "type": "commit"}, {"oid": "46a0f9fb12e6a959c9054b92577716d0b7111446", "url": "https://github.com/dotCMS/core/commit/46a0f9fb12e6a959c9054b92577716d0b7111446", "message": "#18064 adding unit test", "committedDate": "2020-03-02T22:36:11Z", "type": "commit"}, {"oid": "2a94d3cb6f3cfcb98dbd9f3ea3e83f64cea60c7f", "url": "https://github.com/dotCMS/core/commit/2a94d3cb6f3cfcb98dbd9f3ea3e83f64cea60c7f", "message": "#18064 merge master done", "committedDate": "2020-03-02T22:37:39Z", "type": "commit"}, {"oid": "5e451e722ac8518dc31bfaac1aafabaddc2c5487", "url": "https://github.com/dotCMS/core/commit/5e451e722ac8518dc31bfaac1aafabaddc2c5487", "message": "#18064 unit test", "committedDate": "2020-03-02T23:07:06Z", "type": "commit"}, {"oid": "cdf43cca9be8c02d69b310311a875e97ff37d854", "url": "https://github.com/dotCMS/core/commit/cdf43cca9be8c02d69b310311a875e97ff37d854", "message": "#18064 setting the Site or Folder required in order to select the current host", "committedDate": "2020-03-03T18:11:38Z", "type": "commit"}, {"oid": "325cc7b8d44c8dd0e64adc06b177af4f1e561a34", "url": "https://github.com/dotCMS/core/commit/325cc7b8d44c8dd0e64adc06b177af4f1e561a34", "message": "#18064 merge master", "committedDate": "2020-03-31T16:53:00Z", "type": "commit"}, {"oid": "70ff8da919374ce00a2a87cf148c9c499b82dd1d", "url": "https://github.com/dotCMS/core/commit/70ff8da919374ce00a2a87cf148c9c499b82dd1d", "message": "#18064 adding postman", "committedDate": "2020-03-31T23:03:10Z", "type": "commit"}, {"oid": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "url": "https://github.com/dotCMS/core/commit/63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "message": "#18064 the site or folder must be not required", "committedDate": "2020-04-15T22:23:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUwMA==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171500", "bodyText": "Issue found: Avoid unused imports such as 'com.liferay.portal.model.User'", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:40Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUwNQ==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171505", "bodyText": "Issue found: Avoid instantiating FileInputStream, FileOutputStream, FileReader, or FileWriter", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:41Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);\n+        final FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES)\n+                .value(\"text/plain\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(allowFileTypes));\n+\n+        APILocator.getContentTypeAPI(APILocator.systemUser()).save(dotAssetContentType);\n+        APILocator.getContentTypeFieldAPI().save(binaryField, APILocator.systemUser());\n+        APILocator.getContentTypeFieldAPI().save(allowFileTypes, APILocator.systemUser());\n+\n+        final Optional<BaseTypeToContentTypeStrategy> baseTypeToContentTypeStrategy =\n+                BaseTypeToContentTypeStrategyResolver.getInstance().get(BaseContentType.DOTASSET);\n+\n+        Assert.assertTrue(baseTypeToContentTypeStrategy.isPresent());\n+        MockHeaderRequest request = new MockHeaderRequest(\n+                (\n+                        new MockSessionRequest(new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request())\n+                ).request()\n+        );\n+\n+        request.setHeader(\"Authorization\", \"Basic \" + new String(Base64.encode(\"admin@dotcms.com:admin\".getBytes())));\n+        request.setHeader(\"User-Agent\", \"Fake-Agent\");\n+        request.setHeader(\"Host\", \"localhost\");\n+        request.setHeader(\"Origin\", \"localhost\");\n+        request.setAttribute(WebKeys.USER, APILocator.systemUser());\n+\n+        final File file = FileUtil.createTemporalFile(\"test\", \"txt\");\n+        final String content = \"This is a test temporal file\";\n+        try (final FileWriter fileWriter = new FileWriter(file)) {", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUxMg==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171512", "bodyText": "Issue found: Avoid unused imports such as 'com.liferay.portal.util.PortalUtil'", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:42Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUxNQ==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171515", "bodyText": "Issue found: Local variable 'request' could be declared final", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:43Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);\n+        final FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES)\n+                .value(\"text/plain\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(allowFileTypes));\n+\n+        APILocator.getContentTypeAPI(APILocator.systemUser()).save(dotAssetContentType);\n+        APILocator.getContentTypeFieldAPI().save(binaryField, APILocator.systemUser());\n+        APILocator.getContentTypeFieldAPI().save(allowFileTypes, APILocator.systemUser());\n+\n+        final Optional<BaseTypeToContentTypeStrategy> baseTypeToContentTypeStrategy =\n+                BaseTypeToContentTypeStrategyResolver.getInstance().get(BaseContentType.DOTASSET);\n+\n+        Assert.assertTrue(baseTypeToContentTypeStrategy.isPresent());\n+        MockHeaderRequest request = new MockHeaderRequest(", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUyNg==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171526", "bodyText": "Issue found: Local variable 'binaryField' could be declared final", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:44Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUzMA==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171530", "bodyText": "Issue found: Unnecessary modifier 'final' on resource specification 'fileWriter': resource specifications are implicitly final", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:45Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);\n+        final FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES)\n+                .value(\"text/plain\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(allowFileTypes));\n+\n+        APILocator.getContentTypeAPI(APILocator.systemUser()).save(dotAssetContentType);\n+        APILocator.getContentTypeFieldAPI().save(binaryField, APILocator.systemUser());\n+        APILocator.getContentTypeFieldAPI().save(allowFileTypes, APILocator.systemUser());\n+\n+        final Optional<BaseTypeToContentTypeStrategy> baseTypeToContentTypeStrategy =\n+                BaseTypeToContentTypeStrategyResolver.getInstance().get(BaseContentType.DOTASSET);\n+\n+        Assert.assertTrue(baseTypeToContentTypeStrategy.isPresent());\n+        MockHeaderRequest request = new MockHeaderRequest(\n+                (\n+                        new MockSessionRequest(new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request())\n+                ).request()\n+        );\n+\n+        request.setHeader(\"Authorization\", \"Basic \" + new String(Base64.encode(\"admin@dotcms.com:admin\".getBytes())));\n+        request.setHeader(\"User-Agent\", \"Fake-Agent\");\n+        request.setHeader(\"Host\", \"localhost\");\n+        request.setHeader(\"Origin\", \"localhost\");\n+        request.setAttribute(WebKeys.USER, APILocator.systemUser());\n+\n+        final File file = FileUtil.createTemporalFile(\"test\", \"txt\");\n+        final String content = \"This is a test temporal file\";\n+        try (final FileWriter fileWriter = new FileWriter(file)) {", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTUzMw==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171533", "bodyText": "Issue found: Useless parentheses.", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:45Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);\n+        final FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES)\n+                .value(\"text/plain\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(allowFileTypes));\n+\n+        APILocator.getContentTypeAPI(APILocator.systemUser()).save(dotAssetContentType);\n+        APILocator.getContentTypeFieldAPI().save(binaryField, APILocator.systemUser());\n+        APILocator.getContentTypeFieldAPI().save(allowFileTypes, APILocator.systemUser());\n+\n+        final Optional<BaseTypeToContentTypeStrategy> baseTypeToContentTypeStrategy =\n+                BaseTypeToContentTypeStrategyResolver.getInstance().get(BaseContentType.DOTASSET);\n+\n+        Assert.assertTrue(baseTypeToContentTypeStrategy.isPresent());\n+        MockHeaderRequest request = new MockHeaderRequest(\n+                (\n+                        new MockSessionRequest(new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request())", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTU0MA==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171540", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:46Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTU0Mw==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171543", "bodyText": "Issue found: Unnecessary use of fully qualified name 'com.dotcms.contenttype.model.field.Field' due to existing import 'com.dotcms.contenttype.model.field.Field'", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:47Z", "path": "dotCMS/src/integration-test/java/com/dotcms/contenttype/business/DotAssetBaseTypeToContentTypeStrategyImplTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package com.dotcms.contenttype.business;\n+\n+import com.dotcms.IntegrationTestBase;\n+import com.dotcms.contenttype.model.field.BinaryField;\n+import com.dotcms.contenttype.model.field.Field;\n+import com.dotcms.contenttype.model.field.FieldVariable;\n+import com.dotcms.contenttype.model.field.ImmutableFieldVariable;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.rest.api.v1.temp.DotTempFile;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.util.FileUtil;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.PortalUtil;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.internal.util.Base64;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.FileWriter;\n+import java.util.Arrays;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+public class DotAssetBaseTypeToContentTypeStrategyImplTest  extends IntegrationTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * 1) creates a dotAsset content type for text plain\n+     * 2) creates a temporal file asset and gets the id\n+     * 3) creates a map with the contentlet properties (including as a file asset the temporal file id)\n+     * 4) runs the BaseTypeToContentTypeStrategy in order to get the new content type using the temporal file\n+     * @throws Exception\n+     */\n+    @Test\n+    public void test_apply_with_temporal_file() throws Exception {\n+\n+        // creates a dotAsset for text files\n+        final String variable = \"testDotAsset\" + System.currentTimeMillis();\n+        final ContentType dotAssetContentType = APILocator.getContentTypeAPI(APILocator.systemUser()).\n+                save(ContentTypeBuilder.builder(DotAssetContentType.class).folder(\n+                FolderAPI.SYSTEM_FOLDER).host(Host.SYSTEM_HOST).name(variable)\n+                .owner(APILocator.systemUser().getUserId()).build());\n+\n+        final Map<String, Field> fieldMap = dotAssetContentType.fieldMap();\n+        com.dotcms.contenttype.model.field.Field binaryField           = fieldMap.get(DotAssetContentType.ASSET_FIELD_VAR);", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE3MTU0OQ==", "url": "https://github.com/dotCMS/core/pull/18067#discussion_r409171549", "bodyText": "Issue found: Avoid unused imports such as 'java.util.ArrayList'", "author": "dev-dotcms", "createdAt": "2020-04-15T22:29:48Z", "path": "dotCMS/src/main/java/com/dotcms/rest/ContentHelper.java", "diffHunk": "@@ -23,6 +23,8 @@\n \n import javax.servlet.http.HttpServletRequest;\n import java.io.File;\n+import java.util.ArrayList;", "originalCommit": "63b41fe0ecaa20ace60e24b92aa1a5deab45167c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}