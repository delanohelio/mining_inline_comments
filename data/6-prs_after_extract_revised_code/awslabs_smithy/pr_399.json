{"pr_number": 399, "pr_title": "requestBody and response content schemas as references", "pr_createdAt": "2020-04-28T22:17:23Z", "pr_url": "https://github.com/awslabs/smithy/pull/399", "timeline": [{"oid": "635cab04d8c9e61a365e9894a7364a4b4f9c2c30", "url": "https://github.com/awslabs/smithy/commit/635cab04d8c9e61a365e9894a7364a4b4f9c2c30", "message": "Refs on requestBody and response schemas", "committedDate": "2020-04-28T22:12:54Z", "type": "commit"}, {"oid": "befac81ea81092081038ef1b0c59e6fabe23a08a", "url": "https://github.com/awslabs/smithy/commit/befac81ea81092081038ef1b0c59e6fabe23a08a", "message": "Update ref naming", "committedDate": "2020-04-28T23:20:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4MjQ2Mw==", "url": "https://github.com/awslabs/smithy/pull/399#discussion_r416982463", "bodyText": "Can you add a comment here (and in the other bit of updated code) to state why we're doing this?", "author": "mtdowling", "createdAt": "2020-04-28T23:23:07Z", "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java", "diffHunk": "@@ -398,10 +403,17 @@ private void createResponsePayload(\n             String mediaType,\n             Context<T> context,\n             HttpBinding binding,\n-            ResponseObject.Builder responseBuilder\n+            ResponseObject.Builder responseBuilder,\n+            Shape operationOrError\n     ) {\n+        Schema schema = context.inlineOrReferenceSchema(binding.getMember());", "originalCommit": "befac81ea81092081038ef1b0c59e6fabe23a08a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4NTMwMA==", "url": "https://github.com/awslabs/smithy/pull/399#discussion_r416985300", "bodyText": "Added documentation in both places.", "author": "srchase", "createdAt": "2020-04-28T23:31:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk4MjQ2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "874747b26dc235157b1c39c9606c5752cdf0b4c8", "chunk": "diff --git a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\nindex 29ecd4746..338e1a542 100644\n--- a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\n+++ b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\n\n@@ -406,6 +406,9 @@ abstract class AbstractRestProtocol<T extends Trait> implements OpenApiProtocol<\n             ResponseObject.Builder responseBuilder,\n             Shape operationOrError\n     ) {\n+        // API Gateway validation requires that in-line schemas must be objects\n+        // or arrays. These schemas are synthesized as references so that\n+        // any schemas with string types will pass validation.\n         Schema schema = context.inlineOrReferenceSchema(binding.getMember());\n         String shapeName = operationOrError.getId().getName();\n         String synthesizedName = operationOrError instanceof OperationShape\n"}}, {"oid": "874747b26dc235157b1c39c9606c5752cdf0b4c8", "url": "https://github.com/awslabs/smithy/commit/874747b26dc235157b1c39c9606c5752cdf0b4c8", "message": "Document API Gateway validation requirements", "committedDate": "2020-04-28T23:28:35Z", "type": "commit"}, {"oid": "c80d89df4d463c994fb15146e71cf7da3e14d4fc", "url": "https://github.com/awslabs/smithy/commit/c80d89df4d463c994fb15146e71cf7da3e14d4fc", "message": "Additional documentation", "committedDate": "2020-04-28T23:30:50Z", "type": "commit"}]}