{"pr_number": 587, "pr_title": "Add CodegenWriter abstractions", "pr_createdAt": "2020-10-01T03:24:31Z", "pr_url": "https://github.com/awslabs/smithy/pull/587", "timeline": [{"oid": "19d56bb2597af6af48e62a6be813c0a0bdadbce4", "url": "https://github.com/awslabs/smithy/commit/19d56bb2597af6af48e62a6be813c0a0bdadbce4", "message": "Add CodegenWriter abstractions\n\nCodegenWriter, CodegenWriterDelegator, et al. are meant to make it\neasier to develop code generators that utilize Smithy's Symbol,\nSymbolReference, and SymbolDependency abstractions.\nCodegenWriterDelegator provides abstractions for creating and handing\nout references to CodegenWriters while collecting all of the imports\nneeded for an entire project. CodegenWriter is used to write code,\nsymbols, documentation, and manage the imports needed for a specific\nfile. Other abstractions were added that make it easier to build-up and\ncompose CodegenWriters and delegators, for example, the\nJavaStyleDocumentationWriter can make it easier to implement writing\ndocumentation for programming languages that use Java-style comments.", "committedDate": "2020-10-01T07:46:59Z", "type": "forcePushed"}, {"oid": "d7a921f2e1814452b261f64100ad0f2e671e5355", "url": "https://github.com/awslabs/smithy/commit/d7a921f2e1814452b261f64100ad0f2e671e5355", "message": "Add CodegenWriter abstractions\n\nCodegenWriter, CodegenWriterDelegator, et al. are meant to make it\neasier to develop code generators that utilize Smithy's Symbol,\nSymbolReference, and SymbolDependency abstractions.\nCodegenWriterDelegator provides abstractions for creating and handing\nout references to CodegenWriters while collecting all of the imports\nneeded for an entire project. CodegenWriter is used to write code,\nsymbols, documentation, and manage the imports needed for a specific\nfile. Other abstractions were added that make it easier to build-up and\ncompose CodegenWriters and delegators, for example, the\nJavaStyleDocumentationWriter can make it easier to implement writing\ndocumentation for programming languages that use Java-style comments.", "committedDate": "2020-10-01T16:34:23Z", "type": "forcePushed"}, {"oid": "3434273c2eeb39aa547c746c904481d38937a473", "url": "https://github.com/awslabs/smithy/commit/3434273c2eeb39aa547c746c904481d38937a473", "message": "Add CodegenWriter abstractions\n\nCodegenWriter, CodegenWriterDelegator, et al. are meant to make it\neasier to develop code generators that utilize Smithy's Symbol,\nSymbolReference, and SymbolDependency abstractions.\nCodegenWriterDelegator provides abstractions for creating and handing\nout references to CodegenWriters while collecting all of the imports\nneeded for an entire project. CodegenWriter is used to write code,\nsymbols, documentation, and manage the imports needed for a specific\nfile. Other abstractions were added that make it easier to build-up and\ncompose CodegenWriters and delegators, for example, the\nJavaStyleDocumentationWriter can make it easier to implement writing\ndocumentation for programming languages that use Java-style comments.", "committedDate": "2020-10-01T17:59:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY4MTkwOQ==", "url": "https://github.com/awslabs/smithy/pull/587#discussion_r502681909", "bodyText": "Needs a space after \"states.\"", "author": "kstich", "createdAt": "2020-10-09T21:36:35Z", "path": "smithy-utils/src/main/java/software/amazon/smithy/utils/CodeWriter.java", "diffHunk": "@@ -472,6 +473,19 @@ public CodeWriter setExpressionStart(char expressionStart) {\n         return this;\n     }\n \n+    /**\n+     * Get the expression start character of the <em>current</em> state.\n+     *\n+     * <p>This value should not be cached and reused across pushed and popped\n+     * states.This value is \"$\" by default, but it can be changed using", "originalCommit": "3434273c2eeb39aa547c746c904481d38937a473", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "chunk": "diff --git a/smithy-utils/src/main/java/software/amazon/smithy/utils/CodeWriter.java b/smithy-utils/src/main/java/software/amazon/smithy/utils/CodeWriter.java\nindex 9e96437c7..544837bd8 100644\n--- a/smithy-utils/src/main/java/software/amazon/smithy/utils/CodeWriter.java\n+++ b/smithy-utils/src/main/java/software/amazon/smithy/utils/CodeWriter.java\n\n@@ -477,7 +477,7 @@ public class CodeWriter {\n      * Get the expression start character of the <em>current</em> state.\n      *\n      * <p>This value should not be cached and reused across pushed and popped\n-     * states.This value is \"$\" by default, but it can be changed using\n+     * states. This value is \"$\" by default, but it can be changed using\n      * {@link #setExpressionStart(char)}.\n      *\n      * @return Returns the expression start char of the current state.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4NTc4Ng==", "url": "https://github.com/awslabs/smithy/pull/587#discussion_r503385786", "bodyText": "fwiw, I don't understand this comment.", "author": "rcoh", "createdAt": "2020-10-12T15:51:13Z", "path": "smithy-codegen-core/src/main/java/software/amazon/smithy/codegen/core/writer/UseShapeWriterObserver.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.codegen.core.writer;\n+\n+import software.amazon.smithy.codegen.core.Symbol;\n+import software.amazon.smithy.codegen.core.SymbolProvider;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.utils.CodeWriter;\n+import software.amazon.smithy.utils.SmithyUnstableApi;\n+\n+/**\n+ * An observer invoked when a shape CodegenWriter is used.\n+ *\n+ * <p>The following example defines a {@code UseShapeWriterObserver} that\n+ * writes a comment before a shape is written:\n+ *\n+ * <pre>{@code\n+ * public final class MyObserver implements UseShapeWriterObserver<MyWriter> {\n+ *     \\@Override\n+ *     public void observe(Shape shape, Symbol symbol, SymbolProvider symbolProvider, T writer) {\n+ *         writer.write(\"/// Writing $L\", shape.getId());\n+ *     }\n+ * }\n+ * }</pre>\n+ *\n+ * @param <T> Type of CodegenWriter being used.\n+ */\n+@FunctionalInterface\n+@SmithyUnstableApi\n+public interface UseShapeWriterObserver<T extends CodegenWriter<T, ?>> {\n+    /**\n+     * Invoked when a shape writer is used, allowing for customizations to be\n+     * applied to the shape writer like invoking service providers to write\n+     * default contents to generated code.", "originalCommit": "3434273c2eeb39aa547c746c904481d38937a473", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4Nzg2MQ==", "url": "https://github.com/awslabs/smithy/pull/587#discussion_r503487861", "bodyText": "Thanks, I simplified the comment.", "author": "mtdowling", "createdAt": "2020-10-12T19:21:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzM4NTc4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "chunk": "diff --git a/smithy-codegen-core/src/main/java/software/amazon/smithy/codegen/core/writer/UseShapeWriterObserver.java b/smithy-codegen-core/src/main/java/software/amazon/smithy/codegen/core/writer/UseShapeWriterObserver.java\nindex 7bf8fa1a6..6b1579628 100644\n--- a/smithy-codegen-core/src/main/java/software/amazon/smithy/codegen/core/writer/UseShapeWriterObserver.java\n+++ b/smithy-codegen-core/src/main/java/software/amazon/smithy/codegen/core/writer/UseShapeWriterObserver.java\n\n@@ -15,6 +15,7 @@\n \n package software.amazon.smithy.codegen.core.writer;\n \n+import java.util.function.Consumer;\n import software.amazon.smithy.codegen.core.Symbol;\n import software.amazon.smithy.codegen.core.SymbolProvider;\n import software.amazon.smithy.model.shapes.Shape;\n"}}, {"oid": "ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "url": "https://github.com/awslabs/smithy/commit/ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "message": "Add CodegenWriter abstractions\n\nCodegenWriter, CodegenWriterDelegator, et al. are meant to make it\neasier to develop code generators that utilize Smithy's Symbol,\nSymbolReference, and SymbolDependency abstractions.\nCodegenWriterDelegator provides abstractions for creating and handing\nout references to CodegenWriters while collecting all of the imports\nneeded for an entire project. CodegenWriter is used to write code,\nsymbols, documentation, and manage the imports needed for a specific\nfile. Other abstractions were added that make it easier to build-up and\ncompose CodegenWriters and delegators, for example, the\nJavaStyleDocumentationWriter can make it easier to implement writing\ndocumentation for programming languages that use Java-style comments.", "committedDate": "2020-10-12T19:21:24Z", "type": "commit"}, {"oid": "ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "url": "https://github.com/awslabs/smithy/commit/ac7e907bf667e0d5ed04f9d9c129145c1de7346c", "message": "Add CodegenWriter abstractions\n\nCodegenWriter, CodegenWriterDelegator, et al. are meant to make it\neasier to develop code generators that utilize Smithy's Symbol,\nSymbolReference, and SymbolDependency abstractions.\nCodegenWriterDelegator provides abstractions for creating and handing\nout references to CodegenWriters while collecting all of the imports\nneeded for an entire project. CodegenWriter is used to write code,\nsymbols, documentation, and manage the imports needed for a specific\nfile. Other abstractions were added that make it easier to build-up and\ncompose CodegenWriters and delegators, for example, the\nJavaStyleDocumentationWriter can make it easier to implement writing\ndocumentation for programming languages that use Java-style comments.", "committedDate": "2020-10-12T19:21:24Z", "type": "forcePushed"}]}