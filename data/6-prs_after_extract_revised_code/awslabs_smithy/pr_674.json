{"pr_number": 674, "pr_title": "Fix openapi greedy param names for API Gateway REST APIs", "pr_createdAt": "2020-12-16T22:47:55Z", "pr_url": "https://github.com/awslabs/smithy/pull/674", "timeline": [{"oid": "cb8b3043c95446954639efee5fa2e7e0603b3ea3", "url": "https://github.com/awslabs/smithy/commit/cb8b3043c95446954639efee5fa2e7e0603b3ea3", "message": "Add config to suffix greedy param", "committedDate": "2020-12-16T21:48:58Z", "type": "commit"}, {"oid": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "url": "https://github.com/awslabs/smithy/commit/958c9a8e12994e69b6a8f2e4022605b88787a42e", "message": "Default REST apis to remove greedy suffix", "committedDate": "2020-12-16T22:37:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NjU1MQ==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544686551", "bodyText": "This would probably work better as a real if statement now that the ternary is so complex.", "author": "kstich", "createdAt": "2020-12-16T23:03:04Z", "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java", "diffHunk": "@@ -138,7 +138,11 @@ abstract Schema createDocumentSchema(\n \n             // Greedy labels in OpenAPI need to include the label in the generated parameter.\n             // For example, given \"/{foo+}\", the parameter name must be \"foo+\".\n-            String name = label.isGreedyLabel() ? label.getContent() + \"+\" : label.getContent();\n+            // Some vendors/tooling, require the \"+\" suffix be excluded in the generated parameter.\n+            // If required, the setRemoveGreedyParameterSuffix config option should be set to `true`.\n+            // When this option is enabled, given \"/{foo+}\", the parameter name will be \"foo\".\n+            String name = (label.isGreedyLabel() && !context.getConfig().getRemoveGreedyParameterSuffix())", "originalCommit": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxODI2Mw==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544718263", "bodyText": "Addressed in ee69c1c.", "author": "srchase", "createdAt": "2020-12-17T00:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NjU1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "chunk": "diff --git a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\nindex 9476dbc81..eb88e8b0f 100644\n--- a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\n+++ b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/protocols/AbstractRestProtocol.java\n\n@@ -141,8 +141,10 @@ abstract class AbstractRestProtocol<T extends Trait> implements OpenApiProtocol<\n             // Some vendors/tooling, require the \"+\" suffix be excluded in the generated parameter.\n             // If required, the setRemoveGreedyParameterSuffix config option should be set to `true`.\n             // When this option is enabled, given \"/{foo+}\", the parameter name will be \"foo\".\n-            String name = (label.isGreedyLabel() && !context.getConfig().getRemoveGreedyParameterSuffix())\n-                    ? label.getContent() + \"+\" : label.getContent();\n+            String name = label.getContent();\n+            if (label.isGreedyLabel() && !context.getConfig().getRemoveGreedyParameterSuffix()) {\n+                name = name + \"+\";\n+            }\n \n             result.add(ModelUtils.createParameterMember(context, binding.getMember())\n                     .name(name)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4Njg1Mw==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544686853", "bodyText": "This should have a guide update, since it's a new option.", "author": "kstich", "createdAt": "2020-12-16T23:03:47Z", "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java", "diffHunk": "@@ -218,6 +219,14 @@ public void setForbidGreedyLabels(boolean forbidGreedyLabels) {\n         this.forbidGreedyLabels = forbidGreedyLabels;\n     }\n \n+    public boolean getRemoveGreedyParameterSuffix() {", "originalCommit": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxODM3MA==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544718370", "bodyText": "Addressed in ee69c1c.", "author": "srchase", "createdAt": "2020-12-17T00:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4Njg1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "chunk": "diff --git a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\nindex e29b9e49e..521b82e6a 100644\n--- a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\n+++ b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\n\n@@ -223,6 +223,15 @@ public class OpenApiConfig extends JsonSchemaConfig {\n         return removeGreedyParameterSuffix;\n     }\n \n+    /**\n+     * Set to true to remove the \"+\" suffix that is added to the generated\n+     * parameter name for greedy labels.\n+     *\n+     * <p>By default, greedy labels will have a parameter name generated that\n+     * matches the label, including the \"+\" suffix.</p>\n+     * @param removeGreedyParameterSuffix Set to true to remove the \"+\" suffix\n+     *                                    on generated parameter name.\n+     */\n     public void setRemoveGreedyParameterSuffix(boolean removeGreedyParameterSuffix) {\n         this.removeGreedyParameterSuffix = removeGreedyParameterSuffix;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4OTUxOA==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544689518", "bodyText": "This should probably link to their API docs showing that greedy labels are not suffixed for REST: https://docs.aws.amazon.com/apigateway/latest/developerguide/setup-http-integrations.html\nConsider a \"this is counter to the default, like for HTTP APIs, ...\" that links to those docs too: https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-http.html", "author": "kstich", "createdAt": "2020-12-16T23:09:37Z", "path": "smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.aws.apigateway.openapi;\n+\n+import java.util.List;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.openapi.OpenApiConfig;\n+import software.amazon.smithy.utils.ListUtils;\n+\n+/**\n+ * REST APIs require that name parameters for greedy labels are not suffixed with \"+\".", "originalCommit": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxODMwMg==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544718302", "bodyText": "Addressed in ee69c1c.", "author": "srchase", "createdAt": "2020-12-17T00:21:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4OTUxOA=="}], "type": "inlineReview", "revised_code": {"commit": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "chunk": "diff --git a/smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java b/smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java\nindex d8e2186da..5b665f7ab 100644\n--- a/smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java\n+++ b/smithy-aws-apigateway-openapi/src/main/java/software/amazon/smithy/aws/apigateway/openapi/AddDefaultRestConfigSettings.java\n\n@@ -22,6 +22,9 @@ import software.amazon.smithy.utils.ListUtils;\n \n /**\n  * REST APIs require that name parameters for greedy labels are not suffixed with \"+\".\n+ *  @see <a href=\"https://docs.aws.amazon.com/apigateway/latest/developerguide/setup-http-integrations.html\">REST APIs</a>\n+ *  which is counter to the default, like for\n+ *  <a href=\"https://docs.aws.amazon.com/apigateway/latest/developerguide/http-api-develop-integrations-http.html\">HTTP APIs</a>.\n  */\n final class AddDefaultRestConfigSettings implements ApiGatewayMapper {\n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5MDAwNA==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544690004", "bodyText": "This should have javadoc.", "author": "kstich", "createdAt": "2020-12-16T23:10:43Z", "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java", "diffHunk": "@@ -218,6 +219,14 @@ public void setForbidGreedyLabels(boolean forbidGreedyLabels) {\n         this.forbidGreedyLabels = forbidGreedyLabels;\n     }\n \n+    public boolean getRemoveGreedyParameterSuffix() {\n+        return removeGreedyParameterSuffix;\n+    }\n+\n+    public void setRemoveGreedyParameterSuffix(boolean removeGreedyParameterSuffix) {", "originalCommit": "958c9a8e12994e69b6a8f2e4022605b88787a42e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcxODM0MA==", "url": "https://github.com/awslabs/smithy/pull/674#discussion_r544718340", "bodyText": "Addressed in ee69c1c.", "author": "srchase", "createdAt": "2020-12-17T00:21:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5MDAwNA=="}], "type": "inlineReview", "revised_code": {"commit": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "chunk": "diff --git a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\nindex e29b9e49e..521b82e6a 100644\n--- a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\n+++ b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/OpenApiConfig.java\n\n@@ -223,6 +223,15 @@ public class OpenApiConfig extends JsonSchemaConfig {\n         return removeGreedyParameterSuffix;\n     }\n \n+    /**\n+     * Set to true to remove the \"+\" suffix that is added to the generated\n+     * parameter name for greedy labels.\n+     *\n+     * <p>By default, greedy labels will have a parameter name generated that\n+     * matches the label, including the \"+\" suffix.</p>\n+     * @param removeGreedyParameterSuffix Set to true to remove the \"+\" suffix\n+     *                                    on generated parameter name.\n+     */\n     public void setRemoveGreedyParameterSuffix(boolean removeGreedyParameterSuffix) {\n         this.removeGreedyParameterSuffix = removeGreedyParameterSuffix;\n     }\n"}}, {"oid": "ee69c1c4ae18c050239476beb5ad5c6abded8051", "url": "https://github.com/awslabs/smithy/commit/ee69c1c4ae18c050239476beb5ad5c6abded8051", "message": "Simplify suffix logic, add docs", "committedDate": "2020-12-17T00:16:36Z", "type": "commit"}]}