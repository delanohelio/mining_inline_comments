{"pr_number": 364, "pr_title": "Update open api json schema pojos", "pr_createdAt": "2020-04-08T23:37:47Z", "pr_url": "https://github.com/awslabs/smithy/pull/364", "timeline": [{"oid": "326c505931d1377049ec10fae35cacd166ffe8ec", "url": "https://github.com/awslabs/smithy/commit/326c505931d1377049ec10fae35cacd166ffe8ec", "message": "Update JSON schema config to use POJO", "committedDate": "2020-04-08T20:11:55Z", "type": "commit"}, {"oid": "64aad7dd2ef890633f85404d8c7d6135d1b4fc55", "url": "https://github.com/awslabs/smithy/commit/64aad7dd2ef890633f85404d8c7d6135d1b4fc55", "message": "Refactor OpenAPI plugin to use POJOs\n\nThe OpenAPI plugin has now been refactored to use strongly-typed POJOs\nrather than the more dynamic Node-based configuration. This is possible\nbecause of the NodeMapper. Now OpenAPI's config extends from JSON\nSchema's config. All configuration prefixes were removed from OpenAPI\nkeys, but the plugin will handle loading the deprecated form of\n\"openapi.\" when parsing configuration settings.\n\nAdditional configuration settings used to configure conversion plugins\nfor either OpenAPI or JSON Schema are contained in the \"extensions\"\nproperty. This property can be access from the JsonSchemaConfig object\nand deserialized into a desired POJO using `getExtensions(Class type)`.\nThis allows typed access to additional configuration settings along with\nvalidation. Subsequent access to the same type is cached.", "committedDate": "2020-04-08T23:39:34Z", "type": "forcePushed"}, {"oid": "cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "url": "https://github.com/awslabs/smithy/commit/cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "message": "Refactor OpenAPI plugin to use POJOs\n\nThe OpenAPI plugin has now been refactored to use strongly-typed POJOs\nrather than the more dynamic Node-based configuration. This is possible\nbecause of the NodeMapper. Now OpenAPI's config extends from JSON\nSchema's config. All configuration prefixes were removed from OpenAPI\nkeys, but the plugin will handle loading the deprecated form of\n\"openapi.\" when parsing configuration settings.\n\nAdditional configuration settings used to configure conversion plugins\nfor either OpenAPI or JSON Schema are contained in the \"extensions\"\nproperty. This property can be access from the JsonSchemaConfig object\nand deserialized into a desired POJO using `getExtensions(Class type)`.\nThis allows typed access to additional configuration settings along with\nvalidation. Subsequent access to the same type is cached.", "committedDate": "2020-04-09T18:36:02Z", "type": "commit"}, {"oid": "cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "url": "https://github.com/awslabs/smithy/commit/cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "message": "Refactor OpenAPI plugin to use POJOs\n\nThe OpenAPI plugin has now been refactored to use strongly-typed POJOs\nrather than the more dynamic Node-based configuration. This is possible\nbecause of the NodeMapper. Now OpenAPI's config extends from JSON\nSchema's config. All configuration prefixes were removed from OpenAPI\nkeys, but the plugin will handle loading the deprecated form of\n\"openapi.\" when parsing configuration settings.\n\nAdditional configuration settings used to configure conversion plugins\nfor either OpenAPI or JSON Schema are contained in the \"extensions\"\nproperty. This property can be access from the JsonSchemaConfig object\nand deserialized into a desired POJO using `getExtensions(Class type)`.\nThis allows typed access to additional configuration settings along with\nvalidation. Subsequent access to the same type is cached.", "committedDate": "2020-04-09T18:36:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQwNTk0MA==", "url": "https://github.com/awslabs/smithy/pull/364#discussion_r406405940", "bodyText": "The javadoc here doesn't map to the expectation anymore, these are just strings of properties to disable not prefixed by \"disable\".", "author": "kstich", "createdAt": "2020-04-09T18:46:03Z", "path": "smithy-jsonschema/src/main/java/software/amazon/smithy/jsonschema/Schema.java", "diffHunk": "@@ -802,80 +808,80 @@ public Builder removeExtension(String key) {\n         }\n \n         /**\n-         * Applies a \"disable.X\" key to a schema builder.\n+         * Applies a \"disableX\" key to a schema builder.", "originalCommit": "cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a838695472dcd9f3fbf3b6369b508734034b85b", "chunk": "diff --git a/smithy-jsonschema/src/main/java/software/amazon/smithy/jsonschema/Schema.java b/smithy-jsonschema/src/main/java/software/amazon/smithy/jsonschema/Schema.java\nindex 237c6eeb2..13b035faa 100644\n--- a/smithy-jsonschema/src/main/java/software/amazon/smithy/jsonschema/Schema.java\n+++ b/smithy-jsonschema/src/main/java/software/amazon/smithy/jsonschema/Schema.java\n\n@@ -808,13 +808,13 @@ public final class Schema implements ToNode, ToSmithyBuilder<Schema> {\n         }\n \n         /**\n-         * Applies a \"disableX\" key to a schema builder.\n+         * Disables a specific JSON schema property by name.\n          *\n-         * @param disableKey Disable key to apply (e.g., \"disablePropertyNames\").\n+         * @param propertyName Property name to remove (e.g., \"propertyNames\").\n          * @return Returns the builder.\n          */\n-        public Builder disableProperty(String disableKey) {\n-            switch (disableKey) {\n+        public Builder disableProperty(String propertyName) {\n+            switch (propertyName) {\n                 case \"const\":\n                     return this.constValue(null);\n                 case \"default\":\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjQ1MzcyMw==", "url": "https://github.com/awslabs/smithy/pull/364#discussion_r406453723", "bodyText": "The intent to help here is really nice, but if it's something we want to do it needs a little more work to not cause issues. This will give the wrong value for what used to be openapi.aws.jsonContentType - removing .aws is an option. It will give the wrong methodology completely for openapi.use entries - however only openapi.use.xml was documented and was not implemented.", "author": "kstich", "createdAt": "2020-04-09T20:18:54Z", "path": "smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/Smithy2OpenApi.java", "diffHunk": "@@ -40,12 +46,29 @@ public String getName() {\n     @Override\n     public void execute(PluginContext context) {\n         OpenApiConverter converter = OpenApiConverter.create();\n-        context.getSettings().getStringMap().forEach(converter::putSetting);\n         context.getPluginClassLoader().ifPresent(converter::classLoader);\n \n-        ShapeId shapeId = ShapeId.from(context.getSettings()\n-                .expectStringMember(OpenApiConstants.SERVICE)\n-                .getValue());\n+        // Remove deprecated \"openapi.\" prefixes from configuration settings.\n+        ObjectNode mapped = context.getSettings();\n+        for (Map.Entry<String, Node> entry : mapped.getStringMap().entrySet()) {\n+            if (entry.getKey().startsWith(\"openapi.\")) {", "originalCommit": "cbf8f2e86d3b70b7d2d4a1096e0fa11828e492e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a838695472dcd9f3fbf3b6369b508734034b85b", "chunk": "diff --git a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/Smithy2OpenApi.java b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/Smithy2OpenApi.java\nindex 0bd968e97..7cac415e7 100644\n--- a/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/Smithy2OpenApi.java\n+++ b/smithy-openapi/src/main/java/software/amazon/smithy/openapi/fromsmithy/Smithy2OpenApi.java\n\n@@ -47,23 +41,7 @@ public final class Smithy2OpenApi implements SmithyBuildPlugin {\n     public void execute(PluginContext context) {\n         OpenApiConverter converter = OpenApiConverter.create();\n         context.getPluginClassLoader().ifPresent(converter::classLoader);\n-\n-        // Remove deprecated \"openapi.\" prefixes from configuration settings.\n-        ObjectNode mapped = context.getSettings();\n-        for (Map.Entry<String, Node> entry : mapped.getStringMap().entrySet()) {\n-            if (entry.getKey().startsWith(\"openapi.\")) {\n-                String expected = entry.getKey().substring(8);\n-                LOGGER.warning(\"Deprecated `openapi` configuration setting found: \" + entry.getKey()\n-                               + \". Use \" + expected + \" instead\");\n-                mapped = mapped.withoutMember(entry.getKey());\n-                mapped = mapped.withMember(expected, entry.getValue());\n-            }\n-        }\n-\n-        NodeMapper mapper = new NodeMapper();\n-        OpenApiConfig config = new OpenApiConfig();\n-        mapper.deserializeInto(mapped, config);\n-\n+        OpenApiConfig config = OpenApiConfig.fromNode(context.getSettings());\n         ShapeId shapeId = config.getService();\n \n         if (shapeId == null) {\n"}}, {"oid": "9a838695472dcd9f3fbf3b6369b508734034b85b", "url": "https://github.com/awslabs/smithy/commit/9a838695472dcd9f3fbf3b6369b508734034b85b", "message": "Add better deprecated property handling", "committedDate": "2020-04-09T22:27:18Z", "type": "commit"}]}