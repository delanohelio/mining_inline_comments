{"pr_number": 8590, "pr_title": " Add integration tests for samlsso legacy URL mode", "pr_createdAt": "2020-06-29T03:01:00Z", "pr_url": "https://github.com/wso2/product-is/pull/8590", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc0NzgwNw==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r446747807", "bodyText": "Update the license.", "author": "ashensw", "createdAt": "2020-06-29T03:05:31Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java", "diffHunk": "@@ -0,0 +1,170 @@\n+/*\n+ * Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "9fbbbb41cd2acfc9977e604de26f9195d5e12029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1ODE4MQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r446758181", "bodyText": "Fixed db6519d", "author": "GANGANI", "createdAt": "2020-06-29T03:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc0NzgwNw=="}], "type": "inlineReview", "revised_code": {"commit": "18ffcb4ef91e29a99b5c59e760712b638934ab11", "chunk": "diff --git a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java\nindex f4fbe67b0..593554152 100644\n--- a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java\n+++ b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2015, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n  *\n  *  WSO2 Inc. licenses this file to you under the Apache License,\n  *  Version 2.0 (the \"License\"); you may not use this file except\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc0Nzg3OA==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r446747878", "bodyText": "Fix formatting.", "author": "ashensw", "createdAt": "2020-06-29T03:05:53Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java", "diffHunk": "@@ -280,6 +284,12 @@ public void createUser(SAMLConfig config) {\n         }\n     }\n \n+    public void createApplicationForSAMLAartResolve(SAMLConfig config, String appName) throws Exception {\n+\n+        samlArtResolve =true;", "originalCommit": "9fbbbb41cd2acfc9977e604de26f9195d5e12029", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1ODE0Nw==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r446758147", "bodyText": "Fixed db6519d", "author": "GANGANI", "createdAt": "2020-06-29T03:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc0Nzg3OA=="}], "type": "inlineReview", "revised_code": {"commit": "18ffcb4ef91e29a99b5c59e760712b638934ab11", "chunk": "diff --git a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java\nindex b8fd17778..c452f8339 100644\n--- a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java\n+++ b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java\n\n@@ -286,7 +286,7 @@ public abstract class AbstractSAMLSSOTestCase extends ISIntegrationTest {\n \n     public void createApplicationForSAMLAartResolve(SAMLConfig config, String appName) throws Exception {\n \n-        samlArtResolve =true;\n+        samlArtResolve = true;\n         createApplication(config, appName);\n     }\n \n"}}, {"oid": "e4b4e8afd0c2b0743adcad220ec3a339a937f459", "url": "https://github.com/wso2/product-is/commit/e4b4e8afd0c2b0743adcad220ec3a339a937f459", "message": "Add integration tests for samlsso legacy URL mode", "committedDate": "2020-07-01T11:17:45Z", "type": "commit"}, {"oid": "3f8fe4d0751577ad325f4b5ed26c82271795c366", "url": "https://github.com/wso2/product-is/commit/3f8fe4d0751577ad325f4b5ed26c82271795c366", "message": "Add travelocity.properties file", "committedDate": "2020-07-01T11:17:45Z", "type": "commit"}, {"oid": "18ffcb4ef91e29a99b5c59e760712b638934ab11", "url": "https://github.com/wso2/product-is/commit/18ffcb4ef91e29a99b5c59e760712b638934ab11", "message": "Format the code", "committedDate": "2020-07-01T11:17:45Z", "type": "commit"}, {"oid": "0838822983fcf8db36a9618538d7dddd6af892d6", "url": "https://github.com/wso2/product-is/commit/0838822983fcf8db36a9618538d7dddd6af892d6", "message": "Change test case execution order", "committedDate": "2020-07-02T00:59:25Z", "type": "commit"}, {"oid": "0838822983fcf8db36a9618538d7dddd6af892d6", "url": "https://github.com/wso2/product-is/commit/0838822983fcf8db36a9618538d7dddd6af892d6", "message": "Change test case execution order", "committedDate": "2020-07-02T00:59:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1NzE0NQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489357145", "bodyText": "Missing description", "author": "Abilashini", "createdAt": "2020-09-16T11:14:42Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java", "diffHunk": "@@ -403,6 +420,16 @@ public SAMLSSOServiceProviderDTO createSsoSPDTOForIdPInit(SAMLConfig config){\n         return idpInitSpDTO;\n     }\n \n+    /**", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0Mzg3Mw==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543873", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1NzE0NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1NzcxNA==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489357714", "bodyText": "Shall we add a class level comment", "author": "Abilashini", "createdAt": "2020-09-16T11:15:46Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.identity.integration.test.saml;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.util.EntityUtils;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.identity.sso.saml.stub.types.SAMLSSOServiceProviderDTO;\n+import org.wso2.identity.integration.test.util.Utils;\n+import org.wso2.identity.integration.test.utils.CommonConstants;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+\n+public class SAMLARTRESOLVETestCase extends AbstractSAMLSSOTestCase {", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MzcxOQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543719", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1NzcxNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MTI2OA==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489361268", "bodyText": "missing Javadoc", "author": "Abilashini", "createdAt": "2020-09-16T11:22:53Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/AbstractSAMLSSOTestCase.java", "diffHunk": "@@ -280,6 +284,12 @@ public void createUser(SAMLConfig config) {\n         }\n     }\n \n+    public void createApplicationForSAMLArtResolve(SAMLConfig config, String appName) throws Exception {", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MzYyMQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543621", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MTI2OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MTYxOQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489361619", "bodyText": "Class level comment", "author": "Abilashini", "createdAt": "2020-09-16T11:23:39Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLInvalidIssuerTestCase.java", "diffHunk": "@@ -24,39 +24,33 @@\n import org.apache.commons.logging.LogFactory;\n import org.apache.http.Header;\n import org.apache.http.HttpResponse;\n-import org.apache.http.NameValuePair;\n import org.apache.http.ProtocolException;\n-import org.apache.http.client.entity.UrlEncodedFormEntity;\n-import org.apache.http.client.methods.HttpGet;\n-import org.apache.http.client.methods.HttpPost;\n import org.apache.http.impl.client.DefaultHttpClient;\n import org.apache.http.impl.client.DefaultRedirectHandler;\n-import org.apache.http.message.BasicNameValuePair;\n import org.apache.http.protocol.HttpContext;\n import org.apache.http.util.EntityUtils;\n import org.testng.Assert;\n import org.testng.annotations.AfterClass;\n import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n import org.wso2.carbon.identity.application.common.model.xsd.InboundAuthenticationConfig;\n import org.wso2.carbon.identity.application.common.model.xsd.InboundAuthenticationRequestConfig;\n import org.wso2.carbon.identity.application.common.model.xsd.Property;\n import org.wso2.carbon.identity.application.common.model.xsd.ServiceProvider;\n-import org.wso2.carbon.um.ws.api.stub.ClaimValue;\n import org.wso2.identity.integration.common.clients.application.mgt.ApplicationManagementServiceClient;\n import org.wso2.identity.integration.common.clients.usermgt.remote.RemoteUserStoreManagerServiceClient;\n-import org.wso2.identity.integration.common.utils.ISIntegrationTest;\n+import org.wso2.identity.integration.test.util.Utils;\n+import org.wso2.identity.integration.test.utils.CommonConstants;\n \n-import java.io.BufferedReader;\n-import java.io.IOException;\n-import java.io.InputStreamReader;\n import java.net.MalformedURLException;\n import java.net.URI;\n import java.net.URL;\n-import java.util.ArrayList;\n-import java.util.List;\n \n-public class SAMLInvalidIssuerTestCase extends ISIntegrationTest {\n+public class SAMLInvalidIssuerTestCase extends AbstractSAMLSSOTestCase {", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MzUyNA==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543524", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MTYxOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwMTI0OQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489401249", "bodyText": "shall we change it to a debug log instead of using an info log? otherwise having if (log.isDebugEnabled()) { is redundant", "author": "dewniMW", "createdAt": "2020-09-16T12:35:11Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLARTRESOLVETestCase.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.identity.integration.test.saml;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.util.EntityUtils;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Factory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.automation.engine.context.TestUserMode;\n+import org.wso2.carbon.identity.sso.saml.stub.types.SAMLSSOServiceProviderDTO;\n+import org.wso2.identity.integration.test.util.Utils;\n+import org.wso2.identity.integration.test.utils.CommonConstants;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+\n+public class SAMLARTRESOLVETestCase extends AbstractSAMLSSOTestCase {\n+\n+    private static final Log log = LogFactory.getLog(SAMLSSOTestCase.class);\n+\n+    private SAMLConfig config;\n+\n+    @Factory(dataProvider = \"samlConfigProvider\")\n+    public SAMLARTRESOLVETestCase(SAMLConfig config) {\n+\n+        if (log.isDebugEnabled()) {\n+            log.info(\"SAML Artifact Binding Test initialized for \" + config);", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MzQzNg==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543436", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwMTI0OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwMzkyNw==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489403927", "bodyText": "change to log.debug", "author": "dewniMW", "createdAt": "2020-09-16T12:39:51Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/saml/SAMLInvalidIssuerTestCase.java", "diffHunk": "@@ -67,34 +61,33 @@\n     private static final String ATTRIBUTE_CS_INDEX_VALUE = \"1239245949\";\n     private static final String ATTRIBUTE_CS_INDEX_NAME = \"attrConsumServiceIndex\";\n \n-    // User Attributes\n-    private static final String USERNAME = \"testUser\";\n-    private static final String PASSWORD = \"testUser\";\n-    private static final String EMAIL = \"testUser@wso2.com\";\n-    private static final String NICKNAME = \"testUserNick\";\n-\n     private static final String ACS_URL = \"http://localhost:8490/travelocity.com/home.jsp\";\n     private static final String COMMON_AUTH_URL = \"https://localhost:9853/commonauth\";\n     private static final String SAML_SSO_LOGIN_URL =\n             \"http://localhost:8490/travelocity.com/samlsso?SAML2.HTTPBinding=HTTP-Redirect\";\n     private static final String SAML_ERROR_NOTIFICATION_PATH = \"/authenticationendpoint/samlsso_notification.do\";\n \n-    //Claim Uris\n-    private static final String firstNameClaimURI = \"http://wso2.org/claims/givenname\";\n-    private static final String lastNameClaimURI = \"http://wso2.org/claims/lastname\";\n-    private static final String emailClaimURI = \"http://wso2.org/claims/emailaddress\";\n-\n-    private static final String profileName = \"default\";\n-\n     private ApplicationManagementServiceClient applicationManagementServiceClient;\n     private RemoteUserStoreManagerServiceClient remoteUSMServiceClient;\n     private DefaultHttpClient httpClient;\n \n     private boolean isSAMLReturned;\n \n+    private SAMLConfig config;\n+\n+    @Factory(dataProvider = \"samlConfigProvider\")\n+    public SAMLInvalidIssuerTestCase(SAMLConfig config) {\n+\n+        if (log.isDebugEnabled()){\n+            log.info(\"SAML SSO Test initialized for \" + config);", "originalCommit": "0838822983fcf8db36a9618538d7dddd6af892d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwNDM2Mg==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489404362", "bodyText": "shouldn't it be config.toString() ?", "author": "dewniMW", "createdAt": "2020-09-16T12:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwMzkyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTU0MzMzOQ==", "url": "https://github.com/wso2/product-is/pull/8590#discussion_r489543339", "bodyText": "Fixed 70d73b5", "author": "GANGANI", "createdAt": "2020-09-16T15:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQwMzkyNw=="}], "type": "inlineReview", "revised_code": null}]}