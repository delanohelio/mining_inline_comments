{"pr_number": 9926, "pr_title": "Fix integration test failure due to nonce cookie flow.", "pr_createdAt": "2020-10-17T15:01:20Z", "pr_url": "https://github.com/wso2/product-is/pull/9926", "timeline": [{"oid": "89796870bf99c5ff6ad3931ab63d38842c24f034", "url": "https://github.com/wso2/product-is/commit/89796870bf99c5ff6ad3931ab63d38842c24f034", "message": "Fix nonce cookie flow.", "committedDate": "2020-10-18T18:33:00Z", "type": "forcePushed"}, {"oid": "bf4ce63f3713de4c41ebeb3f2c9e98bd0424215b", "url": "https://github.com/wso2/product-is/commit/bf4ce63f3713de4c41ebeb3f2c9e98bd0424215b", "message": "Fix nonce cookie flow.", "committedDate": "2020-10-18T18:36:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NTU1Mg==", "url": "https://github.com/wso2/product-is/pull/9926#discussion_r516455552", "bodyText": "do we need to declare these variables? cant we pass like\nhttpClientAzUser = HttpClientBuilder.create().setDefaultCookieStore(new BasicCookieStore()).build();", "author": "thanujalk", "createdAt": "2020-11-03T06:55:14Z", "path": "modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/application/authz/ApplicationAuthzTestCase.java", "diffHunk": "@@ -83,6 +86,9 @@\n                     \"    <Rule Effect=\\\"Deny\\\" RuleId=\\\"denyall\\\"/>\\n\" +\n                     \"</Policy>\";\n \n+    CookieStore cookieStore = new BasicCookieStore();\n+    CookieStore cookieStoreUnAuthorized = new BasicCookieStore();", "originalCommit": "bf4ce63f3713de4c41ebeb3f2c9e98bd0424215b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NjIxOQ==", "url": "https://github.com/wso2/product-is/pull/9926#discussion_r516456219", "bodyText": "in other places as well..", "author": "thanujalk", "createdAt": "2020-11-03T06:57:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NTU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3OTE0Nw==", "url": "https://github.com/wso2/product-is/pull/9926#discussion_r516479147", "bodyText": "In some places, we can reuse the cookie store by clearing it like:  cookieStore.clear(), I will fix the other places.", "author": "inthirakumaaran", "createdAt": "2020-11-03T08:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ1NTU1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a6e9fad8f2d49b75e0031dfab8f6ad70a276aa91", "chunk": "diff --git a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/application/authz/ApplicationAuthzTestCase.java b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/application/authz/ApplicationAuthzTestCase.java\nindex 76c7bf6fd..6d84fac42 100644\n--- a/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/application/authz/ApplicationAuthzTestCase.java\n+++ b/modules/integration/tests-integration/tests-backend/src/test/java/org/wso2/identity/integration/test/application/authz/ApplicationAuthzTestCase.java\n\n@@ -86,9 +81,6 @@ public class ApplicationAuthzTestCase extends AbstractApplicationAuthzTestCase {\n                     \"    <Rule Effect=\\\"Deny\\\" RuleId=\\\"denyall\\\"/>\\n\" +\n                     \"</Policy>\";\n \n-    CookieStore cookieStore = new BasicCookieStore();\n-    CookieStore cookieStoreUnAuthorized = new BasicCookieStore();\n-\n     @BeforeClass(alwaysRun = true)\n     public void testInit() throws Exception {\n \n"}}, {"oid": "79c4682ac1da0bee6941622833b4544557ee8f34", "url": "https://github.com/wso2/product-is/commit/79c4682ac1da0bee6941622833b4544557ee8f34", "message": "Fix nonce cookie flow.", "committedDate": "2020-11-03T08:17:24Z", "type": "commit"}, {"oid": "a6e9fad8f2d49b75e0031dfab8f6ad70a276aa91", "url": "https://github.com/wso2/product-is/commit/a6e9fad8f2d49b75e0031dfab8f6ad70a276aa91", "message": "Fix cookieStore object declaration.", "committedDate": "2020-11-03T08:17:24Z", "type": "commit"}, {"oid": "a6e9fad8f2d49b75e0031dfab8f6ad70a276aa91", "url": "https://github.com/wso2/product-is/commit/a6e9fad8f2d49b75e0031dfab8f6ad70a276aa91", "message": "Fix cookieStore object declaration.", "committedDate": "2020-11-03T08:17:24Z", "type": "forcePushed"}]}