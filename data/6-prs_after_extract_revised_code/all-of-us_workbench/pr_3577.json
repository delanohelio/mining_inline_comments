{"pr_number": 3577, "pr_title": "[noTicket][risk=low]Send Workspace Creator information to RDR", "pr_createdAt": "2020-05-12T22:46:47Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3577", "timeline": [{"oid": "2c9893b4015a16c406f45839c667c18662473026", "url": "https://github.com/all-of-us/workbench/commit/2c9893b4015a16c406f45839c667c18662473026", "message": "Send Workspace Creator information to RDR", "committedDate": "2020-05-12T22:27:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NzQ1MQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424077451", "bodyText": "Please make a new MapStruct mapper for this. There's a guide and tutorial in the top level README.", "author": "jaycarlton", "createdAt": "2020-05-12T22:49:07Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -447,6 +448,22 @@ public void updateDbRdrExport(RdrEntity entity, List<Long> idList) {\n     rdrExportDao.save(exportList);\n   }\n \n+  /**\n+   * Creates RdrWorkspaceCreator object that contains workspace creator information like id, given\n+   * name and lastName\n+   *\n+   * @param creatorUser\n+   * @return RdrWorkspaceCreator object\n+   */\n+  RdrWorkspaceCreator toRdrWorkspaceCreator(DbUser creatorUser) {", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java\nindex c86699ec9..7afdd26c5 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java\n\n@@ -448,22 +341,6 @@ public class RdrExportServiceImpl implements RdrExportService {\n     rdrExportDao.save(exportList);\n   }\n \n-  /**\n-   * Creates RdrWorkspaceCreator object that contains workspace creator information like id, given\n-   * name and lastName\n-   *\n-   * @param creatorUser\n-   * @return RdrWorkspaceCreator object\n-   */\n-  RdrWorkspaceCreator toRdrWorkspaceCreator(DbUser creatorUser) {\n-    RdrWorkspaceCreator workspaceCreator =\n-        new RdrWorkspaceCreator()\n-            .familyName(creatorUser.getFamilyName())\n-            .givenName(creatorUser.getGivenName())\n-            .userId(creatorUser.getUserId());\n-    return workspaceCreator;\n-  }\n-\n   /**\n    * Set excludeFromPublicDirectory to true if the workspace creator is an operational user i.e has\n    * Institution as All of Us Program operational Use\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODE5OQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424078199", "bodyText": "nit: Usually I'd use @Mock for mocking value objects (and @MockBean for beans). There may be a reason not to do so here.", "author": "jaycarlton", "createdAt": "2020-05-12T22:51:09Z", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -71,7 +72,7 @@\n \n   private DbUser dbUserWithEmail;\n   private DbUser dbUserWithoutEmail;\n-  private DbWorkspace mockWorkspace, mockDeletedWorkspace;\n+  private DbWorkspace mockWorkspace, mockDeletedWorkspace, mockCreatorWorkspace;", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "chunk": "diff --git a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\nindex b6374dad5..e811ed603 100644\n--- a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n\n@@ -65,6 +65,8 @@ public class RdrExportServiceImplTest {\n   @MockBean private WorkspaceService mockWorkspaceService;\n   @MockBean private InstitutionService institutionService;\n   @MockBean private VerifiedInstitutionalAffiliationDao verifiedInstitutionalAffiliationDao;\n+  @MockBean private RdrMapper rdrMapper;\n+  private DbWorkspace mockWorkspace, mockDeletedWorkspace, mockCreatorWorkspace;\n \n   private static final Instant NOW = Instant.now();\n   private static final Timestamp NOW_TIMESTAMP = Timestamp.from(NOW);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODQ0MA==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424078440", "bodyText": "I would have expected the creator to be a field passed in to buildDbWorkspace.", "author": "jaycarlton", "createdAt": "2020-05-12T22:51:51Z", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -117,9 +118,14 @@ public void setUp() {\n \n     mockDeletedWorkspace =\n         buildDbWorkspace(2, \"workspace_del\", \"workspaceNs\", WorkspaceActiveStatus.DELETED);\n-\n+    mockDeletedWorkspace.setCreator(dbUserWithEmail);\n     when(mockWorkspaceDao.findDbWorkspaceByWorkspaceId(2)).thenReturn(mockDeletedWorkspace);\n \n+    mockCreatorWorkspace =\n+        buildDbWorkspace(3, \"mock_workspace_name\", \"workspaceNS\", WorkspaceActiveStatus.ACTIVE);\n+    mockCreatorWorkspace.setCreator(dbUserWithoutEmail);", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "chunk": "diff --git a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\nindex b6374dad5..a7067abab 100644\n--- a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n\n@@ -112,18 +112,15 @@ public class RdrExportServiceImplTest {\n \n     when(rdrExportDao.findByEntityTypeAndEntityId(anyShort(), anyLong())).thenReturn(null);\n     mockWorkspace =\n-        buildDbWorkspace(1, \"workspace_name\", \"workspaceNS\", WorkspaceActiveStatus.ACTIVE);\n-    mockWorkspace.setCreator(dbUserWithEmail);\n+        buildDbWorkspace(1, \"workspace_name\", \"workspaceNS\", WorkspaceActiveStatus.ACTIVE, dbUserWithEmail);\n     when(mockWorkspaceDao.findDbWorkspaceByWorkspaceId(1)).thenReturn(mockWorkspace);\n \n     mockDeletedWorkspace =\n-        buildDbWorkspace(2, \"workspace_del\", \"workspaceNs\", WorkspaceActiveStatus.DELETED);\n-    mockDeletedWorkspace.setCreator(dbUserWithEmail);\n+        buildDbWorkspace(2, \"workspace_del\", \"workspaceNs\", WorkspaceActiveStatus.DELETED, dbUserWithEmail);\n     when(mockWorkspaceDao.findDbWorkspaceByWorkspaceId(2)).thenReturn(mockDeletedWorkspace);\n \n     mockCreatorWorkspace =\n-        buildDbWorkspace(3, \"mock_workspace_name\", \"workspaceNS\", WorkspaceActiveStatus.ACTIVE);\n-    mockCreatorWorkspace.setCreator(dbUserWithoutEmail);\n+        buildDbWorkspace(3, \"mock_workspace_name\", \"workspaceNS\", WorkspaceActiveStatus.ACTIVE, dbUserWithoutEmail);\n     when(mockWorkspaceDao.findDbWorkspaceByWorkspaceId(3)).thenReturn(mockCreatorWorkspace);\n \n     DbVerifiedInstitutionalAffiliation mockVerifiedInstitutionalAffiliation =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODY0MA==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424078640", "bodyText": "workspaceIds plural.", "author": "jaycarlton", "createdAt": "2020-05-12T22:52:27Z", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -215,6 +221,25 @@ public void exportWorkspace_FocusOnUnderservedPopulation() throws ApiException {\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n+  @Test\n+  public void exportWorkspace_CreatorInformation() throws ApiException {\n+    List<Long> workspaceID = new ArrayList<>();", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "chunk": "diff --git a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\nindex b6374dad5..a7067abab 100644\n--- a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n\n@@ -223,20 +221,22 @@ public class RdrExportServiceImplTest {\n \n   @Test\n   public void exportWorkspace_CreatorInformation() throws ApiException {\n-    List<Long> workspaceID = new ArrayList<>();\n-    workspaceID.add(1l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n-    verify(rdrExportDao, times(1)).save(anyList());\n+    List<Long> workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(1l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n \n     RdrWorkspace rdrWorkspace = toDefaultRdrWorkspace(mockWorkspace);\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n \n-    workspaceID = new ArrayList<>();\n-    workspaceID.add(3l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n+    workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(3l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n     rdrWorkspace = toDefaultRdrWorkspace(mockCreatorWorkspace);\n     rdrWorkspace.setCreator(\n-        new RdrWorkspaceCreator().userId(2l).familyName(\"email\").givenName(\"icannothas\"));\n+        new RdrWorkspaceCreator()\n+            .userId(2l)\n+            .familyName(\"email\")\n+            .givenName(\"icannothas\"));\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODgzMQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424078831", "bodyText": "Is there anything else you can verify?", "author": "jaycarlton", "createdAt": "2020-05-12T22:52:55Z", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -215,6 +221,25 @@ public void exportWorkspace_FocusOnUnderservedPopulation() throws ApiException {\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n+  @Test\n+  public void exportWorkspace_CreatorInformation() throws ApiException {\n+    List<Long> workspaceID = new ArrayList<>();\n+    workspaceID.add(1l);\n+    rdrExportService.exportWorkspaces(workspaceID);\n+    verify(rdrExportDao, times(1)).save(anyList());", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODk1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424078959", "bodyText": "If you're using a real DAO, then you should be able to fetch the saved object and compare fields.", "author": "jaycarlton", "createdAt": "2020-05-12T22:53:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODgzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA4NDQ5Mw==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424084493", "bodyText": "i actually do not need to verify this, the purpose of this test is to ensure the creator information is different", "author": "NehaBroad", "createdAt": "2020-05-12T23:09:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODgzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwMDQwNQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424700405", "bodyText": "and i am verifying the RdrWorkspace converted object attribute value is matched via\nverify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));", "author": "NehaBroad", "createdAt": "2020-05-13T20:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3ODgzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "chunk": "diff --git a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\nindex b6374dad5..a7067abab 100644\n--- a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n\n@@ -223,20 +221,22 @@ public class RdrExportServiceImplTest {\n \n   @Test\n   public void exportWorkspace_CreatorInformation() throws ApiException {\n-    List<Long> workspaceID = new ArrayList<>();\n-    workspaceID.add(1l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n-    verify(rdrExportDao, times(1)).save(anyList());\n+    List<Long> workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(1l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n \n     RdrWorkspace rdrWorkspace = toDefaultRdrWorkspace(mockWorkspace);\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n \n-    workspaceID = new ArrayList<>();\n-    workspaceID.add(3l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n+    workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(3l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n     rdrWorkspace = toDefaultRdrWorkspace(mockCreatorWorkspace);\n     rdrWorkspace.setCreator(\n-        new RdrWorkspaceCreator().userId(2l).familyName(\"email\").givenName(\"icannothas\"));\n+        new RdrWorkspaceCreator()\n+            .userId(2l)\n+            .familyName(\"email\")\n+            .givenName(\"icannothas\"));\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3OTI2OA==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424079268", "bodyText": "With fluent constructsors or builders, please break before every new parameter.", "author": "jaycarlton", "createdAt": "2020-05-12T22:54:13Z", "path": "api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java", "diffHunk": "@@ -215,6 +221,25 @@ public void exportWorkspace_FocusOnUnderservedPopulation() throws ApiException {\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n+  @Test\n+  public void exportWorkspace_CreatorInformation() throws ApiException {\n+    List<Long> workspaceID = new ArrayList<>();\n+    workspaceID.add(1l);\n+    rdrExportService.exportWorkspaces(workspaceID);\n+    verify(rdrExportDao, times(1)).save(anyList());\n+\n+    RdrWorkspace rdrWorkspace = toDefaultRdrWorkspace(mockWorkspace);\n+    verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n+\n+    workspaceID = new ArrayList<>();\n+    workspaceID.add(3l);\n+    rdrExportService.exportWorkspaces(workspaceID);\n+    rdrWorkspace = toDefaultRdrWorkspace(mockCreatorWorkspace);\n+    rdrWorkspace.setCreator(\n+        new RdrWorkspaceCreator().userId(2l).familyName(\"email\").givenName(\"icannothas\"));", "originalCommit": "2c9893b4015a16c406f45839c667c18662473026", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgyNzAxMg==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r424827012", "bodyText": "so spotlessApply is putting them in one line. i had it like ....\n.userId(2l)\n.familyName(\"email\")\n.givenName(\"icannothas\"));", "author": "NehaBroad", "createdAt": "2020-05-14T01:53:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3OTI2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3NTk0Mg==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425275942", "bodyText": "ok. Spotless isn't the best poet.", "author": "jaycarlton", "createdAt": "2020-05-14T16:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3OTI2OA=="}], "type": "inlineReview", "revised_code": {"commit": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "chunk": "diff --git a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\nindex b6374dad5..a7067abab 100644\n--- a/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n+++ b/api/src/test/java/org/pmiops/workbench/rdr/RdrExportServiceImplTest.java\n\n@@ -223,20 +221,22 @@ public class RdrExportServiceImplTest {\n \n   @Test\n   public void exportWorkspace_CreatorInformation() throws ApiException {\n-    List<Long> workspaceID = new ArrayList<>();\n-    workspaceID.add(1l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n-    verify(rdrExportDao, times(1)).save(anyList());\n+    List<Long> workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(1l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n \n     RdrWorkspace rdrWorkspace = toDefaultRdrWorkspace(mockWorkspace);\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n \n-    workspaceID = new ArrayList<>();\n-    workspaceID.add(3l);\n-    rdrExportService.exportWorkspaces(workspaceID);\n+    workspaceIdList = new ArrayList<>();\n+    workspaceIdList.add(3l);\n+    rdrExportService.exportWorkspaces(workspaceIdList);\n     rdrWorkspace = toDefaultRdrWorkspace(mockCreatorWorkspace);\n     rdrWorkspace.setCreator(\n-        new RdrWorkspaceCreator().userId(2l).familyName(\"email\").givenName(\"icannothas\"));\n+        new RdrWorkspaceCreator()\n+            .userId(2l)\n+            .familyName(\"email\")\n+            .givenName(\"icannothas\"));\n     verify(mockRdrApi).exportWorkspaces(Arrays.asList(rdrWorkspace));\n   }\n \n"}}, {"oid": "7261cc47aa50eef6aa836d11e5103e4f801afd7d", "url": "https://github.com/all-of-us/workbench/commit/7261cc47aa50eef6aa836d11e5103e4f801afd7d", "message": "Pr comments create mapper", "committedDate": "2020-05-13T20:14:53Z", "type": "commit"}, {"oid": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "url": "https://github.com/all-of-us/workbench/commit/42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "message": "Fix Test", "committedDate": "2020-05-13T20:31:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2NjYyOQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425266629", "bodyText": "Yay! look how small it is!", "author": "jaycarlton", "createdAt": "2020-05-14T16:23:05Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrExportServiceImpl.java", "diffHunk": "@@ -274,45 +272,9 @@ private RdrResearcher toRdrResearcher(DbUser dbUser) {\n   }\n \n   private RdrWorkspace toRdrWorkspace(DbWorkspace dbWorkspace) {\n-    RdrWorkspace rdrWorkspace = new RdrWorkspace();\n-    rdrWorkspace.setWorkspaceId((int) dbWorkspace.getWorkspaceId());\n-    rdrWorkspace.setName(dbWorkspace.getName());\n-\n-    rdrWorkspace.setCreationTime(dbWorkspace.getCreationTime().toLocalDateTime().atOffset(offset));\n-    rdrWorkspace.setModifiedTime(\n-        dbWorkspace.getLastModifiedTime().toLocalDateTime().atOffset(offset));\n-\n-    RdrWorkspace.StatusEnum workspaceRDRStatus =\n-        dbWorkspace.getWorkspaceActiveStatusEnum() == WorkspaceActiveStatus.ACTIVE\n-            ? RdrWorkspace.StatusEnum.ACTIVE\n-            : RdrWorkspace.StatusEnum.INACTIVE;\n-\n-    rdrWorkspace.setStatus(workspaceRDRStatus);\n+    RdrWorkspace rdrWorkspace = rdrMapper.toRdrModel(dbWorkspace);", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2NzUxNg==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425267516", "bodyText": "This is great, but even better would be to have the fields named the same way.", "author": "jaycarlton", "createdAt": "2020-05-14T16:23:54Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2ODA4MQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425268081", "bodyText": "It's better if we can order them by source, target, and then use a string utility to alphabetize them.", "author": "jaycarlton", "createdAt": "2020-05-14T16:24:26Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2OTIwNg==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425269206", "bodyText": "We've already got different names for the db and model classes here, and now the RDR model is yet another mapping. This is just way more complicated than it needs to be. But the mapper sweeps it all under the rug in a really nice way.", "author": "jaycarlton", "createdAt": "2020-05-14T16:25:27Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n+  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n+  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n+  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n+  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n+  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n+  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2OTY2OQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425269669", "bodyText": "For anything you need to ignore, please put a comment indicating why it's required/safe/desired.", "author": "jaycarlton", "createdAt": "2020-05-14T16:25:54Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n+  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n+  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n+  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n+  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n+  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n+  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n+  @Mapping(target = \"workspaceUsers\", ignore = true)", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3MjgxOQ==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425272819", "bodyText": "nit: you can get around all ternary operators if you just set all the flages to unset first, then iterate over the enums and use a mapping function, sort of like the PropertyMapper class. Probably too fancy to bother with, but it's a neat trick.\nSo it'd be like AccessToCare.setRdrFlag(rdrDemogrphic); You can just zip down the set and call the setRdrFlag() method on each one for the thing and avoid all the branching.", "author": "jaycarlton", "createdAt": "2020-05-14T16:30:07Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n+  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n+  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n+  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n+  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n+  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n+  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n+  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n+  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n+\n+  ZoneOffset offset = OffsetDateTime.now().getOffset();\n+\n+  default OffsetDateTime toModelOffsetTime(Timestamp dbTime) {\n+    return dbTime.toLocalDateTime().atOffset(offset);\n+  }\n+\n+  default RdrWorkspace.StatusEnum toModelStatus(WorkspaceActiveStatus workspaceActiveStatus) {\n+    return workspaceActiveStatus == WorkspaceActiveStatus.ACTIVE\n+        ? RdrWorkspace.StatusEnum.ACTIVE\n+        : RdrWorkspace.StatusEnum.INACTIVE;\n+  }\n+\n+  default boolean toModelFocusOnUnderrepresentedPopulation(\n+      Set<SpecificPopulationEnum> dbSpecificPopulationSet) {\n+    return dbSpecificPopulationSet != null && dbSpecificPopulationSet.size() > 0;\n+  }\n+\n+  default RdrWorkspaceDemographic toModelWorkspaceDemographic(\n+      Set<SpecificPopulationEnum> dbPopulationEnumSet) {\n+    RdrWorkspaceDemographic rdrDemographic = new RdrWorkspaceDemographic();\n+\n+    rdrDemographic.setAccessToCare(", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI3NDQ2Mw==", "url": "https://github.com/all-of-us/workbench/pull/3577#discussion_r425274463", "bodyText": "You may want to find out when this returns null. Maybe a unit test there. In general, if you have to do a filter on non-null, there might be a constraint you could add upstream so this doesn't happen. Not always though.", "author": "jaycarlton", "createdAt": "2020-05-14T16:32:39Z", "path": "api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java", "diffHunk": "@@ -0,0 +1,118 @@\n+package org.pmiops.workbench.rdr;\n+\n+import java.sql.Timestamp;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.util.Arrays;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import org.mapstruct.Mapper;\n+import org.mapstruct.Mapping;\n+import org.pmiops.workbench.db.model.DbWorkspace;\n+import org.pmiops.workbench.model.SpecificPopulationEnum;\n+import org.pmiops.workbench.model.WorkspaceActiveStatus;\n+import org.pmiops.workbench.rdr.model.RdrWorkspace;\n+import org.pmiops.workbench.rdr.model.RdrWorkspaceDemographic;\n+import org.pmiops.workbench.utils.mappers.MapStructConfig;\n+\n+@Mapper(config = MapStructConfig.class)\n+public interface RdrMapper {\n+  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n+  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n+  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n+  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n+  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n+  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n+  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n+  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n+  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n+\n+  ZoneOffset offset = OffsetDateTime.now().getOffset();\n+\n+  default OffsetDateTime toModelOffsetTime(Timestamp dbTime) {\n+    return dbTime.toLocalDateTime().atOffset(offset);\n+  }\n+\n+  default RdrWorkspace.StatusEnum toModelStatus(WorkspaceActiveStatus workspaceActiveStatus) {\n+    return workspaceActiveStatus == WorkspaceActiveStatus.ACTIVE\n+        ? RdrWorkspace.StatusEnum.ACTIVE\n+        : RdrWorkspace.StatusEnum.INACTIVE;\n+  }\n+\n+  default boolean toModelFocusOnUnderrepresentedPopulation(\n+      Set<SpecificPopulationEnum> dbSpecificPopulationSet) {\n+    return dbSpecificPopulationSet != null && dbSpecificPopulationSet.size() > 0;\n+  }\n+\n+  default RdrWorkspaceDemographic toModelWorkspaceDemographic(\n+      Set<SpecificPopulationEnum> dbPopulationEnumSet) {\n+    RdrWorkspaceDemographic rdrDemographic = new RdrWorkspaceDemographic();\n+\n+    rdrDemographic.setAccessToCare(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.ACCESS_TO_CARE)\n+            ? RdrWorkspaceDemographic.AccessToCareEnum.NOT_EASILY_ACCESS_CARE\n+            : RdrWorkspaceDemographic.AccessToCareEnum.UNSET);\n+\n+    rdrDemographic.setDisabilityStatus(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.DISABILITY_STATUS)\n+            ? RdrWorkspaceDemographic.DisabilityStatusEnum.DISABILITY\n+            : RdrWorkspaceDemographic.DisabilityStatusEnum.UNSET);\n+\n+    rdrDemographic.setEducationLevel(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.EDUCATION_LEVEL)\n+            ? RdrWorkspaceDemographic.EducationLevelEnum.LESS_THAN_HIGH_SCHOOL\n+            : RdrWorkspaceDemographic.EducationLevelEnum.UNSET);\n+\n+    rdrDemographic.setIncomeLevel(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.INCOME_LEVEL)\n+            ? RdrWorkspaceDemographic.IncomeLevelEnum.BELOW_FEDERAL_POVERTY_LEVEL_200_PERCENT\n+            : RdrWorkspaceDemographic.IncomeLevelEnum.UNSET);\n+\n+    rdrDemographic.setGeography(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.GEOGRAPHY)\n+            ? RdrWorkspaceDemographic.GeographyEnum.RURAL\n+            : RdrWorkspaceDemographic.GeographyEnum.UNSET);\n+\n+    rdrDemographic.setSexualOrientation(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.SEXUAL_ORIENTATION)\n+            ? RdrWorkspaceDemographic.SexualOrientationEnum.OTHER_THAN_STRAIGHT\n+            : RdrWorkspaceDemographic.SexualOrientationEnum.UNSET);\n+\n+    rdrDemographic.setGenderIdentity(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.GENDER_IDENTITY)\n+            ? RdrWorkspaceDemographic.GenderIdentityEnum.OTHER_THAN_MAN_WOMAN\n+            : RdrWorkspaceDemographic.GenderIdentityEnum.UNSET);\n+\n+    rdrDemographic.setSexAtBirth(\n+        dbPopulationEnumSet.contains(SpecificPopulationEnum.SEX)\n+            ? RdrWorkspaceDemographic.SexAtBirthEnum.INTERSEX\n+            : RdrWorkspaceDemographic.SexAtBirthEnum.UNSET);\n+\n+    rdrDemographic.setRaceEthnicity(\n+        dbPopulationEnumSet.stream()\n+            .map(RdrExportEnums::specificPopulationToRaceEthnicity)", "originalCommit": "42d3fdef53fbabb41d43c6bdbdf7f13391d79b1f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\nindex ce647363e..6e4442196 100644\n--- a/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n+++ b/api/src/main/java/org/pmiops/workbench/rdr/RdrMapper.java\n\n@@ -18,17 +18,21 @@ import org.pmiops.workbench.utils.mappers.MapStructConfig;\n \n @Mapper(config = MapStructConfig.class)\n public interface RdrMapper {\n-  @Mapping(target = \"modifiedTime\", source = \"lastModifiedTime\")\n-  @Mapping(target = \"intendToStudy\", source = \"intendedStudy\")\n-  @Mapping(target = \"diseaseFocusedResearchName\", source = \"diseaseOfFocus\")\n-  @Mapping(target = \"ethicalLegalSocialImplications\", source = \"ethics\")\n-  @Mapping(target = \"scientificApproaches\", source = \"scientificApproach\")\n-  @Mapping(target = \"findingsFromStudy\", source = \"anticipatedFindings\")\n-  @Mapping(target = \"status\", source = \"workspaceActiveStatusEnum\")\n-  @Mapping(target = \"workspaceUsers\", ignore = true)\n+  @Mapping(source = \"anticipatedFindings\", target = \"findingsFromStudy\")\n+  @Mapping(source = \"ethics\", target = \"ethicalLegalSocialImplications\")\n+  // excludeFromPublicDirectory requires checking workspace creator institution information\n+  // This will be handle in ServiceImpl Class\n   @Mapping(target = \"excludeFromPublicDirectory\", ignore = true)\n-  @Mapping(target = \"focusOnUnderrepresentedPopulations\", source = \"specificPopulationsEnum\")\n-  @Mapping(target = \"workspaceDemographic\", source = \"specificPopulationsEnum\")\n+  @Mapping(source = \"intendedStudy\", target = \"intendToStudy\")\n+  @Mapping(source = \"diseaseOfFocus\", target = \"diseaseFocusedResearchName\")\n+  @Mapping(source = \"lastModifiedTime\", target = \"modifiedTime\")\n+  @Mapping(source = \"scientificApproach\", target = \"scientificApproaches\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"focusOnUnderrepresentedPopulations\")\n+  @Mapping(source = \"specificPopulationsEnum\", target = \"workspaceDemographic\")\n+  @Mapping(source = \"workspaceActiveStatusEnum\", target = \"status\")\n+  // Workspace User will be populated by a call to FireCloud\n+  // This will be handle in ServiceImpl Class\n+  @Mapping(target = \"workspaceUsers\", ignore = true)\n   RdrWorkspace toRdrModel(DbWorkspace employeeDbEntity);\n \n   ZoneOffset offset = OffsetDateTime.now().getOffset();\n"}}, {"oid": "1b3cf2acb7629a5116d40185147bbb6649b191bf", "url": "https://github.com/all-of-us/workbench/commit/1b3cf2acb7629a5116d40185147bbb6649b191bf", "message": "PR comments: Add comment and sort out mapping attribute", "committedDate": "2020-05-14T20:04:05Z", "type": "commit"}]}