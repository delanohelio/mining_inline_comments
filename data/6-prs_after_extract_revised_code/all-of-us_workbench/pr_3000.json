{"pr_number": 3000, "pr_title": "[no ticket][risk=no] Did I say Attachments? I meant Tags.", "pr_createdAt": "2020-01-14T22:49:50Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3000", "timeline": [{"oid": "da8a725f0599777018ad4bf8ef14bcb74f380262", "url": "https://github.com/all-of-us/workbench/commit/da8a725f0599777018ad4bf8ef14bcb74f380262", "message": "cleaning some things up", "committedDate": "2020-01-14T18:07:52Z", "type": "commit"}, {"oid": "c2607b3d80c59dbaa905ce7da8cb015b4ac4e135", "url": "https://github.com/all-of-us/workbench/commit/c2607b3d80c59dbaa905ce7da8cb015b4ac4e135", "message": "more fixes", "committedDate": "2020-01-14T20:17:44Z", "type": "commit"}, {"oid": "6f35c8f5ee2594fda1f1752ac591ff2f11d38595", "url": "https://github.com/all-of-us/workbench/commit/6f35c8f5ee2594fda1f1752ac591ff2f11d38595", "message": "spotless", "committedDate": "2020-01-14T21:47:44Z", "type": "commit"}, {"oid": "9805b747141f43e7ec5be4b8e06c6c4eec7e99d5", "url": "https://github.com/all-of-us/workbench/commit/9805b747141f43e7ec5be4b8e06c6c4eec7e99d5", "message": "make string format thinner", "committedDate": "2020-01-14T22:26:06Z", "type": "commit"}, {"oid": "7dd1a1ad35ab1c54753ad36947f640dea9432dbf", "url": "https://github.com/all-of-us/workbench/commit/7dd1a1ad35ab1c54753ad36947f640dea9432dbf", "message": "restore logging level", "committedDate": "2020-01-14T22:26:33Z", "type": "commit"}, {"oid": "414905cd08fe8154f83451638aef23032c63f55e", "url": "https://github.com/all-of-us/workbench/commit/414905cd08fe8154f83451638aef23032c63f55e", "message": "Fox in mocks our game is done sir", "committedDate": "2020-01-14T23:18:44Z", "type": "commit"}, {"oid": "9020032cc65f7e0fed788de49c36e3b80a015d5b", "url": "https://github.com/all-of-us/workbench/commit/9020032cc65f7e0fed788de49c36e3b80a015d5b", "message": "spotless", "committedDate": "2020-01-15T02:30:34Z", "type": "commit"}, {"oid": "be70469b636474e31867c108b5c8cd7b86d103eb", "url": "https://github.com/all-of-us/workbench/commit/be70469b636474e31867c108b5c8cd7b86d103eb", "message": "merge master && switch set to list to match view.create signature", "committedDate": "2020-01-15T17:05:46Z", "type": "commit"}, {"oid": "8a8c6c85d4ba54a996f29e462bdcc0c866c4acd4", "url": "https://github.com/all-of-us/workbench/commit/8a8c6c85d4ba54a996f29e462bdcc0c866c4acd4", "message": "test tweak", "committedDate": "2020-01-15T17:47:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE0OTM3NA==", "url": "https://github.com/all-of-us/workbench/pull/3000#discussion_r367149374", "bodyText": "Everything else was incremented to _2, but this was incremented to _3. Who should know about why this metric is different from all the others?", "author": "gjuggler", "createdAt": "2020-01-15T22:51:20Z", "path": "api/src/main/java/org/pmiops/workbench/monitoring/views/GaugeMetric.java", "diffHunk": "@@ -1,72 +1,60 @@\n package org.pmiops.workbench.monitoring.views;\n \n-import com.google.common.collect.ImmutableSet;\n+import com.google.common.collect.ImmutableList;\n import io.opencensus.stats.Aggregation;\n+import io.opencensus.stats.Aggregation.LastValue;\n import io.opencensus.stats.Measure.MeasureLong;\n-import io.opencensus.tags.TagKey;\n import java.util.Collections;\n import java.util.List;\n-import java.util.Set;\n-import org.pmiops.workbench.monitoring.attachments.Attachment;\n+import org.pmiops.workbench.monitoring.attachments.MetricLabel;\n \n public enum GaugeMetric implements Metric {\n   BILLING_BUFFER_PROJECT_COUNT(\n       \"billing_buffer_project_count\",\n       \"Number of projects in the billing buffer for each status\",\n-      ImmutableSet.of(Attachment.BUFFER_ENTRY_STATUS)),\n-  COHORT_COUNT(\"cohort_count\", \"Count of all cohorts in existence\"),\n-  COHORT_REVIEW_COUNT(\"cohort_review_count\", \"Total number of cohort reviews in existence\"),\n+      ImmutableList.of(MetricLabel.BUFFER_ENTRY_STATUS)),\n+  COHORT_COUNT(\"cohort_count_2\", \"Count of all cohorts in existence\"),\n+  COHORT_REVIEW_COUNT(\"cohort_review_count_2\", \"Total number of cohort reviews in existence\"),\n   DATASET_COUNT(\n-      \"dataset_count\",\n+      \"dataset_count_2\",\n       \"Count of all datasets in existence\",\n-      Collections.singleton(Attachment.DATASET_INVALID)),\n+      ImmutableList.of(MetricLabel.DATASET_INVALID)),\n   USER_COUNT(\n-      \"user_count\",\n+      \"user_count_2\",\n       \"total number of users\",\n-      ImmutableSet.of(\n-          Attachment.USER_BYPASSED_BETA, Attachment.USER_DISABLED, Attachment.DATA_ACCESS_LEVEL)),\n+      ImmutableList.of(\n+          MetricLabel.USER_BYPASSED_BETA,\n+          MetricLabel.USER_DISABLED,\n+          MetricLabel.DATA_ACCESS_LEVEL)),\n   WORKSPACE_COUNT(\n-      \"workspace_count\",\n+      \"workspace_count_3\",", "originalCommit": "8a8c6c85d4ba54a996f29e462bdcc0c866c4acd4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE1MjA4MA==", "url": "https://github.com/all-of-us/workbench/pull/3000#discussion_r367152080", "bodyText": "These are all going to get scrapped at least one more time, so I didn't invest in consistency or name conventions yet. I need to circulate a convention where we have a way to give versions to the metric descriptors.\nIt appears that registering (in OpenCensus) a view corresponding to an existing metric is a no-op if that metric is actually live, but the Google api fails with a \"metric exists\" error if the metric has been deleted. Still sorting this out a bit.", "author": "jaycarlton", "createdAt": "2020-01-15T22:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE0OTM3NA=="}], "type": "inlineReview", "revised_code": null}]}