{"pr_number": 4038, "pr_title": "[RW-5622][risk=no] allow for null answer concept id", "pr_createdAt": "2020-09-21T18:37:18Z", "pr_url": "https://github.com/all-of-us/workbench/pull/4038", "timeline": [{"oid": "2bcc490f83614414c1f121c998ed5b65d669881d", "url": "https://github.com/all-of-us/workbench/commit/2bcc490f83614414c1f121c998ed5b65d669881d", "message": "RW-5622 fixing survey versions", "committedDate": "2020-09-21T18:35:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4MDYyOA==", "url": "https://github.com/all-of-us/workbench/pull/4038#discussion_r492280628", "bodyText": "add a comment to explain this", "author": "jscherdin", "createdAt": "2020-09-21T19:00:51Z", "path": "api/src/main/java/org/pmiops/workbench/cdr/dao/CBCriteriaDao.java", "diffHunk": "@@ -312,7 +297,7 @@ Long findQuestionCountByDomainAndIdAndTerm(\n               + \"join cb_survey_attribute csa on csv.survey_id = csa.survey_id \"\n               + \"where csv.concept_id = :surveyConceptId \"\n               + \"and csa.question_concept_id = :questionConceptId \"\n-              + \"and csa.answer_concept_id = :answerConceptId \"\n+              + \"and (csa.answer_concept_id = :answerConceptId or :answerConceptId is null)\"", "originalCommit": "2bcc490f83614414c1f121c998ed5b65d669881d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI5ODkyOQ==", "url": "https://github.com/all-of-us/workbench/pull/4038#discussion_r492298929", "bodyText": "done.", "author": "freemabd", "createdAt": "2020-09-21T19:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4MDYyOA=="}], "type": "inlineReview", "revised_code": {"commit": "8cb1fe5fb5f8b1e4286cbcf88d11460615a5ade0", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/cdr/dao/CBCriteriaDao.java b/api/src/main/java/org/pmiops/workbench/cdr/dao/CBCriteriaDao.java\nindex 23302cf4a..565b7f472 100644\n--- a/api/src/main/java/org/pmiops/workbench/cdr/dao/CBCriteriaDao.java\n+++ b/api/src/main/java/org/pmiops/workbench/cdr/dao/CBCriteriaDao.java\n\n@@ -300,6 +300,12 @@ public interface CBCriteriaDao extends CrudRepository<DbCriteria, Long> {\n               + \"and (csa.answer_concept_id = :answerConceptId or :answerConceptId is null)\"\n               + \"order by csv.display_order) innerSql\",\n       nativeQuery = true)\n+  /**\n+   * This is ignoring null parameters using the @Query annotation. This allows us to avoid creating\n+   * additional methods just to handle null params. If the :answerConceptId parameter is null, then\n+   * the clause is always true and allows us to handle both null and non null parameters for\n+   * :answerConceptId\n+   */\n   List<DbSurveyVersion> findSurveyVersionByQuestionConceptIdAndAnswerConceptId(\n       @Param(\"surveyConceptId\") Long surveyConceptId,\n       @Param(\"questionConceptId\") Long questionConceptId,\n"}}, {"oid": "8cb1fe5fb5f8b1e4286cbcf88d11460615a5ade0", "url": "https://github.com/all-of-us/workbench/commit/8cb1fe5fb5f8b1e4286cbcf88d11460615a5ade0", "message": "RW-5622 adding comment", "committedDate": "2020-09-21T19:29:59Z", "type": "commit"}, {"oid": "62a7f5b4fc405b081a32f4e6d0816c9894cb917b", "url": "https://github.com/all-of-us/workbench/commit/62a7f5b4fc405b081a32f4e6d0816c9894cb917b", "message": "RW-5622 adding comment", "committedDate": "2020-09-21T19:30:45Z", "type": "commit"}, {"oid": "ef9f6aadfda29a1f80a1cd11cafc7f3be01da5fd", "url": "https://github.com/all-of-us/workbench/commit/ef9f6aadfda29a1f80a1cd11cafc7f3be01da5fd", "message": "RW-5622 adding comment", "committedDate": "2020-09-21T19:37:14Z", "type": "commit"}, {"oid": "c1be4f6759960f70450c51fb524f15fffcecdcb9", "url": "https://github.com/all-of-us/workbench/commit/c1be4f6759960f70450c51fb524f15fffcecdcb9", "message": "RW-5622 adding comment", "committedDate": "2020-09-21T19:38:35Z", "type": "commit"}, {"oid": "b7aeb0945c937afdf450a5b9047948f7168f1351", "url": "https://github.com/all-of-us/workbench/commit/b7aeb0945c937afdf450a5b9047948f7168f1351", "message": "RW-5622 fixing", "committedDate": "2020-09-21T20:03:30Z", "type": "commit"}, {"oid": "b6eb5dd05417be9e44630f2e773873b35101baa5", "url": "https://github.com/all-of-us/workbench/commit/b6eb5dd05417be9e44630f2e773873b35101baa5", "message": "RW-5622 fixing", "committedDate": "2020-09-21T20:34:01Z", "type": "commit"}, {"oid": "632afa10c2079c4481634eca30c4ddd0aae938f0", "url": "https://github.com/all-of-us/workbench/commit/632afa10c2079c4481634eca30c4ddd0aae938f0", "message": "RW-5622 spotless", "committedDate": "2020-09-21T20:55:29Z", "type": "commit"}]}