{"pr_number": 3392, "pr_title": "[RW-4505] [RISK=LOW]Factor out Edit Profile component", "pr_createdAt": "2020-04-14T14:12:42Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3392", "timeline": [{"oid": "4c4bd8afffeb321e75a0bbbe8b1415348f647a9e", "url": "https://github.com/all-of-us/workbench/commit/4c4bd8afffeb321e75a0bbbe8b1415348f647a9e", "message": "Profil Page", "committedDate": "2020-04-14T05:00:45Z", "type": "commit"}, {"oid": "8bccd168f356bc156e1678a3672d8d35f365ed71", "url": "https://github.com/all-of-us/workbench/commit/8bccd168f356bc156e1678a3672d8d35f365ed71", "message": "Fix test", "committedDate": "2020-04-14T15:07:51Z", "type": "commit"}, {"oid": "d10c1e04557517967741533b9d515d9efac4f761", "url": "https://github.com/all-of-us/workbench/commit/d10c1e04557517967741533b9d515d9efac4f761", "message": "Update insitutionRole only if its updated", "committedDate": "2020-04-14T16:17:45Z", "type": "commit"}, {"oid": "c21d4a89a7836dece5339872fa71a7560a8bcd60", "url": "https://github.com/all-of-us/workbench/commit/c21d4a89a7836dece5339872fa71a7560a8bcd60", "message": "Extracting styles and handling other text", "committedDate": "2020-04-14T17:44:26Z", "type": "commit"}, {"oid": "22eab0eb816ea5a312d46501ef88675be8eee238", "url": "https://github.com/all-of-us/workbench/commit/22eab0eb816ea5a312d46501ef88675be8eee238", "message": "add some comments", "committedDate": "2020-04-17T18:07:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNTU5Mg==", "url": "https://github.com/all-of-us/workbench/pull/3392#discussion_r410425592", "bodyText": "Are you using this instead of java.lang.String.isEmpty to avoid NPEs?", "author": "als364", "createdAt": "2020-04-17T19:25:29Z", "path": "api/src/main/java/org/pmiops/workbench/api/ProfileController.java", "diffHunk": "@@ -275,6 +280,45 @@ private void validateAndCleanProfile(Profile profile) throws BadRequestException\n     profile.setUsername(profile.getUsername().toLowerCase());\n   }\n \n+  private void validateUpdatedProfile(Profile updatedProfile, Profile prevProfile)\n+      throws BadRequestException {\n+    validateAndCleanProfile(updatedProfile);\n+    if (StringUtils.isEmpty(updatedProfile.getAreaOfResearch())) {\n+      throw new BadRequestException(\"Research background cannot be empty\");\n+    }\n+    Optional.ofNullable(updatedProfile.getAddress())\n+        .orElseThrow(() -> new BadRequestException(\"Address must not be empty\"));\n+\n+    Address updatedProfileAddress = updatedProfile.getAddress();\n+    if (StringUtils.isEmpty(updatedProfileAddress.getStreetAddress1())", "originalCommit": "22eab0eb816ea5a312d46501ef88675be8eee238", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5MTIyMA==", "url": "https://github.com/all-of-us/workbench/pull/3392#discussion_r412191220", "bodyText": "Yes", "author": "NehaBroad", "createdAt": "2020-04-21T13:37:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyNTU5Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMTEyMQ==", "url": "https://github.com/all-of-us/workbench/pull/3392#discussion_r410431121", "bodyText": "Since this does conflict handling, could you please indicate that in the name of the function?", "author": "als364", "createdAt": "2020-04-17T19:37:51Z", "path": "api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java", "diffHunk": "@@ -417,6 +418,41 @@ public DbUser createUser(\n     return dbUser;\n   }\n \n+  /**\n+   * Save updated dbUser object if requireInstitutionalVerification is enabled: Get the existing\n+   * dbExistingVerifiedInstitutionalAffiliation and update it with Institution role and other text\n+   *\n+   * @param dbUser\n+   * @param dbVerifiedAffiliation\n+   * @return\n+   */\n+  @Override\n+  public DbUser updateUser(", "originalCommit": "22eab0eb816ea5a312d46501ef88675be8eee238", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMzU5MA==", "url": "https://github.com/all-of-us/workbench/pull/3392#discussion_r410433590", "bodyText": "Or, better, could you also call saveUserWithConflictHandling in this function?", "author": "als364", "createdAt": "2020-04-17T19:43:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMTEyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5NTQ1OQ==", "url": "https://github.com/all-of-us/workbench/pull/3392#discussion_r412195459", "bodyText": "Will change it to updateUserWithConflictHandling since i do want the name to specify that we are updating user and its related table (like verified institution in this case)", "author": "NehaBroad", "createdAt": "2020-04-21T13:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzMTEyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "482cefbd173c97a1d51b7387f9aa9834f6ef48d2", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java b/api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java\nindex 6b0346313..03dda6066 100644\n--- a/api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java\n+++ b/api/src/main/java/org/pmiops/workbench/db/dao/UserServiceImpl.java\n\n@@ -427,7 +427,7 @@ public class UserServiceImpl implements UserService, GaugeDataCollector {\n    * @return\n    */\n   @Override\n-  public DbUser updateUser(\n+  public DbUser updateUserWithConflictHandling(\n       DbUser dbUser, DbVerifiedInstitutionalAffiliation dbVerifiedAffiliation) {\n     try {\n       dbUser = userDao.save(dbUser);\n"}}, {"oid": "482cefbd173c97a1d51b7387f9aa9834f6ef48d2", "url": "https://github.com/all-of-us/workbench/commit/482cefbd173c97a1d51b7387f9aa9834f6ef48d2", "message": "PR Comments", "committedDate": "2020-04-21T16:19:23Z", "type": "commit"}, {"oid": "aedf01e54046b516d30d2f259f368813af6ae7a9", "url": "https://github.com/all-of-us/workbench/commit/aedf01e54046b516d30d2f259f368813af6ae7a9", "message": "resolve merge conflict", "committedDate": "2020-04-21T16:35:17Z", "type": "commit"}, {"oid": "d7c7aebf8368abb6a5931beb2f5b557a5431ed9c", "url": "https://github.com/all-of-us/workbench/commit/d7c7aebf8368abb6a5931beb2f5b557a5431ed9c", "message": "Use string | React.ReactNode rather than any", "committedDate": "2020-04-21T16:43:48Z", "type": "commit"}, {"oid": "bebee5e3ef49492b8f3b9c9705629eaded4e2e11", "url": "https://github.com/all-of-us/workbench/commit/bebee5e3ef49492b8f3b9c9705629eaded4e2e11", "message": "spotless", "committedDate": "2020-04-21T17:07:37Z", "type": "commit"}, {"oid": "ecfb886a729200892312eb35a7045e18208589e8", "url": "https://github.com/all-of-us/workbench/commit/ecfb886a729200892312eb35a7045e18208589e8", "message": "Pr comments : Correct case", "committedDate": "2020-04-27T16:23:05Z", "type": "commit"}, {"oid": "ff461eda66c325eed4e765febb855705a44f7140", "url": "https://github.com/all-of-us/workbench/commit/ff461eda66c325eed4e765febb855705a44f7140", "message": "Resolve conflict", "committedDate": "2020-04-27T17:29:39Z", "type": "commit"}, {"oid": "22650782aad8ca02894481d910e671a6458de6e8", "url": "https://github.com/all-of-us/workbench/commit/22650782aad8ca02894481d910e671a6458de6e8", "message": "Remove duplicate update demographic link", "committedDate": "2020-04-27T19:28:45Z", "type": "commit"}]}