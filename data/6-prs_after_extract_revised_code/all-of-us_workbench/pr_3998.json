{"pr_number": 3998, "pr_title": "[RW-4591][risk=no]API: add the new column for parent & children", "pr_createdAt": "2020-09-14T16:56:44Z", "pr_url": "https://github.com/all-of-us/workbench/pull/3998", "timeline": [{"oid": "c39e6452d0b47540ccf81b91320fc659b1496697", "url": "https://github.com/all-of-us/workbench/commit/c39e6452d0b47540ccf81b91320fc659b1496697", "message": "Add Parent and child count", "committedDate": "2020-09-14T16:50:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIwODkzNg==", "url": "https://github.com/all-of-us/workbench/pull/3998#discussion_r488208936", "bodyText": "We could change these to be Long instead of String to match the database. I think we changed  count from String to Long in the db somewhere along the way and we didn't update it here.", "author": "freemabd", "createdAt": "2020-09-14T20:44:40Z", "path": "api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java", "diffHunk": "@@ -24,6 +24,8 @@\n   private boolean group;\n   private boolean selectable;\n   private String count;\n+  private String parentCount;\n+  private String childCount;", "originalCommit": "c39e6452d0b47540ccf81b91320fc659b1496697", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13c035b3ed42d5bf0ab0a3fe4f14730ce1227221", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java b/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\nindex 03a74a9d1..a8227fa90 100644\n--- a/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\n+++ b/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\n\n@@ -24,8 +24,8 @@ public class DbCriteria {\n   private boolean group;\n   private boolean selectable;\n   private String count;\n-  private String parentCount;\n-  private String childCount;\n+  private Long parentCount;\n+  private Long childCount;\n   private String conceptId;\n   private String domainId;\n   private boolean attribute;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODIwOTYzNw==", "url": "https://github.com/all-of-us/workbench/pull/3998#discussion_r488209637", "bodyText": "If we change those we would no longer need these Transient properties for count, rollup count and item count.", "author": "freemabd", "createdAt": "2020-09-14T20:45:55Z", "path": "api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java", "diffHunk": "@@ -119,7 +121,39 @@ public void setCount(String count) {\n \n   @Transient\n   public Long getLongCount() {\n-    return Strings.isNullOrEmpty(this.count) ? null : Long.valueOf(this.count);\n+    return getLongValue(this.count);", "originalCommit": "c39e6452d0b47540ccf81b91320fc659b1496697", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13c035b3ed42d5bf0ab0a3fe4f14730ce1227221", "chunk": "diff --git a/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java b/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\nindex 03a74a9d1..a8227fa90 100644\n--- a/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\n+++ b/api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java\n\n@@ -129,33 +129,23 @@ public class DbCriteria {\n   }\n \n   @Column(name = \"rollup_count\")\n-  public String getParentCount() {\n-    return parentCount;\n+  public Long getParentCount() {\n+    return this.parentCount == null ? 0 : this.parentCount;\n   }\n \n-  public void setParentCount(String parentCount) {\n+  public void setParentCount(Long parentCount) {\n     this.parentCount = parentCount;\n   }\n \n-  @Transient\n-  public Long getLongParentCount() {\n-    return getLongValue(this.parentCount);\n-  }\n-\n   @Column(name = \"item_count\")\n-  public String getChildCount() {\n-    return childCount;\n+  public Long getChildCount() {\n+    return this.childCount == null ? 0 : this.childCount;\n   }\n \n-  public void setChildCount(String childCount) {\n+  public void setChildCount(Long childCount) {\n     this.childCount = childCount;\n   }\n \n-  @Transient\n-  public Long getLongChildCount() {\n-    return getLongValue(this.childCount);\n-  }\n-\n   @Column(name = \"concept_id\")\n   public String getConceptId() {\n     return conceptId;\n"}}, {"oid": "13c035b3ed42d5bf0ab0a3fe4f14730ce1227221", "url": "https://github.com/all-of-us/workbench/commit/13c035b3ed42d5bf0ab0a3fe4f14730ce1227221", "message": "Parent and Child Count Long in DBCriteria", "committedDate": "2020-09-14T23:33:59Z", "type": "commit"}, {"oid": "fc046574f04b65da4e49785e30995378081bd3c7", "url": "https://github.com/all-of-us/workbench/commit/fc046574f04b65da4e49785e30995378081bd3c7", "message": "Reverting getlong function", "committedDate": "2020-09-15T00:27:26Z", "type": "commit"}, {"oid": "9d97d5186b60badc95a9b5dc21ab7f77dd263182", "url": "https://github.com/all-of-us/workbench/commit/9d97d5186b60badc95a9b5dc21ab7f77dd263182", "message": "Fix test", "committedDate": "2020-09-15T00:32:45Z", "type": "commit"}, {"oid": "dac04b2493fbf1236ab6e6b1aebb4fca2608ff0e", "url": "https://github.com/all-of-us/workbench/commit/dac04b2493fbf1236ab6e6b1aebb4fca2608ff0e", "message": "Change count type from string to Long DbCriteria", "committedDate": "2020-09-15T00:49:35Z", "type": "commit"}, {"oid": "5b609aed6161471f7ab10f26f17939fc21e43f9f", "url": "https://github.com/all-of-us/workbench/commit/5b609aed6161471f7ab10f26f17939fc21e43f9f", "message": "Big Query Test", "committedDate": "2020-09-15T13:13:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY5NDA2Mw==", "url": "https://github.com/all-of-us/workbench/pull/3998#discussion_r488694063", "bodyText": "You need to add parentCount and childCount to the equals() and hashCode() methods", "author": "freemabd", "createdAt": "2020-09-15T14:03:32Z", "path": "api/src/main/java/org/pmiops/workbench/cdr/model/DbCriteria.java", "diffHunk": "@@ -109,17 +111,30 @@ public void setSelectable(boolean selectable) {\n   }\n \n   @Column(name = \"est_count\")\n-  public String getCount() {\n-    return count;\n+  public Long getCount() {\n+    return this.count == null ? 0 : this.count;\n   }\n \n-  public void setCount(String count) {\n+  public void setCount(Long count) {\n     this.count = count;\n   }\n \n-  @Transient\n-  public Long getLongCount() {\n-    return Strings.isNullOrEmpty(this.count) ? null : Long.valueOf(this.count);\n+  @Column(name = \"rollup_count\")", "originalCommit": "5b609aed6161471f7ab10f26f17939fc21e43f9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcwODg5OA==", "url": "https://github.com/all-of-us/workbench/pull/3998#discussion_r488708898", "bodyText": "Done", "author": "NehaBroad", "createdAt": "2020-09-15T14:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODY5NDA2Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e89b1a64b5192150b682c9f1dba4df4f3e557453", "url": "https://github.com/all-of-us/workbench/commit/e89b1a64b5192150b682c9f1dba4df4f3e557453", "message": "Add parent and child count to Equal and Hash method", "committedDate": "2020-09-15T14:12:38Z", "type": "commit"}]}