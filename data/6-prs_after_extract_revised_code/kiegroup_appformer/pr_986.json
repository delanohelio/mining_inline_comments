{"pr_number": 986, "pr_title": "DROOLS-5384: Clicking rightmost column's header in DMN decision table raises an error", "pr_createdAt": "2020-06-10T14:43:01Z", "pr_url": "https://github.com/kiegroup/appformer/pull/986", "timeline": [{"oid": "5c6368762dff5dc614723268934b9234c3eb2abf", "url": "https://github.com/kiegroup/appformer/commit/5c6368762dff5dc614723268934b9234c3eb2abf", "message": "DROOLS-5384: Clicking rightmost column's header in DMN decision table raises an error", "committedDate": "2020-06-10T14:41:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r438179788", "bodyText": "I am curious when this should occur?\nHow is it possible for candidateHeaderColumnIndex to exceed the number of columns?", "author": "manstis", "createdAt": "2020-06-10T14:44:53Z", "path": "uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/ColumnIndexUtilities.java", "diffHunk": "@@ -81,6 +81,9 @@ public static int getHeaderBlockEndColumnIndex(final List<GridColumn<?>> allColu\n         if (candidateHeaderColumnIndex == allColumns.size() - 1) {\n             return candidateHeaderColumnIndex;\n         }\n+        if (candidateHeaderColumnIndex >= allColumns.size()) {", "originalCommit": "5c6368762dff5dc614723268934b9234c3eb2abf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU0Nzc4Nw==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r438547787", "bodyText": "Yes, could you please explain a little bit. Just we are sure we do not cause index out of bounds exception somewhere else.", "author": "jomarko", "createdAt": "2020-06-11T05:18:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI3NTU2MA==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r450275560", "bodyText": "When you double-click the last cell in a header and the first cell is hidden (scrolled).\nThis didn't happened before because the last header cell was not \"clickable\" when we had the \"Description\" column.", "author": "danielzhe", "createdAt": "2020-07-06T14:50:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY4NzAwNw==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r450687007", "bodyText": "So the issue is that the headerColumnIndex is wrong?\nWhere is the getHeaderBlockEndColumnIndex(..) method called from? How was the parameter value derived?", "author": "manstis", "createdAt": "2020-07-07T08:14:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1MjI4NA==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r451152284", "bodyText": "Is called here: \n  \n    \n      appformer/uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/CellContextUtilities.java\n    \n    \n         Line 98\n      in\n      331f358\n    \n    \n    \n    \n\n        \n          \n           final int blockEndColumnIndex = ColumnIndexUtilities.getHeaderBlockEndColumnIndex(gridColumns, \n        \n    \n  \n\n\nIn my opinion this fix is correct, because ColumnIndexUtilities already \"fixes\" the candidateHeaderColumnIndex to a valid value in other situations.", "author": "danielzhe", "createdAt": "2020-07-07T21:24:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUxMTIyOQ==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r451511229", "bodyText": "I'm not convinced it is the correct fix; however I was unable to debug in GWT (wozza, is it just me or has GWT development taken a performance turn for the worse recently!?!?!?) I still believe candidateHeaderColumnIndex should not exceed the number of columns in the grid. However this PR fixes the issue and therefore so as not to stand in the way of progress I'll approve....", "author": "manstis", "createdAt": "2020-07-08T12:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyNTA2MQ==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r451525061", "bodyText": "For me the performance is the same. :D\nI still think the fix is the correct, because if you trace back the candidateHeaderColumnIndex comes from ci.getUiColumnIndex(). I think the uiColumnIndex() is right and the logic is good since ColumnIndexUtilities.getHeaderBlockEndColumnIndex() in my understands have the job of get the logical end block column index for that specific UI column.", "author": "danielzhe", "createdAt": "2020-07-08T13:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTUyNzA5NQ==", "url": "https://github.com/kiegroup/appformer/pull/986#discussion_r451527095", "bodyText": "Sure, but ci.getUiColumnIndex() should NEVER be greater than the gridModel.getColumns().size() - 1 otherwise something has gone wrong somewhere else...", "author": "manstis", "createdAt": "2020-07-08T13:03:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3OTc4OA=="}], "type": "inlineReview", "revised_code": {"commit": "6c897de38268c3b71380e216c16915ad128cfdc3", "chunk": "diff --git a/uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/ColumnIndexUtilities.java b/uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/ColumnIndexUtilities.java\nindex f0d502c05..cbcdfecf1 100644\n--- a/uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/ColumnIndexUtilities.java\n+++ b/uberfire-extensions/uberfire-wires/uberfire-wires-core/uberfire-wires-core-grids/src/main/java/org/uberfire/ext/wires/core/grids/client/util/ColumnIndexUtilities.java\n\n@@ -78,11 +78,8 @@ public class ColumnIndexUtilities {\n                                                    final int headerColumnIndex) {\n         //Forward-track adding width of following columns sharing header MetaData\n         int candidateHeaderColumnIndex = headerColumnIndex;\n-        if (candidateHeaderColumnIndex == allColumns.size() - 1) {\n-            return candidateHeaderColumnIndex;\n-        }\n-        if (candidateHeaderColumnIndex >= allColumns.size()) {\n-            return candidateHeaderColumnIndex - 1;\n+        if (candidateHeaderColumnIndex >= allColumns.size() - 1) {\n+            return allColumns.size() - 1;\n         }\n         while (candidateHeaderColumnIndex < allColumns.size() - 1) {\n             final GridColumn candidateColumn = allColumns.get(candidateHeaderColumnIndex + 1);\n"}}, {"oid": "6c897de38268c3b71380e216c16915ad128cfdc3", "url": "https://github.com/kiegroup/appformer/commit/6c897de38268c3b71380e216c16915ad128cfdc3", "message": "DROOLS-5384: Cover all indexes above columns count", "committedDate": "2020-07-07T07:01:21Z", "type": "commit"}, {"oid": "465aeef790d1823a03f51140ab889c91fa6a3397", "url": "https://github.com/kiegroup/appformer/commit/465aeef790d1823a03f51140ab889c91fa6a3397", "message": "Merge pull request #1 from jomarko/PR-DROOLS-5384-original\n\nDROOLS-5384: Cover all indexes above columns count", "committedDate": "2020-07-07T21:25:47Z", "type": "commit"}]}