{"pr_number": 6251, "pr_title": "#4048 Only showing 'Create From' action for drafted Payment Selection documents.", "pr_createdAt": "2020-02-24T13:52:39Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6251", "timeline": [{"oid": "a19e9cb61094700344dbc826d04f1f35017abc4b", "url": "https://github.com/metasfresh/metasfresh/commit/a19e9cb61094700344dbc826d04f1f35017abc4b", "message": "#4048 Only showing 'Create From' action for drafted Payment Selection documents.", "committedDate": "2020-02-24T13:51:42Z", "type": "commit"}, {"oid": "522471fd3236507ef8914d62b2dce315e334fa70", "url": "https://github.com/metasfresh/metasfresh/commit/522471fd3236507ef8914d62b2dce315e334fa70", "message": "#4048 Removed unused import.", "committedDate": "2020-02-24T14:07:13Z", "type": "commit"}, {"oid": "2e68bbb57c84acbfbf58d67898421c72f8816a04", "url": "https://github.com/metasfresh/metasfresh/commit/2e68bbb57c84acbfbf58d67898421c72f8816a04", "message": "#4048 Removed unused variable.", "committedDate": "2020-02-24T14:07:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI4NDg5OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6251#discussion_r383284898", "bodyText": "not 100% sure, but i think this won't work if you reactivate a pay selection. because then it is in \"in progress\".\nSo,\n\nso, use DocStatus.isDraftedOrInProgress()\nalso make sure to avoid NPEs. I.e. use ofNullableCode\nnote: i guess that assuming the C_PaySelection record itself exists is OK", "author": "metas-ts", "createdAt": "2020-02-24T14:10:00Z", "path": "de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java", "diffHunk": "@@ -104,6 +111,22 @@ else if (name.equals(\"C_BP_Group_ID\"))\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic ProcessPreconditionsResolution checkPreconditionsApplicable(final @NonNull IProcessPreconditionsContext context)\n+\t{\n+\t\tfinal IPaySelectionDAO paySelectionDAO = Services.get(IPaySelectionDAO.class);\n+\t\tfinal IPaymentDAO paymentDAO = Services.get(IPaymentDAO.class);\n+\n+\t\tfinal I_C_PaySelection paySelection = paySelectionDAO.retrievePaySelectionById(context.getSingleSelectedRecordId());\n+\n+\t\tif (paySelection.getDocStatus().equals(DocStatus.Drafted.getCode()))", "originalCommit": "a19e9cb61094700344dbc826d04f1f35017abc4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzM1NTUxMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6251#discussion_r383355510", "bodyText": "Yes, it's not working if gets reactivated.", "author": "dragospodariu96", "createdAt": "2020-02-24T16:03:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI4NDg5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk3OTE2OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6251#discussion_r383979169", "bodyText": "agree with Tobi. It shall be as Tobi suggested", "author": "teosarca", "createdAt": "2020-02-25T16:08:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzI4NDg5OA=="}], "type": "inlineReview", "revised_code": {"commit": "c524ad0584c83e3b5e45e778abd76f333a1e781b", "chunk": "diff --git a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java\nindex 6048e96a09..824f5001ee 100644\n--- a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java\n+++ b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java\n\n@@ -115,7 +113,6 @@ public class C_PaySelection_CreateFrom extends JavaProcess implements IProcessPr\n \tpublic ProcessPreconditionsResolution checkPreconditionsApplicable(final @NonNull IProcessPreconditionsContext context)\n \t{\n \t\tfinal IPaySelectionDAO paySelectionDAO = Services.get(IPaySelectionDAO.class);\n-\t\tfinal IPaymentDAO paymentDAO = Services.get(IPaymentDAO.class);\n \n \t\tfinal I_C_PaySelection paySelection = paySelectionDAO.retrievePaySelectionById(context.getSingleSelectedRecordId());\n \n"}}, {"oid": "c524ad0584c83e3b5e45e778abd76f333a1e781b", "url": "https://github.com/metasfresh/metasfresh/commit/c524ad0584c83e3b5e45e778abd76f333a1e781b", "message": "Merge branch 'master' into gh4048", "committedDate": "2020-02-25T23:35:14Z", "type": "commit"}, {"oid": "56f52f761dc335c0a93ac57f9719bd54906dc50b", "url": "https://github.com/metasfresh/metasfresh/commit/56f52f761dc335c0a93ac57f9719bd54906dc50b", "message": "#4048 Now showing 'Create From' Action if document is reactivated.", "committedDate": "2020-02-25T23:36:18Z", "type": "commit"}, {"oid": "b6a059b71c1ce0c85a6f49bac3b7e4043f9e0c5f", "url": "https://github.com/metasfresh/metasfresh/commit/b6a059b71c1ce0c85a6f49bac3b7e4043f9e0c5f", "message": "Merge branch 'master' into gh4048", "committedDate": "2020-02-26T12:19:09Z", "type": "commit"}, {"oid": "0cff69a05406eda8e156d0c6f1b3fc7177ca7412", "url": "https://github.com/metasfresh/metasfresh/commit/0cff69a05406eda8e156d0c6f1b3fc7177ca7412", "message": "QA", "committedDate": "2020-02-26T12:22:17Z", "type": "commit"}]}