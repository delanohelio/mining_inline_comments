{"pr_number": 10048, "pr_title": "#10045 Packing instructions are no longer displayed when ordering ", "pr_createdAt": "2020-10-01T10:21:34Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/10048", "timeline": [{"oid": "1ac333a6ec5df5e4a5f45debbc1f62bd84cb4627", "url": "https://github.com/metasfresh/metasfresh/commit/1ac333a6ec5df5e4a5f45debbc1f62bd84cb4627", "message": "#10045 Add sys config", "committedDate": "2020-10-01T09:24:18Z", "type": "commit"}, {"oid": "d5caa97b8bc603cf322581ba734635a5ba9f47ae", "url": "https://github.com/metasfresh/metasfresh/commit/d5caa97b8bc603cf322581ba734635a5ba9f47ae", "message": "#10045 Use sys config for skipping enforcing M_HU_PI_Item_Product_ID in product price", "committedDate": "2020-10-01T10:20:47Z", "type": "commit"}, {"oid": "0bfbba646e9381c75eaddb0f483be4653fa056bc", "url": "https://github.com/metasfresh/metasfresh/commit/0bfbba646e9381c75eaddb0f483be4653fa056bc", "message": "#10045 Correct the name of sys config", "committedDate": "2020-10-01T10:38:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI3NjQzNw==", "url": "https://github.com/metasfresh/metasfresh/pull/10048#discussion_r498276437", "bodyText": "move this sysconfig to de.metas.ui.web.quickinput.field.PackingItemProductFieldHelper and call it de.metas.ui.web.quickinput.field.PackingItemProductFieldHelper.EnforcePrecisePricePerHUItemProduct.", "author": "teosarca", "createdAt": "2020-10-01T14:12:59Z", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "diffHunk": "@@ -75,6 +76,9 @@\n \n public class HUPIItemProductDAO implements IHUPIItemProductDAO\n {\n+\tprivate static final ISysConfigBL sysConfigBL = Services.get(ISysConfigBL.class);\n+\tprivate static final String SYSCONFIG_Enforce_M_HU_PI_Item_Product_ID = \"de.metas.handlingunits.impl.HUPIItemProductDAO.Enforce_M_HU_PI_Item_Product_ID\";", "originalCommit": "0bfbba646e9381c75eaddb0f483be4653fa056bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0013941cbd2bd633dbb5084e7c7756756706ae5c", "chunk": "diff --git a/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java b/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\nindex d6be036b4d..d3490c60c8 100644\n--- a/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\n+++ b/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\n\n@@ -43,42 +74,9 @@ import de.metas.util.Check;\n import de.metas.util.Services;\n import de.metas.util.time.SystemTime;\n import lombok.NonNull;\n-import org.adempiere.ad.dao.ICompositeQueryFilter;\n-import org.adempiere.ad.dao.IQueryBL;\n-import org.adempiere.ad.dao.IQueryBuilder;\n-import org.adempiere.ad.dao.IQueryFilter;\n-import org.adempiere.ad.dao.IQueryOrderBy.Direction;\n-import org.adempiere.ad.dao.IQueryOrderBy.Nulls;\n-import org.adempiere.ad.dao.IQueryOrderByBuilder;\n-import org.adempiere.ad.dao.impl.CompareQueryFilter.Operator;\n-import org.adempiere.ad.dao.impl.EqualsQueryFilter;\n-import org.adempiere.ad.trx.api.ITrx;\n-import org.adempiere.model.InterfaceWrapperHelper;\n-import org.adempiere.service.IClientDAO;\n-import org.adempiere.service.ISysConfigBL;\n-import org.adempiere.util.proxy.Cached;\n-import org.compiere.model.IQuery;\n-import org.compiere.model.I_M_PriceList_Version;\n-import org.compiere.model.I_M_Product;\n-import org.compiere.util.Env;\n-\n-import javax.annotation.Nullable;\n-import java.math.BigDecimal;\n-import java.time.ZonedDateTime;\n-import java.util.ArrayList;\n-import java.util.Collection;\n-import java.util.Iterator;\n-import java.util.List;\n-import java.util.Optional;\n-import java.util.Properties;\n-\n-import static org.adempiere.model.InterfaceWrapperHelper.loadOutOfTrx;\n \n public class HUPIItemProductDAO implements IHUPIItemProductDAO\n {\n-\tprivate static final ISysConfigBL sysConfigBL = Services.get(ISysConfigBL.class);\n-\tprivate static final String SYSCONFIG_Enforce_M_HU_PI_Item_Product_ID = \"de.metas.handlingunits.impl.HUPIItemProductDAO.Enforce_M_HU_PI_Item_Product_ID\";\n-\n \t@Override\n \tpublic I_M_HU_PI_Item_Product getById(@NonNull final HUPIItemProductId id)\n \t{\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI3NzI4OA==", "url": "https://github.com/metasfresh/metasfresh/pull/10048#discussion_r498277288", "bodyText": "do this checking in de.metas.ui.web.quickinput.field.PackingItemProductFieldHelper and decide there if u set queryVO's priceListVersionId.", "author": "teosarca", "createdAt": "2020-10-01T14:14:01Z", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "diffHunk": "@@ -291,10 +295,12 @@ public I_M_HU_PI_Item_Product retrieveMaterialItemProduct(\n \t\t\t}\n \t\t}\n \n+\t\tfinal boolean enforceHU_PI_Item_Product = sysConfigBL.getBooleanValue(SYSCONFIG_Enforce_M_HU_PI_Item_Product_ID, false);\n+\t\t\n \t\t//\n \t\t// Product Price of a Price List Version has this Packing Item\n \t\t{\n-\t\t\tif (queryVO.getPriceListVersionId() != null)\n+\t\t\tif (enforceHU_PI_Item_Product && queryVO.getPriceListVersionId() != null)", "originalCommit": "0bfbba646e9381c75eaddb0f483be4653fa056bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0013941cbd2bd633dbb5084e7c7756756706ae5c", "chunk": "diff --git a/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java b/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\nindex d6be036b4d..d3490c60c8 100644\n--- a/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\n+++ b/backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java\n\n@@ -295,12 +293,10 @@ public class HUPIItemProductDAO implements IHUPIItemProductDAO\n \t\t\t}\n \t\t}\n \n-\t\tfinal boolean enforceHU_PI_Item_Product = sysConfigBL.getBooleanValue(SYSCONFIG_Enforce_M_HU_PI_Item_Product_ID, false);\n-\t\t\n \t\t//\n \t\t// Product Price of a Price List Version has this Packing Item\n \t\t{\n-\t\t\tif (enforceHU_PI_Item_Product && queryVO.getPriceListVersionId() != null)\n+\t\t\tif (queryVO.getPriceListVersionId() != null)\n \t\t\t{\n \t\t\t\tfinal IQueryFilter<I_M_PriceList_Version> plvFilter = queryBL.createCompositeQueryFilter(I_M_PriceList_Version.class)\n \t\t\t\t\t\t.addOnlyActiveRecordsFilter()\n"}}, {"oid": "0013941cbd2bd633dbb5084e7c7756756706ae5c", "url": "https://github.com/metasfresh/metasfresh/commit/0013941cbd2bd633dbb5084e7c7756756706ae5c", "message": "#10045 Rename sys config", "committedDate": "2020-10-01T14:54:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMxNDE3Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/10048#discussion_r498314173", "bodyText": "not sure this will work with Client level sysconfigs....", "author": "teosarca", "createdAt": "2020-10-01T15:01:57Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/field/PackingItemProductFieldHelper.java", "diffHunk": "@@ -88,6 +92,8 @@\n \t\t\treturn Optional.empty();\n \t\t}\n \n+\t\tfinal boolean enforcePrecisePricePerHUItemProduct = sysConfigBL.getBooleanValue(SYSCONFIG_EnforcePrecisePricePerHUItemProduct, false);", "originalCommit": "0013941cbd2bd633dbb5084e7c7756756706ae5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDA3NDQ3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/10048#discussion_r500074476", "bodyText": "Agree. Tested and fixed it! Thx!", "author": "cristinamghita", "createdAt": "2020-10-06T07:52:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODMxNDE3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "2037032df4b95767dc514ad05c7406538062d4a6", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/field/PackingItemProductFieldHelper.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/field/PackingItemProductFieldHelper.java\nindex 0c992c294c..afbe917b0e 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/field/PackingItemProductFieldHelper.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/field/PackingItemProductFieldHelper.java\n\n@@ -92,7 +92,7 @@ public class PackingItemProductFieldHelper\n \t\t\treturn Optional.empty();\n \t\t}\n \n-\t\tfinal boolean enforcePrecisePricePerHUItemProduct = sysConfigBL.getBooleanValue(SYSCONFIG_EnforcePrecisePricePerHUItemProduct, false);\n+\t\tfinal boolean enforcePrecisePricePerHUItemProduct = sysConfigBL.getBooleanValue(SYSCONFIG_EnforcePrecisePricePerHUItemProduct, false, Env.getAD_Client_ID());\n \t\t\n \t\t// TODO: check ASI too\n \t\tfinal IHUPIItemProductDAO piItemProductDAO = Services.get(IHUPIItemProductDAO.class);\n"}}, {"oid": "2037032df4b95767dc514ad05c7406538062d4a6", "url": "https://github.com/metasfresh/metasfresh/commit/2037032df4b95767dc514ad05c7406538062d4a6", "message": "#10045 Add clientId as parameter", "committedDate": "2020-10-06T07:51:58Z", "type": "commit"}, {"oid": "d9035688bf4e2339444004e0b6bffd9b90e8bcd8", "url": "https://github.com/metasfresh/metasfresh/commit/d9035688bf4e2339444004e0b6bffd9b90e8bcd8", "message": "#10045 Introduce ClientId to DefaultPackingItemCriteria", "committedDate": "2020-10-06T08:54:03Z", "type": "commit"}, {"oid": "e9ca6e457c0d76bcc8818bce04c4c52d88954b6b", "url": "https://github.com/metasfresh/metasfresh/commit/e9ca6e457c0d76bcc8818bce04c4c52d88954b6b", "message": "#10045 Make sure we set ClientId all over", "committedDate": "2020-10-06T09:15:53Z", "type": "commit"}]}