{"pr_number": 10319, "pr_title": "#10318 Use last archive when no other info for creating the report", "pr_createdAt": "2020-11-26T20:53:36Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/10319", "timeline": [{"oid": "84e5f140f34a55527e3b94f05661237b78fcb09e", "url": "https://github.com/metasfresh/metasfresh/commit/84e5f140f34a55527e3b94f05661237b78fcb09e", "message": "#10318 Use last archive when no other info for creating the report\n\nhttps://github.com/metasfresh/metasfresh/issues/10318", "committedDate": "2020-11-26T20:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNjI1OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10319#discussion_r531436259", "bodyText": "lastArchiveResult  is nullable, so u shall check if is null", "author": "teosarca", "createdAt": "2020-11-27T08:02:41Z", "path": "backend/de.metas.document.archive/de.metas.document.archive.base/src/main/java/de/metas/document/archive/spi/impl/DefaultModelArchiver.java", "diffHunk": "@@ -128,22 +131,18 @@ public ArchiveResult archive()\n \t\t\t\t\t\t//\n \t\t\t\t\t\t.build());\n \n-\t\tfinal boolean wasReturnedFromArchive = false; // TODO: impl\n+\t\tfinal ArchiveResult lastArchiveResult = report.getLastArchiveResult();\n+\n \t\tfinal ArchiveResult archiveResult;\n-\t\tif (!wasReturnedFromArchive)\n+\n+\t\tif (lastArchiveResult.isNoArchive())", "originalCommit": "84e5f140f34a55527e3b94f05661237b78fcb09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d810874e9dc89a92b6e84829798a120e8820bcfc", "chunk": "diff --git a/backend/de.metas.document.archive/de.metas.document.archive.base/src/main/java/de/metas/document/archive/spi/impl/DefaultModelArchiver.java b/backend/de.metas.document.archive/de.metas.document.archive.base/src/main/java/de/metas/document/archive/spi/impl/DefaultModelArchiver.java\nindex 1c7bed0a25..7610876416 100644\n--- a/backend/de.metas.document.archive/de.metas.document.archive.base/src/main/java/de/metas/document/archive/spi/impl/DefaultModelArchiver.java\n+++ b/backend/de.metas.document.archive/de.metas.document.archive.base/src/main/java/de/metas/document/archive/spi/impl/DefaultModelArchiver.java\n\n@@ -131,18 +131,17 @@ public class DefaultModelArchiver\n \t\t\t\t\t\t//\n \t\t\t\t\t\t.build());\n \n-\t\tfinal ArchiveResult lastArchiveResult = report.getLastArchiveResult();\n+\t\tfinal ArchiveResult lastArchive = report.getLastArchive();\n \n \t\tfinal ArchiveResult archiveResult;\n \n-\t\tif (lastArchiveResult.isNoArchive())\n+\t\tif (lastArchive == null || lastArchive.isNoArchive())\n \t\t{\n \t\t\tarchiveResult = createArchive(report);\n-\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tarchiveResult = lastArchiveResult;\n+\t\t\tarchiveResult = lastArchive;\n \t\t}\n \n \t\t//\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNjY1OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10319#discussion_r531436659", "bodyText": "limit the scope, move it down, where it is initialized", "author": "teosarca", "createdAt": "2020-11-27T08:03:44Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportService.java", "diffHunk": "@@ -122,6 +128,8 @@ public DocumentReportResult createReport(@NonNull final DocumentReportRequest re\n \t\tfinal StandardDocumentReportType standardDocumentReportType = computeStandardDocumentReportTypeOrNull(request);\n \n \t\t//\n+\t\tArchiveResult lastArchiveResult = ArchiveResult.EMPTY;", "originalCommit": "84e5f140f34a55527e3b94f05661237b78fcb09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d810874e9dc89a92b6e84829798a120e8820bcfc", "chunk": "diff --git a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportService.java b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportService.java\nindex ab7b9f5bd2..1f0d089999 100644\n--- a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportService.java\n+++ b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportService.java\n\n@@ -127,9 +127,6 @@ public class DocumentReportService\n \t{\n \t\tfinal StandardDocumentReportType standardDocumentReportType = computeStandardDocumentReportTypeOrNull(request);\n \n-\t\t//\n-\t\tArchiveResult lastArchiveResult = ArchiveResult.EMPTY;\n-\n \t\tfinal DocumentReportAdvisor advisor;\n \t\tDocumentReportRequest requestEffective = request;\n \t\tif (standardDocumentReportType != null)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQzNzE2MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10319#discussion_r531437161", "bodyText": "minor: rename it to lastArchive", "author": "teosarca", "createdAt": "2020-11-27T08:04:52Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportResult.java", "diffHunk": "@@ -63,6 +65,9 @@\n \t@NonNull\n \t@Builder.Default\n \tPrintCopies copies = PrintCopies.ONE;\n+\t\n+\t@Nullable\n+\tArchiveResult lastArchiveResult;", "originalCommit": "84e5f140f34a55527e3b94f05661237b78fcb09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d810874e9dc89a92b6e84829798a120e8820bcfc", "chunk": "diff --git a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportResult.java b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportResult.java\nindex 4c8b1f9fea..c30ecca8a8 100644\n--- a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportResult.java\n+++ b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/report/DocumentReportResult.java\n\n@@ -67,7 +67,7 @@ public class DocumentReportResult\n \tPrintCopies copies = PrintCopies.ONE;\n \t\n \t@Nullable\n-\tArchiveResult lastArchiveResult;\n+\tArchiveResult lastArchive;\n \n \t@Nullable\n \tpublic String getFilename()\n"}}, {"oid": "d810874e9dc89a92b6e84829798a120e8820bcfc", "url": "https://github.com/metasfresh/metasfresh/commit/d810874e9dc89a92b6e84829798a120e8820bcfc", "message": "#10318 refactoring, nullcheck\n\nhttps://github.com/metasfresh/metasfresh/issues/10318", "committedDate": "2020-11-27T08:20:39Z", "type": "commit"}]}