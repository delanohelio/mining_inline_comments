{"pr_number": 6512, "pr_title": "Add Swing \"Chat\" Feature to WebUI", "pr_createdAt": "2020-04-22T11:04:20Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6512", "timeline": [{"oid": "09f7936e990134f8ca3acb909aaa048e05682a20", "url": "https://github.com/metasfresh/metasfresh/commit/09f7936e990134f8ca3acb909aaa048e05682a20", "message": "Update references to TableRecordReference; fix warnings\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-22T11:47:44Z", "type": "forcePushed"}, {"oid": "1dbd856657f4c6bd2579e78a2c009ca4b54cd8cc", "url": "https://github.com/metasfresh/metasfresh/commit/1dbd856657f4c6bd2579e78a2c009ca4b54cd8cc", "message": "Cleanup + Regenerate `CM_Chat*` records\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:07Z", "type": "commit"}, {"oid": "aecb402eb04d32f5cdc9acb2189b526723b60466", "url": "https://github.com/metasfresh/metasfresh/commit/aecb402eb04d32f5cdc9acb2189b526723b60466", "message": "Mark `ITableRecordReference.getModel` as Deprecated\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:07Z", "type": "commit"}, {"oid": "0eeaba5057f2f4052be424a4153a7a8b66a93059", "url": "https://github.com/metasfresh/metasfresh/commit/0eeaba5057f2f4052be424a4153a7a8b66a93059", "message": "Mark nullability, fix javadoc\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "commit"}, {"oid": "63e4afe322906606f1c738fbde045ff96ac4fbb2", "url": "https://github.com/metasfresh/metasfresh/commit/63e4afe322906606f1c738fbde045ff96ac4fbb2", "message": "Add NotesRepository along with Chat RepoIdAwares\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "commit"}, {"oid": "005c4b0eea16d32c1c1d0b5cac94fec8b3b20b96", "url": "https://github.com/metasfresh/metasfresh/commit/005c4b0eea16d32c1c1d0b5cac94fec8b3b20b96", "message": "Add limit to the number of Notes retrieved for a record\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "commit"}, {"oid": "f2a560344fb1241fc2f25dbc2d85b7d9efc2e053", "url": "https://github.com/metasfresh/metasfresh/commit/f2a560344fb1241fc2f25dbc2d85b7d9efc2e053", "message": "Update references to TableRecordReference; fix warnings\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "commit"}, {"oid": "66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "url": "https://github.com/metasfresh/metasfresh/commit/66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "message": "Update references to TableRecordReference; fix warnings (2)\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "commit"}, {"oid": "66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "url": "https://github.com/metasfresh/metasfresh/commit/66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "message": "Update references to TableRecordReference; fix warnings (2)\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-23T05:52:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTE3Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r413581173", "bodyText": "pls introduce a POJO to be returned instead of I_CM_ChatEntry", "author": "teosarca", "createdAt": "2020-04-23T07:35:48Z", "path": "de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.notes;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.ad.table.api.AdTableId;\n+import org.adempiere.ad.table.api.IADTableDAO;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_CM_Chat;\n+import org.compiere.model.I_CM_ChatEntry;\n+import org.compiere.model.X_CM_Chat;\n+import org.compiere.model.X_CM_ChatEntry;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+/**\n+ * A Note is made of an {@link I_CM_Chat} as the parent storing the table and record IDs,\n+ * and an {@link I_CM_ChatEntry} as the children storing the text data of the note.\n+ * <p>\n+ * There can be multiple notes for a record.\n+ */\n+@Repository\n+public class NotesRepository\n+{\n+\tprivate final IQueryBL queryBL = Services.get(IQueryBL.class);\n+\tprivate final IADTableDAO tableDAO = Services.get(IADTableDAO.class);\n+\n+\tpublic void createNote(final @NonNull String characterData, @NonNull final TableRecordReference tableRecordReference)\n+\t{\n+\t\tfinal I_CM_Chat chat = getOrCreateChat(tableRecordReference);\n+\n+\t\tfinal I_CM_ChatEntry chatEntry = InterfaceWrapperHelper.newInstance(I_CM_ChatEntry.class);\n+\t\tchatEntry.setCM_Chat_ID(chat.getCM_Chat_ID());\n+\t\tchatEntry.setConfidentialType(X_CM_ChatEntry.CONFIDENTIALTYPE_PublicInformation);\n+\t\tchatEntry.setCharacterData(characterData);\n+\t\tchatEntry.setChatEntryType(X_CM_ChatEntry.CHATENTRYTYPE_NoteFlat);\n+\t\tInterfaceWrapperHelper.save(chatEntry);\n+\t}\n+\n+\t@NonNull\n+\tpublic List<I_CM_ChatEntry> retrieveNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)", "originalCommit": "66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MjM5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r413582396", "bodyText": "rename the method to retrieveLastNotes", "author": "teosarca", "createdAt": "2020-04-23T07:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTE3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0NDkwNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r413644904", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-04-23T09:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTE3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a63bf7cbaf96fd89dffe59f9e0b5bdc7c4c97dfc", "chunk": "diff --git a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\nindex 4b1decd6ea..052930b13a 100644\n--- a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\n+++ b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\n\n@@ -64,7 +64,7 @@ public class NotesRepository\n \t}\n \n \t@NonNull\n-\tpublic List<I_CM_ChatEntry> retrieveNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)\n+\tpublic List<I_CM_ChatEntry> retrieveLastNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)\n \t{\n \t\tfinal ChatId chatId = getChatIdOrNull(tableRecordReference);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTI4MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r413581281", "bodyText": "pls introduce a POJO to be returned instead of I_CM_Chat", "author": "teosarca", "createdAt": "2020-04-23T07:35:58Z", "path": "de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.notes;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.ad.table.api.AdTableId;\n+import org.adempiere.ad.table.api.IADTableDAO;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_CM_Chat;\n+import org.compiere.model.I_CM_ChatEntry;\n+import org.compiere.model.X_CM_Chat;\n+import org.compiere.model.X_CM_ChatEntry;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+/**\n+ * A Note is made of an {@link I_CM_Chat} as the parent storing the table and record IDs,\n+ * and an {@link I_CM_ChatEntry} as the children storing the text data of the note.\n+ * <p>\n+ * There can be multiple notes for a record.\n+ */\n+@Repository\n+public class NotesRepository\n+{\n+\tprivate final IQueryBL queryBL = Services.get(IQueryBL.class);\n+\tprivate final IADTableDAO tableDAO = Services.get(IADTableDAO.class);\n+\n+\tpublic void createNote(final @NonNull String characterData, @NonNull final TableRecordReference tableRecordReference)\n+\t{\n+\t\tfinal I_CM_Chat chat = getOrCreateChat(tableRecordReference);\n+\n+\t\tfinal I_CM_ChatEntry chatEntry = InterfaceWrapperHelper.newInstance(I_CM_ChatEntry.class);\n+\t\tchatEntry.setCM_Chat_ID(chat.getCM_Chat_ID());\n+\t\tchatEntry.setConfidentialType(X_CM_ChatEntry.CONFIDENTIALTYPE_PublicInformation);\n+\t\tchatEntry.setCharacterData(characterData);\n+\t\tchatEntry.setChatEntryType(X_CM_ChatEntry.CHATENTRYTYPE_NoteFlat);\n+\t\tInterfaceWrapperHelper.save(chatEntry);\n+\t}\n+\n+\t@NonNull\n+\tpublic List<I_CM_ChatEntry> retrieveNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)\n+\t{\n+\t\tfinal ChatId chatId = getChatIdOrNull(tableRecordReference);\n+\n+\t\tif (chatId == null)\n+\t\t{\n+\t\t\treturn ImmutableList.of();\n+\t\t}\n+\n+\t\treturn queryBL.createQueryBuilder(I_CM_ChatEntry.class)\n+\t\t\t\t.addEqualsFilter(I_CM_ChatEntry.COLUMNNAME_CM_Chat_ID, chatId)\n+\t\t\t\t.orderByDescending(I_CM_ChatEntry.COLUMNNAME_Created)\n+\t\t\t\t.setLimit(maxNumberOfRecords)\n+\t\t\t\t.create()\n+\t\t\t\t.listImmutable(I_CM_ChatEntry.class);\n+\t}\n+\n+\t@NonNull\n+\tprivate I_CM_Chat getOrCreateChat(final @NonNull TableRecordReference tableRecordReference)", "originalCommit": "66faf4423f2aa11c1ef3e4fdd9f675f4499eda31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY0ODM2NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r413648365", "bodyText": "Fixed by returning ChatId since that's what i really need.", "author": "TheBestPessimist", "createdAt": "2020-04-23T09:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU4MTI4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "a63bf7cbaf96fd89dffe59f9e0b5bdc7c4c97dfc", "chunk": "diff --git a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\nindex 4b1decd6ea..052930b13a 100644\n--- a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\n+++ b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/notes/NotesRepository.java\n\n@@ -64,7 +64,7 @@ public class NotesRepository\n \t}\n \n \t@NonNull\n-\tpublic List<I_CM_ChatEntry> retrieveNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)\n+\tpublic List<I_CM_ChatEntry> retrieveLastNotes(@NonNull final TableRecordReference tableRecordReference, final int maxNumberOfRecords)\n \t{\n \t\tfinal ChatId chatId = getChatIdOrNull(tableRecordReference);\n \n"}}, {"oid": "a63bf7cbaf96fd89dffe59f9e0b5bdc7c4c97dfc", "url": "https://github.com/metasfresh/metasfresh/commit/a63bf7cbaf96fd89dffe59f9e0b5bdc7c4c97dfc", "message": "Rename method\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T08:46:57Z", "type": "commit"}, {"oid": "b1da921041b65f5ced43d5bd914b8d57ba835cb4", "url": "https://github.com/metasfresh/metasfresh/commit/b1da921041b65f5ced43d5bd914b8d57ba835cb4", "message": "Add trl for \"Notes\"\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T08:49:08Z", "type": "commit"}, {"oid": "c9c7a34cd295e40e45168a9d4e25591479333459", "url": "https://github.com/metasfresh/metasfresh/commit/c9c7a34cd295e40e45168a9d4e25591479333459", "message": "Fix warnings\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T09:42:43Z", "type": "commit"}, {"oid": "8a120ba21513cfe74c7be3d9bd976f6d72f0ab38", "url": "https://github.com/metasfresh/metasfresh/commit/8a120ba21513cfe74c7be3d9bd976f6d72f0ab38", "message": "NotesRepository: return Pojo instead of PO\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T09:43:49Z", "type": "commit"}, {"oid": "98776a589eeb891e277b93376613db6f660e35b8", "url": "https://github.com/metasfresh/metasfresh/commit/98776a589eeb891e277b93376613db6f660e35b8", "message": "Rename to `UserRecordNote` from `RecordNote`\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T09:47:03Z", "type": "commit"}, {"oid": "75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "url": "https://github.com/metasfresh/metasfresh/commit/75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "message": "Rename feature to `Comments` from `Notes`\n\nhttps://github.com/metasfresh/metasfresh/issues/6302", "committedDate": "2020-04-23T11:49:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI3NzE5Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414277193", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t@Override\n          \n          \n            \n            \t/**\n          \n          \n            \n            \t * @return first ID or -1 if not found\n          \n          \n            \n            \t */\n          \n          \n            \n            \t@Override\n          \n      \n    \n    \n  \n\ni think the behavior if nt found (0? Integer.MIN_VALUE? throws exception?)is a useful information", "author": "metas-ts", "createdAt": "2020-04-24T04:07:31Z", "path": "de.metas.adempiere.adempiere/base/src/main/java-legacy/org/adempiere/ad/dao/impl/TypedSqlQuery.java", "diffHunk": "@@ -515,12 +515,6 @@ else if (postQueryFilter.accept(model))\n \t\treturn model;\n \t}\n \n-\t/**\n-\t * Return first ID\n-\t *\n-\t * @return first ID or -1 if not found\n-\t * @throws DBException\n-\t */\n \t@Override", "originalCommit": "75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMjU5OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414312599", "bodyText": "This is the implementation class. I removed the comments from here and added better comments in the interface\nI don't understand what you want to say in  if nt found (0? Integer.MIN_VALUE? throws exception?)", "author": "TheBestPessimist", "createdAt": "2020-04-24T05:53:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI3NzE5Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI3OTEzMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414279133", "bodyText": "I guess that this should be similar to e.g. BPartnerLocationId in containing also the ChatId.\nIf there are parts of the code where this is a problem, we shall take a look at them, probable a problem can be solved there.", "author": "metas-ts", "createdAt": "2020-04-24T04:13:37Z", "path": "de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/ChatEntryId.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.comments;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonValue;\n+import de.metas.util.Check;\n+import de.metas.util.lang.RepoIdAware;\n+import lombok.Value;\n+\n+@Value\n+public class ChatEntryId implements RepoIdAware\n+{\n+\tint repoId;\n+\n+\t@JsonCreator\n+\tpublic static ChatEntryId ofRepoId(final int repoId)", "originalCommit": "75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxMzA1MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414313051", "bodyText": "Sounds like a good idea. Will implement.", "author": "TheBestPessimist", "createdAt": "2020-04-24T05:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI3OTEzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ2NTYyMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414465623", "bodyText": "No longer implementing this. Explanation below.", "author": "TheBestPessimist", "createdAt": "2020-04-24T10:21:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI3OTEzMw=="}], "type": "inlineReview", "revised_code": {"commit": "47c966fa57b6cf73c2c42eae5016f225007b0927", "chunk": "diff --git a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/ChatEntryId.java b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentId.java\nsimilarity index 81%\nrename from de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/ChatEntryId.java\nrename to de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentId.java\nindex cecf42ba27..6fd1e9a1d2 100644\n--- a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/ChatEntryId.java\n+++ b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentId.java\n\n@@ -28,23 +28,26 @@ import de.metas.util.Check;\n import de.metas.util.lang.RepoIdAware;\n import lombok.Value;\n \n+import javax.annotation.Nullable;\n+\n @Value\n-public class ChatEntryId implements RepoIdAware\n+public class CommentId implements RepoIdAware\n {\n \tint repoId;\n \n \t@JsonCreator\n-\tpublic static ChatEntryId ofRepoId(final int repoId)\n+\tpublic static CommentId ofRepoId(final int repoId)\n \t{\n-\t\treturn new ChatEntryId(repoId);\n+\t\treturn new CommentId(repoId);\n \t}\n \n-\tpublic static ChatEntryId ofRepoIdOrNull(final int repoId)\n+\t@Nullable\n+\tpublic static CommentId ofRepoIdOrNull(final int repoId)\n \t{\n \t\treturn repoId > 0 ? ofRepoId(repoId) : null;\n \t}\n \n-\tprivate ChatEntryId(final int repoId)\n+\tprivate CommentId(final int repoId)\n \t{\n \t\tthis.repoId = Check.assumeGreaterThanZero(repoId, \"repoId\");\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI4MDMyNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414280326", "bodyText": "For the record, i like such information. Ofc we want to avoid a code-dependency to I_CM_Chat, but still imho it's useful for a dev to know that under the hood we use them, (e.g. when she needs to do stuff in the application dictionary)", "author": "metas-ts", "createdAt": "2020-04-24T04:17:24Z", "path": "de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.comments;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.user.UserId;\n+import de.metas.util.GuavaCollectors;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.ad.table.api.AdTableId;\n+import org.adempiere.ad.table.api.IADTableDAO;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_CM_Chat;\n+import org.compiere.model.I_CM_ChatEntry;\n+import org.compiere.model.X_CM_Chat;\n+import org.compiere.model.X_CM_ChatEntry;\n+import org.compiere.util.TimeUtil;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.Nullable;\n+import java.time.ZonedDateTime;\n+import java.util.List;\n+\n+/**\n+ * A Comment is made of an {@link I_CM_Chat} as the parent storing the table and record IDs,", "originalCommit": "75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "47c966fa57b6cf73c2c42eae5016f225007b0927", "chunk": "diff --git a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\nindex d636712386..d57cd85bc0 100644\n--- a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\n+++ b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\n\n@@ -57,10 +57,10 @@ public class CommentsRepository\n \n \tpublic void createComment(final @NonNull String characterData, @NonNull final TableRecordReference tableRecordReference)\n \t{\n-\t\tfinal ChatId chatId = getOrCreateChat(tableRecordReference);\n+\t\tfinal CommentId commentId = getOrCreateChat(tableRecordReference);\n \n \t\tfinal I_CM_ChatEntry chatEntry = InterfaceWrapperHelper.newInstance(I_CM_ChatEntry.class);\n-\t\tchatEntry.setCM_Chat_ID(chatId.getRepoId());\n+\t\tchatEntry.setCM_Chat_ID(commentId.getRepoId());\n \t\tchatEntry.setConfidentialType(X_CM_ChatEntry.CONFIDENTIALTYPE_PublicInformation);\n \t\tchatEntry.setCharacterData(characterData);\n \t\tchatEntry.setChatEntryType(X_CM_ChatEntry.CHATENTRYTYPE_NoteFlat);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI4MDQ0NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414280445", "bodyText": "allright, let's rename this to CommentId / CommentLineId then", "author": "metas-ts", "createdAt": "2020-04-24T04:17:53Z", "path": "de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.comments;\n+\n+import com.google.common.collect.ImmutableList;\n+import de.metas.user.UserId;\n+import de.metas.util.GuavaCollectors;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.ad.table.api.AdTableId;\n+import org.adempiere.ad.table.api.IADTableDAO;\n+import org.adempiere.model.InterfaceWrapperHelper;\n+import org.adempiere.util.lang.impl.TableRecordReference;\n+import org.compiere.model.I_CM_Chat;\n+import org.compiere.model.I_CM_ChatEntry;\n+import org.compiere.model.X_CM_Chat;\n+import org.compiere.model.X_CM_ChatEntry;\n+import org.compiere.util.TimeUtil;\n+import org.springframework.stereotype.Repository;\n+\n+import javax.annotation.Nullable;\n+import java.time.ZonedDateTime;\n+import java.util.List;\n+\n+/**\n+ * A Comment is made of an {@link I_CM_Chat} as the parent storing the table and record IDs,\n+ * and an {@link I_CM_ChatEntry} as the children storing the text data of the Comment.\n+ * <p>\n+ * There can be multiple Comments for a record.\n+ */\n+@Repository\n+public class CommentsRepository\n+{\n+\tprivate final IQueryBL queryBL = Services.get(IQueryBL.class);\n+\tprivate final IADTableDAO tableDAO = Services.get(IADTableDAO.class);\n+\n+\tpublic void createComment(final @NonNull String characterData, @NonNull final TableRecordReference tableRecordReference)\n+\t{\n+\t\tfinal ChatId chatId = getOrCreateChat(tableRecordReference);", "originalCommit": "75103708810d7bc23c31bf2e7fcb0810a2bdc4d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMxNTA2Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414315067", "bodyText": "Instead of ChatId/ChatEntryId? What about the tables/POs?", "author": "TheBestPessimist", "createdAt": "2020-04-24T05:59:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI4MDQ0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMzMjI2Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6512#discussion_r414332262", "bodyText": "The POs and tables will not be renamed.", "author": "TheBestPessimist", "createdAt": "2020-04-24T06:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI4MDQ0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "47c966fa57b6cf73c2c42eae5016f225007b0927", "chunk": "diff --git a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\nindex d636712386..d57cd85bc0 100644\n--- a/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\n+++ b/de.metas.adempiere.adempiere/base/src/main/java/de/metas/comments/CommentsRepository.java\n\n@@ -57,10 +57,10 @@ public class CommentsRepository\n \n \tpublic void createComment(final @NonNull String characterData, @NonNull final TableRecordReference tableRecordReference)\n \t{\n-\t\tfinal ChatId chatId = getOrCreateChat(tableRecordReference);\n+\t\tfinal CommentId commentId = getOrCreateChat(tableRecordReference);\n \n \t\tfinal I_CM_ChatEntry chatEntry = InterfaceWrapperHelper.newInstance(I_CM_ChatEntry.class);\n-\t\tchatEntry.setCM_Chat_ID(chatId.getRepoId());\n+\t\tchatEntry.setCM_Chat_ID(commentId.getRepoId());\n \t\tchatEntry.setConfidentialType(X_CM_ChatEntry.CONFIDENTIALTYPE_PublicInformation);\n \t\tchatEntry.setCharacterData(characterData);\n \t\tchatEntry.setChatEntryType(X_CM_ChatEntry.CHATENTRYTYPE_NoteFlat);\n"}}, {"oid": "7f25ed4780a5aea084f070312a7e11c7d375657d", "url": "https://github.com/metasfresh/metasfresh/commit/7f25ed4780a5aea084f070312a7e11c7d375657d", "message": "Improve javadoc even more\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T05:56:55Z", "type": "commit"}, {"oid": "47c966fa57b6cf73c2c42eae5016f225007b0927", "url": "https://github.com/metasfresh/metasfresh/commit/47c966fa57b6cf73c2c42eae5016f225007b0927", "message": "Rename classes to `Comment` and `CommentEntry` respectively\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T06:40:19Z", "type": "commit"}, {"oid": "4c2810e45fc903cbb1030b7e9d8070e36075140b", "url": "https://github.com/metasfresh/metasfresh/commit/4c2810e45fc903cbb1030b7e9d8070e36075140b", "message": "Better error message in case repoId is <= 0\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T08:19:46Z", "type": "commit"}, {"oid": "ce5e4d6081f4bc4976237ca900ae1dbbbe264f4a", "url": "https://github.com/metasfresh/metasfresh/commit/ce5e4d6081f4bc4976237ca900ae1dbbbe264f4a", "message": "Use OrderBy when asking for the first row\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T08:25:25Z", "type": "commit"}, {"oid": "c99c1c7933cea5c9e797e6c05d54c2d2a002bdab", "url": "https://github.com/metasfresh/metasfresh/commit/c99c1c7933cea5c9e797e6c05d54c2d2a002bdab", "message": "Rename CommentEntryRepository\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T08:26:00Z", "type": "commit"}, {"oid": "1bb1a5175f35855154ef0d9aa1e6ddd20253bf99", "url": "https://github.com/metasfresh/metasfresh/commit/1bb1a5175f35855154ef0d9aa1e6ddd20253bf99", "message": "Make CommentId public again\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T08:30:38Z", "type": "commit"}, {"oid": "3868d7bce123a69364eb4322c61356d980ef5aa0", "url": "https://github.com/metasfresh/metasfresh/commit/3868d7bce123a69364eb4322c61356d980ef5aa0", "message": "Add note of different converters to use when returning a time (ie. ZonedDateTime) in JSON\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T08:34:53Z", "type": "commit"}, {"oid": "1b00abcf91a158399658b1a3d69a285df03fbaca", "url": "https://github.com/metasfresh/metasfresh/commit/1b00abcf91a158399658b1a3d69a285df03fbaca", "message": "Add Builder to CommentEntry instead of `of`\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T10:15:11Z", "type": "commit"}, {"oid": "4bd7c5778ff16736ab5e8600d67e76a12bc5c3f0", "url": "https://github.com/metasfresh/metasfresh/commit/4bd7c5778ff16736ab5e8600d67e76a12bc5c3f0", "message": "Improve distinction between `CommentEntryParentId` and `CommentEntryId`\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-24T10:29:39Z", "type": "commit"}, {"oid": "226a6ba2ea2abba7510fc07cac6b49befb058b72", "url": "https://github.com/metasfresh/metasfresh/commit/226a6ba2ea2abba7510fc07cac6b49befb058b72", "message": "Update Comments Modal trl\n\nhttps://github.com/metasfresh/metasfresh/issues/6504", "committedDate": "2020-04-29T09:05:43Z", "type": "commit"}, {"oid": "59e1691c2a27174fd71c78fbdfe10d1b359aff91", "url": "https://github.com/metasfresh/metasfresh/commit/59e1691c2a27174fd71c78fbdfe10d1b359aff91", "message": "Merge remote-tracking branch 'origin/gh6504-chat' into gh6504-chat", "committedDate": "2020-04-29T09:06:02Z", "type": "commit"}]}