{"pr_number": 7055, "pr_title": "Do not show action Picking Terminal V2 -> Picking -> Process if there are no rows available for processing", "pr_createdAt": "2020-07-24T12:09:07Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/7055", "timeline": [{"oid": "6a23438d72e305d5f1bcbcec0dd50f4795ecc3d7", "url": "https://github.com/metasfresh/metasfresh/commit/6a23438d72e305d5f1bcbcec0dd50f4795ecc3d7", "message": "Do not show action Picking Terminal V2 -> Picking -> Process if there are no rows available for processing\n\nhttps://github.com/metasfresh/metasfresh/issues/6997", "committedDate": "2020-07-24T12:08:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA2Nzk4MA==", "url": "https://github.com/metasfresh/metasfresh/pull/7055#discussion_r460067980", "bodyText": "I think you should check if there are unpacked rows as well, not only the ones that are not already processed. If the rows were picked but not yet packed, the \"Process\"  action is available and one can set the shipper transportation and believe the stuff really got in there, when in fact they didn't.", "author": "metas-rc", "createdAt": "2020-07-24T13:56:16Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java", "diffHunk": "@@ -76,23 +76,31 @@ protected ProcessPreconditionsResolution checkPreconditionsApplicable()\n \t\t\treturn ProcessPreconditionsResolution.rejectWithInternalReason(\"only picker shall be allowed to process\");\n \t\t}\n \n+\t\tfinal List<ProductsToPickRow> rows = getRowsNotAlreadyProcessed();", "originalCommit": "6a23438d72e305d5f1bcbcec0dd50f4795ecc3d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY0Nzc1Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/7055#discussion_r460647752", "bodyText": "If there are Picked rows but not Packed, the Process action does not appear.\n\nThe method isEligibleForProcessing already checks for packed status:", "author": "TheBestPessimist", "createdAt": "2020-07-27T05:01:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA2Nzk4MA=="}], "type": "inlineReview", "revised_code": {"commit": "c301c7572f3f2074074e070849ca9f1840e39a4b", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\nindex 09dea90d06..0b952243c7 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\n\n@@ -82,7 +82,14 @@ public class ProductsToPick_4EyesReview_ProcessAll extends ProductsToPickViewBas\n \t\t\treturn ProcessPreconditionsResolution.rejectWithInternalReason(\"no unprocessed rows\");\n \t\t}\n \n-\t\tif (partialDeliveryNotAllowed())\n+\t\tif (partialDeliveryAllowed())\n+\t\t{\n+\t\t\tif (rows.stream().noneMatch(ProductsToPickRow::isEligibleForProcessing))\n+\t\t\t{\n+\t\t\t\treturn ProcessPreconditionsResolution.rejectWithInternalReason(\"no rows eligible for processing\");\n+\t\t\t}\n+\t\t}\n+\t\telse\n \t\t{\n \t\t\tif (!getView().isApproved())\n \t\t\t{\n"}}, {"oid": "c301c7572f3f2074074e070849ca9f1840e39a4b", "url": "https://github.com/metasfresh/metasfresh/commit/c301c7572f3f2074074e070849ca9f1840e39a4b", "message": "Refactoring\n\nhttps://github.com/metasfresh/metasfresh/issues/6997", "committedDate": "2020-07-27T07:31:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyNDg0MA==", "url": "https://github.com/metasfresh/metasfresh/pull/7055#discussion_r460724840", "bodyText": "why not prefixing with is?", "author": "teosarca", "createdAt": "2020-07-27T08:23:32Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java", "diffHunk": "@@ -205,8 +213,8 @@ private void deliverAndInvoice(final List<PickingCandidate> pickingCandidates)\n \t\t\t\t.collect(ImmutableList.toImmutableList());\n \t}\n \n-\tprivate boolean partialDeliveryNotAllowed()\n+\tprivate boolean partialDeliveryAllowed()", "originalCommit": "c301c7572f3f2074074e070849ca9f1840e39a4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyOTgzOA==", "url": "https://github.com/metasfresh/metasfresh/pull/7055#discussion_r460729838", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-07-27T08:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcyNDg0MA=="}], "type": "inlineReview", "revised_code": {"commit": "2c91b3a75fd05097216f1c1efe6a0bf09663a8c1", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\nindex 0b952243c7..0c6ae2d048 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/pickingV2/productsToPick/process/ProductsToPick_4EyesReview_ProcessAll.java\n\n@@ -213,7 +213,7 @@ public class ProductsToPick_4EyesReview_ProcessAll extends ProductsToPickViewBas\n \t\t\t\t.collect(ImmutableList.toImmutableList());\n \t}\n \n-\tprivate boolean partialDeliveryAllowed()\n+\tprivate boolean isPartialDeliveryAllowed()\n \t{\n \t\treturn sysConfigBL.getBooleanValue(SYSCONFIG_AllowPartialDelivery, false);\n \t}\n"}}, {"oid": "2c91b3a75fd05097216f1c1efe6a0bf09663a8c1", "url": "https://github.com/metasfresh/metasfresh/commit/2c91b3a75fd05097216f1c1efe6a0bf09663a8c1", "message": "Better method name\n\nhttps://github.com/metasfresh/metasfresh/issues/6997", "committedDate": "2020-07-27T08:31:33Z", "type": "commit"}]}