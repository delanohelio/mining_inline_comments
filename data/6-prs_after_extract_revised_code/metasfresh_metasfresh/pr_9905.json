{"pr_number": 9905, "pr_title": "#9904 Also saving a product trl in the base language.", "pr_createdAt": "2020-09-06T19:13:06Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/9905", "timeline": [{"oid": "860f4e065059eefb0ba714b5b41543e4954ac4ef", "url": "https://github.com/metasfresh/metasfresh/commit/860f4e065059eefb0ba714b5b41543e4954ac4ef", "message": "#9904 Also saving a product trl in the base language.", "committedDate": "2020-09-06T19:12:02Z", "type": "commit"}, {"oid": "e21fc64f583f79cb8961e80d7cc585c804ddc21d", "url": "https://github.com/metasfresh/metasfresh/commit/e21fc64f583f79cb8961e80d7cc585c804ddc21d", "message": "#9904 Only inserting trls for languages with issystemlanguage='Y'", "committedDate": "2020-09-07T16:42:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0OTg1NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/9905#discussion_r484649855", "bodyText": "Please check out the two differnt where-clauses:\nas talked yesterday, this whole if doesn't make any sense anymore.", "author": "metas-ts", "createdAt": "2020-09-08T04:57:12Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/i18n/po/POTrlRepository.java", "diffHunk": "@@ -156,14 +153,14 @@ public final boolean insertTranslations(@NonNull final POTrlInfo trlInfo, final\n \t\t}", "originalCommit": "e21fc64f583f79cb8961e80d7cc585c804ddc21d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY5NTk5Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/9905#discussion_r484695997", "bodyText": "There might be languages that are marked as isbaselanguage = 'y' and issystemlanguage='n' that we need trls for for the ad_element table (not on the hf instance but on other ones where there will be languages only marked as base language and not as system language too). That's the scenario I left the if for. WDYT?", "author": "dragospodariu96", "createdAt": "2020-09-08T07:06:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0OTg1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjExNTIxMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/9905#discussion_r486115211", "bodyText": "aaah, ok, i think now i got it.\nthen i think we should change this\n\t\tif (I_AD_Element.Table_Name.equals(tableName))\n\t\t{\n\t\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y' OR l.\" + I_AD_Language.COLUMNNAME_IsBaseLanguage + \"='Y')\");\n\t\t}\n\t\telse\n\t\t{\n\t\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y')\");\n\t\t}\nto\n\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y'\");\n\t\tif (I_AD_Element.Table_Name.equals(tableName))\n\t\t{ // for AD_Element we need to make sure to have the BaseLanguage, no matter if that's also a system-language\n\t\t\tsql.append(\" OR l.\" + I_AD_Language.COLUMNNAME_IsBaseLanguage + \"='Y'\");\n\t\t}\n\t\tsql.append(\")\");\ni think that way it's clearer", "author": "metas-ts", "createdAt": "2020-09-10T07:12:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY0OTg1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "fe0364ab989a9f6ad5f19a2a59b858989e827022", "chunk": "diff --git a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/i18n/po/POTrlRepository.java b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/i18n/po/POTrlRepository.java\nindex d0e7dc1080..dcf7650add 100644\n--- a/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/i18n/po/POTrlRepository.java\n+++ b/backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/i18n/po/POTrlRepository.java\n\n@@ -146,15 +146,12 @@ public class POTrlRepository\n \t\t\t\t\t\t+ I_AD_Language.COLUMNNAME_IsActive\n \t\t\t\t\t\t+ \"='Y'\");\n \n-\t\t// This will change in #4672\n+\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y'\");\n \t\tif (I_AD_Element.Table_Name.equals(tableName))\n-\t\t{\n-\t\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y' OR l.\" + I_AD_Language.COLUMNNAME_IsBaseLanguage + \"='Y')\");\n-\t\t}\n-\t\telse\n-\t\t{\n-\t\t\tsql.append(\"AND (l.\" + I_AD_Language.COLUMNNAME_IsSystemLanguage + \"='Y')\");\n+\t\t{ // for AD_Element we need to make sure to have the BaseLanguage, no matter if that's also a system-language\n+\t\t\tsql.append(\" OR l.\" + I_AD_Language.COLUMNNAME_IsBaseLanguage + \"='Y'\");\n \t\t}\n+\t\tsql.append(\")\");\n \n \t\tsql.append(\" AND t.\")\n \t\t\t\t.append(keyColumn).append(\"=\").append(recordId)\n"}}, {"oid": "fe0364ab989a9f6ad5f19a2a59b858989e827022", "url": "https://github.com/metasfresh/metasfresh/commit/fe0364ab989a9f6ad5f19a2a59b858989e827022", "message": "#9904 Aplying code review changes.", "committedDate": "2020-09-10T08:20:22Z", "type": "commit"}]}