{"pr_number": 6778, "pr_title": "#6777 Shall refresh even if is single document", "pr_createdAt": "2020-06-02T11:10:29Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6778", "timeline": [{"oid": "0c30e9b3f3c0ae74de6d7bdaff5c6ef530d1eda2", "url": "https://github.com/metasfresh/metasfresh/commit/0c30e9b3f3c0ae74de6d7bdaff5c6ef530d1eda2", "message": "#6777 Shall refresh even if is single document", "committedDate": "2020-06-02T11:09:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgxMDI3NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6778#discussion_r433810274", "bodyText": "wanted to call, but i think it's better to list my questions..\n\nsince we are in the isRefreshAllAfterExecution() branch, don't we have to find a way to invalidate all records?\nin case of isRefreshAllAfterExecution() == false, shouldn't we still make sure to invalidate the selected record?\nin the dev-test you wrote \"select a product and run the process\". So, i can imagine the test succeeds with a single record. but what if more than one record is selected?\nmaybe consult with Teo?", "author": "metas-ts", "createdAt": "2020-06-02T11:37:35Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java", "diffHunk": "@@ -126,10 +130,19 @@ private void invalidateDocumentsAndViews(final ViewId viewId, final ProcessExecu\n \t\t//\n \t\t// Refresh all\n \t\tboolean viewInvalidateAllCalled = false;\n-\t\tif (processExecutionResult.isRefreshAllAfterExecution() && viewSupplier.get() != null)\n+\t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n-\t\t\tviewSupplier.get().invalidateAll();\n-\t\t\tviewInvalidateAllCalled = true;\n+\t\t\tif (viewSupplier.get() != null)\n+\t\t\t{\n+\t\t\t\tviewSupplier.get().invalidateAll();\n+\t\t\t\tviewInvalidateAllCalled = true;\n+\t\t\t}\n+\t\t\telse if (currentSingleSelectedDocumentRef != null)\n+\t\t\t{\n+\t\t\t\tdocumentsCollection.invalidateDocumentByRecordId(", "originalCommit": "0c30e9b3f3c0ae74de6d7bdaff5c6ef530d1eda2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgzMjcwNQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6778#discussion_r433832705", "bodyText": "One short, the case of more than one record selected is already covered by previous lines:\n\n\nin case of isRefreshAllAfterExecution() == false, shouldn't we still make sure to invalidate the selected record?\n\nHm.. it is wanted? Not sure.", "author": "cristinamghita", "createdAt": "2020-06-02T12:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzgxMDI3NA=="}], "type": "inlineReview", "revised_code": {"commit": "bdadedf68a06f0c5748db4dd3dfb6bc25419a462", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\nindex afbf190851..b5b38eb632 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n\n@@ -133,12 +133,12 @@ public class ADProcessPostProcessService\n \t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n \t\t\tif (viewSupplier.get() != null)\n-\t\t\t{\n+\t\t\t{ // multible rows selected\n \t\t\t\tviewSupplier.get().invalidateAll();\n \t\t\t\tviewInvalidateAllCalled = true;\n \t\t\t}\n \t\t\telse if (currentSingleSelectedDocumentRef != null)\n-\t\t\t{\n+\t\t\t{ // single row selected\n \t\t\t\tdocumentsCollection.invalidateDocumentByRecordId(\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getTableName(),\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getRecord_ID());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg0MDM3MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6778#discussion_r433840370", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t{\n          \n          \n            \n            \t\t\t{ // multible rows selected", "author": "metas-ts", "createdAt": "2020-06-02T12:34:57Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java", "diffHunk": "@@ -126,10 +130,19 @@ private void invalidateDocumentsAndViews(final ViewId viewId, final ProcessExecu\n \t\t//\n \t\t// Refresh all\n \t\tboolean viewInvalidateAllCalled = false;\n-\t\tif (processExecutionResult.isRefreshAllAfterExecution() && viewSupplier.get() != null)\n+\t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n-\t\t\tviewSupplier.get().invalidateAll();\n-\t\t\tviewInvalidateAllCalled = true;\n+\t\t\tif (viewSupplier.get() != null)\n+\t\t\t{", "originalCommit": "0c30e9b3f3c0ae74de6d7bdaff5c6ef530d1eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bdadedf68a06f0c5748db4dd3dfb6bc25419a462", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\nindex afbf190851..b5b38eb632 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n\n@@ -133,12 +133,12 @@ public class ADProcessPostProcessService\n \t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n \t\t\tif (viewSupplier.get() != null)\n-\t\t\t{\n+\t\t\t{ // multible rows selected\n \t\t\t\tviewSupplier.get().invalidateAll();\n \t\t\t\tviewInvalidateAllCalled = true;\n \t\t\t}\n \t\t\telse if (currentSingleSelectedDocumentRef != null)\n-\t\t\t{\n+\t\t\t{ // single row selected\n \t\t\t\tdocumentsCollection.invalidateDocumentByRecordId(\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getTableName(),\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getRecord_ID());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzg0MDQ3Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6778#discussion_r433840477", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t{\n          \n          \n            \n            \t\t\t{ // single row selected", "author": "metas-ts", "createdAt": "2020-06-02T12:35:10Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java", "diffHunk": "@@ -126,10 +130,19 @@ private void invalidateDocumentsAndViews(final ViewId viewId, final ProcessExecu\n \t\t//\n \t\t// Refresh all\n \t\tboolean viewInvalidateAllCalled = false;\n-\t\tif (processExecutionResult.isRefreshAllAfterExecution() && viewSupplier.get() != null)\n+\t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n-\t\t\tviewSupplier.get().invalidateAll();\n-\t\t\tviewInvalidateAllCalled = true;\n+\t\t\tif (viewSupplier.get() != null)\n+\t\t\t{\n+\t\t\t\tviewSupplier.get().invalidateAll();\n+\t\t\t\tviewInvalidateAllCalled = true;\n+\t\t\t}\n+\t\t\telse if (currentSingleSelectedDocumentRef != null)\n+\t\t\t{", "originalCommit": "0c30e9b3f3c0ae74de6d7bdaff5c6ef530d1eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bdadedf68a06f0c5748db4dd3dfb6bc25419a462", "chunk": "diff --git a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\nindex afbf190851..b5b38eb632 100644\n--- a/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n+++ b/backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/process/adprocess/ADProcessPostProcessService.java\n\n@@ -133,12 +133,12 @@ public class ADProcessPostProcessService\n \t\tif (processExecutionResult.isRefreshAllAfterExecution())\n \t\t{\n \t\t\tif (viewSupplier.get() != null)\n-\t\t\t{\n+\t\t\t{ // multible rows selected\n \t\t\t\tviewSupplier.get().invalidateAll();\n \t\t\t\tviewInvalidateAllCalled = true;\n \t\t\t}\n \t\t\telse if (currentSingleSelectedDocumentRef != null)\n-\t\t\t{\n+\t\t\t{ // single row selected\n \t\t\t\tdocumentsCollection.invalidateDocumentByRecordId(\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getTableName(),\n \t\t\t\t\t\tcurrentSingleSelectedDocumentRef.getRecord_ID());\n"}}, {"oid": "bdadedf68a06f0c5748db4dd3dfb6bc25419a462", "url": "https://github.com/metasfresh/metasfresh/commit/bdadedf68a06f0c5748db4dd3dfb6bc25419a462", "message": "minor: add comments", "committedDate": "2020-06-02T12:35:54Z", "type": "commit"}]}