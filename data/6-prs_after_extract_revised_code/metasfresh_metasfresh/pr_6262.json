{"pr_number": 6262, "pr_title": "Update Total Amount of Payment Selection.", "pr_createdAt": "2020-02-25T15:45:59Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6262", "timeline": [{"oid": "af2c1ddc92c726813c11f743772b6c0a6a3d4792", "url": "https://github.com/metasfresh/metasfresh/commit/af2c1ddc92c726813c11f743772b6c0a6a3d4792", "message": "#4051 Now updating total ammound after adding a new payselection line to completed pay selection.", "committedDate": "2020-02-25T15:29:35Z", "type": "commit"}, {"oid": "67d37e2a5d0293d48e58a6488560f5db2bb4254b", "url": "https://github.com/metasfresh/metasfresh/commit/67d37e2a5d0293d48e58a6488560f5db2bb4254b", "message": "Merge branch 'master' into gh4051", "committedDate": "2020-02-25T15:32:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MDQ1Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6262#discussion_r384460452", "bodyText": "why full cache reset is needed?", "author": "teosarca", "createdAt": "2020-02-26T12:27:45Z", "path": "de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java", "diffHunk": "@@ -153,6 +175,7 @@ public void run(final String localTrxName) throws Exception\n \t\t\t\tsetTrxName(localTrxName);\n \n \t\t\t\tupdate0();\n+\t\t\t\tCacheMgt.get().reset();", "originalCommit": "67d37e2a5d0293d48e58a6488560f5db2bb4254b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MjU3NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6262#discussion_r384462574", "bodyText": "i would really really really avoid this.", "author": "teosarca", "createdAt": "2020-02-26T12:32:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MDQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MzEzMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6262#discussion_r384463131", "bodyText": "forgot that one there while testing smth, it's not.", "author": "dragospodariu96", "createdAt": "2020-02-26T12:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MDQ1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8a0275198e4bc1ebfa50249a3616a8030d47dfd3", "chunk": "diff --git a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\nindex 24810d6239..89f0ca7add 100644\n--- a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n+++ b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n\n@@ -175,7 +175,6 @@ public class PaySelectionUpdater implements IPaySelectionUpdater\n \t\t\t\tsetTrxName(localTrxName);\n \n \t\t\t\tupdate0();\n-\t\t\t\tCacheMgt.get().reset();\n \t\t\t}\n \n \t\t\t@Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MjEwMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6262#discussion_r384462100", "bodyText": "pls getC_PaySelection_ID() method instead of _paySelection.getC_PaySelection_ID().\nNOTE: in metasfresh, usually class fields which are prefixed with _ shall not be used directly.", "author": "teosarca", "createdAt": "2020-02-26T12:31:25Z", "path": "de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java", "diffHunk": "@@ -673,6 +707,17 @@ private void setTrxName(final String trxName)\n \t\t_trxName = trxName;\n \t}\n \n+\t/**\n+\t * Invalidates Cache for current PaySelection.\n+\t */\n+\tprivate void cacheInvalidationForCurrentPaySelection()\n+\t{\n+\t\tfinal IModelCacheInvalidationService modelCacheInvalidationService = Services.get(IModelCacheInvalidationService.class);\n+\t\tmodelCacheInvalidationService.invalidate(\n+\t\t\t\tCacheInvalidateMultiRequest.fromTableNameAndRecordId(I_C_PaySelection.Table_Name, _paySelection.getC_PaySelection_ID()),", "originalCommit": "67d37e2a5d0293d48e58a6488560f5db2bb4254b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8a0275198e4bc1ebfa50249a3616a8030d47dfd3", "chunk": "diff --git a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\nindex 24810d6239..89f0ca7add 100644\n--- a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n+++ b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n\n@@ -712,9 +711,8 @@ public class PaySelectionUpdater implements IPaySelectionUpdater\n \t */\n \tprivate void cacheInvalidationForCurrentPaySelection()\n \t{\n-\t\tfinal IModelCacheInvalidationService modelCacheInvalidationService = Services.get(IModelCacheInvalidationService.class);\n \t\tmodelCacheInvalidationService.invalidate(\n-\t\t\t\tCacheInvalidateMultiRequest.fromTableNameAndRecordId(I_C_PaySelection.Table_Name, _paySelection.getC_PaySelection_ID()),\n+\t\t\t\tCacheInvalidateMultiRequest.fromTableNameAndRecordId(I_C_PaySelection.Table_Name, getC_PaySelection_ID()),\n \t\t\t\tModelCacheInvalidationTiming.CHANGE);\n \t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ2MjQxNw==", "url": "https://github.com/metasfresh/metasfresh/pull/6262#discussion_r384462417", "bodyText": "declare your modelCacheInvalidationService service  at the top, near the other services.", "author": "teosarca", "createdAt": "2020-02-26T12:32:06Z", "path": "de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java", "diffHunk": "@@ -673,6 +707,17 @@ private void setTrxName(final String trxName)\n \t\t_trxName = trxName;\n \t}\n \n+\t/**\n+\t * Invalidates Cache for current PaySelection.\n+\t */\n+\tprivate void cacheInvalidationForCurrentPaySelection()\n+\t{\n+\t\tfinal IModelCacheInvalidationService modelCacheInvalidationService = Services.get(IModelCacheInvalidationService.class);", "originalCommit": "67d37e2a5d0293d48e58a6488560f5db2bb4254b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8a0275198e4bc1ebfa50249a3616a8030d47dfd3", "chunk": "diff --git a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\nindex 24810d6239..89f0ca7add 100644\n--- a/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n+++ b/de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/payment/impl/PaySelectionUpdater.java\n\n@@ -712,9 +711,8 @@ public class PaySelectionUpdater implements IPaySelectionUpdater\n \t */\n \tprivate void cacheInvalidationForCurrentPaySelection()\n \t{\n-\t\tfinal IModelCacheInvalidationService modelCacheInvalidationService = Services.get(IModelCacheInvalidationService.class);\n \t\tmodelCacheInvalidationService.invalidate(\n-\t\t\t\tCacheInvalidateMultiRequest.fromTableNameAndRecordId(I_C_PaySelection.Table_Name, _paySelection.getC_PaySelection_ID()),\n+\t\t\t\tCacheInvalidateMultiRequest.fromTableNameAndRecordId(I_C_PaySelection.Table_Name, getC_PaySelection_ID()),\n \t\t\t\tModelCacheInvalidationTiming.CHANGE);\n \t}\n \n"}}, {"oid": "8a0275198e4bc1ebfa50249a3616a8030d47dfd3", "url": "https://github.com/metasfresh/metasfresh/commit/8a0275198e4bc1ebfa50249a3616a8030d47dfd3", "message": "#4051 Code Quality Upgrades.", "committedDate": "2020-02-26T12:44:24Z", "type": "commit"}, {"oid": "59028be3a5a051ac6fe58efc4ca730cb2bbba867", "url": "https://github.com/metasfresh/metasfresh/commit/59028be3a5a051ac6fe58efc4ca730cb2bbba867", "message": "Merge branch 'master' into gh4051\n\n# Conflicts:\n#\tde.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/process/C_PaySelection_CreateFrom.java", "committedDate": "2020-02-26T15:01:11Z", "type": "commit"}, {"oid": "585e7fb56cad51cef7b4c7d191206586fe36ea9e", "url": "https://github.com/metasfresh/metasfresh/commit/585e7fb56cad51cef7b4c7d191206586fe36ea9e", "message": "#4051 Resolved C_PaySelection_CreateFrom conflicts.", "committedDate": "2020-02-26T15:08:48Z", "type": "commit"}]}