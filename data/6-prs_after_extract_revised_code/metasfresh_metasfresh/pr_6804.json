{"pr_number": 6804, "pr_title": "#6803 Can now generate delivery days for a specific tour version.", "pr_createdAt": "2020-06-05T15:25:47Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6804", "timeline": [{"oid": "8e0ba18fa2a1c89512de13dc5080f5bb17570f0d", "url": "https://github.com/metasfresh/metasfresh/commit/8e0ba18fa2a1c89512de13dc5080f5bb17570f0d", "message": "#6803 Can now generate delivery days for a specific tour version.", "committedDate": "2020-06-05T15:25:17Z", "type": "commit"}, {"oid": "ce56a40aa40907b05948c5da9c9de47a3ecb5bbe", "url": "https://github.com/metasfresh/metasfresh/commit/ce56a40aa40907b05948c5da9c9de47a3ecb5bbe", "message": "#6803 Code Refractoring.", "committedDate": "2020-06-05T15:36:38Z", "type": "commit"}, {"oid": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "url": "https://github.com/metasfresh/metasfresh/commit/9b3d6e04c594036f726ab8599ef2ed65ee648304", "message": "#6803 Translated process to German translations too.", "committedDate": "2020-06-09T07:40:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNDg3NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r437224875", "bodyText": "no finals needed in this interface", "author": "metas-ts", "createdAt": "2020-06-09T08:23:10Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/ITourDAO.java", "diffHunk": "@@ -38,4 +38,6 @@\n \t * @return tour version ranges\n \t */\n \tList<ITourVersionRange> retrieveTourVersionRanges(I_M_Tour tour, LocalDate dateFrom, LocalDate dateTo);\n+\n+\tITourVersionRange generateTourVersionRange(final I_M_TourVersion tourVersion, final LocalDate validFrom, final LocalDate validTo);", "originalCommit": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI4OTQzOA==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r439289438", "bodyText": "Done!", "author": "dragospodariu96", "createdAt": "2020-06-12T08:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNDg3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "0bc67d63369ebd565f8bb7e03acdb57368735777", "chunk": "diff --git a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/ITourDAO.java b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/ITourDAO.java\nindex 20a659839c..6763d16807 100644\n--- a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/ITourDAO.java\n+++ b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/ITourDAO.java\n\n@@ -39,5 +39,5 @@ public interface ITourDAO extends ISingletonService\n \t */\n \tList<ITourVersionRange> retrieveTourVersionRanges(I_M_Tour tour, LocalDate dateFrom, LocalDate dateTo);\n \n-\tITourVersionRange generateTourVersionRange(final I_M_TourVersion tourVersion, final LocalDate validFrom, final LocalDate validTo);\n+\tITourVersionRange generateTourVersionRange(I_M_TourVersion tourVersion, LocalDate validFrom, LocalDate validTo);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNjA1MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r437226051", "bodyText": "see if you can't avoid the code duplication; looks very similar to generateForTour to me on the first glimpse", "author": "metas-ts", "createdAt": "2020-06-09T08:25:01Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/impl/DeliveryDayGenerator.java", "diffHunk": "@@ -151,6 +150,26 @@ public final void generate(final String trxName)\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic void generateDeliveryDaysForTourVersion(final String trxName, final I_M_TourVersion tourVersion)", "originalCommit": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTMwNDQ1Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r439304457", "bodyText": "Extracted duplicate code to new method!", "author": "dragospodariu96", "createdAt": "2020-06-12T09:14:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyNjA1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f02aa4e0499205ae24e171e434bf3af09de0ec0a", "chunk": "diff --git a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/impl/DeliveryDayGenerator.java b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/impl/DeliveryDayGenerator.java\nindex 010d025dbd..c7187ac2d4 100644\n--- a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/impl/DeliveryDayGenerator.java\n+++ b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/impl/DeliveryDayGenerator.java\n\n@@ -155,6 +155,11 @@ public class DeliveryDayGenerator implements IDeliveryDayGenerator\n \t{\n \n \t\tfinal ITourVersionRange tourVersionRange = tourDAO.generateTourVersionRange(tourVersion, getDateFromToUse(), getDateToToUse());\n+\t\tif (tourVersionRange == null)\n+\t\t{\n+\t\t\tloggable.addLog(\"Skip {} because validFrom > validTo\");\n+\t\t\treturn;\n+\t\t}\n \t\tfinal List<I_M_TourVersionLine> tourVersionLines = tourDAO.retrieveTourVersionLines(tourVersion);\n \t\tinactivateDeliveryDaysInRange(tourVersionRange, trxName);\n \t\tif (tourVersionLines.isEmpty())\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyODA3OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r437228079", "bodyText": "pls call it generateForTourVersion\n...we allready guessed that i created delviery days ;-)", "author": "metas-ts", "createdAt": "2020-06-09T08:28:14Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/IDeliveryDayGenerator.java", "diffHunk": "@@ -22,4 +22,6 @@\n \tvoid setDateFrom(final LocalDate dateFrom);\n \n \tvoid generate(String trxName);\n+\n+\tvoid generateDeliveryDaysForTourVersion(String trxName, I_M_TourVersion tourVersion);", "originalCommit": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI4OTM1MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r439289351", "bodyText": "Done!", "author": "dragospodariu96", "createdAt": "2020-06-12T08:44:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIyODA3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "0bc67d63369ebd565f8bb7e03acdb57368735777", "chunk": "diff --git a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/IDeliveryDayGenerator.java b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/IDeliveryDayGenerator.java\nindex 2caf492ae0..256017a4fe 100644\n--- a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/IDeliveryDayGenerator.java\n+++ b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/api/IDeliveryDayGenerator.java\n\n@@ -23,5 +23,5 @@ public interface IDeliveryDayGenerator\n \n \tvoid generate(String trxName);\n \n-\tvoid generateDeliveryDaysForTourVersion(String trxName, I_M_TourVersion tourVersion);\n+\tvoid generateForTourVersion(String trxName, I_M_TourVersion tourVersion);\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzOTA0Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r437239047", "bodyText": "please use the modern way of assigning parameters in this process (de.metas.process.Param annotation)", "author": "metas-ts", "createdAt": "2020-06-09T08:45:23Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java", "diffHunk": "@@ -92,6 +93,11 @@ else if (PARAM_DateTo.equals(name))\n \t\t{\n \t\t\tp_tour = InterfaceWrapperHelper.create(getCtx(), getRecord_ID(), I_M_Tour.class, ITrx.TRXNAME_None);\n \t\t}\n+\t\tif (I_M_TourVersion.Table_Name.equals(getTableName()) && getRecord_ID() > 0)", "originalCommit": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI4OTI2NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r439289264", "bodyText": "Done!", "author": "dragospodariu96", "createdAt": "2020-06-12T08:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzOTA0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "0bc67d63369ebd565f8bb7e03acdb57368735777", "chunk": "diff --git a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\nindex 5e74db1ec6..fc70c4ea0c 100644\n--- a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\n+++ b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\n\n@@ -74,21 +73,6 @@ public class GenerateDeliveryDays extends JavaProcess implements IProcessPrecond\n \t@Override\n \tprotected void prepare()\n \t{\n-\t\tfor (final ProcessInfoParameter para : getParametersAsArray())\n-\t\t{\n-\t\t\tfinal String name = para.getParameterName();\n-\t\t\tif (para.getParameter() == null)\n-\t\t\t\t;\n-\t\t\telse if (PARAM_DateFrom.equals(name))\n-\t\t\t{\n-\t\t\t\tp_DateFrom = (Timestamp)para.getParameter();\n-\t\t\t}\n-\t\t\telse if (PARAM_DateTo.equals(name))\n-\t\t\t{\n-\t\t\t\tp_DateTo = (Timestamp)para.getParameter();\n-\t\t\t}\n-\t\t}\n-\n \t\tif (I_M_Tour.Table_Name.equals(getTableName()) && getRecord_ID() > 0)\n \t\t{\n \t\t\tp_tour = InterfaceWrapperHelper.create(getCtx(), getRecord_ID(), I_M_Tour.class, ITrx.TRXNAME_None);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0MDIyMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r437240223", "bodyText": "as written in the channel, i'm unsure about the role of p_DateFrom and p_DateTo in case a  p_tourVersion is selected.\nMaybe you should preset them? see IProcessDefaultParametersProvider", "author": "metas-ts", "createdAt": "2020-06-09T08:47:08Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java", "diffHunk": "@@ -58,18 +58,19 @@\n \tprivate Timestamp p_DateFrom = null;\n \tprivate Timestamp p_DateTo = null;", "originalCommit": "9b3d6e04c594036f726ab8599ef2ed65ee648304", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI4OTc2Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6804#discussion_r439289762", "bodyText": "Clarified with Mark, we shall leave the behaviour as it is in the tour window. Parameters are set and overwritten if necessary", "author": "dragospodariu96", "createdAt": "2020-06-12T08:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI0MDIyMw=="}], "type": "inlineReview", "revised_code": {"commit": "0bc67d63369ebd565f8bb7e03acdb57368735777", "chunk": "diff --git a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\nindex 5e74db1ec6..fc70c4ea0c 100644\n--- a/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\n+++ b/backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/tourplanning/process/GenerateDeliveryDays.java\n\n@@ -51,12 +51,11 @@ public class GenerateDeliveryDays extends JavaProcess implements IProcessPrecond\n \t// Services\n \tprivate final ITourBL tourBL = Services.get(ITourBL.class);\n \n-\t//\n-\t// Parameters\n-\tprivate static final String PARAM_DateFrom = \"DateFrom\";\n-\tprivate static final String PARAM_DateTo = \"DateTo\";\n-\tprivate Timestamp p_DateFrom = null;\n-\tprivate Timestamp p_DateTo = null;\n+\t@Param(parameterName = \"DateFrom\")\n+\tprivate Timestamp p_DateFrom;\n+\t@Param(parameterName = \"DateTo\")\n+\tprivate Timestamp p_DateTo;\n+\n \tprivate I_M_Tour p_tour = null;\n \tprivate I_M_TourVersion p_tourVersion = null;\n \n"}}, {"oid": "f02aa4e0499205ae24e171e434bf3af09de0ec0a", "url": "https://github.com/metasfresh/metasfresh/commit/f02aa4e0499205ae24e171e434bf3af09de0ec0a", "message": "#6803 Added Unit Tests + Handling the case when valid from > valid to.", "committedDate": "2020-06-09T10:42:03Z", "type": "commit"}, {"oid": "2efff0685e64b81304e0f17da6d98218cfa0dcde", "url": "https://github.com/metasfresh/metasfresh/commit/2efff0685e64b81304e0f17da6d98218cfa0dcde", "message": "unrelated build problem fix", "committedDate": "2020-06-09T13:40:57Z", "type": "commit"}, {"oid": "0bd57faec1b92b60bdda1fdfd636db0ad6f8b984", "url": "https://github.com/metasfresh/metasfresh/commit/0bd57faec1b92b60bdda1fdfd636db0ad6f8b984", "message": "Merge remote-tracking branch 'origin/gh6803' into gh6803", "committedDate": "2020-06-09T13:41:32Z", "type": "commit"}, {"oid": "0bc67d63369ebd565f8bb7e03acdb57368735777", "url": "https://github.com/metasfresh/metasfresh/commit/0bc67d63369ebd565f8bb7e03acdb57368735777", "message": "#6803 Implemented review notes.", "committedDate": "2020-06-12T09:12:36Z", "type": "commit"}, {"oid": "0b7fba2ac249e1485da5caa351b12a47540048fa", "url": "https://github.com/metasfresh/metasfresh/commit/0b7fba2ac249e1485da5caa351b12a47540048fa", "message": "Merge remote-tracking branch 'origin/gh6803' into gh6803", "committedDate": "2020-06-12T09:13:09Z", "type": "commit"}]}