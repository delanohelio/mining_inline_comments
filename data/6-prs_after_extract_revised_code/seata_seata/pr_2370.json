{"pr_number": 2370, "pr_title": "feature: failureHandler implement can be read from the container", "pr_createdAt": "2020-03-06T14:50:21Z", "pr_url": "https://github.com/seata/seata/pull/2370", "timeline": [{"oid": "783d71310af2df48f26397055b70c7cf39db6dc7", "url": "https://github.com/seata/seata/commit/783d71310af2df48f26397055b70c7cf39db6dc7", "message": "FailureHandler implement can be read from the container", "committedDate": "2020-03-06T14:48:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyOTA5OA==", "url": "https://github.com/seata/seata/pull/2370#discussion_r389229098", "bodyText": "Test failed, custom FailureHandler implementation has not yet been instantiated.", "author": "zjinlei", "createdAt": "2020-03-07T05:10:47Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "diffHunk": "@@ -287,6 +283,17 @@ public void afterPropertiesSet() {\n         }\n         initClient();\n \n+        setCustomFailureHandler();\n+    }\n+\n+    private void setCustomFailureHandler() {\n+        if (failureHandlerHook == null) {\n+            try {\n+                failureHandlerHook = applicationContext.getBean(FailureHandler.class);", "originalCommit": "783d71310af2df48f26397055b70c7cf39db6dc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzMDc2OA==", "url": "https://github.com/seata/seata/pull/2370#discussion_r389230768", "bodyText": "Unit tests have passed,Is the custom FailureHandler in the container?If there is no customization, FailureHandler  is null,Because GlobalTransactionalInterceptor has a default", "author": "ph3636", "createdAt": "2020-03-07T05:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyOTA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzMjY0Ng==", "url": "https://github.com/seata/seata/pull/2370#discussion_r389232646", "bodyText": "Custom FailureHandler implementation need be instantiated before GlobalTransactionScanner initialization.\nUnit tests initialize the GlobalTransactionScanner first.", "author": "zjinlei", "createdAt": "2020-03-07T06:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIyOTA5OA=="}], "type": "inlineReview", "revised_code": {"commit": "c77dcfab80bdd25bba1fc20638073b872d348dd9", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\nindex 8bf04b7d..8bf173c0 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n\n@@ -282,18 +281,6 @@ public class GlobalTransactionScanner extends AbstractAutoProxyCreator\n             return;\n         }\n         initClient();\n-\n-        setCustomFailureHandler();\n-    }\n-\n-    private void setCustomFailureHandler() {\n-        if (failureHandlerHook == null) {\n-            try {\n-                failureHandlerHook = applicationContext.getBean(FailureHandler.class);\n-            } catch (NoSuchBeanDefinitionException ex) {\n-                // ignore\n-            }\n-        }\n     }\n \n     @Override\n"}}, {"oid": "d9b05c9b150cad31728d01585d9f652ca93636c6", "url": "https://github.com/seata/seata/commit/d9b05c9b150cad31728d01585d9f652ca93636c6", "message": "Merge branch 'develop' into CustomFailureHandler", "committedDate": "2020-03-07T12:10:50Z", "type": "commit"}, {"oid": "c77dcfab80bdd25bba1fc20638073b872d348dd9", "url": "https://github.com/seata/seata/commit/c77dcfab80bdd25bba1fc20638073b872d348dd9", "message": "FailureHandler implement can be read from the container", "committedDate": "2020-03-11T10:26:31Z", "type": "commit"}, {"oid": "b15b126c16f6377e2b56178682714a02b367b48f", "url": "https://github.com/seata/seata/commit/b15b126c16f6377e2b56178682714a02b367b48f", "message": "Merge branch 'develop' into CustomFailureHandler", "committedDate": "2020-03-11T10:26:38Z", "type": "commit"}, {"oid": "5f46aabee24adbcd1998141df9843430c9e4b2e2", "url": "https://github.com/seata/seata/commit/5f46aabee24adbcd1998141df9843430c9e4b2e2", "message": "add final", "committedDate": "2020-03-11T10:29:26Z", "type": "commit"}, {"oid": "d6bb5ca8dba4ee272e86c1d67868f7b830167de3", "url": "https://github.com/seata/seata/commit/d6bb5ca8dba4ee272e86c1d67868f7b830167de3", "message": "Merge remote-tracking branch 'origin/CustomFailureHandler' into CustomFailureHandler", "committedDate": "2020-03-11T10:29:43Z", "type": "commit"}, {"oid": "1e56c4edc2fd4fbf1f520a50c263dedef016fe4b", "url": "https://github.com/seata/seata/commit/1e56c4edc2fd4fbf1f520a50c263dedef016fe4b", "message": "Merge branch 'develop' into CustomFailureHandler", "committedDate": "2020-03-12T17:07:19Z", "type": "commit"}, {"oid": "7341af3a3a37d54fac8d8b5742887d3640341e69", "url": "https://github.com/seata/seata/commit/7341af3a3a37d54fac8d8b5742887d3640341e69", "message": "Merge branch 'develop' into CustomFailureHandler", "committedDate": "2020-03-15T16:12:33Z", "type": "commit"}, {"oid": "1289c1ae7d89a9d077eb90697a8794d5a9eb7882", "url": "https://github.com/seata/seata/commit/1289c1ae7d89a9d077eb90697a8794d5a9eb7882", "message": "Merge branch 'develop' into CustomFailureHandler", "committedDate": "2020-03-25T08:37:21Z", "type": "commit"}]}