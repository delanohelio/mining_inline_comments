{"pr_number": 2575, "pr_title": "bugfix: fix executeBatch can not get targetSql in Statement mode", "pr_createdAt": "2020-04-19T10:39:12Z", "pr_url": "https://github.com/seata/seata/pull/2575", "timeline": [{"oid": "650dd774e5af250566735548b2cd597790d220b9", "url": "https://github.com/seata/seata/commit/650dd774e5af250566735548b2cd597790d220b9", "message": "fix bug#2537 jdbcTemplate batchUpdate can not get targetSql", "committedDate": "2020-04-19T10:36:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg5NzU1OQ==", "url": "https://github.com/seata/seata/pull/2575#discussion_r410897559", "bodyText": "If the business sql has \";\", the spliced sql will be wrong.\nBut the business side can handle it, and it can be changed here or not.", "author": "zjinlei", "createdAt": "2020-04-19T12:50:55Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/StatementProxy.java", "diffHunk": "@@ -113,6 +114,16 @@ public boolean execute(String sql, String[] columnNames) throws SQLException {\n         return ExecuteTemplate.execute(this, (statement, args) -> statement.execute((String) args[0],(String[])args[1]), sql,columnNames);\n     }\n \n+    @Override\n+    public void addBatch(String sql) throws SQLException {\n+        if (StringUtils.isNotBlank(targetSQL)) {\n+            targetSQL += \"; \" + sql;", "originalCommit": "650dd774e5af250566735548b2cd597790d220b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMDIyOQ==", "url": "https://github.com/seata/seata/pull/2575#discussion_r410910229", "bodyText": "There may be problems using split characters here. The best strategy is to store sql in List", "author": "HankDevelop", "createdAt": "2020-04-19T13:48:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg5NzU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkxMTU3MA==", "url": "https://github.com/seata/seata/pull/2575#discussion_r410911570", "bodyText": "There may be problems using split characters here. The best strategy is to store sql in List\n\nReleased soon, no major changes.", "author": "zjinlei", "createdAt": "2020-04-19T13:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg5NzU1OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a2fca3b7ca0f5143c7f9591b6921d2c07f24945a", "url": "https://github.com/seata/seata/commit/a2fca3b7ca0f5143c7f9591b6921d2c07f24945a", "message": "fix unit test at io.seata.rm.datasource.StatementProxyTest#testGetTargetSQL", "committedDate": "2020-04-19T14:20:29Z", "type": "commit"}]}