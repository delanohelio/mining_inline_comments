{"pr_number": 2275, "pr_title": "feature: support hsf on TCC transaction mode", "pr_createdAt": "2020-02-20T02:12:49Z", "pr_url": "https://github.com/seata/seata/pull/2275", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NDc4OQ==", "url": "https://github.com/seata/seata/pull/2275#discussion_r394884789", "bodyText": "I think  !SpringProxyUtils.isProxy Contains the !(bean instanceof SpringProxy)) condition.", "author": "slievrly", "createdAt": "2020-03-19T09:16:31Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "diffHunk": "@@ -227,7 +227,7 @@ protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey)\n                 }\n \n                 LOGGER.info(\"Bean[{}] with name [{}] would use interceptor [{}]\", bean.getClass().getName(), beanName, interceptor.getClass().getName());\n-                if (!AopUtils.isAopProxy(bean)) {\n+                if (!SpringProxyUtils.isProxy(bean) || !(bean instanceof SpringProxy)) {", "originalCommit": "6382ed62eea5d90b862bd331f1c87cb4f8da4d8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NzkzNw==", "url": "https://github.com/seata/seata/pull/2275#discussion_r394887937", "bodyText": "!SpringProxyUtils.isProxy(bean) -> !AopUtils.isAopProxy(bean)  -> !((object instanceof SpringProxy && (Proxy.isProxyClass(object.getClass()) || ClassUtils.isCglibProxyClass(object.getClass())))) -> !(bean instanceof SpringProxy)) || !((Proxy.isProxyClass(object.getClass()) || ClassUtils.isCglibProxyClass(object.getClass()))))) ->   !(bean instanceof SpringProxy)) || (!Proxy.isProxyClass(object.getClass()) && !ClassUtils.isCglibProxyClass(object.getClass())))", "author": "slievrly", "createdAt": "2020-03-19T09:22:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NDc4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f9c367ffd1ac0674086fef1e82a1cb720d240703", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\nindex 0ae131dec7..1a0f209856 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n\n@@ -227,7 +222,7 @@ public class GlobalTransactionScanner extends AbstractAutoProxyCreator\n                 }\n \n                 LOGGER.info(\"Bean[{}] with name [{}] would use interceptor [{}]\", bean.getClass().getName(), beanName, interceptor.getClass().getName());\n-                if (!SpringProxyUtils.isProxy(bean) || !(bean instanceof SpringProxy)) {\n+                if (!AopUtils.isAopProxy(bean)) {\n                     bean = super.wrapIfNecessary(bean, beanName, cacheKey);\n                 } else {\n                     AdvisedSupport advised = SpringProxyUtils.getAdvisedSupport(bean);\n"}}, {"oid": "f9c367ffd1ac0674086fef1e82a1cb720d240703", "url": "https://github.com/seata/seata/commit/f9c367ffd1ac0674086fef1e82a1cb720d240703", "message": "add hsf parser\nfixes #2248", "committedDate": "2020-04-16T10:30:13Z", "type": "commit"}, {"oid": "f9c367ffd1ac0674086fef1e82a1cb720d240703", "url": "https://github.com/seata/seata/commit/f9c367ffd1ac0674086fef1e82a1cb720d240703", "message": "add hsf parser\nfixes #2248", "committedDate": "2020-04-16T10:30:13Z", "type": "forcePushed"}]}