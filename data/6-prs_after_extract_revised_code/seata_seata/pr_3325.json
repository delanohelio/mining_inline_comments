{"pr_number": 3325, "pr_title": "bugfix: fix retry commit unsuccess when record subMachineInst failed", "pr_createdAt": "2020-12-01T09:20:09Z", "pr_url": "https://github.com/seata/seata/pull/3325", "timeline": [{"oid": "c6f54466840204f12cbc30705c66433e2f962547", "url": "https://github.com/seata/seata/commit/c6f54466840204f12cbc30705c66433e2f962547", "message": "bugfix: fix retry-commit failed on record subMachineInst failed", "committedDate": "2020-12-01T08:56:31Z", "type": "commit"}, {"oid": "1875ca6b9161d4b34144b892a62ed8e5218cbced", "url": "https://github.com/seata/seata/commit/1875ca6b9161d4b34144b892a62ed8e5218cbced", "message": "fix: use originalStateInst instead", "committedDate": "2020-12-02T04:52:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQxMzA5Mw==", "url": "https://github.com/seata/seata/pull/3325#discussion_r533413093", "bodyText": "Need to use originalStateInst", "author": "long187", "createdAt": "2020-12-01T13:39:18Z", "path": "saga/seata-saga-engine/src/main/java/io/seata/saga/engine/pcext/handlers/SubStateMachineHandler.java", "diffHunk": "@@ -190,9 +190,7 @@ private StateMachineInstance forwardStateMachine(Map<String, Object> startParams\n \n             return engine.forward(subInstId, startParams);\n         } else {\n-            throw new ForwardInvalidException(\n-                \"Cannot find sub statemachine [\" + subStateMachine.getStateMachineName() + \"]\",\n-                FrameworkErrorCode.ObjectNotExists);\n+            return startNewStateMachine(startParams, engine, stateInstance, subStateMachine);", "originalCommit": "c6f54466840204f12cbc30705c66433e2f962547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk5NTk5NA==", "url": "https://github.com/seata/seata/pull/3325#discussion_r537995994", "bodyText": "fixed, use originalStateInst instead", "author": "anselleeyy", "createdAt": "2020-12-08T02:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQxMzA5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "1875ca6b9161d4b34144b892a62ed8e5218cbced", "chunk": "diff --git a/saga/seata-saga-engine/src/main/java/io/seata/saga/engine/pcext/handlers/SubStateMachineHandler.java b/saga/seata-saga-engine/src/main/java/io/seata/saga/engine/pcext/handlers/SubStateMachineHandler.java\nindex 3da4eab1f7..30b27320a5 100644\n--- a/saga/seata-saga-engine/src/main/java/io/seata/saga/engine/pcext/handlers/SubStateMachineHandler.java\n+++ b/saga/seata-saga-engine/src/main/java/io/seata/saga/engine/pcext/handlers/SubStateMachineHandler.java\n\n@@ -190,7 +190,8 @@ public class SubStateMachineHandler implements StateHandler, InterceptableStateH\n \n             return engine.forward(subInstId, startParams);\n         } else {\n-            return startNewStateMachine(startParams, engine, stateInstance, subStateMachine);\n+            originalStateInst.setStateMachineInstance(stateInstance.getStateMachineInstance());\n+            return startNewStateMachine(startParams, engine, originalStateInst, subStateMachine);\n         }\n     }\n \n"}}]}