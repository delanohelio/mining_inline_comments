{"pr_number": 3129, "pr_title": "bugfix: forbidding execute SQL which update pk value", "pr_createdAt": "2020-09-18T03:50:52Z", "pr_url": "https://github.com/seata/seata/pull/3129", "timeline": [{"oid": "0357e578a5360c7c1a1c2a30b125d3ee9dfeb3ae", "url": "https://github.com/seata/seata/commit/0357e578a5360c7c1a1c2a30b125d3ee9dfeb3ae", "message": "bugfix:update pk value", "committedDate": "2020-09-18T03:45:54Z", "type": "commit"}, {"oid": "9b5900a3605213fd36eb08f64accacafce6fef73", "url": "https://github.com/seata/seata/commit/9b5900a3605213fd36eb08f64accacafce6fef73", "message": "opt format", "committedDate": "2020-09-18T06:01:38Z", "type": "commit"}, {"oid": "490023228f0760296f72db848af173627105735d", "url": "https://github.com/seata/seata/commit/490023228f0760296f72db848af173627105735d", "message": "Merge branch 'develop' into fix_update_pk_bug", "committedDate": "2020-10-10T07:49:07Z", "type": "commit"}, {"oid": "a9cc2cdf2ca712e140aeb703191a45e413550f3e", "url": "https://github.com/seata/seata/commit/a9cc2cdf2ca712e140aeb703191a45e413550f3e", "message": "Merge branch 'develop' into fix_update_pk_bug", "committedDate": "2020-10-10T07:59:30Z", "type": "commit"}, {"oid": "596e5a37557b5b9e9305ed06d89600d71c481529", "url": "https://github.com/seata/seata/commit/596e5a37557b5b9e9305ed06d89600d71c481529", "message": "Merge branch 'develop' into fix_update_pk_bug", "committedDate": "2020-10-10T10:19:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NDg3OA==", "url": "https://github.com/seata/seata/pull/3129#discussion_r502774878", "bodyText": "return boolean? control of exception by caller?", "author": "jsbxyyx", "createdAt": "2020-10-10T10:25:53Z", "path": "rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java", "diffHunk": "@@ -172,4 +173,13 @@ public static boolean isLockRetryPolicyBranchRollbackOnConflict() {\n             return LOCK_RETRY_POLICY_BRANCH_ROLLBACK_ON_CONFLICT;\n         }\n     }\n+\n+    protected void isUpdatePkValue(List<String> updateColumns) {", "originalCommit": "596e5a37557b5b9e9305ed06d89600d71c481529", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NTgwMA==", "url": "https://github.com/seata/seata/pull/3129#discussion_r502775800", "bodyText": "I think this is unnecessary. It just checks if the param is legal. There is nothing to control by the caller.", "author": "0000005", "createdAt": "2020-10-10T10:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NDg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk5NDE4MQ==", "url": "https://github.com/seata/seata/pull/3129#discussion_r502994181", "bodyText": "this method is more suitable placed in UpdateExecutor or MultiUpdateExecutor. or rename method name.", "author": "jsbxyyx", "createdAt": "2020-10-12T01:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NDg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzAwNjE2NQ==", "url": "https://github.com/seata/seata/pull/3129#discussion_r503006165", "bodyText": "What method name do you want? Please give me some advice", "author": "0000005", "createdAt": "2020-10-12T02:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NDg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA1MzA4Mw==", "url": "https://github.com/seata/seata/pull/3129#discussion_r509053083", "bodyText": "how about assertContainsPKColumnName?", "author": "jsbxyyx", "createdAt": "2020-10-21T07:35:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc3NDg3OA=="}], "type": "inlineReview", "revised_code": {"commit": "5796892ff6268d58bfb9f0d03e7a57b848dad1ab", "chunk": "diff --git a/rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java b/rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java\nindex d846934eb..ab7383206 100644\n--- a/rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java\n+++ b/rm-datasource/src/main/java/io/seata/rm/datasource/exec/AbstractDMLBaseExecutor.java\n\n@@ -174,7 +174,7 @@ public abstract class AbstractDMLBaseExecutor<T, S extends Statement> extends Ba\n         }\n     }\n \n-    protected void isUpdatePkValue(List<String> updateColumns) {\n+    protected void assertContainsPKColumnName(List<String> updateColumns) {\n         for (String columnName : updateColumns) {\n             String standardColumnName = getStandardPkColumnName(columnName);\n             if (StringUtils.isNotEmpty(standardColumnName)) {\n"}}, {"oid": "5b3900ff8db08eaf9754076f7371be87b758804c", "url": "https://github.com/seata/seata/commit/5b3900ff8db08eaf9754076f7371be87b758804c", "message": "Merge branch 'develop' into fix_update_pk_bug", "committedDate": "2020-10-10T10:28:11Z", "type": "commit"}, {"oid": "df7c40f3435b5dadf2a4e2fefc8a3c1a614dad64", "url": "https://github.com/seata/seata/commit/df7c40f3435b5dadf2a4e2fefc8a3c1a614dad64", "message": "Merge remote-tracking branch 'origin/develop' into fix_update_pk_bug\n\n# Conflicts:\n#\trm-datasource/src/main/java/io/seata/rm/datasource/exec/BaseInsertExecutor.java", "committedDate": "2020-10-22T02:42:49Z", "type": "commit"}, {"oid": "5796892ff6268d58bfb9f0d03e7a57b848dad1ab", "url": "https://github.com/seata/seata/commit/5796892ff6268d58bfb9f0d03e7a57b848dad1ab", "message": "change method name", "committedDate": "2020-10-22T02:43:39Z", "type": "commit"}, {"oid": "b6a1f38f04fc66593edfe4fa1bc075dbe4f4e708", "url": "https://github.com/seata/seata/commit/b6a1f38f04fc66593edfe4fa1bc075dbe4f4e708", "message": "Merge remote-tracking branch 'myGithub/fix_update_pk_bug' into fix_update_pk_bug", "committedDate": "2020-10-22T02:45:26Z", "type": "commit"}]}