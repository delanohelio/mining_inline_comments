{"pr_number": 2776, "pr_title": "optimize: paramsPlaceHolder generate by StringUtils.repeat()", "pr_createdAt": "2020-06-08T03:19:27Z", "pr_url": "https://github.com/seata/seata/pull/2776", "timeline": [{"oid": "d97136712b96464719d5e4d02cd8b4c8cfbbf1f9", "url": "https://github.com/seata/seata/commit/d97136712b96464719d5e4d02cd8b4c8cfbbf1f9", "message": "paramsPlaceHolder generate by StringUtils.repeat()\n\nparamsPlaceHolder generate by StringUtils.repeat()", "committedDate": "2020-06-08T03:13:42Z", "type": "commit"}, {"oid": "08d287dc5985daaf2fefce63a7d1358f195f6be6", "url": "https://github.com/seata/seata/commit/08d287dc5985daaf2fefce63a7d1358f195f6be6", "message": "Update LogStoreDataBaseDAO.java", "committedDate": "2020-06-08T06:59:28Z", "type": "commit"}, {"oid": "21a7855effecf1df0785a3acef964832a239a33a", "url": "https://github.com/seata/seata/commit/21a7855effecf1df0785a3acef964832a239a33a", "message": "Merge branch 'develop' into patch-1", "committedDate": "2020-06-08T08:03:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEwNjMzNQ==", "url": "https://github.com/seata/seata/pull/2776#discussion_r437106335", "bodyText": "extract repeat method to io.seata.common.util.StringUtils?", "author": "jsbxyyx", "createdAt": "2020-06-09T02:42:33Z", "path": "server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java", "diffHunk": "@@ -165,15 +164,9 @@ public GlobalTransactionDO queryGlobalTransactionDO(long transactionId) {\n             conn = logStoreDataSource.getConnection();\n             conn.setAutoCommit(true);\n \n-            StringBuilder sb = new StringBuilder();\n-            for (int i = 0; i < statuses.length; i++) {\n-                sb.append(\"?\");\n-                if (i != (statuses.length - 1)) {\n-                    sb.append(\", \");\n-                }\n-            }\n+            String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\",\",\",statuses.length);", "originalCommit": "21a7855effecf1df0785a3acef964832a239a33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEwOTk2Nw==", "url": "https://github.com/seata/seata/pull/2776#discussion_r437109967", "bodyText": "I don't think it's necessary.", "author": "xianlaioy", "createdAt": "2020-06-09T02:56:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEwNjMzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExMzc3OA==", "url": "https://github.com/seata/seata/pull/2776#discussion_r437113778", "bodyText": "the apache common langs jar often conflicts with other libraries. convenient direct replacement.", "author": "jsbxyyx", "createdAt": "2020-06-09T03:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzEwNjMzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "746b542cc912a592cfc49d214dd196ec2e4f9b28", "chunk": "diff --git a/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java b/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\nindex 3702a4dc2..058723193 100644\n--- a/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\n+++ b/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\n\n@@ -164,7 +164,7 @@ public class LogStoreDataBaseDAO implements LogStore {\n             conn = logStoreDataSource.getConnection();\n             conn.setAutoCommit(true);\n \n-            String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\",\",\",statuses.length);\n+            String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\", \",\", statuses.length);;\n \n             String sql = LogStoreSqlsFactory.getLogStoreSqls(dbType).getQueryGlobalTransactionSQLByStatus(globalTable, paramsPlaceHolder);\n             ps = conn.prepareStatement(sql);\n"}}, {"oid": "962f1e192e6bc5c1525299454c8bb5495bd444b6", "url": "https://github.com/seata/seata/commit/962f1e192e6bc5c1525299454c8bb5495bd444b6", "message": "Merge branch 'develop' into patch-1", "committedDate": "2020-06-09T03:18:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzExNzc3OQ==", "url": "https://github.com/seata/seata/pull/2776#discussion_r437117779", "bodyText": "for better readability, please add a space in the separator.   \",\"-> \", \"", "author": "slievrly", "createdAt": "2020-06-09T03:29:44Z", "path": "server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java", "diffHunk": "@@ -288,11 +281,9 @@ public boolean deleteGlobalTransactionDO(GlobalTransactionDO globalTransactionDO\n     @Override\n     public List<BranchTransactionDO> queryBranchTransactionDO(List<String> xids) {\n         int length = xids.size();\n-        int retsSize = length * 3;\n-        List<BranchTransactionDO> rets = new ArrayList<>(retsSize);\n-        StringJoiner sj = new StringJoiner(\",\");\n-        xids.stream().forEach(xid -> sj.add(\"?\"));\n-        String sql = LogStoreSqlsFactory.getLogStoreSqls(dbType).getQueryBranchTransaction(brachTable, sj.toString());\n+        List<BranchTransactionDO> rets = new ArrayList<>(length * 3);\n+        String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\",\",\",length);", "originalCommit": "962f1e192e6bc5c1525299454c8bb5495bd444b6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "746b542cc912a592cfc49d214dd196ec2e4f9b28", "chunk": "diff --git a/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java b/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\nindex 3702a4dc2..058723193 100644\n--- a/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\n+++ b/server/src/main/java/io/seata/server/storage/db/store/LogStoreDataBaseDAO.java\n\n@@ -282,7 +282,7 @@ public class LogStoreDataBaseDAO implements LogStore {\n     public List<BranchTransactionDO> queryBranchTransactionDO(List<String> xids) {\n         int length = xids.size();\n         List<BranchTransactionDO> rets = new ArrayList<>(length * 3);\n-        String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\",\",\",length);\n+        String paramsPlaceHolder = org.apache.commons.lang.StringUtils.repeat(\"?\", \",\", length);\n         String sql = LogStoreSqlsFactory.getLogStoreSqls(dbType).getQueryBranchTransaction(brachTable, paramsPlaceHolder);\n         Connection conn = null;\n         PreparedStatement ps = null;\n"}}, {"oid": "746b542cc912a592cfc49d214dd196ec2e4f9b28", "url": "https://github.com/seata/seata/commit/746b542cc912a592cfc49d214dd196ec2e4f9b28", "message": "code style format", "committedDate": "2020-06-09T03:43:52Z", "type": "commit"}, {"oid": "1ad5fffde3877545de5e2fc5ee8ca12586885e5d", "url": "https://github.com/seata/seata/commit/1ad5fffde3877545de5e2fc5ee8ca12586885e5d", "message": "Update LogStoreDataBaseDAO.java", "committedDate": "2020-06-09T03:48:44Z", "type": "commit"}, {"oid": "28b65a45a3c110ca4a0ea7c1ac41d1aeb00dde70", "url": "https://github.com/seata/seata/commit/28b65a45a3c110ca4a0ea7c1ac41d1aeb00dde70", "message": "Merge branch 'develop' into patch-1", "committedDate": "2020-06-09T04:01:08Z", "type": "commit"}, {"oid": "61711f427bbb448cd34f9989cdd891f4702cd6f4", "url": "https://github.com/seata/seata/commit/61711f427bbb448cd34f9989cdd891f4702cd6f4", "message": "Merge branch 'develop' into patch-1", "committedDate": "2020-06-22T02:54:11Z", "type": "commit"}, {"oid": "29942d595bd649995a467bafd306d64996d70c92", "url": "https://github.com/seata/seata/commit/29942d595bd649995a467bafd306d64996d70c92", "message": "Merge branch 'develop' into patch-1", "committedDate": "2020-06-24T08:00:46Z", "type": "commit"}]}