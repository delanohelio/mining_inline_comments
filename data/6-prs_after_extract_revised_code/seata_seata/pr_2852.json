{"pr_number": 2852, "pr_title": "feature: support configuring scan target for GlobalTransactionScanner", "pr_createdAt": "2020-07-02T10:38:17Z", "pr_url": "https://github.com/seata/seata/pull/2852", "timeline": [{"oid": "c2b01fe76d02ddb5326c6a808cdf663384ab7f31", "url": "https://github.com/seata/seata/commit/c2b01fe76d02ddb5326c6a808cdf663384ab7f31", "message": "feature: Can exclude beans that do not need to be scanned in the GlobalTransactionScanner", "committedDate": "2020-07-02T10:32:47Z", "type": "commit"}, {"oid": "3c2c7c37e0f970f0702fc84f0777faf42e3856d2", "url": "https://github.com/seata/seata/commit/3c2c7c37e0f970f0702fc84f0777faf42e3856d2", "message": "\u6dfb\u52a0\u626b\u63cf\u6392\u9664\u5668\u63a5\u53e3\uff0c\u5e76\u5f00\u53d1\u4e86\u4e09\u79cd\u6dfb\u52a0\u6392\u9664\u5668\u7684\u65b9\u5f0f\uff1a1\uff09spring bean, 2\uff09/META-INF/services\uff0c3\uff09GlobalTransactionScanner.addScannerExcluders()", "committedDate": "2020-07-02T15:15:32Z", "type": "commit"}, {"oid": "fd1573842c5bfea1f552b009e5d1723b92c6a501", "url": "https://github.com/seata/seata/commit/fd1573842c5bfea1f552b009e5d1723b92c6a501", "message": "fix NPE", "committedDate": "2020-07-02T15:20:52Z", "type": "commit"}, {"oid": "9f2109cc137b75032d8bf49ea5e37776556bc030", "url": "https://github.com/seata/seata/commit/9f2109cc137b75032d8bf49ea5e37776556bc030", "message": "\u5c0f\u8c03\u6574", "committedDate": "2020-07-02T15:28:32Z", "type": "commit"}, {"oid": "22424c0212495c20f6e1e96d62b0201ec03028c1", "url": "https://github.com/seata/seata/commit/22424c0212495c20f6e1e96d62b0201ec03028c1", "message": "bugfix: GlobalTransactionScanner\u7c7b\u5b9e\u73b0BeanFactoryPostProcessor\uff0c\u4f7f\u5176\u6bd4\u914d\u7f6e\u66f4\u65e9\u521d\u59cb\u5316\uff0c\u5bfc\u81f4\u914d\u7f6e\u4fe1\u606f\u65e0\u6cd5\u6b63\u5e38\u83b7\u53d6\u5e76\u8bbe\u7f6e\u5230\u5176\u4e2d\u3002", "committedDate": "2020-07-02T16:03:59Z", "type": "commit"}, {"oid": "cd1afe8688ea44c421b4ab310d2e289b746a2798", "url": "https://github.com/seata/seata/commit/cd1afe8688ea44c421b4ab310d2e289b746a2798", "message": "\u5c0f\u8c03\u6574", "committedDate": "2020-07-02T16:05:52Z", "type": "commit"}, {"oid": "e9abd2d9e24439665949028b8a63a3a9daa89968", "url": "https://github.com/seata/seata/commit/e9abd2d9e24439665949028b8a63a3a9daa89968", "message": "\u79fb\u9664\u4e3anull\u7684\u6392\u9664\u5668", "committedDate": "2020-07-02T16:20:08Z", "type": "commit"}, {"oid": "f8f77d06394a233428e571d6c108757453f6b6ee", "url": "https://github.com/seata/seata/commit/f8f77d06394a233428e571d6c108757453f6b6ee", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-07-03T01:32:46Z", "type": "commit"}, {"oid": "2cf2e598b272a01a16cb2dbab32844e40e9fdea8", "url": "https://github.com/seata/seata/commit/2cf2e598b272a01a16cb2dbab32844e40e9fdea8", "message": "\u6dfb\u52a0Scope\u626b\u63cf\u6392\u9664\u5668\u3002\u76ee\u524d\u6392\u9664\u4e86request\u3001session\u3001job\u3001step\u56db\u79cdscope.", "committedDate": "2020-07-03T03:05:05Z", "type": "commit"}, {"oid": "5f189cf3f766b8c9ff16a61676fec046a188cedb", "url": "https://github.com/seata/seata/commit/5f189cf3f766b8c9ff16a61676fec046a188cedb", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-03T03:17:33Z", "type": "commit"}, {"oid": "b7cef8e45a3b51587edf4c0073f8a8a1e0e34ae4", "url": "https://github.com/seata/seata/commit/b7cef8e45a3b51587edf4c0073f8a8a1e0e34ae4", "message": "\u6355\u83b7\u4e00\u4e0bNoSuchBeanDefinitionException\u7684\u5f02\u5e38\u3002", "committedDate": "2020-07-03T09:09:34Z", "type": "commit"}, {"oid": "61f4e70378724912eb4c29953a98b1c984172935", "url": "https://github.com/seata/seata/commit/61f4e70378724912eb4c29953a98b1c984172935", "message": "\u7b80\u5316SeataAutoConfiguration\u7684\u90e8\u5206\u4ee3\u7801", "committedDate": "2020-07-04T13:54:41Z", "type": "commit"}, {"oid": "839ca046e248810f08ed4a422b4df639ad895fba", "url": "https://github.com/seata/seata/commit/839ca046e248810f08ed4a422b4df639ad895fba", "message": "\u4f18\u5316\u4ee3\u7801", "committedDate": "2020-07-04T14:55:35Z", "type": "commit"}, {"oid": "ce82a45a82e86267e5862fbbeb704e592902dc83", "url": "https://github.com/seata/seata/commit/ce82a45a82e86267e5862fbbeb704e592902dc83", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-04T14:56:40Z", "type": "commit"}, {"oid": "2dcac457ef375f1f4f933ef7f829d371abb81350", "url": "https://github.com/seata/seata/commit/2dcac457ef375f1f4f933ef7f829d371abb81350", "message": "\u5c0fBUG\u4fee\u590d", "committedDate": "2020-07-04T15:04:25Z", "type": "commit"}, {"oid": "9e868a1a6c94ff1150134f030e70f50465069d14", "url": "https://github.com/seata/seata/commit/9e868a1a6c94ff1150134f030e70f50465069d14", "message": "ScopeScannerExcluder\u6dfb\u52a0\u65e5\u5fd7\u3002", "committedDate": "2020-07-04T15:19:33Z", "type": "commit"}, {"oid": "60133b79ed8050dffda5097c1f967b80c1511fd6", "url": "https://github.com/seata/seata/commit/60133b79ed8050dffda5097c1f967b80c1511fd6", "message": "\u4f18\u5316\u4ee3\u7801", "committedDate": "2020-07-04T15:29:33Z", "type": "commit"}, {"oid": "0739a2d10d735f7f5e93e93983bd590315b0db02", "url": "https://github.com/seata/seata/commit/0739a2d10d735f7f5e93e93983bd590315b0db02", "message": "\u6dfb\u52a0\u6ce8\u91ca", "committedDate": "2020-07-07T01:50:37Z", "type": "commit"}, {"oid": "2b43f798092c14b3d2afc5b99b52b51e02c269a9", "url": "https://github.com/seata/seata/commit/2b43f798092c14b3d2afc5b99b52b51e02c269a9", "message": "\u4f18\u5316ScopeScannerExcluder\u3002Scope\u6ce8\u89e3\u6dfb\u52a0\u5728\u7c7b\u4e0a\u65f6\uff0c\u4e5f\u80fd\u6392\u9664\u6389\u3002", "committedDate": "2020-07-07T12:06:18Z", "type": "commit"}, {"oid": "3874c01b44078971ad1c92520c300f04ca4d8051", "url": "https://github.com/seata/seata/commit/3874c01b44078971ad1c92520c300f04ca4d8051", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-08T09:21:11Z", "type": "commit"}, {"oid": "fb28764a06237501436eac2acff4c4a0fe7def78", "url": "https://github.com/seata/seata/commit/fb28764a06237501436eac2acff4c4a0fe7def78", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-08T10:32:03Z", "type": "commit"}, {"oid": "c815c8e29e0849b3c3a749d4c3ba7d750269afc3", "url": "https://github.com/seata/seata/commit/c815c8e29e0849b3c3a749d4c3ba7d750269afc3", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-08T10:35:30Z", "type": "commit"}, {"oid": "33ad611955c2b884d2aef57d569ea725a0822bb1", "url": "https://github.com/seata/seata/commit/33ad611955c2b884d2aef57d569ea725a0822bb1", "message": "\u6dfb\u52a0\u914d\u7f6e\u7c7b\u626b\u63cf\u6392\u9664\u5668\u3002", "committedDate": "2020-07-09T07:22:47Z", "type": "commit"}, {"oid": "aaebc636b76bb37fe5b25acbfc6c2e8363504eef", "url": "https://github.com/seata/seata/commit/aaebc636b76bb37fe5b25acbfc6c2e8363504eef", "message": "\u7c7b\u540d\u8c03\u6574\u3002", "committedDate": "2020-07-09T07:45:34Z", "type": "commit"}, {"oid": "c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "url": "https://github.com/seata/seata/commit/c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-11T04:10:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzQ1NQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453153455", "bodyText": "Please define constants for those names.", "author": "xingfudeshi", "createdAt": "2020-07-11T04:24:23Z", "path": "spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.spring.annotation.scannerexcluders;\n+\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.spring.annotation.GlobalLock;\n+import io.seata.spring.annotation.GlobalTransactionScanner;\n+import io.seata.spring.annotation.GlobalTransactional;\n+import io.seata.spring.annotation.ScannerExcluder;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.aop.scope.ScopedProxyFactoryBean;\n+import org.springframework.beans.factory.annotation.AnnotatedBeanDefinition;\n+import org.springframework.beans.factory.config.BeanDefinition;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.core.type.AnnotatedTypeMetadata;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * Scope scanner excluder.\n+ *\n+ * @author wang.liang\n+ */\n+@LoadLevel(name = \"ScopeBeans\", order = 200)\n+public class ScopeBeansScannerExcluder implements ScannerExcluder {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n+    private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n+\n+    static {\n+        EXCLUDE_SCOPE_SET.add(\"request\");\n+        EXCLUDE_SCOPE_SET.add(\"session\");\n+        EXCLUDE_SCOPE_SET.add(\"step\");\n+        EXCLUDE_SCOPE_SET.add(\"job\");", "originalCommit": "c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NjM5OA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453156398", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-07-11T05:03:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzQ1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "4240ab4d4a532067f11f2f831adc4a2793232948", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\nindex 42af80f8f..31ec59cc9 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n\n@@ -46,11 +46,16 @@ public class ScopeBeansScannerExcluder implements ScannerExcluder {\n     private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n     private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n \n+    public static final String REQUEST_SCOPE_NAME = \"request\";\n+    public static final String SESSION_SCOPE_NAME = \"session\";\n+    public static final String JOB_SCOPE_NAME = \"job\";\n+    public static final String STEP_SCOPE_NAME = \"step\";\n+\n     static {\n-        EXCLUDE_SCOPE_SET.add(\"request\");\n-        EXCLUDE_SCOPE_SET.add(\"session\");\n-        EXCLUDE_SCOPE_SET.add(\"step\");\n-        EXCLUDE_SCOPE_SET.add(\"job\");\n+        EXCLUDE_SCOPE_SET.add(REQUEST_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(SESSION_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(JOB_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(STEP_SCOPE_NAME);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzgxMA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453153810", "bodyText": "Missing '@OverRide'.", "author": "xingfudeshi", "createdAt": "2020-07-11T04:28:30Z", "path": "spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.spring.annotation.scannerexcluders;\n+\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.spring.annotation.GlobalLock;\n+import io.seata.spring.annotation.GlobalTransactionScanner;\n+import io.seata.spring.annotation.GlobalTransactional;\n+import io.seata.spring.annotation.ScannerExcluder;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.aop.scope.ScopedProxyFactoryBean;\n+import org.springframework.beans.factory.annotation.AnnotatedBeanDefinition;\n+import org.springframework.beans.factory.config.BeanDefinition;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.core.type.AnnotatedTypeMetadata;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * Scope scanner excluder.\n+ *\n+ * @author wang.liang\n+ */\n+@LoadLevel(name = \"ScopeBeans\", order = 200)\n+public class ScopeBeansScannerExcluder implements ScannerExcluder {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n+    private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n+\n+    static {\n+        EXCLUDE_SCOPE_SET.add(\"request\");\n+        EXCLUDE_SCOPE_SET.add(\"session\");\n+        EXCLUDE_SCOPE_SET.add(\"step\");\n+        EXCLUDE_SCOPE_SET.add(\"job\");\n+    }\n+\n+    /**\n+     * Add more exclude scopes.\n+     *\n+     * @param scopeNames the scope names\n+     */\n+    public static void addExcludeScopes(String... scopeNames) {\n+        if (ArrayUtils.isNotEmpty(scopeNames)) {\n+            for (String scopeName : scopeNames) {\n+                if (StringUtils.isNotBlank(scopeName)) {\n+                    EXCLUDE_SCOPE_SET.add(scopeName.trim().toLowerCase());\n+                }\n+            }\n+        }\n+    }\n+\n+\n+    public boolean isMatch(Object bean, String beanName, BeanDefinition beanDefinition) throws Throwable {", "originalCommit": "c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NjM4Nw==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453156387", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-07-11T05:03:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzgxMA=="}], "type": "inlineReview", "revised_code": {"commit": "4240ab4d4a532067f11f2f831adc4a2793232948", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\nindex 42af80f8f..31ec59cc9 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n\n@@ -46,11 +46,16 @@ public class ScopeBeansScannerExcluder implements ScannerExcluder {\n     private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n     private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n \n+    public static final String REQUEST_SCOPE_NAME = \"request\";\n+    public static final String SESSION_SCOPE_NAME = \"session\";\n+    public static final String JOB_SCOPE_NAME = \"job\";\n+    public static final String STEP_SCOPE_NAME = \"step\";\n+\n     static {\n-        EXCLUDE_SCOPE_SET.add(\"request\");\n-        EXCLUDE_SCOPE_SET.add(\"session\");\n-        EXCLUDE_SCOPE_SET.add(\"step\");\n-        EXCLUDE_SCOPE_SET.add(\"job\");\n+        EXCLUDE_SCOPE_SET.add(REQUEST_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(SESSION_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(JOB_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(STEP_SCOPE_NAME);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzgzMA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453153830", "bodyText": "Missing '@OverRide'.", "author": "xingfudeshi", "createdAt": "2020-07-11T04:28:41Z", "path": "spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ConfigBeansScannerExcluder.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.spring.annotation.scannerexcluders;\n+\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.spring.annotation.ScannerExcluder;\n+import org.springframework.beans.factory.config.BeanDefinition;\n+\n+/**\n+ * Config scanner excluder.\n+ *\n+ * @author wang.liang\n+ */\n+@LoadLevel(name = \"ConfigBeans\", order = 100)\n+public class ConfigBeansScannerExcluder implements ScannerExcluder {\n+\n+    public boolean isMatch(Object bean, String beanName, BeanDefinition beanDefinition) throws Throwable {", "originalCommit": "c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NjM3MA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453156370", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-07-11T05:03:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1MzgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "4240ab4d4a532067f11f2f831adc4a2793232948", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ConfigBeansScannerExcluder.java b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ConfigBeansScannerExcluder.java\nindex 43335c5fb..64fc34f13 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ConfigBeansScannerExcluder.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ConfigBeansScannerExcluder.java\n\n@@ -27,6 +27,7 @@ import org.springframework.beans.factory.config.BeanDefinition;\n @LoadLevel(name = \"ConfigBeans\", order = 100)\n public class ConfigBeansScannerExcluder implements ScannerExcluder {\n \n+    @Override\n     public boolean isMatch(Object bean, String beanName, BeanDefinition beanDefinition) throws Throwable {\n         return beanName == null\n                 || beanName.endsWith(\"AutoConfiguration\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NDAxMg==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453154012", "bodyText": "Please don't write comments at the tail of line.Please check all places.", "author": "xingfudeshi", "createdAt": "2020-07-11T04:31:00Z", "path": "spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java", "diffHunk": "@@ -0,0 +1,120 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.spring.annotation.scannerexcluders;\n+\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.spring.annotation.GlobalLock;\n+import io.seata.spring.annotation.GlobalTransactionScanner;\n+import io.seata.spring.annotation.GlobalTransactional;\n+import io.seata.spring.annotation.ScannerExcluder;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.aop.scope.ScopedProxyFactoryBean;\n+import org.springframework.beans.factory.annotation.AnnotatedBeanDefinition;\n+import org.springframework.beans.factory.config.BeanDefinition;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.core.type.AnnotatedTypeMetadata;\n+import org.springframework.util.MultiValueMap;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * Scope scanner excluder.\n+ *\n+ * @author wang.liang\n+ */\n+@LoadLevel(name = \"ScopeBeans\", order = 200)\n+public class ScopeBeansScannerExcluder implements ScannerExcluder {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n+    private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n+\n+    static {\n+        EXCLUDE_SCOPE_SET.add(\"request\");\n+        EXCLUDE_SCOPE_SET.add(\"session\");\n+        EXCLUDE_SCOPE_SET.add(\"step\");\n+        EXCLUDE_SCOPE_SET.add(\"job\");\n+    }\n+\n+    /**\n+     * Add more exclude scopes.\n+     *\n+     * @param scopeNames the scope names\n+     */\n+    public static void addExcludeScopes(String... scopeNames) {\n+        if (ArrayUtils.isNotEmpty(scopeNames)) {\n+            for (String scopeName : scopeNames) {\n+                if (StringUtils.isNotBlank(scopeName)) {\n+                    EXCLUDE_SCOPE_SET.add(scopeName.trim().toLowerCase());\n+                }\n+            }\n+        }\n+    }\n+\n+\n+    public boolean isMatch(Object bean, String beanName, BeanDefinition beanDefinition) throws Throwable {\n+        if (bean instanceof ScopedProxyFactoryBean) {\n+            return true; // exclude", "originalCommit": "c4d85da94ec076ddc3efc8ab2f3eb3cec5cafc79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NjM2OQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453156369", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-07-11T05:03:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE1NDAxMg=="}], "type": "inlineReview", "revised_code": {"commit": "4240ab4d4a532067f11f2f831adc4a2793232948", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\nindex 42af80f8f..31ec59cc9 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/scannerexcluders/ScopeBeansScannerExcluder.java\n\n@@ -46,11 +46,16 @@ public class ScopeBeansScannerExcluder implements ScannerExcluder {\n     private static final Logger LOGGER = LoggerFactory.getLogger(ScopeBeansScannerExcluder.class);\n     private static final Set<String> EXCLUDE_SCOPE_SET = Collections.synchronizedSet(new HashSet<>());\n \n+    public static final String REQUEST_SCOPE_NAME = \"request\";\n+    public static final String SESSION_SCOPE_NAME = \"session\";\n+    public static final String JOB_SCOPE_NAME = \"job\";\n+    public static final String STEP_SCOPE_NAME = \"step\";\n+\n     static {\n-        EXCLUDE_SCOPE_SET.add(\"request\");\n-        EXCLUDE_SCOPE_SET.add(\"session\");\n-        EXCLUDE_SCOPE_SET.add(\"step\");\n-        EXCLUDE_SCOPE_SET.add(\"job\");\n+        EXCLUDE_SCOPE_SET.add(REQUEST_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(SESSION_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(JOB_SCOPE_NAME);\n+        EXCLUDE_SCOPE_SET.add(STEP_SCOPE_NAME);\n     }\n \n     /**\n"}}, {"oid": "4240ab4d4a532067f11f2f831adc4a2793232948", "url": "https://github.com/seata/seata/commit/4240ab4d4a532067f11f2f831adc4a2793232948", "message": "\u6dfb\u52a0Override\u3001\u8c03\u6574\u6ce8\u91ca", "committedDate": "2020-07-11T05:01:48Z", "type": "commit"}, {"oid": "c0e71d8b92e651196bc7e9d5f031ca7ce768a2ab", "url": "https://github.com/seata/seata/commit/c0e71d8b92e651196bc7e9d5f031ca7ce768a2ab", "message": "Merge remote-tracking branch 'origin/exclude-scanner' into exclude-scanner", "committedDate": "2020-07-11T05:01:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzI0MQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453333241", "bodyText": "Specifies beans that won't be scanned in the GlobalTransactionScanner", "author": "xingfudeshi", "createdAt": "2020-07-12T15:54:03Z", "path": "seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/SeataProperties.java", "diffHunk": "@@ -47,6 +47,10 @@\n      * Whether use JDK proxy instead of CGLIB proxy\n      */\n     private boolean useJdkProxy = false;\n+    /**\n+     * Specifies which bean do not scanner in the GlobalTransactionScanner", "originalCommit": "c0e71d8b92e651196bc7e9d5f031ca7ce768a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM5MDAwMg==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453390002", "bodyText": "done.", "author": "wangliang181230", "createdAt": "2020-07-13T01:17:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzI0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "48612f967997cb2f44ede82f02e08cc9f4a27b73", "chunk": "diff --git a/seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/SeataProperties.java b/seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/SeataProperties.java\nindex f4592f405..7598dd0fe 100644\n--- a/seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/SeataProperties.java\n+++ b/seata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/properties/SeataProperties.java\n\n@@ -48,7 +48,7 @@ public class SeataProperties {\n      */\n     private boolean useJdkProxy = false;\n     /**\n-     * Specifies which bean do not scanner in the GlobalTransactionScanner\n+     * Specifies beans that won't be scanned in the GlobalTransactionScanner\n      */\n     private String[] excludesForScanner = {};\n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzU2OQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453333569", "bodyText": "Please use {}.", "author": "xingfudeshi", "createdAt": "2020-07-12T15:57:37Z", "path": "spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "diffHunk": "@@ -200,9 +211,30 @@ protected Object wrapIfNecessary(Object bean, String beanName, Object cacheKey)\n         }\n         try {\n             synchronized (PROXYED_SET) {\n-                if (PROXYED_SET.contains(beanName)) {\n+                if (PROXYED_SET.contains(beanName) || EXCLUDE_SET.contains(beanName)) {\n                     return bean;\n                 }\n+\n+                //execute the excluders\n+                if (!SCANNER_EXCLUDER_SET.isEmpty()) {\n+                    try {\n+                        BeanDefinition beanDefinition = beanFactory.getBeanDefinition(beanName);\n+                        for (ScannerExcluder excluder : SCANNER_EXCLUDER_SET) {\n+                            try {\n+                                if (excluder.isMatch(bean, beanName, beanDefinition)) {\n+                                    return bean;\n+                                }\n+                            } catch (Throwable e) {\n+                                String errorMsg = String.format(\"Do check need exclude failed: beanName=%s, excluder=%s\",\n+                                        beanName, excluder.getClass().getSimpleName());\n+                                LOGGER.error(errorMsg, e);", "originalCommit": "c0e71d8b92e651196bc7e9d5f031ca7ce768a2ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM5MTY2MQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453391661", "bodyText": "There is no method org.slf4j.Logger.error(String msg, Throwable t, Object... arguments);. Only method org.slf4j.Logger.error(String msg, Throwable t); can be used.", "author": "wangliang181230", "createdAt": "2020-07-13T01:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQwMjk5MA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453402990", "bodyText": "", "author": "xingfudeshi", "createdAt": "2020-07-13T02:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQwNDQwMA==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453404400", "bodyText": "Oh, it can be used like this. I've learned it. Thank you.", "author": "wangliang181230", "createdAt": "2020-07-13T02:32:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQwNTk0NQ==", "url": "https://github.com/seata/seata/pull/2852#discussion_r453405945", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-07-13T02:40:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMzMzU2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "026dbef4f6044e0e58cec666ca73cad4086e6b16", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\nindex e2e872268..00d14852d 100644\n--- a/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n+++ b/spring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java\n\n@@ -225,9 +225,8 @@ public class GlobalTransactionScanner extends AbstractAutoProxyCreator\n                                     return bean;\n                                 }\n                             } catch (Throwable e) {\n-                                String errorMsg = String.format(\"Do check need exclude failed: beanName=%s, excluder=%s\",\n-                                        beanName, excluder.getClass().getSimpleName());\n-                                LOGGER.error(errorMsg, e);\n+                                LOGGER.error(\"Do check need exclude failed: beanName={}, excluder={}\",\n+                                        beanName, excluder.getClass().getSimpleName(), e);\n                             }\n                         }\n                     } catch (NoSuchBeanDefinitionException e) {\n"}}, {"oid": "48612f967997cb2f44ede82f02e08cc9f4a27b73", "url": "https://github.com/seata/seata/commit/48612f967997cb2f44ede82f02e08cc9f4a27b73", "message": "\u6ce8\u91ca\u8c03\u6574", "committedDate": "2020-07-13T01:14:35Z", "type": "commit"}, {"oid": "026dbef4f6044e0e58cec666ca73cad4086e6b16", "url": "https://github.com/seata/seata/commit/026dbef4f6044e0e58cec666ca73cad4086e6b16", "message": "\u7b80\u5316\u4ee3\u7801", "committedDate": "2020-07-13T02:35:10Z", "type": "commit"}, {"oid": "452617eca84c3f588b34fb8926157136ce43f638", "url": "https://github.com/seata/seata/commit/452617eca84c3f588b34fb8926157136ce43f638", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-13T09:56:38Z", "type": "commit"}, {"oid": "7766450bdaf0f669b1bca5c248828055a3df9ee9", "url": "https://github.com/seata/seata/commit/7766450bdaf0f669b1bca5c248828055a3df9ee9", "message": "\u6dfb\u52a0PackageScannerExcluder", "committedDate": "2020-07-15T03:13:53Z", "type": "commit"}, {"oid": "6607aad599a497c2615a31d16e29991b3a335dcd", "url": "https://github.com/seata/seata/commit/6607aad599a497c2615a31d16e29991b3a335dcd", "message": "\u914d\u7f6e\u540d\u8c03\u6574\u3002", "committedDate": "2020-07-15T03:58:52Z", "type": "commit"}, {"oid": "b133e5206791daa1acef0be5c28616922a1f5936", "url": "https://github.com/seata/seata/commit/b133e5206791daa1acef0be5c28616922a1f5936", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-16T01:39:27Z", "type": "commit"}, {"oid": "7cb54f78aabe758e7bf2001cf979638c90afa540", "url": "https://github.com/seata/seata/commit/7cb54f78aabe758e7bf2001cf979638c90afa540", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-16T09:59:09Z", "type": "commit"}, {"oid": "dc56c151e7a3b39236a494008cf825b1768ee0b3", "url": "https://github.com/seata/seata/commit/dc56c151e7a3b39236a494008cf825b1768ee0b3", "message": "fix style", "committedDate": "2020-07-16T10:20:18Z", "type": "commit"}, {"oid": "73ae6da935e6e5172f5f04c1a81aaa68bc93b8fc", "url": "https://github.com/seata/seata/commit/73ae6da935e6e5172f5f04c1a81aaa68bc93b8fc", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-23T01:02:19Z", "type": "commit"}, {"oid": "a96c72f1b2c41c8b802fb5391361881a3aef0f19", "url": "https://github.com/seata/seata/commit/a96c72f1b2c41c8b802fb5391361881a3aef0f19", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-24T10:15:51Z", "type": "commit"}, {"oid": "dcf5c5dae22e5f3870cae8e1f058898fda59e6b0", "url": "https://github.com/seata/seata/commit/dcf5c5dae22e5f3870cae8e1f058898fda59e6b0", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-07-31T07:24:36Z", "type": "commit"}, {"oid": "0e73add3dbaba205a82eb22c057f7820769812bb", "url": "https://github.com/seata/seata/commit/0e73add3dbaba205a82eb22c057f7820769812bb", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-08-05T10:36:03Z", "type": "commit"}, {"oid": "dd81ace8822b5673af46518c122bc13fa954b44b", "url": "https://github.com/seata/seata/commit/dd81ace8822b5673af46518c122bc13fa954b44b", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-08-13T01:33:15Z", "type": "commit"}, {"oid": "7a28b0335ea923e20d364ff72282ce0b8025a440", "url": "https://github.com/seata/seata/commit/7a28b0335ea923e20d364ff72282ce0b8025a440", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-10-12T11:02:53Z", "type": "commit"}, {"oid": "fb6e10bbe6073707c0e592cfcd87c0ad8cfc1bd6", "url": "https://github.com/seata/seata/commit/fb6e10bbe6073707c0e592cfcd87c0ad8cfc1bd6", "message": "\u91cd\u6784\u4ee3\u7801", "committedDate": "2020-10-14T02:56:17Z", "type": "commit"}, {"oid": "fe0ab28fec3398fabc1cb80f79329aeb4b6d7f2a", "url": "https://github.com/seata/seata/commit/fe0ab28fec3398fabc1cb80f79329aeb4b6d7f2a", "message": "optimize code", "committedDate": "2020-10-15T01:35:41Z", "type": "commit"}, {"oid": "c2d211ed65b9fcdfee913c746218fda34bf1c841", "url": "https://github.com/seata/seata/commit/c2d211ed65b9fcdfee913c746218fda34bf1c841", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into exclude-scanner", "committedDate": "2020-10-15T02:25:42Z", "type": "commit"}, {"oid": "58d0a71be3543e8135f4774e661ffa0535b47206", "url": "https://github.com/seata/seata/commit/58d0a71be3543e8135f4774e661ffa0535b47206", "message": "optimize code", "committedDate": "2020-10-15T03:37:39Z", "type": "commit"}, {"oid": "a66a0cf060f4db8f00df966ad0bc26398a352588", "url": "https://github.com/seata/seata/commit/a66a0cf060f4db8f00df966ad0bc26398a352588", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-10-17T16:12:53Z", "type": "commit"}, {"oid": "343877b6755d69dc7084eaabef2cc4289e0b4d7d", "url": "https://github.com/seata/seata/commit/343877b6755d69dc7084eaabef2cc4289e0b4d7d", "message": "fix style", "committedDate": "2020-10-17T16:24:42Z", "type": "commit"}, {"oid": "0da7194c053ec7ecf94212715b736ac9149113e5", "url": "https://github.com/seata/seata/commit/0da7194c053ec7ecf94212715b736ac9149113e5", "message": "Merge branch 'develop' into exclude-scanner", "committedDate": "2020-11-16T02:53:33Z", "type": "commit"}, {"oid": "cd6c315e42a882c496c8ed51197a4e1f954de763", "url": "https://github.com/seata/seata/commit/cd6c315e42a882c496c8ed51197a4e1f954de763", "message": "Merge branch 'develop' into exclude-scanner\n\n# Conflicts:\n#\tseata-spring-boot-starter/src/main/java/io/seata/spring/boot/autoconfigure/SeataAutoConfiguration.java", "committedDate": "2021-05-06T15:49:05Z", "type": "commit"}, {"oid": "ecd1b6de4ae18f99a0bee4ed483106576b548ebf", "url": "https://github.com/seata/seata/commit/ecd1b6de4ae18f99a0bee4ed483106576b548ebf", "message": "fix style", "committedDate": "2021-05-06T15:50:16Z", "type": "commit"}, {"oid": "a630af6eb4747e988aba8c3b1d6a297e96ef48ed", "url": "https://github.com/seata/seata/commit/a630af6eb4747e988aba8c3b1d6a297e96ef48ed", "message": "modify 1.5.0.md", "committedDate": "2021-05-06T15:58:49Z", "type": "commit"}, {"oid": "1ae4c0dbd4cb85b28e829daf3cebf0e25d23a13e", "url": "https://github.com/seata/seata/commit/1ae4c0dbd4cb85b28e829daf3cebf0e25d23a13e", "message": "Merge remote-tracking branch 'remotes/upstream/develop' into exclude-scanner\n\n# Conflicts:\n#\tchanges/1.5.0.md\n#\tchanges/en-us/1.5.0.md\n#\tspring/src/main/java/io/seata/spring/annotation/GlobalTransactionScanner.java", "committedDate": "2021-05-12T05:40:06Z", "type": "commit"}, {"oid": "e07aef81197750fc1b8238b8c2845fe749025eb0", "url": "https://github.com/seata/seata/commit/e07aef81197750fc1b8238b8c2845fe749025eb0", "message": "optimize code", "committedDate": "2021-05-12T06:09:47Z", "type": "commit"}]}