{"pr_number": 2380, "pr_title": "feature: support yml configuration", "pr_createdAt": "2020-03-09T10:29:23Z", "pr_url": "https://github.com/seata/seata/pull/2380", "timeline": [{"oid": "b5aa73ccadce752abdfb0368d565d7b03c971a3f", "url": "https://github.com/seata/seata/commit/b5aa73ccadce752abdfb0368d565d7b03c971a3f", "message": "registry.conf suffix support customize", "committedDate": "2020-03-05T09:02:53Z", "type": "commit"}, {"oid": "f10e973b2cd10baeb68641738981368d63cf9eff", "url": "https://github.com/seata/seata/commit/f10e973b2cd10baeb68641738981368d63cf9eff", "message": "add yaml parseService", "committedDate": "2020-03-06T09:43:50Z", "type": "commit"}, {"oid": "f821e20a17562e7aac5f018cfffa323e5f6048f2", "url": "https://github.com/seata/seata/commit/f821e20a17562e7aac5f018cfffa323e5f6048f2", "message": "add test case", "committedDate": "2020-03-06T09:52:19Z", "type": "commit"}, {"oid": "57cef371d79d218e1d131c2aa5ca0afb97e8c691", "url": "https://github.com/seata/seata/commit/57cef371d79d218e1d131c2aa5ca0afb97e8c691", "message": "add test case", "committedDate": "2020-03-09T03:07:56Z", "type": "commit"}, {"oid": "b0bccb25737142110efc5d86edc07670cdc63854", "url": "https://github.com/seata/seata/commit/b0bccb25737142110efc5d86edc07670cdc63854", "message": "fix test  error", "committedDate": "2020-03-09T03:53:28Z", "type": "commit"}, {"oid": "87b4e712d6c92ba8633fe869756b0361dc8a16d8", "url": "https://github.com/seata/seata/commit/87b4e712d6c92ba8633fe869756b0361dc8a16d8", "message": "add projectDir first match", "committedDate": "2020-03-09T09:26:42Z", "type": "commit"}, {"oid": "f2e206c08b73e65912f912ea18f07450e43da44f", "url": "https://github.com/seata/seata/commit/f2e206c08b73e65912f912ea18f07450e43da44f", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-03-09T10:29:40Z", "type": "commit"}, {"oid": "d19645a3db0eea0cd470105b9d968cac3061ab3c", "url": "https://github.com/seata/seata/commit/d19645a3db0eea0cd470105b9d968cac3061ab3c", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-03-29T09:16:18Z", "type": "commit"}, {"oid": "bc1a10844c233595ace32fc0fd0d981dd02cd166", "url": "https://github.com/seata/seata/commit/bc1a10844c233595ace32fc0fd0d981dd02cd166", "message": "fix test case", "committedDate": "2020-03-30T02:06:02Z", "type": "commit"}, {"oid": "51b74688400da33328f557f574bb00ab8155d87d", "url": "https://github.com/seata/seata/commit/51b74688400da33328f557f574bb00ab8155d87d", "message": "fix ci error", "committedDate": "2020-03-30T09:53:17Z", "type": "commit"}, {"oid": "889ce62b8e5622df71d2c0646b9e5c8a3cb820b5", "url": "https://github.com/seata/seata/commit/889ce62b8e5622df71d2c0646b9e5c8a3cb820b5", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-03-31T14:22:56Z", "type": "commit"}, {"oid": "fadac0e4c0423a643d77ba3a72a4c04f302c6560", "url": "https://github.com/seata/seata/commit/fadac0e4c0423a643d77ba3a72a4c04f302c6560", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-04-05T14:15:19Z", "type": "commit"}, {"oid": "1e758b10651663d20e98ac30ced13b37a8d833cb", "url": "https://github.com/seata/seata/commit/1e758b10651663d20e98ac30ced13b37a8d833cb", "message": "fix bug", "committedDate": "2020-04-08T02:03:14Z", "type": "commit"}, {"oid": "509c15fea93dddd8ef7e45aedc27cab2e96c8daa", "url": "https://github.com/seata/seata/commit/509c15fea93dddd8ef7e45aedc27cab2e96c8daa", "message": "Merge branch 'develop' into feature/registry.conf-customize\n\n# Conflicts:\n#\tconfig/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "committedDate": "2020-04-24T02:35:55Z", "type": "commit"}, {"oid": "39e3849ef44d67075f70985cf75b5001976e3e61", "url": "https://github.com/seata/seata/commit/39e3849ef44d67075f70985cf75b5001976e3e61", "message": "resolve conflicts", "committedDate": "2020-04-24T03:18:08Z", "type": "commit"}, {"oid": "49c8a4cf5662ea067dc091401dd9fca0016067eb", "url": "https://github.com/seata/seata/commit/49c8a4cf5662ea067dc091401dd9fca0016067eb", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-04-24T03:21:34Z", "type": "commit"}, {"oid": "4ba513f53e230c95d72dd8f1b33bc82a4ade4990", "url": "https://github.com/seata/seata/commit/4ba513f53e230c95d72dd8f1b33bc82a4ade4990", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-04-24T03:30:52Z", "type": "commit"}, {"oid": "6b9fcb72347f59471e8be26717c2f6ed515b87ff", "url": "https://github.com/seata/seata/commit/6b9fcb72347f59471e8be26717c2f6ed515b87ff", "message": "Merge branch 'develop' of github.com:seata/seata into feature/registry.conf-customize\n\n\u0001 Conflicts:\n\u0001\tbom/pom.xml\n\u0001\tconfig/seata-config-core/src/main/java/io/seata/config/ConfigurationFactory.java", "committedDate": "2020-06-01T10:05:37Z", "type": "commit"}, {"oid": "d68a5031c319ef907138f6958e60dccb31331189", "url": "https://github.com/seata/seata/commit/d68a5031c319ef907138f6958e60dccb31331189", "message": "Merge branch 'feature/registry.conf-customize' of https://github.com/wangwei-ying/seata into feature/registry.conf-customize", "committedDate": "2020-06-01T10:09:01Z", "type": "commit"}, {"oid": "b6457c11fc1890f305af0815505b10fbf6410e07", "url": "https://github.com/seata/seata/commit/b6457c11fc1890f305af0815505b10fbf6410e07", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-03T03:16:48Z", "type": "commit"}, {"oid": "1b60e00acb535a50449d7770b92966a8fd0783c7", "url": "https://github.com/seata/seata/commit/1b60e00acb535a50449d7770b92966a8fd0783c7", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-04T01:43:44Z", "type": "commit"}, {"oid": "ac6a573dd822793438e7198827a1aa629d49560e", "url": "https://github.com/seata/seata/commit/ac6a573dd822793438e7198827a1aa629d49560e", "message": "Merge branch 'develop' of github.com:seata/seata into feature/registry.conf-customize\n\n\u0001 Conflicts:\n\u0001\tconfig/seata-config-core/pom.xml\n\u0001\tconfig/seata-config-core/src/main/java/io/seata/config/ConfigurationFactory.java\n\u0001\tconfig/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "committedDate": "2020-06-29T12:06:45Z", "type": "commit"}, {"oid": "5f83889be1327340625eb0f581a2717f97269ac7", "url": "https://github.com/seata/seata/commit/5f83889be1327340625eb0f581a2717f97269ac7", "message": "resolve conflicts", "committedDate": "2020-06-29T12:07:49Z", "type": "commit"}, {"oid": "a1aff936eec7cd6aff56efb72d54bb3034feb83b", "url": "https://github.com/seata/seata/commit/a1aff936eec7cd6aff56efb72d54bb3034feb83b", "message": "clean code", "committedDate": "2020-06-29T13:23:48Z", "type": "commit"}, {"oid": "32adccef9f79f44481bae0009a069c5eccba1cc7", "url": "https://github.com/seata/seata/commit/32adccef9f79f44481bae0009a069c5eccba1cc7", "message": "fix config cache", "committedDate": "2020-06-29T14:45:27Z", "type": "commit"}, {"oid": "fe7b1c81643d7934eab07fe991c4f7c71ff264c8", "url": "https://github.com/seata/seata/commit/fe7b1c81643d7934eab07fe991c4f7c71ff264c8", "message": "code style", "committedDate": "2020-06-29T14:46:33Z", "type": "commit"}, {"oid": "92212bc0921464a0f52381791edc5626939e0fdb", "url": "https://github.com/seata/seata/commit/92212bc0921464a0f52381791edc5626939e0fdb", "message": "resolve conflicts", "committedDate": "2020-06-29T15:10:03Z", "type": "commit"}, {"oid": "7e5b5349b67fb2792b43b9f7c8a426380a2c8cdf", "url": "https://github.com/seata/seata/commit/7e5b5349b67fb2792b43b9f7c8a426380a2c8cdf", "message": "codestyle check", "committedDate": "2020-06-29T15:26:16Z", "type": "commit"}, {"oid": "2424628441646562e7df4d9dd95f4125b1740e5b", "url": "https://github.com/seata/seata/commit/2424628441646562e7df4d9dd95f4125b1740e5b", "message": "codestyle check", "committedDate": "2020-06-29T15:35:48Z", "type": "commit"}, {"oid": "d861846cb8867654d615c69b61d02af30f7e2995", "url": "https://github.com/seata/seata/commit/d861846cb8867654d615c69b61d02af30f7e2995", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-30T01:14:28Z", "type": "commit"}, {"oid": "654daf4fba0eee691f72b857b727325046557bbb", "url": "https://github.com/seata/seata/commit/654daf4fba0eee691f72b857b727325046557bbb", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-30T06:07:42Z", "type": "commit"}, {"oid": "7dbef5692c27f44740b456ac4f540fe332c3b614", "url": "https://github.com/seata/seata/commit/7dbef5692c27f44740b456ac4f540fe332c3b614", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-30T07:13:56Z", "type": "commit"}, {"oid": "d095b7251dc6ebe9371b9f498150a99c2d335c8a", "url": "https://github.com/seata/seata/commit/d095b7251dc6ebe9371b9f498150a99c2d335c8a", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-06-30T13:02:10Z", "type": "commit"}, {"oid": "ff627e8b2ec7f65495f1ef28026891ed42603716", "url": "https://github.com/seata/seata/commit/ff627e8b2ec7f65495f1ef28026891ed42603716", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-07-01T08:21:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwMTY0NQ==", "url": "https://github.com/seata/seata/pull/2380#discussion_r448401645", "bodyText": "unnecessary", "author": "a364176773", "createdAt": "2020-07-01T14:26:40Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.config;\n+\n+import io.seata.common.loader.EnhancedServiceLoader;\n+import io.seata.config.file.FileConfig;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.File;\n+import java.util.LinkedHashMap;\n+import java.util.Set;\n+\n+/**\n+ * @author wangwei-ying\n+ */\n+public class FileConfigFactory {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(FileConfigFactory.class);\n+\n+    public static final String DEFAULT_TYPE = \"CONF\";\n+\n+    public static final String YAML_TYPE = \"YAML\";\n+\n+\n+    private static final LinkedHashMap<String, String> SUFFIX_MAP = new LinkedHashMap<String, String>(4) {\n+        {\n+            put(\"conf\", DEFAULT_TYPE);\n+            put(\"properties\", DEFAULT_TYPE);\n+            put(\"yml\", YAML_TYPE);\n+        }\n+    };\n+\n+\n+    public static FileConfig load() {\n+", "originalCommit": "ff627e8b2ec7f65495f1ef28026891ed42603716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk1MDIyMQ==", "url": "https://github.com/seata/seata/pull/2380#discussion_r449950221", "bodyText": "construct??", "author": "wangwei-ying", "createdAt": "2020-07-06T01:59:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwMTY0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ3MzcwMw==", "url": "https://github.com/seata/seata/pull/2380#discussion_r455473703", "bodyText": "construct??\n\nnewline", "author": "a364176773", "createdAt": "2020-07-16T02:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwMTY0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "7cfee6597dc6f18b83937b639637028225f800f2", "chunk": "diff --git a/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java b/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\nindex f130c7ff..0bd77b58 100644\n--- a/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\n+++ b/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\n\n@@ -29,13 +29,10 @@ import java.util.Set;\n  */\n public class FileConfigFactory {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(FileConfigFactory.class);\n-\n     public static final String DEFAULT_TYPE = \"CONF\";\n \n     public static final String YAML_TYPE = \"YAML\";\n \n-\n     private static final LinkedHashMap<String, String> SUFFIX_MAP = new LinkedHashMap<String, String>(4) {\n         {\n             put(\"conf\", DEFAULT_TYPE);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwNTk2OA==", "url": "https://github.com/seata/seata/pull/2380#discussion_r448405968", "bodyText": "not in use", "author": "a364176773", "createdAt": "2020-07-01T14:32:41Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.config;\n+\n+import io.seata.common.loader.EnhancedServiceLoader;\n+import io.seata.config.file.FileConfig;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.io.File;\n+import java.util.LinkedHashMap;\n+import java.util.Set;\n+\n+/**\n+ * @author wangwei-ying\n+ */\n+public class FileConfigFactory {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(FileConfigFactory.class);", "originalCommit": "ff627e8b2ec7f65495f1ef28026891ed42603716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE2MjAwOQ==", "url": "https://github.com/seata/seata/pull/2380#discussion_r456162009", "bodyText": "done", "author": "wangwei-ying", "createdAt": "2020-07-17T01:07:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQwNTk2OA=="}], "type": "inlineReview", "revised_code": {"commit": "7cfee6597dc6f18b83937b639637028225f800f2", "chunk": "diff --git a/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java b/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\nindex f130c7ff..0bd77b58 100644\n--- a/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\n+++ b/config/seata-config-core/src/main/java/io/seata/config/FileConfigFactory.java\n\n@@ -29,13 +29,10 @@ import java.util.Set;\n  */\n public class FileConfigFactory {\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(FileConfigFactory.class);\n-\n     public static final String DEFAULT_TYPE = \"CONF\";\n \n     public static final String YAML_TYPE = \"YAML\";\n \n-\n     private static final LinkedHashMap<String, String> SUFFIX_MAP = new LinkedHashMap<String, String>(4) {\n         {\n             put(\"conf\", DEFAULT_TYPE);\n"}}, {"oid": "d8c86c9236ed8dea696730ba3385a25626e2e172", "url": "https://github.com/seata/seata/commit/d8c86c9236ed8dea696730ba3385a25626e2e172", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-07-02T02:32:46Z", "type": "commit"}, {"oid": "4214df2f89f68fc3c71dc31daee8e7426a3f5921", "url": "https://github.com/seata/seata/commit/4214df2f89f68fc3c71dc31daee8e7426a3f5921", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-07-06T08:20:40Z", "type": "commit"}, {"oid": "88fe10b1e609c80ddf9af49ab9381e782b10c188", "url": "https://github.com/seata/seata/commit/88fe10b1e609c80ddf9af49ab9381e782b10c188", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-07-17T01:05:38Z", "type": "commit"}, {"oid": "7cfee6597dc6f18b83937b639637028225f800f2", "url": "https://github.com/seata/seata/commit/7cfee6597dc6f18b83937b639637028225f800f2", "message": "clean code", "committedDate": "2020-07-17T01:05:01Z", "type": "commit"}, {"oid": "76cbd9e7de8ee44682a3caa1f20cb98108d1b2c4", "url": "https://github.com/seata/seata/commit/76cbd9e7de8ee44682a3caa1f20cb98108d1b2c4", "message": "codestyle check", "committedDate": "2020-07-17T01:09:32Z", "type": "commit"}, {"oid": "a363dd7d4d26f1a212a389c5e454c565868fa881", "url": "https://github.com/seata/seata/commit/a363dd7d4d26f1a212a389c5e454c565868fa881", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-07-31T07:04:01Z", "type": "commit"}, {"oid": "77f06d8b0252c0e67b9bdc3bb3d1d0d82a005fe3", "url": "https://github.com/seata/seata/commit/77f06d8b0252c0e67b9bdc3bb3d1d0d82a005fe3", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-04T12:23:52Z", "type": "commit"}, {"oid": "05b065728e9a19bde7abff447f809abe80594570", "url": "https://github.com/seata/seata/commit/05b065728e9a19bde7abff447f809abe80594570", "message": "fix projectDir first", "committedDate": "2020-08-05T15:31:51Z", "type": "commit"}, {"oid": "4db1dbd49a0f7298ff951c0b49300287f225a301", "url": "https://github.com/seata/seata/commit/4db1dbd49a0f7298ff951c0b49300287f225a301", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-06T01:21:35Z", "type": "commit"}, {"oid": "c2cfd035d19bfd7632d9051f2b7de6695ee5684d", "url": "https://github.com/seata/seata/commit/c2cfd035d19bfd7632d9051f2b7de6695ee5684d", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-17T07:40:06Z", "type": "commit"}, {"oid": "0878468f1add8e02a8cafd155e9ec5e3cba5dd3d", "url": "https://github.com/seata/seata/commit/0878468f1add8e02a8cafd155e9ec5e3cba5dd3d", "message": "add config example", "committedDate": "2020-08-18T07:50:33Z", "type": "commit"}, {"oid": "817df46ed736d1fbac24c17a51accb0bb2faea8a", "url": "https://github.com/seata/seata/commit/817df46ed736d1fbac24c17a51accb0bb2faea8a", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-19T09:10:52Z", "type": "commit"}, {"oid": "ed82390b0522654535d92cdce5b666a36c9c473f", "url": "https://github.com/seata/seata/commit/ed82390b0522654535d92cdce5b666a36c9c473f", "message": "add config example", "committedDate": "2020-08-21T09:01:32Z", "type": "commit"}, {"oid": "38a94678bfbe977224e76c63b9ec275601138617", "url": "https://github.com/seata/seata/commit/38a94678bfbe977224e76c63b9ec275601138617", "message": "add config example", "committedDate": "2020-08-21T09:03:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMyMTA3OA==", "url": "https://github.com/seata/seata/pull/2380#discussion_r476321078", "bodyText": "config.get(dataId[dataId.length - 1]) If it is null  String.valueof(null)  to be  \"null\"", "author": "a364176773", "createdAt": "2020-08-25T09:45:08Z", "path": "config/seata-config-core/src/main/java/io/seata/config/file/YamlFileConfig.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ *  Copyright 1999-2019 Seata.io Group.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package io.seata.config.file;\n+\n+import io.seata.common.loader.LoadLevel;\n+import io.seata.common.loader.Scope;\n+import io.seata.config.FileConfigFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.yaml.snakeyaml.Yaml;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.util.Map;\n+\n+/**\n+ * @author wangwei-ying\n+ */\n+@LoadLevel(name = FileConfigFactory.YAML_TYPE, order = 1,scope = Scope.PROTOTYPE)\n+public class YamlFileConfig implements FileConfig {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(YamlFileConfig.class);\n+    private Map configMap;\n+\n+    public YamlFileConfig(File file, String name) {\n+        Yaml yaml = new Yaml();\n+        try {\n+            configMap = (Map) yaml.load(new FileInputStream(file));\n+        } catch (FileNotFoundException e) {\n+            throw new IllegalArgumentException(\"file not found\");\n+        }\n+    }\n+\n+    @Override\n+    public String getString(String path) {\n+        try {\n+            Map config = configMap;\n+            String[] dataId = path.split(\"\\\\.\");\n+            for (int i = 0; i < dataId.length - 1; i++) {\n+                if (config.containsKey(dataId[i])) {\n+                    config = (Map) config.get(dataId[i]);\n+                } else {\n+                    return null;\n+                }\n+            }\n+            return String.valueOf(config.get(dataId[dataId.length - 1]));", "originalCommit": "38a94678bfbe977224e76c63b9ec275601138617", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3719703419e057a107a831d2e7a413ef78aff20f", "chunk": "diff --git a/config/seata-config-core/src/main/java/io/seata/config/file/YamlFileConfig.java b/config/seata-config-core/src/main/java/io/seata/config/file/YamlFileConfig.java\nindex a24bad0a..0634ad49 100644\n--- a/config/seata-config-core/src/main/java/io/seata/config/file/YamlFileConfig.java\n+++ b/config/seata-config-core/src/main/java/io/seata/config/file/YamlFileConfig.java\n\n@@ -30,7 +30,7 @@ import java.util.Map;\n /**\n  * @author wangwei-ying\n  */\n-@LoadLevel(name = FileConfigFactory.YAML_TYPE, order = 1,scope = Scope.PROTOTYPE)\n+@LoadLevel(name = FileConfigFactory.YAML_TYPE, order = 1, scope = Scope.PROTOTYPE)\n public class YamlFileConfig implements FileConfig {\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(YamlFileConfig.class);\n"}}, {"oid": "14c75f1506743f260e80c9925a517f01ce65d60a", "url": "https://github.com/seata/seata/commit/14c75f1506743f260e80c9925a517f01ce65d60a", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-25T09:47:50Z", "type": "commit"}, {"oid": "3719703419e057a107a831d2e7a413ef78aff20f", "url": "https://github.com/seata/seata/commit/3719703419e057a107a831d2e7a413ef78aff20f", "message": "fix null value", "committedDate": "2020-08-25T10:39:16Z", "type": "commit"}, {"oid": "01bd9ae0cc105e50eabd91458c92bc4ce85784fa", "url": "https://github.com/seata/seata/commit/01bd9ae0cc105e50eabd91458c92bc4ce85784fa", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-08-28T09:03:58Z", "type": "commit"}, {"oid": "829f6f46e130fd48dea7ff006e0c775848ed0b62", "url": "https://github.com/seata/seata/commit/829f6f46e130fd48dea7ff006e0c775848ed0b62", "message": "fix URL encode", "committedDate": "2020-09-14T14:38:07Z", "type": "commit"}, {"oid": "5bf12b19099f01ed9c3d06670402a0fa7dd920e7", "url": "https://github.com/seata/seata/commit/5bf12b19099f01ed9c3d06670402a0fa7dd920e7", "message": "update test file name", "committedDate": "2020-09-14T14:38:38Z", "type": "commit"}, {"oid": "3a07db1e9617425f326ff2eb91fc0cae2ee1e3a4", "url": "https://github.com/seata/seata/commit/3a07db1e9617425f326ff2eb91fc0cae2ee1e3a4", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-09-15T01:14:40Z", "type": "commit"}, {"oid": "008538b2660ae2bf6cddd820f341daa489e2fc93", "url": "https://github.com/seata/seata/commit/008538b2660ae2bf6cddd820f341daa489e2fc93", "message": "update test file name", "committedDate": "2020-09-15T02:40:36Z", "type": "commit"}, {"oid": "ff4303aac91f456105e8540aac7d3f65196a30f1", "url": "https://github.com/seata/seata/commit/ff4303aac91f456105e8540aac7d3f65196a30f1", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-09-15T03:03:54Z", "type": "commit"}, {"oid": "a42dc1357ccb08c06ce8715d5bb404d7a039a14e", "url": "https://github.com/seata/seata/commit/a42dc1357ccb08c06ce8715d5bb404d7a039a14e", "message": "fix ci error", "committedDate": "2020-09-15T03:42:38Z", "type": "commit"}, {"oid": "44ed761475b1109a59897586553084db422fa69a", "url": "https://github.com/seata/seata/commit/44ed761475b1109a59897586553084db422fa69a", "message": "fix url file path", "committedDate": "2020-09-15T06:47:38Z", "type": "commit"}, {"oid": "fa97be633b3ffd54731edabbd85955702f37cc8d", "url": "https://github.com/seata/seata/commit/fa97be633b3ffd54731edabbd85955702f37cc8d", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-09-15T06:50:18Z", "type": "commit"}, {"oid": "17a668907a93e45477ce947a97648d7590d2b2f8", "url": "https://github.com/seata/seata/commit/17a668907a93e45477ce947a97648d7590d2b2f8", "message": "codestyle check", "committedDate": "2020-09-15T07:03:06Z", "type": "commit"}, {"oid": "99fd5533d5035cedb8c39459d55e41ace70101c2", "url": "https://github.com/seata/seata/commit/99fd5533d5035cedb8c39459d55e41ace70101c2", "message": "codestyle check", "committedDate": "2020-09-15T07:32:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAwMjExNA==", "url": "https://github.com/seata/seata/pull/2380#discussion_r495002114", "bodyText": "still test fail when file path include sapce mark.\n/D:/Program%20Files/github/seata/server/target/classes/registry", "author": "l81893521", "createdAt": "2020-09-25T13:51:31Z", "path": "config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java", "diffHunk": "@@ -139,8 +121,68 @@ public FileConfiguration(String name, boolean allowDynamicRefresh) {\n \n         this.name = name;\n         configOperateExecutor = new ThreadPoolExecutor(CORE_CONFIG_OPERATE_THREAD, MAX_CONFIG_OPERATE_THREAD,\n-            Integer.MAX_VALUE, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(),\n-            new NamedThreadFactory(\"configOperate\", MAX_CONFIG_OPERATE_THREAD));\n+                Integer.MAX_VALUE, TimeUnit.MILLISECONDS, new LinkedBlockingQueue<>(),\n+                new NamedThreadFactory(\"configOperate\", MAX_CONFIG_OPERATE_THREAD));\n+    }\n+\n+    private File getConfigFile(String name) {\n+        if (name == null) {\n+            throw new IllegalArgumentException(\"name can't be null\");\n+        }\n+        String filePath = null;\n+        boolean filePathCustom = name.startsWith(SYS_FILE_RESOURCE_PREFIX);\n+        if (filePathCustom) {\n+            filePath = name.substring(SYS_FILE_RESOURCE_PREFIX.length());\n+        } else {\n+            // projectDir first\n+            filePath = this.getClass().getClassLoader().getResource(\"\").getPath() + name;\n+        }\n+\n+        File targetFile = new File(filePath);", "originalCommit": "99fd5533d5035cedb8c39459d55e41ace70101c2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c975dd193a01078300d915a9a782342d359fbed6", "chunk": "diff --git a/config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java b/config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java\nindex d1df6168..064d421a 100644\n--- a/config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java\n+++ b/config/seata-config-core/src/main/java/io/seata/config/FileConfiguration.java\n\n@@ -126,36 +126,36 @@ public class FileConfiguration extends AbstractConfiguration {\n     }\n \n     private File getConfigFile(String name) {\n-        if (name == null) {\n-            throw new IllegalArgumentException(\"name can't be null\");\n-        }\n-        String filePath = null;\n-        boolean filePathCustom = name.startsWith(SYS_FILE_RESOURCE_PREFIX);\n-        if (filePathCustom) {\n-            filePath = name.substring(SYS_FILE_RESOURCE_PREFIX.length());\n-        } else {\n-            // projectDir first\n-            filePath = this.getClass().getClassLoader().getResource(\"\").getPath() + name;\n-        }\n-\n-        File targetFile = new File(filePath);\n-        if (!targetFile.exists()) {\n-            for (String s : FileConfigFactory.getSuffixSet()) {\n-                targetFile = new File(filePath + ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR + s);\n-                if (targetFile.exists()) {\n-                    if (LOGGER.isInfoEnabled()) {\n-                        LOGGER.info(\"The configuration file used is {}\", targetFile.getPath());\n+        try {\n+            if (name == null) {\n+                throw new IllegalArgumentException(\"name can't be null\");\n+            }\n+            String filePath = null;\n+            boolean filePathCustom = name.startsWith(SYS_FILE_RESOURCE_PREFIX);\n+            if (filePathCustom) {\n+                filePath = name.substring(SYS_FILE_RESOURCE_PREFIX.length());\n+            } else {\n+                // projectDir first\n+                filePath = this.getClass().getClassLoader().getResource(\"\").getPath() + name;\n+            }\n+            filePath = URLDecoder.decode(filePath, \"utf-8\");\n+            File targetFile = new File(filePath);\n+            if (!targetFile.exists()) {\n+                for (String s : FileConfigFactory.getSuffixSet()) {\n+                    targetFile = new File(filePath + ConfigurationKeys.FILE_CONFIG_SPLIT_CHAR + s);\n+                    if (targetFile.exists()) {\n+                        if (LOGGER.isInfoEnabled()) {\n+                            LOGGER.info(\"The configuration file used is {}\", targetFile.getPath());\n+                        }\n+                        return targetFile;\n                     }\n-                    return targetFile;\n                 }\n+            } else {\n+                if (LOGGER.isInfoEnabled()) {\n+                    LOGGER.info(\"The configuration file used is {}\", name);\n+                }\n+                return targetFile;\n             }\n-        } else {\n-            if (LOGGER.isInfoEnabled()) {\n-                LOGGER.info(\"The configuration file used is {}\", name);\n-            }\n-            return targetFile;\n-        }\n-        try {\n             if (!filePathCustom) {\n                 URL resource = this.getClass().getClassLoader().getResource(name);\n                 if (resource == null) {\n"}}, {"oid": "df5baee7ce8ad4ab4f225c2ce0ba49f8eae5e69b", "url": "https://github.com/seata/seata/commit/df5baee7ce8ad4ab4f225c2ce0ba49f8eae5e69b", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-09-25T15:01:14Z", "type": "commit"}, {"oid": "c975dd193a01078300d915a9a782342d359fbed6", "url": "https://github.com/seata/seata/commit/c975dd193a01078300d915a9a782342d359fbed6", "message": "fix blank path", "committedDate": "2020-09-28T05:13:22Z", "type": "commit"}, {"oid": "155ff2ca986cdcfe47ae1b3b3881221e002aa20c", "url": "https://github.com/seata/seata/commit/155ff2ca986cdcfe47ae1b3b3881221e002aa20c", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-10-03T03:23:15Z", "type": "commit"}, {"oid": "5a98239e493e06d37a807615644a337f053f8832", "url": "https://github.com/seata/seata/commit/5a98239e493e06d37a807615644a337f053f8832", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-10-12T13:21:45Z", "type": "commit"}, {"oid": "f74a86e3e22005be37e0c9467630000fd65c84ab", "url": "https://github.com/seata/seata/commit/f74a86e3e22005be37e0c9467630000fd65c84ab", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-10-19T09:48:06Z", "type": "commit"}, {"oid": "b365a65d71f1d773d601c949e778818222adbf1b", "url": "https://github.com/seata/seata/commit/b365a65d71f1d773d601c949e778818222adbf1b", "message": "Merge branch 'develop' into feature/registry.conf-customize", "committedDate": "2020-10-21T03:51:24Z", "type": "commit"}]}