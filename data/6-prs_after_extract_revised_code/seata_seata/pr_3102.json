{"pr_number": 3102, "pr_title": "optimize: opt ContextCore, can be set 'Object' value", "pr_createdAt": "2020-09-10T06:22:50Z", "pr_url": "https://github.com/seata/seata/pull/3102", "timeline": [{"oid": "802490fe52b6706cee63a83bf741e97e8d692279", "url": "https://github.com/seata/seata/commit/802490fe52b6706cee63a83bf741e97e8d692279", "message": "optimize: opt ContextCore, support Object value", "committedDate": "2020-09-10T06:18:59Z", "type": "commit"}, {"oid": "d6123c57033813871940b76d78a79dbaf6013d1f", "url": "https://github.com/seata/seata/commit/d6123c57033813871940b76d78a79dbaf6013d1f", "message": "fix style.", "committedDate": "2020-09-10T06:37:54Z", "type": "commit"}, {"oid": "70d42fc53d84be81e37f598767760020373493ef", "url": "https://github.com/seata/seata/commit/70d42fc53d84be81e37f598767760020373493ef", "message": "\u5c0f\u8c03\u6574\u3002", "committedDate": "2020-09-10T07:04:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY4MzcwNw==", "url": "https://github.com/seata/seata/pull/3102#discussion_r487683707", "bodyText": "if (BranchType.TCC != previousBranchType) {\nRootContext.unbindBranchType();\n}", "author": "slievrly", "createdAt": "2020-09-14T06:43:17Z", "path": "spring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java", "diffHunk": "@@ -87,10 +86,11 @@ public Object invoke(final MethodInvocation invocation) throws Throwable {\n                 return ret.get(Constants.TCC_METHOD_RESULT);\n             }\n             finally {\n-                RootContext.unbindBranchType();\n                 //restore the TCC branchType if exists\n-                if (StringUtils.equals(BranchType.TCC.name(), previousBranchType)) {\n+                if (BranchType.TCC == previousBranchType) {", "originalCommit": "70d42fc53d84be81e37f598767760020373493ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY4OTI3MQ==", "url": "https://github.com/seata/seata/pull/3102#discussion_r487689271", "bodyText": "done", "author": "wangliang181230", "createdAt": "2020-09-14T06:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY4MzcwNw=="}], "type": "inlineReview", "revised_code": {"commit": "c25e4b6b3fe15539408a0be79afacf825ca6e865", "chunk": "diff --git a/spring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java b/spring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java\nindex 9089a40174..9e775cd2dd 100644\n--- a/spring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java\n+++ b/spring/src/main/java/io/seata/spring/tcc/TccActionInterceptor.java\n\n@@ -86,10 +89,8 @@ public class TccActionInterceptor implements MethodInterceptor {\n                 return ret.get(Constants.TCC_METHOD_RESULT);\n             }\n             finally {\n-                //restore the TCC branchType if exists\n-                if (BranchType.TCC == previousBranchType) {\n-                    RootContext.bindBranchType(BranchType.TCC);\n-                } else {\n+                //if not TCC, unbind branchType\n+                if (BranchType.TCC != previousBranchType) {\n                     RootContext.unbindBranchType();\n                 }\n             }\n"}}, {"oid": "c25e4b6b3fe15539408a0be79afacf825ca6e865", "url": "https://github.com/seata/seata/commit/c25e4b6b3fe15539408a0be79afacf825ca6e865", "message": "optimize code", "committedDate": "2020-09-14T06:55:50Z", "type": "commit"}, {"oid": "80395a137f45c2327fea2d5d12ddbcebe2f8ce29", "url": "https://github.com/seata/seata/commit/80395a137f45c2327fea2d5d12ddbcebe2f8ce29", "message": "optimize code", "committedDate": "2020-09-14T07:02:56Z", "type": "commit"}, {"oid": "9a721879bf4f0716941fb54b2b13956a14520f3a", "url": "https://github.com/seata/seata/commit/9a721879bf4f0716941fb54b2b13956a14520f3a", "message": "fix notes", "committedDate": "2020-09-14T07:17:17Z", "type": "commit"}]}