{"pr_number": 2816, "pr_title": "optimize: optimize create clazz instance", "pr_createdAt": "2020-06-19T06:06:11Z", "pr_url": "https://github.com/seata/seata/pull/2816", "timeline": [{"oid": "affabd781ca9a64a81e2ddb69fc1d81cf1edae62", "url": "https://github.com/seata/seata/commit/affabd781ca9a64a81e2ddb69fc1d81cf1edae62", "message": "optimize: optimize create clazz instance\n\nSigned-off-by: slievrly <slievrly@163.com>", "committedDate": "2020-06-19T06:05:02Z", "type": "commit"}, {"oid": "342efb2247a84d6d7adbefd5680a26ae2364db15", "url": "https://github.com/seata/seata/commit/342efb2247a84d6d7adbefd5680a26ae2364db15", "message": "Merge branch 'develop' into develop_06_19", "committedDate": "2020-06-19T09:55:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDA2Ng==", "url": "https://github.com/seata/seata/pull/2816#discussion_r443294066", "bodyText": "the classloader may be null? use Objects.equals ?", "author": "jsbxyyx", "createdAt": "2020-06-22T02:50:40Z", "path": "common/src/main/java/io/seata/common/loader/EnhancedServiceLoader.java", "diffHunk": "@@ -516,6 +520,18 @@ private ExtensionDefinition getUnloadedExtensionDefinition(Class<?> clazz) {\n             return null;\n         }\n \n+        private boolean isDefinitionContainsClazz(String className, ClassLoader loader) {\n+            for (Map.Entry<Class<?>, ExtensionDefinition> entry : classToDefinitionMap.entrySet()) {\n+                if (!entry.getKey().getName().equals(className)) {\n+                    continue;\n+                }\n+                if (entry.getValue().getServiceClass().getClassLoader().equals(loader)) {", "originalCommit": "342efb2247a84d6d7adbefd5680a26ae2364db15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzk0NDE1MA==", "url": "https://github.com/seata/seata/pull/2816#discussion_r443944150", "bodyText": "classLoader alway not null", "author": "slievrly", "createdAt": "2020-06-23T03:43:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI5NDA2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "c2ec0a3559ef084be487b581ba489f2116a8fc3a", "chunk": "diff --git a/common/src/main/java/io/seata/common/loader/EnhancedServiceLoader.java b/common/src/main/java/io/seata/common/loader/EnhancedServiceLoader.java\nindex 5f3b6f2e9..cf815a655 100644\n--- a/common/src/main/java/io/seata/common/loader/EnhancedServiceLoader.java\n+++ b/common/src/main/java/io/seata/common/loader/EnhancedServiceLoader.java\n\n@@ -525,7 +526,7 @@ public class EnhancedServiceLoader {\n                 if (!entry.getKey().getName().equals(className)) {\n                     continue;\n                 }\n-                if (entry.getValue().getServiceClass().getClassLoader().equals(loader)) {\n+                if (Objects.equals(entry.getValue().getServiceClass().getClassLoader(), loader)) {\n                     return true;\n                 }\n             }\n"}}, {"oid": "35ac45a57272d1f01e27f3dff508366f6beed6ca", "url": "https://github.com/seata/seata/commit/35ac45a57272d1f01e27f3dff508366f6beed6ca", "message": "Merge branch 'develop' into develop_06_19", "committedDate": "2020-06-22T03:18:50Z", "type": "commit"}, {"oid": "882a88886f7594c749c7a2668aba21ca5c04f8d0", "url": "https://github.com/seata/seata/commit/882a88886f7594c749c7a2668aba21ca5c04f8d0", "message": "Merge remote-tracking branch 'upstream/develop' into develop_06_19", "committedDate": "2020-06-23T03:55:29Z", "type": "commit"}, {"oid": "dd936c2dde68ec624e64ad54ac6115c097a978b6", "url": "https://github.com/seata/seata/commit/dd936c2dde68ec624e64ad54ac6115c097a978b6", "message": "Merge branch 'develop_06_19' of github.com:slievrly/fescar into develop_06_19", "committedDate": "2020-06-23T03:56:10Z", "type": "commit"}, {"oid": "c2ec0a3559ef084be487b581ba489f2116a8fc3a", "url": "https://github.com/seata/seata/commit/c2ec0a3559ef084be487b581ba489f2116a8fc3a", "message": "fix review\n\nSigned-off-by: slievrly <slievrly@163.com>", "committedDate": "2020-06-23T04:01:29Z", "type": "commit"}]}