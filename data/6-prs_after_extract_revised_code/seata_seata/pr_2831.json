{"pr_number": 2831, "pr_title": "feature: Saga support jackson json parser", "pr_createdAt": "2020-06-24T10:09:29Z", "pr_url": "https://github.com/seata/seata/pull/2831", "timeline": [{"oid": "12c330f0488e2bcfcdff2837e6337f2730538fb5", "url": "https://github.com/seata/seata/commit/12c330f0488e2bcfcdff2837e6337f2730538fb5", "message": "jackson tests", "committedDate": "2020-06-17T09:00:53Z", "type": "commit"}, {"oid": "9817d27df1b7e43f527b301a3b997d33e14c0406", "url": "https://github.com/seata/seata/commit/9817d27df1b7e43f527b301a3b997d33e14c0406", "message": "saga support jackson json parser", "committedDate": "2020-06-24T03:40:49Z", "type": "commit"}, {"oid": "b95868d8f9e3027eb73eceb3a15d9048b3765f1e", "url": "https://github.com/seata/seata/commit/b95868d8f9e3027eb73eceb3a15d9048b3765f1e", "message": "saga support jackson json parser", "committedDate": "2020-06-24T08:15:37Z", "type": "commit"}, {"oid": "ba59eeee2b6d1e01aa6e2c7abbdecb8fd81605b7", "url": "https://github.com/seata/seata/commit/ba59eeee2b6d1e01aa6e2c7abbdecb8fd81605b7", "message": "saga support jackson json parser", "committedDate": "2020-06-24T10:05:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5NDE1NA==", "url": "https://github.com/seata/seata/pull/2831#discussion_r446594154", "bodyText": "When the configuration is null, the default value is not set.", "author": "wangliang181230", "createdAt": "2020-06-28T03:18:52Z", "path": "saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java", "diffHunk": "@@ -39,14 +45,31 @@\n  */\n public class DbStateMachineConfig extends DefaultStateMachineConfig implements DisposableBean {\n \n+    private static final Logger LOGGER = LoggerFactory.getLogger(DbStateMachineConfig.class);\n+\n     private DataSource dataSource;\n     private String applicationId;\n     private String txServiceGroup;\n     private String tablePrefix = \"seata_\";\n     private String dbType;\n     private SagaTransactionalTemplate sagaTransactionalTemplate;\n-    private boolean rmReportSuccessEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_REPORT_SUCCESS_ENABLE, DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE);\n-    private boolean sagaBranchRegisterEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);\n+    private boolean rmReportSuccessEnable;\n+    private boolean sagaBranchRegisterEnable;\n+    private String sagaJsonParser;\n+\n+\n+    public DbStateMachineConfig() {\n+        try {\n+            Configuration configuration = ConfigurationFactory.getInstance();\n+            if (configuration != null) {\n+                this.rmReportSuccessEnable = configuration.getBoolean(ConfigurationKeys.CLIENT_REPORT_SUCCESS_ENABLE, DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE);\n+                this.sagaBranchRegisterEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);\n+                this.sagaJsonParser = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.CLIENT_SAGA_JSON_PARSER, DEFAULT_SAGA_JSON_PARSER);\n+            }", "originalCommit": "ba59eeee2b6d1e01aa6e2c7abbdecb8fd81605b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4950667bf5cb976c1617946da4bd1d5ab22bdfe9", "chunk": "diff --git a/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java b/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\nindex 00f431ae7..d18811d75 100644\n--- a/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\n+++ b/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\n\n@@ -53,9 +53,9 @@ public class DbStateMachineConfig extends DefaultStateMachineConfig implements D\n     private String tablePrefix = \"seata_\";\n     private String dbType;\n     private SagaTransactionalTemplate sagaTransactionalTemplate;\n-    private boolean rmReportSuccessEnable;\n-    private boolean sagaBranchRegisterEnable;\n-    private String sagaJsonParser;\n+    private boolean rmReportSuccessEnable = DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE;\n+    private boolean sagaBranchRegisterEnable = DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE;\n+    private String sagaJsonParser = DEFAULT_SAGA_JSON_PARSER;\n \n \n     public DbStateMachineConfig() {\n"}}, {"oid": "4950667bf5cb976c1617946da4bd1d5ab22bdfe9", "url": "https://github.com/seata/seata/commit/4950667bf5cb976c1617946da4bd1d5ab22bdfe9", "message": "add default value for sagaJsonParser", "committedDate": "2020-06-30T07:16:34Z", "type": "commit"}, {"oid": "fb3516b15703f7f5e070a071ad49976dfa5071bc", "url": "https://github.com/seata/seata/commit/fb3516b15703f7f5e070a071ad49976dfa5071bc", "message": "Saga client application-id read from config", "committedDate": "2020-07-01T07:10:14Z", "type": "commit"}, {"oid": "9f2f2b16f968b28d098fbdba98a69ab92dd3a1f4", "url": "https://github.com/seata/seata/commit/9f2f2b16f968b28d098fbdba98a69ab92dd3a1f4", "message": "fix saga junit test", "committedDate": "2020-07-01T07:42:29Z", "type": "commit"}, {"oid": "3c5c8b4c24f634049314281a3d4c5a9fd9751781", "url": "https://github.com/seata/seata/commit/3c5c8b4c24f634049314281a3d4c5a9fd9751781", "message": "resolve conflict", "committedDate": "2020-07-01T07:58:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIxMzgwNQ==", "url": "https://github.com/seata/seata/pull/2831#discussion_r448213805", "bodyText": "ConfigurationFactory.getInstance() to configuration", "author": "wangliang181230", "createdAt": "2020-07-01T08:47:40Z", "path": "saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java", "diffHunk": "@@ -39,14 +45,33 @@\n  */\n public class DbStateMachineConfig extends DefaultStateMachineConfig implements DisposableBean {\n \n+    private static final Logger LOGGER = LoggerFactory.getLogger(DbStateMachineConfig.class);\n+\n     private DataSource dataSource;\n     private String applicationId;\n     private String txServiceGroup;\n     private String tablePrefix = \"seata_\";\n     private String dbType;\n     private SagaTransactionalTemplate sagaTransactionalTemplate;\n-    private boolean rmReportSuccessEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_REPORT_SUCCESS_ENABLE, DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE);\n-    private boolean sagaBranchRegisterEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);\n+    private boolean rmReportSuccessEnable = DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE;\n+    private boolean sagaBranchRegisterEnable = DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE;\n+    private String sagaJsonParser = DEFAULT_SAGA_JSON_PARSER;\n+\n+\n+    public DbStateMachineConfig() {\n+        try {\n+            Configuration configuration = ConfigurationFactory.getInstance();\n+            if (configuration != null) {\n+                this.rmReportSuccessEnable = configuration.getBoolean(ConfigurationKeys.CLIENT_REPORT_SUCCESS_ENABLE, DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE);\n+                this.sagaBranchRegisterEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);", "originalCommit": "3c5c8b4c24f634049314281a3d4c5a9fd9751781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIxOTQ2Nw==", "url": "https://github.com/seata/seata/pull/2831#discussion_r448219467", "bodyText": "done", "author": "long187", "createdAt": "2020-07-01T08:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODIxMzgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "54294b3362865eee1dc7700eac1606b4d797868d", "chunk": "diff --git a/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java b/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\nindex 86e296812..cb098c9b2 100644\n--- a/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\n+++ b/saga/seata-saga-engine-store/src/main/java/io/seata/saga/engine/config/DbStateMachineConfig.java\n\n@@ -63,10 +63,10 @@ public class DbStateMachineConfig extends DefaultStateMachineConfig implements D\n             Configuration configuration = ConfigurationFactory.getInstance();\n             if (configuration != null) {\n                 this.rmReportSuccessEnable = configuration.getBoolean(ConfigurationKeys.CLIENT_REPORT_SUCCESS_ENABLE, DEFAULT_CLIENT_REPORT_SUCCESS_ENABLE);\n-                this.sagaBranchRegisterEnable = ConfigurationFactory.getInstance().getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);\n-                this.sagaJsonParser = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.CLIENT_SAGA_JSON_PARSER, DEFAULT_SAGA_JSON_PARSER);\n-                this.applicationId = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.APPLICATION_ID);\n-                this.txServiceGroup = ConfigurationFactory.getInstance().getConfig(ConfigurationKeys.TX_SERVICE_GROUP);\n+                this.sagaBranchRegisterEnable = configuration.getBoolean(ConfigurationKeys.CLIENT_SAGA_BRANCH_REGISTER_ENABLE, DEFAULT_CLIENT_SAGA_BRANCH_REGISTER_ENABLE);\n+                this.sagaJsonParser = configuration.getConfig(ConfigurationKeys.CLIENT_SAGA_JSON_PARSER, DEFAULT_SAGA_JSON_PARSER);\n+                this.applicationId = configuration.getConfig(ConfigurationKeys.APPLICATION_ID);\n+                this.txServiceGroup = configuration.getConfig(ConfigurationKeys.TX_SERVICE_GROUP);\n             }\n         } catch (Exception e) {\n             LOGGER.warn(\"Load SEATA configuration failed, use default configuration instead.\", e);\n"}}, {"oid": "54294b3362865eee1dc7700eac1606b4d797868d", "url": "https://github.com/seata/seata/commit/54294b3362865eee1dc7700eac1606b4d797868d", "message": "fix ConfigurationFactory.getInstance() to configuration", "committedDate": "2020-07-01T08:56:56Z", "type": "commit"}]}