{"pr_number": 2351, "pr_title": "optimize: add get local global status", "pr_createdAt": "2020-03-04T13:43:34Z", "pr_url": "https://github.com/seata/seata/pull/2351", "timeline": [{"oid": "7898dd3af3353555fc3a4cefb2a4953a7322c15e", "url": "https://github.com/seata/seata/commit/7898dd3af3353555fc3a4cefb2a4953a7322c15e", "message": "add globalStatus now", "committedDate": "2020-03-04T13:40:51Z", "type": "commit"}, {"oid": "10ca2ab87ddeeb7de7b1a39cb9d4af1fe54265f1", "url": "https://github.com/seata/seata/commit/10ca2ab87ddeeb7de7b1a39cb9d4af1fe54265f1", "message": "change method name", "committedDate": "2020-03-04T14:08:51Z", "type": "commit"}, {"oid": "c103bf4ef1c907474af70e77762fa732cbd86552", "url": "https://github.com/seata/seata/commit/c103bf4ef1c907474af70e77762fa732cbd86552", "message": "modify annotate", "committedDate": "2020-03-04T14:12:35Z", "type": "commit"}, {"oid": "f333252e50acd540afd63d9f2aac5568fa263a14", "url": "https://github.com/seata/seata/commit/f333252e50acd540afd63d9f2aac5568fa263a14", "message": "Merge pull request #26 from seata/develop\n\nbugfix:modify the error configuration name", "committedDate": "2020-03-07T08:53:39Z", "type": "forcePushed"}, {"oid": "c103bf4ef1c907474af70e77762fa732cbd86552", "url": "https://github.com/seata/seata/commit/c103bf4ef1c907474af70e77762fa732cbd86552", "message": "modify annotate", "committedDate": "2020-03-04T14:12:35Z", "type": "forcePushed"}, {"oid": "29026f633c9f1a4365980c10044c93039a33e2b0", "url": "https://github.com/seata/seata/commit/29026f633c9f1a4365980c10044c93039a33e2b0", "message": "Merge pull request #27 from seata/develop\n\nupdate", "committedDate": "2020-03-07T16:02:59Z", "type": "commit"}, {"oid": "4706655a68e7cfa33f8105fa4464b1addfdc0dab", "url": "https://github.com/seata/seata/commit/4706655a68e7cfa33f8105fa4464b1addfdc0dab", "message": "adjust the fetch state to the local state", "committedDate": "2020-03-07T16:04:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0NTg1Mg==", "url": "https://github.com/seata/seata/pull/2351#discussion_r389345852", "bodyText": "simplify the conditional judgment", "author": "slievrly", "createdAt": "2020-03-08T08:07:14Z", "path": "tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java", "diffHunk": "@@ -145,8 +145,9 @@ private void rollbackTransaction(GlobalTransaction tx, Throwable ex) throws Tran\n         triggerAfterRollback();\n         // 3.1 Successfully rolled back\n         throw new TransactionalExecutor.ExecutionException(tx,\n-            tx.getStatus().equals(GlobalStatus.RollbackRetrying) ? TransactionalExecutor.Code.RollbackRetrying :\n-                TransactionalExecutor.Code.RollbackDone, ex);\n+            null != tx.getLocalStatus() && tx.getLocalStatus().equals(GlobalStatus.RollbackRetrying)", "originalCommit": "4706655a68e7cfa33f8105fa4464b1addfdc0dab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM1MjAyMQ==", "url": "https://github.com/seata/seata/pull/2351#discussion_r389352021", "bodyText": "simplify the conditional judgment\n\nPTAL", "author": "a364176773", "createdAt": "2020-03-08T09:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0NTg1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "94262361def3c089443d7137e8f2b0a859232fc3", "chunk": "diff --git a/tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java b/tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java\nindex 088512a1b..4e06e14b8 100644\n--- a/tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java\n+++ b/tm/src/main/java/io/seata/tm/api/TransactionalTemplate.java\n\n@@ -144,10 +144,8 @@ public class TransactionalTemplate {\n         tx.rollback();\n         triggerAfterRollback();\n         // 3.1 Successfully rolled back\n-        throw new TransactionalExecutor.ExecutionException(tx,\n-            null != tx.getLocalStatus() && tx.getLocalStatus().equals(GlobalStatus.RollbackRetrying)\n-                ? TransactionalExecutor.Code.RollbackRetrying : TransactionalExecutor.Code.RollbackDone,\n-            ex);\n+        throw new TransactionalExecutor.ExecutionException(tx, GlobalStatus.RollbackRetrying.equals(tx.getLocalStatus())\n+            ? TransactionalExecutor.Code.RollbackRetrying : TransactionalExecutor.Code.RollbackDone, ex);\n     }\n \n     private void beginTransaction(TransactionInfo txInfo, GlobalTransaction tx) throws TransactionalExecutor.ExecutionException {\n"}}, {"oid": "94262361def3c089443d7137e8f2b0a859232fc3", "url": "https://github.com/seata/seata/commit/94262361def3c089443d7137e8f2b0a859232fc3", "message": "simplify the conditional judgment", "committedDate": "2020-03-08T09:31:08Z", "type": "commit"}]}