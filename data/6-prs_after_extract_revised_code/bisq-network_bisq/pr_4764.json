{"pr_number": 4764, "pr_title": "Don't allow trade start if BitcoinJ is not fully synced", "pr_createdAt": "2020-11-08T05:31:29Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4764", "timeline": [{"oid": "a312b0786e488d6ba89692aa788ccd78a0ef7209", "url": "https://github.com/bisq-network/bisq/commit/a312b0786e488d6ba89692aa788ccd78a0ef7209", "message": "Don't allow trade start if BitcoinJ is not fully synced\n\nAdds a check that chain height is within 3 blocks of the reported\nheight from bitcoin peers -> if not the user cannot take an offer\nor have an existing offer taken.  It shows a message informing the\nuser that Bisq is not currently synced, advising them to do an\nSPV resync if necessary.\n\nAdditionally under Settings/Network a field has been added\nto show the chain height of Bisq vs the Peer group.\n\nAdded after discussion with chimp1984:\n- Correct initialization of chainHeight property\n- Rename \"Latest BTC block height\" display field for clarity\n- Enforce chain sync rule for Take Offer scenario\n- Enforce chain synch rule for Check offer availability scenario", "committedDate": "2020-11-09T19:32:03Z", "type": "forcePushed"}, {"oid": "9c8981fddfb99d8b1879e690f3388e015ad6c07f", "url": "https://github.com/bisq-network/bisq/commit/9c8981fddfb99d8b1879e690f3388e015ad6c07f", "message": "Don't allow trade start if BitcoinJ is not fully synced\n\nAdds a check that chain height is within 3 blocks of the reported\nheight from bitcoin peers -> if not the user cannot take an offer\nor have an existing offer taken.  It shows a message informing the\nuser that Bisq is not currently synced, advising them to do an\nSPV resync if necessary.\n\nAdditionally under Settings/Network a field has been added\nto show the chain height of Bisq vs the Peer group.\n\nAdded after discussion with chimp1984:\n- Correct initialization of chainHeight property\n- Rename \"Latest BTC block height\" display field for clarity\n- Enforce chain sync rule for Take Offer scenario\n- Enforce chain synch rule for Check offer availability scenario", "committedDate": "2020-11-09T20:13:12Z", "type": "forcePushed"}, {"oid": "77df5c32689f38438305c91d38154b25fb3ae231", "url": "https://github.com/bisq-network/bisq/commit/77df5c32689f38438305c91d38154b25fb3ae231", "message": "Don't allow trade start if BitcoinJ is not fully synced\n\nAdds a check that chain height is within 3 blocks of the reported\nheight from bitcoin peers -> if not the user cannot take an offer\nor have an existing offer taken.  It shows a message informing the\nuser that Bisq is not currently synced, advising them to do an\nSPV resync if necessary.\n\nAdditionally under Settings/Network a field has been added\nto show the chain height of Bisq vs the Peer group.\n\nAdded after discussion with chimp1984:\n- Correct initialization of chainHeight property\n- Rename \"Latest BTC block height\" display field for clarity\n- Enforce chain sync rule for Take Offer scenario\n- Enforce chain synch rule for Check offer availability scenario", "committedDate": "2020-11-09T21:09:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwMTAzNg==", "url": "https://github.com/bisq-network/bisq/pull/4764#discussion_r520701036", "bodyText": "Maybe better rename it so it reflects that we have a tolernace for the check...\nMaybe: inSyncWithMostCommonChainHeight ? (still not great but the \"MostCommon\" suggests we are not operating on exact data here.", "author": "chimp1984", "createdAt": "2020-11-10T16:32:36Z", "path": "core/src/main/java/bisq/core/btc/setup/WalletsSetup.java", "diffHunk": "@@ -522,6 +523,16 @@ public boolean isDownloadComplete() {\n         return downloadPercentageProperty().get() == 1d;\n     }\n \n+    public boolean isChainHeightSyncedToPeers() {", "originalCommit": "77df5c32689f38438305c91d38154b25fb3ae231", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg1MDE0Ng==", "url": "https://github.com/bisq-network/bisq/pull/4764#discussion_r520850146", "bodyText": "Done!  renamed to isChainHeightSyncedWithinTolerance", "author": "jmacxx", "createdAt": "2020-11-10T20:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcwMTAzNg=="}], "type": "inlineReview", "revised_code": {"commit": "0ddd333ce6d833332b348d3706c3ff21c0ab9543", "chunk": "diff --git a/core/src/main/java/bisq/core/btc/setup/WalletsSetup.java b/core/src/main/java/bisq/core/btc/setup/WalletsSetup.java\nindex 3f59de1425..46e43c1bca 100644\n--- a/core/src/main/java/bisq/core/btc/setup/WalletsSetup.java\n+++ b/core/src/main/java/bisq/core/btc/setup/WalletsSetup.java\n\n@@ -523,7 +523,7 @@ public class WalletsSetup {\n         return downloadPercentageProperty().get() == 1d;\n     }\n \n-    public boolean isChainHeightSyncedToPeers() {\n+    public boolean isChainHeightSyncedWithinTolerance() {\n         int peersChainHeight = PeerGroup.getMostCommonChainHeight(connectedPeers.get());\n         int bestChainHeight = walletConfig.chain().getBestChainHeight();\n         if (peersChainHeight - bestChainHeight <= 3) {\n"}}, {"oid": "0ddd333ce6d833332b348d3706c3ff21c0ab9543", "url": "https://github.com/bisq-network/bisq/commit/0ddd333ce6d833332b348d3706c3ff21c0ab9543", "message": "Don't allow trade start if BitcoinJ is not fully synced\n\nAdds a check that chain height is within 3 blocks of the reported\nheight from bitcoin peers -> if not the user cannot take an offer\nor have an existing offer taken.  It shows a message informing the\nuser that Bisq is not currently synced, advising them to do an\nSPV resync if necessary.\n\nAdditionally under Settings/Network a field has been added\nto show the chain height of Bisq vs the Peer group.\n\nAdded after discussion with chimp1984:\n- Correct initialization of chainHeight property\n- Rename \"Latest BTC block height\" display field for clarity\n- Enforce chain sync rule for Take Offer scenario\n- Enforce chain synch rule for Check offer availability scenario\n- change method name to be clearer", "committedDate": "2020-11-10T20:15:39Z", "type": "commit"}, {"oid": "0ddd333ce6d833332b348d3706c3ff21c0ab9543", "url": "https://github.com/bisq-network/bisq/commit/0ddd333ce6d833332b348d3706c3ff21c0ab9543", "message": "Don't allow trade start if BitcoinJ is not fully synced\n\nAdds a check that chain height is within 3 blocks of the reported\nheight from bitcoin peers -> if not the user cannot take an offer\nor have an existing offer taken.  It shows a message informing the\nuser that Bisq is not currently synced, advising them to do an\nSPV resync if necessary.\n\nAdditionally under Settings/Network a field has been added\nto show the chain height of Bisq vs the Peer group.\n\nAdded after discussion with chimp1984:\n- Correct initialization of chainHeight property\n- Rename \"Latest BTC block height\" display field for clarity\n- Enforce chain sync rule for Take Offer scenario\n- Enforce chain synch rule for Check offer availability scenario\n- change method name to be clearer", "committedDate": "2020-11-10T20:15:39Z", "type": "forcePushed"}]}