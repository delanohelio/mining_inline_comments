{"pr_number": 3890, "pr_title": "Improve readability of the daily burnt BSQ chart", "pr_createdAt": "2020-01-11T21:04:37Z", "pr_url": "https://github.com/bisq-network/bisq/pull/3890", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ3ODU4Nw==", "url": "https://github.com/bisq-network/bisq/pull/3890#discussion_r367478587", "bodyText": "Not used in code", "author": "ripcurlx", "createdAt": "2020-01-16T15:21:37Z", "path": "common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.common.util;\n+\n+import bisq.common.util.Tuple2;", "originalCommit": "884c8cbdab4aef73942858e3e18a375acc291c86", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edec6985734f709500732a46f2d7efe9c7622a48", "chunk": "diff --git a/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java b/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\nindex 15b23d2ffd..362df2af49 100644\n--- a/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\n+++ b/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\n\n@@ -17,10 +17,7 @@\n \n package bisq.common.util;\n \n-import bisq.common.util.Tuple2;\n-\n import java.util.DoubleSummaryStatistics;\n-import bisq.common.util.DoubleSummaryStatisticsWithStdDev;\n \n /* Adds logic to DoubleSummaryStatistics for keeping track of sum of squares\n  * and computing population variance and population standard deviation.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ3ODY4Ng==", "url": "https://github.com/bisq-network/bisq/pull/3890#discussion_r367478686", "bodyText": "Not used in code", "author": "ripcurlx", "createdAt": "2020-01-16T15:21:50Z", "path": "common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java", "diffHunk": "@@ -0,0 +1,87 @@\n+/*\n+ * This file is part of Bisq.\n+ *\n+ * Bisq is free software: you can redistribute it and/or modify it\n+ * under the terms of the GNU Affero General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or (at\n+ * your option) any later version.\n+ *\n+ * Bisq is distributed in the hope that it will be useful, but WITHOUT\n+ * ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or\n+ * FITNESS FOR A PARTICULAR PURPOSE. See the GNU Affero General Public\n+ * License for more details.\n+ *\n+ * You should have received a copy of the GNU Affero General Public License\n+ * along with Bisq. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package bisq.common.util;\n+\n+import bisq.common.util.Tuple2;\n+\n+import java.util.DoubleSummaryStatistics;\n+import bisq.common.util.DoubleSummaryStatisticsWithStdDev;", "originalCommit": "884c8cbdab4aef73942858e3e18a375acc291c86", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edec6985734f709500732a46f2d7efe9c7622a48", "chunk": "diff --git a/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java b/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\nindex 15b23d2ffd..362df2af49 100644\n--- a/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\n+++ b/common/src/main/java/bisq/common/util/DoubleSummaryStatisticsWithStdDev.java\n\n@@ -17,10 +17,7 @@\n \n package bisq.common.util;\n \n-import bisq.common.util.Tuple2;\n-\n import java.util.DoubleSummaryStatistics;\n-import bisq.common.util.DoubleSummaryStatisticsWithStdDev;\n \n /* Adds logic to DoubleSummaryStatistics for keeping track of sum of squares\n  * and computing population variance and population standard deviation.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ4MDE3NQ==", "url": "https://github.com/bisq-network/bisq/pull/3890#discussion_r367480175", "bodyText": "Do you use IntelliJ for development? If yes, please use the formatting functionality that auto sorts and groups the different imports.", "author": "ripcurlx", "createdAt": "2020-01-16T15:24:21Z", "path": "desktop/src/main/java/bisq/desktop/main/dao/economy/supply/SupplyView.java", "diffHunk": "@@ -63,16 +70,26 @@\n import java.time.temporal.TemporalAdjusters;\n \n import java.util.Comparator;\n+import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.List;\n import java.util.Map;\n import java.util.Set;\n import java.util.stream.Collectors;\n import java.util.stream.Stream;\n+import java.util.stream.StreamSupport;\n+import java.util.Spliterators.AbstractSpliterator;\n+\n+import java.util.function.BiFunction;\n+import java.util.function.Supplier;\n+import java.util.function.Consumer;\n+\n+import javafx.collections.ListChangeListener;\n \n import static bisq.desktop.util.FormBuilder.addTitledGroupBg;\n import static bisq.desktop.util.FormBuilder.addTopLabelReadOnlyTextField;\n+import static bisq.desktop.util.FormBuilder.addSlideToggleButton;", "originalCommit": "884c8cbdab4aef73942858e3e18a375acc291c86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg1ODg1NQ==", "url": "https://github.com/bisq-network/bisq/pull/3890#discussion_r367858855", "bodyText": "I use vim and I do formatting and similar tasks manually. I'll ask for suggestions on #dev.", "author": "dmos62", "createdAt": "2020-01-17T10:09:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQ4MDE3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "edec6985734f709500732a46f2d7efe9c7622a48", "chunk": "diff --git a/desktop/src/main/java/bisq/desktop/main/dao/economy/supply/SupplyView.java b/desktop/src/main/java/bisq/desktop/main/dao/economy/supply/SupplyView.java\nindex 3bb6a13fa1..ae6bf1fb58 100644\n--- a/desktop/src/main/java/bisq/desktop/main/dao/economy/supply/SupplyView.java\n+++ b/desktop/src/main/java/bisq/desktop/main/dao/economy/supply/SupplyView.java\n\n@@ -70,7 +63,6 @@ import java.time.temporal.TemporalAdjuster;\n import java.time.temporal.TemporalAdjusters;\n \n import java.util.Comparator;\n-import java.util.Collections;\n import java.util.HashMap;\n import java.util.HashSet;\n import java.util.List;\n"}}, {"oid": "edec6985734f709500732a46f2d7efe9c7622a48", "url": "https://github.com/bisq-network/bisq/commit/edec6985734f709500732a46f2d7efe9c7622a48", "message": "Provide an online standard deviation algorithm\n\nThis provides an efficient way to calculate the standard deviation from\na DoubleStream, and is to be used in measuring whether or not a data\npoint on a chart axis is an inlier.\n\nThe Kahan summation algorithm is in a slightly different style, because\nit's a faithful copy of its implementation in JDK 11's\nDoubleSummaryStatistics.", "committedDate": "2020-01-18T13:22:03Z", "type": "commit"}, {"oid": "0775aee6cb04eb850f4ee5bf93d61e598791b682", "url": "https://github.com/bisq-network/bisq/commit/0775aee6cb04eb850f4ee5bf93d61e598791b682", "message": "Provide a way to zoom a chart axis to inliers\n\nThis utility provides ways to zoom in a chart (more specifically its\naxes) on inlier data points. The principal use-case is to restore\nreadability to charts that were distorted by outliers. The first (and\nmaybe the last) chart to use this is the daily burnt BSQ chart under\n'DAO -> Facts and Figures'.", "committedDate": "2020-01-18T13:22:55Z", "type": "commit"}, {"oid": "c6941cf412b0fddd298d685f0d4c9fd6bb32766a", "url": "https://github.com/bisq-network/bisq/commit/c6941cf412b0fddd298d685f0d4c9fd6bb32766a", "message": "Provide an online moving average algorithm\n\nAllows computing a simple moving average lazily from a Stream, to be\nused in plotting noisy data. Will be used in the daily burnt BSQ chart\nunder 'DAO -> Facts and Figures'. Can be easily modified to compute\nother moving averages, like exponential.", "committedDate": "2020-01-18T13:24:26Z", "type": "commit"}, {"oid": "1901501a6ba7fd38fc0906aae7a19462c3e21a94", "url": "https://github.com/bisq-network/bisq/commit/1901501a6ba7fd38fc0906aae7a19462c3e21a94", "message": "Improve readability of the daily burnt BSQ chart\n\nRelevant issue thread: #3753\n\nCurrently the daily burnt BSQ chart under 'DAO -> Facts and Figures' is\ndistorted by outliers. This introduces a 'Zoom to inliers' toggle (off\nby default), which, when toggled on, effectively zooms the chart to\ninliers, thus removing the distortion. Also, a moving average is\nplotted, to further improve the chart's readibility.\n\nThe chart is also changed from an area chart to a line chart, on the\npresumption that it was an area chart for cosmetic reasons, but now that\nthere are two series in it (the moving average was added) an area chart\nmakes less sense.\n\nAnother noteworthy change is that the other chart in the screen, monthly\nissued BSQ, has its Y axis set to start at zero, so as to improve\nreadability. This might seem outside the scope of this commit, but the\nother changes involved some refactoring, which involved cleaning up some\nduplicated logic, which involved configuring both of these charts\ntogether, which involved forcing zero to be on the axis.\n\nThis implementation mixes some plotting logic (responsible for zooming\nin on inliers) into the view logic, because I opted to implement said\nzooming as an external manipulation of a chart's axis. I chose this in\nfavor of implementing a new Chart, because it would have required\nincluding multiple large classes (relevant JavaFX's classes can't be\nergonomically extended) to the code base. I presumed that my chosen\nsolution will be easier to maintain.\n\nI am not entirely happy with this choice and can see myself introducing\nsome plotting-related classes to encapsulate creating charts like these,\nthus unmixing plotting logic from view logic. In the meantime this is a\nworking solution, and I plan to continue working on these charts in the\nnear future.", "committedDate": "2020-01-18T13:25:10Z", "type": "forcePushed"}, {"oid": "86489e0d7434c44c6e492a46dd1e727c23c6f91f", "url": "https://github.com/bisq-network/bisq/commit/86489e0d7434c44c6e492a46dd1e727c23c6f91f", "message": "Improve readability of the daily burnt BSQ chart\n\nRelevant issue thread: #3753\n\nCurrently the daily burnt BSQ chart under 'DAO -> Facts and Figures' is\ndistorted by outliers. This introduces a 'Zoom to inliers' toggle (off\nby default), which, when toggled on, effectively zooms the chart to\ninliers, thus removing the distortion. Also, a moving average is\nplotted, to further improve the chart's readibility.\n\nThe chart is also changed from an area chart to a line chart, on the\npresumption that it was an area chart for cosmetic reasons, but now that\nthere are two series in it (the moving average was added) an area chart\nmakes less sense.\n\nAnother noteworthy change is that the other chart in the screen, monthly\nissued BSQ, has its Y axis set to start at zero, so as to improve\nreadability. This might seem outside the scope of this commit, but the\nother changes involved some refactoring, which involved cleaning up some\nduplicated logic, which involved configuring both of these charts\ntogether, which involved forcing zero to be on the axis.\n\nThis implementation mixes some plotting logic (responsible for zooming\nin on inliers) into the view logic, because I opted to implement said\nzooming as an external manipulation of a chart's axis. I chose this in\nfavor of implementing a new Chart, because it would have required\nincluding multiple large classes (relevant JavaFX's classes can't be\nergonomically extended) to the code base. I presumed that my chosen\nsolution will be easier to maintain.\n\nI am not entirely happy with this choice and can see myself introducing\nsome plotting-related classes to encapsulate creating charts like these,\nthus unmixing plotting logic from view logic. In the meantime this is a\nworking solution, and I plan to continue working on these charts in the\nnear future.", "committedDate": "2020-01-18T13:35:56Z", "type": "commit"}, {"oid": "86489e0d7434c44c6e492a46dd1e727c23c6f91f", "url": "https://github.com/bisq-network/bisq/commit/86489e0d7434c44c6e492a46dd1e727c23c6f91f", "message": "Improve readability of the daily burnt BSQ chart\n\nRelevant issue thread: #3753\n\nCurrently the daily burnt BSQ chart under 'DAO -> Facts and Figures' is\ndistorted by outliers. This introduces a 'Zoom to inliers' toggle (off\nby default), which, when toggled on, effectively zooms the chart to\ninliers, thus removing the distortion. Also, a moving average is\nplotted, to further improve the chart's readibility.\n\nThe chart is also changed from an area chart to a line chart, on the\npresumption that it was an area chart for cosmetic reasons, but now that\nthere are two series in it (the moving average was added) an area chart\nmakes less sense.\n\nAnother noteworthy change is that the other chart in the screen, monthly\nissued BSQ, has its Y axis set to start at zero, so as to improve\nreadability. This might seem outside the scope of this commit, but the\nother changes involved some refactoring, which involved cleaning up some\nduplicated logic, which involved configuring both of these charts\ntogether, which involved forcing zero to be on the axis.\n\nThis implementation mixes some plotting logic (responsible for zooming\nin on inliers) into the view logic, because I opted to implement said\nzooming as an external manipulation of a chart's axis. I chose this in\nfavor of implementing a new Chart, because it would have required\nincluding multiple large classes (relevant JavaFX's classes can't be\nergonomically extended) to the code base. I presumed that my chosen\nsolution will be easier to maintain.\n\nI am not entirely happy with this choice and can see myself introducing\nsome plotting-related classes to encapsulate creating charts like these,\nthus unmixing plotting logic from view logic. In the meantime this is a\nworking solution, and I plan to continue working on these charts in the\nnear future.", "committedDate": "2020-01-18T13:35:56Z", "type": "forcePushed"}, {"oid": "c403ee7723d1b8303066b6fa23f88dadffa01ced", "url": "https://github.com/bisq-network/bisq/commit/c403ee7723d1b8303066b6fa23f88dadffa01ced", "message": "Minor code cleanups", "committedDate": "2020-01-22T10:34:15Z", "type": "commit"}]}