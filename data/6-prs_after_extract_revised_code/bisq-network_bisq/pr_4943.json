{"pr_number": 4943, "pr_title": "Add tx broadcast to mempool explorer api", "pr_createdAt": "2020-12-14T00:45:27Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4943", "timeline": [{"oid": "7d06bf3803bca342cd35463725ee329725c60373", "url": "https://github.com/bisq-network/bisq/commit/7d06bf3803bca342cd35463725ee329725c60373", "message": "Add mempool nodes to Preferences", "committedDate": "2020-12-14T16:23:51Z", "type": "commit"}, {"oid": "664ebc13b5ec0c68d3563de269dfdb909fe61331", "url": "https://github.com/bisq-network/bisq/commit/664ebc13b5ec0c68d3563de269dfdb909fe61331", "message": "Add constructor with responseCode", "committedDate": "2020-12-14T16:24:07Z", "type": "commit"}, {"oid": "7f73fa10afa1ee8bf1eef3743bdb99c27faeba48", "url": "https://github.com/bisq-network/bisq/commit/7f73fa10afa1ee8bf1eef3743bdb99c27faeba48", "message": "Add support for data post", "committedDate": "2020-12-14T16:24:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUyNjM3OA==", "url": "https://github.com/bisq-network/bisq/pull/4943#discussion_r542526378", "bodyText": "Instead of checking for that exact message, maybe just checking for a substring of \\\"code\\\":-27 is better, since the exact string might change in future releases of Bitcoin Core RPC", "author": "wiz", "createdAt": "2020-12-14T16:34:07Z", "path": "core/src/main/java/bisq/core/btc/wallet/http/MemPoolSpaceTxBroadcaster.java", "diffHunk": "@@ -115,8 +114,21 @@ public void onSuccess(String txId) {\n             }\n \n             public void onFailure(@NotNull Throwable throwable) {\n-                log.warn(\"Broadcast of raw tx with txId {} to {} failed. Error={}\",\n-                        txIdToSend, url, throwable.toString());\n+                Throwable cause = throwable.getCause();\n+                if (cause instanceof HttpException) {\n+                    int responseCode = ((HttpException) cause).getResponseCode();\n+                    String message = cause.getMessage();\n+                    if (responseCode == 400 && message.equals(\"sendrawtransaction RPC error: {\\\"code\\\":-27,\\\"message\\\":\\\"Transaction already in block chain\\\"}\")) {", "originalCommit": "300671abb2c1407c1959994edaac441e37ec0b09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2MTI2MA==", "url": "https://github.com/bisq-network/bisq/pull/4943#discussion_r542561260", "bodyText": "ok. do you have a list of other return codes/messages?", "author": "chimp1984", "createdAt": "2020-12-14T17:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUyNjM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU3NTk2OA==", "url": "https://github.com/bisq-network/bisq/pull/4943#discussion_r542575968", "bodyText": "https://github.com/bitcoin/bitcoin/blob/master/src/rpc/protocol.h", "author": "wiz", "createdAt": "2020-12-14T17:38:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUyNjM3OA=="}], "type": "inlineReview", "revised_code": {"commit": "f0eefe794312bd94b675726c744242b9cbaf121c", "chunk": "diff --git a/core/src/main/java/bisq/core/btc/wallet/http/MemPoolSpaceTxBroadcaster.java b/core/src/main/java/bisq/core/btc/wallet/http/MemPoolSpaceTxBroadcaster.java\nindex ff9b291be4..10588a0223 100644\n--- a/core/src/main/java/bisq/core/btc/wallet/http/MemPoolSpaceTxBroadcaster.java\n+++ b/core/src/main/java/bisq/core/btc/wallet/http/MemPoolSpaceTxBroadcaster.java\n\n@@ -127,7 +124,7 @@ public class MemPoolSpaceTxBroadcaster {\n                     }\n                 } else {\n                     log.warn(\"Broadcast of raw tx with txId {} to {} failed. Error={}\",\n-                            txIdToSend, url, throwable.toString());\n+                            txIdToSend, serviceAddress, throwable.toString());\n                 }\n             }\n         }, MoreExecutors.directExecutor());\n"}}, {"oid": "f0eefe794312bd94b675726c744242b9cbaf121c", "url": "https://github.com/bisq-network/bisq/commit/f0eefe794312bd94b675726c744242b9cbaf121c", "message": "Add MemPoolSpaceTxBroadcaster", "committedDate": "2020-12-14T16:35:24Z", "type": "commit"}, {"oid": "910441125e44b37a3695be3b0dcf92967da6efc5", "url": "https://github.com/bisq-network/bisq/commit/910441125e44b37a3695be3b0dcf92967da6efc5", "message": "Return if not mainnet", "committedDate": "2020-12-14T17:11:24Z", "type": "commit"}, {"oid": "f26e76c908cae37fef6e7dcd37376caef32f1276", "url": "https://github.com/bisq-network/bisq/commit/f26e76c908cae37fef6e7dcd37376caef32f1276", "message": "Only check for code", "committedDate": "2020-12-14T17:30:37Z", "type": "commit"}, {"oid": "f26e76c908cae37fef6e7dcd37376caef32f1276", "url": "https://github.com/bisq-network/bisq/commit/f26e76c908cae37fef6e7dcd37376caef32f1276", "message": "Only check for code", "committedDate": "2020-12-14T17:30:37Z", "type": "forcePushed"}, {"oid": "478e1224e8c727f63c13cb3f8266ed6701fe8ea8", "url": "https://github.com/bisq-network/bisq/commit/478e1224e8c727f63c13cb3f8266ed6701fe8ea8", "message": "Use MemPoolSpaceTxBroadcaster for withdrawing\nfunds and for empty wallet call.", "committedDate": "2020-12-14T17:52:32Z", "type": "commit"}, {"oid": "33cf657d1dc7722739a3068872833fe66cfce8de", "url": "https://github.com/bisq-network/bisq/commit/33cf657d1dc7722739a3068872833fe66cfce8de", "message": "Clone txBroadcastServices so we do not manipulate source list", "committedDate": "2020-12-14T18:02:15Z", "type": "commit"}, {"oid": "cb289845b65a62550ab2984c16aaaf068285d8b2", "url": "https://github.com/bisq-network/bisq/commit/cb289845b65a62550ab2984c16aaaf068285d8b2", "message": "Add reference to bitcoin RPC error codes", "committedDate": "2020-12-14T18:08:12Z", "type": "commit"}]}