{"pr_number": 2059, "pr_title": "Team Matchmaker Integration", "pr_createdAt": "2020-12-04T14:08:37Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/2059", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NjA0NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536196045", "bodyText": "just Map.of()", "author": "Brutus5000", "createdAt": "2020-12-04T15:50:38Z", "path": "src/main/java/com/faforever/client/api/FafApiAccessorImpl.java", "diffHunk": "@@ -431,12 +432,24 @@ public void deleteModVersionReview(String id) {\n   }\n \n   @Override\n-  public Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> getLadder1v1MapsWithMeta(int count, int page) {\n-    JSONAPIDocument<List<Ladder1v1Map>> jsonApiDoc = getPageWithMeta(\"/data/ladder1v1Map\", count, page, ImmutableMap.of(\n-        \"include\", \"mapVersion,mapVersion.map,mapVersion.map.latestVersion,mapVersion.map.author,\" +\n-            \"mapVersion.map.statistics,mapVersion.map.reviewsSummary,mapVersion.map.versions.reviews,\" +\n-            \"mapVersion.map.versions.reviews.player\"));\n-    return new Tuple<>(jsonApiDoc.get(), jsonApiDoc.getMeta());\n+  public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n+    return getAll(\"/data/matchmakerQueueMapPool\", ImmutableMap.of(", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4MzczMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536383733", "bodyText": "All other functions in that class also use ImmutableMap, should those be changed too?", "author": "BlackYps", "createdAt": "2020-12-04T21:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NjA0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMDYwMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536410603", "bodyText": "Yes. Map.of is also immutable and is java standard, so we should use this.", "author": "Brutus5000", "createdAt": "2020-12-04T22:04:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NjA0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQxMTM0Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536411343", "bodyText": "It came after Java 8 into the JDK that's why you find guava ImmutableMap/List/... everywhere in old code.", "author": "Brutus5000", "createdAt": "2020-12-04T22:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NjA0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\nindex 00bd8bb67..95131d2a6 100644\n--- a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n+++ b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n\n@@ -428,23 +428,23 @@ public class FafApiAccessorImpl implements FafApiAccessor, InitializingBean {\n \n   @Override\n   public Optional<Game> findReplayById(int id) {\n-    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, ImmutableMap.of(\"include\", REPLAY_INCLUDES)));\n+    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, java.util.Map.of(\"include\", REPLAY_INCLUDES)));\n   }\n \n   @Override\n   public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n-    return getAll(\"/data/matchmakerQueueMapPool\", ImmutableMap.of(\n-        \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersion,\" +\n-            \"mapPool.mapVersion.map,mapPool.mapVersion.map.latestVersion,\" +\n-            \"mapPool.mapVersion.map.author,mapPool.mapVersion.map.statistics,\" +\n-            \"mapPool.mapVersion.map.reviewsSummary,mapPool.mapVersion.map.versions.reviews,\" +\n-            \"mapPool.mapVersion.map.versions.reviews.player\",\n+    return getAll(\"/data/matchmakerQueueMapPool\", java.util.Map.of(\n+        \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersions,\" +\n+            \"mapPool.mapVersions.map,mapPool.mapVersions.map.latestVersion,\" +\n+            \"mapPool.mapVersions.map.author,mapPool.mapVersions.map.statistics,\" +\n+            \"mapPool.mapVersions.map.reviewsSummary,mapPool.mapVersions.map.versions.reviews,\" +\n+            \"mapPool.mapVersions.map.versions.reviews.player\",\n         \"filter\", rsql(qBuilder().string(\"matchmakerQueue.id\").eq(String.valueOf(matchmakerQueueId)))));\n   }\n \n   @Override\n   public Optional<MatchmakerQueue> getMatchmakerQueue(String technicalName) {\n-    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", ImmutableMap.of(\n+    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", java.util.Map.of(\n         \"filter\", rsql(qBuilder().string(\"technicalName\").eq(technicalName))));\n     if (queue.isEmpty()) {\n       return Optional.empty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NjQxOA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536196418", "bodyText": "just Map.of()", "author": "Brutus5000", "createdAt": "2020-12-04T15:51:08Z", "path": "src/main/java/com/faforever/client/api/FafApiAccessorImpl.java", "diffHunk": "@@ -431,12 +432,24 @@ public void deleteModVersionReview(String id) {\n   }\n \n   @Override\n-  public Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> getLadder1v1MapsWithMeta(int count, int page) {\n-    JSONAPIDocument<List<Ladder1v1Map>> jsonApiDoc = getPageWithMeta(\"/data/ladder1v1Map\", count, page, ImmutableMap.of(\n-        \"include\", \"mapVersion,mapVersion.map,mapVersion.map.latestVersion,mapVersion.map.author,\" +\n-            \"mapVersion.map.statistics,mapVersion.map.reviewsSummary,mapVersion.map.versions.reviews,\" +\n-            \"mapVersion.map.versions.reviews.player\"));\n-    return new Tuple<>(jsonApiDoc.get(), jsonApiDoc.getMeta());\n+  public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n+    return getAll(\"/data/matchmakerQueueMapPool\", ImmutableMap.of(\n+        \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersion,\" +\n+            \"mapPool.mapVersion.map,mapPool.mapVersion.map.latestVersion,\" +\n+            \"mapPool.mapVersion.map.author,mapPool.mapVersion.map.statistics,\" +\n+            \"mapPool.mapVersion.map.reviewsSummary,mapPool.mapVersion.map.versions.reviews,\" +\n+            \"mapPool.mapVersion.map.versions.reviews.player\",\n+        \"filter\", rsql(qBuilder().string(\"matchmakerQueue.id\").eq(String.valueOf(matchmakerQueueId)))));\n+  }\n+\n+  @Override\n+  public Optional<MatchmakerQueue> getMatchmakerQueue(String technicalName) {\n+    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", ImmutableMap.of(", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\nindex 00bd8bb67..95131d2a6 100644\n--- a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n+++ b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n\n@@ -428,23 +428,23 @@ public class FafApiAccessorImpl implements FafApiAccessor, InitializingBean {\n \n   @Override\n   public Optional<Game> findReplayById(int id) {\n-    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, ImmutableMap.of(\"include\", REPLAY_INCLUDES)));\n+    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, java.util.Map.of(\"include\", REPLAY_INCLUDES)));\n   }\n \n   @Override\n   public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n-    return getAll(\"/data/matchmakerQueueMapPool\", ImmutableMap.of(\n-        \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersion,\" +\n-            \"mapPool.mapVersion.map,mapPool.mapVersion.map.latestVersion,\" +\n-            \"mapPool.mapVersion.map.author,mapPool.mapVersion.map.statistics,\" +\n-            \"mapPool.mapVersion.map.reviewsSummary,mapPool.mapVersion.map.versions.reviews,\" +\n-            \"mapPool.mapVersion.map.versions.reviews.player\",\n+    return getAll(\"/data/matchmakerQueueMapPool\", java.util.Map.of(\n+        \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersions,\" +\n+            \"mapPool.mapVersions.map,mapPool.mapVersions.map.latestVersion,\" +\n+            \"mapPool.mapVersions.map.author,mapPool.mapVersions.map.statistics,\" +\n+            \"mapPool.mapVersions.map.reviewsSummary,mapPool.mapVersions.map.versions.reviews,\" +\n+            \"mapPool.mapVersions.map.versions.reviews.player\",\n         \"filter\", rsql(qBuilder().string(\"matchmakerQueue.id\").eq(String.valueOf(matchmakerQueueId)))));\n   }\n \n   @Override\n   public Optional<MatchmakerQueue> getMatchmakerQueue(String technicalName) {\n-    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", ImmutableMap.of(\n+    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", java.util.Map.of(\n         \"filter\", rsql(qBuilder().string(\"technicalName\").eq(technicalName))));\n     if (queue.isEmpty()) {\n       return Optional.empty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5NzA4Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536197083", "bodyText": "just List.of()", "author": "Brutus5000", "createdAt": "2020-12-04T15:51:58Z", "path": "src/main/java/com/faforever/client/api/MockFafApiAccessor.java", "diffHunk": "@@ -284,8 +285,13 @@ public void deleteModVersionReview(String id) {\n   }\n \n   @Override\n-  public Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> getLadder1v1MapsWithMeta(int count, int page) {\n-    return new Tuple(Collections.emptyList(), Collections.emptyMap());\n+  public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n+    return Collections.emptyList();", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/MockFafApiAccessor.java b/src/main/java/com/faforever/client/api/MockFafApiAccessor.java\nindex 82d05bb8c..2d9acc4dd 100644\n--- a/src/main/java/com/faforever/client/api/MockFafApiAccessor.java\n+++ b/src/main/java/com/faforever/client/api/MockFafApiAccessor.java\n\n@@ -281,12 +281,12 @@ public class MockFafApiAccessor implements FafApiAccessor {\n \n   @Override\n   public Tuple<List<Mod>, java.util.Map<String, ?>> findModsByQueryWithMeta(SearchConfig query, int maxResults, int page) {\n-    return new Tuple(Collections.emptyList(), Collections.emptyMap());\n+    return new Tuple(List.of(), Collections.emptyMap());\n   }\n \n   @Override\n   public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n-    return Collections.emptyList();\n+    return List.of();\n   }\n \n   @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5Nzc5MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536197791", "bodyText": "Why not @Data or @Value?", "author": "Brutus5000", "createdAt": "2020-12-04T15:52:54Z", "path": "src/main/java/com/faforever/client/api/dto/Leaderboard.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import java.time.OffsetDateTime;\n+\n+@Getter\n+@Setter\n+@EqualsAndHashCode(of = \"id\")", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4NjUyOA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536386528", "bodyText": "I think I copied that from another dto class. No real reason to not use @Data", "author": "BlackYps", "createdAt": "2020-12-04T21:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5Nzc5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/dto/Leaderboard.java b/src/main/java/com/faforever/client/api/dto/Leaderboard.java\nindex 55a7d1963..da8135cfb 100644\n--- a/src/main/java/com/faforever/client/api/dto/Leaderboard.java\n+++ b/src/main/java/com/faforever/client/api/dto/Leaderboard.java\n\n@@ -2,15 +2,10 @@ package com.faforever.client.api.dto;\n \n import com.github.jasminb.jsonapi.annotations.Id;\n import com.github.jasminb.jsonapi.annotations.Type;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.Setter;\n-\n+import lombok.Data;\n import java.time.OffsetDateTime;\n \n-@Getter\n-@Setter\n-@EqualsAndHashCode(of = \"id\")\n+@Data\n @Type(\"leaderboard\")\n public class Leaderboard {\n   @Id\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjE5ODE2NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536198165", "bodyText": "Why not @DaTa or @value?", "author": "Brutus5000", "createdAt": "2020-12-04T15:53:27Z", "path": "src/main/java/com/faforever/client/api/dto/MapPool.java", "diffHunk": "@@ -7,13 +7,19 @@\n import lombok.Getter;\n import lombok.Setter;\n \n+import java.time.OffsetDateTime;\n+import java.util.List;\n+\n @Getter\n @Setter\n @EqualsAndHashCode(of = \"id\")", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/dto/MapPool.java b/src/main/java/com/faforever/client/api/dto/MapPool.java\nindex ebe46b963..6ad33e2a8 100644\n--- a/src/main/java/com/faforever/client/api/dto/MapPool.java\n+++ b/src/main/java/com/faforever/client/api/dto/MapPool.java\n\n@@ -3,16 +3,12 @@ package com.faforever.client.api.dto;\n import com.github.jasminb.jsonapi.annotations.Id;\n import com.github.jasminb.jsonapi.annotations.Relationship;\n import com.github.jasminb.jsonapi.annotations.Type;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.Setter;\n+import lombok.Data;\n \n import java.time.OffsetDateTime;\n import java.util.List;\n \n-@Getter\n-@Setter\n-@EqualsAndHashCode(of = \"id\")\n+@Data\n @Type(\"mapPool\")\n public class MapPool {\n   @Id\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMTA4OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536201089", "bodyText": ".endsWith(\"'sParty\") has an implicit semantical meaning and therefore should be put into a dedicated method.\nI'd guess something like boolean isOwnPartiesChannel(String name)\nBut just comparing the end of the name sounds really... odd?", "author": "Brutus5000", "createdAt": "2020-12-04T15:57:25Z", "path": "src/main/java/com/faforever/client/chat/ChatController.java", "diffHunk": "@@ -178,6 +178,8 @@ private void onConnectionStateChange(ConnectionState newValue) {\n   public void onChatMessage(ChatMessageEvent event) {\n     Platform.runLater(() -> {\n       ChatMessage message = event.getMessage();\n+      if (message.getSource() != null && message.getSource().endsWith(\"'sParty\"))\n+        return;", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/ChatController.java b/src/main/java/com/faforever/client/chat/ChatController.java\nindex 1b778c59b..467fd977c 100644\n--- a/src/main/java/com/faforever/client/chat/ChatController.java\n+++ b/src/main/java/com/faforever/client/chat/ChatController.java\n\n@@ -178,7 +178,7 @@ public class ChatController extends AbstractViewController<Node> {\n   public void onChatMessage(ChatMessageEvent event) {\n     Platform.runLater(() -> {\n       ChatMessage message = event.getMessage();\n-      if (message.getSource() != null && message.getSource().endsWith(\"'sParty\"))\n+      if (isMatchmakerPartyMessage(message))\n         return;\n       if (!message.isPrivate()) {\n         getOrCreateChannelTab(message.getSource()).onChatMessage(message);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMjA0Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536202042", "bodyText": "Why is this public now? Could be a code smell. Not sure.", "author": "Brutus5000", "createdAt": "2020-12-04T15:58:53Z", "path": "src/main/java/com/faforever/client/chat/ChatChannelUser.java", "diffHunk": "@@ -45,7 +45,7 @@\n     this(username, color, moderator, null);\n   }\n \n-  ChatChannelUser(String username, Color color, boolean moderator, Player player) {\n+  public ChatChannelUser(String username, Color color, boolean moderator, Player player) {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY2MDA4NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536660084", "bodyText": "This and related changes were done in a214cbd by Geosearchef. This is where he implemented the hacky way to display the contextmenu. I can't say for sure, but this looks like a candidate for refactoring to make the whole thing cleaner", "author": "BlackYps", "createdAt": "2020-12-05T10:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMjA0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "901c2727e7b4f0b304ae370161c8e76128b4fe5a", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/ChatChannelUser.java b/src/main/java/com/faforever/client/chat/ChatChannelUser.java\nindex 496226c1f..78fde0601 100644\n--- a/src/main/java/com/faforever/client/chat/ChatChannelUser.java\n+++ b/src/main/java/com/faforever/client/chat/ChatChannelUser.java\n\n@@ -45,7 +45,7 @@ public class ChatChannelUser {\n     this(username, color, moderator, null);\n   }\n \n-  public ChatChannelUser(String username, Color color, boolean moderator, Player player) {\n+  ChatChannelUser(String username, Color color, boolean moderator, Player player) {\n     this.username = new SimpleStringProperty(username);\n     this.moderator = new SimpleBooleanProperty(moderator);\n     this.color = new SimpleObjectProperty<>(color);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMjI0NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536202245", "bodyText": "same here", "author": "Brutus5000", "createdAt": "2020-12-04T15:59:12Z", "path": "src/main/java/com/faforever/client/api/dto/MatchmakerQueueMapPool.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Relationship;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import java.time.OffsetDateTime;\n+\n+@Getter\n+@Setter\n+@EqualsAndHashCode(of = \"id\")", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/dto/MatchmakerQueueMapPool.java b/src/main/java/com/faforever/client/api/dto/MatchmakerQueueMapPool.java\nindex 7378c6696..8e24e8be0 100644\n--- a/src/main/java/com/faforever/client/api/dto/MatchmakerQueueMapPool.java\n+++ b/src/main/java/com/faforever/client/api/dto/MatchmakerQueueMapPool.java\n\n@@ -3,15 +3,11 @@ package com.faforever.client.api.dto;\n import com.github.jasminb.jsonapi.annotations.Id;\n import com.github.jasminb.jsonapi.annotations.Relationship;\n import com.github.jasminb.jsonapi.annotations.Type;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.Setter;\n+import lombok.Data;\n \n import java.time.OffsetDateTime;\n \n-@Getter\n-@Setter\n-@EqualsAndHashCode(of = \"id\")\n+@Data\n @Type(\"matchmakerQueueMapPool\")\n public class MatchmakerQueueMapPool {\n   @Id\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwMjM2Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536202363", "bodyText": "same here", "author": "Brutus5000", "createdAt": "2020-12-04T15:59:21Z", "path": "src/main/java/com/faforever/client/api/dto/MatchmakerQueue.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Relationship;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import java.time.OffsetDateTime;\n+\n+@Getter\n+@Setter\n+@EqualsAndHashCode(of = \"id\")", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/api/dto/MatchmakerQueue.java b/src/main/java/com/faforever/client/api/dto/MatchmakerQueue.java\nindex b8409c739..4a3c1dc21 100644\n--- a/src/main/java/com/faforever/client/api/dto/MatchmakerQueue.java\n+++ b/src/main/java/com/faforever/client/api/dto/MatchmakerQueue.java\n\n@@ -3,15 +3,11 @@ package com.faforever.client.api.dto;\n import com.github.jasminb.jsonapi.annotations.Id;\n import com.github.jasminb.jsonapi.annotations.Relationship;\n import com.github.jasminb.jsonapi.annotations.Type;\n-import lombok.EqualsAndHashCode;\n-import lombok.Getter;\n-import lombok.Setter;\n+import lombok.Data;\n \n import java.time.OffsetDateTime;\n \n-@Getter\n-@Setter\n-@EqualsAndHashCode(of = \"id\")\n+@Data\n @Type(\"matchmakerQueue\")\n public class MatchmakerQueue {\n   @Id\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDE0Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536204143", "bodyText": "Why does this method even exist if there is getRoot()? I know it was there before, but maybe you can explain.", "author": "Brutus5000", "createdAt": "2020-12-04T16:02:00Z", "path": "src/main/java/com/faforever/client/chat/ChatUserContextMenuController.java", "diffHunk": "@@ -145,7 +145,7 @@ public void initialize() {\n         });\n   }\n \n-  ContextMenu getContextMenu() {\n+  public ContextMenu getContextMenu() {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY1ODg5Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536658892", "bodyText": "No idea...", "author": "BlackYps", "createdAt": "2020-12-05T10:26:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDE0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI4NjgyNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r546286825", "bodyText": "This was for the hacky implementation in the partyMemberItemController", "author": "BlackYps", "createdAt": "2020-12-19T21:45:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "901c2727e7b4f0b304ae370161c8e76128b4fe5a", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/ChatUserContextMenuController.java b/src/main/java/com/faforever/client/chat/ChatUserContextMenuController.java\nindex 60ee666ee..a923bad38 100644\n--- a/src/main/java/com/faforever/client/chat/ChatUserContextMenuController.java\n+++ b/src/main/java/com/faforever/client/chat/ChatUserContextMenuController.java\n\n@@ -145,7 +145,7 @@ public class ChatUserContextMenuController implements Controller<ContextMenu> {\n         });\n   }\n \n-  public ContextMenu getContextMenu() {\n+  ContextMenu getContextMenu() {\n     return chatUserContextMenuRoot;\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDcxMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536204711", "bodyText": "Remove. @Inject isn't needed.", "author": "Brutus5000", "createdAt": "2020-12-04T16:02:49Z", "path": "src/main/java/com/faforever/client/chat/MatchmakingChatController.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package com.faforever.client.chat;\n+\n+import com.faforever.client.audio.AudioService;\n+import com.faforever.client.chat.event.UnreadPartyMessageEvent;\n+import com.faforever.client.fx.WebViewConfigurer;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.reporting.ReportingService;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.uploader.ImageUploadService;\n+import com.faforever.client.user.UserService;\n+import com.faforever.client.util.TimeService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.eventbus.EventBus;\n+import javafx.application.Platform;\n+import javafx.collections.MapChangeListener;\n+import javafx.scene.control.Tab;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.web.WebView;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+import java.time.Instant;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingChatController extends AbstractChatTabController {\n+\n+  public Tab matchmakingChatTabRoot;\n+  public WebView messagesWebView;\n+  public TextInputControl messageTextField;\n+\n+  private Channel channel;\n+  private MapChangeListener<String, ChatChannelUser> usersChangeListener;\n+\n+  @Inject", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/MatchmakingChatController.java b/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\nindex a96ae89a5..6c1b89c30 100644\n--- a/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\n+++ b/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\n\n@@ -37,7 +37,6 @@ public class MatchmakingChatController extends AbstractChatTabController {\n   private Channel channel;\n   private MapChangeListener<String, ChatChannelUser> usersChangeListener;\n \n-  @Inject\n   // TODO cut dependencies\n   public MatchmakingChatController(UserService userService,\n                                    PreferencesService preferencesService,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDk0OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536204948", "bodyText": "Is there a TODO or not? If yes, please fix, if no please remove.", "author": "Brutus5000", "createdAt": "2020-12-04T16:03:15Z", "path": "src/main/java/com/faforever/client/chat/MatchmakingChatController.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package com.faforever.client.chat;\n+\n+import com.faforever.client.audio.AudioService;\n+import com.faforever.client.chat.event.UnreadPartyMessageEvent;\n+import com.faforever.client.fx.WebViewConfigurer;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.reporting.ReportingService;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.uploader.ImageUploadService;\n+import com.faforever.client.user.UserService;\n+import com.faforever.client.util.TimeService;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.eventbus.EventBus;\n+import javafx.application.Platform;\n+import javafx.collections.MapChangeListener;\n+import javafx.scene.control.Tab;\n+import javafx.scene.control.TextInputControl;\n+import javafx.scene.web.WebView;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import javax.inject.Inject;\n+import java.time.Instant;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingChatController extends AbstractChatTabController {\n+\n+  public Tab matchmakingChatTabRoot;\n+  public WebView messagesWebView;\n+  public TextInputControl messageTextField;\n+\n+  private Channel channel;\n+  private MapChangeListener<String, ChatChannelUser> usersChangeListener;\n+\n+  @Inject\n+  // TODO cut dependencies", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4ODIyNA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536388224", "bodyText": "I don't know. The other two classes that extend from AbstractChatTabController also have it and I wanted to stay consistent.", "author": "BlackYps", "createdAt": "2020-12-04T21:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4MjIxMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536782212", "bodyText": "I think the thing to do here would be to cut the unnecessary dependencies.", "author": "Sheikah45", "createdAt": "2020-12-05T14:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjI4NjczNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r546286737", "bodyText": "This is a separate issue. This todo also exists in the other chatcontrollers. I put it here for consistency", "author": "BlackYps", "createdAt": "2020-12-19T21:45:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwNDk0OA=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/MatchmakingChatController.java b/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\nindex a96ae89a5..6c1b89c30 100644\n--- a/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\n+++ b/src/main/java/com/faforever/client/chat/MatchmakingChatController.java\n\n@@ -37,7 +37,6 @@ public class MatchmakingChatController extends AbstractChatTabController {\n   private Channel channel;\n   private MapChangeListener<String, ChatChannelUser> usersChangeListener;\n \n-  @Inject\n   // TODO cut dependencies\n   public MatchmakingChatController(UserService userService,\n                                    PreferencesService preferencesService,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIwODk0MA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536208940", "bodyText": "duplicate code, please put into dedicated method", "author": "Brutus5000", "createdAt": "2020-12-04T16:09:17Z", "path": "src/main/java/com/faforever/client/game/GameService.java", "diffHunk": "@@ -331,9 +339,17 @@ public ReadOnlyBooleanProperty gameRunningProperty() {\n       return gameDirectoryFuture.thenCompose(path -> joinGame(game, password));\n     }\n \n-    log.info(\"Joining game: '{}' ({})\", game.getTitle(), game.getId());\n+    if (inMatchmakerQueue.get()) {\n+      notificationService.addNotification(new ImmediateNotification(\n+          i18n.get(\"teammatchmaking.notification.customAlreadyInQueue.title\"),\n+          i18n.get(\"teammatchmaking.notification.customAlreadyInQueue.message\"),\n+          Severity.WARN,\n+          Collections.singletonList(new Action(i18n.get(\"dismiss\")))\n+      ));\n+      return completedFuture(null);\n+    }", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/game/GameService.java b/src/main/java/com/faforever/client/game/GameService.java\nindex 097e99b9e..d7556446f 100644\n--- a/src/main/java/com/faforever/client/game/GameService.java\n+++ b/src/main/java/com/faforever/client/game/GameService.java\n\n@@ -340,12 +342,7 @@ public class GameService implements InitializingBean {\n     }\n \n     if (inMatchmakerQueue.get()) {\n-      notificationService.addNotification(new ImmediateNotification(\n-          i18n.get(\"teammatchmaking.notification.customAlreadyInQueue.title\"),\n-          i18n.get(\"teammatchmaking.notification.customAlreadyInQueue.message\"),\n-          Severity.WARN,\n-          Collections.singletonList(new Action(i18n.get(\"dismiss\")))\n-      ));\n+      addAlreadyInQueueNotification();\n       return completedFuture(null);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxMDE2MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536210161", "bodyText": "I suggest debug logging of both cases", "author": "Brutus5000", "createdAt": "2020-12-04T16:11:05Z", "path": "src/main/java/com/faforever/client/game/GameService.java", "diffHunk": "@@ -534,27 +546,27 @@ public void addOnRankedMatchNotificationListener(Consumer<MatchmakerInfoMessage>\n               gameLaunchMessage.getArgs().add(\"/players \" + gameLaunchMessage.getExpectedPlayers());\n               gameLaunchMessage.getArgs().add(\"/startspot \" + gameLaunchMessage.getMapPosition());\n \n-              startGame(gameLaunchMessage, faction, RatingMode.LADDER_1V1);\n+              startGame(gameLaunchMessage, gameLaunchMessage.getFaction(), NONE); // TODO: rating mode\n             }))\n         .exceptionally(throwable -> {\n-          if (throwable instanceof CancellationException) {\n-            log.info(\"Ranked1v1 search has been cancelled\");\n+          if (throwable.getCause() instanceof CancellationException) {\n+            log.info(\"Matchmaking search has been cancelled\");\n           } else {\n-            log.warn(\"Ranked1v1 could not be started\", throwable);\n+            log.warn(\"Matchmade game could not be started\", throwable);\n           }\n           return null;\n         });\n   }\n \n-  public void stopSearchLadder1v1() {\n-    if (searching1v1.get()) {\n-      fafService.stopSearchingRanked();\n-      searching1v1.set(false);\n+  public void onMatchmakerSearchStopped() {\n+    if (inMatchmakerQueue.get()) {\n+      fafService.stopSearchMatchmaker();\n+      inMatchmakerQueue.set(false);\n     }\n   }", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzExNDkxNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r537114915", "bodyText": "The other case is that inMatchmakerQueue is already false?", "author": "BlackYps", "createdAt": "2020-12-06T20:16:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxMDE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/game/GameService.java b/src/main/java/com/faforever/client/game/GameService.java\nindex 097e99b9e..d7556446f 100644\n--- a/src/main/java/com/faforever/client/game/GameService.java\n+++ b/src/main/java/com/faforever/client/game/GameService.java\n\n@@ -562,6 +559,9 @@ public class GameService implements InitializingBean {\n     if (inMatchmakerQueue.get()) {\n       fafService.stopSearchMatchmaker();\n       inMatchmakerQueue.set(false);\n+      log.debug(\"Matchmaker search stopped\");\n+    } else {\n+      log.debug(\"Matchmaker search has already been stopped, ignoring call\");\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxNTAyNg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536215026", "bodyText": "Use Lombok @Data instead?\nGet rid of all the getter and setter below.", "author": "Brutus5000", "createdAt": "2020-12-04T16:18:06Z", "path": "src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java", "diffHunk": "@@ -9,32 +9,38 @@\n \n public class MatchmakerInfoMessage extends FafServerMessage {\n \n+  private String action; // TODO: doesn't exist anymore\n+\n   public static class MatchmakerQueue {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java b/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\nindex c27dc7055..49139cf9a 100644\n--- a/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\n+++ b/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\n\n@@ -4,13 +4,15 @@ import com.faforever.client.remote.domain.FafServerMessage;\n import com.faforever.client.remote.domain.FafServerMessageType;\n import com.faforever.client.remote.domain.RatingRange;\n import com.google.gson.annotations.SerializedName;\n+import lombok.Data;\n+import lombok.Getter;\n+import lombok.Setter;\n \n import java.util.List;\n \n public class MatchmakerInfoMessage extends FafServerMessage {\n \n-  private String action; // TODO: doesn't exist anymore\n-\n+  @Data\n   public static class MatchmakerQueue {\n \n     private String queueName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxNzk3OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536217978", "bodyText": "Please resolve the todo", "author": "Brutus5000", "createdAt": "2020-12-04T16:22:38Z", "path": "src/main/java/com/faforever/client/remote/FafService.java", "diffHunk": "@@ -96,16 +96,17 @@\n     return fafServerAccessor.requestJoinGame(gameId, password);\n   }\n \n-  public CompletableFuture<GameLaunchMessage> startSearchLadder1v1(Faction faction) {\n-    return fafServerAccessor.startSearchLadder1v1(faction);\n+  public CompletableFuture<GameLaunchMessage> startSearchMatchmaker() {\n+    return fafServerAccessor.startSearchMatchmaker();\n   }\n \n-  public void requestMatchmakerInfo() {\n-    fafServerAccessor.requestMatchmakerInfo();\n+  public void stopSearchMatchmaker() {\n+    fafServerAccessor.stopSearchMatchmaker();\n   }\n \n-  public void stopSearchingRanked() {\n-    fafServerAccessor.stopSearchingRanked();\n+  //TODO: use for TMM or remove", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/FafService.java b/src/main/java/com/faforever/client/remote/FafService.java\nindex 7e4874b0d..c010983f5 100644\n--- a/src/main/java/com/faforever/client/remote/FafService.java\n+++ b/src/main/java/com/faforever/client/remote/FafService.java\n\n@@ -104,7 +104,6 @@ public class FafService {\n     fafServerAccessor.stopSearchMatchmaker();\n   }\n \n-  //TODO: use for TMM or remove\n   public void requestMatchmakerInfo() {\n     fafServerAccessor.requestMatchmakerInfo();\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxOTg4OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536219889", "bodyText": "I know it was there before, but now it looks even more like a code smell \ud83e\udd14", "author": "Brutus5000", "createdAt": "2020-12-04T16:25:25Z", "path": "src/main/java/com/faforever/client/remote/FafService.java", "diffHunk": "@@ -458,13 +459,27 @@ public void restoreGameSession(int id) {\n   }\n \n   @Async\n-  public CompletableFuture<Tuple<List<MapBean>, Integer>> getLadder1v1MapsWithPageCount(int count, int page) {\n-    Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> tuple = fafApiAccessor.getLadder1v1MapsWithMeta(count, page);\n-    return CompletableFuture.completedFuture(new Tuple<>(tuple.getFirst()\n-        .parallelStream()\n-        .map(ladder1v1Map -> MapBean.fromMapVersionDto(ladder1v1Map.getMapVersion()))\n+  public CompletableFuture<Tuple<List<MapBean>, Integer>> getMatchmakerMapsWithPageCount(int matchmakerQueueId, int count, int page) {\n+    List<MapVersion> mapVersions = fafApiAccessor.getMatchmakerPools(matchmakerQueueId)\n+        .stream()\n+        .map(MatchmakerQueueMapPool::getMapPool)\n+        .flatMap(mapPool -> mapPool.getMapVersions().stream())\n+        .distinct()\n+        .collect(toList());\n+    int totalPages = (mapVersions.size() - 1) / count + 1;\n+    return CompletableFuture.completedFuture(new Tuple<>(mapVersions\n+        .stream()\n+        .skip((page - 1) * count)\n+        .limit(count)\n+        .map(MapBean::fromMapVersionDto)\n         .collect(toList()),\n-        ((HashMap<String,Integer>) tuple.getSecond().get(\"page\")).get(\"totalPages\")));\n+        totalPages));\n+  }\n+", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY2MDYyNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536660625", "bodyText": "What exactly? Or the whole thing?", "author": "BlackYps", "createdAt": "2020-12-05T10:29:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxOTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5NTIxMA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536895210", "bodyText": "The integer that is returned as well. Calculating page sizes / page numbers is not a problem tied to map beans, it applies to every collection and it could go into some util function.", "author": "Brutus5000", "createdAt": "2020-12-05T21:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxOTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5Njg0OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536896848", "bodyText": "Just as a note for all other api calls the api gives us the total page number. However it doesnt do that for the mapPool maps currently which is why it needs to be calculated here.", "author": "Sheikah45", "createdAt": "2020-12-05T21:35:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxOTg4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5ODAxMA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536898010", "bodyText": "I agree, but all the other api calls use pagination to limit the api call itself. This one is the only one (yet) that has to limit the returning result. What would an appropriate place for the helper function be?", "author": "BlackYps", "createdAt": "2020-12-05T21:42:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIxOTg4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6bc898e1955c41f87f97b267761c12eba21bf319", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/FafService.java b/src/main/java/com/faforever/client/remote/FafService.java\nindex 7e4874b0d..f8bdcfe78 100644\n--- a/src/main/java/com/faforever/client/remote/FafService.java\n+++ b/src/main/java/com/faforever/client/remote/FafService.java\n\n@@ -460,18 +460,23 @@ public class FafService {\n \n   @Async\n   public CompletableFuture<Tuple<List<MapBean>, Integer>> getMatchmakerMapsWithPageCount(int matchmakerQueueId, int count, int page) {\n-    List<MapVersion> mapVersions = fafApiAccessor.getMatchmakerPools(matchmakerQueueId)\n+    List<MapBean> mapVersions = fafApiAccessor.getMatchmakerPools(matchmakerQueueId)\n         .stream()\n         .map(MatchmakerQueueMapPool::getMapPool)\n         .flatMap(mapPool -> mapPool.getMapVersions().stream())\n         .distinct()\n+        .map(MapBean::fromMapVersionDto)\n         .collect(toList());\n-    int totalPages = (mapVersions.size() - 1) / count + 1;\n-    return CompletableFuture.completedFuture(new Tuple<>(mapVersions\n+    return paginateResult(count, page, mapVersions);\n+  }\n+\n+  @NotNull\n+  private <T> CompletableFuture<Tuple<List<T>, Integer>> paginateResult(int count, int page, List<T> results) {\n+    int totalPages = (results.size() - 1) / count + 1;\n+    return CompletableFuture.completedFuture(new Tuple<>(results\n         .stream()\n-        .skip((page - 1) * count)\n+        .skip((long) (page - 1) * count)\n         .limit(count)\n-        .map(MapBean::fromMapVersionDto)\n         .collect(toList()),\n         totalPages));\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMDg1Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536220857", "bodyText": "Underscores in variables and methods names are a no-go.", "author": "Brutus5000", "createdAt": "2020-12-04T16:26:48Z", "path": "src/main/java/com/faforever/client/remote/domain/AcceptPartyInviteMessage.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.faforever.client.remote.domain;\n+\n+public class AcceptPartyInviteMessage extends ClientMessage {\n+\n+  private Integer sender_id;\n+\n+  public AcceptPartyInviteMessage(Integer sender_id) {\n+    super(ClientMessageType.ACCEPT_PARTY_INVITE);\n+    this.sender_id = sender_id;\n+  }\n+\n+  public Integer getSender_id() {\n+    return sender_id;\n+  }\n+\n+  public void setSender_id(Integer sender_id) {\n+    this.sender_id = sender_id;\n+  }\n+}", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/AcceptPartyInviteMessage.java b/src/main/java/com/faforever/client/remote/domain/AcceptPartyInviteMessage.java\nindex ac129042f..0457cba84 100644\n--- a/src/main/java/com/faforever/client/remote/domain/AcceptPartyInviteMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/AcceptPartyInviteMessage.java\n\n@@ -1,19 +1,15 @@\n package com.faforever.client.remote.domain;\n \n+import lombok.Getter;\n+\n+@Getter\n public class AcceptPartyInviteMessage extends ClientMessage {\n \n-  private Integer sender_id;\n+  private final Integer senderId;\n \n-  public AcceptPartyInviteMessage(Integer sender_id) {\n+  public AcceptPartyInviteMessage(Integer senderId) {\n     super(ClientMessageType.ACCEPT_PARTY_INVITE);\n-    this.sender_id = sender_id;\n-  }\n-\n-  public Integer getSender_id() {\n-    return sender_id;\n+    this.senderId = senderId;\n   }\n \n-  public void setSender_id(Integer sender_id) {\n-    this.sender_id = sender_id;\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMTYwNA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536221604", "bodyText": "Underscores in variables are a no-go.", "author": "Brutus5000", "createdAt": "2020-12-04T16:27:32Z", "path": "src/main/java/com/faforever/client/remote/domain/GameMatchmakingMessage.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package com.faforever.client.remote.domain;\n+\n+import lombok.Getter;\n+\n+@Getter\n+public class GameMatchmakingMessage extends ClientMessage {\n+\n+  private final String queue_name;\n+  private final MatchmakingState state;\n+\n+  public GameMatchmakingMessage(String queue_name, MatchmakingState state) {\n+    super(ClientMessageType.GAME_MATCHMAKING);\n+    this.queue_name = queue_name;\n+    this.state = state;\n+  }\n+\n+}", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/GameMatchmakingMessage.java b/src/main/java/com/faforever/client/remote/domain/GameMatchmakingMessage.java\nindex e30878e10..ee8d1f3b6 100644\n--- a/src/main/java/com/faforever/client/remote/domain/GameMatchmakingMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/GameMatchmakingMessage.java\n\n@@ -5,12 +5,12 @@ import lombok.Getter;\n @Getter\n public class GameMatchmakingMessage extends ClientMessage {\n \n-  private final String queue_name;\n+  private final String queueName;\n   private final MatchmakingState state;\n \n-  public GameMatchmakingMessage(String queue_name, MatchmakingState state) {\n+  public GameMatchmakingMessage(String queueName, MatchmakingState state) {\n     super(ClientMessageType.GAME_MATCHMAKING);\n-    this.queue_name = queue_name;\n+    this.queueName = queueName;\n     this.state = state;\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMTc2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536221767", "bodyText": "stop it", "author": "Brutus5000", "createdAt": "2020-12-04T16:27:43Z", "path": "src/main/java/com/faforever/client/remote/domain/InviteToPartyMessage.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.faforever.client.remote.domain;\n+\n+public class InviteToPartyMessage extends ClientMessage {\n+\n+  private Integer recipient_id;\n+\n+  public InviteToPartyMessage(Integer recipient_id) {\n+    super(ClientMessageType.INVITE_TO_PARTY);\n+    this.recipient_id = recipient_id;\n+  }\n+\n+  public Integer getRecipient_id() {\n+    return recipient_id;\n+  }\n+\n+  public void setRecipient_id(Integer recipient_id) {\n+    this.recipient_id = recipient_id;\n+  }\n+}", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/InviteToPartyMessage.java b/src/main/java/com/faforever/client/remote/domain/InviteToPartyMessage.java\nindex 46c940d36..649c294bb 100644\n--- a/src/main/java/com/faforever/client/remote/domain/InviteToPartyMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/InviteToPartyMessage.java\n\n@@ -1,19 +1,15 @@\n package com.faforever.client.remote.domain;\n \n+import lombok.Getter;\n+\n+@Getter\n public class InviteToPartyMessage extends ClientMessage {\n \n-  private Integer recipient_id;\n+  private final Integer recipientId;\n \n-  public InviteToPartyMessage(Integer recipient_id) {\n+  public InviteToPartyMessage(Integer recipientId) {\n     super(ClientMessageType.INVITE_TO_PARTY);\n-    this.recipient_id = recipient_id;\n-  }\n-\n-  public Integer getRecipient_id() {\n-    return recipient_id;\n+    this.recipientId = recipientId;\n   }\n \n-  public void setRecipient_id(Integer recipient_id) {\n-    this.recipient_id = recipient_id;\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMTk1NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536221955", "bodyText": "my eyes!! \ud83d\udc40", "author": "Brutus5000", "createdAt": "2020-12-04T16:27:59Z", "path": "src/main/java/com/faforever/client/remote/domain/KickPlayerFromPartyMessage.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package com.faforever.client.remote.domain;\n+\n+public class KickPlayerFromPartyMessage extends ClientMessage {\n+\n+  private Integer kicked_player_id;\n+\n+  public KickPlayerFromPartyMessage(Integer kicked_player_id) {\n+    super(ClientMessageType.KICK_PLAYER_FROM_PARTY);\n+    this.kicked_player_id = kicked_player_id;\n+  }\n+\n+  public Integer getKicked_player_id() {\n+    return kicked_player_id;\n+  }\n+\n+  public void setKicked_player_id(Integer kicked_player_id) {\n+    this.kicked_player_id = kicked_player_id;\n+  }\n+}", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/KickPlayerFromPartyMessage.java b/src/main/java/com/faforever/client/remote/domain/KickPlayerFromPartyMessage.java\nindex b7288ef01..e950bac39 100644\n--- a/src/main/java/com/faforever/client/remote/domain/KickPlayerFromPartyMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/KickPlayerFromPartyMessage.java\n\n@@ -1,19 +1,15 @@\n package com.faforever.client.remote.domain;\n \n+import lombok.Getter;\n+\n+@Getter\n public class KickPlayerFromPartyMessage extends ClientMessage {\n \n-  private Integer kicked_player_id;\n+  private final Integer kickedPlayerId;\n \n-  public KickPlayerFromPartyMessage(Integer kicked_player_id) {\n+  public KickPlayerFromPartyMessage(Integer kickedPlayerId) {\n     super(ClientMessageType.KICK_PLAYER_FROM_PARTY);\n-    this.kicked_player_id = kicked_player_id;\n-  }\n-\n-  public Integer getKicked_player_id() {\n-    return kicked_player_id;\n+    this.kickedPlayerId = kickedPlayerId;\n   }\n \n-  public void setKicked_player_id(Integer kicked_player_id) {\n-    this.kicked_player_id = kicked_player_id;\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMjY1MA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536222650", "bodyText": "Please put line breaks after each stream operation", "author": "Brutus5000", "createdAt": "2020-12-04T16:29:00Z", "path": "src/main/java/com/faforever/client/remote/domain/MatchmakingState.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package com.faforever.client.remote.domain;\n+\n+import java.util.Arrays;\n+\n+public enum MatchmakingState {\n+  START(\"start\"), STOP(\"stop\");\n+\n+  private String string;\n+\n+  MatchmakingState(String string) {\n+    this.string = string;\n+  }\n+\n+  public static MatchmakingState fromString(String string) {\n+    return Arrays.stream(MatchmakingState.values()).filter(s -> s.getString().equals(string)).findFirst().orElse(null);", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/MatchmakingState.java b/src/main/java/com/faforever/client/remote/domain/MatchmakingState.java\nindex e7195e32d..99142066a 100644\n--- a/src/main/java/com/faforever/client/remote/domain/MatchmakingState.java\n+++ b/src/main/java/com/faforever/client/remote/domain/MatchmakingState.java\n\n@@ -5,14 +5,17 @@ import java.util.Arrays;\n public enum MatchmakingState {\n   START(\"start\"), STOP(\"stop\");\n \n-  private String string;\n+  private final String string;\n \n   MatchmakingState(String string) {\n     this.string = string;\n   }\n \n   public static MatchmakingState fromString(String string) {\n-    return Arrays.stream(MatchmakingState.values()).filter(s -> s.getString().equals(string)).findFirst().orElse(null);\n+    return Arrays.stream(MatchmakingState.values())\n+        .filter(s -> s.getString().equals(string))\n+        .findFirst()\n+        .orElse(null);\n   }\n \n   public String getString() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMzM5Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536223396", "bodyText": "Use lombok instead", "author": "Brutus5000", "createdAt": "2020-12-04T16:30:08Z", "path": "src/main/java/com/faforever/client/remote/domain/PartyInviteMessage.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.faforever.client.remote.domain;\n+\n+public class PartyInviteMessage extends FafServerMessage {\n+\n+  private Integer sender;\n+\n+  public PartyInviteMessage() {\n+    super(FafServerMessageType.PARTY_INVITE);\n+  }\n+\n+  public Integer getSender() {\n+    return sender;\n+  }\n+\n+  public void setSender(Integer sender) {\n+    this.sender = sender;\n+  }", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/PartyInviteMessage.java b/src/main/java/com/faforever/client/remote/domain/PartyInviteMessage.java\nindex eba9cac6f..5dadd0fc5 100644\n--- a/src/main/java/com/faforever/client/remote/domain/PartyInviteMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/PartyInviteMessage.java\n\n@@ -1,5 +1,10 @@\n package com.faforever.client.remote.domain;\n \n+import lombok.Getter;\n+import lombok.Setter;\n+\n+@Getter\n+@Setter\n public class PartyInviteMessage extends FafServerMessage {\n \n   private Integer sender;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyMzY0NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536223645", "bodyText": "Use lombok instead", "author": "Brutus5000", "createdAt": "2020-12-04T16:30:31Z", "path": "src/main/java/com/faforever/client/remote/domain/SetPartyFactionsMessage.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.faforever.client.remote.domain;\n+\n+import com.faforever.client.game.Faction;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+public class SetPartyFactionsMessage extends ClientMessage {\n+\n+  private List<String> factions;\n+\n+  public SetPartyFactionsMessage(List<Faction> factions) {\n+    super(ClientMessageType.SET_PARTY_FACTIONS);\n+    this.factions = factions.stream().map(Faction::getString).collect(Collectors.toList());\n+  }\n+\n+  public List<String> getFactions() {\n+    return factions;\n+  }\n+\n+  public void setFactions(List<String> factions) {\n+    this.factions = factions;\n+  }", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/domain/SetPartyFactionsMessage.java b/src/main/java/com/faforever/client/remote/domain/SetPartyFactionsMessage.java\nindex f06f0402c..7c166aa57 100644\n--- a/src/main/java/com/faforever/client/remote/domain/SetPartyFactionsMessage.java\n+++ b/src/main/java/com/faforever/client/remote/domain/SetPartyFactionsMessage.java\n\n@@ -1,10 +1,14 @@\n package com.faforever.client.remote.domain;\n \n import com.faforever.client.game.Faction;\n+import lombok.Getter;\n+import lombok.Setter;\n \n import java.util.List;\n import java.util.stream.Collectors;\n \n+@Getter\n+@Setter\n public class SetPartyFactionsMessage extends ClientMessage {\n \n   private List<String> factions;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNTA5Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536225097", "bodyText": "Wait what? An object isn't allowed to change itself outside of the main thread?", "author": "Brutus5000", "createdAt": "2020-12-04T16:32:43Z", "path": "src/main/java/com/faforever/client/teammatchmaking/Party.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import javafx.application.Platform;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.AllArgsConstructor;\n+import lombok.Data;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+@Slf4j\n+public class Party {\n+\n+  private final ObjectProperty<Player> owner;\n+  private ObservableList<PartyMember> members;\n+\n+  public Party() {\n+    owner = new SimpleObjectProperty<>();\n+    members = FXCollections.observableArrayList();\n+  }\n+\n+  public void fromInfoMessage(PartyInfoMessage message, PlayerService playerService) {\n+    playerService.getPlayersByIds(Collections.singletonList(message.getOwner()))\n+        .thenAccept(players -> {\n+          if (!players.isEmpty()) {\n+            Platform.runLater(() -> owner.set(players.get(0)));", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4OTU2NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536789564", "bodyText": "This seems fishy it should be able to run outside the main thread unless it is bound to some graphic somewhere", "author": "Sheikah45", "createdAt": "2020-12-05T14:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzE1ODg3Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r537158876", "bodyText": "There are a lot of graphical bindings to this, so it is necessary", "author": "BlackYps", "createdAt": "2020-12-07T00:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNTA5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/Party.java b/src/main/java/com/faforever/client/teammatchmaking/Party.java\nindex 81413f92a..b15fe2cf1 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/Party.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/Party.java\n\n@@ -14,7 +14,6 @@ import lombok.Data;\n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Objects;\n import java.util.Optional;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNTMzNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536225335", "bodyText": "use List.of(message.getOwner())", "author": "Brutus5000", "createdAt": "2020-12-04T16:33:06Z", "path": "src/main/java/com/faforever/client/teammatchmaking/Party.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import javafx.application.Platform;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.AllArgsConstructor;\n+import lombok.Data;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+@Slf4j\n+public class Party {\n+\n+  private final ObjectProperty<Player> owner;\n+  private ObservableList<PartyMember> members;\n+\n+  public Party() {\n+    owner = new SimpleObjectProperty<>();\n+    members = FXCollections.observableArrayList();\n+  }\n+\n+  public void fromInfoMessage(PartyInfoMessage message, PlayerService playerService) {\n+    playerService.getPlayersByIds(Collections.singletonList(message.getOwner()))", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/Party.java b/src/main/java/com/faforever/client/teammatchmaking/Party.java\nindex 81413f92a..b15fe2cf1 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/Party.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/Party.java\n\n@@ -14,7 +14,6 @@ import lombok.Data;\n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Objects;\n import java.util.Optional;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNjQzOQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536226439", "bodyText": "This is a heavy violation of separation of concerns. This method is NOT allowed in a dto. Put it into the playerservice or wherever you need it.", "author": "Brutus5000", "createdAt": "2020-12-04T16:34:47Z", "path": "src/main/java/com/faforever/client/teammatchmaking/Party.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import javafx.application.Platform;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.AllArgsConstructor;\n+import lombok.Data;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+@Slf4j\n+public class Party {\n+\n+  private final ObjectProperty<Player> owner;\n+  private ObservableList<PartyMember> members;\n+\n+  public Party() {\n+    owner = new SimpleObjectProperty<>();\n+    members = FXCollections.observableArrayList();\n+  }\n+\n+  public void fromInfoMessage(PartyInfoMessage message, PlayerService playerService) {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/Party.java b/src/main/java/com/faforever/client/teammatchmaking/Party.java\nindex 81413f92a..b15fe2cf1 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/Party.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/Party.java\n\n@@ -14,7 +14,6 @@ import lombok.Data;\n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Objects;\n import java.util.Optional;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyNzAxMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536227012", "bodyText": "The nested complexitiy of these lines is too damn high. Outsource it in functions or at least improve formatting with proper linebreaking on each stream.", "author": "Brutus5000", "createdAt": "2020-12-04T16:35:37Z", "path": "src/main/java/com/faforever/client/teammatchmaking/Party.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import javafx.application.Platform;\n+import javafx.beans.property.ObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.AllArgsConstructor;\n+import lombok.Data;\n+import lombok.extern.slf4j.Slf4j;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.stream.Collectors;\n+\n+@Slf4j\n+public class Party {\n+\n+  private final ObjectProperty<Player> owner;\n+  private ObservableList<PartyMember> members;\n+\n+  public Party() {\n+    owner = new SimpleObjectProperty<>();\n+    members = FXCollections.observableArrayList();\n+  }\n+\n+  public void fromInfoMessage(PartyInfoMessage message, PlayerService playerService) {\n+    playerService.getPlayersByIds(Collections.singletonList(message.getOwner()))\n+        .thenAccept(players -> {\n+          if (!players.isEmpty()) {\n+            Platform.runLater(() -> owner.set(players.get(0)));\n+          }\n+        });\n+\n+    playerService\n+        .getPlayersByIds(message.getMembers().stream().map(PartyInfoMessage.PartyMember::getPlayer).collect(Collectors.toList()))\n+        .thenAccept(players -> {\n+          List<PartyMember> members = message.getMembers().stream().map(member -> {\n+            Optional<Player> player;\n+            if (playerService.getCurrentPlayer().map(Player::getId).map(id -> id.equals(member.getPlayer())).orElse(false)) {\n+              player = playerService.getCurrentPlayer(); // The player found by the search below might contain less information (e.g. a missing flag)\n+            } else {\n+              player = players.stream().filter(playerToBeFiltered -> playerToBeFiltered.getId() == member.getPlayer()).findFirst();\n+            }\n+\n+            if (!player.isPresent()) {\n+              log.warn(\"Could not find party member {}\", member.getPlayer());\n+              return null;\n+            } else {\n+              return new PartyMember(player.get(), member.getFactions());\n+            }\n+          }).filter(Objects::nonNull).collect(Collectors.toList());\n+          //TODO: this is a race condition. The api might answer with big delay and then server message order might be changed.\n+          Platform.runLater(() -> this.members.setAll(members));\n+        });", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/Party.java b/src/main/java/com/faforever/client/teammatchmaking/Party.java\nindex 81413f92a..b15fe2cf1 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/Party.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/Party.java\n\n@@ -14,7 +14,6 @@ import lombok.Data;\n import lombok.extern.slf4j.Slf4j;\n \n import java.util.Arrays;\n-import java.util.Collections;\n import java.util.List;\n import java.util.Objects;\n import java.util.Optional;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyODgzMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536228833", "bodyText": "Revert revert! :D", "author": "Brutus5000", "createdAt": "2020-12-04T16:38:18Z", "path": "src/test/java/com/faforever/client/chat/AbstractChatTabControllerTest.java", "diffHunk": "@@ -233,6 +234,7 @@ public void testOnChatMessageAction() {\n   }\n \n   @Test\n+  @Ignore // TODO: REVERT", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "adfe7a5cd79e54cfab1ae93d7cd54d1345705925", "chunk": "diff --git a/src/test/java/com/faforever/client/chat/AbstractChatTabControllerTest.java b/src/test/java/com/faforever/client/chat/AbstractChatTabControllerTest.java\nindex 969bd4760..dd3533718 100644\n--- a/src/test/java/com/faforever/client/chat/AbstractChatTabControllerTest.java\n+++ b/src/test/java/com/faforever/client/chat/AbstractChatTabControllerTest.java\n\n@@ -234,7 +234,6 @@ public class AbstractChatTabControllerTest extends AbstractPlainJavaFxTest {\n   }\n \n   @Test\n-  @Ignore // TODO: REVERT\n   public void testHasFocus() {\n     assertThat(instance.hasFocus(), is(true));\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyOTA2OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536229068", "bodyText": "I guess this block can be removed now.", "author": "Brutus5000", "createdAt": "2020-12-04T16:38:39Z", "path": "src/test/java/com/faforever/client/game/GameServiceTest.java", "diffHunk": "@@ -484,80 +479,83 @@ public void testOnGameInfoRemove() {\n     assertThat(instance.getGames(), empty());\n   }\n \n-  @Test\n-  public void testStartSearchLadder1v1() throws Exception {\n-    int uid = 123;\n-    String map = \"scmp_037\";\n-    GameLaunchMessage gameLaunchMessage = new GameLaunchMessageBuilder().defaultValues()\n-        .uid(uid).mod(\"ladder1v1\").mapname(map)\n-        .expectedPlayers(2)\n-        .faction(CYBRAN)\n-        .initMode(LobbyMode.AUTO_LOBBY)\n-        .mapPosition(4)\n-        .team(1)\n-        .get();\n-\n-    FeaturedMod featuredMod = FeaturedModBeanBuilder.create().defaultValues().get();\n-\n-    String[] additionalArgs = {\"/team\", \"1\", \"/players\", \"2\", \"/startspot\", \"4\"};\n-    mockStartGameProcess(uid, RatingMode.LADDER_1V1, CYBRAN, false, additionalArgs);\n-    when(fafService.startSearchLadder1v1(CYBRAN)).thenReturn(completedFuture(gameLaunchMessage));\n-    when(gameUpdater.update(featuredMod, null, Collections.emptyMap(), Collections.emptySet())).thenReturn(completedFuture(null));\n-    when(mapService.isInstalled(map)).thenReturn(false);\n-    when(mapService.download(map)).thenReturn(completedFuture(null));\n-    when(modService.getFeaturedMod(LADDER_1V1.getTechnicalName())).thenReturn(completedFuture(featuredMod));\n-\n-    instance.startSearchLadder1v1(CYBRAN).toCompletableFuture();\n-\n-    verify(fafService).startSearchLadder1v1(CYBRAN);\n-    verify(mapService).download(map);\n-    verify(replayService).start(eq(uid), any());\n-    verify(forgedAllianceService).startGame(\n-        uid, CYBRAN, asList(additionalArgs), RatingMode.LADDER_1V1, GPG_PORT, LOCAL_REPLAY_PORT, false, junitPlayer);\n-  }\n-\n-  @Test\n-  public void testStartSearchLadder1v1GameRunningDoesNothing() throws Exception {\n-    Process process = mock(Process.class);\n-    when(process.isAlive()).thenReturn(true);\n-\n-    NewGameInfo newGameInfo = NewGameInfoBuilder.create().defaultValues().get();\n-    GameLaunchMessage gameLaunchMessage = GameLaunchMessageBuilder.create().defaultValues().get();\n-\n-    when(forgedAllianceService.startGame(anyInt(), any(), any(), any(), anyInt(), eq(LOCAL_REPLAY_PORT), eq(false), eq(junitPlayer))).thenReturn(process);\n-    when(gameUpdater.update(any(), any(), any(), any())).thenReturn(completedFuture(null));\n-    when(fafService.requestHostGame(newGameInfo)).thenReturn(completedFuture(gameLaunchMessage));\n-    when(mapService.download(newGameInfo.getMap())).thenReturn(completedFuture(null));\n-\n-    CountDownLatch gameRunningLatch = new CountDownLatch(1);\n-    instance.gameRunningProperty().addListener((observable, oldValue, newValue) -> {\n-      if (newValue) {\n-        gameRunningLatch.countDown();\n-      }\n-    });\n-\n-    instance.hostGame(newGameInfo);\n-    gameRunningLatch.await(TIMEOUT, TIME_UNIT);\n-\n-    instance.startSearchLadder1v1(AEON);\n-\n-    assertThat(instance.searching1v1Property().get(), is(false));\n-  }\n+  //TODO: remove/reimplement TMM", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5NDU5Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536894593", "bodyText": "same here", "author": "BlackYps", "createdAt": "2020-12-05T21:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyOTA2OA=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/test/java/com/faforever/client/game/GameServiceTest.java b/src/test/java/com/faforever/client/game/GameServiceTest.java\nindex 84d6cd3e9..9efca9dc6 100644\n--- a/src/test/java/com/faforever/client/game/GameServiceTest.java\n+++ b/src/test/java/com/faforever/client/game/GameServiceTest.java\n\n@@ -479,68 +483,65 @@ public class GameServiceTest extends AbstractPlainJavaFxTest {\n     assertThat(instance.getGames(), empty());\n   }\n \n-  //TODO: remove/reimplement TMM\n-//  @Test\n-//  public void testStartSearchLadder1v1() throws Exception {\n-//    int uid = 123;\n-//    String map = \"scmp_037\";\n-//    GameLaunchMessage gameLaunchMessage = new GameLaunchMessageBuilder().defaultValues()\n-//        .uid(uid).mod(\"ladder1v1\").mapname(map)\n-//        .expectedPlayers(2)\n-//        .faction(CYBRAN)\n-//        .initMode(LobbyMode.AUTO_LOBBY)\n-//        .mapPosition(4)\n-//        .team(1)\n-//        .get();\n-//\n-//    FeaturedMod featuredMod = FeaturedModBeanBuilder.create().defaultValues().get();\n-//\n-//    String[] additionalArgs = {\"/team\", \"1\", \"/players\", \"2\", \"/startspot\", \"4\"};\n-//    mockStartGameProcess(uid, RatingMode.LADDER_1V1, CYBRAN, false, additionalArgs);\n-//    when(fafService.startSearchLadder1v1(CYBRAN)).thenReturn(completedFuture(gameLaunchMessage));\n-//    when(gameUpdater.update(featuredMod, null, Collections.emptyMap(), Collections.emptySet())).thenReturn(completedFuture(null));\n-//    when(mapService.isInstalled(map)).thenReturn(false);\n-//    when(mapService.download(map)).thenReturn(completedFuture(null));\n-//    when(modService.getFeaturedMod(LADDER_1V1.getTechnicalName())).thenReturn(completedFuture(featuredMod));\n-//\n-//    instance.startSearchLadder1v1(CYBRAN).toCompletableFuture();\n-//\n-//    verify(fafService).startSearchLadder1v1(CYBRAN);\n-//    verify(mapService).download(map);\n-//    verify(replayService).start(eq(uid), any());\n-//    verify(forgedAllianceService).startGame(\n-//        uid, CYBRAN, asList(additionalArgs), RatingMode.LADDER_1V1, GPG_PORT, LOCAL_REPLAY_PORT, false, junitPlayer);\n-//  }\n-\n-\n-  //TODO: remove/reimplement TMM\n-//  @Test\n-//  public void testStartSearchLadder1v1GameRunningDoesNothing() throws Exception {\n-//    Process process = mock(Process.class);\n-//    when(process.isAlive()).thenReturn(true);\n-//\n-//    NewGameInfo newGameInfo = NewGameInfoBuilder.create().defaultValues().get();\n-//    GameLaunchMessage gameLaunchMessage = GameLaunchMessageBuilder.create().defaultValues().get();\n-//\n-//    when(forgedAllianceService.startGame(anyInt(), any(), any(), any(), anyInt(), eq(LOCAL_REPLAY_PORT), eq(false), eq(junitPlayer))).thenReturn(process);\n-//    when(gameUpdater.update(any(), any(), any(), any())).thenReturn(completedFuture(null));\n-//    when(fafService.requestHostGame(newGameInfo)).thenReturn(completedFuture(gameLaunchMessage));\n-//    when(mapService.download(newGameInfo.getMap())).thenReturn(completedFuture(null));\n-//\n-//    CountDownLatch gameRunningLatch = new CountDownLatch(1);\n-//    instance.gameRunningProperty().addListener((observable, oldValue, newValue) -> {\n-//      if (newValue) {\n-//        gameRunningLatch.countDown();\n-//      }\n-//    });\n-//\n-//    instance.hostGame(newGameInfo);\n-//    gameRunningLatch.await(TIMEOUT, TIME_UNIT);\n-//\n-//    instance.startSearchLadder1v1(AEON);\n-//\n-//    assertThat(instance.inMatchmakerQueueProperty().get(), is(false));\n-//  }\n+  @Test\n+  public void testStartSearchLadder1v1() throws Exception {\n+    int uid = 123;\n+    String map = \"scmp_037\";\n+    GameLaunchMessage gameLaunchMessage = new GameLaunchMessageBuilder().defaultValues()\n+        .uid(uid).mod(\"FAF\").mapname(map)\n+        .expectedPlayers(2)\n+        .faction(CYBRAN)\n+        .initMode(LobbyMode.AUTO_LOBBY)\n+        .mapPosition(4)\n+        .team(1)\n+        .get();\n+\n+    FeaturedMod featuredMod = FeaturedModBeanBuilder.create().defaultValues().get();\n+\n+    String[] additionalArgs = {\"/team\", \"1\", \"/players\", \"2\", \"/startspot\", \"4\"};\n+    mockStartGameProcess(uid, RatingMode.NONE, CYBRAN, false, additionalArgs);\n+    when(fafService.startSearchMatchmaker()).thenReturn(completedFuture(gameLaunchMessage));\n+    when(gameUpdater.update(featuredMod, null, Collections.emptyMap(), Collections.emptySet())).thenReturn(completedFuture(null));\n+    when(mapService.isInstalled(map)).thenReturn(false);\n+    when(mapService.download(map)).thenReturn(completedFuture(null));\n+    when(modService.getFeaturedMod(FAF.getTechnicalName())).thenReturn(completedFuture(featuredMod));\n+\n+    instance.startSearchMatchmaker().toCompletableFuture();\n+\n+    verify(fafService).startSearchMatchmaker();\n+    verify(mapService).download(map);\n+    verify(replayService).start(eq(uid), any());\n+    verify(forgedAllianceService).startGame(\n+        uid, CYBRAN, asList(additionalArgs), RatingMode.NONE, GPG_PORT, LOCAL_REPLAY_PORT, false, junitPlayer);\n+  }\n+\n+  @Test\n+  public void testStartSearchMatchmakerGameRunningDoesNothing() throws Exception {\n+    Process process = mock(Process.class);\n+    when(process.isAlive()).thenReturn(true);\n+\n+    NewGameInfo newGameInfo = NewGameInfoBuilder.create().defaultValues().get();\n+    GameLaunchMessage gameLaunchMessage = GameLaunchMessageBuilder.create().defaultValues().get();\n+\n+    when(forgedAllianceService.startGame(anyInt(), any(), any(), any(), anyInt(), eq(LOCAL_REPLAY_PORT), eq(false), eq(junitPlayer))).thenReturn(process);\n+    when(gameUpdater.update(any(), any(), any(), any())).thenReturn(completedFuture(null));\n+    when(fafService.requestHostGame(newGameInfo)).thenReturn(completedFuture(gameLaunchMessage));\n+    when(mapService.download(newGameInfo.getMap())).thenReturn(completedFuture(null));\n+\n+    CountDownLatch gameRunningLatch = new CountDownLatch(1);\n+    instance.gameRunningProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        gameRunningLatch.countDown();\n+      }\n+    });\n+\n+    instance.hostGame(newGameInfo);\n+    gameRunningLatch.await(TIMEOUT, TIME_UNIT);\n+\n+    instance.startSearchMatchmaker();\n+\n+    assertThat(instance.inMatchmakerQueueProperty().get(), is(false));\n+  }\n \n   @Test\n   public void testStopSearchMatchmaker() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyOTE5Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536229192", "bodyText": "Can be removed now as well?", "author": "Brutus5000", "createdAt": "2020-12-04T16:38:52Z", "path": "src/test/java/com/faforever/client/game/GameServiceTest.java", "diffHunk": "@@ -629,12 +627,13 @@ public void runWithLiveReplayIfNoGameSet() {\n     verify(eventBus).post(any(GameDirectoryChooseEvent.class));\n   }\n \n-  @Test\n-  public void startSearchLadder1v1IfNoGameSet() {\n-    when(preferencesService.isGamePathValid()).thenReturn(false);\n-    instance.startSearchLadder1v1(null);\n-    verify(eventBus).post(any(GameDirectoryChooseEvent.class));\n-  }\n+  //TODO: remove/reimplement TMM", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgwMDMwNA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536800304", "bodyText": "I think it needs to be reimplemented otherwise there is no test for this I think", "author": "Sheikah45", "createdAt": "2020-12-05T14:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyOTE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5NDUyMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536894521", "bodyText": "Reimplementing this was surprisingly easy", "author": "BlackYps", "createdAt": "2020-12-05T21:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIyOTE5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/test/java/com/faforever/client/game/GameServiceTest.java b/src/test/java/com/faforever/client/game/GameServiceTest.java\nindex 84d6cd3e9..9efca9dc6 100644\n--- a/src/test/java/com/faforever/client/game/GameServiceTest.java\n+++ b/src/test/java/com/faforever/client/game/GameServiceTest.java\n\n@@ -627,13 +628,12 @@ public class GameServiceTest extends AbstractPlainJavaFxTest {\n     verify(eventBus).post(any(GameDirectoryChooseEvent.class));\n   }\n \n-  //TODO: remove/reimplement TMM\n-//  @Test\n-//  public void startSearchLadder1v1IfNoGameSet() {\n-//    when(preferencesService.isGamePathValid()).thenReturn(false);\n-//    instance.startSearchLadder1v1(null);\n-//    verify(eventBus).post(any(GameDirectoryChooseEvent.class));\n-//  }\n+  @Test\n+  public void startSearchMatchmakerIfNoGameSet() {\n+    when(preferencesService.isGamePathValid()).thenReturn(false);\n+    instance.startSearchMatchmaker();\n+    verify(eventBus).post(any(GameDirectoryChooseEvent.class));\n+  }\n \n   @Test\n   public void joinGameIfNoGameSet() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIzMDE5Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536230193", "bodyText": "I see a lot of empty tests there.", "author": "Brutus5000", "createdAt": "2020-12-04T16:40:26Z", "path": "src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java", "diffHunk": "@@ -0,0 +1,240 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.game.GameService;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.net.ConnectionState;\n+import com.faforever.client.notification.ImmediateNotification;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.remote.FafServerAccessor;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.MatchmakingState;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import com.faforever.client.remote.domain.PartyInviteMessage;\n+import com.faforever.client.remote.domain.PartyKickedMessage;\n+import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.test.AbstractPlainJavaFxTest;\n+import com.google.common.eventbus.EventBus;\n+import javafx.beans.property.ReadOnlyObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mock;\n+import org.springframework.scheduling.TaskScheduler;\n+import org.testfx.util.WaitForAsyncUtils;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+\n+import static com.faforever.client.notification.Severity.INFO;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.verifyNoMoreInteractions;\n+import static org.mockito.Mockito.when;\n+\n+public class TeamMatchmakingServiceTest extends AbstractPlainJavaFxTest {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java b/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\nindex 115186996..c8b8ee743 100644\n--- a/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\n+++ b/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\n\n@@ -1,21 +1,31 @@\n package com.faforever.client.teammatchmaking;\n \n+import com.faforever.client.fa.relay.LobbyMode;\n+import com.faforever.client.game.Faction;\n import com.faforever.client.game.GameService;\n import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.OpenTeamMatchmakingEvent;\n import com.faforever.client.net.ConnectionState;\n import com.faforever.client.notification.ImmediateNotification;\n import com.faforever.client.notification.NotificationService;\n import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.notification.TransientNotification;\n import com.faforever.client.player.Player;\n import com.faforever.client.player.PlayerService;\n import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage.MatchmakerQueue;\n import com.faforever.client.remote.FafServerAccessor;\n import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.GameLaunchMessage;\n+import com.faforever.client.remote.domain.MatchCancelledMessage;\n+import com.faforever.client.remote.domain.MatchFoundMessage;\n import com.faforever.client.remote.domain.MatchmakingState;\n import com.faforever.client.remote.domain.PartyInfoMessage;\n import com.faforever.client.remote.domain.PartyInviteMessage;\n import com.faforever.client.remote.domain.PartyKickedMessage;\n import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.MatchmakingQueue.MatchingStatus;\n import com.faforever.client.teammatchmaking.Party.PartyMember;\n import com.faforever.client.test.AbstractPlainJavaFxTest;\n import com.google.common.eventbus.EventBus;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Mjg3Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536352877", "bodyText": "playerTextField.getText().isBlank()", "author": "Brutus5000", "createdAt": "2020-12-04T20:11:25Z", "path": "src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.player.SocialStatus;\n+import javafx.beans.binding.Bindings;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.collections.transformation.SortedList;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.ListView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.Pane;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class InvitePlayerController implements Controller<Pane> {\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final ObservableList<String> playerList = FXCollections.observableArrayList();\n+  private final FilteredList<String> filteredPlayerList = new FilteredList<>(playerList, p -> true);\n+  private final SortedList<String> sortedPlayerList = new SortedList<>(filteredPlayerList, Comparator.naturalOrder());\n+\n+  public Pane root;\n+  public TextField playerTextField;\n+  public ListView<String> playersListView;\n+  public ListView<String> invitedPlayersListView;\n+\n+  @Override\n+  public void initialize() {\n+    playerTextField.textProperty().addListener((observable, oldValue, newValue) -> {\n+      playerList.setAll(getPlayerNames());\n+      playersListView.getSelectionModel().selectFirst();\n+    });\n+\n+\n+    //TODO: use longest common subsequence instead and sort list\n+    filteredPlayerList.predicateProperty().bind(Bindings.createObjectBinding(() -> p -> {\n+          if (playerService.getCurrentPlayer().map(Player::getUsername).map(n -> n.equals(p)).orElse(true)) {\n+            return false;\n+          }\n+\n+          if (playerTextField.getText().trim().equals(\"\")) {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\nindex 5544f253d..f24fade4b 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n\n@@ -4,6 +4,7 @@ import com.faforever.client.fx.Controller;\n import com.faforever.client.player.Player;\n import com.faforever.client.player.PlayerService;\n import com.faforever.client.player.SocialStatus;\n+import javafx.application.Platform;\n import javafx.beans.binding.Bindings;\n import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Mjk5Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536352996", "bodyText": "Is this todo still relevant?", "author": "Brutus5000", "createdAt": "2020-12-04T20:11:36Z", "path": "src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.player.SocialStatus;\n+import javafx.beans.binding.Bindings;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.collections.transformation.SortedList;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.ListView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.Pane;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class InvitePlayerController implements Controller<Pane> {\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final ObservableList<String> playerList = FXCollections.observableArrayList();\n+  private final FilteredList<String> filteredPlayerList = new FilteredList<>(playerList, p -> true);\n+  private final SortedList<String> sortedPlayerList = new SortedList<>(filteredPlayerList, Comparator.naturalOrder());\n+\n+  public Pane root;\n+  public TextField playerTextField;\n+  public ListView<String> playersListView;\n+  public ListView<String> invitedPlayersListView;\n+\n+  @Override\n+  public void initialize() {\n+    playerTextField.textProperty().addListener((observable, oldValue, newValue) -> {\n+      playerList.setAll(getPlayerNames());\n+      playersListView.getSelectionModel().selectFirst();\n+    });\n+\n+\n+    //TODO: use longest common subsequence instead and sort list", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjcxMjcxNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536712715", "bodyText": "seems to be already implemented", "author": "BlackYps", "createdAt": "2020-12-05T12:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Mjk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4NzE3Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536787177", "bodyText": "So the TODO should be removed then", "author": "Sheikah45", "createdAt": "2020-12-05T14:23:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1Mjk5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\nindex 5544f253d..f24fade4b 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n\n@@ -4,6 +4,7 @@ import com.faforever.client.fx.Controller;\n import com.faforever.client.player.Player;\n import com.faforever.client.player.PlayerService;\n import com.faforever.client.player.SocialStatus;\n+import javafx.application.Platform;\n import javafx.beans.binding.Bindings;\n import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MzI0Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536353246", "bodyText": "Line breaks in the stream operations improves readability", "author": "Brutus5000", "createdAt": "2020-12-04T20:12:04Z", "path": "src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.player.SocialStatus;\n+import javafx.beans.binding.Bindings;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.collections.transformation.SortedList;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.ListView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.Pane;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class InvitePlayerController implements Controller<Pane> {\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final ObservableList<String> playerList = FXCollections.observableArrayList();\n+  private final FilteredList<String> filteredPlayerList = new FilteredList<>(playerList, p -> true);\n+  private final SortedList<String> sortedPlayerList = new SortedList<>(filteredPlayerList, Comparator.naturalOrder());\n+\n+  public Pane root;\n+  public TextField playerTextField;\n+  public ListView<String> playersListView;\n+  public ListView<String> invitedPlayersListView;\n+\n+  @Override\n+  public void initialize() {\n+    playerTextField.textProperty().addListener((observable, oldValue, newValue) -> {\n+      playerList.setAll(getPlayerNames());\n+      playersListView.getSelectionModel().selectFirst();\n+    });\n+\n+\n+    //TODO: use longest common subsequence instead and sort list\n+    filteredPlayerList.predicateProperty().bind(Bindings.createObjectBinding(() -> p -> {\n+          if (playerService.getCurrentPlayer().map(Player::getUsername).map(n -> n.equals(p)).orElse(true)) {\n+            return false;\n+          }\n+\n+          if (playerTextField.getText().trim().equals(\"\")) {\n+            return playerService.getPlayerForUsername(p).map(player -> player.getSocialStatus() == SocialStatus.FRIEND).orElse(false);\n+          } else {\n+            return p.toLowerCase().contains(playerTextField.getText().toLowerCase());\n+          }\n+        }, playerTextField.textProperty()", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\nindex 5544f253d..f24fade4b 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n\n@@ -4,6 +4,7 @@ import com.faforever.client.fx.Controller;\n import com.faforever.client.player.Player;\n import com.faforever.client.player.PlayerService;\n import com.faforever.client.player.SocialStatus;\n+import javafx.application.Platform;\n import javafx.beans.binding.Bindings;\n import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1MzMwMA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536353300", "bodyText": "Remove?", "author": "Brutus5000", "createdAt": "2020-12-04T20:12:10Z", "path": "src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java", "diffHunk": "@@ -0,0 +1,102 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.player.SocialStatus;\n+import javafx.beans.binding.Bindings;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import javafx.collections.transformation.FilteredList;\n+import javafx.collections.transformation.SortedList;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.ListView;\n+import javafx.scene.control.TextField;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.Pane;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.Collection;\n+import java.util.Comparator;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class InvitePlayerController implements Controller<Pane> {\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final ObservableList<String> playerList = FXCollections.observableArrayList();\n+  private final FilteredList<String> filteredPlayerList = new FilteredList<>(playerList, p -> true);\n+  private final SortedList<String> sortedPlayerList = new SortedList<>(filteredPlayerList, Comparator.naturalOrder());\n+\n+  public Pane root;\n+  public TextField playerTextField;\n+  public ListView<String> playersListView;\n+  public ListView<String> invitedPlayersListView;\n+\n+  @Override\n+  public void initialize() {\n+    playerTextField.textProperty().addListener((observable, oldValue, newValue) -> {\n+      playerList.setAll(getPlayerNames());\n+      playersListView.getSelectionModel().selectFirst();\n+    });\n+\n+\n+    //TODO: use longest common subsequence instead and sort list\n+    filteredPlayerList.predicateProperty().bind(Bindings.createObjectBinding(() -> p -> {\n+          if (playerService.getCurrentPlayer().map(Player::getUsername).map(n -> n.equals(p)).orElse(true)) {\n+            return false;\n+          }\n+\n+          if (playerTextField.getText().trim().equals(\"\")) {\n+            return playerService.getPlayerForUsername(p).map(player -> player.getSocialStatus() == SocialStatus.FRIEND).orElse(false);\n+          } else {\n+            return p.toLowerCase().contains(playerTextField.getText().toLowerCase());\n+          }\n+        }, playerTextField.textProperty()\n+    ));\n+\n+    //TODO", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\nindex 5544f253d..f24fade4b 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/InvitePlayerController.java\n\n@@ -4,6 +4,7 @@ import com.faforever.client.fx.Controller;\n import com.faforever.client.player.Player;\n import com.faforever.client.player.PlayerService;\n import com.faforever.client.player.SocialStatus;\n+import javafx.application.Platform;\n import javafx.beans.binding.Bindings;\n import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NTEzMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536355132", "bodyText": "Isn't the toUpperCase something that should be configurable in the control via css or something?", "author": "Brutus5000", "createdAt": "2020-12-04T20:16:00Z", "path": "src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java", "diffHunk": "@@ -0,0 +1,151 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.ShowMapPoolEvent;\n+import com.faforever.client.player.PlayerService;\n+import com.google.common.eventbus.EventBus;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.Timeline;\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ToggleButton;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingQueueItemController implements Controller<Node> {\n+\n+  private final static String QUEUE_I18N_PATTERN = \"teammatchmaking.queue.%s.%s\";\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final I18n i18n;\n+  private final EventBus eventBus;\n+\n+  public Node queueItemRoot;\n+  public Label playersInQueueLabel;\n+  public Label queuePopTimeLabel;\n+  public ToggleButton joinLeaveQueueButton;\n+  public Label refreshingLabel;\n+  public Label matchFoundLabel;\n+  public Label matchStartingLabel;\n+  public Label matchCancelledLabel;\n+  public Button mapPoolButton;\n+\n+\n+  private Timeline queuePopTimeUpdater;\n+\n+  private MatchmakingQueue queue;\n+\n+  public MatchmakingQueueItemController(PlayerService playerService, TeamMatchmakingService teamMatchmakingService, I18n i18n, EventBus eventBus) {\n+    this.playerService = playerService;\n+    this.teamMatchmakingService = teamMatchmakingService;\n+    this.i18n = i18n;\n+    this.eventBus = eventBus;\n+  }\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    joinLeaveQueueButton.widthProperty().addListener(new ChangeListener<Number>() {\n+      @Override\n+      public void changed(ObservableValue<? extends Number> observable, Number oldValue, Number newValue) {\n+        if ((double) newValue > 150.0) {\n+          joinLeaveQueueButton.setText(\n+              i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"fullName\")));\n+        } else {\n+          joinLeaveQueueButton.setText(\n+              i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"shortName\")));\n+        }\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return queueItemRoot;\n+  }\n+\n+  void setQueue(MatchmakingQueue queue) {\n+    this.queue = queue;\n+\n+    playersInQueueLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"teammatchmaking.playersInQueue\", queue.getPlayersInQueue()).toUpperCase(),", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\nindex f53be8668..8e6b89f1c 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n\n@@ -1,19 +1,19 @@\n package com.faforever.client.teammatchmaking;\n \n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.i18n.I18n;\n import com.faforever.client.main.event.ShowMapPoolEvent;\n import com.faforever.client.player.PlayerService;\n import com.google.common.eventbus.EventBus;\n import javafx.animation.KeyFrame;\n import javafx.animation.Timeline;\n-import javafx.beans.value.ChangeListener;\n-import javafx.beans.value.ObservableValue;\n import javafx.event.ActionEvent;\n-import javafx.scene.Node;\n import javafx.scene.control.Button;\n import javafx.scene.control.Label;\n import javafx.scene.control.ToggleButton;\n+import javafx.scene.layout.VBox;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NjE4MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536356181", "bodyText": "Don't tell me it's hacky without telling what and why. I assume the WeakReference is meant here, but it I don't know for sure.", "author": "Brutus5000", "createdAt": "2020-12-04T20:18:01Z", "path": "src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java", "diffHunk": "@@ -0,0 +1,176 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatChannelUser;\n+import com.faforever.client.chat.ChatService;\n+import com.faforever.client.chat.ChatUserContextMenuController;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.util.RatingUtil;\n+import com.google.common.base.Strings;\n+import javafx.application.Platform;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.input.ContextMenuEvent;\n+import javafx.scene.layout.HBox;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.lang.ref.WeakReference;\n+\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class PartyMemberItemController implements Controller<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass PLAYING_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"playing\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final UiService uiService;\n+  private final ChatService chatService;\n+  private final I18n i18n;\n+\n+  public Node playerItemRoot;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public ImageView leagueImageView;\n+  public Button kickPlayerButton;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label leagueLabel;\n+  public Label gameCountLabel;\n+  public Label uefLabel;\n+  public Label cybranLabel;\n+  public Label aeonLabel;\n+  public Label seraphimLabel;\n+  public Label crownLabel;\n+  public HBox playerCard;\n+  public ImageView playerStatusImageView;\n+\n+  private Player player;\n+  //TODO: this is a bit hacky", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQyODcwNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536428707", "bodyText": "I don't know either. That comment is from Geosearchef.", "author": "BlackYps", "createdAt": "2020-12-04T22:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NjE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjY2MjA0Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536662042", "bodyText": "a214cbd", "author": "BlackYps", "createdAt": "2020-12-05T10:32:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NjE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc5MDIyMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536790223", "bodyText": "The contextmenu is separable from the chatUser which might be the thing to do here as I don't understand why the chatUser is necessary if all we want is a context menu", "author": "Sheikah45", "createdAt": "2020-12-05T14:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NjE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc5MzE2Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536793166", "bodyText": "This also seems like it would be a different context menu", "author": "Sheikah45", "createdAt": "2020-12-05T14:36:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM1NjE4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\nindex 89555f347..07f3584b3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n\n@@ -6,6 +6,7 @@ import com.faforever.client.chat.ChatUserContextMenuController;\n import com.faforever.client.chat.CountryFlagService;\n import com.faforever.client.chat.avatar.AvatarService;\n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.game.Faction;\n import com.faforever.client.game.PlayerStatus;\n import com.faforever.client.i18n.I18n;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MTU2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536361567", "bodyText": "StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry()\nIf the string is empty it's empty? Thanks captain.", "author": "Brutus5000", "createdAt": "2020-12-04T20:28:48Z", "path": "src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java", "diffHunk": "@@ -0,0 +1,176 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatChannelUser;\n+import com.faforever.client.chat.ChatService;\n+import com.faforever.client.chat.ChatUserContextMenuController;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.util.RatingUtil;\n+import com.google.common.base.Strings;\n+import javafx.application.Platform;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.input.ContextMenuEvent;\n+import javafx.scene.layout.HBox;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.lang.ref.WeakReference;\n+\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class PartyMemberItemController implements Controller<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass PLAYING_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"playing\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final UiService uiService;\n+  private final ChatService chatService;\n+  private final I18n i18n;\n+\n+  public Node playerItemRoot;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public ImageView leagueImageView;\n+  public Button kickPlayerButton;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label leagueLabel;\n+  public Label gameCountLabel;\n+  public Label uefLabel;\n+  public Label cybranLabel;\n+  public Label aeonLabel;\n+  public Label seraphimLabel;\n+  public Label crownLabel;\n+  public HBox playerCard;\n+  public ImageView playerStatusImageView;\n+\n+  private Player player;\n+  //TODO: this is a bit hacky\n+  private WeakReference<ChatUserContextMenuController> contextMenuController = null;\n+\n+  @Override\n+  public void initialize() {\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return playerItemRoot;\n+  }\n+\n+  private ChatChannelUser chatUser;\n+\n+  public PartyMemberItemController(CountryFlagService countryFlagService, AvatarService avatarService, PlayerService playerService, TeamMatchmakingService teamMatchmakingService, UiService uiService, ChatService chatService, I18n i18n) {\n+    this.countryFlagService = countryFlagService;\n+    this.avatarService = avatarService;\n+    this.playerService = playerService;\n+    this.teamMatchmakingService = teamMatchmakingService;\n+    this.uiService = uiService;\n+    this.chatService = chatService;\n+    this.i18n = i18n;\n+  }\n+\n+  void setMember(PartyMember member) {\n+    this.player = member.getPlayer();\n+    //TODO: this is a bit hacky, a chat channel user is required to create a context menu as in the chat tab (for foeing/befriending/messaging people...)\n+    chatUser = new ChatChannelUser(player.getUsername(), chatService.getChatUserColor(player.getUsername()), false, player);\n+\n+    countryImageView.imageProperty().bind(createObjectBinding(() -> countryFlagService.loadCountryFlag(\n+        StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry()).orElse(null), player.countryProperty()));", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjQzMDM1Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536430352", "bodyText": "This seems to be a nullcheck, no?", "author": "BlackYps", "createdAt": "2020-12-04T22:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MTU2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5NTU5NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536895595", "bodyText": "Yes, but the CountryFlagService.loadCountryFlag has null handling builtin ^^", "author": "Brutus5000", "createdAt": "2020-12-05T21:26:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MTU2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\nindex 89555f347..07f3584b3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n\n@@ -6,6 +6,7 @@ import com.faforever.client.chat.ChatUserContextMenuController;\n import com.faforever.client.chat.CountryFlagService;\n import com.faforever.client.chat.avatar.AvatarService;\n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.game.Faction;\n import com.faforever.client.game.PlayerStatus;\n import com.faforever.client.i18n.I18n;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MzA3Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536363076", "bodyText": "Use @RequiredArgsConstructor", "author": "Brutus5000", "createdAt": "2020-12-04T20:32:00Z", "path": "src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java", "diffHunk": "@@ -0,0 +1,176 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatChannelUser;\n+import com.faforever.client.chat.ChatService;\n+import com.faforever.client.chat.ChatUserContextMenuController;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.util.RatingUtil;\n+import com.google.common.base.Strings;\n+import javafx.application.Platform;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.input.ContextMenuEvent;\n+import javafx.scene.layout.HBox;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.lang.ref.WeakReference;\n+\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class PartyMemberItemController implements Controller<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass PLAYING_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"playing\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final UiService uiService;\n+  private final ChatService chatService;\n+  private final I18n i18n;\n+\n+  public Node playerItemRoot;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public ImageView leagueImageView;\n+  public Button kickPlayerButton;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label leagueLabel;\n+  public Label gameCountLabel;\n+  public Label uefLabel;\n+  public Label cybranLabel;\n+  public Label aeonLabel;\n+  public Label seraphimLabel;\n+  public Label crownLabel;\n+  public HBox playerCard;\n+  public ImageView playerStatusImageView;\n+\n+  private Player player;\n+  //TODO: this is a bit hacky\n+  private WeakReference<ChatUserContextMenuController> contextMenuController = null;\n+\n+  @Override\n+  public void initialize() {\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return playerItemRoot;\n+  }\n+\n+  private ChatChannelUser chatUser;\n+\n+  public PartyMemberItemController(CountryFlagService countryFlagService, AvatarService avatarService, PlayerService playerService, TeamMatchmakingService teamMatchmakingService, UiService uiService, ChatService chatService, I18n i18n) {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\nindex 89555f347..07f3584b3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n\n@@ -6,6 +6,7 @@ import com.faforever.client.chat.ChatUserContextMenuController;\n import com.faforever.client.chat.CountryFlagService;\n import com.faforever.client.chat.avatar.AvatarService;\n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.game.Faction;\n import com.faforever.client.game.PlayerStatus;\n import com.faforever.client.i18n.I18n;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2MzM3Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536363373", "bodyText": "Again here StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry() seems  useless.\nAnd duplicate code", "author": "Brutus5000", "createdAt": "2020-12-04T20:32:39Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,287 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.ui.dialog.Dialog;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  private MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    countryImageView.imageProperty().bind(createObjectBinding(() -> countryFlagService.loadCountryFlag(\n+        StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry()).orElse(null), player.countryProperty()));", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 382577d42..fa6baed87 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -39,12 +39,13 @@ import javafx.scene.layout.StackPane;\n import javafx.scene.layout.VBox;\n import lombok.RequiredArgsConstructor;\n import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n-import org.springframework.util.StringUtils;\n \n import java.util.ArrayList;\n+import java.util.Comparator;\n import java.util.List;\n \n import static javafx.beans.binding.Bindings.createBooleanBinding;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDE4NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536364184", "bodyText": "Can this not be done via css? Then it would be completely redundant (handled in FXML)", "author": "Brutus5000", "createdAt": "2020-12-04T20:34:25Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,287 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.ui.dialog.Dialog;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  private MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    countryImageView.imageProperty().bind(createObjectBinding(() -> countryFlagService.loadCountryFlag(\n+        StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() ->\n+        Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    crownLabel.visibleProperty().bind(createBooleanBinding(() ->\n+        teamMatchmakingService.getParty().getMembers().size() > 1 && teamMatchmakingService.getParty().getOwner().equals(player),\n+        teamMatchmakingService.getParty().ownerProperty(), teamMatchmakingService.getParty().getMembers()));\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> {\n+      playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+          (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+      List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+      partyMemberPane.getChildren().clear();\n+      members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+      for(int i = 0; i < members.size(); i++) {\n+        PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+        controller.setMember(members.get(i));\n+        if (members.size() == 1)\n+          partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+        else\n+          partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+      }\n+    });\n+\n+    invitePlayerButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getOwner().getId() != playerService.getCurrentPlayer().map(Player::getId).orElse(-1),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        playerService.currentPlayerProperty()\n+    ));\n+    leavePartyButton.disableProperty().bind(createBooleanBinding(() -> teamMatchmakingService.getParty().getMembers().size() <= 1, teamMatchmakingService.getParty().getMembers()));\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(String.format(\"#%s'sParty\", newValue.getUsername()));\n+    });\n+    createChannelTab(String.format(\"#%s'sParty\", teamMatchmakingService.getParty().getOwner().getUsername()));\n+\n+    fafService.requestMatchmakerInfo();\n+  }\n+\n+  private void initializeDynamicChatPosition() {\n+    contentPane.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue < 1115.0) {\n+        GridPane.setColumnIndex(chatTabPane, 0);\n+        GridPane.setRowIndex(chatTabPane, 1);\n+        GridPane.setColumnSpan(chatTabPane, 2);\n+        GridPane.setColumnSpan(scrollPane, 2);\n+        column2.setMinWidth(0);\n+        row2.setMinHeight(200);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, true);\n+      } else {\n+        GridPane.setColumnIndex(chatTabPane, 1);\n+        GridPane.setRowIndex(chatTabPane, 0);\n+        GridPane.setColumnSpan(chatTabPane, 1);\n+        GridPane.setColumnSpan(scrollPane, 1);\n+        column2.setMinWidth(400);\n+        row2.setMinHeight(0);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, false);\n+      }\n+    });\n+  }\n+\n+  private void initializeUppercaseText() {\n+    matchmakerHeadingLabel.setText(i18n.get(\"teammatchmaking.playerTitle\").toUpperCase());\n+    partyHeadingLabel.setText(i18n.get(\"teammatchmaking.partyTitle\").toUpperCase());\n+    invitePlayerButton.setText(i18n.get(\"teammatchmaking.invitePlayer\").toUpperCase());\n+    leavePartyButton.setText(i18n.get(\"teammatchmaking.leaveParty\").toUpperCase());", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM3NDUyMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536374522", "bodyText": "I wish! CSS can do that, but the \"special\" css for javafx cannot :(", "author": "BlackYps", "createdAt": "2020-12-04T20:56:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4MDc2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536380767", "bodyText": "Shame", "author": "Brutus5000", "createdAt": "2020-12-04T21:09:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDE4NA=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 382577d42..fa6baed87 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -39,12 +39,13 @@ import javafx.scene.layout.StackPane;\n import javafx.scene.layout.VBox;\n import lombok.RequiredArgsConstructor;\n import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n-import org.springframework.util.StringUtils;\n \n import java.util.ArrayList;\n+import java.util.Comparator;\n import java.util.List;\n \n import static javafx.beans.binding.Bindings.createBooleanBinding;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NDg1Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536364852", "bodyText": "As stated earlier, this should be outsourced into a dedicated function", "author": "Brutus5000", "createdAt": "2020-12-04T20:35:50Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,287 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.ui.dialog.Dialog;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  private MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    countryImageView.imageProperty().bind(createObjectBinding(() -> countryFlagService.loadCountryFlag(\n+        StringUtils.isEmpty(player.getCountry()) ? \"\" : player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() ->\n+        Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    crownLabel.visibleProperty().bind(createBooleanBinding(() ->\n+        teamMatchmakingService.getParty().getMembers().size() > 1 && teamMatchmakingService.getParty().getOwner().equals(player),\n+        teamMatchmakingService.getParty().ownerProperty(), teamMatchmakingService.getParty().getMembers()));\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> {\n+      playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+          (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+      List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+      partyMemberPane.getChildren().clear();\n+      members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+      for(int i = 0; i < members.size(); i++) {\n+        PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+        controller.setMember(members.get(i));\n+        if (members.size() == 1)\n+          partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+        else\n+          partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+      }\n+    });\n+\n+    invitePlayerButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getOwner().getId() != playerService.getCurrentPlayer().map(Player::getId).orElse(-1),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        playerService.currentPlayerProperty()\n+    ));\n+    leavePartyButton.disableProperty().bind(createBooleanBinding(() -> teamMatchmakingService.getParty().getMembers().size() <= 1, teamMatchmakingService.getParty().getMembers()));\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(String.format(\"#%s'sParty\", newValue.getUsername()));\n+    });\n+    createChannelTab(String.format(\"#%s'sParty\", teamMatchmakingService.getParty().getOwner().getUsername()));\n+\n+    fafService.requestMatchmakerInfo();\n+  }\n+\n+  private void initializeDynamicChatPosition() {\n+    contentPane.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue < 1115.0) {\n+        GridPane.setColumnIndex(chatTabPane, 0);\n+        GridPane.setRowIndex(chatTabPane, 1);\n+        GridPane.setColumnSpan(chatTabPane, 2);\n+        GridPane.setColumnSpan(scrollPane, 2);\n+        column2.setMinWidth(0);\n+        row2.setMinHeight(200);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, true);\n+      } else {\n+        GridPane.setColumnIndex(chatTabPane, 1);\n+        GridPane.setRowIndex(chatTabPane, 0);\n+        GridPane.setColumnSpan(chatTabPane, 1);\n+        GridPane.setColumnSpan(scrollPane, 1);\n+        column2.setMinWidth(400);\n+        row2.setMinHeight(0);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, false);\n+      }\n+    });\n+  }\n+\n+  private void initializeUppercaseText() {\n+    matchmakerHeadingLabel.setText(i18n.get(\"teammatchmaking.playerTitle\").toUpperCase());\n+    partyHeadingLabel.setText(i18n.get(\"teammatchmaking.partyTitle\").toUpperCase());\n+    invitePlayerButton.setText(i18n.get(\"teammatchmaking.invitePlayer\").toUpperCase());\n+    leavePartyButton.setText(i18n.get(\"teammatchmaking.leaveParty\").toUpperCase());\n+\n+    leagueLabel.textProperty().bind(createStringBinding(() -> i18n.get(\"leaderboard.divisionName\").toUpperCase(),\n+        player.globalRatingMeanProperty())); // This should actually be a divisionProperty once that is available\n+    gameCountLabel.textProperty().bind(createStringBinding(() ->\n+        i18n.get(\"teammatchmaking.gameCount\", player.getNumberOfGames()).toUpperCase(), player.numberOfGamesProperty()));\n+    queueHeadingLabel.textProperty().bind(createStringBinding(() -> {\n+      if (teamMatchmakingService.getParty().getOwner().equals(player))\n+        return i18n.get(\"teammatchmaking.queueTitle\").toUpperCase();\n+      else\n+        return i18n.get(\"teammatchmaking.queueTitle.inParty\").toUpperCase();\n+    }, teamMatchmakingService.getParty().ownerProperty()));\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return teamMatchmakingRoot;\n+  }\n+\n+  public void onInvitePlayerButtonClicked(ActionEvent actionEvent) {\n+    InvitePlayerController invitePlayerController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_invite_player.fxml\");\n+    Pane root = invitePlayerController.getRoot();\n+    Dialog dialog = uiService.showInDialog(teamMatchmakingRoot, root, i18n.get(\"teammatchmaking.invitePlayer\"));\n+  }\n+\n+  public void onLeavePartyButtonClicked(ActionEvent actionEvent) {\n+    teamMatchmakingService.leaveParty();\n+  }\n+\n+  public void onFactionButtonClicked(ActionEvent actionEvent) {\n+\n+    if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n+      selectFactionsBasedOnParty();\n+      return;\n+    }\n+\n+    List<Faction> factions = new ArrayList<>();\n+    if (uefButton.isSelected()) {\n+      factions.add(Faction.UEF);\n+    }\n+    if (aeonButton.isSelected()) {\n+      factions.add(Faction.AEON);\n+    }\n+    if (cybranButton.isSelected()) {\n+      factions.add(Faction.CYBRAN);\n+    }\n+    if (seraphimButton.isSelected()) {\n+      factions.add(Faction.SERAPHIM);\n+    }\n+\n+    teamMatchmakingService.setPartyFactions(factions);\n+\n+    refreshingLabel.setVisible(true);\n+  }\n+\n+  private void selectFactionsBasedOnParty() {\n+    uefButton.setSelected(isFactionSelectedInParty(Faction.UEF));\n+    aeonButton.setSelected(isFactionSelectedInParty(Faction.AEON));\n+    cybranButton.setSelected(isFactionSelectedInParty(Faction.CYBRAN));\n+    seraphimButton.setSelected(isFactionSelectedInParty(Faction.SERAPHIM));\n+  }\n+\n+  private boolean isFactionSelectedInParty(Faction faction) {\n+    return teamMatchmakingService.getParty().getMembers().stream()\n+        .anyMatch(m -> m.getPlayer().getId() == player.getId() && m.getFactions().contains(faction));\n+  }\n+\n+  private void createChannelTab(String channelName) {\n+    JavaFxUtil.assertApplicationThread();\n+    matchmakingChatController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_chat.fxml\");\n+    matchmakingChatController.setChannel(channelName);\n+    chatTabPane.getTabs().clear();\n+    chatTabPane.getTabs().add(matchmakingChatController.getRoot());\n+  }\n+\n+  @Subscribe\n+  public void onChatMessage(ChatMessageEvent event) {\n+    Platform.runLater(() -> {\n+      ChatMessage message = event.getMessage();\n+      if (message.getSource().equals(String.format(\"#%s'sParty\", teamMatchmakingService.getParty().getOwner().getUsername()))) {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 382577d42..fa6baed87 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -39,12 +39,13 @@ import javafx.scene.layout.StackPane;\n import javafx.scene.layout.VBox;\n import lombok.RequiredArgsConstructor;\n import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n-import org.springframework.util.StringUtils;\n \n import java.util.ArrayList;\n+import java.util.Comparator;\n import java.util.List;\n \n import static javafx.beans.binding.Bindings.createBooleanBinding;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NTAzMA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536365030", "bodyText": "If not needed remove Initializing bean or use @RequiredArgsConstructor and do all the current constructor logic here.", "author": "Brutus5000", "createdAt": "2020-12-04T20:36:12Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java", "diffHunk": "@@ -0,0 +1,363 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fa.relay.LobbyMode;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.GameService;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.OpenTeamMatchmakingEvent;\n+import com.faforever.client.net.ConnectionState;\n+import com.faforever.client.notification.Action;\n+import com.faforever.client.notification.Action.ActionCallback;\n+import com.faforever.client.notification.ImmediateNotification;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.notification.Severity;\n+import com.faforever.client.notification.TransientNotification;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.preferences.event.MissingGamePathEvent;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage;\n+import com.faforever.client.remote.FafServerAccessor;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.GameLaunchMessage;\n+import com.faforever.client.remote.domain.MatchCancelledMessage;\n+import com.faforever.client.remote.domain.MatchFoundMessage;\n+import com.faforever.client.remote.domain.MatchmakingState;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import com.faforever.client.remote.domain.PartyInviteMessage;\n+import com.faforever.client.remote.domain.PartyKickedMessage;\n+import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.MatchmakingQueue.MatchingStatus;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.util.IdenticonUtil;\n+import com.google.common.eventbus.EventBus;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.InitializingBean;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.scheduling.TaskScheduler;\n+import org.springframework.stereotype.Service;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ScheduledFuture;\n+\n+@Lazy\n+@Service\n+@Slf4j\n+public class TeamMatchmakingService implements InitializingBean {\n+\n+  private final FafServerAccessor fafServerAccessor;\n+  private final PlayerService playerService;\n+  private final NotificationService notificationService;\n+  private final PreferencesService preferencesService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+  private final I18n i18n;\n+  private final TaskScheduler taskScheduler;\n+  private final GameService gameService;\n+\n+  @Getter\n+  private final Party party;\n+  @Getter\n+  private final ObservableList<MatchmakingQueue> matchmakingQueues = FXCollections.observableArrayList();\n+  private final List<ScheduledFuture<?>> leaveQueueTimeouts = new LinkedList<>();\n+\n+  private volatile boolean matchFoundAndWaitingForGameLaunch = false;\n+  private boolean queuesAdded = false;\n+\n+  @Override\n+  public void afterPropertiesSet() throws Exception {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\nindex 24815e3ad..917793a25 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n\n@@ -37,7 +37,7 @@ import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n-import org.springframework.beans.factory.InitializingBean;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.context.annotation.Lazy;\n import org.springframework.scheduling.TaskScheduler;\n import org.springframework.stereotype.Service;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NTM5MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536365391", "bodyText": "line breaks after the stream operators", "author": "Brutus5000", "createdAt": "2020-12-04T20:36:56Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java", "diffHunk": "@@ -0,0 +1,363 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fa.relay.LobbyMode;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.GameService;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.OpenTeamMatchmakingEvent;\n+import com.faforever.client.net.ConnectionState;\n+import com.faforever.client.notification.Action;\n+import com.faforever.client.notification.Action.ActionCallback;\n+import com.faforever.client.notification.ImmediateNotification;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.notification.Severity;\n+import com.faforever.client.notification.TransientNotification;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.preferences.event.MissingGamePathEvent;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage;\n+import com.faforever.client.remote.FafServerAccessor;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.GameLaunchMessage;\n+import com.faforever.client.remote.domain.MatchCancelledMessage;\n+import com.faforever.client.remote.domain.MatchFoundMessage;\n+import com.faforever.client.remote.domain.MatchmakingState;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import com.faforever.client.remote.domain.PartyInviteMessage;\n+import com.faforever.client.remote.domain.PartyKickedMessage;\n+import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.MatchmakingQueue.MatchingStatus;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.util.IdenticonUtil;\n+import com.google.common.eventbus.EventBus;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.InitializingBean;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.scheduling.TaskScheduler;\n+import org.springframework.stereotype.Service;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ScheduledFuture;\n+\n+@Lazy\n+@Service\n+@Slf4j\n+public class TeamMatchmakingService implements InitializingBean {\n+\n+  private final FafServerAccessor fafServerAccessor;\n+  private final PlayerService playerService;\n+  private final NotificationService notificationService;\n+  private final PreferencesService preferencesService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+  private final I18n i18n;\n+  private final TaskScheduler taskScheduler;\n+  private final GameService gameService;\n+\n+  @Getter\n+  private final Party party;\n+  @Getter\n+  private final ObservableList<MatchmakingQueue> matchmakingQueues = FXCollections.observableArrayList();\n+  private final List<ScheduledFuture<?>> leaveQueueTimeouts = new LinkedList<>();\n+\n+  private volatile boolean matchFoundAndWaitingForGameLaunch = false;\n+  private boolean queuesAdded = false;\n+\n+  @Override\n+  public void afterPropertiesSet() throws Exception {\n+\n+  }\n+\n+  public TeamMatchmakingService(FafServerAccessor fafServerAccessor, PlayerService playerService, NotificationService notificationService, PreferencesService preferencesService, FafService fafService, EventBus eventBus, I18n i18n, TaskScheduler taskScheduler, GameService gameService) {\n+    this.fafServerAccessor = fafServerAccessor;\n+    this.playerService = playerService;\n+    this.notificationService = notificationService;\n+    this.preferencesService = preferencesService;\n+    this.fafService = fafService;\n+    this.eventBus = eventBus;\n+    this.i18n = i18n;\n+    this.taskScheduler = taskScheduler;\n+    this.gameService = gameService;\n+\n+    fafService.addOnMessageListener(PartyInviteMessage.class, this::onPartyInvite);\n+    fafService.addOnMessageListener(PartyKickedMessage.class, this::onPartyKicked);\n+    fafService.addOnMessageListener(PartyInfoMessage.class, this::onPartyInfo);\n+    fafService.addOnMessageListener(SearchInfoMessage.class, this::onSearchInfoMessage);\n+    fafService.addOnMessageListener(MatchFoundMessage.class, this::onMatchFoundMessage);\n+    fafService.addOnMessageListener(MatchCancelledMessage.class, this::onMatchCancelledMessage);\n+    fafService.addOnMessageListener(GameLaunchMessage.class, this::onGameLaunchMessage);\n+    fafService.connectionStateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue == ConnectionState.DISCONNECTED) {\n+        Platform.runLater(() -> initParty(playerService.getCurrentPlayer().get()));\n+      }\n+    });\n+\n+    fafService.addOnMessageListener(MatchmakerInfoMessage.class, this::onMatchmakerInfo);\n+\n+    party = new Party();\n+\n+    playerService.currentPlayerProperty().addListener((obs, old, player) -> {\n+      if (party.getOwner() == null && party.getMembers().isEmpty() && player != null) {\n+        Platform.runLater(() -> initParty(player));\n+      }\n+    });\n+\n+    playerService.getCurrentPlayer().ifPresent(this::initParty);\n+  }\n+\n+  private void onMatchmakerInfo(MatchmakerInfoMessage message) {\n+    List<CompletableFuture<?>> futures = new ArrayList<>();\n+    message.getQueues().forEach(remoteQueue -> {\n+      MatchmakingQueue localQueue = matchmakingQueues.stream()\n+          .filter(q -> Objects.equals(q.getQueueName(), remoteQueue.getQueueName())).findFirst().orElse(null);", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\nindex 24815e3ad..917793a25 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n\n@@ -37,7 +37,7 @@ import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n-import org.springframework.beans.factory.InitializingBean;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.context.annotation.Lazy;\n import org.springframework.scheduling.TaskScheduler;\n import org.springframework.stereotype.Service;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM2NTgzNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536365837", "bodyText": "linebreaks after each stream operator", "author": "Brutus5000", "createdAt": "2020-12-04T20:38:04Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java", "diffHunk": "@@ -0,0 +1,363 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fa.relay.LobbyMode;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.GameService;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.OpenTeamMatchmakingEvent;\n+import com.faforever.client.net.ConnectionState;\n+import com.faforever.client.notification.Action;\n+import com.faforever.client.notification.Action.ActionCallback;\n+import com.faforever.client.notification.ImmediateNotification;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.notification.Severity;\n+import com.faforever.client.notification.TransientNotification;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.preferences.event.MissingGamePathEvent;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage;\n+import com.faforever.client.remote.FafServerAccessor;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.GameLaunchMessage;\n+import com.faforever.client.remote.domain.MatchCancelledMessage;\n+import com.faforever.client.remote.domain.MatchFoundMessage;\n+import com.faforever.client.remote.domain.MatchmakingState;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import com.faforever.client.remote.domain.PartyInviteMessage;\n+import com.faforever.client.remote.domain.PartyKickedMessage;\n+import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.MatchmakingQueue.MatchingStatus;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.util.IdenticonUtil;\n+import com.google.common.eventbus.EventBus;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import lombok.Getter;\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.InitializingBean;\n+import org.springframework.context.annotation.Lazy;\n+import org.springframework.scheduling.TaskScheduler;\n+import org.springframework.stereotype.Service;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+import java.time.OffsetDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.LinkedList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.ScheduledFuture;\n+\n+@Lazy\n+@Service\n+@Slf4j\n+public class TeamMatchmakingService implements InitializingBean {\n+\n+  private final FafServerAccessor fafServerAccessor;\n+  private final PlayerService playerService;\n+  private final NotificationService notificationService;\n+  private final PreferencesService preferencesService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+  private final I18n i18n;\n+  private final TaskScheduler taskScheduler;\n+  private final GameService gameService;\n+\n+  @Getter\n+  private final Party party;\n+  @Getter\n+  private final ObservableList<MatchmakingQueue> matchmakingQueues = FXCollections.observableArrayList();\n+  private final List<ScheduledFuture<?>> leaveQueueTimeouts = new LinkedList<>();\n+\n+  private volatile boolean matchFoundAndWaitingForGameLaunch = false;\n+  private boolean queuesAdded = false;\n+\n+  @Override\n+  public void afterPropertiesSet() throws Exception {\n+\n+  }\n+\n+  public TeamMatchmakingService(FafServerAccessor fafServerAccessor, PlayerService playerService, NotificationService notificationService, PreferencesService preferencesService, FafService fafService, EventBus eventBus, I18n i18n, TaskScheduler taskScheduler, GameService gameService) {\n+    this.fafServerAccessor = fafServerAccessor;\n+    this.playerService = playerService;\n+    this.notificationService = notificationService;\n+    this.preferencesService = preferencesService;\n+    this.fafService = fafService;\n+    this.eventBus = eventBus;\n+    this.i18n = i18n;\n+    this.taskScheduler = taskScheduler;\n+    this.gameService = gameService;\n+\n+    fafService.addOnMessageListener(PartyInviteMessage.class, this::onPartyInvite);\n+    fafService.addOnMessageListener(PartyKickedMessage.class, this::onPartyKicked);\n+    fafService.addOnMessageListener(PartyInfoMessage.class, this::onPartyInfo);\n+    fafService.addOnMessageListener(SearchInfoMessage.class, this::onSearchInfoMessage);\n+    fafService.addOnMessageListener(MatchFoundMessage.class, this::onMatchFoundMessage);\n+    fafService.addOnMessageListener(MatchCancelledMessage.class, this::onMatchCancelledMessage);\n+    fafService.addOnMessageListener(GameLaunchMessage.class, this::onGameLaunchMessage);\n+    fafService.connectionStateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue == ConnectionState.DISCONNECTED) {\n+        Platform.runLater(() -> initParty(playerService.getCurrentPlayer().get()));\n+      }\n+    });\n+\n+    fafService.addOnMessageListener(MatchmakerInfoMessage.class, this::onMatchmakerInfo);\n+\n+    party = new Party();\n+\n+    playerService.currentPlayerProperty().addListener((obs, old, player) -> {\n+      if (party.getOwner() == null && party.getMembers().isEmpty() && player != null) {\n+        Platform.runLater(() -> initParty(player));\n+      }\n+    });\n+\n+    playerService.getCurrentPlayer().ifPresent(this::initParty);\n+  }\n+\n+  private void onMatchmakerInfo(MatchmakerInfoMessage message) {\n+    List<CompletableFuture<?>> futures = new ArrayList<>();\n+    message.getQueues().forEach(remoteQueue -> {\n+      MatchmakingQueue localQueue = matchmakingQueues.stream()\n+          .filter(q -> Objects.equals(q.getQueueName(), remoteQueue.getQueueName())).findFirst().orElse(null);\n+      if (localQueue == null) {\n+        queuesAdded = true;\n+        CompletableFuture<Optional<MatchmakingQueue>> future = fafService.getMatchmakingQueue(remoteQueue.getQueueName());\n+        futures.add(future);\n+        future.thenAccept(result -> result.ifPresent(\n+            matchmakingQueue -> {\n+              matchmakingQueues.add(matchmakingQueue);\n+              matchmakingQueue.setQueuePopTime(OffsetDateTime.parse(remoteQueue.getQueuePopTime()).toInstant());\n+              matchmakingQueue.setTeamSize(remoteQueue.getTeamSize());\n+              matchmakingQueue.setPartiesInQueue(remoteQueue.getBoundary75s().size());\n+              Platform.runLater(() -> matchmakingQueue.setPlayersInQueue(remoteQueue.getNumPlayers()));\n+            }));\n+      } else {\n+        localQueue.setQueuePopTime(OffsetDateTime.parse(remoteQueue.getQueuePopTime()).toInstant());\n+        localQueue.setTeamSize(remoteQueue.getTeamSize());\n+        localQueue.setPartiesInQueue(remoteQueue.getBoundary75s().size());\n+        Platform.runLater(() -> localQueue.setPlayersInQueue(remoteQueue.getNumPlayers()));\n+      }\n+    });\n+\n+    CompletableFuture.allOf(futures.toArray(new CompletableFuture<?>[futures.size()])).thenRun(() -> {\n+      if (queuesAdded) {\n+        eventBus.post(new QueuesAddedEvent());\n+        queuesAdded = false;\n+      }\n+    });\n+  }\n+\n+  protected void onSearchInfoMessage(SearchInfoMessage message) {\n+    matchmakingQueues.stream().filter(q -> Objects.equals(q.getQueueName(), message.getQueueName())).forEach(q -> {\n+          Platform.runLater(() -> {\n+            q.setJoined(message.getState() == MatchmakingState.START);\n+            leaveQueueTimeouts.forEach(f -> f.cancel(false));\n+          });\n+\n+          //TODO: check current state / other queues\n+          if (message.getState() == MatchmakingState.START) {\n+            gameService.startSearchMatchmaker();\n+\n+            // Send own factions to server upon joining a queue\n+            Optional<PartyMember> ownPartyMember = party.getMembers().stream()\n+                .filter(m -> m.getPlayer().getId() == playerService.getCurrentPlayer().map(Player::getId).orElse(-1))\n+                .findFirst();\n+            ownPartyMember.ifPresent(m -> setPartyFactions(m.getFactions()));\n+          }\n+        }\n+    );\n+\n+    if (matchmakingQueues.stream().noneMatch(q -> q.isJoined() && !q.getQueueName().equals(message.getQueueName())) // filter catches a race condition due MatchmakingQueue::isJoined being set on UI thread\n+        && message.getState() != MatchmakingState.START // catches same race condition\n+        && !matchFoundAndWaitingForGameLaunch) {\n+      gameService.onMatchmakerSearchStopped();\n+    }\n+  }\n+\n+  private void onMatchFoundMessage(MatchFoundMessage message) {\n+    matchFoundAndWaitingForGameLaunch = true; // messages from server: match found -> STOP all queues that you are in that haven't found a match -> game launch\n+\n+    notificationService.addNotification(new TransientNotification(\n+        i18n.get(\"teammatchmaking.notification.matchFound.title\"),\n+        i18n.get(\"teammatchmaking.notification.matchFound.message\")\n+    ));\n+    matchmakingQueues.stream().filter(q -> Objects.equals(q.getQueueName(), message.getQueue())).forEach(q -> {\n+      q.setTimedOutMatchingStatus(MatchingStatus.MATCH_FOUND, Duration.ofSeconds(15), taskScheduler);\n+    });\n+\n+    matchmakingQueues.forEach(q -> q.setJoined(false));\n+  }\n+\n+  private void onMatchCancelledMessage(MatchCancelledMessage message) {\n+    matchmakingQueues.stream().filter(q -> q.getMatchingStatus() != null).forEach(q -> {\n+      q.setTimedOutMatchingStatus(MatchingStatus.MATCH_CANCELLED, Duration.ofSeconds(15), taskScheduler);\n+    });\n+\n+    matchFoundAndWaitingForGameLaunch = false;\n+    gameService.onMatchmakerSearchStopped(); // joining custom games is still blocked till match is cancelled or launched\n+  }\n+\n+  private void onGameLaunchMessage(GameLaunchMessage message) {\n+    if (message.getInitMode() != LobbyMode.AUTO_LOBBY) {\n+      return;\n+    }\n+\n+    matchmakingQueues.stream().filter(q -> q.getMatchingStatus() != null).forEach(q -> {", "originalCommit": "926eb981194e2bb5d6af3ea25e6276720252355e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\nindex 24815e3ad..917793a25 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingService.java\n\n@@ -37,7 +37,7 @@ import javafx.collections.FXCollections;\n import javafx.collections.ObservableList;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n-import org.springframework.beans.factory.InitializingBean;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.context.annotation.Lazy;\n import org.springframework.scheduling.TaskScheduler;\n import org.springframework.stereotype.Service;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4MzA4OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536783089", "bodyText": "Can this TODO be resolved?", "author": "Sheikah45", "createdAt": "2020-12-05T14:14:44Z", "path": "src/main/java/com/faforever/client/game/GameService.java", "diffHunk": "@@ -505,27 +518,23 @@ public Game getByUid(int uid) {\n     return game;\n   }\n \n-  public void addOnRankedMatchNotificationListener(Consumer<MatchmakerInfoMessage> listener) {\n-    fafService.addOnMessageListener(MatchmakerInfoMessage.class, listener);\n-  }\n-\n-  public CompletableFuture<Void> startSearchLadder1v1(Faction faction) {\n+  public CompletableFuture<Void> startSearchMatchmaker() {\n     if (isRunning()) {\n-      log.debug(\"Game is running, ignoring 1v1 search request\");\n+      log.debug(\"Game is running, ignoring matchmaking search request\");\n       notificationService.addImmediateErrorNotification(new UnsupportedOperationException(\"Forged Alliances is already running\"), \"game.gameRunning\");\n       return completedFuture(null);\n     }\n \n     if (!preferencesService.isGamePathValid()) {\n       CompletableFuture<Path> gameDirectoryFuture = postGameDirectoryChooseEvent();\n-      return gameDirectoryFuture.thenCompose(path -> startSearchLadder1v1(faction));\n+      return gameDirectoryFuture.thenCompose(path -> startSearchMatchmaker());\n     }\n \n-    searching1v1.set(true);\n+    inMatchmakerQueue.set(true);\n \n-    return modService.getFeaturedMod(LADDER_1V1.getTechnicalName())\n+    return modService.getFeaturedMod(FAF.getTechnicalName())//TODO: use matchmaking featured mod", "originalCommit": "506f696bf0fb72c82a1dd6569b1d24c461397b05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAwNjE0OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542006148", "bodyText": "FAF is the right featured mod for the matchmaker. I will delete the todo", "author": "BlackYps", "createdAt": "2020-12-13T21:09:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4MzA4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "adfe7a5cd79e54cfab1ae93d7cd54d1345705925", "chunk": "diff --git a/src/main/java/com/faforever/client/game/GameService.java b/src/main/java/com/faforever/client/game/GameService.java\nindex 08a0594e4..725db3c06 100644\n--- a/src/main/java/com/faforever/client/game/GameService.java\n+++ b/src/main/java/com/faforever/client/game/GameService.java\n\n@@ -532,7 +532,7 @@ public class GameService implements InitializingBean {\n \n     inMatchmakerQueue.set(true);\n \n-    return modService.getFeaturedMod(FAF.getTechnicalName())//TODO: use matchmaking featured mod\n+    return modService.getFeaturedMod(FAF.getTechnicalName())\n         .thenAccept(featuredModBean -> updateGameIfNecessary(featuredModBean, null, emptyMap(), emptySet()))\n         .thenCompose(aVoid -> fafService.startSearchMatchmaker())\n         .thenAccept((gameLaunchMessage) -> downloadMapIfNecessary(gameLaunchMessage.getMapname())\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4MzI3NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536783274", "bodyText": "This one seems needed as well unless I am missing something", "author": "Sheikah45", "createdAt": "2020-12-05T14:15:14Z", "path": "src/main/java/com/faforever/client/game/GameService.java", "diffHunk": "@@ -534,27 +543,27 @@ public void addOnRankedMatchNotificationListener(Consumer<MatchmakerInfoMessage>\n               gameLaunchMessage.getArgs().add(\"/players \" + gameLaunchMessage.getExpectedPlayers());\n               gameLaunchMessage.getArgs().add(\"/startspot \" + gameLaunchMessage.getMapPosition());\n \n-              startGame(gameLaunchMessage, faction, RatingMode.LADDER_1V1);\n+              startGame(gameLaunchMessage, gameLaunchMessage.getFaction(), NONE); // TODO: rating mode", "originalCommit": "506f696bf0fb72c82a1dd6569b1d24c461397b05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAwODQ5OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542008498", "bodyText": "This is for displaying the right rating in the game. We should grab the appropriate leaderboard from the queue information once #1791 is implemented.", "author": "BlackYps", "createdAt": "2020-12-13T21:23:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4MzI3NA=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/game/GameService.java b/src/main/java/com/faforever/client/game/GameService.java\nindex 08a0594e4..d7556446f 100644\n--- a/src/main/java/com/faforever/client/game/GameService.java\n+++ b/src/main/java/com/faforever/client/game/GameService.java\n\n@@ -559,6 +559,9 @@ public class GameService implements InitializingBean {\n     if (inMatchmakerQueue.get()) {\n       fafService.stopSearchMatchmaker();\n       inMatchmakerQueue.set(false);\n+      log.debug(\"Matchmaker search stopped\");\n+    } else {\n+      log.debug(\"Matchmaker search has already been stopped, ignoring call\");\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4NTYxMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536785612", "bodyText": "I believe these can be removed with the @DaTa at top", "author": "Sheikah45", "createdAt": "2020-12-05T14:20:13Z", "path": "src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java", "diffHunk": "@@ -4,86 +4,47 @@\n import com.faforever.client.remote.domain.FafServerMessageType;\n import com.faforever.client.remote.domain.RatingRange;\n import com.google.gson.annotations.SerializedName;\n+import lombok.Data;\n+import lombok.Getter;\n+import lombok.Setter;\n \n import java.util.List;\n \n public class MatchmakerInfoMessage extends FafServerMessage {\n \n+  @Data\n   public static class MatchmakerQueue {\n \n-    private QueueName queueName;\n+    private String queueName;\n     private String queuePopTime;\n+    @SerializedName(\"team_size\")\n+    private int teamSize;\n+    @SerializedName(\"num_players\")\n+    private int numPlayers;\n+\n+    // The boundaries indicate the ranges applicable for other searching players,\n+    // boundarys.size() therefore indicates the players currently in queue\n     @SerializedName(\"boundary_75s\")\n     private List<RatingRange> boundary75s;\n     @SerializedName(\"boundary_80s\")\n     private List<RatingRange> boundary80s;\n \n-    public static enum QueueName {\n-      @SerializedName(\"ladder1v1\")\n-      LADDER_1V1\n-    }\n-\n-    public MatchmakerQueue(QueueName queueName, String queuePopTime, List<RatingRange> boundary75s, List<RatingRange> boundary80s) {\n+    public MatchmakerQueue(String queueName, String queuePopTime, int teamSize, int numPlayers, List<RatingRange> boundary75s, List<RatingRange> boundary80s) {\n       this.queueName = queueName;\n       this.queuePopTime = queuePopTime;\n+      this.teamSize = teamSize;\n+      this.numPlayers = numPlayers;\n       this.boundary75s = boundary75s;\n       this.boundary80s = boundary80s;\n     }\n \n-    public QueueName getQueueName() {\n-      return queueName;\n-    }\n-\n-    public void setQueueName(QueueName queueName) {\n-      this.queueName = queueName;\n-    }\n-\n-    public String getQueuePopTime() {\n-      return queuePopTime;\n-    }\n-\n-    public void setQueuePopTime(String queuePopTime) {\n-      this.queuePopTime = queuePopTime;\n-    }\n-\n-    public List<RatingRange> getBoundary75s() {\n-      return boundary75s;\n-    }\n-\n-    public void setBoundary75s(List<RatingRange> boundary75s) {\n-      this.boundary75s = boundary75s;\n-    }\n-\n-    public List<RatingRange> getBoundary80s() {\n-      return boundary80s;\n-    }\n-\n-    public void setBoundary80s(List<RatingRange> boundary80s) {\n-      this.boundary80s = boundary80s;\n-    }\n   }\n-\n-  private String action;\n+  @Getter\n+  @Setter", "originalCommit": "506f696bf0fb72c82a1dd6569b1d24c461397b05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgyNjE3OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536826178", "bodyText": "The @DaTa annotation is only for the nested class", "author": "BlackYps", "createdAt": "2020-12-05T17:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4NTYxMg=="}], "type": "inlineReview", "revised_code": {"commit": "7936a63a30c4691a77194e00c838a537184cfccb", "chunk": "diff --git a/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java b/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\nindex 49139cf9a..c27dc7055 100644\n--- a/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\n+++ b/src/main/java/com/faforever/client/rankedmatch/MatchmakerInfoMessage.java\n\n@@ -4,15 +4,13 @@ import com.faforever.client.remote.domain.FafServerMessage;\n import com.faforever.client.remote.domain.FafServerMessageType;\n import com.faforever.client.remote.domain.RatingRange;\n import com.google.gson.annotations.SerializedName;\n-import lombok.Data;\n-import lombok.Getter;\n-import lombok.Setter;\n \n import java.util.List;\n \n public class MatchmakerInfoMessage extends FafServerMessage {\n \n-  @Data\n+  private String action; // TODO: doesn't exist anymore\n+\n   public static class MatchmakerQueue {\n \n     private String queueName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc4ODA2Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536788066", "bodyText": "JavaFxUtil.bindManagedToVisible", "author": "Sheikah45", "createdAt": "2020-12-05T14:25:44Z", "path": "src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java", "diffHunk": "@@ -0,0 +1,151 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.ShowMapPoolEvent;\n+import com.faforever.client.player.PlayerService;\n+import com.google.common.eventbus.EventBus;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.Timeline;\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ToggleButton;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingQueueItemController implements Controller<Node> {\n+\n+  private final static String QUEUE_I18N_PATTERN = \"teammatchmaking.queue.%s.%s\";\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final I18n i18n;\n+  private final EventBus eventBus;\n+\n+  public Node queueItemRoot;\n+  public Label playersInQueueLabel;\n+  public Label queuePopTimeLabel;\n+  public ToggleButton joinLeaveQueueButton;\n+  public Label refreshingLabel;\n+  public Label matchFoundLabel;\n+  public Label matchStartingLabel;\n+  public Label matchCancelledLabel;\n+  public Button mapPoolButton;\n+\n+\n+  private Timeline queuePopTimeUpdater;\n+\n+  private MatchmakingQueue queue;\n+\n+  public MatchmakingQueueItemController(PlayerService playerService, TeamMatchmakingService teamMatchmakingService, I18n i18n, EventBus eventBus) {\n+    this.playerService = playerService;\n+    this.teamMatchmakingService = teamMatchmakingService;\n+    this.i18n = i18n;\n+    this.eventBus = eventBus;\n+  }\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    joinLeaveQueueButton.widthProperty().addListener(new ChangeListener<Number>() {\n+      @Override\n+      public void changed(ObservableValue<? extends Number> observable, Number oldValue, Number newValue) {\n+        if ((double) newValue > 150.0) {\n+          joinLeaveQueueButton.setText(\n+              i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"fullName\")));\n+        } else {\n+          joinLeaveQueueButton.setText(\n+              i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"shortName\")));\n+        }\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return queueItemRoot;\n+  }\n+\n+  public void setQueue(MatchmakingQueue queue) {\n+    this.queue = queue;\n+\n+    playersInQueueLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"teammatchmaking.playersInQueue\", queue.getPlayersInQueue()).toUpperCase(),\n+        queue.playersInQueueProperty()));\n+\n+    matchFoundLabel.visibleProperty().bind(matchFoundLabel.managedProperty());\n+    matchStartingLabel.visibleProperty().bind(matchStartingLabel.managedProperty());\n+    matchCancelledLabel.visibleProperty().bind(matchCancelledLabel.managedProperty());", "originalCommit": "506f696bf0fb72c82a1dd6569b1d24c461397b05", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\nindex aeb1471dd..8e6b89f1c 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n\n@@ -1,19 +1,19 @@\n package com.faforever.client.teammatchmaking;\n \n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.i18n.I18n;\n import com.faforever.client.main.event.ShowMapPoolEvent;\n import com.faforever.client.player.PlayerService;\n import com.google.common.eventbus.EventBus;\n import javafx.animation.KeyFrame;\n import javafx.animation.Timeline;\n-import javafx.beans.value.ChangeListener;\n-import javafx.beans.value.ObservableValue;\n import javafx.event.ActionEvent;\n-import javafx.scene.Node;\n import javafx.scene.control.Button;\n import javafx.scene.control.Label;\n import javafx.scene.control.ToggleButton;\n+import javafx.scene.layout.VBox;\n+import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc5MjIzOQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r536792239", "bodyText": "We need to make sure this listener is removed if a player leaves the party", "author": "Sheikah45", "createdAt": "2020-12-05T14:34:37Z", "path": "src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java", "diffHunk": "@@ -0,0 +1,167 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatChannelUser;\n+import com.faforever.client.chat.ChatService;\n+import com.faforever.client.chat.ChatUserContextMenuController;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.util.RatingUtil;\n+import com.google.common.base.Strings;\n+import javafx.application.Platform;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.input.ContextMenuEvent;\n+import javafx.scene.layout.HBox;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n+\n+import java.lang.ref.WeakReference;\n+\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class PartyMemberItemController implements Controller<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass PLAYING_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"playing\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final UiService uiService;\n+  private final ChatService chatService;\n+  private final I18n i18n;\n+\n+  public Node playerItemRoot;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public ImageView leagueImageView;\n+  public Button kickPlayerButton;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label leagueLabel;\n+  public Label gameCountLabel;\n+  public Label uefLabel;\n+  public Label cybranLabel;\n+  public Label aeonLabel;\n+  public Label seraphimLabel;\n+  public Label crownLabel;\n+  public HBox playerCard;\n+  public ImageView playerStatusImageView;\n+\n+  private Player player;\n+  private ChatChannelUser chatUser;\n+  //TODO: this is a bit hacky\n+  private WeakReference<ChatUserContextMenuController> contextMenuController = null;\n+\n+  @Override\n+  public void initialize() {\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return playerItemRoot;\n+  }\n+\n+  public void setMember(PartyMember member) {\n+    this.player = member.getPlayer();\n+    //TODO: this is a bit hacky, a chat channel user is required to create a context menu as in the chat tab (for foeing/befriending/messaging people...)\n+    chatUser = new ChatChannelUser(player.getUsername(), chatService.getChatUserColor(player.getUsername()), false, player);\n+\n+    countryImageView.imageProperty().bind(createObjectBinding(() -> countryFlagService.loadCountryFlag(\n+        StringUtils.hasText(player.getCountry()) ? \"\" : player.getCountry()).orElse(null), player.countryProperty()));\n+\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() -> Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+\n+    leagueLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"leaderboard.divisionName\", RatingUtil.getLeaderboardRating(player)).toUpperCase(),\n+        player.globalRatingMeanProperty())); // TODO: replace this with divisionproperty once it is available\n+    gameCountLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"teammatchmaking.gameCount\", player.getNumberOfGames()).toUpperCase(),\n+        player.numberOfGamesProperty()));\n+\n+    BooleanBinding isDifferentPlayerBinding = playerService.currentPlayerProperty().isNotEqualTo(player);\n+    kickPlayerButton.visibleProperty().bind(teamMatchmakingService.getParty().ownerProperty().isEqualTo(playerService.currentPlayerProperty()).and(isDifferentPlayerBinding));\n+    kickPlayerButton.managedProperty().bind(kickPlayerButton.visibleProperty());\n+    playerStatusImageView.managedProperty().bind(playerStatusImageView.visibleProperty());\n+    crownLabel.visibleProperty().bind(teamMatchmakingService.getParty().ownerProperty().isEqualTo(player));\n+    playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS, teamMatchmakingService.getParty().getOwner().equals(player));\n+\n+    playerStatusImageView.setImage(uiService.getThemeImage(UiService.CHAT_LIST_STATUS_PLAYING));\n+    playerService.getPlayerForUsername(player.getUsername()).get().statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue == PlayerStatus.IDLE) {\n+        Platform.runLater(() -> {\n+          playerStatusImageView.setVisible(false);\n+          playerCard.pseudoClassStateChanged(PLAYING_PSEUDO_CLASS, false);\n+        });\n+      } else {\n+        Platform.runLater(() -> {\n+          playerStatusImageView.setVisible(true);\n+          playerCard.pseudoClassStateChanged(PLAYING_PSEUDO_CLASS, true);\n+        });\n+      }", "originalCommit": "506f696bf0fb72c82a1dd6569b1d24c461397b05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU3MDkxNQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542570915", "bodyText": "Everytime a partymember leaves or joines the player cards get rerendered, that means it clears all children from the pane and instantiates new controllers. I am not sure, if this also cleans up the controllers, or if we need to do some form of garbage collection", "author": "BlackYps", "createdAt": "2020-12-14T17:31:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjc5MjIzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4385daf18b21429cd163c5d239caa74f40d9845", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\nindex f51994753..07f3584b3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n\n@@ -6,6 +6,7 @@ import com.faforever.client.chat.ChatUserContextMenuController;\n import com.faforever.client.chat.CountryFlagService;\n import com.faforever.client.chat.avatar.AvatarService;\n import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.game.Faction;\n import com.faforever.client.game.PlayerStatus;\n import com.faforever.client.i18n.I18n;\n"}}, {"oid": "b4385daf18b21429cd163c5d239caa74f40d9845", "url": "https://github.com/FAForever/downlords-faf-client/commit/b4385daf18b21429cd163c5d239caa74f40d9845", "message": "Refactor partychat", "committedDate": "2020-12-07T10:58:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAyMjM3Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542022372", "bodyText": "TODO what also refer to an issue if you make a TODO", "author": "1-alex98", "createdAt": "2020-12-13T22:40:51Z", "path": "src/main/java/com/faforever/client/remote/MockFafServerAccessor.java", "diffHunk": "@@ -245,17 +234,17 @@ public void requestMatchmakerInfo() {\n   }\n \n   @Override\n-  public CompletableFuture<GameLaunchMessage> startSearchLadder1v1(Faction faction) {\n-    logger.debug(\"Searching 1v1 match with faction: {}\", faction);\n+  public CompletableFuture<GameLaunchMessage> startSearchMatchmaker() {\n+    logger.debug(\"Starting matchmaker game\");\n     GameLaunchMessage gameLaunchMessage = new GameLaunchMessage();\n     gameLaunchMessage.setUid(123);\n-    gameLaunchMessage.setMod(KnownFeaturedMod.DEFAULT.getTechnicalName());\n+    gameLaunchMessage.setMod(KnownFeaturedMod.DEFAULT.getTechnicalName()); // TODO", "originalCommit": "ba436113c98b78d863a04b0dcec8154039b5c14f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ3NzU3OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542477579", "bodyText": "I am not sure, I guess it refers to changing the gamemode to a matchmaking mode. However we use FAF gamemode, so I guess this todo is obsolete.", "author": "BlackYps", "createdAt": "2020-12-14T15:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAyMjM3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "adfe7a5cd79e54cfab1ae93d7cd54d1345705925", "chunk": "diff --git a/src/main/java/com/faforever/client/remote/MockFafServerAccessor.java b/src/main/java/com/faforever/client/remote/MockFafServerAccessor.java\nindex f1243b63f..e279fd9af 100644\n--- a/src/main/java/com/faforever/client/remote/MockFafServerAccessor.java\n+++ b/src/main/java/com/faforever/client/remote/MockFafServerAccessor.java\n\n@@ -238,7 +238,7 @@ public class MockFafServerAccessor implements FafServerAccessor {\n     logger.debug(\"Starting matchmaker game\");\n     GameLaunchMessage gameLaunchMessage = new GameLaunchMessage();\n     gameLaunchMessage.setUid(123);\n-    gameLaunchMessage.setMod(KnownFeaturedMod.DEFAULT.getTechnicalName()); // TODO\n+    gameLaunchMessage.setMod(KnownFeaturedMod.DEFAULT.getTechnicalName());\n     return CompletableFuture.completedFuture(gameLaunchMessage);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAyMjc1NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542022755", "bodyText": "Extract into method", "author": "1-alex98", "createdAt": "2020-12-13T22:42:49Z", "path": "src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.ShowMapPoolEvent;\n+import com.faforever.client.player.PlayerService;\n+import com.google.common.eventbus.EventBus;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.Timeline;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.layout.VBox;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingQueueItemController implements Controller<VBox> {\n+\n+  private final static String QUEUE_I18N_PATTERN = \"teammatchmaking.queue.%s.%s\";\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final I18n i18n;\n+  private final EventBus eventBus;\n+\n+  public VBox queueItemRoot;\n+  public Label playersInQueueLabel;\n+  public Label queuePopTimeLabel;\n+  public ToggleButton joinLeaveQueueButton;\n+  public Label refreshingLabel;\n+  public Label matchFoundLabel;\n+  public Label matchStartingLabel;\n+  public Label matchCancelledLabel;\n+  public Button mapPoolButton;\n+\n+  @VisibleForTesting\n+  protected MatchmakingQueue queue;\n+\n+  public MatchmakingQueueItemController(PlayerService playerService, TeamMatchmakingService teamMatchmakingService, I18n i18n, EventBus eventBus) {\n+    this.playerService = playerService;\n+    this.teamMatchmakingService = teamMatchmakingService;\n+    this.i18n = i18n;\n+    this.eventBus = eventBus;\n+  }\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    joinLeaveQueueButton.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue > 150.0) {\n+        joinLeaveQueueButton.setText(\n+            i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"fullName\")));\n+      } else {\n+        joinLeaveQueueButton.setText(\n+            i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"shortName\")));\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public VBox getRoot() {\n+    return queueItemRoot;\n+  }\n+\n+  public void setQueue(MatchmakingQueue queue) {\n+    this.queue = queue;\n+\n+    playersInQueueLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"teammatchmaking.playersInQueue\", queue.getPlayersInQueue()).toUpperCase(),\n+        queue.playersInQueueProperty()));\n+\n+    JavaFxUtil.bindManagedToVisible(matchFoundLabel, matchStartingLabel, matchCancelledLabel);\n+    queue.matchingStatusProperty().addListener((observable, oldValue, newValue) -> {\n+      disableMatchStatus();\n+      if (newValue == null) {\n+        return;\n+      }\n+      switch (newValue) {\n+        case MATCH_FOUND -> matchFoundLabel.setVisible(true);\n+        case GAME_LAUNCHING -> matchStartingLabel.setVisible(true);\n+        case MATCH_CANCELLED -> matchCancelledLabel.setVisible(true);\n+      }\n+    });\n+\n+    joinLeaveQueueButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getMembers().size() > queue.getTeamSize()\n+            || !teamMatchmakingService.getParty().getOwner().equals(playerService.getCurrentPlayer().orElse(null)),\n+        teamMatchmakingService.getParty().getMembers(), queue.teamSizeProperty()\n+    ));\n+    queue.joinedProperty().addListener(observable -> refreshingLabel.setVisible(false));\n+    queue.joinedProperty().addListener(observable -> joinLeaveQueueButton.setSelected(queue.isJoined()));\n+\n+    mapPoolButton.setText(i18n.get(\"teammatchmaking.mapPool\").toUpperCase());\n+\n+    Timeline queuePopTimeUpdater = new Timeline(1, new KeyFrame(javafx.util.Duration.seconds(0), (ActionEvent event) -> {\n+      if (queue.getQueuePopTime() != null) {\n+        Instant now = Instant.now();\n+        Duration timeUntilPopQueue = Duration.between(now, queue.getQueuePopTime());\n+        if (!timeUntilPopQueue.isNegative()) {\n+          queuePopTimeLabel.setText(i18n.get(\"teammatchmaking.queuePopTimer\",\n+              timeUntilPopQueue.toMinutes(),\n+              timeUntilPopQueue.toSecondsPart()).toUpperCase());\n+        }\n+      }", "originalCommit": "ba436113c98b78d863a04b0dcec8154039b5c14f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7936a63a30c4691a77194e00c838a537184cfccb", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\nindex 8e6b89f1c..f53be8668 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n\n@@ -1,19 +1,19 @@\n package com.faforever.client.teammatchmaking;\n \n import com.faforever.client.fx.Controller;\n-import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.i18n.I18n;\n import com.faforever.client.main.event.ShowMapPoolEvent;\n import com.faforever.client.player.PlayerService;\n import com.google.common.eventbus.EventBus;\n import javafx.animation.KeyFrame;\n import javafx.animation.Timeline;\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n import javafx.scene.control.Button;\n import javafx.scene.control.Label;\n import javafx.scene.control.ToggleButton;\n-import javafx.scene.layout.VBox;\n-import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAyMjgzMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542022833", "bodyText": "the method is a little long", "author": "1-alex98", "createdAt": "2020-12-13T22:43:35Z", "path": "src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.ShowMapPoolEvent;\n+import com.faforever.client.player.PlayerService;\n+import com.google.common.eventbus.EventBus;\n+import javafx.animation.KeyFrame;\n+import javafx.animation.Timeline;\n+import javafx.event.ActionEvent;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.layout.VBox;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.time.Duration;\n+import java.time.Instant;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+public class MatchmakingQueueItemController implements Controller<VBox> {\n+\n+  private final static String QUEUE_I18N_PATTERN = \"teammatchmaking.queue.%s.%s\";\n+\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final I18n i18n;\n+  private final EventBus eventBus;\n+\n+  public VBox queueItemRoot;\n+  public Label playersInQueueLabel;\n+  public Label queuePopTimeLabel;\n+  public ToggleButton joinLeaveQueueButton;\n+  public Label refreshingLabel;\n+  public Label matchFoundLabel;\n+  public Label matchStartingLabel;\n+  public Label matchCancelledLabel;\n+  public Button mapPoolButton;\n+\n+  @VisibleForTesting\n+  protected MatchmakingQueue queue;\n+\n+  public MatchmakingQueueItemController(PlayerService playerService, TeamMatchmakingService teamMatchmakingService, I18n i18n, EventBus eventBus) {\n+    this.playerService = playerService;\n+    this.teamMatchmakingService = teamMatchmakingService;\n+    this.i18n = i18n;\n+    this.eventBus = eventBus;\n+  }\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    joinLeaveQueueButton.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue > 150.0) {\n+        joinLeaveQueueButton.setText(\n+            i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"fullName\")));\n+      } else {\n+        joinLeaveQueueButton.setText(\n+            i18n.get(String.format(QUEUE_I18N_PATTERN, queue.getQueueName(), \"shortName\")));\n+      }\n+    });\n+  }\n+\n+  @Override\n+  public VBox getRoot() {\n+    return queueItemRoot;\n+  }\n+\n+  public void setQueue(MatchmakingQueue queue) {", "originalCommit": "ba436113c98b78d863a04b0dcec8154039b5c14f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7936a63a30c4691a77194e00c838a537184cfccb", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\nindex 8e6b89f1c..f53be8668 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n\n@@ -1,19 +1,19 @@\n package com.faforever.client.teammatchmaking;\n \n import com.faforever.client.fx.Controller;\n-import com.faforever.client.fx.JavaFxUtil;\n import com.faforever.client.i18n.I18n;\n import com.faforever.client.main.event.ShowMapPoolEvent;\n import com.faforever.client.player.PlayerService;\n import com.google.common.eventbus.EventBus;\n import javafx.animation.KeyFrame;\n import javafx.animation.Timeline;\n+import javafx.beans.value.ChangeListener;\n+import javafx.beans.value.ObservableValue;\n import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n import javafx.scene.control.Button;\n import javafx.scene.control.Label;\n import javafx.scene.control.ToggleButton;\n-import javafx.scene.layout.VBox;\n-import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAyMzA2Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r542023066", "bodyText": "extract method", "author": "1-alex98", "createdAt": "2020-12-13T22:44:35Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,296 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.ui.dialog.Dialog;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> {\n+      playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+          (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+      List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+      partyMemberPane.getChildren().clear();\n+      members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+      for(int i = 0; i < members.size(); i++) {\n+        PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+        controller.setMember(members.get(i));\n+        if (members.size() == 1) {\n+          partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+        } else {\n+          partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+        }\n+      }", "originalCommit": "ba436113c98b78d863a04b0dcec8154039b5c14f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7936a63a30c4691a77194e00c838a537184cfccb", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex fa6baed87..382577d42 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -39,13 +39,12 @@ import javafx.scene.layout.StackPane;\n import javafx.scene.layout.VBox;\n import lombok.RequiredArgsConstructor;\n import lombok.extern.slf4j.Slf4j;\n-import org.jetbrains.annotations.VisibleForTesting;\n import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n import org.springframework.context.annotation.Scope;\n import org.springframework.stereotype.Component;\n+import org.springframework.util.StringUtils;\n \n import java.util.ArrayList;\n-import java.util.Comparator;\n import java.util.List;\n \n import static javafx.beans.binding.Bindings.createBooleanBinding;\n"}}, {"oid": "7936a63a30c4691a77194e00c838a537184cfccb", "url": "https://github.com/FAForever/downlords-faf-client/commit/7936a63a30c4691a77194e00c838a537184cfccb", "message": "Fix merge errors", "committedDate": "2020-12-19T23:02:29Z", "type": "commit"}, {"oid": "8f554c321468bac2c60105d0e9b003eba46b29d7", "url": "https://github.com/FAForever/downlords-faf-client/commit/8f554c321468bac2c60105d0e9b003eba46b29d7", "message": "Refactoring\n\nUse Map instead of ImmutableMap\nUse List.of instead of Collections.emptyList\nClean imports\nExtract method in GameService\nUse line breaks in stream operations\nController refactoring", "committedDate": "2020-12-19T23:03:23Z", "type": "commit"}, {"oid": "411da96ef94f8c911fe64ba887f5e30260e4d642", "url": "https://github.com/FAForever/downlords-faf-client/commit/411da96ef94f8c911fe64ba887f5e30260e4d642", "message": "Improve invite dialog", "committedDate": "2020-12-20T00:12:02Z", "type": "commit"}, {"oid": "6a9b84530c0c6744fdc6e36e4ab133cccb55965b", "url": "https://github.com/FAForever/downlords-faf-client/commit/6a9b84530c0c6744fdc6e36e4ab133cccb55965b", "message": "Add more tests", "committedDate": "2020-12-20T00:12:02Z", "type": "commit"}, {"oid": "5e5cc4582645fa056588eb4a4cab463a72c9d682", "url": "https://github.com/FAForever/downlords-faf-client/commit/5e5cc4582645fa056588eb4a4cab463a72c9d682", "message": "Add logging when matchmaker search stopped", "committedDate": "2020-12-20T00:13:52Z", "type": "commit"}, {"oid": "6a7a51a60428a593bdd217aa5939c84fb6d54b25", "url": "https://github.com/FAForever/downlords-faf-client/commit/6a7a51a60428a593bdd217aa5939c84fb6d54b25", "message": "Fix missing info on partymember cards", "committedDate": "2020-12-20T00:13:52Z", "type": "commit"}, {"oid": "adfe7a5cd79e54cfab1ae93d7cd54d1345705925", "url": "https://github.com/FAForever/downlords-faf-client/commit/adfe7a5cd79e54cfab1ae93d7cd54d1345705925", "message": "Refactoring\n\nMove method from Party.java to TeamMatchmakingService\nRefactor partychat logic\nCleanup todos\nReposition kick button", "committedDate": "2020-12-20T00:13:52Z", "type": "commit"}, {"oid": "95ba8394fa4afa1ef7473e847c41a0339fb85ad3", "url": "https://github.com/FAForever/downlords-faf-client/commit/95ba8394fa4afa1ef7473e847c41a0339fb85ad3", "message": "Add github actions", "committedDate": "2020-12-20T13:45:20Z", "type": "commit"}, {"oid": "dc2d3117782a2b139a02e51508741fb581197491", "url": "https://github.com/FAForever/downlords-faf-client/commit/dc2d3117782a2b139a02e51508741fb581197491", "message": "Disable queue buttons when someone is in a game", "committedDate": "2020-12-20T13:45:20Z", "type": "commit"}, {"oid": "3e0e68d82855851a4ab0aca69a06418550486f29", "url": "https://github.com/FAForever/downlords-faf-client/commit/3e0e68d82855851a4ab0aca69a06418550486f29", "message": "Change queue heading message when you are in queue", "committedDate": "2020-12-20T13:45:20Z", "type": "commit"}, {"oid": "392770c1e55a656b1770d1a6a6bf16f038a9cdf1", "url": "https://github.com/FAForever/downlords-faf-client/commit/392770c1e55a656b1770d1a6a6bf16f038a9cdf1", "message": "Remember factions", "committedDate": "2020-12-20T13:45:20Z", "type": "commit"}, {"oid": "6bc898e1955c41f87f97b267761c12eba21bf319", "url": "https://github.com/FAForever/downlords-faf-client/commit/6bc898e1955c41f87f97b267761c12eba21bf319", "message": "Refactoring", "committedDate": "2020-12-20T13:45:21Z", "type": "commit"}, {"oid": "2824223ed76fb452d6886470f5380f599cec4b93", "url": "https://github.com/FAForever/downlords-faf-client/commit/2824223ed76fb452d6886470f5380f599cec4b93", "message": "Cache api call and fix queue display bugs", "committedDate": "2020-12-20T13:45:21Z", "type": "commit"}, {"oid": "901c2727e7b4f0b304ae370161c8e76128b4fe5a", "url": "https://github.com/FAForever/downlords-faf-client/commit/901c2727e7b4f0b304ae370161c8e76128b4fe5a", "message": "Create new context menu for party members", "committedDate": "2020-12-20T13:45:21Z", "type": "commit"}, {"oid": "e8fe02f6752b97d8f20ee0010fd9905eee528d97", "url": "https://github.com/FAForever/downlords-faf-client/commit/e8fe02f6752b97d8f20ee0010fd9905eee528d97", "message": "merge branch 'develop' into feature/team-matchmaking", "committedDate": "2020-12-20T14:29:39Z", "type": "commit"}, {"oid": "e8fe02f6752b97d8f20ee0010fd9905eee528d97", "url": "https://github.com/FAForever/downlords-faf-client/commit/e8fe02f6752b97d8f20ee0010fd9905eee528d97", "message": "merge branch 'develop' into feature/team-matchmaking", "committedDate": "2020-12-20T14:29:39Z", "type": "forcePushed"}, {"oid": "857d045ad3caf57e21c8ec74f32171049a96cef9", "url": "https://github.com/FAForever/downlords-faf-client/commit/857d045ad3caf57e21c8ec74f32171049a96cef9", "message": "code cleanup", "committedDate": "2020-12-20T14:54:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njc0MDgyNw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r546740827", "bodyText": "empty test", "author": "Sheikah45", "createdAt": "2020-12-21T14:37:29Z", "path": "src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.fa.relay.LobbyMode;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.GameService;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.main.event.OpenTeamMatchmakingEvent;\n+import com.faforever.client.net.ConnectionState;\n+import com.faforever.client.notification.ImmediateNotification;\n+import com.faforever.client.notification.NotificationService;\n+import com.faforever.client.notification.PersistentNotification;\n+import com.faforever.client.notification.TransientNotification;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.preferences.PreferencesService;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage;\n+import com.faforever.client.rankedmatch.MatchmakerInfoMessage.MatchmakerQueue;\n+import com.faforever.client.remote.FafServerAccessor;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.remote.domain.GameLaunchMessage;\n+import com.faforever.client.remote.domain.MatchCancelledMessage;\n+import com.faforever.client.remote.domain.MatchFoundMessage;\n+import com.faforever.client.remote.domain.MatchmakingState;\n+import com.faforever.client.remote.domain.PartyInfoMessage;\n+import com.faforever.client.remote.domain.PartyInviteMessage;\n+import com.faforever.client.remote.domain.PartyKickedMessage;\n+import com.faforever.client.remote.domain.SearchInfoMessage;\n+import com.faforever.client.teammatchmaking.MatchmakingQueue.MatchingStatus;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.test.AbstractPlainJavaFxTest;\n+import com.google.common.eventbus.EventBus;\n+import javafx.beans.property.ReadOnlyObjectProperty;\n+import javafx.beans.property.SimpleObjectProperty;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ObservableList;\n+import org.jetbrains.annotations.NotNull;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mock;\n+import org.springframework.scheduling.TaskScheduler;\n+import org.testfx.util.WaitForAsyncUtils;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+import static com.faforever.client.notification.Severity.INFO;\n+import static com.faforever.client.notification.Severity.WARN;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.hamcrest.CoreMatchers.nullValue;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.mockito.Mockito.verifyNoInteractions;\n+import static org.mockito.Mockito.verifyNoMoreInteractions;\n+import static org.mockito.Mockito.when;\n+\n+public class TeamMatchmakingServiceTest extends AbstractPlainJavaFxTest {\n+\n+  @Mock\n+  private FafServerAccessor fafServerAccessor;\n+  @Mock\n+  private PlayerService playerService;\n+  @Mock\n+  private NotificationService notificationService;\n+  @Mock\n+  private PreferencesService preferencesService;\n+  @Mock\n+  private FafService fafService;\n+  @Mock\n+  private EventBus eventBus;\n+  @Mock\n+  private I18n i18n;\n+  @Mock\n+  private TaskScheduler taskScheduler;\n+  @Mock\n+  private GameService gameService;\n+  @Mock\n+  private Player player;\n+  @Mock\n+  private Player otherPlayer;\n+\n+  private TeamMatchmakingService instance;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    List<Player> playerList = new ArrayList<>();\n+    playerList.add(player);\n+    when(player.getStatus()).thenReturn(PlayerStatus.IDLE);\n+    when(playerService.getPlayersByIds(Collections.singletonList(1))).thenReturn(CompletableFuture.completedFuture(playerList));\n+    ReadOnlyObjectProperty<ConnectionState> state = new SimpleObjectProperty<>();\n+    when(fafService.connectionStateProperty()).thenReturn(state);\n+    ReadOnlyObjectProperty<Player> playerProperty = new SimpleObjectProperty<>();\n+    when(playerService.currentPlayerProperty()).thenReturn(playerProperty);\n+    instance = new TeamMatchmakingService(fafServerAccessor, playerService, notificationService, preferencesService,\n+        fafService, eventBus, i18n, taskScheduler, gameService);\n+\n+    when(preferencesService.isGamePathValid()).thenReturn(true);\n+    when(playerService.getCurrentPlayer()).thenReturn(Optional.of(player));\n+  }\n+\n+  private void setPartyMembers() {\n+    ObservableList<PartyMember> testMembers = FXCollections.observableArrayList();\n+    testMembers.add(new PartyMember(new Player(\"member1\")));\n+    testMembers.add(new PartyMember(new Player(\"member2\")));\n+    testMembers.add(new PartyMember(new Player(\"member3\")));\n+    testMembers.add(new PartyMember(player));\n+    instance.getParty().setMembers(testMembers);\n+    instance.getParty().setOwner(player);\n+  }\n+\n+  private void setOwnerByName(String owner) {\n+    instance.getParty().getMembers().stream()\n+        .filter(member -> member.getPlayer().getUsername().equals(owner))\n+        .findFirst()\n+        .ifPresent(partyMember1 -> instance.getParty().setOwner(partyMember1.getPlayer()));\n+  }\n+\n+  @Test\n+  public void testOnInviteMessage() {\n+    when(player.getUsername()).thenReturn(\"dummy\");\n+    PartyInviteMessage message = new PartyInviteMessage();\n+    message.setSender(1);\n+\n+    instance.onPartyInvite(message);\n+\n+    ArgumentCaptor<TransientNotification> captorTransient = ArgumentCaptor.forClass(TransientNotification.class);\n+    verify(notificationService).addNotification(captorTransient.capture());\n+    ArgumentCaptor<PersistentNotification> captorPersistent = ArgumentCaptor.forClass(PersistentNotification.class);\n+    verify(notificationService).addNotification(captorPersistent.capture());\n+    PersistentNotification persistentNotification = captorPersistent.getValue();\n+    assertThat(persistentNotification.getSeverity(), is(INFO));\n+    verify(i18n, times(2)).get(\"teammatchmaking.notification.invite.message\", \"dummy\");\n+  }\n+\n+  @Test\n+  public void testOnKickedFromPartyMessage() {\n+    setPartyMembers();\n+    setOwnerByName(\"member2\");\n+\n+    instance.onPartyKicked(new PartyKickedMessage());\n+    WaitForAsyncUtils.waitForFxEvents();\n+\n+    assertThat(instance.getParty().getMembers().size(), is(1));\n+    assertThat(instance.getParty().getOwner(), is(player));\n+    assertThat(instance.getPlayersInGame().isEmpty(), is(true));\n+  }\n+\n+  @Test\n+  public void testOnKickedFromPartyMessageWhenInGame() {\n+    setPartyMembers();\n+    setOwnerByName(\"member2\");\n+    when(player.getStatus()).thenReturn(PlayerStatus.PLAYING);\n+\n+    instance.onPartyKicked(new PartyKickedMessage());\n+    WaitForAsyncUtils.waitForFxEvents();\n+\n+    assertThat(instance.getParty().getMembers().size(), is(1));\n+    assertThat(instance.getParty().getOwner(), is(player));\n+    assertThat(instance.getPlayersInGame().size(), is(1));\n+    assertThat(instance.getPlayersInGame().contains(player), is(true));\n+  }\n+\n+  @Test\n+  public void testOnPartyInfoMessagePlayerNotInParty() {\n+    when(playerService.getCurrentPlayer()).thenReturn(Optional.of(player));\n+    List<PartyInfoMessage.PartyMember> testMembers = FXCollections.observableArrayList();\n+    PartyInfoMessage.PartyMember member = new PartyInfoMessage.PartyMember();\n+    member.setPlayer(2);\n+    testMembers.add(member);\n+    PartyInfoMessage message = new PartyInfoMessage();\n+    message.setMembers(testMembers);\n+\n+    instance.onPartyInfo(message);\n+    WaitForAsyncUtils.waitForFxEvents();\n+\n+    assertThat(instance.getParty().getMembers().size(), is(1));\n+    assertThat(instance.getParty().getOwner(), is(player));\n+  }\n+\n+  @Test\n+  public void testOnPartyInfoMessage() {\n+\n+  }", "originalCommit": "857d045ad3caf57e21c8ec74f32171049a96cef9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1df5ab784ec12b238cef8f7aecc98359bb31eabf", "chunk": "diff --git a/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java b/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\nindex 9d3a1089b..4072cd62a 100644\n--- a/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\n+++ b/src/test/java/com/faforever/client/teammatchmaking/TeamMatchmakingServiceTest.java\n\n@@ -94,6 +94,8 @@ public class TeamMatchmakingServiceTest extends AbstractPlainJavaFxTest {\n     List<Player> playerList = new ArrayList<>();\n     playerList.add(player);\n     when(player.getStatus()).thenReturn(PlayerStatus.IDLE);\n+    when(player.getId()).thenReturn(1);\n+    when(otherPlayer.getId()).thenReturn(2);\n     when(playerService.getPlayersByIds(Collections.singletonList(1))).thenReturn(CompletableFuture.completedFuture(playerList));\n     ReadOnlyObjectProperty<ConnectionState> state = new SimpleObjectProperty<>();\n     when(fafService.connectionStateProperty()).thenReturn(state);\n"}}, {"oid": "54b40ddf6c8f67bac4c08cb8e2ac82c4c9099340", "url": "https://github.com/FAForever/downlords-faf-client/commit/54b40ddf6c8f67bac4c08cb8e2ac82c4c9099340", "message": "Add invite item to chat context menu", "committedDate": "2020-12-21T21:39:38Z", "type": "commit"}, {"oid": "1df5ab784ec12b238cef8f7aecc98359bb31eabf", "url": "https://github.com/FAForever/downlords-faf-client/commit/1df5ab784ec12b238cef8f7aecc98359bb31eabf", "message": "Add tests", "committedDate": "2020-12-24T00:21:44Z", "type": "commit"}, {"oid": "41d3283903944aac66f95760c3be06e378dc8aa5", "url": "https://github.com/FAForever/downlords-faf-client/commit/41d3283903944aac66f95760c3be06e378dc8aa5", "message": "Fix queues not displayed bug", "committedDate": "2020-12-26T17:30:38Z", "type": "commit"}, {"oid": "41d3283903944aac66f95760c3be06e378dc8aa5", "url": "https://github.com/FAForever/downlords-faf-client/commit/41d3283903944aac66f95760c3be06e378dc8aa5", "message": "Fix queues not displayed bug", "committedDate": "2020-12-26T17:30:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAzNzkxMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549037911", "bodyText": "Needs to be a constant", "author": "1-alex98", "createdAt": "2020-12-26T22:29:00Z", "path": "src/main/java/com/faforever/client/chat/ChatController.java", "diffHunk": "@@ -135,10 +136,10 @@ public void initialize() {\n     eventBus.register(this);\n \n     chatService.addChannelsListener(change -> {\n-      if (change.wasRemoved()) {\n+      if (change.wasRemoved() && !change.getValueRemoved().getName().endsWith(\"'sParty\")) {", "originalCommit": "41d3283903944aac66f95760c3be06e378dc8aa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMyMDU2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549320567", "bodyText": "Overload isMatchmakerPartyMessage to take a String as well. Then use the dedicated function", "author": "Brutus5000", "createdAt": "2020-12-28T11:51:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTAzNzkxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b7a3de636218a11c2076e50bf59953d9e3be826b", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/ChatController.java b/src/main/java/com/faforever/client/chat/ChatController.java\nindex c8746c31c..f60e0759a 100644\n--- a/src/main/java/com/faforever/client/chat/ChatController.java\n+++ b/src/main/java/com/faforever/client/chat/ChatController.java\n\n@@ -136,10 +136,10 @@ public class ChatController extends AbstractViewController<Node> {\n     eventBus.register(this);\n \n     chatService.addChannelsListener(change -> {\n-      if (change.wasRemoved() && !change.getValueRemoved().getName().endsWith(\"'sParty\")) {\n+      if (change.wasRemoved() && !isMatchmakerPartyMessage(change.getValueRemoved().getName())) {\n         onChannelLeft(change.getValueRemoved());\n       }\n-      if (change.wasAdded() && !change.getValueAdded().getName().endsWith(\"'sParty\")) {\n+      if (change.wasAdded() && !isMatchmakerPartyMessage(change.getValueAdded().getName())) {\n         onChannelJoined(change.getValueAdded());\n       }\n     });\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxOTk0NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549319944", "bodyText": "Should this be cached as well?", "author": "Brutus5000", "createdAt": "2020-12-28T11:49:32Z", "path": "src/main/java/com/faforever/client/api/FafApiAccessorImpl.java", "diffHunk": "@@ -427,28 +427,41 @@ public void deleteModVersionReview(String id) {\n \n   @Override\n   public Optional<Game> findReplayById(int id) {\n-    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, ImmutableMap.of(\"include\", REPLAY_INCLUDES)));\n+    return Optional.ofNullable(getOne(\"/data/game/\" + id, Game.class, java.util.Map.of(\"include\", REPLAY_INCLUDES)));\n   }\n \n   @Override\n-  public Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> getLadder1v1MapsWithMeta(int count, int page) {\n-    JSONAPIDocument<List<Ladder1v1Map>> jsonApiDoc = getPageWithMeta(\"/data/ladder1v1Map\", count, page, ImmutableMap.of(\n-        \"include\", \"mapVersion,mapVersion.map,mapVersion.map.latestVersion,mapVersion.map.author,\" +\n-            \"mapVersion.map.statistics,mapVersion.map.reviewsSummary,mapVersion.map.versions.reviews,\" +\n-            \"mapVersion.map.versions.reviews.player\"));\n-    return new Tuple<>(jsonApiDoc.get(), jsonApiDoc.getMeta());\n+  public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {", "originalCommit": "41d3283903944aac66f95760c3be06e378dc8aa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2Njk1Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549666957", "bodyText": "probably a good idea", "author": "BlackYps", "createdAt": "2020-12-29T11:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMxOTk0NA=="}], "type": "inlineReview", "revised_code": {"commit": "bde9eea83c469241a9ec5f504210f58df2cca22a", "chunk": "diff --git a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\nindex c7f6cc9f8..2d8ac4398 100644\n--- a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n+++ b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n\n@@ -431,6 +431,7 @@ public class FafApiAccessorImpl implements FafApiAccessor, InitializingBean {\n   }\n \n   @Override\n+  @Cacheable(value = CacheNames.MATCHMAKER_POOLS, sync = true)\n   public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n     return getAll(\"/data/matchmakerQueueMapPool\", java.util.Map.of(\n         \"include\", \"matchmakerQueue,mapPool,mapPool.mapVersions,\" +\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMyMDE5OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549320199", "bodyText": "We just changed this in the API to be properly camel case again", "author": "Brutus5000", "createdAt": "2020-12-28T11:50:25Z", "path": "src/main/java/com/faforever/client/api/dto/Leaderboard.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.faforever.client.api.dto;\n+\n+import com.github.jasminb.jsonapi.annotations.Id;\n+import com.github.jasminb.jsonapi.annotations.Type;\n+import lombok.Data;\n+import java.time.OffsetDateTime;\n+\n+@Data\n+@Type(\"leaderboard\")\n+public class Leaderboard {\n+  @Id\n+  private String id;\n+  private OffsetDateTime createTime;\n+  private OffsetDateTime updateTime;\n+  private String description_key;\n+  private String name_key;\n+  private String technical_name;", "originalCommit": "41d3283903944aac66f95760c3be06e378dc8aa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTM0OTI5Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549349296", "bodyText": "Brutus did this get changed to being camelCase after you reverted?", "author": "Sheikah45", "createdAt": "2020-12-28T13:32:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMyMDE5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "chunk": "diff --git a/src/main/java/com/faforever/client/api/dto/Leaderboard.java b/src/main/java/com/faforever/client/api/dto/Leaderboard.java\nindex da8135cfb..40aaa5bb9 100644\n--- a/src/main/java/com/faforever/client/api/dto/Leaderboard.java\n+++ b/src/main/java/com/faforever/client/api/dto/Leaderboard.java\n\n@@ -3,6 +3,7 @@ package com.faforever.client.api.dto;\n import com.github.jasminb.jsonapi.annotations.Id;\n import com.github.jasminb.jsonapi.annotations.Type;\n import lombok.Data;\n+\n import java.time.OffsetDateTime;\n \n @Data\n"}}, {"oid": "b7a3de636218a11c2076e50bf59953d9e3be826b", "url": "https://github.com/FAForever/downlords-faf-client/commit/b7a3de636218a11c2076e50bf59953d9e3be826b", "message": "Code cleanup", "committedDate": "2020-12-29T11:44:01Z", "type": "commit"}, {"oid": "bde9eea83c469241a9ec5f504210f58df2cca22a", "url": "https://github.com/FAForever/downlords-faf-client/commit/bde9eea83c469241a9ec5f504210f58df2cca22a", "message": "Cache map pools", "committedDate": "2020-12-29T11:44:01Z", "type": "commit"}, {"oid": "c37a25b4ff66049a8ee011ea417d18393171a886", "url": "https://github.com/FAForever/downlords-faf-client/commit/c37a25b4ff66049a8ee011ea417d18393171a886", "message": "Merge branch 'develop' into feature/team-matchmaking\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/api/FafApiAccessorImpl.java", "committedDate": "2020-12-29T12:06:17Z", "type": "commit"}, {"oid": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "url": "https://github.com/FAForever/downlords-faf-client/commit/1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "message": "leaderboard to camelCase", "committedDate": "2020-12-29T12:06:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcxMzY2Nw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549713667", "bodyText": "I would include the leaderboard of the queue, although if the api did not change back to camelcase this may break it at the moment", "author": "Sheikah45", "createdAt": "2020-12-29T13:55:59Z", "path": "src/main/java/com/faforever/client/api/FafApiAccessorImpl.java", "diffHunk": "@@ -446,28 +446,42 @@ public void deleteModVersionReview(String id) {\n \n   @Override\n   public Optional<Game> findReplayById(int id) {\n-    return Optional.ofNullable(getOne(REPLAY_ENDPOINT + id, Game.class, ImmutableMap.of(INCLUDE, REPLAY_INCLUDES)));\n+    return Optional.ofNullable(getOne(REPLAY_ENDPOINT + id, Game.class, java.util.Map.of(INCLUDE, REPLAY_INCLUDES)));\n   }\n \n   @Override\n-  public Tuple<List<Ladder1v1Map>, java.util.Map<String, ?>> getLadder1v1MapsWithMeta(int count, int page) {\n-    JSONAPIDocument<List<Ladder1v1Map>> jsonApiDoc = getPageWithMeta(\"/data/ladder1v1Map\", count, page, ImmutableMap.of(\n-        INCLUDE, \"mapVersion,mapVersion.map,mapVersion.map.latestVersion,mapVersion.map.author,\" +\n-            \"mapVersion.map.statistics,mapVersion.map.reviewsSummary,mapVersion.map.versions.reviews,\" +\n-            \"mapVersion.map.versions.reviews.player\"));\n-    return new Tuple<>(jsonApiDoc.get(), jsonApiDoc.getMeta());\n+  @Cacheable(value = CacheNames.MATCHMAKER_POOLS, sync = true)\n+  public List<MatchmakerQueueMapPool> getMatchmakerPools(int matchmakerQueueId) {\n+    return getAll(\"/data/matchmakerQueueMapPool\", java.util.Map.of(\n+        INCLUDE, \"matchmakerQueue,mapPool,mapPool.mapVersions,\" +\n+            \"mapPool.mapVersions.map,mapPool.mapVersions.map.latestVersion,\" +\n+            \"mapPool.mapVersions.map.author,mapPool.mapVersions.map.statistics,\" +\n+            \"mapPool.mapVersions.map.reviewsSummary,mapPool.mapVersions.map.versions.reviews,\" +\n+            \"mapPool.mapVersions.map.versions.reviews.player\",\n+        FILTER, rsql(qBuilder().string(\"matchmakerQueue.id\").eq(String.valueOf(matchmakerQueueId)))));\n+  }\n+\n+  @Override\n+  @Cacheable(value = CacheNames.MATCHMAKER_QUEUES, sync = true)\n+  public Optional<MatchmakerQueue> getMatchmakerQueue(String technicalName) {\n+    List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", java.util.Map.of(\n+        FILTER, rsql(qBuilder().string(\"technicalName\").eq(technicalName))));", "originalCommit": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "chunk": "diff --git a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\nindex d608e9b89..745564c6d 100644\n--- a/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n+++ b/src/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n\n@@ -465,6 +465,7 @@ public class FafApiAccessorImpl implements FafApiAccessor, InitializingBean {\n   @Cacheable(value = CacheNames.MATCHMAKER_QUEUES, sync = true)\n   public Optional<MatchmakerQueue> getMatchmakerQueue(String technicalName) {\n     List<MatchmakerQueue> queue = getAll(\"/data/matchmakerQueue\", java.util.Map.of(\n+        INCLUDE, \"leaderboard\",\n         FILTER, rsql(qBuilder().string(\"technicalName\").eq(technicalName))));\n     if (queue.isEmpty()) {\n       return Optional.empty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcyMTI2NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549721264", "bodyText": "This should be a constant as well ideally related to the one used for checking the channel name", "author": "Sheikah45", "createdAt": "2020-12-29T14:18:47Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,324 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> renderPartyMembers());\n+    if (teamMatchmakingService.isQueuesReadyForUpdate()) {\n+      renderQueues(); // The teamMatchmakingService may already have all queues collected\n+    }                 // so we won't get any updates on the following change listener\n+    teamMatchmakingService.queuesReadyForUpdateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        renderQueues();\n+      }\n+    });\n+\n+    player.statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue != PlayerStatus.IDLE) {\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      } else {\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      }\n+    });\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(String.format(\"#%s'sParty\", newValue.getUsername()));", "originalCommit": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13248e0b78ebc057e5672d703678134e1fa9e2f5", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 0ee768652..127b337c3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -49,6 +49,7 @@ import java.util.Collections;\n import java.util.Comparator;\n import java.util.List;\n \n+import static com.faforever.client.chat.ChatService.PARTY_CHANNEL_SUFFIX;\n import static javafx.beans.binding.Bindings.createBooleanBinding;\n import static javafx.beans.binding.Bindings.createObjectBinding;\n import static javafx.beans.binding.Bindings.createStringBinding;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcyMTk3OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549721978", "bodyText": "constant", "author": "Sheikah45", "createdAt": "2020-12-29T14:20:55Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,324 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> renderPartyMembers());\n+    if (teamMatchmakingService.isQueuesReadyForUpdate()) {\n+      renderQueues(); // The teamMatchmakingService may already have all queues collected\n+    }                 // so we won't get any updates on the following change listener\n+    teamMatchmakingService.queuesReadyForUpdateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        renderQueues();\n+      }\n+    });\n+\n+    player.statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue != PlayerStatus.IDLE) {\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      } else {\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      }\n+    });\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(String.format(\"#%s'sParty\", newValue.getUsername()));\n+    });\n+    createChannelTab(String.format(\"#%s'sParty\", teamMatchmakingService.getParty().getOwner().getUsername()));", "originalCommit": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13248e0b78ebc057e5672d703678134e1fa9e2f5", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 0ee768652..127b337c3 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -49,6 +49,7 @@ import java.util.Collections;\n import java.util.Comparator;\n import java.util.List;\n \n+import static com.faforever.client.chat.ChatService.PARTY_CHANNEL_SUFFIX;\n import static javafx.beans.binding.Bindings.createBooleanBinding;\n import static javafx.beans.binding.Bindings.createObjectBinding;\n import static javafx.beans.binding.Bindings.createStringBinding;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTcyNTAwMg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549725002", "bodyText": "Would be good to have this as a constant to make referencing easier", "author": "Sheikah45", "createdAt": "2020-12-29T14:29:57Z", "path": "src/main/java/com/faforever/client/chat/ChatController.java", "diffHunk": "@@ -186,6 +189,14 @@ public void onChatMessage(ChatMessageEvent event) {\n     });\n   }\n \n+  private boolean isMatchmakerPartyMessage(ChatMessage message) {\n+    return message.getSource() != null && isMatchmakerPartyMessage(message.getSource());\n+  }\n+\n+  private boolean isMatchmakerPartyMessage(String channelName) {\n+    return channelName.endsWith(\"'sParty\");", "originalCommit": "1ff214537aa6580a5470daecf7bb442bdfc8e1f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13248e0b78ebc057e5672d703678134e1fa9e2f5", "chunk": "diff --git a/src/main/java/com/faforever/client/chat/ChatController.java b/src/main/java/com/faforever/client/chat/ChatController.java\nindex f60e0759a..02483b886 100644\n--- a/src/main/java/com/faforever/client/chat/ChatController.java\n+++ b/src/main/java/com/faforever/client/chat/ChatController.java\n\n@@ -194,7 +196,7 @@ public class ChatController extends AbstractViewController<Node> {\n   }\n \n   private boolean isMatchmakerPartyMessage(String channelName) {\n-    return channelName.endsWith(\"'sParty\");\n+    return channelName.endsWith(PARTY_CHANNEL_SUFFIX);\n   }\n \n   private AbstractChatTabController addAndGetPrivateMessageTab(String username) {\n"}}, {"oid": "13248e0b78ebc057e5672d703678134e1fa9e2f5", "url": "https://github.com/FAForever/downlords-faf-client/commit/13248e0b78ebc057e5672d703678134e1fa9e2f5", "message": "Use constant for party channels", "committedDate": "2020-12-29T15:31:23Z", "type": "commit"}, {"oid": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "url": "https://github.com/FAForever/downlords-faf-client/commit/6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "message": "Include leaderboard in queue api call", "committedDate": "2020-12-29T15:41:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2MzAzNg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549763036", "bodyText": "why would that be synchronized? I mean it just executes in site PlatformRun.later ... That make is synchronized because there is only one UI Thread !!!", "author": "1-alex98", "createdAt": "2020-12-29T16:15:55Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,325 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static com.faforever.client.chat.ChatService.PARTY_CHANNEL_SUFFIX;\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> renderPartyMembers());\n+    if (teamMatchmakingService.isQueuesReadyForUpdate()) {\n+      renderQueues(); // The teamMatchmakingService may already have all queues collected\n+    }                 // so we won't get any updates on the following change listener\n+    teamMatchmakingService.queuesReadyForUpdateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        renderQueues();\n+      }\n+    });\n+\n+    player.statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue != PlayerStatus.IDLE) {\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      } else {\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      }\n+    });\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(\"#\" + newValue.getUsername() + PARTY_CHANNEL_SUFFIX);\n+    });\n+    createChannelTab(\"#\" + teamMatchmakingService.getParty().getOwner().getUsername() + PARTY_CHANNEL_SUFFIX);\n+\n+    fafService.requestMatchmakerInfo();\n+  }\n+\n+  private void initializeDynamicChatPosition() {\n+    contentPane.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue < 1115.0) {\n+        GridPane.setColumnIndex(chatTabPane, 0);\n+        GridPane.setRowIndex(chatTabPane, 1);\n+        GridPane.setColumnSpan(chatTabPane, 2);\n+        GridPane.setColumnSpan(scrollPane, 2);\n+        column2.setMinWidth(0);\n+        row2.setMinHeight(200);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, true);\n+      } else {\n+        GridPane.setColumnIndex(chatTabPane, 1);\n+        GridPane.setRowIndex(chatTabPane, 0);\n+        GridPane.setColumnSpan(chatTabPane, 1);\n+        GridPane.setColumnSpan(scrollPane, 1);\n+        column2.setMinWidth(400);\n+        row2.setMinHeight(0);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, false);\n+      }\n+    });\n+  }\n+\n+  private void initializeUppercaseText() {\n+    matchmakerHeadingLabel.setText(i18n.get(\"teammatchmaking.playerTitle\").toUpperCase());\n+    partyHeadingLabel.setText(i18n.get(\"teammatchmaking.partyTitle\").toUpperCase());\n+    invitePlayerButton.setText(i18n.get(\"teammatchmaking.invitePlayer\").toUpperCase());\n+    leavePartyButton.setText(i18n.get(\"teammatchmaking.leaveParty\").toUpperCase());\n+\n+    leagueLabel.textProperty().bind(createStringBinding(() -> i18n.get(\"leaderboard.divisionName\").toUpperCase(),\n+        player.globalRatingMeanProperty())); // This should actually be a divisionProperty once that is available\n+    gameCountLabel.textProperty().bind(createStringBinding(() ->\n+        i18n.get(\"teammatchmaking.gameCount\", player.getNumberOfGames()).toUpperCase(), player.numberOfGamesProperty()));\n+    queueHeadingLabel.textProperty().bind(createStringBinding(() -> {\n+      if (teamMatchmakingService.isCurrentlyInQueue())\n+        return i18n.get(\"teammatchmaking.queueTitle.inQueue\").toUpperCase();\n+      else if (!teamMatchmakingService.getParty().getOwner().equals(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inParty\").toUpperCase();\n+      else if (teamMatchmakingService.getPlayersInGame().contains(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inGame\").toUpperCase();\n+      else if (!teamMatchmakingService.getPlayersInGame().isEmpty())\n+        return i18n.get(\"teammatchmaking.queueTitle.memberInGame\").toUpperCase();\n+      else\n+        return i18n.get(\"teammatchmaking.queueTitle\").toUpperCase();\n+    },  teamMatchmakingService.currentlyInQueueProperty(),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        teamMatchmakingService.getPlayersInGame()));\n+  }\n+\n+  private void initializeBindings() {\n+    countryImageView.imageProperty().bind(createObjectBinding(() ->\n+        countryFlagService.loadCountryFlag(player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    JavaFxUtil.bindManagedToVisible(clanLabel, avatarImageView);\n+\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() ->\n+        Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    crownLabel.visibleProperty().bind(createBooleanBinding(() ->\n+            teamMatchmakingService.getParty().getMembers().size() > 1 && teamMatchmakingService.getParty().getOwner().equals(player),\n+        teamMatchmakingService.getParty().ownerProperty(), teamMatchmakingService.getParty().getMembers()));\n+\n+    invitePlayerButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getOwner().getId() != playerService.getCurrentPlayer().map(Player::getId).orElse(-1),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        playerService.currentPlayerProperty()\n+    ));\n+    leavePartyButton.disableProperty().bind(createBooleanBinding(() -> teamMatchmakingService.getParty().getMembers().size() <= 1, teamMatchmakingService.getParty().getMembers()));\n+  }\n+\n+  private void renderPartyMembers() {\n+    playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+        (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+    List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+    partyMemberPane.getChildren().clear();\n+    members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+    for(int i = 0; i < members.size(); i++) {\n+      PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+      controller.setMember(members.get(i));\n+      if (members.size() == 1) {\n+        partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+      } else {\n+        partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return teamMatchmakingRoot;\n+  }\n+\n+  public void onInvitePlayerButtonClicked(ActionEvent actionEvent) {\n+    InvitePlayerController invitePlayerController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_invite_player.fxml\");\n+    Pane root = invitePlayerController.getRoot();\n+    uiService.showInDialog(teamMatchmakingRoot, root, i18n.get(\"teammatchmaking.invitePlayer\"));\n+  }\n+\n+  public void onLeavePartyButtonClicked(ActionEvent actionEvent) {\n+    teamMatchmakingService.leaveParty();\n+  }\n+\n+  public void onFactionButtonClicked(ActionEvent actionEvent) {\n+\n+    if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n+      selectFactionsBasedOnParty();\n+      return;\n+    }\n+\n+    List<Faction> factions = new ArrayList<>();\n+    if (uefButton.isSelected()) {\n+      factions.add(Faction.UEF);\n+    }\n+    if (aeonButton.isSelected()) {\n+      factions.add(Faction.AEON);\n+    }\n+    if (cybranButton.isSelected()) {\n+      factions.add(Faction.CYBRAN);\n+    }\n+    if (seraphimButton.isSelected()) {\n+      factions.add(Faction.SERAPHIM);\n+    }\n+\n+    teamMatchmakingService.sendFactionSelection(factions);\n+\n+    refreshingLabel.setVisible(true);\n+  }\n+\n+  private void selectFactionsBasedOnParty() {\n+    uefButton.setSelected(isFactionSelectedInParty(Faction.UEF));\n+    aeonButton.setSelected(isFactionSelectedInParty(Faction.AEON));\n+    cybranButton.setSelected(isFactionSelectedInParty(Faction.CYBRAN));\n+    seraphimButton.setSelected(isFactionSelectedInParty(Faction.SERAPHIM));\n+  }\n+\n+  private boolean isFactionSelectedInParty(Faction faction) {\n+    return teamMatchmakingService.getParty().getMembers().stream()\n+        .anyMatch(m -> m.getPlayer().getId() == player.getId() && m.getFactions().contains(faction));\n+  }\n+\n+  private void createChannelTab(String channelName) {\n+    matchmakingChatController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_chat.fxml\");\n+    matchmakingChatController.setChannel(channelName);\n+    Platform.runLater(() -> {\n+      chatTabPane.getTabs().clear();\n+      chatTabPane.getTabs().add(matchmakingChatController.getRoot());\n+    });\n+  }\n+\n+  @Subscribe\n+  public void onChatMessage(ChatMessageEvent event) {\n+    Platform.runLater(() -> {\n+      ChatMessage message = event.getMessage();\n+      if (message.getSource().equals(matchmakingChatController.getReceiver())) {\n+        matchmakingChatController.onChatMessage(message);\n+      }\n+    });\n+  }\n+\n+  private synchronized void renderQueues() {", "originalCommit": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc5MTQ2MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549791461", "bodyText": "That is leftover from my attempts to fix a bug with concurrent access to the queue list. Using the synchronized list should fix it. I'll delete it", "author": "BlackYps", "createdAt": "2020-12-29T17:43:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2MzAzNg=="}], "type": "inlineReview", "revised_code": {"commit": "44cbd2c344ab20ed407c72e43b129e48a828f368", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 127b337c3..fbafe9947 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -252,7 +252,6 @@ public class TeamMatchmakingController extends AbstractViewController<Node> {\n   }\n \n   public void onFactionButtonClicked(ActionEvent actionEvent) {\n-\n     if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n       selectFactionsBasedOnParty();\n       return;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2Mzc2Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549763762", "bodyText": "Since there might be a lot of messages received here. Only execute this very line on the UI  Thread no need to switch to the UI thread to check if the message is releavnt => 99% less execution on the UI thread for this action", "author": "1-alex98", "createdAt": "2020-12-29T16:17:49Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,325 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static com.faforever.client.chat.ChatService.PARTY_CHANNEL_SUFFIX;\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> renderPartyMembers());\n+    if (teamMatchmakingService.isQueuesReadyForUpdate()) {\n+      renderQueues(); // The teamMatchmakingService may already have all queues collected\n+    }                 // so we won't get any updates on the following change listener\n+    teamMatchmakingService.queuesReadyForUpdateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        renderQueues();\n+      }\n+    });\n+\n+    player.statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue != PlayerStatus.IDLE) {\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      } else {\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      }\n+    });\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(\"#\" + newValue.getUsername() + PARTY_CHANNEL_SUFFIX);\n+    });\n+    createChannelTab(\"#\" + teamMatchmakingService.getParty().getOwner().getUsername() + PARTY_CHANNEL_SUFFIX);\n+\n+    fafService.requestMatchmakerInfo();\n+  }\n+\n+  private void initializeDynamicChatPosition() {\n+    contentPane.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue < 1115.0) {\n+        GridPane.setColumnIndex(chatTabPane, 0);\n+        GridPane.setRowIndex(chatTabPane, 1);\n+        GridPane.setColumnSpan(chatTabPane, 2);\n+        GridPane.setColumnSpan(scrollPane, 2);\n+        column2.setMinWidth(0);\n+        row2.setMinHeight(200);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, true);\n+      } else {\n+        GridPane.setColumnIndex(chatTabPane, 1);\n+        GridPane.setRowIndex(chatTabPane, 0);\n+        GridPane.setColumnSpan(chatTabPane, 1);\n+        GridPane.setColumnSpan(scrollPane, 1);\n+        column2.setMinWidth(400);\n+        row2.setMinHeight(0);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, false);\n+      }\n+    });\n+  }\n+\n+  private void initializeUppercaseText() {\n+    matchmakerHeadingLabel.setText(i18n.get(\"teammatchmaking.playerTitle\").toUpperCase());\n+    partyHeadingLabel.setText(i18n.get(\"teammatchmaking.partyTitle\").toUpperCase());\n+    invitePlayerButton.setText(i18n.get(\"teammatchmaking.invitePlayer\").toUpperCase());\n+    leavePartyButton.setText(i18n.get(\"teammatchmaking.leaveParty\").toUpperCase());\n+\n+    leagueLabel.textProperty().bind(createStringBinding(() -> i18n.get(\"leaderboard.divisionName\").toUpperCase(),\n+        player.globalRatingMeanProperty())); // This should actually be a divisionProperty once that is available\n+    gameCountLabel.textProperty().bind(createStringBinding(() ->\n+        i18n.get(\"teammatchmaking.gameCount\", player.getNumberOfGames()).toUpperCase(), player.numberOfGamesProperty()));\n+    queueHeadingLabel.textProperty().bind(createStringBinding(() -> {\n+      if (teamMatchmakingService.isCurrentlyInQueue())\n+        return i18n.get(\"teammatchmaking.queueTitle.inQueue\").toUpperCase();\n+      else if (!teamMatchmakingService.getParty().getOwner().equals(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inParty\").toUpperCase();\n+      else if (teamMatchmakingService.getPlayersInGame().contains(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inGame\").toUpperCase();\n+      else if (!teamMatchmakingService.getPlayersInGame().isEmpty())\n+        return i18n.get(\"teammatchmaking.queueTitle.memberInGame\").toUpperCase();\n+      else\n+        return i18n.get(\"teammatchmaking.queueTitle\").toUpperCase();\n+    },  teamMatchmakingService.currentlyInQueueProperty(),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        teamMatchmakingService.getPlayersInGame()));\n+  }\n+\n+  private void initializeBindings() {\n+    countryImageView.imageProperty().bind(createObjectBinding(() ->\n+        countryFlagService.loadCountryFlag(player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    JavaFxUtil.bindManagedToVisible(clanLabel, avatarImageView);\n+\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() ->\n+        Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    crownLabel.visibleProperty().bind(createBooleanBinding(() ->\n+            teamMatchmakingService.getParty().getMembers().size() > 1 && teamMatchmakingService.getParty().getOwner().equals(player),\n+        teamMatchmakingService.getParty().ownerProperty(), teamMatchmakingService.getParty().getMembers()));\n+\n+    invitePlayerButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getOwner().getId() != playerService.getCurrentPlayer().map(Player::getId).orElse(-1),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        playerService.currentPlayerProperty()\n+    ));\n+    leavePartyButton.disableProperty().bind(createBooleanBinding(() -> teamMatchmakingService.getParty().getMembers().size() <= 1, teamMatchmakingService.getParty().getMembers()));\n+  }\n+\n+  private void renderPartyMembers() {\n+    playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+        (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+    List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+    partyMemberPane.getChildren().clear();\n+    members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+    for(int i = 0; i < members.size(); i++) {\n+      PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+      controller.setMember(members.get(i));\n+      if (members.size() == 1) {\n+        partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+      } else {\n+        partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return teamMatchmakingRoot;\n+  }\n+\n+  public void onInvitePlayerButtonClicked(ActionEvent actionEvent) {\n+    InvitePlayerController invitePlayerController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_invite_player.fxml\");\n+    Pane root = invitePlayerController.getRoot();\n+    uiService.showInDialog(teamMatchmakingRoot, root, i18n.get(\"teammatchmaking.invitePlayer\"));\n+  }\n+\n+  public void onLeavePartyButtonClicked(ActionEvent actionEvent) {\n+    teamMatchmakingService.leaveParty();\n+  }\n+\n+  public void onFactionButtonClicked(ActionEvent actionEvent) {\n+\n+    if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n+      selectFactionsBasedOnParty();\n+      return;\n+    }\n+\n+    List<Faction> factions = new ArrayList<>();\n+    if (uefButton.isSelected()) {\n+      factions.add(Faction.UEF);\n+    }\n+    if (aeonButton.isSelected()) {\n+      factions.add(Faction.AEON);\n+    }\n+    if (cybranButton.isSelected()) {\n+      factions.add(Faction.CYBRAN);\n+    }\n+    if (seraphimButton.isSelected()) {\n+      factions.add(Faction.SERAPHIM);\n+    }\n+\n+    teamMatchmakingService.sendFactionSelection(factions);\n+\n+    refreshingLabel.setVisible(true);\n+  }\n+\n+  private void selectFactionsBasedOnParty() {\n+    uefButton.setSelected(isFactionSelectedInParty(Faction.UEF));\n+    aeonButton.setSelected(isFactionSelectedInParty(Faction.AEON));\n+    cybranButton.setSelected(isFactionSelectedInParty(Faction.CYBRAN));\n+    seraphimButton.setSelected(isFactionSelectedInParty(Faction.SERAPHIM));\n+  }\n+\n+  private boolean isFactionSelectedInParty(Faction faction) {\n+    return teamMatchmakingService.getParty().getMembers().stream()\n+        .anyMatch(m -> m.getPlayer().getId() == player.getId() && m.getFactions().contains(faction));\n+  }\n+\n+  private void createChannelTab(String channelName) {\n+    matchmakingChatController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_chat.fxml\");\n+    matchmakingChatController.setChannel(channelName);\n+    Platform.runLater(() -> {\n+      chatTabPane.getTabs().clear();\n+      chatTabPane.getTabs().add(matchmakingChatController.getRoot());\n+    });\n+  }\n+\n+  @Subscribe\n+  public void onChatMessage(ChatMessageEvent event) {\n+    Platform.runLater(() -> {\n+      ChatMessage message = event.getMessage();\n+      if (message.getSource().equals(matchmakingChatController.getReceiver())) {\n+        matchmakingChatController.onChatMessage(message);", "originalCommit": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "44cbd2c344ab20ed407c72e43b129e48a828f368", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 127b337c3..fbafe9947 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -252,7 +252,6 @@ public class TeamMatchmakingController extends AbstractViewController<Node> {\n   }\n \n   public void onFactionButtonClicked(ActionEvent actionEvent) {\n-\n     if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n       selectFactionsBasedOnParty();\n       return;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2Mzk5NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549763994", "bodyText": "remove new line", "author": "1-alex98", "createdAt": "2020-12-29T16:18:28Z", "path": "src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java", "diffHunk": "@@ -0,0 +1,325 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.ChatMessage;\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.MatchmakingChatController;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.chat.event.ChatMessageEvent;\n+import com.faforever.client.fx.AbstractViewController;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.remote.FafService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.google.common.base.Strings;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+import javafx.application.Platform;\n+import javafx.beans.InvalidationListener;\n+import javafx.beans.Observable;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TabPane;\n+import javafx.scene.control.ToggleButton;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.layout.ColumnConstraints;\n+import javafx.scene.layout.GridPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Pane;\n+import javafx.scene.layout.RowConstraints;\n+import javafx.scene.layout.StackPane;\n+import javafx.scene.layout.VBox;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.jetbrains.annotations.VisibleForTesting;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+\n+import static com.faforever.client.chat.ChatService.PARTY_CHANNEL_SUFFIX;\n+import static javafx.beans.binding.Bindings.createBooleanBinding;\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@RequiredArgsConstructor\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@Slf4j\n+public class TeamMatchmakingController extends AbstractViewController<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass CHAT_AT_BOTTOM_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"bottom\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final I18n i18n;\n+  private final UiService uiService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final FafService fafService;\n+  private final EventBus eventBus;\n+\n+  public StackPane teamMatchmakingRoot;\n+  public Button invitePlayerButton;\n+  public Button leavePartyButton;\n+  public Label refreshingLabel;\n+  public ToggleButton uefButton;\n+  public ToggleButton cybranButton;\n+  public ToggleButton aeonButton;\n+  public ToggleButton seraphimButton;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label gameCountLabel;\n+  public Label leagueLabel;\n+  public HBox queueBox;\n+  public GridPane partyMemberPane;\n+  public VBox preparationArea;\n+  public ImageView leagueImageView;\n+  public Label matchmakerHeadingLabel;\n+  public Label partyHeadingLabel;\n+  public Label queueHeadingLabel;\n+  public ScrollPane scrollPane;\n+  public HBox playerCard;\n+  public Label crownLabel;\n+  public TabPane chatTabPane;\n+  public GridPane contentPane;\n+  public ColumnConstraints column2;\n+  public RowConstraints row2;\n+  private Player player;\n+  @VisibleForTesting\n+  protected MatchmakingChatController matchmakingChatController;\n+\n+  @Override\n+  public void initialize() {\n+    eventBus.register(this);\n+    JavaFxUtil.fixScrollSpeed(scrollPane);\n+    initializeDynamicChatPosition();\n+    player = playerService.getCurrentPlayer().get();\n+    initializeUppercaseText();\n+    initializeBindings();\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((Observable o) -> renderPartyMembers());\n+    if (teamMatchmakingService.isQueuesReadyForUpdate()) {\n+      renderQueues(); // The teamMatchmakingService may already have all queues collected\n+    }                 // so we won't get any updates on the following change listener\n+    teamMatchmakingService.queuesReadyForUpdateProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue) {\n+        renderQueues();\n+      }\n+    });\n+\n+    player.statusProperty().addListener((observable, oldValue, newValue) -> {\n+      if (newValue != PlayerStatus.IDLE) {\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      } else {\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      }\n+    });\n+\n+    teamMatchmakingService.getParty().getMembers().addListener((InvalidationListener) c -> {\n+      refreshingLabel.setVisible(false);\n+      selectFactionsBasedOnParty();\n+    });\n+\n+    JavaFxUtil.addListener(teamMatchmakingService.getParty().ownerProperty(), (observable, oldValue, newValue) -> {\n+      if (matchmakingChatController != null) {\n+        matchmakingChatController.closeChannel();\n+      }\n+      createChannelTab(\"#\" + newValue.getUsername() + PARTY_CHANNEL_SUFFIX);\n+    });\n+    createChannelTab(\"#\" + teamMatchmakingService.getParty().getOwner().getUsername() + PARTY_CHANNEL_SUFFIX);\n+\n+    fafService.requestMatchmakerInfo();\n+  }\n+\n+  private void initializeDynamicChatPosition() {\n+    contentPane.widthProperty().addListener((observable, oldValue, newValue) -> {\n+      if ((double) newValue < 1115.0) {\n+        GridPane.setColumnIndex(chatTabPane, 0);\n+        GridPane.setRowIndex(chatTabPane, 1);\n+        GridPane.setColumnSpan(chatTabPane, 2);\n+        GridPane.setColumnSpan(scrollPane, 2);\n+        column2.setMinWidth(0);\n+        row2.setMinHeight(200);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, true);\n+      } else {\n+        GridPane.setColumnIndex(chatTabPane, 1);\n+        GridPane.setRowIndex(chatTabPane, 0);\n+        GridPane.setColumnSpan(chatTabPane, 1);\n+        GridPane.setColumnSpan(scrollPane, 1);\n+        column2.setMinWidth(400);\n+        row2.setMinHeight(0);\n+        chatTabPane.pseudoClassStateChanged(CHAT_AT_BOTTOM_PSEUDO_CLASS, false);\n+      }\n+    });\n+  }\n+\n+  private void initializeUppercaseText() {\n+    matchmakerHeadingLabel.setText(i18n.get(\"teammatchmaking.playerTitle\").toUpperCase());\n+    partyHeadingLabel.setText(i18n.get(\"teammatchmaking.partyTitle\").toUpperCase());\n+    invitePlayerButton.setText(i18n.get(\"teammatchmaking.invitePlayer\").toUpperCase());\n+    leavePartyButton.setText(i18n.get(\"teammatchmaking.leaveParty\").toUpperCase());\n+\n+    leagueLabel.textProperty().bind(createStringBinding(() -> i18n.get(\"leaderboard.divisionName\").toUpperCase(),\n+        player.globalRatingMeanProperty())); // This should actually be a divisionProperty once that is available\n+    gameCountLabel.textProperty().bind(createStringBinding(() ->\n+        i18n.get(\"teammatchmaking.gameCount\", player.getNumberOfGames()).toUpperCase(), player.numberOfGamesProperty()));\n+    queueHeadingLabel.textProperty().bind(createStringBinding(() -> {\n+      if (teamMatchmakingService.isCurrentlyInQueue())\n+        return i18n.get(\"teammatchmaking.queueTitle.inQueue\").toUpperCase();\n+      else if (!teamMatchmakingService.getParty().getOwner().equals(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inParty\").toUpperCase();\n+      else if (teamMatchmakingService.getPlayersInGame().contains(player))\n+        return i18n.get(\"teammatchmaking.queueTitle.inGame\").toUpperCase();\n+      else if (!teamMatchmakingService.getPlayersInGame().isEmpty())\n+        return i18n.get(\"teammatchmaking.queueTitle.memberInGame\").toUpperCase();\n+      else\n+        return i18n.get(\"teammatchmaking.queueTitle\").toUpperCase();\n+    },  teamMatchmakingService.currentlyInQueueProperty(),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        teamMatchmakingService.getPlayersInGame()));\n+  }\n+\n+  private void initializeBindings() {\n+    countryImageView.imageProperty().bind(createObjectBinding(() ->\n+        countryFlagService.loadCountryFlag(player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    JavaFxUtil.bindManagedToVisible(clanLabel, avatarImageView);\n+\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() ->\n+        Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    crownLabel.visibleProperty().bind(createBooleanBinding(() ->\n+            teamMatchmakingService.getParty().getMembers().size() > 1 && teamMatchmakingService.getParty().getOwner().equals(player),\n+        teamMatchmakingService.getParty().ownerProperty(), teamMatchmakingService.getParty().getMembers()));\n+\n+    invitePlayerButton.disableProperty().bind(createBooleanBinding(\n+        () -> teamMatchmakingService.getParty().getOwner().getId() != playerService.getCurrentPlayer().map(Player::getId).orElse(-1),\n+        teamMatchmakingService.getParty().ownerProperty(),\n+        playerService.currentPlayerProperty()\n+    ));\n+    leavePartyButton.disableProperty().bind(createBooleanBinding(() -> teamMatchmakingService.getParty().getMembers().size() <= 1, teamMatchmakingService.getParty().getMembers()));\n+  }\n+\n+  private void renderPartyMembers() {\n+    playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS,\n+        (teamMatchmakingService.getParty().getOwner().equals(player) && teamMatchmakingService.getParty().getMembers().size() > 1));\n+    List<PartyMember> members = new ArrayList<>(teamMatchmakingService.getParty().getMembers());\n+    partyMemberPane.getChildren().clear();\n+    members.removeIf(partyMember -> partyMember.getPlayer().equals(player));\n+    for(int i = 0; i < members.size(); i++) {\n+      PartyMemberItemController controller = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_member_card.fxml\");\n+      controller.setMember(members.get(i));\n+      if (members.size() == 1) {\n+        partyMemberPane.add(controller.getRoot(), 0, 0, 2, 1);\n+      } else {\n+        partyMemberPane.add(controller.getRoot(), i % 2, i / 2);\n+      }\n+    }\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return teamMatchmakingRoot;\n+  }\n+\n+  public void onInvitePlayerButtonClicked(ActionEvent actionEvent) {\n+    InvitePlayerController invitePlayerController = uiService.loadFxml(\"theme/play/teammatchmaking/matchmaking_invite_player.fxml\");\n+    Pane root = invitePlayerController.getRoot();\n+    uiService.showInDialog(teamMatchmakingRoot, root, i18n.get(\"teammatchmaking.invitePlayer\"));\n+  }\n+\n+  public void onLeavePartyButtonClicked(ActionEvent actionEvent) {\n+    teamMatchmakingService.leaveParty();\n+  }\n+\n+  public void onFactionButtonClicked(ActionEvent actionEvent) {\n+", "originalCommit": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "44cbd2c344ab20ed407c72e43b129e48a828f368", "chunk": "diff --git a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\nindex 127b337c3..fbafe9947 100644\n--- a/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n+++ b/src/main/java/com/faforever/client/teammatchmaking/TeamMatchmakingController.java\n\n@@ -252,7 +252,6 @@ public class TeamMatchmakingController extends AbstractViewController<Node> {\n   }\n \n   public void onFactionButtonClicked(ActionEvent actionEvent) {\n-\n     if (!uefButton.isSelected() && !aeonButton.isSelected() && !cybranButton.isSelected() && !seraphimButton.isSelected()) {\n       selectFactionsBasedOnParty();\n       return;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2NDY4OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549764688", "bodyText": "Create an issue and reference it", "author": "1-alex98", "createdAt": "2020-12-29T16:20:29Z", "path": "src/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java", "diffHunk": "@@ -0,0 +1,166 @@\n+package com.faforever.client.teammatchmaking;\n+\n+import com.faforever.client.chat.CountryFlagService;\n+import com.faforever.client.chat.avatar.AvatarService;\n+import com.faforever.client.fx.Controller;\n+import com.faforever.client.fx.JavaFxUtil;\n+import com.faforever.client.game.Faction;\n+import com.faforever.client.game.PlayerStatus;\n+import com.faforever.client.i18n.I18n;\n+import com.faforever.client.player.Player;\n+import com.faforever.client.player.PlayerService;\n+import com.faforever.client.teammatchmaking.Party.PartyMember;\n+import com.faforever.client.theme.UiService;\n+import com.faforever.client.util.RatingUtil;\n+import com.google.common.base.Strings;\n+import javafx.application.Platform;\n+import javafx.beans.binding.BooleanBinding;\n+import javafx.beans.value.WeakChangeListener;\n+import javafx.css.PseudoClass;\n+import javafx.event.ActionEvent;\n+import javafx.scene.Node;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.image.ImageView;\n+import javafx.scene.input.ContextMenuEvent;\n+import javafx.scene.layout.HBox;\n+import lombok.RequiredArgsConstructor;\n+import org.springframework.beans.factory.config.ConfigurableBeanFactory;\n+import org.springframework.context.annotation.Scope;\n+import org.springframework.stereotype.Component;\n+\n+import java.lang.ref.WeakReference;\n+\n+import static javafx.beans.binding.Bindings.createObjectBinding;\n+import static javafx.beans.binding.Bindings.createStringBinding;\n+\n+@Component\n+@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)\n+@RequiredArgsConstructor\n+public class PartyMemberItemController implements Controller<Node> {\n+\n+  private static final PseudoClass LEADER_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"leader\");\n+  private static final PseudoClass PLAYING_PSEUDO_CLASS = PseudoClass.getPseudoClass(\"playing\");\n+\n+  private final CountryFlagService countryFlagService;\n+  private final AvatarService avatarService;\n+  private final PlayerService playerService;\n+  private final TeamMatchmakingService teamMatchmakingService;\n+  private final UiService uiService;\n+  private final I18n i18n;\n+\n+  public Node playerItemRoot;\n+  public ImageView avatarImageView;\n+  public ImageView countryImageView;\n+  public ImageView leagueImageView;\n+  public Button kickPlayerButton;\n+  public Label clanLabel;\n+  public Label usernameLabel;\n+  public Label leagueLabel;\n+  public Label gameCountLabel;\n+  public Label uefLabel;\n+  public Label cybranLabel;\n+  public Label aeonLabel;\n+  public Label seraphimLabel;\n+  public Label crownLabel;\n+  public HBox playerCard;\n+  public ImageView playerStatusImageView;\n+\n+  private Player player;\n+  private WeakReference<PartyMemberContextMenuController> contextMenuController = null;\n+\n+  @Override\n+  public void initialize() {\n+    clanLabel.managedProperty().bind(clanLabel.visibleProperty());\n+  }\n+\n+  @Override\n+  public Node getRoot() {\n+    return playerItemRoot;\n+  }\n+\n+  public void setMember(PartyMember member) {\n+    this.player = member.getPlayer();\n+\n+    initializeBindings();\n+    playerCard.pseudoClassStateChanged(LEADER_PSEUDO_CLASS, teamMatchmakingService.getParty().getOwner().equals(player));\n+\n+    playerStatusImageView.setImage(uiService.getThemeImage(UiService.CHAT_LIST_STATUS_PLAYING));\n+    player.statusProperty().addListener(new WeakChangeListener<>((observable, oldValue, newValue) -> markMemberBusy(newValue)));\n+    markMemberBusy(player.statusProperty().get());\n+\n+    selectFactionsBasedOnParty();\n+  }\n+\n+  private void markMemberBusy(PlayerStatus status) {\n+    if (status != PlayerStatus.IDLE) {\n+      Platform.runLater(() -> {\n+        playerStatusImageView.setVisible(true);\n+        playerCard.pseudoClassStateChanged(PLAYING_PSEUDO_CLASS, true);\n+        teamMatchmakingService.getPlayersInGame().add(player);\n+      });\n+    } else {\n+      Platform.runLater(() -> {\n+        playerStatusImageView.setVisible(false);\n+        playerCard.pseudoClassStateChanged(PLAYING_PSEUDO_CLASS, false);\n+        teamMatchmakingService.getPlayersInGame().remove(player);\n+      });\n+    }\n+  }\n+\n+  private void initializeBindings() {\n+    countryImageView.imageProperty().bind(createObjectBinding(() ->\n+        countryFlagService.loadCountryFlag(player.getCountry()).orElse(null), player.countryProperty()));\n+    avatarImageView.visibleProperty().bind(player.avatarUrlProperty().isNotNull().and(player.avatarUrlProperty().isNotEmpty()));\n+    avatarImageView.imageProperty().bind(createObjectBinding(() -> Strings.isNullOrEmpty(player.getAvatarUrl()) ? null : avatarService.loadAvatar(player.getAvatarUrl()), player.avatarUrlProperty()));\n+    leagueImageView.setManaged(false);\n+    JavaFxUtil.bindManagedToVisible(clanLabel, avatarImageView, playerStatusImageView);\n+\n+    clanLabel.visibleProperty().bind(player.clanProperty().isNotEmpty().and(player.clanProperty().isNotNull()));\n+    clanLabel.textProperty().bind(createStringBinding(() -> Strings.isNullOrEmpty(player.getClan()) ? \"\" : String.format(\"[%s]\", player.getClan()), player.clanProperty()));\n+    usernameLabel.textProperty().bind(player.usernameProperty());\n+    leagueLabel.textProperty().bind(createStringBinding(\n+        () -> i18n.get(\"leaderboard.divisionName\", RatingUtil.getLeaderboardRating(player)).toUpperCase(),\n+        player.globalRatingMeanProperty())); // TODO: replace this with divisionproperty once it is available", "originalCommit": "6b73bd3a2def2bce452cc87f4eb3fb4dccde1504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc5NTgzNg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/2059#discussion_r549795836", "bodyText": "The leagueservice has already been merged into faf stack. I think it is just a matter of time for deployment now. Or maybe there needs to be extra work done to create the api endpoints. I am not sure.", "author": "BlackYps", "createdAt": "2020-12-29T17:57:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc2NDY4OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "44cbd2c344ab20ed407c72e43b129e48a828f368", "url": "https://github.com/FAForever/downlords-faf-client/commit/44cbd2c344ab20ed407c72e43b129e48a828f368", "message": "Code cleanup", "committedDate": "2020-12-30T13:43:13Z", "type": "commit"}, {"oid": "2aeaeaa018276a4cc0ab98a66b932007c4f62de1", "url": "https://github.com/FAForever/downlords-faf-client/commit/2aeaeaa018276a4cc0ab98a66b932007c4f62de1", "message": "Delete leftover message", "committedDate": "2020-12-30T21:53:42Z", "type": "commit"}, {"oid": "61867f41510a108db36f7e449ef960aaa6cabf18", "url": "https://github.com/FAForever/downlords-faf-client/commit/61867f41510a108db36f7e449ef960aaa6cabf18", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "c48e14ac3dcdf670bb65381adf252885adacc2c7", "url": "https://github.com/FAForever/downlords-faf-client/commit/c48e14ac3dcdf670bb65381adf252885adacc2c7", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "17357f52afc7dc315d84eea536ee8c8433f88b61", "url": "https://github.com/FAForever/downlords-faf-client/commit/17357f52afc7dc315d84eea536ee8c8433f88b61", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "e7d29568cbd60339c4c1277362b9ceaf067d01c9", "url": "https://github.com/FAForever/downlords-faf-client/commit/e7d29568cbd60339c4c1277362b9ceaf067d01c9", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "66cc15ed79e9e22ba47a30369dbad120c369837f", "url": "https://github.com/FAForever/downlords-faf-client/commit/66cc15ed79e9e22ba47a30369dbad120c369837f", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "52f5f1e95f06d5e98894d6b4fccc2b9d1810161c", "url": "https://github.com/FAForever/downlords-faf-client/commit/52f5f1e95f06d5e98894d6b4fccc2b9d1810161c", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "907e22c5aeb515dc1a6bd7d640b847d1f79c2b7a", "url": "https://github.com/FAForever/downlords-faf-client/commit/907e22c5aeb515dc1a6bd7d640b847d1f79c2b7a", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "7b28e0df51e74afc6af10801e1ade9a2b7e8fb49", "url": "https://github.com/FAForever/downlords-faf-client/commit/7b28e0df51e74afc6af10801e1ade9a2b7e8fb49", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "0fd85819a3377dbff56b2236d8de875948dd9a61", "url": "https://github.com/FAForever/downlords-faf-client/commit/0fd85819a3377dbff56b2236d8de875948dd9a61", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "f58a5dd717b6339c54ae831ca17e8d34d3c03726", "url": "https://github.com/FAForever/downlords-faf-client/commit/f58a5dd717b6339c54ae831ca17e8d34d3c03726", "message": "team matchmaking WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "e964573811f1b05a013b9aa956eb4764bdbe7cd3", "url": "https://github.com/FAForever/downlords-faf-client/commit/e964573811f1b05a013b9aa956eb4764bdbe7cd3", "message": "party ready system", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "6818fb4069f850c9834442938b59b0a72d1d26fd", "url": "https://github.com/FAForever/downlords-faf-client/commit/6818fb4069f850c9834442938b59b0a72d1d26fd", "message": "party structure rework, factions WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "7081bde3cc70d046f1da292df70dd09de570a646", "url": "https://github.com/FAForever/downlords-faf-client/commit/7081bde3cc70d046f1da292df70dd09de570a646", "message": "party factions UI, UI restructure", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "0da93f46dd019d56aed12354a61764c58c6eca9a", "url": "https://github.com/FAForever/downlords-faf-client/commit/0da93f46dd019d56aed12354a61764c58c6eca9a", "message": "party system WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "470a5653f8471fe245601c29709007761b2d52e9", "url": "https://github.com/FAForever/downlords-faf-client/commit/470a5653f8471fe245601c29709007761b2d52e9", "message": "party system FACTIONS WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "4ec75df643767fe5bb71afc3faacceb4e1bf27e8", "url": "https://github.com/FAForever/downlords-faf-client/commit/4ec75df643767fe5bb71afc3faacceb4e1bf27e8", "message": "party system factions", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "f772b8c5308c7b2ab7252445315b86d45d918869", "url": "https://github.com/FAForever/downlords-faf-client/commit/f772b8c5308c7b2ab7252445315b86d45d918869", "message": "do not show faction buttons on disable", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "d7f4f7325ddf05a0ec1d6cc90f9799a8df5ed2ae", "url": "https://github.com/FAForever/downlords-faf-client/commit/d7f4f7325ddf05a0ec1d6cc90f9799a8df5ed2ae", "message": "Clean up and Exception fixes", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "2f88f4c60c32dad14bc773b7fab48857d22b9a22", "url": "https://github.com/FAForever/downlords-faf-client/commit/2f88f4c60c32dad14bc773b7fab48857d22b9a22", "message": "WIP", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "a214cbdfa20c6d2399a436ec5f36978f07b5ff19", "url": "https://github.com/FAForever/downlords-faf-client/commit/a214cbdfa20c6d2399a436ec5f36978f07b5ff19", "message": "add context menu to party", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "37bddf609453806fbefadb89e16da22a50054628", "url": "https://github.com/FAForever/downlords-faf-client/commit/37bddf609453806fbefadb89e16da22a50054628", "message": "player card ui", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "f067be152e3392a2efeb03de60d4ffc9b3e34a01", "url": "https://github.com/FAForever/downlords-faf-client/commit/f067be152e3392a2efeb03de60d4ffc9b3e34a01", "message": "restructure TMM ui", "committedDate": "2020-06-03T21:19:30Z", "type": "commit"}, {"oid": "806d815f06c5999b5dcfa6e1995021a3ce95a308", "url": "https://github.com/FAForever/downlords-faf-client/commit/806d815f06c5999b5dcfa6e1995021a3ce95a308", "message": "TMM queue list display", "committedDate": "2020-06-03T22:48:34Z", "type": "commit"}, {"oid": "d9e096352968ee65d47e15784be4ed9a6a5c39ca", "url": "https://github.com/FAForever/downlords-faf-client/commit/d9e096352968ee65d47e15784be4ed9a6a5c39ca", "message": "tmm queue UI, timer", "committedDate": "2020-06-04T11:29:39Z", "type": "commit"}, {"oid": "94359c2841f2678fd9b29d53db43fe12d11a8d35", "url": "https://github.com/FAForever/downlords-faf-client/commit/94359c2841f2678fd9b29d53db43fe12d11a8d35", "message": "tmm queue - business logic", "committedDate": "2020-06-27T22:46:43Z", "type": "commit"}, {"oid": "da1c07992e59f1c0acbbbb0494dfad0fc989b116", "url": "https://github.com/FAForever/downlords-faf-client/commit/da1c07992e59f1c0acbbbb0494dfad0fc989b116", "message": "ensure game path is valid before sending invite", "committedDate": "2020-07-20T11:34:40Z", "type": "commit"}, {"oid": "fdba3592ec773cb221790054300840178393434e", "url": "https://github.com/FAForever/downlords-faf-client/commit/fdba3592ec773cb221790054300840178393434e", "message": "Integrate new matchmaker ui", "committedDate": "2020-08-11T11:26:21Z", "type": "commit"}, {"oid": "4c960de0fe4306d51341352b30caec9b497f0ad8", "url": "https://github.com/FAForever/downlords-faf-client/commit/4c960de0fe4306d51341352b30caec9b497f0ad8", "message": "Use i18n instead of hardcoded text", "committedDate": "2020-08-11T21:01:56Z", "type": "commit"}, {"oid": "515fb3db9c76635fc77c8f9490252c59695f67fd", "url": "https://github.com/FAForever/downlords-faf-client/commit/515fb3db9c76635fc77c8f9490252c59695f67fd", "message": "Filter player out of party", "committedDate": "2020-08-11T21:30:57Z", "type": "commit"}, {"oid": "f269f7f7b622580b1980d71f5c5a5cd61557f0ce", "url": "https://github.com/FAForever/downlords-faf-client/commit/f269f7f7b622580b1980d71f5c5a5cd61557f0ce", "message": "Refactor country flag loading", "committedDate": "2020-08-20T07:51:08Z", "type": "commit"}, {"oid": "2b568e3639873e84a3d088fc7ea458e22422af40", "url": "https://github.com/FAForever/downlords-faf-client/commit/2b568e3639873e84a3d088fc7ea458e22422af40", "message": "Change ready button to play button", "committedDate": "2020-08-20T19:38:17Z", "type": "commit"}, {"oid": "07d08bcdc1c23f1142a1891ea9c1178976424e29", "url": "https://github.com/FAForever/downlords-faf-client/commit/07d08bcdc1c23f1142a1891ea9c1178976424e29", "message": "hide ready button, disable join queue buttons based on party size and ownership, hide invite player button", "committedDate": "2020-08-23T16:49:26Z", "type": "commit"}, {"oid": "8e62e2a898e4023192672b8f6f3f492d1b03b4b5", "url": "https://github.com/FAForever/downlords-faf-client/commit/8e62e2a898e4023192672b8f6f3f492d1b03b4b5", "message": "fix tests", "committedDate": "2020-08-23T16:56:55Z", "type": "commit"}, {"oid": "7241dd3335c42d0ce8b4b4b066533a85b939419a", "url": "https://github.com/FAForever/downlords-faf-client/commit/7241dd3335c42d0ce8b4b4b066533a85b939419a", "message": "TESTS DISABLED, REVERT!", "committedDate": "2020-08-23T17:07:53Z", "type": "commit"}, {"oid": "99c4d1d0f563d7f67840d1ffcebbb10a6ccacecf", "url": "https://github.com/FAForever/downlords-faf-client/commit/99c4d1d0f563d7f67840d1ffcebbb10a6ccacecf", "message": "WIP remove faction from matchmaker queue join, faction order fix, temporary ugly GameLaunchMessage parsing fix, temporary matchmaker game launch", "committedDate": "2020-08-24T10:00:17Z", "type": "commit"}, {"oid": "57f51d1c358b3c36f8f733aee6974d0b69f125a5", "url": "https://github.com/FAForever/downlords-faf-client/commit/57f51d1c358b3c36f8f733aee6974d0b69f125a5", "message": "switch faction buttons, fix flag on faction select, force faction selection", "committedDate": "2020-08-24T11:01:28Z", "type": "commit"}, {"oid": "debad00bc0e54c28c848129257ba2965f0721dba", "url": "https://github.com/FAForever/downlords-faf-client/commit/debad00bc0e54c28c848129257ba2965f0721dba", "message": "tmm - display matching status", "committedDate": "2020-08-24T12:20:36Z", "type": "commit"}, {"oid": "efb81171aa7f80372ac61749074e3b4a9ccc7995", "url": "https://github.com/FAForever/downlords-faf-client/commit/efb81171aa7f80372ac61749074e3b4a9ccc7995", "message": "i18n queue name", "committedDate": "2020-09-06T10:37:25Z", "type": "commit"}, {"oid": "39b9c92012f764196275200b7c6b803ae2875e48", "url": "https://github.com/FAForever/downlords-faf-client/commit/39b9c92012f764196275200b7c6b803ae2875e48", "message": "matchmaking - use faction ids instead of boolean array", "committedDate": "2020-09-06T11:03:31Z", "type": "commit"}, {"oid": "5ff6a29c95ac2c03f2d494920e8d2be73d162b36", "url": "https://github.com/FAForever/downlords-faf-client/commit/5ff6a29c95ac2c03f2d494920e8d2be73d162b36", "message": "notify and block party invite / join when in queue", "committedDate": "2020-09-06T11:21:01Z", "type": "commit"}, {"oid": "17296248dd8b6f3a8db144ad21e5bc4cefede375", "url": "https://github.com/FAForever/downlords-faf-client/commit/17296248dd8b6f3a8db144ad21e5bc4cefede375", "message": "sanity checks, game launch cleanup", "committedDate": "2020-09-06T11:48:45Z", "type": "commit"}, {"oid": "aa2ef7991287a5ea8bc3af6f4c008ad106a47877", "url": "https://github.com/FAForever/downlords-faf-client/commit/aa2ef7991287a5ea8bc3af6f4c008ad106a47877", "message": "Uppercase now controlled by styleclass to enable override by themes", "committedDate": "2020-09-14T20:52:05Z", "type": "commit"}, {"oid": "025c079e23af590c6cc5bc2efa861ce1d9bed5e6", "url": "https://github.com/FAForever/downlords-faf-client/commit/025c079e23af590c6cc5bc2efa861ce1d9bed5e6", "message": "Delete obsolete play button", "committedDate": "2020-09-14T21:09:49Z", "type": "commit"}, {"oid": "5bafdd3ad1297c83496c7ca0abf75517aa8e8858", "url": "https://github.com/FAForever/downlords-faf-client/commit/5bafdd3ad1297c83496c7ca0abf75517aa8e8858", "message": "Enable resizing of the UI", "committedDate": "2020-09-14T21:27:10Z", "type": "commit"}, {"oid": "9095afa78644b12a7d4b6944d9cbeed51dc142a3", "url": "https://github.com/FAForever/downlords-faf-client/commit/9095afa78644b12a7d4b6944d9cbeed51dc142a3", "message": "Add new heading for queue area", "committedDate": "2020-09-14T21:37:13Z", "type": "commit"}, {"oid": "16f097866d6212844750291dbd0ce8bd62e9aa7d", "url": "https://github.com/FAForever/downlords-faf-client/commit/16f097866d6212844750291dbd0ce8bd62e9aa7d", "message": "Fix some bugs", "committedDate": "2020-09-15T08:41:13Z", "type": "commit"}, {"oid": "d46a7d81f8186b86bdc8c441b1df95b39def2be4", "url": "https://github.com/FAForever/downlords-faf-client/commit/d46a7d81f8186b86bdc8c441b1df95b39def2be4", "message": "Restyle queue cards", "committedDate": "2020-09-16T11:41:42Z", "type": "commit"}, {"oid": "b3358fc5f331eac0f611754a97985e3d4cd9300b", "url": "https://github.com/FAForever/downlords-faf-client/commit/b3358fc5f331eac0f611754a97985e3d4cd9300b", "message": "Implement queue name lookup and shortening", "committedDate": "2020-09-16T19:33:55Z", "type": "commit"}, {"oid": "bdcda34f4138e621619798380583f670d4b6c977", "url": "https://github.com/FAForever/downlords-faf-client/commit/bdcda34f4138e621619798380583f670d4b6c977", "message": "Replace rating labels with league icon + label", "committedDate": "2020-09-22T11:11:58Z", "type": "commit"}, {"oid": "6c86a3515238234eeee8a925122692310336ff8f", "url": "https://github.com/FAForever/downlords-faf-client/commit/6c86a3515238234eeee8a925122692310336ff8f", "message": "Layout changes and playercard grows properly", "committedDate": "2020-10-01T17:28:09Z", "type": "commit"}, {"oid": "202c6e6bbb2d65f844bab8d76b71bf6a368763c8", "url": "https://github.com/FAForever/downlords-faf-client/commit/202c6e6bbb2d65f844bab8d76b71bf6a368763c8", "message": "Use proper string formatting", "committedDate": "2020-10-01T22:20:03Z", "type": "commit"}, {"oid": "b79ddae4528000a3bc2940be5c78cc2481b3010b", "url": "https://github.com/FAForever/downlords-faf-client/commit/b79ddae4528000a3bc2940be5c78cc2481b3010b", "message": "Add matching status labels", "committedDate": "2020-10-01T22:38:27Z", "type": "commit"}, {"oid": "157b65757c99f782f8258e3abbded272e2731c3e", "url": "https://github.com/FAForever/downlords-faf-client/commit/157b65757c99f782f8258e3abbded272e2731c3e", "message": "Merge branch 'feature/team-matchmaking' into feature/new-tmm-ui\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/teammatchmaking/MatchmakingQueueItemController.java\n#\tsrc/main/java/com/faforever/client/teammatchmaking/PartyMemberItemController.java\n#\tsrc/main/resources/i18n/messages.properties\n#\tsrc/main/resources/theme/play/team_matchmaking.fxml\n#\tsrc/main/resources/theme/play/teammatchmaking/matchmaking_member_card.fxml\n#\tsrc/main/resources/theme/play/teammatchmaking/matchmaking_queue_card.fxml", "committedDate": "2020-10-01T23:20:57Z", "type": "commit"}, {"oid": "65b6b81e6e648bc55c083eb158e5d0dd4720f72e", "url": "https://github.com/FAForever/downlords-faf-client/commit/65b6b81e6e648bc55c083eb158e5d0dd4720f72e", "message": "Fix merge errors", "committedDate": "2020-10-02T15:02:06Z", "type": "commit"}, {"oid": "cffc66e6cba2f2b8a89c7a0773451a5d88d432f0", "url": "https://github.com/FAForever/downlords-faf-client/commit/cffc66e6cba2f2b8a89c7a0773451a5d88d432f0", "message": "tmm: parse factions as string, fix status indicators for own faction selection", "committedDate": "2020-10-04T11:31:07Z", "type": "commit"}, {"oid": "c99d1e32ac5b0913dc1741de7813b357de8030f5", "url": "https://github.com/FAForever/downlords-faf-client/commit/c99d1e32ac5b0913dc1741de7813b357de8030f5", "message": "fix queue join race condition, set queue joined button state based on server state", "committedDate": "2020-10-04T11:52:43Z", "type": "commit"}, {"oid": "9ea96bb8e2b33731f7bd73bcf2fa439017665911", "url": "https://github.com/FAForever/downlords-faf-client/commit/9ea96bb8e2b33731f7bd73bcf2fa439017665911", "message": "fix faction parsing for game launch message", "committedDate": "2020-10-04T12:19:28Z", "type": "commit"}, {"oid": "6935b4f8981e1f193ccd2da0d9a446a397633555", "url": "https://github.com/FAForever/downlords-faf-client/commit/6935b4f8981e1f193ccd2da0d9a446a397633555", "message": "fix install4j github release url", "committedDate": "2020-10-04T15:12:17Z", "type": "commit"}, {"oid": "03d6558bd115c5560fa808587d8030c1ad590c1d", "url": "https://github.com/FAForever/downlords-faf-client/commit/03d6558bd115c5560fa808587d8030c1ad590c1d", "message": "remove / disable ladder1v1 tests", "committedDate": "2020-10-04T15:17:34Z", "type": "commit"}, {"oid": "5719cae773864a15b9b16419b4528d37fe953e42", "url": "https://github.com/FAForever/downlords-faf-client/commit/5719cae773864a15b9b16419b4528d37fe953e42", "message": "bump install4j version WIP", "committedDate": "2020-10-04T16:02:28Z", "type": "commit"}, {"oid": "54792c6e301c042d8ba184962b29e2537fa1b362", "url": "https://github.com/FAForever/downlords-faf-client/commit/54792c6e301c042d8ba184962b29e2537fa1b362", "message": "unbump install4j version (to 7, use different key)", "committedDate": "2020-10-04T17:03:27Z", "type": "commit"}, {"oid": "9c09d8e3dfea2d6cc8a795f681af16484d7677fb", "url": "https://github.com/FAForever/downlords-faf-client/commit/9c09d8e3dfea2d6cc8a795f681af16484d7677fb", "message": "send own factions to server upon entering queue", "committedDate": "2020-10-04T19:23:40Z", "type": "commit"}, {"oid": "ec2f619e39d36454b9102e07e9490f15a92680a7", "url": "https://github.com/FAForever/downlords-faf-client/commit/ec2f619e39d36454b9102e07e9490f15a92680a7", "message": "select all factions in an empty party", "committedDate": "2020-10-04T19:31:35Z", "type": "commit"}, {"oid": "40b5351b8812af56bf4443337de013675a289019", "url": "https://github.com/FAForever/downlords-faf-client/commit/40b5351b8812af56bf4443337de013675a289019", "message": "Fix empty slot in party member pane", "committedDate": "2020-10-04T21:18:40Z", "type": "commit"}, {"oid": "bdfbc454eae43c391df3b9144f4a8e737fa46467", "url": "https://github.com/FAForever/downlords-faf-client/commit/bdfbc454eae43c391df3b9144f4a8e737fa46467", "message": "Highlight party owner", "committedDate": "2020-10-04T23:28:06Z", "type": "commit"}, {"oid": "7e30329c55de3a3fb84cdeb00364a21b4e85bf7f", "url": "https://github.com/FAForever/downlords-faf-client/commit/7e30329c55de3a3fb84cdeb00364a21b4e85bf7f", "message": "Align kick button to the right", "committedDate": "2020-10-05T11:09:56Z", "type": "commit"}, {"oid": "85d51945a2d42b04a3ff4e7d9717e5cebd28021f", "url": "https://github.com/FAForever/downlords-faf-client/commit/85d51945a2d42b04a3ff4e7d9717e5cebd28021f", "message": "Change queues heading text when player is not the party owner", "committedDate": "2020-10-05T13:20:02Z", "type": "commit"}, {"oid": "b8617d2d562b805fc4d0aa3a91efb05587e1d78d", "url": "https://github.com/FAForever/downlords-faf-client/commit/b8617d2d562b805fc4d0aa3a91efb05587e1d78d", "message": "Show invited players in invite dialog", "committedDate": "2020-10-05T13:20:02Z", "type": "commit"}, {"oid": "f32bb9a23af9727452912ff93926c10bfde75c77", "url": "https://github.com/FAForever/downlords-faf-client/commit/f32bb9a23af9727452912ff93926c10bfde75c77", "message": "Add scrollpane to matchmaker ui", "committedDate": "2020-10-05T20:50:57Z", "type": "commit"}, {"oid": "bfde76af4c7874e0438d09c133124769321792d1", "url": "https://github.com/FAForever/downlords-faf-client/commit/bfde76af4c7874e0438d09c133124769321792d1", "message": "fix disabled queue on startup", "committedDate": "2020-10-11T18:48:05Z", "type": "commit"}, {"oid": "120dfcb35c01812ff2d64eb5c159fce9183f40e5", "url": "https://github.com/FAForever/downlords-faf-client/commit/120dfcb35c01812ff2d64eb5c159fce9183f40e5", "message": "catch game cancel during launch when multiqueueing", "committedDate": "2020-10-11T19:40:25Z", "type": "commit"}, {"oid": "6a219424334ad7cd81480e4230f0a4abf1644932", "url": "https://github.com/FAForever/downlords-faf-client/commit/6a219424334ad7cd81480e4230f0a4abf1644932", "message": "fix already in queue when starting a custom game", "committedDate": "2020-10-11T20:23:41Z", "type": "commit"}, {"oid": "420fa805ec969632d186923559ce6a588b765124", "url": "https://github.com/FAForever/downlords-faf-client/commit/420fa805ec969632d186923559ce6a588b765124", "message": "uncheck queue button when launch failed due to being in game", "committedDate": "2020-10-11T20:35:54Z", "type": "commit"}, {"oid": "c17f47ef825d1948588b11e57b91a0e5091d2202", "url": "https://github.com/FAForever/downlords-faf-client/commit/c17f47ef825d1948588b11e57b91a0e5091d2202", "message": "Add leader highlight for own player", "committedDate": "2020-10-13T09:30:38Z", "type": "commit"}, {"oid": "d690ff8ba0f685e1c57d3ec8709ff6b82e4caf13", "url": "https://github.com/FAForever/downlords-faf-client/commit/d690ff8ba0f685e1c57d3ec8709ff6b82e4caf13", "message": "Move splitPane divider to 0.7", "committedDate": "2020-10-13T09:30:38Z", "type": "commit"}, {"oid": "60226c6db603c66a365feeb068406c4dabf7e490", "url": "https://github.com/FAForever/downlords-faf-client/commit/60226c6db603c66a365feeb068406c4dabf7e490", "message": "Add VCS config", "committedDate": "2020-10-13T09:49:30Z", "type": "commit"}, {"oid": "827ee919f6d889335bea269e0555500d0453cdb5", "url": "https://github.com/FAForever/downlords-faf-client/commit/827ee919f6d889335bea269e0555500d0453cdb5", "message": "Merge branch 'develop' into feature/team-matchmaking\n\n# Conflicts:\n#\tci/github-release.sh\n#\tsrc/main/java/com/faforever/client/game/GameService.java\n#\tsrc/main/java/com/faforever/client/play/PlayController.java\n#\tsrc/main/java/com/faforever/client/remote/domain/GameInfoMessage.java\n#\tsrc/main/resources/font/dfc-icons.ttf\n#\tsrc/main/resources/i18n/messages.properties\n#\tsrc/main/resources/theme/style.css\n#\tsrc/test/java/com/faforever/client/game/GameInfoMessageBuilder.java\n#\tsrc/test/java/com/faforever/client/rankedmatch/Ladder1V1ControllerTest.java", "committedDate": "2020-10-13T10:12:27Z", "type": "commit"}, {"oid": "d41a984f28535e817ddea4f133d1a8d4b64b81d6", "url": "https://github.com/FAForever/downlords-faf-client/commit/d41a984f28535e817ddea4f133d1a8d4b64b81d6", "message": "tmm merge fixes", "committedDate": "2020-10-13T10:49:06Z", "type": "commit"}, {"oid": "9a9bf624d74092ef1dfc732570d665186471a5d7", "url": "https://github.com/FAForever/downlords-faf-client/commit/9a9bf624d74092ef1dfc732570d665186471a5d7", "message": "Adapt icons to new workflow", "committedDate": "2020-10-14T12:14:24Z", "type": "commit"}, {"oid": "3fb27ee02c112a1c64bc9e4ad7a4aa6787ce2210", "url": "https://github.com/FAForever/downlords-faf-client/commit/3fb27ee02c112a1c64bc9e4ad7a4aa6787ce2210", "message": "Load division icon instead of avatar", "committedDate": "2020-10-30T23:02:40Z", "type": "commit"}, {"oid": "a8426a794910522b840e06b09c0a6832e24e1fcb", "url": "https://github.com/FAForever/downlords-faf-client/commit/a8426a794910522b840e06b09c0a6832e24e1fcb", "message": "Add chat functionality WIP", "committedDate": "2020-10-31T17:47:54Z", "type": "commit"}, {"oid": "e126af2e8eff3c030fd9da3b164c1d48d5c3b9b5", "url": "https://github.com/FAForever/downlords-faf-client/commit/e126af2e8eff3c030fd9da3b164c1d48d5c3b9b5", "message": "Spawn new chat tabs only when necessary", "committedDate": "2020-10-31T19:58:00Z", "type": "commit"}, {"oid": "52529ec5b71cbf68d48c39a393502542ba739964", "url": "https://github.com/FAForever/downlords-faf-client/commit/52529ec5b71cbf68d48c39a393502542ba739964", "message": "Add chat functionality", "committedDate": "2020-11-01T11:42:17Z", "type": "commit"}, {"oid": "477a29086c477db8e22c6327b0647037baaa50db", "url": "https://github.com/FAForever/downlords-faf-client/commit/477a29086c477db8e22c6327b0647037baaa50db", "message": "Make code cleaner by removing checks for uppercase style class", "committedDate": "2020-11-05T16:23:57Z", "type": "commit"}, {"oid": "f1d7838d2ef6ee9c08b2b9dd32b21631f081d4b4", "url": "https://github.com/FAForever/downlords-faf-client/commit/f1d7838d2ef6ee9c08b2b9dd32b21631f081d4b4", "message": "Fix bug in PartyMemberItemController", "committedDate": "2020-11-11T17:30:18Z", "type": "commit"}, {"oid": "7ff32a6b73497839be0c1ebea2884a90ed2d98d6", "url": "https://github.com/FAForever/downlords-faf-client/commit/7ff32a6b73497839be0c1ebea2884a90ed2d98d6", "message": "Code cleanup (mostly deleting of redundant code)", "committedDate": "2020-11-15T13:25:03Z", "type": "commit"}, {"oid": "82825c944858f5cd0bc7c59f41c26538f1738157", "url": "https://github.com/FAForever/downlords-faf-client/commit/82825c944858f5cd0bc7c59f41c26538f1738157", "message": "Remove ladder tab", "committedDate": "2020-11-15T13:25:03Z", "type": "commit"}, {"oid": "ec177f1c0ff0c9f540d4e8f9d7244b2b19214144", "url": "https://github.com/FAForever/downlords-faf-client/commit/ec177f1c0ff0c9f540d4e8f9d7244b2b19214144", "message": "Remove logic for ladder searches", "committedDate": "2020-11-15T13:25:03Z", "type": "commit"}, {"oid": "7b164c69f193943e26f575f4afa5759fd61a1df9", "url": "https://github.com/FAForever/downlords-faf-client/commit/7b164c69f193943e26f575f4afa5759fd61a1df9", "message": "Remove notification for match available", "committedDate": "2020-11-15T13:25:03Z", "type": "commit"}, {"oid": "5ce4670c2686e69536fdfffe6390ad3756e0cfcd", "url": "https://github.com/FAForever/downlords-faf-client/commit/5ce4670c2686e69536fdfffe6390ad3756e0cfcd", "message": "Disable chat tab highlight on party message", "committedDate": "2020-11-15T17:05:22Z", "type": "commit"}, {"oid": "4b617b812cfad2c4314622bbc5bddb2d6271a3cb", "url": "https://github.com/FAForever/downlords-faf-client/commit/4b617b812cfad2c4314622bbc5bddb2d6271a3cb", "message": "Merge branch 'develop' into feature/team-matchmaking\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/game/GameService.java\n#\tsrc/main/java/com/faforever/client/rankedmatch/Ladder1v1Controller.java\n#\tsrc/main/resources/theme/settings/settings.fxml\n#\tsrc/test/java/com/faforever/client/game/GameServiceTest.java", "committedDate": "2020-11-15T18:02:21Z", "type": "commit"}, {"oid": "9e68bf9dd00d48958735c8baf31b24be7ff2be03", "url": "https://github.com/FAForever/downlords-faf-client/commit/9e68bf9dd00d48958735c8baf31b24be7ff2be03", "message": "Make chat position dynamic", "committedDate": "2020-11-17T18:17:32Z", "type": "commit"}, {"oid": "acbf51b7ee29a25f2eef7a3021af72f18c164b8c", "url": "https://github.com/FAForever/downlords-faf-client/commit/acbf51b7ee29a25f2eef7a3021af72f18c164b8c", "message": "Show team matchmaker map pools (#2032)", "committedDate": "2020-11-19T10:58:22Z", "type": "commit"}, {"oid": "3a13fadd4378d28dab39c092adc37f64218fb4a2", "url": "https://github.com/FAForever/downlords-faf-client/commit/3a13fadd4378d28dab39c092adc37f64218fb4a2", "message": "UI adjustments", "committedDate": "2020-11-20T22:32:18Z", "type": "commit"}, {"oid": "eba597c886bcbcf6c70a2b5d054d36994001dda6", "url": "https://github.com/FAForever/downlords-faf-client/commit/eba597c886bcbcf6c70a2b5d054d36994001dda6", "message": "Fix failing tests", "committedDate": "2020-11-21T15:51:25Z", "type": "commit"}, {"oid": "d7c9e8a13c93492013a9646539c7248c75ffb883", "url": "https://github.com/FAForever/downlords-faf-client/commit/d7c9e8a13c93492013a9646539c7248c75ffb883", "message": "Only highlight tab on new messages", "committedDate": "2020-11-23T16:54:11Z", "type": "commit"}, {"oid": "df717712e60a6e9d3d6d8b939141acd7df664a94", "url": "https://github.com/FAForever/downlords-faf-client/commit/df717712e60a6e9d3d6d8b939141acd7df664a94", "message": "Fix error in log on queue deselect", "committedDate": "2020-11-23T16:54:43Z", "type": "commit"}, {"oid": "f363aab283a057be1bc69b5d9cb67374ff06f4e6", "url": "https://github.com/FAForever/downlords-faf-client/commit/f363aab283a057be1bc69b5d9cb67374ff06f4e6", "message": "Add indication when partyMember is in a game", "committedDate": "2020-12-04T12:26:20Z", "type": "commit"}, {"oid": "aa67c37c1bd548879850f6abda2ebdda964adb27", "url": "https://github.com/FAForever/downlords-faf-client/commit/aa67c37c1bd548879850f6abda2ebdda964adb27", "message": "Add tests for TeamMatchmakingService", "committedDate": "2020-12-04T12:48:48Z", "type": "commit"}, {"oid": "337361dcca0b4598577e8db9761cf76d3eb7c6af", "url": "https://github.com/FAForever/downlords-faf-client/commit/337361dcca0b4598577e8db9761cf76d3eb7c6af", "message": "Merge branch 'develop' into feature/team-matchmaking\n\n# Conflicts:\n#\tsrc/main/java/com/faforever/client/api/FafApiAccessorImpl.java\n#\tsrc/main/java/com/faforever/client/main/MainController.java\n#\tsrc/main/resources/theme/play/ranked_1v1.fxml", "committedDate": "2020-12-04T13:28:22Z", "type": "commit"}]}