{"pr_number": 1885, "pr_title": "Add install button to map and mod cards for easier UX for installing", "pr_createdAt": "2020-09-04T15:15:46Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/1885", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzEwMw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1885#discussion_r484533103", "bodyText": "what for?", "author": "1-alex98", "createdAt": "2020-09-07T17:44:14Z", "path": "src/main/java/com/faforever/client/map/MapCardController.java", "diffHunk": "@@ -87,8 +97,16 @@ public void setMap(MapBean map) {\n     sizeLabel.setText(i18n.get(\"mapPreview.size\", size.getWidthInKm(), size.getHeightInKm()));\n     maxPlayersLabel.setText(i18n.number(map.getPlayers()));\n \n-    ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n-    JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installedMapsChangeListener));\n+    if (mapService.isOfficialMap(map.getFolderName())) {\n+      installButton.setDisable(false);\n+      uninstallButton.setDisable(false);", "originalCommit": "4b1ca55ac76a8a8c41e5f79ff16386a391374600", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU1MTk2MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1885#discussion_r484551961", "bodyText": "ha meant to disable it but got the logic wrong. Meant to be disabled so that if anything else in the client tries to manually fire it it wont do anything", "author": "Sheikah45", "createdAt": "2020-09-07T19:32:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2NTk2NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1885#discussion_r484565964", "bodyText": "Dont thin that invisible buttons can be fired but well ok", "author": "1-alex98", "createdAt": "2020-09-07T21:00:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTM2NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1885#discussion_r484569365", "bodyText": "ah I was probably being over cautious", "author": "Sheikah45", "createdAt": "2020-09-07T21:23:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzEwMw=="}], "type": "inlineReview", "revised_code": {"commit": "eef317bb68b339d765037a5855de2139d442098c", "chunk": "diff --git a/src/main/java/com/faforever/client/map/MapCardController.java b/src/main/java/com/faforever/client/map/MapCardController.java\nindex 0ef466cd..8ece6ef0 100644\n--- a/src/main/java/com/faforever/client/map/MapCardController.java\n+++ b/src/main/java/com/faforever/client/map/MapCardController.java\n\n@@ -97,20 +97,15 @@ public class MapCardController implements Controller<Node> {\n     sizeLabel.setText(i18n.get(\"mapPreview.size\", size.getWidthInKm(), size.getHeightInKm()));\n     maxPlayersLabel.setText(i18n.number(map.getPlayers()));\n \n-    if (mapService.isOfficialMap(map.getFolderName())) {\n-      installButton.setDisable(false);\n-      uninstallButton.setDisable(false);\n-      installButton.setVisible(false);\n-      uninstallButton.setVisible(false);\n-    } else {\n-      ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n-      JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installStatusChangeListener));\n-      setInstalled(mapService.isInstalled(map.getFolderName()));\n-    }\n+    ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n+    JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installStatusChangeListener));\n \n     ObservableList<Review> reviews = map.getReviews();\n     JavaFxUtil.addListener(reviews, new WeakInvalidationListener(reviewsChangedListener));\n     reviewsChangedListener.invalidated(reviews);\n+\n+    boolean mapInstalled = mapService.isInstalled(map.getFolderName());\n+    setInstalled(mapInstalled);\n   }\n \n   private void populateReviews() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUzMzE5MQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1885#discussion_r484533191", "bodyText": "why", "author": "1-alex98", "createdAt": "2020-09-07T17:44:40Z", "path": "src/main/java/com/faforever/client/map/MapDetailController.java", "diffHunk": "@@ -200,17 +200,23 @@ public void setMap(MapBean map) {\n             installButton.setDisable(true);\n           }\n         }));\n-    uninstallButton.setVisible(mapInstalled);\n \n     mapDescriptionLabel.setText(Optional.ofNullable(map.getDescription())\n         .map(Strings::emptyToNull)\n         .map(FaStrings::removeLocalizationTag)\n         .orElseGet(() -> i18n.get(\"map.noDescriptionAvailable\")));\n \n-    ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n-    JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installStatusChangeListener));\n \n-    setInstalled(mapService.isInstalled(map.getFolderName()));\n+    if (mapService.isOfficialMap(map.getFolderName())) {\n+      installButton.setDisable(false);\n+      uninstallButton.setDisable(false);", "originalCommit": "4b1ca55ac76a8a8c41e5f79ff16386a391374600", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eef317bb68b339d765037a5855de2139d442098c", "chunk": "diff --git a/src/main/java/com/faforever/client/map/MapDetailController.java b/src/main/java/com/faforever/client/map/MapDetailController.java\nindex fa39f8f8..b4329eb2 100644\n--- a/src/main/java/com/faforever/client/map/MapDetailController.java\n+++ b/src/main/java/com/faforever/client/map/MapDetailController.java\n\n@@ -206,17 +206,10 @@ public class MapDetailController implements Controller<Node> {\n         .map(FaStrings::removeLocalizationTag)\n         .orElseGet(() -> i18n.get(\"map.noDescriptionAvailable\")));\n \n+    ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n+    JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installStatusChangeListener));\n \n-    if (mapService.isOfficialMap(map.getFolderName())) {\n-      installButton.setDisable(false);\n-      uninstallButton.setDisable(false);\n-      installButton.setVisible(false);\n-      uninstallButton.setVisible(false);\n-    } else {\n-      ObservableList<MapBean> installedMaps = mapService.getInstalledMaps();\n-      JavaFxUtil.addListener(installedMaps, new WeakListChangeListener<>(installStatusChangeListener));\n-      setInstalled(mapService.isInstalled(map.getFolderName()));\n-    }\n+    setInstalled(mapService.isInstalled(map.getFolderName()));\n   }\n \n   private void onDeleteReview(Review review) {\n"}}, {"oid": "eef317bb68b339d765037a5855de2139d442098c", "url": "https://github.com/FAForever/downlords-faf-client/commit/eef317bb68b339d765037a5855de2139d442098c", "message": "Add install button to map and mod cards for easier UX for installing", "committedDate": "2020-09-07T21:02:13Z", "type": "commit"}, {"oid": "794c63b4a9248f8aa038b963e0ce921f62e5a019", "url": "https://github.com/FAForever/downlords-faf-client/commit/794c63b4a9248f8aa038b963e0ce921f62e5a019", "message": "Use icons for buttons", "committedDate": "2020-09-07T21:02:13Z", "type": "commit"}, {"oid": "fb78fef96392ad5c12de10a6d909f4e31f7b43c6", "url": "https://github.com/FAForever/downlords-faf-client/commit/fb78fef96392ad5c12de10a6d909f4e31f7b43c6", "message": "Use Bin for uninstall icon", "committedDate": "2020-09-07T21:02:13Z", "type": "commit"}, {"oid": "ef2cad5825fb982ca8f056134dbc67e681e04c16", "url": "https://github.com/FAForever/downlords-faf-client/commit/ef2cad5825fb982ca8f056134dbc67e681e04c16", "message": "Remove install uninstall for official maps", "committedDate": "2020-09-07T21:02:14Z", "type": "commit"}, {"oid": "645785fb80627c58bc3b58b085db8ecaa7dd4086", "url": "https://github.com/FAForever/downlords-faf-client/commit/645785fb80627c58bc3b58b085db8ecaa7dd4086", "message": "Set buttons to disabled when official map", "committedDate": "2020-09-07T21:02:14Z", "type": "commit"}, {"oid": "645785fb80627c58bc3b58b085db8ecaa7dd4086", "url": "https://github.com/FAForever/downlords-faf-client/commit/645785fb80627c58bc3b58b085db8ecaa7dd4086", "message": "Set buttons to disabled when official map", "committedDate": "2020-09-07T21:02:14Z", "type": "forcePushed"}, {"oid": "8288758d7e688c2486d97b85dc11edc969fcf54a", "url": "https://github.com/FAForever/downlords-faf-client/commit/8288758d7e688c2486d97b85dc11edc969fcf54a", "message": "Remove disabling buttons", "committedDate": "2020-09-09T12:01:06Z", "type": "commit"}]}