{"pr_number": 1793, "pr_title": "Feature/#1792 theme", "pr_createdAt": "2020-06-20T22:26:43Z", "pr_url": "https://github.com/FAForever/downlords-faf-client/pull/1793", "timeline": [{"oid": "9e76771b23606c90959ae1792c4b7a207c8b2a54", "url": "https://github.com/FAForever/downlords-faf-client/commit/9e76771b23606c90959ae1792c4b7a207c8b2a54", "message": "Themes support\n\nFixes #1792", "committedDate": "2020-06-20T22:29:22Z", "type": "forcePushed"}, {"oid": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73", "url": "https://github.com/FAForever/downlords-faf-client/commit/a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73", "message": "Themes support\n\nFixes #1792", "committedDate": "2020-06-20T22:33:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r443204544", "bodyText": "when the theme.properties specifies needsRestart=true I get an exception here. I think these are the relevant ones:\nat org.springframework.context.support.AbstractMessageSource.getMessage(AbstractMessageSource.java:153) at com.faforever.client.i18n.I18n.get(I18n.java:94) at com.faforever.client.i18n.I18n.get(I18n.java:90) at com.faforever.client.preferences.ui.SettingsController.lambda$initialize$8(SettingsController.java:245) [...] Caused by: java.lang.NumberFormatException: For input string: \"\"", "author": "BlackYps", "createdAt": "2020-06-21T10:18:27Z", "path": "src/main/java/com/faforever/client/preferences/ui/SettingsController.java", "diffHunk": "@@ -239,7 +239,14 @@ public void initialize() {\n     });\n \n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n-    selectedThemeChangeListener = (observable, oldValue, newValue) -> uiService.setTheme(newValue);\n+    selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n+      uiService.setTheme(newValue);\n+      if (newValue.isNeedsRestart()) {\n+        notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,", "originalCommit": "a3c3055ff30b9d2c6f1b8d803c2c7dacef465d73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkxNzI3Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r444917272", "bodyText": "I propose that we don't leave it up to the theme guy to decide whether or not a restart is neede; he might not even know and it might change in future client releases.\nRather the client should figure out itself whether it's needed or not. In its simplest version: require restart if there's more than just a CSS file.\nA future client might be able to reload FXML as well.", "author": "micheljung", "createdAt": "2020-06-24T14:03:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwNDc4OQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r446504789", "bodyText": "If he changes fxml files of pop ups or the gif in the ladder1v1 search it might not be needed even tho it is more than just a css. So I say a maintainer should better judge himself. Also concider context menus, changes there also don't require a restart. You are right that in general none CSS changes more often require a restart but this is not 100%of cases the case.", "author": "1-alex98", "createdAt": "2020-06-27T09:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNTQ4OA==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453005488", "bodyText": "No answer means u agree with me", "author": "1-alex98", "createdAt": "2020-07-10T18:28:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNzQ3Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453007473", "bodyText": "Fixed", "author": "1-alex98", "createdAt": "2020-07-10T18:32:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzIwNDU0NA=="}], "type": "inlineReview", "revised_code": {"commit": "cb30a3bee7527743e22fdf91d39b02897edf8351", "chunk": "diff --git a/src/main/java/com/faforever/client/preferences/ui/SettingsController.java b/src/main/java/com/faforever/client/preferences/ui/SettingsController.java\nindex 64cd5c84a..3399b9850 100644\n--- a/src/main/java/com/faforever/client/preferences/ui/SettingsController.java\n+++ b/src/main/java/com/faforever/client/preferences/ui/SettingsController.java\n\n@@ -241,7 +241,7 @@ public class SettingsController implements Controller<Node> {\n     currentThemeChangeListener = (observable, oldValue, newValue) -> themeComboBox.getSelectionModel().select(newValue);\n     selectedThemeChangeListener = (observable, oldValue, newValue) -> {\n       uiService.setTheme(newValue);\n-      if (newValue.isNeedsRestart()) {\n+      if (oldValue != null && uiService.doesThemeNeedRestart(newValue)) {\n         notificationService.addNotification(new PersistentNotification(i18n.get(\"theme.needsRestart.message\", newValue.getDisplayName()), Severity.WARN,\n             Collections.singletonList(new Action(i18n.get(\"theme.needsRestart.quit\"), event -> Platform.exit()))));\n         // FIXME reload application (stage & application context) https://github.com/FAForever/downlords-faf-client/issues/1794\n"}}, {"oid": "4014ca95483152481c882f55f74789fbcb028cee", "url": "https://github.com/FAForever/downlords-faf-client/commit/4014ca95483152481c882f55f74789fbcb028cee", "message": "Themes support\n\nFixes #1792", "committedDate": "2020-07-10T18:32:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNjY1Mw==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r453206653", "bodyText": "I'm still against having such a property.", "author": "micheljung", "createdAt": "2020-07-11T15:39:46Z", "path": "src/main/java/com/faforever/client/theme/Theme.java", "diffHunk": "@@ -13,21 +15,20 @@\n   private static final String AUTHOR = \"author\";\n   private static final String COMPATIBILITY_VERSION = \"compatibilityVersion\";\n   private static final String THEME_VERSION = \"themeVersion\";\n+  private static final String NEEDS_RESTART = \"needsRestart\";\n \n-  private StringProperty displayName;\n-  private StringProperty author;\n-  private SimpleObjectProperty<Integer> compatibilityVersion;\n-  private StringProperty themeVersion;\n+  private final StringProperty displayName;\n+  private final StringProperty author;\n+  private final SimpleObjectProperty<Integer> compatibilityVersion;\n+  private final StringProperty themeVersion;\n+  private final BooleanProperty needsRestart;\n \n-  public Theme() {\n-    this(null, null, null, null);\n-  }\n-\n-  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion) {\n+  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion, boolean needsRestart) {\n     this.displayName = new SimpleStringProperty(displayName);\n     this.author = new SimpleStringProperty(author);\n     this.compatibilityVersion = new SimpleObjectProperty<>(compatibilityVersion);\n     this.themeVersion = new SimpleStringProperty(themeVersion);\n+    this.needsRestart = new SimpleBooleanProperty(needsRestart);", "originalCommit": "4014ca95483152481c882f55f74789fbcb028cee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY3NDU2Mg==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r456674562", "bodyText": "So what are u for? No restart pop up, always a pop up? Looking if it contains fxml files?(that's inaccurate) Looking if it contains none css files?", "author": "1-alex98", "createdAt": "2020-07-17T21:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzIwNjY1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "cb30a3bee7527743e22fdf91d39b02897edf8351", "chunk": "diff --git a/src/main/java/com/faforever/client/theme/Theme.java b/src/main/java/com/faforever/client/theme/Theme.java\nindex 16ee9a8d9..8c43b7902 100644\n--- a/src/main/java/com/faforever/client/theme/Theme.java\n+++ b/src/main/java/com/faforever/client/theme/Theme.java\n\n@@ -15,20 +13,17 @@ public class Theme {\n   private static final String AUTHOR = \"author\";\n   private static final String COMPATIBILITY_VERSION = \"compatibilityVersion\";\n   private static final String THEME_VERSION = \"themeVersion\";\n-  private static final String NEEDS_RESTART = \"needsRestart\";\n \n   private final StringProperty displayName;\n   private final StringProperty author;\n   private final SimpleObjectProperty<Integer> compatibilityVersion;\n   private final StringProperty themeVersion;\n-  private final BooleanProperty needsRestart;\n \n-  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion, boolean needsRestart) {\n+  public Theme(String displayName, String author, Integer compatibilityVersion, String themeVersion) {\n     this.displayName = new SimpleStringProperty(displayName);\n     this.author = new SimpleStringProperty(author);\n     this.compatibilityVersion = new SimpleObjectProperty<>(compatibilityVersion);\n     this.themeVersion = new SimpleStringProperty(themeVersion);\n-    this.needsRestart = new SimpleBooleanProperty(needsRestart);\n   }\n \n   public String getDisplayName() {\n"}}, {"oid": "8da5e25353fdd763cfcc6e91583574528078067e", "url": "https://github.com/FAForever/downlords-faf-client/commit/8da5e25353fdd763cfcc6e91583574528078067e", "message": "Themes support\n\nFixes #1792", "committedDate": "2020-07-20T16:17:33Z", "type": "forcePushed"}, {"oid": "05d6f9228a459d166efc3e8df8ad4e8e3dfde69b", "url": "https://github.com/FAForever/downlords-faf-client/commit/05d6f9228a459d166efc3e8df8ad4e8e3dfde69b", "message": "Theming\n\nFixes #1792", "committedDate": "2020-07-20T16:25:40Z", "type": "forcePushed"}, {"oid": "cb30a3bee7527743e22fdf91d39b02897edf8351", "url": "https://github.com/FAForever/downlords-faf-client/commit/cb30a3bee7527743e22fdf91d39b02897edf8351", "message": "Theming\n\nFixes #1792", "committedDate": "2020-07-20T17:19:35Z", "type": "forcePushed"}, {"oid": "bc37865c553d2c03e5918dd527830ecf2206f548", "url": "https://github.com/FAForever/downlords-faf-client/commit/bc37865c553d2c03e5918dd527830ecf2206f548", "message": "Correct tests", "committedDate": "2020-07-23T15:48:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463287221", "bodyText": "This will always return the theme.properties file", "author": "BlackYps", "createdAt": "2020-07-30T21:40:24Z", "path": "src/main/java/com/faforever/client/theme/UiService.java", "diffHunk": "@@ -472,4 +472,11 @@ public JFXDialog showInDialog(StackPane parent, Node content, String title) {\n     dialog.show(parent);\n     return dialog;\n   }\n+\n+  @SneakyThrows\n+  public boolean doesThemeNeedRestart(Theme theme) {\n+    try (Stream<Path> stream = Files.list(getThemeDirectory(theme))) {\n+      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\"));", "originalCommit": "bc37865c553d2c03e5918dd527830ecf2206f548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5MTA5NQ==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463491095", "bodyText": "What are u talking about? This is a check on wether a theme conatins a file that is not an css file, because if so we need a restart to fully load the theme.", "author": "1-alex98", "createdAt": "2020-07-31T08:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ5MTk3Ng==", "url": "https://github.com/FAForever/downlords-faf-client/pull/1793#discussion_r463491976", "bodyText": "oh yeah i get u now. Hmm yes so I guess I got to include this there as well", "author": "1-alex98", "createdAt": "2020-07-31T09:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4NzIyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "fbc5f644b9ff38d989d79b0ada7337cd2d391fb0", "chunk": "diff --git a/src/main/java/com/faforever/client/theme/UiService.java b/src/main/java/com/faforever/client/theme/UiService.java\nindex 1e881e52a..07ccec402 100644\n--- a/src/main/java/com/faforever/client/theme/UiService.java\n+++ b/src/main/java/com/faforever/client/theme/UiService.java\n\n@@ -476,7 +476,7 @@ public class UiService implements InitializingBean, DisposableBean {\n   @SneakyThrows\n   public boolean doesThemeNeedRestart(Theme theme) {\n     try (Stream<Path> stream = Files.list(getThemeDirectory(theme))) {\n-      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\"));\n+      return stream.anyMatch(path -> Files.isRegularFile(path) && !path.endsWith(\".css\") && !path.endsWith(\".properties\"));\n     }\n   }\n }\n"}}, {"oid": "fbc5f644b9ff38d989d79b0ada7337cd2d391fb0", "url": "https://github.com/FAForever/downlords-faf-client/commit/fbc5f644b9ff38d989d79b0ada7337cd2d391fb0", "message": "Correct tests", "committedDate": "2020-07-31T09:02:25Z", "type": "forcePushed"}, {"oid": "494520c12b995bb1e42721469333c15b824709c4", "url": "https://github.com/FAForever/downlords-faf-client/commit/494520c12b995bb1e42721469333c15b824709c4", "message": "Correct tests", "committedDate": "2020-07-31T09:03:46Z", "type": "forcePushed"}, {"oid": "81dc1f5bcb459d23350460b2711dc4a6222f8037", "url": "https://github.com/FAForever/downlords-faf-client/commit/81dc1f5bcb459d23350460b2711dc4a6222f8037", "message": "Allow Theming\n\nFixes #1792", "committedDate": "2020-07-31T09:05:02Z", "type": "commit"}, {"oid": "81dc1f5bcb459d23350460b2711dc4a6222f8037", "url": "https://github.com/FAForever/downlords-faf-client/commit/81dc1f5bcb459d23350460b2711dc4a6222f8037", "message": "Allow Theming\n\nFixes #1792", "committedDate": "2020-07-31T09:05:02Z", "type": "forcePushed"}]}