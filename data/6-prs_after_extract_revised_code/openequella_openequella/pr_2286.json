{"pr_number": 2286, "pr_title": "Functional tests for new Search page", "pr_createdAt": "2020-09-16T00:47:03Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2286", "timeline": [{"oid": "bde927131e7c4f71d0355d709577d30ba8bb2a09", "url": "https://github.com/openequella/openEQUELLA/commit/bde927131e7c4f71d0355d709577d30ba8bb2a09", "message": "Give Search result list an ID so that the autotest can access\nthe list conveniently.", "committedDate": "2020-09-15T01:15:36Z", "type": "commit"}, {"oid": "24eae671157d385656b2e8f4fec204e0cf8f66ad", "url": "https://github.com/openequella/openEQUELLA/commit/24eae671157d385656b2e8f4fec204e0cf8f66ad", "message": "Add a autotest PageObject for the new Search page.", "committedDate": "2020-09-15T01:15:36Z", "type": "commit"}, {"oid": "85feaeb69fdf6fdcc4c00b35f06ac9666f757ac2", "url": "https://github.com/openequella/openEQUELLA/commit/85feaeb69fdf6fdcc4c00b35f06ac9666f757ac2", "message": "Add a Selenium test for the new Search page\n\n1. Create two methods to help access the list of Search\nresult items and the link of a specified item.\n\n2. Create a test case to check if the initial search is\ncompleted after open the page. This method is also annotated\nby 'BeforeMethod'.\n\n3. Create a test case to check if clicking an item will\nopen this item's summary page.", "committedDate": "2020-09-15T01:15:36Z", "type": "commit"}, {"oid": "9fbc496fe263fe41ee5ee30ed4e5accefaf9a067", "url": "https://github.com/openequella/openEQUELLA/commit/9fbc496fe263fe41ee5ee30ed4e5accefaf9a067", "message": "Add more methods interacting with the Search page.", "committedDate": "2020-09-16T00:30:45Z", "type": "commit"}, {"oid": "2f72472bbb65630dc8bcf10660c915c50bcec794", "url": "https://github.com/openequella/openEQUELLA/commit/2f72472bbb65630dc8bcf10660c915c50bcec794", "message": "Add more test cases for new Search page.", "committedDate": "2020-09-16T00:32:28Z", "type": "commit"}, {"oid": "e98f38eb45cc92eb1090710d5a04d6a5dbe4bcc0", "url": "https://github.com/openequella/openEQUELLA/commit/e98f38eb45cc92eb1090710d5a04d6a5dbe4bcc0", "message": "Include the new test suite in CI.", "committedDate": "2020-09-16T00:35:47Z", "type": "commit"}, {"oid": "77cc9bcb056a32a44ed31290408821abd4ea584c", "url": "https://github.com/openequella/openEQUELLA/commit/77cc9bcb056a32a44ed31290408821abd4ea584c", "message": "Merge branch 'component/new-search-page' into feature/autotests-for-search-page", "committedDate": "2020-10-06T03:11:13Z", "type": "commit"}, {"oid": "e942b10ada781e535cf78aa41acb1283d759c805", "url": "https://github.com/openequella/openEQUELLA/commit/e942b10ada781e535cf78aa41acb1283d759c805", "message": "Add the AutoTest account to Institution Facet.", "committedDate": "2020-10-06T04:55:47Z", "type": "commit"}, {"oid": "72cf800ee3bdcb0f4273c95472d07c46bd44e509", "url": "https://github.com/openequella/openEQUELLA/commit/72cf800ee3bdcb0f4273c95472d07c46bd44e509", "message": "Update the search settings of Institution Facet.", "committedDate": "2020-10-06T05:15:18Z", "type": "commit"}, {"oid": "2e1e982e3eac6772227ff5025712439f568da82e", "url": "https://github.com/openequella/openEQUELLA/commit/2e1e982e3eac6772227ff5025712439f568da82e", "message": "Update the ACLs of Institution Facet.", "committedDate": "2020-10-06T06:10:17Z", "type": "commit"}, {"oid": "d17d4c49785fa802df2fdc827029d3a878c6be17", "url": "https://github.com/openequella/openEQUELLA/commit/d17d4c49785fa802df2fdc827029d3a878c6be17", "message": "Update NewSearchPageTest to run against Institution Facet.", "committedDate": "2020-10-06T06:11:16Z", "type": "commit"}, {"oid": "c8e9776d128ce2cecb49d92fd7c51c856658d0a6", "url": "https://github.com/openequella/openEQUELLA/commit/c8e9776d128ce2cecb49d92fd7c51c856658d0a6", "message": "Add testing items to Institution Facet.", "committedDate": "2020-10-06T06:13:50Z", "type": "commit"}, {"oid": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "url": "https://github.com/openequella/openEQUELLA/commit/ad345cdab0d4bce5b441856afd04c6ff72f251ed", "message": "No longer need the ID of searchResultList so remove it.", "committedDate": "2020-10-06T06:20:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NzcwNA==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500647704", "bodyText": "Curious.... You say the initial search should return 10 items, but then you wait for 16...", "author": "edalex-ian", "createdAt": "2020-10-06T23:15:13Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMzMTYzNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r501331635", "bodyText": "oops I forgot to update the comment.", "author": "PenghaiZhang", "createdAt": "2020-10-07T21:53:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NzcwNA=="}], "type": "inlineReview", "revised_code": {"commit": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "chunk": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\nindex a829c5df1..cef1bdf49 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n\n@@ -16,7 +16,7 @@ public class NewSearchPageTest extends AbstractCleanupAutoTest {\n   @Test(description = \"open the new Search page and wait for initial search completed\")\n   public void initialSearch() {\n     searchPage = new NewSearchPage(context).load();\n-    // The initial search should return 10 items.\n+    // The initial search should return 16 items.\n     searchPage.waitForSearchCompleted(16);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0ODk0MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500648940", "bodyText": "It'd be good to have this as a method of NewSearchPage. Maybe with a signature of: SummaryPage selectItem(String itemTitle).", "author": "edalex-ian", "createdAt": "2020-10-06T23:19:20Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "chunk": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\nindex a829c5df1..cef1bdf49 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n\n@@ -16,7 +16,7 @@ public class NewSearchPageTest extends AbstractCleanupAutoTest {\n   @Test(description = \"open the new Search page and wait for initial search completed\")\n   public void initialSearch() {\n     searchPage = new NewSearchPage(context).load();\n-    // The initial search should return 10 items.\n+    // The initial search should return 16 items.\n     searchPage.waitForSearchCompleted(16);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0OTQxNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500649415", "bodyText": "Could be good to add a comment above this to highlight what the following lines are doing:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n          \n          \n            \n                // Expect when going 'back' to the search page, the previous search settings have been remembered\n          \n          \n            \n                assertEquals(searchBar.getAttribute(\"value\"), \"Java\");", "author": "edalex-ian", "createdAt": "2020-10-06T23:21:01Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();\n+    assertEquals(summary.getItemTitle(), ITEM_TITLE);\n+  }\n+\n+  @Test(\n+      description = \"Go back to the Search page from another page\",\n+      dependsOnMethods = \"openItemSummaryPage\")\n+  public void backToSearchPage() {\n+    context.getDriver().navigate().back();\n+    WebElement searchBar = searchPage.getSearchBar();\n+    assertEquals(searchBar.getAttribute(\"value\"), \"Java\");", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "chunk": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\nindex a829c5df1..cef1bdf49 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n\n@@ -16,7 +16,7 @@ public class NewSearchPageTest extends AbstractCleanupAutoTest {\n   @Test(description = \"open the new Search page and wait for initial search completed\")\n   public void initialSearch() {\n     searchPage = new NewSearchPage(context).load();\n-    // The initial search should return 10 items.\n+    // The initial search should return 16 items.\n     searchPage.waitForSearchCompleted(16);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1NzEzOA==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500657138", "bodyText": "I was wondering why you were going through this pain when you actually don't need anything else AbstractCleanupAutoTest really provides - other than perhaps the prepareBrowserSession implementation. So on digging deeper I think it would be good to:\n\nMove com.tle.webtests.test.AbstractCleanupTest#logon, com.tle.webtests.test.AbstractCleanupTest#AUTOTEST_LOGON and com.tle.webtests.test.AbstractCleanupTest#AUTOTEST_PASSWD to com.tle.webtests.test.AbstractSessionTest\nMake this test then simply extend com.tle.webtests.test.AbstractSessionTest\nAnd in this test add your implementation of prepareBrowserSession which simply calls the newly located com.tle.webtests.test.AbstractSessionTest#logon", "author": "edalex-ian", "createdAt": "2020-10-06T23:46:31Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;\n+\n+import static org.testng.Assert.assertEquals;\n+\n+import com.tle.webtests.framework.TestInstitution;\n+import com.tle.webtests.pageobject.searching.NewSearchPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n+import com.tle.webtests.test.AbstractCleanupAutoTest;\n+import org.openqa.selenium.WebElement;\n+import org.testng.annotations.Test;\n+\n+@TestInstitution(\"facet\")\n+public class NewSearchPageTest extends AbstractCleanupAutoTest {\n+  private NewSearchPage searchPage;\n+\n+  @Test(description = \"open the new Search page and wait for initial search completed\")\n+  public void initialSearch() {\n+    searchPage = new NewSearchPage(context).load();\n+    // The initial search should return 10 items.\n+    searchPage.waitForSearchCompleted(16);\n+  }\n+\n+  @Test(dependsOnMethods = \"initialSearch\", description = \"Search with a query and refine controls\")\n+  public void searchByFilters() {\n+    searchPage.newSearch();\n+    // Search by Collections.\n+    searchPage.selectCollection(\"programming\");\n+    searchPage.waitForSearchCompleted(9);\n+    // Expand the Refine control panel.\n+    searchPage.expandRefineControlPanel();\n+    // Search by Item status.\n+    searchPage.selectStatus(true);\n+    searchPage.waitForSearchCompleted(10);\n+    // Search by a query.\n+    searchPage.changeQuery(\"Java\");\n+    searchPage.waitForSearchCompleted(4);\n+    // Exclude attachments in a search.\n+    searchPage.selectSearchAttachments(false);\n+    searchPage.waitForSearchCompleted(4);\n+    // Search by date ranges.\n+    searchPage.selectCustomDateRange(\"2020-10-01\", \"2020-10-06\");\n+    searchPage.waitForSearchCompleted(1);\n+    // Search by an owner.\n+    searchPage.selectOwner(\"AutoTest\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Test(description = \"open an item's summary page\", dependsOnMethods = \"searchByFilters\")\n+  public void openItemSummaryPage() {\n+    final String ITEM_TITLE = \"Java (cloned)\";\n+    WebElement titleLink = searchPage.getItemTitleLink(ITEM_TITLE);\n+    titleLink.click();\n+    SummaryPage summary = new SummaryPage(context).get();\n+    assertEquals(summary.getItemTitle(), ITEM_TITLE);\n+  }\n+\n+  @Test(\n+      description = \"Go back to the Search page from another page\",\n+      dependsOnMethods = \"openItemSummaryPage\")\n+  public void backToSearchPage() {\n+    context.getDriver().navigate().back();\n+    WebElement searchBar = searchPage.getSearchBar();\n+    assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n+    searchPage.waitForSearchCompleted(1);\n+  }\n+\n+  @Override\n+  protected void cleanupAfterClass() throws Exception {\n+    // This test does not need to clean anything.\n+  }", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "chunk": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\nindex a829c5df1..cef1bdf49 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n\n@@ -16,7 +16,7 @@ public class NewSearchPageTest extends AbstractCleanupAutoTest {\n   @Test(description = \"open the new Search page and wait for initial search completed\")\n   public void initialSearch() {\n     searchPage = new NewSearchPage(context).load();\n-    // The initial search should return 10 items.\n+    // The initial search should return 16 items.\n     searchPage.waitForSearchCompleted(16);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MDg1OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500660859", "bodyText": "Seeing this is all about testing the new stuff, should we perhaps move it (and the below Page class) over to the io.github.openequella package tree? Maybe they could be:\n\nio.github.openequella.search.NewSearchPageTest\nio.github.openequella.pages.search.NewSearchPage", "author": "edalex-ian", "createdAt": "2020-10-06T23:58:23Z", "path": "autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.tle.webtests.test.searching;", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "chunk": "diff --git a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\nindex a829c5df1..cef1bdf49 100644\n--- a/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/com/tle/webtests/test/searching/NewSearchPageTest.java\n\n@@ -16,7 +16,7 @@ public class NewSearchPageTest extends AbstractCleanupAutoTest {\n   @Test(description = \"open the new Search page and wait for initial search completed\")\n   public void initialSearch() {\n     searchPage = new NewSearchPage(context).load();\n-    // The initial search should return 10 items.\n+    // The initial search should return 16 items.\n     searchPage.waitForSearchCompleted(16);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2Mjc0OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500662749", "bodyText": "Is this unused?", "author": "edalex-ian", "createdAt": "2020-10-07T00:04:39Z", "path": "autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java", "diffHunk": "@@ -0,0 +1,193 @@\n+package com.tle.webtests.pageobject.searching;\n+\n+import com.tle.webtests.framework.PageContext;\n+import com.tle.webtests.pageobject.AbstractPage;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.ui.ExpectedConditions;\n+\n+public class NewSearchPage extends AbstractPage<NewSearchPage> {\n+\n+  public NewSearchPage(PageContext context) {\n+    super(context);\n+  }\n+\n+  @Override\n+  protected void loadUrl() {\n+    driver.get(context.getBaseUrl() + \"page/search\");\n+  }\n+\n+  /** Find the Search query bar. */\n+  public WebElement getSearchBar() {\n+    return driver.findElement(By.id(\"searchBar\"));\n+  }\n+\n+  @Override\n+  protected WebElement findLoadedElement() {\n+    // When the Search bar is visible, the page is loaded.\n+    return getSearchBar();\n+  }\n+\n+  /**\n+   * Wait until the correct number of items are displayed.\n+   *\n+   * @param itemCount The expected number of items\n+   */\n+  public void waitForSearchCompleted(int itemCount) {\n+    waiter.until(\n+        ExpectedConditions.visibilityOfElementLocated(\n+            By.xpath(\"//span[text()='Search results (\" + itemCount + \")']\")));\n+  }\n+\n+  /** Perform a new search. */\n+  public void newSearch() {\n+    WebElement newSearchButton = driver.findElement(By.xpath(\"//button[span=('New search')]\"));\n+    newSearchButton.click();\n+  }\n+\n+  /**\n+   * Change the search query.\n+   *\n+   * @param query A text used as search query.\n+   */\n+  public void changeQuery(String query) {\n+    WebElement searchBar = getSearchBar();\n+    searchBar.sendKeys(query);\n+  }\n+\n+  /**\n+   * Get the link of an Item's title which links to the Item's summary page.\n+   *\n+   * @param title The text of an Item's title\n+   */\n+  public WebElement getItemTitleLink(String title) {\n+    return driver.findElement(By.linkText(title));\n+  }\n+\n+  public void expandRefineControlPanel() {\n+    WebElement showMore = driver.findElement(By.id(\"collapsibleRefinePanelButton\"));\n+    showMore.click();\n+  }\n+  /**\n+   * Select Collections by typing keywords in the Selector's TextField.\n+   *\n+   * @param collectionNames A list of Collection names\n+   */\n+  public void selectCollection(String... collectionNames) {\n+    WebElement collectionSelector = getRefineControl(\"CollectionSelector\");\n+    WebElement collectionSelectTextField = collectionSelector.findElement(By.xpath(\".//input\"));\n+    for (String name : collectionNames) {\n+      collectionSelectTextField.sendKeys(name);\n+      collectionSelectTextField.sendKeys(Keys.DOWN);\n+      collectionSelectTextField.sendKeys(Keys.ENTER);\n+    }\n+    // Press TAB to remove the focus so the Collection dropdown list will disappear.\n+    collectionSelectTextField.sendKeys(Keys.TAB);\n+  }\n+\n+  /**\n+   * Select one of the date range quick options.\n+   *\n+   * @param quickOption The text of a quick option\n+   */\n+  public void selectDateRangeQuickOption(String quickOption) {", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM1MTYxNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r501351615", "bodyText": "It was actually used. The test expects no items found if today is selected, but this failed because of the two new items. So I removed it. Now I can call this method again. The test will select Today and check, and then select All and check.", "author": "PenghaiZhang", "createdAt": "2020-10-07T22:43:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2Mjc0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "chunk": "diff --git a/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java b/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\nindex 6223369de..5887b766c 100644\n--- a/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\n+++ b/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\n\n@@ -2,6 +2,7 @@ package com.tle.webtests.pageobject.searching;\n \n import com.tle.webtests.framework.PageContext;\n import com.tle.webtests.pageobject.AbstractPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n import org.openqa.selenium.By;\n import org.openqa.selenium.Keys;\n import org.openqa.selenium.WebElement;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0ODE0NQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r500748145", "bodyText": "I wonder if instead we should use the @FindById and a class property. \ud83e\udd14", "author": "edalex-ian", "createdAt": "2020-10-07T05:37:41Z", "path": "autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java", "diffHunk": "@@ -0,0 +1,193 @@\n+package com.tle.webtests.pageobject.searching;\n+\n+import com.tle.webtests.framework.PageContext;\n+import com.tle.webtests.pageobject.AbstractPage;\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.Keys;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.ui.ExpectedConditions;\n+\n+public class NewSearchPage extends AbstractPage<NewSearchPage> {\n+\n+  public NewSearchPage(PageContext context) {\n+    super(context);\n+  }\n+\n+  @Override\n+  protected void loadUrl() {\n+    driver.get(context.getBaseUrl() + \"page/search\");\n+  }\n+\n+  /** Find the Search query bar. */\n+  public WebElement getSearchBar() {", "originalCommit": "ad345cdab0d4bce5b441856afd04c6ff72f251ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM3MDI5OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r501370299", "bodyText": "I think it's good to use this annotation for three components: the search bar, new search button and the refine panel show more button.", "author": "PenghaiZhang", "createdAt": "2020-10-07T23:40:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc0ODE0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "chunk": "diff --git a/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java b/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\nindex 6223369de..5887b766c 100644\n--- a/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\n+++ b/autotest/Tests/src/main/java/com/tle/webtests/pageobject/searching/NewSearchPage.java\n\n@@ -2,6 +2,7 @@ package com.tle.webtests.pageobject.searching;\n \n import com.tle.webtests.framework.PageContext;\n import com.tle.webtests.pageobject.AbstractPage;\n+import com.tle.webtests.pageobject.viewitem.SummaryPage;\n import org.openqa.selenium.By;\n import org.openqa.selenium.Keys;\n import org.openqa.selenium.WebElement;\n"}}, {"oid": "dface0bf9888e3c480927efb15ec52d4f7f3d294", "url": "https://github.com/openequella/openEQUELLA/commit/dface0bf9888e3c480927efb15ec52d4f7f3d294", "message": "Update NewSearchPageTest comments.", "committedDate": "2020-10-07T22:03:54Z", "type": "commit"}, {"oid": "13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "url": "https://github.com/openequella/openEQUELLA/commit/13f6ae0e0bf38dda7ed93c09106d15ca5d7a3797", "message": "Add a method in NewSearchPage to abstract out\nthe user action of selecting an item.", "committedDate": "2020-10-07T22:08:22Z", "type": "commit"}, {"oid": "fbe86ad0a42f835d3164c05703423fff25b4ea81", "url": "https://github.com/openequella/openEQUELLA/commit/fbe86ad0a42f835d3164c05703423fff25b4ea81", "message": "Clean up the autotest class tree.\n\n1. Move the method for logon as Autotest and two constants\nfrom AbstractCleanupTest to AbstractSessionTest.\n2. Make NewSearchPageTest extend AbstractSessionTest and\noverride method 'prepareBrowserSession' for logon.", "committedDate": "2020-10-07T22:18:51Z", "type": "commit"}, {"oid": "391c11905a4794b010f233e0a56876c365d4353f", "url": "https://github.com/openequella/openEQUELLA/commit/391c11905a4794b010f233e0a56876c365d4353f", "message": "Move NewSearchPage and NewSearchPageTest to package\n'io.github.openequella'.", "committedDate": "2020-10-07T22:39:22Z", "type": "commit"}, {"oid": "063efc130b7e9a8ad2e3592ddf8076345449375a", "url": "https://github.com/openequella/openEQUELLA/commit/063efc130b7e9a8ad2e3592ddf8076345449375a", "message": "Check whether selecting date range quick options works\nin NewSearchPageTest.", "committedDate": "2020-10-07T22:46:54Z", "type": "commit"}, {"oid": "f323bfd1ae6fb702350e53e0e1783ced5b9a6beb", "url": "https://github.com/openequella/openEQUELLA/commit/f323bfd1ae6fb702350e53e0e1783ced5b9a6beb", "message": "Use the 'FindBy' annotation to locate some new search\npage Web elements.", "committedDate": "2020-10-07T23:37:51Z", "type": "commit"}, {"oid": "d050d13da10d191f972a644f3491709f00210988", "url": "https://github.com/openequella/openEQUELLA/commit/d050d13da10d191f972a644f3491709f00210988", "message": "Update testing Institution Facet.", "committedDate": "2020-10-08T03:02:39Z", "type": "commit"}, {"oid": "92dbb54acba1937afde1c707a0d6bf070054271f", "url": "https://github.com/openequella/openEQUELLA/commit/92dbb54acba1937afde1c707a0d6bf070054271f", "message": "Add a test to check if new search page is accessible\nwithout any error for low privileged users.", "committedDate": "2020-10-08T03:03:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQyOTE5Mw==", "url": "https://github.com/openequella/openEQUELLA/pull/2286#discussion_r501429193", "bodyText": "Does it need to depend on any prior test? Seeing it's logging in with a new session, it should be stand-alone really shouldn't it?", "author": "edalex-ian", "createdAt": "2020-10-08T03:36:24Z", "path": "autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java", "diffHunk": "@@ -60,12 +68,22 @@ public void openItemSummaryPage() {\n   public void backToSearchPage() {\n     context.getDriver().navigate().back();\n     WebElement searchBar = searchPage.getSearchBar();\n+    // Expect when going 'back' to the search page, the previous search\n+    // settings have been remembered.\n     assertEquals(searchBar.getAttribute(\"value\"), \"Java\");\n     searchPage.waitForSearchCompleted(1);\n   }\n \n-  @Override\n-  protected void cleanupAfterClass() throws Exception {\n-    // This test does not need to clean anything.\n+  @Test(description = \"Search with a low privileged user\", dependsOnMethods = \"backToSearchPage\")", "originalCommit": "92dbb54acba1937afde1c707a0d6bf070054271f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8fb70264b0f11a5620680faf426d63e75604cd12", "chunk": "diff --git a/autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java b/autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java\nindex ef2d8751e..933540ed0 100644\n--- a/autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java\n+++ b/autotest/OldTests/src/test/java/io/github/openequella/search/NewSearchPageTest.java\n\n@@ -67,6 +67,10 @@ public class NewSearchPageTest extends AbstractSessionTest {\n       dependsOnMethods = \"openItemSummaryPage\")\n   public void backToSearchPage() {\n     context.getDriver().navigate().back();\n+    // todo: remove this when we can skip this test suite in Old UI mode.\n+    if (!testConfig.isNewUI()) {\n+      context.getDriver().navigate().refresh();\n+    }\n     WebElement searchBar = searchPage.getSearchBar();\n     // Expect when going 'back' to the search page, the previous search\n     // settings have been remembered.\n"}}, {"oid": "522486df25d3cb67e26900f9fb47431b83291b7b", "url": "https://github.com/openequella/openEQUELLA/commit/522486df25d3cb67e26900f9fb47431b83291b7b", "message": "Merge branch 'component/new-search-page' into feature/autotests-for-search-page", "committedDate": "2020-10-08T04:28:53Z", "type": "commit"}, {"oid": "c9d124b50161135ea72c69c187737ad2318dc47a", "url": "https://github.com/openequella/openEQUELLA/commit/c9d124b50161135ea72c69c187737ad2318dc47a", "message": "Update SearchFacets test because of three new facets\ngenerated from new testing items.", "committedDate": "2020-10-08T04:51:44Z", "type": "commit"}, {"oid": "21a7734190defa8b7297891b1c57a1597f9de125", "url": "https://github.com/openequella/openEQUELLA/commit/21a7734190defa8b7297891b1c57a1597f9de125", "message": "Update the classpath of NewSearchPageTest in CI yaml.", "committedDate": "2020-10-08T21:53:26Z", "type": "commit"}, {"oid": "98096c04139353d1e892e17503198c2b5c542579", "url": "https://github.com/openequella/openEQUELLA/commit/98096c04139353d1e892e17503198c2b5c542579", "message": "Try to use the administrator account to run REST Module\ntests: Search and SearchFacets.", "committedDate": "2020-10-08T23:19:29Z", "type": "commit"}, {"oid": "9f4dc7840cf45fcd281d31179261e7a8431108bb", "url": "https://github.com/openequella/openEQUELLA/commit/9f4dc7840cf45fcd281d31179261e7a8431108bb", "message": "Revert \"Try to use the administrator account to run REST Module\"\n\nThis reverts commit 98096c04139353d1e892e17503198c2b5c542579.", "committedDate": "2020-10-09T01:20:23Z", "type": "commit"}, {"oid": "d4a7316e352193da896d9a79d956cc959f5931df", "url": "https://github.com/openequella/openEQUELLA/commit/d4a7316e352193da896d9a79d956cc959f5931df", "message": "Make sure date range quick option is clickable.", "committedDate": "2020-10-09T01:21:03Z", "type": "commit"}, {"oid": "9bf8e8cbcda36e7263f4470da0ce5bbc59470aef", "url": "https://github.com/openequella/openEQUELLA/commit/9bf8e8cbcda36e7263f4470da0ce5bbc59470aef", "message": "Create a new annotation used to specify whether a\ntest should be skipped in Old UI mode.", "committedDate": "2020-10-09T02:31:01Z", "type": "commit"}, {"oid": "f6f61dc3f4aab15e0647eef4f7521a88e413cd59", "url": "https://github.com/openequella/openEQUELLA/commit/f6f61dc3f4aab15e0647eef4f7521a88e413cd59", "message": "Revert \"Create a new annotation used to specify whether a\"\n\nThis reverts commit 9bf8e8cbcda36e7263f4470da0ce5bbc59470aef.", "committedDate": "2020-10-09T02:44:58Z", "type": "commit"}, {"oid": "8fb70264b0f11a5620680faf426d63e75604cd12", "url": "https://github.com/openequella/openEQUELLA/commit/8fb70264b0f11a5620680faf426d63e75604cd12", "message": "Add a workaround to temporarily pass NewSearchPageTest\nin Old UI.", "committedDate": "2020-10-09T02:46:56Z", "type": "commit"}, {"oid": "bbf3c5bba2cf2527806f36d7372f306d6f702236", "url": "https://github.com/openequella/openEQUELLA/commit/bbf3c5bba2cf2527806f36d7372f306d6f702236", "message": "Add a wait for selecting date range quick option.", "committedDate": "2020-10-09T03:41:07Z", "type": "commit"}, {"oid": "4d17b48dfd0b2901dbeca68a45f3dfec54714a34", "url": "https://github.com/openequella/openEQUELLA/commit/4d17b48dfd0b2901dbeca68a45f3dfec54714a34", "message": "Add testing code to check why SearchFacets/Search tests\nfail on CI.", "committedDate": "2020-10-09T05:32:29Z", "type": "commit"}, {"oid": "a0b4173743a4813da3164e342ccd81d4be5ef21b", "url": "https://github.com/openequella/openEQUELLA/commit/a0b4173743a4813da3164e342ccd81d4be5ef21b", "message": "A couple tweaks for NewSearchPageTest.", "committedDate": "2020-10-09T06:33:50Z", "type": "commit"}, {"oid": "ceab6ffa644c8e4073cf4c226ebf71cfb5d71996", "url": "https://github.com/openequella/openEQUELLA/commit/ceab6ffa644c8e4073cf4c226ebf71cfb5d71996", "message": "Remove the action of selecting date range option\n'Today'.", "committedDate": "2020-10-09T09:03:59Z", "type": "commit"}, {"oid": "7ff0586bae4cdf0a7966283b01b0773588887cf0", "url": "https://github.com/openequella/openEQUELLA/commit/7ff0586bae4cdf0a7966283b01b0773588887cf0", "message": "Two tweaks to help NewSearchPageTest pass on CI.", "committedDate": "2020-10-10T01:29:26Z", "type": "commit"}, {"oid": "019814ede747a61789d1678e42b4112d98b02e68", "url": "https://github.com/openequella/openEQUELLA/commit/019814ede747a61789d1678e42b4112d98b02e68", "message": "Wait until Owner Select dialog is closed.", "committedDate": "2020-10-10T08:25:52Z", "type": "commit"}, {"oid": "51ebf38b42bce89630e7952ccaa473652712e1b5", "url": "https://github.com/openequella/openEQUELLA/commit/51ebf38b42bce89630e7952ccaa473652712e1b5", "message": "Wait until the whole MUI Owner select Dialog is closed.", "committedDate": "2020-10-10T22:33:40Z", "type": "commit"}, {"oid": "56a32348fe47c4dcc0603a6079ec2b8295edf394", "url": "https://github.com/openequella/openEQUELLA/commit/56a32348fe47c4dcc0603a6079ec2b8295edf394", "message": "Testing code to check what UI mode NewSearchPageTest\nis running against.", "committedDate": "2020-10-10T22:45:04Z", "type": "commit"}, {"oid": "cc97a410146632c770810d61d0647a5fe031b94a", "url": "https://github.com/openequella/openEQUELLA/commit/cc97a410146632c770810d61d0647a5fe031b94a", "message": "Revert the abstract method of opening ItemSummary\nPage to check why this page is incorrectly open.", "committedDate": "2020-10-11T01:38:19Z", "type": "commit"}, {"oid": "b14c3b196afdecb938975a3ef514bdf10969fa0b", "url": "https://github.com/openequella/openEQUELLA/commit/b14c3b196afdecb938975a3ef514bdf10969fa0b", "message": "Revert \"Revert the abstract method of opening ItemSummary\"\n\nThis reverts commit cc97a410146632c770810d61d0647a5fe031b94a.", "committedDate": "2020-10-11T05:35:28Z", "type": "commit"}, {"oid": "b90041c63802510a45f4b8bbf8adf9b44ed54825", "url": "https://github.com/openequella/openEQUELLA/commit/b90041c63802510a45f4b8bbf8adf9b44ed54825", "message": "Take screenshots to check if Summary page is on\nNew UI mode.", "committedDate": "2020-10-11T05:37:41Z", "type": "commit"}, {"oid": "3366c9e39fb44a264e0ac86ac2ba4f90c8b6ec95", "url": "https://github.com/openequella/openEQUELLA/commit/3366c9e39fb44a264e0ac86ac2ba4f90c8b6ec95", "message": "Let 'Facet' Institution run in Old UI by default.", "committedDate": "2020-10-12T02:03:51Z", "type": "commit"}, {"oid": "2985f8e681052b3eab85ca7b100d07f76a1675c6", "url": "https://github.com/openequella/openEQUELLA/commit/2985f8e681052b3eab85ca7b100d07f76a1675c6", "message": "Remove NewSearchPageTest testing code.", "committedDate": "2020-10-12T02:33:09Z", "type": "commit"}, {"oid": "9a4941b84fcec9490dcf7a395257a92d75321869", "url": "https://github.com/openequella/openEQUELLA/commit/9a4941b84fcec9490dcf7a395257a92d75321869", "message": "Remove AxiosInstance testing code.", "committedDate": "2020-10-12T02:52:00Z", "type": "commit"}, {"oid": "008ce6eb77a2ce9f80c6c3c610e05e8321064ae6", "url": "https://github.com/openequella/openEQUELLA/commit/008ce6eb77a2ce9f80c6c3c610e05e8321064ae6", "message": "Revert changes made on AxiosInstance.ts", "committedDate": "2020-10-12T02:53:17Z", "type": "commit"}]}