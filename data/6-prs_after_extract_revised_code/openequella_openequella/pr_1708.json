{"pr_number": 1708, "pr_title": "Contribution wizard lost metadata fix", "pr_createdAt": "2020-05-07T00:28:45Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/1708", "timeline": [{"oid": "b3d3c6d5e15eb3996213f313c5dcfd7309f78bac", "url": "https://github.com/openequella/openEQUELLA/commit/b3d3c6d5e15eb3996213f313c5dcfd7309f78bac", "message": "Surround initilise page function with viewable check\n\nTo ensure metadata attributed to hidden pages is not wiped by the\nmandatory field check.", "committedDate": "2020-05-07T00:23:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE4Njg2MA==", "url": "https://github.com/openequella/openEQUELLA/pull/1708#discussion_r421186860", "bodyText": "So as to stay within the functional paradigm a bit, how's about:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    .forEach(\n          \n          \n            \n                        p -> {\n          \n          \n            \n                          if (p.isViewable()) {\n          \n          \n            \n                            wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true);\n          \n          \n            \n                          }\n          \n          \n            \n                        });\n          \n          \n            \n                    .stream().filter(WebWizardPage::isViewable)\n          \n          \n            \n                    .forEach(p -> wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true));\n          \n      \n    \n    \n  \n\nI think this also has a slight readability benefit.", "author": "edalex-ian", "createdAt": "2020-05-07T01:30:31Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java", "diffHunk": "@@ -305,6 +305,11 @@ void validateMandatoryFields(SectionInfo info, WizardState state) {\n     PagesSection ps = info.lookupSection(PagesSection.class);\n     wizardService\n         .getWizardPages(state)\n-        .forEach(p -> wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true));\n+        .forEach(\n+            p -> {\n+              if (p.isViewable()) {\n+                wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true);\n+              }\n+            });", "originalCommit": "b3d3c6d5e15eb3996213f313c5dcfd7309f78bac", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6", "chunk": "diff --git a/Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java b/Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java\nindex 591173584..b9e8d40e8 100644\n--- a/Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java\n+++ b/Source/Plugins/Core/com.equella.core/src/com/tle/web/wizard/section/RootWizardSection.java\n\n@@ -305,11 +305,7 @@ public class RootWizardSection extends TwoColumnLayout<WizardForm>\n     PagesSection ps = info.lookupSection(PagesSection.class);\n     wizardService\n         .getWizardPages(state)\n-        .forEach(\n-            p -> {\n-              if (p.isViewable()) {\n-                wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true);\n-              }\n-            });\n+        .stream().filter(WebWizardPage::isViewable)\n+        .forEach(p -> wizardService.ensureInitialisedPage(info, p, ps.getReloadFunction(), true));\n   }\n }\n"}}, {"oid": "0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6", "url": "https://github.com/openequella/openEQUELLA/commit/0785e0c7f1d13c0df7ac983eb74d9f55275aa2c6", "message": "Make viewable check a filter rather than an if statement\n\nCo-authored-by: edalex-ian <43919233+edalex-ian@users.noreply.github.com>", "committedDate": "2020-05-07T01:35:28Z", "type": "commit"}, {"oid": "f786b71e48fb4d7d28ee5efa6ab65c9cd1c225d8", "url": "https://github.com/openequella/openEQUELLA/commit/f786b71e48fb4d7d28ee5efa6ab65c9cd1c225d8", "message": "Add import statement for WebWizardPage", "committedDate": "2020-05-07T01:36:58Z", "type": "commit"}]}