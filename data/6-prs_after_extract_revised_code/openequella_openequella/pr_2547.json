{"pr_number": 2547, "pr_title": "Feature/select resource from new search page", "pr_createdAt": "2020-11-24T06:14:25Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2547", "timeline": [{"oid": "93c429905bd7016ed87b072415e6f812e275b382", "url": "https://github.com/openequella/openEQUELLA/commit/93c429905bd7016ed87b072415e6f812e275b382", "message": "Ignore eslint checks for legacy JS code.", "committedDate": "2020-11-16T06:29:53Z", "type": "commit"}, {"oid": "fcc9e8895f6a3a0fcf7652b89e822c43ca544172", "url": "https://github.com/openequella/openEQUELLA/commit/fcc9e8895f6a3a0fcf7652b89e822c43ca544172", "message": "Refactor legacy code to support select resources\nfrom new search UI. This includes:\n\n1. Separate the functionality of updating course list\nto a single function.\n\n2. Improve function 'selectAllAttachmentsFunction'.\n3. Some tweaks for 'CourseListSection'.", "committedDate": "2020-11-16T06:30:05Z", "type": "commit"}, {"oid": "ff8ef0136aeaba34f0eec58270efb2f8ec36748c", "url": "https://github.com/openequella/openEQUELLA/commit/ff8ef0136aeaba34f0eec58270efb2f8ec36748c", "message": "Change the type of parameters passed to 'selectAllAttachments'.", "committedDate": "2020-11-17T23:06:36Z", "type": "commit"}, {"oid": "a3147aeb185905f23dd0b14dc2893ce615c2306c", "url": "https://github.com/openequella/openEQUELLA/commit/a3147aeb185905f23dd0b14dc2893ce615c2306c", "message": "Export interface 'LegacyContentResponse'.", "committedDate": "2020-11-17T23:39:08Z", "type": "commit"}, {"oid": "445e74c6e3945e4a78bcc15f29f1a85af07c9d90", "url": "https://github.com/openequella/openEQUELLA/commit/445e74c6e3945e4a78bcc15f29f1a85af07c9d90", "message": "Fundamentals for selecting resources from new search UI. This includes:\n\n1. A few type definitions for required data structure.\n2. Two functions that build request URL and body data .\n3. An abstract function sending request to server and firing callbacks.\n4. A function updating the 'selection-summary' div in 'selectOrAdd'.", "committedDate": "2020-11-18T03:39:21Z", "type": "commit"}, {"oid": "5559061c2f4b45a84c320ee1bd47d4a95588ab9f", "url": "https://github.com/openequella/openEQUELLA/commit/5559061c2f4b45a84c320ee1bd47d4a95588ab9f", "message": "Integrate SearchResult with SelectionSessionModule.", "committedDate": "2020-11-18T03:40:37Z", "type": "commit"}, {"oid": "04dc17ef0928dc14875da663d044f181b6dca4af", "url": "https://github.com/openequella/openEQUELLA/commit/04dc17ef0928dc14875da663d044f181b6dca4af", "message": "Ensure new search page search options persist when\nresources are unselected from the course list.", "committedDate": "2020-11-18T22:05:36Z", "type": "commit"}, {"oid": "96e47275b291dc13a1cc3a8101b03099fc2902e8", "url": "https://github.com/openequella/openEQUELLA/commit/96e47275b291dc13a1cc3a8101b03099fc2902e8", "message": "Tidy ups for SelectionSessionModule.", "committedDate": "2020-11-18T23:19:32Z", "type": "commit"}, {"oid": "c4292285632261cf5b959ca0aab6aa2fb69b6efd", "url": "https://github.com/openequella/openEQUELLA/commit/c4292285632261cf5b959ca0aab6aa2fb69b6efd", "message": "Create a server event handler for selecting attachments\nfrom new search UI in 'selectOrAdd'.\n\nThe existing handler will unselect an attachment if the\nattachment is selected, which is not needed in new search\nUI. So implement a new handler which only adds an attachment.", "committedDate": "2020-11-19T05:46:49Z", "type": "commit"}, {"oid": "5f783b3a257af6c241b1426509b0bc779a4a71a3", "url": "https://github.com/openequella/openEQUELLA/commit/5f783b3a257af6c241b1426509b0bc779a4a71a3", "message": "Allow the Selection Summary panel to be updated by\nan ajax request when new search UI is enabled.\n\nTo achieve this, the JS file for AJAX Effect must be\nincluded in the context of new search UI.", "committedDate": "2020-11-19T05:50:28Z", "type": "commit"}, {"oid": "f5033e4eeddf9c3439282a3b8c8d4ed5620d903f", "url": "https://github.com/openequella/openEQUELLA/commit/f5033e4eeddf9c3439282a3b8c8d4ed5620d903f", "message": "Remove redundant field 'isAllAttachments' for 'SelectResourceProps'.", "committedDate": "2020-11-20T00:29:25Z", "type": "commit"}, {"oid": "89f371a40d86e2e6d3e18b4506bd5d925581704b", "url": "https://github.com/openequella/openEQUELLA/commit/89f371a40d86e2e6d3e18b4506bd5d925581704b", "message": "Use JS History API to navigate from Selection Checkout page\nback to Search page.\n\nThe previous approach is to refresh the whole page which works\nfine for Old UI. But with new search UI refreshing the page\nwill result in missing search options. Luckily, new search UI\ncan read search options stored in Browser history. Therefore,\nusing JS History API is probably the best way at this stage.\nAnd it still works fine with Old UI.", "committedDate": "2020-11-20T00:43:14Z", "type": "commit"}, {"oid": "4ae4e596b21faf2ebc90b47dd02228804fc44050", "url": "https://github.com/openequella/openEQUELLA/commit/4ae4e596b21faf2ebc90b47dd02228804fc44050", "message": "Merge branch 'component/new-search-page-in-selection-section' into feature/select-resource-from-new-search-page", "committedDate": "2020-11-23T04:50:29Z", "type": "commit"}, {"oid": "194bd57aa260b8abe38d939cc89982761edbbf4b", "url": "https://github.com/openequella/openEQUELLA/commit/194bd57aa260b8abe38d939cc89982761edbbf4b", "message": "Update SelectionSessionModule and SearchResult\n\n1. Remove redundant interface 'SelectResourceProps'.\n2. Centralise the validation for Selection Session info\ninb one function.\n3. Update comments and clean up the code.", "committedDate": "2020-11-23T06:09:04Z", "type": "commit"}, {"oid": "24a5e0b54d37180aa9f78e5346b255720ff7a892", "url": "https://github.com/openequella/openEQUELLA/commit/24a5e0b54d37180aa9f78e5346b255720ff7a892", "message": "Merge branch 'component/new-search-page-in-selection-section' into feature/select-resource-from-new-search-page", "committedDate": "2020-11-24T00:53:44Z", "type": "commit"}, {"oid": "23d6398634f8aa48837f5d81a26d316d6a3e55db", "url": "https://github.com/openequella/openEQUELLA/commit/23d6398634f8aa48837f5d81a26d316d6a3e55db", "message": "Merge branch 'component/new-search-page-in-selection-section' into feature/select-resource-from-new-search-page", "committedDate": "2020-11-24T02:42:53Z", "type": "commit"}, {"oid": "8b7ff79a299b89a3d1fee9414389ceb2b30e3d50", "url": "https://github.com/openequella/openEQUELLA/commit/8b7ff79a299b89a3d1fee9414389ceb2b30e3d50", "message": "Do not convert query string params to search options\nin Selection Session.", "committedDate": "2020-11-24T03:12:44Z", "type": "commit"}, {"oid": "48381b6cf4e8fbb83c3fdd9fdb8447377d86c84d", "url": "https://github.com/openequella/openEQUELLA/commit/48381b6cf4e8fbb83c3fdd9fdb8447377d86c84d", "message": "Clean up SelectionSessionModule.", "committedDate": "2020-11-24T03:32:58Z", "type": "commit"}, {"oid": "4855002a821578f1f9d704adf83a64c3952385a5", "url": "https://github.com/openequella/openEQUELLA/commit/4855002a821578f1f9d704adf83a64c3952385a5", "message": "Add a Jest test for selecting resources from new search UI.", "committedDate": "2020-11-24T05:26:17Z", "type": "commit"}, {"oid": "c68835ad06a7fa4a6dfe7142027951c4af249eb6", "url": "https://github.com/openequella/openEQUELLA/commit/c68835ad06a7fa4a6dfe7142027951c4af249eb6", "message": "Add more Jest tests in SelectionSessionModule.", "committedDate": "2020-11-24T05:59:56Z", "type": "commit"}, {"oid": "d958c14054b5ad57e1b6bfb4e7ff1b8f9c338574", "url": "https://github.com/openequella/openEQUELLA/commit/d958c14054b5ad57e1b6bfb4e7ff1b8f9c338574", "message": "Move the test for function 'isSelectionSessionOpen' to\nits own describe block.", "committedDate": "2020-11-24T22:46:33Z", "type": "commit"}, {"oid": "7f4fdffe74ca53201cbe4305086616c114398755", "url": "https://github.com/openequella/openEQUELLA/commit/7f4fdffe74ca53201cbe4305086616c114398755", "message": "Make sure the course list is reloaded when the Selection\nDialog is closed by the close button.", "committedDate": "2020-11-24T23:37:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1MTMxOQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2547#discussion_r530151319", "bodyText": "Sorry, I've lost track of the threads. Where is this triggered from?", "author": "edalex-ian", "createdAt": "2020-11-25T07:15:52Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/web/itemlist/standard/AbstractItemlikeListAttachmentDisplaySection.java", "diffHunk": "@@ -396,7 +394,42 @@ public void selectAttachment(\n     final AttachmentDisplayModel<I> model = getModel(info);\n     model.setShow(true);\n     model.setItemId(itemId);\n+  }\n+\n+  private void addAttachment(\n+      SectionInfo info, String attachmentUuid, ItemId itemId, String extensionType) {\n+    final IAttachment attachment =\n+        new UnmodifiableAttachments(getCachedItem(info, itemId))\n+            .getAttachmentByUuid(attachmentUuid);\n+    if (attachment != null) {\n+      final ViewableItem<I> viewableItem = getViewableItem(getItem(itemId));\n+      final SelectAttachmentHandler selectAttachmentHandler =\n+          selectionService.getSelectAttachmentHandler(info, viewableItem, attachmentUuid);\n+      if (selectAttachmentHandler != null) {\n+        selectAttachmentHandler.handleAttachmentSelection(\n+            info, itemId, attachment, extensionType, true);\n+      }\n+    }\n+  }\n \n+  @EventHandlerMethod\n+  public void selectAttachmentsFromNewSearch(", "originalCommit": "7f4fdffe74ca53201cbe4305086616c114398755", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDY4NzcyMQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2547#discussion_r530687721", "bodyText": "The only usage of this is in SelectionSessionModule.ts. There is an existing one named selectAttachment, and there are two key differences:\n\nthis one will not unselect an attachment if the button is clicked again.\nthis one supports selecting multiple attachments.", "author": "PenghaiZhang", "createdAt": "2020-11-25T23:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1MTMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcwNzY1MQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2547#discussion_r530707651", "bodyText": "Ah! How it is triggered? Just but building up the correct events etc for the POST?", "author": "edalex-ian", "createdAt": "2020-11-26T00:31:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1MTMxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDcyMDU1OA==", "url": "https://github.com/openequella/openEQUELLA/pull/2547#discussion_r530720558", "bodyText": "Yes, but we must tell the server the correct section, which is ilad here.\nilad is probably the short name of AbstractItemlikeListAttachmentDisplaySection.\nThat is why I did\n event__: [`ilad.selectAttachmentsFromNewSearch`],\n\nI am pretty sure I have seen how server processes this event__ and finds the matched method from the section. But I can't remember much detail now...", "author": "PenghaiZhang", "createdAt": "2020-11-26T01:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1MTMxOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c2a3e7520c0ed6266659c1aa92df1c7fbdc2204c", "url": "https://github.com/openequella/openEQUELLA/commit/c2a3e7520c0ed6266659c1aa92df1c7fbdc2204c", "message": "Rename SelectionSessionModule to LegacySelectionSessionModule", "committedDate": "2020-11-25T23:34:58Z", "type": "commit"}, {"oid": "97b0befc798302051a51f725b2e5a9338846ab08", "url": "https://github.com/openequella/openEQUELLA/commit/97b0befc798302051a51f725b2e5a9338846ab08", "message": "Tweaks for LegacySelectionSessionModule test.", "committedDate": "2020-11-25T23:45:02Z", "type": "commit"}, {"oid": "18435d69c5ee7cb2e3dd7a52031145032055eaed", "url": "https://github.com/openequella/openEQUELLA/commit/18435d69c5ee7cb2e3dd7a52031145032055eaed", "message": "Add one more Jest test for not showing selection\nbuttons in non-Selection Sessions.\n\nAlso improve readability of the test for showing and\nclicking selection buttons.", "committedDate": "2020-11-26T02:45:07Z", "type": "commit"}, {"oid": "faa38abe4dc8e00a52387c928126635da7eca9bb", "url": "https://github.com/openequella/openEQUELLA/commit/faa38abe4dc8e00a52387c928126635da7eca9bb", "message": "Tidy ups for LegacySelectionSessionModule.", "committedDate": "2020-11-26T02:45:53Z", "type": "commit"}, {"oid": "9c2a39d947d9c44bfa5d2d093cc1d04bcf7a3670", "url": "https://github.com/openequella/openEQUELLA/commit/9c2a39d947d9c44bfa5d2d093cc1d04bcf7a3670", "message": "Fix the comment format issue in 'attachments.js'.", "committedDate": "2020-11-26T02:47:52Z", "type": "commit"}, {"oid": "8dddd58a4651ffc8ca0df1fa626d29d5860fb021", "url": "https://github.com/openequella/openEQUELLA/commit/8dddd58a4651ffc8ca0df1fa626d29d5860fb021", "message": "Centralise mocked 'renderData' and 'getRenderData'\ninto a helper file.", "committedDate": "2020-11-26T03:21:10Z", "type": "commit"}, {"oid": "910096e996f444fcedc7d3b7a7ebad5c2f3d3e06", "url": "https://github.com/openequella/openEQUELLA/commit/910096e996f444fcedc7d3b7a7ebad5c2f3d3e06", "message": "Add Jest tests for building the data sent to\nLegacy Selection Session endpoints.", "committedDate": "2020-11-26T04:45:29Z", "type": "commit"}, {"oid": "c79dd2bb0fe7417c8d58b52acf0d770777185bff", "url": "https://github.com/openequella/openEQUELLA/commit/c79dd2bb0fe7417c8d58b52acf0d770777185bff", "message": "Move the test suite for 'buildPostDataForSelectOrAdd'\nto an independent describe block.", "committedDate": "2020-11-26T05:47:16Z", "type": "commit"}, {"oid": "0a1f862f07cd109ca32314bbc56f69438ac2e1fa", "url": "https://github.com/openequella/openEQUELLA/commit/0a1f862f07cd109ca32314bbc56f69438ac2e1fa", "message": "Simplify function 'makeSelection'.", "committedDate": "2020-11-26T05:55:00Z", "type": "commit"}]}