{"pr_number": 1274, "pr_title": "Create course groups in JIRA automatically based on the course short name", "pr_createdAt": "2020-03-18T15:25:14Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1274", "timeline": [{"oid": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8", "url": "https://github.com/ls1intum/Artemis/commit/9e2a99b914ed2defae3c197a34307dd4dfcc08b8", "message": "create course groups in JIRA automatically based on the course short name\n\nimprove error handling for courses and programming exercises\ncheck that short names are always unique\nin case of an error, automatically scroll up in the client", "committedDate": "2020-03-18T15:22:07Z", "type": "commit"}, {"oid": "e864b09c19091d29d5cf66971d7bc55987c7d836", "url": "https://github.com/ls1intum/Artemis/commit/e864b09c19091d29d5cf66971d7bc55987c7d836", "message": "Merge branch 'develop' into feature/course-automatic-groups", "committedDate": "2020-03-18T20:48:34Z", "type": "commit"}, {"oid": "267e050da96cb70b45559e05f5550c37e899bac0", "url": "https://github.com/ls1intum/Artemis/commit/267e050da96cb70b45559e05f5550c37e899bac0", "message": "fix course tests by mocking new jira calls", "committedDate": "2020-03-18T21:18:52Z", "type": "commit"}, {"oid": "24aba450c78355c6392ef81a3a46dd0354e18d9b", "url": "https://github.com/ls1intum/Artemis/commit/24aba450c78355c6392ef81a3a46dd0354e18d9b", "message": "implement removeGroupFromUsers and fix missing @Param in UserRepository", "committedDate": "2020-03-18T21:51:38Z", "type": "commit"}, {"oid": "3dc82b9ccaab5ed3682c1bab6a688e2d59834fa2", "url": "https://github.com/ls1intum/Artemis/commit/3dc82b9ccaab5ed3682c1bab6a688e2d59834fa2", "message": "Merge branch 'develop' into feature/course-automatic-groups", "committedDate": "2020-03-18T21:53:49Z", "type": "commit"}, {"oid": "aa69070333eda53eec712642ff03c6aa9c652230", "url": "https://github.com/ls1intum/Artemis/commit/aa69070333eda53eec712642ff03c6aa9c652230", "message": "do not delete groups that have not been created in artemis", "committedDate": "2020-03-19T06:05:37Z", "type": "commit"}, {"oid": "ede367528a80366946fbdaa6ca6e1e07ce371b65", "url": "https://github.com/ls1intum/Artemis/commit/ede367528a80366946fbdaa6ca6e1e07ce371b65", "message": "update delete test case", "committedDate": "2020-03-19T06:08:01Z", "type": "commit"}, {"oid": "b66f109312111c1b4158be026fb23c15ff18a2fc", "url": "https://github.com/ls1intum/Artemis/commit/b66f109312111c1b4158be026fb23c15ff18a2fc", "message": "additional check to prevent the deletion of groups in JIRA", "committedDate": "2020-03-19T06:14:16Z", "type": "commit"}, {"oid": "49d3204ee136e25756e4856a21d24d6789abc174", "url": "https://github.com/ls1intum/Artemis/commit/49d3204ee136e25756e4856a21d24d6789abc174", "message": "fix code style and test", "committedDate": "2020-03-19T06:22:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY3NDM0MA==", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394674340", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    // Cceck if the exercise title matches regex\n          \n          \n            \n                    // Check if the exercise title matches regex", "author": "jpbernius", "createdAt": "2020-03-18T22:25:59Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java", "diffHunk": "@@ -169,7 +170,7 @@ public ProgrammingExerciseResource(ProgrammingExerciseRepository programmingExer\n                     .headers(HeaderUtil.createAlert(applicationName, \"The title of the programming exercise is too short\", \"programmingExerciseTitleInvalid\")).body(null);\n         }\n \n-        // CHeck if the exercise title matches regex\n+        // Cceck if the exercise title matches regex", "originalCommit": "9e2a99b914ed2defae3c197a34307dd4dfcc08b8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\nindex a04235fd0..2ff56be96 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\n\n@@ -170,7 +170,7 @@ public class ProgrammingExerciseResource {\n                     .headers(HeaderUtil.createAlert(applicationName, \"The title of the programming exercise is too short\", \"programmingExerciseTitleInvalid\")).body(null);\n         }\n \n-        // Cceck if the exercise title matches regex\n+        // Check if the exercise title matches regex\n         Matcher titleMatcher = TITLE_NAME_PATTERN.matcher(programmingExercise.getTitle());\n         if (!titleMatcher.matches()) {\n             return ResponseEntity.badRequest().headers(HeaderUtil.createAlert(applicationName, \"The title is invalid\", \"titleInvalid\")).body(null);\n"}}, {"oid": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "url": "https://github.com/ls1intum/Artemis/commit/9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "message": "Update Typo in ProgrammingExerciseResource.java", "committedDate": "2020-03-19T11:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1ODg4MA==", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394958880", "bodyText": "Only the student group is deleted on Jira. Here is why:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getTeachingAssistantGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n          \n          \n            \n                    }\n          \n          \n            \n                    if (course.getInstructorGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n          \n          \n            \n                        artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n          \n          \n            \n                    }", "author": "jpbernius", "createdAt": "2020-03-19T11:28:45Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -620,7 +619,20 @@ private boolean userHasPermission(Course course, User user) {\n             notificationService.deleteNotification(notification);\n         }\n         String title = course.getTitle();\n+\n+        // only delete the groups if they have been created by Artemis before\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-students\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getStudentGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n+        }\n+        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n+            artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n+        }", "originalCommit": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8b6eae66cae8debd669b181902ca369c413ce660", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\nindex dd8ff3b72..6565c29ce 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n\n@@ -624,10 +624,10 @@ public class CourseResource {\n         if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-students\")) {\n             artemisAuthenticationProvider.deleteGroup(course.getStudentGroupName());\n         }\n-        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n+        if (course.getTeachingAssistantGroupName().equals(\"artemis-\" + course.getShortName() + \"-tutors\")) {\n             artemisAuthenticationProvider.deleteGroup(course.getTeachingAssistantGroupName());\n         }\n-        if (course.getStudentGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n+        if (course.getInstructorGroupName().equals(\"artemis-\" + course.getShortName() + \"-instructors\")) {\n             artemisAuthenticationProvider.deleteGroup(course.getInstructorGroupName());\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1OTI3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r394959271", "bodyText": "I am wondering if we should create the group names in the Course Object, as we use them multiple times.", "author": "jpbernius", "createdAt": "2020-03-19T11:29:32Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -141,22 +136,48 @@ public CourseResource(Environment env, UserService userService, CourseService co\n         if (course.getId() != null) {\n             throw new BadRequestAlertException(\"A new course cannot already have an ID\", ENTITY_NAME, \"idexists\");\n         }\n+\n+        // Check if course shortname matches regex\n+        Matcher shortNameMatcher = SHORT_NAME_PATTERN.matcher(course.getShortName());\n+        if (!shortNameMatcher.matches()) {\n+            return ResponseEntity.badRequest().headers(HeaderUtil.createAlert(applicationName, \"The shortname is invalid\", \"shortnameInvalid\")).body(null);\n+        }\n+\n+        List<Course> coursesWithSameShortName = courseRepository.findAllByShortName(course.getShortName());\n+        if (coursesWithSameShortName.size() > 0) {\n+            return ResponseEntity.badRequest().headers(\n+                    HeaderUtil.createAlert(applicationName, \"A course with the same short name already exists. Please choose a different short name.\", \"shortnameAlreadyExists\"))\n+                    .body(null);\n+        }\n+\n+        if (course.getStudentGroupName() != null) {\n+            throw new BadRequestAlertException(\"The student group name must be null when creating a course\", ENTITY_NAME, \"studentGroupNameCannotBeSet\");\n+        }\n+        if (course.getTeachingAssistantGroupName() != null) {\n+            throw new BadRequestAlertException(\"The teaching assistant group name must be null when creating a course\", ENTITY_NAME, \"teachingAssistantGroupNameCannotBeSet\");\n+        }\n+        if (course.getInstructorGroupName() != null) {\n+            throw new BadRequestAlertException(\"The instructor group name must be null when creating a course\", ENTITY_NAME, \"instructorGroupNameCannotBeSet\");\n+        }\n+\n         validateComplaintsConfig(course);\n+\n+        course.setStudentGroupName(\"artemis-\" + course.getShortName() + \"-students\");\n+        course.setTeachingAssistantGroupName(\"artemis-\" + course.getShortName() + \"-tutors\");\n+        course.setInstructorGroupName(\"artemis-\" + course.getShortName() + \"-instructors\");", "originalCommit": "9e266cd6c81fe9d9ad1dc12b56e3c6311df5f18f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAyMTgzMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1274#discussion_r395021831", "bodyText": "good point. I refactored it", "author": "krusche", "createdAt": "2020-03-19T13:25:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDk1OTI3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "2bbca3583e4c5ed2dbae77f2aa49a93c929056a4", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\nindex dd8ff3b72..4c3a34066 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n\n@@ -162,9 +162,9 @@ public class CourseResource {\n \n         validateComplaintsConfig(course);\n \n-        course.setStudentGroupName(\"artemis-\" + course.getShortName() + \"-students\");\n-        course.setTeachingAssistantGroupName(\"artemis-\" + course.getShortName() + \"-tutors\");\n-        course.setInstructorGroupName(\"artemis-\" + course.getShortName() + \"-instructors\");\n+        course.setStudentGroupName(course.getDefaultStudentGroupName());\n+        course.setTeachingAssistantGroupName(course.getDefaultTeachingAssistantGroupName());\n+        course.setInstructorGroupName(course.getDefaultInstructorGroupName());\n \n         try {\n             artemisAuthenticationProvider.createGroup(course.getStudentGroupName());\n"}}, {"oid": "8b6eae66cae8debd669b181902ca369c413ce660", "url": "https://github.com/ls1intum/Artemis/commit/8b6eae66cae8debd669b181902ca369c413ce660", "message": "Update src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n\nCo-Authored-By: Jan Philip Bernius <janphilip.bernius@tum.de>", "committedDate": "2020-03-19T13:10:43Z", "type": "commit"}, {"oid": "2bbca3583e4c5ed2dbae77f2aa49a93c929056a4", "url": "https://github.com/ls1intum/Artemis/commit/2bbca3583e4c5ed2dbae77f2aa49a93c929056a4", "message": "refactor group default names into Constant and into Course.java\n\nvalidate that programming exercise short name does not change during PUT", "committedDate": "2020-03-19T13:25:40Z", "type": "commit"}, {"oid": "4711360fce6b851ebd02a75c57a92b03984e9a14", "url": "https://github.com/ls1intum/Artemis/commit/4711360fce6b851ebd02a75c57a92b03984e9a14", "message": "Merge branch 'develop' into feature/course-automatic-groups", "committedDate": "2020-03-19T13:32:54Z", "type": "commit"}, {"oid": "1ee2faf21d0adfe97c5a6d0b80bf0c2f91552042", "url": "https://github.com/ls1intum/Artemis/commit/1ee2faf21d0adfe97c5a6d0b80bf0c2f91552042", "message": "Merge branch 'develop' into feature/course-automatic-groups", "committedDate": "2020-03-19T16:23:35Z", "type": "commit"}, {"oid": "d6f4f80dcf8d108e6a9af760fda22b4a39caffe7", "url": "https://github.com/ls1intum/Artemis/commit/d6f4f80dcf8d108e6a9af760fda22b4a39caffe7", "message": "count number of students, tutors and instructors for course management", "committedDate": "2020-03-19T17:31:57Z", "type": "commit"}]}