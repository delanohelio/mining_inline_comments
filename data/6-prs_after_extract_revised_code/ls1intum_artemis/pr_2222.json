{"pr_number": 2222, "pr_title": "[Feature] Structured Grading Instructions for Programming Exercises", "pr_createdAt": "2020-10-17T09:35:42Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2222", "timeline": [{"oid": "3e3299ab1d518d2fb3ed5c52b92d91453aca2768", "url": "https://github.com/ls1intum/Artemis/commit/3e3299ab1d518d2fb3ed5c52b92d91453aca2768", "message": "use jhi-assessment-instructions instead of programming-exercise-instructions", "committedDate": "2020-10-12T19:32:44Z", "type": "commit"}, {"oid": "455282c50c9b61296daa0911b718bf5e9e46e517", "url": "https://github.com/ls1intum/Artemis/commit/455282c50c9b61296daa0911b718bf5e9e46e517", "message": "enable structured grading criteria for programming exercise creation", "committedDate": "2020-10-13T07:11:28Z", "type": "commit"}, {"oid": "08e9ba52c8fc06baf1deb866f63041b00f0e60c0", "url": "https://github.com/ls1intum/Artemis/commit/08e9ba52c8fc06baf1deb866f63041b00f0e60c0", "message": "add sgi to tutor assessment view", "committedDate": "2020-10-13T15:15:47Z", "type": "commit"}, {"oid": "496beedbd05f0560733b9c8c0659276cc1ad204a", "url": "https://github.com/ls1intum/Artemis/commit/496beedbd05f0560733b9c8c0659276cc1ad204a", "message": "add drag and drop to inline feedback", "committedDate": "2020-10-13T15:28:06Z", "type": "commit"}, {"oid": "25b11386af2e9da2f331abe18fe037562ad74213", "url": "https://github.com/ls1intum/Artemis/commit/25b11386af2e9da2f331abe18fe037562ad74213", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-exercises/structured-grading-instructions", "committedDate": "2020-10-13T15:28:51Z", "type": "commit"}, {"oid": "6c7e25a4a50d215e94d82c4953ed95633b124f6f", "url": "https://github.com/ls1intum/Artemis/commit/6c7e25a4a50d215e94d82c4953ed95633b124f6f", "message": "add client test", "committedDate": "2020-10-13T21:38:02Z", "type": "commit"}, {"oid": "ac61786a2f72f0bf133f09557ff2b1f90a0ef0e0", "url": "https://github.com/ls1intum/Artemis/commit/ac61786a2f72f0bf133f09557ff2b1f90a0ef0e0", "message": "add comment", "committedDate": "2020-10-13T22:00:39Z", "type": "commit"}, {"oid": "43f9620cc49796c7b3054b4ab52788c6965c5eba", "url": "https://github.com/ls1intum/Artemis/commit/43f9620cc49796c7b3054b4ab52788c6965c5eba", "message": "add server tests", "committedDate": "2020-10-16T00:55:15Z", "type": "commit"}, {"oid": "622cc26ec2fa2c48b932eb5b0b645eb689a982ea", "url": "https://github.com/ls1intum/Artemis/commit/622cc26ec2fa2c48b932eb5b0b645eb689a982ea", "message": "add solution repo link to sample solution section\nfetch solution and template participation", "committedDate": "2020-10-17T09:34:00Z", "type": "commit"}, {"oid": "5ff6a042eb8cb80e05b22e8865c1afc263d99cb0", "url": "https://github.com/ls1intum/Artemis/commit/5ff6a042eb8cb80e05b22e8865c1afc263d99cb0", "message": "run prettier and spotless", "committedDate": "2020-10-17T09:50:37Z", "type": "commit"}, {"oid": "228b472badc44e341601dadbf4a16fdad3e0b3c3", "url": "https://github.com/ls1intum/Artemis/commit/228b472badc44e341601dadbf4a16fdad3e0b3c3", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-exercises/structured-grading-instructions", "committedDate": "2020-10-17T09:51:42Z", "type": "commit"}, {"oid": "c715fc8e725adae6de0a188df95615faf0177566", "url": "https://github.com/ls1intum/Artemis/commit/c715fc8e725adae6de0a188df95615faf0177566", "message": "add sgi layout for programming exercise details view\nadapt getProgrammingExercise REST call to fetch also sgi", "committedDate": "2020-10-17T12:53:36Z", "type": "commit"}, {"oid": "25b9187e73896977f2a89ce73e15b76b06ec69ea", "url": "https://github.com/ls1intum/Artemis/commit/25b9187e73896977f2a89ce73e15b76b06ec69ea", "message": "add server test", "committedDate": "2020-10-17T13:21:11Z", "type": "commit"}, {"oid": "a447261990b7df69001bab8e4abc64c9d0e22055", "url": "https://github.com/ls1intum/Artemis/commit/a447261990b7df69001bab8e4abc64c9d0e22055", "message": "run spotless", "committedDate": "2020-10-17T13:22:40Z", "type": "commit"}, {"oid": "94021daab0dd77c987a015051a7c3e3fa8da5445", "url": "https://github.com/ls1intum/Artemis/commit/94021daab0dd77c987a015051a7c3e3fa8da5445", "message": "try to make codacy happy", "committedDate": "2020-10-17T13:42:11Z", "type": "commit"}, {"oid": "2dc47dac78ce5798aeaf45c9634104c7f2d579db", "url": "https://github.com/ls1intum/Artemis/commit/2dc47dac78ce5798aeaf45c9634104c7f2d579db", "message": "remove commented out code", "committedDate": "2020-10-17T23:43:27Z", "type": "commit"}, {"oid": "0a66af5c56e6f92bab1cb37a4977f08d1434c5d9", "url": "https://github.com/ls1intum/Artemis/commit/0a66af5c56e6f92bab1cb37a4977f08d1434c5d9", "message": "fix github actions issue", "committedDate": "2020-10-17T23:43:55Z", "type": "commit"}, {"oid": "ed1dd43d29a5d6bf1558158110aa162d21cd63d3", "url": "https://github.com/ls1intum/Artemis/commit/ed1dd43d29a5d6bf1558158110aa162d21cd63d3", "message": "improve client test", "committedDate": "2020-10-17T23:51:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0NzEwNg==", "url": "https://github.com/ls1intum/Artemis/pull/2222#discussion_r507047106", "bodyText": "We only need the template and solution participation if the user is at least a teaching assistant or?\nIn that case, it would be better if we move this into the if block in line 110. This way we reduce unnecessary database calls. Same for the grading criteria in line 107.", "author": "anditurdiu", "createdAt": "2020-10-18T08:45:55Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java", "diffHunk": "@@ -93,10 +98,23 @@ public ProgrammingExerciseParticipationResource(ProgrammingExerciseParticipation\n         if (!programmingExerciseParticipationService.canAccessParticipation(participation.get())) {\n             return forbidden();\n         }\n-        if (!authCheckService.isAtLeastTeachingAssistantForExercise(participation.get().getExercise())) {\n+\n+        // Fetch template and solution participation into exercise of participation\n+        ProgrammingExercise exercise = (ProgrammingExercise) participation.get().getExercise();\n+        exercise = programmingExerciseService.findWithTemplateParticipationAndSolutionParticipationById(exercise.getId());", "originalCommit": "ed1dd43d29a5d6bf1558158110aa162d21cd63d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIwMjMzOA==", "url": "https://github.com/ls1intum/Artemis/pull/2222#discussion_r507202338", "bodyText": "The thing here is, that this REST call cannot be called from a student. So this check is legacy as I initially implemented it to also allow calls from students. I will remove this check :)", "author": "fde312", "createdAt": "2020-10-18T19:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzA0NzEwNg=="}], "type": "inlineReview", "revised_code": {"commit": "73aa62289582cfa2ac4eb3570ed6b4330f96add9", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java\nindex c94e4d8084..6c85201cd5 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseParticipationResource.java\n\n@@ -107,11 +107,6 @@ public class ProgrammingExerciseParticipationResource {\n         List<GradingCriterion> gradingCriteria = gradingCriterionService.findByExerciseIdWithEagerGradingCriteria(exercise.getId());\n         exercise.setGradingCriteria(gradingCriteria);\n \n-        if (!authCheckService.isAtLeastTeachingAssistantForExercise(exercise)) {\n-            // hide details that should not be shown to the students\n-            exercise.filterSensitiveInformation();\n-        }\n-\n         // Set exercise back to participation\n         participation.get().setExercise(exercise);\n \n"}}, {"oid": "c50eabd3821e54a8c95059dafd080baa8dc09e72", "url": "https://github.com/ls1intum/Artemis/commit/c50eabd3821e54a8c95059dafd080baa8dc09e72", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-exercises/structured-grading-instructions", "committedDate": "2020-10-18T19:17:47Z", "type": "commit"}, {"oid": "73aa62289582cfa2ac4eb3570ed6b4330f96add9", "url": "https://github.com/ls1intum/Artemis/commit/73aa62289582cfa2ac4eb3570ed6b4330f96add9", "message": "remove legacy check", "committedDate": "2020-10-18T19:52:29Z", "type": "commit"}, {"oid": "97326bee44d78502b3229e06b7710b8d0f9fa132", "url": "https://github.com/ls1intum/Artemis/commit/97326bee44d78502b3229e06b7710b8d0f9fa132", "message": "rename toggle flag", "committedDate": "2020-10-19T19:01:36Z", "type": "commit"}, {"oid": "d7578fea3f2ffe1a028b5c396a9b8861ed0111bb", "url": "https://github.com/ls1intum/Artemis/commit/d7578fea3f2ffe1a028b5c396a9b8861ed0111bb", "message": "use calculation from gradingInstructions", "committedDate": "2020-10-19T19:09:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1Mjc1Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2222#discussion_r508152752", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetParticipationWithResultsForStudentParticipation_forbidden' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-10-20T01:22:09Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseParticipationIntegrationTest.java", "diffHunk": "@@ -276,7 +276,39 @@ public void getLatestSubmissionsForExercise_instructor() throws Exception {\n \n     @Test\n     @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void getLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+    public void testGetLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+        request.getMap(exercisesBaseUrl + programmingExercise.getId() + \"/latest-pending-submissions\", HttpStatus.FORBIDDEN, Long.class, ProgrammingSubmission.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetParticipationWithResultsForStudentParticipation_success() throws Exception {\n+        database.addGradingInstructionsToExercise(programmingExercise);\n+        programmingExerciseRepository.save(programmingExercise);\n+        addStudentParticipationWithResult(AssessmentType.AUTOMATIC, ZonedDateTime.now());\n+        StudentParticipation participation = studentParticipationRepository.findAll().get(0);\n+\n+        ProgrammingExerciseStudentParticipation response = request.get(participationsBaseUrl + participation.getId() + \"/student-participation-with-results-and-feedbacks\",\n+                HttpStatus.OK, ProgrammingExerciseStudentParticipation.class);\n+        ProgrammingExercise exercise = (ProgrammingExercise) response.getExercise();\n+\n+        assertThat(exercise.getGradingCriteria().get(0).getStructuredGradingInstructions().size()).isEqualTo(1);\n+        assertThat(exercise.getGradingCriteria().get(1).getStructuredGradingInstructions().size()).isEqualTo(1);\n+        assertThat(response.getResults().iterator().next().getAssessmentType()).isEqualTo(AssessmentType.AUTOMATIC);\n+        assertThat(response.getResults().iterator().next().getResultString()).isEqualTo(\"x of y passed\");\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetParticipationWithResultsForStudentParticipation_notFound() throws Exception {\n+        StudentParticipation participation = database.addParticipationForExercise(programmingExercise, \"student1\");\n+        request.get(participationsBaseUrl + participation.getId() + \"/student-participation-with-results-and-feedbacks\", HttpStatus.NOT_FOUND,\n+                ProgrammingExerciseStudentParticipation.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"stidemt1\", roles = \"USER\")\n+    public void testGetParticipationWithResultsForStudentParticipation_forbidden() throws Exception {", "originalCommit": "d7578fea3f2ffe1a028b5c396a9b8861ed0111bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1Mjc1Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2222#discussion_r508152757", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetParticipationWithResultsForStudentParticipation_notFound' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-10-20T01:22:10Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseParticipationIntegrationTest.java", "diffHunk": "@@ -276,7 +276,39 @@ public void getLatestSubmissionsForExercise_instructor() throws Exception {\n \n     @Test\n     @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void getLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+    public void testGetLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+        request.getMap(exercisesBaseUrl + programmingExercise.getId() + \"/latest-pending-submissions\", HttpStatus.FORBIDDEN, Long.class, ProgrammingSubmission.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetParticipationWithResultsForStudentParticipation_success() throws Exception {\n+        database.addGradingInstructionsToExercise(programmingExercise);\n+        programmingExerciseRepository.save(programmingExercise);\n+        addStudentParticipationWithResult(AssessmentType.AUTOMATIC, ZonedDateTime.now());\n+        StudentParticipation participation = studentParticipationRepository.findAll().get(0);\n+\n+        ProgrammingExerciseStudentParticipation response = request.get(participationsBaseUrl + participation.getId() + \"/student-participation-with-results-and-feedbacks\",\n+                HttpStatus.OK, ProgrammingExerciseStudentParticipation.class);\n+        ProgrammingExercise exercise = (ProgrammingExercise) response.getExercise();\n+\n+        assertThat(exercise.getGradingCriteria().get(0).getStructuredGradingInstructions().size()).isEqualTo(1);\n+        assertThat(exercise.getGradingCriteria().get(1).getStructuredGradingInstructions().size()).isEqualTo(1);\n+        assertThat(response.getResults().iterator().next().getAssessmentType()).isEqualTo(AssessmentType.AUTOMATIC);\n+        assertThat(response.getResults().iterator().next().getResultString()).isEqualTo(\"x of y passed\");\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetParticipationWithResultsForStudentParticipation_notFound() throws Exception {", "originalCommit": "d7578fea3f2ffe1a028b5c396a9b8861ed0111bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE1Mjc2Mg==", "url": "https://github.com/ls1intum/Artemis/pull/2222#discussion_r508152762", "bodyText": "Codacy found an issue: The JUnit 5 test method name 'testGetParticipationWithResultsForStudentParticipation_success' doesn't match '[a-z][a-zA-Z0-9]*'", "author": "artemis-bot", "createdAt": "2020-10-20T01:22:11Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseParticipationIntegrationTest.java", "diffHunk": "@@ -276,7 +276,39 @@ public void getLatestSubmissionsForExercise_instructor() throws Exception {\n \n     @Test\n     @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void getLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+    public void testGetLatestSubmissionsForExercise_studentForbidden() throws Exception {\n+        request.getMap(exercisesBaseUrl + programmingExercise.getId() + \"/latest-pending-submissions\", HttpStatus.FORBIDDEN, Long.class, ProgrammingSubmission.class);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"instructor1\", roles = \"INSTRUCTOR\")\n+    public void testGetParticipationWithResultsForStudentParticipation_success() throws Exception {", "originalCommit": "d7578fea3f2ffe1a028b5c396a9b8861ed0111bb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "9eb2efb98bc4a8d4b13a010fd631226b28211a42", "url": "https://github.com/ls1intum/Artemis/commit/9eb2efb98bc4a8d4b13a010fd631226b28211a42", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-exercises/structured-grading-instructions", "committedDate": "2020-10-20T07:48:01Z", "type": "commit"}, {"oid": "40e16583d5da4604d94b55a0f68c37863a404c9b", "url": "https://github.com/ls1intum/Artemis/commit/40e16583d5da4604d94b55a0f68c37863a404c9b", "message": "fix issue with cancelling assessment and rename variable", "committedDate": "2020-10-20T10:15:33Z", "type": "commit"}, {"oid": "db573e7258cd011bb060dc94506adbcac0af4980", "url": "https://github.com/ls1intum/Artemis/commit/db573e7258cd011bb060dc94506adbcac0af4980", "message": "fix test", "committedDate": "2020-10-20T10:33:49Z", "type": "commit"}, {"oid": "9dff0bb8cda100246177ccce9eb1401be50e94b0", "url": "https://github.com/ls1intum/Artemis/commit/9dff0bb8cda100246177ccce9eb1401be50e94b0", "message": "fix issue with cancel button for saved feedback", "committedDate": "2020-10-20T16:17:57Z", "type": "commit"}, {"oid": "bd1553452e5ec5df3730f2121cee72a4e49b8934", "url": "https://github.com/ls1intum/Artemis/commit/bd1553452e5ec5df3730f2121cee72a4e49b8934", "message": "Merge branch 'develop' into feature/programming-exercises/structured-grading-instructions", "committedDate": "2020-10-20T16:18:16Z", "type": "commit"}]}