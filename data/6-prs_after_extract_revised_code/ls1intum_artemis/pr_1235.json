{"pr_number": 1235, "pr_title": "Chore: Add tests for Submission Resource", "pr_createdAt": "2020-02-10T13:37:43Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1235", "timeline": [{"oid": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "url": "https://github.com/ls1intum/Artemis/commit/d01d67220c83af4f1e9af7baacdd8997a971d8f1", "message": "Add tests for Submission Resource", "committedDate": "2020-02-10T12:50:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTUwMw==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377069503", "bodyText": "I didn't find any usage of the endpoints except the delete one. They didn't have any authorization checks and in my opinion can cause security issues. I would suggest to remove them. Should I do that @krusche ?", "author": "maxr96", "createdAt": "2020-02-10T13:44:10Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java", "diffHunk": "@@ -65,6 +65,7 @@ public SubmissionResource(SubmissionRepository submissionRepository, ResultServi\n      * @throws URISyntaxException if the Location URI syntax is incorrect\n      */\n     @PostMapping(\"/submissions\")\n+    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk5NzE1NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r378997155", "bodyText": "yes, please remove the unused endpoints, but double check that they are really unused", "author": "krusche", "createdAt": "2020-02-13T17:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA2OTUwMw=="}], "type": "inlineReview", "revised_code": {"commit": "e9cb357434e724a96d67c54c3517ae7702537683", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java\nindex 7498fedab6..140825d675 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/SubmissionResource.java\n\n@@ -57,70 +52,6 @@ public class SubmissionResource {\n         this.userService = userService;\n     }\n \n-    /**\n-     * POST /submissions : Create a new submission.\n-     *\n-     * @param submission the submission to create\n-     * @return the ResponseEntity with status 201 (Created) and with body the new submission, or with status 400 (Bad Request) if the submission has already an ID\n-     * @throws URISyntaxException if the Location URI syntax is incorrect\n-     */\n-    @PostMapping(\"/submissions\")\n-    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n-    public ResponseEntity<Submission> createSubmission(@RequestBody Submission submission) throws URISyntaxException {\n-        log.debug(\"REST request to save Submission : {}\", submission);\n-        if (submission.getId() != null) {\n-            throw new BadRequestAlertException(\"A new submission cannot already have an ID\", ENTITY_NAME, \"idexists\");\n-        }\n-        Submission result = submissionRepository.save(submission);\n-        return ResponseEntity.created(new URI(\"/api/submissions/\" + result.getId()))\n-                .headers(HeaderUtil.createEntityCreationAlert(applicationName, true, ENTITY_NAME, result.getId().toString())).body(result);\n-    }\n-\n-    /**\n-     * PUT /submissions : Updates an existing submission.\n-     *\n-     * @param submission the submission to update\n-     * @return the ResponseEntity with status 200 (OK) and with body the updated submission, or with status 400 (Bad Request) if the submission is not valid, or with status 500\n-     *         (Internal Server Error) if the submission couldn't be updated\n-     * @throws URISyntaxException if the Location URI syntax is incorrect\n-     */\n-    @PutMapping(\"/submissions\")\n-    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n-    public ResponseEntity<Submission> updateSubmission(@RequestBody Submission submission) throws URISyntaxException {\n-        log.debug(\"REST request to update Submission : {}\", submission);\n-        if (submission.getId() == null) {\n-            return createSubmission(submission);\n-        }\n-        Submission result = submissionRepository.save(submission);\n-        return ResponseEntity.ok().headers(HeaderUtil.createEntityUpdateAlert(applicationName, true, ENTITY_NAME, submission.getId().toString())).body(result);\n-    }\n-\n-    /**\n-     * GET /submissions : get all the submissions.\n-     *\n-     * @return the ResponseEntity with status 200 (OK) and the list of submissions in body\n-     */\n-    @GetMapping(\"/submissions\")\n-    @PreAuthorize(\"hasAnyRole('TA', 'INSTRUCTOR', 'ADMIN')\")\n-    public List<Submission> getAllSubmissions() {\n-        log.debug(\"REST request to get all Submissions\");\n-        return submissionRepository.findAll();\n-    }\n-\n-    /**\n-     * GET /submissions/:id : get the \"id\" submission.\n-     *\n-     * @param id the id of the submission to retrieve\n-     * @return the ResponseEntity with status 200 (OK) and with body the submission, or with status 404 (Not Found)\n-     */\n-    @GetMapping(\"/submissions/{id}\")\n-    @PreAuthorize(\"hasAnyRole('USER', 'TA', 'INSTRUCTOR', 'ADMIN')\")\n-    public ResponseEntity<Submission> getSubmission(@PathVariable Long id) {\n-        log.debug(\"REST request to get Submission : {}\", id);\n-        Optional<Submission> submission = submissionRepository.findById(id);\n-        return ResponseUtil.wrapOrNotFound(submission);\n-    }\n-\n     /**\n      * DELETE /submissions/:id : delete the \"id\" submission.\n      *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NDI4OA==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377074288", "bodyText": "Could you change an attribute and then verify that it has actually changed?", "author": "HanyaElhashemy", "createdAt": "2020-02-10T13:52:49Z", "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e9cb357434e724a96d67c54c3517ae7702537683", "chunk": "diff --git a/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java b/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\nindex 7052831310..c6577d6c52 100644\n--- a/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\n+++ b/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\n\n@@ -94,49 +92,4 @@ public class ParticipationSubmissionIntegrationTest extends AbstractSpringIntegr\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void createSubmission() throws Exception {\n-        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void createSubmission_withId() throws Exception {\n-        var submission = new TextSubmission();\n-        submission.setId(1L);\n-        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void updateSubmission() throws Exception {\n-        var submission = new TextSubmission();\n-        submissionRepository.save(submission);\n-        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.OK);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void updateSubmission_noId() throws Exception {\n-        var submission = new TextSubmission();\n-        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.CREATED);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n-    public void getAllSubmissions() throws Exception {\n-        submissionRepository.save(new TextSubmission());\n-        submissionRepository.save(new ModelingSubmission());\n-        List<Submission> submissions = request.getList(\"/api/submissions\", HttpStatus.OK, Submission.class);\n-        assertThat(submissions.size()).isEqualTo(2);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n-    public void getSubmission() throws Exception {\n-        var submission = submissionRepository.save(new TextSubmission());\n-        request.get(\"/api/submissions/\" + submission.getId(), HttpStatus.OK, Submission.class);\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzA3NTQ4Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1235#discussion_r377075487", "bodyText": "could you assert that the properties of the received submission have the expected values?", "author": "HanyaElhashemy", "createdAt": "2020-02-10T13:55:00Z", "path": "src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java", "diffHunk": "@@ -83,4 +94,49 @@ public void deleteParticipation_forbidden_tutor() throws Exception {\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission() throws Exception {\n+        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void createSubmission_withId() throws Exception {\n+        var submission = new TextSubmission();\n+        submission.setId(1L);\n+        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission() throws Exception {\n+        var submission = new TextSubmission();\n+        submissionRepository.save(submission);\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.OK);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"student1\", roles = \"USER\")\n+    public void updateSubmission_noId() throws Exception {\n+        var submission = new TextSubmission();\n+        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.CREATED);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getAllSubmissions() throws Exception {\n+        submissionRepository.save(new TextSubmission());\n+        submissionRepository.save(new ModelingSubmission());\n+        List<Submission> submissions = request.getList(\"/api/submissions\", HttpStatus.OK, Submission.class);\n+        assertThat(submissions.size()).isEqualTo(2);\n+    }\n+\n+    @Test\n+    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n+    public void getSubmission() throws Exception {\n+        var submission = submissionRepository.save(new TextSubmission());", "originalCommit": "d01d67220c83af4f1e9af7baacdd8997a971d8f1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e9cb357434e724a96d67c54c3517ae7702537683", "chunk": "diff --git a/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java b/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\nindex 7052831310..c6577d6c52 100644\n--- a/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\n+++ b/src/test/java/de/tum/in/www1/artemis/ParticipationSubmissionIntegrationTest.java\n\n@@ -94,49 +92,4 @@ public class ParticipationSubmissionIntegrationTest extends AbstractSpringIntegr\n     public void deleteParticipation_notFound() throws Exception {\n         request.delete(\"/api/submissions/\" + 1, HttpStatus.NOT_FOUND);\n     }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void createSubmission() throws Exception {\n-        request.postWithResponseBody(\"/api/submissions\", new TextSubmission(), Submission.class, HttpStatus.CREATED);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void createSubmission_withId() throws Exception {\n-        var submission = new TextSubmission();\n-        submission.setId(1L);\n-        request.postWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.BAD_REQUEST);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void updateSubmission() throws Exception {\n-        var submission = new TextSubmission();\n-        submissionRepository.save(submission);\n-        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.OK);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"student1\", roles = \"USER\")\n-    public void updateSubmission_noId() throws Exception {\n-        var submission = new TextSubmission();\n-        request.putWithResponseBody(\"/api/submissions\", submission, Submission.class, HttpStatus.CREATED);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n-    public void getAllSubmissions() throws Exception {\n-        submissionRepository.save(new TextSubmission());\n-        submissionRepository.save(new ModelingSubmission());\n-        List<Submission> submissions = request.getList(\"/api/submissions\", HttpStatus.OK, Submission.class);\n-        assertThat(submissions.size()).isEqualTo(2);\n-    }\n-\n-    @Test\n-    @WithMockUser(username = \"tutor1\", roles = \"TA\")\n-    public void getSubmission() throws Exception {\n-        var submission = submissionRepository.save(new TextSubmission());\n-        request.get(\"/api/submissions/\" + submission.getId(), HttpStatus.OK, Submission.class);\n-    }\n }\n"}}, {"oid": "e9cb357434e724a96d67c54c3517ae7702537683", "url": "https://github.com/ls1intum/Artemis/commit/e9cb357434e724a96d67c54c3517ae7702537683", "message": "Removed unused code", "committedDate": "2020-02-15T22:23:47Z", "type": "commit"}]}