{"pr_number": 1664, "pr_title": "[Exam] Management: Follow-up fixes", "pr_createdAt": "2020-06-16T11:10:47Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1664", "timeline": [{"oid": "f0d9c3260c985cf4da3527d864781cb54836eb70", "url": "https://github.com/ls1intum/Artemis/commit/f0d9c3260c985cf4da3527d864781cb54836eb70", "message": "Make sure that exercise groups are preserved on exam update", "committedDate": "2020-06-16T09:17:26Z", "type": "commit"}, {"oid": "f3901c8e7dd3ecf34ead2629bc44ccc443bdc429", "url": "https://github.com/ls1intum/Artemis/commit/f3901c8e7dd3ecf34ead2629bc44ccc443bdc429", "message": "Save exerciseGroups as part of exam. Otherwise the order column won't get set correctly.", "committedDate": "2020-06-16T09:26:29Z", "type": "commit"}, {"oid": "058f5630e9af37ccbd24559e1163eef1c9192aa2", "url": "https://github.com/ls1intum/Artemis/commit/058f5630e9af37ccbd24559e1163eef1c9192aa2", "message": "Update the delete functions of ExamResource & CourseResource\nNow they delete all child elements first. Also updated the warning to make it clear that the exams will also be deleted", "committedDate": "2020-06-16T11:48:24Z", "type": "commit"}, {"oid": "66469d863a5a1fb0f6afcfc8a7f3bb18f8b19323", "url": "https://github.com/ls1intum/Artemis/commit/66469d863a5a1fb0f6afcfc8a7f3bb18f8b19323", "message": "Merge branch 'develop' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T11:50:14Z", "type": "commit"}, {"oid": "c7beefde5d83ff5f96edb44e99783c20941a4179", "url": "https://github.com/ls1intum/Artemis/commit/c7beefde5d83ff5f96edb44e99783c20941a4179", "message": "Fix null index column error: Use @JoinColumn instead of mappedBy as it is not support in combination with @OrderColumn", "committedDate": "2020-06-16T12:56:56Z", "type": "commit"}, {"oid": "7615a0b4223e1d0d07d5935c76ba9363313535db", "url": "https://github.com/ls1intum/Artemis/commit/7615a0b4223e1d0d07d5935c76ba9363313535db", "message": "Clean up ExamIntegrationTest", "committedDate": "2020-06-16T13:08:55Z", "type": "commit"}, {"oid": "0e7a4b259be58e6bb1b1d9cee8c578eb1b6c29e3", "url": "https://github.com/ls1intum/Artemis/commit/0e7a4b259be58e6bb1b1d9cee8c578eb1b6c29e3", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T13:13:45Z", "type": "commit"}, {"oid": "9dc476376e655f4a834ed56f6861442be34c624f", "url": "https://github.com/ls1intum/Artemis/commit/9dc476376e655f4a834ed56f6861442be34c624f", "message": "Clean up ExamIntegrationTest", "committedDate": "2020-06-16T14:24:42Z", "type": "commit"}, {"oid": "180802ddb9bd389d6214a04a130793a4082ceff2", "url": "https://github.com/ls1intum/Artemis/commit/180802ddb9bd389d6214a04a130793a4082ceff2", "message": "Ensure that exercise groups that exerciseGroups cannot be manipulated via POST exam", "committedDate": "2020-06-16T14:53:35Z", "type": "commit"}, {"oid": "a8d39841e6d28197bb9e27773340bf445f93812b", "url": "https://github.com/ls1intum/Artemis/commit/a8d39841e6d28197bb9e27773340bf445f93812b", "message": "Remove TODO", "committedDate": "2020-06-16T14:56:18Z", "type": "commit"}, {"oid": "7ce3350843fcf2929e9bae8007f927920e8445cc", "url": "https://github.com/ls1intum/Artemis/commit/7ce3350843fcf2929e9bae8007f927920e8445cc", "message": "Refactor integration tests using exercise groups. We have to ensure that exerciseGroups are created via examRepository. Otherwise orderColumn won't work.", "committedDate": "2020-06-16T15:40:41Z", "type": "commit"}, {"oid": "34e741f5cb6285e2018286d2e656363e42abeaf5", "url": "https://github.com/ls1intum/Artemis/commit/34e741f5cb6285e2018286d2e656363e42abeaf5", "message": "Use ExamAccessService in register student routes", "committedDate": "2020-06-16T15:44:16Z", "type": "commit"}, {"oid": "ec1e7f0b5074cc16900d25821815d954ce044db2", "url": "https://github.com/ls1intum/Artemis/commit/ec1e7f0b5074cc16900d25821815d954ce044db2", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T15:44:33Z", "type": "commit"}, {"oid": "6c14a566a38fdf4ee850c44d4105141a964b8002", "url": "https://github.com/ls1intum/Artemis/commit/6c14a566a38fdf4ee850c44d4105141a964b8002", "message": "Merge branch 'develop' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T15:44:46Z", "type": "commit"}, {"oid": "30e73dba63476f238b15c6ed38162fba5613dde8", "url": "https://github.com/ls1intum/Artemis/commit/30e73dba63476f238b15c6ed38162fba5613dde8", "message": "Merge branch 'exam/management/follow-up-fixes' of github.com:ls1intum/Artemis into exam/management/follow-up-fixes", "committedDate": "2020-06-16T15:46:05Z", "type": "commit"}, {"oid": "2a473ce88cdf1c370a863a9f18c0522f026c163b", "url": "https://github.com/ls1intum/Artemis/commit/2a473ce88cdf1c370a863a9f18c0522f026c163b", "message": "Hide assessment dashboard link", "committedDate": "2020-06-16T15:58:33Z", "type": "commit"}, {"oid": "027448ddf5b6858610dee0e91f4c32ed52cd034b", "url": "https://github.com/ls1intum/Artemis/commit/027448ddf5b6858610dee0e91f4c32ed52cd034b", "message": "Fix delete operation for ExamResource\nNow it successfully deletes an exam even if there is an exerciseGroup with exercises", "committedDate": "2020-06-16T16:55:06Z", "type": "commit"}, {"oid": "0eaab31e981938f14e41b195de945dfff6b3986a", "url": "https://github.com/ls1intum/Artemis/commit/0eaab31e981938f14e41b195de945dfff6b3986a", "message": "Rename functions", "committedDate": "2020-06-16T17:13:28Z", "type": "commit"}, {"oid": "b176beb64f5ace0d3c6968f95188629dd448aad8", "url": "https://github.com/ls1intum/Artemis/commit/b176beb64f5ace0d3c6968f95188629dd448aad8", "message": "Fix course delete operation\nNow it handles courses with exams aswell", "committedDate": "2020-06-16T17:29:56Z", "type": "commit"}, {"oid": "3a7f7d32c4e6f18fc4510653b4998f3562f7e1d7", "url": "https://github.com/ls1intum/Artemis/commit/3a7f7d32c4e6f18fc4510653b4998f3562f7e1d7", "message": "Merge branch 'exam/management/follow-up-fixes' of github.com:ls1intum/Artemis into exam/management/follow-up-fixes", "committedDate": "2020-06-16T17:31:11Z", "type": "commit"}, {"oid": "cd4f83e52faae2fcc8e323747bca4a5ade56a446", "url": "https://github.com/ls1intum/Artemis/commit/cd4f83e52faae2fcc8e323747bca4a5ade56a446", "message": "Update Exam Integration tests", "committedDate": "2020-06-16T17:44:52Z", "type": "commit"}, {"oid": "990b5158760020f4f3f8c241848d83d3cec41fd7", "url": "https://github.com/ls1intum/Artemis/commit/990b5158760020f4f3f8c241848d83d3cec41fd7", "message": "Merge branch 'develop' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T18:49:42Z", "type": "commit"}, {"oid": "b79ba9358ad141c13206b9955cbed6f5e6b7b8eb", "url": "https://github.com/ls1intum/Artemis/commit/b79ba9358ad141c13206b9955cbed6f5e6b7b8eb", "message": "update IntegrationTest", "committedDate": "2020-06-16T19:03:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3OTEzNg==", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441079136", "bodyText": "typo, please revert", "author": "krusche", "createdAt": "2020-06-16T19:05:38Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java", "diffHunk": "@@ -772,7 +784,7 @@ private boolean userHasPermission(Course course, User user) {\n     }\n \n     /**\n-     * DELETE /courses/:courseId : delete the \"id\" course.\n+     * DELETE /courses/:courseId : deletedelete the \"id\" course.", "originalCommit": "b79ba9358ad141c13206b9955cbed6f5e6b7b8eb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "60aeb2891ea5241f48786287aab841698d79ab3f", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\nindex f5f3ce1ae1..194f5aac42 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/CourseResource.java\n\n@@ -784,7 +784,7 @@ public class CourseResource {\n     }\n \n     /**\n-     * DELETE /courses/:courseId : deletedelete the \"id\" course.\n+     * DELETE /courses/:courseId : delete the \"id\" course.\n      *\n      * @param courseId the id of the course to delete\n      * @return the ResponseEntity with status 200 (OK)\n"}}, {"oid": "60aeb2891ea5241f48786287aab841698d79ab3f", "url": "https://github.com/ls1intum/Artemis/commit/60aeb2891ea5241f48786287aab841698d79ab3f", "message": "Fix typo", "committedDate": "2020-06-16T19:07:05Z", "type": "commit"}, {"oid": "c6f42cfb587b4b5869be9b771db5ecb129bd0419", "url": "https://github.com/ls1intum/Artemis/commit/c6f42cfb587b4b5869be9b771db5ecb129bd0419", "message": "Merge remote-tracking branch 'origin/exam/management/follow-up-fixes' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T19:07:46Z", "type": "commit"}, {"oid": "db7585355af2072875cd38b5b88d8424fda07f37", "url": "https://github.com/ls1intum/Artemis/commit/db7585355af2072875cd38b5b88d8424fda07f37", "message": "Merge branch 'develop' into exam/management/follow-up-fixes", "committedDate": "2020-06-16T19:29:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0MDg0OA==", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441140848", "bodyText": "Using both @EntityGraph and @query is redundant. We should be able to delete one.", "author": "kloessst", "createdAt": "2020-06-16T21:04:07Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/ExamRepository.java", "diffHunk": "@@ -19,6 +21,13 @@\n \n     List<Exam> findByCourseId(Long courseId);\n \n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\" })\n+    Optional<Exam> findWithExerciseGroupsById(Long id);\n+\n     @EntityGraph(type = LOAD, attributePaths = { \"registeredUsers\" })\n     Optional<Exam> findWithRegisteredUsersById(Long id);\n+\n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\", \"studentExams\" })\n+    @Query(\"select distinct exam from Exam exam left join fetch exam.studentExams studentExams left join fetch exam.exerciseGroups exerciseGroups left join fetch exerciseGroups.exercises where (exam.id =:#{#examId})\")", "originalCommit": "db7585355af2072875cd38b5b88d8424fda07f37", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NDEzNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441144135", "bodyText": "find instead of findOne. Return an Optional", "author": "kloessst", "createdAt": "2020-06-16T21:10:36Z", "path": "src/main/java/de/tum/in/www1/artemis/repository/ExamRepository.java", "diffHunk": "@@ -19,6 +21,13 @@\n \n     List<Exam> findByCourseId(Long courseId);\n \n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\" })\n+    Optional<Exam> findWithExerciseGroupsById(Long id);\n+\n     @EntityGraph(type = LOAD, attributePaths = { \"registeredUsers\" })\n     Optional<Exam> findWithRegisteredUsersById(Long id);\n+\n+    @EntityGraph(type = LOAD, attributePaths = { \"exerciseGroups\", \"studentExams\" })\n+    @Query(\"select distinct exam from Exam exam left join fetch exam.studentExams studentExams left join fetch exam.exerciseGroups exerciseGroups left join fetch exerciseGroups.exercises where (exam.id =:#{#examId})\")\n+    Exam findOneWithEagerExercisesGroupsAndStudentExams(@Param(\"examId\") long examId);", "originalCommit": "db7585355af2072875cd38b5b88d8424fda07f37", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE0NDM3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1664#discussion_r441144371", "bodyText": "Add new entity not found exception", "author": "kloessst", "createdAt": "2020-06-16T21:11:02Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ExamService.java", "diffHunk": "@@ -74,6 +86,16 @@ public Exam findOneWithRegisteredUsers(Long examId) {\n         return examRepository.findByCourseId(courseId);\n     }\n \n+    /**\n+     * Get the exam of a course with exercise groups and student exams\n+     * @param examId {Long} The courseId of the course which contains the exam\n+     * @return The exam\n+     */\n+    public Exam findOneWithExercisesGroupsAndStudentExamsByExamId(Long examId) {\n+        log.debug(\"REST request to get the exam with student exams and exercise groups for Id : {}\", examId);\n+        return examRepository.findOneWithEagerExercisesGroupsAndStudentExams(examId);", "originalCommit": "db7585355af2072875cd38b5b88d8424fda07f37", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}