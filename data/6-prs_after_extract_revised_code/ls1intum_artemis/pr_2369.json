{"pr_number": 2369, "pr_title": "[Enhancement] Hide the name of the student when downloading repos for Programming Assessment", "pr_createdAt": "2020-11-09T09:14:50Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/2369", "timeline": [{"oid": "74917e5a0ed4770e4864388f2fdbde3e0dcd140a", "url": "https://github.com/ls1intum/Artemis/commit/74917e5a0ed4770e4864388f2fdbde3e0dcd140a", "message": "hide the name of the student when downloading repos during programming assessment", "committedDate": "2020-11-09T09:07:21Z", "type": "commit"}, {"oid": "88acf67e06255ec9af83b994135278d6e6cbb4a6", "url": "https://github.com/ls1intum/Artemis/commit/88acf67e06255ec9af83b994135278d6e6cbb4a6", "message": "add docu", "committedDate": "2020-11-09T10:16:02Z", "type": "commit"}, {"oid": "b16bc6ea51dedb9ec0793ee83b87ecad6664a3e0", "url": "https://github.com/ls1intum/Artemis/commit/b16bc6ea51dedb9ec0793ee83b87ecad6664a3e0", "message": "Merge branch 'develop' into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-10T08:09:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM3NTU2Nw==", "url": "https://github.com/ls1intum/Artemis/pull/2369#discussion_r520375567", "bodyText": "Can you assign repositoryUrlComponents[n] to a variable with a meaningful name?\nWould help if we need to touch this again in a week or so :D", "author": "jpbernius", "createdAt": "2020-11-10T08:29:47Z", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java", "diffHunk": "@@ -657,23 +657,30 @@ public void deleteLocalRepository(URL repoUrl, String targetPath) {\n      * @return path to zip file.\n      */\n     public Path zipRepository(Repository repo) throws IOException {\n-        return zipRepository(repo, REPO_CLONE_PATH);\n+        return zipRepository(repo, REPO_CLONE_PATH, false);\n     }\n \n     /**\n      * Zip the content of a git repository.\n      *\n      * @param repo Local Repository Object.\n      * @param targetPath path where the repo is located on disk\n+     * @param hideStudentName option to hide the student name for the zip file\n      * @throws IOException if the zipping process failed.\n      * @return path to zip file.\n      */\n-    public Path zipRepository(Repository repo, String targetPath) throws IOException {\n+    public Path zipRepository(Repository repo, String targetPath, boolean hideStudentName) throws IOException {\n         String[] repositoryUrlComponents = repo.getParticipation().getRepositoryUrl().split(File.separator);\n         ProgrammingExercise exercise = repo.getParticipation().getProgrammingExercise();\n         String courseShortName = exercise.getCourseViaExerciseGroupOrCourseMember().getShortName().replaceAll(\"\\\\s\", \"\");\n-        // take the last component\n-        String zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 1] + \".zip\";\n+        String zipRepoName;\n+        if (hideStudentName) {\n+            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission\" + \".zip\";\n+        }\n+        else {\n+            // take the last component\n+            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 1] + \".zip\";\n+        }", "originalCommit": "b16bc6ea51dedb9ec0793ee83b87ecad6664a3e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ1MzAzOA==", "url": "https://github.com/ls1intum/Artemis/pull/2369#discussion_r522453038", "bodyText": "I added detailed comments what we are using in d4a225b", "author": "fde312", "createdAt": "2020-11-12T22:00:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM3NTU2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "d4a225b2207c567b41ae81e3c363c79974488e8b", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\nindex ddc5c45c7c..5d370de268 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n\n@@ -670,15 +670,20 @@ public class GitService {\n      * @return path to zip file.\n      */\n     public Path zipRepository(Repository repo, String targetPath, boolean hideStudentName) throws IOException {\n+        /*\n+         * This will split the repositoryUrl e.g. http://artemis-admin@localhost:7990/scm/TC1SCHEDULER1/tc1scheduler1-artemis-admin.git into a string array e.g. [\"http\", \"\",\n+         * \"artemis-admin@localhost:7990\", \"scm\", \"TC1SCHEDULER1\", \"tc1scheduler1-artemis-admin.git\"]\n+         */\n         String[] repositoryUrlComponents = repo.getParticipation().getRepositoryUrl().split(File.separator);\n         ProgrammingExercise exercise = repo.getParticipation().getProgrammingExercise();\n         String courseShortName = exercise.getCourseViaExerciseGroupOrCourseMember().getShortName().replaceAll(\"\\\\s\", \"\");\n         String zipRepoName;\n         if (hideStudentName) {\n-            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission\" + \".zip\";\n+            // Take the last but one component, which does not contain the students name\n+            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission.git\" + \".zip\";\n         }\n         else {\n-            // take the last component\n+            // Take the last component, which contains the students name\n             zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 1] + \".zip\";\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM4NjQ0Mw==", "url": "https://github.com/ls1intum/Artemis/pull/2369#discussion_r520386443", "bodyText": "not sure if I understand what's going on here. Can you document this a bit better?", "author": "krusche", "createdAt": "2020-11-10T08:47:25Z", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java", "diffHunk": "@@ -657,23 +657,30 @@ public void deleteLocalRepository(URL repoUrl, String targetPath) {\n      * @return path to zip file.\n      */\n     public Path zipRepository(Repository repo) throws IOException {\n-        return zipRepository(repo, REPO_CLONE_PATH);\n+        return zipRepository(repo, REPO_CLONE_PATH, false);\n     }\n \n     /**\n      * Zip the content of a git repository.\n      *\n      * @param repo Local Repository Object.\n      * @param targetPath path where the repo is located on disk\n+     * @param hideStudentName option to hide the student name for the zip file\n      * @throws IOException if the zipping process failed.\n      * @return path to zip file.\n      */\n-    public Path zipRepository(Repository repo, String targetPath) throws IOException {\n+    public Path zipRepository(Repository repo, String targetPath, boolean hideStudentName) throws IOException {\n         String[] repositoryUrlComponents = repo.getParticipation().getRepositoryUrl().split(File.separator);\n         ProgrammingExercise exercise = repo.getParticipation().getProgrammingExercise();\n         String courseShortName = exercise.getCourseViaExerciseGroupOrCourseMember().getShortName().replaceAll(\"\\\\s\", \"\");\n-        // take the last component\n-        String zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 1] + \".zip\";\n+        String zipRepoName;\n+        if (hideStudentName) {\n+            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission\" + \".zip\";", "originalCommit": "b16bc6ea51dedb9ec0793ee83b87ecad6664a3e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjQ1Mjc0Ng==", "url": "https://github.com/ls1intum/Artemis/pull/2369#discussion_r522452746", "bodyText": "Done in d4a225b", "author": "fde312", "createdAt": "2020-11-12T21:59:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM4NjQ0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "d4a225b2207c567b41ae81e3c363c79974488e8b", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\nindex ddc5c45c7c..5d370de268 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n\n@@ -670,15 +670,20 @@ public class GitService {\n      * @return path to zip file.\n      */\n     public Path zipRepository(Repository repo, String targetPath, boolean hideStudentName) throws IOException {\n+        /*\n+         * This will split the repositoryUrl e.g. http://artemis-admin@localhost:7990/scm/TC1SCHEDULER1/tc1scheduler1-artemis-admin.git into a string array e.g. [\"http\", \"\",\n+         * \"artemis-admin@localhost:7990\", \"scm\", \"TC1SCHEDULER1\", \"tc1scheduler1-artemis-admin.git\"]\n+         */\n         String[] repositoryUrlComponents = repo.getParticipation().getRepositoryUrl().split(File.separator);\n         ProgrammingExercise exercise = repo.getParticipation().getProgrammingExercise();\n         String courseShortName = exercise.getCourseViaExerciseGroupOrCourseMember().getShortName().replaceAll(\"\\\\s\", \"\");\n         String zipRepoName;\n         if (hideStudentName) {\n-            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission\" + \".zip\";\n+            // Take the last but one component, which does not contain the students name\n+            zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 2].toLowerCase() + \"-student-submission.git\" + \".zip\";\n         }\n         else {\n-            // take the last component\n+            // Take the last component, which contains the students name\n             zipRepoName = courseShortName + \"-\" + repositoryUrlComponents[repositoryUrlComponents.length - 1] + \".zip\";\n         }\n \n"}}, {"oid": "29b9f73767193d10d7d9292bfe24ccc6bf52c7be", "url": "https://github.com/ls1intum/Artemis/commit/29b9f73767193d10d7d9292bfe24ccc6bf52c7be", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-10T16:10:49Z", "type": "commit"}, {"oid": "f33ee8aa190d62ca2b110e1fa87d1d717a464830", "url": "https://github.com/ls1intum/Artemis/commit/f33ee8aa190d62ca2b110e1fa87d1d717a464830", "message": "Merge branch 'develop' of https://github.com/ls1intum/Artemis into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-12T20:50:33Z", "type": "commit"}, {"oid": "e5ecc44a486fffc3e16b0a8f842e1e6b5d5321c2", "url": "https://github.com/ls1intum/Artemis/commit/e5ecc44a486fffc3e16b0a8f842e1e6b5d5321c2", "message": "refactor to use exportOptions for hiding the student name on the client", "committedDate": "2020-11-12T21:24:19Z", "type": "commit"}, {"oid": "f2cebd9e9bbc00c994a67bb95f021b68259227cd", "url": "https://github.com/ls1intum/Artemis/commit/f2cebd9e9bbc00c994a67bb95f021b68259227cd", "message": "refactor to use exportOptions for hiding the student name on server", "committedDate": "2020-11-12T21:35:18Z", "type": "commit"}, {"oid": "d4a225b2207c567b41ae81e3c363c79974488e8b", "url": "https://github.com/ls1intum/Artemis/commit/d4a225b2207c567b41ae81e3c363c79974488e8b", "message": "add comments", "committedDate": "2020-11-12T21:50:08Z", "type": "commit"}, {"oid": "d12a5ef70e0a53c76162a93336fef13eea75f14b", "url": "https://github.com/ls1intum/Artemis/commit/d12a5ef70e0a53c76162a93336fef13eea75f14b", "message": "Merge branch 'develop' into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-14T11:50:09Z", "type": "commit"}, {"oid": "9f5a22a9d9c8329b64e4aca26d67fa75d66e4d66", "url": "https://github.com/ls1intum/Artemis/commit/9f5a22a9d9c8329b64e4aca26d67fa75d66e4d66", "message": "Merge branch 'develop' into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-15T23:10:01Z", "type": "commit"}, {"oid": "e0925c24815b2ebe7f4e38a472bf0aa5710eb0a1", "url": "https://github.com/ls1intum/Artemis/commit/e0925c24815b2ebe7f4e38a472bf0aa5710eb0a1", "message": "Merge branch 'develop' into feature/programming-assessment/hide-student-name-repo-download", "committedDate": "2020-11-17T00:30:19Z", "type": "commit"}]}