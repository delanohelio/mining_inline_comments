{"pr_number": 1253, "pr_title": "Start team-based exercises and create submissions", "pr_createdAt": "2020-02-25T00:10:32Z", "pr_url": "https://github.com/ls1intum/Artemis/pull/1253", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Nzk4NA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398867984", "bodyText": "rename username to participantIdentifier", "author": "krusche", "createdAt": "2020-03-26T20:24:08Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -497,7 +505,7 @@ private ProgrammingExerciseStudentParticipation copyBuildPlan(ProgrammingExercis\n         if (!participation.getInitializationState().hasCompletedState(InitializationState.BUILD_PLAN_COPIED) || participation.getBuildPlanId() == null) {\n             final var projectKey = participation.getProgrammingExercise().getProjectKey();\n             final var planName = BuildPlanType.TEMPLATE.getName();\n-            final var username = participation.getStudent().getLogin();\n+            final var username = participation.getParticipantIdentifier();", "originalCommit": "43aa91d92b2fe35deea78934e59017861ef868d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDMxMw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399774313", "bodyText": "Renamed", "author": "madwau", "createdAt": "2020-03-29T10:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Nzk4NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2OTQzMg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398869432", "bodyText": "please add a log.info(..) statement here so that we could potentially track this in the log", "author": "krusche", "createdAt": "2020-03-26T20:26:48Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -935,6 +1001,22 @@ public void deleteAllByExerciseId(Long exerciseId, boolean deleteBuildPlan, bool\n         }\n     }\n \n+    /**\n+     * Delete all participations belonging to the given team\n+     *\n+     * @param teamId the id of the team\n+     * @param deleteBuildPlan specify if build plan should be deleted\n+     * @param deleteRepository specify if repository should be deleted\n+     */\n+    @Transactional\n+    public void deleteAllByTeamId(Long teamId, boolean deleteBuildPlan, boolean deleteRepository) {\n+        List<StudentParticipation> participationsToDelete = findByTeamId(teamId);", "originalCommit": "43aa91d92b2fe35deea78934e59017861ef868d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDU1OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399774559", "bodyText": "Added", "author": "madwau", "createdAt": "2020-03-29T10:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2OTQzMg=="}], "type": "inlineReview", "revised_code": {"commit": "5af944e527362e217688827ec157660ee5b435f8", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\nindex 7bbcf9a7b0..bb5287ee8d 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n\n@@ -1010,6 +1010,8 @@ public class ParticipationService {\n      */\n     @Transactional\n     public void deleteAllByTeamId(Long teamId, boolean deleteBuildPlan, boolean deleteRepository) {\n+        log.info(\"Request to delete all participations of Team with id : {}\", teamId);\n+\n         List<StudentParticipation> participationsToDelete = findByTeamId(teamId);\n \n         for (StudentParticipation participation : participationsToDelete) {\n"}}, {"oid": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "url": "https://github.com/ls1intum/Artemis/commit/b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "message": "Rename studentId to participantIdentifier", "committedDate": "2020-03-29T09:54:38Z", "type": "commit"}, {"oid": "441425f14d1544201cfc1f683d2ef3754fba43c6", "url": "https://github.com/ls1intum/Artemis/commit/441425f14d1544201cfc1f683d2ef3754fba43c6", "message": "Merge remote-tracking branch 'origin/feature/team-based-exercises/programming-exercises' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-29T09:55:06Z", "type": "commit"}, {"oid": "d1d803f7c7f0d784f6f872c545c871c08246ea34", "url": "https://github.com/ls1intum/Artemis/commit/d1d803f7c7f0d784f6f872c545c871c08246ea34", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises\n\n# Conflicts:\n#\tsrc/main/webapp/app/shared/data-table/data-table.component.ts", "committedDate": "2020-03-29T09:57:18Z", "type": "commit"}, {"oid": "fe5db7d684bd85548156b98d3363c9503927cfd5", "url": "https://github.com/ls1intum/Artemis/commit/fe5db7d684bd85548156b98d3363c9503927cfd5", "message": "Update comment to mention teams as well", "committedDate": "2020-03-29T09:59:24Z", "type": "commit"}, {"oid": "4cb3e7310903e51ecc076177b8994376a202a214", "url": "https://github.com/ls1intum/Artemis/commit/4cb3e7310903e51ecc076177b8994376a202a214", "message": "Rename username to participantIdentifier", "committedDate": "2020-03-29T10:02:11Z", "type": "commit"}, {"oid": "5af944e527362e217688827ec157660ee5b435f8", "url": "https://github.com/ls1intum/Artemis/commit/5af944e527362e217688827ec157660ee5b435f8", "message": "Add info log when deleting all participations of team", "committedDate": "2020-03-29T10:04:04Z", "type": "commit"}, {"oid": "0feef0bd7fb848bb7d631fedfde34d67a682f4c3", "url": "https://github.com/ls1intum/Artemis/commit/0feef0bd7fb848bb7d631fedfde34d67a682f4c3", "message": "Move teams route for students to /courses instead of /course-management", "committedDate": "2020-03-29T10:10:22Z", "type": "commit"}, {"oid": "d8cc5bd653904d58367f6df9099727b58975e838", "url": "https://github.com/ls1intum/Artemis/commit/d8cc5bd653904d58367f6df9099727b58975e838", "message": "Add missing module import", "committedDate": "2020-03-29T10:37:24Z", "type": "commit"}, {"oid": "066c102a5b4d1da352388fbe87e92b88f4736441", "url": "https://github.com/ls1intum/Artemis/commit/066c102a5b4d1da352388fbe87e92b88f4736441", "message": "Avoid traditional for-loop", "committedDate": "2020-03-29T11:16:38Z", "type": "commit"}, {"oid": "574a9a7f3493c633d888742988acfa1a12df6932", "url": "https://github.com/ls1intum/Artemis/commit/574a9a7f3493c633d888742988acfa1a12df6932", "message": "Repo export for student logins or team short names", "committedDate": "2020-03-29T12:34:03Z", "type": "commit"}, {"oid": "759bebec12b4269dc58ac0ee490c1c31bc524a9f", "url": "https://github.com/ls1intum/Artemis/commit/759bebec12b4269dc58ac0ee490c1c31bc524a9f", "message": "Improve translations", "committedDate": "2020-03-29T13:13:34Z", "type": "commit"}, {"oid": "278691efd6ed0cd0035c14ea7eba4afa817e65d3", "url": "https://github.com/ls1intum/Artemis/commit/278691efd6ed0cd0035c14ea7eba4afa817e65d3", "message": "Fix typo", "committedDate": "2020-03-29T13:39:21Z", "type": "commit"}, {"oid": "f1bc250641f151e112d109e98da889debf8b9372", "url": "https://github.com/ls1intum/Artemis/commit/f1bc250641f151e112d109e98da889debf8b9372", "message": "Generalize from student to participant on StudentParticipation (WIP)", "committedDate": "2020-02-24T20:52:40Z", "type": "commit"}, {"oid": "b1a71f496551ad205309361cecad1c581edb7142", "url": "https://github.com/ls1intum/Artemis/commit/b1a71f496551ad205309361cecad1c581edb7142", "message": "Generalize from student to participant on StudentParticipation", "committedDate": "2020-02-24T22:09:26Z", "type": "commit"}, {"oid": "0b709d259efa331f05d714dc7b1281af8da26c3e", "url": "https://github.com/ls1intum/Artemis/commit/0b709d259efa331f05d714dc7b1281af8da26c3e", "message": "Refactor", "committedDate": "2020-02-24T22:56:19Z", "type": "commit"}, {"oid": "268d5351fac2a50e5383d89c6badb78110b55006", "url": "https://github.com/ls1intum/Artemis/commit/268d5351fac2a50e5383d89c6badb78110b55006", "message": "Start exercises as team exercises", "committedDate": "2020-02-24T23:42:39Z", "type": "commit"}, {"oid": "cc5d8413dd0c1949f56d989832cabb386542a997", "url": "https://github.com/ls1intum/Artemis/commit/cc5d8413dd0c1949f56d989832cabb386542a997", "message": "\"Start team exercise\" in button", "committedDate": "2020-02-25T00:04:43Z", "type": "commit"}, {"oid": "ffb3ed1a7e3707231b8191a0115d4243584054ac", "url": "https://github.com/ls1intum/Artemis/commit/ffb3ed1a7e3707231b8191a0115d4243584054ac", "message": "Fix tests", "committedDate": "2020-02-25T00:12:16Z", "type": "commit"}, {"oid": "fb3246b5f35f64728638b08677d4ef90f8800ed2", "url": "https://github.com/ls1intum/Artemis/commit/fb3246b5f35f64728638b08677d4ef90f8800ed2", "message": "Fix tests", "committedDate": "2020-02-25T00:17:35Z", "type": "commit"}, {"oid": "1a7ae0eeaea74ccd7701ddfe45a4c49959643a10", "url": "https://github.com/ls1intum/Artemis/commit/1a7ae0eeaea74ccd7701ddfe45a4c49959643a10", "message": "Translation", "committedDate": "2020-02-25T00:20:31Z", "type": "commit"}, {"oid": "a2d6bcb9b45cae4494e78ebb61bf7095715f5e6f", "url": "https://github.com/ls1intum/Artemis/commit/a2d6bcb9b45cae4494e78ebb61bf7095715f5e6f", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/domain/participation/StudentParticipation.java\n#\tsrc/main/java/de/tum/in/www1/artemis/repository/StudentParticipationRepository.java", "committedDate": "2020-03-10T10:13:31Z", "type": "commit"}, {"oid": "14229e77330515535d907b80510e5b7514f59da9", "url": "https://github.com/ls1intum/Artemis/commit/14229e77330515535d907b80510e5b7514f59da9", "message": "Adapt test to getParticipantIdentifier", "committedDate": "2020-03-10T09:21:15Z", "type": "commit"}, {"oid": "55ea0d4090c032e379ca799610a08c5e8361405f", "url": "https://github.com/ls1intum/Artemis/commit/55ea0d4090c032e379ca799610a08c5e8361405f", "message": "Code style", "committedDate": "2020-03-10T10:18:32Z", "type": "commit"}, {"oid": "7d955882d0ace07b1ad02b566081d015d3fb8cfa", "url": "https://github.com/ls1intum/Artemis/commit/7d955882d0ace07b1ad02b566081d015d3fb8cfa", "message": "Adapt test", "committedDate": "2020-03-10T12:57:44Z", "type": "commit"}, {"oid": "f61f7f75afb628c23d91adf227ee5f95c56f3132", "url": "https://github.com/ls1intum/Artemis/commit/f61f7f75afb628c23d91adf227ee5f95c56f3132", "message": "Prefer orElseGet", "committedDate": "2020-03-10T12:59:53Z", "type": "commit"}, {"oid": "39f04c2ab8a922175f310d8778d7ce9f4948c750", "url": "https://github.com/ls1intum/Artemis/commit/39f04c2ab8a922175f310d8778d7ce9f4948c750", "message": "isEmpty instead of isNull due to Optional", "committedDate": "2020-03-10T14:05:15Z", "type": "commit"}, {"oid": "45dc3a25d6bad2b1520d57f02f3acfb0b1592ca8", "url": "https://github.com/ls1intum/Artemis/commit/45dc3a25d6bad2b1520d57f02f3acfb0b1592ca8", "message": "isEmpty instead of isNull due to Optional", "committedDate": "2020-03-10T14:13:47Z", "type": "commit"}, {"oid": "fd97a89e5eb22a59d753aa78dc9ea0285849f21f", "url": "https://github.com/ls1intum/Artemis/commit/fd97a89e5eb22a59d753aa78dc9ea0285849f21f", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-10T14:14:45Z", "type": "commit"}, {"oid": "82200d263230ac6d12383774436bae65c658d07f", "url": "https://github.com/ls1intum/Artemis/commit/82200d263230ac6d12383774436bae65c658d07f", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-13T18:06:21Z", "type": "commit"}, {"oid": "f0e087a869189e792a8885290979866f52ca00e1", "url": "https://github.com/ls1intum/Artemis/commit/f0e087a869189e792a8885290979866f52ca00e1", "message": "Load team students with student participation when auth check needs it to prove participation ownership", "committedDate": "2020-03-13T18:51:18Z", "type": "commit"}, {"oid": "edf16e6c9000bdd0cbd90af16002c9654e3d23ac", "url": "https://github.com/ls1intum/Artemis/commit/edf16e6c9000bdd0cbd90af16002c9654e3d23ac", "message": "- adapt StudentParticipationRepository to find team participations\n- fix broken routes to /exercises/:exerciseId/teams for file upload and text\n- handle team instead of student for studentParticipation in participation component and service", "committedDate": "2020-03-13T21:20:50Z", "type": "commit"}, {"oid": "62d1ece42b2d0b09639c0595d7fad270b07f8062", "url": "https://github.com/ls1intum/Artemis/commit/62d1ece42b2d0b09639c0595d7fad270b07f8062", "message": "Keep team queries explicit in StudentParticipationRepository and use them in ParticipationService (avoids fetching teams and students for non-team based exercises)", "committedDate": "2020-03-14T13:59:19Z", "type": "commit"}, {"oid": "90d6c2e822c1189d04dc87d278f75931bb8b5b16", "url": "https://github.com/ls1intum/Artemis/commit/90d6c2e822c1189d04dc87d278f75931bb8b5b16", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-14T14:08:25Z", "type": "commit"}, {"oid": "9bbc165fb5e447f9d5dce595822df34c74b867be", "url": "https://github.com/ls1intum/Artemis/commit/9bbc165fb5e447f9d5dce595822df34c74b867be", "message": "Handle \"Not yet assigned to team\" participation status", "committedDate": "2020-03-14T15:11:44Z", "type": "commit"}, {"oid": "850490d31935f1681e36f9ab9e32db88ebbe1af4", "url": "https://github.com/ls1intum/Artemis/commit/850490d31935f1681e36f9ab9e32db88ebbe1af4", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-14T15:13:53Z", "type": "commit"}, {"oid": "eac8faefef3e7c23aaa3e8e6c2a9b75ca6c80c7c", "url": "https://github.com/ls1intum/Artemis/commit/eac8faefef3e7c23aaa3e8e6c2a9b75ca6c80c7c", "message": "Do not allow exercise mode change after creation", "committedDate": "2020-03-14T16:00:19Z", "type": "commit"}, {"oid": "7a852c7ac19be08089c933a47abc47b9f672ca44", "url": "https://github.com/ls1intum/Artemis/commit/7a852c7ac19be08089c933a47abc47b9f672ca44", "message": "UI improvements of team management", "committedDate": "2020-03-14T16:52:35Z", "type": "commit"}, {"oid": "c9e43db120d437075d8801ed8561649e04b542b5", "url": "https://github.com/ls1intum/Artemis/commit/c9e43db120d437075d8801ed8561649e04b542b5", "message": "Link students in team member list", "committedDate": "2020-03-14T17:02:19Z", "type": "commit"}, {"oid": "841c9dacb82e321d0ec632d6111c36f471e39fee", "url": "https://github.com/ls1intum/Artemis/commit/841c9dacb82e321d0ec632d6111c36f471e39fee", "message": "Search for teams by their students + generalize participations page for team exercises", "committedDate": "2020-03-14T19:03:18Z", "type": "commit"}, {"oid": "641a14e293f2be9d1dd5f79021b027c3db357405", "url": "https://github.com/ls1intum/Artemis/commit/641a14e293f2be9d1dd5f79021b027c3db357405", "message": "Team students list component", "committedDate": "2020-03-14T19:27:21Z", "type": "commit"}, {"oid": "638df6993182e7f20bba228ba31f064ec43dd750", "url": "https://github.com/ls1intum/Artemis/commit/638df6993182e7f20bba228ba31f064ec43dd750", "message": "Styling", "committedDate": "2020-03-14T19:39:26Z", "type": "commit"}, {"oid": "69a0d67055d5522d9bcf2f967d65608068c2e631", "url": "https://github.com/ls1intum/Artemis/commit/69a0d67055d5522d9bcf2f967d65608068c2e631", "message": "Exercise scores for teams", "committedDate": "2020-03-14T20:27:13Z", "type": "commit"}, {"oid": "da015a4cb9119d973d6f8b84d29213dae0b04cba", "url": "https://github.com/ls1intum/Artemis/commit/da015a4cb9119d973d6f8b84d29213dae0b04cba", "message": "Submissions for teams", "committedDate": "2020-03-14T20:57:48Z", "type": "commit"}, {"oid": "36cc0d22164f100b1a7177448f7b42e6eedd564f", "url": "https://github.com/ls1intum/Artemis/commit/36cc0d22164f100b1a7177448f7b42e6eedd564f", "message": "Team should always return students, even if empty", "committedDate": "2020-03-14T21:12:43Z", "type": "commit"}, {"oid": "ce706d1aceb63aee25c7df22f7d9611bec02e8bb", "url": "https://github.com/ls1intum/Artemis/commit/ce706d1aceb63aee25c7df22f7d9611bec02e8bb", "message": "Assessment dashboards + score calculation for teams", "committedDate": "2020-03-14T21:42:48Z", "type": "commit"}, {"oid": "ae1e575ef9c81584cc896e28ec602f6a3330e393", "url": "https://github.com/ls1intum/Artemis/commit/ae1e575ef9c81584cc896e28ec602f6a3330e393", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-14T21:46:28Z", "type": "commit"}, {"oid": "a49210a3abe8caf413951434066e30c5aed4ef6e", "url": "https://github.com/ls1intum/Artemis/commit/a49210a3abe8caf413951434066e30c5aed4ef6e", "message": "Fix tests", "committedDate": "2020-03-14T21:58:32Z", "type": "commit"}, {"oid": "7f9e093cabc35570aaec4c9023ffe42d8b519c04", "url": "https://github.com/ls1intum/Artemis/commit/7f9e093cabc35570aaec4c9023ffe42d8b519c04", "message": "Add team detail view", "committedDate": "2020-03-15T15:39:30Z", "type": "commit"}, {"oid": "83ef9d1bfa1417bd097289c31944d7eca888bfa1", "url": "https://github.com/ls1intum/Artemis/commit/83ef9d1bfa1417bd097289c31944d7eca888bfa1", "message": "Add id column to teams table + add update team button on team detail page", "committedDate": "2020-03-15T16:03:17Z", "type": "commit"}, {"oid": "50e9b9747259bc0beeed1f4aae494d6daf09edff", "url": "https://github.com/ls1intum/Artemis/commit/50e9b9747259bc0beeed1f4aae494d6daf09edff", "message": "Edit and delete team from team detail view + delete confirm modals", "committedDate": "2020-03-15T16:53:24Z", "type": "commit"}, {"oid": "4d8b48beea5a6189022a3a76bc2f56878de6930c", "url": "https://github.com/ls1intum/Artemis/commit/4d8b48beea5a6189022a3a76bc2f56878de6930c", "message": "Add mode to exercise detail pages", "committedDate": "2020-03-15T17:40:38Z", "type": "commit"}, {"oid": "4e2c4cdc30fafdfc011fa5d69eb9f8e0123f1b61", "url": "https://github.com/ls1intum/Artemis/commit/4e2c4cdc30fafdfc011fa5d69eb9f8e0123f1b61", "message": "Do not show loading animation for team button", "committedDate": "2020-03-15T17:55:53Z", "type": "commit"}, {"oid": "6e753cc69268ac644f324851ccc539dbdca896ed", "url": "https://github.com/ls1intum/Artemis/commit/6e753cc69268ac644f324851ccc539dbdca896ed", "message": "If there are already participations, the student must be part of a team already", "committedDate": "2020-03-15T18:03:41Z", "type": "commit"}, {"oid": "a984cae2a67697264e52aa47cfc865bf459f6169", "url": "https://github.com/ls1intum/Artemis/commit/a984cae2a67697264e52aa47cfc865bf459f6169", "message": "Link to teams from participations table", "committedDate": "2020-03-15T18:29:13Z", "type": "commit"}, {"oid": "3b89839b0878dc6bbb61bbf995805be05fa85de7", "url": "https://github.com/ls1intum/Artemis/commit/3b89839b0878dc6bbb61bbf995805be05fa85de7", "message": "Fix repository url for team based participations in frontend", "committedDate": "2020-03-15T19:20:57Z", "type": "commit"}, {"oid": "de04f9218b4952223856aaf8b820107f1910902e", "url": "https://github.com/ls1intum/Artemis/commit/de04f9218b4952223856aaf8b820107f1910902e", "message": "Link name and login/short name to respective pages + adapt exercise score exports for teams", "committedDate": "2020-03-15T19:54:26Z", "type": "commit"}, {"oid": "b47d4c0e6584a3c8452ccbcdaad0f447ad71d050", "url": "https://github.com/ls1intum/Artemis/commit/b47d4c0e6584a3c8452ccbcdaad0f447ad71d050", "message": "Switch name and shortName position", "committedDate": "2020-03-15T20:03:09Z", "type": "commit"}, {"oid": "e4ffad194dd6df8a2f185a1efce1a25ec6cfcccf", "url": "https://github.com/ls1intum/Artemis/commit/e4ffad194dd6df8a2f185a1efce1a25ec6cfcccf", "message": "Fix column widths in participation.component.html", "committedDate": "2020-03-15T20:46:27Z", "type": "commit"}, {"oid": "733150af553456ba9f7bf91aa52b898fbdba6a5e", "url": "https://github.com/ls1intum/Artemis/commit/733150af553456ba9f7bf91aa52b898fbdba6a5e", "message": "AssignedTeamId when a participation is available", "committedDate": "2020-03-15T23:11:04Z", "type": "commit"}, {"oid": "350b1537c0c595f1db16dbdf53852726df0ef355", "url": "https://github.com/ls1intum/Artemis/commit/350b1537c0c595f1db16dbdf53852726df0ef355", "message": "Fix deleting teams with participations + only allow instructors to delete teams", "committedDate": "2020-03-15T23:44:36Z", "type": "commit"}, {"oid": "dbae58a157e686e2aab3f0fe1e7647dd510000b1", "url": "https://github.com/ls1intum/Artemis/commit/dbae58a157e686e2aab3f0fe1e7647dd510000b1", "message": "Adapt repo permissions when changing team members", "committedDate": "2020-03-16T00:39:45Z", "type": "commit"}, {"oid": "e7adfe6b829ec13c55e248f140d9a590bf57fed3", "url": "https://github.com/ls1intum/Artemis/commit/e7adfe6b829ec13c55e248f140d9a590bf57fed3", "message": "Fix test", "committedDate": "2020-03-16T00:51:28Z", "type": "commit"}, {"oid": "e5722b321ff198088ae96cc54257b2dedd0a3682", "url": "https://github.com/ls1intum/Artemis/commit/e5722b321ff198088ae96cc54257b2dedd0a3682", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises\n\n# Conflicts:\n#\tsrc/main/java/de/tum/in/www1/artemis/repository/StudentParticipationRepository.java\n#\tsrc/main/java/de/tum/in/www1/artemis/service/connectors/gitlab/GitLabService.java\n#\tsrc/test/java/de/tum/in/www1/artemis/TextAssessmentIntegrationTest.java", "committedDate": "2020-03-17T11:10:37Z", "type": "commit"}, {"oid": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "url": "https://github.com/ls1intum/Artemis/commit/4a012038c34eb91afd0fa757114c1084ee7dc89d", "message": "Fix test", "committedDate": "2020-03-17T11:41:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1ODI3Nw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393858277", "bodyText": "Should this be handled in this PR?", "author": "sleiss", "createdAt": "2020-03-17T17:43:10Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java", "diffHunk": "@@ -53,7 +53,7 @@ public Complaint createComplaint(Complaint complaint, Principal principal) {\n         Result originalResult = resultRepository.findByIdWithEagerFeedbacksAndAssessor(complaint.getResult().getId())\n                 .orElseThrow(() -> new BadRequestAlertException(\"The result you are referring to does not exist\", ENTITY_NAME, \"resultnotfound\"));\n         StudentParticipation studentParticipation = (StudentParticipation) originalResult.getParticipation();\n-        User student = studentParticipation.getStudent();\n+        User student = studentParticipation.getStudent().get(); // TODO: adapt for teams", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU4NDM2MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r394584361", "bodyText": "Good question. I think adapting the complaints to teams is probably better suited to a follow-up PR since it might require some non-trivial decisions on how we want to handle complaints for team-based exercises. Also this PR is already on the larger side and since the creation of team-based exercises is still hidden for non-admin users, it is not like regular users will run into this under-construction part of the epic. I should still see about though that I deliver this within some days.", "author": "madwau", "createdAt": "2020-03-18T19:19:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1ODI3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDYyNzY1OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r394627659", "bodyText": "Alright, then let's handle this in a different PR.", "author": "sleiss", "createdAt": "2020-03-18T20:43:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg1ODI3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java b/src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java\nindex 9701931edf..ce73d620fd 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ComplaintService.java\n\n@@ -56,12 +56,15 @@ public class ComplaintService {\n         User student = studentParticipation.getStudent().get(); // TODO: adapt for teams\n         Long courseId = studentParticipation.getExercise().getCourse().getId();\n \n+        // Retrieve course to get Max Complaint Number and Max Complaint Time per Student\n+        Course course = courseService.findOne(courseId);\n+\n         long numberOfUnacceptedComplaints = countUnacceptedComplaintsByStudentIdAndCourseId(student.getId(), courseId);\n-        if (numberOfUnacceptedComplaints >= MAX_COMPLAINT_NUMBER_PER_STUDENT && complaint.getComplaintType() == ComplaintType.COMPLAINT) {\n-            throw new BadRequestAlertException(\"You cannot have more than \" + MAX_COMPLAINT_NUMBER_PER_STUDENT + \" open or rejected complaints at the same time.\", ENTITY_NAME,\n+        if (numberOfUnacceptedComplaints >= course.getMaxComplaints() && complaint.getComplaintType() == ComplaintType.COMPLAINT) {\n+            throw new BadRequestAlertException(\"You cannot have more than \" + course.getMaxComplaints() + \" open or rejected complaints at the same time.\", ENTITY_NAME,\n                     \"toomanycomplaints\");\n         }\n-        if (!isTimeOfComplaintValid(originalResult, studentParticipation.getExercise())) {\n+        if (!isTimeOfComplaintValid(originalResult, studentParticipation.getExercise(), course)) {\n             throw new BadRequestAlertException(\"You cannot submit a complaint for a result that is older than one week.\", ENTITY_NAME, \"resultolderthanaweek\");\n         }\n         if (!student.getLogin().equals(principal.getName())) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMTEwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393901109", "bodyText": "I find this method name now misleading: It pretends to use a exercise id (as it did before), but uses an Exercise object now.\nPlease rename it e.g. to findOneByExerciseAndStudentLoginWithEagerSubmissionsAnyState", "author": "sleiss", "createdAt": "2020-03-17T18:54:41Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -648,37 +652,80 @@ public StudentParticipation findOneWithEagerSubmissionsAndResults(Long participa\n     /**\n      * Get one participation (in any state) by its student and exercise.\n      *\n-     * @param exerciseId the project key of the exercise\n-     * @param username   the username of the student\n+     * @param exercise the exercise for which to find a participation\n+     * @param username the username of the student\n      * @return the participation of the given student and exercise in any state\n      */\n-    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginAnyState(Long exerciseId, String username) {\n-        log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exerciseId);\n-        return studentParticipationRepository.findByExerciseIdAndStudentLogin(exerciseId, username);\n+    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginAnyState(Exercise exercise, String username) {\n+        log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exercise.getId());\n+        if (exercise.isTeamMode()) {\n+            Optional<Team> optionalTeam = teamRepository.findOneByExerciseIdAndUserLogin(exercise.getId(), username);\n+            return optionalTeam.flatMap(team -> studentParticipationRepository.findByExerciseIdAndTeamId(exercise.getId(), team.getId()));\n+        }\n+        return studentParticipationRepository.findByExerciseIdAndStudentLogin(exercise.getId(), username);\n+    }\n+\n+    /**\n+     * Get one participation (in any state) by its team and exercise.\n+     *\n+     * @param exercise the exercise for which to find a participation\n+     * @param teamId the id of the team\n+     * @return the participation of the given team and exercise in any state\n+     */\n+    public Optional<StudentParticipation> findOneByExerciseIdAndTeamIdAnyState(Exercise exercise, Long teamId) {\n+        log.debug(\"Request to get Participation for Team with id {} for Exercise with id: {}\", teamId, exercise.getId());\n+        return studentParticipationRepository.findByExerciseIdAndTeamId(exercise.getId(), teamId);\n+    }\n+\n+    /**\n+     * Get one participation (in any state) by its participant and exercise.\n+     *\n+     * @param exercise the exercise for which to find a participation\n+     * @param participant the short name of the team\n+     * @return the participation of the given team and exercise in any state\n+     */\n+    public Optional<StudentParticipation> findOneByExerciseIdAndParticipantAnyState(Exercise exercise, Participant participant) {\n+        if (participant instanceof User) {\n+            return findOneByExerciseIdAndStudentLoginAnyState(exercise, ((User) participant).getLogin());\n+        }\n+        else if (participant instanceof Team) {\n+            return findOneByExerciseIdAndTeamIdAnyState(exercise, ((Team) participant).getId());\n+        }\n+        else {\n+            throw new Error(\"Unknown Participant type\");\n+        }\n     }\n \n     /**\n      * Get one participation (in any state) by its student and exercise with all its results.\n      *\n-     * @param exerciseId the project key of the exercise\n+     * @param exercise the exercise for which to find a participation\n      * @param username   the username of the student\n      * @return the participation of the given student and exercise in any state\n      */\n-    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(Long exerciseId, String username) {\n-        log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exerciseId);\n-        return studentParticipationRepository.findWithEagerResultsByExerciseIdAndStudentLogin(exerciseId, username);\n+    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(Exercise exercise, String username) {\n+        log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exercise.getId());\n+        if (exercise.isTeamMode()) {\n+            Optional<Team> optionalTeam = teamRepository.findOneByExerciseIdAndUserLogin(exercise.getId(), username);\n+            return optionalTeam.flatMap(team -> studentParticipationRepository.findWithEagerResultsByExerciseIdAndTeamId(exercise.getId(), team.getId()));\n+        }\n+        return studentParticipationRepository.findWithEagerResultsByExerciseIdAndStudentLogin(exercise.getId(), username);\n     }\n \n     /**\n      * Get one participation (in any state) by its student and exercise with eager submissions.\n      *\n-     * @param exerciseId the project key of the exercise\n+     * @param exercise the exercise for which to find a participation\n      * @param username   the username of the student\n      * @return the participation of the given student and exercise with eager submissions in any state\n      */\n-    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginWithEagerSubmissionsAnyState(Long exerciseId, String username) {\n-        log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exerciseId);\n-        return studentParticipationRepository.findWithEagerSubmissionsByExerciseIdAndStudentLogin(exerciseId, username);\n+    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginWithEagerSubmissionsAnyState(Exercise exercise, String username) {", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3Mzc2OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393973769", "bodyText": "Good catch, oversight on my part. I fixed it.", "author": "madwau", "createdAt": "2020-03-17T21:12:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMTEwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\nindex 971965917b..7bbcf9a7b0 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n\n@@ -656,7 +660,7 @@ public class ParticipationService {\n      * @param username the username of the student\n      * @return the participation of the given student and exercise in any state\n      */\n-    public Optional<StudentParticipation> findOneByExerciseIdAndStudentLoginAnyState(Exercise exercise, String username) {\n+    public Optional<StudentParticipation> findOneByExerciseAndStudentLoginAnyState(Exercise exercise, String username) {\n         log.debug(\"Request to get Participation for User {} for Exercise with id: {}\", username, exercise.getId());\n         if (exercise.isTeamMode()) {\n             Optional<Team> optionalTeam = teamRepository.findOneByExerciseIdAndUserLogin(exercise.getId(), username);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMjg4OA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393902888", "bodyText": "I find this method name now misleading: It pretends to use a exercise id (as it did before), but uses an Exercise object now.\nSame as above.", "author": "sleiss", "createdAt": "2020-03-17T18:57:50Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java", "diffHunk": "@@ -735,12 +792,17 @@ public StudentParticipation findOneWithEagerSubmissionsAndResults(Long participa\n     /**\n      * Get all programming exercise participations belonging to exercise and student with eager results and submissions.\n      *\n-     * @param exerciseId the id of exercise\n+     * @param exercise  the exercise\n      * @param studentId the id of student\n      * @return the list of programming exercise participations belonging to exercise and student\n      */\n-    public List<StudentParticipation> findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(Long exerciseId, Long studentId) {\n-        return studentParticipationRepository.findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(exerciseId, studentId);\n+    public List<StudentParticipation> findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(Exercise exercise, Long studentId) {", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3NDEyNw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393974127", "bodyText": "Fixed.", "author": "madwau", "createdAt": "2020-03-17T21:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMjg4OA=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\nindex 971965917b..7bbcf9a7b0 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ParticipationService.java\n\n@@ -796,7 +800,7 @@ public class ParticipationService {\n      * @param studentId the id of student\n      * @return the list of programming exercise participations belonging to exercise and student\n      */\n-    public List<StudentParticipation> findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(Exercise exercise, Long studentId) {\n+    public List<StudentParticipation> findByExerciseAndStudentIdWithEagerResultsAndSubmissions(Exercise exercise, Long studentId) {\n         if (exercise.isTeamMode()) {\n             Optional<Team> optionalTeam = teamRepository.findOneByExerciseIdAndUserId(exercise.getId(), studentId);\n             return optionalTeam.map(team -> studentParticipationRepository.findByExerciseIdAndTeamIdWithEagerResultsAndSubmissions(exercise.getId(), team.getId()))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMzcyMg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393903722", "bodyText": "Usage of misleading method, see ParticipationService.", "author": "sleiss", "createdAt": "2020-03-17T18:59:24Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java", "diffHunk": "@@ -187,8 +187,7 @@ public ModelingSubmission lockModelingSubmissionWithoutResult(ModelingExercise m\n      * @return the saved modelingSubmission entity\n      */\n     public ModelingSubmission save(ModelingSubmission modelingSubmission, ModelingExercise modelingExercise, String username) {\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginWithEagerSubmissionsAnyState(modelingExercise.getId(),\n-                username);\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginWithEagerSubmissionsAnyState(modelingExercise, username);", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3NDMxOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393974319", "bodyText": "See above (fixed).", "author": "madwau", "createdAt": "2020-03-17T21:13:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMzcyMg=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java b/src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java\nindex 5d3dd436ad..122df0664b 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ModelingSubmissionService.java\n\n@@ -187,7 +187,7 @@ public class ModelingSubmissionService extends SubmissionService {\n      * @return the saved modelingSubmission entity\n      */\n     public ModelingSubmission save(ModelingSubmission modelingSubmission, ModelingExercise modelingExercise, String username) {\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginWithEagerSubmissionsAnyState(modelingExercise, username);\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseAndStudentLoginWithEagerSubmissionsAnyState(modelingExercise, username);\n         if (optionalParticipation.isEmpty()) {\n             throw new EntityNotFoundException(\"No participation found for \" + username + \" in exercise with id \" + modelingExercise.getId());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMzc5NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393903795", "bodyText": "Usage of misleading method, see ParticipationService.", "author": "sleiss", "createdAt": "2020-03-17T18:59:31Z", "path": "src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java", "diffHunk": "@@ -70,7 +70,7 @@ public FileUploadSubmissionService(FileUploadSubmissionRepository fileUploadSubm\n     @Transactional\n     public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission fileUploadSubmission, MultipartFile file, FileUploadExercise fileUploadExercise,\n             Principal principal) throws IOException, EmptyFileException {\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(fileUploadExercise.getId(), principal.getName());\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(fileUploadExercise, principal.getName());", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3NDQxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393974411", "bodyText": "See above (fixed).", "author": "madwau", "createdAt": "2020-03-17T21:14:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwMzc5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java b/src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java\nindex 515921767b..54e366b94e 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/FileUploadSubmissionService.java\n\n@@ -70,7 +70,7 @@ public class FileUploadSubmissionService extends SubmissionService {\n     @Transactional\n     public FileUploadSubmission handleFileUploadSubmission(FileUploadSubmission fileUploadSubmission, MultipartFile file, FileUploadExercise fileUploadExercise,\n             Principal principal) throws IOException, EmptyFileException {\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(fileUploadExercise, principal.getName());\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseAndStudentLoginAnyState(fileUploadExercise, principal.getName());\n         if (optionalParticipation.isEmpty()) {\n             throw new ResponseStatusException(HttpStatus.FAILED_DEPENDENCY, \"No participation found for \" + principal.getName() + \" in exercise \" + fileUploadExercise.getId());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwNjkyNA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393906924", "bodyText": "Usage of misleading method, see ParticipationService.", "author": "sleiss", "createdAt": "2020-03-17T19:05:32Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java", "diffHunk": "@@ -553,7 +553,7 @@ else if (participation instanceof ProgrammingExerciseParticipation) {\n         }\n \n         // Check if a result exists already for this exercise and student. If so, do nothing and just inform the instructor.\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exerciseId, studentLogin);\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exercise, studentLogin);", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java\nindex 380162d957..bc53fbce7f 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ResultResource.java\n\n@@ -553,7 +553,7 @@ public class ResultResource {\n         }\n \n         // Check if a result exists already for this exercise and student. If so, do nothing and just inform the instructor.\n-        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exercise, studentLogin);\n+        Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseAndStudentLoginAnyStateWithEagerResults(exercise, studentLogin);\n         Optional<Result> optionalResult = optionalParticipation.map(Participation::findLatestResult);\n         if (optionalResult.isPresent()) {\n             return ResponseEntity.badRequest()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkwODAwOA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393908008", "bodyText": "Usage of misleading method, see ParticipationService.", "author": "sleiss", "createdAt": "2020-03-17T19:07:40Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java", "diffHunk": "@@ -306,7 +306,7 @@ private StatsForInstructorDashboardDTO populateCommonStatistics(Exercise exercis\n         }\n \n         if (exercise != null) {\n-            List<StudentParticipation> participations = participationService.findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(exercise.getId(), user.getId());\n+            List<StudentParticipation> participations = participationService.findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(exercise, user.getId());", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java\nindex dc7e8a39ef..504f4c342e 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ExerciseResource.java\n\n@@ -299,14 +299,14 @@ public class ExerciseResource {\n         User user = userService.getUserWithGroupsAndAuthorities();\n         log.debug(user.getLogin() + \" requested access for exercise with exerciseId \" + exerciseId, exerciseId);\n \n-        Exercise exercise = exerciseService.findOneWithDetailsForStudents(exerciseId);\n+        Exercise exercise = exerciseService.findOneWithDetailsForStudents(exerciseId, user);\n         // if exercise is not yet released to the students they should not have any access to it\n         if (!authCheckService.isAllowedToSeeExercise(exercise, user)) {\n             return forbidden();\n         }\n \n         if (exercise != null) {\n-            List<StudentParticipation> participations = participationService.findByExerciseIdAndStudentIdWithEagerResultsAndSubmissions(exercise, user.getId());\n+            List<StudentParticipation> participations = participationService.findByExerciseAndStudentIdWithEagerResultsAndSubmissions(exercise, user.getId());\n             exercise.setStudentParticipations(new HashSet<>());\n             for (StudentParticipation participation : participations) {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTAxNQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393911015", "bodyText": "Is it possible that a team has no members when this is called (e.g. all team members are removed for some reason?)?\nThis would cause an error here, but I don't know if that's a problem or if this is not possible.", "author": "sleiss", "createdAt": "2020-03-17T19:13:35Z", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java", "diffHunk": "@@ -469,7 +469,7 @@ public void combineAllStudentCommits(Repository repository, ProgrammingExercise\n \n             studentGit.reset().setMode(ResetCommand.ResetType.SOFT).setRef(latestHash.getName()).call();\n             studentGit.add().addFilepattern(\".\").call();\n-            var student = ((StudentParticipation) repository.getParticipation()).getStudent();\n+            var student = ((StudentParticipation) repository.getParticipation()).getStudents().iterator().next();", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQwNjgxMA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396406810", "bodyText": "Great catch. In theory it would indeed be possible that someone removed all students from a team that already has programming exercise participations before this method is called. Then this would have thrown a NoSuchElementException. I fixed it so that it uses the existing fallback correctly for empty teams.", "author": "madwau", "createdAt": "2020-03-23T12:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMTAxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\nindex b6f20c4fec..65566d003d 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/connectors/GitService.java\n\n@@ -469,9 +469,9 @@ public class GitService {\n \n             studentGit.reset().setMode(ResetCommand.ResetType.SOFT).setRef(latestHash.getName()).call();\n             studentGit.add().addFilepattern(\".\").call();\n-            var student = ((StudentParticipation) repository.getParticipation()).getStudents().iterator().next();\n-            var name = student != null ? student.getName() : ARTEMIS_GIT_NAME;\n-            var email = student != null ? student.getEmail() : ARTEMIS_GIT_EMAIL;\n+            var optionalStudent = ((StudentParticipation) repository.getParticipation()).getStudents().stream().findFirst();\n+            var name = optionalStudent.map(User::getName).orElse(ARTEMIS_GIT_NAME);\n+            var email = optionalStudent.map(User::getEmail).orElse(ARTEMIS_GIT_EMAIL);\n             studentGit.commit().setMessage(\"All student changes in one commit\").setCommitter(name, email).call();\n \n             // if repo is not closed, it causes weird IO issues when trying to delete the repo again\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNTcyOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393915729", "bodyText": "I would assume this is fine for the log, but maybe @krusche should decide that.", "author": "sleiss", "createdAt": "2020-03-17T19:22:58Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java", "diffHunk": "@@ -87,8 +87,9 @@ public File exportStudentRepositories(long programmingExerciseId, @NotNull List<\n             log.info(\"Request to export all student repositories of programming exercise \" + programmingExerciseId + \" with title '\" + programmingExercise.getTitle() + \"'\");\n         }\n         else {\n+            // TODO: Is this the expected behavior for teams? Or should all team members be listed instead?", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxMDkyOA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396410928", "bodyText": "The TODO placement might have been a little misleading; it refers to the whole method and not just the log statement. But I think you are right that only @krusche has enough insight here to know how exportStudentRepositories should behave for teams. The behavior right now is that it treats teams as it would treat students (and uses the team shortName for the student login).", "author": "madwau", "createdAt": "2020-03-23T12:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNTcyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3NjY4MA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398776680", "bodyText": "should be ok", "author": "krusche", "createdAt": "2020-03-26T17:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNTcyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "574a9a7f3493c633d888742988acfa1a12df6932", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\nindex 3b1ebc32a5..be20baa32f 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\n\n@@ -83,13 +83,13 @@ public class ProgrammingExerciseExportService {\n             RepositoryExportOptionsDTO repositoryExportOptions) {\n         ProgrammingExercise programmingExercise = programmingExerciseRepository.findWithTemplateParticipationAndSolutionParticipationById(programmingExerciseId).get();\n \n-        if (repositoryExportOptions.isExportAllStudents()) {\n-            log.info(\"Request to export all student repositories of programming exercise \" + programmingExerciseId + \" with title '\" + programmingExercise.getTitle() + \"'\");\n+        if (repositoryExportOptions.isExportAllParticipants()) {\n+            log.info(\n+                    \"Request to export all student or team repositories of programming exercise \" + programmingExerciseId + \" with title '\" + programmingExercise.getTitle() + \"'\");\n         }\n         else {\n-            // TODO: Is this the expected behavior for teams? Or should all team members be listed instead?\n             log.info(\"Request to export the repositories of programming exercise \" + programmingExerciseId + \" with title '\" + programmingExercise.getTitle()\n-                    + \"' of the following students/teams: \" + participations.stream().map(StudentParticipation::getParticipantIdentifier).collect(Collectors.joining(\", \")));\n+                    + \"' of the following students or teams: \" + participations.stream().map(StudentParticipation::getParticipantIdentifier).collect(Collectors.joining(\", \")));\n         }\n \n         List<Path> zippedRepoFiles = new ArrayList<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNjIzNA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393916234", "bodyText": "I find this method name now misleading: It pretends to use a exercise id (as it did before), but uses an Exercise object now.\nSame as in ParticipationService.", "author": "sleiss", "createdAt": "2020-03-17T19:23:51Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java", "diffHunk": "@@ -104,17 +106,24 @@ public TemplateProgrammingExerciseParticipation findTemplateParticipationByProgr\n     /**\n      * Tries to retrieve a student participation for the given exercise id and username.\n      *\n-     * @param exerciseId id of the exercise.\n+     * @param exercise the exercise for which to find a participation\n      * @param username of the user to which the participation belongs.\n      * @return the participation for the given exercise and user.\n      * @throws EntityNotFoundException if there is no participation for the given exercise and user.\n      */\n     @Transactional(readOnly = true)\n     @NotNull\n-    public ProgrammingExerciseStudentParticipation findStudentParticipationByExerciseIdAndStudentId(Long exerciseId, String username) throws EntityNotFoundException {\n-        Optional<ProgrammingExerciseStudentParticipation> participation = studentParticipationRepository.findByExerciseIdAndStudentLogin(exerciseId, username);\n+    public ProgrammingExerciseStudentParticipation findStudentParticipationByExerciseIdAndStudentId(Exercise exercise, String username) throws EntityNotFoundException {", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxMjI5Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396412292", "bodyText": "Fixed", "author": "madwau", "createdAt": "2020-03-23T12:25:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNjIzNA=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java\nindex a462be4669..13e089fcf2 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseParticipationService.java\n\n@@ -113,7 +113,7 @@ public class ProgrammingExerciseParticipationService {\n      */\n     @Transactional(readOnly = true)\n     @NotNull\n-    public ProgrammingExerciseStudentParticipation findStudentParticipationByExerciseIdAndStudentId(Exercise exercise, String username) throws EntityNotFoundException {\n+    public ProgrammingExerciseStudentParticipation findStudentParticipationByExerciseAndStudentId(Exercise exercise, String username) throws EntityNotFoundException {\n         Optional<ProgrammingExerciseStudentParticipation> participation;\n         if (exercise.isTeamMode()) {\n             Optional<Team> optionalTeam = teamRepository.findOneByExerciseIdAndUserLogin(exercise.getId(), username);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxNzk5Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393917993", "bodyText": "Usage of misleading method.", "author": "sleiss", "createdAt": "2020-03-17T19:27:13Z", "path": "src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java", "diffHunk": "@@ -72,7 +72,7 @@ public TextSubmissionService(TextSubmissionRepository textSubmissionRepository,\n     public TextSubmission handleTextSubmission(TextSubmission textSubmission, TextExercise textExercise, Principal principal) {\n         // Don't allow submissions after the due date (except if the exercise was started after the due date)\n         final var dueDate = textExercise.getDueDate();\n-        final var optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(textExercise.getId(), principal.getName());\n+        final var optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(textExercise, principal.getName());", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java b/src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java\nindex e528136a02..3293017b8a 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/TextSubmissionService.java\n\n@@ -72,7 +72,7 @@ public class TextSubmissionService extends SubmissionService {\n     public TextSubmission handleTextSubmission(TextSubmission textSubmission, TextExercise textExercise, Principal principal) {\n         // Don't allow submissions after the due date (except if the exercise was started after the due date)\n         final var dueDate = textExercise.getDueDate();\n-        final var optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyState(textExercise, principal.getName());\n+        final var optionalParticipation = participationService.findOneByExerciseAndStudentLoginAnyState(textExercise, principal.getName());\n         if (optionalParticipation.isEmpty()) {\n             throw new ResponseStatusException(HttpStatus.FAILED_DEPENDENCY, \"No participation found for \" + principal.getName() + \" in exercise \" + textExercise.getId());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyMzc2Ng==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393923766", "bodyText": "I don't know if I understand this correctly:\nThis field can have several values for the same Exercise depending on what user is interacting with the Exercise, correct?", "author": "sleiss", "createdAt": "2020-03-17T19:38:24Z", "path": "src/main/java/de/tum/in/www1/artemis/domain/Exercise.java", "diffHunk": "@@ -172,6 +172,9 @@\n     @Transient\n     private Long numberOfOpenMoreFeedbackRequestsTransient;\n \n+    @Transient\n+    private Long studentAssignedTeamIdTransient; // id of the team that the logged-in user is assigned to (only relevant if team mode is enabled)", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NTMyMg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396395322", "bodyText": "Yes, that is correct. It is a dynamically set transient property and the value depends on the logged-in user. There is some precedent for this already on the Exercise model, namely studentParticipations depend on the user as well.", "author": "madwau", "createdAt": "2020-03-23T11:53:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyMzc2Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNDI2Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393924262", "bodyText": "See comment of the field in the class Exercise.", "author": "sleiss", "createdAt": "2020-03-17T19:39:25Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java", "diffHunk": "@@ -123,9 +126,15 @@ else if (authCheckService.isStudentInCourse(course, user)) {\n             exercises = exercises.stream().filter(Exercise::isVisibleToStudents).collect(Collectors.toList());\n         }\n \n-        // filter out questions and all statistical information about the quizPointStatistic from quizExercises (so users can't see which answer options are correct)\n         if (exercises != null) {\n             for (Exercise exercise : exercises) {\n+                // for team-based exercises: add the team that the user has been assigned to onto the exercise\n+                if (exercise.isTeamMode()) {\n+                    teamService.findOneByExerciseAndUser(exercise, user).ifPresent(team -> {\n+                        exercise.setStudentAssignedTeamId(team.getId());", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxMzU4OQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396413589", "bodyText": "I responded to that comment.", "author": "madwau", "createdAt": "2020-03-23T12:28:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNDI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java b/src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java\nindex 3a7de68b0d..f64d1ed4c4 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ExerciseService.java\n\n@@ -128,12 +128,8 @@ public class ExerciseService {\n \n         if (exercises != null) {\n             for (Exercise exercise : exercises) {\n-                // for team-based exercises: add the team that the user has been assigned to onto the exercise\n-                if (exercise.isTeamMode()) {\n-                    teamService.findOneByExerciseAndUser(exercise, user).ifPresent(team -> {\n-                        exercise.setStudentAssignedTeamId(team.getId());\n-                    });\n-                }\n+                setAssignedTeamIdForExerciseAndUser(exercise, user);\n+\n                 // filter out questions and all statistical information about the quizPointStatistic from quizExercises (so users can't see which answer options are correct)\n                 if (exercise instanceof QuizExercise) {\n                     QuizExercise quizExercise = (QuizExercise) exercise;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNTA2Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393925063", "bodyText": "This behaviour will be changed in a future PR, right?", "author": "sleiss", "createdAt": "2020-03-17T19:40:56Z", "path": "src/main/java/de/tum/in/www1/artemis/service/connectors/BitbucketService.java", "diffHunk": "@@ -79,36 +79,50 @@ public BitbucketService(UserService userService, @Qualifier(\"bitbucketRestTempla\n     }\n \n     @Override\n-    public void configureRepository(URL repositoryUrl, String username) {\n-        if (username.startsWith(USER_PREFIX_EDX) || username.startsWith((USER_PREFIX_U4I))) {\n-            // It is an automatically created user\n+    public void configureRepository(URL repositoryUrl, Set<User> users) {\n+        for (User user : users) {\n+            String username = user.getLogin();\n \n-            User user = userService.getUserWithGroupsByLogin(username).get();\n+            if (username.startsWith(USER_PREFIX_EDX) || username.startsWith((USER_PREFIX_U4I))) {\n+                // It is an automatically created user\n \n-            if (!userExists(username)) {\n-                log.debug(\"Bitbucket user {} does not exist yet\", username);\n-                String displayName = (user.getFirstName() + \" \" + user.getLastName()).trim();\n-                createUser(username, userService.decryptPasswordByLogin(username).get(), user.getEmail(), displayName);\n+                if (!userExists(username)) {\n+                    log.debug(\"Bitbucket user {} does not exist yet\", username);\n+                    String displayName = (user.getFirstName() + \" \" + user.getLastName()).trim();\n+                    createUser(username, userService.decryptPasswordByLogin(username).get(), user.getEmail(), displayName);\n \n-                try {\n-                    addUserToGroups(username, user.getGroups());\n+                    try {\n+                        addUserToGroups(username, user.getGroups());\n+                    }\n+                    catch (BitbucketException e) {\n+                        /*\n+                         * This might throw exceptions, for example if the group does not exist on Bitbucket. We can safely ignore them.\n+                         */\n+                    }\n                 }\n-                catch (BitbucketException e) {\n-                    /*\n-                     * This might throw exceptions, for example if the group does not exist on Bitbucket. We can safely ignore them.\n-                     */\n+                else {\n+                    log.debug(\"Bitbucket user {} already exists\", username);\n                 }\n-            }\n-            else {\n-                log.debug(\"Bitbucket user {} already exists\", username);\n+\n             }\n \n+            addMemberToRepository(repositoryUrl, user);\n         }\n \n-        giveWritePermission(getProjectKeyFromUrl(repositoryUrl), getRepositorySlugFromUrl(repositoryUrl), username);\n         protectBranches(getProjectKeyFromUrl(repositoryUrl), getRepositorySlugFromUrl(repositoryUrl));\n     }\n \n+    @Override\n+    public void addMemberToRepository(URL repositoryUrl, User user) {\n+        giveWritePermission(getProjectKeyFromUrl(repositoryUrl), getRepositorySlugFromUrl(repositoryUrl), user.getLogin());\n+    }\n+\n+    @Override\n+    public void removeMemberFromRepository(URL repositoryUrl, User user) {\n+        // TODO: Instead of reducing the permissions to readOnly, the user should be removed from the repo entirely", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NjI1NA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r396396254", "bodyText": "Yes, I think it's better to do this in a separate PR. I put it on my todo list, so it won't be forgotten.", "author": "madwau", "createdAt": "2020-03-23T11:54:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNTA2Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNzY4NA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393927684", "bodyText": "Usage of misleading method.", "author": "sleiss", "createdAt": "2020-03-17T19:46:05Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java", "diffHunk": "@@ -430,7 +438,7 @@ public ResponseEntity getParticipationBuildArtifact(@PathVariable Long participa\n             response = participationForQuizExercise((QuizExercise) exercise, principal.getName());\n         }\n         else {\n-            Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exerciseId, principal.getName());\n+            Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exercise, principal.getName());", "originalCommit": "4a012038c34eb91afd0fa757114c1084ee7dc89d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk3NTkwOQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r393975909", "bodyText": "Fixed.", "author": "madwau", "createdAt": "2020-03-17T21:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNzY4NA=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java\nindex ac3fb37c1a..df979c0c83 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ParticipationResource.java\n\n@@ -438,7 +438,7 @@ public class ParticipationResource {\n             response = participationForQuizExercise((QuizExercise) exercise, principal.getName());\n         }\n         else {\n-            Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseIdAndStudentLoginAnyStateWithEagerResults(exercise, principal.getName());\n+            Optional<StudentParticipation> optionalParticipation = participationService.findOneByExerciseAndStudentLoginAnyStateWithEagerResults(exercise, principal.getName());\n             if (optionalParticipation.isEmpty()) {\n                 throw new ResponseStatusException(HttpStatus.FAILED_DEPENDENCY, \"No participation found for \" + principal.getName() + \" in exercise \" + exerciseId);\n             }\n"}}, {"oid": "87a090d0f77a89dfe889b822d5152efcdafe2f35", "url": "https://github.com/ls1intum/Artemis/commit/87a090d0f77a89dfe889b822d5152efcdafe2f35", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises\n\n# Conflicts:\n#\tsrc/main/webapp/app/entities/exercise.model.ts", "committedDate": "2020-03-17T21:07:03Z", "type": "commit"}, {"oid": "c8e7d314e34b4061eb570cc9aeb3f6babe9df612", "url": "https://github.com/ls1intum/Artemis/commit/c8e7d314e34b4061eb570cc9aeb3f6babe9df612", "message": "Rename methods according to first argument from ExerciseId to Exercise", "committedDate": "2020-03-17T21:17:58Z", "type": "commit"}, {"oid": "233ea517bf7a5bbe563f45ae1bf0932f05a1c811", "url": "https://github.com/ls1intum/Artemis/commit/233ea517bf7a5bbe563f45ae1bf0932f05a1c811", "message": "Get rid of two \"or\"s", "committedDate": "2020-03-17T21:56:51Z", "type": "commit"}, {"oid": "8361812c18d9695ca368618243e02dee306638c8", "url": "https://github.com/ls1intum/Artemis/commit/8361812c18d9695ca368618243e02dee306638c8", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-18T16:53:45Z", "type": "commit"}, {"oid": "2a6f9c413495a2ff742a8c5a815ca64677953cf5", "url": "https://github.com/ls1intum/Artemis/commit/2a6f9c413495a2ff742a8c5a815ca64677953cf5", "message": "Set transient attribute for exercise details request", "committedDate": "2020-03-18T19:00:30Z", "type": "commit"}, {"oid": "616b14ae288148c039ce413380ec97e4393677cb", "url": "https://github.com/ls1intum/Artemis/commit/616b14ae288148c039ce413380ec97e4393677cb", "message": "Fix JavaDoc", "committedDate": "2020-03-18T19:04:15Z", "type": "commit"}, {"oid": "3650ecfac4cd037d8cee726af487caa5c6bebd90", "url": "https://github.com/ls1intum/Artemis/commit/3650ecfac4cd037d8cee726af487caa5c6bebd90", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-21T13:35:05Z", "type": "commit"}, {"oid": "d7563c4471c3f50e5671cb352a1886a76878be74", "url": "https://github.com/ls1intum/Artemis/commit/d7563c4471c3f50e5671cb352a1886a76878be74", "message": "Increate test coverage for TeamResource to 100%", "committedDate": "2020-03-21T15:52:49Z", "type": "commit"}, {"oid": "1cab33e96b1c9813d3b96d8c4b39d71094dfd338", "url": "https://github.com/ls1intum/Artemis/commit/1cab33e96b1c9813d3b96d8c4b39d71094dfd338", "message": "Fix boolean deserialization issue for assignedToTeam (needed for testing team student search)", "committedDate": "2020-03-21T16:43:13Z", "type": "commit"}, {"oid": "264f93c0c856e0333dfb23c939f45c8a1275dda3", "url": "https://github.com/ls1intum/Artemis/commit/264f93c0c856e0333dfb23c939f45c8a1275dda3", "message": "Test assignedTeamIdOnExercise + test that starting a participations fails when no team is assigned yet", "committedDate": "2020-03-21T18:13:30Z", "type": "commit"}, {"oid": "d4d280333d06be796cd1839311e6310615755845", "url": "https://github.com/ls1intum/Artemis/commit/d4d280333d06be796cd1839311e6310615755845", "message": "Fix small bug where students from original team cannot be added back right away when removed from pending team", "committedDate": "2020-03-21T19:37:14Z", "type": "commit"}, {"oid": "dcc5929ba35fcfa071d815f196a40f40483c0e81", "url": "https://github.com/ls1intum/Artemis/commit/dcc5929ba35fcfa071d815f196a40f40483c0e81", "message": "Make \"delete student from team\" button keyboard accessible", "committedDate": "2020-03-22T12:59:30Z", "type": "commit"}, {"oid": "7112bb3098a0ee6adeead812065d70d3b8f25992", "url": "https://github.com/ls1intum/Artemis/commit/7112bb3098a0ee6adeead812065d70d3b8f25992", "message": "Add team-update-dialog.spec.ts", "committedDate": "2020-03-22T16:28:18Z", "type": "commit"}, {"oid": "6038d4c7056f2e5039c3a174756dc3564054f681", "url": "https://github.com/ls1intum/Artemis/commit/6038d4c7056f2e5039c3a174756dc3564054f681", "message": "Update team test case", "committedDate": "2020-03-22T18:47:06Z", "type": "commit"}, {"oid": "4b2236623b18b3f87234b2d95e50a83e97fd1835", "url": "https://github.com/ls1intum/Artemis/commit/4b2236623b18b3f87234b2d95e50a83e97fd1835", "message": "Add first stub for teams.spec.ts", "committedDate": "2020-03-22T21:40:24Z", "type": "commit"}, {"oid": "34b8ec6b29ef5adf0d17b2eac7fdcc7694ec8916", "url": "https://github.com/ls1intum/Artemis/commit/34b8ec6b29ef5adf0d17b2eac7fdcc7694ec8916", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises\n\n# Conflicts:\n#\tsrc/main/webapp/app/exercises/shared/participation/participation.service.ts\n#\tsrc/main/webapp/app/overview/exercise-details/exercise-details-student-actions.component.ts", "committedDate": "2020-03-23T10:58:01Z", "type": "commit"}, {"oid": "d893991978a5a0f6d0734d0d90c0bf11b22bd482", "url": "https://github.com/ls1intum/Artemis/commit/d893991978a5a0f6d0734d0d90c0bf11b22bd482", "message": "Run prettier:format", "committedDate": "2020-03-23T11:48:38Z", "type": "commit"}, {"oid": "be74439748ec005a6879edef48a954921226a8ee", "url": "https://github.com/ls1intum/Artemis/commit/be74439748ec005a6879edef48a954921226a8ee", "message": "Handle participations with no students associated gracefully", "committedDate": "2020-03-23T12:12:03Z", "type": "commit"}, {"oid": "cef85560ba492aa4340cb2985a501c3c85b7f47d", "url": "https://github.com/ls1intum/Artemis/commit/cef85560ba492aa4340cb2985a501c3c85b7f47d", "message": "Fix method name", "committedDate": "2020-03-23T12:25:28Z", "type": "commit"}, {"oid": "97cbdb258849d02d37a30579b3a9fb6a7ef49987", "url": "https://github.com/ls1intum/Artemis/commit/97cbdb258849d02d37a30579b3a9fb6a7ef49987", "message": "Improve search: handle \"query too short\" and \"no results\"", "committedDate": "2020-03-23T13:59:07Z", "type": "commit"}, {"oid": "437b385359b0439ecaba78e6ea0f1dc0388a0829", "url": "https://github.com/ls1intum/Artemis/commit/437b385359b0439ecaba78e6ea0f1dc0388a0829", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-23T15:07:44Z", "type": "commit"}, {"oid": "c7e5caa3e5e0d9dda8304bbaef523317687118fb", "url": "https://github.com/ls1intum/Artemis/commit/c7e5caa3e5e0d9dda8304bbaef523317687118fb", "message": "Team-based exercises focused client tests for exercise-details-student-actions.component.html", "committedDate": "2020-03-23T15:29:01Z", "type": "commit"}, {"oid": "845f5657ad7a7ec755a3cf2cb0f0c110a69852c9", "url": "https://github.com/ls1intum/Artemis/commit/845f5657ad7a7ec755a3cf2cb0f0c110a69852c9", "message": "Merge remote-tracking branch 'origin/feature/team-based-exercises/programming-exercises' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-23T15:29:11Z", "type": "commit"}, {"oid": "11fe6763d370b6ff1c0fda59c98f1e51894762f4", "url": "https://github.com/ls1intum/Artemis/commit/11fe6763d370b6ff1c0fda59c98f1e51894762f4", "message": "Merge remote-tracking branch 'origin/develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-23T15:29:51Z", "type": "commit"}, {"oid": "8547ca35ea671897c2e969030dfca4bc49797141", "url": "https://github.com/ls1intum/Artemis/commit/8547ca35ea671897c2e969030dfca4bc49797141", "message": "Responsive display when modal is too small", "committedDate": "2020-03-23T19:55:40Z", "type": "commit"}, {"oid": "eed87433efe85bd41e40390b40015c6c31ebb1a2", "url": "https://github.com/ls1intum/Artemis/commit/eed87433efe85bd41e40390b40015c6c31ebb1a2", "message": "Improve conflict handling", "committedDate": "2020-03-23T21:07:14Z", "type": "commit"}, {"oid": "733dccc0212f6497834e096498afdb1fc978c541", "url": "https://github.com/ls1intum/Artemis/commit/733dccc0212f6497834e096498afdb1fc978c541", "message": "Fix typo", "committedDate": "2020-03-24T10:13:41Z", "type": "commit"}, {"oid": "4f27302a64b2adade2990456eca37d1106b35e46", "url": "https://github.com/ls1intum/Artemis/commit/4f27302a64b2adade2990456eca37d1106b35e46", "message": "- server test for starting team programming exercises\n- do not use team short name as user info in repoUrl for team repositories (just leave out user info segment of repoUrl for team participations, reinsert in frontend when needed)", "committedDate": "2020-03-24T12:53:33Z", "type": "commit"}, {"oid": "3996d845e4149f5f293cb54f5738e113e6347080", "url": "https://github.com/ls1intum/Artemis/commit/3996d845e4149f5f293cb54f5738e113e6347080", "message": "Fix object mapper module issue", "committedDate": "2020-03-24T13:36:14Z", "type": "commit"}, {"oid": "d076065a2943dbcbb47a86ffb289d7a9c63144e2", "url": "https://github.com/ls1intum/Artemis/commit/d076065a2943dbcbb47a86ffb289d7a9c63144e2", "message": "Fix object mapper module issue", "committedDate": "2020-03-24T14:16:38Z", "type": "commit"}, {"oid": "69062110a93364f3ad5dccd4f2f596f2fa7568d6", "url": "https://github.com/ls1intum/Artemis/commit/69062110a93364f3ad5dccd4f2f596f2fa7568d6", "message": "Revert \"Fix object mapper module issue\"\n\nThis reverts commit d076065a", "committedDate": "2020-03-24T15:00:31Z", "type": "commit"}, {"oid": "d43355048eef974fbf3fbb99fb6dfb834896dff1", "url": "https://github.com/ls1intum/Artemis/commit/d43355048eef974fbf3fbb99fb6dfb834896dff1", "message": "Revert \"Fix object mapper module issue\"\n\nThis reverts commit 3996d845", "committedDate": "2020-03-24T15:00:59Z", "type": "commit"}, {"oid": "8c2de1f8e23ed89f67e1f9dbdd29b8ac1c599fd4", "url": "https://github.com/ls1intum/Artemis/commit/8c2de1f8e23ed89f67e1f9dbdd29b8ac1c599fd4", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-24T15:40:02Z", "type": "commit"}, {"oid": "816297892d15235b51104f0b3e547f57b4c683e1", "url": "https://github.com/ls1intum/Artemis/commit/816297892d15235b51104f0b3e547f57b4c683e1", "message": "Fix test issue caused by different serializers for read/write", "committedDate": "2020-03-24T16:14:53Z", "type": "commit"}, {"oid": "d6cc8f5f51bde2e6498f7329c0099796d3f76c2f", "url": "https://github.com/ls1intum/Artemis/commit/d6cc8f5f51bde2e6498f7329c0099796d3f76c2f", "message": "Merge remote-tracking branch 'origin/feature/team-based-exercises/programming-exercises' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-24T16:15:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzODcwMA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r397938700", "bodyText": "Is there a typo in studentTeamOriginaRepo?", "author": "sleiss", "createdAt": "2020-03-25T15:19:31Z", "path": "src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseBitbucketBambooIntegrationTest.java", "diffHunk": "@@ -113,37 +132,44 @@ public void setup() throws Exception {\n         testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n         solutionRepo.configureRepos(\"solutionLocalRepo\", \"solutionOriginRepo\");\n         studentRepo.configureRepos(\"studentRepo\", \"studentOriginaRepo\");\n+        studentTeamRepo.configureRepos(\"studentTeamRepo\", \"studentTeamOriginaRepo\");", "originalCommit": "d6cc8f5f51bde2e6498f7329c0099796d3f76c2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1MDgxMQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r397950811", "bodyText": "Definitely looks like a typo to me in the original studentOriginaRepo in the line above. I fixed both occurences.", "author": "madwau", "createdAt": "2020-03-25T15:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzODcwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk2NzU3Mw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r397967573", "bodyText": "Perfect!", "author": "sleiss", "createdAt": "2020-03-25T15:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzODcwMA=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseBitbucketBambooIntegrationTest.java b/src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseBitbucketBambooIntegrationTest.java\nindex ed12f9cfb4..542733d407 100644\n--- a/src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseBitbucketBambooIntegrationTest.java\n+++ b/src/test/java/de/tum/in/www1/artemis/programmingexercise/ProgrammingExerciseBitbucketBambooIntegrationTest.java\n\n@@ -131,8 +131,8 @@ public class ProgrammingExerciseBitbucketBambooIntegrationTest extends AbstractS\n         exerciseRepo.configureRepos(\"exerciseLocalRepo\", \"exerciseOriginRepo\");\n         testRepo.configureRepos(\"testLocalRepo\", \"testOriginRepo\");\n         solutionRepo.configureRepos(\"solutionLocalRepo\", \"solutionOriginRepo\");\n-        studentRepo.configureRepos(\"studentRepo\", \"studentOriginaRepo\");\n-        studentTeamRepo.configureRepos(\"studentTeamRepo\", \"studentTeamOriginaRepo\");\n+        studentRepo.configureRepos(\"studentRepo\", \"studentOriginRepo\");\n+        studentTeamRepo.configureRepos(\"studentTeamRepo\", \"studentTeamOriginRepo\");\n \n         final var projectKey = exercise.getProjectKey();\n         String exerciseRepoName = projectKey.toLowerCase() + \"-\" + RepositoryType.TEMPLATE.getName();\n"}}, {"oid": "b6a0aef101d4ab03e084c12b23095f40aea1039d", "url": "https://github.com/ls1intum/Artemis/commit/b6a0aef101d4ab03e084c12b23095f40aea1039d", "message": "Fix typo in origin repo names", "committedDate": "2020-03-25T15:33:09Z", "type": "commit"}, {"oid": "48de619876e3f0001e4cf8b8e099a14aeb08dfd8", "url": "https://github.com/ls1intum/Artemis/commit/48de619876e3f0001e4cf8b8e099a14aeb08dfd8", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-25T15:34:33Z", "type": "commit"}, {"oid": "43aa91d92b2fe35deea78934e59017861ef868d1", "url": "https://github.com/ls1intum/Artemis/commit/43aa91d92b2fe35deea78934e59017861ef868d1", "message": "Merge branch 'develop' into feature/team-based-exercises/programming-exercises", "committedDate": "2020-03-25T21:53:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3NzE3OA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398777178", "bodyText": "I guess the variable studentId should then be renamed to participantId", "author": "krusche", "createdAt": "2020-03-26T17:56:46Z", "path": "src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java", "diffHunk": "@@ -277,15 +278,15 @@ private void createZipFile(Path zipFilePath, List<Path> paths) throws IOExceptio\n     }\n \n     /**\n-     * Adds the student id of the given student participation to the project name in all .project (Eclipse)\n+     * Adds the student/team identifier of the given student participation to the project name in all .project (Eclipse)\n      * and pom.xml (Maven) files found in the given repository.\n      *\n      * @param repo The repository for which the student id should get added\n      * @param programmingExercise The checked out exercise in the repository\n-     * @param participation The student participation for the student id, which should be added.\n+     * @param participation The student participation for the student/team identifier, which should be added.\n      */\n     public void addStudentIdToProjectName(Repository repo, ProgrammingExercise programmingExercise, StudentParticipation participation) {\n-        String studentId = participation.getStudent().getLogin();\n+        String studentId = participation.getParticipantIdentifier();", "originalCommit": "43aa91d92b2fe35deea78934e59017861ef868d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3MzQ2NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399773465", "bodyText": "Renamed it to participantIdentifier.", "author": "madwau", "createdAt": "2020-03-29T09:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3NzE3OA=="}], "type": "inlineReview", "revised_code": {"commit": "b9daf6b1c71b6dc85998dd33d2eb17635c1787f5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\nindex 3b1ebc32a5..88725719ad 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/ProgrammingExerciseExportService.java\n\n@@ -286,7 +286,7 @@ public class ProgrammingExerciseExportService {\n      * @param participation The student participation for the student/team identifier, which should be added.\n      */\n     public void addStudentIdToProjectName(Repository repo, ProgrammingExercise programmingExercise, StudentParticipation participation) {\n-        String studentId = participation.getParticipantIdentifier();\n+        String participantIdentifier = participation.getParticipantIdentifier();\n \n         // Get all files in repository expect .git files\n         List<String> allRepoFiles = listAllFilesInPath(repo.getLocalPath());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg0NTQzNw==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398845437", "bodyText": "I guess we should update this comment", "author": "krusche", "createdAt": "2020-03-26T19:44:25Z", "path": "src/main/java/de/tum/in/www1/artemis/service/scheduled/AutomaticBuildPlanCleanupService.java", "diffHunk": "@@ -67,7 +67,7 @@ public void cleanupBuildPlans() {\n                 // already cleaned up\n                 continue;\n             }\n-            if (participation.getStudent() == null) {\n+            if (participation.getParticipant() == null) {\n                 // we only want to clean up build plans of students", "originalCommit": "43aa91d92b2fe35deea78934e59017861ef868d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg0NTY3Mg==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398845672", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            // we only want to clean up build plans of students\n          \n          \n            \n                            // we only want to clean up build plans of students or teams (NOT template or solution build plans)", "author": "krusche", "createdAt": "2020-03-26T19:44:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg0NTQzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NDA3OA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399774078", "bodyText": "Updated", "author": "madwau", "createdAt": "2020-03-29T10:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg0NTQzNw=="}], "type": "inlineReview", "revised_code": {"commit": "fe5db7d684bd85548156b98d3363c9503927cfd5", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/service/scheduled/AutomaticBuildPlanCleanupService.java b/src/main/java/de/tum/in/www1/artemis/service/scheduled/AutomaticBuildPlanCleanupService.java\nindex c021b4ac1a..c58b8fcd6a 100644\n--- a/src/main/java/de/tum/in/www1/artemis/service/scheduled/AutomaticBuildPlanCleanupService.java\n+++ b/src/main/java/de/tum/in/www1/artemis/service/scheduled/AutomaticBuildPlanCleanupService.java\n\n@@ -68,7 +68,7 @@ public class AutomaticBuildPlanCleanupService {\n                 continue;\n             }\n             if (participation.getParticipant() == null) {\n-                // we only want to clean up build plans of students\n+                // we only want to clean up build plans of students or teams (NOT template or solution build plans)\n                 continue;\n             }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg1MDI3MQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r398850271", "bodyText": "I think there is a small logic error here. In case of a team exercise, we would like to export the repository only, if the team was mentioned in the \"studentList\", otherwise we would export the same repository multiple times, if the students of the same team are mentioned here.\nSo I would suggest we rename studentList to participantList and instructors need to refer to team short names for a team exercise and to student logins for individual exercises.\nIf you don't want to change this here, please add a TODO and fix it in a subsequent PR", "author": "krusche", "createdAt": "2020-03-26T19:52:16Z", "path": "src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java", "diffHunk": "@@ -567,8 +567,8 @@ public ProgrammingExerciseResource(ProgrammingExerciseRepository programmingExer\n         List<ProgrammingExerciseStudentParticipation> exportedStudentParticipations = new ArrayList<>();\n         for (StudentParticipation studentParticipation : programmingExercise.getStudentParticipations()) {\n             ProgrammingExerciseStudentParticipation programmingStudentParticipation = (ProgrammingExerciseStudentParticipation) studentParticipation;\n-            if (repositoryExportOptions.isExportAllStudents() || (programmingStudentParticipation.getRepositoryUrl() != null && studentParticipation.getStudent() != null\n-                    && studentList.contains(studentParticipation.getStudent().getLogin()))) {\n+            if (repositoryExportOptions.isExportAllStudents() || (programmingStudentParticipation.getRepositoryUrl() != null && studentParticipation.getParticipant() != null\n+                    && studentParticipation.getStudents().stream().map(User::getLogin).anyMatch(studentList::contains))) {", "originalCommit": "43aa91d92b2fe35deea78934e59017861ef868d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc4NzIyNA==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399787224", "bodyText": "You are correct. Right now the same repository would get exported multiple times if more than one student from the same team is entered.\nYour suggestion for how to handle this makes total sense. I'll include it here since it should be quick to adapt.", "author": "madwau", "createdAt": "2020-03-29T11:57:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg1MDI3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc5OTg5NQ==", "url": "https://github.com/ls1intum/Artemis/pull/1253#discussion_r399799895", "bodyText": "Export for individual-mode exercises:\n\nExport for team-mode exercises:\n\nI tested the export for individual and team exercises with a specified list of participants and without (i.e. download all).", "author": "madwau", "createdAt": "2020-03-29T13:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg1MDI3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "574a9a7f3493c633d888742988acfa1a12df6932", "chunk": "diff --git a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\nindex fb005ea7fa..4df40e0c47 100644\n--- a/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\n+++ b/src/main/java/de/tum/in/www1/artemis/web/rest/ProgrammingExerciseResource.java\n\n@@ -557,18 +557,18 @@ public class ProgrammingExerciseResource {\n             repositoryExportOptions.setFilterLateSubmissionsDate(programmingExercise.getDueDate());\n         }\n \n-        List<String> studentList = new ArrayList<>();\n-        if (!repositoryExportOptions.isExportAllStudents()) {\n-            studentIds = studentIds.replaceAll(\"\\\\s+\", \"\");\n-            studentList = Arrays.asList(studentIds.split(\",\"));\n+        List<String> participantIdentifierList = new ArrayList<>();\n+        if (!repositoryExportOptions.isExportAllParticipants()) {\n+            participantIdentifiers = participantIdentifiers.replaceAll(\"\\\\s+\", \"\");\n+            participantIdentifierList = Arrays.asList(participantIdentifiers.split(\",\"));\n         }\n \n         // Select the participations that should be exported\n         List<ProgrammingExerciseStudentParticipation> exportedStudentParticipations = new ArrayList<>();\n         for (StudentParticipation studentParticipation : programmingExercise.getStudentParticipations()) {\n             ProgrammingExerciseStudentParticipation programmingStudentParticipation = (ProgrammingExerciseStudentParticipation) studentParticipation;\n-            if (repositoryExportOptions.isExportAllStudents() || (programmingStudentParticipation.getRepositoryUrl() != null && studentParticipation.getParticipant() != null\n-                    && studentParticipation.getStudents().stream().map(User::getLogin).anyMatch(studentList::contains))) {\n+            if (repositoryExportOptions.isExportAllParticipants() || (programmingStudentParticipation.getRepositoryUrl() != null && studentParticipation.getParticipant() != null\n+                    && participantIdentifierList.contains(studentParticipation.getParticipantIdentifier()))) {\n                 exportedStudentParticipations.add(programmingStudentParticipation);\n             }\n         }\n"}}]}