{"pr_number": 2601, "pr_title": "LSP: Hoover the mouse over identifier shows JavaDoc.", "pr_createdAt": "2020-12-16T14:48:58Z", "pr_url": "https://github.com/apache/netbeans/pull/2601", "timeline": [{"oid": "fb147f0e47274bd73ef158fd1780a1b51ee91315", "url": "https://github.com/apache/netbeans/commit/fb147f0e47274bd73ef158fd1780a1b51ee91315", "message": "LSP: Hoover the mouse over identifier shows JavaDoc", "committedDate": "2020-12-16T12:17:09Z", "type": "commit"}, {"oid": "7448a1a68f8d432cc8920f36935cadf9049cdbbf", "url": "https://github.com/apache/netbeans/commit/7448a1a68f8d432cc8920f36935cadf9049cdbbf", "message": "Generate Constructor source action throws InvocationTargetException - fixed.", "committedDate": "2020-12-16T14:44:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQzOTM0NA==", "url": "https://github.com/apache/netbeans/pull/2601#discussion_r544439344", "bodyText": "Isn't this test too JDK specific? What if the wording of the Javadoc changes between the various JDKs? Then the test would fail.\nIt might be safer to create own class with Javadoc and test against it. That one would be stable.", "author": "JaroslavTulach", "createdAt": "2020-12-16T16:26:54Z", "path": "java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java", "diffHunk": "@@ -888,6 +891,73 @@ public void logMessage(MessageParams arg0) {\n                          \"<none>:1:26-1:29\", \"<none>:2:12-2:15\", \"<none>:3:17-3:20\");\n     }\n \n+    public void testHover() throws Exception {\n+        File src = new File(getWorkDir(), \"Test.java\");\n+        src.getParentFile().mkdirs();\n+        String code = \"public class Test {\\n\" +\n+                      \"    public static void main(String[] args) {\\n\" +\n+                      \"        System.out.println(\\\"Hello World!\\\");\\n\" +\n+                      \"    }\\n\" +\n+                      \"}\\n\";\n+        try (Writer w = new FileWriter(src)) {\n+            w.write(code);\n+        }\n+        FileUtil.refreshFor(getWorkDir());\n+        Launcher<LanguageServer> serverLauncher = LSPLauncher.createClientLauncher(new LanguageClient() {\n+            @Override\n+            public void telemetryEvent(Object arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+\n+            @Override\n+            public void publishDiagnostics(PublishDiagnosticsParams params) {\n+            }\n+\n+            @Override\n+            public void showMessage(MessageParams arg0) {\n+            }\n+\n+            @Override\n+            public CompletableFuture<MessageActionItem> showMessageRequest(ShowMessageRequestParams arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+\n+            @Override\n+            public void logMessage(MessageParams arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+        }, client.getInputStream(), client.getOutputStream());\n+        serverLauncher.startListening();\n+        LanguageServer server = serverLauncher.getRemoteProxy();\n+        InitializeResult result = server.initialize(new InitializeParams()).get();\n+        assertTrue(result.getCapabilities().getHoverProvider());\n+        Hover hover = server.getTextDocumentService().hover(new HoverParams(new TextDocumentIdentifier(toURI(src)), new Position(2, 10))).get();\n+        assertNotNull(hover);\n+        assertTrue(hover.getContents().isRight());\n+        MarkupContent content = hover.getContents().getRight();\n+        assertNotNull(content);\n+        assertEquals(content.getKind(), \"markdown\");\n+        assertEquals(content.getValue(), \"**[java.\u200blang](*0)**\\n\" +\n+                \"\\n\" +\n+                \"```\\n\" +\n+                \"public final class System\\n\" +", "originalCommit": "7448a1a68f8d432cc8920f36935cadf9049cdbbf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ3ODg1NA==", "url": "https://github.com/apache/netbeans/pull/2601#discussion_r544478854", "bodyText": "Good catch. Fixed.", "author": "dbalek", "createdAt": "2020-12-16T17:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQzOTM0NA=="}], "type": "inlineReview", "revised_code": {"commit": "88d99a8fb0d40e1ab59e01e682f554443f583bc5", "chunk": "diff --git a/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java b/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\nindex 7b07e0d802..d80ac25610 100644\n--- a/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\n+++ b/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\n\n@@ -894,9 +894,12 @@ public class ServerTest extends NbTestCase {\n     public void testHover() throws Exception {\n         File src = new File(getWorkDir(), \"Test.java\");\n         src.getParentFile().mkdirs();\n-        String code = \"public class Test {\\n\" +\n+        String code = \"/**\\n\" +\n+                      \" * This is a test class with Javadoc.\\n\" +\n+                      \" */\\n\" +\n+                      \"public class Test {\\n\" +\n                       \"    public static void main(String[] args) {\\n\" +\n-                      \"        System.out.println(\\\"Hello World!\\\");\\n\" +\n+                      \"        Test t = new Test();\\n\" +\n                       \"    }\\n\" +\n                       \"}\\n\";\n         try (Writer w = new FileWriter(src)) {\n"}}, {"oid": "88d99a8fb0d40e1ab59e01e682f554443f583bc5", "url": "https://github.com/apache/netbeans/commit/88d99a8fb0d40e1ab59e01e682f554443f583bc5", "message": "Making hover test more robust.", "committedDate": "2020-12-16T17:16:30Z", "type": "commit"}, {"oid": "f29d194c4f47886b97fa2a7a5a626c20dc6eb9a0", "url": "https://github.com/apache/netbeans/commit/f29d194c4f47886b97fa2a7a5a626c20dc6eb9a0", "message": "Merge branch 'apache/master' into dbalek/lsp-hover", "committedDate": "2020-12-17T08:57:42Z", "type": "commit"}]}