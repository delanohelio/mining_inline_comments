{"pr_number": 2530, "pr_title": "First attempt for Java getter/setter generator for the Java LSP server.", "pr_createdAt": "2020-11-09T22:17:47Z", "pr_url": "https://github.com/apache/netbeans/pull/2530", "timeline": [{"oid": "c64eb1a17d33899c890f1e0d8dc27444f8b2405d", "url": "https://github.com/apache/netbeans/commit/c64eb1a17d33899c890f1e0d8dc27444f8b2405d", "message": "First attempt for Java getter/setter generator for the Java LSP server.", "committedDate": "2020-11-09T22:14:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg0NTkwMQ==", "url": "https://github.com/apache/netbeans/pull/2530#discussion_r521845901", "bodyText": "Great, there is a test!", "author": "JaroslavTulach", "createdAt": "2020-11-12T05:20:12Z", "path": "java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java", "diffHunk": "@@ -1134,6 +1140,93 @@ public void logMessage(MessageParams arg0) {\n         }\n     }\n \n+    public void testCodeActionGetterSetting() throws Exception {", "originalCommit": "c64eb1a17d33899c890f1e0d8dc27444f8b2405d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c48f4167cee530c9b47e05ab9f39c3e4310b85f2", "chunk": "diff --git a/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java b/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\nindex 7b8b1c91e9..7daada0a77 100644\n--- a/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\n+++ b/java/java.lsp.server/test/unit/src/org/netbeans/modules/java/lsp/server/protocol/ServerTest.java\n\n@@ -1140,6 +1215,64 @@ public class ServerTest extends NbTestCase {\n         }\n     }\n \n+    public void testWorkspaceSymbols() throws Exception {\n+        File src = new File(getWorkDir(), \"Test.java\");\n+        src.getParentFile().mkdirs();\n+        try (Writer w = new FileWriter(new File(src.getParentFile(), \".test-project\"))) {}\n+        String code = \"public class Test {\\n\" +\n+                      \"    public static class TestNested {}\\n\" +\n+                      \"    public static void testMethod() {}\\n\" +\n+                      \"}\\n\";\n+        try (Writer w = new FileWriter(src)) {\n+            w.write(code);\n+        }\n+        CountDownLatch indexingComplete = new CountDownLatch(1);\n+        Launcher<LanguageServer> serverLauncher = LSPLauncher.createClientLauncher(new LanguageClient() {\n+            @Override\n+            public void telemetryEvent(Object arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+\n+            @Override\n+            public void publishDiagnostics(PublishDiagnosticsParams params) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+\n+            @Override\n+            public void showMessage(MessageParams params) {\n+                if (Server.INDEXING_COMPLETED.equals(params.getMessage())) {\n+                    indexingComplete.countDown();\n+                } else {\n+                    throw new UnsupportedOperationException(\"Unexpected message.\");\n+                }\n+            }\n+\n+            @Override\n+            public CompletableFuture<MessageActionItem> showMessageRequest(ShowMessageRequestParams arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+\n+            @Override\n+            public void logMessage(MessageParams arg0) {\n+                throw new UnsupportedOperationException(\"Not supported yet.\");\n+            }\n+        }, client.getInputStream(), client.getOutputStream());\n+        serverLauncher.startListening();\n+        LanguageServer server = serverLauncher.getRemoteProxy();\n+        InitializeParams initParams = new InitializeParams();\n+        initParams.setRootUri(toURI(getWorkDir()));\n+        InitializeResult result = server.initialize(initParams).get();\n+        indexingComplete.await();\n+        List<? extends SymbolInformation> symbols = server.getWorkspaceService().symbol(new WorkspaceSymbolParams(\"Tes\")).get();\n+        List<String> actual = symbols.stream().map(si -> si.getKind() + \":\" + si.getName() + \":\" + si.getContainerName() + \":\" + si.getDeprecated() + \":\" + toString(si.getLocation())).collect(Collectors.toList());\n+        assertEquals(Arrays.asList(\"Class:Test:Test:false:Test.java:0:0-3:1\",\n+                                   \"Constructor:Test():Test:false:Test.java:0:7-0:7\",\n+                                   \"Method:testMethod():Test:false:Test.java:2:4-2:38\",\n+                                   \"Class:TestNested:Test.TestNested:false:Test.java:1:4-1:37\",\n+                                   \"Constructor:TestNested():Test.TestNested:false:Test.java:1:18-1:18\"),\n+                     actual);\n+    }\n+\n     public void testCodeActionGetterSetting() throws Exception {\n         File src = new File(getWorkDir(), \"Test.java\");\n         src.getParentFile().mkdirs();\n"}}, {"oid": "c48f4167cee530c9b47e05ab9f39c3e4310b85f2", "url": "https://github.com/apache/netbeans/commit/c48f4167cee530c9b47e05ab9f39c3e4310b85f2", "message": "Merging master into java-lsp-getters-setters", "committedDate": "2020-12-01T06:56:03Z", "type": "commit"}, {"oid": "7cccad540e67da6cd9e927e65dca129135ca9353", "url": "https://github.com/apache/netbeans/commit/7cccad540e67da6cd9e927e65dca129135ca9353", "message": "Removing broken import.", "committedDate": "2020-12-01T21:01:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA2MjkxMg==", "url": "https://github.com/apache/netbeans/pull/2530#discussion_r543062912", "bodyText": "I've noticed this code during #2587 and asked why we aren't using URLMapper.findURL(EXTERNAL)?", "author": "JaroslavTulach", "createdAt": "2020-12-15T05:44:32Z", "path": "java/java.lsp.server/src/org/netbeans/modules/java/lsp/server/protocol/TextDocumentServiceImpl.java", "diffHunk": "@@ -1129,7 +1171,115 @@ private JavaSource getSource(String fileUri) {\n         }\n     }\n \n-    private static List<TextEdit> modify2TextEdits(JavaSource js, Task<WorkingCopy> task) throws IOException {\n+    public static Position createPosition(CompilationUnitTree cut, int offset) {\n+        return createPosition(cut.getLineMap(), offset);\n+    }\n+\n+    public static Position createPosition(LineMap lm, int offset) {\n+        return new Position((int) lm.getLineNumber(offset) - 1,\n+                            (int) lm.getColumnNumber(offset) - 1);\n+    }\n+\n+    public static Position createPosition(FileObject file, int offset) {\n+        try {\n+            EditorCookie ec = file.getLookup().lookup(EditorCookie.class);\n+            StyledDocument doc = ec.openDocument();\n+            int line = NbDocument.findLineNumber(doc, offset);\n+            int column = NbDocument.findLineColumn(doc, offset);\n+\n+            return new Position(line, column);\n+        } catch (IOException ex) {\n+            throw new IllegalStateException(ex);\n+        }\n+    }\n+\n+    public static int getOffset(Document doc, Position pos) {\n+        return LineDocumentUtils.getLineStartFromIndex((LineDocument) doc, pos.getLine()) + pos.getCharacter();\n+    }\n+\n+    private static String toUri(FileObject file) {\n+        if (FileUtil.isArchiveArtifact(file)) {", "originalCommit": "7cccad540e67da6cd9e927e65dca129135ca9353", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}