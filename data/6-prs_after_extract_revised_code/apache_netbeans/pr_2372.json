{"pr_number": 2372, "pr_title": "Update dependencies to GraalVM 20.2.0", "pr_createdAt": "2020-09-16T14:44:04Z", "pr_url": "https://github.com/apache/netbeans/pull/2372", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzNDkwOQ==", "url": "https://github.com/apache/netbeans/pull/2372#discussion_r490434909", "bodyText": "Is this change really necessary? It does work in the GraalVM 20.2.0 console (CCing @woess):\n./graalvm-ce-java8-20.2.0/bin/js --jvm\n> let Long = Java.type(\"java.lang.Long\");\n> new Long(33)\n33\n> new Long(\"33\")\n33\nIt would be surprising that the interop behaves differently in the console and in our ScriptEngine...", "author": "JaroslavTulach", "createdAt": "2020-09-17T17:28:42Z", "path": "platform/api.scripting/test/unit/src/org/netbeans/api/scripting/JavaScriptEnginesTest.java", "diffHunk": "@@ -256,7 +256,7 @@ public void allowLoadAClassInJS() throws Exception {\n         // BEGIN: org.netbeans.api.scripting.JavaScriptEnginesTest#allowLoadAClassInJS\n         Object fn = engine.eval(\"(function(obj) {\\n\"\n                 + \"  var Long = Java.type('java.lang.Long');\\n\"\n-                + \"  return new Long(33);\\n\"\n+                + \"  return new Long(\\\"33\\\");\\n\"", "originalCommit": "6f1f59abbbc6f67568fcd6babf2c6a1712d317e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzNzE5OA==", "url": "https://github.com/apache/netbeans/pull/2372#discussion_r490437198", "bodyText": "Well, this is the error that I ran into in CI and also later confirmed locally. Maybe there is a way to turn this off in ScriptEngine configuration?", "author": "daemontus", "createdAt": "2020-09-17T17:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzNDkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcxNjM0MQ==", "url": "https://github.com/apache/netbeans/pull/2372#discussion_r490716341", "bodyText": "aa76809 seems to be a workaround. Requesting Nashorn compatibility mode activates NASHORN_HOST_ACCESS which contains the Long \u21d2 String conversion as identified by Samuel. By calling\nb.put(\"polyglot.js.allowHostAccess\", true);\nafter that one replaces the Nashorn compatibility host access with HostAccess.ALL switching back to the behavior of the engine as of GraalVM 19.3.x. CCing @iamstolis", "author": "JaroslavTulach", "createdAt": "2020-09-18T05:49:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzNDkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc1MDM1MA==", "url": "https://github.com/apache/netbeans/pull/2372#discussion_r490750350", "bodyText": "Yes, this is a known consequence of the new conversion and also a known workaround that removes the new conversion see oracle/graaljs#286\nNote that the conversion itself is not incorrect (in the sense that Nashorn has it as well and so some Nashorn users need it). Unfortunately, the inclusion of the conversion discloses that our method resolution (in truffle) is different than Nashorn one.", "author": "iamstolis", "createdAt": "2020-09-18T07:18:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQzNDkwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "e15a48fe1f6006091b538d5dc7b80485e2e3c0aa", "chunk": "diff --git a/platform/api.scripting/test/unit/src/org/netbeans/api/scripting/JavaScriptEnginesTest.java b/platform/api.scripting/test/unit/src/org/netbeans/api/scripting/JavaScriptEnginesTest.java\nindex befcc1d6ce..58adcbea06 100644\n--- a/platform/api.scripting/test/unit/src/org/netbeans/api/scripting/JavaScriptEnginesTest.java\n+++ b/platform/api.scripting/test/unit/src/org/netbeans/api/scripting/JavaScriptEnginesTest.java\n\n@@ -256,7 +256,7 @@ public class JavaScriptEnginesTest {\n         // BEGIN: org.netbeans.api.scripting.JavaScriptEnginesTest#allowLoadAClassInJS\n         Object fn = engine.eval(\"(function(obj) {\\n\"\n                 + \"  var Long = Java.type('java.lang.Long');\\n\"\n-                + \"  return new Long(\\\"33\\\");\\n\"\n+                + \"  return new Long(33);\\n\"\n                 + \"})\\n\");\n         // END: org.netbeans.api.scripting.JavaScriptEnginesTest#allowLoadAClassInJS\n         assertNotNull(fn);\n"}}, {"oid": "e15a48fe1f6006091b538d5dc7b80485e2e3c0aa", "url": "https://github.com/apache/netbeans/commit/e15a48fe1f6006091b538d5dc7b80485e2e3c0aa", "message": "Update truffle-api dependency to 20.2.0", "committedDate": "2020-09-18T09:18:41Z", "type": "commit"}, {"oid": "b8521d90a3c407a134a935ad80921e9791e87223", "url": "https://github.com/apache/netbeans/commit/b8521d90a3c407a134a935ad80921e9791e87223", "message": "Update graalsdk dependency to 20.2.0", "committedDate": "2020-09-18T09:18:41Z", "type": "commit"}, {"oid": "bc752407a26bde151cacba008260d90a103cb037", "url": "https://github.com/apache/netbeans/commit/bc752407a26bde151cacba008260d90a103cb037", "message": "Update graaljs dependency to 20.2.0", "committedDate": "2020-09-18T09:18:41Z", "type": "commit"}, {"oid": "bcbc5b9de523ba805037fd05cb9f183727113c0e", "url": "https://github.com/apache/netbeans/commit/bcbc5b9de523ba805037fd05cb9f183727113c0e", "message": "CI: Run GraalVM tests on both latest and LTS version", "committedDate": "2020-09-18T09:18:42Z", "type": "commit"}, {"oid": "4357fa94ed93ebff9262bd7b0d11c44851b4feff", "url": "https://github.com/apache/netbeans/commit/4357fa94ed93ebff9262bd7b0d11c44851b4feff", "message": "Resolve method resolution ambiguity.", "committedDate": "2020-09-18T09:18:42Z", "type": "commit"}, {"oid": "686f9824340f27368145a2da541550f53ea4ca49", "url": "https://github.com/apache/netbeans/commit/686f9824340f27368145a2da541550f53ea4ca49", "message": "Increase test memory limit for graal-sdk tests", "committedDate": "2020-09-18T09:18:42Z", "type": "commit"}, {"oid": "df53a865a0b539670065a168a07b70a2c0b334d3", "url": "https://github.com/apache/netbeans/commit/df53a865a0b539670065a168a07b70a2c0b334d3", "message": "Workaround for GR-26188. Calling polyglot.js.allowHostAccess replaces NASHORN_HOST_ACCESS with ALL.", "committedDate": "2020-09-18T09:18:42Z", "type": "commit"}, {"oid": "414a83802f8fd873cef6a698bcdf32b24c92d7c8", "url": "https://github.com/apache/netbeans/commit/414a83802f8fd873cef6a698bcdf32b24c92d7c8", "message": "Update graalsdk public packages.", "committedDate": "2020-09-18T09:18:42Z", "type": "commit"}, {"oid": "414a83802f8fd873cef6a698bcdf32b24c92d7c8", "url": "https://github.com/apache/netbeans/commit/414a83802f8fd873cef6a698bcdf32b24c92d7c8", "message": "Update graalsdk public packages.", "committedDate": "2020-09-18T09:18:42Z", "type": "forcePushed"}, {"oid": "afc3259c158be1bcaaf922597e38a6943d0e510f", "url": "https://github.com/apache/netbeans/commit/afc3259c158be1bcaaf922597e38a6943d0e510f", "message": "Compare the signatures against previous release", "committedDate": "2020-09-18T13:39:46Z", "type": "commit"}, {"oid": "d80c3785866383fdf519855366aba08d5035fd8c", "url": "https://github.com/apache/netbeans/commit/d80c3785866383fdf519855366aba08d5035fd8c", "message": "Regenerating GraalSDK and Truffle API signature to match 20.2.0 version", "committedDate": "2020-09-18T14:33:06Z", "type": "commit"}, {"oid": "714f3403e75266a104084f1a209b8e63d0b876dc", "url": "https://github.com/apache/netbeans/commit/714f3403e75266a104084f1a209b8e63d0b876dc", "message": "Adjusting other .sig files to now enabled 'ant check-sigtests-release' test", "committedDate": "2020-09-18T14:33:44Z", "type": "commit"}, {"oid": "eed81f5d058b652683884a9a11a17cf6cc55adb7", "url": "https://github.com/apache/netbeans/commit/eed81f5d058b652683884a9a11a17cf6cc55adb7", "message": "Increasing spec versions of all three Graal.js related modules as they depend on each other", "committedDate": "2020-09-18T15:17:46Z", "type": "commit"}]}