{"pr_number": 3288, "pr_title": "Tranks link pathway id in response", "pr_createdAt": "2020-12-11T14:59:32Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288", "timeline": [{"oid": "7e47795b75f30c549864488d1201ca61988be3bb", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7e47795b75f30c549864488d1201ca61988be3bb", "message": "TOTP-9 changes to pass the feedscopedID to the the route for pathways.", "committedDate": "2020-12-08T22:50:59Z", "type": "commit"}, {"oid": "49fde08938b9af81f4e2f6676a58e6780ae7d0f1", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/49fde08938b9af81f4e2f6676a58e6780ae7d0f1", "message": "Updating Changelog.md", "committedDate": "2020-12-11T14:57:04Z", "type": "commit"}, {"oid": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "message": "Merge branch 'dev-2.x' into tranksLink_pathway_id_in_response", "committedDate": "2020-12-15T13:06:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNTM4MA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545705380", "bodyText": "We avoid using toString anywhere in the mapping. The internal model objects uses the toString for logging and debugging ONLY. Here you should use the: FeedScopedIdMapper.mapToApi(..), also we want to support different id implementation in the future, and this code would fail silently if we do that.", "author": "t2gran", "createdAt": "2020-12-18T09:27:06Z", "path": "src/main/java/org/opentripplanner/api/mapping/LegMapper.java", "diffHunk": "@@ -80,6 +80,9 @@ public ApiLeg mapLeg(Leg domain, Calendar arrivalTimeFromPlace, Calendar departu\n             api.tripShortName = trip.getTripShortName();\n             api.tripBlockId = trip.getBlockId();\n         }\n+        else if (domain.pathway) {\n+            api.route = domain.edgeIdentifier.toString();", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "chunk": "diff --git a/src/main/java/org/opentripplanner/api/mapping/LegMapper.java b/src/main/java/org/opentripplanner/api/mapping/LegMapper.java\nindex dbafd672a..11fdde035 100644\n--- a/src/main/java/org/opentripplanner/api/mapping/LegMapper.java\n+++ b/src/main/java/org/opentripplanner/api/mapping/LegMapper.java\n\n@@ -81,7 +81,7 @@ public class LegMapper {\n             api.tripBlockId = trip.getBlockId();\n         }\n         else if (domain.pathway) {\n-            api.route = domain.edgeIdentifier.toString();\n+            api.route = FeedScopedIdMapper.mapToApi(domain.edgeIdentifier);\n         }\n         else {\n             // TODO OTP2 - This should be set to the street name according to the JavaDoc\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwOTY2NQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545709665", "bodyText": "Minor thing, but try to keep the constructor arguments in the order they are defined. Theid is normally the first field in an entity class, but since the class inherit edge, put the id after the toVertex in the list.", "author": "t2gran", "createdAt": "2020-12-18T09:31:33Z", "path": "src/main/java/org/opentripplanner/graph_builder/module/AddTransitModelEntitiesToGraph.java", "diffHunk": "@@ -205,7 +205,8 @@ private void createPathwayEdgesAndAddThemToGraph(Graph graph) {\n                         pathway.getLength(),\n                         pathway.getStairCount(),\n                         pathway.getSlope(),\n-                        pathway.isPathwayModeWheelchairAccessible()\n+                        pathway.isPathwayModeWheelchairAccessible(),\n+                        pathway.getId()", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "chunk": "diff --git a/src/main/java/org/opentripplanner/graph_builder/module/AddTransitModelEntitiesToGraph.java b/src/main/java/org/opentripplanner/graph_builder/module/AddTransitModelEntitiesToGraph.java\nindex c4f68a6c7..9ec1f6489 100644\n--- a/src/main/java/org/opentripplanner/graph_builder/module/AddTransitModelEntitiesToGraph.java\n+++ b/src/main/java/org/opentripplanner/graph_builder/module/AddTransitModelEntitiesToGraph.java\n\n@@ -200,13 +200,13 @@ public class AddTransitModelEntitiesToGraph {\n                     new PathwayEdge(\n                         fromVertex,\n                         toVertex,\n+                        pathway.getId(),\n                         pathway.getName(),\n                         pathway.getTraversalTime(),\n                         pathway.getLength(),\n                         pathway.getStairCount(),\n                         pathway.getSlope(),\n-                        pathway.isPathwayModeWheelchairAccessible(),\n-                        pathway.getId()\n+                        pathway.isPathwayModeWheelchairAccessible()\n                     );\n                     if (pathway.isBidirectional()) {\n                         new PathwayEdge(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMDE5Mw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545710193", "bodyText": "We do not use * imports in OTP2.", "author": "t2gran", "createdAt": "2020-12-18T09:32:19Z", "path": "src/main/java/org/opentripplanner/model/plan/Leg.java", "diffHunk": "@@ -1,10 +1,6 @@\n package org.opentripplanner.model.plan;\n \n-import org.opentripplanner.model.Agency;\n-import org.opentripplanner.model.Operator;\n-import org.opentripplanner.model.Route;\n-import org.opentripplanner.model.StreetNote;\n-import org.opentripplanner.model.Trip;\n+import org.opentripplanner.model.*;", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "chunk": "diff --git a/src/main/java/org/opentripplanner/model/plan/Leg.java b/src/main/java/org/opentripplanner/model/plan/Leg.java\nindex ce6d3aef0..0cf8a9422 100644\n--- a/src/main/java/org/opentripplanner/model/plan/Leg.java\n+++ b/src/main/java/org/opentripplanner/model/plan/Leg.java\n\n@@ -1,6 +1,8 @@\n package org.opentripplanner.model.plan;\n \n-import org.opentripplanner.model.*;\n+\n+import org.opentripplanner.model.FeedScopedId;\n+import org.opentripplanner.model.Trip;\n import org.opentripplanner.model.base.ToStringBuilder;\n import org.opentripplanner.model.calendar.ServiceDate;\n import org.opentripplanner.routing.alertpatch.TransitAlert;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMDI5Ng==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545710296", "bodyText": "indentation", "author": "t2gran", "createdAt": "2020-12-18T09:32:30Z", "path": "src/main/java/org/opentripplanner/model/plan/Leg.java", "diffHunk": "@@ -29,6 +25,7 @@\n    */\n   public final TraverseMode mode;\n \n+    public FeedScopedId edgeIdentifier;", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "chunk": "diff --git a/src/main/java/org/opentripplanner/model/plan/Leg.java b/src/main/java/org/opentripplanner/model/plan/Leg.java\nindex ce6d3aef0..0cf8a9422 100644\n--- a/src/main/java/org/opentripplanner/model/plan/Leg.java\n+++ b/src/main/java/org/opentripplanner/model/plan/Leg.java\n\n@@ -25,7 +27,7 @@ public class Leg {\n    */\n   public final TraverseMode mode;\n \n-    public FeedScopedId edgeIdentifier;\n+  public FeedScopedId edgeIdentifier;\n \n   private final Trip trip;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMTM2OA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545711368", "bodyText": "Rename and add javadoc", "author": "t2gran", "createdAt": "2020-12-18T09:34:28Z", "path": "src/main/java/org/opentripplanner/routing/algorithm/mapping/GraphPathToItineraryMapper.java", "diffHunk": "@@ -357,6 +358,19 @@ private static void setLegPathwayFlag(List<Leg> legs, State[][] legsStates) {\n         }\n     }\n \n+    private static void setRoute(List<Leg> legs, State[][] legsStates) {", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTczNDc5MA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r549734790", "bodyText": "Quick question about the rename comment is there a preferred name you would like for this to make sure I stay within convention?  @t2gran", "author": "mmaranda-cs", "createdAt": "2020-12-29T14:57:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMTM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDUxMjU1Mg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r564512552", "bodyText": "I would expect a Route to be a transit Line/Route, this seems to be adding references to the PathwayEdge id. I am not to familiar with what those ids are - so a comment on which information is added to the Leg would be nice. I also  see that this is only done for one leg? Why? It might be ok to use the word Route, but I was not sure if this was a copy/paste error or not, since nothing else in this method include the word route.", "author": "t2gran", "createdAt": "2021-01-26T13:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMTM2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NDUyMDY2Mg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r564520662", "bodyText": "Maybe something like setLegPathwayId.", "author": "t2gran", "createdAt": "2021-01-26T13:46:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMTM2OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNTcyMQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3288#discussion_r545715721", "bodyText": "Move id up as the first field. We try to keep things readable, and it is a common de-facto standard that ids are defined before other fields in entities.  The serialVersionUID is also defined after the constructor, could you clean it up a bit and move it up as the first declared field. I know you did not do that.", "author": "t2gran", "createdAt": "2020-12-18T09:42:09Z", "path": "src/main/java/org/opentripplanner/routing/edgetype/PathwayEdge.java", "diffHunk": "@@ -23,6 +24,7 @@\n     private String name = \"pathway\";\n \n     private boolean wheelchairAccessible = true;\n+    private FeedScopedId id;", "originalCommit": "22e2ce4ddddd3c6a0f13ff57a26a25511033ed2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "chunk": "diff --git a/src/main/java/org/opentripplanner/routing/edgetype/PathwayEdge.java b/src/main/java/org/opentripplanner/routing/edgetype/PathwayEdge.java\nindex 2cb94c206..dc02820dc 100644\n--- a/src/main/java/org/opentripplanner/routing/edgetype/PathwayEdge.java\n+++ b/src/main/java/org/opentripplanner/routing/edgetype/PathwayEdge.java\n\n@@ -17,6 +17,8 @@ import java.util.Locale;\n  */\n public class PathwayEdge extends Edge {\n \n+    private static final long serialVersionUID = -3311099256178798982L;\n+\n     private int traversalTime;\n     private double distance;\n     private int steps;\n"}}, {"oid": "bfbb29c779ddb2d40888a513b05efd0aa910838d", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/bfbb29c779ddb2d40888a513b05efd0aa910838d", "message": "Adding the relaxed Cost setter", "committedDate": "2020-12-29T14:59:37Z", "type": "commit"}, {"oid": "7ed55dbc90c8615f8ba7508601ce2370b43bf269", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/7ed55dbc90c8615f8ba7508601ce2370b43bf269", "message": "Adding the relaxed Cost setter", "committedDate": "2020-12-29T15:31:27Z", "type": "commit"}, {"oid": "1b4769d14660e605fda60566bc5b7fe457603fd1", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/1b4769d14660e605fda60566bc5b7fe457603fd1", "message": "Merge branch 'dev-2.x' of https://github.com/opentripplanner/OpenTripPlanner into tranksLink_pathway_id_in_response", "committedDate": "2020-12-29T15:31:52Z", "type": "commit"}, {"oid": "98bbc784e9194f4298fadb8651a3a5708baeffa5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/98bbc784e9194f4298fadb8651a3a5708baeffa5", "message": "Merge remote-tracking branch 'origin/tranksLink_pathway_id_in_response' into tranksLink_pathway_id_in_response", "committedDate": "2020-12-29T15:41:25Z", "type": "commit"}, {"oid": "9eb4c052620759f599d3053d7b5ae6531ffe874f", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9eb4c052620759f599d3053d7b5ae6531ffe874f", "message": "Merge branch 'dev-2.x' of https://github.com/opentripplanner/OpenTripPlanner into tranksLink_pathway_id_in_response", "committedDate": "2021-03-01T13:55:59Z", "type": "commit"}]}