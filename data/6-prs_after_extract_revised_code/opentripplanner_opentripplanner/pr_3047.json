{"pr_number": 3047, "pr_title": "Add transfer priority to station", "pr_createdAt": "2020-04-22T16:37:50Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3047", "timeline": [{"oid": "23e96b1485b40f2acd1dcb67ca63d72368cc9394", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/23e96b1485b40f2acd1dcb67ca63d72368cc9394", "message": "Integrate Stop Transfer board/alight cost with into the Raptor routing.\n- Add documentation on configuration and update JavaDoc.\n- Add/update unit tests on config, mapping and calculations.", "committedDate": "2020-04-22T16:58:13Z", "type": "forcePushed"}, {"oid": "3bf966189b6212c440813d93f8fb2d5d812ef56b", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3bf966189b6212c440813d93f8fb2d5d812ef56b", "message": "Clean code - SpeedTest - Log OTP version at the end of the test, so it become easy to compare results with other versions of OTP.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "73d504954a8ff36575af6dc7e1d2791f8eb17d8a", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/73d504954a8ff36575af6dc7e1d2791f8eb17d8a", "message": "Remove boardSlack from heuristic cost minimum calculation, the board/alight slack is part of the minTravelTime and should not be part of any additional cost. The current heuristic cost calculation is not working properly - this is just a temporary correction. A real fix to this is to use a reverse search to calculate the generalized cost, not estimating it from an other search.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "0d87bb9a2cf3688dd8c448494377e43e7c336d06", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/0d87bb9a2cf3688dd8c448494377e43e7c336d06", "message": "Clean code\n  - Rename OTP internal 'cost' in Raptor path to 'generalizedCost'.\n  - Make CostCalculator.toOtpDomainCost none static, this enable extracting interface later.\n  - Make SearchContext.lifeCycleSubscriptions final, and add a close() method to prevent new subscriptions from being added.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "2823d9c333a9268a8b54ef8a416e9694204f08b0", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/2823d9c333a9268a8b54ef8a416e9694204f08b0", "message": "Clean code - Extract CostCalculator as an interface. This wil enable us to provide alternative cost calculators later.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "60f6ed4eaa1976bbf2aa3399dc745ce8bd2cd9c9", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/60f6ed4eaa1976bbf2aa3399dc745ce8bd2cd9c9", "message": "Refactor Station, Stop and all other StationElements to have final fields for all fields with basic types. This will make it simpler tp make the internal OTP Transit domain model immutable later.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "a01aa5322ee617c0d36aea06fbead7fbd03557fa", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a01aa5322ee617c0d36aea06fbead7fbd03557fa", "message": "Add TransferCostPriority to internal model and map from NeTEx model into internal domain model.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "b08b7489d6d448f00c70c6348665afd3d390c37d", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b08b7489d6d448f00c70c6348665afd3d390c37d", "message": "Clean code - Formatting McRangeRaptorWorkerState - no code changes", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "ccde367e0f06cd18a163dd03d6275ce3b9dc76e1", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/ccde367e0f06cd18a163dd03d6275ce3b9dc76e1", "message": "Clean code - Add OtpStartupInfo to the SpeedTest as well.", "committedDate": "2020-04-22T17:03:55Z", "type": "commit"}, {"oid": "8f3cc789ebfcf35080c98876592bee8f0c452477", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8f3cc789ebfcf35080c98876592bee8f0c452477", "message": "Integrate Stop Transfer board/alight cost with into the Raptor routing.\n- Add documentation on configuration and update JavaDoc.\n- Add/update unit tests on config, mapping and calculations.", "committedDate": "2020-04-22T17:03:55Z", "type": "forcePushed"}, {"oid": "916bc210eb6f759acc1e1c8d98a8e426e984ea59", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/916bc210eb6f759acc1e1c8d98a8e426e984ea59", "message": "Integrate Stop Transfer board/alight cost with into the Raptor routing.\n- Add documentation on configuration and update JavaDoc.\n- Add/update unit tests on config, mapping and calculations.", "committedDate": "2020-04-22T17:50:47Z", "type": "commit"}, {"oid": "916bc210eb6f759acc1e1c8d98a8e426e984ea59", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/916bc210eb6f759acc1e1c8d98a8e426e984ea59", "message": "Integrate Stop Transfer board/alight cost with into the Raptor routing.\n- Add documentation on configuration and update JavaDoc.\n- Add/update unit tests on config, mapping and calculations.", "committedDate": "2020-04-22T17:50:47Z", "type": "forcePushed"}, {"oid": "a7a4b925b137fba89e23e76c8269ffaa2030015e", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a7a4b925b137fba89e23e76c8269ffaa2030015e", "message": "Merge branch 'dev-2.x' into otp2_station_priority", "committedDate": "2020-04-23T08:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2NDM0Nw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3047#discussion_r413664347", "bodyText": "Cost is an implementation detail, it does not need to be mentioned in the name. We could change to TransferPriority.", "author": "abyrd", "createdAt": "2020-04-23T09:34:14Z", "path": "src/main/java/org/opentripplanner/model/TransferCostPriority.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.opentripplanner.model;\n+\n+\n+/**\n+ * Categorize how suitable a Station or Transfer is it for transfer. The values arrange\n+ * stops from transfer FORBIDDEN to PREFERRED. First of all this should encourage\n+ * transfers between two trips/routes to happen at the best possible location if there\n+ * are multiple stop to choose from. But, it will also apply to score a journey over\n+ * another one, if one of the journeys score better on the transfers, and they have the\n+ * same cost.\n+ */\n+public enum TransferCostPriority {", "originalCommit": "a01aa5322ee617c0d36aea06fbead7fbd03557fa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0eeeb5ccce605eeb0abe418f22e2351922f7e450", "chunk": "diff --git a/src/main/java/org/opentripplanner/model/TransferCostPriority.java b/src/main/java/org/opentripplanner/model/TransferCostPriority.java\nindex 6195192f9..498b3997d 100644\n--- a/src/main/java/org/opentripplanner/model/TransferCostPriority.java\n+++ b/src/main/java/org/opentripplanner/model/TransferCostPriority.java\n\n@@ -3,22 +3,39 @@ package org.opentripplanner.model;\n \n /**\n  * Categorize how suitable a Station or Transfer is it for transfer. The values arrange\n- * stops from transfer FORBIDDEN to PREFERRED. First of all this should encourage\n+ * stops from transfer DISCOURAGED to PREFERRED. First of all this should encourage\n  * transfers between two trips/routes to happen at the best possible location if there\n  * are multiple stop to choose from. But, it will also apply to score a journey over\n  * another one, if one of the journeys score better on the transfers, and they have the\n  * same cost.\n  */\n public enum TransferCostPriority {\n-    /** Block transfers from/to this stop. */\n-    FORBIDDEN,\n+    /**\n+     * Block transfers from/to this stop. In OTP this is not a definitive block,\n+     * just a huge penalty is added to the cost function.\n+     * <p>\n+     * NeTEx equivalent is NO_INTERCHANGE.\n+     */\n+    DISCOURAGED,\n \n-    /** Allow transfers from/to this stop. This is the default. */\n+    /**\n+     * Allow transfers from/to this stop. This is the default.\n+     * <p>\n+     * NeTEx equivalent is INTERCHANGE_ALLOWED.\n+     */\n     ALLOWED,\n \n-    /** Recommended stop place. */\n+    /**\n+     * Recommended stop place.\n+     * <p>\n+     * NeTEx equivalent is RECOMMENDED_INTERCHANGE.\n+     */\n     RECOMMENDED,\n \n-    /** Preferred place to transfer, strongly recommended. */\n+    /**\n+     * Preferred place to transfer, strongly recommended.\n+     * <p>\n+     * NeTEx equivalent is PREFERRED_INTERCHANGE.\n+     */\n     PREFERRED;\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzY2ODY2OQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3047#discussion_r413668669", "bodyText": "Change mapper class name to match TransferCostPriority.", "author": "abyrd", "createdAt": "2020-04-23T09:40:30Z", "path": "src/main/java/org/opentripplanner/netex/loader/mapping/TransferCostPriorityMapper.java", "diffHunk": "@@ -0,0 +1,19 @@\n+package org.opentripplanner.netex.loader.mapping;\n+\n+import org.opentripplanner.model.TransferCostPriority;\n+import org.rutebanken.netex.model.InterchangeWeightingEnumeration;\n+\n+public class TransferCostPriorityMapper {", "originalCommit": "a01aa5322ee617c0d36aea06fbead7fbd03557fa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0eeeb5ccce605eeb0abe418f22e2351922f7e450", "chunk": "diff --git a/src/main/java/org/opentripplanner/netex/loader/mapping/TransferCostPriorityMapper.java b/src/main/java/org/opentripplanner/netex/loader/mapping/TransferCostPriorityMapper.java\nindex a39586812..2b042ebf9 100644\n--- a/src/main/java/org/opentripplanner/netex/loader/mapping/TransferCostPriorityMapper.java\n+++ b/src/main/java/org/opentripplanner/netex/loader/mapping/TransferCostPriorityMapper.java\n\n@@ -9,7 +9,7 @@ public class TransferCostPriorityMapper {\n         if(value == null) { return null; }\n \n         switch (value) {\n-            case NO_INTERCHANGE: return TransferCostPriority.FORBIDDEN;\n+            case NO_INTERCHANGE: return TransferCostPriority.DISCOURAGED;\n             case INTERCHANGE_ALLOWED: return TransferCostPriority.ALLOWED;\n             case PREFERRED_INTERCHANGE: return TransferCostPriority.PREFERRED;\n             case RECOMMENDED_INTERCHANGE: return TransferCostPriority.RECOMMENDED;\n"}}, {"oid": "0eeeb5ccce605eeb0abe418f22e2351922f7e450", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/0eeeb5ccce605eeb0abe418f22e2351922f7e450", "message": "Bugfix - The `enableStopTransferPriority()` is inverted. StopTransferPriority should only be enabled if it is configured, not if it is NOT configured.", "committedDate": "2020-04-23T10:25:35Z", "type": "commit"}, {"oid": "64d058227253de3a256021ab876a73d9a6a64cf6", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/64d058227253de3a256021ab876a73d9a6a64cf6", "message": "Clean code - Take away the frame around the ASCII ART at start-up.", "committedDate": "2020-04-23T10:29:33Z", "type": "commit"}, {"oid": "27d45ce0befb571acf7eef1be17ebf35d4bd926d", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/27d45ce0befb571acf7eef1be17ebf35d4bd926d", "message": "PR Review - Rename TransferCostPriority to TransferPriority, and all related classes like test and mappers. The documentation is also updated.", "committedDate": "2020-04-23T10:29:38Z", "type": "commit"}, {"oid": "76a38e218ce8f0017c34e6fa962c1f02cd8541cb", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/76a38e218ce8f0017c34e6fa962c1f02cd8541cb", "message": "Merge branch 'dev-2.x' into otp2_station_priority", "committedDate": "2020-04-23T10:33:27Z", "type": "commit"}]}