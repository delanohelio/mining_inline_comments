{"pr_number": 3035, "pr_title": "Make agency id feed scoped", "pr_createdAt": "2020-04-16T13:24:08Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035", "timeline": [{"oid": "8d27442e8c74f5ae1c4ff0bf911fecaf4e4160e5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8d27442e8c74f5ae1c4ff0bf911fecaf4e4160e5", "message": "Make agency id feed scoped", "committedDate": "2020-04-17T18:05:53Z", "type": "forcePushed"}, {"oid": "9a24e2d917ddeff475af7151ee2d820c5c284d87", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/9a24e2d917ddeff475af7151ee2d820c5c284d87", "message": "Add changelog + migration entries", "committedDate": "2020-04-21T08:30:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc2NDA5OA==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r412764098", "bodyText": "This is repeated several times.  I suggest making a static parse function in the FeedScopedId.", "author": "t2gran", "createdAt": "2020-04-22T08:06:12Z", "path": "src/main/java/org/opentripplanner/routing/request/RoutingRequest.java", "diffHunk": "@@ -820,7 +820,12 @@ public void setBikeBoardCost(int bikeBoardCost) {\n     public void setPreferredAgencies(String s) {\n         if (!s.isEmpty()) {\n             preferredAgencies = new HashSet<>();\n-            Collections.addAll(preferredAgencies, s.split(\",\"));\n+            Collections.addAll(\n+                preferredAgencies,\n+                Arrays.stream(s.split(\",\"))\n+                    .map(FeedScopedId::convertFromString)\n+                    .toArray(FeedScopedId[]::new)\n+            );", "originalCommit": "5d07ca52cd4e45b8094a3aa8fea95a4f428b71cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjk5NTA1MQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r412995051", "bodyText": "Added a static method convertFromConcatenatedString  in FeedScopedId for this.", "author": "hannesj", "createdAt": "2020-04-22T13:44:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjc2NDA5OA=="}], "type": "inlineReview", "revised_code": {"commit": "09792700539f9fc2cb36fea056d858ed77e73020", "chunk": "diff --git a/src/main/java/org/opentripplanner/routing/request/RoutingRequest.java b/src/main/java/org/opentripplanner/routing/request/RoutingRequest.java\nindex b004ff13e..8c7e8e884 100644\n--- a/src/main/java/org/opentripplanner/routing/request/RoutingRequest.java\n+++ b/src/main/java/org/opentripplanner/routing/request/RoutingRequest.java\n\n@@ -819,13 +819,7 @@ public class RoutingRequest implements Cloneable, Serializable {\n \n     public void setPreferredAgencies(String s) {\n         if (!s.isEmpty()) {\n-            preferredAgencies = new HashSet<>();\n-            Collections.addAll(\n-                preferredAgencies,\n-                Arrays.stream(s.split(\",\"))\n-                    .map(FeedScopedId::convertFromString)\n-                    .toArray(FeedScopedId[]::new)\n-            );\n+            preferredAgencies = FeedScopedId.convertFromConcatenatedString(s);\n         }\n     }\n \n"}}, {"oid": "dabe10f0924bd420489061e6ecdc4a6bb5afd117", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/dabe10f0924bd420489061e6ecdc4a6bb5afd117", "message": "Make agency id feed scoped", "committedDate": "2020-04-22T13:40:52Z", "type": "commit"}, {"oid": "3fdb08f51abc0eaed2692ce4109ea121ead07d7e", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/3fdb08f51abc0eaed2692ce4109ea121ead07d7e", "message": "Expose all ids as strings in the API", "committedDate": "2020-04-22T13:40:52Z", "type": "commit"}, {"oid": "5cf6226c5ee66c2905ffd66d6b7dd38bdecdad59", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5cf6226c5ee66c2905ffd66d6b7dd38bdecdad59", "message": "Add changelog + migration entries", "committedDate": "2020-04-22T13:42:31Z", "type": "commit"}, {"oid": "09792700539f9fc2cb36fea056d858ed77e73020", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09792700539f9fc2cb36fea056d858ed77e73020", "message": "Add a utility method from converting from a string to a set of feed scoped ids", "committedDate": "2020-04-22T13:42:31Z", "type": "commit"}, {"oid": "09792700539f9fc2cb36fea056d858ed77e73020", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09792700539f9fc2cb36fea056d858ed77e73020", "message": "Add a utility method from converting from a string to a set of feed scoped ids", "committedDate": "2020-04-22T13:42:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE3MDU1Ng==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r413170556", "bodyText": "I would call this function convertFromListOfIds or parseListOfIds. I prefer parseoverconvert`, but we already used convert for the single element version, so it should be consistent.", "author": "t2gran", "createdAt": "2020-04-22T17:20:58Z", "path": "src/main/java/org/opentripplanner/model/FeedScopedId.java", "diffHunk": "@@ -105,4 +108,14 @@ public static String convertToString(FeedScopedId aid) {\n     public static String concatenateId(String feedId, String id) {\n         return feedId + ID_SEPARATOR + id;\n     }\n+\n+    /**\n+     * Converts a string consisting of concatenated FeedScopedIds to a Set\n+     */\n+    public static HashSet<FeedScopedId> convertFromConcatenatedString(String s) {", "originalCommit": "09792700539f9fc2cb36fea056d858ed77e73020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYwNzkyMQ==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3035#discussion_r413607921", "bodyText": "Changed both of these to start with convert", "author": "hannesj", "createdAt": "2020-04-23T08:14:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE3MDU1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "27dde83a84a3fb5415ce2d19cc7499cd2a747d19", "chunk": "diff --git a/src/main/java/org/opentripplanner/model/FeedScopedId.java b/src/main/java/org/opentripplanner/model/FeedScopedId.java\nindex 3d59cd938..816ea2efc 100644\n--- a/src/main/java/org/opentripplanner/model/FeedScopedId.java\n+++ b/src/main/java/org/opentripplanner/model/FeedScopedId.java\n\n@@ -88,20 +88,6 @@ public final class FeedScopedId implements Serializable, Comparable<FeedScopedId\n         return value != null && value.indexOf(ID_SEPARATOR) > -1;\n     }\n \n-    /**\n-     * Given an {@link FeedScopedId} object, creates a string representation of the\n-     * form \"agencyId_entityId\"\n-     *\n-     * @param aid an id object\n-     * @return a string representation of the form \"agencyId_entityId\"\n-     */\n-    public static String convertToString(FeedScopedId aid) {\n-        if (aid == null) {\n-            return null;\n-        }\n-        return concatenateId(aid.feedId, aid.id);\n-    }\n-\n     /**\n      * Concatenate agencyId and id into a string.\n      */\n"}}, {"oid": "27dde83a84a3fb5415ce2d19cc7499cd2a747d19", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/27dde83a84a3fb5415ce2d19cc7499cd2a747d19", "message": "Rename from convert to parse in FeedScopedId", "committedDate": "2020-04-23T08:06:38Z", "type": "commit"}, {"oid": "c61d7d3b9e3302a0718be9ca493ffc4d66b1fcfb", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/c61d7d3b9e3302a0718be9ca493ffc4d66b1fcfb", "message": "Update javadoc to match reality", "committedDate": "2020-04-23T08:34:46Z", "type": "commit"}, {"oid": "09afb56a9e9c9d9b3af796f32d78d0d0cd0e7a46", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/09afb56a9e9c9d9b3af796f32d78d0d0cd0e7a46", "message": "Merge branch 'dev-2.x' into agency-feed-id", "committedDate": "2020-04-23T08:47:34Z", "type": "commit"}]}