{"pr_number": 3111, "pr_title": "Fixed arraysOutOfBounds exception when copying pattern geometries to \u2026", "pr_createdAt": "2020-06-23T10:58:09Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111", "timeline": [{"oid": "8453756838418411023d3dcec42c2307f37301b2", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/8453756838418411023d3dcec42c2307f37301b2", "message": "Fixed arraysOutOfBounds exception when copying pattern geometries to new trip patterns", "committedDate": "2020-06-23T10:52:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzMjM1Nw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111#discussion_r476332357", "bodyText": "Should be sufficient to just add a comment here explaining why a length mismatch would occur (realtime update adding stops) and clarifying that this will only preserve geometry up to the added stop, at which point it will fall back on straight lines.", "author": "abyrd", "createdAt": "2020-08-25T10:04:02Z", "path": "src/main/java/org/opentripplanner/model/TripPattern.java", "diffHunk": "@@ -159,7 +159,11 @@ public void setHopGeometry(int i, LineString hopGeometry) {\n      */\n     public void setHopGeometriesFromPattern(TripPattern other) {\n         this.hopGeometries = new byte[this.getStops().size() - 1][];\n-        for (int i = 0; i < other.getStops().size() - 1; i++) {\n+\n+        // Gets the size of the shortest of the two trip patterns\n+        int sizeOfShortestPattern = Math.min(this.getStops().size(), other.getStops().size());", "originalCommit": "8453756838418411023d3dcec42c2307f37301b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQwNzUyMg==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/3111#discussion_r476407522", "bodyText": "I have added the comment now.", "author": "gmellemstrand", "createdAt": "2020-08-25T12:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjMzMjM1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b06e239f1fba9219d6773ad69c97e4b31f26cc00", "chunk": "diff --git a/src/main/java/org/opentripplanner/model/TripPattern.java b/src/main/java/org/opentripplanner/model/TripPattern.java\nindex 75e614c85..70c2b1a1e 100644\n--- a/src/main/java/org/opentripplanner/model/TripPattern.java\n+++ b/src/main/java/org/opentripplanner/model/TripPattern.java\n\n@@ -159,11 +157,7 @@ public class TripPattern extends TransitEntity<FeedScopedId> implements Cloneabl\n      */\n     public void setHopGeometriesFromPattern(TripPattern other) {\n         this.hopGeometries = new byte[this.getStops().size() - 1][];\n-\n-        // Gets the size of the shortest of the two trip patterns\n-        int sizeOfShortestPattern = Math.min(this.getStops().size(), other.getStops().size());\n-\n-        for (int i = 0; i < sizeOfShortestPattern - 1; i++) {\n+        for (int i = 0; i < other.getStops().size() - 1; i++) {\n             if (other.getHopGeometry(i) != null\n                 && other.getStop(i).equals(this.getStop(i))\n                 && other.getStop(i + 1).equals(this.getStop(i + 1))) {\n"}}, {"oid": "882cb57093129b1e09228bb7af4cf5828be3cb92", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/882cb57093129b1e09228bb7af4cf5828be3cb92", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix", "committedDate": "2020-08-25T10:04:45Z", "type": "commit"}, {"oid": "b06e239f1fba9219d6773ad69c97e4b31f26cc00", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b06e239f1fba9219d6773ad69c97e4b31f26cc00", "message": "Correctly add GroupOfLines", "committedDate": "2020-08-25T11:56:14Z", "type": "commit"}, {"oid": "b876436f76fef546502eafcf891a7fd78e33a11a", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/b876436f76fef546502eafcf891a7fd78e33a11a", "message": "Add comment", "committedDate": "2020-08-25T12:09:47Z", "type": "commit"}, {"oid": "65dda1b7da0765daee5a64d8ec348ede67a36848", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/65dda1b7da0765daee5a64d8ec348ede67a36848", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix", "committedDate": "2020-08-25T12:10:06Z", "type": "commit"}, {"oid": "a49443b0e66e5d0ac9de43fca193ebdb4b0d1536", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/a49443b0e66e5d0ac9de43fca193ebdb4b0d1536", "message": "Merge branch 'dev-2.x' into otp2_copy_geometry_bugfix", "committedDate": "2020-08-27T08:43:47Z", "type": "commit"}]}