{"pr_number": 2980, "pr_title": "NeTEx import: Do not add ServiceJourney if any StopPoints are not found", "pr_createdAt": "2020-02-18T14:18:19Z", "pr_url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2980", "timeline": [{"oid": "963456b463511d99ccbdb1892b763780ff14e2e5", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/963456b463511d99ccbdb1892b763780ff14e2e5", "message": "Do not add ServiceJourney if any StopPoints are not found", "committedDate": "2020-02-18T14:10:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ4MjUwMw==", "url": "https://github.com/opentripplanner/OpenTripPlanner/pull/2980#discussion_r383482503", "bodyText": "This only log the id of the stopPoint, maybe also log the missing stop id:  stopPoint.getScheduledStopPointRef().getValue().getRef()?\nAn while at it, the Stop not found for {} is missing the context of the id, e.g.: Stop not found for stop-point in journey pattern {}?", "author": "t2gran", "createdAt": "2020-02-24T19:58:22Z", "path": "src/main/java/org/opentripplanner/netex/loader/mapping/StopTimesMapper.java", "diffHunk": "@@ -78,6 +78,11 @@ MappedStopTimes mapToStopTimes(\n \n             StopPointInJourneyPattern stopPoint = findStopPoint(pointInJourneyPattern, journeyPattern);\n             Stop stop = lookupStop(stopPoint, quayIdByStopPointRef, stopsById);\n+            if (stop == null) {\n+                LOG.warn(\"Stop not found for {}. Trip {} will not be mapped.\",\n+                    stopPoint != null ? stopPoint.getId() : \"null\", trip.getId());", "originalCommit": "963456b463511d99ccbdb1892b763780ff14e2e5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5395e8adaa4a7deee71005bded67e1af42aef6b2", "chunk": "diff --git a/src/main/java/org/opentripplanner/netex/loader/mapping/StopTimesMapper.java b/src/main/java/org/opentripplanner/netex/loader/mapping/StopTimesMapper.java\nindex fe6529891..058cf77b0 100644\n--- a/src/main/java/org/opentripplanner/netex/loader/mapping/StopTimesMapper.java\n+++ b/src/main/java/org/opentripplanner/netex/loader/mapping/StopTimesMapper.java\n\n@@ -79,8 +79,14 @@ class StopTimesMapper {\n             StopPointInJourneyPattern stopPoint = findStopPoint(pointInJourneyPattern, journeyPattern);\n             Stop stop = lookupStop(stopPoint, quayIdByStopPointRef, stopsById);\n             if (stop == null) {\n-                LOG.warn(\"Stop not found for {}. Trip {} will not be mapped.\",\n-                    stopPoint != null ? stopPoint.getId() : \"null\", trip.getId());\n+                LOG.warn(\"Stop with id {} not found for StopPoint {} in JourneyPattern {}. \"\n+                        + \"Trip {} will not be mapped.\",\n+                    stopPoint != null && stopPoint.getScheduledStopPointRef() != null\n+                        ? stopPoint.getScheduledStopPointRef().getValue().getRef()\n+                        : \"null\"\n+                    , stopPoint != null ? stopPoint.getId() : \"null\"\n+                    , journeyPattern.getId()\n+                    , trip.getId());\n                 return null;\n             }\n \n"}}, {"oid": "5395e8adaa4a7deee71005bded67e1af42aef6b2", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/5395e8adaa4a7deee71005bded67e1af42aef6b2", "message": "Add more info to error message", "committedDate": "2020-02-25T14:33:46Z", "type": "commit"}, {"oid": "d104d9ee4b9960ac76cec1496d569f7980b2b9af", "url": "https://github.com/opentripplanner/OpenTripPlanner/commit/d104d9ee4b9960ac76cec1496d569f7980b2b9af", "message": "Merge branch 'dev-2.x' into otp2_netex_handle_stoppoint_not_found", "committedDate": "2020-02-25T14:34:14Z", "type": "commit"}]}