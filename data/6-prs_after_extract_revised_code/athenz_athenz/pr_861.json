{"pr_number": 861, "pr_title": "properly reading resources from classpath", "pr_createdAt": "2020-01-04T00:06:06Z", "pr_url": "https://github.com/AthenZ/athenz/pull/861", "timeline": [{"oid": "3e180a7eb653d202dae775fddfe524479015c655", "url": "https://github.com/AthenZ/athenz/commit/3e180a7eb653d202dae775fddfe524479015c655", "message": "properly reading resources from classpath", "committedDate": "2020-01-04T00:03:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAwMDk4Mg==", "url": "https://github.com/AthenZ/athenz/pull/861#discussion_r363000982", "bodyText": "Both here and in the readContentFromFile method why are we calling Objects.requireNonNull if we have already verified that the resource is valid - there is resource != null check? was the plan to remove the initial resource check completely?", "author": "havetisyan", "createdAt": "2020-01-04T00:24:34Z", "path": "libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/EmailNotificationService.java", "diffHunk": "@@ -117,14 +118,30 @@\n         athenzUIUrl = System.getProperty(PROP_NOTIFICATION_ATHENZ_UI_URL);\n         from = System.getProperty(PROP_NOTIFICATION_EMAIL_FROM);\n \n-        logoImageResource = getClass().getClassLoader().getResource(EMAIL_TEMPLATE_ATHENZ_LOGO);\n+        logoImage = readBinaryFromFile(EMAIL_TEMPLATE_ATHENZ_LOGO);\n         emailBaseCSS = readContentFromFile(EMAIL_TEMPLATE_CSS);\n         emailMembershipApprovalBody = readContentFromFile(EMAIL_TEMPLATE_NOTIFICATION_APPROVAL);\n         emailMembershipApprovalReminderBody = readContentFromFile(EMAIL_TEMPLATE_NOTIFICATION_APPROVAL_REMINDER);\n         emailDomainMemberExpiryBody = readContentFromFile(EMAIL_TEMPLATE_DOMAIN_MEMBER_EXPIRY);\n         emailPrincipalExpiryBody =  readContentFromFile(EMAIL_TEMPLATE_PRINCIPAL_EXPIRY);\n     }\n \n+    byte[] readBinaryFromFile(String fileName) {\n+\n+        byte[] fileByteArray = null;\n+        URL resource = getClass().getClassLoader().getResource(fileName);\n+        if (resource != null) {\n+            try (InputStream fileStream = getClass().getClassLoader().getResourceAsStream(fileName)) {\n+                //convert to byte array\n+                fileByteArray = IOUtils.toByteArray(Objects.requireNonNull(fileStream));", "originalCommit": "3e180a7eb653d202dae775fddfe524479015c655", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cc0337a95fa66316606da781681cd3e60faab994", "chunk": "diff --git a/libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/EmailNotificationService.java b/libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/EmailNotificationService.java\nindex 2ec92e61c..cefdda377 100644\n--- a/libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/EmailNotificationService.java\n+++ b/libs/java/server_common/src/main/java/com/yahoo/athenz/common/server/notification/impl/EmailNotificationService.java\n\n@@ -131,9 +131,9 @@ public class EmailNotificationService implements NotificationService {\n         byte[] fileByteArray = null;\n         URL resource = getClass().getClassLoader().getResource(fileName);\n         if (resource != null) {\n-            try (InputStream fileStream = getClass().getClassLoader().getResourceAsStream(fileName)) {\n+            try (InputStream fileStream = resource.openStream()) {\n                 //convert to byte array\n-                fileByteArray = IOUtils.toByteArray(Objects.requireNonNull(fileStream));\n+                fileByteArray = IOUtils.toByteArray(fileStream);\n \n             } catch (IOException ex) {\n                 LOGGER.error(\"Could not read file: {}. Error message: {}\", fileName, ex.getMessage());\n"}}, {"oid": "cc0337a95fa66316606da781681cd3e60faab994", "url": "https://github.com/AthenZ/athenz/commit/cc0337a95fa66316606da781681cd3e60faab994", "message": "using resource to get input stream", "committedDate": "2020-01-04T00:35:32Z", "type": "commit"}]}