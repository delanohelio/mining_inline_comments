{"pr_number": 14605, "pr_title": "Export additional fields in VerifierQueryEvents", "pr_createdAt": "2020-06-04T05:28:15Z", "pr_url": "https://github.com/prestodb/presto/pull/14605", "timeline": [{"oid": "0407e4a72bd110f1e26771f571852fe700753028", "url": "https://github.com/prestodb/presto/commit/0407e4a72bd110f1e26771f571852fe700753028", "message": "Collect and expose setup and teardown query IDs", "committedDate": "2020-06-04T18:58:22Z", "type": "forcePushed"}, {"oid": "2a9d5d51aefe2ed77c0ed0cce0394f0f8156f13b", "url": "https://github.com/prestodb/presto/commit/2a9d5d51aefe2ed77c0ed0cce0394f0f8156f13b", "message": "Collect and expose setup and teardown query IDs", "committedDate": "2020-06-04T19:45:07Z", "type": "forcePushed"}, {"oid": "b1a1bfaf3ac1413055b9b66476b1d9a3583526b5", "url": "https://github.com/prestodb/presto/commit/b1a1bfaf3ac1413055b9b66476b1d9a3583526b5", "message": "Export peakTotalMemoryBytes in VerifierQueryEvent", "committedDate": "2020-06-04T23:19:21Z", "type": "forcePushed"}, {"oid": "46d1ed9e765f5b01286d210608fa0140dfd19894", "url": "https://github.com/prestodb/presto/commit/46d1ed9e765f5b01286d210608fa0140dfd19894", "message": "Export peakTotalMemoryBytes in VerifierQueryEvent", "committedDate": "2020-06-05T00:25:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDczNA==", "url": "https://github.com/prestodb/presto/pull/14605#discussion_r435630734", "bodyText": "is this the right check?", "author": "mbasmanova", "createdAt": "2020-06-05T00:40:12Z", "path": "presto-verifier/src/main/java/com/facebook/presto/verifier/event/DeterminismAnalysisRun.java", "diffHunk": "@@ -85,6 +107,20 @@ public Builder setQueryId(String queryId)\n             return this;\n         }\n \n+        public Builder addSetupQueryId(String queryId)\n+        {\n+            checkState(!this.queryId.isPresent(), \"queryId is already set\");", "originalCommit": "fe71c1586a95493104b4886a8cff873d11300a47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzOTE5Mw==", "url": "https://github.com/prestodb/presto/pull/14605#discussion_r435639193", "bodyText": "Good catch. Thanks! Remove those checks and added unit test coverage.", "author": "caithagoras", "createdAt": "2020-06-05T01:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYzMDczNA=="}], "type": "inlineReview", "revised_code": {"commit": "5961e7c089941233ce9f0d9ef33506ea12a863e4", "chunk": "diff --git a/presto-verifier/src/main/java/com/facebook/presto/verifier/event/DeterminismAnalysisRun.java b/presto-verifier/src/main/java/com/facebook/presto/verifier/event/DeterminismAnalysisRun.java\nindex 5f40a62796..d5334ec241 100644\n--- a/presto-verifier/src/main/java/com/facebook/presto/verifier/event/DeterminismAnalysisRun.java\n+++ b/presto-verifier/src/main/java/com/facebook/presto/verifier/event/DeterminismAnalysisRun.java\n\n@@ -109,14 +109,12 @@ public class DeterminismAnalysisRun\n \n         public Builder addSetupQueryId(String queryId)\n         {\n-            checkState(!this.queryId.isPresent(), \"queryId is already set\");\n             this.setupQueryIds.add(queryId);\n             return this;\n         }\n \n         public Builder addTeardownQueryId(String queryId)\n         {\n-            checkState(!this.queryId.isPresent(), \"queryId is already set\");\n             this.teardownQueryIds.add(queryId);\n             return this;\n         }\n"}}, {"oid": "5961e7c089941233ce9f0d9ef33506ea12a863e4", "url": "https://github.com/prestodb/presto/commit/5961e7c089941233ce9f0d9ef33506ea12a863e4", "message": "Export peakTotalMemoryBytes in VerifierQueryEvent", "committedDate": "2020-06-05T01:15:00Z", "type": "forcePushed"}, {"oid": "4a1fa32b5322df92300fa5caec560472130b45e7", "url": "https://github.com/prestodb/presto/commit/4a1fa32b5322df92300fa5caec560472130b45e7", "message": "Collect and export setup and teardown query IDs in VerifierQueryEvent\n\nThe query IDs are collected once a query ID is received by the JDBC\nclient, not matter if the query succeeds or fails.\n\nPreviously, we're running teardown queries in a finally block after\nVerifierQueryEvent is generated. We need to change that order in\norder to export the IDs in the event.\n\nAlso, export setup query IDs and teardown query IDs for determinism\nanalysis, in determinism_analysis_details.", "committedDate": "2020-06-05T04:30:50Z", "type": "commit"}, {"oid": "c346a862ac172c5a3c135ddd1a084146ea7c1b95", "url": "https://github.com/prestodb/presto/commit/c346a862ac172c5a3c135ddd1a084146ea7c1b95", "message": "Export peakTotalMemoryBytes in VerifierQueryEvent", "committedDate": "2020-06-05T04:30:50Z", "type": "commit"}, {"oid": "c346a862ac172c5a3c135ddd1a084146ea7c1b95", "url": "https://github.com/prestodb/presto/commit/c346a862ac172c5a3c135ddd1a084146ea7c1b95", "message": "Export peakTotalMemoryBytes in VerifierQueryEvent", "committedDate": "2020-06-05T04:30:50Z", "type": "forcePushed"}]}