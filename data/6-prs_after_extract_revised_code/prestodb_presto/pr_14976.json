{"pr_number": 14976, "pr_title": "Fix generation of dynamic filter", "pr_createdAt": "2020-08-06T04:38:55Z", "pr_url": "https://github.com/prestodb/presto/pull/14976", "timeline": [{"oid": "071874e2443384155d65a7d7815118e54d41c2dc", "url": "https://github.com/prestodb/presto/commit/071874e2443384155d65a7d7815118e54d41c2dc", "message": "Fix generation of dynamic filter\n\n1. Only create DynamicFilters when turned on to avoid unnecessary compute\n2. Add dynamicFilterEnabled check", "committedDate": "2020-08-06T04:39:24Z", "type": "forcePushed"}, {"oid": "c1939d8b012a2f2d913086745127c816d6dbe2ff", "url": "https://github.com/prestodb/presto/commit/c1939d8b012a2f2d913086745127c816d6dbe2ff", "message": "Fix generation of dynamic filter\n\n1. Only create DynamicFilters when turned on to avoid unnecessary compute\n2. Add dynamicFilterEnabled check", "committedDate": "2020-08-06T06:34:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4NTc0OA==", "url": "https://github.com/prestodb/presto/pull/14976#discussion_r466185748", "bodyText": "Why removing this?", "author": "highker", "createdAt": "2020-08-06T06:57:55Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java", "diffHunk": "@@ -602,7 +608,7 @@ private static DynamicFiltersResult createDynamicFilters(\n         {\n             Map<String, VariableReferenceExpression> dynamicFilters = ImmutableMap.of();\n             List<RowExpression> predicates = ImmutableList.of();\n-            if (node.getType() == INNER && isEnableDynamicFiltering(session)) {", "originalCommit": "c1939d8b012a2f2d913086745127c816d6dbe2ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4NzQ2Ng==", "url": "https://github.com/prestodb/presto/pull/14976#discussion_r466187466", "bodyText": "This is inside the createDynamicFilters function, not in visitJoin, after simply we won't need this duplicate logic", "author": "kewang1024", "createdAt": "2020-08-06T07:01:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE4NTc0OA=="}], "type": "inlineReview", "revised_code": {"commit": "0e494605e33611abf5065f18138450125b909352", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java b/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\nindex a9d9758c0a..fbacec8524 100644\n--- a/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\n+++ b/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\n\n@@ -602,7 +602,6 @@ public class PredicatePushDown\n         private static DynamicFiltersResult createDynamicFilters(\n                 JoinNode node,\n                 List<JoinNode.EquiJoinClause> equiJoinClauses,\n-                Session session,\n                 PlanNodeIdAllocator idAllocator,\n                 FunctionManager functionManager)\n         {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc0NjQwMQ==", "url": "https://github.com/prestodb/presto/pull/14976#discussion_r466746401", "bodyText": "There is session in the param. Remove", "author": "highker", "createdAt": "2020-08-06T23:55:17Z", "path": "presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java", "diffHunk": "@@ -602,7 +608,7 @@ private static DynamicFiltersResult createDynamicFilters(\n         {", "originalCommit": "c1939d8b012a2f2d913086745127c816d6dbe2ff", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0e494605e33611abf5065f18138450125b909352", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java b/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\nindex a9d9758c0a..fbacec8524 100644\n--- a/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\n+++ b/presto-main/src/main/java/com/facebook/presto/sql/planner/optimizations/PredicatePushDown.java\n\n@@ -602,7 +602,6 @@ public class PredicatePushDown\n         private static DynamicFiltersResult createDynamicFilters(\n                 JoinNode node,\n                 List<JoinNode.EquiJoinClause> equiJoinClauses,\n-                Session session,\n                 PlanNodeIdAllocator idAllocator,\n                 FunctionManager functionManager)\n         {\n"}}, {"oid": "0e494605e33611abf5065f18138450125b909352", "url": "https://github.com/prestodb/presto/commit/0e494605e33611abf5065f18138450125b909352", "message": "Fix generation of dynamic filter\n\n1. Only create DynamicFilters when turned on to avoid unnecessary compute\n2. Add dynamicFilterEnabled check", "committedDate": "2020-08-07T00:33:02Z", "type": "commit"}, {"oid": "0e494605e33611abf5065f18138450125b909352", "url": "https://github.com/prestodb/presto/commit/0e494605e33611abf5065f18138450125b909352", "message": "Fix generation of dynamic filter\n\n1. Only create DynamicFilters when turned on to avoid unnecessary compute\n2. Add dynamicFilterEnabled check", "committedDate": "2020-08-07T00:33:02Z", "type": "forcePushed"}]}