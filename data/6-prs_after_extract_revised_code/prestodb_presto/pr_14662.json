{"pr_number": 14662, "pr_title": "Print more information for BlockEncodingBuffer.toString()", "pr_createdAt": "2020-06-17T10:17:00Z", "pr_url": "https://github.com/prestodb/presto/pull/14662", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3NDI1Mg==", "url": "https://github.com/prestodb/presto/pull/14662#discussion_r441474252", "bodyText": "I don't think you need to call toString() explicitly here (and in other similar places).", "author": "mbasmanova", "createdAt": "2020-06-17T11:26:08Z", "path": "presto-main/src/main/java/com/facebook/presto/operator/repartition/LongArrayBlockEncodingBuffer.java", "diffHunk": "@@ -118,6 +118,7 @@ public long getSerializedSizeInBytes()\n     public String toString()\n     {\n         return toStringHelper(this)\n+                .add(\"super\", super.toString())", "originalCommit": "28805821345273c0ac0a75a1dc151fe83fe8a4a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyMjQ5Nw==", "url": "https://github.com/prestodb/presto/pull/14662#discussion_r441822497", "bodyText": "@mbasmanova Actually without the .toString() the compilation would fail. The add method takes Object not String specifically:\npublic ToStringHelper add(String name, @Nullable Object value)", "author": "yingsu00", "createdAt": "2020-06-17T20:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3NDI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgyNDM1MA==", "url": "https://github.com/prestodb/presto/pull/14662#discussion_r441824350", "bodyText": "@yingsu00 I'm confused. Are you saying .add(\"super\", super) fails to compile? What's the error? I expect this to work and call \"super.toString()\" internally.", "author": "mbasmanova", "createdAt": "2020-06-17T20:46:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3NDI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMDI0OA==", "url": "https://github.com/prestodb/presto/pull/14662#discussion_r441900248", "bodyText": "@yingsu00 I'm confused. Are you saying .add(\"super\", super) fails to compile? What's the error? I expect this to work and call \"super.toString()\" internally.\n\nYes. Changing the code to\n@Override\n    public String toString()\n    {\n        return toStringHelper(this)\n                .add(\"super\", super)\n                .add(\"estimatedValueBufferMaxCapacity\", estimatedValueBufferMaxCapacity)\n                .add(\"valuesBufferCapacity\", valuesBuffer == null ? 0 : valuesBuffer.length)\n                .add(\"valuesBufferIndex\", valuesBufferIndex)\n                .toString();\n    }\n\nwould get the following error message:\n[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.8.0:compile (default-compile) on project presto-main: Compilation failure: Compilation failure:\n[ERROR] /Users/yingsu/presto5/presto/presto-main/src/main/java/com/facebook/presto/operator/repartition/ByteArrayBlockEncodingBuffer.java:[142,36] '.' expected\n[ERROR] /Users/yingsu/presto5/presto/presto-main/src/main/java/com/facebook/presto/operator/repartition/ByteArrayBlockEncodingBuffer.java:[146,28] ')' expected\n\nMy understanding is super cannot be used by itself. It has to be used in a constructor like super() or super.method().\nHowever I removed other .toString() calls on decodedBlock, valueBuffers, etc.", "author": "yingsu00", "createdAt": "2020-06-18T00:14:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3NDI1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a0c8b872bb867632a5935aeee8e5c0b9b7173a1a", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/LongArrayBlockEncodingBuffer.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/LongArrayBlockEncodingBuffer.java\nindex 2c46706e4b..e0ef497fe4 100644\n--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/LongArrayBlockEncodingBuffer.java\n+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/LongArrayBlockEncodingBuffer.java\n\n@@ -119,6 +119,7 @@ public class LongArrayBlockEncodingBuffer\n     {\n         return toStringHelper(this)\n                 .add(\"super\", super.toString())\n+                .add(\"estimatedValueBufferMaxCapacity\", estimatedValueBufferMaxCapacity)\n                 .add(\"valuesBufferCapacity\", valuesBuffer == null ? 0 : valuesBuffer.length)\n                 .add(\"valuesBufferIndex\", valuesBufferIndex)\n                 .toString();\n"}}, {"oid": "a0c8b872bb867632a5935aeee8e5c0b9b7173a1a", "url": "https://github.com/prestodb/presto/commit/a0c8b872bb867632a5935aeee8e5c0b9b7173a1a", "message": "Print estimated buffer max capacities in BlockEncodingBuffers.toString()", "committedDate": "2020-06-17T20:44:00Z", "type": "forcePushed"}, {"oid": "febe877ce658c82684b62819ecdd06f7594c23c0", "url": "https://github.com/prestodb/presto/commit/febe877ce658c82684b62819ecdd06f7594c23c0", "message": "Use ToStringHelper in BlockEncodingBuffers.toString()", "committedDate": "2020-06-18T00:10:44Z", "type": "commit"}, {"oid": "aa01e792f26968bcaa452a816796cf0d0918a1d8", "url": "https://github.com/prestodb/presto/commit/aa01e792f26968bcaa452a816796cf0d0918a1d8", "message": "Add toString() to AbstractBlockEncodingBuffer", "committedDate": "2020-06-18T00:11:41Z", "type": "commit"}, {"oid": "21875a0453df9977ce4666d5a6c1450ff1ae68f3", "url": "https://github.com/prestodb/presto/commit/21875a0453df9977ce4666d5a6c1450ff1ae68f3", "message": "Print estimated buffer max capacities in BlockEncodingBuffers.toString()", "committedDate": "2020-06-18T00:11:41Z", "type": "commit"}, {"oid": "21875a0453df9977ce4666d5a6c1450ff1ae68f3", "url": "https://github.com/prestodb/presto/commit/21875a0453df9977ce4666d5a6c1450ff1ae68f3", "message": "Print estimated buffer max capacities in BlockEncodingBuffers.toString()", "committedDate": "2020-06-18T00:11:41Z", "type": "forcePushed"}]}