{"pr_number": 14114, "pr_title": "Fix null pointer when creating ConnectorSession for LocalExchange", "pr_createdAt": "2020-02-18T18:44:06Z", "pr_url": "https://github.com/prestodb/presto/pull/14114", "timeline": [{"oid": "af340316c5d646aae5237055516168cade28326f", "url": "https://github.com/prestodb/presto/commit/af340316c5d646aae5237055516168cade28326f", "message": "Fix null pointer when creating ConnectorSession for LocalExchange", "committedDate": "2020-02-18T18:42:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2NTU4Ng==", "url": "https://github.com/prestodb/presto/pull/14114#discussion_r380865586", "bodyText": "why the original code has null pointer issue? Maybe explain it a bit in commit message?", "author": "wenleix", "createdAt": "2020-02-18T18:49:14Z", "path": "presto-main/src/main/java/com/facebook/presto/operator/exchange/LocalExchange.java", "diffHunk": "@@ -173,7 +173,7 @@ private static PartitionFunction createPartitionFunction(\n         ConnectorNodePartitioningProvider partitioningProvider = partitioningProviderManager.getPartitioningProvider(partitioning.getConnectorId().get());\n         ConnectorBucketNodeMap connectorBucketNodeMap = partitioningProvider.getBucketNodeMap(\n                 partitioning.getTransactionHandle().orElse(null),\n-                session.toConnectorSession(),\n+                session.toConnectorSession(partitioning.getConnectorId().get()),", "originalCommit": "af340316c5d646aae5237055516168cade28326f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg5NDI5MQ==", "url": "https://github.com/prestodb/presto/pull/14114#discussion_r380894291", "bodyText": "toConnectorSession() will call\nnew FullConnectorSession(this, identity.toConnectorIdentity());\npublic FullConnectorSession(Session session, ConnectorIdentity identity)\n    {\n        this.session = requireNonNull(session, \"session is null\");\n        this.identity = requireNonNull(identity, \"identity is null\");\n        this.properties = null;\n        this.connectorId = null;\n        this.catalog = null;\n        this.sessionPropertyManager = null;\n        this.sqlFunctionProperties = session.getSqlFunctionProperties();\n    }\n\nhere will set properties/connecotId/catalog/sessionPropertyManager null\nhence we should call ConnectorSession toConnectorSession(ConnectorId connectorId)\npublic ConnectorSession toConnectorSession(ConnectorId connectorId)\n    {\n        requireNonNull(connectorId, \"connectorId is null\");\n\n        return new FullConnectorSession(\n                this,\n                identity.toConnectorIdentity(connectorId.getCatalogName()),\n                connectorProperties.getOrDefault(connectorId, ImmutableMap.of()),\n                connectorId,\n                connectorId.getCatalogName(),\n                sessionPropertyManager);\n    }", "author": "kewang1024", "createdAt": "2020-02-18T19:43:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2NTU4Ng=="}], "type": "inlineReview", "revised_code": null}]}