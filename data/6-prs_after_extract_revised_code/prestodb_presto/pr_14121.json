{"pr_number": 14121, "pr_title": "Add toString() method to BlockEncodingBuffers and ColumnarXXX", "pr_createdAt": "2020-02-20T09:47:48Z", "pr_url": "https://github.com/prestodb/presto/pull/14121", "timeline": [{"oid": "7b407dc4f2894cc3f42ccf7d61111406fd97cc38", "url": "https://github.com/prestodb/presto/commit/7b407dc4f2894cc3f42ccf7d61111406fd97cc38", "message": "Improve toString() for DictionaryBlock and RunLengthEncodedBlock", "committedDate": "2020-02-20T09:44:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk1OTUzMA==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381959530", "bodyText": "@OverRide", "author": "mbasmanova", "createdAt": "2020-02-20T12:08:13Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarArray.java", "diffHunk": "@@ -155,4 +155,15 @@ public long getRetainedSizeInBytes()\n     {\n         return nullCheckBlock.getRetainedSizeInBytes() + elementsBlock.getRetainedSizeInBytes() + sizeOf(offsets);\n     }\n+\n+    public String toString()", "originalCommit": "61f44d6a2ceda19610698312a41857edd85a73a6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarArray.java b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarArray.java\nindex bc53c93945..b3a10b2542 100644\n--- a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarArray.java\n+++ b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarArray.java\n\n@@ -156,6 +156,7 @@ public class ColumnarArray\n         return nullCheckBlock.getRetainedSizeInBytes() + elementsBlock.getRetainedSizeInBytes() + sizeOf(offsets);\n     }\n \n+    @Override\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder(\"ColumnarArray{\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk1OTU3Mw==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381959573", "bodyText": "@OverRide", "author": "mbasmanova", "createdAt": "2020-02-20T12:08:19Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarMap.java", "diffHunk": "@@ -191,4 +191,17 @@ public long getRetainedSizeInBytes()\n     {\n         return nullCheckBlock.getRetainedSizeInBytes() + keysBlock.getRetainedSizeInBytes() + valuesBlock.getRetainedSizeInBytes() + sizeOf(offsets) + sizeOf(hashTables);\n     }\n+\n+    public String toString()", "originalCommit": "61f44d6a2ceda19610698312a41857edd85a73a6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarMap.java b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarMap.java\nindex 7dd99dada9..25dadb6a02 100644\n--- a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarMap.java\n+++ b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarMap.java\n\n@@ -192,6 +192,7 @@ public class ColumnarMap\n         return nullCheckBlock.getRetainedSizeInBytes() + keysBlock.getRetainedSizeInBytes() + valuesBlock.getRetainedSizeInBytes() + sizeOf(offsets) + sizeOf(hashTables);\n     }\n \n+    @Override\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder(\"ColumnarMap{\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk1OTYzNw==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381959637", "bodyText": "@OverRide", "author": "mbasmanova", "createdAt": "2020-02-20T12:08:26Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java", "diffHunk": "@@ -153,4 +153,16 @@ public long getRetainedSizeInBytes()\n         }\n         return nullCheckBlock.getRetainedSizeInBytes() + fieldsRetainedSize;\n     }\n+\n+    public String toString()", "originalCommit": "61f44d6a2ceda19610698312a41857edd85a73a6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\nindex 91eccba600..cb4e7eb446 100644\n--- a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\n+++ b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\n\n@@ -154,11 +154,12 @@ public final class ColumnarRow\n         return nullCheckBlock.getRetainedSizeInBytes() + fieldsRetainedSize;\n     }\n \n+    @Override\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder(\"ColumnarRow{\");\n         sb.append(\"positionCount=\").append(getPositionCount()).append(\",\");\n-        sb.append(\"fields count=\").append(fields.length).append(\",\");\n+        sb.append(\"fieldsCount=\").append(fields.length).append(\",\");\n         for (int i = 0; i < fields.length; i++) {\n             sb.append(\"field_\").append(i).append(\"=\").append(fields[i].toString()).append(\",\");\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk1OTgwMg==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381959802", "bodyText": "fieldsCount for consistency", "author": "mbasmanova", "createdAt": "2020-02-20T12:08:46Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java", "diffHunk": "@@ -153,4 +153,16 @@ public long getRetainedSizeInBytes()\n         }\n         return nullCheckBlock.getRetainedSizeInBytes() + fieldsRetainedSize;\n     }\n+\n+    public String toString()\n+    {\n+        StringBuilder sb = new StringBuilder(\"ColumnarRow{\");\n+        sb.append(\"positionCount=\").append(getPositionCount()).append(\",\");\n+        sb.append(\"fields count=\").append(fields.length).append(\",\");", "originalCommit": "61f44d6a2ceda19610698312a41857edd85a73a6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\nindex 91eccba600..cb4e7eb446 100644\n--- a/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\n+++ b/presto-spi/src/main/java/com/facebook/presto/spi/block/ColumnarRow.java\n\n@@ -154,11 +154,12 @@ public final class ColumnarRow\n         return nullCheckBlock.getRetainedSizeInBytes() + fieldsRetainedSize;\n     }\n \n+    @Override\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder(\"ColumnarRow{\");\n         sb.append(\"positionCount=\").append(getPositionCount()).append(\",\");\n-        sb.append(\"fields count=\").append(fields.length).append(\",\");\n+        sb.append(\"fieldsCount=\").append(fields.length).append(\",\");\n         for (int i = 0; i < fields.length; i++) {\n             sb.append(\"field_\").append(i).append(\"=\").append(fields[i].toString()).append(\",\");\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk2MDMwMQ==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381960301", "bodyText": "not needed", "author": "mbasmanova", "createdAt": "2020-02-20T12:09:57Z", "path": "presto-main/src/main/java/com/facebook/presto/operator/repartition/BlockEncodingBuffer.java", "diffHunk": "@@ -51,4 +51,6 @@\n     long getRetainedSizeInBytes();\n \n     long getSerializedSizeInBytes();\n+\n+    String toString();", "originalCommit": "d41f64b4b895a10bc6085432cfa5a41b581b8cc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/BlockEncodingBuffer.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/BlockEncodingBuffer.java\nindex ca3fe465cb..10f54f3fc4 100644\n--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/BlockEncodingBuffer.java\n+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/BlockEncodingBuffer.java\n\n@@ -51,6 +51,4 @@ public interface BlockEncodingBuffer\n     long getRetainedSizeInBytes();\n \n     long getSerializedSizeInBytes();\n-\n-    String toString();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk2MDQwNA==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381960404", "bodyText": "@OverRide", "author": "mbasmanova", "createdAt": "2020-02-20T12:10:11Z", "path": "presto-main/src/main/java/com/facebook/presto/operator/repartition/DecodedBlockNode.java", "diffHunk": "@@ -79,4 +79,17 @@ else if (decodedBlock instanceof ColumnarRow) {\n         }\n         return size;\n     }\n+\n+    public String toString()", "originalCommit": "d41f64b4b895a10bc6085432cfa5a41b581b8cc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/DecodedBlockNode.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/DecodedBlockNode.java\nindex 4a08357f76..7e71a1f379 100644\n--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/DecodedBlockNode.java\n+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/DecodedBlockNode.java\n\n@@ -80,6 +80,7 @@ class DecodedBlockNode\n         return size;\n     }\n \n+    @Override\n     public String toString()\n     {\n         StringBuilder sb = new StringBuilder(\"DecodedBlockNode{\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk2MDY5Mg==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r381960692", "bodyText": "better Int128ArrayBlockEncodingBuffer.class.getSimpleName(); ditto other places", "author": "mbasmanova", "createdAt": "2020-02-20T12:10:54Z", "path": "presto-main/src/main/java/com/facebook/presto/operator/repartition/Int128ArrayBlockEncodingBuffer.java", "diffHunk": "@@ -109,6 +109,15 @@ public long getSerializedSizeInBytes()\n                 getNullsBufferSerializedSizeInBytes();    // nulls buffer\n     }\n \n+    @Override\n+    public String toString()\n+    {\n+        StringBuilder sb = new StringBuilder(\"Int128ArrayBlockEncodingBuffer{\");", "originalCommit": "d41f64b4b895a10bc6085432cfa5a41b581b8cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMzNTQxMw==", "url": "https://github.com/prestodb/presto/pull/14121#discussion_r382335413", "bodyText": "Sure. Changed to\nStringBuilder sb = new StringBuilder(getClass().getSimpleName()).append(\"{\");", "author": "yingsu00", "createdAt": "2020-02-21T00:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk2MDY5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "chunk": "diff --git a/presto-main/src/main/java/com/facebook/presto/operator/repartition/Int128ArrayBlockEncodingBuffer.java b/presto-main/src/main/java/com/facebook/presto/operator/repartition/Int128ArrayBlockEncodingBuffer.java\nindex f1a9279c1f..e51e69ceef 100644\n--- a/presto-main/src/main/java/com/facebook/presto/operator/repartition/Int128ArrayBlockEncodingBuffer.java\n+++ b/presto-main/src/main/java/com/facebook/presto/operator/repartition/Int128ArrayBlockEncodingBuffer.java\n\n@@ -112,7 +112,7 @@ public class Int128ArrayBlockEncodingBuffer\n     @Override\n     public String toString()\n     {\n-        StringBuilder sb = new StringBuilder(\"Int128ArrayBlockEncodingBuffer{\");\n+        StringBuilder sb = new StringBuilder(getClass().getSimpleName()).append(\"{\");\n         sb.append(\"valuesBufferCapacity=\").append(valuesBuffer == null ? 0 : valuesBuffer.length).append(\",\");\n         sb.append(\"valuesBufferIndex=\").append(valuesBufferIndex).append(\"}\");\n         return sb.toString();\n"}}, {"oid": "a3421adf2ad37b4758f707025612ad9a9576ca5d", "url": "https://github.com/prestodb/presto/commit/a3421adf2ad37b4758f707025612ad9a9576ca5d", "message": "Add toString() to BlockEncodingBuffers and DecodedBlockNode", "committedDate": "2020-02-21T00:50:50Z", "type": "forcePushed"}, {"oid": "928c3dfc336889b66261dec7437e74c069d31edc", "url": "https://github.com/prestodb/presto/commit/928c3dfc336889b66261dec7437e74c069d31edc", "message": "Add toString() to ColumnarXXX", "committedDate": "2020-02-21T00:56:31Z", "type": "commit"}, {"oid": "9139784d4daba5835d7a9ab46fdbfba048d2b2a9", "url": "https://github.com/prestodb/presto/commit/9139784d4daba5835d7a9ab46fdbfba048d2b2a9", "message": "Add toString() to BlockEncodingBuffers and DecodedBlockNode", "committedDate": "2020-02-21T00:56:31Z", "type": "commit"}, {"oid": "9139784d4daba5835d7a9ab46fdbfba048d2b2a9", "url": "https://github.com/prestodb/presto/commit/9139784d4daba5835d7a9ab46fdbfba048d2b2a9", "message": "Add toString() to BlockEncodingBuffers and DecodedBlockNode", "committedDate": "2020-02-21T00:56:31Z", "type": "forcePushed"}]}