{"pr_number": 14324, "pr_title": "Add peak [task] total memory to returned stats ", "pr_createdAt": "2020-04-01T18:32:24Z", "pr_url": "https://github.com/prestodb/presto/pull/14324", "timeline": [{"oid": "9946d7ec765203debc8f0ed74ba13e503bece4a8", "url": "https://github.com/prestodb/presto/commit/9946d7ec765203debc8f0ed74ba13e503bece4a8", "message": "Update more things", "committedDate": "2020-04-01T21:45:53Z", "type": "forcePushed"}, {"oid": "11e6e28be856546bac80fe0522941b0d4573a736", "url": "https://github.com/prestodb/presto/commit/11e6e28be856546bac80fe0522941b0d4573a736", "message": "Update more things", "committedDate": "2020-04-01T21:54:10Z", "type": "forcePushed"}, {"oid": "11e6e28be856546bac80fe0522941b0d4573a736", "url": "https://github.com/prestodb/presto/commit/11e6e28be856546bac80fe0522941b0d4573a736", "message": "Update more things", "committedDate": "2020-04-01T21:54:10Z", "type": "forcePushed"}, {"oid": "48274dcc6ca80a6cb91cfc8d8ed8f8322aae6435", "url": "https://github.com/prestodb/presto/commit/48274dcc6ca80a6cb91cfc8d8ed8f8322aae6435", "message": "Add peak total [task] memory to BasicQueryStats", "committedDate": "2020-04-03T18:28:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyNjMxNA==", "url": "https://github.com/prestodb/presto/pull/14324#discussion_r403226314", "bodyText": "change this and below to say \"Peak User Memory\".  I mean user memory vs. total memory is already a confusing concept, but it's even weirder to have Peak Memory vs. PeakTotalMemory.", "author": "rschlussel", "createdAt": "2020-04-03T18:30:27Z", "path": "presto-cli/src/main/java/com/facebook/presto/cli/StatusPrinter.java", "diffHunk": "@@ -206,6 +206,10 @@ public void printFinalInfo()\n \n             // Peak Memory: 1.97GB\n             reprintLine(\"Peak Memory: \" + formatDataSize(bytes(stats.getPeakMemoryBytes()), true));", "originalCommit": "48274dcc6ca80a6cb91cfc8d8ed8f8322aae6435", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzI4MzIxMA==", "url": "https://github.com/prestodb/presto/pull/14324#discussion_r403283210", "bodyText": "I agree our terminology is not great, but it is our terminology. We don't refer to user memory in Daiquery, Chronos, Presto Query Lookup, Presto Query Status, or in the code most of the time.\nWDYT?", "author": "aweisberg", "createdAt": "2020-04-03T19:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyNjMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMzNzM0Mg==", "url": "https://github.com/prestodb/presto/pull/14324#discussion_r403337342", "bodyText": "Those are internal tools and shouldn't affect what Presto surfaces.\nThat being said, I think we're a bit inconsistent, in our terminology, as the code does in places refer to \"peakUserMemoryBytes\".  I think that's less confusing and we should try make anything user facing start to use that terminology if we're going to be surfacing the \"total memory\" more. To me, Peak Memory and Peak Total Memory sound like they should mean exactly the same thing and it's confusing that they don't.  Peak user memory and peak total memory at least sound like they might mean different things.  Even if you don't know what user memory is, you'd probably infer that there's some other kind of memory that total memory includes.\nAlso, possibly controversial opinion (for a bigger discussion separate from this PR), but I don't really think separating user memory and system/total memory is that valuable.  I mean, it gives a quick way to see whether a query is using lots of memory from reading maps or if it's from building hash tables and sorting, but you could also learn that from the operator stats. From a cluster management perspective it's not relevant, and for a user just trying to understand the resource utilization of their query, I think it's more confusing than helpful.", "author": "rschlussel", "createdAt": "2020-04-03T21:09:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyNjMxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM0MzkzOA==", "url": "https://github.com/prestodb/presto/pull/14324#discussion_r403343938", "bodyText": "I agree it's a distinction that doesn't seem useful most of the time.\nI'll change it. I misunderstood what you were asking for anyways. My brain added that you wanted to switch total to System along with User.", "author": "aweisberg", "createdAt": "2020-04-03T21:25:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyNjMxNA=="}], "type": "inlineReview", "revised_code": {"commit": "829548ea2c9e3683cfa6296a5399a887edcd0b58", "chunk": "diff --git a/presto-cli/src/main/java/com/facebook/presto/cli/StatusPrinter.java b/presto-cli/src/main/java/com/facebook/presto/cli/StatusPrinter.java\nindex d24c4e019e..cacae5f841 100644\n--- a/presto-cli/src/main/java/com/facebook/presto/cli/StatusPrinter.java\n+++ b/presto-cli/src/main/java/com/facebook/presto/cli/StatusPrinter.java\n\n@@ -204,8 +204,8 @@ Spilled: 20GB\n             // Parallelism: 5.3\n             out.println(format(\"Parallelism: %.1f\", parallelism));\n \n-            // Peak Memory: 1.97GB\n-            reprintLine(\"Peak Memory: \" + formatDataSize(bytes(stats.getPeakMemoryBytes()), true));\n+            // Peak User Memory: 1.97GB\n+            reprintLine(\"Peak User Memory: \" + formatDataSize(bytes(stats.getPeakMemoryBytes()), true));\n             // Peak Total Memory: 1.98GB\n             reprintLine(\"Peak Total Memory: \" + formatDataSize(bytes(stats.getPeakTotalMemoryBytes()), true));\n             // Peak Task Total Memory: 1.99GB\n"}}, {"oid": "829548ea2c9e3683cfa6296a5399a887edcd0b58", "url": "https://github.com/prestodb/presto/commit/829548ea2c9e3683cfa6296a5399a887edcd0b58", "message": "Add peak total [task] memory to BasicQueryStats", "committedDate": "2020-04-03T21:24:08Z", "type": "forcePushed"}, {"oid": "bda55922aad451c449666b1beb1bbe4d714a1be0", "url": "https://github.com/prestodb/presto/commit/bda55922aad451c449666b1beb1bbe4d714a1be0", "message": "Add peak [task] total memory to returned stats\n\nAdds peak [task] total mememory to BasicQueryStats and QueryProgressStats", "committedDate": "2020-04-06T21:48:42Z", "type": "forcePushed"}, {"oid": "62e6f9415ffaef5db724fec407b9ecd06f34d8a3", "url": "https://github.com/prestodb/presto/commit/62e6f9415ffaef5db724fec407b9ecd06f34d8a3", "message": "Add peak [task] total memory to returned stats\n\nAdds peak [task] total mememory to BasicQueryStats and QueryProgressStats", "committedDate": "2020-04-07T14:39:19Z", "type": "commit"}, {"oid": "62e6f9415ffaef5db724fec407b9ecd06f34d8a3", "url": "https://github.com/prestodb/presto/commit/62e6f9415ffaef5db724fec407b9ecd06f34d8a3", "message": "Add peak [task] total memory to returned stats\n\nAdds peak [task] total mememory to BasicQueryStats and QueryProgressStats", "committedDate": "2020-04-07T14:39:19Z", "type": "forcePushed"}]}