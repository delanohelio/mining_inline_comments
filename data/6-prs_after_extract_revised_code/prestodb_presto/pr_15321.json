{"pr_number": 15321, "pr_title": "Add sealedPartition flag to HivePartition", "pr_createdAt": "2020-10-16T16:39:11Z", "pr_url": "https://github.com/prestodb/presto/pull/15321", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjYwMzM3MA==", "url": "https://github.com/prestodb/presto/pull/15321#discussion_r506603370", "bodyText": "Let's call this cacheable to be consistent with HiveDirectoryContext", "author": "shixuan-fan", "createdAt": "2020-10-16T16:58:07Z", "path": "presto-hive/src/main/java/com/facebook/presto/hive/BackgroundHiveSplitLoader.java", "diffHunk": "@@ -443,9 +443,15 @@ private static boolean shouldUseFileSplitsFromInputFormat(InputFormat<?, ?> inpu\n                 .anyMatch(name -> name.equals(\"UseFileSplitsFromInputFormat\"));\n     }\n \n-    private Iterator<InternalHiveSplit> createInternalHiveSplitIterator(Path path, ExtendedFileSystem fileSystem, InternalHiveSplitFactory splitFactory, boolean splittable, PathFilter pathFilter)\n+    private Iterator<InternalHiveSplit> createInternalHiveSplitIterator(Path path, ExtendedFileSystem fileSystem, InternalHiveSplitFactory splitFactory, boolean splittable, PathFilter pathFilter, Optional<Partition> partition)\n     {\n-        HiveDirectoryContext hiveDirectoryContext = new HiveDirectoryContext(recursiveDirWalkerEnabled ? RECURSE : IGNORED, isUseListDirectoryCache(session));\n+        boolean useCache = isUseListDirectoryCache(session);", "originalCommit": "f96f00ec6bc38fbe483d17a0e7ddb12cce19126c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3250f2aec6409865deaa33abb92244a25d2422be", "chunk": "diff --git a/presto-hive/src/main/java/com/facebook/presto/hive/BackgroundHiveSplitLoader.java b/presto-hive/src/main/java/com/facebook/presto/hive/BackgroundHiveSplitLoader.java\nindex 9dafe40cc5..c66581bf1b 100644\n--- a/presto-hive/src/main/java/com/facebook/presto/hive/BackgroundHiveSplitLoader.java\n+++ b/presto-hive/src/main/java/com/facebook/presto/hive/BackgroundHiveSplitLoader.java\n\n@@ -445,13 +445,13 @@ public class BackgroundHiveSplitLoader\n \n     private Iterator<InternalHiveSplit> createInternalHiveSplitIterator(Path path, ExtendedFileSystem fileSystem, InternalHiveSplitFactory splitFactory, boolean splittable, PathFilter pathFilter, Optional<Partition> partition)\n     {\n-        boolean useCache = isUseListDirectoryCache(session);\n+        boolean cacheable = isUseListDirectoryCache(session);\n         if (partition.isPresent()) {\n             // Use cache only for sealed partitions\n-            useCache &= partition.get().isSealedPartition();\n+            cacheable &= partition.get().isSealedPartition();\n         }\n \n-        HiveDirectoryContext hiveDirectoryContext = new HiveDirectoryContext(recursiveDirWalkerEnabled ? RECURSE : IGNORED, useCache);\n+        HiveDirectoryContext hiveDirectoryContext = new HiveDirectoryContext(recursiveDirWalkerEnabled ? RECURSE : IGNORED, cacheable);\n         return stream(directoryLister.list(fileSystem, table, path, namenodeStats, pathFilter, hiveDirectoryContext))\n                 .map(status -> splitFactory.createInternalHiveSplit(status, splittable))\n                 .filter(Optional::isPresent)\n"}}, {"oid": "3250f2aec6409865deaa33abb92244a25d2422be", "url": "https://github.com/prestodb/presto/commit/3250f2aec6409865deaa33abb92244a25d2422be", "message": "Add sealedPartition flag to HivePartition", "committedDate": "2020-10-16T17:05:03Z", "type": "commit"}, {"oid": "3250f2aec6409865deaa33abb92244a25d2422be", "url": "https://github.com/prestodb/presto/commit/3250f2aec6409865deaa33abb92244a25d2422be", "message": "Add sealedPartition flag to HivePartition", "committedDate": "2020-10-16T17:05:03Z", "type": "forcePushed"}]}