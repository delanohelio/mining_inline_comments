{"pr_number": 15313, "pr_title": "Add type to FunctionNamespaceManager", "pr_createdAt": "2020-10-15T01:32:40Z", "pr_url": "https://github.com/prestodb/presto/pull/15313", "timeline": [{"oid": "8afeac544641009dc236d0e95d20b17a1066f148", "url": "https://github.com/prestodb/presto/commit/8afeac544641009dc236d0e95d20b17a1066f148", "message": "Clean up TypeManager APIs\n\nSome of the APIs in TypeManager are only relavent to the engine and not useful\nto connectors / plugins. Remove getTypes, getParametricTypes from TypeManger.", "committedDate": "2020-10-15T05:24:04Z", "type": "forcePushed"}, {"oid": "3a0737d01a28386923b0e208b531f64763e71832", "url": "https://github.com/prestodb/presto/commit/3a0737d01a28386923b0e208b531f64763e71832", "message": "Clean up TypeManager APIs\n\nSome of the APIs in TypeManager are only relavent to the engine and not useful\nto connectors / plugins. Remove the following functions from TypeManager:\n* getTypes\n* getParametricTypes\n* getCommonSuperType\n* isTypeOnlyCoercion\n* coerceTypeBase", "committedDate": "2020-10-15T05:36:50Z", "type": "forcePushed"}, {"oid": "8e1feaec29659efb56d6dbed88f18a11b0cb014d", "url": "https://github.com/prestodb/presto/commit/8e1feaec29659efb56d6dbed88f18a11b0cb014d", "message": "Clean up TypeManager APIs\n\nSome of the APIs in TypeManager are only relavent to the engine and not useful\nto connectors / plugins. Remove the following functions from TypeManager:\n* getTypes\n* getParametricTypes\n* getCommonSuperType\n* isTypeOnlyCoercion\n* coerceTypeBase", "committedDate": "2020-10-15T05:38:35Z", "type": "forcePushed"}, {"oid": "96aabe980683f64e697da53ad101e987b8277f60", "url": "https://github.com/prestodb/presto/commit/96aabe980683f64e697da53ad101e987b8277f60", "message": "Clean up TypeManager APIs\n\nSome of the APIs in TypeManager are only relavent to the engine and not useful\nto connectors / plugins. Remove the following functions from TypeManager:\n* getTypes\n* getParametricTypes\n* getCommonSuperType\n* isTypeOnlyCoercion\n* coerceTypeBase", "committedDate": "2020-10-15T05:43:13Z", "type": "forcePushed"}, {"oid": "ad8bae1c4bd86b2bc54bba77b0a8fb6a3cc2c71f", "url": "https://github.com/prestodb/presto/commit/ad8bae1c4bd86b2bc54bba77b0a8fb6a3cc2c71f", "message": "Refactor type coercion logic to TypeCoercer", "committedDate": "2020-10-16T21:26:29Z", "type": "forcePushed"}, {"oid": "9502c436cffe4cd4becce6624fb2719491210df7", "url": "https://github.com/prestodb/presto/commit/9502c436cffe4cd4becce6624fb2719491210df7", "message": "Use QualifiedObjectName instead of QualifiedFunctionName", "committedDate": "2020-10-17T00:59:01Z", "type": "forcePushed"}, {"oid": "5acc5f69547b0fe6a395eb1165142ff2d68ab92c", "url": "https://github.com/prestodb/presto/commit/5acc5f69547b0fe6a395eb1165142ff2d68ab92c", "message": "Use QualifiedObjectName instead of QualifiedFunctionName", "committedDate": "2020-10-19T07:48:38Z", "type": "forcePushed"}, {"oid": "3275d9a50853af447b8ef333853e0199f17f0150", "url": "https://github.com/prestodb/presto/commit/3275d9a50853af447b8ef333853e0199f17f0150", "message": "Use QualifiedObjectName instead of QualifiedFunctionName", "committedDate": "2020-10-19T17:36:24Z", "type": "forcePushed"}, {"oid": "8e457ed6003210341db39156b66f5667ebbe9aaa", "url": "https://github.com/prestodb/presto/commit/8e457ed6003210341db39156b66f5667ebbe9aaa", "message": "Use QualifiedObjectName instead of QualifiedFunctionName", "committedDate": "2020-10-20T19:56:26Z", "type": "forcePushed"}, {"oid": "52137701e6a9cbcb858e3f63f03b503d985db768", "url": "https://github.com/prestodb/presto/commit/52137701e6a9cbcb858e3f63f03b503d985db768", "message": "Use QualifiedObjectName instead of QualifiedFunctionName", "committedDate": "2020-10-20T20:37:57Z", "type": "forcePushed"}, {"oid": "e601acf38ae95572d7b52cd7400d0efe9266b6bf", "url": "https://github.com/prestodb/presto/commit/e601acf38ae95572d7b52cd7400d0efe9266b6bf", "message": "Move QualifiedObjectName to presto-common", "committedDate": "2020-10-20T20:42:25Z", "type": "forcePushed"}, {"oid": "54393dc75c325e34633e633aca071ededeeeb72e", "url": "https://github.com/prestodb/presto/commit/54393dc75c325e34633e633aca071ededeeeb72e", "message": "Move QualifiedObjectName to presto-common", "committedDate": "2020-10-26T22:42:39Z", "type": "forcePushed"}, {"oid": "76a45ad0fc466af0c8e0b532145eea9884f38bf2", "url": "https://github.com/prestodb/presto/commit/76a45ad0fc466af0c8e0b532145eea9884f38bf2", "message": "Add type APIs to FunctionNamespaceManager", "committedDate": "2020-10-28T19:55:57Z", "type": "forcePushed"}, {"oid": "a840fee036eda90aedcf00ea224c041b19ee823a", "url": "https://github.com/prestodb/presto/commit/a840fee036eda90aedcf00ea224c041b19ee823a", "message": "Add type APIs to FunctionNamespaceManager", "committedDate": "2020-10-28T20:21:31Z", "type": "forcePushed"}, {"oid": "2634cb9ec7127f976f4bfe4bc6e6704341e2c5dc", "url": "https://github.com/prestodb/presto/commit/2634cb9ec7127f976f4bfe4bc6e6704341e2c5dc", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T04:54:51Z", "type": "forcePushed"}, {"oid": "20f3ece19996ae54ea09480101ea9eb0aafa877d", "url": "https://github.com/prestodb/presto/commit/20f3ece19996ae54ea09480101ea9eb0aafa877d", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T05:28:45Z", "type": "forcePushed"}, {"oid": "54f304343e6a50db6429a6ca769fdd24cb12a9de", "url": "https://github.com/prestodb/presto/commit/54f304343e6a50db6429a6ca769fdd24cb12a9de", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T05:33:11Z", "type": "forcePushed"}, {"oid": "d7e96dc9f1e35c79eff7ae50768e87ece68a4a65", "url": "https://github.com/prestodb/presto/commit/d7e96dc9f1e35c79eff7ae50768e87ece68a4a65", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T06:07:37Z", "type": "forcePushed"}, {"oid": "ca963fc024fbf78d599b2ba51aa1fc35ffb27466", "url": "https://github.com/prestodb/presto/commit/ca963fc024fbf78d599b2ba51aa1fc35ffb27466", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T18:18:02Z", "type": "forcePushed"}, {"oid": "ccb5ec138ea27985a4d4b49db7d80b94ad498ff6", "url": "https://github.com/prestodb/presto/commit/ccb5ec138ea27985a4d4b49db7d80b94ad498ff6", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T19:06:48Z", "type": "forcePushed"}, {"oid": "6d80dcabd57428162b8fe1eb56ac0cfbd9558c4b", "url": "https://github.com/prestodb/presto/commit/6d80dcabd57428162b8fe1eb56ac0cfbd9558c4b", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-29T20:32:43Z", "type": "forcePushed"}, {"oid": "e883764937435c0e6e55f4a4d8d9c1ad26cc8209", "url": "https://github.com/prestodb/presto/commit/e883764937435c0e6e55f4a4d8d9c1ad26cc8209", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-10-30T00:13:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NTI3Mg==", "url": "https://github.com/prestodb/presto/pull/15313#discussion_r515095272", "bodyText": "is it OK to remove methods from a public interface in presto-common ?", "author": "daniel-ohayon", "createdAt": "2020-10-30T13:27:17Z", "path": "presto-common/src/main/java/com/facebook/presto/common/type/TypeManager.java", "diffHunk": "@@ -13,9 +13,7 @@\n  */\n package com.facebook.presto.common.type;\n \n-import java.util.Collection;\n import java.util.List;\n-import java.util.Optional;\n \n public interface TypeManager", "originalCommit": "e883764937435c0e6e55f4a4d8d9c1ad26cc8209", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ae66246ebbb9bcf4f1deabc399543d26beadebd3", "chunk": "diff --git a/presto-common/src/main/java/com/facebook/presto/common/type/TypeManager.java b/presto-common/src/main/java/com/facebook/presto/common/type/TypeManager.java\nindex 4eafde00c4..9bf841e1c1 100644\n--- a/presto-common/src/main/java/com/facebook/presto/common/type/TypeManager.java\n+++ b/presto-common/src/main/java/com/facebook/presto/common/type/TypeManager.java\n\n@@ -13,7 +13,9 @@\n  */\n package com.facebook.presto.common.type;\n \n+import java.util.Collection;\n import java.util.List;\n+import java.util.Optional;\n \n public interface TypeManager\n {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTA5NjU1Mw==", "url": "https://github.com/prestodb/presto/pull/15313#discussion_r515096553", "bodyText": "implement equals and hashCode on TypeSignatureBase instead of casting to string here?", "author": "daniel-ohayon", "createdAt": "2020-10-30T13:29:08Z", "path": "presto-common/src/main/java/com/facebook/presto/common/type/TypeSignature.java", "diffHunk": "@@ -576,13 +590,13 @@ public boolean equals(Object o)\n \n         TypeSignature other = (TypeSignature) o;\n \n-        return Objects.equals(this.base.toLowerCase(ENGLISH), other.base.toLowerCase(ENGLISH)) &&\n+        return Objects.equals(this.base.toString().toLowerCase(ENGLISH), other.base.toString().toLowerCase(ENGLISH)) &&", "originalCommit": "e883764937435c0e6e55f4a4d8d9c1ad26cc8209", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "839c50df7547a4f043179640d65a8c2a19b0bdad", "chunk": "diff --git a/presto-common/src/main/java/com/facebook/presto/common/type/TypeSignature.java b/presto-common/src/main/java/com/facebook/presto/common/type/TypeSignature.java\nindex dc5ac7b78f..979135f00f 100644\n--- a/presto-common/src/main/java/com/facebook/presto/common/type/TypeSignature.java\n+++ b/presto-common/src/main/java/com/facebook/presto/common/type/TypeSignature.java\n\n@@ -590,13 +590,13 @@ public class TypeSignature\n \n         TypeSignature other = (TypeSignature) o;\n \n-        return Objects.equals(this.base.toString().toLowerCase(ENGLISH), other.base.toString().toLowerCase(ENGLISH)) &&\n+        return Objects.equals(this.base, other.base) &&\n                 Objects.equals(this.parameters, other.parameters);\n     }\n \n     @Override\n     public int hashCode()\n     {\n-        return Objects.hash(base.toString().toLowerCase(ENGLISH), parameters);\n+        return Objects.hash(base, parameters);\n     }\n }\n"}}, {"oid": "839c50df7547a4f043179640d65a8c2a19b0bdad", "url": "https://github.com/prestodb/presto/commit/839c50df7547a4f043179640d65a8c2a19b0bdad", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-11-09T23:00:36Z", "type": "forcePushed"}, {"oid": "ae66246ebbb9bcf4f1deabc399543d26beadebd3", "url": "https://github.com/prestodb/presto/commit/ae66246ebbb9bcf4f1deabc399543d26beadebd3", "message": "Remove Metadata.getTypeManager\n\nReplace all call sites with Metadata.getFunctionAndTypeManager", "committedDate": "2020-11-10T20:09:58Z", "type": "commit"}, {"oid": "cd44d2409d5413385ade194eefd539ca017d639e", "url": "https://github.com/prestodb/presto/commit/cd44d2409d5413385ade194eefd539ca017d639e", "message": "Clean up TypeManager APIs\n\nSome of the APIs in TypeManager are only relavent to the engine and not useful\nto connectors / plugins. Remove the following functions from TypeManager:\n* getTypes\n* getParametricTypes\n* getCommonSuperType\n* isTypeOnlyCoercion\n* coerceTypeBase", "committedDate": "2020-11-10T20:09:58Z", "type": "commit"}, {"oid": "d8da5bc2cbcf8fade280e57ffa4893abdffff240", "url": "https://github.com/prestodb/presto/commit/d8da5bc2cbcf8fade280e57ffa4893abdffff240", "message": "Rename TypeRegistry to BuiltInTypeRegistry", "committedDate": "2020-11-10T20:09:58Z", "type": "commit"}, {"oid": "bde30f6ba348ad20b729cdba4c0d54a574bb1cf2", "url": "https://github.com/prestodb/presto/commit/bde30f6ba348ad20b729cdba4c0d54a574bb1cf2", "message": "Refactor type coercion logic to TypeCoercer", "committedDate": "2020-11-10T20:09:58Z", "type": "commit"}, {"oid": "0ffe6dfca5a0220aeb54afe9d043ad6a19bb4574", "url": "https://github.com/prestodb/presto/commit/0ffe6dfca5a0220aeb54afe9d043ad6a19bb4574", "message": "Move QualifiedObjectName to presto-common", "committedDate": "2020-11-10T20:09:58Z", "type": "commit"}, {"oid": "b411d77178848abfa31d903d3d0c1a4fe1024390", "url": "https://github.com/prestodb/presto/commit/b411d77178848abfa31d903d3d0c1a4fe1024390", "message": "Merge BuiltInTypeRegistry and BuiltinFunctionNamespaceManager\n\nMerge the two classes into BuiltInTypeAndFunctionNamespaceManager", "committedDate": "2020-11-10T20:09:59Z", "type": "commit"}, {"oid": "a6d77a63e29adaaff1047c73f8448c66aebac479", "url": "https://github.com/prestodb/presto/commit/a6d77a63e29adaaff1047c73f8448c66aebac479", "message": "Add QualifiedObjectName to TypeSignature\n\nThe TypeSignature base can either be a unqualified name, which means it's a standard type,\nor it can be a QualifiedObjectName, which means it's a schema type.", "committedDate": "2020-11-10T20:09:59Z", "type": "commit"}, {"oid": "63d85a3c4998370738e0a859c1bda1061ee316cb", "url": "https://github.com/prestodb/presto/commit/63d85a3c4998370738e0a859c1bda1061ee316cb", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-11-10T20:09:59Z", "type": "commit"}, {"oid": "63d85a3c4998370738e0a859c1bda1061ee316cb", "url": "https://github.com/prestodb/presto/commit/63d85a3c4998370738e0a859c1bda1061ee316cb", "message": "Add ParametricType APIs to FunctionNamespaceManager", "committedDate": "2020-11-10T20:09:59Z", "type": "forcePushed"}]}