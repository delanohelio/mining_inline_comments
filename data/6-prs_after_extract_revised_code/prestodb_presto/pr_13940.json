{"pr_number": 13940, "pr_title": "Add t-digest functions to Presto", "pr_createdAt": "2020-01-08T19:27:05Z", "pr_url": "https://github.com/prestodb/presto/pull/13940", "timeline": [{"oid": "706cb75a3ea6a10362db13d995191349dcdfc4dc", "url": "https://github.com/prestodb/presto/commit/706cb75a3ea6a10362db13d995191349dcdfc4dc", "message": "[COMMIT TO BE SQUASHED] Cleanups to be squashed into previous commit before merge", "committedDate": "2020-01-09T21:46:40Z", "type": "forcePushed"}, {"oid": "7e2e032edc63b4d3c24c4bde2559b005f508fe44", "url": "https://github.com/prestodb/presto/commit/7e2e032edc63b4d3c24c4bde2559b005f508fe44", "message": "[COMMIT TO BE SQUASHED] Cleanups to be squashed into previous commit before merge", "committedDate": "2020-01-09T22:11:50Z", "type": "forcePushed"}, {"oid": "b41ab1c6e11ffcad85dc5a604ed6c81a85aed03a", "url": "https://github.com/prestodb/presto/commit/b41ab1c6e11ffcad85dc5a604ed6c81a85aed03a", "message": "[COMMIT TO BE SQUASHED] Cleanups to be squashed into previous commit before merge", "committedDate": "2020-01-14T06:21:26Z", "type": "forcePushed"}, {"oid": "ac699927ec59860035ded6bb08460606fe895226", "url": "https://github.com/prestodb/presto/commit/ac699927ec59860035ded6bb08460606fe895226", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-15T20:11:07Z", "type": "forcePushed"}, {"oid": "0126b193d61340da5a9a8053cbf5cebf12537e31", "url": "https://github.com/prestodb/presto/commit/0126b193d61340da5a9a8053cbf5cebf12537e31", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-15T20:16:04Z", "type": "forcePushed"}, {"oid": "a6e29030709ee5401dd4377c24096ee59ff04c40", "url": "https://github.com/prestodb/presto/commit/a6e29030709ee5401dd4377c24096ee59ff04c40", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-15T21:05:25Z", "type": "forcePushed"}, {"oid": "6e77a33fddf8918a28a84b218c08dd6ee42db6f4", "url": "https://github.com/prestodb/presto/commit/6e77a33fddf8918a28a84b218c08dd6ee42db6f4", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-15T22:33:28Z", "type": "forcePushed"}, {"oid": "731953a821a8f2187b0fdf4bd0aea34f622b0603", "url": "https://github.com/prestodb/presto/commit/731953a821a8f2187b0fdf4bd0aea34f622b0603", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-21T16:47:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE3NzY3MQ==", "url": "https://github.com/prestodb/presto/pull/13940#discussion_r369177671", "bodyText": "I'm wondering, are we going to have \"alpha\" functions? Is it better to name the value \"experimental\" as explained in the comment?", "author": "rongrong", "createdAt": "2020-01-21T18:45:54Z", "path": "presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionVisibility.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.facebook.presto.spi.function;\n+\n+public enum SqlFunctionVisibility\n+{\n+    PUBLIC,\n+    HIDDEN,\n+    /**\n+     * Beta functions are marked to indicate that the function is experimental and may change in the future.  They have the same visibility as HIDDEN by default, but", "originalCommit": "85751002cf3913b53313f2895432e45b7a50317a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9c9ef8ea31606beb0c09d0c6fa21607baf65167b", "chunk": "diff --git a/presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionVisibility.java b/presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionVisibility.java\nindex 786b872984..d4be41e9f6 100644\n--- a/presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionVisibility.java\n+++ b/presto-spi/src/main/java/com/facebook/presto/spi/function/SqlFunctionVisibility.java\n\n@@ -18,11 +18,11 @@ public enum SqlFunctionVisibility\n     PUBLIC,\n     HIDDEN,\n     /**\n-     * Beta functions are marked to indicate that the function is experimental and may change in the future.  They have the same visibility as HIDDEN by default, but\n+     * Marked to indicate that the function is experimental and may change in the future.  They have the same visibility as HIDDEN by default, but\n      * can be toggled via session property or system property.\n      *\n      * @see SystemSessionProperties#isBetaFunctionsEnabled session property\n      * @see FeaturesConfig#isBetaFunctionsEnabled system property\n      */\n-    BETA,\n+    EXPERIMENTAL,\n }\n"}}, {"oid": "9c9ef8ea31606beb0c09d0c6fa21607baf65167b", "url": "https://github.com/prestodb/presto/commit/9c9ef8ea31606beb0c09d0c6fa21607baf65167b", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-22T03:34:09Z", "type": "forcePushed"}, {"oid": "ef122b97586471fbabff870a49f13221a6ebf9ad", "url": "https://github.com/prestodb/presto/commit/ef122b97586471fbabff870a49f13221a6ebf9ad", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-22T03:37:44Z", "type": "forcePushed"}, {"oid": "43451a00a5e2ed812d15eae7f9e0c80cebb95503", "url": "https://github.com/prestodb/presto/commit/43451a00a5e2ed812d15eae7f9e0c80cebb95503", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-22T03:39:57Z", "type": "forcePushed"}, {"oid": "b3532f266d29bf0d75563963d9ac842f82ad4196", "url": "https://github.com/prestodb/presto/commit/b3532f266d29bf0d75563963d9ac842f82ad4196", "message": "Migrate function isHidden to new visibility enum\n\nSqlFunctionVisibility can take three states:\n- public\n- hidden\n- beta\n\nPublic visibility is equivalent to isHidden=false and hidden visibility\nis equivalent to isHidden=true.  Beta visibility by default is\nequivalent to hidden, however can be toggled by included session and\nsystem properties to make it public.", "committedDate": "2020-01-22T03:41:21Z", "type": "commit"}, {"oid": "222936d3ab02ab937f9503698c79f7fe0d2e277e", "url": "https://github.com/prestodb/presto/commit/222936d3ab02ab937f9503698c79f7fe0d2e277e", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-22T03:41:21Z", "type": "commit"}, {"oid": "222936d3ab02ab937f9503698c79f7fe0d2e277e", "url": "https://github.com/prestodb/presto/commit/222936d3ab02ab937f9503698c79f7fe0d2e277e", "message": "Add t-digest functions to Presto\nAdd scalar and aggregation functions to Presto repo. Scalar functions\nallow retrieving values at a given quantile and quantiles at a given\nvalue. Aggregation functions allow creating a t-digest from a block\nof doubles and merging a block of t-digests.\n\nBenchmark testing results for aggregation functions displayed below:\n\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t1\tavgt\t20\t413.63\t\u00b1 16.67\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t1\tavgt\t20\t118.57\t\u00b1  2.25\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t2\tavgt\t20\t801.19\t\u00b1 10.97\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t2\tavgt\t20\t242.89\t\u00b1  9.71\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkQuantileDigestAggregation\t3\tavgt\t20     1156.49\t\u00b1 14.87\tms/op\nBenchmarkDoubleStatisticalDigestAggregationFunctions.benchmarkTDigestAggregation\t3\tavgt\t20\t359.56\t\u00b1 11.72\tms/op\n\nCo-authored-by: Gaston Arguindegui <gastonar@fb.com>", "committedDate": "2020-01-22T03:41:21Z", "type": "forcePushed"}]}