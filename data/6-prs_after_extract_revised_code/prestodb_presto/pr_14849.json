{"pr_number": 14849, "pr_title": "Honor ignore_stats_calculator_failures in getTableStatistics", "pr_createdAt": "2020-07-16T20:22:44Z", "pr_url": "https://github.com/prestodb/presto/pull/14849", "timeline": [{"oid": "18cbb51409e71939a5433cf144c100cabf533835", "url": "https://github.com/prestodb/presto/commit/18cbb51409e71939a5433cf144c100cabf533835", "message": "Honor ignore_stats_calculator_failures in getTableStatistics\n\nignore_stats_calculator_failures was getting enforced in\ncachingStatsProvider and cachingCostProvider.  However, InputExtractor\nwas calling getTableStatistics directly, so queries could still fail due\nto errors computing stats.  This was particularly a problem when filters\nwere pushed down to the table scan, because we compute filter stats as\npart of getTableStatistics().", "committedDate": "2020-07-16T22:28:16Z", "type": "forcePushed"}, {"oid": "14b3683a89e1ccb6ba69cd5817c6dfc4bc0355ab", "url": "https://github.com/prestodb/presto/commit/14b3683a89e1ccb6ba69cd5817c6dfc4bc0355ab", "message": "Honor ignore_stats_calculator_failures in getTableStatistics\n\nignore_stats_calculator_failures was getting enforced in\ncachingStatsProvider and cachingCostProvider.  However, InputExtractor\nwas calling getTableStatistics directly, so queries could still fail due\nto errors computing stats.  This was particularly a problem when filters\nwere pushed down to the table scan, because we compute filter stats as\npart of getTableStatistics().", "committedDate": "2020-07-16T22:30:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjExNTI0MA==", "url": "https://github.com/prestodb/presto/pull/14849#discussion_r456115240", "bodyText": "perhaps, use com.facebook.presto.SystemSessionProperties#IGNORE_STATS_CALCULATOR_FAILURES constant", "author": "mbasmanova", "createdAt": "2020-07-16T22:32:48Z", "path": "presto-tests/src/test/java/com/facebook/presto/tests/TestMetadataManager.java", "diffHunk": "@@ -152,4 +164,36 @@ public void testUpperCaseSchemaIsChangedToLowerCase()\n                             return null;\n                         });\n     }\n+\n+    @Test\n+    public void testGetTableStatisticsDoesNotThrow()\n+    {\n+        Session session = testSessionBuilder()\n+                .setSystemProperty(\"ignore_stats_calculator_failures\", \"true\")", "originalCommit": "14b3683a89e1ccb6ba69cd5817c6dfc4bc0355ab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "569bd0f0fb16f69de9bd8a50a155905baea88a2f", "chunk": "diff --git a/presto-tests/src/test/java/com/facebook/presto/tests/TestMetadataManager.java b/presto-tests/src/test/java/com/facebook/presto/tests/TestMetadataManager.java\nindex 373fe239fe..010ef895c1 100644\n--- a/presto-tests/src/test/java/com/facebook/presto/tests/TestMetadataManager.java\n+++ b/presto-tests/src/test/java/com/facebook/presto/tests/TestMetadataManager.java\n\n@@ -185,7 +186,7 @@ public class TestMetadataManager\n     public void testGetTableStatisticsThrows()\n     {\n         Session session = testSessionBuilder()\n-                .setSystemProperty(\"ignore_stats_calculator_failures\", \"false\")\n+                .setSystemProperty(IGNORE_STATS_CALCULATOR_FAILURES, \"false\")\n                 .build();\n         TableHandle tableHandle = new TableHandle(new ConnectorId(\"upper_case_schema_catalog\"), new ConnectorTableHandle() {}, TestingTransactionHandle.create(), Optional.empty());\n         TransactionBuilder.transaction(queryRunner.getTransactionManager(), queryRunner.getAccessControl())\n"}}, {"oid": "569bd0f0fb16f69de9bd8a50a155905baea88a2f", "url": "https://github.com/prestodb/presto/commit/569bd0f0fb16f69de9bd8a50a155905baea88a2f", "message": "Honor ignore_stats_calculator_failures in getTableStatistics\n\nignore_stats_calculator_failures was getting enforced in\ncachingStatsProvider and cachingCostProvider.  However, InputExtractor\nwas calling getTableStatistics directly, so queries could still fail due\nto errors computing stats.  This was particularly a problem when filters\nwere pushed down to the table scan, because we compute filter stats as\npart of getTableStatistics().", "committedDate": "2020-07-17T13:40:55Z", "type": "commit"}, {"oid": "569bd0f0fb16f69de9bd8a50a155905baea88a2f", "url": "https://github.com/prestodb/presto/commit/569bd0f0fb16f69de9bd8a50a155905baea88a2f", "message": "Honor ignore_stats_calculator_failures in getTableStatistics\n\nignore_stats_calculator_failures was getting enforced in\ncachingStatsProvider and cachingCostProvider.  However, InputExtractor\nwas calling getTableStatistics directly, so queries could still fail due\nto errors computing stats.  This was particularly a problem when filters\nwere pushed down to the table scan, because we compute filter stats as\npart of getTableStatistics().", "committedDate": "2020-07-17T13:40:55Z", "type": "forcePushed"}]}