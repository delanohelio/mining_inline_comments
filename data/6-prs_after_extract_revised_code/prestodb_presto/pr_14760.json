{"pr_number": 14760, "pr_title": "Fix flaky testAndInFilter test", "pr_createdAt": "2020-07-01T13:56:06Z", "pr_url": "https://github.com/prestodb/presto/pull/14760", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjM5MQ==", "url": "https://github.com/prestodb/presto/pull/14760#discussion_r448382391", "bodyText": "@kaikalur why were these tests using random(10) instead of an explicit value for the filter (or just a limit)?", "author": "rschlussel", "createdAt": "2020-07-01T13:58:34Z", "path": "presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java", "diffHunk": "@@ -8446,11 +8446,11 @@ public void testSwitchReturnsNull()\n     public void testAndInFilter()\n     {\n         assertQuery(\n-                \"SELECT count() from (select * from orders where orderkey < random(10)) where ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200))\",\n+                \"SELECT count() from (select * from orders where orderkey < random(10) + 1) where ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200))\",", "originalCommit": "94ae71dade42ce77b6fce04ce204d23108554a35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE0NDc0NA==", "url": "https://github.com/prestodb/presto/pull/14760#discussion_r449144744", "bodyText": "Good point. We can make it a between 0 and 10 or something and get rid of the randomness.", "author": "kaikalur", "createdAt": "2020-07-02T16:45:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODM4MjM5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "537525f2214756cec8580f4ae97c94a189057229", "chunk": "diff --git a/presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java b/presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java\nindex e3910f4f66..1a1df147c1 100644\n--- a/presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java\n+++ b/presto-tests/src/main/java/com/facebook/presto/tests/AbstractTestQueries.java\n\n@@ -8446,11 +8446,11 @@ public abstract class AbstractTestQueries\n     public void testAndInFilter()\n     {\n         assertQuery(\n-                \"SELECT count() from (select * from orders where orderkey < random(10) + 1) where ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200))\",\n+                \"SELECT count() from (select * from orders where orderkey < 10) where ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200))\",\n                 \"values 0\");\n \n         assertQuery(\n-                \"SELECT ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200)) from (select * from orders where orderkey < random(10) + 1 limit 1)\",\n+                \"SELECT ((orderkey > 100 and custkey > 100) or (orderkey > 200 and custkey < 200)) from (select * from orders where orderkey < 10 limit 1)\",\n                 \"values false\");\n     }\n \n"}}, {"oid": "537525f2214756cec8580f4ae97c94a189057229", "url": "https://github.com/prestodb/presto/commit/537525f2214756cec8580f4ae97c94a189057229", "message": "Fix flaky testAndInFilter test\n\nrandom(10) was returning 0 sometimes causing tests to be flaky", "committedDate": "2020-07-06T21:27:26Z", "type": "forcePushed"}, {"oid": "b8b24e3d53a2e4056040e68e1346c701569929e2", "url": "https://github.com/prestodb/presto/commit/b8b24e3d53a2e4056040e68e1346c701569929e2", "message": "Fix flaky testAndInFilter test\n\nrandom(10) was returning 0 sometimes causing tests to be flaky", "committedDate": "2020-07-07T14:14:28Z", "type": "commit"}, {"oid": "b8b24e3d53a2e4056040e68e1346c701569929e2", "url": "https://github.com/prestodb/presto/commit/b8b24e3d53a2e4056040e68e1346c701569929e2", "message": "Fix flaky testAndInFilter test\n\nrandom(10) was returning 0 sometimes causing tests to be flaky", "committedDate": "2020-07-07T14:14:28Z", "type": "forcePushed"}]}