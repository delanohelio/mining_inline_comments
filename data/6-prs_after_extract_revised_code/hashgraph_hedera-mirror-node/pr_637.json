{"pr_number": 637, "pr_title": "Kubernetes", "pr_createdAt": "2020-03-31T17:47:14Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/637", "timeline": [{"oid": "bcad1a91604cf64c0a7eea71edc105dea1fc7b4c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bcad1a91604cf64c0a7eea71edc105dea1fc7b4c", "message": "Add initial Helm chart with importer and GRPC\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:18Z", "type": "commit"}, {"oid": "c5555890a0a5e70b304297e057f1e8066f95b305", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c5555890a0a5e70b304297e057f1e8066f95b305", "message": "Add REST API to Helm chart\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:19Z", "type": "commit"}, {"oid": "20b94c87ed21658cf56fa7fd86370b884c8b70d5", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/20b94c87ed21658cf56fa7fd86370b884c8b70d5", "message": "Fix prettier corrupting helm files\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:19Z", "type": "commit"}, {"oid": "9af005f75b0d3c7085ce9601410d19b08ddbeac8", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9af005f75b0d3c7085ce9601410d19b08ddbeac8", "message": "Add HA to importer\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:19Z", "type": "commit"}, {"oid": "72e2c77a748ee97e2d66c5c0b47c6896343cc014", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/72e2c77a748ee97e2d66c5c0b47c6896343cc014", "message": "Add Prometheus\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:20Z", "type": "commit"}, {"oid": "9914303efdafb9a86e3e60c179dd5b7edc612c9a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9914303efdafb9a86e3e60c179dd5b7edc612c9a", "message": "Add Prometheus Adapter\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:20Z", "type": "commit"}, {"oid": "446a7b3ea41ebd70288407123e097ccf5a3b57da", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/446a7b3ea41ebd70288407123e097ccf5a3b57da", "message": "Add Horizontal Pod Autoscaling to GRPC and REST\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:20Z", "type": "commit"}, {"oid": "2dd13662043e538d360ac2820d2499408097483a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2dd13662043e538d360ac2820d2499408097483a", "message": "Add centralized logging via Loki\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:20Z", "type": "commit"}, {"oid": "fe7ecc6155b65ecbf41e2e358a627bc5ce5f1f2c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fe7ecc6155b65ecbf41e2e358a627bc5ce5f1f2c", "message": "Add ability to refresh properties from configmap\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:39:20Z", "type": "commit"}, {"oid": "b0d8662b441a156425d3830859dc735b6e2e0257", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b0d8662b441a156425d3830859dc735b6e2e0257", "message": "Return proper response/code for REST when db is down\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:48:58Z", "type": "commit"}, {"oid": "f6534281253c997968d6a4278a4cc0049ab9cd79", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f6534281253c997968d6a4278a4cc0049ab9cd79", "message": "Fix busy retry in shared poller\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T00:49:04Z", "type": "commit"}, {"oid": "5c173755fb6caedbb03cd3c7eabc8dd47b94a4ec", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5c173755fb6caedbb03cd3c7eabc8dd47b94a4ec", "message": "Switch to postgresql-ha chart\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T03:24:43Z", "type": "commit"}, {"oid": "985a57f6fee2f1d7f1e471a6fc4c94f78e0c0cfa", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/985a57f6fee2f1d7f1e471a6fc4c94f78e0c0cfa", "message": "Fix scaling down deployments on upgrade\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T17:32:41Z", "type": "commit"}, {"oid": "3d2273ad7fbc6f02bead01432f8991ba4f18323f", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3d2273ad7fbc6f02bead01432f8991ba4f18323f", "message": "Disable AlertManager for now\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T17:46:14Z", "type": "commit"}, {"oid": "6f89c9d0f1edc18da1afc60d0808a9c51b78b2bb", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6f89c9d0f1edc18da1afc60d0808a9c51b78b2bb", "message": "Merge remote-tracking branch 'origin/master' into kubernetes\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-03-31T21:45:24Z", "type": "commit"}, {"oid": "46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "message": "Add dependent chart artifacts\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:23:54Z", "type": "commit"}, {"oid": "46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "message": "Add dependent chart artifacts\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:23:54Z", "type": "forcePushed"}, {"oid": "4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:48:21Z", "type": "forcePushed"}, {"oid": "52ef9d0735684611c8aad62f7625a5576f759fe1", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/52ef9d0735684611c8aad62f7625a5576f759fe1", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:52:13Z", "type": "forcePushed"}, {"oid": "3a9b53bde87a9836e2c62068383d6c6eb83afab0", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3a9b53bde87a9836e2c62068383d6c6eb83afab0", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:55:24Z", "type": "commit"}, {"oid": "3a9b53bde87a9836e2c62068383d6c6eb83afab0", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3a9b53bde87a9836e2c62068383d6c6eb83afab0", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T04:55:24Z", "type": "forcePushed"}, {"oid": "40490d48ed4210450ac93848958711806c42ad09", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/40490d48ed4210450ac93848958711806c42ad09", "message": "Bump version to 0.8.1\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-01T20:56:40Z", "type": "commit"}, {"oid": "f12766af499366c252b00bab86cf996817615c29", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f12766af499366c252b00bab86cf996817615c29", "message": "Merge remote-tracking branch 'origin/master' into kubernetes", "committedDate": "2020-04-01T20:56:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2OTI2OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r401969268", "bodyText": "q: is there somewhere this is specified once and centrally so places like this can call them and not have string hard coded?", "author": "Nana-EC", "createdAt": "2020-04-01T23:32:00Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java", "diffHunk": "@@ -101,7 +101,7 @@ private void initConnectionAndStatements() throws ParserSQLException {\n         try {\n             connection = dataSource.getConnection();\n             connection.setAutoCommit(false); // do not auto-commit\n-            connection.setClientInfo(\"ApplicationName\", getClass().getCanonicalName());\n+            connection.setClientInfo(\"ApplicationName\", \"hedera-mirror-importer\");", "originalCommit": "f12766af499366c252b00bab86cf996817615c29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDU3NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r402454575", "bodyText": "I could inject it using @Value(\"${spring.application.name}\"), but don't think it's worth the effort. I reverted to using the class name but without the package.", "author": "steven-sheehy", "createdAt": "2020-04-02T16:40:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2OTI2OA=="}], "type": "inlineReview", "revised_code": {"commit": "204ca5f7f71469c7012baf4e898e5cbbab768046", "chunk": "diff --git a/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java b/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java\nindex 88dd3ae2..f18e1278 100644\n--- a/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java\n+++ b/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java\n\n@@ -101,7 +101,7 @@ public class PostgresWritingRecordParsedItemHandler implements RecordParsedItemH\n         try {\n             connection = dataSource.getConnection();\n             connection.setAutoCommit(false); // do not auto-commit\n-            connection.setClientInfo(\"ApplicationName\", \"hedera-mirror-importer\");\n+            connection.setClientInfo(\"ApplicationName\", getClass().getSimpleName());\n         } catch (SQLException e) {\n             throw new ParserSQLException(\"Error setting up connection to database\", e);\n         }\n"}}, {"oid": "06d0456e80c1f5d1d242f219acb6bb3e8c485f6b", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/06d0456e80c1f5d1d242f219acb6bb3e8c485f6b", "message": "Bump Flyway connectRetries to avoid crashing importer on initial start\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-02T16:13:07Z", "type": "commit"}, {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/204ca5f7f71469c7012baf4e898e5cbbab768046", "message": "Review feedback\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-04-02T16:39:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzNzE4Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404337183", "bodyText": "Please add class comment.\nIf there's a default example/source from where the code was forked, it'd be good to add that too. Just makes reviewing (or understanding code in general for anyone in future), lot easier.", "author": "apeksharma", "createdAt": "2020-04-06T19:32:26Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/leader/LeaderAspect.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package com.hedera.mirror.importer.leader;\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+\n+import lombok.extern.log4j.Log4j2;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.springframework.context.event.EventListener;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.integration.leader.event.OnGrantedEvent;\n+import org.springframework.integration.leader.event.OnRevokedEvent;\n+\n+@Aspect\n+@Log4j2\n+@Order(1)\n+public class LeaderAspect {", "originalCommit": "204ca5f7f71469c7012baf4e898e5cbbab768046", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzOTc0Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404339742", "bodyText": "Will add a javadoc. It's not forked, I wrote it. I used something similar at my last job, but can't link to that ;)", "author": "steven-sheehy", "createdAt": "2020-04-06T19:36:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzNzE4Mw=="}], "type": "inlineReview", "revised_code": null}]}