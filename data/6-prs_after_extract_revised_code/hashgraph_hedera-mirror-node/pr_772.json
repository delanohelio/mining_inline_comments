{"pr_number": 772, "pr_title": "Add option to archive verified signature files", "pr_createdAt": "2020-05-21T16:16:30Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/772", "timeline": [{"oid": "2692ffdc2e6ee78b72fbe29b1bc90e8a55b05555", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2692ffdc2e6ee78b72fbe29b1bc90e8a55b05555", "message": "Add option to keep signatures\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-05-21T15:58:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc2MzIxNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/772#discussion_r428763215", "bodyText": "Using parser specific properties in a generic utility class is a code smell. It also didn't allow for code reuse with the new downloader properties. Instead move this back to layer where it belongs even if it duplicates 4 lines of code. This duplication will be gone anyway once we integrate balance parsing into the new framework (#573).", "author": "steven-sheehy", "createdAt": "2020-05-21T16:21:10Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -311,38 +310,21 @@ public static boolean hashIsEmpty(String hash) {\n         return StringUtils.isBlank(hash) || hash.equals(EMPTY_HASH);\n     }\n \n-    public static void moveFileToParsedDir(String filePath, ParserProperties parserProperties) {\n-        Path source = Path.of(filePath);\n-        String fileName = source.getFileName().toString();\n-        String dateSubDir = fileName.substring(0, 10).replace(\"-\", File.separator);\n-        Path destination = parserProperties.getParsedPath().resolve(dateSubDir).resolve(fileName);\n-        destination.getParent().toFile().mkdirs();\n+    // Moves a file in the form 2019-08-30T18_10_00.419072Z.rcd to destinationRoot/2019/08/30\n+    public static void archiveFile(File source, Path destinationRoot) {\n+        String filename = source.getName();\n+        String date = filename.substring(0, 10).replace(\"-\", File.separator);\n+        Path destination = destinationRoot.resolve(date);\n \n         try {\n-            Files.move(source, destination, StandardCopyOption.REPLACE_EXISTING);\n+            destination.toFile().mkdirs();\n+            Files.move(source.toPath(), destination.resolve(filename), StandardCopyOption.REPLACE_EXISTING);\n             log.trace(\"Moved {} to {}\", source, destination);\n         } catch (Exception e) {\n             log.error(\"Error moving file {} to {}\", source, destination, e);\n         }\n     }\n \n-    public static void deleteFile(String fileName) {\n-        try {\n-            Files.delete(new File(fileName).toPath());\n-            log.trace(\"Deleted file {}\", fileName);\n-        } catch (Exception e) {\n-            log.error(\"Error deleting file {}\", fileName);\n-        }\n-    }\n-\n-    public static void moveOrDeleteParsedFile(String fileName, ParserProperties parserProperties) {", "originalCommit": "2692ffdc2e6ee78b72fbe29b1bc90e8a55b05555", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "fcfbdf73da0b3afa49eadb4cd8d1638884df39d3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fcfbdf73da0b3afa49eadb4cd8d1638884df39d3", "message": "Address review\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-05-21T21:49:13Z", "type": "commit"}]}