{"pr_number": 876, "pr_title": "Populate consensus_(start|end) for historical entries in t_record_files and fix name column", "pr_createdAt": "2020-07-17T01:46:10Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/876", "timeline": [{"oid": "6b8ac904725915681737e80418ff8a97f710331d", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6b8ac904725915681737e80418ff8a97f710331d", "message": "add flyway db migration script to populate consensus_start and consensus_end for historic rows in t_record_files\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-17T01:39:43Z", "type": "commit"}, {"oid": "31366b4086f7f69ba477698e19712a9f15ea750e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/31366b4086f7f69ba477698e19712a9f15ea750e", "message": "add comment for clarity\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-17T13:44:44Z", "type": "commit"}, {"oid": "838bb7a76170b3ac57505b0e53c4fc5ae1f4b03e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/838bb7a76170b3ac57505b0e53c4fc5ae1f4b03e", "message": "db migration script optimization\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-18T02:36:07Z", "type": "commit"}, {"oid": "874890c5462985c75377d402599a5c09b4b24d02", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/874890c5462985c75377d402599a5c09b4b24d02", "message": "store file name not the full file path in EventFile.name\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-20T15:36:27Z", "type": "commit"}, {"oid": "226de784b082393ef1408b35b4df24e9c9696f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/226de784b082393ef1408b35b4df24e9c9696f19", "message": "use file name instead of full file path for name field of RecordFile and EventFile\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-20T20:36:47Z", "type": "commit"}, {"oid": "226de784b082393ef1408b35b4df24e9c9696f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/226de784b082393ef1408b35b4df24e9c9696f19", "message": "use file name instead of full file path for name field of RecordFile and EventFile\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-20T20:36:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5MzYxNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/876#discussion_r457693614", "bodyText": "Can we change parseRecordFile to take in a File instead of using this logic?", "author": "steven-sheehy", "createdAt": "2020-07-20T21:10:21Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -137,8 +138,8 @@\n     public static RecordFile parseRecordFile(String filePath, String expectedPrevFileHash, Instant verifyHashAfter,\n                                              Consumer<RecordItem> recordItemConsumer) {\n         RecordFile recordFile = new RecordFile();\n-        recordFile.setName(filePath);\n-        String fileName = Utility.getFileName(filePath);\n+        String fileName = FilenameUtils.getName(filePath);", "originalCommit": "226de784b082393ef1408b35b4df24e9c9696f19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzcxNzM0NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/876#discussion_r457717344", "bodyText": "sure. and the change is bigger than I thought.", "author": "xin-hedera", "createdAt": "2020-07-20T22:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5MzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNDI5OA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/876#discussion_r458134298", "bodyText": "We shouldn't remove StreamFileData. The purpose of that file is to abstract out the fact that we're storing the stream file on the filesystem in case we want to store it in a queue or the database in the future. I just meant the minimal change to the RecordFileDownloader to pass File. For RecordFileParser, can just construct a new File(streamFileData.getFilename()). Or we can just revert last commit and leave as is and revist later.", "author": "steven-sheehy", "createdAt": "2020-07-21T14:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5MzYxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NTcxNw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/876#discussion_r458145717", "bodyText": "i'll revert the last commit and just change the signature of Utility.recordFileParser.\nA relevant question, is StreamFileData.filename supposed to be the file name or the full file path? I have to change both RecordStreamFileListener.onStart(StreamFileData) implementations since it checks duplication against t_record_files using the StreamFileData.filename.\nWith t_record_files.name updated to the file name, I have to either change StreamFileData.filename to match t_record_files.name or change onStart implementation to get file name from full file path (yes, current implementation saves full pauth in StreamFileData.filename).", "author": "xin-hedera", "createdAt": "2020-07-21T14:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY5MzYxNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "fbecc7c8251c60a85335a9f8dd8699d882b5c50a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fbecc7c8251c60a85335a9f8dd8699d882b5c50a", "message": "use file name instead of file path to query t_record_files to check duplicate\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-21T14:51:26Z", "type": "commit"}, {"oid": "fbecc7c8251c60a85335a9f8dd8699d882b5c50a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fbecc7c8251c60a85335a9f8dd8699d882b5c50a", "message": "use file name instead of file path to query t_record_files to check duplicate\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>", "committedDate": "2020-07-21T14:51:26Z", "type": "forcePushed"}]}