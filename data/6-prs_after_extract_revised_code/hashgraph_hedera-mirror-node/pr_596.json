{"pr_number": 596, "pr_title": "Configuration to delete parsed files", "pr_createdAt": "2020-03-12T21:41:10Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/596", "timeline": [{"oid": "42875c07c680e23a2f61c46f04ade38e571808bd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/42875c07c680e23a2f61c46f04ade38e571808bd", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T21:40:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzODg5OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391938899", "bodyText": "Should this method be something that lives in Utility class. Taking in a boolean of whether to move or delete and the name\ne.g.\npublic void moveOrDeleteParsedFile(boolean move, String fileName) {\n        if (moved) {\n             Utility.moveFileToParsedDir(fileName, \"/parsedBalanceFiles/\");\n         } else {\n             Utility.deleteParsedFile(fileName);\n         }\n}\n\nThat way The FileParser classes only have to call\n\nUtility. moveOrDeleteParsedFile(parserProperties.isKeepFiles(), PARSED_DIR)", "author": "Nana-EC", "createdAt": "2020-03-12T22:26:48Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java", "diffHunk": "@@ -97,23 +94,26 @@ private void processAllFilesForHistory() {\n \n     private void processLastBalanceFile() {\n         Stopwatch stopwatch = Stopwatch.createStarted();\n-\n         try {\n             File balanceFile = getLatestBalanceFile();\n-\n             if (balanceFile == null) {\n                 return;\n             }\n-\n             log.debug(\"Processing last balance file {}\", balanceFile);\n-\n             if (new AccountBalancesFileLoader((BalanceParserProperties) parserProperties, balanceFile.toPath())\n                     .loadAccountBalances()) {\n-                // move it\n-                Utility.moveFileToParsedDir(balanceFile.getCanonicalPath(), \"/parsedBalanceFiles/\");\n+                moveOrDeleteParsedFile(balanceFile.getCanonicalPath());\n             }\n         } catch (Exception e) {\n             log.error(\"Error processing balances files after {}\", stopwatch, e);\n         }\n     }\n+\n+    private void moveOrDeleteParsedFile(String fileName) {", "originalCommit": "42875c07c680e23a2f61c46f04ade38e571808bd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fad5d48b06c80f6d1103625b127418292c4c4f19", "chunk": "diff --git a/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java b/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java\nindex 6017824b..cdb8c99b 100644\n--- a/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java\n+++ b/hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java\n\n@@ -100,20 +97,17 @@ public class BalanceFileParser extends FileWatcher {\n                 return;\n             }\n             log.debug(\"Processing last balance file {}\", balanceFile);\n-            if (new AccountBalancesFileLoader((BalanceParserProperties) parserProperties, balanceFile.toPath())\n-                    .loadAccountBalances()) {\n-                moveOrDeleteParsedFile(balanceFile.getCanonicalPath());\n-            }\n+            processBalanceFile(balanceFile);\n         } catch (Exception e) {\n             log.error(\"Error processing balances files after {}\", stopwatch, e);\n         }\n     }\n \n-    private void moveOrDeleteParsedFile(String fileName) {\n-        if (((BalanceParserProperties) parserProperties).isKeepFiles()) {\n-            Utility.moveFileToParsedDir(fileName, \"/parsedBalanceFiles/\");\n-        } else {\n-            Utility.deleteParsedFile(fileName);\n+    private void processBalanceFile(File balanceFile) throws Exception {\n+        if (new AccountBalancesFileLoader((BalanceParserProperties) parserProperties, balanceFile.toPath())\n+                .loadAccountBalances()) {\n+            Utility.moveOrDeleteParsedFile(balanceFile.getCanonicalPath(), \"/parsedBalanceFiles/\",\n+                    ((BalanceParserProperties) parserProperties).isKeepFiles());\n         }\n     }\n }\n"}}, {"oid": "e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T22:41:16Z", "type": "commit"}, {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T23:36:20Z", "type": "commit"}, {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-03-12T23:36:20Z", "type": "forcePushed"}]}