{"pr_number": 728, "pr_title": "Homogenize integration test setup", "pr_createdAt": "2020-04-30T20:56:01Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/728", "timeline": [{"oid": "6af9ac45b65002d64b669e0965468aad9c4363d4", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6af9ac45b65002d64b669e0965468aad9c4363d4", "message": "Homogenize integration test setup\n\nAdds @ConditionalOnRecordParser. RecordFileParser bean (and downstream beans) are instantiated based on it. Add test to avoid regression in bean setup.\nReplaces EntityEnabledCondition and PubSubEnabledCondition with @ConditionOnEntityRecordParser and @ConditionalOnPubSubRecordParser.\nUses @ConditionalOn*RecordParser to instantiate corresponding RecordItemListeners and downstream beans\nMove cache cleaning logic to ResetCacheTestExecutionListener.\nMake RecordFileParserTest unit test by mocking ApplicationStatusRepository\nAdds barebone PubSubIntegrationTest and TestPubSubConfiguration classes to show how everything fits\nMake tests homogeneous. Some were @Transactional, however most were not. Make them all non @Transactional.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-30T21:00:20Z", "type": "forcePushed"}, {"oid": "373e7ccff83619c0f763019e279048f505b3f49e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/373e7ccff83619c0f763019e279048f505b3f49e", "message": "Homogenize integration test setup\n\nAdds @ConditionalOnRecordParser. RecordFileParser bean (and downstream beans) are instantiated based on it. Add test to avoid regression in bean setup.\nReplaces EntityEnabledCondition and PubSubEnabledCondition with @ConditionOnEntityRecordParser and @ConditionalOnPubSubRecordParser.\nUses @ConditionalOn*RecordParser to instantiate corresponding RecordItemListeners and downstream beans\nMove cache cleaning logic to ResetCacheTestExecutionListener.\nMake RecordFileParserTest unit test by mocking ApplicationStatusRepository\nAdds barebone PubSubIntegrationTest and TestPubSubConfiguration classes to show how everything fits\nMake tests homogeneous. Some were @Transactional, however most were not. Make them all non @Transactional.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-30T21:02:55Z", "type": "forcePushed"}, {"oid": "7d6bcc5e770fcee05d76d5df1fab76eea2c2a393", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d6bcc5e770fcee05d76d5df1fab76eea2c2a393", "message": "Homogenize integration test setup\n\nAdds @ConditionalOnRecordParser. RecordFileParser bean (and downstream beans) are instantiated based on it. Add test to avoid regression in bean setup.\nReplaces EntityEnabledCondition and PubSubEnabledCondition with @ConditionOnEntityRecordParser and @ConditionalOnPubSubRecordParser.\nUses @ConditionalOn*RecordParser to instantiate corresponding RecordItemListeners and downstream beans\nMove cache cleaning logic to ResetCacheTestExecutionListener.\nMake RecordFileParserTest unit test by mocking ApplicationStatusRepository\nAdds barebone PubSubIntegrationTest and TestPubSubConfiguration classes to show how everything fits\nMake tests homogeneous. Some were @Transactional, however most were not. Make them all non @Transactional.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-30T21:08:28Z", "type": "commit"}, {"oid": "7d6bcc5e770fcee05d76d5df1fab76eea2c2a393", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d6bcc5e770fcee05d76d5df1fab76eea2c2a393", "message": "Homogenize integration test setup\n\nAdds @ConditionalOnRecordParser. RecordFileParser bean (and downstream beans) are instantiated based on it. Add test to avoid regression in bean setup.\nReplaces EntityEnabledCondition and PubSubEnabledCondition with @ConditionOnEntityRecordParser and @ConditionalOnPubSubRecordParser.\nUses @ConditionalOn*RecordParser to instantiate corresponding RecordItemListeners and downstream beans\nMove cache cleaning logic to ResetCacheTestExecutionListener.\nMake RecordFileParserTest unit test by mocking ApplicationStatusRepository\nAdds barebone PubSubIntegrationTest and TestPubSubConfiguration classes to show how everything fits\nMake tests homogeneous. Some were @Transactional, however most were not. Make them all non @Transactional.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-30T21:08:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMyNzQ5Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/728#discussion_r418327497", "bodyText": "q: What happens when hedera.mirror.importer.parser.record.enabled is missing since ConditionalOnRecordParser has a match on missing?\nChecking in case removing this means parser ends up getting run anyway.", "author": "Nana-EC", "createdAt": "2020-04-30T22:35:31Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -283,9 +285,6 @@ private void loadRecordFiles(List<String> fileNames) {\n     @Override\n     @Scheduled(fixedRateString = \"${hedera.mirror.importer.parser.record.frequency:500}\")\n     public void parse() {\n-        if (!parserProperties.isEnabled()) {", "originalCommit": "7d6bcc5e770fcee05d76d5df1fab76eea2c2a393", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODM0MDA1NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/728#discussion_r418340054", "bodyText": "Checked again, ConditionalOnRecordParser has matchIfMissing=true and comment too.", "author": "apeksharma", "createdAt": "2020-04-30T23:13:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODMyNzQ5Nw=="}], "type": "inlineReview", "revised_code": null}]}