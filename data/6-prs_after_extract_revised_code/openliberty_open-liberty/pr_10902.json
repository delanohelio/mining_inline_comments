{"pr_number": 10902, "pr_title": "Add test variations for header(\"Expect\", \"100-continue\")", "pr_createdAt": "2020-02-14T14:12:00Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10902", "timeline": [{"oid": "6fd686229317c0b4a3804549ecd43259f81929d9", "url": "https://github.com/OpenLiberty/open-liberty/commit/6fd686229317c0b4a3804549ecd43259f81929d9", "message": "Add test variations for header(\"Expect\", \"100-continue\")", "committedDate": "2020-02-14T14:46:52Z", "type": "commit"}, {"oid": "6fd686229317c0b4a3804549ecd43259f81929d9", "url": "https://github.com/OpenLiberty/open-liberty/commit/6fd686229317c0b4a3804549ecd43259f81929d9", "message": "Add test variations for header(\"Expect\", \"100-continue\")", "committedDate": "2020-02-14T14:46:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2OTI4NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10902#discussion_r379469285", "bodyText": "This does not seem right to me.  It is certainly inconsistent.  I don't think that we want a test case to verify that we behave incorrectly/inconsistently.  Instead, we should probably work with the CXF community to determine the right next step - possibly something like always enabling chunking when the Expect: 100-continue header is specified.", "author": "andymc12", "createdAt": "2020-02-14T14:48:20Z", "path": "dev/com.ibm.ws.jaxrs.2.x_fat_clientProps/test-applications/cxfClientPropsApp/src/jaxrs2x/cxfClientProps/CxfClientPropsTestServlet.java", "diffHunk": "@@ -253,6 +253,37 @@ public void testChunkingThreshold(HttpServletRequest req, HttpServletResponse re\n                        .post(Entity.text(sb.toString()))\n                        .readEntity(String.class);\n         assertEquals(\"30000:30000\", result);\n+        \n+        // Repeating the tests but adding the \"Expect\", \"100-continue\" header.  In this case a 100 will\n+        // be sent prior to the 200 containing the output.  The JDK will catch and handle this 100 and \n+        // JAXRS will only get the 200 response when in streaming mode (which for now is only chunking).  \n+        // If not in chunking then JAXRS will receive the 100 response which will contain no returned data.\n+        client = ClientBuilder.newBuilder()\n+                        .property(\"client.ChunkingThreshold\", \"10000\")\n+                        .build();\n+   \n+        Response response = client.target(\"http://localhost:\" + req.getServerPort() + \"/cxfClientPropsApp/resource/chunking\")\n+                              .request().header(\"Expect\", \"100-continue\")\n+                              .post(Entity.text(sb.toString()));\n+        int status = response.getStatus();\n+        result = response.readEntity(String.class);\n+        \n+        assertEquals(200,status);\n+        assertEquals(\"CHUNKING\", result);\n+\n+        client = ClientBuilder.newBuilder()\n+                        .property(\"client.ChunkingThreshold\", \"40000\")\n+                        .build();\n+        response = client.target(\"http://localhost:\" + req.getServerPort() + \"/cxfClientPropsApp/resource/chunking\")\n+                       .request().header(\"Expect\", \"100-continue\")\n+                       .post(Entity.text(sb.toString()));\n+        status = response.getStatus();\n+        result = response.readEntity(String.class);\n+\n+        // If a 100 response is received then no data will be sent.\n+        assertEquals(100,status);", "originalCommit": "6fd686229317c0b4a3804549ecd43259f81929d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3NDUzOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10902#discussion_r379474538", "bodyText": "I agree in principle.   However, this is our behavior now so I think I will leave it.   However I agree this should be addressed so I'll create an issue to work with CXF to resolve, indicating that this testcase will need to be adjusted when that happens.", "author": "jim-krueger", "createdAt": "2020-02-14T14:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2OTI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ3Njg4Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10902#discussion_r379476886", "bodyText": "And it will be interesting to see if this behavior is the same for all platforms/jdks.", "author": "jim-krueger", "createdAt": "2020-02-14T15:01:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQ2OTI4NQ=="}], "type": "inlineReview", "revised_code": null}]}