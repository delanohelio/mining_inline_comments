{"pr_number": 14983, "pr_title": "Adding more debug to wlp.lib.extract.PackageRunnableTest.testRunnableJar", "pr_createdAt": "2020-11-16T17:00:45Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/14983", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNTIzOQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14983#discussion_r524435239", "bodyText": "I suggest just using a BufferedReader with the META-INF/MANIFEST.MF JarEntry input stream to log it line by line.  I worry that the JarFile Manifest object may give us an empty  attributes even when the manifest resource has some corrupted data in it.", "author": "tjwatson", "createdAt": "2020-11-16T17:13:22Z", "path": "dev/wlp.lib.extract_fat/fat/src/wlp/lib/extract/PackageRunnableTest.java", "diffHunk": "@@ -297,7 +299,25 @@ private String executeTheJar(File extractDirectory, boolean useDummyUserDir, boo\n             } else {\n                 Log.info(c, \"executeTheJar\", \"No messages.log - \" + messagesLog.getAbsolutePath());\n             }\n+", "originalCommit": "97f425ce3303e3a3eaae2006fe7f081abb8cb4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDUxODI0Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/14983#discussion_r524518242", "bodyText": "Thanks Tom!  Updates made based on your suggestion.", "author": "hlhoots", "createdAt": "2020-11-16T19:27:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQzNTIzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "f022bf0223a7864fc7dd881761b0d4dc79dfdeb0", "chunk": "diff --git a/dev/wlp.lib.extract_fat/fat/src/wlp/lib/extract/PackageRunnableTest.java b/dev/wlp.lib.extract_fat/fat/src/wlp/lib/extract/PackageRunnableTest.java\nindex 1f93b57224..80143ba49b 100644\n--- a/dev/wlp.lib.extract_fat/fat/src/wlp/lib/extract/PackageRunnableTest.java\n+++ b/dev/wlp.lib.extract_fat/fat/src/wlp/lib/extract/PackageRunnableTest.java\n\n@@ -300,22 +297,25 @@ public class PackageRunnableTest {\n                 Log.info(c, \"executeTheJar\", \"No messages.log - \" + messagesLog.getAbsolutePath());\n             }\n \n-            // log the contents of the runnable jar's manifest if there is a failure\n-            Log.info(c, \"executeTheJar\", \"=== Start dumping contents of manifest file ===\");\n+            // log the contents of the runnable jar's manifest.mf\n             JarFile jarFile = new JarFile(runnableJar.getAbsolutePath());\n-            Manifest mf = jarFile.getManifest();\n-            Attributes attrs = mf.getMainAttributes();\n-            Iterator<Object> it = attrs.keySet().iterator();\n-            while (it.hasNext()) {\n-                Attributes.Name attrName = (Attributes.Name) it.next();\n-                String attrValue = attrs.getValue(attrName);\n-                Log.info(c, \"executeTheJar\", \"name = \" + attrName + \" value = \" + attrValue);\n+            boolean manifestFound = false;\n+\n+            for (Enumeration<JarEntry> e = jarFile.entries(); e.hasMoreElements();) {\n+                JarEntry je = e.nextElement();\n+                if (je.getName().equals(\"META-INF/MANIFEST.MF\")) {\n+                    Log.info(c, \"executeTheJar\", \"=== Start dumping contents of manifest file ===\");\n+                    readJarEntryContent(jarFile, je);\n+                    manifestFound = true;\n+                    Log.info(c, \"executeTheJar\", \"=== End dumping contents of manifest file ===\");\n+                }\n             }\n \n             if (jarFile != null) {\n                 jarFile.close();\n             }\n-            Log.info(c, \"executeTheJar\", \"=== End dumping contents of manifest file ===\");\n+\n+            assertTrue(\"Runnable jar did not contain a META-INF/MANIFEST.MF file\", manifestFound);\n         }\n \n         assertTrue(\"Server did not start successfully in time.\", found);\n"}}, {"oid": "f022bf0223a7864fc7dd881761b0d4dc79dfdeb0", "url": "https://github.com/OpenLiberty/open-liberty/commit/f022bf0223a7864fc7dd881761b0d4dc79dfdeb0", "message": "Add debug to dump manifest.mf in wlp.lib.extract.PackageRunnableTest.testRunnableJar", "committedDate": "2020-11-16T19:25:43Z", "type": "forcePushed"}, {"oid": "c0b2a2dfe3c458eef2296220f1963eca69b3228f", "url": "https://github.com/OpenLiberty/open-liberty/commit/c0b2a2dfe3c458eef2296220f1963eca69b3228f", "message": "Add debug to dump manifest.mf in wlp.lib.extract.PackageRunnableTest.testRunnableJar", "committedDate": "2020-11-16T20:21:21Z", "type": "commit"}, {"oid": "c0b2a2dfe3c458eef2296220f1963eca69b3228f", "url": "https://github.com/OpenLiberty/open-liberty/commit/c0b2a2dfe3c458eef2296220f1963eca69b3228f", "message": "Add debug to dump manifest.mf in wlp.lib.extract.PackageRunnableTest.testRunnableJar", "committedDate": "2020-11-16T20:21:21Z", "type": "forcePushed"}]}