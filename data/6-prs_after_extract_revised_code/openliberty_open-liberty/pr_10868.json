{"pr_number": 10868, "pr_title": "Change URL and connectionProperties to ibm-obscure", "pr_createdAt": "2020-02-12T21:20:52Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10868", "timeline": [{"oid": "975b767aef90fb550badcfbcaf0227c0d1380e4d", "url": "https://github.com/OpenLiberty/open-liberty/commit/975b767aef90fb550badcfbcaf0227c0d1380e4d", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-12T21:25:23Z", "type": "forcePushed"}, {"oid": "ad17f16d37373bb61970e67f5e324322f5fe093d", "url": "https://github.com/OpenLiberty/open-liberty/commit/ad17f16d37373bb61970e67f5e324322f5fe093d", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-13T18:18:56Z", "type": "forcePushed"}, {"oid": "f7d83608937460194ffe23594901ddbde97ab878", "url": "https://github.com/OpenLiberty/open-liberty/commit/f7d83608937460194ffe23594901ddbde97ab878", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-14T15:41:35Z", "type": "forcePushed"}, {"oid": "9c48e3fffef7f215f2eb7a37b4533ce3a197e920", "url": "https://github.com/OpenLiberty/open-liberty/commit/9c48e3fffef7f215f2eb7a37b4533ce3a197e920", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-17T18:47:50Z", "type": "forcePushed"}, {"oid": "fb798b67eb419f7bef423466a96a2f6fac14235b", "url": "https://github.com/OpenLiberty/open-liberty/commit/fb798b67eb419f7bef423466a96a2f6fac14235b", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-17T18:49:18Z", "type": "forcePushed"}, {"oid": "41564d8110197e4286c720f1e55b6df5063e85b0", "url": "https://github.com/OpenLiberty/open-liberty/commit/41564d8110197e4286c720f1e55b6df5063e85b0", "message": "Change URL and connectionProperties to ibm-type passwords", "committedDate": "2020-02-17T18:53:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM0NDUxMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10868#discussion_r380344510", "bodyText": "Minor: mixture of tabs and spaces makes this code for the following method format awkwardly", "author": "njr-11", "createdAt": "2020-02-17T19:45:32Z", "path": "dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java", "diffHunk": "@@ -28,4 +37,54 @@ public static void beforeSuite() throws Exception {\n         //Allows local tests to switch between using a local docker client, to using a remote docker client. \n         ExternalTestServiceDockerClientStrategy.clearTestcontainersConfig();\n     }\n+    \n+    public static void initDatabaseTables(OracleContainer oracle) throws SQLException {", "originalCommit": "41564d8110197e4286c720f1e55b6df5063e85b0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "05f68b5e0c3887d38ec8bbe04ba980c21c8e6517", "chunk": "diff --git a/dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java b/dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java\nindex 6d3773db02..601da10953 100755\n--- a/dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java\n+++ b/dev/com.ibm.ws.jdbc_fat_oracle/fat/src/com/ibm/ws/jdbc/fat/oracle/FATSuite.java\n\n@@ -32,27 +36,45 @@ import oracle.jdbc.pool.OracleDataSource;\n                 OracleUCPTest.class\n })\n public class FATSuite {\n+\n+    //TODO replace this container with the official oracle-xe container if/when it is available without a license\n+    public static OracleContainer oracle = new OracleContainer(\"oracleinanutshell/oracle-xe-11g\").withLogConsumer(FATSuite::log);\n+\n+    private static void log(OutputFrame frame) {\n+        String msg = frame.getUtf8String();\n+        if (msg.endsWith(\"\\n\"))\n+            msg = msg.substring(0, msg.length() - 1);\n+        Log.info(FATSuite.class, \"oracle\", msg);\n+    }\n+\n     @BeforeClass\n     public static void beforeSuite() throws Exception {\n-        //Allows local tests to switch between using a local docker client, to using a remote docker client. \n+        //Allows local tests to switch between using a local docker client, to using a remote docker client.\n         ExternalTestServiceDockerClientStrategy.clearTestcontainersConfig();\n+\n+        oracle.start();\n+    }\n+\n+    @AfterClass\n+    public static void afterSuite() {\n+        oracle.stop();\n     }\n-    \n-    public static void initDatabaseTables(OracleContainer oracle) throws SQLException {\n-\t\tProperties connProps = new Properties();\n-\t\t// This property prevents \"ORA-01882: timezone region not found\" errors due to the Oracle DB not understanding \n-\t\t// some time zones(specifically those used by our RHEL 6 test systems).\n-\t\tconnProps.put(\"oracle.jdbc.timezoneAsRegion\", \"false\"); \n-\t\t\n-\t\tOracleDataSource ds = new OracleDataSource();\n-\t\tds.setConnectionProperties(connProps);\n-\t\tds.setUser(oracle.getUsername());\n-\t\tds.setPassword(oracle.getPassword());\n-\t\tds.setURL(oracle.getJdbcUrl());\n-\t\t\n-    \ttry (Connection conn = ds.getConnection()){\n+\n+    public static void initDatabaseTables() throws SQLException {\n+        Properties connProps = new Properties();\n+        // This property prevents \"ORA-01882: timezone region not found\" errors due to the Oracle DB not understanding\n+        // some time zones(specifically those used by our RHEL 6 test systems).\n+        connProps.put(\"oracle.jdbc.timezoneAsRegion\", \"false\");\n+\n+        OracleDataSource ds = new OracleDataSource();\n+        ds.setConnectionProperties(connProps);\n+        ds.setUser(oracle.getUsername());\n+        ds.setPassword(oracle.getPassword());\n+        ds.setURL(oracle.getJdbcUrl());\n+\n+        try (Connection conn = ds.getConnection()) {\n             Statement stmt = conn.createStatement();\n-            \n+\n             //Create MYTABLE for OracleTest.class and OracleTraceTest.class\n             try {\n                 stmt.execute(\"DROP TABLE MYTABLE\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM0NzE0Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10868#discussion_r380347147", "bodyText": "minor: System.out with initials accidentally left in test code?", "author": "njr-11", "createdAt": "2020-02-17T19:55:15Z", "path": "dev/com.ibm.ws.jdbc_fat_oracle/test-applications/oracletracefat/src/trace/web/OracleTraceTestServlet.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package trace.web;\n+\n+import java.sql.Connection;\n+import java.sql.PreparedStatement;\n+\n+import javax.annotation.Resource;\n+import javax.annotation.sql.DataSourceDefinition;\n+import javax.servlet.annotation.WebServlet;\n+import javax.sql.DataSource;\n+\n+import org.junit.Test;\n+\n+import componenttest.app.FATServlet;\n+\n+\n+@DataSourceDefinition(\n+        name = \"java:comp/env/jdbc/conn_prop_dsd\",\n+        className = \"oracle.jdbc.pool.OracleDataSource\",\n+        url = \"${env.URL}\",\n+        user = \"${env.USER}\",\n+        password = \"${env.PASSWORD}\",\n+        properties = {\n+                       \"connectionProperties=\" +\n+                       \"oracle.net.ssl_version=1.2;\" +\n+                       \"oracle.net.authentication_services=(TCPS);\" + \n+                       \"javax.net.ssl.keyStore=path-to-keystore/keystore.p12;\\n\" + \n+                       \"javax.net.ssl.keyStoreType=PKCS12;\\n\" + \n+                       \"javax.net.ssl.keyStorePassword=${env.SSL_PASSWORD};\\n\" + \n+                       \"javax.net.ssl.trustStore= path-to-keystore/keystore.p12;\\n\" + \n+                       \"javax.net.ssl.trustStoreType=PKCS12;\\n\" + \n+                       \"javax.net.ssl.trustStorePassword=${env.SSL_PASSWORD}\"\n+        })\n+\n+\n+@SuppressWarnings(\"serial\")\n+@WebServlet(urlPatterns = \"/OracleTraceTestServlet\")\n+public class OracleTraceTestServlet extends FATServlet {\n+    \n+    @Resource(lookup = \"jdbc/conn-prop-ds\")\n+    private DataSource conn_prop_ds;\n+    \n+    @Resource(lookup = \"java:comp/env/jdbc/conn_prop_dsd\")\n+    private DataSource conn_prop_dsd;\n+    \n+    //These tests are not expected to actually create an SSL connection to our Oracle Database\n+    //The oracle test container does not have SSL connections enabled.  Instead we are just\n+    //using these connections to make sure the trust/key store passwords are not traced.  \n+    @Test\n+    public void testDSUsingConnProps() throws Exception {\n+        Connection conn = conn_prop_ds.getConnection();\n+\n+        try {\n+            PreparedStatement ps = conn.prepareStatement(\"INSERT INTO MYTABLE VALUES(?,?)\");\n+            ps.setInt(1, 10);\n+            ps.setString(2, \"ten\");\n+            ps.executeUpdate();\n+            ps.close();\n+        } finally {\n+            conn.close();\n+        }\n+    }\n+    \n+    @Test\n+    public void testDSDUsingConnProps() throws Exception {\n+    \tSystem.out.println(\"KJA1017 connection property settings: \" + conn_prop_dsd.toString() );", "originalCommit": "41564d8110197e4286c720f1e55b6df5063e85b0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "05f68b5e0c3887d38ec8bbe04ba980c21c8e6517", "chunk": "diff --git a/dev/com.ibm.ws.jdbc_fat_oracle/test-applications/oracletracefat/src/trace/web/OracleTraceTestServlet.java b/dev/com.ibm.ws.jdbc_fat_oracle/test-applications/oracletracefat/src/trace/web/OracleTraceTestServlet.java\nindex 635d518ecb..abdd6b0ab4 100755\n--- a/dev/com.ibm.ws.jdbc_fat_oracle/test-applications/oracletracefat/src/trace/web/OracleTraceTestServlet.java\n+++ b/dev/com.ibm.ws.jdbc_fat_oracle/test-applications/oracletracefat/src/trace/web/OracleTraceTestServlet.java\n\n@@ -12,6 +12,7 @@ package trace.web;\n \n import java.sql.Connection;\n import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n \n import javax.annotation.Resource;\n import javax.annotation.sql.DataSourceDefinition;\n"}}, {"oid": "05f68b5e0c3887d38ec8bbe04ba980c21c8e6517", "url": "https://github.com/OpenLiberty/open-liberty/commit/05f68b5e0c3887d38ec8bbe04ba980c21c8e6517", "message": "Hide url and connProps when using generic props", "committedDate": "2020-02-21T15:47:41Z", "type": "forcePushed"}, {"oid": "a845a0141262b222d8878e792b4227245f9624d4", "url": "https://github.com/OpenLiberty/open-liberty/commit/a845a0141262b222d8878e792b4227245f9624d4", "message": "Hide url and connProps when using generic props", "committedDate": "2020-03-11T15:18:46Z", "type": "forcePushed"}, {"oid": "595b569b5f504b5edd2bac30fc5a9073fc3c1794", "url": "https://github.com/OpenLiberty/open-liberty/commit/595b569b5f504b5edd2bac30fc5a9073fc3c1794", "message": "Change URL and connectionProperties to ibm-type obscure", "committedDate": "2020-03-11T15:36:54Z", "type": "forcePushed"}, {"oid": "edddfc69efe7c309f078ecc46a480ceb8dc1365e", "url": "https://github.com/OpenLiberty/open-liberty/commit/edddfc69efe7c309f078ecc46a480ceb8dc1365e", "message": "Change URL and connectionProperties to ibm-type obscure", "committedDate": "2020-03-12T15:48:37Z", "type": "forcePushed"}, {"oid": "3506793ac2e28231e9357c4d13854cc4ee662e59", "url": "https://github.com/OpenLiberty/open-liberty/commit/3506793ac2e28231e9357c4d13854cc4ee662e59", "message": "Change URL and connectionProperties to ibm-type obscure", "committedDate": "2020-03-23T21:55:54Z", "type": "forcePushed"}, {"oid": "22986aa698048244bb4841ac14938669eec88a7e", "url": "https://github.com/OpenLiberty/open-liberty/commit/22986aa698048244bb4841ac14938669eec88a7e", "message": "Change URL and connectionProperties to ibm-type obscure", "committedDate": "2020-04-17T16:47:59Z", "type": "commit"}, {"oid": "22986aa698048244bb4841ac14938669eec88a7e", "url": "https://github.com/OpenLiberty/open-liberty/commit/22986aa698048244bb4841ac14938669eec88a7e", "message": "Change URL and connectionProperties to ibm-type obscure", "committedDate": "2020-04-17T16:47:59Z", "type": "forcePushed"}]}