{"pr_number": 10896, "pr_title": "AsyncResponseImpl.initContinuation() throws NPE when Continuation is null", "pr_createdAt": "2020-02-13T22:16:42Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10896", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1Mjc2OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10896#discussion_r379152768", "bodyText": "The message text seems a little harsh.  Maybe something like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw new IllegalArgumentException(\"All servlets and servlet filters must support async!\");\n          \n          \n            \n                        throw new IllegalArgumentException(\"Continuation not supported. Please ensure that all servlets and servlet filters must support async operations\");", "author": "andymc12", "createdAt": "2020-02-13T22:22:36Z", "path": "dev/com.ibm.ws.jaxrs.2.0.common/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java", "diffHunk": "@@ -354,7 +354,11 @@ public synchronized void handleTimeout() {\n     private void initContinuation() {\n         ContinuationProvider provider =\n             (ContinuationProvider)inMessage.get(ContinuationProvider.class.getName());\n-        cont = provider.getContinuation();\n+        if (provider != null) {\n+            cont = provider.getContinuation();\n+        } else {\n+            throw new IllegalArgumentException(\"All servlets and servlet filters must support async!\");", "originalCommit": "e60922587b5d377f75b06e5614f59519c8e75629", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca574e75b747c364332a64ae8835112312df087", "chunk": "diff --git a/dev/com.ibm.ws.jaxrs.2.0.common/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java b/dev/com.ibm.ws.jaxrs.2.0.common/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\nindex 36f43154e2..99d09b1fef 100644\n--- a/dev/com.ibm.ws.jaxrs.2.0.common/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\n+++ b/dev/com.ibm.ws.jaxrs.2.0.common/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\n\n@@ -354,11 +354,10 @@ public class AsyncResponseImpl implements AsyncResponse, ContinuationCallback {\n     private void initContinuation() {\n         ContinuationProvider provider =\n             (ContinuationProvider)inMessage.get(ContinuationProvider.class.getName());\n-        if (provider != null) {\n-            cont = provider.getContinuation();\n-        } else {\n-            throw new IllegalArgumentException(\"All servlets and servlet filters must support async!\");\n+        if (provider == null) {\n+            throw new IllegalArgumentException(\"Continuation not supported. Please ensure that all servlets and servlet filters support async operations\");\n         }\n+        cont = provider.getContinuation();\n         initialSuspend = true;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1MzM2OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10896#discussion_r379153368", "bodyText": "same as above.  Also, not a huge deal, but you can save a line of code by doing:\nif (provider == null) {\n    throw new IllegalArgumentException(\"Continuation not supported. Please ensure that all servlets and servlet filters must support async operations\");\n}\ncont = provider.getContinuation();", "author": "andymc12", "createdAt": "2020-02-13T22:24:03Z", "path": "dev/com.ibm.ws.org.apache.cxf.cxf.rt.frontend.jaxrs.3.2/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java", "diffHunk": "@@ -348,7 +348,11 @@ public synchronized void handleTimeout() {\n     private void initContinuation() {\n         ContinuationProvider provider =\n             (ContinuationProvider)inMessage.get(ContinuationProvider.class.getName());\n-        cont = provider.getContinuation();\n+        if (provider != null) {\n+            cont = provider.getContinuation();\n+        } else {\n+            throw new IllegalArgumentException(\"All servlets and servlet filters must support async!\");", "originalCommit": "e60922587b5d377f75b06e5614f59519c8e75629", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca574e75b747c364332a64ae8835112312df087", "chunk": "diff --git a/dev/com.ibm.ws.org.apache.cxf.cxf.rt.frontend.jaxrs.3.2/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java b/dev/com.ibm.ws.org.apache.cxf.cxf.rt.frontend.jaxrs.3.2/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\nindex ece6e62c8d..27310000b2 100644\n--- a/dev/com.ibm.ws.org.apache.cxf.cxf.rt.frontend.jaxrs.3.2/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\n+++ b/dev/com.ibm.ws.org.apache.cxf.cxf.rt.frontend.jaxrs.3.2/src/org/apache/cxf/jaxrs/impl/AsyncResponseImpl.java\n\n@@ -348,11 +348,10 @@ public class AsyncResponseImpl implements AsyncResponse, ContinuationCallback {\n     private void initContinuation() {\n         ContinuationProvider provider =\n             (ContinuationProvider)inMessage.get(ContinuationProvider.class.getName());\n-        if (provider != null) {\n-            cont = provider.getContinuation();\n-        } else {\n-            throw new IllegalArgumentException(\"All servlets and servlet filters must support async!\");\n+        if (provider == null) {\n+            throw new IllegalArgumentException(\"Continuation not supported. Please ensure that all servlets and servlet filters support async operations\");\n         }\n+        cont = provider.getContinuation();\n         initialSuspend = true;\n     }\n \n"}}, {"oid": "eca574e75b747c364332a64ae8835112312df087", "url": "https://github.com/OpenLiberty/open-liberty/commit/eca574e75b747c364332a64ae8835112312df087", "message": "jaxrs - throw an IllegalArgumentException in AsyncResponseImpl.initContinuation() instead of an NPE when user includes a servlet or servlet filter that does not support async", "committedDate": "2020-02-13T22:30:38Z", "type": "commit"}, {"oid": "eca574e75b747c364332a64ae8835112312df087", "url": "https://github.com/OpenLiberty/open-liberty/commit/eca574e75b747c364332a64ae8835112312df087", "message": "jaxrs - throw an IllegalArgumentException in AsyncResponseImpl.initContinuation() instead of an NPE when user includes a servlet or servlet filter that does not support async", "committedDate": "2020-02-13T22:30:38Z", "type": "forcePushed"}]}