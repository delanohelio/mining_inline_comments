{"pr_number": 12761, "pr_title": "Oracle container wait strategy", "pr_createdAt": "2020-06-23T20:38:07Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/12761", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MjcyMg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/12761#discussion_r444492722", "bodyText": "Add this waitStrategy instead of using default jdbc wait strategy.", "author": "KyleAure", "createdAt": "2020-06-23T20:38:53Z", "path": "dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package componenttest.topology.database.container;\n+\n+import java.time.Duration;\n+import static java.time.temporal.ChronoUnit.SECONDS;\n+import java.util.concurrent.Future;\n+\n+import org.testcontainers.containers.JdbcDatabaseContainer;\n+import org.testcontainers.containers.wait.strategy.Wait;\n+import org.testcontainers.utility.TestcontainersConfiguration;\n+\n+//TODO this class can be deleted once this issue is resolved in TestContainers: https://github.com/testcontainers/testcontainers-java/issues/1292\n+public class OracleContainer extends JdbcDatabaseContainer<OracleContainer> {\n+\n+    public static final String NAME = \"oracle\";\n+\n+    private static final int ORACLE_PORT = 1521;\n+    private static final int APEX_HTTP_PORT = 8080;\n+\n+    private static final int DEFAULT_STARTUP_TIMEOUT_SECONDS = 240;\n+    private static final int DEFAULT_CONNECT_TIMEOUT_SECONDS = 120;\n+\n+    private String username = \"system\";\n+    private String password = \"oracle\";\n+\n+    private static String resolveImageName() {\n+        String image = TestcontainersConfiguration.getInstance()\n+            .getProperties().getProperty(\"oracle.container.image\");\n+\n+        if (image == null) {\n+            throw new IllegalStateException(\"An image to use for Oracle containers must be configured. \" +\n+                \"To do this, please place a file on the classpath named `testcontainers.properties`, \" +\n+                \"containing `oracle.container.image=IMAGE`, where IMAGE is a suitable image name and tag.\");\n+        }\n+        return image;\n+    }\n+\n+    public OracleContainer() {\n+        this(resolveImageName());\n+    }\n+\n+    public OracleContainer(String dockerImageName) {\n+        super(dockerImageName);\n+        this.waitStrategy = Wait.forHealthcheck()", "originalCommit": "ec672966467baec3809c4b1546d2d854ac7a0bca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f227c0480412ab9a39e7657881b4784e738fe9b4", "chunk": "diff --git a/dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java b/dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java\nindex d2c65fa73d..7608e830bd 100644\n--- a/dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java\n+++ b/dev/fattest.databases/src/componenttest/topology/database/container/OracleContainer.java\n\n@@ -40,14 +40,14 @@ public class OracleContainer extends JdbcDatabaseContainer<OracleContainer> {\n \n     public OracleContainer(String dockerImageName) {\n         super(dockerImageName);\n-        this.waitStrategy = Wait.forHealthcheck()\n+        this.waitStrategy = Wait.forLogMessage(\".*DATABASE IS READY TO USE!.*\", 1)\n                 .withStartupTimeout(Duration.of(DEFAULT_STARTUP_TIMEOUT_SECONDS, SECONDS));\n         withConnectTimeoutSeconds(DEFAULT_CONNECT_TIMEOUT_SECONDS);\n     }\n \n     public OracleContainer(Future<String> dockerImageName) {\n         super(dockerImageName);\n-        this.waitStrategy = Wait.forHealthcheck()\n+        this.waitStrategy = Wait.forLogMessage(\".*DATABASE IS READY TO USE!.*\", 1)\n                 .withStartupTimeout(Duration.of(DEFAULT_STARTUP_TIMEOUT_SECONDS, SECONDS));\n         withConnectTimeoutSeconds(DEFAULT_CONNECT_TIMEOUT_SECONDS);\n         addExposedPorts(ORACLE_PORT, APEX_HTTP_PORT);\n"}}, {"oid": "f227c0480412ab9a39e7657881b4784e738fe9b4", "url": "https://github.com/OpenLiberty/open-liberty/commit/f227c0480412ab9a39e7657881b4784e738fe9b4", "message": "Oracle container wait strategy", "committedDate": "2020-06-23T21:56:46Z", "type": "commit"}, {"oid": "f227c0480412ab9a39e7657881b4784e738fe9b4", "url": "https://github.com/OpenLiberty/open-liberty/commit/f227c0480412ab9a39e7657881b4784e738fe9b4", "message": "Oracle container wait strategy", "committedDate": "2020-06-23T21:56:46Z", "type": "forcePushed"}]}