{"pr_number": 10969, "pr_title": "catch IO exception due to bundle uninstallation in generateXML", "pr_createdAt": "2020-02-19T22:14:39Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/10969", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1NzkwMQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10969#discussion_r382057901", "bodyText": "Does this method really need to be public?", "author": "pnicolucci", "createdAt": "2020-02-20T15:06:22Z", "path": "dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java", "diffHunk": "@@ -208,6 +211,10 @@ protected BundleContext getBundleContext() {\n         return FrameworkUtil.getBundle(PluginGenerator.class).getBundleContext();\n     }\n \n+    public boolean isBundleUninstalled() {\n+        return bundle.getState() == Bundle.UNINSTALLED;\n+    }\n+", "originalCommit": "92355cf740e6f739221788e230cd9796f07359ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4NzUzMA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10969#discussion_r382187530", "bodyText": "good catch, will change", "author": "volosied", "createdAt": "2020-02-20T18:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjA1NzkwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "7c20adf9d91582d4d57a580876125e811f1fae90", "chunk": "diff --git a/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java b/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\nindex ba1cc69608..b65aa9f8ab 100644\n--- a/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\n+++ b/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\n\n@@ -211,7 +211,7 @@ public class PluginGenerator {\n         return FrameworkUtil.getBundle(PluginGenerator.class).getBundleContext();\n     }\n \n-    public boolean isBundleUninstalled() {\n+    private boolean isBundleUninstalled() {\n         return bundle.getState() == Bundle.UNINSTALLED;\n     }\n \n"}}, {"oid": "7c20adf9d91582d4d57a580876125e811f1fae90", "url": "https://github.com/OpenLiberty/open-liberty/commit/7c20adf9d91582d4d57a580876125e811f1fae90", "message": "revise bundle check in plugin generation", "committedDate": "2020-02-20T19:02:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM4ODA1Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10969#discussion_r382388056", "bodyText": "We're just checking that the bundle is not uninstalled, can be correct this comment to say that? The bundle must not be uninstalled in order to write the file or something like that. If this isn't actually the case let me know and we can discuss.", "author": "pnicolucci", "createdAt": "2020-02-21T04:08:03Z", "path": "dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java", "diffHunk": "@@ -775,6 +782,7 @@ protected synchronized void generateXML(String rootLoc, String serverName,\n \n             // Only write out to file if we have new or changed configuration information, or if this is an explicit request\n             if (writeFile || !utilityRequest || !fileExists) {\n+                // Bundle must be valid in order to write the file", "originalCommit": "7c20adf9d91582d4d57a580876125e811f1fae90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5MDQ1MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/10969#discussion_r382390451", "bodyText": "I can see that this can cause some confusion. Let me update it", "author": "volosied", "createdAt": "2020-02-21T04:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM4ODA1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d720a0ba75d11719887ea7f03acea371d8c75880", "chunk": "diff --git a/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java b/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\nindex b65aa9f8ab..d17594b7ee 100644\n--- a/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\n+++ b/dev/com.ibm.ws.webcontainer/src/com/ibm/ws/webcontainer/osgi/mbeans/PluginGenerator.java\n\n@@ -782,7 +782,7 @@ public class PluginGenerator {\n \n             // Only write out to file if we have new or changed configuration information, or if this is an explicit request\n             if (writeFile || !utilityRequest || !fileExists) {\n-                // Bundle must be valid in order to write the file\n+                // The bundle must not be uninstalled in order to write the file\n                 // If writeFile is true write to the cachedFile and copy from there\n                 // If writeFile is false and the cachedFile doesn't exist write to the cache file and copy from there\n                 // If writeFile is false and cachedFile exists copy from there\n"}}, {"oid": "d720a0ba75d11719887ea7f03acea371d8c75880", "url": "https://github.com/OpenLiberty/open-liberty/commit/d720a0ba75d11719887ea7f03acea371d8c75880", "message": "revise bundle check in plugin generation", "committedDate": "2020-02-21T04:22:09Z", "type": "commit"}, {"oid": "d720a0ba75d11719887ea7f03acea371d8c75880", "url": "https://github.com/OpenLiberty/open-liberty/commit/d720a0ba75d11719887ea7f03acea371d8c75880", "message": "revise bundle check in plugin generation", "committedDate": "2020-02-21T04:22:09Z", "type": "forcePushed"}]}