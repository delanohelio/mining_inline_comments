{"pr_number": 11486, "pr_title": "Disable LTPA cookie for SPNEGO authentication", "pr_createdAt": "2020-03-26T17:24:34Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/11486", "timeline": [{"oid": "669964c1ebbc76331a5ba851f7c3ff2a7a8db91a", "url": "https://github.com/OpenLiberty/open-liberty/commit/669964c1ebbc76331a5ba851f7c3ff2a7a8db91a", "message": "disable LTPA for SPNEGO", "committedDate": "2020-03-26T18:08:23Z", "type": "forcePushed"}, {"oid": "7bbc8b890c3ecf3e6915cc6e9a69bf0508f0438a", "url": "https://github.com/OpenLiberty/open-liberty/commit/7bbc8b890c3ecf3e6915cc6e9a69bf0508f0438a", "message": "disable LTPA for SPNEGO", "committedDate": "2020-04-06T16:29:45Z", "type": "forcePushed"}, {"oid": "fe841f7d60729e68f595785fc1db4a0d3476fbe0", "url": "https://github.com/OpenLiberty/open-liberty/commit/fe841f7d60729e68f595785fc1db4a0d3476fbe0", "message": "disable LTPA for SPNEGO", "committedDate": "2020-04-06T17:55:58Z", "type": "commit"}, {"oid": "fe841f7d60729e68f595785fc1db4a0d3476fbe0", "url": "https://github.com/OpenLiberty/open-liberty/commit/fe841f7d60729e68f595785fc1db4a0d3476fbe0", "message": "disable LTPA for SPNEGO", "committedDate": "2020-04-06T17:55:58Z", "type": "forcePushed"}, {"oid": "7d5c4556d729303784ce323218ee9284c8485269", "url": "https://github.com/OpenLiberty/open-liberty/commit/7d5c4556d729303784ce323218ee9284c8485269", "message": "merged with master", "committedDate": "2020-04-06T20:50:28Z", "type": "commit"}, {"oid": "6690d0c6a4f6bb378ca9711f076a16398d5d2bbe", "url": "https://github.com/OpenLiberty/open-liberty/commit/6690d0c6a4f6bb378ca9711f076a16398d5d2bbe", "message": "update copy right and change property name", "committedDate": "2020-04-13T16:44:23Z", "type": "forcePushed"}, {"oid": "2c9b569fe8b06283833fdd2865440b9ca24e357f", "url": "https://github.com/OpenLiberty/open-liberty/commit/2c9b569fe8b06283833fdd2865440b9ca24e357f", "message": "update copy right and change property name", "committedDate": "2020-04-14T15:22:03Z", "type": "commit"}, {"oid": "2c9b569fe8b06283833fdd2865440b9ca24e357f", "url": "https://github.com/OpenLiberty/open-liberty/commit/2c9b569fe8b06283833fdd2865440b9ca24e357f", "message": "update copy right and change property name", "committedDate": "2020-04-14T15:22:03Z", "type": "forcePushed"}, {"oid": "74d2aeb9689d4e59ba0042829c1aa3991772fa23", "url": "https://github.com/OpenLiberty/open-liberty/commit/74d2aeb9689d4e59ba0042829c1aa3991772fa23", "message": "add ibm:beta", "committedDate": "2020-04-16T19:41:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjg3Mw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11486#discussion_r409836873", "bodyText": "This comment seems to be extra and it appears that it was intended for the AuthenticationConstants.java class, which has this new comment already.", "author": "teddyjtorres", "createdAt": "2020-04-16T20:44:04Z", "path": "dev/com.ibm.websphere.security/src/com/ibm/ws/security/authentication/utility/SubjectHelper.java", "diffHunk": "@@ -37,6 +37,12 @@\n public class SubjectHelper {\n     private static final TraceComponent tc = Tr.register(SubjectHelper.class);\n \n+    /**", "originalCommit": "74d2aeb9689d4e59ba0042829c1aa3991772fa23", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e8197c5b4072538fae1e142ba8819ff677ff4ca", "chunk": "diff --git a/dev/com.ibm.websphere.security/src/com/ibm/ws/security/authentication/utility/SubjectHelper.java b/dev/com.ibm.websphere.security/src/com/ibm/ws/security/authentication/utility/SubjectHelper.java\nindex 9efe6522a0..9cb167da97 100644\n--- a/dev/com.ibm.websphere.security/src/com/ibm/ws/security/authentication/utility/SubjectHelper.java\n+++ b/dev/com.ibm.websphere.security/src/com/ibm/ws/security/authentication/utility/SubjectHelper.java\n\n@@ -40,8 +40,11 @@ public class SubjectHelper {\n     /**\n      * This key maps to a boolean property in a Subject's private credentials\n      * hashtable. When the property is true, the authentication service will\n-     * not put a LTPA cookie in the response and will not use the LTPA SSO cache key to cache the subject.\n+     * not put a LTPA cookie in the response and will not use the SSO LTPA cache key to cache the subject.\n      */\n+    private static final String INTERNAL_DISABLE_SSO_LTPA_COOKIE = \"com.ibm.ws.authentication.internal.sso.disable.ltpa.cookie\";\n+\n+    private static final String[] disableSsoLtpaCookie = new String[] { INTERNAL_DISABLE_SSO_LTPA_COOKIE };\n \n     /**\n      * Check whether the subject is un-authenticated or not.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTA3NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11486#discussion_r409841075", "bodyText": "There may be a defect in this path if someone adds AuthenticationConstants.INTERNAL_DISABLE_SSO_LTPA_COOKIE with a value of false to the hashtable. The cookie should still be created in that case.", "author": "teddyjtorres", "createdAt": "2020-04-16T20:52:19Z", "path": "dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/SSOCookieHelperImpl.java", "diffHunk": "@@ -544,6 +547,27 @@ public void addSSOCookiesToResponse(Subject subject, HttpServletRequest req, Htt\n             return;\n         }\n \n+        SubjectHelper subjectHelper = new SubjectHelper();\n+\n+        if (subjectHelper.getHashtableFromSubject(subject, disableSsoLtpaCookie) == null) {", "originalCommit": "74d2aeb9689d4e59ba0042829c1aa3991772fa23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIwMTEwNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/11486#discussion_r410201104", "bodyText": "It's an internal property and default is false. I check for true any way", "author": "utle", "createdAt": "2020-04-17T12:51:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTA3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "2e8197c5b4072538fae1e142ba8819ff677ff4ca", "chunk": "diff --git a/dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/SSOCookieHelperImpl.java b/dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/SSOCookieHelperImpl.java\nindex 6786103c93..df10175fe9 100644\n--- a/dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/SSOCookieHelperImpl.java\n+++ b/dev/com.ibm.ws.webcontainer.security/src/com/ibm/ws/webcontainer/security/SSOCookieHelperImpl.java\n\n@@ -547,9 +548,7 @@ public class SSOCookieHelperImpl implements SSOCookieHelper {\n             return;\n         }\n \n-        SubjectHelper subjectHelper = new SubjectHelper();\n-\n-        if (subjectHelper.getHashtableFromSubject(subject, disableSsoLtpaCookie) == null) {\n+        if (!isDisableLtpaCookie(subject)) {\n             addLtpaSsoCookiesToResponse(subject, req, resp);\n         }\n \n"}}, {"oid": "2e8197c5b4072538fae1e142ba8819ff677ff4ca", "url": "https://github.com/OpenLiberty/open-liberty/commit/2e8197c5b4072538fae1e142ba8819ff677ff4ca", "message": "move isDisableLtpaCookie method to SubjectHelper", "committedDate": "2020-04-17T13:15:20Z", "type": "commit"}]}