{"pr_number": 15080, "pr_title": "Create generic MP Repeat Actions", "pr_createdAt": "2020-11-23T11:23:50Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/15080", "timeline": [{"oid": "e8635033583a6d192587a89426837176bf006ed1", "url": "https://github.com/OpenLiberty/open-liberty/commit/e8635033583a6d192587a89426837176bf006ed1", "message": "Remove enum", "committedDate": "2020-11-23T17:18:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg5MTU3Mw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r528891573", "bodyText": "Needs javadoc.", "author": "Azquelt", "createdAt": "2020-11-23T17:53:40Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class RepeatFeatureSet {", "originalCommit": "e8635033583a6d192587a89426837176bf006ed1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2f0d0f1e807e447e692b7118c201fe6c6f87ff8e", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java\ndeleted file mode 100644\nindex 009788a6e9..0000000000\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java\n+++ /dev/null\n\n@@ -1,59 +0,0 @@\n-/*******************************************************************************\n- * Copyright (c) 2020 IBM Corporation and others.\n- * All rights reserved. This program and the accompanying materials\n- * are made available under the terms of the Eclipse Public License v1.0\n- * which accompanies this distribution, and is available at\n- * http://www.eclipse.org/legal/epl-v10.html\n- *\n- * Contributors:\n- *     IBM Corporation - initial API and implementation\n- *******************************************************************************/\n-package componenttest.rules.repeater;\n-\n-import java.util.Collections;\n-import java.util.HashSet;\n-import java.util.Set;\n-\n-public class RepeatFeatureSet {\n-    private final String id;\n-    private final Set<String> features;\n-\n-    public RepeatFeatureSet(String id, Set<String> features) {\n-        this.id = id;\n-        this.features = Collections.unmodifiableSet(features);\n-    }\n-\n-    public String getID() {\n-        return this.id;\n-    }\n-\n-    public RepeatFeatureSet withFeature(String id, String feature) {\n-        Set<String> newFeatures = new HashSet<String>(this.features);\n-        newFeatures.add(feature);\n-        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n-        return newSet;\n-    }\n-\n-    public RepeatFeatureSet removeFeature(String id, String feature) {\n-        Set<String> newFeatures = new HashSet<String>(this.features);\n-        newFeatures.remove(feature);\n-        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n-        return newSet;\n-    }\n-\n-    public RepeatFeatureSet withFeature(String feature) {\n-        return withFeature(this.id, feature);\n-    }\n-\n-    public RepeatFeatureSet removeFeature(String feature) {\n-        return removeFeature(this.id, feature);\n-    }\n-\n-    public RepeatFeatureSet withID(String id) {\n-        return new RepeatFeatureSet(id, this.features);\n-    }\n-\n-    public Set<String> getFeatures() {\n-        return this.features;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg5NTkxNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r528895915", "bodyText": "I worry a little that this will confuse people, since it looks similar to the methods on FeatureReplacementAction but it works differently.\nI do like the ability to take an modify an existing feature set.\nI don't like that you can add features to an existing feature set without changing the ID.\nI think it would be better if the ID had to be provided in the constructor, but you could copy the feature list from another set. E.g:\nnew RepeatFeatureSet(ID).addAllFrom(MP40).remove(\"mpConfig-2.0\").add(\"mpConfig-2.0\");\n\nHowever, this wouldn't stop someone doing this and getting a featureset with the MP4.0 ID.\nMP40.add(\"someOtherFeature\");\n\nNot sure if you can prevent that without using a builder pattern.", "author": "Azquelt", "createdAt": "2020-11-23T18:00:35Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+public class RepeatFeatureSet {\n+    private final String id;\n+    private final Set<String> features;\n+\n+    public RepeatFeatureSet(String id, Set<String> features) {\n+        this.id = id;\n+        this.features = Collections.unmodifiableSet(features);\n+    }\n+\n+    public String getID() {\n+        return this.id;\n+    }\n+\n+    public RepeatFeatureSet withFeature(String id, String feature) {\n+        Set<String> newFeatures = new HashSet<String>(this.features);\n+        newFeatures.add(feature);\n+        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n+        return newSet;\n+    }\n+\n+    public RepeatFeatureSet removeFeature(String id, String feature) {\n+        Set<String> newFeatures = new HashSet<String>(this.features);\n+        newFeatures.remove(feature);\n+        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n+        return newSet;\n+    }\n+\n+    public RepeatFeatureSet withFeature(String feature) {\n+        return withFeature(this.id, feature);\n+    }\n+\n+    public RepeatFeatureSet removeFeature(String feature) {\n+        return removeFeature(this.id, feature);\n+    }\n+\n+    public RepeatFeatureSet withID(String id) {\n+        return new RepeatFeatureSet(id, this.features);\n+    }", "originalCommit": "e8635033583a6d192587a89426837176bf006ed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc4MzYzNA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r529783634", "bodyText": "went with a partial builder pattern", "author": "tevans78", "createdAt": "2020-11-24T18:16:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg5NTkxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "2f0d0f1e807e447e692b7118c201fe6c6f87ff8e", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java\ndeleted file mode 100644\nindex 009788a6e9..0000000000\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/RepeatFeatureSet.java\n+++ /dev/null\n\n@@ -1,59 +0,0 @@\n-/*******************************************************************************\n- * Copyright (c) 2020 IBM Corporation and others.\n- * All rights reserved. This program and the accompanying materials\n- * are made available under the terms of the Eclipse Public License v1.0\n- * which accompanies this distribution, and is available at\n- * http://www.eclipse.org/legal/epl-v10.html\n- *\n- * Contributors:\n- *     IBM Corporation - initial API and implementation\n- *******************************************************************************/\n-package componenttest.rules.repeater;\n-\n-import java.util.Collections;\n-import java.util.HashSet;\n-import java.util.Set;\n-\n-public class RepeatFeatureSet {\n-    private final String id;\n-    private final Set<String> features;\n-\n-    public RepeatFeatureSet(String id, Set<String> features) {\n-        this.id = id;\n-        this.features = Collections.unmodifiableSet(features);\n-    }\n-\n-    public String getID() {\n-        return this.id;\n-    }\n-\n-    public RepeatFeatureSet withFeature(String id, String feature) {\n-        Set<String> newFeatures = new HashSet<String>(this.features);\n-        newFeatures.add(feature);\n-        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n-        return newSet;\n-    }\n-\n-    public RepeatFeatureSet removeFeature(String id, String feature) {\n-        Set<String> newFeatures = new HashSet<String>(this.features);\n-        newFeatures.remove(feature);\n-        RepeatFeatureSet newSet = new RepeatFeatureSet(id, newFeatures);\n-        return newSet;\n-    }\n-\n-    public RepeatFeatureSet withFeature(String feature) {\n-        return withFeature(this.id, feature);\n-    }\n-\n-    public RepeatFeatureSet removeFeature(String feature) {\n-        return removeFeature(this.id, feature);\n-    }\n-\n-    public RepeatFeatureSet withID(String id) {\n-        return new RepeatFeatureSet(id, this.features);\n-    }\n-\n-    public Set<String> getFeatures() {\n-        return this.features;\n-    }\n-}\n"}}, {"oid": "2f0d0f1e807e447e692b7118c201fe6c6f87ff8e", "url": "https://github.com/OpenLiberty/open-liberty/commit/2f0d0f1e807e447e692b7118c201fe6c6f87ff8e", "message": "rework FeatureSets", "committedDate": "2020-11-24T18:15:20Z", "type": "forcePushed"}, {"oid": "d4b515e25aac5184668c279e248a39a53589682b", "url": "https://github.com/OpenLiberty/open-liberty/commit/d4b515e25aac5184668c279e248a39a53589682b", "message": "Create generic MP Repeat Actions", "committedDate": "2020-11-25T11:52:41Z", "type": "forcePushed"}, {"oid": "bb87a23c7969b28493d113ff2dd94280fe2a0875", "url": "https://github.com/OpenLiberty/open-liberty/commit/bb87a23c7969b28493d113ff2dd94280fe2a0875", "message": "Create generic MP Repeat Actions", "committedDate": "2020-11-25T11:53:52Z", "type": "forcePushed"}, {"oid": "5174a810e47952baf092ffc307a8216576829617", "url": "https://github.com/OpenLiberty/open-liberty/commit/5174a810e47952baf092ffc307a8216576829617", "message": "Create generic MP Repeat Actions", "committedDate": "2020-11-25T12:02:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MjM2Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r530352367", "bodyText": "Javadoc (particularly important here as the meaning of allFeatureSets and otherFeatureSetsTestMode isn't particularly intuitive)", "author": "Azquelt", "createdAt": "2020-11-25T12:54:12Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import componenttest.custom.junit.runner.Mode.TestMode;\n+\n+public class MicroProfileActions {\n+\n+    public static final String MP10_ID = \"MicroProfile_10\";\n+    public static final String MP12_ID = \"MicroProfile_12\";\n+    public static final String MP13_ID = \"MicroProfile_13\";\n+    public static final String MP14_ID = \"MicroProfile_14\";\n+    public static final String MP20_ID = \"MicroProfile_20\";\n+    public static final String MP21_ID = \"MicroProfile_21\";\n+    public static final String MP22_ID = \"MicroProfile_22\";\n+    public static final String MP30_ID = \"MicroProfile_30\";\n+    public static final String MP32_ID = \"MicroProfile_32\";\n+    public static final String MP33_ID = \"MicroProfile_33\";\n+    public static final String MP40_ID = \"MicroProfile_40\";\n+\n+    private static final String[] MP10_FEATURES_ARRAY = { \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jsonp-1.0\" };\n+\n+    private static final String[] MP12_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.1\",\n+                                                          \"mpFaultTolerance-1.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.0\",\n+                                                          \"mpMetrics-1.0\" };\n+\n+    private static final String[] MP13_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jaxrsClient-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.2\",\n+                                                          \"mpFaultTolerance-1.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.0\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.0\",\n+                                                          \"mpRestClient-1.0\" };\n+\n+    private static final String[] MP14_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jaxrsClient-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.1\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP20_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.1\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP21_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.2\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP22_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.2\" };\n+\n+    private static final String[] MP30_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-2.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.0\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.3\" };\n+\n+    private static final String[] MP32_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-2.1\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.2\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.3\" };\n+\n+    private static final String[] MP33_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.4\",\n+                                                          \"mpFaultTolerance-2.1\",\n+                                                          \"mpHealth-2.2\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.3\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.4\" };\n+\n+    private static final String[] MP40_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-2.0\",\n+                                                          \"mpFaultTolerance-3.0\",\n+                                                          \"mpHealth-3.0\",\n+                                                          \"mpJwt-1.2\",\n+                                                          \"mpMetrics-3.0\",\n+                                                          \"mpOpenAPI-2.0\",\n+                                                          \"mpOpenTracing-2.0\",\n+                                                          \"mpRestClient-2.0\" };\n+\n+    private static final Set<String> MP10_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP10_FEATURES_ARRAY)));\n+    private static final Set<String> MP12_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP12_FEATURES_ARRAY)));\n+    private static final Set<String> MP13_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP13_FEATURES_ARRAY)));\n+    private static final Set<String> MP14_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP14_FEATURES_ARRAY)));\n+    private static final Set<String> MP20_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP20_FEATURES_ARRAY)));\n+    private static final Set<String> MP21_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP21_FEATURES_ARRAY)));\n+    private static final Set<String> MP22_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP22_FEATURES_ARRAY)));\n+    private static final Set<String> MP30_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP30_FEATURES_ARRAY)));\n+    private static final Set<String> MP32_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP32_FEATURES_ARRAY)));\n+    private static final Set<String> MP33_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP33_FEATURES_ARRAY)));\n+    private static final Set<String> MP40_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP40_FEATURES_ARRAY)));\n+\n+    public static final FeatureSet MP10 = new FeatureSet(MP10_ID, MP10_FEATURE_SET);\n+    public static final FeatureSet MP12 = new FeatureSet(MP12_ID, MP12_FEATURE_SET);\n+    public static final FeatureSet MP13 = new FeatureSet(MP13_ID, MP13_FEATURE_SET);\n+    public static final FeatureSet MP14 = new FeatureSet(MP14_ID, MP14_FEATURE_SET);\n+    public static final FeatureSet MP20 = new FeatureSet(MP20_ID, MP20_FEATURE_SET);\n+    public static final FeatureSet MP21 = new FeatureSet(MP21_ID, MP21_FEATURE_SET);\n+    public static final FeatureSet MP22 = new FeatureSet(MP22_ID, MP22_FEATURE_SET);\n+    public static final FeatureSet MP30 = new FeatureSet(MP30_ID, MP30_FEATURE_SET);\n+    public static final FeatureSet MP32 = new FeatureSet(MP32_ID, MP32_FEATURE_SET);\n+    public static final FeatureSet MP33 = new FeatureSet(MP33_ID, MP33_FEATURE_SET);\n+    public static final FeatureSet MP40 = new FeatureSet(MP40_ID, MP40_FEATURE_SET);\n+\n+    public static final FeatureSet LATEST = MP40;\n+\n+    public static final FeatureSet[] ALL_SETS_ARRAY = { MP10, MP12, MP13, MP14, MP20, MP21, MP22, MP30, MP32, MP33, MP40 };\n+    public static final Set<FeatureSet> ALL = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(ALL_SETS_ARRAY)));\n+\n+    /**\n+     * Get a RepeatTests instance for the given FeatureSets. All FeatureSets will be run in LITE mode.\n+     *\n+     * @param  server           The server to repeat on\n+     * @param  firstFeatureSet  The first FeatureSet\n+     * @param  otherFeatureSets The other FeatureSets\n+     * @return                  a RepeatTests instance\n+     */\n+    public static RepeatTests repeat(String server, FeatureSet firstFeatureSet, FeatureSet... otherFeatureSets) {\n+        return repeat(server, TestMode.LITE, ALL, firstFeatureSet, otherFeatureSets);\n+    }\n+\n+    /**\n+     * @param  server\n+     * @param  otherFeatureSetsTestMode\n+     * @param  allFeatureSets\n+     * @param  firstFeatureSet\n+     * @param  otherFeatureSets\n+     * @return\n+     */\n+    public static RepeatTests repeat(String server, TestMode otherFeatureSetsTestMode, Set<FeatureSet> allFeatureSets, FeatureSet firstFeatureSet, FeatureSet... otherFeatureSets) {", "originalCommit": "5174a810e47952baf092ffc307a8216576829617", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMTg4Mg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531701882", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:04:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MjM2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\nindex 983e69da69..04f0d28326 100644\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\n+++ b/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\n\n@@ -19,18 +19,6 @@ import componenttest.custom.junit.runner.Mode.TestMode;\n \n public class MicroProfileActions {\n \n-    public static final String MP10_ID = \"MicroProfile_10\";\n-    public static final String MP12_ID = \"MicroProfile_12\";\n-    public static final String MP13_ID = \"MicroProfile_13\";\n-    public static final String MP14_ID = \"MicroProfile_14\";\n-    public static final String MP20_ID = \"MicroProfile_20\";\n-    public static final String MP21_ID = \"MicroProfile_21\";\n-    public static final String MP22_ID = \"MicroProfile_22\";\n-    public static final String MP30_ID = \"MicroProfile_30\";\n-    public static final String MP32_ID = \"MicroProfile_32\";\n-    public static final String MP33_ID = \"MicroProfile_33\";\n-    public static final String MP40_ID = \"MicroProfile_40\";\n-\n     private static final String[] MP10_FEATURES_ARRAY = { \"cdi-1.2\",\n                                                           \"jaxrs-2.0\",\n                                                           \"jsonp-1.0\" };\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MjQ4MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r530352480", "bodyText": "Javadoc", "author": "Azquelt", "createdAt": "2020-11-25T12:54:22Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java", "diffHunk": "@@ -0,0 +1,263 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import componenttest.custom.junit.runner.Mode.TestMode;\n+\n+public class MicroProfileActions {\n+\n+    public static final String MP10_ID = \"MicroProfile_10\";\n+    public static final String MP12_ID = \"MicroProfile_12\";\n+    public static final String MP13_ID = \"MicroProfile_13\";\n+    public static final String MP14_ID = \"MicroProfile_14\";\n+    public static final String MP20_ID = \"MicroProfile_20\";\n+    public static final String MP21_ID = \"MicroProfile_21\";\n+    public static final String MP22_ID = \"MicroProfile_22\";\n+    public static final String MP30_ID = \"MicroProfile_30\";\n+    public static final String MP32_ID = \"MicroProfile_32\";\n+    public static final String MP33_ID = \"MicroProfile_33\";\n+    public static final String MP40_ID = \"MicroProfile_40\";\n+\n+    private static final String[] MP10_FEATURES_ARRAY = { \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jsonp-1.0\" };\n+\n+    private static final String[] MP12_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.1\",\n+                                                          \"mpFaultTolerance-1.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.0\",\n+                                                          \"mpMetrics-1.0\" };\n+\n+    private static final String[] MP13_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jaxrsClient-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.2\",\n+                                                          \"mpFaultTolerance-1.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.0\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.0\",\n+                                                          \"mpRestClient-1.0\" };\n+\n+    private static final String[] MP14_FEATURES_ARRAY = { \"servlet-3.1\",\n+                                                          \"cdi-1.2\",\n+                                                          \"jaxrs-2.0\",\n+                                                          \"jaxrsClient-2.0\",\n+                                                          \"jsonp-1.0\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.1\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP20_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.1\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP21_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-1.1\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.2\",\n+                                                          \"mpRestClient-1.1\" };\n+\n+    private static final String[] MP22_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-1.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-1.1\",\n+                                                          \"mpOpenAPI-1.0\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.2\" };\n+\n+    private static final String[] MP30_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-2.0\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.0\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.3\" };\n+\n+    private static final String[] MP32_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.3\",\n+                                                          \"mpFaultTolerance-2.0\",\n+                                                          \"mpHealth-2.1\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.2\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.3\" };\n+\n+    private static final String[] MP33_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-1.4\",\n+                                                          \"mpFaultTolerance-2.1\",\n+                                                          \"mpHealth-2.2\",\n+                                                          \"mpJwt-1.1\",\n+                                                          \"mpMetrics-2.3\",\n+                                                          \"mpOpenAPI-1.1\",\n+                                                          \"mpOpenTracing-1.3\",\n+                                                          \"mpRestClient-1.4\" };\n+\n+    private static final String[] MP40_FEATURES_ARRAY = { \"servlet-4.0\",\n+                                                          \"cdi-2.0\",\n+                                                          \"jaxrs-2.1\",\n+                                                          \"jaxrsClient-2.1\",\n+                                                          \"jsonb-1.0\",\n+                                                          \"jsonp-1.1\",\n+                                                          \"mpConfig-2.0\",\n+                                                          \"mpFaultTolerance-3.0\",\n+                                                          \"mpHealth-3.0\",\n+                                                          \"mpJwt-1.2\",\n+                                                          \"mpMetrics-3.0\",\n+                                                          \"mpOpenAPI-2.0\",\n+                                                          \"mpOpenTracing-2.0\",\n+                                                          \"mpRestClient-2.0\" };\n+\n+    private static final Set<String> MP10_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP10_FEATURES_ARRAY)));\n+    private static final Set<String> MP12_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP12_FEATURES_ARRAY)));\n+    private static final Set<String> MP13_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP13_FEATURES_ARRAY)));\n+    private static final Set<String> MP14_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP14_FEATURES_ARRAY)));\n+    private static final Set<String> MP20_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP20_FEATURES_ARRAY)));\n+    private static final Set<String> MP21_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP21_FEATURES_ARRAY)));\n+    private static final Set<String> MP22_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP22_FEATURES_ARRAY)));\n+    private static final Set<String> MP30_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP30_FEATURES_ARRAY)));\n+    private static final Set<String> MP32_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP32_FEATURES_ARRAY)));\n+    private static final Set<String> MP33_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP33_FEATURES_ARRAY)));\n+    private static final Set<String> MP40_FEATURE_SET = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(MP40_FEATURES_ARRAY)));\n+\n+    public static final FeatureSet MP10 = new FeatureSet(MP10_ID, MP10_FEATURE_SET);\n+    public static final FeatureSet MP12 = new FeatureSet(MP12_ID, MP12_FEATURE_SET);\n+    public static final FeatureSet MP13 = new FeatureSet(MP13_ID, MP13_FEATURE_SET);\n+    public static final FeatureSet MP14 = new FeatureSet(MP14_ID, MP14_FEATURE_SET);\n+    public static final FeatureSet MP20 = new FeatureSet(MP20_ID, MP20_FEATURE_SET);\n+    public static final FeatureSet MP21 = new FeatureSet(MP21_ID, MP21_FEATURE_SET);\n+    public static final FeatureSet MP22 = new FeatureSet(MP22_ID, MP22_FEATURE_SET);\n+    public static final FeatureSet MP30 = new FeatureSet(MP30_ID, MP30_FEATURE_SET);\n+    public static final FeatureSet MP32 = new FeatureSet(MP32_ID, MP32_FEATURE_SET);\n+    public static final FeatureSet MP33 = new FeatureSet(MP33_ID, MP33_FEATURE_SET);\n+    public static final FeatureSet MP40 = new FeatureSet(MP40_ID, MP40_FEATURE_SET);\n+\n+    public static final FeatureSet LATEST = MP40;\n+\n+    public static final FeatureSet[] ALL_SETS_ARRAY = { MP10, MP12, MP13, MP14, MP20, MP21, MP22, MP30, MP32, MP33, MP40 };\n+    public static final Set<FeatureSet> ALL = Collections.unmodifiableSet(new HashSet<>(Arrays.asList(ALL_SETS_ARRAY)));\n+\n+    /**\n+     * Get a RepeatTests instance for the given FeatureSets. All FeatureSets will be run in LITE mode.\n+     *\n+     * @param  server           The server to repeat on\n+     * @param  firstFeatureSet  The first FeatureSet\n+     * @param  otherFeatureSets The other FeatureSets\n+     * @return                  a RepeatTests instance\n+     */\n+    public static RepeatTests repeat(String server, FeatureSet firstFeatureSet, FeatureSet... otherFeatureSets) {\n+        return repeat(server, TestMode.LITE, ALL, firstFeatureSet, otherFeatureSets);\n+    }\n+\n+    /**\n+     * @param  server\n+     * @param  otherFeatureSetsTestMode\n+     * @param  allFeatureSets\n+     * @param  firstFeatureSet\n+     * @param  otherFeatureSets\n+     * @return\n+     */\n+    public static RepeatTests repeat(String server, TestMode otherFeatureSetsTestMode, Set<FeatureSet> allFeatureSets, FeatureSet firstFeatureSet, FeatureSet... otherFeatureSets) {\n+        RepeatTests r = RepeatTests.with(forFeatureSet(allFeatureSets, firstFeatureSet, server, TestMode.LITE));\n+        for (int i = 0; i < otherFeatureSets.length; i++) {\n+            r = r.andWith(forFeatureSet(allFeatureSets, otherFeatureSets[i], server, otherFeatureSetsTestMode));\n+        }\n+        return r;\n+    }\n+\n+    /**\n+     * @param  allFeatureSets\n+     * @param  version\n+     * @param  server\n+     * @param  testMode\n+     * @return\n+     */\n+    public static FeatureReplacementAction forFeatureSet(Set<FeatureSet> allFeatureSets, FeatureSet version, String server, TestMode testMode) {", "originalCommit": "5174a810e47952baf092ffc307a8216576829617", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMTkyNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531701926", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:04:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1MjQ4MA=="}], "type": "inlineReview", "revised_code": {"commit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\nindex 983e69da69..04f0d28326 100644\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\n+++ b/dev/fattest.simplicity/src/componenttest/rules/repeater/MicroProfileActions.java\n\n@@ -19,18 +19,6 @@ import componenttest.custom.junit.runner.Mode.TestMode;\n \n public class MicroProfileActions {\n \n-    public static final String MP10_ID = \"MicroProfile_10\";\n-    public static final String MP12_ID = \"MicroProfile_12\";\n-    public static final String MP13_ID = \"MicroProfile_13\";\n-    public static final String MP14_ID = \"MicroProfile_14\";\n-    public static final String MP20_ID = \"MicroProfile_20\";\n-    public static final String MP21_ID = \"MicroProfile_21\";\n-    public static final String MP22_ID = \"MicroProfile_22\";\n-    public static final String MP30_ID = \"MicroProfile_30\";\n-    public static final String MP32_ID = \"MicroProfile_32\";\n-    public static final String MP33_ID = \"MicroProfile_33\";\n-    public static final String MP40_ID = \"MicroProfile_40\";\n-\n     private static final String[] MP10_FEATURES_ARRAY = { \"cdi-1.2\",\n                                                           \"jaxrs-2.0\",\n                                                           \"jsonp-1.0\" };\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM1NDAyOA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r530354028", "bodyText": "Ideally these methods would have Javadoc too, though I think the class is fairly intuitive. Otherwise I'd take the tags out completely.", "author": "Azquelt", "createdAt": "2020-11-25T12:56:55Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java", "diffHunk": "@@ -0,0 +1,122 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * An immutable set of features with an ID\n+ */\n+public class FeatureSet {\n+    private final String id;\n+    private final Set<String> features;\n+\n+    /**\n+     * Create a new FeatureSet with the given ID and set of features\n+     *\n+     * @param id       The ID of the FeatureSet. It is recommended that this should be unique.\n+     * @param features The features to include in the set\n+     */\n+    public FeatureSet(String id, Set<String> features) {\n+        this.id = id;\n+        this.features = Collections.unmodifiableSet(features);\n+    }\n+\n+    /**\n+     * Get the ID of this FeatureSet\n+     *\n+     * @return the id\n+     */\n+    public final String getID() {\n+        return this.id;\n+    }\n+\n+    /**\n+     * Get an unmodifiable set of the features\n+     *\n+     * @return the features\n+     */\n+    public final Set<String> getFeatures() {\n+        return this.features;\n+    }\n+\n+    /**\n+     * Create a new FeatureSetBuilder based on this FeatureSet\n+     *\n+     * @param  feature the feature to add to the set\n+     * @return         a FeatureSetBuilder\n+     */\n+    public FeatureSetBuilder addFeature(String feature) {\n+        FeatureSetBuilder builder = new FeatureSetBuilder(this);\n+        builder.addFeature(feature);\n+        return builder;\n+    }\n+\n+    /**\n+     * Create a new FeatureSetBuilder based on this FeatureSet\n+     *\n+     * @param  feature the feature to remove from the set\n+     * @return         a FeatureSetBuilder\n+     */\n+    public FeatureSetBuilder removeFeature(String feature) {\n+        FeatureSetBuilder builder = new FeatureSetBuilder(this);\n+        builder.removeFeature(feature);\n+        return builder;\n+    }\n+\n+    public static class FeatureSetBuilder {\n+\n+        private final HashSet<String> features;\n+\n+        /**\n+         * @param featureSet\n+         */\n+        public FeatureSetBuilder(FeatureSet featureSet) {\n+            this(featureSet.getFeatures());\n+        }\n+\n+        /**\n+         * @param features\n+         */\n+        public FeatureSetBuilder(Set<String> features) {\n+            this.features = new HashSet<>(features);\n+        }\n+\n+        /**\n+         *\n+         */\n+        public FeatureSetBuilder() {\n+            this.features = new HashSet<>();\n+        }\n+\n+        /**\n+         * @param feature\n+         */\n+        public FeatureSetBuilder addFeature(String feature) {", "originalCommit": "5174a810e47952baf092ffc307a8216576829617", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\nindex eae9bfd292..e792f6f619 100644\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\n+++ b/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\n\n@@ -24,12 +24,14 @@ public class FeatureSet {\n     /**\n      * Create a new FeatureSet with the given ID and set of features\n      *\n-     * @param id       The ID of the FeatureSet. It is recommended that this should be unique.\n+     * @param id       The ID of the FeatureSet. Must be unique.\n      * @param features The features to include in the set\n      */\n     public FeatureSet(String id, Set<String> features) {\n+        if (id == null)\n+            throw new NullPointerException();\n         this.id = id;\n-        this.features = Collections.unmodifiableSet(features);\n+        this.features = Collections.unmodifiableSet(new HashSet<>(features));\n     }\n \n     /**\n"}}, {"oid": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "url": "https://github.com/OpenLiberty/open-liberty/commit/c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "message": "Create generic MP Repeat Actions", "committedDate": "2020-11-27T15:19:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY2NjIyNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531666225", "bodyText": "We should probably document what equality means for this class if we're overriding equals and hashCode", "author": "Azquelt", "createdAt": "2020-11-27T15:37:25Z", "path": "dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 IBM Corporation and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Public License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/legal/epl-v10.html\n+ *\n+ * Contributors:\n+ *     IBM Corporation - initial API and implementation\n+ *******************************************************************************/\n+package componenttest.rules.repeater;\n+\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+/**\n+ * An immutable set of features with an ID\n+ */\n+public class FeatureSet {\n+    private final String id;\n+    private final Set<String> features;\n+\n+    /**\n+     * Create a new FeatureSet with the given ID and set of features\n+     *\n+     * @param id       The ID of the FeatureSet. Must be unique.\n+     * @param features The features to include in the set\n+     */\n+    public FeatureSet(String id, Set<String> features) {\n+        if (id == null)\n+            throw new NullPointerException();\n+        this.id = id;\n+        this.features = Collections.unmodifiableSet(new HashSet<>(features));\n+    }\n+\n+    /**\n+     * Get the ID of this FeatureSet\n+     *\n+     * @return the id\n+     */\n+    public final String getID() {\n+        return this.id;\n+    }\n+\n+    /**\n+     * Get an unmodifiable set of the features\n+     *\n+     * @return the features\n+     */\n+    public final Set<String> getFeatures() {\n+        return this.features;\n+    }\n+\n+    /**\n+     * Create a new FeatureSetBuilder based on this FeatureSet\n+     *\n+     * @param  feature the feature to add to the set\n+     * @return         a FeatureSetBuilder\n+     */\n+    public FeatureSetBuilder addFeature(String feature) {\n+        FeatureSetBuilder builder = new FeatureSetBuilder(this);\n+        builder.addFeature(feature);\n+        return builder;\n+    }\n+\n+    /**\n+     * Create a new FeatureSetBuilder based on this FeatureSet\n+     *\n+     * @param  feature the feature to remove from the set\n+     * @return         a FeatureSetBuilder\n+     */\n+    public FeatureSetBuilder removeFeature(String feature) {\n+        FeatureSetBuilder builder = new FeatureSetBuilder(this);\n+        builder.removeFeature(feature);\n+        return builder;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return id.hashCode();\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+\n+        FeatureSet other = (FeatureSet) obj;\n+\n+        if (id == null) {\n+            if (other.id != null)\n+                return false;\n+        } else if (!id.equals(other.id))\n+            return false;\n+\n+        return true;\n+    }", "originalCommit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMTk5MA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531701990", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY2NjIyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "3741cddea2b624fcddffac4334510aa9b8e897ff", "chunk": "diff --git a/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java b/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\nindex e792f6f619..54c3b718a0 100644\n--- a/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\n+++ b/dev/fattest.simplicity/src/componenttest/rules/repeater/FeatureSet.java\n\n@@ -76,11 +76,17 @@ public class FeatureSet {\n         return builder;\n     }\n \n+    /*\n+     * Since the id should be unique, we just use the hashCode of the id as the hashCode for this FeatureSet\n+     */\n     @Override\n     public int hashCode() {\n         return id.hashCode();\n     }\n \n+    /*\n+     * Since the id should be unique, equality is based on the ids being equal\n+     */\n     @Override\n     public boolean equals(Object obj) {\n         if (this == obj)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTQ3Mw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531681473", "bodyText": "The old config was equivalent to MP14, rather than MP20. Probably unimportant but was this a deliberate change?", "author": "Azquelt", "createdAt": "2020-11-27T16:11:04Z", "path": "dev/com.ibm.ws.microprofile.config.1.1_fat/fat/src/com/ibm/ws/microprofile/config/fat/tests/StressTest.java", "diffHunk": "@@ -48,7 +47,7 @@\n     public static LibertyServer server;\n \n     @ClassRule\n-    public static RepeatTests r = RepeatConfigActions.repeat(\"StressServer\", Version.CONFIG13_EE7, Version.LATEST);\n+    public static RepeatTests r = MicroProfileActions.repeat(\"StressServer\", MicroProfileActions.MP20, MicroProfileActions.LATEST);", "originalCommit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY5NjI0Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531696246", "bodyText": "This one is a mistake, will change it", "author": "tevans78", "createdAt": "2020-11-27T16:49:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMjA3MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531702071", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:05:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTQ3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "3741cddea2b624fcddffac4334510aa9b8e897ff", "chunk": "diff --git a/dev/com.ibm.ws.microprofile.config.1.1_fat/fat/src/com/ibm/ws/microprofile/config/fat/tests/StressTest.java b/dev/com.ibm.ws.microprofile.config.1.1_fat/fat/src/com/ibm/ws/microprofile/config/fat/tests/StressTest.java\nindex 5a41bf3d14..86d5d5a1fb 100644\n--- a/dev/com.ibm.ws.microprofile.config.1.1_fat/fat/src/com/ibm/ws/microprofile/config/fat/tests/StressTest.java\n+++ b/dev/com.ibm.ws.microprofile.config.1.1_fat/fat/src/com/ibm/ws/microprofile/config/fat/tests/StressTest.java\n\n@@ -47,7 +47,7 @@ public class StressTest extends FATServletClient {\n     public static LibertyServer server;\n \n     @ClassRule\n-    public static RepeatTests r = MicroProfileActions.repeat(\"StressServer\", MicroProfileActions.MP20, MicroProfileActions.LATEST);\n+    public static RepeatTests r = MicroProfileActions.repeat(\"StressServer\", MicroProfileActions.MP14, MicroProfileActions.LATEST);\n \n     @BeforeClass\n     public static void setUp() throws Exception {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTYwMg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531681602", "bodyText": "This should use the contstant.", "author": "Azquelt", "createdAt": "2020-11-27T16:11:24Z", "path": "dev/com.ibm.ws.microprofile.config.1.1_fat/test-applications/cdiConfig.jar/src/com/ibm/ws/microprofile/appConfig/cdi/web/FieldTestServlet.java", "diffHunk": "@@ -79,7 +78,7 @@ public void testDiscovered() throws Exception {\n     }\n \n     @Test\n-    @SkipForRepeat(RepeatConfig20EE8.ID) // TODO: The intended behaviour for this is not defined in the MP Config spec. It may be covered by the answer to this: https://github.com/eclipse/microprofile-config/issues/608\n+    @SkipForRepeat(\"MicroProfile_40\") // TODO: The intended behaviour for this is not defined in the MP Config spec. It may be covered by the answer to this: https://github.com/eclipse/microprofile-config/issues/608", "originalCommit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY5NjQ0MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531696441", "bodyText": "yep, ok", "author": "tevans78", "createdAt": "2020-11-27T16:50:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMjEyNg==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531702126", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MTYwMg=="}], "type": "inlineReview", "revised_code": {"commit": "3741cddea2b624fcddffac4334510aa9b8e897ff", "chunk": "diff --git a/dev/com.ibm.ws.microprofile.config.1.1_fat/test-applications/cdiConfig.jar/src/com/ibm/ws/microprofile/appConfig/cdi/web/FieldTestServlet.java b/dev/com.ibm.ws.microprofile.config.1.1_fat/test-applications/cdiConfig.jar/src/com/ibm/ws/microprofile/appConfig/cdi/web/FieldTestServlet.java\nindex 330bc8c251..9bbdc2f06d 100644\n--- a/dev/com.ibm.ws.microprofile.config.1.1_fat/test-applications/cdiConfig.jar/src/com/ibm/ws/microprofile/appConfig/cdi/web/FieldTestServlet.java\n+++ b/dev/com.ibm.ws.microprofile.config.1.1_fat/test-applications/cdiConfig.jar/src/com/ibm/ws/microprofile/appConfig/cdi/web/FieldTestServlet.java\n\n@@ -78,7 +79,7 @@ public class FieldTestServlet extends AbstractBeanServlet {\n     }\n \n     @Test\n-    @SkipForRepeat(\"MicroProfile_40\") // TODO: The intended behaviour for this is not defined in the MP Config spec. It may be covered by the answer to this: https://github.com/eclipse/microprofile-config/issues/608\n+    @SkipForRepeat(MicroProfileActions.MP40_ID) // TODO: The intended behaviour for this is not defined in the MP Config spec. It may be covered by the answer to this: https://github.com/eclipse/microprofile-config/issues/608\n     public void testNullWithDefault() throws Exception {\n         test(\"NULL_WITH_DEFAULT_KEY\", \"null\");\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MzAxMw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531683013", "bodyText": "These tests are only supposed to run against 1.x, and I think LATEST would make them run against 2.0", "author": "Azquelt", "createdAt": "2020-11-27T16:14:42Z", "path": "dev/com.ibm.ws.microprofile.config.1.4_fat/fat/src/com/ibm/ws/microprofile/config14/test/LibertySpecificConfigTests.java", "diffHunk": "@@ -51,7 +50,7 @@\n      * Test covered in io.openliberty.microprofile.config.2.0.internal_fat.\n      */\n     @ClassRule\n-    public static RepeatTests r = RepeatConfigActions.repeat(SERVER_NAME, Version.CONFIG14_EE7, Version.CONFIG14_EE8);\n+    public static RepeatTests r = MicroProfileActions.repeat(SERVER_NAME, MicroProfileActions.LATEST, MicroProfileActions.MP33);", "originalCommit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY5NzE2Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531697167", "bodyText": "yep will change", "author": "tevans78", "createdAt": "2020-11-27T16:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MzAxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMjMwNQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531702305", "bodyText": "done", "author": "tevans78", "createdAt": "2020-11-27T17:05:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4MzAxMw=="}], "type": "inlineReview", "revised_code": {"commit": "3741cddea2b624fcddffac4334510aa9b8e897ff", "chunk": "diff --git a/dev/com.ibm.ws.microprofile.config.1.4_fat/fat/src/com/ibm/ws/microprofile/config14/test/LibertySpecificConfigTests.java b/dev/com.ibm.ws.microprofile.config.1.4_fat/fat/src/com/ibm/ws/microprofile/config14/test/LibertySpecificConfigTests.java\nindex ab90e6858d..f361a68d03 100644\n--- a/dev/com.ibm.ws.microprofile.config.1.4_fat/fat/src/com/ibm/ws/microprofile/config14/test/LibertySpecificConfigTests.java\n+++ b/dev/com.ibm.ws.microprofile.config.1.4_fat/fat/src/com/ibm/ws/microprofile/config14/test/LibertySpecificConfigTests.java\n\n@@ -50,7 +50,7 @@ public class LibertySpecificConfigTests extends FATServletClient {\n      * Test covered in io.openliberty.microprofile.config.2.0.internal_fat.\n      */\n     @ClassRule\n-    public static RepeatTests r = MicroProfileActions.repeat(SERVER_NAME, MicroProfileActions.LATEST, MicroProfileActions.MP33);\n+    public static RepeatTests r = MicroProfileActions.repeat(SERVER_NAME, MicroProfileActions.MP33);\n \n     @Server(SERVER_NAME)\n     @TestServlets({\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4NTU5Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531685596", "bodyText": "I think the design of this method was to repeat for Fault Tolerance 2.0 and above, rather than MP 2.0 and above (because the FT core was rewritten for FT 2.0).\nIt should not include MP20 - the rest is correct.", "author": "Azquelt", "createdAt": "2020-11-27T16:21:14Z", "path": "dev/com.ibm.ws.microprofile.faulttolerance_repeat_tests/src/com/ibm/ws/microprofile/faulttolerance/fat/repeat/RepeatFaultTolerance.java", "diffHunk": "@@ -146,21 +79,19 @@ public static RepeatTests repeatDefault(String server) {\n      * @return the RepeatTests rule\n      */\n     public static RepeatTests repeatAll(String server) {\n-        return RepeatTests.with(mp13Features(server))\n-                        .andWith(mp20Features(server))\n-                        .andWith(ft20metrics11Features(server))\n-                        .andWith(mp30Features(server))\n-                        .andWith(mp32Features(server))\n-                        .andWith(mp33Features(server))\n-                        .andWith(mp40Features(server));\n+        return repeat(server, TestMode.LITE, MicroProfileActions.MP13, MicroProfileActions.MP20, MicroProfileActions.MP22, MicroProfileActions.MP30, MicroProfileActions.MP32,\n+                      MicroProfileActions.MP33, MicroProfileActions.MP40);\n     }\n \n+    /**\n+     * Repeat on MicroProfile 2.0 and above. MP40 will be in LITE mode, the others in FULL mode.\n+     *\n+     * @param server the server name\n+     * @return the RepeatTests rule\n+     */\n     public static RepeatTests repeat20AndAbove(String server) {\n-        return RepeatTests.with(ft20metrics11Features(server).fullFATOnly())\n-                        .andWith(mp30Features(server).fullFATOnly())\n-                        .andWith(mp32Features(server).fullFATOnly())\n-                        .andWith(mp33Features(server).fullFATOnly())\n-                        .andWith(mp40Features(server));\n+        return repeat(server, TestMode.FULL, MicroProfileActions.MP40, MicroProfileActions.MP20, MicroProfileActions.MP22, MicroProfileActions.MP30, MicroProfileActions.MP32,\n+                      MicroProfileActions.MP33);", "originalCommit": "c42f7090ba0bf664ba229b2c162df3ae75e2e6fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY5Nzc0OA==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531697748", "bodyText": "doh!", "author": "tevans78", "createdAt": "2020-11-27T16:53:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4NTU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTcwMjM2NQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15080#discussion_r531702365", "bodyText": "fixed", "author": "tevans78", "createdAt": "2020-11-27T17:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY4NTU5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "3741cddea2b624fcddffac4334510aa9b8e897ff", "chunk": "diff --git a/dev/com.ibm.ws.microprofile.faulttolerance_repeat_tests/src/com/ibm/ws/microprofile/faulttolerance/fat/repeat/RepeatFaultTolerance.java b/dev/com.ibm.ws.microprofile.faulttolerance_repeat_tests/src/com/ibm/ws/microprofile/faulttolerance/fat/repeat/RepeatFaultTolerance.java\nindex f2f53410c5..3575aff99b 100644\n--- a/dev/com.ibm.ws.microprofile.faulttolerance_repeat_tests/src/com/ibm/ws/microprofile/faulttolerance/fat/repeat/RepeatFaultTolerance.java\n+++ b/dev/com.ibm.ws.microprofile.faulttolerance_repeat_tests/src/com/ibm/ws/microprofile/faulttolerance/fat/repeat/RepeatFaultTolerance.java\n\n@@ -84,13 +84,13 @@ public class RepeatFaultTolerance {\n     }\n \n     /**\n-     * Repeat on MicroProfile 2.0 and above. MP40 will be in LITE mode, the others in FULL mode.\n+     * Repeat on FaultTolerance 2.0 and above (MP22 and above). MP40 will be in LITE mode, the others in FULL mode.\n      *\n      * @param server the server name\n      * @return the RepeatTests rule\n      */\n     public static RepeatTests repeat20AndAbove(String server) {\n-        return repeat(server, TestMode.FULL, MicroProfileActions.MP40, MicroProfileActions.MP20, MicroProfileActions.MP22, MicroProfileActions.MP30, MicroProfileActions.MP32,\n+        return repeat(server, TestMode.FULL, MicroProfileActions.MP40, MicroProfileActions.MP22, MicroProfileActions.MP30, MicroProfileActions.MP32,\n                       MicroProfileActions.MP33);\n     }\n \n"}}, {"oid": "3741cddea2b624fcddffac4334510aa9b8e897ff", "url": "https://github.com/OpenLiberty/open-liberty/commit/3741cddea2b624fcddffac4334510aa9b8e897ff", "message": "Create generic MP Repeat Actions.\nAlso reduces the MP Config RepeatTests down to just the standard MicroProfile FeatureSets.", "committedDate": "2020-11-27T17:01:48Z", "type": "forcePushed"}, {"oid": "1c8d179def45781d85f7d370d5eab407281dba55", "url": "https://github.com/OpenLiberty/open-liberty/commit/1c8d179def45781d85f7d370d5eab407281dba55", "message": "Fix FT tests to only use appSecurity-2.0 where needed", "committedDate": "2020-11-30T14:38:47Z", "type": "forcePushed"}, {"oid": "48541ee304c302a67bb89b38f78a4e170a806bad", "url": "https://github.com/OpenLiberty/open-liberty/commit/48541ee304c302a67bb89b38f78a4e170a806bad", "message": "Create generic MP Repeat Actions.\nAlso reduces the MP Config RepeatTests down to just the standard MicroProfile FeatureSets.", "committedDate": "2020-12-01T10:03:30Z", "type": "commit"}, {"oid": "a8ad4627bfe3555273bc01ed0292990c052dc465", "url": "https://github.com/OpenLiberty/open-liberty/commit/a8ad4627bfe3555273bc01ed0292990c052dc465", "message": "Fix FT tests to only use appSecurity-2.0 where needed", "committedDate": "2020-12-01T10:03:30Z", "type": "commit"}, {"oid": "c74f882606c19f2f54eb6869f08f730bf9fd1fe8", "url": "https://github.com/OpenLiberty/open-liberty/commit/c74f882606c19f2f54eb6869f08f730bf9fd1fe8", "message": "Fix some FT FAT bucket issues", "committedDate": "2020-12-01T15:17:14Z", "type": "commit"}, {"oid": "c74f882606c19f2f54eb6869f08f730bf9fd1fe8", "url": "https://github.com/OpenLiberty/open-liberty/commit/c74f882606c19f2f54eb6869f08f730bf9fd1fe8", "message": "Fix some FT FAT bucket issues", "committedDate": "2020-12-01T15:17:14Z", "type": "forcePushed"}]}