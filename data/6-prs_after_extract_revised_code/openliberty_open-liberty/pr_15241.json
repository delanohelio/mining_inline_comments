{"pr_number": 15241, "pr_title": "Restructure mpJwt FAT projects", "pr_createdAt": "2020-12-09T19:00:23Z", "pr_url": "https://github.com/OpenLiberty/open-liberty/pull/15241", "timeline": [{"oid": "79d37310410caf18104e554d215f3fba50dc1d7c", "url": "https://github.com/OpenLiberty/open-liberty/commit/79d37310410caf18104e554d215f3fba50dc1d7c", "message": "Move common mpJwt files to shared project", "committedDate": "2020-12-09T18:55:02Z", "type": "commit"}, {"oid": "20ad175cabc827e14e5ab70be7446f183285a0e0", "url": "https://github.com/OpenLiberty/open-liberty/commit/20ad175cabc827e14e5ab70be7446f183285a0e0", "message": "Update common files", "committedDate": "2020-12-09T19:10:16Z", "type": "commit"}, {"oid": "93e01f9a7c184b2d1c4c881cf95d74083423426b", "url": "https://github.com/OpenLiberty/open-liberty/commit/93e01f9a7c184b2d1c4c881cf95d74083423426b", "message": "Update FAT logging for repeat actions", "committedDate": "2020-12-09T19:11:11Z", "type": "commit"}, {"oid": "fe950e6b8a38894605714b2cd7a7091de6080ec9", "url": "https://github.com/OpenLiberty/open-liberty/commit/fe950e6b8a38894605714b2cd7a7091de6080ec9", "message": "Update mpJwt-1.1 FAT project for restructuring", "committedDate": "2020-12-09T19:16:47Z", "type": "commit"}, {"oid": "bcd5a26e044315688e27376897d0938acef7db74", "url": "https://github.com/OpenLiberty/open-liberty/commit/bcd5a26e044315688e27376897d0938acef7db74", "message": "Update mpJwt-1.2 FAT project for restructuring", "committedDate": "2020-12-09T19:19:13Z", "type": "commit"}, {"oid": "9a20a63f3cb662ebabbb4a3f0e6909a344ed7641", "url": "https://github.com/OpenLiberty/open-liberty/commit/9a20a63f3cb662ebabbb4a3f0e6909a344ed7641", "message": "Misc Updates", "committedDate": "2020-12-09T19:23:00Z", "type": "commit"}, {"oid": "298571c42c8efaadc918cec67f0eb33e62b1d9c7", "url": "https://github.com/OpenLiberty/open-liberty/commit/298571c42c8efaadc918cec67f0eb33e62b1d9c7", "message": "Merge remote-tracking branch 'origin/integration' into restructureMpJwt", "committedDate": "2020-12-09T19:26:06Z", "type": "commit"}, {"oid": "2896eed22b25bb2b4ca8e598ce34571d06335f2f", "url": "https://github.com/OpenLiberty/open-liberty/commit/2896eed22b25bb2b4ca8e598ce34571d06335f2f", "message": "Update unittests", "committedDate": "2020-12-09T23:04:04Z", "type": "commit"}, {"oid": "2896eed22b25bb2b4ca8e598ce34571d06335f2f", "url": "https://github.com/OpenLiberty/open-liberty/commit/2896eed22b25bb2b4ca8e598ce34571d06335f2f", "message": "Update unittests", "committedDate": "2020-12-09T23:04:04Z", "type": "forcePushed"}, {"oid": "0fdb91c516ba2dbc9094aaf887a204e9b47f7fa7", "url": "https://github.com/OpenLiberty/open-liberty/commit/0fdb91c516ba2dbc9094aaf887a204e9b47f7fa7", "message": "fix file sharing between mpJwt Fat projects", "committedDate": "2020-12-10T17:36:55Z", "type": "commit"}, {"oid": "52bd3640f4c1fe7626e9a94b546cac0692b83c42", "url": "https://github.com/OpenLiberty/open-liberty/commit/52bd3640f4c1fe7626e9a94b546cac0692b83c42", "message": "update jwtsso web client issue", "committedDate": "2020-12-10T18:47:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ0MzA3OQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15241#discussion_r544443079", "bodyText": "I'm guessing this still works with the // in the path?", "author": "ayoho", "createdAt": "2020-12-16T16:31:36Z", "path": "dev/com.ibm.ws.security.fat.common.mp.jwt/src/com/ibm/ws/security/fat/common/mp/jwt/utils/MPJwtAppSetupUtils.java", "diffHunk": "@@ -319,9 +239,9 @@ protected String getWarName(String baseWarName) {\n     }\n \n     public WebArchive addDefaultFileAssetsForAppsToWar(String warName, WebArchive war) throws Exception {\n-        war.add(new FileAsset(new File(\"build/classes/com/ibm/ws/security/jwt/fat/mpjwt/CommonMicroProfileApp.class\")),\n-                \"com/ibm/ws/security/jwt/fat/mpjwt/CommonMicroProfileApp.class\");\n-        war.add(new FileAsset(new File(\"build/classes/com/ibm/ws/security/jwt/fat/mpjwt/MpJwtFatConstants.class\")), \"com/ibm/ws/security/jwt/fat/mpjwt/MpJwtFatConstants.class\");\n+        war.add(new FileAsset(new File(\"lib/com/ibm/ws/security/fat/common/mp/jwt/CommonMicroProfileApp.class\")),\n+                \"com/ibm/ws/security/fat/common/mp/jwt/CommonMicroProfileApp.class\");\n+        war.add(new FileAsset(new File(\"lib/com/ibm/ws/security/fat/common/mp/jwt//MPJwtFatConstants.class\")), \"com/ibm/ws/security/fat/common/mp/jwt//MPJwtFatConstants.class\");", "originalCommit": "52bd3640f4c1fe7626e9a94b546cac0692b83c42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQxMjI1Nw==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15241#discussion_r551412257", "bodyText": "It works - but since I need to merge with Jesse's changes, I've removed the extra \"/\".", "author": "c00crane", "createdAt": "2021-01-04T16:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ0MzA3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "26939600020b9c074c52ffd392066034b8827164", "chunk": "diff --git a/dev/com.ibm.ws.security.fat.common.mp.jwt/src/com/ibm/ws/security/fat/common/mp/jwt/utils/MPJwtAppSetupUtils.java b/dev/com.ibm.ws.security.fat.common.mp.jwt/src/com/ibm/ws/security/fat/common/mp/jwt/utils/MPJwtAppSetupUtils.java\nindex 2b80726fa8..85e4d489d0 100644\n--- a/dev/com.ibm.ws.security.fat.common.mp.jwt/src/com/ibm/ws/security/fat/common/mp/jwt/utils/MPJwtAppSetupUtils.java\n+++ b/dev/com.ibm.ws.security.fat.common.mp.jwt/src/com/ibm/ws/security/fat/common/mp/jwt/utils/MPJwtAppSetupUtils.java\n\n@@ -241,7 +241,7 @@ public class MPJwtAppSetupUtils {\n     public WebArchive addDefaultFileAssetsForAppsToWar(String warName, WebArchive war) throws Exception {\n         war.add(new FileAsset(new File(\"lib/com/ibm/ws/security/fat/common/mp/jwt/CommonMicroProfileApp.class\")),\n                 \"com/ibm/ws/security/fat/common/mp/jwt/CommonMicroProfileApp.class\");\n-        war.add(new FileAsset(new File(\"lib/com/ibm/ws/security/fat/common/mp/jwt//MPJwtFatConstants.class\")), \"com/ibm/ws/security/fat/common/mp/jwt//MPJwtFatConstants.class\");\n+        war.add(new FileAsset(new File(\"lib/com/ibm/ws/security/fat/common/mp/jwt/MPJwtFatConstants.class\")), \"com/ibm/ws/security/fat/common/mp/jwt/MPJwtFatConstants.class\");\n         war.add(new FileAsset(new File(\"test-applications/\" + warName + \"/resources/WEB-INF/web.xml\")), \"/WEB-INF/web.xml\");\n         war.add(new FileAsset(new File(\"test-applications/\" + warName + \"/resources/META-INF/permissions.xml\")), \"/META-INF/permissions.xml\");\n         return war;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1ODI3Ng==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15241#discussion_r544458276", "bodyText": "Not going to try these tests with the MP JWT features anymore?", "author": "ayoho", "createdAt": "2020-12-16T16:50:53Z", "path": "dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java", "diffHunk": "@@ -64,9 +65,9 @@\n     protected static Class<?> thisClass = ConfigAttributeTests.class;\n \n     @ClassRule\n-    public static RepeatTests r = RepeatTests.with(new RunWithMpJwtVersion(JwtFatConstants.NO_MPJWT))\n-                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_11))\n-                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_12));\n+    public static RepeatTests r = RepeatTests.with(new RunWithMpJwtVersion(JwtFatConstants.NO_MPJWT));\n+//                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_11))\n+//                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_12));", "originalCommit": "52bd3640f4c1fe7626e9a94b546cac0692b83c42", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQxNTU2MQ==", "url": "https://github.com/OpenLiberty/open-liberty/pull/15241#discussion_r551415561", "bodyText": "Had commented out the extra runs while I was testing with Jesse's changes to the runner - I shouldn't have delivered that file with those updates.  I've re-enabled.", "author": "c00crane", "createdAt": "2021-01-04T16:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ1ODI3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "26939600020b9c074c52ffd392066034b8827164", "chunk": "diff --git a/dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java b/dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java\nindex 085f78a2c2..1e80256fe8 100644\n--- a/dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java\n+++ b/dev/com.ibm.ws.security.jwtsso_fat/fat/src/com/ibm/ws/security/jwtsso/fat/ConfigAttributeTests.java\n\n@@ -65,9 +65,9 @@ public class ConfigAttributeTests extends CommonSecurityFat {\n     protected static Class<?> thisClass = ConfigAttributeTests.class;\n \n     @ClassRule\n-    public static RepeatTests r = RepeatTests.with(new RunWithMpJwtVersion(JwtFatConstants.NO_MPJWT));\n-//                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_11))\n-//                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_12));\n+    public static RepeatTests r = RepeatTests.with(new RunWithMpJwtVersion(JwtFatConstants.NO_MPJWT))\n+                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_11))\n+                    .andWith(new RunWithMpJwtVersion(JwtFatConstants.MPJWT_VERSION_12));\n \n     @Server(\"com.ibm.ws.security.jwtsso.fat\")\n     public static LibertyServer server;\n"}}, {"oid": "26939600020b9c074c52ffd392066034b8827164", "url": "https://github.com/OpenLiberty/open-liberty/commit/26939600020b9c074c52ffd392066034b8827164", "message": "Review comment updates", "committedDate": "2021-01-04T16:26:26Z", "type": "commit"}, {"oid": "0d97817562843cac66df6a8779f09c89000b1729", "url": "https://github.com/OpenLiberty/open-liberty/commit/0d97817562843cac66df6a8779f09c89000b1729", "message": "Merge remote-tracking branch 'origin/integration' into restructureMpJwt", "committedDate": "2021-01-04T16:37:00Z", "type": "commit"}]}