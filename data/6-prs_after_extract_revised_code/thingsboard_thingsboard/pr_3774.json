{"pr_number": 3774, "pr_title": "count assets by tenantId improvements, added thermostat rule chain, removed \"Temperature & Humidity Demo Das...", "pr_createdAt": "2020-11-25T09:06:05Z", "pr_url": "https://github.com/thingsboard/thingsboard/pull/3774", "timeline": [{"oid": "cce09d52333f105f3002e96c475aef44c51add84", "url": "https://github.com/thingsboard/thingsboard/commit/cce09d52333f105f3002e96c475aef44c51add84", "message": "count assets by tenantId improvements", "committedDate": "2020-11-25T09:05:36Z", "type": "commit"}, {"oid": "0b82dfe155036713b35127c153478caafd44cf8c", "url": "https://github.com/thingsboard/thingsboard/commit/0b82dfe155036713b35127c153478caafd44cf8c", "message": "Merge branch 'master' of https://github.com/thingsboard/thingsboard into max-assets-improvements", "committedDate": "2020-11-25T09:44:58Z", "type": "commit"}, {"oid": "92daa8da0cafc5750b9f049c4dfaeda065e5a10f", "url": "https://github.com/thingsboard/thingsboard/commit/92daa8da0cafc5750b9f049c4dfaeda065e5a10f", "message": "added thermostat rule chain, removed \"Temperature & Humidity Demo Dashboard\" & \"Raspberry PI GPIO Demo Dashboard\"", "committedDate": "2020-11-25T09:45:39Z", "type": "commit"}, {"oid": "9a5f9af7350ad47d26b917ae50a0f82445d26501", "url": "https://github.com/thingsboard/thingsboard/commit/9a5f9af7350ad47d26b917ae50a0f82445d26501", "message": "improvements asset validation for RE statistics", "committedDate": "2020-11-25T10:18:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI2NDI2Mg==", "url": "https://github.com/thingsboard/thingsboard/pull/3774#discussion_r530264262", "bodyText": "why not RuleChain savedRuleChain = installScripts.createDefaultRuleChain(getCurrentUser().getTenantId(), request.getName()); ?", "author": "ashvayka", "createdAt": "2020-11-25T10:26:11Z", "path": "application/src/main/java/org/thingsboard/server/service/install/InstallScripts.java", "diffHunk": "@@ -212,10 +212,17 @@ public void loadDashboards(TenantId tenantId, CustomerId customerId) throws Exce\n     public void loadDemoRuleChains(TenantId tenantId) throws Exception {\n         Path ruleChainsDir = Paths.get(getDataDir(), JSON_DIR, DEMO_DIR, RULE_CHAINS_DIR);\n         try {\n+            JsonNode thermostatRuleChainJson = objectMapper.readTree(ruleChainsDir.resolve(\"thermostat_rule_chain.json\").toFile());", "originalCommit": "9a5f9af7350ad47d26b917ae50a0f82445d26501", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1c0427c5b78e8555dda10263380f92f1ff3732db", "chunk": "diff --git a/application/src/main/java/org/thingsboard/server/service/install/InstallScripts.java b/application/src/main/java/org/thingsboard/server/service/install/InstallScripts.java\nindex bd49089f40..5e6797eeb7 100644\n--- a/application/src/main/java/org/thingsboard/server/service/install/InstallScripts.java\n+++ b/application/src/main/java/org/thingsboard/server/service/install/InstallScripts.java\n\n@@ -210,23 +210,9 @@ public class InstallScripts {\n \n \n     public void loadDemoRuleChains(TenantId tenantId) throws Exception {\n-        Path ruleChainsDir = Paths.get(getDataDir(), JSON_DIR, DEMO_DIR, RULE_CHAINS_DIR);\n         try {\n-            JsonNode thermostatRuleChainJson = objectMapper.readTree(ruleChainsDir.resolve(\"thermostat_rule_chain.json\").toFile());\n-            RuleChain thermostatRuleChain = objectMapper.treeToValue(thermostatRuleChainJson.get(\"ruleChain\"), RuleChain.class);\n-            RuleChainMetaData ruleChainMetaData = objectMapper.treeToValue(thermostatRuleChainJson.get(\"metadata\"), RuleChainMetaData.class);\n-            thermostatRuleChain.setTenantId(tenantId);\n-            thermostatRuleChain = ruleChainService.saveRuleChain(thermostatRuleChain);\n-            ruleChainMetaData.setRuleChainId(thermostatRuleChain.getId());\n-            ruleChainService.saveRuleChainMetaData(new TenantId(EntityId.NULL_UUID), ruleChainMetaData);\n-\n-            JsonNode rootChainJson = objectMapper.readTree(ruleChainsDir.resolve(\"root_rule_chain.json\").toFile());\n-            RuleChain rootChain = objectMapper.treeToValue(rootChainJson.get(\"ruleChain\"), RuleChain.class);\n-            RuleChainMetaData rootChainMetaData = objectMapper.treeToValue(rootChainJson.get(\"metadata\"), RuleChainMetaData.class);\n-            rootChain.setTenantId(tenantId);\n-            rootChain = ruleChainService.saveRuleChain(rootChain);\n-            rootChainMetaData.setRuleChainId(rootChain.getId());\n-            ruleChainService.saveRuleChainMetaData(new TenantId(EntityId.NULL_UUID), rootChainMetaData);\n+            createDefaultRuleChains(tenantId);\n+            createDefaultRuleChain(tenantId, \"Thermostat\");\n         } catch (Exception e) {\n             log.error(\"Unable to load dashboard from json\", e);\n             throw new RuntimeException(\"Unable to load dashboard from json\", e);\n"}}, {"oid": "1c0427c5b78e8555dda10263380f92f1ff3732db", "url": "https://github.com/thingsboard/thingsboard/commit/1c0427c5b78e8555dda10263380f92f1ff3732db", "message": "load demo rule chains improvements", "committedDate": "2020-11-25T12:26:26Z", "type": "commit"}]}