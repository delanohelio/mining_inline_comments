{"pr_number": 3548, "pr_title": "[2.5.5] fix enqueue methods impl in DefaultTbContext", "pr_createdAt": "2020-10-06T14:11:47Z", "pr_url": "https://github.com/thingsboard/thingsboard/pull/3548", "timeline": [{"oid": "a3b005e45a01b54044a4780fa36b263712364c0e", "url": "https://github.com/thingsboard/thingsboard/commit/a3b005e45a01b54044a4780fa36b263712364c0e", "message": "added queueName to enqueueForTellNext in TbSendRPCRequestNode", "committedDate": "2020-10-06T14:11:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwNjczOQ==", "url": "https://github.com/thingsboard/thingsboard/pull/3548#discussion_r500406739", "bodyText": "This fixes usage of the API but not the problem with the API itself. Please update your fix with the following idea:\n    @Override\n    public void enqueueForTellNext(TbMsg tbMsg, String relationType) {\n        TopicPartitionInfo tpi = mainCtx.resolve(ServiceType.TB_RULE_ENGINE, tbMsg.getQueueName(), getTenantId(), tbMsg.getOriginator());\n        enqueueForTellNext(tpi, tbMsg, Collections.singleton(relationType), null, null, null);\n    }", "author": "ashvayka", "createdAt": "2020-10-06T15:47:10Z", "path": "rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/rpc/TbSendRPCRequestNode.java", "diffHunk": "@@ -113,7 +113,7 @@ public void onMsg(TbContext ctx, TbMsg msg) {\n             ctx.getRpcService().sendRpcRequestToDevice(request, ruleEngineDeviceRpcResponse -> {\n                 if (!ruleEngineDeviceRpcResponse.getError().isPresent()) {\n                     TbMsg next = ctx.newMsg(msg.getQueueName(), msg.getType(), msg.getOriginator(), msg.getMetaData(), ruleEngineDeviceRpcResponse.getResponse().orElse(\"{}\"));\n-                    ctx.enqueueForTellNext(next, TbRelationTypes.SUCCESS);\n+                    ctx.enqueueForTellNext(next, next.getQueueName(), TbRelationTypes.SUCCESS, null, null);", "originalCommit": "a3b005e45a01b54044a4780fa36b263712364c0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgzNjY3MA==", "url": "https://github.com/thingsboard/thingsboard/pull/3548#discussion_r500836670", "bodyText": "Done.", "author": "ShvaykaD", "createdAt": "2020-10-07T08:38:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwNjczOQ=="}], "type": "inlineReview", "revised_code": {"commit": "94bb9f5be3c3ca878b9ed5d6b95a7e3156c29ea0", "chunk": "diff --git a/rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/rpc/TbSendRPCRequestNode.java b/rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/rpc/TbSendRPCRequestNode.java\nindex df3ed752b3..2bd7f315fe 100644\n--- a/rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/rpc/TbSendRPCRequestNode.java\n+++ b/rule-engine/rule-engine-components/src/main/java/org/thingsboard/rule/engine/rpc/TbSendRPCRequestNode.java\n\n@@ -113,7 +113,7 @@ public class TbSendRPCRequestNode implements TbNode {\n             ctx.getRpcService().sendRpcRequestToDevice(request, ruleEngineDeviceRpcResponse -> {\n                 if (!ruleEngineDeviceRpcResponse.getError().isPresent()) {\n                     TbMsg next = ctx.newMsg(msg.getQueueName(), msg.getType(), msg.getOriginator(), msg.getMetaData(), ruleEngineDeviceRpcResponse.getResponse().orElse(\"{}\"));\n-                    ctx.enqueueForTellNext(next, next.getQueueName(), TbRelationTypes.SUCCESS, null, null);\n+                    ctx.enqueueForTellNext(next, TbRelationTypes.SUCCESS);\n                 } else {\n                     TbMsg next = ctx.newMsg(msg.getQueueName(), msg.getType(), msg.getOriginator(), msg.getMetaData(), wrap(\"error\", ruleEngineDeviceRpcResponse.getError().get().name()));\n                     ctx.tellFailure(next, new RuntimeException(ruleEngineDeviceRpcResponse.getError().get().name()));\n"}}, {"oid": "94bb9f5be3c3ca878b9ed5d6b95a7e3156c29ea0", "url": "https://github.com/thingsboard/thingsboard/commit/94bb9f5be3c3ca878b9ed5d6b95a7e3156c29ea0", "message": "update the fix in the API", "committedDate": "2020-10-06T15:59:18Z", "type": "commit"}, {"oid": "7cfa97ab5edb2f7e416b6a90c3b8221cb6011803", "url": "https://github.com/thingsboard/thingsboard/commit/7cfa97ab5edb2f7e416b6a90c3b8221cb6011803", "message": "refactoring", "committedDate": "2020-10-06T16:04:54Z", "type": "commit"}]}