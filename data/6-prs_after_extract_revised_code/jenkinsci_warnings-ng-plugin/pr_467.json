{"pr_number": 467, "pr_title": "Add integrationtest for metrics-aggregation-plugin", "pr_createdAt": "2020-05-07T20:57:41Z", "pr_url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467", "timeline": [{"oid": "9ae71ade55d746b432e8355f80372878e6ee9f39", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/9ae71ade55d746b432e8355f80372878e6ee9f39", "message": "Add integrationtest for metrics-aggregation-plugin", "committedDate": "2020-05-07T20:53:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MDkzMA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467#discussion_r425090930", "bodyText": "Build build = scheduleBuild();\nbuild.getAction(Metrics*Action.class).getResults().getMetrics().hasErrorFromWarnings();", "author": "uhafner", "createdAt": "2020-05-14T12:17:20Z", "path": "plugin/src/test/java/io/jenkins/plugins/analysis/warnings/plugins/MetricsAggregationPluginITest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+package io.jenkins.plugins.analysis.warnings.plugins;\n+\n+import org.junit.Test;\n+\n+import hudson.model.FreeStyleProject;\n+import hudson.model.Result;\n+\n+import io.jenkins.plugins.analysis.core.model.AnalysisResult;\n+import io.jenkins.plugins.analysis.core.testutil.IntegrationTestWithJenkinsPerSuite;\n+import io.jenkins.plugins.analysis.warnings.Java;\n+import io.jenkins.plugins.metrics.analysis.steps.MetricsRecorder;\n+\n+import static io.jenkins.plugins.analysis.core.assertions.Assertions.*;\n+\n+public class MetricsAggregationPluginITest extends IntegrationTestWithJenkinsPerSuite {\n+\n+    @Test\n+    public void shouldAggregateMetrics() {\n+        FreeStyleProject project = createJavaWarningsFreestyleProject(\"pmd.xml\", \"cpd.xml\", \"spotbugsXml.xml\");\n+\n+        MetricsRecorder recorder = new MetricsRecorder();\n+        recorder.setFilePattern(\"**/*.txt\");\n+\n+        project.getPublishersList().add(recorder);\n+\n+        AnalysisResult analysisResult = scheduleBuildAndAssertStatus(project, Result.SUCCESS);", "originalCommit": "9ae71ade55d746b432e8355f80372878e6ee9f39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MTYxNA==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467#discussion_r425091614", "bodyText": "Diese Action brauchen Sie dann:\nhttps://github.com/andipabst/metrics-aggregation-plugin/blob/ui-plugins/plugin/src/main/java/io/jenkins/plugins/metrics/view/MetricsViewAction.java", "author": "uhafner", "createdAt": "2020-05-14T12:18:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MDkzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MTc3Nw==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467#discussion_r430251777", "bodyText": "Soweit ich das sehe, stehen in der MetricsViewAction keine Methoden zur \u00dcberpr\u00fcfung der Results oder Metrics zur Verf\u00fcgung. Den Build habe ich folgenderma\u00dfen erstellt.\n Run<?, ?> build= buildSuccessfully(project);\n\nDie Frage ist jetzt, wie ich mit der Action fortfahren kann.\nbuild.getAction(MetricsViewAction.class).?", "author": "ThoGro", "createdAt": "2020-05-26T08:44:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MDkzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcyNzYyOQ==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467#discussion_r430727629", "bodyText": "Sie m\u00fcssen die Methode nutzen:\nhttps://github.com/andipabst/metrics-aggregation-plugin/blob/ui-plugins/plugin/src/main/java/io/jenkins/plugins/metrics/view/MetricsViewAction.java#L62", "author": "uhafner", "createdAt": "2020-05-26T21:50:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MDkzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcyODU0Mg==", "url": "https://github.com/jenkinsci/warnings-ng-plugin/pull/467#discussion_r430728542", "bodyText": "Und dann (wahrscheinlich) https://github.com/andipabst/metrics-aggregation-plugin/blob/e9fb720a061da1c06970522f91cedd98d19e413c/plugin/src/main/java/io/jenkins/plugins/metrics/view/MetricsView.java#L91\nEvtl. mal im Debugger das Objekt inspizieren...", "author": "uhafner", "createdAt": "2020-05-26T21:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA5MDkzMA=="}], "type": "inlineReview", "revised_code": {"commit": "ed2072941c5e2093ea8309cbbc753d1fe87684df", "chunk": "diff --git a/plugin/src/test/java/io/jenkins/plugins/analysis/warnings/plugins/MetricsAggregationPluginITest.java b/plugin/src/test/java/io/jenkins/plugins/analysis/warnings/plugins/MetricsAggregationPluginITest.java\nindex 14d3f93f4..ad9b8b774 100644\n--- a/plugin/src/test/java/io/jenkins/plugins/analysis/warnings/plugins/MetricsAggregationPluginITest.java\n+++ b/plugin/src/test/java/io/jenkins/plugins/analysis/warnings/plugins/MetricsAggregationPluginITest.java\n\n@@ -3,12 +3,17 @@ package io.jenkins.plugins.analysis.warnings.plugins;\n import org.junit.Test;\n \n import hudson.model.FreeStyleProject;\n-import hudson.model.Result;\n+import hudson.model.Run;\n \n-import io.jenkins.plugins.analysis.core.model.AnalysisResult;\n+import io.jenkins.plugins.analysis.core.steps.IssuesRecorder;\n import io.jenkins.plugins.analysis.core.testutil.IntegrationTestWithJenkinsPerSuite;\n+import io.jenkins.plugins.analysis.warnings.Cpd;\n import io.jenkins.plugins.analysis.warnings.Java;\n-import io.jenkins.plugins.metrics.analysis.steps.MetricsRecorder;\n+import io.jenkins.plugins.analysis.warnings.Pmd;\n+import io.jenkins.plugins.analysis.warnings.SpotBugs;\n+import io.jenkins.plugins.metrics.model.metric.MetricDefinition;\n+import io.jenkins.plugins.metrics.view.MetricsView;\n+import io.jenkins.plugins.metrics.view.MetricsViewAction;\n \n import static io.jenkins.plugins.analysis.core.assertions.Assertions.*;\n \n"}}, {"oid": "ed2072941c5e2093ea8309cbbc753d1fe87684df", "url": "https://github.com/jenkinsci/warnings-ng-plugin/commit/ed2072941c5e2093ea8309cbbc753d1fe87684df", "message": "Test Metrics Aggregation Plugin with MetricsViewAction", "committedDate": "2020-05-27T22:26:17Z", "type": "commit"}]}