{"pr_number": 2238, "pr_title": "Federated admin changes", "pr_createdAt": "2020-01-24T13:58:00Z", "pr_url": "https://github.com/gchq/Gaffer/pull/2238", "timeline": [{"oid": "f997dce61630d88a56617eceee52cc8c4bff2420", "url": "https://github.com/gchq/Gaffer/commit/f997dce61630d88a56617eceee52cc8c4bff2420", "message": "Gh 2223 federated admin override (#2231)\n\n* Typo\r\n\r\n* gh-2223 FederatedAdminIT tests\r\n\r\n* gh-2223 Admin Override for RemoveGraph and GetAllGraphIds\r\n\r\n* gh-2223 Admin override for RemoveGraph uses predicate\r\n\r\n* gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.\r\n\r\n* gh-2223 change to gaffer.store.admin.auth and renaming\r\n\r\n* gh-2223 checkstyle\r\n\r\n* gh-2223 remove graph admin param added.\r\n\r\n* gh-2223 refinements and package protected methods in FederatedGraphStorage", "committedDate": "2020-01-22T15:46:56Z", "type": "commit"}, {"oid": "1495fb380d84ef8d2ff1abf9caa7dbe0d93357be", "url": "https://github.com/gchq/Gaffer/commit/1495fb380d84ef8d2ff1abf9caa7dbe0d93357be", "message": "Gh 2225 federated get all graph info (#2232)\n\n* Typo\r\n\r\n* gh-2223 FederatedAdminIT tests\r\n\r\n* gh-2223 Admin Override for RemoveGraph and GetAllGraphIds\r\n\r\n* gh-2223 Admin override for RemoveGraph uses predicate\r\n\r\n* gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.\r\n\r\n* gh-2223 change to gaffer.store.admin.auth and renaming\r\n\r\n* gh-2225 Federated GetAllGraphInfo\r\n\r\n* gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage.\r\n\r\n* gh-2223 checkstyle\r\n\r\n* gh-2225 checkstyle\r\n\r\n* gh-2225 GetGraphInfo can be filtered by graphIds\r\n\r\n* gh-2223 remove graph admin param added.\r\n\r\n* gh-2225 getAllGraphsAndAuths isAdmin param\r\n\r\n* gh-2223 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2225 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>\r\n\r\n* gh-2225 PR changes GetGraphInfo returns FederatedAccess not string.\r\n\r\nCo-authored-by: d47853 <d47853@users.noreply.github.com>", "committedDate": "2020-01-23T10:14:27Z", "type": "commit"}, {"oid": "a5992bf4ce30562017210a21660d96171447b923", "url": "https://github.com/gchq/Gaffer/commit/a5992bf4ce30562017210a21660d96171447b923", "message": "Gh 2226 fedated change graph access (#2233)\n\n* Typo\r\n\r\n* gh-2223 FederatedAdminIT tests\r\n\r\n* gh-2223 Admin Override for RemoveGraph and GetAllGraphIds\r\n\r\n* gh-2223 Admin override for RemoveGraph uses predicate\r\n\r\n* gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.\r\n\r\n* gh-2223 change to gaffer.store.admin.auth and renaming\r\n\r\n* gh-2225 Federated GetAllGraphInfo\r\n\r\n* gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage.\r\n\r\n* gh-2223 checkstyle\r\n\r\n* gh-2225 checkstyle\r\n\r\n* gh-2225 GetGraphInfo can be filtered by graphIds\r\n\r\n* gh-2223 remove graph admin param added.\r\n\r\n* gh-2225 getAllGraphsAndAuths isAdmin param\r\n\r\n* gh-2226 Federated ChangeGraphAccess\r\n\r\n* gh-2223 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2225 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2226 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>\r\n\r\n* gh-2225 PR changes GetGraphInfo returns FederatedAccess not string.\r\n\r\n* gh-2226 comments\r\n\r\n* gh-2226 tidy up builder and PR change\r\n\r\nCo-authored-by: d47853 <d47853@users.noreply.github.com>", "committedDate": "2020-01-24T13:36:08Z", "type": "commit"}, {"oid": "f603a6fea6eabdb4209da31b790820bc68b1230d", "url": "https://github.com/gchq/Gaffer/commit/f603a6fea6eabdb4209da31b790820bc68b1230d", "message": "Gh 2227 federated remove graph add limitation for visibility (#2234)\n\n* Typo\r\n\r\n* gh-2223 FederatedAdminIT tests\r\n\r\n* gh-2223 Admin Override for RemoveGraph and GetAllGraphIds\r\n\r\n* gh-2223 Admin override for RemoveGraph uses predicate\r\n\r\n* gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.\r\n\r\n* gh-2223 change to gaffer.store.admin.auth and renaming\r\n\r\n* gh-2225 Federated GetAllGraphInfo\r\n\r\n* gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage.\r\n\r\n* gh-2223 checkstyle\r\n\r\n* gh-2225 checkstyle\r\n\r\n* gh-2225 GetGraphInfo can be filtered by graphIds\r\n\r\n* gh-2223 remove graph admin param added.\r\n\r\n* gh-2225 getAllGraphsAndAuths isAdmin param\r\n\r\n* gh-2226 Federated ChangeGraphAccess\r\n\r\n* gh-2227 Federated Remove Graph works only for AdminUsers and AddingUser not users with visibility.\r\n\r\n* gh-2223 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2225 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2226 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2227 refinements and package protected methods\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>\r\n\r\n* gh-2225 PR changes GetGraphInfo returns FederatedAccess not string.\r\n\r\n* gh-2226 comments\r\n\r\n* gh-2227 removing package private\r\n\r\n* gh-2227 removing FederatedAccess unused toString\r\n\r\nCo-authored-by: d47853 <d47853@users.noreply.github.com>", "committedDate": "2020-01-24T13:42:49Z", "type": "commit"}, {"oid": "ea4a976788e5ad3d4ca1b6e112007ad20ae87371", "url": "https://github.com/gchq/Gaffer/commit/ea4a976788e5ad3d4ca1b6e112007ad20ae87371", "message": "Gh 2225 improvements (#2235)\n\n* Typo\r\n\r\n* gh-2223 FederatedAdminIT tests\r\n\r\n* gh-2223 Admin Override for RemoveGraph and GetAllGraphIds\r\n\r\n* gh-2223 Admin override for RemoveGraph uses predicate\r\n\r\n* gh-2223 FederatedAdminIT tests for a NonAdmin user requesting admin override.\r\n\r\n* gh-2223 change to gaffer.store.admin.auth and renaming\r\n\r\n* gh-2225 Federated GetAllGraphInfo\r\n\r\n* gh-2225 FederatedGetAllGraphInfoHandler has AdminAll and User usage.\r\n\r\n* gh-2223 checkstyle\r\n\r\n* gh-2225 checkstyle\r\n\r\n* gh-2225 GetGraphInfo can be filtered by graphIds\r\n\r\n* gh-2223 remove graph admin param added.\r\n\r\n* gh-2225 getAllGraphsAndAuths isAdmin param\r\n\r\n* gh-2226 Federated ChangeGraphAccess\r\n\r\n* gh-2227 Federated Remove Graph works only for AdminUsers and AddingUser not users with visibility.\r\n\r\n* gh-2223 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2225 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2226 refinements and package protected methods in FederatedGraphStorage\r\n\r\n* gh-2227 refinements and package protected methods\r\n\r\n* Apply suggestions from code review\r\n\r\nCo-Authored-By: d47853 <d47853@users.noreply.github.com>\r\n\r\n* gh-2225 PR changes GetGraphInfo returns FederatedAccess not string.\r\n\r\n* gh-2226 comments\r\n\r\n* gh-2227 removing package private\r\n\r\n* gh-2227 removing FederatedAccess unused toString\r\n\r\n* gh-2225 improvements\r\n\r\nCo-authored-by: d47853 <d47853@users.noreply.github.com>", "committedDate": "2020-01-24T13:54:16Z", "type": "commit"}, {"oid": "37adbb6c1ea266f596cb8690234c5f8995a46f90", "url": "https://github.com/gchq/Gaffer/commit/37adbb6c1ea266f596cb8690234c5f8995a46f90", "message": "Merge remote-tracking branch 'origin/develop' into federated-admin-changes", "committedDate": "2020-01-24T13:56:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3MDIxNA==", "url": "https://github.com/gchq/Gaffer/pull/2238#discussion_r370670214", "bodyText": "Can you restore the modifiers for these?", "author": "d47853", "createdAt": "2020-01-24T14:46:16Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedAccess.java", "diffHunk": "@@ -87,7 +87,7 @@ public String getAddingUserId() {\n         return addingUserId;\n     }\n \n-    public void setAddingUserId(final String creatorUserId) {\n+    void setAddingUserId(final String creatorUserId) {", "originalCommit": "37adbb6c1ea266f596cb8690234c5f8995a46f90", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "chunk": "diff --git a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedAccess.java b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedAccess.java\nindex 76107ade16..9a6a13489a 100644\n--- a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedAccess.java\n+++ b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedAccess.java\n\n@@ -87,7 +87,7 @@ public class FederatedAccess implements Serializable {\n         return addingUserId;\n     }\n \n-    void setAddingUserId(final String creatorUserId) {\n+    public void setAddingUserId(final String creatorUserId) {\n         this.addingUserId = creatorUserId;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3MDU4NA==", "url": "https://github.com/gchq/Gaffer/pull/2238#discussion_r370670584", "bodyText": "Can you set these back to public", "author": "d47853", "createdAt": "2020-01-24T14:46:57Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java", "diffHunk": "@@ -82,7 +85,7 @@ protected void startCacheServiceLoader() throws StorageException {\n      * @throws StorageException if unable to put arguments into storage\n      * @see #put(GraphSerialisable, FederatedAccess)\n      */\n-    public void put(final Collection<GraphSerialisable> graphs, final FederatedAccess access) throws StorageException {\n+    protected void put(final Collection<GraphSerialisable> graphs, final FederatedAccess access) throws StorageException {", "originalCommit": "37adbb6c1ea266f596cb8690234c5f8995a46f90", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "chunk": "diff --git a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\nindex 2b537202a0..079c509aa9 100644\n--- a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n+++ b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/FederatedGraphStorage.java\n\n@@ -85,7 +85,7 @@ public class FederatedGraphStorage {\n      * @throws StorageException if unable to put arguments into storage\n      * @see #put(GraphSerialisable, FederatedAccess)\n      */\n-    protected void put(final Collection<GraphSerialisable> graphs, final FederatedAccess access) throws StorageException {\n+    public void put(final Collection<GraphSerialisable> graphs, final FederatedAccess access) throws StorageException {\n         for (final GraphSerialisable graph : graphs) {\n             put(graph, access);\n         }\n"}}, {"oid": "0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "url": "https://github.com/gchq/Gaffer/commit/0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "message": "PR changes", "committedDate": "2020-01-24T15:46:10Z", "type": "commit"}, {"oid": "0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "url": "https://github.com/gchq/Gaffer/commit/0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "message": "PR changes", "committedDate": "2020-01-24T15:46:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NDk4OA==", "url": "https://github.com/gchq/Gaffer/pull/2238#discussion_r371154988", "bodyText": "Do you need the other fields here?", "author": "d47853", "createdAt": "2020-01-27T10:14:12Z", "path": "store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/ChangeGraphAccess.java", "diffHunk": "@@ -0,0 +1,169 @@\n+/*\n+ * Copyright 2020 Crown Copyright\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package uk.gov.gchq.gaffer.federatedstore.operation;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonInclude.Include;\n+import com.fasterxml.jackson.annotation.JsonPropertyOrder;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.google.common.collect.Sets;\n+import org.apache.commons.lang3.exception.CloneFailedException;\n+\n+import uk.gov.gchq.gaffer.commonutil.Required;\n+import uk.gov.gchq.gaffer.federatedstore.FederatedGraphStorage;\n+import uk.gov.gchq.gaffer.operation.io.Output;\n+import uk.gov.gchq.gaffer.operation.serialisation.TypeReferenceImpl;\n+import uk.gov.gchq.koryphe.Since;\n+import uk.gov.gchq.koryphe.Summary;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import static uk.gov.gchq.gaffer.federatedstore.FederatedStoreConstants.KEY_OPERATION_OPTIONS_GRAPH_IDS;\n+\n+\n+@JsonPropertyOrder(value = {\"class\", \"graphId\"}, alphabetic = true)", "originalCommit": "0f979bb2fa81f45a4a7b2b237ca28fc03b164f92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyNjQ3Nw==", "url": "https://github.com/gchq/Gaffer/pull/2238#discussion_r371226477", "bodyText": "Not necessary as all will be displayed alphabetically, but I've added some more in.", "author": "GCHQDev404", "createdAt": "2020-01-27T13:01:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1NDk4OA=="}], "type": "inlineReview", "revised_code": {"commit": "d31f421eaa3d833d66af23e4d0b10c0988e595af", "chunk": "diff --git a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/ChangeGraphAccess.java b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/ChangeGraphAccess.java\nindex 94f6617e27..a2da7b5de3 100644\n--- a/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/ChangeGraphAccess.java\n+++ b/store-implementation/federated-store/src/main/java/uk/gov/gchq/gaffer/federatedstore/operation/ChangeGraphAccess.java\n\n@@ -38,7 +38,7 @@ import java.util.Set;\n import static uk.gov.gchq.gaffer.federatedstore.FederatedStoreConstants.KEY_OPERATION_OPTIONS_GRAPH_IDS;\n \n \n-@JsonPropertyOrder(value = {\"class\", \"graphId\"}, alphabetic = true)\n+@JsonPropertyOrder(value = {\"class\", \"graphId\", \"graphAuths\", \"isPublic\"}, alphabetic = true)\n @Since(\"1.10.6\")\n @Summary(\"Changes the protection used for accessing graphs\")\n @JsonInclude(Include.NON_DEFAULT)\n"}}, {"oid": "d31f421eaa3d833d66af23e4d0b10c0988e595af", "url": "https://github.com/gchq/Gaffer/commit/d31f421eaa3d833d66af23e4d0b10c0988e595af", "message": "Update ChangeGraphAccess.java", "committedDate": "2020-01-27T12:59:06Z", "type": "commit"}]}