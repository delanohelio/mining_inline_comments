{"pr_number": 796, "pr_title": "[vividus-plugin-db] hash method is independent of key set order", "pr_createdAt": "2020-08-03T11:46:18Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/796", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ3ODc0MA==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464478740", "bodyText": "what is root cause of the issue?", "author": "valfirst", "createdAt": "2020-08-03T15:13:26Z", "path": "vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java", "diffHunk": "@@ -418,6 +418,7 @@ private HashCode hash(Set<String> keys, Map<String, Object> map)\n                            .stream()\n                            .map(map::get)\n                            .filter(Objects::nonNull)\n+                           .sorted()", "originalCommit": "78607ad93ed7a0af6a2f41093aa4f29596aa0047", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c3c935f7d3db42fc99c772bf2ce48bcc0b97fee8", "chunk": "diff --git a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\nindex b3647c9b..6f218cc3 100644\n--- a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n+++ b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n\n@@ -418,8 +420,8 @@ public class DatabaseSteps\n                            .stream()\n                            .map(map::get)\n                            .filter(Objects::nonNull)\n-                           .sorted()\n                            .map(Object::toString)\n+                           .sorted()\n                            .collect(Collectors.joining()), StandardCharsets.UTF_8);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ3ODkxMQ==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464478911", "bodyText": "please fix checkstyle violations", "author": "valfirst", "createdAt": "2020-08-03T15:13:43Z", "path": "vividus-plugin-db/src/test/java/org/vividus/bdd/steps/db/DatabaseStepsTests.java", "diffHunk": "@@ -373,13 +373,21 @@ void shouldThrowTimeoutExceptionIfQueryTakesTooMuchTime()\n         verifyNoInteractions(attachmentPublisher, softAssert);\n     }\n \n-    @Test\n-    void shouldCompareDataVsExamplesTableAndNotPostReportIfDataEqual()\n+    static Stream<Arguments> equalDataProvider() {", "originalCommit": "78607ad93ed7a0af6a2f41093aa4f29596aa0047", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg2NjU4OA==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464866588", "bodyText": "fixed", "author": "VitaliLebedzeu", "createdAt": "2020-08-04T07:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ3ODkxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "c3c935f7d3db42fc99c772bf2ce48bcc0b97fee8", "chunk": "diff --git a/vividus-plugin-db/src/test/java/org/vividus/bdd/steps/db/DatabaseStepsTests.java b/vividus-plugin-db/src/test/java/org/vividus/bdd/steps/db/DatabaseStepsTests.java\nindex 98cb8bca..c57328be 100644\n--- a/vividus-plugin-db/src/test/java/org/vividus/bdd/steps/db/DatabaseStepsTests.java\n+++ b/vividus-plugin-db/src/test/java/org/vividus/bdd/steps/db/DatabaseStepsTests.java\n\n@@ -373,7 +373,8 @@ class DatabaseStepsTests\n         verifyNoInteractions(attachmentPublisher, softAssert);\n     }\n \n-    static Stream<Arguments> equalDataProvider() {\n+    static Stream<Arguments> equalDataProvider()\n+    {\n         return Stream.of(\n                 Arguments.of(List.of(Map.of(COL1, VAL1)), new ExamplesTable(\"|col1|\\n|val1|\")),\n                 Arguments.of(List.of(Map.of(COL1, VAL1, COL2, VAL2)), new ExamplesTable(\"|col2|col1|\\n|val2|val1|\"))\n"}}, {"oid": "c3c935f7d3db42fc99c772bf2ce48bcc0b97fee8", "url": "https://github.com/vividus-framework/vividus/commit/c3c935f7d3db42fc99c772bf2ce48bcc0b97fee8", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-04T07:50:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg2Nzg1Mw==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464867853", "bodyText": "Could you please clarify what's unordered? Columns within a row and rows within a result set?", "author": "ikalinin1", "createdAt": "2020-08-04T07:54:55Z", "path": "vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java", "diffHunk": "@@ -249,7 +249,8 @@ public void compareData(String sourceSqlQuery, String sourceDbKey, String target\n     }\n \n     /**\n-     * Step waits until data received from SQL request is equal to data from examples table for some duration.\n+     * Step waits until data received from SQL request is equal to data from examples table in any order", "originalCommit": "c3c935f7d3db42fc99c772bf2ce48bcc0b97fee8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg2ODUwNw==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464868507", "bodyText": "and please add System test", "author": "ikalinin1", "createdAt": "2020-08-04T07:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg2Nzg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkxNjgwNg==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r464916806", "bodyText": "definition was changed\nsystem test was added", "author": "VitaliLebedzeu", "createdAt": "2020-08-04T09:19:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDg2Nzg1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c67025b2e957172a56668948a9a047e52cd26b1f", "chunk": "diff --git a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\nindex 6f218cc3..5e4fa18d 100644\n--- a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n+++ b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n\n@@ -249,8 +249,8 @@ public class DatabaseSteps\n     }\n \n     /**\n-     * Step waits until data received from SQL request is equal to data from examples table in any order\n-     * for some duration (each received data element CONTAINS in examples table).\n+     * Step waits until data received from SQL request is equal to data from examples table with any order columns\n+     * within a row for some duration (each received data element CONTAINS in examples table).\n      * Actions performed in the step:\n      * <ul>\n      *     <li>executes provided SQL query against database</li>\n"}}, {"oid": "c67025b2e957172a56668948a9a047e52cd26b1f", "url": "https://github.com/vividus-framework/vividus/commit/c67025b2e957172a56668948a9a047e52cd26b1f", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-04T09:13:33Z", "type": "forcePushed"}, {"oid": "0b9110cbae17d09430151b0235082121627164f6", "url": "https://github.com/vividus-framework/vividus/commit/0b9110cbae17d09430151b0235082121627164f6", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-05T08:54:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NjkxNQ==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r465256915", "bodyText": "I think it should be rephrased to make it clear", "author": "valfirst", "createdAt": "2020-08-04T18:47:13Z", "path": "vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java", "diffHunk": "@@ -249,7 +249,8 @@ public void compareData(String sourceSqlQuery, String sourceDbKey, String target\n     }\n \n     /**\n-     * Step waits until data received from SQL request is equal to data from examples table for some duration.\n+     * Step waits until data received from SQL request is equal to data from examples table with any order columns\n+     * within a row for some duration (each received data element CONTAINS in examples table).", "originalCommit": "c67025b2e957172a56668948a9a047e52cd26b1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjAxMjk5NQ==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r472012995", "bodyText": "/**\n     * The step waits until the <code>sqlQuery</code> returns the data equal to the examples table row\n     * The order of columns is ignored\n     * Actions:\n     * <ul>\n     *     <li>run the <code>sqlQuery</code></li>\n     *     <li>compare the response with the examples table row</li>\n     *     <li>sleep for the <code>duration</code></li>\n     *     <li>repeat all of the above until there are no more retry attempts or the response is equal to the examples table row</li>\n     * </ul>\n     * @param duration The time gap between two queries\n     * @param retryTimes How many times request will be retried; duration/retryTimes=timeout between requests\n     * @param sqlQuery SQL query to execute\n     * @param dbKey Key identifying the database connection\n     * @param table Rows to compare the data against", "author": "ivan-lednev", "createdAt": "2020-08-18T08:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NjkxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjA1MzIxOA==", "url": "https://github.com/vividus-framework/vividus/pull/796#discussion_r472053218", "bodyText": "rewrite", "author": "VitaliLebedzeu", "createdAt": "2020-08-18T09:44:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI1NjkxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "31a89ceb3f7513e1cc4cf89984de28f33c56d0af", "chunk": "diff --git a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\nindex 5e4fa18d..f0394af6 100644\n--- a/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n+++ b/vividus-plugin-db/src/main/java/org/vividus/bdd/steps/db/DatabaseSteps.java\n\n@@ -249,16 +249,16 @@ public class DatabaseSteps\n     }\n \n     /**\n-     * Step waits until data received from SQL request is equal to data from examples table with any order columns\n-     * within a row for some duration (each received data element CONTAINS in examples table).\n+     * The step waits until the <code>sqlQuery</code> returns the data equal to the examples table row\n+     * The order of columns is ignored\n      * Actions performed in the step:\n      * <ul>\n-     *     <li>executes provided SQL query against database</li>\n-     *     <li>compares data received from SQL request against examples table</li>\n-     *     <li>sleeps during calculated part of specified duration</li>\n-     *     <li>repeats previous actions if data was not equal and seconds timeout not expired</li>\n+     *     <li>run the <code>sqlQuery</code></li>\n+     *     <li>compares the response with the examples table row</li>\n+     *     <li>sleep for the <code>duration</code></li>\n+     *     <li>repeat all of the above until there are no more retry attempts or the response is equal to the examples table row</li>\n      * </ul>\n-     * @param duration Time duration to wait\n+     * @param duration The time gap between two queries\n      * @param retryTimes How many times request will be retried; duration/retryTimes=timeout between requests\n      * @param sqlQuery SQL query to execute\n      * @param dbKey Key identifying the database connection\n"}}, {"oid": "31a89ceb3f7513e1cc4cf89984de28f33c56d0af", "url": "https://github.com/vividus-framework/vividus/commit/31a89ceb3f7513e1cc4cf89984de28f33c56d0af", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-18T09:43:48Z", "type": "forcePushed"}, {"oid": "2c9fadd5a0e6de030e1e59e882b0418abef8dea5", "url": "https://github.com/vividus-framework/vividus/commit/2c9fadd5a0e6de030e1e59e882b0418abef8dea5", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-18T10:13:41Z", "type": "forcePushed"}, {"oid": "7ac2c3123c3d7f76afaff31a6a6eccbd64657b64", "url": "https://github.com/vividus-framework/vividus/commit/7ac2c3123c3d7f76afaff31a6a6eccbd64657b64", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-18T12:26:11Z", "type": "commit"}, {"oid": "7ac2c3123c3d7f76afaff31a6a6eccbd64657b64", "url": "https://github.com/vividus-framework/vividus/commit/7ac2c3123c3d7f76afaff31a6a6eccbd64657b64", "message": "[vividus-plugin-db] hash method is independent of key set order", "committedDate": "2020-08-18T12:26:11Z", "type": "forcePushed"}]}