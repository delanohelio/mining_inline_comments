{"pr_number": 928, "pr_title": "Fixed 'Step to add single HTTP header to request #881'", "pr_createdAt": "2020-09-11T09:50:18Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/928", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjkzMjY1MQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r486932651", "bodyText": "duplicated code, please, avoid copy-paste-s", "author": "valfirst", "createdAt": "2020-09-11T09:54:17Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -116,6 +116,20 @@ public void setUpRequestHeaders(ExamplesTable headers)\n         httpTestContext.putRequestHeaders(requestHeaders);\n     }\n \n+    /**\n+     * Add request headers\n+     * @param headers ExamplesTable representing list of headers with columns \"name\" and \"value\" specifying HTTP header\n+     * names and values respectively\n+     */\n+    @When(\"I add request headers:$headers\")\n+    public void addRequestHeaders(ExamplesTable headers)\n+    {\n+        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n+                .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n+                .collect(toList());", "originalCommit": "060714758a74985e274c37b0b712b4f89988c11e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c9764ee6cf85f5b682a0de6eef3e382e29b72e58", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex 442dc62f..19c4a822 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -110,9 +110,7 @@ public class HttpRequestSteps\n     @When(\"I set request headers:$headers\")\n     public void setUpRequestHeaders(ExamplesTable headers)\n     {\n-        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n-                .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n-                .collect(toList());\n+        List<Header> requestHeaders = getRequestHeaders(headers);\n         httpTestContext.putRequestHeaders(requestHeaders);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk0NzYyMQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r486947621", "bodyText": "please add unit tests", "author": "valfirst", "createdAt": "2020-09-11T10:10:15Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/http/HttpTestContext.java", "diffHunk": "@@ -48,6 +48,11 @@ public void putRequestHeaders(List<Header> requestHeaders)\n         getData().requestHeaders = requestHeaders;\n     }\n \n+    public void addRequestHeaders(List<Header> requestHeaders)\n+    {\n+        getData().requestHeaders.addAll(requestHeaders);", "originalCommit": "060714758a74985e274c37b0b712b4f89988c11e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "c9764ee6cf85f5b682a0de6eef3e382e29b72e58", "url": "https://github.com/vividus-framework/vividus/commit/c9764ee6cf85f5b682a0de6eef3e382e29b72e58", "message": "Update # 928 commit", "committedDate": "2020-09-14T07:59:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzczODYwNQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r487738605", "bodyText": "it's better to keep such methods before setters", "author": "valfirst", "createdAt": "2020-09-14T08:28:17Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -255,4 +265,11 @@ public void setApiEndpoint(String apiEndpoint)\n     {\n         this.apiEndpoint = apiEndpoint;\n     }\n+\n+    private List<Header> getRequestHeaders(ExamplesTable headers)", "originalCommit": "c9764ee6cf85f5b682a0de6eef3e382e29b72e58", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex 19c4a822..245dc32b 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -265,11 +273,4 @@ public class HttpRequestSteps\n     {\n         this.apiEndpoint = apiEndpoint;\n     }\n-\n-    private List<Header> getRequestHeaders(ExamplesTable headers)\n-    {\n-        return headers.getRowsAsParameters(true).stream()\n-                .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n-                .collect(toList());\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk4ODgzMQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r487988831", "bodyText": "maybe create function like\nvoid performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer) \n\nto inline setUpRequestHeaders and addRequestHeaders methods bodies", "author": "uarlouski", "createdAt": "2020-09-14T14:44:42Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -110,12 +110,22 @@ public void putMultipartRequest(ExamplesTable requestParts)\n     @When(\"I set request headers:$headers\")\n     public void setUpRequestHeaders(ExamplesTable headers)\n     {\n-        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n-                .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n-                .collect(toList());\n+        List<Header> requestHeaders = getRequestHeaders(headers);\n         httpTestContext.putRequestHeaders(requestHeaders);\n     }\n \n+    /**\n+     * Add request headers\n+     * @param headers ExamplesTable representing list of headers with columns \"name\" and \"value\" specifying HTTP header\n+     * names and values respectively\n+     */\n+    @When(\"I add request headers:$headers\")\n+    public void addRequestHeaders(ExamplesTable headers)\n+    {\n+        List<Header> requestHeaders = getRequestHeaders(headers);\n+        httpTestContext.addRequestHeaders(requestHeaders);", "originalCommit": "eb5dd27edbfd891229bc11a8d5cb89510c764050", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex cb1f59dc..245dc32b 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -110,8 +111,7 @@ public class HttpRequestSteps\n     @When(\"I set request headers:$headers\")\n     public void setUpRequestHeaders(ExamplesTable headers)\n     {\n-        List<Header> requestHeaders = getRequestHeaders(headers);\n-        httpTestContext.putRequestHeaders(requestHeaders);\n+        performWithHeaders(headers, httpTestContext::putRequestHeaders);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0MzExNA==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r488443114", "bodyText": "Let's use the Header converter?", "author": "ikalinin1", "createdAt": "2020-09-15T07:22:31Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -110,12 +110,22 @@ public void putMultipartRequest(ExamplesTable requestParts)\n     @When(\"I set request headers:$headers\")\n     public void setUpRequestHeaders(ExamplesTable headers)\n     {\n-        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n-                .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n-                .collect(toList());\n+        List<Header> requestHeaders = getRequestHeaders(headers);\n         httpTestContext.putRequestHeaders(requestHeaders);\n     }\n \n+    /**\n+     * Add request headers\n+     * @param headers ExamplesTable representing list of headers with columns \"name\" and \"value\" specifying HTTP header\n+     * names and values respectively\n+     */\n+    @When(\"I add request headers:$headers\")\n+    public void addRequestHeaders(ExamplesTable headers)", "originalCommit": "eb5dd27edbfd891229bc11a8d5cb89510c764050", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0MzIwMA==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r488443200", "bodyText": "cc @valfirst", "author": "ikalinin1", "createdAt": "2020-09-15T07:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ0MzExNA=="}], "type": "inlineReview", "revised_code": {"commit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex cb1f59dc..245dc32b 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -110,8 +111,7 @@ public class HttpRequestSteps\n     @When(\"I set request headers:$headers\")\n     public void setUpRequestHeaders(ExamplesTable headers)\n     {\n-        List<Header> requestHeaders = getRequestHeaders(headers);\n-        httpTestContext.putRequestHeaders(requestHeaders);\n+        performWithHeaders(headers, httpTestContext::putRequestHeaders);\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MDM2MQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r490080361", "bodyText": "it can be inlined", "author": "valfirst", "createdAt": "2020-09-17T08:52:59Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -233,6 +242,19 @@ public void waitForResponseCode(int responseCode, Duration duration, int retryTi\n         );\n     }\n \n+    public void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)\n+    {\n+        List<Header> requestHeaders = getRequestHeaders(headers);\n+        headersConsumer.accept(requestHeaders);\n+    }\n+\n+    private List<Header> getRequestHeaders(ExamplesTable headers)", "originalCommit": "ab9cfcad02e63a6cfc95187beb352930c9279e54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex 284b9a28..245dc32b 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -242,19 +242,15 @@ public class HttpRequestSteps\n         );\n     }\n \n-    public void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)\n+    private void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)\n     {\n-        List<Header> requestHeaders = getRequestHeaders(headers);\n-        headersConsumer.accept(requestHeaders);\n-    }\n-\n-    private List<Header> getRequestHeaders(ExamplesTable headers)\n-    {\n-        return headers.getRowsAsParameters(true).stream()\n+        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n                 .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n                 .collect(toList());\n+        headersConsumer.accept(requestHeaders);\n     }\n \n+\n     private boolean isResponseCodeIsEqualToExpected(HttpResponse response, int expectedResponseCode)\n     {\n         return response != null && response.getStatusCode() == expectedResponseCode;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDA4MDQ2NQ==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r490080465", "bodyText": "it shouldn't be public", "author": "valfirst", "createdAt": "2020-09-17T08:53:08Z", "path": "vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java", "diffHunk": "@@ -233,6 +242,19 @@ public void waitForResponseCode(int responseCode, Duration duration, int retryTi\n         );\n     }\n \n+    public void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)", "originalCommit": "ab9cfcad02e63a6cfc95187beb352930c9279e54", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "chunk": "diff --git a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\nindex 284b9a28..245dc32b 100644\n--- a/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n+++ b/vividus-plugin-rest-api/src/main/java/org/vividus/bdd/steps/api/HttpRequestSteps.java\n\n@@ -242,19 +242,15 @@ public class HttpRequestSteps\n         );\n     }\n \n-    public void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)\n+    private void performWithHeaders(ExamplesTable headers, Consumer<List<Header>> headersConsumer)\n     {\n-        List<Header> requestHeaders = getRequestHeaders(headers);\n-        headersConsumer.accept(requestHeaders);\n-    }\n-\n-    private List<Header> getRequestHeaders(ExamplesTable headers)\n-    {\n-        return headers.getRowsAsParameters(true).stream()\n+        List<Header> requestHeaders = headers.getRowsAsParameters(true).stream()\n                 .map(row -> new BasicHeader(row.valueAs(NAME, String.class), row.valueAs(VALUE, String.class)))\n                 .collect(toList());\n+        headersConsumer.accept(requestHeaders);\n     }\n \n+\n     private boolean isResponseCodeIsEqualToExpected(HttpResponse response, int expectedResponseCode)\n     {\n         return response != null && response.getStatusCode() == expectedResponseCode;\n"}}, {"oid": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "url": "https://github.com/vividus-framework/vividus/commit/fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "message": "Update fix issue881 via comments", "committedDate": "2020-09-17T09:56:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEyNjY2Nw==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r490126667", "bodyText": "it's not related to the current PR", "author": "valfirst", "createdAt": "2020-09-17T10:06:44Z", "path": "vividus-http-client/src/main/java/org/vividus/http/exception/HttpRequestBuildException.java", "diffHunk": "@@ -16,7 +16,9 @@\n \n package org.vividus.http.exception;\n \n-public class HttpRequestBuildException extends Exception\n+import java.io.IOException;\n+\n+public class HttpRequestBuildException extends IOException", "originalCommit": "fd81207dc0f25d7a326e8cd7178b5a49179c0ce4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEyNzE1NA==", "url": "https://github.com/vividus-framework/vividus/pull/928#discussion_r490127154", "bodyText": "a lot of noisy changes coming from another PRs/commits", "author": "valfirst", "createdAt": "2020-09-17T10:07:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDEyNjY2Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "b980bddb46e6a10e09f87818d7d4f3381e0eed5e", "url": "https://github.com/vividus-framework/vividus/commit/b980bddb46e6a10e09f87818d7d4f3381e0eed5e", "message": "Fixed 'Step to add single HTTP header to request #881'", "committedDate": "2020-09-17T10:32:43Z", "type": "commit"}, {"oid": "b980bddb46e6a10e09f87818d7d4f3381e0eed5e", "url": "https://github.com/vividus-framework/vividus/commit/b980bddb46e6a10e09f87818d7d4f3381e0eed5e", "message": "Fixed 'Step to add single HTTP header to request #881'", "committedDate": "2020-09-17T10:32:43Z", "type": "forcePushed"}, {"oid": "26c4627b18f81f6ae216fd5f0c47b0b8bfe94ac8", "url": "https://github.com/vividus-framework/vividus/commit/26c4627b18f81f6ae216fd5f0c47b0b8bfe94ac8", "message": "Update fix", "committedDate": "2020-09-17T10:56:34Z", "type": "commit"}, {"oid": "0374d9c94c011036907079884fa55ac3132b312b", "url": "https://github.com/vividus-framework/vividus/commit/0374d9c94c011036907079884fa55ac3132b312b", "message": "Update fix issue881 via comments", "committedDate": "2020-09-18T15:13:03Z", "type": "commit"}]}