{"pr_number": 1267, "pr_title": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "pr_createdAt": "2020-12-23T10:09:24Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1267", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4ODY5NQ==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547888695", "bodyText": "adjustVerticalPosition", "author": "valfirst", "createdAt": "2020-12-23T10:28:56Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java", "diffHunk": "@@ -139,8 +145,34 @@ public void swipeToElement(SwipeDirection direction, Locator locator, Duration d\n             });\n         }\n \n-        baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n-                ComparisonRule.EQUAL_TO, 1);\n+        if (baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n+                ComparisonRule.EQUAL_TO, 1))\n+        {\n+            adjustElementPosition(elements.get(0), duration);\n+        }\n+    }\n+\n+    private void adjustElementPosition(WebElement element, Duration duration)", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\nindex eed77717..77a2cda4 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n\n@@ -128,17 +127,17 @@ public class TouchSteps\n      * Swipes to element in <b>direction</b> direction with duration <b>duration</b>\n      * @param direction direction to swipe, either <b>UP</b> or <b>DOWN</b>\n      * @param locator locator to find an element\n-     * @param duration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n+     * @param swipeDuration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n      */\n     @When(\"I swipe $direction to element located `$locator` with duration $swipeDuration\")\n-    public void swipeToElement(SwipeDirection direction, Locator locator, Duration duration)\n+    public void swipeToElement(SwipeDirection direction, Locator locator, Duration swipeDuration)\n     {\n         locator.getSearchParameters().setWaitForElement(false);\n \n         List<WebElement> elements = new ArrayList<>(searchActions.findElements(locator));\n         if (elements.isEmpty())\n         {\n-            touchActions.swipeUntil(direction, duration, () ->\n+            touchActions.swipeUntil(direction, swipeDuration, () ->\n             {\n                 elements.addAll(searchActions.findElements(locator));\n                 return !elements.isEmpty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4ODg3OQ==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547888879", "bodyText": "duration -> swipeDuration", "author": "valfirst", "createdAt": "2020-12-23T10:29:20Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java", "diffHunk": "@@ -139,8 +145,34 @@ public void swipeToElement(SwipeDirection direction, Locator locator, Duration d\n             });\n         }\n \n-        baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n-                ComparisonRule.EQUAL_TO, 1);\n+        if (baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n+                ComparisonRule.EQUAL_TO, 1))\n+        {\n+            adjustElementPosition(elements.get(0), duration);\n+        }\n+    }\n+\n+    private void adjustElementPosition(WebElement element, Duration duration)", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\nindex eed77717..77a2cda4 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n\n@@ -128,17 +127,17 @@ public class TouchSteps\n      * Swipes to element in <b>direction</b> direction with duration <b>duration</b>\n      * @param direction direction to swipe, either <b>UP</b> or <b>DOWN</b>\n      * @param locator locator to find an element\n-     * @param duration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n+     * @param swipeDuration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n      */\n     @When(\"I swipe $direction to element located `$locator` with duration $swipeDuration\")\n-    public void swipeToElement(SwipeDirection direction, Locator locator, Duration duration)\n+    public void swipeToElement(SwipeDirection direction, Locator locator, Duration swipeDuration)\n     {\n         locator.getSearchParameters().setWaitForElement(false);\n \n         List<WebElement> elements = new ArrayList<>(searchActions.findElements(locator));\n         if (elements.isEmpty())\n         {\n-            touchActions.swipeUntil(direction, duration, () ->\n+            touchActions.swipeUntil(direction, swipeDuration, () ->\n             {\n                 elements.addAll(searchActions.findElements(locator));\n                 return !elements.isEmpty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4OTQxMg==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547889412", "bodyText": "(windowSizeHeight - visibilityIndent) - is calculated twice", "author": "valfirst", "createdAt": "2020-12-23T10:30:48Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java", "diffHunk": "@@ -139,8 +145,34 @@ public void swipeToElement(SwipeDirection direction, Locator locator, Duration d\n             });\n         }\n \n-        baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n-                ComparisonRule.EQUAL_TO, 1);\n+        if (baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n+                ComparisonRule.EQUAL_TO, 1))\n+        {\n+            adjustElementPosition(elements.get(0), duration);\n+        }\n+    }\n+\n+    private void adjustElementPosition(WebElement element, Duration duration)\n+    {\n+        int windowSizeHeight = genericWebDriverManager.getSize().getHeight();\n+        int windowCenterY = windowSizeHeight / 2;\n+        int visibilityIndent = (int) (VISIBILITY_INDENT_COEFFICIENT * windowSizeHeight);\n+        int elementTopCoordinateY = element.getLocation().getY();\n+\n+        if (elementTopCoordinateY < visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, visibilityIndent - elementTopCoordinateY, duration);\n+        }\n+        else if (elementTopCoordinateY > windowSizeHeight - visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, Math.negateExact(elementTopCoordinateY - (windowSizeHeight - visibilityIndent)),", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\nindex eed77717..77a2cda4 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n\n@@ -128,17 +127,17 @@ public class TouchSteps\n      * Swipes to element in <b>direction</b> direction with duration <b>duration</b>\n      * @param direction direction to swipe, either <b>UP</b> or <b>DOWN</b>\n      * @param locator locator to find an element\n-     * @param duration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n+     * @param swipeDuration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n      */\n     @When(\"I swipe $direction to element located `$locator` with duration $swipeDuration\")\n-    public void swipeToElement(SwipeDirection direction, Locator locator, Duration duration)\n+    public void swipeToElement(SwipeDirection direction, Locator locator, Duration swipeDuration)\n     {\n         locator.getSearchParameters().setWaitForElement(false);\n \n         List<WebElement> elements = new ArrayList<>(searchActions.findElements(locator));\n         if (elements.isEmpty())\n         {\n-            touchActions.swipeUntil(direction, duration, () ->\n+            touchActions.swipeUntil(direction, swipeDuration, () ->\n             {\n                 elements.addAll(searchActions.findElements(locator));\n                 return !elements.isEmpty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4OTg0MA==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547889840", "bodyText": "what about moving this method to TouchActions and naming performVerticalSwipe", "author": "valfirst", "createdAt": "2020-12-23T10:31:52Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java", "diffHunk": "@@ -139,8 +145,34 @@ public void swipeToElement(SwipeDirection direction, Locator locator, Duration d\n             });\n         }\n \n-        baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n-                ComparisonRule.EQUAL_TO, 1);\n+        if (baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n+                ComparisonRule.EQUAL_TO, 1))\n+        {\n+            adjustElementPosition(elements.get(0), duration);\n+        }\n+    }\n+\n+    private void adjustElementPosition(WebElement element, Duration duration)\n+    {\n+        int windowSizeHeight = genericWebDriverManager.getSize().getHeight();\n+        int windowCenterY = windowSizeHeight / 2;\n+        int visibilityIndent = (int) (VISIBILITY_INDENT_COEFFICIENT * windowSizeHeight);\n+        int elementTopCoordinateY = element.getLocation().getY();\n+\n+        if (elementTopCoordinateY < visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, visibilityIndent - elementTopCoordinateY, duration);\n+        }\n+        else if (elementTopCoordinateY > windowSizeHeight - visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, Math.negateExact(elementTopCoordinateY - (windowSizeHeight - visibilityIndent)),\n+                    duration);\n+        }\n+    }\n+\n+    private void performSwipe(int centerY, int offset, Duration duration)", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\nindex eed77717..77a2cda4 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n\n@@ -128,17 +127,17 @@ public class TouchSteps\n      * Swipes to element in <b>direction</b> direction with duration <b>duration</b>\n      * @param direction direction to swipe, either <b>UP</b> or <b>DOWN</b>\n      * @param locator locator to find an element\n-     * @param duration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n+     * @param swipeDuration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n      */\n     @When(\"I swipe $direction to element located `$locator` with duration $swipeDuration\")\n-    public void swipeToElement(SwipeDirection direction, Locator locator, Duration duration)\n+    public void swipeToElement(SwipeDirection direction, Locator locator, Duration swipeDuration)\n     {\n         locator.getSearchParameters().setWaitForElement(false);\n \n         List<WebElement> elements = new ArrayList<>(searchActions.findElements(locator));\n         if (elements.isEmpty())\n         {\n-            touchActions.swipeUntil(direction, duration, () ->\n+            touchActions.swipeUntil(direction, swipeDuration, () ->\n             {\n                 elements.addAll(searchActions.findElements(locator));\n                 return !elements.isEmpty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg4OTk2NA==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547889964", "bodyText": "centerY -> startY ?", "author": "valfirst", "createdAt": "2020-12-23T10:32:09Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java", "diffHunk": "@@ -139,8 +145,34 @@ public void swipeToElement(SwipeDirection direction, Locator locator, Duration d\n             });\n         }\n \n-        baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n-                ComparisonRule.EQUAL_TO, 1);\n+        if (baseValidations.assertElementsNumber(String.format(\"The element by locator %s exists\", locator), elements,\n+                ComparisonRule.EQUAL_TO, 1))\n+        {\n+            adjustElementPosition(elements.get(0), duration);\n+        }\n+    }\n+\n+    private void adjustElementPosition(WebElement element, Duration duration)\n+    {\n+        int windowSizeHeight = genericWebDriverManager.getSize().getHeight();\n+        int windowCenterY = windowSizeHeight / 2;\n+        int visibilityIndent = (int) (VISIBILITY_INDENT_COEFFICIENT * windowSizeHeight);\n+        int elementTopCoordinateY = element.getLocation().getY();\n+\n+        if (elementTopCoordinateY < visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, visibilityIndent - elementTopCoordinateY, duration);\n+        }\n+        else if (elementTopCoordinateY > windowSizeHeight - visibilityIndent)\n+        {\n+            performSwipe(windowCenterY, Math.negateExact(elementTopCoordinateY - (windowSizeHeight - visibilityIndent)),\n+                    duration);\n+        }\n+    }\n+\n+    private void performSwipe(int centerY, int offset, Duration duration)", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\nindex eed77717..77a2cda4 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/steps/TouchSteps.java\n\n@@ -128,17 +127,17 @@ public class TouchSteps\n      * Swipes to element in <b>direction</b> direction with duration <b>duration</b>\n      * @param direction direction to swipe, either <b>UP</b> or <b>DOWN</b>\n      * @param locator locator to find an element\n-     * @param duration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n+     * @param swipeDuration swipe duration in <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format\n      */\n     @When(\"I swipe $direction to element located `$locator` with duration $swipeDuration\")\n-    public void swipeToElement(SwipeDirection direction, Locator locator, Duration duration)\n+    public void swipeToElement(SwipeDirection direction, Locator locator, Duration swipeDuration)\n     {\n         locator.getSearchParameters().setWaitForElement(false);\n \n         List<WebElement> elements = new ArrayList<>(searchActions.findElements(locator));\n         if (elements.isEmpty())\n         {\n-            touchActions.swipeUntil(direction, duration, () ->\n+            touchActions.swipeUntil(direction, swipeDuration, () ->\n             {\n                 elements.addAll(searchActions.findElements(locator));\n                 return !elements.isEmpty();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5MTcxMw==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547891713", "bodyText": "why is it needed?", "author": "valfirst", "createdAt": "2020-12-23T10:36:30Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/SwipeCoordinates.java", "diffHunk": "@@ -38,4 +40,25 @@ public Point getEnd()\n     {\n         return end;\n     }\n+\n+    @Override\n+    public int hashCode()\n+    {\n+        return Objects.hash(end, start);\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj)", "originalCommit": "965b9d2e009ec951cc1b7b900a4864301d9a4d3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5NjM1Nw==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547896357", "bodyText": "for unit tests :)", "author": "uarlouski", "createdAt": "2020-12-23T10:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5MTcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkwMDE2NA==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547900164", "bodyText": "The code for unit tests should live in unit tests", "author": "valfirst", "createdAt": "2020-12-23T10:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5MTcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkxNzk0NQ==", "url": "https://github.com/vividus-framework/vividus/pull/1267#discussion_r547917945", "bodyText": "removed as no more needed due api changes", "author": "uarlouski", "createdAt": "2020-12-23T11:43:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzg5MTcxMw=="}], "type": "inlineReview", "revised_code": {"commit": "2a32edc2df1aa3d2518f3422b752848f76a38578", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/SwipeCoordinates.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/SwipeCoordinates.java\nindex 31ad3e1e..0c3fba95 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/SwipeCoordinates.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/SwipeCoordinates.java\n\n@@ -40,25 +38,4 @@ public class SwipeCoordinates\n     {\n         return end;\n     }\n-\n-    @Override\n-    public int hashCode()\n-    {\n-        return Objects.hash(end, start);\n-    }\n-\n-    @Override\n-    public boolean equals(Object obj)\n-    {\n-        if (this == obj)\n-        {\n-            return true;\n-        }\n-        if (!(obj instanceof SwipeCoordinates))\n-        {\n-            return false;\n-        }\n-        SwipeCoordinates other = (SwipeCoordinates) obj;\n-        return Objects.equals(end, other.end) && Objects.equals(start, other.start);\n-    }\n }\n"}}, {"oid": "2a32edc2df1aa3d2518f3422b752848f76a38578", "url": "https://github.com/vividus-framework/vividus/commit/2a32edc2df1aa3d2518f3422b752848f76a38578", "message": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "committedDate": "2020-12-23T11:30:51Z", "type": "forcePushed"}, {"oid": "b8d486080c60d02368dfb346f6ec6119cef67860", "url": "https://github.com/vividus-framework/vividus/commit/b8d486080c60d02368dfb346f6ec6119cef67860", "message": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "committedDate": "2020-12-23T12:32:14Z", "type": "forcePushed"}, {"oid": "5797545e14b69ec4440e01dceedcdc3b33c4385d", "url": "https://github.com/vividus-framework/vividus/commit/5797545e14b69ec4440e01dceedcdc3b33c4385d", "message": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "committedDate": "2020-12-23T13:20:13Z", "type": "forcePushed"}, {"oid": "75f01d706decae2d54ee5518cade6f2f2c83bde4", "url": "https://github.com/vividus-framework/vividus/commit/75f01d706decae2d54ee5518cade6f2f2c83bde4", "message": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "committedDate": "2020-12-23T19:09:04Z", "type": "commit"}, {"oid": "75f01d706decae2d54ee5518cade6f2f2c83bde4", "url": "https://github.com/vividus-framework/vividus/commit/75f01d706decae2d54ee5518cade6f2f2c83bde4", "message": "[plugin-mobile-app] Adjust element position on screen after swipe to it", "committedDate": "2020-12-23T19:09:04Z", "type": "forcePushed"}]}