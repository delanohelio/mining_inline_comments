{"pr_number": 995, "pr_title": "[plugin-mobile-app] Add property to specify test execution on real device", "pr_createdAt": "2020-10-06T14:52:00Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/995", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM1OTAyMA==", "url": "https://github.com/vividus-framework/vividus/pull/995#discussion_r500359020", "bodyText": "move to the end of fields list", "author": "valfirst", "createdAt": "2020-10-06T14:55:19Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java", "diffHunk": "@@ -18,16 +18,32 @@\n \n import org.openqa.selenium.WebElement;\n import org.vividus.selenium.IWebDriverProvider;\n+import org.vividus.selenium.manager.GenericWebDriverManager;\n+import org.vividus.ui.action.ISearchActions;\n+import org.vividus.ui.action.search.Locator;\n+import org.vividus.ui.action.search.SearchParameters;\n+import org.vividus.ui.action.search.Visibility;\n+import org.vividus.ui.mobile.action.search.AppiumLocatorType;\n \n import io.appium.java_client.HidesKeyboard;\n \n public class KeyboardActions\n {\n+    private boolean hideKeyboardUsingNativeCall;", "originalCommit": "d21b87a8f0318ce03e48f240f6c7cdad6451d39d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96d59a96b574656438e0291b8276d8cb1d789942", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\nindex 53e5d588..1ab4271e 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n\n@@ -29,17 +29,17 @@ import io.appium.java_client.HidesKeyboard;\n \n public class KeyboardActions\n {\n-    private boolean hideKeyboardUsingNativeCall;\n     private final TouchActions touchActions;\n     private final IWebDriverProvider webDriverProvider;\n     private final GenericWebDriverManager genericWebDriverManager;\n     private final ISearchActions searchActions;\n+    private final boolean realDevice;\n \n-    public KeyboardActions(boolean hideKeyboardUsingNativeCall, TouchActions touchActions,\n+    public KeyboardActions(boolean realDevice, TouchActions touchActions,\n             IWebDriverProvider webDriverProvider, GenericWebDriverManager genericWebDriverManager,\n             ISearchActions searchActions)\n     {\n-        this.hideKeyboardUsingNativeCall = hideKeyboardUsingNativeCall;\n+        this.realDevice = realDevice;\n         this.touchActions = touchActions;\n         this.webDriverProvider = webDriverProvider;\n         this.genericWebDriverManager = genericWebDriverManager;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDM2MDc0Nw==", "url": "https://github.com/vividus-framework/vividus/pull/995#discussion_r500360747", "bodyText": "java.util.Optional#ifPresentOrElse ?", "author": "valfirst", "createdAt": "2020-10-06T14:57:03Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java", "diffHunk": "@@ -44,6 +60,16 @@ public KeyboardActions(IWebDriverProvider webDriverProvider)\n     public void typeText(WebElement element, String text)\n     {\n         element.sendKeys(text);\n+        // https://github.com/appium/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBCustomCommands.m#L107\n+        if (genericWebDriverManager.isIOSNativeApp() && !hideKeyboardUsingNativeCall)\n+        {\n+            Locator keyboardReturnLocator = new Locator(AppiumLocatorType.XPATH, new SearchParameters(\n+                    \"//XCUIElementTypeKeyboard//XCUIElementTypeButton[@name='Return']\", Visibility.VISIBLE, false));\n+            WebElement returnButton = searchActions.findElement(keyboardReturnLocator).orElseThrow(", "originalCommit": "d21b87a8f0318ce03e48f240f6c7cdad6451d39d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96d59a96b574656438e0291b8276d8cb1d789942", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\nindex 53e5d588..1ab4271e 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n\n@@ -61,13 +61,14 @@ public class KeyboardActions\n     {\n         element.sendKeys(text);\n         // https://github.com/appium/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBCustomCommands.m#L107\n-        if (genericWebDriverManager.isIOSNativeApp() && !hideKeyboardUsingNativeCall)\n+        if (genericWebDriverManager.isIOSNativeApp() && realDevice)\n         {\n             Locator keyboardReturnLocator = new Locator(AppiumLocatorType.XPATH, new SearchParameters(\n                     \"//XCUIElementTypeKeyboard//XCUIElementTypeButton[@name='Return']\", Visibility.VISIBLE, false));\n-            WebElement returnButton = searchActions.findElement(keyboardReturnLocator).orElseThrow(\n-                () -> new IllegalStateException(\"Unable to find 'Return' button to close the keyboard\"));\n-            touchActions.tap(returnButton);\n+            searchActions.findElement(keyboardReturnLocator).ifPresentOrElse(touchActions::tap, () ->\n+            {\n+                throw new IllegalStateException(\"Unable to find 'Return' button to close the keyboard\");\n+            });\n             return;\n         }\n         webDriverProvider.getUnwrapped(HidesKeyboard.class).hideKeyboard();\n"}}, {"oid": "96d59a96b574656438e0291b8276d8cb1d789942", "url": "https://github.com/vividus-framework/vividus/commit/96d59a96b574656438e0291b8276d8cb1d789942", "message": "[plugin-mobile-app] Add property to aviod keyboard dismiss native call on iOS RD", "committedDate": "2020-10-06T15:34:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyMTMwMw==", "url": "https://github.com/vividus-framework/vividus/pull/995#discussion_r500421303", "bodyText": "if (genericWebDriverManager.isIOSNativeApp() && realDevice)\n{\n...\nreturn;\n}\nelse\n{\nwebDriverProvider.getUnwrapped(HidesKeyboard.class).hideKeyboard();\n}", "author": "valfirst", "createdAt": "2020-10-06T16:07:18Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java", "diffHunk": "@@ -44,6 +60,17 @@ public KeyboardActions(IWebDriverProvider webDriverProvider)\n     public void typeText(WebElement element, String text)\n     {\n         element.sendKeys(text);\n+        // https://github.com/appium/WebDriverAgent/blob/master/WebDriverAgentLib/Commands/FBCustomCommands.m#L107\n+        if (genericWebDriverManager.isIOSNativeApp() && realDevice)\n+        {\n+            Locator keyboardReturnLocator = new Locator(AppiumLocatorType.XPATH, new SearchParameters(\n+                    \"//XCUIElementTypeKeyboard//XCUIElementTypeButton[@name='Return']\", Visibility.VISIBLE, false));\n+            searchActions.findElement(keyboardReturnLocator).ifPresentOrElse(touchActions::tap, () ->\n+            {\n+                throw new IllegalStateException(\"Unable to find 'Return' button to close the keyboard\");\n+            });\n+            return;\n+        }\n         webDriverProvider.getUnwrapped(HidesKeyboard.class).hideKeyboard();", "originalCommit": "96d59a96b574656438e0291b8276d8cb1d789942", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyNTQ0Nw==", "url": "https://github.com/vividus-framework/vividus/pull/995#discussion_r500425447", "bodyText": "Fixed, but why not to reduce number of lines by using return?", "author": "uarlouski", "createdAt": "2020-10-06T16:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQyMTMwMw=="}], "type": "inlineReview", "revised_code": {"commit": "6ba29147b5f5e145f39824254512bf70ebbff8c7", "chunk": "diff --git a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\nindex 1ab4271e..5a517343 100644\n--- a/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n+++ b/vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/KeyboardActions.java\n\n@@ -69,8 +69,10 @@ public class KeyboardActions\n             {\n                 throw new IllegalStateException(\"Unable to find 'Return' button to close the keyboard\");\n             });\n-            return;\n         }\n-        webDriverProvider.getUnwrapped(HidesKeyboard.class).hideKeyboard();\n+        else\n+        {\n+            webDriverProvider.getUnwrapped(HidesKeyboard.class).hideKeyboard();\n+        }\n     }\n }\n"}}, {"oid": "6ba29147b5f5e145f39824254512bf70ebbff8c7", "url": "https://github.com/vividus-framework/vividus/commit/6ba29147b5f5e145f39824254512bf70ebbff8c7", "message": "[plugin-mobile-app] Add property to specify test execution on real device", "committedDate": "2020-10-06T16:13:08Z", "type": "commit"}, {"oid": "6ba29147b5f5e145f39824254512bf70ebbff8c7", "url": "https://github.com/vividus-framework/vividus/commit/6ba29147b5f5e145f39824254512bf70ebbff8c7", "message": "[plugin-mobile-app] Add property to specify test execution on real device", "committedDate": "2020-10-06T16:13:08Z", "type": "forcePushed"}]}