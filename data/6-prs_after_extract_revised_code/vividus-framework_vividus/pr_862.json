{"pr_number": 862, "pr_title": "Fix NPE when browser session starting in before story", "pr_createdAt": "2020-08-27T15:46:05Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/862", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNjkzOA==", "url": "https://github.com/vividus-framework/vividus/pull/862#discussion_r478526938", "bodyText": "when can runningStory be null?", "author": "valfirst", "createdAt": "2020-08-27T15:58:16Z", "path": "vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java", "diffHunk": "@@ -123,8 +126,10 @@ private boolean isStoryHasNoScreenshotOnFailureMeta()\n \n     private boolean isScenarioHasNoScreenshotsOnFailureMeta()\n     {\n-        RunningStory runningStory = bddRunContext.getRunningStory();\n-        return runningStory.getRunningScenario().getScenario().getMeta()\n-                .hasProperty(NO_SCREENSHOT_ON_FAILURE_META_NAME);\n+        return Optional.ofNullable(bddRunContext.getRunningStory())", "originalCommit": "e935c691eaf861e2122858d3ce0979de3189ebae", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dd32e322b5a46a91e7f02e3b3411970e87fd6970", "chunk": "diff --git a/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java b/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\nindex 06955b0e..36749417 100644\n--- a/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\n+++ b/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\n\n@@ -126,7 +126,7 @@ public class ScreenshotOnFailureMonitor extends NullStepMonitor\n \n     private boolean isScenarioHasNoScreenshotsOnFailureMeta()\n     {\n-        return Optional.ofNullable(bddRunContext.getRunningStory())\n+        return Optional.of(bddRunContext.getRunningStory())\n                        .map(RunningStory::getRunningScenario)\n                        .map(RunningScenario::getScenario)\n                        .map(Scenario::getMeta)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyNzYzNQ==", "url": "https://github.com/vividus-framework/vividus/pull/862#discussion_r478527635", "bodyText": "similar here: if runningScenario is not null, will scenario ever be null?", "author": "valfirst", "createdAt": "2020-08-27T15:59:19Z", "path": "vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java", "diffHunk": "@@ -123,8 +126,10 @@ private boolean isStoryHasNoScreenshotOnFailureMeta()\n \n     private boolean isScenarioHasNoScreenshotsOnFailureMeta()\n     {\n-        RunningStory runningStory = bddRunContext.getRunningStory();\n-        return runningStory.getRunningScenario().getScenario().getMeta()\n-                .hasProperty(NO_SCREENSHOT_ON_FAILURE_META_NAME);\n+        return Optional.ofNullable(bddRunContext.getRunningStory())\n+                       .map(RunningStory::getRunningScenario)\n+                       .map(RunningScenario::getScenario)", "originalCommit": "e935c691eaf861e2122858d3ce0979de3189ebae", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dd32e322b5a46a91e7f02e3b3411970e87fd6970", "chunk": "diff --git a/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java b/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\nindex 06955b0e..36749417 100644\n--- a/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\n+++ b/vividus-plugin-web-app/src/main/java/org/vividus/bdd/monitor/ScreenshotOnFailureMonitor.java\n\n@@ -126,7 +126,7 @@ public class ScreenshotOnFailureMonitor extends NullStepMonitor\n \n     private boolean isScenarioHasNoScreenshotsOnFailureMeta()\n     {\n-        return Optional.ofNullable(bddRunContext.getRunningStory())\n+        return Optional.of(bddRunContext.getRunningStory())\n                        .map(RunningStory::getRunningScenario)\n                        .map(RunningScenario::getScenario)\n                        .map(Scenario::getMeta)\n"}}, {"oid": "dd32e322b5a46a91e7f02e3b3411970e87fd6970", "url": "https://github.com/vividus-framework/vividus/commit/dd32e322b5a46a91e7f02e3b3411970e87fd6970", "message": "[tests] Favor before story hook over set-up scenario", "committedDate": "2020-08-27T17:06:36Z", "type": "forcePushed"}, {"oid": "6c3f1fb7dfcbc8246bdeadba84bb7245ebe41063", "url": "https://github.com/vividus-framework/vividus/commit/6c3f1fb7dfcbc8246bdeadba84bb7245ebe41063", "message": "[plugin-web-app] Fix NPE when browser session starting in before story", "committedDate": "2020-08-27T17:07:47Z", "type": "commit"}, {"oid": "db8807fa37a8563fb926518af3caef5d98a79e68", "url": "https://github.com/vividus-framework/vividus/commit/db8807fa37a8563fb926518af3caef5d98a79e68", "message": "[tests] Favor before story hook over set-up scenario", "committedDate": "2020-08-27T17:07:50Z", "type": "commit"}, {"oid": "db8807fa37a8563fb926518af3caef5d98a79e68", "url": "https://github.com/vividus-framework/vividus/commit/db8807fa37a8563fb926518af3caef5d98a79e68", "message": "[tests] Favor before story hook over set-up scenario", "committedDate": "2020-08-27T17:07:50Z", "type": "forcePushed"}]}