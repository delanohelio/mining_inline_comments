{"pr_number": 1750, "pr_title": "[JBPM-9261] unclear validation message for link in different subprocess", "pr_createdAt": "2020-09-07T14:05:56Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1750", "timeline": [{"oid": "9353110c7203fe0e49919055655321b31c026147", "url": "https://github.com/kiegroup/jbpm/commit/9353110c7203fe0e49919055655321b31c026147", "message": "[JBPM-9261] unclear validation message for link in different subprocess\n\nActually, the way engine works, links are included as metadata\ninformation of the parent process or every container node, so there is\nnot vissibility between the links of a subprocess and links of the\nparent process, meaning that, at all effects, a no link scenario is\nsimilar to a link in different subprocess.\n\nError Message was already improved as part of RPHAM-3132, so message\nwhen there is no association is\n\n\"There is not connection from any throw link to these catch links {list\nof ids}\" or \"There is not connection from any catch link to these throw\nlinks {list of ids}\"\n\nSince now the ids of the missing connections are loggged, although the\nsame message is printed regardless there is no link or there is a link\nin a different process,  the user can easily tie knots, avoiding the\nconfusion.\n\nA test case was added to verify message is printed", "committedDate": "2020-09-07T14:26:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc3OTAxOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1750#discussion_r484779019", "bodyText": "Maybe we can use org.kie.api.definition.process.Process instead, just to make it a little more abstract? just like the one used below which is an instance of org.kie.api.definition.process.Node? - wdyt?", "author": "afalhambra", "createdAt": "2020-09-08T09:26:47Z", "path": "jbpm-bpmn2/src/main/java/org/jbpm/bpmn2/xml/ProcessHandler.java", "diffHunk": "@@ -258,28 +260,34 @@ else if (link.isThrowLink()) {\n         // throw exception if any error (this is done at the end of the process to show the user as much errors as possible) \n         StringBuilder errors = new StringBuilder();\n         if (!noNameLinks.isEmpty()) {\n-            formatError(errors,\"These nodes do not have a name \",noNameLinks.stream());\n+            formatError(errors,\"These nodes do not have a name \",noNameLinks.stream(), process);\n         }\n         if (!duplicatedTarget.isEmpty()) {\n-            formatError(errors,\"\\nThere are multiple catch nodes with the same name \",duplicatedTarget.stream());\n+            formatError(errors,\"\\nThere are multiple catch nodes with the same name \",duplicatedTarget.stream(), process);\n         }\n         if (!unconnectedTarget.isEmpty()) {\n-            formatError(errors,\"\\nThere is not connection from any throw link to these catch links \",unconnectedTarget.stream());\n+            formatError(errors,\"\\nThere is not connection from any throw link to these catch links \",unconnectedTarget.stream(), process);\n         }\n         if (!throwLinks.isEmpty()) {\n             formatError(errors,\"\\nThere is not connection from any catch link to these throw links \",throwLinks\n                                                .values()\n                                                .stream()\n-                                               .flatMap(Collection::stream));\n+                                               .flatMap(Collection::stream), process);\n         }\n         if (errors.length() > 0) {\n             throw new IllegalArgumentException (errors.toString());\n         }\n         \n     }\n     \n-    private static void formatError (StringBuilder errors, String message, Stream<IntermediateLink> stream) {\n+    private static void formatError (StringBuilder errors, String message, Stream<IntermediateLink> stream, NodeContainer container) {\n         errors.append(message).append(stream.map(IntermediateLink::getUniqueId).collect(Collectors.joining(\", \",\"{\",\"}\")));\n+        if (container instanceof Process) {", "originalCommit": "9353110c7203fe0e49919055655321b31c026147", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc4MTY3NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1750#discussion_r484781675", "bodyText": "you are right, changed", "author": "fjtirado", "createdAt": "2020-09-08T09:30:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDc3OTAxOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f88fe3d3bfeb863450ba8430f84b04609fd717f1", "url": "https://github.com/kiegroup/jbpm/commit/f88fe3d3bfeb863450ba8430f84b04609fd717f1", "message": "[JBPM-9261] unclear validation message for link in different subprocess\n\nActually, the way engine works, links are included as metadata\ninformation of the parent process or every container node, so there is\nnot vissibility between the links of a subprocess and links of the\nparent process, meaning that, at all effects, a no link scenario is\nsimilar to a link in different subprocess.\n\nError Message was already improved as part of RPHAM-3132, so message\nwhen there is no association is\n\n\"There is not connection from any throw link to these catch links {list\nof ids}\" or \"There is not connection from any catch link to these throw\nlinks {list of ids}\"\n\nSince now the ids of the missing connections are loggged, although the\nsame message is printed regardless there is no link or there is a link\nin a different process,  the user can easily tie knots, avoiding the\nconfusion.\n\nA test case was added to verify message is printed", "committedDate": "2020-09-08T09:30:24Z", "type": "commit"}, {"oid": "f88fe3d3bfeb863450ba8430f84b04609fd717f1", "url": "https://github.com/kiegroup/jbpm/commit/f88fe3d3bfeb863450ba8430f84b04609fd717f1", "message": "[JBPM-9261] unclear validation message for link in different subprocess\n\nActually, the way engine works, links are included as metadata\ninformation of the parent process or every container node, so there is\nnot vissibility between the links of a subprocess and links of the\nparent process, meaning that, at all effects, a no link scenario is\nsimilar to a link in different subprocess.\n\nError Message was already improved as part of RPHAM-3132, so message\nwhen there is no association is\n\n\"There is not connection from any throw link to these catch links {list\nof ids}\" or \"There is not connection from any catch link to these throw\nlinks {list of ids}\"\n\nSince now the ids of the missing connections are loggged, although the\nsame message is printed regardless there is no link or there is a link\nin a different process,  the user can easily tie knots, avoiding the\nconfusion.\n\nA test case was added to verify message is printed", "committedDate": "2020-09-08T09:30:24Z", "type": "forcePushed"}]}