{"pr_number": 1702, "pr_title": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before deleting tables at after", "pr_createdAt": "2020-07-20T15:51:50Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1702", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkxMDQ1OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457910459", "bodyText": "not sure why do we need to remove this line? Don't we have to abort instances before removing data from the tables?\nAlso, same method will be called in the @after method cleanup once this test is finished.", "author": "afalhambra", "createdAt": "2020-07-21T08:01:08Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1038,7 +1038,6 @@ public void testGetTaskByIdWithCorrelation() {\n         assertNotNull(userTask);\n         assertCorrelationAndProcess(userTask, correlationKey);\n         assertEquals(processInstanceId, userTask.getProcessInstanceId());\n-        processService.abortProcessInstance(processInstanceId);", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4MjQ2Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457982463", "bodyText": "In the after method, it will be aborted as other tests, so it's not strictly needed. Before this fixing, it was necessary for CDI tests to avoid failing and it was the main clue for understanding what was happening.", "author": "gmunozfe", "createdAt": "2020-07-21T10:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkxMDQ1OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyMzcyNw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457923727", "bodyText": "this method is checking for the correlationKey rather than pids. Probably in this case correlationKey = pid always? would it not make sense to modify assertTasks method to fetch pids instead of correlationKey? all the calls to this method are passing pids. What do you think?", "author": "afalhambra", "createdAt": "2020-07-21T08:23:58Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/RuntimeDataServiceImplTest.java", "diffHunk": "@@ -1152,6 +1151,7 @@ public void testGetTaskAssignedAsBusinessAdminByStatus() {\n         List<TaskSummary> tasks = runtimeDataService.getTasksAssignedAsBusinessAdministratorByStatus(\"Administrator\", statuses, new QueryFilter(0, 5));\n         assertNotNull(tasks);\n         assertEquals(5, tasks.size());\n+        assertTasks(tasks, 5, pids);", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4NDE5OA==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457984198", "bodyText": "the goal for this assertTasks method is to verify that correlationKey and processType have the expected value (pids and process respectively), as it was introduced in the jbpm#1680", "author": "gmunozfe", "createdAt": "2020-07-21T10:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyMzcyNw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNTM4Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457925387", "bodyText": "Small typo\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    //neeed to abort all processes before deleting all the tables\n          \n          \n            \n                    // need to abort all processes before deleting all the tables", "author": "afalhambra", "createdAt": "2020-07-21T08:26:36Z", "path": "jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java", "diffHunk": "@@ -173,7 +173,9 @@ public void setIdentityProvider(TestIdentityProvider identityProvider) {\n \t\n \t@After\n \tpublic void removeAllData() {\n-\t\tint deleted = 0;\n+        //neeed to abort all processes before deleting all the tables", "originalCommit": "fa69f3eaafe531f2beefd636f4a5aa01964ecf80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzk4NDk1Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1702#discussion_r457984956", "bodyText": "done", "author": "gmunozfe", "createdAt": "2020-07-21T10:07:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkyNTM4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "chunk": "diff --git a/jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java b/jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java\nindex 531b2f750..12adcd3c5 100644\n--- a/jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java\n+++ b/jbpm-services/jbpm-services-cdi/src/test/java/org/jbpm/services/cdi/test/RuntimeDataServiceCDIImplTest.java\n\n@@ -173,7 +173,7 @@ public class RuntimeDataServiceCDIImplTest extends RuntimeDataServiceImplTest {\n \t\n \t@After\n \tpublic void removeAllData() {\n-        //neeed to abort all processes before deleting all the tables\n+        //need to abort all processes before deleting all the tables\n         super.cleanup();\n         int deleted = 0;\n         deleted += commandService.execute(new UpdateStringCommand(\"delete from  NodeInstanceLog nid\"));\n"}}, {"oid": "bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "url": "https://github.com/kiegroup/jbpm/commit/bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "message": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before", "committedDate": "2020-07-21T10:07:05Z", "type": "commit"}, {"oid": "bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "url": "https://github.com/kiegroup/jbpm/commit/bb77c3adbb1aee3a3b7a09936b67ce64fc37f250", "message": "[JBPM-9248] RuntimeDataServiceCDIImplTest must abort process before", "committedDate": "2020-07-21T10:07:05Z", "type": "forcePushed"}]}