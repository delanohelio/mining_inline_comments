{"pr_number": 1782, "pr_title": "[JBPM-9434] REST endpoint authetication fails if Authorization header\u2026", "pr_createdAt": "2020-10-18T11:56:43Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1782", "timeline": [{"oid": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "url": "https://github.com/kiegroup/jbpm/commit/9c3805de6657a57e5dbc02e8e83ada3025bb4347", "message": "[JBPM-9434] REST endpoint authetication fails if Authorization header has == in encoded key in REST WIH", "committedDate": "2020-10-18T11:52:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwODY5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508408693", "bodyText": "We can keep previous separator, but forcing the length of the resulting array, just to split with the first separator:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                         String[] headerParts = h.split(\":\");\n          \n          \n            \n                         String[] headerParts = h.split(\"=\", 2);", "author": "gmunozfe", "createdAt": "2020-10-20T11:02:55Z", "path": "jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java", "diffHunk": "@@ -905,7 +905,7 @@ protected void addAcceptHeader(HttpRequestBase theMethod,\n     protected void addCustomHeaders(String headers,\n             BiConsumer<String, String> consumer) {\n         for(String h : headers.split(\";\")) {\n-             String[] headerParts = h.split(\"=\");\n+             String[] headerParts = h.split(\":\");", "originalCommit": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0NTMwMA==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508445300", "bodyText": "@gmunozfe Thank you for pointing it out. I should have thought about backward compatibility.", "author": "abhijithumbe", "createdAt": "2020-10-20T12:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQwODY5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b55256baa72789b130b2809776c1e46111896974", "chunk": "diff --git a/jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java b/jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java\nindex 2e7399fce..2e9ba369f 100644\n--- a/jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java\n+++ b/jbpm-workitems/jbpm-workitems-rest/src/main/java/org/jbpm/process/workitem/rest/RESTWorkItemHandler.java\n\n@@ -905,7 +905,7 @@ public class RESTWorkItemHandler extends AbstractLogOrThrowWorkItemHandler imple\n     protected void addCustomHeaders(String headers,\n             BiConsumer<String, String> consumer) {\n         for(String h : headers.split(\";\")) {\n-             String[] headerParts = h.split(\":\");\n+             String[] headerParts = h.split(\"=\",2);\n              if(headerParts.length == 2) {\n                  consumer.accept(headerParts[0], headerParts[1]);\n              } \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQxMTI5Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508411293", "bodyText": "It should be the other way around (expected, current):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertEquals(result, headerValue);\n          \n          \n            \n                    assertEquals(headerValue, result);", "author": "gmunozfe", "createdAt": "2020-10-20T11:07:32Z", "path": "jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java", "diffHunk": "@@ -1069,7 +1069,29 @@ public void testHeadersSingleValue() {\n         RESTWorkItemHandler handler = new RESTWorkItemHandler();\n         String headerKey = \"headerKey\";\n         String headerValue = \"headerValue\";\n-        String headers = headerKey + \"=\" + headerValue;\n+        String headers = headerKey + \":\" + headerValue;\n+         \n+        WorkItemImpl workItem = new WorkItemImpl();\n+        workItem.setParameter(\"Url\",\n+                              serverURL + \"/header/\" + headerKey);\n+        workItem.setParameter(\"Method\",\n+                              \"GET\");\n+        workItem.setParameter(PARAM_HEADERS, headers);\n+        \n+        WorkItemManager manager = new TestWorkItemManager();\n+        handler.executeWorkItem(workItem,\n+                                manager);\n+        Map<String, Object> results = ((TestWorkItemManager) manager).getResults(workItem.getId());\n+        String result = (String) results.get(PARAM_RESULT);\n+        assertEquals(result, headerValue);", "originalCommit": "9c3805de6657a57e5dbc02e8e83ada3025bb4347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0NTc0MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1782#discussion_r508445741", "bodyText": "@gmunozfe Made suggested changes in this test case and in other test cases as well.", "author": "abhijithumbe", "createdAt": "2020-10-20T12:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQxMTI5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b55256baa72789b130b2809776c1e46111896974", "chunk": "diff --git a/jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java b/jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java\nindex fdad398bc..658ef2e58 100644\n--- a/jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java\n+++ b/jbpm-workitems/jbpm-workitems-rest/src/test/java/org/jbpm/process/workitem/rest/RestWorkItemHandlerTest.java\n\n@@ -1069,7 +1069,7 @@ public class RestWorkItemHandlerTest {\n         RESTWorkItemHandler handler = new RESTWorkItemHandler();\n         String headerKey = \"headerKey\";\n         String headerValue = \"headerValue\";\n-        String headers = headerKey + \":\" + headerValue;\n+        String headers = headerKey + \"=\" + headerValue;\n          \n         WorkItemImpl workItem = new WorkItemImpl();\n         workItem.setParameter(\"Url\",\n"}}, {"oid": "b55256baa72789b130b2809776c1e46111896974", "url": "https://github.com/kiegroup/jbpm/commit/b55256baa72789b130b2809776c1e46111896974", "message": "[JBPM-9434] REST endpoint authetication fails if Authorization header has == in encoded key in REST WIH", "committedDate": "2020-10-20T12:04:13Z", "type": "commit"}]}