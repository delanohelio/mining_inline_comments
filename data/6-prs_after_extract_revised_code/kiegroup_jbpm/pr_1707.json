{"pr_number": 1707, "pr_title": "[BAQE-1444] - Switch from tcp to mem H2 in jbpm-bpmn2 module", "pr_createdAt": "2020-07-22T16:04:42Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1707", "timeline": [{"oid": "2afd7c2794d2392d3494cad23717992a5f1b0079", "url": "https://github.com/kiegroup/jbpm/commit/2afd7c2794d2392d3494cad23717992a5f1b0079", "message": "[BAQE-1444] Switch from tcp to mem H2 in jbpm-bpmn2 module\n\n- Due to this change, there might be some tests failing as records are inserted in the in memory DB much faster (some records in DB might have same date, including milliseconds).", "committedDate": "2020-07-23T11:29:07Z", "type": "forcePushed"}, {"oid": "de877650f92df874801d9814edc32a609fd77152", "url": "https://github.com/kiegroup/jbpm/commit/de877650f92df874801d9814edc32a609fd77152", "message": "[JBPM-9223] include case file details in case list. (#1697)\n\nAdding new overloaded getCaseInstances method to CaseRuntimeDataService\nthat allows\nthe possibility to include case file information if a flag is set", "committedDate": "2020-07-23T16:14:18Z", "type": "commit"}, {"oid": "ba7bf5a8d852981f0dfcd094c2822de19d49f42d", "url": "https://github.com/kiegroup/jbpm/commit/ba7bf5a8d852981f0dfcd094c2822de19d49f42d", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-04T08:17:18Z", "type": "commit"}, {"oid": "0709eed6d6e379eda3d0c197051c5423148cdb49", "url": "https://github.com/kiegroup/jbpm/commit/0709eed6d6e379eda3d0c197051c5423148cdb49", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-05T10:58:16Z", "type": "commit"}, {"oid": "904e54420d6096f9fcf44da953d3e924a7ff34b1", "url": "https://github.com/kiegroup/jbpm/commit/904e54420d6096f9fcf44da953d3e924a7ff34b1", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-06T10:04:34Z", "type": "commit"}, {"oid": "b65cb83811caf8fde1eb312b48a80a7f963ca170", "url": "https://github.com/kiegroup/jbpm/commit/b65cb83811caf8fde1eb312b48a80a7f963ca170", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-10T06:42:34Z", "type": "commit"}, {"oid": "dae059d1f5e9813da373f0d5ca801993266c1099", "url": "https://github.com/kiegroup/jbpm/commit/dae059d1f5e9813da373f0d5ca801993266c1099", "message": "[BAQE-1444] Switch from tcp to mem H2 in jbpm-bpmn2 module\n\n- Due to this change, there might be some tests failing as records are inserted in the in memory DB much faster (some records in DB might have same date, including milliseconds).", "committedDate": "2020-08-10T09:15:20Z", "type": "forcePushed"}, {"oid": "ad532cbf703b3c9ca22e137e61fe2632ec73a87d", "url": "https://github.com/kiegroup/jbpm/commit/ad532cbf703b3c9ca22e137e61fe2632ec73a87d", "message": "[BAQE-1444] Switch from tcp to mem H2 in jbpm-bpmn2 module\n\n- Due to this change, there might be some tests failing as records are inserted in the in memory DB much faster (some records in DB might have same date, including milliseconds).", "committedDate": "2020-08-10T12:07:59Z", "type": "forcePushed"}, {"oid": "ee75d4417a8961a10ab27a3eecbc9195ed2544e8", "url": "https://github.com/kiegroup/jbpm/commit/ee75d4417a8961a10ab27a3eecbc9195ed2544e8", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-17T09:46:22Z", "type": "commit"}, {"oid": "f5e50c751ecc3660e280fdec8d280dfbb31f2d49", "url": "https://github.com/kiegroup/jbpm/commit/f5e50c751ecc3660e280fdec8d280dfbb31f2d49", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-19T14:12:44Z", "type": "commit"}, {"oid": "668e5768d2558693ba215488e7669afea788e1dc", "url": "https://github.com/kiegroup/jbpm/commit/668e5768d2558693ba215488e7669afea788e1dc", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-24T08:05:36Z", "type": "commit"}, {"oid": "2cf146b2f25dbfc38b5dffb5cb7d37b69b1cd1d2", "url": "https://github.com/kiegroup/jbpm/commit/2cf146b2f25dbfc38b5dffb5cb7d37b69b1cd1d2", "message": "Merge branch 'master' of github.com:kiegroup/jbpm", "committedDate": "2020-08-26T09:02:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NzY4Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1707#discussion_r477567683", "bodyText": "Comment on the line 211 no longer holds (timestamp -> UUID).", "author": "MarianMacik", "createdAt": "2020-08-26T20:24:43Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/SubProcessNodeInstance.java", "diffHunk": "@@ -211,7 +212,7 @@ public void internalTrigger(final NodeInstance from, String type) {\n                 List<String> businessKeys = new ArrayList<String>();", "originalCommit": "ad532cbf703b3c9ca22e137e61fe2632ec73a87d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE3MDg5OA==", "url": "https://github.com/kiegroup/jbpm/pull/1707#discussion_r478170898", "bodyText": "done", "author": "afalhambra", "createdAt": "2020-08-27T06:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2NzY4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "2481547fe297303accd9f907ec62470714b96665", "chunk": "diff --git a/jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/SubProcessNodeInstance.java b/jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/SubProcessNodeInstance.java\nindex eca2790ea..fcaf27eff 100644\n--- a/jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/SubProcessNodeInstance.java\n+++ b/jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/SubProcessNodeInstance.java\n\n@@ -208,8 +208,8 @@ public class SubProcessNodeInstance extends StateBasedNodeInstance implements Ev\n             ProcessInstance processInstance = null;\n             if (((WorkflowProcessInstanceImpl)getProcessInstance()).getCorrelationKey() != null) {\n                 // in case there is correlation key on parent instance pass it along to child so it can be easily correlated \n-                // since correlation key must be unique for active instances it appends processId and timestamp\n-                List<String> businessKeys = new ArrayList<String>();\n+                // since correlation key must be unique for active instances it appends processId and UUID\n+                List<String> businessKeys = new ArrayList<>();\n                 businessKeys.add(((WorkflowProcessInstanceImpl)getProcessInstance()).getCorrelationKey());\n                 businessKeys.add(processId);\n                 businessKeys.add(UUID.randomUUID().toString());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2ODc2MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1707#discussion_r477568761", "bodyText": "So I guess issue was in case there were 2 subprocesses created in a succession, for example with multi-instance/loop subprocess, right? And at least 2 of them had the same timestamp... That's really quick!", "author": "MarianMacik", "createdAt": "2020-08-26T20:26:43Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/node/DynamicUtils.java", "diffHunk": "@@ -275,7 +276,7 @@ private static long executeSubProcess(StatefulKnowledgeSessionImpl ksession,\n                 List<String> businessKeys = new ArrayList<>();\n                 businessKeys.add(((WorkflowProcessInstanceImpl) processInstance).getCorrelationKey());\n                 businessKeys.add(processId);\n-                businessKeys.add(String.valueOf(System.currentTimeMillis()));\n+                businessKeys.add(UUID.randomUUID().toString());", "originalCommit": "ad532cbf703b3c9ca22e137e61fe2632ec73a87d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE2OTc4Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1707#discussion_r478169783", "bodyText": "Correct. Two parallel subprocesses from same parent created in the same millisecond... specially now having H2 pure in memory did the trick.", "author": "afalhambra", "createdAt": "2020-08-27T06:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU2ODc2MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "2481547fe297303accd9f907ec62470714b96665", "url": "https://github.com/kiegroup/jbpm/commit/2481547fe297303accd9f907ec62470714b96665", "message": "[BAQE-1444] Switch from tcp to mem H2 in jbpm-bpmn2 module\n\n- Due to this change, there might be some tests failing as records are inserted in the in memory DB much faster (some records in DB might have same date, including milliseconds).", "committedDate": "2020-08-27T06:13:31Z", "type": "commit"}, {"oid": "2481547fe297303accd9f907ec62470714b96665", "url": "https://github.com/kiegroup/jbpm/commit/2481547fe297303accd9f907ec62470714b96665", "message": "[BAQE-1444] Switch from tcp to mem H2 in jbpm-bpmn2 module\n\n- Due to this change, there might be some tests failing as records are inserted in the in memory DB much faster (some records in DB might have same date, including milliseconds).", "committedDate": "2020-08-27T06:13:31Z", "type": "forcePushed"}]}