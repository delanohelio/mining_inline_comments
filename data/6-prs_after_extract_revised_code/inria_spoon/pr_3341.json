{"pr_number": 3341, "pr_title": "fix: fix wrong import on annotated parameter #3320", "pr_createdAt": "2020-04-21T21:40:39Z", "pr_url": "https://github.com/INRIA/spoon/pull/3341", "timeline": [{"oid": "6919c239f6e28500a868480c1f1fbb8c891083b1", "url": "https://github.com/INRIA/spoon/commit/6919c239f6e28500a868480c1f1fbb8c891083b1", "message": "Merge remote-tracking branch 'source/master'", "committedDate": "2020-04-21T18:57:58Z", "type": "commit"}, {"oid": "d92b10a20b07824009bd4bfccc194810bee9965a", "url": "https://github.com/INRIA/spoon/commit/d92b10a20b07824009bd4bfccc194810bee9965a", "message": "fix: annotated element bad import", "committedDate": "2020-04-21T20:51:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3ODcyMg==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r412678722", "bodyText": "In Spoon, the tests come with a one-line contract describing the test intention, something like\n// contract: annotations are not added on import statements\ncould you add the contract that is tested? Thanks!", "author": "monperrus", "createdAt": "2020-04-22T05:23:49Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,22 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {", "originalCommit": "d92b10a20b07824009bd4bfccc194810bee9965a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "chunk": "diff --git a/src/test/java/spoon/test/imports/ImportTest.java b/src/test/java/spoon/test/imports/ImportTest.java\nindex d07040c1..1cb9b568 100644\n--- a/src/test/java/spoon/test/imports/ImportTest.java\n+++ b/src/test/java/spoon/test/imports/ImportTest.java\n\n@@ -1779,7 +1779,8 @@ launcher.addInputResource(\"./src/test/java/spoon/test/imports/testclasses/JavaLo\n \t}\n \n \t@Test\n-\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n \t\tfinal Launcher l = new Launcher();\n \t\tEnvironment e = l.getEnvironment();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3ODc5Nw==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r412678797", "bodyText": "Remove System.out from tests.", "author": "monperrus", "createdAt": "2020-04-22T05:24:02Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,22 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+\n+\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\n+\t\tfor (CtImport anImport : compilationUnit.getImports()) {\n+\t\t\tSystem.out.println(anImport.prettyprint());", "originalCommit": "d92b10a20b07824009bd4bfccc194810bee9965a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "chunk": "diff --git a/src/test/java/spoon/test/imports/ImportTest.java b/src/test/java/spoon/test/imports/ImportTest.java\nindex d07040c1..1cb9b568 100644\n--- a/src/test/java/spoon/test/imports/ImportTest.java\n+++ b/src/test/java/spoon/test/imports/ImportTest.java\n\n@@ -1779,7 +1779,8 @@ launcher.addInputResource(\"./src/test/java/spoon/test/imports/testclasses/JavaLo\n \t}\n \n \t@Test\n-\tpublic void testThatCorrectImportsAreGeneratedForJavaxAnnotatedElements() {\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n \t\tfinal Launcher l = new Launcher();\n \t\tEnvironment e = l.getEnvironment();\n \n"}}, {"oid": "1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "url": "https://github.com/INRIA/spoon/commit/1213053b6dbd49f7e835a1bb5642c4ff97ceb849", "message": "attended to pr reviews", "committedDate": "2020-04-23T21:07:46Z", "type": "commit"}, {"oid": "dbb03134d4f2c770426526abac6e7df50d2e6855", "url": "https://github.com/INRIA/spoon/commit/dbb03134d4f2c770426526abac6e7df50d2e6855", "message": "Merge remote-tracking branch 'source/master'", "committedDate": "2020-04-23T21:08:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyNzk2MQ==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414127961", "bodyText": "Personally i hate reading this. It feels like useless information, which get outdated easily. Git can provide this information better. Maybe remove it?", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:09Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source;\n+\n+import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\n+import spoon.test.imports.testclasses.badimportissue3320.source.other.TestAnnotation;\n+\n+/**\n+ * @author Gibah Joseph\n+ * Email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "chunk": "diff --git a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\nindex fb603e0f..ffa718c0 100644\n--- a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\n+++ b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\n\n@@ -3,11 +3,6 @@ package spoon.test.imports.testclasses.badimportissue3320.source;\n import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\n import spoon.test.imports.testclasses.badimportissue3320.source.other.TestAnnotation;\n \n-/**\n- * @author Gibah Joseph\n- * Email: gibahjoe@gmail.com\n- * Apr, 2020\n- **/\n public class TestSource {\n     private String firstName;\n     private String lastName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyNzk5Nw==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414127997", "bodyText": "see other comment", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:13Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source.other;\n+\n+/**\n+ * @author Gibah Joseph\n+ * Email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "chunk": "diff --git a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java\nindex b63f58d6..8e0d10e1 100644\n--- a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java\n+++ b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/SomeObjectDto.java\n\n@@ -1,9 +1,4 @@\n package spoon.test.imports.testclasses.badimportissue3320.source.other;\n \n-/**\n- * @author Gibah Joseph\n- * Email: gibahjoe@gmail.com\n- * Apr, 2020\n- **/\n public class SomeObjectDto {\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyODEzMA==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414128130", "bodyText": "see other comment", "author": "MartinWitt", "createdAt": "2020-04-23T21:13:26Z", "path": "src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package spoon.test.imports.testclasses.badimportissue3320.source.other;\n+\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.Target;\n+\n+import static java.lang.annotation.ElementType.*;\n+import static java.lang.annotation.RetentionPolicy.RUNTIME;\n+\n+/**\n+ * @author Gibah Joseph\n+ * email: gibahjoe@gmail.com\n+ * Apr, 2020\n+ **/", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "chunk": "diff --git a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java\nindex 7a1c2cbc..75b8b08e 100644\n--- a/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java\n+++ b/src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/other/TestAnnotation.java\n\n@@ -6,11 +6,6 @@ import java.lang.annotation.Target;\n import static java.lang.annotation.ElementType.*;\n import static java.lang.annotation.RetentionPolicy.RUNTIME;\n \n-/**\n- * @author Gibah Joseph\n- * email: gibahjoe@gmail.com\n- * Apr, 2020\n- **/\n @Target({ METHOD, FIELD, CONSTRUCTOR, PARAMETER, TYPE_USE })\n @Retention(RUNTIME)\n public @interface TestAnnotation {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEyOTI1OA==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414129258", "bodyText": "maybe a pit \"picky\", but short names like e and l makes reading hard.", "author": "MartinWitt", "createdAt": "2020-04-23T21:15:18Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,20 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "chunk": "diff --git a/src/test/java/spoon/test/imports/ImportTest.java b/src/test/java/spoon/test/imports/ImportTest.java\nindex 1cb9b568..82da8c74 100644\n--- a/src/test/java/spoon/test/imports/ImportTest.java\n+++ b/src/test/java/spoon/test/imports/ImportTest.java\n\n@@ -1781,17 +1781,19 @@ launcher.addInputResource(\"./src/test/java/spoon/test/imports/testclasses/JavaLo\n \t@Test\n \tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n \t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n-\t\tfinal Launcher l = new Launcher();\n-\t\tEnvironment e = l.getEnvironment();\n+\t\tfinal Launcher launcher = new Launcher();\n+\t\tEnvironment environment = launcher.getEnvironment();\n \n-\t\te.setNoClasspath(true);\n-\t\te.setAutoImports(true);\n-\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n-\t\tl.run();\n+\t\tenvironment.setNoClasspath(true);\n+\t\tenvironment.setAutoImports(true);\n+\t\tlauncher.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tlauncher.run();\n \n-\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n-\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\t\tCtType<TestSource> objectCtType = launcher.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = launcher.getFactory().CompilationUnit().getOrCreate(objectCtType);\n \n-\t\tassertEquals(1, compilationUnit.getImports().stream().filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\")).count());\n+\t\tassertEquals(1, compilationUnit.getImports().stream()\n+\t\t\t\t.filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\"))\n+\t\t\t\t.count());\n \t}\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDEzMDc5OQ==", "url": "https://github.com/INRIA/spoon/pull/3341#discussion_r414130799", "bodyText": "maybe a linebreak, but not mandatory", "author": "MartinWitt", "createdAt": "2020-04-23T21:17:52Z", "path": "src/test/java/spoon/test/imports/ImportTest.java", "diffHunk": "@@ -1777,4 +1778,20 @@ public void testImportByJavaDoc() throws Exception {\n \t\t}\n \t}\n \n+\t@Test\n+\tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n+\t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n+\t\tfinal Launcher l = new Launcher();\n+\t\tEnvironment e = l.getEnvironment();\n+\n+\t\te.setNoClasspath(true);\n+\t\te.setAutoImports(true);\n+\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tl.run();\n+\n+\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\n+\t\tassertEquals(1, compilationUnit.getImports().stream().filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\")).count());", "originalCommit": "dbb03134d4f2c770426526abac6e7df50d2e6855", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "chunk": "diff --git a/src/test/java/spoon/test/imports/ImportTest.java b/src/test/java/spoon/test/imports/ImportTest.java\nindex 1cb9b568..82da8c74 100644\n--- a/src/test/java/spoon/test/imports/ImportTest.java\n+++ b/src/test/java/spoon/test/imports/ImportTest.java\n\n@@ -1781,17 +1781,19 @@ launcher.addInputResource(\"./src/test/java/spoon/test/imports/testclasses/JavaLo\n \t@Test\n \tpublic void testImportsForElementsAnnotatedWithTypeUseAnnotations() {\n \t\t// contract: correct import generated for method parameters annotated with TYPE_USE annotations\n-\t\tfinal Launcher l = new Launcher();\n-\t\tEnvironment e = l.getEnvironment();\n+\t\tfinal Launcher launcher = new Launcher();\n+\t\tEnvironment environment = launcher.getEnvironment();\n \n-\t\te.setNoClasspath(true);\n-\t\te.setAutoImports(true);\n-\t\tl.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n-\t\tl.run();\n+\t\tenvironment.setNoClasspath(true);\n+\t\tenvironment.setAutoImports(true);\n+\t\tlauncher.addInputResource(\"src/test/java/spoon/test/imports/testclasses/badimportissue3320/source/TestSource.java\");\n+\t\tlauncher.run();\n \n-\t\tCtType<TestSource> objectCtType = l.getFactory().Type().get(TestSource.class);\n-\t\tCompilationUnit compilationUnit = l.getFactory().CompilationUnit().getOrCreate(objectCtType);\n+\t\tCtType<TestSource> objectCtType = launcher.getFactory().Type().get(TestSource.class);\n+\t\tCompilationUnit compilationUnit = launcher.getFactory().CompilationUnit().getOrCreate(objectCtType);\n \n-\t\tassertEquals(1, compilationUnit.getImports().stream().filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\")).count());\n+\t\tassertEquals(1, compilationUnit.getImports().stream()\n+\t\t\t\t.filter(ctImport -> ctImport.prettyprint().equals(\"import spoon.test.imports.testclasses.badimportissue3320.source.other.SomeObjectDto;\"))\n+\t\t\t\t.count());\n \t}\n }\n"}}, {"oid": "9ae6f078ca52694dbe3e68c680514b7403c99e47", "url": "https://github.com/INRIA/spoon/commit/9ae6f078ca52694dbe3e68c680514b7403c99e47", "message": "improved code readability", "committedDate": "2020-04-23T22:37:01Z", "type": "commit"}]}