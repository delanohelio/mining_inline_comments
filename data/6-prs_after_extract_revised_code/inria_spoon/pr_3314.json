{"pr_number": 3314, "pr_title": "feature: add support for java 14 switch/yield", "pr_createdAt": "2020-03-25T17:43:11Z", "pr_url": "https://github.com/INRIA/spoon/pull/3314", "timeline": [{"oid": "6ec0f7e5bae0a0663aecf14eafd28f3900be22dc", "url": "https://github.com/INRIA/spoon/commit/6ec0f7e5bae0a0663aecf14eafd28f3900be22dc", "message": "bump jdt", "committedDate": "2020-03-23T20:35:39Z", "type": "commit"}, {"oid": "ca300a926892ec474e1306f327c2c0279c289a66", "url": "https://github.com/INRIA/spoon/commit/ca300a926892ec474e1306f327c2c0279c289a66", "message": "add java14 yield, refactor switchCaseTest fully for junit5", "committedDate": "2020-03-25T16:30:30Z", "type": "commit"}, {"oid": "f4e0a3b04f2e9dc01e6f6ee54546e8627f62ef78", "url": "https://github.com/INRIA/spoon/commit/f4e0a3b04f2e9dc01e6f6ee54546e8627f62ef78", "message": "add displaynames to tests", "committedDate": "2020-03-25T16:35:53Z", "type": "commit"}, {"oid": "a45f3a75ba9d3b431d6229fdb6dc2dfaa881cdad", "url": "https://github.com/INRIA/spoon/commit/a45f3a75ba9d3b431d6229fdb6dc2dfaa881cdad", "message": "add CtYieldStatement to doc", "committedDate": "2020-03-25T16:38:24Z", "type": "commit"}, {"oid": "843161fa0d92a0bc050756c27f8eb3e58ee83d1b", "url": "https://github.com/INRIA/spoon/commit/843161fa0d92a0bc050756c27f8eb3e58ee83d1b", "message": " fix imports", "committedDate": "2020-03-25T16:42:47Z", "type": "commit"}, {"oid": "50843d6cc032f76de5a2af23facf71bfa8079c60", "url": "https://github.com/INRIA/spoon/commit/50843d6cc032f76de5a2af23facf71bfa8079c60", "message": "fix doc for yield and testcase", "committedDate": "2020-03-25T17:32:51Z", "type": "commit"}, {"oid": "d50cfe9e498b9fddfee899b968e564730b520314", "url": "https://github.com/INRIA/spoon/commit/d50cfe9e498b9fddfee899b968e564730b520314", "message": "remove unused role", "committedDate": "2020-03-25T17:42:25Z", "type": "commit"}, {"oid": "e9eec9152e4303602f61f92d9b6e6bc70dea615b", "url": "https://github.com/INRIA/spoon/commit/e9eec9152e4303602f61f92d9b6e6bc70dea615b", "message": "fix compilation, list.of->Arrays.asList", "committedDate": "2020-03-25T19:14:43Z", "type": "commit"}, {"oid": "2c0c689d39136796992ad3bb4e127a3f23cabea9", "url": "https://github.com/INRIA/spoon/commit/2c0c689d39136796992ad3bb4e127a3f23cabea9", "message": "fix testGenerateRoleHandler", "committedDate": "2020-03-25T19:20:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzQxOA==", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r398117418", "bodyText": "#3314 just as a link", "author": "MartinWitt", "createdAt": "2020-03-25T19:33:35Z", "path": "src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java", "diffHunk": "@@ -358,8 +360,14 @@ CtReference getDeclaringReferenceFromImports(char[] expectedName) {\n \t\t\t\t\t\tif (packageBinding == null || packageBinding instanceof ProblemPackageBinding) {\n \t\t\t\t\t\t\t// Big crisis here. We are already in noclasspath mode but JDT doesn't support always\n \t\t\t\t\t\t\t// creation of a package in this mode. So, if we are in this brace, we make the job of JDT...\n-\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module);\n-\t\t\t\t\t\t}\n+\t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module) {\n+\t\t\t\t\t\t\t\t@Override\n+\t\t\t\t\t\t\t\tpublic PlainPackageBinding getIncarnation(ModuleBinding arg0) {\n+\t\t\t\t\t\t\t\t\t//https://github.com/eclipse/eclipse.jdt.core/blob/master/org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/lookup/PlainPackageBinding.java#L43", "originalCommit": "2c0c689d39136796992ad3bb4e127a3f23cabea9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyNDAyMg==", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399124022", "bodyText": "I don't understand, what do you mean?", "author": "monperrus", "createdAt": "2020-03-27T09:09:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzQxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIxMTczNg==", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399211736", "bodyText": "the class PackageBinding  was changed to an abstract class. To fix the problem, that you cant create an instance of it directly, i created an anonymous class. But the class needs to override the public PlainPackageBinding getIncarnation(ModuleBinding arg0) Method. I linked the original method from PlainPackageBindung to explain why this method always returns null.\nLinked it because I wasn't sure if the change is correct.", "author": "MartinWitt", "createdAt": "2020-03-27T11:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzQxOA=="}], "type": "inlineReview", "revised_code": {"commit": "68aed5b36f782c090345afc8533024b9f8f27ed2", "chunk": "diff --git a/src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java b/src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java\nindex fe310e15..36eeb402 100644\n--- a/src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java\n+++ b/src/main/java/spoon/support/compiler/jdt/ReferenceBuilder.java\n\n@@ -361,9 +361,13 @@ public class ReferenceBuilder {\n \t\t\t\t\t\t\t// Big crisis here. We are already in noclasspath mode but JDT doesn't support always\n \t\t\t\t\t\t\t// creation of a package in this mode. So, if we are in this brace, we make the job of JDT...\n \t\t\t\t\t\t\tpackageBinding = new PackageBinding(chars, null, environment, environment.module) {\n+\t\t\t\t\t\t\t\t// PackageBinding was a class instead of abstract class in earlier jdt versions.\n+\t\t\t\t\t\t\t\t// To circumvent this change to an abstract class, an anonymous class is used here.\n \t\t\t\t\t\t\t\t@Override\n \t\t\t\t\t\t\t\tpublic PlainPackageBinding getIncarnation(ModuleBinding arg0) {\n-\t\t\t\t\t\t\t\t\t//https://github.com/eclipse/eclipse.jdt.core/blob/master/org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/lookup/PlainPackageBinding.java#L43\n+\t\t\t\t\t\t\t\t\t// this method returns always null, because we dont know the enclosingModule here.\n+\t\t\t\t\t\t\t\t\t// Link to original method from PlainPackageBinding:\n+\t\t\t\t\t\t\t\t\t// https://github.com/eclipse/eclipse.jdt.core/blob/master/org.eclipse.jdt.core/compiler/org/eclipse/jdt/internal/compiler/lookup/PlainPackageBinding.java#L43\n \t\t\t\t\t\t\t\t\treturn null;\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t};\n"}}, {"oid": "e6fbbb6f890ef39a54e1636c174a1de70866075b", "url": "https://github.com/INRIA/spoon/commit/e6fbbb6f890ef39a54e1636c174a1de70866075b", "message": "add newlines", "committedDate": "2020-03-25T19:38:07Z", "type": "commit"}, {"oid": "7853d1e6ecfcb7e925205c03122948e48a87fc3e", "url": "https://github.com/INRIA/spoon/commit/7853d1e6ecfcb7e925205c03122948e48a87fc3e", "message": "fix doc", "committedDate": "2020-03-25T19:57:10Z", "type": "commit"}, {"oid": "ab64ce68caafc538befc11c9bf4e49c79a13f269", "url": "https://github.com/INRIA/spoon/commit/ab64ce68caafc538befc11c9bf4e49c79a13f269", "message": " replace -> with -&gt;", "committedDate": "2020-03-25T20:15:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTk1Ng==", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399121956", "bodyText": "to be removed", "author": "monperrus", "createdAt": "2020-03-27T09:06:04Z", "path": "src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java", "diffHunk": "@@ -523,4 +524,9 @@ public void visitCtPackageDeclaration(CtPackageDeclaration packageDeclaration) {\n \tpublic void visitCtTypeMemberWildcardImportReference(CtTypeMemberWildcardImportReference wildcardReference) {\n \n \t}\n+\n+\t@Override\n+\tpublic void visitCtYieldStatement(CtYieldStatement statement) {\n+\t\tString foo = \"\";", "originalCommit": "ab64ce68caafc538befc11c9bf4e49c79a13f269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwODc3MA==", "url": "https://github.com/INRIA/spoon/pull/3314#discussion_r399208770", "bodyText": "done", "author": "MartinWitt", "createdAt": "2020-03-27T11:47:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyMTk1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d3234fa71cac1860b23baeaa711d218b1eebfb23", "chunk": "diff --git a/src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java b/src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java\nindex be57af36..899bc3bc 100644\n--- a/src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java\n+++ b/src/main/java/spoon/reflect/visitor/CtAbstractVisitor.java\n\n@@ -527,6 +527,6 @@ public abstract class CtAbstractVisitor implements CtVisitor {\n \n \t@Override\n \tpublic void visitCtYieldStatement(CtYieldStatement statement) {\n-\t\tString foo = \"\";\n+\n \t}\n }\n"}}, {"oid": "d3234fa71cac1860b23baeaa711d218b1eebfb23", "url": "https://github.com/INRIA/spoon/commit/d3234fa71cac1860b23baeaa711d218b1eebfb23", "message": "remove debug stub", "committedDate": "2020-03-27T11:44:04Z", "type": "commit"}, {"oid": "a3276fa482f30b65272484f8845ea83a8cd1fecb", "url": "https://github.com/INRIA/spoon/commit/a3276fa482f30b65272484f8845ea83a8cd1fecb", "message": "fix whitespaces in pom.xml", "committedDate": "2020-03-27T11:47:31Z", "type": "commit"}, {"oid": "818e40a7fc0cb0a7bcff9e77f8a4607769dc8184", "url": "https://github.com/INRIA/spoon/commit/818e40a7fc0cb0a7bcff9e77f8a4607769dc8184", "message": "Update DefaultJavaPrettyPrinter.java\n\nremove wrong comment", "committedDate": "2020-03-27T12:19:38Z", "type": "commit"}, {"oid": "68aed5b36f782c090345afc8533024b9f8f27ed2", "url": "https://github.com/INRIA/spoon/commit/68aed5b36f782c090345afc8533024b9f8f27ed2", "message": "add explanation to the new anonymous class", "committedDate": "2020-03-27T14:48:20Z", "type": "commit"}]}