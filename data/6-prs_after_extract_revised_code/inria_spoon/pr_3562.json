{"pr_number": 3562, "pr_title": "fix: fix Maven source and test source directory resolving", "pr_createdAt": "2020-09-02T11:27:23Z", "pr_url": "https://github.com/INRIA/spoon/pull/3562", "timeline": [{"oid": "7c8b185992adad130004f6144a83372a63ecf553", "url": "https://github.com/INRIA/spoon/commit/7c8b185992adad130004f6144a83372a63ecf553", "message": "Added test for getting maven source directory from ancestors", "committedDate": "2020-09-03T13:03:02Z", "type": "forcePushed"}, {"oid": "aa0f9b7be3208a4c4190644e321df64feafc5a0a", "url": "https://github.com/INRIA/spoon/commit/aa0f9b7be3208a4c4190644e321df64feafc5a0a", "message": "Improved source and test source directory resolving by climbing the pom.xml hierarchy to find the nearest ancestor that declares the source directory. Also added interpolating (project|pom|'').basedir", "committedDate": "2020-09-09T11:08:10Z", "type": "commit"}, {"oid": "8287583d88ccb7270c21f0aa5697882333ca12b0", "url": "https://github.com/INRIA/spoon/commit/8287583d88ccb7270c21f0aa5697882333ca12b0", "message": "Made 'SpoonPom.addModule' public to facilitate adding modules that are not linked via pom.xml to the model", "committedDate": "2020-09-09T11:08:11Z", "type": "commit"}, {"oid": "589755f15f48b45e7b236a23dcc0e71aba4303fa", "url": "https://github.com/INRIA/spoon/commit/589755f15f48b45e7b236a23dcc0e71aba4303fa", "message": "Added test for getting maven source directory from ancestors", "committedDate": "2020-09-09T11:08:49Z", "type": "commit"}, {"oid": "d6ca1ea419e75250b27a12d544d24d58bf466175", "url": "https://github.com/INRIA/spoon/commit/d6ca1ea419e75250b27a12d544d24d58bf466175", "message": "Added dummy file so folder exists for test case", "committedDate": "2020-09-09T11:08:50Z", "type": "forcePushed"}, {"oid": "76db1d31cb9ae94aac3a135010598195f980062a", "url": "https://github.com/INRIA/spoon/commit/76db1d31cb9ae94aac3a135010598195f980062a", "message": "Added dummy file so folder exists for test case", "committedDate": "2020-09-09T11:09:24Z", "type": "forcePushed"}, {"oid": "be9816fb806ac46521dea80fd4b60ceda19762e7", "url": "https://github.com/INRIA/spoon/commit/be9816fb806ac46521dea80fd4b60ceda19762e7", "message": "Added dummy file so folder exists for test case", "committedDate": "2020-09-09T11:09:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2OTYyMQ==", "url": "https://github.com/INRIA/spoon/pull/3562#discussion_r485569621", "bodyText": "expected should be the second argument, not the last\nyou can remove the first one, the message, not relevant here", "author": "monperrus", "createdAt": "2020-09-09T12:25:55Z", "path": "src/test/java/spoon/support/compiler/SpoonPomTest.java", "diffHunk": "@@ -51,4 +52,20 @@ public void checkProfilesModules(String path, String[] expected, Pattern profile\n \t\t\tassertEquals(expected[i], modules.get(i).getName());\n \t\t}\n \t}\n+\t\n+\tpublic void getSourceDirectory() throws IOException, XmlPullParserException {\n+\t\tcheckSourceDirectory(\n+\t\t\t\"src/test/resources/maven-launcher/hierarchy\",\n+\t\t\tPaths.get(\"src/test/resources/maven-launcher/hierarchy/child/src\").toAbsolutePath().toString()\n+\t\t);\n+\t}\n+\n+\tpublic void checkSourceDirectory(String path, String expected) throws IOException, XmlPullParserException {\n+\t\tSpoonPom pomModel = new SpoonPom(path, null, MavenLauncher.SOURCE_TYPE.APP_SOURCE, new StandardEnvironment());\n+\n+\t\tSpoonPom childModel = pomModel.getModules().get(0);\n+\t\t//contract: source directory is derived from parent pom.xml if not declared in the current\n+\t\t// (childModel) SpoonPom\n+\t\tassertEquals(expected, childModel.getSourceDirectories().get(0).getAbsolutePath(), expected);", "originalCommit": "be9816fb806ac46521dea80fd4b60ceda19762e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU3MjIxMA==", "url": "https://github.com/INRIA/spoon/pull/3562#discussion_r485572210", "bodyText": "Fixed according to the hover definition \ud83d\udc4d", "author": "Strum355", "createdAt": "2020-09-09T12:30:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2OTYyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "1d27d680a42b9586b1123da6d9c23aca9da0169f", "chunk": "diff --git a/src/test/java/spoon/support/compiler/SpoonPomTest.java b/src/test/java/spoon/support/compiler/SpoonPomTest.java\nindex 80b12e4b..b2b57ddb 100644\n--- a/src/test/java/spoon/support/compiler/SpoonPomTest.java\n+++ b/src/test/java/spoon/support/compiler/SpoonPomTest.java\n\n@@ -66,6 +66,6 @@ public class SpoonPomTest {\n \t\tSpoonPom childModel = pomModel.getModules().get(0);\n \t\t//contract: source directory is derived from parent pom.xml if not declared in the current\n \t\t// (childModel) SpoonPom\n-\t\tassertEquals(expected, childModel.getSourceDirectories().get(0).getAbsolutePath(), expected);\n+\t\tassertEquals(expected, childModel.getSourceDirectories().get(0).getAbsolutePath());\n \t}\n }\n\\ No newline at end of file\n"}}, {"oid": "1d27d680a42b9586b1123da6d9c23aca9da0169f", "url": "https://github.com/INRIA/spoon/commit/1d27d680a42b9586b1123da6d9c23aca9da0169f", "message": "Added dummy file so folder exists for test case", "committedDate": "2020-09-09T12:29:47Z", "type": "commit"}, {"oid": "1d27d680a42b9586b1123da6d9c23aca9da0169f", "url": "https://github.com/INRIA/spoon/commit/1d27d680a42b9586b1123da6d9c23aca9da0169f", "message": "Added dummy file so folder exists for test case", "committedDate": "2020-09-09T12:29:47Z", "type": "forcePushed"}]}