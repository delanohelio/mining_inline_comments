{"pr_number": 2290, "pr_title": "expose current (named) and all (named) contexts", "pr_createdAt": "2020-06-15T23:42:26Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2290", "timeline": [{"oid": "c84996ec3e5779ce3e1018ebe9164bb056550433", "url": "https://github.com/fabric8io/kubernetes-client/commit/c84996ec3e5779ce3e1018ebe9164bb056550433", "message": "expose current (named) and all (named) contexts\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-16T08:17:50Z", "type": "forcePushed"}, {"oid": "3383b03cbca69c9bbd9787636ee0ab07b76069f9", "url": "https://github.com/fabric8io/kubernetes-client/commit/3383b03cbca69c9bbd9787636ee0ab07b76069f9", "message": "expose current (named) and all (named) contexts\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-16T11:38:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1NTYyNw==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r440955627", "bodyText": "Do you think we should maybe move this method to KubeConfigUtils?", "author": "rohanKanojia", "createdAt": "2020-06-16T15:46:26Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java", "diffHunk": "@@ -597,6 +599,20 @@ private static boolean loadFromKubeconfig(Config config, String context, String\n \n     return false;\n   }\n+\n+  private static Context setCurrentContext(String context, Config config, io.fabric8.kubernetes.api.model.Config kubeConfig) {", "originalCommit": "3383b03cbca69c9bbd9787636ee0ab07b76069f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1NzgyOA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r440957828", "bodyText": "I haven't look deeply but would we be able to resolve #1512 if we expose this as public?", "author": "rohanKanojia", "createdAt": "2020-06-16T15:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1NTYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA4OTc1Ng==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r441089756", "bodyText": "@rohanKanojia so the idea in #1512 is as far as I understand it is to be able to set the current context to the Config, right?\nThe challenge with this is that this implies an update to plenty of settings like the current cluster, namespace etc. It could be achieved by calling Config#autoConfigure behind the scene though. I'd rather fix this in its very own issue though.", "author": "adietish", "createdAt": "2020-06-16T19:25:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk1NTYyNw=="}], "type": "inlineReview", "revised_code": {"commit": "688f12ee26deda4b509408e50758d91d06186436", "chunk": "diff --git a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\nindex df37ae239..97c35f9f2 100644\n--- a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n+++ b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n\n@@ -601,10 +627,10 @@ public class Config {\n   }\n \n   private static Context setCurrentContext(String context, Config config, io.fabric8.kubernetes.api.model.Config kubeConfig) {\n-\tif (context != null) {\n-\t  kubeConfig.setCurrentContext(context);\n-\t}\n-\tContext currentContext = null;\n+    if (context != null) {\n+      kubeConfig.setCurrentContext(context);\n+    }\n+    Context currentContext = null;\n     NamedContext currentNamedContext = KubeConfigUtils.getCurrentContext(kubeConfig);\n     if (currentNamedContext != null) {\n       config.setCurrentContext(currentNamedContext);\n"}}, {"oid": "688f12ee26deda4b509408e50758d91d06186436", "url": "https://github.com/fabric8io/kubernetes-client/commit/688f12ee26deda4b509408e50758d91d06186436", "message": "Fix #2215: added tests for current/all context(s)\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-17T13:24:42Z", "type": "forcePushed"}, {"oid": "74b918a20c188f54fdfd0d1b376835bd8d780517", "url": "https://github.com/fabric8io/kubernetes-client/commit/74b918a20c188f54fdfd0d1b376835bd8d780517", "message": "Fix #2215: expose current (named) and all (named) contexts\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-17T13:26:27Z", "type": "commit"}, {"oid": "71e0876046d79ecb5d553f36c8a3ad77654d1454", "url": "https://github.com/fabric8io/kubernetes-client/commit/71e0876046d79ecb5d553f36c8a3ad77654d1454", "message": "Fix #2215: added tests for current/all context(s)\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-17T13:26:27Z", "type": "forcePushed"}, {"oid": "1ce27533e4bec06cf1c38259cf7fa80c9aa8a0e9", "url": "https://github.com/fabric8io/kubernetes-client/commit/1ce27533e4bec06cf1c38259cf7fa80c9aa8a0e9", "message": "Fix #2215: added tests for current/all context(s)\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-17T16:02:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMTM5Ng==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r442011396", "bodyText": "nit, Could you please use format specifiers?", "author": "rohanKanojia", "createdAt": "2020-06-18T07:05:45Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java", "diffHunk": "@@ -460,41 +477,52 @@ public static Config fromKubeconfig(String kubeconfigContents) throws IOExceptio\n   public static Config fromKubeconfig(String context, String kubeconfigContents, String kubeconfigPath) {\n     // we allow passing context along here, since downstream accepts it\n     Config config = new Config();\n-    Config.loadFromKubeconfig(config, context, kubeconfigContents, kubeconfigPath);\n+    loadFromKubeconfig(config, context, kubeconfigContents, kubeconfigPath);\n     return config;\n   }\n \n   private static boolean tryKubeConfig(Config config, String context) {\n     LOGGER.debug(\"Trying to configure client from Kubernetes config...\");\n-    if (Utils.getSystemPropertyOrEnvVar(KUBERNETES_AUTH_TRYKUBECONFIG_SYSTEM_PROPERTY, true)) {\n-      String fileName = Utils.getSystemPropertyOrEnvVar(KUBERNETES_KUBECONFIG_FILE, new File(getHomeDir(), \".kube\" + File.separator + \"config\").toString());\n+    if (!Utils.getSystemPropertyOrEnvVar(KUBERNETES_AUTH_TRYKUBECONFIG_SYSTEM_PROPERTY, true)) {\n+      return false;\n+    }\n+    File kubeConfigFile = new File(getKubeconfigFilename());\n+    if (!kubeConfigFile.isFile()) {\n+      LOGGER.debug(\"Did not find Kubernetes config at: [\"+kubeConfigFile.getPath()+\"]. Ignoring.\");", "originalCommit": "1ce27533e4bec06cf1c38259cf7fa80c9aa8a0e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0NDc2NA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r442044764", "bodyText": "nit, Could you please use format specifiers?\n\nyou mean the slf4j facility, right?", "author": "adietish", "createdAt": "2020-06-18T08:08:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxMTM5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "3e3ed455c79bad68484e845c984bef9c8273097d", "chunk": "diff --git a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\nindex 3f4962f2f..a58d78f2f 100644\n--- a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n+++ b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n\n@@ -488,7 +488,7 @@ public class Config {\n     }\n     File kubeConfigFile = new File(getKubeconfigFilename());\n     if (!kubeConfigFile.isFile()) {\n-      LOGGER.debug(\"Did not find Kubernetes config at: [\"+kubeConfigFile.getPath()+\"]. Ignoring.\");\n+      LOGGER.debug(\"Did not find Kubernetes config at: [{}]. Ignoring.\", kubeConfigFile.getPath());\n       return false;\n     }\n     LOGGER.debug(\"Found for Kubernetes config at: [{}].\", kubeConfigFile.getPath());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAxNDM0Ng==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2290#discussion_r442014346", "bodyText": "I would appreciate it if you could add some Javadoc to publicly available methods introduced in this PR.", "author": "rohanKanojia", "createdAt": "2020-06-18T07:12:17Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java", "diffHunk": "@@ -1128,4 +1170,21 @@ public void setOauthTokenProvider(OAuthTokenProvider oauthTokenProvider) {\n   public void setCustomHeaders(Map<String, String> customHeaders) {\n     this.customHeaders = customHeaders;\n   }\n+\n+  public List<NamedContext> getContexts() {", "originalCommit": "1ce27533e4bec06cf1c38259cf7fa80c9aa8a0e9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3e3ed455c79bad68484e845c984bef9c8273097d", "chunk": "diff --git a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\nindex 3f4962f2f..a58d78f2f 100644\n--- a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n+++ b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/Config.java\n\n@@ -1171,6 +1171,13 @@ public class Config {\n     this.customHeaders = customHeaders;\n   }\n \n+  /**\n+   * Returns all the {@link NamedContext}s that exist in the kube config\n+   * \n+   * @return all the contexts\n+   * \n+   * @see NamedContext\n+   */\n   public List<NamedContext> getContexts() {\n     return contexts;\n   }\n"}}, {"oid": "3e3ed455c79bad68484e845c984bef9c8273097d", "url": "https://github.com/fabric8io/kubernetes-client/commit/3e3ed455c79bad68484e845c984bef9c8273097d", "message": "Fix #2215: added tests for current/all context(s)\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-18T08:28:32Z", "type": "commit"}, {"oid": "3e3ed455c79bad68484e845c984bef9c8273097d", "url": "https://github.com/fabric8io/kubernetes-client/commit/3e3ed455c79bad68484e845c984bef9c8273097d", "message": "Fix #2215: added tests for current/all context(s)\n\nSigned-off-by: Andre Dietisheim <adietish@redhat.com>", "committedDate": "2020-06-18T08:28:32Z", "type": "forcePushed"}]}