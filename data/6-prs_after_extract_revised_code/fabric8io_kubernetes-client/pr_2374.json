{"pr_number": 2374, "pr_title": "Fix #2316: Cannot load resource from stream without apiVersion", "pr_createdAt": "2020-07-28T08:09:43Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2374", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NTU4Ng==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2374#discussion_r461495586", "bodyText": "Are we sure we want to return the first item found.\nThis means that PACKAGES must be sorted by order of preference (for packages providing same Types/Kinds). If so maybe we should document this somewhere.", "author": "manusa", "createdAt": "2020-07-28T11:00:05Z", "path": "kubernetes-model-generator/kubernetes-model-core/src/main/java/io/fabric8/kubernetes/internal/KubernetesDeserializer.java", "diffHunk": "@@ -248,16 +248,20 @@ private String getClassName(String key) {\n             // If only one class found, return it\n             if (possibleResults.size() == 1) {\n                 return possibleResults.get(0);\n-            }\n-\n-            // Compare with apiVersions being compared for set of classes found\n-            for (Class<? extends KubernetesResource> result : possibleResults) {\n+            } else if (possibleResults.size() > 1) {\n+              // Compare with apiVersions being compared for set of classes found\n+              for (Class<? extends KubernetesResource> result : possibleResults) {\n                 String defaultKeyFromClass = getKeyFromClass(result);\n                 if (key.equals(defaultKeyFromClass)) {\n-                    return result;\n+                  return result;\n                 }\n+              }\n+              // Not able to compare with apiVersions, perhaps it was not provided;\n+              // return first item found\n+              return possibleResults.get(0);", "originalCommit": "492d18ed5beedd517fd6c358f64bbc92cf8c8cae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUwMjY0MQ==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2374#discussion_r461502641", "bodyText": "I am also not sure whether returning first item found is good or not. But I thought if user wanted some specific apiVersion related resource. He should be providing apiVersion inside object", "author": "rohanKanojia", "createdAt": "2020-07-28T11:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NTU4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUwNDI4OA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2374#discussion_r461504288", "bodyText": "What I mean is that probably the PACKAGE array definition should have an n.b comment e.g.:\n// n.b. Packages sorted in order of precedence, deserialization of resources with no specific version will default to first available Class in one of these packages:", "author": "manusa", "createdAt": "2020-07-28T11:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NTU4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUwNDg5OA==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2374#discussion_r461504898", "bodyText": "Also unit tests for conflicting classes would help enforce list of entries doesn't get messed up (and can probably avoid the comment)", "author": "manusa", "createdAt": "2020-07-28T11:18:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ5NTU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ef19997f3ef0060e51ab67dd6d6b01165e3f44d4", "chunk": "diff --git a/kubernetes-model-generator/kubernetes-model-core/src/main/java/io/fabric8/kubernetes/internal/KubernetesDeserializer.java b/kubernetes-model-generator/kubernetes-model-core/src/main/java/io/fabric8/kubernetes/internal/KubernetesDeserializer.java\nindex 47a01125d..d02009327 100644\n--- a/kubernetes-model-generator/kubernetes-model-core/src/main/java/io/fabric8/kubernetes/internal/KubernetesDeserializer.java\n+++ b/kubernetes-model-generator/kubernetes-model-core/src/main/java/io/fabric8/kubernetes/internal/KubernetesDeserializer.java\n\n@@ -256,8 +259,6 @@ public class KubernetesDeserializer extends JsonDeserializer<KubernetesResource>\n                   return result;\n                 }\n               }\n-              // Not able to compare with apiVersions, perhaps it was not provided;\n-              // return first item found\n               return possibleResults.get(0);\n             } else {\n               return null;\n"}}, {"oid": "ef19997f3ef0060e51ab67dd6d6b01165e3f44d4", "url": "https://github.com/fabric8io/kubernetes-client/commit/ef19997f3ef0060e51ab67dd6d6b01165e3f44d4", "message": "Fix #2316: Cannot load resource from stream without apiVersion\n\nIn case of duplicate Kubernetes resources found, when no apiVersion\nis provided return first item found instead of null", "committedDate": "2020-07-28T14:21:41Z", "type": "forcePushed"}, {"oid": "522b07b73b7ab00f6b0f41bf76fe22a2e0553ceb", "url": "https://github.com/fabric8io/kubernetes-client/commit/522b07b73b7ab00f6b0f41bf76fe22a2e0553ceb", "message": "Fix #2316: Cannot load resource from stream without apiVersion\n\nIn case of duplicate Kubernetes resources found, when no apiVersion\nis provided return first item found instead of null", "committedDate": "2020-07-28T14:48:19Z", "type": "commit"}, {"oid": "522b07b73b7ab00f6b0f41bf76fe22a2e0553ceb", "url": "https://github.com/fabric8io/kubernetes-client/commit/522b07b73b7ab00f6b0f41bf76fe22a2e0553ceb", "message": "Fix #2316: Cannot load resource from stream without apiVersion\n\nIn case of duplicate Kubernetes resources found, when no apiVersion\nis provided return first item found instead of null", "committedDate": "2020-07-28T14:48:19Z", "type": "forcePushed"}]}