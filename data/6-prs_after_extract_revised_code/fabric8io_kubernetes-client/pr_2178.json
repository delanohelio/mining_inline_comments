{"pr_number": 2178, "pr_title": "Fix #2107: Set PropagationPolicy to Background by default", "pr_createdAt": "2020-04-29T17:27:52Z", "pr_url": "https://github.com/fabric8io/kubernetes-client/pull/2178", "timeline": [{"oid": "9a4aefeda2841afdaa9bd66e64b3e99125c7fb06", "url": "https://github.com/fabric8io/kubernetes-client/commit/9a4aefeda2841afdaa9bd66e64b3e99125c7fb06", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-04-29T18:14:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzc2NTUyNg==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2178#discussion_r417765526", "bodyText": "This JavaDoc will be scrambled when processed (no line breaks), try any of the proposed alternatives.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * Whether and how garbage collection will be performed.\n          \n          \n            \n               * Either this field or OrphanDependents may be set, but not both.\n          \n          \n            \n               * The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n          \n          \n            \n               * Acceptable values are:\n          \n          \n            \n               *    'Orphan' - orphan the dependents;\n          \n          \n            \n               *    'Background' - allow the garbage collector to delete the dependents in the background;\n          \n          \n            \n               *    'Foreground' - a cascading policy that deletes all dependents in the foreground.\n          \n          \n            \n               *\n          \n          \n            \n               * @param propagationPolicy propagation policy in form of string\n          \n          \n            \n               * @return resource\n          \n          \n            \n               */\n          \n          \n            \n              /**\n          \n          \n            \n               * Whether and how garbage collection will be performed.\n          \n          \n            \n               * Either this field or OrphanDependents may be set, but not both.\n          \n          \n            \n               *\n          \n          \n            \n               * <p>The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n          \n          \n            \n               * \n          \n          \n            \n               * <p>Acceptable values are:\n          \n          \n            \n               * <ul>\n          \n          \n            \n               * <li>'Orphan' - orphan the dependents;</li>\n          \n          \n            \n               * <li>'Background' - allow the garbage collector to delete the dependents in the background;</li>\n          \n          \n            \n               * <li>'Foreground' - a cascading policy that deletes all dependents in the foreground.</li>\n          \n          \n            \n               * </ul>\n          \n          \n            \n               *\n          \n          \n            \n               * @param propagationPolicy propagation policy in form of string\n          \n          \n            \n               * @return resource\n          \n          \n            \n               */\n          \n      \n    \n    \n  \n\nOr:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /**\n          \n          \n            \n               * Whether and how garbage collection will be performed.\n          \n          \n            \n               * Either this field or OrphanDependents may be set, but not both.\n          \n          \n            \n               * The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n          \n          \n            \n               * Acceptable values are:\n          \n          \n            \n               *    'Orphan' - orphan the dependents;\n          \n          \n            \n               *    'Background' - allow the garbage collector to delete the dependents in the background;\n          \n          \n            \n               *    'Foreground' - a cascading policy that deletes all dependents in the foreground.\n          \n          \n            \n               *\n          \n          \n            \n               * @param propagationPolicy propagation policy in form of string\n          \n          \n            \n               * @return resource\n          \n          \n            \n               */\n          \n          \n            \n              /**\n          \n          \n            \n               * Whether and how garbage collection will be performed.\n          \n          \n            \n               * Either this field or OrphanDependents may be set, but not both.\n          \n          \n            \n               *\n          \n          \n            \n               * <p>The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n          \n          \n            \n               *\n          \n          \n            \n               * <p>Acceptable values are:\n          \n          \n            \n               * <br>Orphan' - orphan the dependents;</li>\n          \n          \n            \n               * <br>Background' - allow the garbage collector to delete the dependents in the background;</li>\n          \n          \n            \n               * <br>Foreground' - a cascading policy that deletes all dependents in the foreground.</li>\n          \n          \n            \n               *\n          \n          \n            \n               * @param propagationPolicy propagation policy in form of string\n          \n          \n            \n               * @return resource\n          \n          \n            \n               */", "author": "manusa", "createdAt": "2020-04-30T05:43:10Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/PropagationPolicyConfigurable.java", "diffHunk": "@@ -17,5 +17,17 @@\n \n public interface PropagationPolicyConfigurable<T>\n {\n+  /**\n+   * Whether and how garbage collection will be performed.\n+   * Either this field or OrphanDependents may be set, but not both.\n+   * The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n+   * Acceptable values are:\n+   *    'Orphan' - orphan the dependents;\n+   *    'Background' - allow the garbage collector to delete the dependents in the background;\n+   *    'Foreground' - a cascading policy that deletes all dependents in the foreground.\n+   *\n+   * @param propagationPolicy propagation policy in form of string\n+   * @return resource\n+   */", "originalCommit": "9a4aefeda2841afdaa9bd66e64b3e99125c7fb06", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d53a50afc347e5324205c47c6540a815add93b41", "chunk": "diff --git a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/PropagationPolicyConfigurable.java b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/PropagationPolicyConfigurable.java\nindex 35347e535..70dd9b72c 100644\n--- a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/PropagationPolicyConfigurable.java\n+++ b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/PropagationPolicyConfigurable.java\n\n@@ -20,13 +20,15 @@ public interface PropagationPolicyConfigurable<T>\n   /**\n    * Whether and how garbage collection will be performed.\n    * Either this field or OrphanDependents may be set, but not both.\n-   * The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n-   * Acceptable values are:\n-   *    'Orphan' - orphan the dependents;\n-   *    'Background' - allow the garbage collector to delete the dependents in the background;\n-   *    'Foreground' - a cascading policy that deletes all dependents in the foreground.\n    *\n-   * @param propagationPolicy propagation policy in form of string\n+   * <p>The default policy is decided by the existing finalizer set in the metadata.finalizers and the resource-specific default policy.\n+   *\n+   * <p>Acceptable values are:\n+   * <br>'Orphan' - orphan the dependents;</li>\n+   * <br>'Background' - allow the garbage collector to delete the dependents in the background;</li>\n+   * <br>'Foreground' - a cascading policy that deletes all dependents in the foreground.</li>\n+   *\n+   * @param propagationPolicy propagation policy in form of string {@link io.fabric8.kubernetes.api.model.DeletionPropagation}\n    * @return resource\n    */\n     T withPropagationPolicy(String propagationPolicy);\n"}}, {"oid": "d53a50afc347e5324205c47c6540a815add93b41", "url": "https://github.com/fabric8io/kubernetes-client/commit/d53a50afc347e5324205c47c6540a815add93b41", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-04-30T09:19:39Z", "type": "forcePushed"}, {"oid": "0036b6767622912ca33776b9a0c20576c9a0ec92", "url": "https://github.com/fabric8io/kubernetes-client/commit/0036b6767622912ca33776b9a0c20576c9a0ec92", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-04-30T14:30:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODEwMzc2Mw==", "url": "https://github.com/fabric8io/kubernetes-client/pull/2178#discussion_r418103763", "bodyText": "This check shouldn't be necessary any more as we are using an enum", "author": "manusa", "createdAt": "2020-04-30T15:39:01Z", "path": "kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/base/OperationSupport.java", "diffHunk": "@@ -221,7 +224,10 @@ protected void handleDelete(URL requestUrl, long gracePeriodSeconds, String prop\n      * Either the propagation policy or the orphan dependent (deprecated) property must be set, but not both.\n      */\n     if (propagationPolicy != null) {\n-      deleteOptions.setPropagationPolicy(propagationPolicy);\n+      if (Arrays.stream(DeletionPropagation.values()).noneMatch(deletionPropagation -> deletionPropagation.name().equals(propagationPolicy))) {\n+        logger.warn(\"Unknown DeletionPropagation policy used for deletion: {}\", propagationPolicy);\n+      }", "originalCommit": "0036b6767622912ca33776b9a0c20576c9a0ec92", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7fe8c8309decdd42e7361b3e90e1ae54fcbe6a89", "chunk": "diff --git a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/base/OperationSupport.java b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/base/OperationSupport.java\nindex 67b42e84d..28511da5c 100644\n--- a/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/base/OperationSupport.java\n+++ b/kubernetes-client/src/main/java/io/fabric8/kubernetes/client/dsl/base/OperationSupport.java\n\n@@ -224,9 +224,6 @@ public class OperationSupport {\n      * Either the propagation policy or the orphan dependent (deprecated) property must be set, but not both.\n      */\n     if (propagationPolicy != null) {\n-      if (Arrays.stream(DeletionPropagation.values()).noneMatch(deletionPropagation -> deletionPropagation.name().equals(propagationPolicy))) {\n-        logger.warn(\"Unknown DeletionPropagation policy used for deletion: {}\", propagationPolicy);\n-      }\n       deleteOptions.setPropagationPolicy(propagationPolicy.toString());\n     } else {\n       deleteOptions.setOrphanDependents(!cascading);\n"}}, {"oid": "7fe8c8309decdd42e7361b3e90e1ae54fcbe6a89", "url": "https://github.com/fabric8io/kubernetes-client/commit/7fe8c8309decdd42e7361b3e90e1ae54fcbe6a89", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-04-30T16:47:41Z", "type": "forcePushed"}, {"oid": "15290ebc60c2e1a1149d3d2fe85737e95125653a", "url": "https://github.com/fabric8io/kubernetes-client/commit/15290ebc60c2e1a1149d3d2fe85737e95125653a", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-05-01T06:55:33Z", "type": "commit"}, {"oid": "15290ebc60c2e1a1149d3d2fe85737e95125653a", "url": "https://github.com/fabric8io/kubernetes-client/commit/15290ebc60c2e1a1149d3d2fe85737e95125653a", "message": "Fix #2107: Set PropagationPolicy to Background by default", "committedDate": "2020-05-01T06:55:33Z", "type": "forcePushed"}]}