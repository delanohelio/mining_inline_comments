{"pr_number": 4031, "pr_title": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language", "pr_createdAt": "2020-01-31T22:15:36Z", "pr_url": "https://github.com/apache/nifi/pull/4031", "timeline": [{"oid": "0245a2ffb33d0d51a29aa9a6a7a2e30cc43ee2e3", "url": "https://github.com/apache/nifi/commit/0245a2ffb33d0d51a29aa9a6a7a2e30cc43ee2e3", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-01-31T22:16:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA5OTcyNw==", "url": "https://github.com/apache/nifi/pull/4031#discussion_r376099727", "bodyText": "I think this is throwing a NullRef when the attribute referenced doesn't exist", "author": "shayneburgess", "createdAt": "2020-02-06T21:46:02Z", "path": "nifi-commons/nifi-expression-language/src/main/java/org/apache/nifi/attribute/expression/language/evaluation/functions/Uuid3Evaluator.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.nifi.attribute.expression.language.evaluation.functions;\n+\n+import org.apache.nifi.attribute.expression.language.EvaluationContext;\n+import org.apache.nifi.attribute.expression.language.evaluation.Evaluator;\n+import org.apache.nifi.attribute.expression.language.evaluation.QueryResult;\n+import org.apache.nifi.attribute.expression.language.evaluation.StringEvaluator;\n+import org.apache.nifi.attribute.expression.language.evaluation.StringQueryResult;\n+\n+import java.nio.ByteBuffer;\n+import java.util.Objects;\n+import java.util.UUID;\n+import org.apache.commons.lang3.ArrayUtils;\n+\n+public class Uuid3Evaluator extends StringEvaluator {\n+\n+    private final Evaluator<String> subject;\n+    private final Evaluator<String> namespace;\n+\n+    public Uuid3Evaluator(final Evaluator<String> subject, final Evaluator<String> namespace) {\n+        this.subject = subject;\n+        this.namespace = namespace;\n+    }\n+\n+    @Override\n+    public QueryResult<String> evaluate(final EvaluationContext evaluationContext) {\n+        final String subjectValue = subject.evaluate(evaluationContext).getValue();\n+        final String nsValue = namespace.evaluate(evaluationContext).getValue();\n+        final UUID nsUUID = UUID.fromString(Objects.requireNonNull(nsValue));\n+\n+        final byte[] nsBytes =\n+            ByteBuffer.wrap(new byte[16])\n+                .putLong(nsUUID.getMostSignificantBits())\n+                .putLong(nsUUID.getLeastSignificantBits())\n+                .array();\n+\n+        final byte[] subjectBytes = Objects.requireNonNull(subjectValue).getBytes();", "originalCommit": "0245a2ffb33d0d51a29aa9a6a7a2e30cc43ee2e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE5NTAzNQ==", "url": "https://github.com/apache/nifi/pull/4031#discussion_r376195035", "bodyText": "Fixed. Returns new StringQueryResult(null) now if the subject is null.", "author": "jfrazee", "createdAt": "2020-02-07T03:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjA5OTcyNw=="}], "type": "inlineReview", "revised_code": {"commit": "2cf46ac1bdc06ceb001a0325615cc6c422e2156f", "chunk": "diff --git a/nifi-commons/nifi-expression-language/src/main/java/org/apache/nifi/attribute/expression/language/evaluation/functions/Uuid3Evaluator.java b/nifi-commons/nifi-expression-language/src/main/java/org/apache/nifi/attribute/expression/language/evaluation/functions/Uuid3Evaluator.java\nindex d4339944bc..70b722b558 100644\n--- a/nifi-commons/nifi-expression-language/src/main/java/org/apache/nifi/attribute/expression/language/evaluation/functions/Uuid3Evaluator.java\n+++ b/nifi-commons/nifi-expression-language/src/main/java/org/apache/nifi/attribute/expression/language/evaluation/functions/Uuid3Evaluator.java\n\n@@ -40,8 +40,11 @@ public class Uuid3Evaluator extends StringEvaluator {\n     @Override\n     public QueryResult<String> evaluate(final EvaluationContext evaluationContext) {\n         final String subjectValue = subject.evaluate(evaluationContext).getValue();\n+        if (subjectValue == null) {\n+            return new StringQueryResult(null);\n+        }\n         final String nsValue = namespace.evaluate(evaluationContext).getValue();\n-        final UUID nsUUID = UUID.fromString(Objects.requireNonNull(nsValue));\n+        final UUID nsUUID = nsValue == null ? new UUID(0, 0) : UUID.fromString(nsValue);\n \n         final byte[] nsBytes =\n             ByteBuffer.wrap(new byte[16])\n"}}, {"oid": "2cf46ac1bdc06ceb001a0325615cc6c422e2156f", "url": "https://github.com/apache/nifi/commit/2cf46ac1bdc06ceb001a0325615cc6c422e2156f", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-02-07T02:45:22Z", "type": "forcePushed"}, {"oid": "f39e195294ec09fddb6c9cdfab75a88f7084c96b", "url": "https://github.com/apache/nifi/commit/f39e195294ec09fddb6c9cdfab75a88f7084c96b", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-02-07T02:57:45Z", "type": "forcePushed"}, {"oid": "2b5899b7d54c2474d842d799a0b6aaeb1579ac35", "url": "https://github.com/apache/nifi/commit/2b5899b7d54c2474d842d799a0b6aaeb1579ac35", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-02-07T03:11:01Z", "type": "forcePushed"}, {"oid": "b2d2b317bcf84acdfb013a60dce69dc4d319cda8", "url": "https://github.com/apache/nifi/commit/b2d2b317bcf84acdfb013a60dce69dc4d319cda8", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-02-07T21:42:59Z", "type": "forcePushed"}, {"oid": "ccb62826b7a3a9434f3cc078e9af292f1c67f0a0", "url": "https://github.com/apache/nifi/commit/ccb62826b7a3a9434f3cc078e9af292f1c67f0a0", "message": "NIFI-6791 Add UUID3 and UUID5 functions to Expression Language\n\nThis closes #4031", "committedDate": "2020-02-27T20:57:55Z", "type": "commit"}, {"oid": "ddfc425d9867f4247bb1ec88e8dba97a5fe642e0", "url": "https://github.com/apache/nifi/commit/ddfc425d9867f4247bb1ec88e8dba97a5fe642e0", "message": "Bump commons-lang3 and commons-codec versions", "committedDate": "2020-02-27T20:57:55Z", "type": "commit"}, {"oid": "ddfc425d9867f4247bb1ec88e8dba97a5fe642e0", "url": "https://github.com/apache/nifi/commit/ddfc425d9867f4247bb1ec88e8dba97a5fe642e0", "message": "Bump commons-lang3 and commons-codec versions", "committedDate": "2020-02-27T20:57:55Z", "type": "forcePushed"}, {"oid": "60b6327757aaf23b0f93acd4c27bdb5d45e40732", "url": "https://github.com/apache/nifi/commit/60b6327757aaf23b0f93acd4c27bdb5d45e40732", "message": "Merge branch 'master' into NIFI-6791", "committedDate": "2020-03-15T13:26:44Z", "type": "commit"}]}