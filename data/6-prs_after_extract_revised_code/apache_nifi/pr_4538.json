{"pr_number": 4538, "pr_title": "NIFI-7817 - Fix ParquetReader instantiation error", "pr_createdAt": "2020-09-19T13:18:18Z", "pr_url": "https://github.com/apache/nifi/pull/4538", "timeline": [{"oid": "fa62d03d9cbf6bc2b225ae9e85610bd8e85baece", "url": "https://github.com/apache/nifi/commit/fa62d03d9cbf6bc2b225ae9e85610bd8e85baece", "message": "NIFI-7817 - Fix ParquetReader instantiation error", "committedDate": "2020-09-19T13:14:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4NTU3NQ==", "url": "https://github.com/apache/nifi/pull/4538#discussion_r492285575", "bodyText": "The COMPRESSION_TYPE PropertyDescriptor has a list of allowable values and it also has a default value using the first value which is UNCOMPRESSED, anything with a default value should always return a value so that is why the code didn't check isSet() before.\nI'm not terribly offended adding this as an extra precaution, but I am concerned that something else broke that now makes the default value not return.", "author": "bbende", "createdAt": "2020-09-21T19:09:32Z", "path": "nifi-nar-bundles/nifi-parquet-bundle/nifi-parquet-processors/src/main/java/org/apache/nifi/parquet/utils/ParquetUtils.java", "diffHunk": "@@ -168,9 +168,11 @@ public static ParquetConfig createParquetConfig(final PropertyContext context, f\n         final ParquetFileWriter.Mode mode = overwrite ? ParquetFileWriter.Mode.OVERWRITE : ParquetFileWriter.Mode.CREATE;\n         parquetConfig.setWriterMode(mode);\n \n-        final String compressionTypeValue = context.getProperty(ParquetUtils.COMPRESSION_TYPE).getValue();\n-        final CompressionCodecName codecName = CompressionCodecName.valueOf(compressionTypeValue);\n-        parquetConfig.setCompressionCodec(codecName);\n+        if(context.getProperty(ParquetUtils.COMPRESSION_TYPE).isSet()) {\n+            final String compressionTypeValue = context.getProperty(ParquetUtils.COMPRESSION_TYPE).getValue();\n+            final CompressionCodecName codecName = CompressionCodecName.valueOf(compressionTypeValue);\n+            parquetConfig.setCompressionCodec(codecName);\n+        }", "originalCommit": "fa62d03d9cbf6bc2b225ae9e85610bd8e85baece", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI5MTg1MA==", "url": "https://github.com/apache/nifi/pull/4538#discussion_r492291850", "bodyText": "There is no COMPRESSION_TYPE PropertyDescriptor in the ParquetReader controller service which is causing the NPE initially discussed in #4537.", "author": "pvillard31", "createdAt": "2020-09-21T19:20:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4NTU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI5NTA1Mw==", "url": "https://github.com/apache/nifi/pull/4538#discussion_r492295053", "bodyText": "That is correct, but we always called ParquetUtils createParquetConfig  from both the reader and writer before and it worked, so I'm confused why now we have to check isSet().\nThe JIRA mentioned https://issues.apache.org/jira/browse/NIFI-7635  so maybe that fix now makes it such that if you call context.getProperty(ParquetUtils.COMPRESSION_TYPE).getValue() and the component doesn't have that property then you no longer get the default value. Before you did get the default value.", "author": "bbende", "createdAt": "2020-09-21T19:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4NTU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI5OTEwOQ==", "url": "https://github.com/apache/nifi/pull/4538#discussion_r492299109", "bodyText": "This is most likely because of this change: 4f11e36#diff-782335ecee68f6939c3724dba3983d3d\nThat's definitely a good question though: did this impact only this Parquet controller service or did it impact other components? custom code/NARs/etc?", "author": "pvillard31", "createdAt": "2020-09-21T19:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4NTU3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjMyMDM4MQ==", "url": "https://github.com/apache/nifi/pull/4538#discussion_r492320381", "bodyText": "PR #4537 aimed to allow previous functionality to work as it did in previous versions of NiFi. However, the resolution order changed to also address NIFI-7635. In that PR, the resolvedValue was determined in this order:\n\nconfiguredValue\ndefault value from the ComponentNode\ndefault value from the PropertyDescriptor\n\nWhereas in earlier versions of NiFi (pre 1.12.0), the resolution was done in this order:\n\nconfiguredValue\ndefault value from the PropertyDescriptor\ndefault value from the ComponentNode", "author": "frankgh", "createdAt": "2020-09-21T20:15:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4NTU3NQ=="}], "type": "inlineReview", "revised_code": null}]}