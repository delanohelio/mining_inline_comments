{"pr_number": 210, "pr_title": "Copybook references", "pr_createdAt": "2020-02-19T15:50:39Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210", "timeline": [{"oid": "fcf3faf4289b1477438fac7c86fe65f1bca14991", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/fcf3faf4289b1477438fac7c86fe65f1bca14991", "message": "added implementation for copybook autocomplete from cobol document and fixed tests\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-05T15:35:59Z", "type": "commit"}, {"oid": "809c5fc662ef26bcff412b1d76177ddae7fa01f9", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/809c5fc662ef26bcff412b1d76177ddae7fa01f9", "message": "added junit test for CopybookCompletion class\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-06T11:13:36Z", "type": "commit"}, {"oid": "5db920082b39a37981a15ed80195422d9f9fe473", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5db920082b39a37981a15ed80195422d9f9fe473", "message": "adding CopybookCompletionsTest to AllTests\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-06T11:15:09Z", "type": "commit"}, {"oid": "abc86d84d7b3afe38d4c163a0f7e8b1e96079dec", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/abc86d84d7b3afe38d4c163a0f7e8b1e96079dec", "message": "Merge branch 'development' into copybooks_autocomplete", "committedDate": "2020-02-06T11:16:32Z", "type": "commit"}, {"oid": "be2164c03d20b40d205455f83e2b5160d465878e", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/be2164c03d20b40d205455f83e2b5160d465878e", "message": "Merge branch 'development' into copybooks_autocomplete", "committedDate": "2020-02-06T13:11:36Z", "type": "commit"}, {"oid": "4306d075f8b0d2eb96f5061d39815a26ef62c314", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4306d075f8b0d2eb96f5061d39815a26ef62c314", "message": "added javadocs annotation for both CopybookCompletion and CopybookCompletionTest\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-06T13:12:28Z", "type": "commit"}, {"oid": "b26663b4fb784b5905dfc6e45f747c774570cb38", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/b26663b4fb784b5905dfc6e45f747c774570cb38", "message": "reverted back packagejson and packagelock fixing naming issue and adding missing entry to testmodule\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-07T10:08:46Z", "type": "commit"}, {"oid": "24159302f51cfb90a654e783fb2285b8f098ac8a", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/24159302f51cfb90a654e783fb2285b8f098ac8a", "message": "Merge branch 'development' into copybooks_autocomplete", "committedDate": "2020-02-07T10:09:52Z", "type": "commit"}, {"oid": "67daa43dfa1773437cf6c2c999899ea203a96ee8", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/67daa43dfa1773437cf6c2c999899ea203a96ee8", "message": "fixed packagelock\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-07T10:20:41Z", "type": "commit"}, {"oid": "268de2b070d869f81f4206a98220a377206a9507", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/268de2b070d869f81f4206a98220a377206a9507", "message": "Merge branch 'development' into copybooks_autocomplete", "committedDate": "2020-02-11T11:09:45Z", "type": "commit"}, {"oid": "71f74592f67e3a9351aec176ef4a2978dd4319b2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/71f74592f67e3a9351aec176ef4a2978dd4319b2", "message": "added implementation for copybook usage reference\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-11T13:24:21Z", "type": "commit"}, {"oid": "ffed222c5d6db8a0092513aafd2728393afbca48", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/ffed222c5d6db8a0092513aafd2728393afbca48", "message": "Merge branch 'development' into copybook_references", "committedDate": "2020-02-17T14:13:53Z", "type": "commit"}, {"oid": "bbe37b4853c7b54f54afbc8dc17aa53829b6ee7f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/bbe37b4853c7b54f54afbc8dc17aa53829b6ee7f", "message": "merging development\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-18T10:28:28Z", "type": "commit"}, {"oid": "22c65eecc40494b42b065389941cc47b4cfb02b2", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/22c65eecc40494b42b065389941cc47b4cfb02b2", "message": "adding implementation for copybook references\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-18T10:31:14Z", "type": "commit"}, {"oid": "1bafc35ff2fa80ce3a26cafb584db5dd48b16468", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1bafc35ff2fa80ce3a26cafb584db5dd48b16468", "message": "Merge branch 'development' into copybook_references", "committedDate": "2020-02-19T10:14:44Z", "type": "commit"}, {"oid": "4fe7b57ac92950b3d000835477afa62bc13b86e6", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4fe7b57ac92950b3d000835477afa62bc13b86e6", "message": "Merge branch 'development' into copybook_references", "committedDate": "2020-02-19T15:30:01Z", "type": "commit"}, {"oid": "dfc6df1dbd9e2c12d6478efd88203793351f6409", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/dfc6df1dbd9e2c12d6478efd88203793351f6409", "message": "added test for copybook references and adjustted copybooks to show on usages\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-19T15:32:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzAzNg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r381877036", "bodyText": "It seems like the problem with the test caused by this line. I think define() here should be also replaced with addUsage()", "author": "temanbrcom", "createdAt": "2020-02-20T09:26:44Z", "path": "com.ca.lsp.cobol/lsp-core-cobol-parser/src/main/java/com/ca/lsp/core/cobol/preprocessor/sub/document/impl/CobolSemanticParserListenerImpl.java", "diffHunk": "@@ -193,7 +193,7 @@ private void defineCopybook(String copybookName, Position position) {\n       return;\n     }\n     if (checkThisCopybookNotPresentInHierarchy(copybookName)) {\n-      semanticContext.getCopybooks().define(copybookName, position);\n+      semanticContext.getCopybooks().addUsage(copybookName, position);\n       semanticContext.getVariables().define(new Variable(\"-1\", copybookName), position);", "originalCommit": "dfc6df1dbd9e2c12d6478efd88203793351f6409", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3OTMyNQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r381879325", "bodyText": "Also, try to replace definitions call in CobolVariableContext#buildVariableStructure() with one for usages", "author": "temanbrcom", "createdAt": "2020-02-20T09:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzAzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY1NzkxOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r382657919", "bodyText": "It was not that, the problem was in CobolSemanticParserImpl#processCopybooks", "author": "temanbrcom", "createdAt": "2020-02-21T15:51:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg3NzAzNg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb", "message": "Make copybook processing work with usages, not with definitions #107", "committedDate": "2020-02-21T15:50:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEyMDUzOQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/210#discussion_r383120539", "bodyText": "could you please provide a negative scenario as well in which you will try to get a reference and there is none", "author": "sergiuilie", "createdAt": "2020-02-24T08:00:32Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/test/java/com/ca/lsp/cobol/service/delegates/references/DocumentOccurrencesTest.java", "diffHunk": "@@ -159,6 +175,23 @@ public void testFindDeclarationForParagraph() throws ExecutionException, Interru\n     assertContainsRange(locations, range(15, 7, TEST_LENGTH));\n   }\n \n+  @Test\n+  public void testFindMultipleCopybookReferences() throws ExecutionException, InterruptedException {\n+    List<? extends Location> locations = invokeReferencesRequest(TEST_COPYBOOK1, true);\n+    assertEquals(2, locations.size());\n+\n+    assertContainsRange(locations, range(20, 12, COPY_LENGTH));\n+    assertContainsRange(locations, range(22, 12, COPY_LENGTH));\n+  }\n+\n+  @Test\n+  public void testFindSingleCopybookReference() throws ExecutionException, InterruptedException {\n+    List<? extends Location> locations = invokeReferencesRequest(TEST_COPYBOOK2, true);\n+    assertEquals(1, locations.size());\n+\n+    assertContainsRange(locations, range(21, 12, COPY_LENGTH));", "originalCommit": "8dd61b5f383f8e711c1c23a91db31cd5c55dc8eb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "09c712958ecd63779de703470a6ef5fdf0bd3d48", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/09c712958ecd63779de703470a6ef5fdf0bd3d48", "message": "Merge branch 'development' into copybook_references", "committedDate": "2020-02-24T09:43:21Z", "type": "commit"}, {"oid": "4b16807c4cb579b0a30215fde762eb7ab33a4843", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/4b16807c4cb579b0a30215fde762eb7ab33a4843", "message": "resolving conflicts\n\nSigned-off-by: Ramy Abdalla <ramy.abdalla@broadcom.com>", "committedDate": "2020-02-24T10:45:03Z", "type": "commit"}]}