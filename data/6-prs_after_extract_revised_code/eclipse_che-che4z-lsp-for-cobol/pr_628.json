{"pr_number": 628, "pr_title": "fix: Copybook with Name in Quotes Not Recognized #620", "pr_createdAt": "2020-11-09T12:56:13Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628", "timeline": [{"oid": "603abc8b6be19a7d34aae0c7f15158388bc88314", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/603abc8b6be19a7d34aae0c7f15158388bc88314", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-09T13:31:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgxNzQ3Ng==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#discussion_r519817476", "bodyText": "Please, use PreprocessorStringUtils#trimQuotes instead", "author": "temanbrcom", "createdAt": "2020-11-09T13:34:15Z", "path": "server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java", "diffHunk": "@@ -336,7 +337,7 @@ private String retrieveCopybookName(@NonNull CopySourceContext copySource) {\n   }\n \n   private String retrieveCopybookName(@NonNull RuleContext context) {\n-    return context.getText().toUpperCase();\n+    return CopybookHelper.normalizeName(context.getText());", "originalCommit": "603abc8b6be19a7d34aae0c7f15158388bc88314", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5e82191d2d7edb7374a4b90da0b0529d880a8571", "chunk": "diff --git a/server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java b/server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java\nindex 87045636..90c1a920 100644\n--- a/server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java\n+++ b/server/src/main/java/com/broadcom/lsp/cobol/core/preprocessor/delegates/GrammarPreprocessorListenerImpl.java\n\n@@ -337,7 +337,7 @@ public class GrammarPreprocessorListenerImpl extends CobolPreprocessorBaseListen\n   }\n \n   private String retrieveCopybookName(@NonNull RuleContext context) {\n-    return CopybookHelper.normalizeName(context.getText());\n+    return PreprocessorStringUtils.trimQuotes(context.getText().toUpperCase());\n   }\n \n   private String retrieveCopybookId() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgyNjc5OQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/628#discussion_r519826799", "bodyText": "Please, add also a check for double-quotes.", "author": "temanbrcom", "createdAt": "2020-11-09T13:49:02Z", "path": "server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package com.broadcom.lsp.cobol.usecases;\n+\n+import com.broadcom.lsp.cobol.positive.CobolText;\n+import com.broadcom.lsp.cobol.usecases.engine.UseCaseEngine;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * This test checks that the copybook name with quotes processed successfully\n+ */\n+class TestCopybookNameWithQuotes {\n+  private static final String TEXT =\n+          \"        IDENTIFICATION DIVISION.\\n\"\n+          + \"          PROGRAM-ID. PARTEST.\\n\"\n+          + \"          DATA DIVISION.\\n\"\n+          + \"          WORKING-STORAGE SECTION.\\n\"\n+          + \"          PROCEDURE DIVISION.\\n\"\n+          + \"            COPY {~'CPBTEST'}.\\n\";", "originalCommit": "603abc8b6be19a7d34aae0c7f15158388bc88314", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5e82191d2d7edb7374a4b90da0b0529d880a8571", "chunk": "diff --git a/server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java b/server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java\nindex 96dabe4a..308bf5e4 100644\n--- a/server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java\n+++ b/server/src/test/java/com/broadcom/lsp/cobol/usecases/TestCopybookNameWithQuotes.java\n\n@@ -16,15 +16,22 @@ class TestCopybookNameWithQuotes {\n           + \"          PROGRAM-ID. PARTEST.\\n\"\n           + \"          DATA DIVISION.\\n\"\n           + \"          WORKING-STORAGE SECTION.\\n\"\n-          + \"          PROCEDURE DIVISION.\\n\"\n-          + \"            COPY {~'CPBTEST'}.\\n\";\n+          + \"          PROCEDURE DIVISION.\\n\";\n+\n+  private static final String QUITES_LOWERCASE = \"            COPY {~'cpbtest'}.\\n\";\n+  private static final String DOUBLE_QUITES = \"            COPY {~'CPBTEST'}.\\n\";\n \n   private static final String COPYBOOK =\n       \"         {#*PROGA}.\";\n \n   @Test\n-  void assertCopybookProcessingModeNotChangesLogic() {\n-    UseCaseEngine.runTest(TEXT, List.of(new CobolText(\"CPBTEST\", COPYBOOK)), Map.of());\n+  void assertCopybookWithQuotesProcessing() {\n+    UseCaseEngine.runTest(TEXT + QUITES_LOWERCASE, List.of(new CobolText(\"CPBTEST\", COPYBOOK)), Map.of());\n+  }\n+\n+  @Test\n+  void assertCopybookWithDoubleQuotesProcessing() {\n+    UseCaseEngine.runTest(TEXT + DOUBLE_QUITES, List.of(new CobolText(\"CPBTEST\", COPYBOOK)), Map.of());\n   }\n \n }\n"}}, {"oid": "5e82191d2d7edb7374a4b90da0b0529d880a8571", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/5e82191d2d7edb7374a4b90da0b0529d880a8571", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-09T14:22:52Z", "type": "forcePushed"}, {"oid": "1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1a3c1e0d09cb38ff98e63ea80af5d7ae5c142c31", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-09T14:26:10Z", "type": "forcePushed"}, {"oid": "1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/1b4e58f363a0fbbccb2c7c2252d069054f5a5d50", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T10:41:32Z", "type": "forcePushed"}, {"oid": "24525cb17e126e51cb26edf4f981479a302dc834", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/24525cb17e126e51cb26edf4f981479a302dc834", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T10:59:58Z", "type": "forcePushed"}, {"oid": "7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/7ee385fd6712b3cb8c7be0c6cb74b38404edae87", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T11:58:11Z", "type": "forcePushed"}, {"oid": "594f50b77a39ada424fae81ac3573a0486ccae6f", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/594f50b77a39ada424fae81ac3573a0486ccae6f", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T13:16:41Z", "type": "forcePushed"}, {"oid": "729997cc5fb29130f989a92f81933d842b18bc43", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/729997cc5fb29130f989a92f81933d842b18bc43", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T13:47:16Z", "type": "commit"}, {"oid": "729997cc5fb29130f989a92f81933d842b18bc43", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/729997cc5fb29130f989a92f81933d842b18bc43", "message": "fix: Copybook with Name in Quotes Not Recognized #620\n\nSigned-off-by: Leonid Baranov <leonid.baranov@broadcom.com>", "committedDate": "2020-11-10T13:47:16Z", "type": "forcePushed"}]}