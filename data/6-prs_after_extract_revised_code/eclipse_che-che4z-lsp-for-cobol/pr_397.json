{"pr_number": 397, "pr_title": "Avoid many error messages for copybook downloading", "pr_createdAt": "2020-06-17T10:38:37Z", "pr_url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NDEwMw==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441494103", "bodyText": "'DoneAnalysisEvent' sounds a little strange, but still applicable. Maybe, something like `AnalysisFinishedEvent' would be more descriptive?", "author": "temanbrcom", "createdAt": "2020-06-17T12:05:43Z", "path": "com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.broadcom.lsp.domain.cobol.event.model;\n+\n+import lombok.Builder;\n+import lombok.Data;\n+import lombok.NoArgsConstructor;\n+\n+/**\n+ * This class is a data transfer object that contains the uri of analyzed document.\n+ */\n+@NoArgsConstructor\n+@Data\n+public class DoneAnalysisEvent extends DataEvent{", "originalCommit": "0fc82cadf18fc40613375da3187b25802ed268a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU4OTI3NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441589274", "bodyText": "I was inspired by the RunAnalysisEvent. In fact, I'm also don't like this name. I'll change it to AnalysisFinishedEvent.", "author": "grianbrcom", "createdAt": "2020-06-17T14:28:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NDEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MjUzMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441592531", "bodyText": "AnalysisFinishedEvent --> AnalysisCompletionEvent we use Completion term in lsp", "author": "asatklichov", "createdAt": "2020-06-17T14:33:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NDEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5NjM1NA==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441596354", "bodyText": "Completion in LSP is only for the autocomplete feature", "author": "temanbrcom", "createdAt": "2020-06-17T14:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NDEwMw=="}], "type": "inlineReview", "revised_code": {"commit": "2e7e394cb319f2b34472d77fd2c843d99c226726", "chunk": "diff --git a/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java b/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\nsimilarity index 67%\nrename from com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java\nrename to com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\nindex 7f107ded..1132047e 100644\n--- a/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java\n+++ b/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\n\n@@ -19,16 +19,16 @@ import lombok.Data;\n import lombok.NoArgsConstructor;\n \n /**\n- * This class is a data transfer object that contains the uri of analyzed document.\n+ * This class is a signal object to show that analysis is finished. Contains the uri of analyzed document.\n  */\n @NoArgsConstructor\n @Data\n-public class DoneAnalysisEvent extends DataEvent{\n+public class AnalysisFinishedEvent extends DataEvent{\n     private String documentUri;\n \n     @Builder\n-    public DoneAnalysisEvent(String documentUri) {\n-        super(DataEventType.DONE_ANALYSIS_EVENT, DataEventType.DONE_ANALYSIS_EVENT.getId());\n+    public AnalysisFinishedEvent(String documentUri) {\n+        super(DataEventType.ANALYSIS_FINISHED_EVENT, DataEventType.ANALYSIS_FINISHED_EVENT.getId());\n         this.documentUri = documentUri;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NTA2Mg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441495062", "bodyText": "In fact, it more a signal event, not really a data transfer object", "author": "temanbrcom", "createdAt": "2020-06-17T12:07:35Z", "path": "com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright (c) 2020 Broadcom.\n+ * The term \"Broadcom\" refers to Broadcom Inc. and/or its subsidiaries.\n+ *\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *    Broadcom, Inc. - initial API and implementation\n+ */\n+\n+package com.broadcom.lsp.domain.cobol.event.model;\n+\n+import lombok.Builder;\n+import lombok.Data;\n+import lombok.NoArgsConstructor;\n+\n+/**\n+ * This class is a data transfer object that contains the uri of analyzed document.", "originalCommit": "0fc82cadf18fc40613375da3187b25802ed268a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU5MDIwMg==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441590202", "bodyText": "Make sense.", "author": "grianbrcom", "createdAt": "2020-06-17T14:30:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ5NTA2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2e7e394cb319f2b34472d77fd2c843d99c226726", "chunk": "diff --git a/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java b/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\nsimilarity index 67%\nrename from com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java\nrename to com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\nindex 7f107ded..1132047e 100644\n--- a/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/DoneAnalysisEvent.java\n+++ b/com.ca.lsp.cobol/lsp-core-domain/src/main/java/com/broadcom/lsp/domain/cobol/event/model/AnalysisFinishedEvent.java\n\n@@ -19,16 +19,16 @@ import lombok.Data;\n import lombok.NoArgsConstructor;\n \n /**\n- * This class is a data transfer object that contains the uri of analyzed document.\n+ * This class is a signal object to show that analysis is finished. Contains the uri of analyzed document.\n  */\n @NoArgsConstructor\n @Data\n-public class DoneAnalysisEvent extends DataEvent{\n+public class AnalysisFinishedEvent extends DataEvent{\n     private String documentUri;\n \n     @Builder\n-    public DoneAnalysisEvent(String documentUri) {\n-        super(DataEventType.DONE_ANALYSIS_EVENT, DataEventType.DONE_ANALYSIS_EVENT.getId());\n+    public AnalysisFinishedEvent(String documentUri) {\n+        super(DataEventType.ANALYSIS_FINISHED_EVENT, DataEventType.ANALYSIS_FINISHED_EVENT.getId());\n         this.documentUri = documentUri;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTUwNzUxMQ==", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/pull/397#discussion_r441507511", "bodyText": "By the agreement, the method Javadoc should start with a verb", "author": "temanbrcom", "createdAt": "2020-06-17T12:30:32Z", "path": "com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java", "diffHunk": "@@ -55,11 +63,30 @@ public CopybookServiceImpl(\n     this.files = files;\n \n     dataBus.subscribe(REQUIRED_COPYBOOK_EVENT, this);\n+    dataBus.subscribe(DONE_ANALYSIS_EVENT, this);\n   }\n \n   @Override\n   public void invalidateURICache() {\n     copybookPaths.clear();\n+    copybooksForDownloading.clear();\n+  }\n+\n+  /**\n+   * Depends on DataEvent type it will be handled with appropriate handler:\n+   * {@link #handleRequiredCopybookEvent} or {@link #handleDoneAnalysisEvent}.\n+   *\n+   * @param event must be {@link RequiredCopybookEvent} or {@link DoneAnalysisEvent}", "originalCommit": "0fc82cadf18fc40613375da3187b25802ed268a2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e7e394cb319f2b34472d77fd2c843d99c226726", "chunk": "diff --git a/com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java b/com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java\nindex 53f67d3c..e697d8ad 100644\n--- a/com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java\n+++ b/com.ca.lsp.cobol/lsp-service-cobol/src/main/java/com/ca/lsp/cobol/service/CopybookServiceImpl.java\n\n@@ -63,7 +63,7 @@ public class CopybookServiceImpl implements CopybookService {\n     this.files = files;\n \n     dataBus.subscribe(REQUIRED_COPYBOOK_EVENT, this);\n-    dataBus.subscribe(DONE_ANALYSIS_EVENT, this);\n+    dataBus.subscribe(ANALYSIS_FINISHED_EVENT, this);\n   }\n \n   @Override\n"}}, {"oid": "2e7e394cb319f2b34472d77fd2c843d99c226726", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2e7e394cb319f2b34472d77fd2c843d99c226726", "message": "fix: Avoid many error messages for copybook downloading #384\n\nThe middleware process two calls: resolve URI and download copybook.\nThe server synchronously resolves URI copybooks, not in the server cache\nduring document analysis. After the scan, the server sends one call to\nmiddleware with a list of copybooks to download.\nDoneAnalysisEvent was added to the databus.\n\nCloses #384\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-06-17T15:15:59Z", "type": "commit"}, {"oid": "2e7e394cb319f2b34472d77fd2c843d99c226726", "url": "https://github.com/eclipse/che-che4z-lsp-for-cobol/commit/2e7e394cb319f2b34472d77fd2c843d99c226726", "message": "fix: Avoid many error messages for copybook downloading #384\n\nThe middleware process two calls: resolve URI and download copybook.\nThe server synchronously resolves URI copybooks, not in the server cache\nduring document analysis. After the scan, the server sends one call to\nmiddleware with a list of copybooks to download.\nDoneAnalysisEvent was added to the databus.\n\nCloses #384\n\nSigned-off-by: Anton Grigorev <anton.grigorev@broadcom.com>", "committedDate": "2020-06-17T15:15:59Z", "type": "forcePushed"}]}