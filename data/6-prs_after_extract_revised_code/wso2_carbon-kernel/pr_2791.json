{"pr_number": 2791, "pr_title": "Make groupDN OU qualified", "pr_createdAt": "2020-10-06T04:24:03Z", "pr_url": "https://github.com/wso2/carbon-kernel/pull/2791", "timeline": [{"oid": "9a36a2f3a38be306bf763e7742c9bd13b662c750", "url": "https://github.com/wso2/carbon-kernel/commit/9a36a2f3a38be306bf763e7742c9bd13b662c750", "message": "Make groupDN OU qualified", "committedDate": "2020-10-06T04:21:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE4NDc4NA==", "url": "https://github.com/wso2/carbon-kernel/pull/2791#discussion_r500184784", "bodyText": "Are we using the returning MEMBERSHIP_ATTRIBUTE attribute? If not, why do we request it?", "author": "IsuraD", "createdAt": "2020-10-06T10:58:00Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java", "diffHunk": "@@ -1458,6 +1458,41 @@ public void doUpdateRoleListOfUser(String userName, String[] deletedRoles, Strin\n         }\n     }\n \n+    /**\n+     * Resolves groupDN which is used in doUpdateRoleListOfUser method to modify the roles of the user.\n+     *\n+     * @param searchFilter Search filter.\n+     * @param role         Role to be assigned to a user.\n+     * @param context      LDAPRoleContext.\n+     * @return String groupDN.\n+     * @throws UserStoreException Error in resolving groupDN.\n+     */\n+    private String resolveGroupDN(String searchFilter, String role, LDAPRoleContext context) throws UserStoreException {\n+\n+        String roleSearchFilter = searchFilter.replace(\"?\", escapeSpecialCharactersForFilter(role));\n+        String membershipAttribute = realmConfig.getUserStoreProperty(LDAPConstants.MEMBERSHIP_ATTRIBUTE);", "originalCommit": "9a36a2f3a38be306bf763e7742c9bd13b662c750", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwMzQ0MA==", "url": "https://github.com/wso2/carbon-kernel/pull/2791#discussion_r500203440", "bodyText": "Yes we use that to search in the group base https://github.com/wso2/carbon-kernel/pull/2791/files#diff-25c6f9a57686933230222e3dff7b0601R1479", "author": "sachiniWettasinghe", "createdAt": "2020-10-06T11:33:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE4NDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDIwNjgxMA==", "url": "https://github.com/wso2/carbon-kernel/pull/2791#discussion_r500206810", "bodyText": "The return is not used anyway ...", "author": "IsuraD", "createdAt": "2020-10-06T11:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE4NDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNzcyNw==", "url": "https://github.com/wso2/carbon-kernel/pull/2791#discussion_r500327727", "bodyText": "Tested and fixed this with dedca0f", "author": "sachiniWettasinghe", "createdAt": "2020-10-06T14:23:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE4NDc4NA=="}], "type": "inlineReview", "revised_code": {"commit": "dedca0f31a6b1d54e45cc15d78aeec9a394d6116", "chunk": "diff --git a/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java b/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java\nindex 1ee05ca65..a52f0dfed 100644\n--- a/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java\n+++ b/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadWriteLDAPUserStoreManager.java\n\n@@ -1470,8 +1470,7 @@ public class ReadWriteLDAPUserStoreManager extends ReadOnlyLDAPUserStoreManager\n     private String resolveGroupDN(String searchFilter, String role, LDAPRoleContext context) throws UserStoreException {\n \n         String roleSearchFilter = searchFilter.replace(\"?\", escapeSpecialCharactersForFilter(role));\n-        String membershipAttribute = realmConfig.getUserStoreProperty(LDAPConstants.MEMBERSHIP_ATTRIBUTE);\n-        String[] returningAttributes = new String[]{membershipAttribute};\n+        String[] returningAttributes = new String[]{};\n         String searchBase = context.getSearchBase();\n         DirContext mainDirContext = this.connectionSource.getContext();\n \n"}}, {"oid": "dedca0f31a6b1d54e45cc15d78aeec9a394d6116", "url": "https://github.com/wso2/carbon-kernel/commit/dedca0f31a6b1d54e45cc15d78aeec9a394d6116", "message": "Address PR comments", "committedDate": "2020-10-06T14:21:06Z", "type": "commit"}]}