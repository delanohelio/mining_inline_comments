{"pr_number": 2512, "pr_title": "Refactor getRoleListOfUserFromDatabase() adhering to new userId implementation", "pr_createdAt": "2020-01-05T13:48:32Z", "pr_url": "https://github.com/wso2/carbon-kernel/pull/2512", "timeline": [{"oid": "a436068ae3f7b55691c43eb0ff2cbb8263a48b71", "url": "https://github.com/wso2/carbon-kernel/commit/a436068ae3f7b55691c43eb0ff2cbb8263a48b71", "message": "Refactor getRoleListOfUserFromDatabase() adhering to new userId implementation", "committedDate": "2020-01-05T13:46:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA5NTE1Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2512#discussion_r363095153", "bodyText": "Shouldn't we use filter instead of *", "author": "madurangasiriwardena", "createdAt": "2020-01-05T14:00:51Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -7947,7 +7947,16 @@ public void addSystemRole(String roleName, String[] userList, Permission[] permi\n             return (String[]) object;\n         }\n \n-        return getUserRoles(username, filter);\n+        if (isUniqueUserIdEnabledInUserStore(getUserStore(username))) {\n+            String userID = getUserIDFromUserName(username);\n+            if (userID == null) {\n+                // According to implementation, getRoleListOfUser method would return everyone role name for all users.\n+                return new String[]{realmConfig.getEveryOneRoleName()};\n+            }\n+            return getUserRolesWithID(userID, \"*\").toArray(new String[0]);\n+        } else {\n+            return getUserRoles(username, \"*\");", "originalCommit": "a436068ae3f7b55691c43eb0ff2cbb8263a48b71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA5Nzg3OA==", "url": "https://github.com/wso2/carbon-kernel/pull/2512#discussion_r363097878", "bodyText": "Resolved in d157f30", "author": "gayashanbc", "createdAt": "2020-01-05T14:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzA5NTE1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "d157f3092249071c71426f62170254838b9f36a3", "chunk": "diff --git a/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java b/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java\nindex 7c5ac9120..b59300c7a 100644\n--- a/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java\n+++ b/core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java\n\n@@ -7953,9 +7953,9 @@ public abstract class AbstractUserStoreManager implements PaginatedUserStoreMana\n                 // According to implementation, getRoleListOfUser method would return everyone role name for all users.\n                 return new String[]{realmConfig.getEveryOneRoleName()};\n             }\n-            return getUserRolesWithID(userID, \"*\").toArray(new String[0]);\n+            return getUserRolesWithID(userID, filter).toArray(new String[0]);\n         } else {\n-            return getUserRoles(username, \"*\");\n+            return getUserRoles(username, filter);\n         }\n     }\n \n"}}, {"oid": "d157f3092249071c71426f62170254838b9f36a3", "url": "https://github.com/wso2/carbon-kernel/commit/d157f3092249071c71426f62170254838b9f36a3", "message": "Fix a typo", "committedDate": "2020-01-05T14:48:34Z", "type": "commit"}]}