{"pr_number": 5770, "pr_title": "GEODE-8745: Closing the queue region when senders are stopped.", "pr_createdAt": "2020-11-24T09:31:46Z", "pr_url": "https://github.com/apache/geode/pull/5770", "timeline": [{"oid": "d01498140a4474e68be1fc94abbd73a7cbf9f97b", "url": "https://github.com/apache/geode/commit/d01498140a4474e68be1fc94abbd73a7cbf9f97b", "message": "GEM-2935: Closing the queue region when senders are stopped\n\n\t* cleanQueues are applicable only while using persistence\n\t* when we are closing the region, the disk files are not deleted.\n\t* hence the values will still be maintained on restart.\n\t* Advantage will be that we are creating the queue region and its cache listener together\n\t* previously the region was not closed and cache listener was attached using mutators.\n\t* this caused secondary events to be missed before the cache listener is activated", "committedDate": "2020-11-24T09:41:31Z", "type": "forcePushed"}, {"oid": "b1c5c7ede4b5f8668a56301c3e013047878973aa", "url": "https://github.com/apache/geode/commit/b1c5c7ede4b5f8668a56301c3e013047878973aa", "message": "GEM-2935: Closing the queue region when senders are stopped.\n\n\t* cleanQueues are applicable only while using persistence\n\t* when we are closing the region, the disk files are not deleted.\n\t* hence the values will still be maintained on restart.\n\t* Advantage will be that we are creating the queue region and its cache listener together\n\t* previously the region was not closed and cache listener was attached using mutators.\n\t* this caused secondary events to be missed before the cache listener is activated", "committedDate": "2020-11-24T10:00:40Z", "type": "forcePushed"}, {"oid": "fbaad8fed505b234445f924fc301cc4cda1f2101", "url": "https://github.com/apache/geode/commit/fbaad8fed505b234445f924fc301cc4cda1f2101", "message": "GEM-2935: Closing the queue region when senders are stopped\n\n\t* cleanQueues are applicable only while using persistence\n\t* when we are closing the region, the disk files are not deleted.\n\t* hence the values will still be maintained on restart.\n\t* Advantage will be that we are creating the queue region and its cache listener together\n\t* previously the region was not closed and cache listener was attached using mutators.\n\t* this caused secondary events to be missed before the cache listener is activated", "committedDate": "2020-11-24T12:57:09Z", "type": "forcePushed"}, {"oid": "119f99323a995d7bef129364380f63a76f3150d3", "url": "https://github.com/apache/geode/commit/119f99323a995d7bef129364380f63a76f3150d3", "message": "GEM-2935: Closing the queue region when senders are stopped\n\n\t* cleanQueues are applicable only while using persistence\n\t* when we are closing the region, the disk files are not deleted.\n\t* hence the values will still be maintained on restart.\n\t* Advantage will be that we are creating the queue region and its cache listener together\n\t* previously the region was not closed and cache listener was attached using mutators.\n\t* this caused secondary events to be missed before the cache listener is activated", "committedDate": "2020-11-24T17:46:32Z", "type": "commit"}, {"oid": "119f99323a995d7bef129364380f63a76f3150d3", "url": "https://github.com/apache/geode/commit/119f99323a995d7bef129364380f63a76f3150d3", "message": "GEM-2935: Closing the queue region when senders are stopped\n\n\t* cleanQueues are applicable only while using persistence\n\t* when we are closing the region, the disk files are not deleted.\n\t* hence the values will still be maintained on restart.\n\t* Advantage will be that we are creating the queue region and its cache listener together\n\t* previously the region was not closed and cache listener was attached using mutators.\n\t* this caused secondary events to be missed before the cache listener is activated", "committedDate": "2020-11-24T17:46:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc3Njc5Ng==", "url": "https://github.com/apache/geode/pull/5770#discussion_r532776796", "bodyText": "This change is because the CacheListener to handle the unprocessedEventsMap is set here, hence I wanted the listener to be up and running before the map is initialized so that no events are missed because they were put in the map before the listener was running.", "author": "nabarunnag", "createdAt": "2020-11-30T17:36:35Z", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/wan/serial/SerialGatewaySenderEventProcessor.java", "diffHunk": "@@ -111,10 +111,9 @@ public SerialGatewaySenderEventProcessor(AbstractGatewaySender sender, String id\n       ThreadsMonitoring tMonitoring, boolean cleanQueues) {\n     super(\"Event Processor for GatewaySender_\" + id, sender, tMonitoring);\n \n+    initializeMessageQueue(id, cleanQueues);", "originalCommit": "119f99323a995d7bef129364380f63a76f3150d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc4NzI4Nw==", "url": "https://github.com/apache/geode/pull/5770#discussion_r532787287", "bodyText": "Instead of using the logger in this test to track progress, you could instead use the invoke() method signature that passes a String description/name as the first parameter, which allows anyone debugging the test to see when the invocation in question starts and finishes. Just personal preference, but I think it makes things neater and provides a little more information to anyone looking at the test output.", "author": "DonalEvans", "createdAt": "2020-11-30T17:52:26Z", "path": "geode-wan/src/distributedTest/java/org/apache/geode/internal/cache/wan/serial/SerialWANPersistenceEnabledGatewaySenderDUnitTest.java", "diffHunk": "@@ -603,27 +605,32 @@ public void testReplicatedRegionPersistentWanGateway_restartSenderWithCleanQueue\n     vm7.invoke(() -> WANTestBase.createPersistentReplicatedRegion(getTestMethodName() + \"_RR\", \"ln\",\n         isOffHeap()));\n \n+    vm4.invoke(() -> WANTestBase.pauseSender(\"ln\"));\n+    vm5.invoke(() -> WANTestBase.pauseSender(\"ln\"));\n+\n     vm4.invoke(() -> WANTestBase.doPuts(getTestMethodName() + \"_RR\", 1000));\n \n     logger.info(\"Completed puts in the region\");\n \n     vm4.invoke(() -> WANTestBase.stopSender(\"ln\"));\n     vm5.invoke(() -> WANTestBase.stopSender(\"ln\"));\n \n-    logger.info(\"Stopped all the senders. \");\n \n-    // Create receiver on remote site\n-    createReceiverInVMs(vm2, vm3);\n+    logger.info(\"Stopped all the senders. \");", "originalCommit": "119f99323a995d7bef129364380f63a76f3150d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAxMzU1Mw==", "url": "https://github.com/apache/geode/pull/5770#discussion_r533013553", "bodyText": "A valid point Donal. I am creating another GEODE ticket to just remove all the logger.info in tests. There are a couple of more statements that went in other commits.", "author": "nabarunnag", "createdAt": "2020-12-01T01:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc4NzI4Nw=="}], "type": "inlineReview", "revised_code": null}]}