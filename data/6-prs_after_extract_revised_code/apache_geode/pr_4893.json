{"pr_number": 4893, "pr_title": "GEODE-7920: Geode UDP INT thread found processing cache operations", "pr_createdAt": "2020-04-01T18:16:30Z", "pr_url": "https://github.com/apache/geode/pull/4893", "timeline": [{"oid": "8f24abbc7bade3f8e65a52a1a0402343e12ba2b5", "url": "https://github.com/apache/geode/commit/8f24abbc7bade3f8e65a52a1a0402343e12ba2b5", "message": "GEODE-7920: Geode UDP INT thread found processing cache operations\n\nModified DistributionMessage to look for JGroups \"internal\" executor\nthreads.  We thought we'd turned off all JGroups thread pools but this\none is still around.  We don't want to process DistributionMessages in\nthese threads unless absolutely necessary since they're needed when\nprocessing incoming messages.", "committedDate": "2020-04-01T18:10:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyNzc5NQ==", "url": "https://github.com/apache/geode/pull/4893#discussion_r401827795", "bodyText": "the old name was very creative, but a bit subjective... like the rename", "author": "echobravopapa", "createdAt": "2020-04-01T18:37:52Z", "path": "geode-core/src/main/java/org/apache/geode/distributed/internal/DistributionMessage.java", "diffHunk": "@@ -476,13 +477,19 @@ protected boolean mayNotifySerialGatewaySender(ClusterDistributionManager dm) {\n   }\n \n   /**\n-   * returns true if the current thread should not be used for inline processing. i.e., it is a\n-   * \"precious\" resource\n+   * returns true if the current thread should not be used for inline processing because it\n+   * is responsible for reading geode-membership messages. Blocking such a thread can cause\n+   * a server to be kicked out\n    */\n-  public static boolean isPreciousThread() {\n+  public static boolean isMembershipMessengerThread() {", "originalCommit": "8f24abbc7bade3f8e65a52a1a0402343e12ba2b5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyODQ5NA==", "url": "https://github.com/apache/geode/pull/4893#discussion_r401828494", "bodyText": "looks like some dead code cruft ... maybe we scrape it off while we're nearby", "author": "echobravopapa", "createdAt": "2020-04-01T18:39:00Z", "path": "geode-core/src/main/java/org/apache/geode/distributed/internal/ShutdownMessage.java", "diffHunk": "@@ -79,7 +79,7 @@ protected void process(final ClusterDistributionManager dm) {\n     // reply.setRecipient(getSender());", "originalCommit": "8f24abbc7bade3f8e65a52a1a0402343e12ba2b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg3OTgzNA==", "url": "https://github.com/apache/geode/pull/4893#discussion_r401879834", "bodyText": "removed", "author": "bschuchardt", "createdAt": "2020-04-01T20:10:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyODQ5NA=="}], "type": "inlineReview", "revised_code": {"commit": "6f8c74b8993c450551658aa744d3dab7d96a0a73", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/distributed/internal/ShutdownMessage.java b/geode-core/src/main/java/org/apache/geode/distributed/internal/ShutdownMessage.java\nindex 2e1ebc442f..9d062ab09f 100644\n--- a/geode-core/src/main/java/org/apache/geode/distributed/internal/ShutdownMessage.java\n+++ b/geode-core/src/main/java/org/apache/geode/distributed/internal/ShutdownMessage.java\n\n@@ -71,27 +71,8 @@ public class ShutdownMessage extends HighPriorityDistributionMessage\n   @Override\n   protected void process(final ClusterDistributionManager dm) {\n     Assert.assertTrue(this.id != null);\n-    // The peer goes deaf after sending us this message, so do not\n-    // attempt a reply.\n-\n-    // final ReplyMessage reply = new ReplyMessage();\n-    // reply.setProcessorId(processorId);\n-    // reply.setRecipient(getSender());\n-    // can't send a response in a UDP receiver thread or we might miss\n-    // the other side going away due to blocking receipt of views\n-    // if (DistributionMessage.isMembershipMessengerThread()) {\n-    // dm.getWaitingThreadPool().execute(new Runnable() {\n-    // public void run() {\n-    // dm.putOutgoing(reply);\n-    // dm.handleManagerDeparture(ShutdownMessage.this.id, false, \"shutdown message received\");\n-    // }\n-    // });\n-    // }\n-    // else {\n-    // dm.putOutgoing(reply);\n     dm.shutdownMessageReceived(id,\n         \"shutdown message received\");\n-    // }\n   }\n \n   @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyOTcxNA==", "url": "https://github.com/apache/geode/pull/4893#discussion_r401829714", "bodyText": "is/was there a failing test that caught the underlying issue?", "author": "echobravopapa", "createdAt": "2020-04-01T18:41:03Z", "path": "geode-core/src/test/java/org/apache/geode/distributed/internal/DistributionMessageTest.java", "diffHunk": "@@ -35,4 +39,12 @@ public void shouldBeMockable() throws Exception {\n \n     verify(mockDistributionMessage, times(1)).setReplySender(mockReplySender);\n   }\n+", "originalCommit": "8f24abbc7bade3f8e65a52a1a0402343e12ba2b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg3NTQ0NA==", "url": "https://github.com/apache/geode/pull/4893#discussion_r401875444", "bodyText": "No, this was in thread dumps when I was debugging an application with disable-tcp=true.", "author": "bschuchardt", "createdAt": "2020-04-01T20:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTgyOTcxNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6f8c74b8993c450551658aa744d3dab7d96a0a73", "url": "https://github.com/apache/geode/commit/6f8c74b8993c450551658aa744d3dab7d96a0a73", "message": "removing commented-out code", "committedDate": "2020-04-01T20:09:56Z", "type": "commit"}]}