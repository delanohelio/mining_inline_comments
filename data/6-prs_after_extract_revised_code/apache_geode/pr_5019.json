{"pr_number": 5019, "pr_title": "GEODE-8076: simplify redis concurrency code", "pr_createdAt": "2020-04-29T17:29:06Z", "pr_url": "https://github.com/apache/geode/pull/5019", "timeline": [{"oid": "634a2b0442da72d5bbf46ba7766ce6c85c3113f1", "url": "https://github.com/apache/geode/commit/634a2b0442da72d5bbf46ba7766ce6c85c3113f1", "message": "added a simple and fast LockManager implementation", "committedDate": "2020-04-30T00:13:59Z", "type": "forcePushed"}, {"oid": "26181818f6e240cda70759425dc302ad9a2f1574", "url": "https://github.com/apache/geode/commit/26181818f6e240cda70759425dc302ad9a2f1574", "message": "rebased on develop", "committedDate": "2020-05-05T21:01:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTE4OA==", "url": "https://github.com/apache/geode/pull/5019#discussion_r421601188", "bodyText": "Is it possible to add correct generic types here so we don't need to suppress anything?", "author": "jdeppe-pivotal", "createdAt": "2020-05-07T15:37:48Z", "path": "geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/PutKeyFunction.java", "diffHunk": "@@ -30,6 +30,7 @@\n \n   private static final String ID = \"PutKeyFunction\";\n \n+  @SuppressWarnings(\"unchecked\")\n   @Override", "originalCommit": "c873a0740ad77b5334cc15bca325149c1fd17f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0NzcxOQ==", "url": "https://github.com/apache/geode/pull/5019#discussion_r421647719", "bodyText": "I have removed this change. I don't know how it snuck in. It caused a bunch of merge conflicts. The build is fine without this change. If someone wants to clean this test code up I think it should be on another PR.", "author": "dschneider-pivotal", "createdAt": "2020-05-07T16:48:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTE4OA=="}], "type": "inlineReview", "revised_code": {"commit": "6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "chunk": "diff --git a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/PutKeyFunction.java b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/PutKeyFunction.java\nindex 8951ae9b8f..696981c1a1 100644\n--- a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/PutKeyFunction.java\n+++ b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/PutKeyFunction.java\n\n@@ -30,7 +30,6 @@ public class PutKeyFunction implements Function {\n \n   private static final String ID = \"PutKeyFunction\";\n \n-  @SuppressWarnings(\"unchecked\")\n   @Override\n   public void execute(FunctionContext context) {\n     RegionFunctionContext regionContext = (RegionFunctionContext) context;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTM2MA==", "url": "https://github.com/apache/geode/pull/5019#discussion_r421601360", "bodyText": "Is it possible to add correct generic types here so we don't need to suppress anything?", "author": "jdeppe-pivotal", "createdAt": "2020-05-07T15:38:03Z", "path": "geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java", "diffHunk": "@@ -29,6 +29,7 @@\n \n public class GetAllEntries implements Function {\n \n+  @SuppressWarnings(\"unchecked\")", "originalCommit": "c873a0740ad77b5334cc15bca325149c1fd17f33", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0NzgwOA==", "url": "https://github.com/apache/geode/pull/5019#discussion_r421647808", "bodyText": "I have removed this change. I don't know how it snuck in. It caused a bunch of merge conflicts. The build is fine without this change. If someone wants to clean this test code up I think it should be on another PR.", "author": "dschneider-pivotal", "createdAt": "2020-05-07T16:48:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYwMTM2MA=="}], "type": "inlineReview", "revised_code": {"commit": "6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "chunk": "diff --git a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\nindex a69ba6ad65..d86bc996e2 100644\n--- a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\n+++ b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\n\n@@ -29,7 +29,6 @@ import org.apache.geode.cache.execute.FunctionContext;\n \n public class GetAllEntries implements Function {\n \n-  @SuppressWarnings(\"unchecked\")\n   @Override\n   public void execute(FunctionContext context) {\n     Map<String, String> myMap = new HashMap();\n"}}, {"oid": "6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "url": "https://github.com/apache/geode/commit/6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "message": "spotless", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "9510a06a4b17f7d119bab41d5f9427c4e37fedc3", "url": "https://github.com/apache/geode/commit/9510a06a4b17f7d119bab41d5f9427c4e37fedc3", "message": "added DEBUG logging", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "90e6f034dbbb623ec8f04d8ca9431366cbc89b9e", "url": "https://github.com/apache/geode/commit/90e6f034dbbb623ec8f04d8ca9431366cbc89b9e", "message": "Revert \"added DEBUG logging\"\n\nThis reverts commit d14ab8f7b1c29cc390ab9f95398e5439f15bb0b7.", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "d5fed5a848781f0f824758d526987bb2cd510028", "url": "https://github.com/apache/geode/commit/d5fed5a848781f0f824758d526987bb2cd510028", "message": "Adds function/delta for SREM", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "f15c2bba7432e6b4d152bb66e38f9256ee453be9", "url": "https://github.com/apache/geode/commit/f15c2bba7432e6b4d152bb66e38f9256ee453be9", "message": "Adds function implementation and delta for SREM and SMEMBERS", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "7403546b73bb0ac334e954ae5fac33fee2fef9a1", "url": "https://github.com/apache/geode/commit/7403546b73bb0ac334e954ae5fac33fee2fef9a1", "message": "WIP add Del function delta crap", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "9a63cefd206ba2567c80fe37c47176d0ca7fd90a", "url": "https://github.com/apache/geode/commit/9a63cefd206ba2567c80fe37c47176d0ca7fd90a", "message": "did some cleanup/refactoring of the DeltaSet code", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "aa7fd5780586d9f869dc326508dedf745f4bdeed", "url": "https://github.com/apache/geode/commit/aa7fd5780586d9f869dc326508dedf745f4bdeed", "message": "fixed build problems", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "1666fd26c3c5259c7072445ba504e761bde399f0", "url": "https://github.com/apache/geode/commit/1666fd26c3c5259c7072445ba504e761bde399f0", "message": "fixed some lgtm warnings about casts", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "9c4a8179e84a15ed7c8305132c050bffb62067f3", "url": "https://github.com/apache/geode/commit/9c4a8179e84a15ed7c8305132c050bffb62067f3", "message": "fixed some serialization problems and got rid of an unneeded exception", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "62dd8c25150eb5d93a8431d1847a2dd1ac149905", "url": "https://github.com/apache/geode/commit/62dd8c25150eb5d93a8431d1847a2dd1ac149905", "message": "DeltaSet now supports the new delete of an empty set when doing srem", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "148ce60ff586c0f30ff4321819445ea42dd59b9b", "url": "https://github.com/apache/geode/commit/148ce60ff586c0f30ff4321819445ea42dd59b9b", "message": "make sure the redis set functions are registered", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "3d2a4222703a47d5cd2b20169890293d1f4f6a53", "url": "https://github.com/apache/geode/commit/3d2a4222703a47d5cd2b20169890293d1f4f6a53", "message": "Revert \"make sure the redis set functions are registered\"\n\nThis reverts commit dc618f20badfd0624bab547df3ad6fa275a93449.", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "e41557a130911ba339abddf9506c8be22d46c37f", "url": "https://github.com/apache/geode/commit/e41557a130911ba339abddf9506c8be22d46c37f", "message": "fix imports", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "83db250939940d7120a40557c6c5a429dd6446a8", "url": "https://github.com/apache/geode/commit/83db250939940d7120a40557c6c5a429dd6446a8", "message": "synchronize access to a redis key", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "f18a3fe475f755afc0646fc233603106404af23b", "url": "https://github.com/apache/geode/commit/f18a3fe475f755afc0646fc233603106404af23b", "message": "exclude class", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "1a65581489e226eb75ab81dc3b623699d3d862ff", "url": "https://github.com/apache/geode/commit/1a65581489e226eb75ab81dc3b623699d3d862ff", "message": "fixed serialization issues", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "c38673805af8e0bee6beeb8e878388581ed41469", "url": "https://github.com/apache/geode/commit/c38673805af8e0bee6beeb8e878388581ed41469", "message": "added a simple and fast LockManager implementation", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "e52c1be05a967bc90ee48b1afb2446a96f0231d9", "url": "https://github.com/apache/geode/commit/e52c1be05a967bc90ee48b1afb2446a96f0231d9", "message": "changed DeltaSet back to wrapping a HashSet", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "7a60f66b085b5bb1330e7ab519cb7682222a1107", "url": "https://github.com/apache/geode/commit/7a60f66b085b5bb1330e7ab519cb7682222a1107", "message": "minor refactors (name/format changes)", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "47a1415f093d7310bdbd1ba5493e98ad97e9bc22", "url": "https://github.com/apache/geode/commit/47a1415f093d7310bdbd1ba5493e98ad97e9bc22", "message": "removeRedisLockService from contructor for synchonizedRunner", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "e1433f4d9e2cb5edca68dcf0b88b307a36f8bd61", "url": "https://github.com/apache/geode/commit/e1433f4d9e2cb5edca68dcf0b88b307a36f8bd61", "message": "rename synchronizedRunner -> synchronizedRedisCommandRunner", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "3362e1cf223e10951d2eac379802442cba3ea5c6", "url": "https://github.com/apache/geode/commit/3362e1cf223e10951d2eac379802442cba3ea5c6", "message": "rename DeltaSet to SetDelta; other smaller renames", "committedDate": "2020-05-07T16:50:36Z", "type": "commit"}, {"oid": "13f0f794a8a6f70cca06240dfd7eb04a09dbd632", "url": "https://github.com/apache/geode/commit/13f0f794a8a6f70cca06240dfd7eb04a09dbd632", "message": "rename setDelta (formerly deltaSet) to RedisSet;  other renames", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "72707a0c2e539c8d9b4fc69bac1e55749a3bcab9", "url": "https://github.com/apache/geode/commit/72707a0c2e539c8d9b4fc69bac1e55749a3bcab9", "message": "Renamed RedisCommandRunnerSynchronizedByKey to StripedExecutor.\nCleaned up its implementation", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "010bcd300e73a46d65559efce62683ac1589c202", "url": "https://github.com/apache/geode/commit/010bcd300e73a46d65559efce62683ac1589c202", "message": "more cleanup of names and javadocs on StripedExecutor", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "47ed4eae88df265499d192a5d2f1f8c3fa539c02", "url": "https://github.com/apache/geode/commit/47ed4eae88df265499d192a5d2f1f8c3fa539c02", "message": "rebased on develop", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "65aa2aceed97cf03ded549331813fb6913c42ab8", "url": "https://github.com/apache/geode/commit/65aa2aceed97cf03ded549331813fb6913c42ab8", "message": "removed some dead code\nadded an interface for StripedExecutor", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "e857281e3eb8d5e7e4901f22b3f21eb79e89e082", "url": "https://github.com/apache/geode/commit/e857281e3eb8d5e7e4901f22b3f21eb79e89e082", "message": "added override annotation", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "b6e8f91f96d3ecdad615b18958d4694cfb4c36aa", "url": "https://github.com/apache/geode/commit/b6e8f91f96d3ecdad615b18958d4694cfb4c36aa", "message": "restored an accidently removed \"return\" statement", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "8588169c25833b60c35db380050c024570f6023a", "url": "https://github.com/apache/geode/commit/8588169c25833b60c35db380050c024570f6023a", "message": "removed some changes unrelated to this branch", "committedDate": "2020-05-07T16:50:37Z", "type": "commit"}, {"oid": "8588169c25833b60c35db380050c024570f6023a", "url": "https://github.com/apache/geode/commit/8588169c25833b60c35db380050c024570f6023a", "message": "removed some changes unrelated to this branch", "committedDate": "2020-05-07T16:50:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQzNzg1OQ==", "url": "https://github.com/apache/geode/pull/5019#discussion_r420437859", "bodyText": "why are we changing stuff in rest.internal.web.controllers?", "author": "prettyClouds", "createdAt": "2020-05-05T22:13:06Z", "path": "geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java", "diffHunk": "@@ -29,6 +29,7 @@\n \n public class GetAllEntries implements Function {\n \n+  @SuppressWarnings(\"unchecked\")", "originalCommit": "c873a0740ad77b5334cc15bca325149c1fd17f33", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "chunk": "diff --git a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\nindex a69ba6ad65..d86bc996e2 100644\n--- a/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\n+++ b/geode-assembly/geode-assembly-test/src/main/java/org/apache/geode/rest/internal/web/controllers/GetAllEntries.java\n\n@@ -29,7 +29,6 @@ import org.apache.geode.cache.execute.FunctionContext;\n \n public class GetAllEntries implements Function {\n \n-  @SuppressWarnings(\"unchecked\")\n   @Override\n   public void execute(FunctionContext context) {\n     Map<String, String> myMap = new HashMap();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYyNTYxMQ==", "url": "https://github.com/apache/geode/pull/5019#discussion_r421625611", "bodyText": "What was the underlying reason behind changing this interface.", "author": "prettyClouds", "createdAt": "2020-05-07T16:12:55Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/RedisSetCommands.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+\n+package org.apache.geode.redis.internal.executor.set;\n+\n+import java.util.ArrayList;\n+import java.util.Set;\n+import java.util.concurrent.atomic.AtomicBoolean;\n+\n+import org.apache.geode.redis.internal.ByteArrayWrapper;\n+\n+public interface RedisSetCommands {", "originalCommit": "c873a0740ad77b5334cc15bca325149c1fd17f33", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6fa43308d83d9126f3e7c4b8bc62f1047ae85c1b", "chunk": "diff --git a/geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/RedisSetCommands.java b/geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/RedisSetCommands.java\ndeleted file mode 100644\nindex b1fb649186..0000000000\n--- a/geode-redis/src/main/java/org/apache/geode/redis/internal/executor/set/RedisSetCommands.java\n+++ /dev/null\n\n@@ -1,34 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n- * agreements. See the NOTICE file distributed with this work for additional information regarding\n- * copyright ownership. The ASF licenses this file to You under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n- * copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software distributed under the License\n- * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n- * or implied. See the License for the specific language governing permissions and limitations under\n- * the License.\n- */\n-\n-package org.apache.geode.redis.internal.executor.set;\n-\n-import java.util.ArrayList;\n-import java.util.Set;\n-import java.util.concurrent.atomic.AtomicBoolean;\n-\n-import org.apache.geode.redis.internal.ByteArrayWrapper;\n-\n-public interface RedisSetCommands {\n-\n-  long sadd(ByteArrayWrapper key, ArrayList<ByteArrayWrapper> membersToAdd);\n-\n-  long srem(ByteArrayWrapper key, ArrayList<ByteArrayWrapper> membersToAdd,\n-      AtomicBoolean setWasDeleted);\n-\n-  Set<ByteArrayWrapper> members(ByteArrayWrapper key);\n-\n-  boolean del(ByteArrayWrapper key);\n-}\n"}}]}