{"pr_number": 4594, "pr_title": "GEODE-6833: remove redundant ArchRule and layer spec", "pr_createdAt": "2020-01-14T23:03:27Z", "pr_url": "https://github.com/apache/geode/pull/4594", "timeline": [{"oid": "b783f3f5f07de615b20461b203cbf2deede30edc", "url": "https://github.com/apache/geode/commit/b783f3f5f07de615b20461b203cbf2deede30edc", "message": "GEODE-6833: remove redundant ArchRule and layer spec", "committedDate": "2020-01-14T23:01:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxOTQ1MA==", "url": "https://github.com/apache/geode/pull/4594#discussion_r366619450", "bodyText": "Now that we have eliminated all the spurious dependencies (except the test package one), this ArchRule is no longer needed as a baseline.", "author": "Bill", "createdAt": "2020-01-14T23:04:39Z", "path": "geode-core/src/test/java/org/apache/geode/distributed/internal/membership/MembershipDependenciesJUnitTest.java", "diffHunk": "@@ -20,65 +20,29 @@\n \n import com.tngtech.archunit.core.importer.ImportOption;\n import com.tngtech.archunit.junit.AnalyzeClasses;\n-import com.tngtech.archunit.junit.ArchIgnore;\n import com.tngtech.archunit.junit.ArchTest;\n import com.tngtech.archunit.junit.ArchUnitRunner;\n import com.tngtech.archunit.junit.CacheMode;\n import com.tngtech.archunit.lang.ArchRule;\n import org.junit.runner.RunWith;\n \n-\n @RunWith(ArchUnitRunner.class)\n @AnalyzeClasses(packages = \"org.apache.geode.distributed.internal.membership.gms..\",\n     cacheMode = CacheMode.PER_CLASS,\n     importOptions = ImportOption.DoNotIncludeArchives.class)\n public class MembershipDependenciesJUnitTest {\n \n   /*\n-   * This test verifies that the membership component (which is currently made up of classes\n-   * inside the geode-core module, but which may someday reside in a separate module)\n-   * depends only on packages within itself (within the membership component) or packages\n-   * outside apache.geode.\n-   *\n-   * For purposes of this test, classes in the membership...adapter package are not considered.\n-   * They will eventually become part of geode-core.\n+   * This test verifies that packages defined in the geode-membership module depend only on\n+   * packages defined within that module or on packages defined outside the geode-core module\n+   * (org.apache.geode packages) or on packages defined in a handful of small \"leaf\" modules.\n    *\n-   * While this rule is ignored, comment-out the ignore annotation to run it periodically to get\n-   * the current count of deviations.\n-   */\n-  // TODO: remove ignore once membershipDoesntDependOnCoreProvisional matches this rule exactly\n-  @ArchIgnore", "originalCommit": "b783f3f5f07de615b20461b203cbf2deede30edc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYxOTY2MQ==", "url": "https://github.com/apache/geode/pull/4594#discussion_r366619661", "bodyText": "The \"adapter\" layer should not be able to access \"internal\", so I removed the former.", "author": "Bill", "createdAt": "2020-01-14T23:05:20Z", "path": "geode-core/src/integrationTest/java/org/apache/geode/distributed/internal/membership/api/CoreOnlyUsesMembershipAPIArchUnitTest.java", "diffHunk": "@@ -105,12 +105,10 @@ public void miscCoreClassesDoNotUseMembershipInternals() {\n \n   private void checkMembershipAPIUse(JavaClasses importedClasses) {\n     ArchRule myRule = layeredArchitecture()\n-        .layer(\"adapter\")\n-        .definedBy(resideInAPackage(\"org.apache.geode.distributed.internal.membership.adapter\"))\n         .layer(\"internal\")\n         .definedBy(resideInAPackage(\"org.apache.geode.distributed.internal.membership.gms..\"))\n         .layer(\"api\").definedBy(\"org.apache.geode.distributed.internal.membership.api\")\n-        .whereLayer(\"internal\").mayOnlyBeAccessedByLayers(\"api\", \"adapter\");", "originalCommit": "b783f3f5f07de615b20461b203cbf2deede30edc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}