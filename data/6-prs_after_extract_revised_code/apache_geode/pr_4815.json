{"pr_number": 4815, "pr_title": "GEODE-7838: getNumOfServers while rebalance is executed", "pr_createdAt": "2020-03-16T11:57:36Z", "pr_url": "https://github.com/apache/geode/pull/4815", "timeline": [{"oid": "52062b6c07edb1c7367c7399384e6e3e02c25f73", "url": "https://github.com/apache/geode/commit/52062b6c07edb1c7367c7399384e6e3e02c25f73", "message": "GEODE-7383: getNumOfServers while rebalance is executed", "committedDate": "2020-03-16T11:38:17Z", "type": "commit"}, {"oid": "216835db3d57f7f0ef593446331555e7fe0a0946", "url": "https://github.com/apache/geode/commit/216835db3d57f7f0ef593446331555e7fe0a0946", "message": "update method", "committedDate": "2020-03-16T11:51:11Z", "type": "commit"}, {"oid": "7ffedc41b6481aab0462ab5f097a6cad5f5bdc7b", "url": "https://github.com/apache/geode/commit/7ffedc41b6481aab0462ab5f097a6cad5f5bdc7b", "message": "fix integration test", "committedDate": "2020-03-16T12:43:47Z", "type": "commit"}, {"oid": "63e85b09a44acd303cc236448c3f9ee3459f07b9", "url": "https://github.com/apache/geode/commit/63e85b09a44acd303cc236448c3f9ee3459f07b9", "message": "fix for integration test v2", "committedDate": "2020-03-16T13:03:56Z", "type": "commit"}, {"oid": "28e144edfb2b425c431d6564f4d40f6fbfe2323b", "url": "https://github.com/apache/geode/commit/28e144edfb2b425c431d6564f4d40f6fbfe2323b", "message": "empty commit to re-launch CI", "committedDate": "2020-03-26T07:18:07Z", "type": "commit"}, {"oid": "fa86193969dd465e03a8774e0c5203890a1d2572", "url": "https://github.com/apache/geode/commit/fa86193969dd465e03a8774e0c5203890a1d2572", "message": "empty commit to re-launch tests", "committedDate": "2020-04-08T11:25:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2ODMyMA==", "url": "https://github.com/apache/geode/pull/4815#discussion_r405768320", "bodyText": "This name is confusing, since the method has nothing to do with primary buckets. A better name might be \"getNumberOfMembersExecutedOn\".", "author": "DonalEvans", "createdAt": "2020-04-08T19:40:53Z", "path": "geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java", "diffHunk": "@@ -137,4 +137,11 @@\n    * @return the time, in milliseconds, spent transferring primaries for this region\n    */\n   long getPrimaryTransferTime();\n+\n+  /**\n+   * Returns the total number of members on which command is executed.\n+   *\n+   * @return the total number of members on which command is executed\n+   */\n+  int getPrimaryNumOfMembers();", "originalCommit": "fa86193969dd465e03a8774e0c5203890a1d2572", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java b/geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java\nindex e44c34fbea..437e8cfd2d 100644\n--- a/geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java\n+++ b/geode-core/src/main/java/org/apache/geode/cache/partition/PartitionRebalanceInfo.java\n\n@@ -143,5 +143,5 @@ public interface PartitionRebalanceInfo {\n    *\n    * @return the total number of members on which command is executed\n    */\n-  int getPrimaryNumOfMembers();\n+  int getNumberOfMembersExecutedOn();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc2OTcxMg==", "url": "https://github.com/apache/geode/pull/4815#discussion_r405769712", "bodyText": "This method might be better named \"getTotalMembersExecutedOn\", or something else that makes it clear that it's specifically returning the number of members the command was executed on.", "author": "DonalEvans", "createdAt": "2020-04-08T19:43:24Z", "path": "geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java", "diffHunk": "@@ -99,4 +99,11 @@\n    * @return the total time, in milliseconds, spent transferring primaries\n    */\n   long getTotalPrimaryTransferTime();\n+\n+  /**\n+   * Returns the total number of members on which command is executed.\n+   *\n+   * @return the total number of members on which command is executed\n+   */\n+  int getTotalNumOfMembers();", "originalCommit": "fa86193969dd465e03a8774e0c5203890a1d2572", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java b/geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java\nindex 2c97dafe70..fd6f28a3d6 100644\n--- a/geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java\n+++ b/geode-core/src/main/java/org/apache/geode/cache/control/RebalanceResults.java\n\n@@ -105,5 +105,5 @@ public interface RebalanceResults {\n    *\n    * @return the total number of members on which command is executed\n    */\n-  int getTotalNumOfMembers();\n+  int getTotalMembersExecutedOn();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3MDQ2NQ==", "url": "https://github.com/apache/geode/pull/4815#discussion_r405770465", "bodyText": "This description is potentially misleading, since the count is actually the number of members on which the rebalance was executed, which might be different from the total number of members in the system.", "author": "DonalEvans", "createdAt": "2020-04-08T19:44:51Z", "path": "geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java", "diffHunk": "@@ -1873,6 +1873,8 @@\n       \"Total primaries transferred during this rebalance\";\n   public static final String REBALANCE__MSG__TOTALTIME =\n       \"Total time (in milliseconds) for this rebalance\";\n+  public static final String REBALANCE__MSG__MEMBER_COUNT =\n+      \"Total number of members in system during rebalance\";", "originalCommit": "fa86193969dd465e03a8774e0c5203890a1d2572", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java b/geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java\nindex eb56f8bc8a..62f2983299 100644\n--- a/geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java\n+++ b/geode-core/src/main/java/org/apache/geode/management/internal/i18n/CliStrings.java\n\n@@ -1874,7 +1874,7 @@ public class CliStrings {\n   public static final String REBALANCE__MSG__TOTALTIME =\n       \"Total time (in milliseconds) for this rebalance\";\n   public static final String REBALANCE__MSG__MEMBER_COUNT =\n-      \"Total number of members in system during rebalance\";\n+      \"Total number of members in system on which rebalance is executed\";\n   public static final String REBALANCE__MSG__NO_REBALANCING_REGIONS_ON_DS =\n       \"Distributed system has no regions that can be rebalanced\";\n   public static final String REBALANCE__MSG__EXCEPTION_IN_REBALANCE_FOR_MEMBER_0_Exception =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc3MTQ2OA==", "url": "https://github.com/apache/geode/pull/4815#discussion_r405771468", "bodyText": "Typo here, should be Of, not 0f", "author": "DonalEvans", "createdAt": "2020-04-08T19:46:51Z", "path": "geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java", "diffHunk": "@@ -74,4 +74,9 @@\n    * Returns the time, in milliseconds, that the rebalance operation took for this region.\n    */\n   long getTimeInMilliseconds();\n+\n+  /**\n+   * Returns the number of members on which rebalance operation is executed.\n+   */\n+  int getNum0fMembers();", "originalCommit": "fa86193969dd465e03a8774e0c5203890a1d2572", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "chunk": "diff --git a/geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java b/geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java\nindex 01bd9d0385..ffb6c13e22 100644\n--- a/geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java\n+++ b/geode-management/src/main/java/org/apache/geode/management/runtime/RebalanceRegionResult.java\n\n@@ -78,5 +78,5 @@ public interface RebalanceRegionResult extends JsonSerializable, Serializable {\n   /**\n    * Returns the number of members on which rebalance operation is executed.\n    */\n-  int getNum0fMembers();\n+  int getNumOfMembers();\n }\n"}}, {"oid": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "url": "https://github.com/apache/geode/commit/3225a84a3d7b66f30146438ee8820f0c1000c03b", "message": "update after comments", "committedDate": "2020-04-09T13:06:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxMDAxMQ==", "url": "https://github.com/apache/geode/pull/4815#discussion_r406310011", "bodyText": "This string should ideally be replaced with a reference to the REBALANCE__MSG__MEMBER_COUNT constant.", "author": "DonalEvans", "createdAt": "2020-04-09T16:00:37Z", "path": "geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java", "diffHunk": "@@ -94,6 +98,40 @@ public void testRebalanceResultOutput() {\n     rebalanceResult.hasRow(9).contains(CliStrings.REBALANCE__MSG__MEMBER_COUNT);\n   }\n \n+  @Test\n+  public void testRebalanceResultOutputMemberCount() {\n+    server3 = cluster.startServerVM(3, \"localhost\", locator.getPort());\n+    server3.invoke(() -> {\n+      Cache cache = ClusterStartupRule.getCache();\n+      RegionFactory<Integer, Integer> dataRegionFactory =\n+          cache.createRegionFactory(RegionShortcut.PARTITION);\n+      Region region = dataRegionFactory.create(\"region-1\");\n+      for (int i = 0; i < 100; i++) {\n+        region.put(\"key\" + (i + 400), \"value\" + (i + 400));\n+      }\n+    });\n+    // check if DistributedRegionMXBean is available so that command will not fail\n+    locator.waitUntilRegionIsReadyOnExactlyThisManyServers(\"/region-1\", 3);\n+\n+    Map<String, List<String>> listMembersResult = gfsh.executeAndAssertThat(\"list members\")\n+        .hasTableSection().getActual().getContent();\n+    assertThat(listMembersResult.get(\"Name\").size()).isEqualTo(4);\n+\n+    server3.forceDisconnect();\n+\n+    Map<String, List<String>> rebalanceResult = gfsh.executeAndAssertThat(\"rebalance\")\n+        .statusIsSuccess().hasTableSection().getActual().getContent();\n+    \n+    server3.waitTilFullyReconnected();\n+\n+    listMembersResult = gfsh.executeAndAssertThat(\"list members\")\n+        .hasTableSection().getActual().getContent();\n+    assertThat(listMembersResult.get(\"Name\").size()).isEqualTo(4);\n+    assertThat(rebalanceResult.get(\"Rebalanced Stats\").get(9))\n+        .isEqualTo(\"Total number of members in system on which rebalance is executed\");", "originalCommit": "3225a84a3d7b66f30146438ee8820f0c1000c03b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMyMjk4OA==", "url": "https://github.com/apache/geode/pull/4815#discussion_r406322988", "bodyText": "Done! :)", "author": "mkevo", "createdAt": "2020-04-09T16:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjMxMDAxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "7b7bb4aa2542458037b3a6f4cbeb228563f23ef0", "chunk": "diff --git a/geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java b/geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java\nindex 9ad5f1c644..d69619f8a7 100644\n--- a/geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java\n+++ b/geode-dunit/src/main/java/org/apache/geode/management/internal/cli/commands/RebalanceCommandDistributedTestBase.java\n\n@@ -121,14 +121,14 @@ public class RebalanceCommandDistributedTestBase {\n \n     Map<String, List<String>> rebalanceResult = gfsh.executeAndAssertThat(\"rebalance\")\n         .statusIsSuccess().hasTableSection().getActual().getContent();\n-    \n+\n     server3.waitTilFullyReconnected();\n \n     listMembersResult = gfsh.executeAndAssertThat(\"list members\")\n         .hasTableSection().getActual().getContent();\n     assertThat(listMembersResult.get(\"Name\").size()).isEqualTo(4);\n     assertThat(rebalanceResult.get(\"Rebalanced Stats\").get(9))\n-        .isEqualTo(\"Total number of members in system on which rebalance is executed\");\n+        .isEqualTo(CliStrings.REBALANCE__MSG__MEMBER_COUNT);\n     assertThat(rebalanceResult.get(\"Value\").get(9)).isEqualTo(\"2\");\n   }\n \n"}}, {"oid": "7b7bb4aa2542458037b3a6f4cbeb228563f23ef0", "url": "https://github.com/apache/geode/commit/7b7bb4aa2542458037b3a6f4cbeb228563f23ef0", "message": "change to CliString", "committedDate": "2020-04-09T16:19:26Z", "type": "commit"}, {"oid": "4e91ef538798b32841119194a0200f94121c422f", "url": "https://github.com/apache/geode/commit/4e91ef538798b32841119194a0200f94121c422f", "message": "documentation update", "committedDate": "2020-04-09T18:54:01Z", "type": "commit"}]}