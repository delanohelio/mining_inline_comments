{"pr_number": 4898, "pr_title": "GEODE-7921: NullPointerExceptions logged during auto-reconnect", "pr_createdAt": "2020-04-01T22:35:30Z", "pr_url": "https://github.com/apache/geode/pull/4898", "timeline": [{"oid": "0400983ae2dd81898c2a416d41d57e89148ad8e2", "url": "https://github.com/apache/geode/commit/0400983ae2dd81898c2a416d41d57e89148ad8e2", "message": "GEODE-7921: NullPointerExceptions logged during auto-reconnect\n\nDon't deliver cache-level messages that were queued while disconnected\nfor auto-reconnect.  During auto-reconnect there is a QuorumChecker that\nreceives messages on the jgroups channel and tries to establish\ncommunications with a quorum of the old membership view.  It may also\nget JoinRequest messages and other membership-level messages but I\nobserved one case where it also queued cache-level messages when the\nproperty disable-tcp was set to true (funnelling all comms through\njgroups).\n\nI also added some null checks to the LatestLastAccessTimeMessage and a\nsmall test for that.", "committedDate": "2020-04-01T22:24:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk4MTk2Mg==", "url": "https://github.com/apache/geode/pull/4898#discussion_r401981962", "bodyText": "so the NPE could happen right here, got it", "author": "echobravopapa", "createdAt": "2020-04-02T00:13:14Z", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/LatestLastAccessTimeMessage.java", "diffHunk": "@@ -62,17 +62,23 @@ public int getDSFID() {\n   @Override\n   protected void process(ClusterDistributionManager dm) {\n     long latestLastAccessTime = 0L;\n+    InternalCache cache = dm.getCache();\n+    if (cache == null) {\n+      return;\n+    }\n     InternalDistributedRegion region =\n-        (InternalDistributedRegion) dm.getCache().getRegion(this.regionName);\n-    if (region != null) {\n-      RegionEntry entry = region.getRegionEntry(this.key);\n-      if (entry != null) {\n-        try {\n-          latestLastAccessTime = entry.getLastAccessed();\n-        } catch (InternalStatisticsDisabledException ignored) {\n-          // last access time is not available\n-        }\n-      }\n+        (InternalDistributedRegion) cache.getRegion(this.regionName);", "originalCommit": "0400983ae2dd81898c2a416d41d57e89148ad8e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}