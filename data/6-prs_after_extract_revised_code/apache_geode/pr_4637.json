{"pr_number": 4637, "pr_title": "GEODE-7597: Factor out code needed in Membership from SocketCreator", "pr_createdAt": "2020-01-27T23:59:21Z", "pr_url": "https://github.com/apache/geode/pull/4637", "timeline": [{"oid": "192c32f0d4bd9fc55811cbc7752df55f6c13bc52", "url": "https://github.com/apache/geode/commit/192c32f0d4bd9fc55811cbc7752df55f6c13bc52", "message": "added missing files", "committedDate": "2020-01-28T16:44:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4MTE5Mw==", "url": "https://github.com/apache/geode/pull/4637#discussion_r372081193", "bodyText": "Minor point - Can we just default the value of this.socketCreator up above when the variable is initialized, rather than having an if check?", "author": "upthewaterspout", "createdAt": "2020-01-28T21:56:49Z", "path": "geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/MembershipLocatorBuilderImpl.java", "diffHunk": "@@ -106,9 +107,13 @@ public MembershipLocatorBuilderImpl(\n   @Override\n   public MembershipLocator<ID> create()\n       throws UnknownHostException, MembershipConfigurationException {\n+    TcpSocketCreator sc = this.socketCreator;\n+    if (sc == null) {", "originalCommit": "065432307c0a408f031d966fb9323933040e540a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4ODYxMw==", "url": "https://github.com/apache/geode/pull/4637#discussion_r372088613", "bodyText": "I'll do that on my next commit", "author": "bschuchardt", "createdAt": "2020-01-28T22:13:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4MTE5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f18c3069a8dd43096e669df5f18b212b751772e2", "chunk": "diff --git a/geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/MembershipLocatorBuilderImpl.java b/geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/MembershipLocatorBuilderImpl.java\nindex dfaa1a4693..4c2e9f40a1 100644\n--- a/geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/MembershipLocatorBuilderImpl.java\n+++ b/geode-membership/src/main/java/org/apache/geode/distributed/internal/membership/gms/MembershipLocatorBuilderImpl.java\n\n@@ -107,14 +102,17 @@ public final class MembershipLocatorBuilderImpl<ID extends MemberIdentifier> imp\n   @Override\n   public MembershipLocator<ID> create()\n       throws UnknownHostException, MembershipConfigurationException {\n-    TcpSocketCreator sc = this.socketCreator;\n-    if (sc == null) {\n-      sc = new TcpSocketCreatorImpl();\n-    }\n-    return new MembershipLocatorImpl<ID>(port, bindAddress, protocolChecker,\n+    Services.registerSerializables(serializer);\n+    MembershipLocator locator = new MembershipLocatorImpl<ID>(port, bindAddress, protocolChecker,\n         executorServiceSupplier,\n-        sc, objectSerializer, objectDeserializer, fallbackHandler,\n+        serializer.getObjectSerializer(), serializer.getObjectDeserializer(),\n+        fallbackHandler,\n+        objectSerializer, objectDeserializer, fallbackHandler,\n         locatorsAreCoordinators, locatorStats, workingDirectory, config);\n+    if (socketCreator != null) {\n+      locator.setSocketCreator(socketCreator);\n+    }\n+    return locator;\n   }\n \n }\n"}}, {"oid": "f18c3069a8dd43096e669df5f18b212b751772e2", "url": "https://github.com/apache/geode/commit/f18c3069a8dd43096e669df5f18b212b751772e2", "message": "GEODE-7597: Factor out code needed in Membership from SocketCreator\n\nImplemented a new TcpSocketCreatorImpl.  Due to GeodeHttpClientRule\ndependencies this and associated interfaces are in geode-common.  I'd\nrather have them in geode-tcp-server.\n\nSocketCreator now subclasses TcpSocketCreatorImpl and I've removed the\nadapter class, which is no longer needed.", "committedDate": "2020-01-29T16:58:06Z", "type": "commit"}, {"oid": "565acce53f4efab812914a46971e3b1888b5b531", "url": "https://github.com/apache/geode/commit/565acce53f4efab812914a46971e3b1888b5b531", "message": "added missing files", "committedDate": "2020-01-29T16:58:07Z", "type": "commit"}, {"oid": "c392c93341a465269b3eaabe30b466546eb091ec", "url": "https://github.com/apache/geode/commit/c392c93341a465269b3eaabe30b466546eb091ec", "message": "fixing dunit failure and moving TcpSocketCreator back to the tcp-server project", "committedDate": "2020-01-29T17:27:43Z", "type": "commit"}, {"oid": "6c7a5771958b6a8694fcfe4f16013ee04df3aba8", "url": "https://github.com/apache/geode/commit/6c7a5771958b6a8694fcfe4f16013ee04df3aba8", "message": "fixing bind address and inheritance problems in socket creators", "committedDate": "2020-01-29T17:33:35Z", "type": "commit"}, {"oid": "a59ef39775c83d9c63154d878ea0ed14a634dd45", "url": "https://github.com/apache/geode/commit/a59ef39775c83d9c63154d878ea0ed14a634dd45", "message": "fixes for unit test failures", "committedDate": "2020-01-29T17:33:35Z", "type": "commit"}, {"oid": "5106283a887710596381842f155f6d044e783383", "url": "https://github.com/apache/geode/commit/5106283a887710596381842f155f6d044e783383", "message": "spotless", "committedDate": "2020-01-29T17:41:07Z", "type": "commit"}, {"oid": "5106283a887710596381842f155f6d044e783383", "url": "https://github.com/apache/geode/commit/5106283a887710596381842f155f6d044e783383", "message": "spotless", "committedDate": "2020-01-29T17:41:07Z", "type": "forcePushed"}, {"oid": "8d96ba43ab72d8536f47c48584938b85eb038f38", "url": "https://github.com/apache/geode/commit/8d96ba43ab72d8536f47c48584938b85eb038f38", "message": "relax assertion in test that fails stress-testing", "committedDate": "2020-01-29T21:19:10Z", "type": "commit"}]}