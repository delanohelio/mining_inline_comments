{"pr_number": 5862, "pr_title": "GEODE-8799: Increase defaults for OperationExecutors.MAX_THREADS and ClusterOperationExecutors.MAX_PR_THREADS", "pr_createdAt": "2020-12-17T01:54:24Z", "pr_url": "https://github.com/apache/geode/pull/5862", "timeline": [{"oid": "0837301a0f0f111d39324b0a008e3f01bef2d095", "url": "https://github.com/apache/geode/commit/0837301a0f0f111d39324b0a008e3f01bef2d095", "message": "Correct default values in properties.html\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2020-12-17T17:20:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMTgyMg==", "url": "https://github.com/apache/geode/pull/5862#discussion_r545321822", "bodyText": "There is another ticket to address this issue: GEODE-8357\nThis change has an impact on overall system requirement and performance; it will be nice to send a proposal to developer community. This helps to get feedback from engineers who had encountered issue with this setting and suggested the recommendation to the users (support teams); there was conversation about changing this to big number like 1000.\nIt will be good to come up with a right number based on previous experience in setting this number.\nWe also need to think about setting the system properties automatically; some kind of auto-tuning service in the product that will adopt/changes the value based on the resource availability and the system load.", "author": "agingade", "createdAt": "2020-12-17T18:48:21Z", "path": "geode-core/src/main/java/org/apache/geode/distributed/internal/OperationExecutors.java", "diffHunk": "@@ -26,7 +26,7 @@\n  */\n public interface OperationExecutors {\n   int MAX_THREADS =\n-      Integer.getInteger(\"DistributionManager.MAX_THREADS\", 100);\n+      Integer.getInteger(\"DistributionManager.MAX_THREADS\", 300);", "originalCommit": "0837301a0f0f111d39324b0a008e3f01bef2d095", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODE2MDA3NQ==", "url": "https://github.com/apache/geode/pull/5862#discussion_r548160075", "bodyText": "@agingade we created this PR after receiving feedback from customers and support. This is one of the requested features from the field and these are the numbers we have received from support.\nWe are also aligning these numbers with MAX_FE_THREADS, which was changed to cpu*32 to tune the internal tests.\nThis can be a temporary band-aid till we start on GEODE-8357, which has more extensive changes and we can involve the community feedback.", "author": "nabarunnag", "createdAt": "2020-12-23T19:22:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMTgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjE0ODE3NA==", "url": "https://github.com/apache/geode/pull/5862#discussion_r552148174", "bodyText": "Having talked to some other people with more hands-on experience with hitting the limit currently set by MAX_THREADS, a value of 1000 was decided to be more appropriate. The PR has been updated to reflect this.", "author": "DonalEvans", "createdAt": "2021-01-05T19:32:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMTgyMg=="}], "type": "inlineReview", "revised_code": {"commit": "fe230cab375f46c3afb6229efa79f4ebfcb57cdd", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/distributed/internal/OperationExecutors.java b/geode-core/src/main/java/org/apache/geode/distributed/internal/OperationExecutors.java\nindex 93f9731551..5f34af2b30 100644\n--- a/geode-core/src/main/java/org/apache/geode/distributed/internal/OperationExecutors.java\n+++ b/geode-core/src/main/java/org/apache/geode/distributed/internal/OperationExecutors.java\n\n@@ -26,7 +26,7 @@ import org.apache.geode.distributed.internal.membership.InternalDistributedMembe\n  */\n public interface OperationExecutors {\n   int MAX_THREADS =\n-      Integer.getInteger(\"DistributionManager.MAX_THREADS\", 300);\n+      Integer.getInteger(\"DistributionManager.MAX_THREADS\", 1000);\n \n   int MAX_FE_THREADS = Integer.getInteger(\"DistributionManager.MAX_FE_THREADS\",\n       Math.max(Runtime.getRuntime().availableProcessors() * 16, 100));\n"}}, {"oid": "c4b3236f58b1ab932f6fa0cd1a38e807e603c8da", "url": "https://github.com/apache/geode/commit/c4b3236f58b1ab932f6fa0cd1a38e807e603c8da", "message": "GEODE-8799: Increase defaults for MAX_THREADS and MAX_PR_THREADS\n\n- MAX_THREADS new default is 300\n- MAX_PR_THREADS new default is\nMath.max(Runtime.getRuntime().availableProcessors() * 32, 200))\n- Removed unit test case for setting system property, since it cannot be\ncleared afterwards without unloading the class\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T18:44:58Z", "type": "commit"}, {"oid": "e0ef863bbb94f9711a48f575e69e6f633eff25ab", "url": "https://github.com/apache/geode/commit/e0ef863bbb94f9711a48f575e69e6f633eff25ab", "message": "Correct default values in properties.html\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T18:44:58Z", "type": "commit"}, {"oid": "fe230cab375f46c3afb6229efa79f4ebfcb57cdd", "url": "https://github.com/apache/geode/commit/fe230cab375f46c3afb6229efa79f4ebfcb57cdd", "message": "Change MAX_THREADS default to 1000\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T18:44:58Z", "type": "commit"}, {"oid": "fe230cab375f46c3afb6229efa79f4ebfcb57cdd", "url": "https://github.com/apache/geode/commit/fe230cab375f46c3afb6229efa79f4ebfcb57cdd", "message": "Change MAX_THREADS default to 1000\n\nAuthored-by: Donal Evans <doevans@vmware.com>", "committedDate": "2021-01-05T18:44:58Z", "type": "forcePushed"}]}