{"pr_number": 5041, "pr_title": "GEODE-8060: Fix flakiness in GemFireCacheImplCloseTest", "pr_createdAt": "2020-05-04T16:30:16Z", "pr_url": "https://github.com/apache/geode/pull/5041", "timeline": [{"oid": "b97b9380355798c8c4c49c7c63c8935bbe40b00a", "url": "https://github.com/apache/geode/commit/b97b9380355798c8c4c49c7c63c8935bbe40b00a", "message": "GEODE-8060: Fix flakiness in GemFireCacheImplCloseTest", "committedDate": "2020-05-04T16:27:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk1NTU5OA==", "url": "https://github.com/apache/geode/pull/5041#discussion_r420955598", "bodyText": "The interrupt flag should be reset after catching InterruptedException", "author": "kirklund", "createdAt": "2020-05-06T17:13:42Z", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/GemFireCacheImpl.java", "diffHunk": "@@ -2377,15 +2381,25 @@ public void close(String reason, Throwable systemFailureCause, boolean keepAlive\n       } finally {\n         CLOSING_THREAD.remove();\n       }\n+      return true;\n     }\n   }\n \n-  private void waitUntilClosed() {\n-    try {\n-      isClosedLatch.await();\n-    } catch (InterruptedException ignore) {\n-      // ignored\n+  /**\n+   * Returns true if caller waited on the {@code isClosedLatch}.\n+   */\n+  private boolean waitIfClosing(boolean skipAwait) {\n+    if (isClosing) {\n+      if (!skipAwait && !Thread.currentThread().equals(CLOSING_THREAD.get())) {\n+        try {\n+          isClosedLatch.await();\n+        } catch (InterruptedException ignore) {\n+          // ignored", "originalCommit": "b97b9380355798c8c4c49c7c63c8935bbe40b00a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "42583c79341691c0e747d7806653ad89f42d6f66", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/internal/cache/GemFireCacheImpl.java b/geode-core/src/main/java/org/apache/geode/internal/cache/GemFireCacheImpl.java\nindex 656fd7c3ef..caa2532a25 100755\n--- a/geode-core/src/main/java/org/apache/geode/internal/cache/GemFireCacheImpl.java\n+++ b/geode-core/src/main/java/org/apache/geode/internal/cache/GemFireCacheImpl.java\n\n@@ -2391,10 +2391,15 @@ public class GemFireCacheImpl implements InternalCache, InternalClientCache, Has\n   private boolean waitIfClosing(boolean skipAwait) {\n     if (isClosing) {\n       if (!skipAwait && !Thread.currentThread().equals(CLOSING_THREAD.get())) {\n+        boolean interrupted = false;\n         try {\n           isClosedLatch.await();\n-        } catch (InterruptedException ignore) {\n-          // ignored\n+        } catch (InterruptedException e) {\n+          interrupted = true;\n+        } finally {\n+          if (interrupted) {\n+            Thread.currentThread().interrupt();\n+          }\n         }\n       }\n       return true;\n"}}, {"oid": "42583c79341691c0e747d7806653ad89f42d6f66", "url": "https://github.com/apache/geode/commit/42583c79341691c0e747d7806653ad89f42d6f66", "message": "Fixup interrupt handling", "committedDate": "2020-05-06T17:29:00Z", "type": "commit"}]}