{"pr_number": 5653, "pr_title": "GEODE-8643: Fix IllegalArgumentException in ParallelGatewaySenderQueu\u2026", "pr_createdAt": "2020-10-22T15:32:10Z", "pr_url": "https://github.com/apache/geode/pull/5653", "timeline": [{"oid": "b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "url": "https://github.com/apache/geode/commit/b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "message": "GEODE-8643: Fix IllegalArgumentException in ParallelGatewaySenderQueue for negative sleep value", "committedDate": "2020-10-23T08:20:39Z", "type": "commit"}, {"oid": "b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "url": "https://github.com/apache/geode/commit/b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "message": "GEODE-8643: Fix IllegalArgumentException in ParallelGatewaySenderQueue for negative sleep value", "committedDate": "2020-10-23T08:20:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2Mjk1Mg==", "url": "https://github.com/apache/geode/pull/5653#discussion_r512362952", "bodyText": "Can we restrict the access to package protected if we remove the private restriction.\nCould we possibly also rename the method to \"calculateTimeToSleep\", as it is clearer than the current method name.", "author": "kohlmu-pivotal", "createdAt": "2020-10-27T01:30:08Z", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java", "diffHunk": "@@ -1393,7 +1393,11 @@ private boolean areAllTransactionsCompleteInBatch(Map incompleteTransactions) {\n     return (incompleteTransactions.size() == 0);\n   }\n \n-  private long getTimeToSleep(long timeToWait) {\n+  @VisibleForTesting\n+  public static long getTimeToSleep(long timeToWait) {", "originalCommit": "b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ1MTg1Nw==", "url": "https://github.com/apache/geode/pull/5653#discussion_r512451857", "bodyText": "Good points, thanks.", "author": "albertogpz", "createdAt": "2020-10-27T06:54:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2Mjk1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b23167f494fbea83c38113ee87d809d3c9d2b9df", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java b/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\nindex ce4eecc822..472fb41410 100644\n--- a/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\n+++ b/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\n\n@@ -1394,8 +1394,8 @@ public class ParallelGatewaySenderQueue implements RegionQueue {\n   }\n \n   @VisibleForTesting\n-  public static long getTimeToSleep(long timeToWait) {\n-    if (timeToWait < 0) {\n+  static long calculateTimeToSleep(long timeToWait) {\n+    if (timeToWait <= 0) {\n       return 0;\n     }\n     // Get the minimum of 50 and 5% of the time to wait (which by default is 1000 ms)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2NzU2MA==", "url": "https://github.com/apache/geode/pull/5653#discussion_r512367560", "bodyText": "surely this logic could be timeToWait <= 0.\nIf so, can we amend and add a test.", "author": "kohlmu-pivotal", "createdAt": "2020-10-27T01:46:38Z", "path": "geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java", "diffHunk": "@@ -1393,7 +1393,11 @@ private boolean areAllTransactionsCompleteInBatch(Map incompleteTransactions) {\n     return (incompleteTransactions.size() == 0);\n   }\n \n-  private long getTimeToSleep(long timeToWait) {\n+  @VisibleForTesting\n+  public static long getTimeToSleep(long timeToWait) {\n+    if (timeToWait < 0) {", "originalCommit": "b5c8e88cfa63c33573e071c365aaad8c8f0980fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjQ1MTkyMQ==", "url": "https://github.com/apache/geode/pull/5653#discussion_r512451921", "bodyText": "Agree.", "author": "albertogpz", "createdAt": "2020-10-27T06:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM2NzU2MA=="}], "type": "inlineReview", "revised_code": {"commit": "b23167f494fbea83c38113ee87d809d3c9d2b9df", "chunk": "diff --git a/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java b/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\nindex ce4eecc822..472fb41410 100644\n--- a/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\n+++ b/geode-core/src/main/java/org/apache/geode/internal/cache/wan/parallel/ParallelGatewaySenderQueue.java\n\n@@ -1394,8 +1394,8 @@ public class ParallelGatewaySenderQueue implements RegionQueue {\n   }\n \n   @VisibleForTesting\n-  public static long getTimeToSleep(long timeToWait) {\n-    if (timeToWait < 0) {\n+  static long calculateTimeToSleep(long timeToWait) {\n+    if (timeToWait <= 0) {\n       return 0;\n     }\n     // Get the minimum of 50 and 5% of the time to wait (which by default is 1000 ms)\n"}}, {"oid": "b23167f494fbea83c38113ee87d809d3c9d2b9df", "url": "https://github.com/apache/geode/commit/b23167f494fbea83c38113ee87d809d3c9d2b9df", "message": "GEODE-8643: Small corrections after review", "committedDate": "2020-10-27T06:57:33Z", "type": "commit"}]}