{"pr_number": 5552, "pr_title": "GEODE-8538: Create test to validate ordering of redis pipeline commands", "pr_createdAt": "2020-09-25T15:50:57Z", "pr_url": "https://github.com/apache/geode/pull/5552", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4MjMzMg==", "url": "https://github.com/apache/geode/pull/5552#discussion_r495082332", "bodyText": "NUMBER_OF_COMMAND_IN_PIPELINE looks like a constant, but isn't. It should be something like \"numberOfCommands\" or \"numberOfCommandsInPipeline\".", "author": "ringles", "createdAt": "2020-09-25T15:56:04Z", "path": "geode-redis/src/integrationTest/java/org/apache/geode/redis/CommandPipeliningIntegrationTest.java", "diffHunk": "@@ -93,6 +98,42 @@ public void whenPipelining_commandResponsesAreNotCorrupted() {\n     assertThat(mockSubscriber.getReceivedMessages()).isEqualTo(expectedMessages);\n   }\n \n+\n+  @Test\n+  public void should_returnResultsOfPipelinedCommands_inCorrectOrder() {\n+    Logger logger = LogManager.getLogger(\"org.apache.geode.redis.internal\");\n+    Configurator.setAllLevels(logger.getName(), Level.getLevel(\"DEBUG\"));\n+    FastLogger.setDelegating(true);\n+\n+    Jedis jedis = new Jedis(\"localhost\", server.getPort(), 10000000);\n+    int NUMBER_OF_COMMANDS_IN_PIPELINE = 100;\n+    int numberOfPipeLineRequests = 1000;\n+\n+    do {\n+      Pipeline p = jedis.pipelined();\n+      for (int i = 0; i < NUMBER_OF_COMMANDS_IN_PIPELINE; i++) {\n+        p.echo(String.valueOf(i));\n+      }\n+\n+      List<Object> results = p.syncAndReturnAll();\n+\n+      verifyResultOrder(NUMBER_OF_COMMANDS_IN_PIPELINE, results);\n+      numberOfPipeLineRequests--;\n+    } while (numberOfPipeLineRequests > 0);\n+\n+    jedis.flushAll();\n+    jedis.close();\n+  }\n+\n+  private void verifyResultOrder(int NUMBER_OF_COMMAND_IN_PIPELINE, List<Object> results) {", "originalCommit": "5c5f4737ab851b4aae41987255a42b2926e8be39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4NTEwOA==", "url": "https://github.com/apache/geode/pull/5552#discussion_r495085108", "bodyText": "made final.  Thanks!", "author": "jhutchison", "createdAt": "2020-09-25T16:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4MjMzMg=="}], "type": "inlineReview", "revised_code": {"commit": "ac89efe42d879afffde11c91833c6e43baa13c81", "chunk": "diff --git a/geode-redis/src/integrationTest/java/org/apache/geode/redis/CommandPipeliningIntegrationTest.java b/geode-redis/src/integrationTest/java/org/apache/geode/redis/CommandPipeliningIntegrationTest.java\nindex d46f67ec46..d3f29fdeeb 100644\n--- a/geode-redis/src/integrationTest/java/org/apache/geode/redis/CommandPipeliningIntegrationTest.java\n+++ b/geode-redis/src/integrationTest/java/org/apache/geode/redis/CommandPipeliningIntegrationTest.java\n\n@@ -106,7 +106,7 @@ public class CommandPipeliningIntegrationTest {\n     FastLogger.setDelegating(true);\n \n     Jedis jedis = new Jedis(\"localhost\", server.getPort(), 10000000);\n-    int NUMBER_OF_COMMANDS_IN_PIPELINE = 100;\n+   final int NUMBER_OF_COMMANDS_IN_PIPELINE = 100;\n     int numberOfPipeLineRequests = 1000;\n \n     do {\n"}}, {"oid": "ac89efe42d879afffde11c91833c6e43baa13c81", "url": "https://github.com/apache/geode/commit/ac89efe42d879afffde11c91833c6e43baa13c81", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds", "committedDate": "2020-09-25T15:59:19Z", "type": "forcePushed"}, {"oid": "3b470560d0c151b4908cad9f67166e2c6eb370ae", "url": "https://github.com/apache/geode/commit/3b470560d0c151b4908cad9f67166e2c6eb370ae", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds", "committedDate": "2020-09-25T16:02:00Z", "type": "forcePushed"}, {"oid": "0a326e905efd43c707c50a8caae51d522288046b", "url": "https://github.com/apache/geode/commit/0a326e905efd43c707c50a8caae51d522288046b", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds", "committedDate": "2020-09-25T17:04:42Z", "type": "forcePushed"}, {"oid": "bde0b1038fe45d822dc5c83e845ecf64b246a5af", "url": "https://github.com/apache/geode/commit/bde0b1038fe45d822dc5c83e845ecf64b246a5af", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds\n\nCo-authored-by: Ray Ingles <ringles@vmware.com>\nCo-authored-by: Darrel Schneider <darrel@vmware.com>\nCo-authored-by: Jens Deppe <jdeppe@vmware.com>\nCo-authored-by: Sarah Abbey <sabbey@vmware.com>", "committedDate": "2020-10-01T13:57:13Z", "type": "forcePushed"}, {"oid": "a5572c5810c0fcce06b2c36eaa631169827a931a", "url": "https://github.com/apache/geode/commit/a5572c5810c0fcce06b2c36eaa631169827a931a", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds\n\nCo-authored-by: Ray Ingles <ringles@vmware.com>\nCo-authored-by: Darrel Schneider <darrel@vmware.com>\nCo-authored-by: Jens Deppe <jdeppe@vmware.com>\nCo-authored-by: Sarah Abbey <sabbey@vmware.com>", "committedDate": "2020-10-05T18:30:46Z", "type": "commit"}, {"oid": "a5572c5810c0fcce06b2c36eaa631169827a931a", "url": "https://github.com/apache/geode/commit/a5572c5810c0fcce06b2c36eaa631169827a931a", "message": "GEODE-8538: Create test to validate ordering of redis pipeline commnds\n\nCo-authored-by: Ray Ingles <ringles@vmware.com>\nCo-authored-by: Darrel Schneider <darrel@vmware.com>\nCo-authored-by: Jens Deppe <jdeppe@vmware.com>\nCo-authored-by: Sarah Abbey <sabbey@vmware.com>", "committedDate": "2020-10-05T18:30:46Z", "type": "forcePushed"}, {"oid": "07500a1ed999d6ae4bd8e2b620728d6ec18f036f", "url": "https://github.com/apache/geode/commit/07500a1ed999d6ae4bd8e2b620728d6ec18f036f", "message": "spA", "committedDate": "2020-10-05T20:34:32Z", "type": "commit"}]}