{"pr_number": 5165, "pr_title": "GEODE-8182: change String commands to use one region", "pr_createdAt": "2020-05-27T02:30:02Z", "pr_url": "https://github.com/apache/geode/pull/5165", "timeline": [{"oid": "fddb3377d27b66063302a9ee9c4ac6ea3acdf18e", "url": "https://github.com/apache/geode/commit/fddb3377d27b66063302a9ee9c4ac6ea3acdf18e", "message": "WIP - first stab at moving Strings to dataRegion", "committedDate": "2020-05-26T21:45:30Z", "type": "commit"}, {"oid": "7b7fccd68184803bc1310253485f8a4e9b3cca29", "url": "https://github.com/apache/geode/commit/7b7fccd68184803bc1310253485f8a4e9b3cca29", "message": "changed all String commands to use the function and to use a single region", "committedDate": "2020-05-27T02:27:45Z", "type": "commit"}, {"oid": "6317a628e7cdf24a505290ab20deaab90d391c13", "url": "https://github.com/apache/geode/commit/6317a628e7cdf24a505290ab20deaab90d391c13", "message": "fixed StringsIntegrationTest failures and\nrenabled tests ignored for GEODE-8182", "committedDate": "2020-05-27T05:47:45Z", "type": "commit"}, {"oid": "99e9a8466ad88509c636e5ec395b392301a036cd", "url": "https://github.com/apache/geode/commit/99e9a8466ad88509c636e5ec395b392301a036cd", "message": "fixed smove", "committedDate": "2020-05-27T05:53:30Z", "type": "commit"}, {"oid": "4389b9bd5b72bf3a073779e809ce2755c851b371", "url": "https://github.com/apache/geode/commit/4389b9bd5b72bf3a073779e809ce2755c851b371", "message": "fixed expiration cleanup", "committedDate": "2020-05-27T05:58:29Z", "type": "commit"}, {"oid": "a599bddcefdfecf0f25e0d04092cabc6140b2d79", "url": "https://github.com/apache/geode/commit/a599bddcefdfecf0f25e0d04092cabc6140b2d79", "message": "removed the RedisLockService since it is not used in the new data model", "committedDate": "2020-05-27T06:13:26Z", "type": "commit"}, {"oid": "b20ec313ba4e383e90571a129fbc6b4795b49794", "url": "https://github.com/apache/geode/commit/b20ec313ba4e383e90571a129fbc6b4795b49794", "message": "removed the unused del methods on RedisSetCommands and RedisHashCommands", "committedDate": "2020-05-27T06:22:41Z", "type": "commit"}, {"oid": "fb1e6574339d6fcb48a8c2e4941a5e63b4f167cd", "url": "https://github.com/apache/geode/commit/fb1e6574339d6fcb48a8c2e4941a5e63b4f167cd", "message": "fixed LGTM warning", "committedDate": "2020-05-27T06:24:23Z", "type": "commit"}, {"oid": "3b4c1cd9aef9ff1a13b5172c58ae56c93934af5e", "url": "https://github.com/apache/geode/commit/3b4c1cd9aef9ff1a13b5172c58ae56c93934af5e", "message": "removed the KeyRegistar since it was no longer needed with a single data region", "committedDate": "2020-05-27T07:04:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MDI1NA==", "url": "https://github.com/apache/geode/pull/5165#discussion_r431140254", "bodyText": "This should be SetOptions(NX, 0L, ExpireUnit.NONE, false);", "author": "jdeppe-pivotal", "createdAt": "2020-05-27T13:42:15Z", "path": "geode-redis/src/main/java/org/apache/geode/redis/internal/executor/string/SetNXExecutor.java", "diffHunk": "@@ -36,27 +36,23 @@\n   public void executeCommand(Command command, ExecutionHandlerContext context) {\n     List<byte[]> commandElems = command.getProcessedCommand();\n \n-    Region<ByteArrayWrapper, RedisData> region =\n-        context.getRegionProvider().getStringsRegion();\n-\n     if (commandElems.size() < 3) {\n       command.setResponse(Coder.getErrorResponse(context.getByteBufAllocator(), ArityDef.SETNX));\n       return;\n     }\n \n     ByteArrayWrapper key = command.getKey();\n-    checkAndSetDataType(key, context);\n-    byte[] value = commandElems.get(VALUE_INDEX);\n+    ByteArrayWrapper value = new ByteArrayWrapper(commandElems.get(VALUE_INDEX));\n \n-    Object oldValue =\n-        region.putIfAbsent(key, (RedisData) new RedisString(new ByteArrayWrapper(value)));\n+    RedisStringCommands stringCommands = getRedisStringCommands(context);\n+    SetOptions setOptions = new SetOptions(NX, 0L, null, false);", "originalCommit": "3b4c1cd9aef9ff1a13b5172c58ae56c93934af5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTIzODQ1Nw==", "url": "https://github.com/apache/geode/pull/5165#discussion_r431238457", "bodyText": "Thanks for pointing this out. At this time, all that is used on the SetOptions when we call RedisStringCommands.set is the first parameter (NX in this case) so I just went with defaults on all the others. Some of these apply to expiration so they will be reviewed when the string expiration work is done.", "author": "dschneider-pivotal", "createdAt": "2020-05-27T15:36:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE0MDI1NA=="}], "type": "inlineReview", "revised_code": null}]}