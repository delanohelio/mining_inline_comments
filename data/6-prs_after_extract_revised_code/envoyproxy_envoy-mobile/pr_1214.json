{"pr_number": 1214, "pr_title": "Expose histogram envoy stats methods to interface & engines", "pr_createdAt": "2020-12-18T18:00:04Z", "pr_url": "https://github.com/envoyproxy/envoy-mobile/pull/1214", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjAwMzM4Nw==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1214#discussion_r546003387", "bodyText": "This will be used in a follow-up PR for the actual interface that clients will use to record histogram stats.", "author": "donyu", "createdAt": "2020-12-18T18:12:23Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/AndroidEngineImpl.java", "diffHunk": "@@ -60,6 +60,16 @@ public int recordGaugeSub(String elements, int amount) {\n     return envoyEngine.recordGaugeSub(elements, amount);\n   }\n \n+  @Override\n+  public int recordGaugeSub(String elements, int amount) {\n+    return envoyEngine.recordGaugeSub(elements, amount);\n+  }\n+\n+  @Override\n+  public int recordHistogramDurationMs(String elements, int duration) {", "originalCommit": "db7f194adeb52375b3e8e005935c057d9ee4cf1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "07b5c07b4174ede4d013ae22cb97bc7e328fb43b", "chunk": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/AndroidEngineImpl.java b/library/java/src/io/envoyproxy/envoymobile/engine/AndroidEngineImpl.java\nindex acc312ab..b42e9c89 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/AndroidEngineImpl.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/AndroidEngineImpl.java\n\n@@ -66,8 +66,8 @@ public class AndroidEngineImpl implements EnvoyEngine {\n   }\n \n   @Override\n-  public int recordHistogramDurationMs(String elements, int duration) {\n-    return envoyEngine.recordHistogramDurationMs(elements, duration);\n+  public int recordHistogram(String elements, int value, HistogramUnit unitMeasure) {\n+    return envoyEngine.recordHistogram(elements, value, unitMeasure);\n   }\n \n   @Override\n"}}, {"oid": "07b5c07b4174ede4d013ae22cb97bc7e328fb43b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/07b5c07b4174ede4d013ae22cb97bc7e328fb43b", "message": "update interfaces again to separate timer and generic", "committedDate": "2021-01-22T17:50:03Z", "type": "forcePushed"}, {"oid": "6a8e0e8891a989bc2af960544c617a21e5482635", "url": "https://github.com/envoyproxy/envoy-mobile/commit/6a8e0e8891a989bc2af960544c617a21e5482635", "message": "uncommit temp bazel change", "committedDate": "2021-01-27T00:29:02Z", "type": "forcePushed"}, {"oid": "47f6deff7656bb630a57491ce2cf401ccd73d7e6", "url": "https://github.com/envoyproxy/envoy-mobile/commit/47f6deff7656bb630a57491ce2cf401ccd73d7e6", "message": "kotlin and swift lint\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-01-27T18:26:20Z", "type": "forcePushed"}, {"oid": "c8ce6d04ebf621add913fe51bc4d0a9743efc10b", "url": "https://github.com/envoyproxy/envoy-mobile/commit/c8ce6d04ebf621add913fe51bc4d0a9743efc10b", "message": "fix ordinal\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-01-27T21:11:43Z", "type": "forcePushed"}, {"oid": "cf64ce10ea17c7b7319cee5780e53089f0440706", "url": "https://github.com/envoyproxy/envoy-mobile/commit/cf64ce10ea17c7b7319cee5780e53089f0440706", "message": "fix ordinal\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-02T21:53:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODk1OTAxNg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1214#discussion_r568959016", "bodyText": "it's probably worth documenting (as a comment in this pr) the reason of pushing HistogramUnit enum to this layer (instead of keeping in below jni)", "author": "jingwei99", "createdAt": "2021-02-02T21:57:18Z", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyEngine.java", "diffHunk": "@@ -72,5 +73,15 @@ int runWithConfig(EnvoyConfiguration envoyConfiguration, String logLevel,\n    */\n   int recordGaugeSub(String elements, int amount);\n \n+  /**\n+   * Add another recorded amount to the histogram with the given string of elements.\n+   *\n+   * @param elements Elements of the histogram stat.\n+   * @param value Amount to record as a new value for the histogram distribution.\n+   * @param unitMeasure the unit of measurement (e.g. milliseconds, bytes, etc.)\n+   * @return A status indicating if the action was successful.\n+   */\n+  int recordHistogramValue(String elements, int value, HistogramUnit unitMeasure);", "originalCommit": "cf64ce10ea17c7b7319cee5780e53089f0440706", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MTEyNzAxMg==", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1214#discussion_r571127012", "bodyText": "I updated to hide the enum at the JNI layer. I think it's cleaner to have 2 separate implementations here.", "author": "donyu", "createdAt": "2021-02-05T17:22:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODk1OTAxNg=="}], "type": "inlineReview", "revised_code": {"commit": "5b93771bbdd82cea92acc0811a218108a5f3a5d2", "chunk": "diff --git a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyEngine.java b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyEngine.java\nindex f9198bd9..7cfa49c3 100644\n--- a/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyEngine.java\n+++ b/library/java/src/io/envoyproxy/envoymobile/engine/EnvoyEngine.java\n\n@@ -74,14 +73,22 @@ public interface EnvoyEngine {\n   int recordGaugeSub(String elements, int amount);\n \n   /**\n-   * Add another recorded amount to the histogram with the given string of elements.\n+   * Add another recorded duration in ms to the timer histogram with the given string of elements.\n+   *\n+   * @param elements Elements of the histogram stat.\n+   * @param durationMs Duration value to record in the histogram timer distribution.\n+   * @return A status indicating if the action was successful.\n+   */\n+  int recordHistogramDuration(String elements, int durationMs);\n+\n+  /**\n+   * Add another recorded value to the generic histogram with the given string of elements.\n    *\n    * @param elements Elements of the histogram stat.\n    * @param value Amount to record as a new value for the histogram distribution.\n-   * @param unitMeasure the unit of measurement (e.g. milliseconds, bytes, etc.)\n    * @return A status indicating if the action was successful.\n    */\n-  int recordHistogramValue(String elements, int value, HistogramUnit unitMeasure);\n+  int recordHistogramValue(String elements, int value);\n \n   int registerStringAccessor(String accessor_name, EnvoyStringAccessor accessor);\n }\n"}}, {"oid": "5b93771bbdd82cea92acc0811a218108a5f3a5d2", "url": "https://github.com/envoyproxy/envoy-mobile/commit/5b93771bbdd82cea92acc0811a218108a5f3a5d2", "message": "create elements string in constructor + update examples\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-05T17:15:09Z", "type": "forcePushed"}, {"oid": "8f3f5f8f5933f7e225f1a4bbbbf33976a102044c", "url": "https://github.com/envoyproxy/envoy-mobile/commit/8f3f5f8f5933f7e225f1a4bbbbf33976a102044c", "message": "create elements string in constructor + update examples\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-05T17:32:05Z", "type": "forcePushed"}, {"oid": "1cba1767a8ffef5d50ef2a534e249f93b8d5b442", "url": "https://github.com/envoyproxy/envoy-mobile/commit/1cba1767a8ffef5d50ef2a534e249f93b8d5b442", "message": "fix examples\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-05T22:09:28Z", "type": "forcePushed"}, {"oid": "743486b67a9b35b823655ca751981530fdb08c1f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/743486b67a9b35b823655ca751981530fdb08c1f", "message": "rename Histogram public api to Distribution\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T00:34:57Z", "type": "forcePushed"}, {"oid": "d4f2d4af632bc9d8bc695266f69f51c7786ad9f4", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d4f2d4af632bc9d8bc695266f69f51c7786ad9f4", "message": "[WIP] Expose histogram envoy stats to mobile clients\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "bba4ec51ff54bf00ddc7a73cfdbdf36a4e5b0a8e", "url": "https://github.com/envoyproxy/envoy-mobile/commit/bba4ec51ff54bf00ddc7a73cfdbdf36a4e5b0a8e", "message": "stats bridge for Android\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "4eab8887bfc6c10c11fec8ee4bd484edac710333", "url": "https://github.com/envoyproxy/envoy-mobile/commit/4eab8887bfc6c10c11fec8ee4bd484edac710333", "message": "also bridge to objective-c/swift\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "623ec2ffe55c6c9b24db517588efb92ac3e1b8f6", "url": "https://github.com/envoyproxy/envoy-mobile/commit/623ec2ffe55c6c9b24db517588efb92ac3e1b8f6", "message": "Incorporate different unit measurements for histogram\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "89bf5d1950066ef6bad86d6e6a1520a4222f749f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/89bf5d1950066ef6bad86d6e6a1520a4222f749f", "message": "Expose mobile interfaces for Histogram Pulse metric\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "c08134b2d0aeaa882cd814755b75f91ecfc02250", "url": "https://github.com/envoyproxy/envoy-mobile/commit/c08134b2d0aeaa882cd814755b75f91ecfc02250", "message": "tests for Android\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "d4cad6e2b92113f7ef5aad6f23fe493f53b20d54", "url": "https://github.com/envoyproxy/envoy-mobile/commit/d4cad6e2b92113f7ef5aad6f23fe493f53b20d54", "message": "update interfaces again to separate timer and generic\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "263ee4b7a9fed9826d7b9bba1f8cffa820efdc69", "url": "https://github.com/envoyproxy/envoy-mobile/commit/263ee4b7a9fed9826d7b9bba1f8cffa820efdc69", "message": "lints\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "33778be91b29f7e7e7fd56a70d3db152502e3074", "url": "https://github.com/envoyproxy/envoy-mobile/commit/33778be91b29f7e7e7fd56a70d3db152502e3074", "message": "match Android\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "2bd908b9c7af756f32e5dd192a063c5ae52df59d", "url": "https://github.com/envoyproxy/envoy-mobile/commit/2bd908b9c7af756f32e5dd192a063c5ae52df59d", "message": "more lints\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "023b8a7ca1d822fb8a89faa79915c730505a7f83", "url": "https://github.com/envoyproxy/envoy-mobile/commit/023b8a7ca1d822fb8a89faa79915c730505a7f83", "message": "uncommit temp bazel change\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "7081f9a2e1c5feb660c3895d858bc87c650bdeea", "url": "https://github.com/envoyproxy/envoy-mobile/commit/7081f9a2e1c5feb660c3895d858bc87c650bdeea", "message": "more lints\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "c97013e45f692bd24e767be06edb294aa0ac997e", "url": "https://github.com/envoyproxy/envoy-mobile/commit/c97013e45f692bd24e767be06edb294aa0ac997e", "message": "new test\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "21d6019e52b93bba4a7a3a95c114fd7f6b658c44", "url": "https://github.com/envoyproxy/envoy-mobile/commit/21d6019e52b93bba4a7a3a95c114fd7f6b658c44", "message": "clang format\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "ae1a0df93257bddf0c84c566c3f24d57ab67d767", "url": "https://github.com/envoyproxy/envoy-mobile/commit/ae1a0df93257bddf0c84c566c3f24d57ab67d767", "message": "kotlin and swift lint\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "dcb2015dff0783e3bf40e3e16c86016c4b8e12f9", "url": "https://github.com/envoyproxy/envoy-mobile/commit/dcb2015dff0783e3bf40e3e16c86016c4b8e12f9", "message": "pass enum in JNI\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "6fb1bcc83924dd160e747ec1457df89383efc7c0", "url": "https://github.com/envoyproxy/envoy-mobile/commit/6fb1bcc83924dd160e747ec1457df89383efc7c0", "message": "fix ordinal\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "a66a081c31920ef80f4affdbb117173e2ce1f38f", "url": "https://github.com/envoyproxy/envoy-mobile/commit/a66a081c31920ef80f4affdbb117173e2ce1f38f", "message": "update docs\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "8ab01eb3eb2a3563c4de130856a1f5742f44c461", "url": "https://github.com/envoyproxy/envoy-mobile/commit/8ab01eb3eb2a3563c4de130856a1f5742f44c461", "message": "docs + examples update\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "c92a92cc8c0255ab3be980ef8f71ef304fd133f6", "url": "https://github.com/envoyproxy/envoy-mobile/commit/c92a92cc8c0255ab3be980ef8f71ef304fd133f6", "message": "remove enum from API java/kotlin/swift layers\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "bfc91e5a4d979c1ebc60bc3befe10880ba956315", "url": "https://github.com/envoyproxy/envoy-mobile/commit/bfc91e5a4d979c1ebc60bc3befe10880ba956315", "message": "create elements string in constructor + update examples\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "a071d086404d5ee67a14b73f9b28f2cbdb8982fb", "url": "https://github.com/envoyproxy/envoy-mobile/commit/a071d086404d5ee67a14b73f9b28f2cbdb8982fb", "message": "fix examples\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "64e5a0e1e805bb4d643c48c0e8fec00223805cc8", "url": "https://github.com/envoyproxy/envoy-mobile/commit/64e5a0e1e805bb4d643c48c0e8fec00223805cc8", "message": "rename Histogram public api to Distribution\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "commit"}, {"oid": "64e5a0e1e805bb4d643c48c0e8fec00223805cc8", "url": "https://github.com/envoyproxy/envoy-mobile/commit/64e5a0e1e805bb4d643c48c0e8fec00223805cc8", "message": "rename Histogram public api to Distribution\n\nSigned-off-by: Don Yu <donyu@lyft.com>", "committedDate": "2021-02-06T02:50:02Z", "type": "forcePushed"}]}