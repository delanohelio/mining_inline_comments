{"pr_number": 4614, "pr_title": "DB-10503 fix foreign key child interceptor's checks for parent row existence", "pr_createdAt": "2020-11-16T17:49:00Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/4614", "timeline": [{"oid": "5b30d594a1feaaf01bd0799d6f5d525f326e3824", "url": "https://github.com/splicemachine/spliceengine/commit/5b30d594a1feaaf01bd0799d6f5d525f326e3824", "message": "DB-10503 fix FK child intercerptor checks for row existence in parent.", "committedDate": "2020-11-16T17:47:51Z", "type": "commit"}, {"oid": "7b466eac594b38926069598ed3f427eda2ba99c2", "url": "https://github.com/splicemachine/spliceengine/commit/7b466eac594b38926069598ed3f427eda2ba99c2", "message": "DB-10503 add test.", "committedDate": "2020-11-16T17:48:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAxOTQ4OA==", "url": "https://github.com/splicemachine/spliceengine/pull/4614#discussion_r525019488", "bodyText": "does it make sense still to use switch here, as most of the cases empty? Maybe \"if\" will look simpler", "author": "ipraznik-splice", "createdAt": "2020-11-17T09:48:20Z", "path": "splice_machine/src/main/java/com/splicemachine/pipeline/foreignkey/ForeignKeyChildInterceptWriteHandler.java", "diffHunk": "@@ -159,24 +159,20 @@ public void close(WriteContext ctx) throws IOException {\n \n     private boolean hasData(DataResult result,SimpleTxnFilter filter) throws IOException {\n         if(result!=null && !result.isEmpty()) {\n-            int cellCount = result.size();\n             for (DataCell dc : result) {\n                 DataFilter.ReturnCode returnCode = filter.filterCell(dc);\n                 switch (returnCode) {\n-                    case NEXT_ROW:\n-                        return false; //the entire row is filtered\n-                    case SKIP:\n-                    case NEXT_COL:\n-                    case SEEK:\n-                        cellCount--; //the cell is filtered\n-                        break;\n-                    case INCLUDE:\n+                    case INCLUDE: // fallthrough\n                     case INCLUDE_AND_NEXT_COL: //the cell is included, so we have some data\n-                    default: //do nothing\n+                        return true;\n+                    case SKIP: // fallthrough\n+                    case NEXT_COL: // fallthrough\n+                    case SEEK: // fallthrough\n+                    case NEXT_ROW: // fallthrough\n+                    default: //do nothing, keep trying", "originalCommit": "7b466eac594b38926069598ed3f427eda2ba99c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyMTU3Mg==", "url": "https://github.com/splicemachine/spliceengine/pull/4614#discussion_r525021572", "bodyText": "If it is OK, I would rather keep it this way mainly to illustrate the exact purpose of the algorithm for each DataFilter.ReturnCode return type. But I don't have strong opinion about it and can still change it if you think this doesn't make too much sense.", "author": "hatyo", "createdAt": "2020-11-17T09:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAxOTQ4OA=="}], "type": "inlineReview", "revised_code": null}]}