{"pr_number": 3991, "pr_title": "DB-8752 Delete obsolete statistics entries when truncating tables", "pr_createdAt": "2020-08-17T11:05:24Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3991", "timeline": [{"oid": "03e0dca64f552dd6e65181888e6423838693ab5f", "url": "https://github.com/splicemachine/spliceengine/commit/03e0dca64f552dd6e65181888e6423838693ab5f", "message": "DB-8752 Delete obsolete statistics entries when truncating tables", "committedDate": "2020-08-17T10:45:44Z", "type": "commit"}, {"oid": "3302f25bedae74f94ed5b4b83d5140182668faf3", "url": "https://github.com/splicemachine/spliceengine/commit/3302f25bedae74f94ed5b4b83d5140182668faf3", "message": "DB-8752 Improve the new test so it doesn't fail on Jenkins", "committedDate": "2020-08-17T14:48:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxMjgyMg==", "url": "https://github.com/splicemachine/spliceengine/pull/3991#discussion_r471612822", "bodyText": "DataDictionaryImpl.deletePartitionStatistics() will delete both table and column stats, so dd.deleteColumnStatistics(oldHeapConglom, tc); is redundant.", "author": "yxia92", "createdAt": "2020-08-17T16:57:13Z", "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/TruncateTableConstantOperation.java", "diffHunk": "@@ -225,9 +226,12 @@ private void truncateTable(TableDescriptor td, Activation activation) throws Sta\n             }\n         }\n \n+        // Remove statistics\n+        dd.deleteColumnStatistics(oldHeapConglom, tc);\n+        dd.deletePartitionStatistics(oldHeapConglom, tc);", "originalCommit": "3302f25bedae74f94ed5b4b83d5140182668faf3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk5NTAxMg==", "url": "https://github.com/splicemachine/spliceengine/pull/3991#discussion_r471995012", "bodyText": "Done.", "author": "ascend1", "createdAt": "2020-08-18T08:08:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxMjgyMg=="}], "type": "inlineReview", "revised_code": {"commit": "0b1085b9203cf0cfc8ee698b9f7f5d4984c9c8e3", "chunk": "diff --git a/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/TruncateTableConstantOperation.java b/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/TruncateTableConstantOperation.java\nindex e1043900be..e8c6522abf 100644\n--- a/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/TruncateTableConstantOperation.java\n+++ b/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/execute/actions/TruncateTableConstantOperation.java\n\n@@ -227,7 +227,6 @@ public class TruncateTableConstantOperation extends AlterTableConstantOperation{\n         }\n \n         // Remove statistics\n-        dd.deleteColumnStatistics(oldHeapConglom, tc);\n         dd.deletePartitionStatistics(oldHeapConglom, tc);\n \n         // Update the DataDictionary\n"}}, {"oid": "0b1085b9203cf0cfc8ee698b9f7f5d4984c9c8e3", "url": "https://github.com/splicemachine/spliceengine/commit/0b1085b9203cf0cfc8ee698b9f7f5d4984c9c8e3", "message": "DB-8752 Remove redundant call", "committedDate": "2020-08-18T07:21:51Z", "type": "commit"}]}