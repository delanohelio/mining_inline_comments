{"pr_number": 3558, "pr_title": "DB-9540 Make RegionLoads use bytes instead of MBs", "pr_createdAt": "2020-05-11T14:40:54Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3558", "timeline": [{"oid": "8f3c231f0262a63b35b17917880b66ae8f34f33a", "url": "https://github.com/splicemachine/spliceengine/commit/8f3c231f0262a63b35b17917880b66ae8f34f33a", "message": "DB-9540 Make RegionLoads use bytes instead of MBs\n\nFix RegionSplitsIT and don't require /BAD directory to exist for\nSpliceRegionAdminIT", "committedDate": "2020-05-11T08:30:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjEzOA==", "url": "https://github.com/splicemachine/spliceengine/pull/3558#discussion_r424586138", "bodyText": "Why storefileIndexSize is removed?", "author": "jyuanca", "createdAt": "2020-05-13T16:50:30Z", "path": "hbase_storage/src/main/java/com/splicemachine/storage/HPartitionLoad.java", "diffHunk": "@@ -19,15 +19,13 @@\n  *         Date: 1/7/16\n  */\n public class HPartitionLoad implements PartitionLoad{\n-    private final int storefileSizeMB;\n-    private final int memStoreSizeMB;\n-    private final int storefileIndexSizeMB;\n+    private final long storefileSize;\n+    private final long memStoreSize;", "originalCommit": "8f3c231f0262a63b35b17917880b66ae8f34f33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYxMTk5NQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3558#discussion_r426611995", "bodyText": "It wasn't used", "author": "dgomezferro", "createdAt": "2020-05-18T13:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4NjEzOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1ODc1NA==", "url": "https://github.com/splicemachine/spliceengine/pull/3558#discussion_r424658754", "bodyText": "Should we multiple 1024*1024 to get the number in bytes?", "author": "yxia92", "createdAt": "2020-05-13T18:50:47Z", "path": "hbase_storage/src/main/java/com/splicemachine/storage/HServerLoad.java", "diffHunk": "@@ -60,7 +60,7 @@ public long totalRequests(){\n         for(Map.Entry<byte[],RegionLoad> regionLoad:regionsLoad.entrySet()){\n             String name = Bytes.toString(regionLoad.getKey());\n             RegionLoad rl = regionLoad.getValue();\n-            PartitionLoad pl = new HPartitionLoad(name,rl.getStorefileSizeMB(),rl.getMemStoreSizeMB(),rl.getStorefileIndexSizeMB());\n+            PartitionLoad pl = new HPartitionLoad(name,rl.getStorefileSizeMB()*1024,rl.getMemStoreSizeMB()*1024);", "originalCommit": "8f3c231f0262a63b35b17917880b66ae8f34f33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjYxMjMyMw==", "url": "https://github.com/splicemachine/spliceengine/pull/3558#discussion_r426612323", "bodyText": "Good catch @yxia92 , addressed in a new commit", "author": "dgomezferro", "createdAt": "2020-05-18T13:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1ODc1NA=="}], "type": "inlineReview", "revised_code": {"commit": "f79ac4a3e295311e2c85f67ce2bb4acddbc57c03", "chunk": "diff --git a/hbase_storage/src/main/java/com/splicemachine/storage/HServerLoad.java b/hbase_storage/src/main/java/com/splicemachine/storage/HServerLoad.java\nindex 007fcbd5b3..d331a3cef4 100644\n--- a/hbase_storage/src/main/java/com/splicemachine/storage/HServerLoad.java\n+++ b/hbase_storage/src/main/java/com/splicemachine/storage/HServerLoad.java\n\n@@ -50,17 +52,17 @@ public class HServerLoad implements PartitionServerLoad{\n \n     @Override\n     public long totalRequests(){\n-        return load.getTotalNumberOfRequests();\n+        return load.getRequestCount();\n     }\n \n     @Override\n     public Set<PartitionLoad> getPartitionLoads(){\n-        Map<byte[], RegionLoad> regionsLoad=load.getRegionsLoad();\n+        Map<byte[], RegionMetrics> regionsLoad=load.getRegionMetrics();\n         Set<PartitionLoad> loads = new HashSet<>(regionsLoad.size(),0.9f);\n-        for(Map.Entry<byte[],RegionLoad> regionLoad:regionsLoad.entrySet()){\n+        for(Map.Entry<byte[], RegionMetrics> regionLoad:regionsLoad.entrySet()){\n             String name = Bytes.toString(regionLoad.getKey());\n-            RegionLoad rl = regionLoad.getValue();\n-            PartitionLoad pl = new HPartitionLoad(name,rl.getStorefileSizeMB()*1024,rl.getMemStoreSizeMB()*1024);\n+            RegionMetrics rm = regionLoad.getValue();\n+            PartitionLoad pl = new HPartitionLoad(name, (long) rm.getStoreFileSize().get(Size.Unit.BYTE), (long) rm.getMemStoreSize().get(Size.Unit.BYTE));\n             loads.add(pl);\n         }\n         return loads;\n"}}, {"oid": "f79ac4a3e295311e2c85f67ce2bb4acddbc57c03", "url": "https://github.com/splicemachine/spliceengine/commit/f79ac4a3e295311e2c85f67ce2bb4acddbc57c03", "message": "DB-9540 Fix conversion to bytes from MB", "committedDate": "2020-05-18T13:08:37Z", "type": "commit"}]}