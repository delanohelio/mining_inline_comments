{"pr_number": 4163, "pr_title": "DB-10084 HBase flush and compactions are aware of min retention period ", "pr_createdAt": "2020-09-21T10:22:08Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/4163", "timeline": [{"oid": "2f9301a293e77bf200ed01b410950a217416734e", "url": "https://github.com/splicemachine/spliceengine/commit/2f9301a293e77bf200ed01b410950a217416734e", "message": "DB-10084 WIP.", "committedDate": "2020-09-10T12:23:35Z", "type": "commit"}, {"oid": "a29fb0ce25433b46af4134a8711d4db5b6849c79", "url": "https://github.com/splicemachine/spliceengine/commit/a29fb0ce25433b46af4134a8711d4db5b6849c79", "message": "DB-10084 flush/compaction are aware of minRetentionPeriod.", "committedDate": "2020-09-10T12:23:35Z", "type": "commit"}, {"oid": "3f8fa905f17418188309ae407c6520a4b2008537", "url": "https://github.com/splicemachine/spliceengine/commit/3f8fa905f17418188309ae407c6520a4b2008537", "message": "DB-10084 Add default flusher to known places.", "committedDate": "2020-09-10T12:23:35Z", "type": "commit"}, {"oid": "2d6e6f14c3729d3b742bc9866289757e7791b62a", "url": "https://github.com/splicemachine/spliceengine/commit/2d6e6f14c3729d3b742bc9866289757e7791b62a", "message": "DB-10084 tolerate having Splice flusher not set properly.", "committedDate": "2020-09-10T12:23:35Z", "type": "commit"}, {"oid": "4c8dd1d46c8174a1652b736783bd758522fc2cb4", "url": "https://github.com/splicemachine/spliceengine/commit/4c8dd1d46c8174a1652b736783bd758522fc2cb4", "message": "DB-10084 address comments.", "committedDate": "2020-09-11T12:17:05Z", "type": "commit"}, {"oid": "5fac4f1f5417084bf5034bef2a0d36e08339fdb8", "url": "https://github.com/splicemachine/spliceengine/commit/5fac4f1f5417084bf5034bef2a0d36e08339fdb8", "message": "DB-10084 address comments.", "committedDate": "2020-09-14T14:25:52Z", "type": "commit"}, {"oid": "028751068fc4e7ab01d8b79e7b3fde2f51f95429", "url": "https://github.com/splicemachine/spliceengine/commit/028751068fc4e7ab01d8b79e7b3fde2f51f95429", "message": "Merge remote-tracking branch 'origin/master' into DB-10084", "committedDate": "2020-09-14T16:10:50Z", "type": "commit"}, {"oid": "3958379e4841b66c79a06d419f93c09fdc15ae1d", "url": "https://github.com/splicemachine/spliceengine/commit/3958379e4841b66c79a06d419f93c09fdc15ae1d", "message": "DB-10084 address further comments.", "committedDate": "2020-09-14T17:46:04Z", "type": "commit"}, {"oid": "00845b1a61114db00fd66ca545bf89b017d20018", "url": "https://github.com/splicemachine/spliceengine/commit/00845b1a61114db00fd66ca545bf89b017d20018", "message": "Merge remote-tracking branch 'origin/master' into DB-10084", "committedDate": "2020-09-21T09:53:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU3NDY1OA==", "url": "https://github.com/splicemachine/spliceengine/pull/4163#discussion_r492574658", "bodyText": "should it be in Java style getMinRetainedPeriod?", "author": "ipraznik-splice", "createdAt": "2020-09-22T08:53:06Z", "path": "db-engine/src/main/java/com/splicemachine/db/iapi/sql/dictionary/TableDescriptor.java", "diffHunk": "@@ -399,11 +399,11 @@ public void setPurgeDeletedRows(boolean purgeDeletedRows) {\n         this.purgeDeletedRows = purgeDeletedRows;\n     }\n \n-    public Long getMinRetainedVersions() {\n+    public Long minRetainedPeriod() {", "originalCommit": "00845b1a61114db00fd66ca545bf89b017d20018", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxMjU5MQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4163#discussion_r492612591", "bodyText": "Done", "author": "arnaud-splice", "createdAt": "2020-09-22T09:56:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU3NDY1OA=="}], "type": "inlineReview", "revised_code": {"commit": "482529254e265a64818881245c5dfcad6bdfc5cb", "chunk": "diff --git a/db-engine/src/main/java/com/splicemachine/db/iapi/sql/dictionary/TableDescriptor.java b/db-engine/src/main/java/com/splicemachine/db/iapi/sql/dictionary/TableDescriptor.java\nindex 99f0854de2..19e2373a13 100644\n--- a/db-engine/src/main/java/com/splicemachine/db/iapi/sql/dictionary/TableDescriptor.java\n+++ b/db-engine/src/main/java/com/splicemachine/db/iapi/sql/dictionary/TableDescriptor.java\n\n@@ -399,7 +399,7 @@ public class TableDescriptor extends TupleDescriptor implements UniqueSQLObjectD\n         this.purgeDeletedRows = purgeDeletedRows;\n     }\n \n-    public Long minRetainedPeriod() {\n+    public Long getMinRetentionPeriod() {\n         return minRetentionPeriod;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4OTExNQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4163#discussion_r492589115", "bodyText": "10 sec delay has to be removed", "author": "ipraznik-splice", "createdAt": "2020-09-22T09:16:36Z", "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java", "diffHunk": "@@ -1666,6 +1669,11 @@ public void addMinRetentionPeriodColumn(TransactionController tc) throws Standar\n             DataTypeDescriptor dtd = DataTypeDescriptor.getBuiltInDataTypeDescriptor(Types.BIGINT, 1);\n             tc.addColumnToConglomerate(td.getHeapConglomerateId(), colNumber, storableDV, dtd.getCollationType());\n \n+            try {\n+                Thread.sleep(10000);", "originalCommit": "00845b1a61114db00fd66ca545bf89b017d20018", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxMjY0Mg==", "url": "https://github.com/splicemachine/spliceengine/pull/4163#discussion_r492612642", "bodyText": "Done", "author": "arnaud-splice", "createdAt": "2020-09-22T09:56:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4OTExNQ=="}], "type": "inlineReview", "revised_code": {"commit": "482529254e265a64818881245c5dfcad6bdfc5cb", "chunk": "diff --git a/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java b/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java\nindex 08811dee45..77fa3ad9fe 100644\n--- a/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java\n+++ b/splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java\n\n@@ -1669,11 +1669,6 @@ public class SpliceDataDictionary extends DataDictionaryImpl{\n             DataTypeDescriptor dtd = DataTypeDescriptor.getBuiltInDataTypeDescriptor(Types.BIGINT, 1);\n             tc.addColumnToConglomerate(td.getHeapConglomerateId(), colNumber, storableDV, dtd.getCollationType());\n \n-            try {\n-                Thread.sleep(10000);\n-            } catch (InterruptedException e) {\n-                e.printStackTrace();\n-            }\n             columnDescriptor = new ColumnDescriptor(SYSTABLESRowFactory.MIN_RETENTION_PERIOD, colNumber,\n                     colNumber, dtd, null, null, td, uuid, 0, 0, td.getColumnSequence());\n \n"}}, {"oid": "482529254e265a64818881245c5dfcad6bdfc5cb", "url": "https://github.com/splicemachine/spliceengine/commit/482529254e265a64818881245c5dfcad6bdfc5cb", "message": "DB-10084 Address comments", "committedDate": "2020-09-22T09:36:26Z", "type": "commit"}, {"oid": "556434127e38cea7923b3fd726978e38374f3fc2", "url": "https://github.com/splicemachine/spliceengine/commit/556434127e38cea7923b3fd726978e38374f3fc2", "message": "DB-10084 Rename setMinRetainedPeriod to setMinRetentionPeriod", "committedDate": "2020-09-22T09:55:52Z", "type": "commit"}, {"oid": "13b80a27d9c1ab3abc6e9022fb0a3f26159260de", "url": "https://github.com/splicemachine/spliceengine/commit/13b80a27d9c1ab3abc6e9022fb0a3f26159260de", "message": "DB-10084 Return default value if region is offline", "committedDate": "2020-09-23T13:13:43Z", "type": "commit"}, {"oid": "f643dd64a162e797cb859acc6a7952d0210c2efe", "url": "https://github.com/splicemachine/spliceengine/commit/f643dd64a162e797cb859acc6a7952d0210c2efe", "message": "DB-10084 Suppress errors from getTxnLowWatermark in SpliceDefaultFlusher", "committedDate": "2020-09-23T14:25:15Z", "type": "commit"}, {"oid": "67de56acefcd5443d21d6a73814fc4e9283565c8", "url": "https://github.com/splicemachine/spliceengine/commit/67de56acefcd5443d21d6a73814fc4e9283565c8", "message": "Merge remote-tracking branch 'origin/master' into DB-10084", "committedDate": "2020-09-25T11:33:22Z", "type": "commit"}, {"oid": "7d483abc547edb522377ee46766dad2b681d7096", "url": "https://github.com/splicemachine/spliceengine/commit/7d483abc547edb522377ee46766dad2b681d7096", "message": "DB-10084 Remove assert", "committedDate": "2020-09-25T14:15:04Z", "type": "commit"}, {"oid": "7d483abc547edb522377ee46766dad2b681d7096", "url": "https://github.com/splicemachine/spliceengine/commit/7d483abc547edb522377ee46766dad2b681d7096", "message": "DB-10084 Remove assert", "committedDate": "2020-09-25T14:15:04Z", "type": "forcePushed"}, {"oid": "082a0cac08999ed308ebc86c087e723969c30160", "url": "https://github.com/splicemachine/spliceengine/commit/082a0cac08999ed308ebc86c087e723969c30160", "message": "DB-10084 Fix issue with ConfigBuilder", "committedDate": "2020-09-29T11:00:11Z", "type": "commit"}, {"oid": "165e3e9528f62a24603101f0b6e3f8947af638e2", "url": "https://github.com/splicemachine/spliceengine/commit/165e3e9528f62a24603101f0b6e3f8947af638e2", "message": "DB-10084 Fix 3 issues\n\n- Do not attempt to get transaction low watermark in Restore Mode\n\n- Fix default min_retention_period. If we can't find the right\ninformation, we should retain forever, instead of returning an unrelated\nOLDEST_TIME_TRAVEL_TX. A retention period is expressed in seconds,\nwhereas OLDEST_TIME_TRAVEL_TX is a transaction_id\n\n- getTxnLowWatermark should not try to get a specific Txn ID if the\nretention period is set to forever", "committedDate": "2020-10-01T16:02:46Z", "type": "commit"}]}