{"pr_number": 3197, "pr_title": "DB-9139 Print reason to choose engine in explain", "pr_createdAt": "2020-02-05T13:29:30Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3197", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwODI5OA==", "url": "https://github.com/splicemachine/spliceengine/pull/3197#discussion_r375608298", "bodyText": "Do we really need line 97? I think the dataSetProcessorType obtained from rsn.getCompilerContext().getDataSetProcessorType() is the final decision, and also the one that is passed to activation, so we don't need to go through every node in orderedNodes.", "author": "yxia92", "createdAt": "2020-02-06T02:08:24Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/ast/PlanPrinter.java", "diffHunk": "@@ -93,10 +93,10 @@ public Visitable defaultVisit(Visitable node) throws StandardException {\n             m.put(query,orderedNodes);\n             if (LOG.isDebugEnabled()){\n                 DataSetProcessorType currentType = rsn.getLanguageConnectionContext().getDataSetProcessorType();\n-                currentType = currentType.combine(queryHintedForcedType(orderedNodes));\n-                boolean useSpark = currentType.isSpark() || currentType.isDefaultControl() && PlanPrinter.shouldUseSpark(orderedNodes, true);\n+                currentType = currentType.combine(rsn.getCompilerContext().getDataSetProcessorType());\n+                currentType = currentType.combine(determineSpark(orderedNodes));", "originalCommit": "33a60ac4f3de9662fab99ffe1eddf89d45b41407", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTc4NjcwMw==", "url": "https://github.com/splicemachine/spliceengine/pull/3197#discussion_r375786703", "bodyText": "You're right, I merely refactored that function while keeping the behaviour intact, but we don't need that anymore. We also don't need the languagecontext.type as this one was put in compilercontext.type during the optimisation phase.", "author": "arnaud-splice", "createdAt": "2020-02-06T11:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwODI5OA=="}], "type": "inlineReview", "revised_code": {"commit": "93f82cddb7aef4ec801978eedc75b5673c3248f6", "chunk": "diff --git a/db-engine/src/main/java/com/splicemachine/db/impl/ast/PlanPrinter.java b/db-engine/src/main/java/com/splicemachine/db/impl/ast/PlanPrinter.java\nindex 60c7af9a45..898e398a9b 100644\n--- a/db-engine/src/main/java/com/splicemachine/db/impl/ast/PlanPrinter.java\n+++ b/db-engine/src/main/java/com/splicemachine/db/impl/ast/PlanPrinter.java\n\n@@ -92,9 +92,7 @@ public class PlanPrinter extends AbstractSpliceVisitor {\n             Map<String, Collection<QueryTreeNode>> m=planMap.get();\n             m.put(query,orderedNodes);\n             if (LOG.isDebugEnabled()){\n-                DataSetProcessorType currentType = rsn.getLanguageConnectionContext().getDataSetProcessorType();\n-                currentType = currentType.combine(rsn.getCompilerContext().getDataSetProcessorType());\n-                currentType = currentType.combine(determineSpark(orderedNodes));\n+                DataSetProcessorType currentType = rsn.getCompilerContext().getDataSetProcessorType();\n \n                 Iterator<String> nodes = planToIterator(orderedNodes, currentType);\n                 StringBuilder sb = new StringBuilder();\n"}}, {"oid": "0ed94c445c36e1f88ed46a98593ad07935666dc9", "url": "https://github.com/splicemachine/spliceengine/commit/0ed94c445c36e1f88ed46a98593ad07935666dc9", "message": "DB-9139 Print reason to choose engine in explain", "committedDate": "2020-02-12T17:39:53Z", "type": "commit"}, {"oid": "93f82cddb7aef4ec801978eedc75b5673c3248f6", "url": "https://github.com/splicemachine/spliceengine/commit/93f82cddb7aef4ec801978eedc75b5673c3248f6", "message": "DB-9139 Address review comments", "committedDate": "2020-02-12T17:40:35Z", "type": "commit"}, {"oid": "93f82cddb7aef4ec801978eedc75b5673c3248f6", "url": "https://github.com/splicemachine/spliceengine/commit/93f82cddb7aef4ec801978eedc75b5673c3248f6", "message": "DB-9139 Address review comments", "committedDate": "2020-02-12T17:40:35Z", "type": "forcePushed"}]}