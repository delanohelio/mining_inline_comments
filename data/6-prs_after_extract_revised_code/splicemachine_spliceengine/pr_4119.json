{"pr_number": 4119, "pr_title": "DB-10196 Create new SPLICE schema for new database", "pr_createdAt": "2020-09-14T15:17:44Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/4119", "timeline": [{"oid": "abcedeadf685b103279d8825531f3755c88b1fed", "url": "https://github.com/splicemachine/spliceengine/commit/abcedeadf685b103279d8825531f3755c88b1fed", "message": "DB-10194 Multidatabase first commit", "committedDate": "2020-09-07T13:21:46Z", "type": "commit"}, {"oid": "12ec3394e5f2a9f304a861b887d80bbd8851c480", "url": "https://github.com/splicemachine/spliceengine/commit/12ec3394e5f2a9f304a861b887d80bbd8851c480", "message": "DB-10194 Support 'show databases' in sqlshell", "committedDate": "2020-09-07T13:21:58Z", "type": "commit"}, {"oid": "9501b63d987c662b8fa1183ae24f0e84bc8c4351", "url": "https://github.com/splicemachine/spliceengine/commit/9501b63d987c662b8fa1183ae24f0e84bc8c4351", "message": "DB-10194 Create new database with correct uuid. New schemas use that uuid", "committedDate": "2020-09-07T13:22:02Z", "type": "commit"}, {"oid": "9d6262470187844dbb180354b71a4e60b9bb64aa", "url": "https://github.com/splicemachine/spliceengine/commit/9d6262470187844dbb180354b71a4e60b9bb64aa", "message": "DB-10194 Use placeholders in database authorizationId", "committedDate": "2020-09-07T13:22:08Z", "type": "commit"}, {"oid": "2f2ccd4b963bd8c79109c5f524990a3a0119c478", "url": "https://github.com/splicemachine/spliceengine/commit/2f2ccd4b963bd8c79109c5f524990a3a0119c478", "message": "DB-10194 Fix spotbugs", "committedDate": "2020-09-07T17:26:57Z", "type": "commit"}, {"oid": "71fe88feb22ffbeb20c871532504e87e5a757229", "url": "https://github.com/splicemachine/spliceengine/commit/71fe88feb22ffbeb20c871532504e87e5a757229", "message": "DB-10194 Fix more spotbugs", "committedDate": "2020-09-08T08:24:51Z", "type": "commit"}, {"oid": "30aa48bc30f59b27c439b934bf1a377a4258e43c", "url": "https://github.com/splicemachine/spliceengine/commit/30aa48bc30f59b27c439b934bf1a377a4258e43c", "message": "DB-10194 Fix even more spotbugs", "committedDate": "2020-09-08T13:21:36Z", "type": "commit"}, {"oid": "81fd9a1d8ea4d7ee52ae284d5e4e0e4c5499b5e1", "url": "https://github.com/splicemachine/spliceengine/commit/81fd9a1d8ea4d7ee52ae284d5e4e0e4c5499b5e1", "message": "DB-10194 Fix even more spotbugs", "committedDate": "2020-09-08T13:21:36Z", "type": "commit"}, {"oid": "f0c0cfbec18be7569af9a4a4bca611e7679f83e0", "url": "https://github.com/splicemachine/spliceengine/commit/f0c0cfbec18be7569af9a4a4bca611e7679f83e0", "message": "DB-10194 Fix aggressive assert", "committedDate": "2020-09-09T09:40:56Z", "type": "commit"}, {"oid": "27f5ec0472c524f1a99f1f05cd26bbea1062cf92", "url": "https://github.com/splicemachine/spliceengine/commit/27f5ec0472c524f1a99f1f05cd26bbea1062cf92", "message": "DB-10195 Support 2 schemas with the same name in 2 different DBs", "committedDate": "2020-09-09T14:25:23Z", "type": "commit"}, {"oid": "4f985a8b11229fae95275b0e28d7b46b7fba6ce2", "url": "https://github.com/splicemachine/spliceengine/commit/4f985a8b11229fae95275b0e28d7b46b7fba6ce2", "message": "DB-10195 Fix spotbugs", "committedDate": "2020-09-09T15:48:31Z", "type": "commit"}, {"oid": "7d23dc335a08831df0321390090f76c856ad2051", "url": "https://github.com/splicemachine/spliceengine/commit/7d23dc335a08831df0321390090f76c856ad2051", "message": "DB-10195 Fix more spotbugs", "committedDate": "2020-09-09T16:55:58Z", "type": "commit"}, {"oid": "f08773ff21d2fbdf19b0d02f13386c096c2610de", "url": "https://github.com/splicemachine/spliceengine/commit/f08773ff21d2fbdf19b0d02f13386c096c2610de", "message": "DB-10195 Fix error", "committedDate": "2020-09-10T09:43:20Z", "type": "commit"}, {"oid": "f1af91d73a60ed8d90c450558c8914589c9f4dc6", "url": "https://github.com/splicemachine/spliceengine/commit/f1af91d73a60ed8d90c450558c8914589c9f4dc6", "message": "DB-10240 Rework test infra to accept DB parameter in connections", "committedDate": "2020-09-11T10:18:55Z", "type": "commit"}, {"oid": "be2db7f3bf7f57073dad0083151de70943b705be", "url": "https://github.com/splicemachine/spliceengine/commit/be2db7f3bf7f57073dad0083151de70943b705be", "message": "DB-10240 Fix CheckConstraintIT", "committedDate": "2020-09-11T11:52:03Z", "type": "commit"}, {"oid": "d7927e1a666d9a325dac7e27bf03a38953e54fe6", "url": "https://github.com/splicemachine/spliceengine/commit/d7927e1a666d9a325dac7e27bf03a38953e54fe6", "message": "DB-10240 Fix more tests", "committedDate": "2020-09-11T12:33:19Z", "type": "commit"}, {"oid": "5c80da9107e10a00e7b6bc770c6e0f3a2a9bdd41", "url": "https://github.com/splicemachine/spliceengine/commit/5c80da9107e10a00e7b6bc770c6e0f3a2a9bdd41", "message": "DB-10241 Remove old pass", "committedDate": "2020-09-11T12:49:21Z", "type": "commit"}, {"oid": "b49570e90b333971036983c16c737e2f51e7feff", "url": "https://github.com/splicemachine/spliceengine/commit/b49570e90b333971036983c16c737e2f51e7feff", "message": "DB-10240 Fix error with getDefaultLocalURL", "committedDate": "2020-09-14T09:45:52Z", "type": "commit"}, {"oid": "15d8ee8d674ac2e50abbcacf11d51e4f1429b676", "url": "https://github.com/splicemachine/spliceengine/commit/15d8ee8d674ac2e50abbcacf11d51e4f1429b676", "message": "DB-10196 Create new SPLICE schema for new database", "committedDate": "2020-09-14T15:07:02Z", "type": "commit"}, {"oid": "c971712a98b1b18024c6e7b39f28b5f2108d949c", "url": "https://github.com/splicemachine/spliceengine/commit/c971712a98b1b18024c6e7b39f28b5f2108d949c", "message": "Merge remote-tracking branch 'origin/DB-10193' into DB-10195", "committedDate": "2020-09-14T22:21:43Z", "type": "commit"}, {"oid": "ff2e8349e2c2da05b0aa2031fb117111bc3e2524", "url": "https://github.com/splicemachine/spliceengine/commit/ff2e8349e2c2da05b0aa2031fb117111bc3e2524", "message": "Merge remote-tracking branch 'origin/DB-10193' into DB-10195", "committedDate": "2020-09-16T16:26:27Z", "type": "commit"}, {"oid": "225699d860e0c11cd6098bd4974772520cec3796", "url": "https://github.com/splicemachine/spliceengine/commit/225699d860e0c11cd6098bd4974772520cec3796", "message": "Merge branch 'DB-10195' into DB-10196", "committedDate": "2020-09-16T16:33:03Z", "type": "commit"}, {"oid": "9883778ad9ef42aafa8952dcb69553e6194d7c99", "url": "https://github.com/splicemachine/spliceengine/commit/9883778ad9ef42aafa8952dcb69553e6194d7c99", "message": "IBEX-10195 Address review", "committedDate": "2020-09-21T11:36:03Z", "type": "commit"}, {"oid": "41a7505de642f4d559edbb67179ade5fc88d9a4a", "url": "https://github.com/splicemachine/spliceengine/commit/41a7505de642f4d559edbb67179ade5fc88d9a4a", "message": "Merge remote-tracking branch 'origin/DB-10195' into DB-10196", "committedDate": "2020-09-21T11:58:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1NDc1NQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r492954755", "bodyText": "Do we need this empty method?", "author": "ascend1", "createdAt": "2020-09-22T18:40:41Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java", "diffHunk": "@@ -569,6 +576,24 @@ public void boot(boolean create,Properties startParams) throws StandardException\n         booting=false;\n     }\n \n+    protected void createOrLoadDictionaryTables() {\n+\n+    }", "originalCommit": "15d8ee8d674ac2e50abbcacf11d51e4f1429b676", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYwNDU3MQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r493604571", "bodyText": "Removed. Thanks!", "author": "arnaud-splice", "createdAt": "2020-09-23T13:45:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1NDc1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d7b47819d1687eb48f5f89f4996e54bb812a2617", "chunk": "diff --git a/db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java b/db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java\nindex 9e2c30d7ba..b457cb75a5 100644\n--- a/db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java\n+++ b/db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java\n\n@@ -576,10 +576,6 @@ public abstract class DataDictionaryImpl extends BaseDataDictionary{\n         booting=false;\n     }\n \n-    protected void createOrLoadDictionaryTables() {\n-\n-    }\n-\n     protected boolean isCurrentlyCreatingSecondaryDatabase(Properties startParams) {\n         return Boolean.TRUE.equals(EmbedConnection.isCreate.get()) &&\n                 !getCurrentlyBootingDatabaseName(startParams).equals(spliceDbDesc.getDatabaseName());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1NzIwOQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r492957209", "bodyText": "Is it possible to reuse isCurrentlyCreatingSecondaryDatabase here?", "author": "ascend1", "createdAt": "2020-09-22T18:44:53Z", "path": "splice_machine/src/main/java/com/splicemachine/derby/impl/sql/catalog/SpliceDataDictionary.java", "diffHunk": "@@ -603,9 +604,10 @@ public void boot(boolean create,Properties startParams) throws StandardException\n                     databaseVersion.getMinorVersionNumber(),databaseVersion.getPatchVersionNumber(),\n                     databaseVersion.getSprintVersionNumber());\n         }\n-        if(create){\n+        if(create || Boolean.TRUE.equals(EmbedConnection.isCreate.get())) {", "originalCommit": "15d8ee8d674ac2e50abbcacf11d51e4f1429b676", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYwNTcwOA==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r493605708", "bodyText": "Unfortunately, no, because spliceDbDesc is not yet defined at this point.", "author": "arnaud-splice", "createdAt": "2020-09-23T13:46:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1NzIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU3MTc1OQ==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r496571759", "bodyText": "I see. Thanks!", "author": "ascend1", "createdAt": "2020-09-29T09:25:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk1NzIwOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "d7b47819d1687eb48f5f89f4996e54bb812a2617", "url": "https://github.com/splicemachine/spliceengine/commit/d7b47819d1687eb48f5f89f4996e54bb812a2617", "message": "DB-10196 Remove unused function", "committedDate": "2020-09-23T13:45:44Z", "type": "commit"}, {"oid": "0033d90e64fd7d712e7835b9c14e2d9c317b9ad1", "url": "https://github.com/splicemachine/spliceengine/commit/0033d90e64fd7d712e7835b9c14e2d9c317b9ad1", "message": "Merge branch 'DB-10193' into DB-10196", "committedDate": "2020-09-23T15:30:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjU4NjQ1NA==", "url": "https://github.com/splicemachine/spliceengine/pull/4119#discussion_r496586454", "bodyText": "why have you changed the scope of this variable?", "author": "martinrupp", "createdAt": "2020-09-29T09:48:10Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/catalog/DataDictionaryImpl.java", "diffHunk": "@@ -444,14 +446,15 @@ public void boot(boolean create,Properties startParams) throws StandardException\n \n             boolean nativeAuthenticationEnabled=PropertyUtil.nativeAuthenticationEnabled(startParams);\n \n-            if(create){\n-                String userName=IdUtil.getUserNameFromURLProps(startParams);\n-                authorizationDatabaseOwner=IdUtil.getUserAuthorizationId(userName);\n-                HashSet newlyCreatedRoutines=new HashSet();\n+            HashSet newlyCreatedRoutines = null;", "originalCommit": "0033d90e64fd7d712e7835b9c14e2d9c317b9ad1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}