{"pr_number": 3995, "pr_title": "DB-10027 Fix grouping by out-of-bound positions", "pr_createdAt": "2020-08-17T14:09:29Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3995", "timeline": [{"oid": "e96df708f73ab609a007d9af37f153c059126504", "url": "https://github.com/splicemachine/spliceengine/commit/e96df708f73ab609a007d9af37f153c059126504", "message": "DB-10027 Fix grouping by out-of-bound positions", "committedDate": "2020-08-17T13:48:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NjgwOA==", "url": "https://github.com/splicemachine/spliceengine/pull/3995#discussion_r471596808", "bodyText": "Can we throw the same error message like the one in the below code which comes a few lines after this line:\n\t\t\t    /* Column is out of range if either a) resultCol is null, OR\n\t\t\t     * b) resultCol points to a column that is not visible to the\n\t\t\t     * user (i.e. it was generated internally).\n\t\t\t    */\n                if ((resultCol == null) ||\n                        (resultCol.getColumnPosition() > targetCols.visibleSize()))\n                {\n                    throw StandardException.newException(SQLState.LANG_COLUMN_OUT_OF_RANGE,\n                            String.valueOf(columnPosition));\n                }\n\nI think they are of similar nature, so it would be better to return consistent error message.", "author": "yxia92", "createdAt": "2020-08-17T16:29:17Z", "path": "db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/GroupByList.java", "diffHunk": "@@ -110,6 +110,10 @@ public void bindGroupByColumns(SelectNode select,List<AggregateNode> aggregateVe\n             if (OrderByColumn.isReferedColByNum(groupByCol.getColumnExpression())) {\n                 ResultColumnList targetCols = select.getResultColumns();\n                 int columnPosition = (Integer) groupByCol.getColumnExpression().getConstantValueAsObject();\n+                if (columnPosition <= 0) {\n+                    throw StandardException.newException(SQLState.LANG_INVALID_GROUP_POSITION,", "originalCommit": "e96df708f73ab609a007d9af37f153c059126504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMjEzNQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3995#discussion_r471602135", "bodyText": "Oh yes, sorry that I didn't see the exception below. I was searching only using the term \"GROUP\". Fixed in the new commit.", "author": "ascend1", "createdAt": "2020-08-17T16:38:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU5NjgwOA=="}], "type": "inlineReview", "revised_code": {"commit": "98d08d4510807ca8fc6fddaea2c05058dfcaf601", "chunk": "diff --git a/db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/GroupByList.java b/db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/GroupByList.java\nindex c7ddbb5f52..8b013310e7 100644\n--- a/db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/GroupByList.java\n+++ b/db-engine/src/main/java/com/splicemachine/db/impl/sql/compile/GroupByList.java\n\n@@ -111,7 +111,7 @@ public class GroupByList extends OrderedColumnList{\n                 ResultColumnList targetCols = select.getResultColumns();\n                 int columnPosition = (Integer) groupByCol.getColumnExpression().getConstantValueAsObject();\n                 if (columnPosition <= 0) {\n-                    throw StandardException.newException(SQLState.LANG_INVALID_GROUP_POSITION,\n+                    throw StandardException.newException(SQLState.LANG_COLUMN_OUT_OF_RANGE,\n                             String.valueOf(columnPosition));\n                 }\n                 ResultColumn resultCol = targetCols.getResultColumn(columnPosition);\n"}}, {"oid": "98d08d4510807ca8fc6fddaea2c05058dfcaf601", "url": "https://github.com/splicemachine/spliceengine/commit/98d08d4510807ca8fc6fddaea2c05058dfcaf601", "message": "DB-10027 Use existing exception", "committedDate": "2020-08-17T16:32:27Z", "type": "commit"}]}