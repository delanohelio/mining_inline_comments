{"pr_number": 3925, "pr_title": "DB-9612 pass result column data types of ProjectRestrictOperation dow\u2026", "pr_createdAt": "2020-08-03T20:55:00Z", "pr_url": "https://github.com/splicemachine/spliceengine/pull/3925", "timeline": [{"oid": "f0a41a81ba63a33cfcb9a385e562e7aa1079e7de", "url": "https://github.com/splicemachine/spliceengine/commit/f0a41a81ba63a33cfcb9a385e562e7aa1079e7de", "message": "DB-9612 pass result column data types of ProjectRestrictOperation down explicitly to execution", "committedDate": "2020-08-03T19:17:12Z", "type": "commit"}, {"oid": "0bc88df02ed4952a13c001a14f66291bbed75aad", "url": "https://github.com/splicemachine/spliceengine/commit/0bc88df02ed4952a13c001a14f66291bbed75aad", "message": "DB-9612 fix spotbugs", "committedDate": "2020-08-03T21:39:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxMTcxNA==", "url": "https://github.com/splicemachine/spliceengine/pull/3925#discussion_r465011714", "bodyText": "I'm a bit confused by the error message. Does it suggest that typeDescriptor == null is valid in some cases? If so, maybe we shouldn't use assert here.", "author": "ascend1", "createdAt": "2020-08-04T12:26:04Z", "path": "db-engine/src/main/java/com/splicemachine/db/iapi/types/DataTypeDescriptor.java", "diffHunk": "@@ -1752,5 +1753,20 @@ public void setChildren(DataTypeDescriptor[] children) {\n     public DataValueDescriptor getDefault() throws StandardException {\n         return typeId.getDefault();\n     }\n+\n+    public StructField getStructField(String columnName) {\n+        StructField childStructField = null;\n+        if (typeId.isArray()) {\n+            // get the child type descriptor & struct field\n+            assert typeDescriptor!=null:\"Catalog Type\";\n+            assert typeDescriptor.getChildren() != null:\"Catalog Type\";", "originalCommit": "f0a41a81ba63a33cfcb9a385e562e7aa1079e7de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTI2ODUxMQ==", "url": "https://github.com/splicemachine/spliceengine/pull/3925#discussion_r465268511", "bodyText": "Sorry for the careless copy-paste error. For ArrayType, its underneath child type should be set. I've corrected the error message. Also typeDescriptor should not be null.", "author": "yxia92", "createdAt": "2020-08-04T19:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAxMTcxNA=="}], "type": "inlineReview", "revised_code": {"commit": "d5fd9a58de0a1fea69284a6b854fa4c7148197d3", "chunk": "diff --git a/db-engine/src/main/java/com/splicemachine/db/iapi/types/DataTypeDescriptor.java b/db-engine/src/main/java/com/splicemachine/db/iapi/types/DataTypeDescriptor.java\nindex a1ecb6187f..3e3ad7a4ba 100644\n--- a/db-engine/src/main/java/com/splicemachine/db/iapi/types/DataTypeDescriptor.java\n+++ b/db-engine/src/main/java/com/splicemachine/db/iapi/types/DataTypeDescriptor.java\n\n@@ -1758,8 +1763,7 @@ public class DataTypeDescriptor implements Formatable{\n         StructField childStructField = null;\n         if (typeId.isArray()) {\n             // get the child type descriptor & struct field\n-            assert typeDescriptor!=null:\"Catalog Type\";\n-            assert typeDescriptor.getChildren() != null:\"Catalog Type\";\n+            assert typeDescriptor.getChildren() != null:\"ArrayType should have the child type specified\";\n             TypeDescriptorImpl childTypeDescriptor = (TypeDescriptorImpl) typeDescriptor.getChildren()[0];\n             TypeId childTypeId = TypeId.getBuiltInTypeId(childTypeDescriptor.getTypeId().getJDBCTypeId());\n             childStructField = childTypeId.getStructField(\"co\", childTypeDescriptor.getPrecision(), childTypeDescriptor.getScale(), null);\n"}}, {"oid": "d5fd9a58de0a1fea69284a6b854fa4c7148197d3", "url": "https://github.com/splicemachine/spliceengine/commit/d5fd9a58de0a1fea69284a6b854fa4c7148197d3", "message": "DB-9612 address review comments", "committedDate": "2020-08-04T18:38:26Z", "type": "commit"}]}