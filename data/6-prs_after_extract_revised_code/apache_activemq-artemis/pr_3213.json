{"pr_number": 3213, "pr_title": "ARTEMIS-2797 Fixing redeploy mechanism", "pr_createdAt": "2020-07-06T19:13:07Z", "pr_url": "https://github.com/apache/activemq-artemis/pull/3213", "timeline": [{"oid": "6cc370e169e16c29f9c2df5622654b264b730fe9", "url": "https://github.com/apache/activemq-artemis/commit/6cc370e169e16c29f9c2df5622654b264b730fe9", "message": "ARTEMIS-2797 Fixing redeploy mechanism\n\nQueue settings are reset to their default values upon broker.xml reload ONLY.\nRegular calls to PostOfficeImpl#updateQueue are no longer affected.", "committedDate": "2020-07-06T19:02:03Z", "type": "commit"}, {"oid": "3f99c4b84613d88a9caba4cb4cf15f6cb0bb1a13", "url": "https://github.com/apache/activemq-artemis/commit/3f99c4b84613d88a9caba4cb4cf15f6cb0bb1a13", "message": "ARTEMIS-2797 Fixing updateQueue on filter / fixing ActiveMQServerControlTest", "committedDate": "2020-07-07T01:45:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NjQyMQ==", "url": "https://github.com/apache/activemq-artemis/pull/3213#discussion_r450566421", "bodyText": "@jsmucr here is the change that should fix the test.", "author": "clebertsuconic", "createdAt": "2020-07-07T01:46:48Z", "path": "artemis-server/src/main/java/org/apache/activemq/artemis/core/postoffice/impl/PostOfficeImpl.java", "diffHunk": "@@ -701,7 +701,7 @@ public QueueBinding updateQueue(QueueConfiguration queueConfiguration, boolean f\n             final SimpleString empty = new SimpleString(\"\");\n             Filter oldFilter = FilterImpl.createFilter(queue.getFilter() == null ? empty : queue.getFilter().getFilterString());\n             Filter newFilter = FilterImpl.createFilter(queueConfiguration.getFilterString() == null ? empty : queueConfiguration.getFilterString());\n-            if ((forceUpdate || newFilter != null) && !Objects.equals(oldFilter, newFilter)) {\n+            if ((forceUpdate || newFilter != oldFilter) && !Objects.equals(oldFilter, newFilter)) {", "originalCommit": "3f99c4b84613d88a9caba4cb4cf15f6cb0bb1a13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYwNjg3Ng==", "url": "https://github.com/apache/activemq-artemis/pull/3213#discussion_r450606876", "bodyText": "Yes, this is what I originally intended. Thank you.", "author": "jsmucr", "createdAt": "2020-07-07T04:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NjQyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDgxNDAwOA==", "url": "https://github.com/apache/activemq-artemis/pull/3213#discussion_r450814008", "bodyText": "@jsmucr merged, thank you", "author": "clebertsuconic", "createdAt": "2020-07-07T12:06:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NjQyMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NjY4NA==", "url": "https://github.com/apache/activemq-artemis/pull/3213#discussion_r450566684", "bodyText": "@jsmucr: just a note here. if you intended to assertNotNull, do a receive with a timeout.\nif you assertNull, do a receiveImmediate (or receiveNoWait in JMS terms).. or a very short timeout.\nassertNotNull(receiveImmediate) is a bit fragile and it may break a test intermittently.", "author": "clebertsuconic", "createdAt": "2020-07-07T01:47:53Z", "path": "tests/integration-tests/src/test/java/org/apache/activemq/artemis/tests/integration/management/ActiveMQServerControlTest.java", "diffHunk": "@@ -514,8 +514,8 @@ public void testRemoveQueueFilter() throws Exception {\n \n       producer.send(m);\n \n-      assertNotNull(consumer1.receiveImmediate());\n-      assertNotNull(consumer2.receiveImmediate());\n+      assertNotNull(consumer1.receive(1000));", "originalCommit": "3f99c4b84613d88a9caba4cb4cf15f6cb0bb1a13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDYwNjU2Mg==", "url": "https://github.com/apache/activemq-artemis/pull/3213#discussion_r450606562", "bodyText": "I'll keep that in mind. Thank you.", "author": "jsmucr", "createdAt": "2020-07-07T04:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU2NjY4NA=="}], "type": "inlineReview", "revised_code": null}]}