{"pr_number": 3377, "pr_title": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages", "pr_createdAt": "2020-12-10T01:09:28Z", "pr_url": "https://github.com/apache/activemq-artemis/pull/3377", "timeline": [{"oid": "f8bd6b6c0937fb99cd8d115e5be0fbf5b0d0f87e", "url": "https://github.com/apache/activemq-artemis/commit/f8bd6b6c0937fb99cd8d115e5be0fbf5b0d0f87e", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T01:12:09Z", "type": "forcePushed"}, {"oid": "55bcb63e37c949377bd416d261e10559f2d6236f", "url": "https://github.com/apache/activemq-artemis/commit/55bcb63e37c949377bd416d261e10559f2d6236f", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T01:14:25Z", "type": "forcePushed"}, {"oid": "c2dde5b4cfa7042ac94f80368bf05d281b46ef9c", "url": "https://github.com/apache/activemq-artemis/commit/c2dde5b4cfa7042ac94f80368bf05d281b46ef9c", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T01:34:58Z", "type": "forcePushed"}, {"oid": "934339c9b47008b3b637b94f97e1913b362345b5", "url": "https://github.com/apache/activemq-artemis/commit/934339c9b47008b3b637b94f97e1913b362345b5", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T01:40:40Z", "type": "forcePushed"}, {"oid": "7e67204d0afd28a0535d294563d18ce3321299d1", "url": "https://github.com/apache/activemq-artemis/commit/7e67204d0afd28a0535d294563d18ce3321299d1", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T01:59:07Z", "type": "forcePushed"}, {"oid": "ffa7f9ff85347105e2737a189b3fc4e50fe7f893", "url": "https://github.com/apache/activemq-artemis/commit/ffa7f9ff85347105e2737a189b3fc4e50fe7f893", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T02:02:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg0ODc2OA==", "url": "https://github.com/apache/activemq-artemis/pull/3377#discussion_r539848768", "bodyText": "Nit. Why is the E capitalised. Reencoded is a single word. https://en.m.wiktionary.org/wiki/reencoded", "author": "michaelandrepearce", "createdAt": "2020-12-10T05:07:33Z", "path": "artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java", "diffHunk": "@@ -622,7 +624,15 @@ public long getPersistentSize() throws ActiveMQException {\n \n    @Override\n    public void reencode() {\n+      reEncoded = true;\n+   }\n+\n+   public void setReEncoded(boolean reEncoded) {\n+      this.reEncoded = reEncoded;", "originalCommit": "ffa7f9ff85347105e2737a189b3fc4e50fe7f893", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1ODYzMg==", "url": "https://github.com/apache/activemq-artemis/pull/3377#discussion_r539858632", "bodyText": "right.. fixed it. thanks", "author": "clebertsuconic", "createdAt": "2020-12-10T05:37:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg0ODc2OA=="}], "type": "inlineReview", "revised_code": {"commit": "94f1857914424638db8b6e49f08f326bd49e6809", "chunk": "diff --git a/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java b/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\nindex 93ae7f9739..4e5e60cf19 100644\n--- a/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\n+++ b/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\n\n@@ -624,15 +624,15 @@ public class AMQPLargeMessage extends AMQPMessage implements LargeServerMessage\n \n    @Override\n    public void reencode() {\n-      reEncoded = true;\n+      reencoded = true;\n    }\n \n-   public void setReEncoded(boolean reEncoded) {\n-      this.reEncoded = reEncoded;\n+   public void setReencoded(boolean reencoded) {\n+      this.reencoded = reencoded;\n    }\n \n    public boolean isReencoded() {\n-      return reEncoded;\n+      return reencoded;\n    }\n \n    @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1MTQ1MA==", "url": "https://github.com/apache/activemq-artemis/pull/3377#discussion_r539851450", "bodyText": "Why isnt the reencoding happening immediately like for other messages (amqp standard, core etc) and expected behaviour, e.g. other areas of code and plugins are expecting the message to rencoded by calling this without doing extra work. I can be missing something.", "author": "michaelandrepearce", "createdAt": "2020-12-10T05:15:49Z", "path": "artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java", "diffHunk": "@@ -622,7 +624,15 @@ public long getPersistentSize() throws ActiveMQException {\n \n    @Override\n    public void reencode() {\n+      reEncoded = true;", "originalCommit": "ffa7f9ff85347105e2737a189b3fc4e50fe7f893", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1NzU4MA==", "url": "https://github.com/apache/activemq-artemis/pull/3377#discussion_r539857580", "bodyText": "It would be fairly difficult to re-encode the message on the large message file.\nFor AMQP Large messages, I'm instead just flagging the message as re-encoded, and I would replace the stream during the delivery.", "author": "clebertsuconic", "createdAt": "2020-12-10T05:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1MTQ1MA=="}], "type": "inlineReview", "revised_code": {"commit": "94f1857914424638db8b6e49f08f326bd49e6809", "chunk": "diff --git a/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java b/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\nindex 93ae7f9739..4e5e60cf19 100644\n--- a/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\n+++ b/artemis-protocols/artemis-amqp-protocol/src/main/java/org/apache/activemq/artemis/protocol/amqp/broker/AMQPLargeMessage.java\n\n@@ -624,15 +624,15 @@ public class AMQPLargeMessage extends AMQPMessage implements LargeServerMessage\n \n    @Override\n    public void reencode() {\n-      reEncoded = true;\n+      reencoded = true;\n    }\n \n-   public void setReEncoded(boolean reEncoded) {\n-      this.reEncoded = reEncoded;\n+   public void setReencoded(boolean reencoded) {\n+      this.reencoded = reencoded;\n    }\n \n    public boolean isReencoded() {\n-      return reEncoded;\n+      return reencoded;\n    }\n \n    @Override\n"}}, {"oid": "94f1857914424638db8b6e49f08f326bd49e6809", "url": "https://github.com/apache/activemq-artemis/commit/94f1857914424638db8b6e49f08f326bd49e6809", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T05:37:11Z", "type": "commit"}, {"oid": "94f1857914424638db8b6e49f08f326bd49e6809", "url": "https://github.com/apache/activemq-artemis/commit/94f1857914424638db8b6e49f08f326bd49e6809", "message": "ARTEMIS-3026 Allow \"re-encode\" of amqp large messages\n\nnotice the quotes on \"re-encode\", as this is just replacing the set of application properties, properties and headers by a new set\nif a flag reEncoded is set to true on AMQPLargeMessage", "committedDate": "2020-12-10T05:37:11Z", "type": "forcePushed"}]}