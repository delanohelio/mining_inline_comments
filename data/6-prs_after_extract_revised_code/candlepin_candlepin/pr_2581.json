{"pr_number": 2581, "pr_title": "[F] Convert StatusResource to the OpenAPI specification (ENT-1884)", "pr_createdAt": "2020-01-23T11:01:31Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2581", "timeline": [{"oid": "487efd189a12c1cb8f88e5fe1a81556a302eb8e5", "url": "https://github.com/candlepin/candlepin/commit/487efd189a12c1cb8f88e5fe1a81556a302eb8e5", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Merge keycloak status fields into status DTO\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-24T06:07:17Z", "type": "forcePushed"}, {"oid": "fcc8ebd632a5763c662734312f2b288dfc97753c", "url": "https://github.com/candlepin/candlepin/commit/fcc8ebd632a5763c662734312f2b288dfc97753c", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-24T06:10:40Z", "type": "forcePushed"}, {"oid": "5795a66ec8193cda916c2276b6c4208c72adb0e1", "url": "https://github.com/candlepin/candlepin/commit/5795a66ec8193cda916c2276b6c4208c72adb0e1", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-24T06:57:28Z", "type": "forcePushed"}, {"oid": "f4122c8298ef76478e106e64ca8996cebbafa556", "url": "https://github.com/candlepin/candlepin/commit/f4122c8298ef76478e106e64ca8996cebbafa556", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-24T11:12:10Z", "type": "forcePushed"}, {"oid": "ebc07a0a2d69967a96069c4033d003ed46bca500", "url": "https://github.com/candlepin/candlepin/commit/ebc07a0a2d69967a96069c4033d003ed46bca500", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-26T11:25:08Z", "type": "forcePushed"}, {"oid": "8f68576ff859e50f9a4df99be4c58d0c4d89b05b", "url": "https://github.com/candlepin/candlepin/commit/8f68576ff859e50f9a4df99be4c58d0c4d89b05b", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-28T13:15:48Z", "type": "forcePushed"}, {"oid": "3a1d133878c57af397af0034eaed6f02f2d5cb22", "url": "https://github.com/candlepin/candlepin/commit/3a1d133878c57af397af0034eaed6f02f2d5cb22", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-29T00:10:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQzOTkzMg==", "url": "https://github.com/candlepin/candlepin/pull/2581#discussion_r372439932", "bodyText": "There is no need to create a Date instance first and then convert it to OffsetDateTime here. OffsetDateTime.now() will do.", "author": "nikosmoum", "createdAt": "2020-01-29T15:10:24Z", "path": "server/src/main/java/org/candlepin/resource/StatusResource.java", "diffHunk": "@@ -157,30 +146,26 @@ public StatusDTO status() {\n \n         good = good && (mode == Mode.NORMAL);\n \n-        StatusDTO status;\n+        StatusDTO status = new StatusDTO()\n+            .result(good)\n+            .version(version)\n+            .release(release)\n+            .standalone(standalone)\n+            .rulesVersion(jsProvider.getRulesVersion())\n+            .rulesSource(rulesSource != null ? rulesSource.toString() : null)\n+            .mode(mode != null ? mode.toString() : null)\n+            .modeReason(mcr != null ? mcr.toString() : null)\n+            .modeChangeTime(mcr != null ? mcr.getTime().toInstant().atOffset(ZoneOffset.UTC) : null)\n+            .managerCapabilities(caps.stream().collect(Collectors.toList()))\n+            .timeUTC(new Date().toInstant().atOffset(ZoneOffset.UTC));", "originalCommit": "3a1d133878c57af397af0034eaed6f02f2d5cb22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcwMDYzMA==", "url": "https://github.com/candlepin/candlepin/pull/2581#discussion_r372700630", "bodyText": "Done.", "author": "abhiskum", "createdAt": "2020-01-30T00:13:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQzOTkzMg=="}], "type": "inlineReview", "revised_code": {"commit": "934511256f65aa70595ab1c7ff17db499b5ce2d0", "chunk": "diff --git a/server/src/main/java/org/candlepin/resource/StatusResource.java b/server/src/main/java/org/candlepin/resource/StatusResource.java\nindex e7ee0abec..c27340101 100644\n--- a/server/src/main/java/org/candlepin/resource/StatusResource.java\n+++ b/server/src/main/java/org/candlepin/resource/StatusResource.java\n\n@@ -157,7 +157,7 @@ public class StatusResource implements StatusApi {\n             .modeReason(mcr != null ? mcr.toString() : null)\n             .modeChangeTime(mcr != null ? mcr.getTime().toInstant().atOffset(ZoneOffset.UTC) : null)\n             .managerCapabilities(caps.stream().collect(Collectors.toList()))\n-            .timeUTC(new Date().toInstant().atOffset(ZoneOffset.UTC));\n+            .timeUTC(OffsetDateTime.now());\n \n         if (keycloakEnabled) {\n             AdapterConfig adapterConfig = keycloakConfig.getAdapterConfig();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ0MTQ3NQ==", "url": "https://github.com/candlepin/candlepin/pull/2581#discussion_r372441475", "bodyText": "Same for all the changes in this file, just use OffsetDateTime.now() directly.", "author": "nikosmoum", "createdAt": "2020-01-29T15:12:34Z", "path": "server/src/test/java/org/candlepin/cache/StatusCacheTest.java", "diffHunk": "@@ -46,8 +47,8 @@ public void setAndGet() {\n         StatusCache cache = new StatusCache();\n \n         StatusDTO status = new StatusDTO()\n-            .setResult(true)\n-            .setTimeUTC(new Date());\n+            .result(true)\n+            .timeUTC(new Date().toInstant().atOffset(ZoneOffset.UTC));", "originalCommit": "3a1d133878c57af397af0034eaed6f02f2d5cb22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjcwMDY5Ng==", "url": "https://github.com/candlepin/candlepin/pull/2581#discussion_r372700696", "bodyText": "Done.", "author": "abhiskum", "createdAt": "2020-01-30T00:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjQ0MTQ3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "934511256f65aa70595ab1c7ff17db499b5ce2d0", "chunk": "diff --git a/server/src/test/java/org/candlepin/cache/StatusCacheTest.java b/server/src/test/java/org/candlepin/cache/StatusCacheTest.java\nindex 8bf34e4ac..bbd9ad333 100644\n--- a/server/src/test/java/org/candlepin/cache/StatusCacheTest.java\n+++ b/server/src/test/java/org/candlepin/cache/StatusCacheTest.java\n\n@@ -48,7 +47,7 @@ public class StatusCacheTest {\n \n         StatusDTO status = new StatusDTO()\n             .result(true)\n-            .timeUTC(new Date().toInstant().atOffset(ZoneOffset.UTC));\n+            .timeUTC(OffsetDateTime.now());\n \n         cache.setStatus(status);\n         assertEquals(status, cache.getStatus());\n"}}, {"oid": "934511256f65aa70595ab1c7ff17db499b5ce2d0", "url": "https://github.com/candlepin/candlepin/commit/934511256f65aa70595ab1c7ff17db499b5ce2d0", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-01-30T00:12:31Z", "type": "forcePushed"}, {"oid": "d4f5181f296946066189fd5bbe48ecacc2cf17fe", "url": "https://github.com/candlepin/candlepin/commit/d4f5181f296946066189fd5bbe48ecacc2cf17fe", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-02-03T03:39:26Z", "type": "forcePushed"}, {"oid": "ca317d18aea70e72d8c763ab612c9f911a155bbe", "url": "https://github.com/candlepin/candlepin/commit/ca317d18aea70e72d8c763ab612c9f911a155bbe", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-02-04T04:02:37Z", "type": "forcePushed"}, {"oid": "9a780b988a40e3c0371e437fc534b5c6c981b555", "url": "https://github.com/candlepin/candlepin/commit/9a780b988a40e3c0371e437fc534b5c6c981b555", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-02-06T17:39:52Z", "type": "forcePushed"}, {"oid": "bfd2c78149078f10c0df338b173d20c289fe665e", "url": "https://github.com/candlepin/candlepin/commit/bfd2c78149078f10c0df338b173d20c289fe665e", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-02-12T06:00:22Z", "type": "commit"}, {"oid": "bfd2c78149078f10c0df338b173d20c289fe665e", "url": "https://github.com/candlepin/candlepin/commit/bfd2c78149078f10c0df338b173d20c289fe665e", "message": "Convert StatusResource to the OpenAPI specification\n   - Created new specifications for the status resource and status DTO\n   - Updated StatusResource to implement the generated API specification\n   - Deleted existing StatusDTO and KeycloakStatusDTO\n   - Deleted existing StatusDTOTest test\n   - Updated StatusCache to use new DTO", "committedDate": "2020-02-12T06:00:22Z", "type": "forcePushed"}]}