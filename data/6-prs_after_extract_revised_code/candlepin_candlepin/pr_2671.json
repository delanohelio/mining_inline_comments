{"pr_number": 2671, "pr_title": "[M] ENT-2215: truncate correlation id to 40 characters", "pr_createdAt": "2020-03-30T09:24:37Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2671", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2MDk4NA==", "url": "https://github.com/candlepin/candlepin/pull/2671#discussion_r400160984", "bodyText": "Please keep and use the constant.", "author": "wottop", "createdAt": "2020-03-30T12:44:08Z", "path": "common/src/main/java/org/candlepin/common/filter/LoggingFilter.java", "diffHunk": "@@ -46,8 +46,7 @@\n     private static Logger log = LoggerFactory.getLogger(LoggingFilter.class);\n \n     public static final String CSID_KEY = \"csid\";\n-    private static final int CSID_MAX_LENGTH = 40;", "originalCommit": "95c7316dc0f76423a429a4646c85107d39c54ee0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQwNzc4Mw==", "url": "https://github.com/candlepin/candlepin/pull/2671#discussion_r401407783", "bodyText": "Fixed.", "author": "abhiskum", "createdAt": "2020-04-01T07:27:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE2MDk4NA=="}], "type": "inlineReview", "revised_code": {"commit": "d32805a6afa664d1937809d94cb840fcf0ace1ab", "chunk": "diff --git a/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java b/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\nindex 7b74438c1..f7b009b73 100644\n--- a/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\n+++ b/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\n\n@@ -46,6 +46,7 @@ public class LoggingFilter implements Filter {\n     private static Logger log = LoggerFactory.getLogger(LoggingFilter.class);\n \n     public static final String CSID_KEY = \"csid\";\n+    private static final int CSID_MAX_LENGTH = 40;\n     private static final Pattern CSID_REGEX = Pattern.compile(\"^([a-zA-Z0-9-]){1,}$\");\n \n     /** The metadata key used to display the owner's key or display name */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4NDg0NQ==", "url": "https://github.com/candlepin/candlepin/pull/2671#discussion_r400184845", "bodyText": "I really don't feel truncating is the right approach here, but if that's what we're going to do, we should still output a log message indicating that we've truncated the original value down, and what that value was so we can at least track and figure out what happened in the event that it happens or when there's a collision caused by it.", "author": "Ceiu", "createdAt": "2020-03-30T13:20:43Z", "path": "common/src/main/java/org/candlepin/common/filter/LoggingFilter.java", "diffHunk": "@@ -95,11 +94,11 @@ public void doFilter(ServletRequest request, ServletResponse response,\n \n             if (correlationId != null) {\n                 if (CSID_REGEX.matcher(correlationId).matches()) {\n-                    MDC.put(CSID_KEY, correlationId);\n+                    MDC.put(CSID_KEY,", "originalCommit": "95c7316dc0f76423a429a4646c85107d39c54ee0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQxNzE2OQ==", "url": "https://github.com/candlepin/candlepin/pull/2671#discussion_r401417169", "bodyText": "Fixed.", "author": "abhiskum", "createdAt": "2020-04-01T07:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE4NDg0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d32805a6afa664d1937809d94cb840fcf0ace1ab", "chunk": "diff --git a/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java b/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\nindex 7b74438c1..f7b009b73 100644\n--- a/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\n+++ b/common/src/main/java/org/candlepin/common/filter/LoggingFilter.java\n\n@@ -94,8 +95,13 @@ public class LoggingFilter implements Filter {\n \n             if (correlationId != null) {\n                 if (CSID_REGEX.matcher(correlationId).matches()) {\n-                    MDC.put(CSID_KEY,\n-                        correlationId.length() > 40 ? correlationId.substring(0, 40) : correlationId);\n+                    if (correlationId.length() > CSID_MAX_LENGTH) {\n+                        log.warn(\n+                            \"Correlation Id {} is more than {} characters in length, hence truncating to {}\" +\n+                            \" characters\", correlationId, CSID_MAX_LENGTH, CSID_MAX_LENGTH);\n+                        correlationId = correlationId.substring(0, CSID_MAX_LENGTH);\n+                    }\n+                    MDC.put(CSID_KEY, correlationId);\n                 }\n                 else {\n                     log.warn(\"Correlation Id must consist of alphanumeric characters or hypens\");\n"}}, {"oid": "d32805a6afa664d1937809d94cb840fcf0ace1ab", "url": "https://github.com/candlepin/candlepin/commit/d32805a6afa664d1937809d94cb840fcf0ace1ab", "message": "ENT-2215: truncate correlation id to 40 characters\n  - Truncate correlation id to 40 characters instead of dropping", "committedDate": "2020-04-01T07:21:39Z", "type": "forcePushed"}, {"oid": "8871bfb7fac830eb76d85a7509deefcaf5190f77", "url": "https://github.com/candlepin/candlepin/commit/8871bfb7fac830eb76d85a7509deefcaf5190f77", "message": "ENT-2215: truncate correlation id to 40 characters\n  - Truncate correlation id to 40 characters instead of dropping", "committedDate": "2020-04-01T07:36:29Z", "type": "commit"}, {"oid": "8871bfb7fac830eb76d85a7509deefcaf5190f77", "url": "https://github.com/candlepin/candlepin/commit/8871bfb7fac830eb76d85a7509deefcaf5190f77", "message": "ENT-2215: truncate correlation id to 40 characters\n  - Truncate correlation id to 40 characters instead of dropping", "committedDate": "2020-04-01T07:36:29Z", "type": "forcePushed"}]}