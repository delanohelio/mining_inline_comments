{"pr_number": 2714, "pr_title": "[M] 1840850: Fixed parameter overflow in bulk entitlement deletion (ENT-2437)", "pr_createdAt": "2020-05-27T18:10:23Z", "pr_url": "https://github.com/candlepin/candlepin/pull/2714", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3OTg3MA==", "url": "https://github.com/candlepin/candlepin/pull/2714#discussion_r431779870", "bodyText": "Could you add a unit-test for this change? I think it would be helpful to know that we do not re-introduce the issue in case we need to make changes in the future.", "author": "Januson", "createdAt": "2020-05-28T11:55:35Z", "path": "server/src/main/java/org/candlepin/model/EntitlementCurator.java", "diffHunk": "@@ -796,11 +796,25 @@ public void batchDelete(Collection<Entitlement> entitlements) {\n      * preferably by calling {@link #unlinkEntitlements} first.\n      *\n      * @param entitlementIds The collection of ids of the entitlements to be deleted.\n+     *\n+     * @return\n+     *  the number of entitlements deleted as a result of this operation\n      */\n-    public void batchDeleteByIds(Collection<String> entitlementIds) {\n-        Map<String, Object> criteria = new HashMap<>();\n-        criteria.put(\"id\", entitlementIds);\n-        this.bulkSQLDelete(Entitlement.DB_TABLE, criteria);\n+    public int batchDeleteByIds(Collection<String> entitlementIds) {", "originalCommit": "c7c7b8db53906aa8d64d00ee5508aba9dc04fc8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MTQzOQ==", "url": "https://github.com/candlepin/candlepin/pull/2714#discussion_r431961439", "bodyText": "Done", "author": "Ceiu", "createdAt": "2020-05-28T16:18:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc3OTg3MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "2ebf56de789d61d96c6ff51f03db13979c22b3d4", "url": "https://github.com/candlepin/candlepin/commit/2ebf56de789d61d96c6ff51f03db13979c22b3d4", "message": "1840850: Fixed parameter overflow in bulk entitlement deletion\n\n- Fixed an issue during entitlement deletion that could cause a\n  query to be generated that attempts to use more parameters than\n  the backend database supports\n- Flagged the bulkSQLDelete method as deprecated, as it lacks\n  protection for the database parameter limit", "committedDate": "2020-05-28T16:10:40Z", "type": "commit"}, {"oid": "2ebf56de789d61d96c6ff51f03db13979c22b3d4", "url": "https://github.com/candlepin/candlepin/commit/2ebf56de789d61d96c6ff51f03db13979c22b3d4", "message": "1840850: Fixed parameter overflow in bulk entitlement deletion\n\n- Fixed an issue during entitlement deletion that could cause a\n  query to be generated that attempts to use more parameters than\n  the backend database supports\n- Flagged the bulkSQLDelete method as deprecated, as it lacks\n  protection for the database parameter limit", "committedDate": "2020-05-28T16:10:40Z", "type": "forcePushed"}]}