{"pr_number": 6226, "pr_title": "Allow to define the maximum body size to passive scan", "pr_createdAt": "2020-10-06T11:24:39Z", "pr_url": "https://github.com/zaproxy/zaproxy/pull/6226", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ3OTQwMg==", "url": "https://github.com/zaproxy/zaproxy/pull/6226#discussion_r502479402", "bodyText": "Worth adding msg.isResponseFromTargetHost().", "author": "thc202", "createdAt": "2020-10-09T14:45:51Z", "path": "zap/src/main/java/org/zaproxy/zap/extension/pscan/PassiveScanThread.java", "diffHunk": "@@ -179,6 +179,23 @@ public void run() {\n                     try {\n                         // Parse the record\n                         HttpMessage msg = href.getHttpMessage();\n+                        if (this.pscanOptions.getMaxBodySizeInBytesToScan() > 0", "originalCommit": "c7e9bb6518beb7a0d2f7b89ef611afe79c5b9dba", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c6877ad9b5379bf7c1de4eac3e7816e43d47ac10", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/extension/pscan/PassiveScanThread.java b/zap/src/main/java/org/zaproxy/zap/extension/pscan/PassiveScanThread.java\nindex 0b934f571..5d6b5e749 100644\n--- a/zap/src/main/java/org/zaproxy/zap/extension/pscan/PassiveScanThread.java\n+++ b/zap/src/main/java/org/zaproxy/zap/extension/pscan/PassiveScanThread.java\n\n@@ -179,26 +179,10 @@ public class PassiveScanThread extends Thread implements ProxyListener, SessionC\n                     try {\n                         // Parse the record\n                         HttpMessage msg = href.getHttpMessage();\n-                        if (this.pscanOptions.getMaxBodySizeInBytesToScan() > 0\n-                                && msg.getResponseBody().length()\n-                                        > this.pscanOptions.getMaxBodySizeInBytesToScan()) {\n-                            // Body is larger than the max allowed to scan\n-                            if (logger.isDebugEnabled()) {\n-                                logger.debug(\n-                                        \"Response from \"\n-                                                + msg.getRequestHeader().getURI()\n-                                                + \" body size \"\n-                                                + msg.getResponseBody().length()\n-                                                + \" larger than max configured \"\n-                                                + this.pscanOptions.getMaxBodySizeInBytesToScan());\n-                                Stats.incCounter(\"stats.pscan.bodyTooBig\");\n-                            }\n-                            continue;\n-                        }\n-\n                         Source src = new Source(msg.getResponseBody().toString());\n                         currentUrl = msg.getRequestHeader().getURI().toString();\n                         PassiveScanData passiveScanData = new PassiveScanData(msg);\n+                        int maxBodySize = this.pscanOptions.getMaxBodySizeInBytesToScan();\n \n                         for (PassiveScanner scanner : scannerList.list()) {\n                             try {\n"}}, {"oid": "c6877ad9b5379bf7c1de4eac3e7816e43d47ac10", "url": "https://github.com/zaproxy/zaproxy/commit/c6877ad9b5379bf7c1de4eac3e7816e43d47ac10", "message": "Add pscan max size in bytes option\n\nPartly addresses #3813\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-13T12:04:00Z", "type": "forcePushed"}, {"oid": "d48762d46e9e1da6d13af1d9e87411bf7e031163", "url": "https://github.com/zaproxy/zaproxy/commit/d48762d46e9e1da6d13af1d9e87411bf7e031163", "message": "Add pscan max size in bytes option\n\nPartly addresses #3813\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-13T12:20:40Z", "type": "forcePushed"}, {"oid": "0860040a8671a0e5e7f8e68ec473b4e676d867b7", "url": "https://github.com/zaproxy/zaproxy/commit/0860040a8671a0e5e7f8e68ec473b4e676d867b7", "message": "Add pscan max size in bytes option\n\nPartly addresses #3813\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-14T08:36:55Z", "type": "commit"}, {"oid": "0860040a8671a0e5e7f8e68ec473b4e676d867b7", "url": "https://github.com/zaproxy/zaproxy/commit/0860040a8671a0e5e7f8e68ec473b4e676d867b7", "message": "Add pscan max size in bytes option\n\nPartly addresses #3813\n\nSigned-off-by: Simon Bennetts <psiinon@gmail.com>", "committedDate": "2020-10-14T08:36:55Z", "type": "forcePushed"}]}