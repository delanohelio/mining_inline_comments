{"pr_number": 5965, "pr_title": "Add host, path and query columns to the history table", "pr_createdAt": "2020-05-01T18:36:28Z", "pr_url": "https://github.com/zaproxy/zaproxy/pull/5965", "timeline": [{"oid": "12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "url": "https://github.com/zaproxy/zaproxy/commit/12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "message": "Add host, path and query columns to the history table\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-01T18:18:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4ODkzMQ==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418688931", "bodyText": "Since these are basically all the same why not extract a private method and pass the column constant?\nPrinting the stack trace should be replaced with a logger.", "author": "kingthorin", "createdAt": "2020-05-01T19:02:07Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java", "diffHunk": "@@ -120,6 +129,52 @@ public DefaultHistoryReferencesTableEntry(HistoryReference historyReference, Col\n \n         alertRiskCellItem = super.getHighestAlert();\n \n+        try {\n+            hostname1 =\n+                    hasColumn(sortedColumns, Column.HOSTNAME)\n+                            ? historyReference.getURI().getHost()\n+                            : null;\n+        } catch (URIException e) {\n+            hostname1 = null;\n+            e.printStackTrace();\n+        }\n+        hostname = hostname1;", "originalCommit": "12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4OTc1Ng==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418689756", "bodyText": "Also is the intermediate storage necessary? (var vs var1)", "author": "kingthorin", "createdAt": "2020-05-01T19:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4ODkzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyMDQwMQ==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418720401", "bodyText": "That's because they are final instance variables. Although IMO the components should be shown encoded, showing them decoded leads to data loss and misleading values (crude example, the path /%2F will be shown as // which is a completely different path).", "author": "thc202", "createdAt": "2020-05-01T20:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4ODkzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODkzNTQ4Ng==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418935486", "bodyText": "@thc202 I also think that they should be shown encoded, I didn't notice that was happening. @kingthorin the functions I will use now don't throw exception and the code will become more clean.", "author": "DiogoMRSilva", "createdAt": "2020-05-02T09:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4ODkzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1Mjg5Ng==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r420652896", "bodyText": "The host should also be shown encoded (for same reason), e.g.:\nnew String(historyReference.getURI().getRawHost())", "author": "thc202", "createdAt": "2020-05-06T09:19:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY4ODkzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "eb43ed101a538f9b4af064050c1c673085cddd13", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\nindex 031752247..3b1d9b493 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n\n@@ -140,40 +137,21 @@ public class DefaultHistoryReferencesTableEntry extends AbstractHistoryReference\n         }\n         hostname = hostname1;\n \n-        try {\n-            pathAndQuery1 =\n-                    hasColumn(sortedColumns, Column.PATH_AND_QUERY)\n-                            ? historyReference.getURI().getPathQuery()\n-                            : null;\n-        } catch (URIException e) {\n-            pathAndQuery1 = null;\n-            e.printStackTrace();\n-        }\n-        pathAndQuery = pathAndQuery1;\n-\n-        try {\n-            path1 =\n-                    hasColumn(sortedColumns, Column.PATH)\n-                            ? historyReference.getURI().getPath()\n-                            : null;\n+        pathAndQuery =\n+                hasColumn(sortedColumns, Column.PATH_AND_QUERY)\n+                        ? historyReference.getURI().getEscapedPathQuery()\n+                        : null;\n \n-        } catch (URIException e) {\n-            path1 = null;\n-            e.printStackTrace();\n-        }\n-        path = path1;\n+        path =\n+                hasColumn(sortedColumns, Column.PATH)\n+                        ? historyReference.getURI().getEscapedPath()\n+                        : null;\n \n-        try {\n-            query1 =\n-                    hasColumn(sortedColumns, Column.QUERY)\n-                            ? historyReference.getURI().getQuery()\n-                            : null;\n+        query =\n+                hasColumn(sortedColumns, Column.QUERY)\n+                        ? historyReference.getURI().getEscapedQuery()\n+                        : null;\n \n-        } catch (URIException e) {\n-            query1 = null;\n-            e.printStackTrace();\n-        }\n-        query = query1;\n \n         refreshCachedValues();\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyMTQ4MQ==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418721481", "bodyText": "I'd expect these to be closer/next to the URL column by default (same in the enum).", "author": "thc202", "createdAt": "2020-05-01T20:22:52Z", "path": "zap/src/main/java/org/parosproxy/paros/extension/history/HistoryTableModel.java", "diffHunk": "@@ -44,7 +44,11 @@ public HistoryTableModel() {\n                     Column.SIZE_RESPONSE_BODY,\n                     Column.HIGHEST_ALERT,\n                     Column.NOTE,\n-                    Column.TAGS\n+                    Column.TAGS,\n+                    Column.HOSTNAME,", "originalCommit": "12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ebd3570f6622e1d12b664eb0a1f4f7861095ac05", "chunk": "diff --git a/zap/src/main/java/org/parosproxy/paros/extension/history/HistoryTableModel.java b/zap/src/main/java/org/parosproxy/paros/extension/history/HistoryTableModel.java\nindex fb05c8ecf..e5ab5eade 100644\n--- a/zap/src/main/java/org/parosproxy/paros/extension/history/HistoryTableModel.java\n+++ b/zap/src/main/java/org/parosproxy/paros/extension/history/HistoryTableModel.java\n\n@@ -44,11 +48,7 @@ class HistoryTableModel extends DefaultHistoryReferencesTableModel {\n                     Column.SIZE_RESPONSE_BODY,\n                     Column.HIGHEST_ALERT,\n                     Column.NOTE,\n-                    Column.TAGS,\n-                    Column.HOSTNAME,\n-                    Column.PATH_AND_QUERY,\n-                    Column.PATH,\n-                    Column.QUERY\n+                    Column.TAGS\n                 });\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyMTU4OQ==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418721589", "bodyText": "Can let fall-through.", "author": "thc202", "createdAt": "2020-05-01T20:23:09Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/AbstractHistoryReferencesTableEntry.java", "diffHunk": "@@ -267,6 +303,14 @@ public static Object getPrototypeValue(Column column) {\n                 return String.class;\n             case CUSTOM:\n                 return null;\n+            case HOSTNAME:\n+                return String.class;", "originalCommit": "12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ebd3570f6622e1d12b664eb0a1f4f7861095ac05", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/AbstractHistoryReferencesTableEntry.java b/zap/src/main/java/org/zaproxy/zap/view/table/AbstractHistoryReferencesTableEntry.java\nindex b3faf7ac5..0ebc82194 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/AbstractHistoryReferencesTableEntry.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/AbstractHistoryReferencesTableEntry.java\n\n@@ -303,14 +307,6 @@ public abstract class AbstractHistoryReferencesTableEntry implements HistoryRefe\n                 return String.class;\n             case CUSTOM:\n                 return null;\n-            case HOSTNAME:\n-                return String.class;\n-            case PATH_AND_QUERY:\n-                return String.class;\n-            case PATH:\n-                return String.class;\n-            case QUERY:\n-                return String.class;\n             default:\n                 return String.class;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyMTY0OA==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r418721648", "bodyText": "This is not necessary for these columns.", "author": "thc202", "createdAt": "2020-05-01T20:23:20Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTable.java", "diffHunk": "@@ -379,6 +379,11 @@ public void configureTableColumn(final TableModel model, final TableColumnExt co\n                     columnExt, hRefModel.getColumnIndex(Column.SIZE_RESPONSE_HEADER), model);\n             installSizeBytesRenderer(\n                     columnExt, hRefModel.getColumnIndex(Column.SIZE_RESPONSE_BODY), model);\n+            installSizeBytesRenderer(columnExt, hRefModel.getColumnIndex(Column.HOSTNAME), model);", "originalCommit": "12bd272c29d017d4f3e13bfbc99c5cd55d7fbe61", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ebd3570f6622e1d12b664eb0a1f4f7861095ac05", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTable.java b/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTable.java\nindex 56eea4619..4099b7ba8 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTable.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTable.java\n\n@@ -379,11 +379,6 @@ public class HistoryReferencesTable extends ZapTable {\n                     columnExt, hRefModel.getColumnIndex(Column.SIZE_RESPONSE_HEADER), model);\n             installSizeBytesRenderer(\n                     columnExt, hRefModel.getColumnIndex(Column.SIZE_RESPONSE_BODY), model);\n-            installSizeBytesRenderer(columnExt, hRefModel.getColumnIndex(Column.HOSTNAME), model);\n-            installSizeBytesRenderer(\n-                    columnExt, hRefModel.getColumnIndex(Column.PATH_AND_QUERY), model);\n-            installSizeBytesRenderer(columnExt, hRefModel.getColumnIndex(Column.PATH), model);\n-            installSizeBytesRenderer(columnExt, hRefModel.getColumnIndex(Column.QUERY), model);\n         }\n \n         protected void installSizeBytesRenderer(\n"}}, {"oid": "eb43ed101a538f9b4af064050c1c673085cddd13", "url": "https://github.com/zaproxy/zaproxy/commit/eb43ed101a538f9b4af064050c1c673085cddd13", "message": "Fix the encoding of path and args that are show in history table\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T09:24:11Z", "type": "commit"}, {"oid": "ebd3570f6622e1d12b664eb0a1f4f7861095ac05", "url": "https://github.com/zaproxy/zaproxy/commit/ebd3570f6622e1d12b664eb0a1f4f7861095ac05", "message": "Reorder History table columns\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T09:42:51Z", "type": "commit"}, {"oid": "6c799dfcb48e6140a8fbed9a2b697bae18a57c24", "url": "https://github.com/zaproxy/zaproxy/commit/6c799dfcb48e6140a8fbed9a2b697bae18a57c24", "message": "Remove path and args columns from history table to reduce memory usage\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T10:17:04Z", "type": "forcePushed"}, {"oid": "644eb8da4f9c38297aee37fec1c060a2c393ef77", "url": "https://github.com/zaproxy/zaproxy/commit/644eb8da4f9c38297aee37fec1c060a2c393ef77", "message": "Fix the encoding of path and args that are show in history table\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T10:26:39Z", "type": "commit"}, {"oid": "ab734821d7021173e465361f7ca1e82545c39f30", "url": "https://github.com/zaproxy/zaproxy/commit/ab734821d7021173e465361f7ca1e82545c39f30", "message": "Fix the encoding of path and args that are show in history table\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T10:26:39Z", "type": "forcePushed"}, {"oid": "644eb8da4f9c38297aee37fec1c060a2c393ef77", "url": "https://github.com/zaproxy/zaproxy/commit/644eb8da4f9c38297aee37fec1c060a2c393ef77", "message": "Fix the encoding of path and args that are show in history table\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-02T10:26:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA4NjA3Ng==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r419086076", "bodyText": "Should use a logger", "author": "kingthorin", "createdAt": "2020-05-03T10:59:05Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java", "diffHunk": "@@ -87,6 +91,20 @@ public DefaultHistoryReferencesTableEntry(HistoryReference historyReference, Col\n         rtt = hasColumn(sortedColumns, Column.RTT) ? historyReference.getRtt() : null;\n \n         uri = hasColumn(sortedColumns, Column.URL) ? historyReference.getURI().toString() : null;\n+        try {\n+            hostname1 =\n+                    hasColumn(sortedColumns, Column.HOSTNAME)\n+                            ? historyReference.getURI().getHost()\n+                            : null;\n+        } catch (URIException e) {\n+            hostname1 = null;\n+            e.printStackTrace();", "originalCommit": "644eb8da4f9c38297aee37fec1c060a2c393ef77", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f3f150d2d8a0a999523d2f2d24f80d8092de80e0", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\nindex 842fbc777..bd0f35c76 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n\n@@ -98,6 +101,7 @@ public class DefaultHistoryReferencesTableEntry extends AbstractHistoryReference\n                             : null;\n         } catch (URIException e) {\n             hostname1 = null;\n+            LOGGER.error(e);\n             e.printStackTrace();\n         }\n         hostname = hostname1;\n"}}, {"oid": "f3f150d2d8a0a999523d2f2d24f80d8092de80e0", "url": "https://github.com/zaproxy/zaproxy/commit/f3f150d2d8a0a999523d2f2d24f80d8092de80e0", "message": "Replace print stack trace with logger\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-03T11:49:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA5MjIyNg==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r419092226", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        e.printStackTrace();", "author": "kingthorin", "createdAt": "2020-05-03T11:51:33Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java", "diffHunk": "@@ -98,6 +101,7 @@ public DefaultHistoryReferencesTableEntry(HistoryReference historyReference, Col\n                             : null;\n         } catch (URIException e) {\n             hostname1 = null;\n+            LOGGER.error(e);\n             e.printStackTrace();", "originalCommit": "f3f150d2d8a0a999523d2f2d24f80d8092de80e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "08c09d25076a9569047e3453bdc5165d2aeb44e0", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\nindex bd0f35c76..3f6a79a03 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/DefaultHistoryReferencesTableEntry.java\n\n@@ -102,7 +102,6 @@ public class DefaultHistoryReferencesTableEntry extends AbstractHistoryReference\n         } catch (URIException e) {\n             hostname1 = null;\n             LOGGER.error(e);\n-            e.printStackTrace();\n         }\n         hostname = hostname1;\n         pathAndQuery =\n"}}, {"oid": "08c09d25076a9569047e3453bdc5165d2aeb44e0", "url": "https://github.com/zaproxy/zaproxy/commit/08c09d25076a9569047e3453bdc5165d2aeb44e0", "message": "Remove print stack trace\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-03T11:54:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDY1NjgyMQ==", "url": "https://github.com/zaproxy/zaproxy/pull/5965#discussion_r420656821", "bodyText": "This could be reverted.", "author": "thc202", "createdAt": "2020-05-06T09:26:32Z", "path": "zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTableModel.java", "diffHunk": "@@ -58,7 +60,6 @@\n         HIGHEST_ALERT,\n         NOTE,\n         TAGS,\n-", "originalCommit": "08c09d25076a9569047e3453bdc5165d2aeb44e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "491db186fe9b89c5c21aea2018866c04650c2ba7", "chunk": "diff --git a/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTableModel.java b/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTableModel.java\nindex 00434678d..f8ccd51c0 100644\n--- a/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTableModel.java\n+++ b/zap/src/main/java/org/zaproxy/zap/view/table/HistoryReferencesTableModel.java\n\n@@ -60,6 +60,7 @@ public interface HistoryReferencesTableModel<T extends HistoryReferencesTableEnt\n         HIGHEST_ALERT,\n         NOTE,\n         TAGS,\n+\n         /**\n          * Indicates that the column has custom values and that those values should retrieved by\n          * other means.\n"}}, {"oid": "491db186fe9b89c5c21aea2018866c04650c2ba7", "url": "https://github.com/zaproxy/zaproxy/commit/491db186fe9b89c5c21aea2018866c04650c2ba7", "message": "revert deleted line\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-06T21:44:02Z", "type": "commit"}, {"oid": "b036be0aeff850749fb57bf290815901ab064ebc", "url": "https://github.com/zaproxy/zaproxy/commit/b036be0aeff850749fb57bf290815901ab064ebc", "message": "Set host column of history encoded\n\nSigned-off-by: Diogo Silva <diogo.m.r.silva@tecnico.ulisboa.pt>", "committedDate": "2020-05-06T21:59:34Z", "type": "commit"}]}