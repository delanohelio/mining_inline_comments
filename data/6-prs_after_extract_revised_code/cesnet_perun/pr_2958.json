{"pr_number": 2958, "pr_title": "Added extraction of ues attributes to extractAdditionalUserExtSources", "pr_createdAt": "2020-10-28T22:05:46Z", "pr_url": "https://github.com/CESNET/perun/pull/2958", "timeline": [{"oid": "a90d5b5dbf44886566bdc0d32df9eb6154c8628b", "url": "https://github.com/CESNET/perun/commit/a90d5b5dbf44886566bdc0d32df9eb6154c8628b", "message": "Added extraction of ues attributes to extractAdditionalUserExtSources\n\n- the method extractAdditionalUserExtSources() now returns RichUserExtSources with attributes extracted from subjectData\n- also created new type of Candidate which holds RichUserExtSources and will be used during synchronization (in later commit)\n- getCandidate now returns this new CandidateSync, every current usage of method was modified to transform to the old Candidate", "committedDate": "2020-10-28T21:45:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5Mjk1Ng==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r514092956", "bodyText": "I am missing the main UserExtSource which is also in Candidate. You wouldn't be able to say which one is the main from the list which I am note sure is or isn't a problem. I would work with this RichUserExtSource as a separate UES like in the Candidate to prevent this problem.", "author": "stavamichal", "createdAt": "2020-10-29T08:49:33Z", "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package cz.metacentrum.perun.core.api;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Candidate used in group synchronization.\n+ * @author Metodej Klang\n+ */\n+public class CandidateSync extends User {\n+\n+\tprivate List<RichUserExtSource> richUserExtSources;\n+\tprivate Map<String, String> attributes;\n+", "originalCommit": "a90d5b5dbf44886566bdc0d32df9eb6154c8628b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5OTUyMg==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r514099522", "bodyText": "Also, you will never get the correct object of a Candidate from the CandidateSync without this information.", "author": "stavamichal", "createdAt": "2020-10-29T09:00:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5Mjk1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "chunk": "diff --git a/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java b/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\nindex 94740468c..4898f8d68 100644\n--- a/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\n+++ b/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\n\n@@ -1,6 +1,7 @@\n package cz.metacentrum.perun.core.api;\n \n import java.util.ArrayList;\n+import java.util.Collections;\n import java.util.List;\n import java.util.Map;\n import java.util.stream.Collectors;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5NjI4Nw==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r514096287", "bodyText": "The main userExtSource should be saved in a different field of the object. Without it, you can't say which one is the main one.", "author": "stavamichal", "createdAt": "2020-10-29T08:55:07Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java", "diffHunk": "@@ -281,11 +281,13 @@ public Candidate getCandidate(PerunSession perunSession, Map<String,String> subj\n \t\t\t\tattributes.put(attrName, subjectData.get(attrName));\n \t\t\t}\n \t\t}\n-\t\tList<UserExtSource> additionalUserExtSources = Utils.extractAdditionalUserExtSources(perunSession, subjectData);\n-\t\tcandidate.setAdditionalUserExtSources(additionalUserExtSources);\n-\t\tcandidate.setAttributes(attributes);\n \n-\t\treturn candidate;\n+\t\tList<RichUserExtSource> additionalUserExtSources = Arrays.asList(new RichUserExtSource(userExtSource, new ArrayList<>()));", "originalCommit": "a90d5b5dbf44886566bdc0d32df9eb6154c8628b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java\nindex c880cb080..26cb39f32 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java\n\n@@ -282,9 +280,8 @@ public class ExtSourcesManagerBlImpl implements ExtSourcesManagerBl {\n \t\t\t}\n \t\t}\n \n-\t\tList<RichUserExtSource> additionalUserExtSources = Arrays.asList(new RichUserExtSource(userExtSource, new ArrayList<>()));\n-\t\tadditionalUserExtSources.addAll(Utils.extractAdditionalUserExtSources(perunSession, subjectData));\n-\t\tcandidateSync.setRichUserExtSources(additionalUserExtSources);\n+\t\tcandidateSync.setRichUserExtSource(new RichUserExtSource(userExtSource, new ArrayList<>()));\n+\t\tcandidateSync.setAdditionalRichUserExtSources(Utils.extractAdditionalUserExtSources(perunSession, subjectData));\n \t\tcandidateSync.setAttributes(attributes);\n \n \t\treturn candidateSync;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDEwMTg1Mg==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r514101852", "bodyText": "There could be more than 1 attribute after the login. You should parse all of them. So this code should probably work for length>1.", "author": "stavamichal", "createdAt": "2020-10-29T09:04:17Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -206,8 +212,25 @@ public static String join(Iterable<?> collection, String separator) {\n \t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n+\t\t\t\t\tUserExtSource userExtSource = new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\t\t\t\t// Set ues attribute\n+\t\t\t\t\tif (additionalExtLoginAndAttribute.length == 2) {", "originalCommit": "a90d5b5dbf44886566bdc0d32df9eb6154c8628b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex c18f50ba1..6b6290f70 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -216,16 +217,19 @@ public class Utils {\n \n \t\t\t\t\tList<Attribute> attributes = new ArrayList<>();\n \t\t\t\t\t// Set ues attribute\n-\t\t\t\t\tif (additionalExtLoginAndAttribute.length == 2) {\n-\t\t\t\t\t\tString[] uesAttribute = additionalExtLoginAndAttribute[1].split(\"=\");\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), uesAttribute[1]);\n-\t\t\t\t\t\t\tattributes.add(attribute);\n-\t\t\t\t\t\t} catch (AttributeNotExistsException e) {\n-\t\t\t\t\t\t\tlog.error(\"User with login {} has invalid attribute for userExtSource defined as {} with value {}.\", login, uesAttribute[0], uesAttribute[1]);\n+\t\t\t\t\tif (additionalExtLoginAndAttribute.length > 1) {\n+\t\t\t\t\t\tList<String> uesAttributesWithValues =  new LinkedList<>();\n+\t\t\t\t\t\tuesAttributesWithValues.addAll(Arrays.asList(additionalExtLoginAndAttribute));\n+\t\t\t\t\t\tuesAttributesWithValues.remove(0);\n+\t\t\t\t\t\tfor (String uesAttributeWithValue : uesAttributesWithValues) {\n+\t\t\t\t\t\t\tString[] uesAttribute = uesAttributeWithValue.split(\"=\");\n+\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), uesAttribute[1]);\n+\t\t\t\t\t\t\t\tattributes.add(attribute);\n+\t\t\t\t\t\t\t} catch (AttributeNotExistsException e) {\n+\t\t\t\t\t\t\t\tlog.error(\"User with login {} has invalid attribute for userExtSource defined as {} with value {}.\", login, uesAttribute[0], uesAttribute[1]);\n+\t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n-\t\t\t\t\t} else if (additionalExtLoginAndAttribute.length > 2) {\n-\t\t\t\t\t\tlog.error(\"User with login {} has invalid attributes for userExtSource defined as {}.\", login, additionalExtLoginAndAttribute);\n \t\t\t\t\t}\n \n \t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(userExtSource, attributes);\n"}}, {"oid": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "url": "https://github.com/CESNET/perun/commit/0fa53b5bfc4686c7bf1237e8206856ee6755087d", "message": "Fixes based on review\n\n- added main RichUserExtSource to CandidateSync (as Candidate has)\n- added support of more attributes in extractAdditionalUserExtSources", "committedDate": "2020-10-30T09:21:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMTg0NA==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r515011844", "bodyText": "I am just wondering about a use case where we want to find users by some attribute from the main userExtSource. I think that the way the code is written now, it will be not possible. What do you think @metodej and @stavamichal ?", "author": "balcirakpeter", "createdAt": "2020-10-30T10:49:57Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ExtSourcesManagerBlImpl.java", "diffHunk": "@@ -281,11 +279,12 @@ public Candidate getCandidate(PerunSession perunSession, Map<String,String> subj\n \t\t\t\tattributes.put(attrName, subjectData.get(attrName));\n \t\t\t}\n \t\t}\n-\t\tList<UserExtSource> additionalUserExtSources = Utils.extractAdditionalUserExtSources(perunSession, subjectData);\n-\t\tcandidate.setAdditionalUserExtSources(additionalUserExtSources);\n-\t\tcandidate.setAttributes(attributes);\n \n-\t\treturn candidate;\n+\t\tcandidateSync.setRichUserExtSource(new RichUserExtSource(userExtSource, new ArrayList<>()));", "originalCommit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMwODQwNQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517308405", "bodyText": "I am not sure where would I find the attributes for main ues... Could they be part of the subjectData like the member and user attributes?", "author": "metodej", "createdAt": "2020-11-04T12:28:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMTg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxMTIzOQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517311239", "bodyText": "At this moment there is no way how to set attributes for main extSource. It would probably need another iteration (other PR) to fix this specific problem. You can't fix it here.", "author": "stavamichal", "createdAt": "2020-11-04T12:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMTg0NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r515013117", "bodyText": "I think this will work only for single value attributes. @stavamichal do we want to support also multivalue attributes?", "author": "balcirakpeter", "createdAt": "2020-10-30T10:52:35Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -206,8 +213,28 @@ public static String join(Iterable<?> collection, String separator) {\n \t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n+\t\t\t\t\tUserExtSource userExtSource = new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\t\t\t\t// Set ues attribute\n+\t\t\t\t\tif (additionalExtLoginAndAttribute.length > 1) {\n+\t\t\t\t\t\tList<String> uesAttributesWithValues =  new LinkedList<>();\n+\t\t\t\t\t\tuesAttributesWithValues.addAll(Arrays.asList(additionalExtLoginAndAttribute));\n+\t\t\t\t\t\tuesAttributesWithValues.remove(0);\n+\t\t\t\t\t\tfor (String uesAttributeWithValue : uesAttributesWithValues) {\n+\t\t\t\t\t\t\tString[] uesAttribute = uesAttributeWithValue.split(\"=\");\n+\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), uesAttribute[1]);", "originalCommit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxNzcyNQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517317725", "bodyText": "@balcirakpeter Do we already have ues attribute with multi-value as logins? If yes, then we need to fix it too. Which means to change format for the multivalue attribute. For example we can use something like \"|login,urn=value1;value2,urn2=value1|1\" (at least if these characters are not in the login itself and they are not used for parsing the whole string yet).", "author": "stavamichal", "createdAt": "2020-11-04T12:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0NTIwNg==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517345206", "bodyText": "If you will be changing this one, please after the change send me re-request for review. Thank you.", "author": "stavamichal", "createdAt": "2020-11-04T13:34:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk4MDIzNQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517980235", "bodyText": "Yes, we have such ues attribute on eduTEAMS instances called additionalIdentifiers.", "author": "balcirakpeter", "createdAt": "2020-11-05T11:27:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODAzOTk2Ng==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518039966", "bodyText": "Ok, so I've updated extraction to support multivalue attributes and re-request your reviews.", "author": "metodej", "createdAt": "2020-11-05T13:13:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0MDQ4MA==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518040480", "bodyText": "In such a case please @metodej prepare this code to be able to process multi-value attributes. Don't need to use my suggestion.", "author": "stavamichal", "createdAt": "2020-11-05T13:14:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTAxMzExNw=="}], "type": "inlineReview", "revised_code": {"commit": "f35d0d9774f23eed28177be784501968a0468d56", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex 6b6290f70..b5b579d60 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -224,7 +224,7 @@ public class Utils {\n \t\t\t\t\t\tfor (String uesAttributeWithValue : uesAttributesWithValues) {\n \t\t\t\t\t\t\tString[] uesAttribute = uesAttributeWithValue.split(\"=\");\n \t\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), uesAttribute[1]);\n+\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), getAttributeValueFromString(uesAttribute[1]));\n \t\t\t\t\t\t\t\tattributes.add(attribute);\n \t\t\t\t\t\t\t} catch (AttributeNotExistsException e) {\n \t\t\t\t\t\t\t\tlog.error(\"User with login {} has invalid attribute for userExtSource defined as {} with value {}.\", login, uesAttribute[0], uesAttribute[1]);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxODU1NQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r517318555", "bodyText": "RichUserExtSource is missing in hashCode counting and also in method equals.", "author": "stavamichal", "createdAt": "2020-11-04T12:47:57Z", "path": "perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package cz.metacentrum.perun.core.api;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * Candidate used in group synchronization.\n+ * @author Metodej Klang\n+ */\n+public class CandidateSync extends User {\n+\n+\tprivate RichUserExtSource richUserExtSource;\n+\tprivate List<RichUserExtSource> additionalRichUserExtSources;\n+\tprivate Map<String, String> attributes;\n+\n+\tpublic CandidateSync() {\n+\t}\n+\n+\tpublic CandidateSync(Candidate candidate) {\n+\t\tthis.setFirstName(candidate.getFirstName());\n+\t\tthis.setLastName(candidate.getLastName());\n+\t\tthis.setMiddleName(candidate.getMiddleName());\n+\t\tthis.setTitleAfter(candidate.getTitleAfter());\n+\t\tthis.setTitleBefore(candidate.getTitleBefore());\n+\t\tthis.setServiceUser(candidate.isServiceUser());\n+\t\tthis.setSponsoredUser(candidate.isSponsoredUser());\n+\t\tsetAttributes(candidate.getAttributes());\n+\t\tsetRichUserExtSource(new RichUserExtSource(candidate.getUserExtSource(), new ArrayList<>()));\n+\t\tif (candidate.getAdditionalUserExtSources() != null) {\n+\t\t\tsetAdditionalRichUserExtSources(candidate.getAdditionalUserExtSources().stream().map(extSource ->\n+\t\t\t\tnew RichUserExtSource(extSource, new ArrayList<>())).collect(Collectors.toList()));\n+\t\t}\n+\t}\n+\n+\tpublic RichUserExtSource getRichUserExtSource() {\n+\t\treturn richUserExtSource;\n+\t}\n+\n+\tpublic void setRichUserExtSource(RichUserExtSource richUserExtSource) {\n+\t\tthis.richUserExtSource = richUserExtSource;\n+\t}\n+\n+\tpublic Map<String, String> getAttributes() {\n+\t\treturn attributes;\n+\t}\n+\n+\tpublic void setAttributes(Map<String, String> attributes) {\n+\t\tthis.attributes = attributes;\n+\t}\n+\n+\tpublic List<RichUserExtSource> getAdditionalRichUserExtSources() {\n+\t\treturn additionalRichUserExtSources;\n+\t}\n+\n+\tpublic void setAdditionalRichUserExtSources(List<RichUserExtSource> additionalRichUserExtSources) {\n+\t\tthis.additionalRichUserExtSources = additionalRichUserExtSources;\n+\t}\n+\n+\tpublic List<RichUserExtSource> getUserExtSources() {\n+\t\tList<RichUserExtSource> userExtSources = new ArrayList<>();\n+\t\tif (this.richUserExtSource != null) {\n+\t\t\tuserExtSources.add(this.richUserExtSource);\n+\t\t}\n+\t\tif (this.additionalRichUserExtSources != null) {\n+\t\t\tuserExtSources.addAll(this.additionalRichUserExtSources);\n+\t\t}\n+\t\treturn Collections.unmodifiableList(userExtSources);\n+\t}\n+\n+\t@Override\n+\tpublic int hashCode() {", "originalCommit": "0fa53b5bfc4686c7bf1237e8206856ee6755087d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODAzOTI2Nw==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518039267", "bodyText": "Fixed.", "author": "metodej", "createdAt": "2020-11-05T13:12:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxODU1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "f35d0d9774f23eed28177be784501968a0468d56", "chunk": "diff --git a/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java b/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\nindex 4898f8d68..3441c8f34 100644\n--- a/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\n+++ b/perun-base/src/main/java/cz/metacentrum/perun/core/api/CandidateSync.java\n\n@@ -77,7 +77,7 @@ public class CandidateSync extends User {\n \t\tresult = prime * result\n \t\t\t+ ((attributes == null) ? 0 : attributes.hashCode());\n \t\tresult = prime * result\n-\t\t\t+ ((additionalRichUserExtSources == null) ? 0 : additionalRichUserExtSources.hashCode());\n+\t\t\t+ ((getUserExtSources() == null) ? 0 : getUserExtSources().hashCode());\n \t\treturn result;\n \t}\n \n"}}, {"oid": "f35d0d9774f23eed28177be784501968a0468d56", "url": "https://github.com/CESNET/perun/commit/f35d0d9774f23eed28177be784501968a0468d56", "message": "Fixes based on review\n\n- new object CandidateSync has now all its attributes included in hashCode and equals methods\n- added support of multivalue login attributes\n- deleted debug printing in test", "committedDate": "2020-11-05T13:02:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0ODQyMw==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518048423", "bodyText": "This whole method should be refactored to smaller parts with better Javadoc. There should be info what is the expected format of additionalUserExtSource in the subject, which part is which and how it will be parsed.", "author": "stavamichal", "createdAt": "2020-11-05T13:26:45Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -158,8 +163,8 @@ public static String join(Iterable<?> collection, String separator) {\n \t * @return List<UserExtSource> all additional ExtSources from the subject, returned list will never contain null value\n \t * @throws InternalErrorException\n \t */\n-\tpublic static List<UserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n-\t\tList<UserExtSource> additionalUserExtSources = new ArrayList<>();\n+\tpublic static List<RichUserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {", "originalCommit": "f35d0d9774f23eed28177be784501968a0468d56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE0OTMyNg==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518149326", "bodyText": "Ok, I've splitted the method to smaller parts and added some comments and javadocs.", "author": "metodej", "createdAt": "2020-11-05T15:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0ODQyMw=="}], "type": "inlineReview", "revised_code": {"commit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex b5b579d60..4672b6c19 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -157,11 +153,11 @@ public class Utils {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n-\t * @return List<UserExtSource> all additional ExtSources from the subject, returned list will never contain null value\n-\t * @throws InternalErrorException\n+\t * @return List<RichUserExtSource> all additional ExtSources (and possibly their attributes) from the subject, returned list will never contain null value\n \t */\n \tpublic static List<RichUserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n \t\tList<RichUserExtSource> additionalUserExtSources = new ArrayList<>();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0OTUzOQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518049539", "bodyText": "The name of this method is very similar to the one parsing attribute value from escaped string (from DB) to the object Attribute in Perun. I would change the name and add more info to the javadoc (because this method has just one purpose and can't be used for other).", "author": "stavamichal", "createdAt": "2020-11-05T13:28:31Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -206,14 +213,49 @@ public static String join(Iterable<?> collection, String separator) {\n \t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n+\t\t\t\t\tUserExtSource userExtSource = new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\tList<Attribute> attributes = new ArrayList<>();\n+\t\t\t\t\t// Set ues attribute\n+\t\t\t\t\tif (additionalExtLoginAndAttribute.length > 1) {\n+\t\t\t\t\t\tList<String> uesAttributesWithValues =  new LinkedList<>();\n+\t\t\t\t\t\tuesAttributesWithValues.addAll(Arrays.asList(additionalExtLoginAndAttribute));\n+\t\t\t\t\t\tuesAttributesWithValues.remove(0);\n+\t\t\t\t\t\tfor (String uesAttributeWithValue : uesAttributesWithValues) {\n+\t\t\t\t\t\t\tString[] uesAttribute = uesAttributeWithValue.split(\"=\");\n+\t\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), getAttributeValueFromString(uesAttribute[1]));\n+\t\t\t\t\t\t\t\tattributes.add(attribute);\n+\t\t\t\t\t\t\t} catch (AttributeNotExistsException e) {\n+\t\t\t\t\t\t\t\tlog.error(\"User with login {} has invalid attribute for userExtSource defined as {} with value {}.\", login, uesAttribute[0], uesAttribute[1]);\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(userExtSource, attributes);\n \t\t\t\t\t// Add additional user extSource\n-\t\t\t\t\tadditionalUserExtSources.add(new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin));\n+\t\t\t\t\tadditionalUserExtSources.add(richUserExtSource);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn additionalUserExtSources;\n \t}\n \n+\t/**\n+\t * Splits attribute value by \";\" and returns list of string values or single string if no \";\" occurres.\n+\t *\n+\t * @param attributeValue unsplitted attribute value\n+\t * @return splitted attribute value to list of string or single string\n+\t */\n+\tprivate static Object getAttributeValueFromString(String attributeValue) {", "originalCommit": "f35d0d9774f23eed28177be784501968a0468d56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE0NjE3OQ==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518146179", "bodyText": "Changed.", "author": "metodej", "createdAt": "2020-11-05T15:37:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODA0OTUzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex b5b579d60..4672b6c19 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -171,69 +167,41 @@ public class Utils {\n \t\t\t\tattrName.startsWith(ExtSourcesManagerImpl.USEREXTSOURCEMAPPING)) {\n \t\t\t\tString login = subjectFromExtSource.get(\"login\");\n \n-\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\"); // Entry contains extSourceName|extSourceType|extLogin[|LoA]\n+\t\t\t\t// Entry contains extSourceName|extSourceType|extLogin;uesAttribute=value1,value2[|LoA]\n+\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\");\n \t\t\t\tlog.debug(\"Processing additionalUserExtSource {}\",  subjectFromExtSource.get(attrName));\n \n-\t\t\t\t//Check if the array has at least 3 parts, this is protection against outOfBoundException\n+\t\t\t\t// Check if the array has at least 3 parts, this is protection against outOfBoundException\n \t\t\t\tif(userExtSourceRaw.length < 3) {\n \t\t\t\t\tthrow new InternalErrorException(\"There is a missing mandatory part of additional user extSource value when processing it - '\" + attrName + \"'\");\n \t\t\t\t}\n \n+\t\t\t\t// Parse required parts of additional ues from subject\n \t\t\t\tString additionalExtSourceName = userExtSourceRaw[0];\n \t\t\t\tString additionalExtSourceType = userExtSourceRaw[1];\n-\t\t\t\tString[] additionalExtLoginAndAttribute = userExtSourceRaw[2].split(\",\");\n-\t\t\t\tString additionalExtLogin = additionalExtLoginAndAttribute[0];\n-\n-\t\t\t\tint additionalExtLoa = 0;\n-\t\t\t\t// Loa is not mandatory argument\n-\t\t\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n-\t\t\t\t\t} catch (NumberFormatException e) {\n-\t\t\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tExtSource additionalExtSource;\n+\t\t\t\tString[] additionalExtLoginAndAttributes = userExtSourceRaw[2].split(\";\");\n+\t\t\t\tString additionalExtLogin = additionalExtLoginAndAttributes[0];\n \n+\t\t\t\t// Check if any of the required part is not null nor it is empty\n \t\t\t\tif (additionalExtSourceName == null || additionalExtSourceName.isEmpty() ||\n \t\t\t\t\tadditionalExtSourceType == null || additionalExtSourceType.isEmpty() ||\n \t\t\t\t\tadditionalExtLogin == null || additionalExtLogin.isEmpty()) {\n \t\t\t\t\tlog.error(\"User with login {} has invalid additional userExtSource defined {}.\", login, userExtSourceRaw);\n \t\t\t\t} else {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// Try to get extSource, with full extSource object (containg ID)\n-\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().getExtSourceByName(sess, additionalExtSourceName);\n-\t\t\t\t\t} catch (ExtSourceNotExistsException e) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t// Create new one if not exists\n-\t\t\t\t\t\t\tadditionalExtSource = new ExtSource(additionalExtSourceName, additionalExtSourceType);\n-\t\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().createExtSource(sess, additionalExtSource, null);\n-\t\t\t\t\t\t} catch (ExtSourceExistsException e1) {\n-\t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\tUserExtSource userExtSource = new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin);\n-\n-\t\t\t\t\tList<Attribute> attributes = new ArrayList<>();\n-\t\t\t\t\t// Set ues attribute\n-\t\t\t\t\tif (additionalExtLoginAndAttribute.length > 1) {\n-\t\t\t\t\t\tList<String> uesAttributesWithValues =  new LinkedList<>();\n-\t\t\t\t\t\tuesAttributesWithValues.addAll(Arrays.asList(additionalExtLoginAndAttribute));\n-\t\t\t\t\t\tuesAttributesWithValues.remove(0);\n-\t\t\t\t\t\tfor (String uesAttributeWithValue : uesAttributesWithValues) {\n-\t\t\t\t\t\t\tString[] uesAttribute = uesAttributeWithValue.split(\"=\");\n-\t\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t\tAttribute attribute = new Attribute(sess.getPerun().getAttributesManager().getAttributeDefinition(sess, uesAttribute[0]), getAttributeValueFromString(uesAttribute[1]));\n-\t\t\t\t\t\t\t\tattributes.add(attribute);\n-\t\t\t\t\t\t\t} catch (AttributeNotExistsException e) {\n-\t\t\t\t\t\t\t\tlog.error(\"User with login {} has invalid attribute for userExtSource defined as {} with value {}.\", login, uesAttribute[0], uesAttribute[1]);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n \n-\t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(userExtSource, attributes);\n-\t\t\t\t\t// Add additional user extSource\n+\t\t\t\t\t// Get LoA of additional ues (0 if not stated)\n+\t\t\t\t\tint additionalExtLoa = parseAdditionalUESLoa(login, userExtSourceRaw);\n+\n+\t\t\t\t\t// Get additional ues\n+\t\t\t\t\tUserExtSource additionalUserExtSource = parseAdditionalUserExtSource(sess, additionalExtSourceType, additionalExtSourceName, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\t// Get ues attributes\n+\t\t\t\t\tList<Attribute> uesAttributes = parseUESAttributes(sess, login, additionalExtLoginAndAttributes);\n+\n+\t\t\t\t\t// Create richUserExtSource from ues and its attributes\n+\t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(additionalUserExtSource, uesAttributes);\n+\n+\t\t\t\t\t// Add additional rich user extSource\n \t\t\t\t\tadditionalUserExtSources.add(richUserExtSource);\n \t\t\t\t}\n \t\t\t}\n"}}, {"oid": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "url": "https://github.com/CESNET/perun/commit/070a86b8b33f08a4fb9cc5f528de18ba529f8726", "message": "Fixes based on review\n\n- changed structure of extractAdditionalUserExtSources and javadoc for better readability (hopefully)", "committedDate": "2020-11-05T15:39:37Z", "type": "commit"}, {"oid": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "url": "https://github.com/CESNET/perun/commit/070a86b8b33f08a4fb9cc5f528de18ba529f8726", "message": "Fixes based on review\n\n- changed structure of extractAdditionalUserExtSources and javadoc for better readability (hopefully)", "committedDate": "2020-11-05T15:39:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE1NTQ3OA==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518155478", "bodyText": "So the LoA part is optional right? Can we have it explicitly in the javadoc please?", "author": "stavamichal", "createdAt": "2020-11-05T15:48:29Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -152,68 +153,163 @@ public static String join(Iterable<?> collection, String separator) {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]", "originalCommit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex 4672b6c19..90fb03bee 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -153,7 +153,9 @@ public class Utils {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n-\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n+\t * This additional userExtSource has 3 required parts: name of extSource, type of extSource, login of extsource with optional ues attributes and their values.\n+\t * And 1 optional part: LoA.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1|LoA\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE2MTAzMw==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518161033", "bodyText": "You don't really need to check it here. If there are 3 parts, you can work with that as it was ok already. So just pass the array (or arraylist) of arguments inside of the method parseAdditionalUserExtSource and let it process (or throw an exception if anything is wrong).", "author": "stavamichal", "createdAt": "2020-11-05T15:55:38Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -152,68 +153,163 @@ public static String join(Iterable<?> collection, String separator) {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n-\t * @return List<UserExtSource> all additional ExtSources from the subject, returned list will never contain null value\n-\t * @throws InternalErrorException\n+\t * @return List<RichUserExtSource> all additional ExtSources (and possibly their attributes) from the subject, returned list will never contain null value\n \t */\n-\tpublic static List<UserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n-\t\tList<UserExtSource> additionalUserExtSources = new ArrayList<>();\n+\tpublic static List<RichUserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n+\t\tList<RichUserExtSource> additionalUserExtSources = new ArrayList<>();\n \t\tfor (String attrName : subjectFromExtSource.keySet()) {\n \t\t\tif(attrName != null &&\n \t\t\t\tsubjectFromExtSource.get(attrName) != null &&\n \t\t\t\tattrName.startsWith(ExtSourcesManagerImpl.USEREXTSOURCEMAPPING)) {\n \t\t\t\tString login = subjectFromExtSource.get(\"login\");\n \n-\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\"); // Entry contains extSourceName|extSourceType|extLogin[|LoA]\n+\t\t\t\t// Entry contains extSourceName|extSourceType|extLogin;uesAttribute=value1,value2[|LoA]\n+\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\");\n \t\t\t\tlog.debug(\"Processing additionalUserExtSource {}\",  subjectFromExtSource.get(attrName));\n \n-\t\t\t\t//Check if the array has at least 3 parts, this is protection against outOfBoundException\n+\t\t\t\t// Check if the array has at least 3 parts, this is protection against outOfBoundException\n \t\t\t\tif(userExtSourceRaw.length < 3) {\n \t\t\t\t\tthrow new InternalErrorException(\"There is a missing mandatory part of additional user extSource value when processing it - '\" + attrName + \"'\");\n \t\t\t\t}\n \n+\t\t\t\t// Parse required parts of additional ues from subject\n \t\t\t\tString additionalExtSourceName = userExtSourceRaw[0];\n \t\t\t\tString additionalExtSourceType = userExtSourceRaw[1];\n-\t\t\t\tString additionalExtLogin = userExtSourceRaw[2];\n-\t\t\t\tint additionalExtLoa = 0;\n-\t\t\t\t// Loa is not mandatory argument\n-\t\t\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n-\t\t\t\t\t} catch (NumberFormatException e) {\n-\t\t\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tExtSource additionalExtSource;\n+\t\t\t\tString[] additionalExtLoginAndAttributes = userExtSourceRaw[2].split(\";\");\n+\t\t\t\tString additionalExtLogin = additionalExtLoginAndAttributes[0];\n \n+\t\t\t\t// Check if any of the required part is not null nor it is empty\n \t\t\t\tif (additionalExtSourceName == null || additionalExtSourceName.isEmpty() ||\n \t\t\t\t\tadditionalExtSourceType == null || additionalExtSourceType.isEmpty() ||\n \t\t\t\t\tadditionalExtLogin == null || additionalExtLogin.isEmpty()) {\n \t\t\t\t\tlog.error(\"User with login {} has invalid additional userExtSource defined {}.\", login, userExtSourceRaw);", "originalCommit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex 4672b6c19..90fb03bee 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -153,7 +153,9 @@ public class Utils {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n-\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n+\t * This additional userExtSource has 3 required parts: name of extSource, type of extSource, login of extsource with optional ues attributes and their values.\n+\t * And 1 optional part: LoA.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1|LoA\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE2Mjc5OA==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518162798", "bodyText": "This method should take care of parsing data needed for creating the UES. If any argument will be missing, you can throw an exception here. Then you can catch it outside and just log it and skip the whole process (as before). What do you think? Create a new exception if needed or use standard ParseException.", "author": "stavamichal", "createdAt": "2020-11-05T15:57:55Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -152,68 +153,163 @@ public static String join(Iterable<?> collection, String separator) {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n-\t * @return List<UserExtSource> all additional ExtSources from the subject, returned list will never contain null value\n-\t * @throws InternalErrorException\n+\t * @return List<RichUserExtSource> all additional ExtSources (and possibly their attributes) from the subject, returned list will never contain null value\n \t */\n-\tpublic static List<UserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n-\t\tList<UserExtSource> additionalUserExtSources = new ArrayList<>();\n+\tpublic static List<RichUserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n+\t\tList<RichUserExtSource> additionalUserExtSources = new ArrayList<>();\n \t\tfor (String attrName : subjectFromExtSource.keySet()) {\n \t\t\tif(attrName != null &&\n \t\t\t\tsubjectFromExtSource.get(attrName) != null &&\n \t\t\t\tattrName.startsWith(ExtSourcesManagerImpl.USEREXTSOURCEMAPPING)) {\n \t\t\t\tString login = subjectFromExtSource.get(\"login\");\n \n-\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\"); // Entry contains extSourceName|extSourceType|extLogin[|LoA]\n+\t\t\t\t// Entry contains extSourceName|extSourceType|extLogin;uesAttribute=value1,value2[|LoA]\n+\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\");\n \t\t\t\tlog.debug(\"Processing additionalUserExtSource {}\",  subjectFromExtSource.get(attrName));\n \n-\t\t\t\t//Check if the array has at least 3 parts, this is protection against outOfBoundException\n+\t\t\t\t// Check if the array has at least 3 parts, this is protection against outOfBoundException\n \t\t\t\tif(userExtSourceRaw.length < 3) {\n \t\t\t\t\tthrow new InternalErrorException(\"There is a missing mandatory part of additional user extSource value when processing it - '\" + attrName + \"'\");\n \t\t\t\t}\n \n+\t\t\t\t// Parse required parts of additional ues from subject\n \t\t\t\tString additionalExtSourceName = userExtSourceRaw[0];\n \t\t\t\tString additionalExtSourceType = userExtSourceRaw[1];\n-\t\t\t\tString additionalExtLogin = userExtSourceRaw[2];\n-\t\t\t\tint additionalExtLoa = 0;\n-\t\t\t\t// Loa is not mandatory argument\n-\t\t\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n-\t\t\t\t\t} catch (NumberFormatException e) {\n-\t\t\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tExtSource additionalExtSource;\n+\t\t\t\tString[] additionalExtLoginAndAttributes = userExtSourceRaw[2].split(\";\");\n+\t\t\t\tString additionalExtLogin = additionalExtLoginAndAttributes[0];\n \n+\t\t\t\t// Check if any of the required part is not null nor it is empty\n \t\t\t\tif (additionalExtSourceName == null || additionalExtSourceName.isEmpty() ||\n \t\t\t\t\tadditionalExtSourceType == null || additionalExtSourceType.isEmpty() ||\n \t\t\t\t\tadditionalExtLogin == null || additionalExtLogin.isEmpty()) {\n \t\t\t\t\tlog.error(\"User with login {} has invalid additional userExtSource defined {}.\", login, userExtSourceRaw);\n \t\t\t\t} else {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// Try to get extSource, with full extSource object (containg ID)\n-\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().getExtSourceByName(sess, additionalExtSourceName);\n-\t\t\t\t\t} catch (ExtSourceNotExistsException e) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t// Create new one if not exists\n-\t\t\t\t\t\t\tadditionalExtSource = new ExtSource(additionalExtSourceName, additionalExtSourceType);\n-\t\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().createExtSource(sess, additionalExtSource, null);\n-\t\t\t\t\t\t} catch (ExtSourceExistsException e1) {\n-\t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\t// Add additional user extSource\n-\t\t\t\t\tadditionalUserExtSources.add(new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin));\n+\n+\t\t\t\t\t// Get LoA of additional ues (0 if not stated)\n+\t\t\t\t\tint additionalExtLoa = parseAdditionalUESLoa(login, userExtSourceRaw);\n+\n+\t\t\t\t\t// Get additional ues\n+\t\t\t\t\tUserExtSource additionalUserExtSource = parseAdditionalUserExtSource(sess, additionalExtSourceType, additionalExtSourceName, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\t// Get ues attributes\n+\t\t\t\t\tList<Attribute> uesAttributes = parseUESAttributes(sess, login, additionalExtLoginAndAttributes);\n+\n+\t\t\t\t\t// Create richUserExtSource from ues and its attributes\n+\t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(additionalUserExtSource, uesAttributes);\n+\n+\t\t\t\t\t// Add additional rich user extSource\n+\t\t\t\t\tadditionalUserExtSources.add(richUserExtSource);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn additionalUserExtSources;\n \t}\n \n+\t/**\n+\t * Returns loa of addtional ues, if not stated, returns 0.\n+\t * Used in extractAdditionalUserExtSources to get ues LoA.\n+\t *\n+\t * @param login login of subject\n+\t * @param userExtSourceRaw array containing LoA\n+\t * @return int LoA\n+\t */\n+\tprivate static int parseAdditionalUESLoa(String login, String[] userExtSourceRaw) {\n+\t\tint additionalExtLoa = 0;\n+\t\t// Loa is not mandatory argument\n+\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n+\t\t\ttry {\n+\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n+\t\t\t} catch (NumberFormatException e) {\n+\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n+\t\t\t}\n+\t\t}\n+\t\treturn additionalExtLoa;\n+\t}\n+\n+\t/**\n+\t * Returns additional user ext source either found already in Perun or new.\n+\t * Used in extractAdditionalUserExtSources to get ues.\n+\t *\n+\t * @param sess perun session\n+\t * @param additionalExtSourceType type of additional ues\n+\t * @param additionalExtSourceName name of additional ues\n+\t * @param additionalExtLoa LoA of additional ues\n+\t * @param additionalExtLogin login of additional ues\n+\t * @return UserExtSource additional ues\n+\t */\n+\tprivate static UserExtSource parseAdditionalUserExtSource(PerunSession sess, String additionalExtSourceType, String additionalExtSourceName, int additionalExtLoa, String additionalExtLogin) {", "originalCommit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex 4672b6c19..90fb03bee 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -153,7 +153,9 @@ public class Utils {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n-\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n+\t * This additional userExtSource has 3 required parts: name of extSource, type of extSource, login of extsource with optional ues attributes and their values.\n+\t * And 1 optional part: LoA.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1|LoA\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODE2NDQ0MA==", "url": "https://github.com/CESNET/perun/pull/2958#discussion_r518164440", "bodyText": "You can throw the part with attributes here and then take care of parsing and everything else (same as in the method above).", "author": "stavamichal", "createdAt": "2020-11-05T16:00:03Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java", "diffHunk": "@@ -152,68 +153,163 @@ public static String join(Iterable<?> collection, String separator) {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n-\t * @return List<UserExtSource> all additional ExtSources from the subject, returned list will never contain null value\n-\t * @throws InternalErrorException\n+\t * @return List<RichUserExtSource> all additional ExtSources (and possibly their attributes) from the subject, returned list will never contain null value\n \t */\n-\tpublic static List<UserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n-\t\tList<UserExtSource> additionalUserExtSources = new ArrayList<>();\n+\tpublic static List<RichUserExtSource> extractAdditionalUserExtSources(PerunSession sess, Map<String, String> subjectFromExtSource) {\n+\t\tList<RichUserExtSource> additionalUserExtSources = new ArrayList<>();\n \t\tfor (String attrName : subjectFromExtSource.keySet()) {\n \t\t\tif(attrName != null &&\n \t\t\t\tsubjectFromExtSource.get(attrName) != null &&\n \t\t\t\tattrName.startsWith(ExtSourcesManagerImpl.USEREXTSOURCEMAPPING)) {\n \t\t\t\tString login = subjectFromExtSource.get(\"login\");\n \n-\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\"); // Entry contains extSourceName|extSourceType|extLogin[|LoA]\n+\t\t\t\t// Entry contains extSourceName|extSourceType|extLogin;uesAttribute=value1,value2[|LoA]\n+\t\t\t\tString[] userExtSourceRaw =  subjectFromExtSource.get(attrName).split(\"\\\\|\");\n \t\t\t\tlog.debug(\"Processing additionalUserExtSource {}\",  subjectFromExtSource.get(attrName));\n \n-\t\t\t\t//Check if the array has at least 3 parts, this is protection against outOfBoundException\n+\t\t\t\t// Check if the array has at least 3 parts, this is protection against outOfBoundException\n \t\t\t\tif(userExtSourceRaw.length < 3) {\n \t\t\t\t\tthrow new InternalErrorException(\"There is a missing mandatory part of additional user extSource value when processing it - '\" + attrName + \"'\");\n \t\t\t\t}\n \n+\t\t\t\t// Parse required parts of additional ues from subject\n \t\t\t\tString additionalExtSourceName = userExtSourceRaw[0];\n \t\t\t\tString additionalExtSourceType = userExtSourceRaw[1];\n-\t\t\t\tString additionalExtLogin = userExtSourceRaw[2];\n-\t\t\t\tint additionalExtLoa = 0;\n-\t\t\t\t// Loa is not mandatory argument\n-\t\t\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n-\t\t\t\t\t} catch (NumberFormatException e) {\n-\t\t\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n-\t\t\t\t\t}\n-\t\t\t\t}\n-\n-\t\t\t\tExtSource additionalExtSource;\n+\t\t\t\tString[] additionalExtLoginAndAttributes = userExtSourceRaw[2].split(\";\");\n+\t\t\t\tString additionalExtLogin = additionalExtLoginAndAttributes[0];\n \n+\t\t\t\t// Check if any of the required part is not null nor it is empty\n \t\t\t\tif (additionalExtSourceName == null || additionalExtSourceName.isEmpty() ||\n \t\t\t\t\tadditionalExtSourceType == null || additionalExtSourceType.isEmpty() ||\n \t\t\t\t\tadditionalExtLogin == null || additionalExtLogin.isEmpty()) {\n \t\t\t\t\tlog.error(\"User with login {} has invalid additional userExtSource defined {}.\", login, userExtSourceRaw);\n \t\t\t\t} else {\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\t// Try to get extSource, with full extSource object (containg ID)\n-\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().getExtSourceByName(sess, additionalExtSourceName);\n-\t\t\t\t\t} catch (ExtSourceNotExistsException e) {\n-\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t// Create new one if not exists\n-\t\t\t\t\t\t\tadditionalExtSource = new ExtSource(additionalExtSourceName, additionalExtSourceType);\n-\t\t\t\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().createExtSource(sess, additionalExtSource, null);\n-\t\t\t\t\t\t} catch (ExtSourceExistsException e1) {\n-\t\t\t\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\t// Add additional user extSource\n-\t\t\t\t\tadditionalUserExtSources.add(new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin));\n+\n+\t\t\t\t\t// Get LoA of additional ues (0 if not stated)\n+\t\t\t\t\tint additionalExtLoa = parseAdditionalUESLoa(login, userExtSourceRaw);\n+\n+\t\t\t\t\t// Get additional ues\n+\t\t\t\t\tUserExtSource additionalUserExtSource = parseAdditionalUserExtSource(sess, additionalExtSourceType, additionalExtSourceName, additionalExtLoa, additionalExtLogin);\n+\n+\t\t\t\t\t// Get ues attributes\n+\t\t\t\t\tList<Attribute> uesAttributes = parseUESAttributes(sess, login, additionalExtLoginAndAttributes);\n+\n+\t\t\t\t\t// Create richUserExtSource from ues and its attributes\n+\t\t\t\t\tRichUserExtSource richUserExtSource = new RichUserExtSource(additionalUserExtSource, uesAttributes);\n+\n+\t\t\t\t\t// Add additional rich user extSource\n+\t\t\t\t\tadditionalUserExtSources.add(richUserExtSource);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn additionalUserExtSources;\n \t}\n \n+\t/**\n+\t * Returns loa of addtional ues, if not stated, returns 0.\n+\t * Used in extractAdditionalUserExtSources to get ues LoA.\n+\t *\n+\t * @param login login of subject\n+\t * @param userExtSourceRaw array containing LoA\n+\t * @return int LoA\n+\t */\n+\tprivate static int parseAdditionalUESLoa(String login, String[] userExtSourceRaw) {\n+\t\tint additionalExtLoa = 0;\n+\t\t// Loa is not mandatory argument\n+\t\tif (userExtSourceRaw.length>3 && userExtSourceRaw[3] != null) {\n+\t\t\ttry {\n+\t\t\t\tadditionalExtLoa = Integer.parseInt(userExtSourceRaw[3]);\n+\t\t\t} catch (NumberFormatException e) {\n+\t\t\t\tthrow new ParserException(\"Subject with login [\" + login + \"] has wrong LoA '\" + userExtSourceRaw[3] + \"'.\", e, \"LoA\");\n+\t\t\t}\n+\t\t}\n+\t\treturn additionalExtLoa;\n+\t}\n+\n+\t/**\n+\t * Returns additional user ext source either found already in Perun or new.\n+\t * Used in extractAdditionalUserExtSources to get ues.\n+\t *\n+\t * @param sess perun session\n+\t * @param additionalExtSourceType type of additional ues\n+\t * @param additionalExtSourceName name of additional ues\n+\t * @param additionalExtLoa LoA of additional ues\n+\t * @param additionalExtLogin login of additional ues\n+\t * @return UserExtSource additional ues\n+\t */\n+\tprivate static UserExtSource parseAdditionalUserExtSource(PerunSession sess, String additionalExtSourceType, String additionalExtSourceName, int additionalExtLoa, String additionalExtLogin) {\n+\t\tExtSource additionalExtSource;\n+\t\ttry {\n+\t\t\t// Try to get extSource, with full extSource object (containg ID)\n+\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().getExtSourceByName(sess, additionalExtSourceName);\n+\t\t} catch (ExtSourceNotExistsException e) {\n+\t\t\ttry {\n+\t\t\t\t// Create new one if not exists\n+\t\t\t\tadditionalExtSource = new ExtSource(additionalExtSourceName, additionalExtSourceType);\n+\t\t\t\tadditionalExtSource = ((PerunBl) sess.getPerun()).getExtSourcesManagerBl().createExtSource(sess, additionalExtSource, null);\n+\t\t\t} catch (ExtSourceExistsException e1) {\n+\t\t\t\tthrow new ConsistencyErrorException(\"Creating existing extSource: \" + additionalExtSourceName);\n+\t\t\t}\n+\t\t}\n+\t\treturn new UserExtSource(additionalExtSource, additionalExtLoa, additionalExtLogin);\n+\t}\n+\n+\t/**\n+\t * Parses attributes of additional ues, which are in format: uesAttributeName=value1,value2. These attributes are returned with their values.\n+\t * Used in extractAdditionalUserExtSources to get ues attributes.\n+\t *\n+\t * @param sess perun session\n+\t * @param login login of subject\n+\t * @param additionalExtLoginAndAttribute array containing extLogin and uesAttributes\n+\t * @return List<Attribute> attributes of additional ues\n+\t */\n+\tprivate static List<Attribute> parseUESAttributes(PerunSession sess, String login, String[] additionalExtLoginAndAttribute) {", "originalCommit": "070a86b8b33f08a4fb9cc5f528de18ba529f8726", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\nindex 4672b6c19..90fb03bee 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/Utils.java\n\n@@ -153,7 +153,9 @@ public class Utils {\n \n \t/**\n \t * Returns additionalUserExtSources from the subject. It's used for synchronization from different ExtSources. subjectFromExtSource was obtained from the ExtSource.\n-\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1[|LoA]\n+\t * This additional userExtSource has 3 required parts: name of extSource, type of extSource, login of extsource with optional ues attributes and their values.\n+\t * And 1 optional part: LoA.\n+\t * Expected format of additional userExtSource is: extSourceName|extSourceType|extLogin;uesAttribute1=value1,value2;uesAttribute2=value1|LoA\n \t *\n \t * @param sess perun session\n \t * @param subjectFromExtSource map with the subject\n"}}, {"oid": "3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "url": "https://github.com/CESNET/perun/commit/3e64b4b09e1bedc8cd845e7d9a2473ab81f15044", "message": "Fixes based on review\n\n- changed structure of extractAdditionalUserExtSources and javadoc for even better readability\n- also added more tests", "committedDate": "2020-11-06T11:36:42Z", "type": "commit"}]}