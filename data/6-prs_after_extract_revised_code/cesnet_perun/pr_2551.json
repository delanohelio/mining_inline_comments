{"pr_number": 2551, "pr_title": "Add new method for testing database performance", "pr_createdAt": "2020-01-30T14:29:28Z", "pr_url": "https://github.com/CESNET/perun/pull/2551", "timeline": [{"oid": "a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "url": "https://github.com/CESNET/perun/commit/a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T08:45:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNDAxNw==", "url": "https://github.com/CESNET/perun/pull/2551#discussion_r374014017", "bodyText": "Please change the return type of the method to Long:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tpublic Object call(ApiCaller ac, Deserializer parms) throws PerunException {\n          \n          \n            \n            \t\tpublic Long call(ApiCaller ac, Deserializer parms) throws PerunException {", "author": "martin-kuba", "createdAt": "2020-02-03T10:04:33Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java", "diffHunk": "@@ -50,5 +52,21 @@ public Object call(ApiCaller ac, Deserializer parms) throws PerunException {\n \n \t\t\treturn ac.getDatabaseManager().getDatabaseInformation(ac.getSession());\n \t\t}\n+\t},\n+\n+\t/**\n+\t *\tGet time in ns \"nanoseconds\" of calling 1 simple update query to DB.\n+\t *  This query will update property for this purpose in configurations table.\n+\t *\n+\t * @exampleResponse \"196920\"\n+\t * @return time of processing query in nanoseconds\n+\t */\n+\tgetTimeOfQueryPerformance {\n+\n+\t\t@Override\n+\t\tpublic Object call(ApiCaller ac, Deserializer parms) throws PerunException {", "originalCommit": "a78c0db1f31e01d644e798e7c4c3c6612fbd4463", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDA0NDcwMA==", "url": "https://github.com/CESNET/perun/pull/2551#discussion_r374044700", "bodyText": "Done.", "author": "stavamichal", "createdAt": "2020-02-03T11:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDAxNDAxNw=="}], "type": "inlineReview", "revised_code": {"commit": "fdedae6652b8a7bcac2a27858a29302de4a937fd", "chunk": "diff --git a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java\nindex 9f7a91b50..fa8bec948 100644\n--- a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java\n+++ b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/DatabaseManagerMethod.java\n\n@@ -64,7 +64,7 @@ public enum DatabaseManagerMethod implements ManagerMethod {\n \tgetTimeOfQueryPerformance {\n \n \t\t@Override\n-\t\tpublic Object call(ApiCaller ac, Deserializer parms) throws PerunException {\n+\t\tpublic Long call(ApiCaller ac, Deserializer parms) throws PerunException {\n \n \t\t\treturn ac.getDatabaseManager().getTimeOfQueryPerformance(ac.getSession());\n \t\t}\n"}}, {"oid": "fdedae6652b8a7bcac2a27858a29302de4a937fd", "url": "https://github.com/CESNET/perun/commit/fdedae6652b8a7bcac2a27858a29302de4a937fd", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T11:10:12Z", "type": "commit"}, {"oid": "fdedae6652b8a7bcac2a27858a29302de4a937fd", "url": "https://github.com/CESNET/perun/commit/fdedae6652b8a7bcac2a27858a29302de4a937fd", "message": "Add new method for testing database performance\n\n - new method getTimeOfQueryPerformance in DatabaseManager on all layers\n (RPC, api, bl, blImpl), can be called by anyone with role SELF and it\n will count processing time (in nanoseconds) of update operation (set\n timestamp to database table configurations to predefined property)\n - for this purpose, other methods was created to support this\n funcionality like createProperty (to create a new property in\n configurations table), propertyExists (to check if specific property\n already exists or need to be created)\n - creating of this new property was added to initialization process of\n DatabaseManager (if property doesn't exist, it will be created on start\n of Perun system)\n - method were added also to openapi perun module\n - database schemas were modified to remove existing constraint on\n configurations table to allow any property (not just database version)\n - basic tests of new methods were added\n - database version was increased\n\n IMPORTANT: database need to be changed manually for this commit,\n constraint need to be removed before using properly", "committedDate": "2020-02-03T11:10:12Z", "type": "forcePushed"}]}