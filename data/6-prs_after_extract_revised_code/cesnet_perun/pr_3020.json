{"pr_number": 3020, "pr_title": "Unifying methods for password validation", "pr_createdAt": "2020-12-01T14:49:08Z", "pr_url": "https://github.com/CESNET/perun/pull/3020", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMTcxMA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533501710", "bodyText": "I would create some new testing login namespace instead of using 'einfra' which may not exists.", "author": "stavamichal", "createdAt": "2020-12-01T15:28:39Z", "path": "perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java", "diffHunk": "@@ -792,6 +794,31 @@ public void countUserFacilityQuotas() throws Exception {\n \t\tassertEquals(expectedResult, result);\n \t}\n \n+\t@Test\n+\tpublic void getUserByLoginInNamespace() throws Exception {\n+\t\tSystem.out.println(CLASS_NAME + \"getUserByLoginInNamespace\");\n+\n+\t\t// create user\n+\t\tUser user = new User();\n+\t\tuser.setFirstName(\"Firstname\");\n+\t\tuser.setLastName(\"Lastname\");\n+\t\tuser = perun.getUsersManagerBl().createUser(sess, user);\n+\t\tassertNotNull(user);\n+\n+\t\tUser userByLogin = perun.getModulesUtilsBl().getUserByLoginInNamespace(sess, \"testlogin\", \"einfra\");\n+\t\tassertNull(\"No user should be found.\", userByLogin);\n+\n+\t\t// create login in einfra namespace\n+\t\tString attrName = AttributesManager.NS_USER_ATTR_DEF + \":\" + AttributesManager.LOGIN_NAMESPACE + \":einfra\";", "originalCommit": "84325f16c4e1152c297ee98e55bfd0e355a83928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMzI2OA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533703268", "bodyText": "We have \"dummy\" login namespace / module for the purpose of the tests.", "author": "zlamalp", "createdAt": "2020-12-01T20:33:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMTcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MzY1Mg==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534043652", "bodyText": "Done, I create \"dummy\" login namespace attribute, if it is not already created.", "author": "cuadradek", "createdAt": "2020-12-02T10:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUwMTcxMA=="}], "type": "inlineReview", "revised_code": {"commit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "chunk": "diff --git a/perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java b/perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java\nindex 27de12022..1f6a52473 100644\n--- a/perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java\n+++ b/perun-core/src/test/java/cz/metacentrum/perun/core/entry/ModulesUtilsEntryIntegrationTest.java\n\n@@ -805,17 +805,25 @@ public class ModulesUtilsEntryIntegrationTest extends AbstractPerunIntegrationTe\n \t\tuser = perun.getUsersManagerBl().createUser(sess, user);\n \t\tassertNotNull(user);\n \n-\t\tUser userByLogin = perun.getModulesUtilsBl().getUserByLoginInNamespace(sess, \"testlogin\", \"einfra\");\n+\t\t// create \"dummy\" login namespace\n+\t\tAttributeDefinition attributeDefinition = new AttributeDefinition();\n+\t\tattributeDefinition.setNamespace(AttributesManager.NS_USER_ATTR_DEF);\n+\t\tattributeDefinition.setFriendlyName(AttributesManager.LOGIN_NAMESPACE + \":dummy\");\n+\t\tattributeDefinition.setDisplayName(AttributesManager.LOGIN_NAMESPACE + \":dummy\");\n+\t\tattributeDefinition.setDescription(AttributesManager.LOGIN_NAMESPACE + \":dummy\");\n+\t\tattributeDefinition.setType(String.class.getName());\n+\t\tassertNotNull(perun.getAttributesManager().createAttribute(sess, attributeDefinition));\n+\n+\t\tUser userByLogin = perun.getModulesUtilsBl().getUserByLoginInNamespace(sess, \"testlogin\", \"dummy\");\n \t\tassertNull(\"No user should be found.\", userByLogin);\n \n-\t\t// create login in einfra namespace\n-\t\tString attrName = AttributesManager.NS_USER_ATTR_DEF + \":\" + AttributesManager.LOGIN_NAMESPACE + \":einfra\";\n-\t\tAttribute attribute = perun.getAttributesManager().getAttribute(sess, user, attrName);\n+\t\t// create login in dummy namespace\n+\t\tAttribute attribute = perun.getAttributesManager().getAttribute(sess, user, attributeDefinition.getName());\n \t\tassertNull(attribute.getValue());\n \t\tattribute.setValue(\"testlogin\");\n \t\tperun.getAttributesManager().setAttribute(sess, user, attribute);\n \n-\t\tuserByLogin = perun.getModulesUtilsBl().getUserByLoginInNamespace(sess, \"testlogin\", \"einfra\");\n+\t\tuserByLogin = perun.getModulesUtilsBl().getUserByLoginInNamespace(sess, \"testlogin\", \"dummy\");\n \t\tassertEquals(user, userByLogin);\n \t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0MzE3Mw==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533543173", "bodyText": "I would perform check, that there is a single result and throw ConsistencyErrorException otherwise.", "author": "zlamalp", "createdAt": "2020-12-01T16:20:49Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -1183,6 +1184,18 @@ public User getUserFromMessage(PerunSessionImpl sess, String message) {\n \t\treturn convertedRanges;\n \t}\n \n+\t@Override\n+\tpublic User getUserByLoginInNamespace(PerunSession sess, String login, String namespace) {\n+\t\tString attrName = AttributesManager.NS_USER_ATTR_DEF + \":\" + AttributesManager.LOGIN_NAMESPACE + \":\" + namespace;\n+\t\tList<User> usersByLoginInNamespace = getPerunBl().getUsersManagerBl().getUsersByAttributeValue(sess, attrName, login);\n+\n+\t\tif (usersByLoginInNamespace.isEmpty()) {\n+\t\t\treturn null;\n+\t\t} else {\n+\t\t\treturn usersByLoginInNamespace.get(0);", "originalCommit": "84325f16c4e1152c297ee98e55bfd0e355a83928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MTk2OA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534041968", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-12-02T10:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0MzE3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\nindex ece8d3542..21968c1de 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n\n@@ -1191,9 +1191,9 @@ public class ModulesUtilsBlImpl implements ModulesUtilsBl {\n \n \t\tif (usersByLoginInNamespace.isEmpty()) {\n \t\t\treturn null;\n-\t\t} else {\n+\t\t} else if (usersByLoginInNamespace.size() == 1) {\n \t\t\treturn usersByLoginInNamespace.get(0);\n-\t\t}\n+\t\t} else throw new ConsistencyErrorException(\"There are 2 same logins '\" + login + \"' in namespace \" + namespace + \".\");\n \t}\n \n \t/**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY5MTc0NQ==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533691745", "bodyText": "Since you are extending GenericPasswordManagerModule you should re-define constructor and set proper values to some variables. See EinfraPasswordManagerModule.", "author": "zlamalp", "createdAt": "2020-12-01T20:12:07Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/pwdmgr/EgiuiPasswordManagerModule.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package cz.metacentrum.perun.core.impl.modules.pwdmgr;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.ExtSource;\n+import cz.metacentrum.perun.core.api.PerunSession;\n+import cz.metacentrum.perun.core.api.User;\n+import cz.metacentrum.perun.core.api.UserExtSource;\n+import cz.metacentrum.perun.core.api.exceptions.AttributeNotExistsException;\n+import cz.metacentrum.perun.core.api.exceptions.ExtSourceNotExistsException;\n+import cz.metacentrum.perun.core.api.exceptions.InternalErrorException;\n+import cz.metacentrum.perun.core.api.exceptions.InvalidLoginException;\n+import cz.metacentrum.perun.core.api.exceptions.UserExtSourceExistsException;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeAssignmentException;\n+import cz.metacentrum.perun.core.api.exceptions.WrongAttributeValueException;\n+import cz.metacentrum.perun.core.api.exceptions.WrongReferenceAttributeValueException;\n+import cz.metacentrum.perun.core.bl.PerunBl;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Password manager for EGI-UI login-namespace.\n+ */\n+public class EgiuiPasswordManagerModule extends GenericPasswordManagerModule {", "originalCommit": "84325f16c4e1152c297ee98e55bfd0e355a83928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MjA3MA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534042070", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-12-02T10:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY5MTc0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/pwdmgr/EgiuiPasswordManagerModule.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/pwdmgr/EgiuiPasswordManagerModule.java\nindex 22072d20f..e3171c525 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/pwdmgr/EgiuiPasswordManagerModule.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/pwdmgr/EgiuiPasswordManagerModule.java\n\n@@ -28,8 +28,13 @@ public class EgiuiPasswordManagerModule extends GenericPasswordManagerModule {\n \n \tprivate final static Logger log = LoggerFactory.getLogger(EinfraPasswordManagerModule.class);\n \n+\tpublic EgiuiPasswordManagerModule() {\n+\t\t// set proper namespace\n+\t\tthis.actualLoginNamespace = \"egi-ui\";\n+\t}\n+\n \t@Override\n-\tpublic void validatePassword(PerunSession sess, String userLogin, User user) throws InvalidLoginException, ExtSourceNotExistsException, WrongReferenceAttributeValueException, WrongAttributeValueException {\n+\tpublic void validatePassword(PerunSession sess, String userLogin, User user) throws InvalidLoginException {\n \t\tif (user == null) {\n \t\t\tuser = ((PerunBl) sess.getPerun()).getModulesUtilsBl().getUserByLoginInNamespace(sess, userLogin, actualLoginNamespace);\n \t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMTEzOA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533701138", "bodyText": "Please add some message, so its more like @deprecated see validatePassword()", "author": "zlamalp", "createdAt": "2020-12-01T20:29:15Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/UsersManagerMethod.java", "diffHunk": "@@ -1158,6 +1158,7 @@ public Void call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t * Validates password for a user in specified login-namespace. After that, user should be able to log-in\n \t * in external authz system using his credentials. It also creates UserExtSource and sets some required attributes.\n \t *\n+\t * @deprecated", "originalCommit": "84325f16c4e1152c297ee98e55bfd0e355a83928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MjE2NA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534042164", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-12-02T10:04:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwMTEzOA=="}], "type": "inlineReview", "revised_code": {"commit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "chunk": "diff --git a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/UsersManagerMethod.java b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/UsersManagerMethod.java\nindex 00f1ed569..b14e00f2b 100644\n--- a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/UsersManagerMethod.java\n+++ b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/UsersManagerMethod.java\n\n@@ -1158,7 +1158,7 @@ public enum UsersManagerMethod implements ManagerMethod {\n \t * Validates password for a user in specified login-namespace. After that, user should be able to log-in\n \t * in external authz system using his credentials. It also creates UserExtSource and sets some required attributes.\n \t *\n-\t * @deprecated\n+\t * @deprecated use validatePassword\n \t * @param user int User <code>id</code>\n \t * @param login String Login\n \t * @param namespace String Namespace\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDc1OA==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r533704758", "bodyText": "I would prefer covering those new exceptions in InternalErrorException as did the original method validatePasswordAndSetExtSources(), since they are not relevant to the caller and are expected to never happen in correctly configured instance. Please update the modules and method hierarchy accordingly. Thank you.", "author": "zlamalp", "createdAt": "2020-12-01T20:35:46Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/implApi/modules/pwdmgr/PasswordManagerModule.java", "diffHunk": "@@ -40,7 +43,7 @@\n \n \tvoid changePassword(PerunSession sess, String userLogin, String newPassword) throws InvalidLoginException, PasswordStrengthException;\n \n-\tvoid validatePassword(PerunSession sess, String userLogin) throws InvalidLoginException;\n+\tvoid validatePassword(PerunSession sess, String userLogin, User user) throws InvalidLoginException, ExtSourceNotExistsException, WrongReferenceAttributeValueException, WrongAttributeValueException;", "originalCommit": "84325f16c4e1152c297ee98e55bfd0e355a83928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0MjM3OQ==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534042379", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-12-02T10:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDc1OA=="}], "type": "inlineReview", "revised_code": {"commit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/implApi/modules/pwdmgr/PasswordManagerModule.java b/perun-core/src/main/java/cz/metacentrum/perun/core/implApi/modules/pwdmgr/PasswordManagerModule.java\nindex dcb2400fc..611148f21 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/implApi/modules/pwdmgr/PasswordManagerModule.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/implApi/modules/pwdmgr/PasswordManagerModule.java\n\n@@ -43,7 +43,7 @@ public interface PasswordManagerModule {\n \n \tvoid changePassword(PerunSession sess, String userLogin, String newPassword) throws InvalidLoginException, PasswordStrengthException;\n \n-\tvoid validatePassword(PerunSession sess, String userLogin, User user) throws InvalidLoginException, ExtSourceNotExistsException, WrongReferenceAttributeValueException, WrongAttributeValueException;\n+\tvoid validatePassword(PerunSession sess, String userLogin, User user) throws InvalidLoginException;\n \n \tvoid deletePassword(PerunSession sess, String userLogin) throws InvalidLoginException;\n \n"}}, {"oid": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "url": "https://github.com/CESNET/perun/commit/a37335e772c73b92a59c0503ec6f8b49d20f8a59", "message": "Unifying methods for password validation\n\n- There were 2 core methods for password validation - validatePassword() and\nvalidatePasswordAndSetExtSources().\n- Method validatePasswordAndSetExtSources() was removed from UsersManager, in RPC\nit is now marked as deprecated and calls validatePassword().\n- Creation of UserExtSources and related attributes was moved to password managers\nmodules.\n- Deleted method was used in Registrar, so it was replaced by validatePassword().\nThe deprecated RPC method was only used in old GUI (and wasn't used in WUI, new\nGUI and OpenAPI), where it was replaced by RPC method validatePassword.", "committedDate": "2020-12-02T10:02:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0NTA1Ng==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534045056", "bodyText": "It is 2 or more (size could be bigger than 2).", "author": "stavamichal", "createdAt": "2020-12-02T10:09:06Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -1183,6 +1184,18 @@ public User getUserFromMessage(PerunSessionImpl sess, String message) {\n \t\treturn convertedRanges;\n \t}\n \n+\t@Override\n+\tpublic User getUserByLoginInNamespace(PerunSession sess, String login, String namespace) {\n+\t\tString attrName = AttributesManager.NS_USER_ATTR_DEF + \":\" + AttributesManager.LOGIN_NAMESPACE + \":\" + namespace;\n+\t\tList<User> usersByLoginInNamespace = getPerunBl().getUsersManagerBl().getUsersByAttributeValue(sess, attrName, login);\n+\n+\t\tif (usersByLoginInNamespace.isEmpty()) {\n+\t\t\treturn null;\n+\t\t} else if (usersByLoginInNamespace.size() == 1) {\n+\t\t\treturn usersByLoginInNamespace.get(0);\n+\t\t} else throw new ConsistencyErrorException(\"There are 2 same logins '\" + login + \"' in namespace \" + namespace + \".\");", "originalCommit": "a37335e772c73b92a59c0503ec6f8b49d20f8a59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA4MjkzOQ==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534082939", "bodyText": "Fixed", "author": "cuadradek", "createdAt": "2020-12-02T11:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA0NTA1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "657aa2eef2b52fb1f94f5497d4441e202adf073f", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\nindex 21968c1de..cdc2a5784 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n\n@@ -1193,7 +1193,7 @@ public class ModulesUtilsBlImpl implements ModulesUtilsBl {\n \t\t\treturn null;\n \t\t} else if (usersByLoginInNamespace.size() == 1) {\n \t\t\treturn usersByLoginInNamespace.get(0);\n-\t\t} else throw new ConsistencyErrorException(\"There are 2 same logins '\" + login + \"' in namespace \" + namespace + \".\");\n+\t\t} else throw new ConsistencyErrorException(\"There is more than 1 login '\" + login + \"' in namespace \" + namespace + \".\");\n \t}\n \n \t/**\n"}}, {"oid": "657aa2eef2b52fb1f94f5497d4441e202adf073f", "url": "https://github.com/CESNET/perun/commit/657aa2eef2b52fb1f94f5497d4441e202adf073f", "message": "Unifying methods for password validation\n\n- There were 2 core methods for password validation - validatePassword() and\nvalidatePasswordAndSetExtSources().\n- Method validatePasswordAndSetExtSources() was removed from UsersManager, in RPC\nit is now marked as deprecated and calls validatePassword().\n- Creation of UserExtSources and related attributes was moved to password managers\nmodules.\n- Deleted method was used in Registrar, so it was replaced by validatePassword().\nThe deprecated RPC method was only used in old GUI (and wasn't used in WUI, new\nGUI and OpenAPI), where it was replaced by RPC method validatePassword.", "committedDate": "2020-12-02T11:05:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA5ODgzNg==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534098836", "bodyText": "Can you please put it between curly brackets, like: } else { throw .... }. Thank you.", "author": "zlamalp", "createdAt": "2020-12-02T11:34:36Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -1183,6 +1184,18 @@ public User getUserFromMessage(PerunSessionImpl sess, String message) {\n \t\treturn convertedRanges;\n \t}\n \n+\t@Override\n+\tpublic User getUserByLoginInNamespace(PerunSession sess, String login, String namespace) {\n+\t\tString attrName = AttributesManager.NS_USER_ATTR_DEF + \":\" + AttributesManager.LOGIN_NAMESPACE + \":\" + namespace;\n+\t\tList<User> usersByLoginInNamespace = getPerunBl().getUsersManagerBl().getUsersByAttributeValue(sess, attrName, login);\n+\n+\t\tif (usersByLoginInNamespace.isEmpty()) {\n+\t\t\treturn null;\n+\t\t} else if (usersByLoginInNamespace.size() == 1) {\n+\t\t\treturn usersByLoginInNamespace.get(0);\n+\t\t} else throw new ConsistencyErrorException(\"There is more than 1 login '\" + login + \"' in namespace \" + namespace + \".\");", "originalCommit": "657aa2eef2b52fb1f94f5497d4441e202adf073f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEwODc3MQ==", "url": "https://github.com/CESNET/perun/pull/3020#discussion_r534108771", "bodyText": "Done", "author": "cuadradek", "createdAt": "2020-12-02T11:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDA5ODgzNg=="}], "type": "inlineReview", "revised_code": {"commit": "1f541c98f5b0ba9f04a1bd8c3455e853077629d1", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\nindex cdc2a5784..f2e7e4030 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java\n\n@@ -1193,7 +1193,9 @@ public class ModulesUtilsBlImpl implements ModulesUtilsBl {\n \t\t\treturn null;\n \t\t} else if (usersByLoginInNamespace.size() == 1) {\n \t\t\treturn usersByLoginInNamespace.get(0);\n-\t\t} else throw new ConsistencyErrorException(\"There is more than 1 login '\" + login + \"' in namespace \" + namespace + \".\");\n+\t\t} else {\n+\t\t\tthrow new ConsistencyErrorException(\"There is more than 1 login '\" + login + \"' in namespace \" + namespace + \".\");\n+\t\t}\n \t}\n \n \t/**\n"}}, {"oid": "1f541c98f5b0ba9f04a1bd8c3455e853077629d1", "url": "https://github.com/CESNET/perun/commit/1f541c98f5b0ba9f04a1bd8c3455e853077629d1", "message": "Unifying methods for password validation\n\n- There were 2 core methods for password validation - validatePassword() and\nvalidatePasswordAndSetExtSources().\n- Method validatePasswordAndSetExtSources() was removed from UsersManager, in RPC\nit is now marked as deprecated and calls validatePassword().\n- Creation of UserExtSources and related attributes was moved to password managers\nmodules.\n- Deleted method was used in Registrar, so it was replaced by validatePassword().\nThe deprecated RPC method was only used in old GUI (and wasn't used in WUI, new\nGUI and OpenAPI), where it was replaced by RPC method validatePassword.", "committedDate": "2020-12-02T11:51:33Z", "type": "commit"}, {"oid": "1f541c98f5b0ba9f04a1bd8c3455e853077629d1", "url": "https://github.com/CESNET/perun/commit/1f541c98f5b0ba9f04a1bd8c3455e853077629d1", "message": "Unifying methods for password validation\n\n- There were 2 core methods for password validation - validatePassword() and\nvalidatePasswordAndSetExtSources().\n- Method validatePasswordAndSetExtSources() was removed from UsersManager, in RPC\nit is now marked as deprecated and calls validatePassword().\n- Creation of UserExtSources and related attributes was moved to password managers\nmodules.\n- Deleted method was used in Registrar, so it was replaced by validatePassword().\nThe deprecated RPC method was only used in old GUI (and wasn't used in WUI, new\nGUI and OpenAPI), where it was replaced by RPC method validatePassword.", "committedDate": "2020-12-02T11:51:33Z", "type": "forcePushed"}]}