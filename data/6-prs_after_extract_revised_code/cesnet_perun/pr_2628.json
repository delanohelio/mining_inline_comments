{"pr_number": 2628, "pr_title": "getUserExtSourceFromMultipleIdentifiers null", "pr_createdAt": "2020-03-18T10:58:25Z", "pr_url": "https://github.com/CESNET/perun/pull/2628", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI4NA==", "url": "https://github.com/CESNET/perun/pull/2628#discussion_r394265284", "bodyText": "Are you sure this is not rather a configuration error? That would mean using InternalErrorException.", "author": "licehammer", "createdAt": "2020-03-18T11:04:44Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java", "diffHunk": "@@ -706,10 +706,10 @@ private UserExtSource getUserExtSourceByUniqueAttributeValue(PerunSession sess,\n \t}\n \n \t@Override\n-\tpublic UserExtSource getUserExtSourceFromMultipleIdentifiers(PerunSession sess, PerunPrincipal principal) throws InternalErrorException, UserExtSourceNotExistsException {\n+\tpublic UserExtSource getUserExtSourceFromMultipleIdentifiers(PerunSession sess, PerunPrincipal principal) throws InternalErrorException, UserExtSourceNotExistsException, WrongReferenceAttributeValueException {\n \t\tString additionalIdentifiers = principal.getAdditionalInformations().get(additionalIdentifiersAttributeName);\n \t\tif (additionalIdentifiers == null) {\n-\t\t\tthrow new UserExtSourceNotExistsException(\"Mandatory attribute is not defined: \".concat(additionalIdentifiersAttributeName));\n+\t\t\tthrow new WrongReferenceAttributeValueException(\"Principal's mandatory attribute is not defined: \".concat(additionalIdentifiersAttributeName));", "originalCommit": "d619d702f10a39079b72aab58f5127c19f2acca2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMwMjk2OA==", "url": "https://github.com/CESNET/perun/pull/2628#discussion_r394302968", "bodyText": "InternalErrorException would be definitely better here. This is probably not attribute as we are using it in Perun. It is more like missing information.", "author": "stavamichal", "createdAt": "2020-03-18T12:17:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMwNjQxMA==", "url": "https://github.com/CESNET/perun/pull/2628#discussion_r394306410", "bodyText": "Changed to InternalErrorexception.", "author": "balcirakpeter", "createdAt": "2020-03-18T12:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg3NDMyOA==", "url": "https://github.com/CESNET/perun/pull/2628#discussion_r394874328", "bodyText": "What about reworking the exception message as well? I will probablly have hard time to figure out that I have to change the config file after I will find this message in logs.", "author": "licehammer", "createdAt": "2020-03-19T08:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTAxODQ5Nw==", "url": "https://github.com/CESNET/perun/pull/2628#discussion_r395018497", "bodyText": "Done", "author": "balcirakpeter", "createdAt": "2020-03-19T13:20:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI2NTI4NA=="}], "type": "inlineReview", "revised_code": {"commit": "301b914bfd32180399fdf1da612f635158c98901", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java\nindex b20ff1f05..8559bf3ab 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java\n\n@@ -706,10 +706,10 @@ public class UsersManagerBlImpl implements UsersManagerBl {\n \t}\n \n \t@Override\n-\tpublic UserExtSource getUserExtSourceFromMultipleIdentifiers(PerunSession sess, PerunPrincipal principal) throws InternalErrorException, UserExtSourceNotExistsException, WrongReferenceAttributeValueException {\n+\tpublic UserExtSource getUserExtSourceFromMultipleIdentifiers(PerunSession sess, PerunPrincipal principal) throws InternalErrorException, UserExtSourceNotExistsException {\n \t\tString additionalIdentifiers = principal.getAdditionalInformations().get(additionalIdentifiersAttributeName);\n \t\tif (additionalIdentifiers == null) {\n-\t\t\tthrow new WrongReferenceAttributeValueException(\"Principal's mandatory attribute is not defined: \".concat(additionalIdentifiersAttributeName));\n+\t\t\tthrow new InternalErrorException(\"Principal's mandatory attribute is not defined: \".concat(additionalIdentifiersAttributeName));\n \t\t}\n \t\tUserExtSource ues = null;\n \t\tfor(String identifier : additionalIdentifiers.split(multivalueAttributeSeparatorRegExp)) {\n"}}, {"oid": "301b914bfd32180399fdf1da612f635158c98901", "url": "https://github.com/CESNET/perun/commit/301b914bfd32180399fdf1da612f635158c98901", "message": "getUserExtSourceFromMultipleIdentifiers null\n\n- Previous implementation of the method returned null\n  when the UserExtSource was not found. That caused NullPointerException\n  later in the method getUserByUserExtSource which was called by the method\n  getPerunSession.\n- Therefore, the method getUserExtSourceFromMultipleIdentifiers was changed\n  to throw the UserExtSourceNotExistException when the UserExtSource was not found.\n- In this method was also check for null additionalIdentifiers, which was throwing\n  the UserExtSourceNotExistsException. This exception was replaced by the\n  InternalerrorException.", "committedDate": "2020-03-18T12:22:03Z", "type": "forcePushed"}, {"oid": "a8cb5fc118906793af7ff698d98f61ecc14eed3d", "url": "https://github.com/CESNET/perun/commit/a8cb5fc118906793af7ff698d98f61ecc14eed3d", "message": "getUserExtSourceFromMultipleIdentifiers null\n\n- Previous implementation of the method returned null\n  when the UserExtSource was not found. That caused NullPointerException\n  later in the method getUserByUserExtSource which was called by the method\n  getPerunSession.\n- Therefore, the method getUserExtSourceFromMultipleIdentifiers was changed\n  to throw the UserExtSourceNotExistException when the UserExtSource was not found.\n- In this method was also check for null additionalIdentifiers, which was throwing\n  the UserExtSourceNotExistsException. This exception was replaced by the\n  InternalerrorException.", "committedDate": "2020-03-19T13:09:13Z", "type": "commit"}, {"oid": "a8cb5fc118906793af7ff698d98f61ecc14eed3d", "url": "https://github.com/CESNET/perun/commit/a8cb5fc118906793af7ff698d98f61ecc14eed3d", "message": "getUserExtSourceFromMultipleIdentifiers null\n\n- Previous implementation of the method returned null\n  when the UserExtSource was not found. That caused NullPointerException\n  later in the method getUserByUserExtSource which was called by the method\n  getPerunSession.\n- Therefore, the method getUserExtSourceFromMultipleIdentifiers was changed\n  to throw the UserExtSourceNotExistException when the UserExtSource was not found.\n- In this method was also check for null additionalIdentifiers, which was throwing\n  the UserExtSourceNotExistsException. This exception was replaced by the\n  InternalerrorException.", "committedDate": "2020-03-19T13:09:13Z", "type": "forcePushed"}]}