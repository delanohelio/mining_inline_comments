{"pr_number": 2675, "pr_title": "CORE: Fix allowed resource recognition, assignGroup optimization", "pr_createdAt": "2020-04-24T12:15:25Z", "pr_url": "https://github.com/CESNET/perun/pull/2675", "timeline": [{"oid": "3f4063add5c8906867b3596b10bfecf29c8bbb63", "url": "https://github.com/CESNET/perun/commit/3f4063add5c8906867b3596b10bfecf29c8bbb63", "message": "CORE: Fixed wrong member status in getAllowedResources(facility,user)\n\n- If user is disabled, we shouldn't return such resources as allowed.\n  Previously it returned also disabled members, since only invalid\n  status was excluded.", "committedDate": "2020-04-24T12:13:46Z", "type": "commit"}, {"oid": "0191dbef3a96fa8f16e04a148063ee6ad94347f1", "url": "https://github.com/CESNET/perun/commit/0191dbef3a96fa8f16e04a148063ee6ad94347f1", "message": "CORE: Throw exception if module for virt attribute doesn't exists\n\n- We silently returned null instead of ModuleNotExistsException for\n  following attribute types: member_group, member_resource, group_resource.\n  Now implementation is aligned for all attribute types.", "committedDate": "2020-04-24T13:30:39Z", "type": "commit"}, {"oid": "db9fcc893fcbe2243ef889a5c499933fbf26e803", "url": "https://github.com/CESNET/perun/commit/db9fcc893fcbe2243ef889a5c499933fbf26e803", "message": "CORE: Optimized performance in group assigning\n\n- Set group and group_resource required attributes together.\n- We now set required attributes only to the valid, expired\n  and suspended group members (same as assign service does).\n- Optimized isTrulyRequired(user,facility), now we resolve\n  allowed resources and check required attributes on them.\n  For true it previously double checked allowed facilities,\n  assigned and allowed resources.\n- Fixed getAllowedResources(member) which previously returned\n  also resources, where member was disabled. Now its aligned\n  with recently fixed getAllowedResources(user,facility).", "committedDate": "2020-04-24T13:36:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM1ODM4NA==", "url": "https://github.com/CESNET/perun/pull/2675#discussion_r419358384", "bodyText": "I just would like to ask, why is this change made only to these three methods and not to all of them? This way, the module accessing methods behave differently for different combinations of entities.", "author": "Vojtech-Sassmann", "createdAt": "2020-05-04T11:02:36Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/AttributesManagerImpl.java", "diffHunk": "@@ -5097,7 +5097,8 @@ private UserExtSourceAttributesModuleImplApi getUserExtSourceAttributeModule(Per\n \t */\n \tGroupResourceVirtualAttributesModuleImplApi getResourceGroupVirtualAttributeModule(PerunSession sess, AttributeDefinition attribute) throws InternalErrorException {\n \t\tObject attributeModule = getAttributesModule(sess, attribute);\n-\t\tif (attributeModule == null) return null;\n+\t\tif (attributeModule == null)\n+\t\t\tthrow new ModuleNotExistsException(\"Virtual attribute module for \" + attribute + \" doesn't exists.\");", "originalCommit": "db9fcc893fcbe2243ef889a5c499933fbf26e803", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM3MDgxOQ==", "url": "https://github.com/CESNET/perun/pull/2675#discussion_r419370819", "bodyText": "Module is \"required\" only for virtual attributes, since it implements getAttributeValue() to actually compute the value. Other getters for virtual attribute modules were already correct, so this commit fixes implementation to be consistent for all virtual attributes.", "author": "zlamalp", "createdAt": "2020-05-04T11:30:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM1ODM4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQwODk1Mw==", "url": "https://github.com/CESNET/perun/pull/2675#discussion_r419408953", "bodyText": "I see, thanks for the explanation.", "author": "Vojtech-Sassmann", "createdAt": "2020-05-04T12:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM1ODM4NA=="}], "type": "inlineReview", "revised_code": null}]}