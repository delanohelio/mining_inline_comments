{"pr_number": 3026, "pr_title": "Core - extension of hashed data", "pr_createdAt": "2020-12-08T12:24:44Z", "pr_url": "https://github.com/CESNET/perun/pull/3026", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM5NzM4MA==", "url": "https://github.com/CESNET/perun/pull/3026#discussion_r538397380", "bodyText": "There is no need for this \"weird\" variable here. Probably debugging context?", "author": "stavamichal", "createdAt": "2020-12-08T13:55:02Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GenDataProviderImpl.java", "diffHunk": "@@ -172,7 +176,8 @@ public void loadResourceAttributes(Resource resource, List<Member> members, bool\n \t\t\t// create incomplete vo object with only vo id\n \t\t\tVo vo = new Vo();\n \t\t\tvo.setId(resource.getVoId());\n-\t\t\thashes.addAll(getVoAttributesHashes(vo));\n+\t\t\tvar huha = getVoAttributesHashes(vo);\n+\t\t\thashes.addAll(huha);", "originalCommit": "46a79d2b24456a1c110d29fbf5afc7df98a84feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "baf49f2c81479835ff9f642e19678e6e9f51ab96", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GenDataProviderImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GenDataProviderImpl.java\nindex 0ad5b3762..0b1e2ba4a 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GenDataProviderImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/provisioning/GenDataProviderImpl.java\n\n@@ -176,8 +176,7 @@ public class GenDataProviderImpl implements GenDataProvider {\n \t\t\t// create incomplete vo object with only vo id\n \t\t\tVo vo = new Vo();\n \t\t\tvo.setId(resource.getVoId());\n-\t\t\tvar huha = getVoAttributesHashes(vo);\n-\t\t\thashes.addAll(huha);\n+\t\t\thashes.addAll(getVoAttributesHashes(vo));\n \t\t}\n \n \t\treturn hashes;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwMzE1OA==", "url": "https://github.com/CESNET/perun/pull/3026#discussion_r538403158", "bodyText": "You probably want this outside of \"pre\".", "author": "stavamichal", "createdAt": "2020-12-08T13:59:53Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java", "diffHunk": "@@ -741,6 +745,7 @@ public HashedGenData call(ApiCaller ac, Deserializer parms) throws PerunExceptio\n \t +------User\n \t |        +-------Attrs (do NOT return member, member-resource attributes)\n \t +...\n+\t * @deprecated - use getHashedHierarchicalData", "originalCommit": "46a79d2b24456a1c110d29fbf5afc7df98a84feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "baf49f2c81479835ff9f642e19678e6e9f51ab96", "chunk": "diff --git a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\nindex 382679870..0bc930005 100644\n--- a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n+++ b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n\n@@ -745,7 +746,6 @@ public enum ServicesManagerMethod implements ManagerMethod {\n \t +------User\n \t |        +-------Attrs (do NOT return member, member-resource attributes)\n \t +...\n-\t * @deprecated - use getHashedHierarchicalData\n \t </pre>\n \n \t *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQwNDY0OA==", "url": "https://github.com/CESNET/perun/pull/3026#discussion_r538404648", "bodyText": "There is a bad indentation somewhere.", "author": "stavamichal", "createdAt": "2020-12-08T14:01:27Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java", "diffHunk": "@@ -1107,6 +1112,7 @@ public ServiceAttributes call(ApiCaller ac, Deserializer parms) throws PerunExce\n \t        |             |                      +...\n \t        +-----Vo ....\n \t</pre>\n+\t* @deprecated - use getHashedDataWithGroups\n \t */", "originalCommit": "46a79d2b24456a1c110d29fbf5afc7df98a84feb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "baf49f2c81479835ff9f642e19678e6e9f51ab96", "chunk": "diff --git a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\nindex 382679870..0bc930005 100644\n--- a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n+++ b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n\n@@ -1112,7 +1112,7 @@ public enum ServicesManagerMethod implements ManagerMethod {\n \t        |             |                      +...\n \t        +-----Vo ....\n \t</pre>\n-\t* @deprecated - use getHashedDataWithGroups\n+\t * @deprecated - use getHashedDataWithGroups\n \t */\n \tgetDataWithVos {\n \t\t@Override\n"}}, {"oid": "baf49f2c81479835ff9f642e19678e6e9f51ab96", "url": "https://github.com/CESNET/perun/commit/baf49f2c81479835ff9f642e19678e6e9f51ab96", "message": "Core - extension of hashed data\n\n* Some services couldn't be rewritten to use the new hashedData method\nbecause they were using getDataWithVos or getFlatData. We have figured\nout that we don't actually need to create new \"hashed\" version of these\nmethods. Insteady, we can reuse the already existing methods with some\nminor modifications.\n* The methods getHashedHierarchicalData and getHashedDataWithGroups now\nalso contains vo id in resource nodes and can return vo attributes.\n* In the data provider class, there were some missuses of the emptyList\nand singletonList methods that caused trouble, because they are\nimmutable.\n* The old getData methods were annotated as deprecated in the API.", "committedDate": "2020-12-08T14:30:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczMDQxNg==", "url": "https://github.com/CESNET/perun/pull/3026#discussion_r538730416", "bodyText": "I'm not sure if our docs parser won't go crazy about it, since it already skips all that <pre> part above and doesn\u1e97 handle more lines of param description.\nAlso it shows deprecation message on hover, so it will be like - use getHashedHierarchicalData. I would suggest to to remove leading dash.", "author": "zlamalp", "createdAt": "2020-12-08T19:04:12Z", "path": "perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java", "diffHunk": "@@ -479,7 +479,7 @@ public Service call(ApiCaller ac, Deserializer parms) throws PerunException {\n \t |        +-------Attrs\n \t +...\n \t </pre>\n-\t *\n+\t * @deprecated - use getHashedHierarchicalData", "originalCommit": "baf49f2c81479835ff9f642e19678e6e9f51ab96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExOTU4Mg==", "url": "https://github.com/CESNET/perun/pull/3026#discussion_r539119582", "bodyText": "Fixed.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-09T08:53:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODczMDQxNg=="}], "type": "inlineReview", "revised_code": {"commit": "79cf59e728ea57ea953456a873ef651fef006c04", "chunk": "diff --git a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\nindex 0bc930005..34050cb3c 100644\n--- a/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n+++ b/perun-rpc/src/main/java/cz/metacentrum/perun/rpc/methods/ServicesManagerMethod.java\n\n@@ -479,11 +480,11 @@ public enum ServicesManagerMethod implements ManagerMethod {\n \t |        +-------Attrs\n \t +...\n \t </pre>\n-\t * @deprecated - use getHashedHierarchicalData\n \t */\n \t/*#\n \t * Generates the list of attributes per each member associated with the resource.\n \t *\n+\t * @deprecated use getHashedDataWithGroups\n \t * @param service int Service <code>id</code>\n \t * @param facility int Facility <code>id</code>. You will get attributes for this facility, resources associated with it and members assigned to the resources.\n \t * @return List<ServiceAttributes> Attributes in special structure. Facility is in the root, facility children are resources. And resource children are members.\n"}}, {"oid": "79cf59e728ea57ea953456a873ef651fef006c04", "url": "https://github.com/CESNET/perun/commit/79cf59e728ea57ea953456a873ef651fef006c04", "message": "Core - extension of hashed data\n\n* Some services couldn't be rewritten to use the new hashedData method\nbecause they were using getDataWithVos or getFlatData. We have figured\nout that we don't actually need to create new \"hashed\" version of these\nmethods. Insteady, we can reuse the already existing methods with some\nminor modifications.\n* The methods getHashedHierarchicalData and getHashedDataWithGroups now\nalso contains vo id in resource nodes and can return vo attributes.\n* In the data provider class, there were some missuses of the emptyList\nand singletonList methods that caused trouble, because they are\nimmutable.\n* The old getData methods were annotated as deprecated in the API.", "committedDate": "2020-12-09T08:52:42Z", "type": "commit"}, {"oid": "79cf59e728ea57ea953456a873ef651fef006c04", "url": "https://github.com/CESNET/perun/commit/79cf59e728ea57ea953456a873ef651fef006c04", "message": "Core - extension of hashed data\n\n* Some services couldn't be rewritten to use the new hashedData method\nbecause they were using getDataWithVos or getFlatData. We have figured\nout that we don't actually need to create new \"hashed\" version of these\nmethods. Insteady, we can reuse the already existing methods with some\nminor modifications.\n* The methods getHashedHierarchicalData and getHashedDataWithGroups now\nalso contains vo id in resource nodes and can return vo attributes.\n* In the data provider class, there were some missuses of the emptyList\nand singletonList methods that caused trouble, because they are\nimmutable.\n* The old getData methods were annotated as deprecated in the API.", "committedDate": "2020-12-09T08:52:42Z", "type": "forcePushed"}]}