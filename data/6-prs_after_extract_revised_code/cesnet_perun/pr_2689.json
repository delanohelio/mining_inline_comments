{"pr_number": 2689, "pr_title": "CORE: Fixed getAssignedServices(resource)", "pr_createdAt": "2020-05-08T17:11:30Z", "pr_url": "https://github.com/CESNET/perun/pull/2689", "timeline": [{"oid": "1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "url": "https://github.com/CESNET/perun/commit/1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "message": "CORE: Fixed getAssignedServices(resource)\n\n- It previously retrieved service IDs and then asked\n  for each service by ID in the BL. Now we retrieve\n  list of services directly in DAO layer.", "committedDate": "2020-05-08T17:10:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422834435", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id and resource_services.resource_id=?\",\n          \n          \n            \n            \t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id where resource_services.resource_id=?\",\n          \n      \n    \n    \n  \n\nI just wanted to ask, if there is a reason to use the condition in the join like you do, instead of writing WHERE?", "author": "Vojtech-Sassmann", "createdAt": "2020-05-11T07:23:43Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ResourcesManagerImpl.java", "diffHunk": "@@ -560,9 +560,11 @@ public boolean isGroupAssigned(PerunSession sess, Group group, Resource resource\n \t}\n \n \t@Override\n-\tpublic List<Integer> getAssignedServices(PerunSession sess, Resource resource) throws InternalErrorException {\n+\tpublic List<Service> getAssignedServices(PerunSession sess, Resource resource) throws InternalErrorException {\n \t\ttry {\n-\t\t\treturn jdbc.query(\"select service_id as id from resource_services where resource_id=?\", Utils.ID_MAPPER, resource.getId());\n+\t\t\treturn jdbc.query(\"select \"+ ServicesManagerImpl.serviceMappingSelectQuery +\n+\t\t\t\t\t\" from services join resource_services on services.id=resource_services.service_id and resource_services.resource_id=?\",", "originalCommit": "1760ce3b70fe41fe7561025ef9fa1d90ae33cb56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzODc1NQ==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422838755", "bodyText": "Joined table can be constrained before actual joining. When you use condition in where, then whole tables are joined first and then invalid data is discarded. For our numbers of records within tables it doesn't really matter + clever sql planners can optimize it even if it`s in a where clause.", "author": "zlamalp", "createdAt": "2020-05-11T07:31:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzOTcxMg==", "url": "https://github.com/CESNET/perun/pull/2689#discussion_r422839712", "bodyText": "Ok, I thought it might be something like that. Thanks.", "author": "Vojtech-Sassmann", "createdAt": "2020-05-11T07:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjgzNDQzNQ=="}], "type": "inlineReview", "revised_code": null}]}