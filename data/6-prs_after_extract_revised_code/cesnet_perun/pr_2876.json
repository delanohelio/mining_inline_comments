{"pr_number": 2876, "pr_title": "Added getUsersSubjects to ExtSources", "pr_createdAt": "2020-08-31T20:01:42Z", "pr_url": "https://github.com/CESNET/perun/pull/2876", "timeline": [{"oid": "8f2368c39c2d7d730d879c43d05f17450b97dad9", "url": "https://github.com/CESNET/perun/commit/8f2368c39c2d7d730d879c43d05f17450b97dad9", "message": "Added getUsersSubjects to ExtSources\n\n- method getUsersSubjects is now implemented everywhere where getGroupSubjects is\n- query used by this method should be defined in perun-extSources.xml\n- method to get http connection separated to protected method for better testing in ExtSourceISMU, also some other methods accessibility changed to protected to be mocked in tests\n- also added tests for this method", "committedDate": "2020-08-31T19:56:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwMDEyNw==", "url": "https://github.com/CESNET/perun/pull/2876#discussion_r482000127", "bodyText": "Please add check if the getGroupsFromRemote() is not null or edit that method so it cannot return a null but empty list instead (if it is possible).", "author": "balcirakpeter", "createdAt": "2020-09-02T11:33:37Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java", "diffHunk": "@@ -159,8 +159,19 @@ public static PerunBlImpl setPerunBlImpl(PerunBlImpl perun) {\n     }\n \n \t@Override\n-\tpublic List<Map<String, String>> getUsersSubjects() throws ExtSourceUnsupportedOperationException {\n-\t\tthrow new ExtSourceUnsupportedOperationException();\n+\tpublic List<Map<String, String>> getUsersSubjects() {\n+\t\tquery = getAttributes().get(\"usersQuery\");\n+\n+\t\tprepareEnvironment();\n+\n+\t\ttry {\n+\t\t\treturn getUsersFromRemote(getGroupsFromRemote(), 0);", "originalCommit": "8f2368c39c2d7d730d879c43d05f17450b97dad9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4NzAyMw==", "url": "https://github.com/CESNET/perun/pull/2876#discussion_r483087023", "bodyText": "Ok, the method returns empty list now.", "author": "metodej", "createdAt": "2020-09-03T15:58:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwMDEyNw=="}], "type": "inlineReview", "revised_code": {"commit": "f48dec598456abf67d695710e359fbe946d516f1", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\nindex 7b84a29a4..c7260fafc 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\n\n@@ -160,7 +161,7 @@ public class ExtSourceVOOT extends ExtSource implements ExtSourceApi {\n \n \t@Override\n \tpublic List<Map<String, String>> getUsersSubjects() {\n-\t\tquery = getAttributes().get(\"usersQuery\");\n+\t\tquery = getAttributes().get(UsersManager.USERS_QUERY);\n \n \t\tprepareEnvironment();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwMDUwNg==", "url": "https://github.com/CESNET/perun/pull/2876#discussion_r482000506", "bodyText": "Consider creating a constant for \"usersQuery\".", "author": "balcirakpeter", "createdAt": "2020-09-02T11:34:11Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java", "diffHunk": "@@ -159,8 +159,19 @@ public static PerunBlImpl setPerunBlImpl(PerunBlImpl perun) {\n     }\n \n \t@Override\n-\tpublic List<Map<String, String>> getUsersSubjects() throws ExtSourceUnsupportedOperationException {\n-\t\tthrow new ExtSourceUnsupportedOperationException();\n+\tpublic List<Map<String, String>> getUsersSubjects() {\n+\t\tquery = getAttributes().get(\"usersQuery\");", "originalCommit": "8f2368c39c2d7d730d879c43d05f17450b97dad9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4NzI1MA==", "url": "https://github.com/CESNET/perun/pull/2876#discussion_r483087250", "bodyText": "Done.", "author": "metodej", "createdAt": "2020-09-03T15:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAwMDUwNg=="}], "type": "inlineReview", "revised_code": {"commit": "f48dec598456abf67d695710e359fbe946d516f1", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\nindex 7b84a29a4..c7260fafc 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/impl/ExtSourceVOOT.java\n\n@@ -160,7 +161,7 @@ public class ExtSourceVOOT extends ExtSource implements ExtSourceApi {\n \n \t@Override\n \tpublic List<Map<String, String>> getUsersSubjects() {\n-\t\tquery = getAttributes().get(\"usersQuery\");\n+\t\tquery = getAttributes().get(UsersManager.USERS_QUERY);\n \n \t\tprepareEnvironment();\n \n"}}, {"oid": "f48dec598456abf67d695710e359fbe946d516f1", "url": "https://github.com/CESNET/perun/commit/f48dec598456abf67d695710e359fbe946d516f1", "message": "Fixes based on review\n\n- getGroupsFromRemote in ExtSourceVOOT returns empty array if no group was found instead of null\n- name of attribute usersQuery is set as constant in UsersManager", "committedDate": "2020-09-03T15:56:47Z", "type": "commit"}]}