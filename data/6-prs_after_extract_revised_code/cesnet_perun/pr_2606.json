{"pr_number": 2606, "pr_title": "CORE: Store mail used in pwd reset notifications", "pr_createdAt": "2020-03-05T08:11:23Z", "pr_url": "https://github.com/CESNET/perun/pull/2606", "timeline": [{"oid": "ae3f1e7c5df6e9c7bc4b14d340cb5332fb12f033", "url": "https://github.com/CESNET/perun/commit/ae3f1e7c5df6e9c7bc4b14d340cb5332fb12f033", "message": "CORE: Store mail used in pwd reset notifications\n\n- We allow sending password reset to non-standard mail addresses by\n  choosing source mail attribute. When password is actually re-set,\n  we should notify user on the same address as was used first time.\n- This change contains DB version update.", "committedDate": "2020-03-05T08:37:04Z", "type": "forcePushed"}, {"oid": "cf5dacccc97800c94b0c36358d450662951bc285", "url": "https://github.com/CESNET/perun/commit/cf5dacccc97800c94b0c36358d450662951bc285", "message": "CORE: Store mail used in pwd reset notifications\n\n- We allow sending password reset to non-standard mail addresses by\n  choosing source mail attribute. When password is actually re-set,\n  we should notify user on the same address as was used first time.\n- This change contains DB version update.", "committedDate": "2020-03-17T13:30:46Z", "type": "commit"}, {"oid": "cf5dacccc97800c94b0c36358d450662951bc285", "url": "https://github.com/CESNET/perun/commit/cf5dacccc97800c94b0c36358d450662951bc285", "message": "CORE: Store mail used in pwd reset notifications\n\n- We allow sending password reset to non-standard mail addresses by\n  choosing source mail attribute. When password is actually re-set,\n  we should notify user on the same address as was used first time.\n- This change contains DB version update.", "committedDate": "2020-03-17T13:30:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwODg2MQ==", "url": "https://github.com/CESNET/perun/pull/2606#discussion_r393708861", "bodyText": "You still can get null in left or right part. Shouldn't we check it here too?", "author": "stavamichal", "createdAt": "2020-03-17T14:13:13Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java", "diffHunk": "@@ -2234,9 +2234,14 @@ public User convertUserEmptyStringsInObjectAttributesIntoNull(User user) {\n \tpublic void changeNonAuthzPassword(PerunSession sess, User user, String m, String password, String lang) throws InternalErrorException, LoginNotExistsException, PasswordChangeFailedException, PasswordOperationTimeoutException, PasswordStrengthFailedException {\n \n \t\tString requestId = Utils.cipherInput(m, true);\n-\t\tString namespace = getUsersManagerImpl().loadPasswordResetRequest(user, Integer.parseInt(requestId));\n+\t\tPair<String,String> resetRequest = getUsersManagerImpl().loadPasswordResetRequest(user, Integer.parseInt(requestId));\n \n-\t\tif (namespace.isEmpty()) throw new InternalErrorException(\"Password reset request is not valid anymore or doesn't existed at all for User: \"+user);\n+\t\tif (resetRequest == null) {\n+\t\t\tthrow new InternalErrorException(\"Password reset request is not valid anymore or doesn't existed at all for User: \"+user);\n+\t\t}\n+\n+\t\tString namespace = resetRequest.getLeft();\n+\t\tString mail = resetRequest.getRight();", "originalCommit": "cf5dacccc97800c94b0c36358d450662951bc285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMTk3Nw==", "url": "https://github.com/CESNET/perun/pull/2606#discussion_r393731977", "bodyText": "Namespace is non-null in DB. Mail can be null and I added check before adding its value between known mails at line 2268.", "author": "zlamalp", "createdAt": "2020-03-17T14:44:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcwODg2MQ=="}], "type": "inlineReview", "revised_code": null}]}