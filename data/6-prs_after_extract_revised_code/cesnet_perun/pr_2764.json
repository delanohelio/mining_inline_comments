{"pr_number": 2764, "pr_title": "Set login as argument of base group members query in structure sync", "pr_createdAt": "2020-06-25T10:17:48Z", "pr_url": "https://github.com/CESNET/perun/pull/2764", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3NzM2Nw==", "url": "https://github.com/CESNET/perun/pull/2764#discussion_r445477367", "bodyText": "Nit: typo", "author": "balcirakpeter", "createdAt": "2020-06-25T11:02:08Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -3627,14 +3627,15 @@ private void saveInformationAboutGroupStructureSynchronization(PerunSession sess\n \t *\n \t * @param sess\n \t * @param baseGroup from which are sub groups taken\n-\t * @param source from which members are synchronized\n+\t * @param source from which members are synchronized\\", "originalCommit": "44410ce86e5d0f1302207ff6939ffcebeea06b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4MDY4Ng==", "url": "https://github.com/CESNET/perun/pull/2764#discussion_r445480686", "bodyText": "Removed.", "author": "stavamichal", "createdAt": "2020-06-25T11:09:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3NzM2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "bb7656279d0d5902cf13b0b89df1c75ee1892213", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\nindex 732a6ce0b..75390b87c 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\n\n@@ -3627,7 +3627,7 @@ public class GroupsManagerBlImpl implements GroupsManagerBl {\n \t *\n \t * @param sess\n \t * @param baseGroup from which are sub groups taken\n-\t * @param source from which members are synchronized\\\n+\t * @param source from which members are synchronized\n \t * @param loginAttributeDefinition attribute definition of group's login in the structure\n \t * @throws InternalErrorException\n \t * @throws AttributeNotExistsException\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3ODkxNg==", "url": "https://github.com/CESNET/perun/pull/2764#discussion_r445478916", "bodyText": "Nit: I think you can write the message like this \"...for \" + group + \" ...\", because if you leave it like it is now, the final message will be with duplicate \"group\" word.", "author": "balcirakpeter", "createdAt": "2020-06-25T11:05:30Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java", "diffHunk": "@@ -3662,7 +3663,10 @@ private void setUpSynchronizationAttributesForAllSubGroups(PerunSession sess, Gr\n \t\t\t\tlog.info(\"ExtSource already assigned to group: {}\", group);\n \t\t\t}\n \n-\t\t\tmembersQueryAttribute.setValue(baseMembersQuery.getValue().toString().replace(\"?\", group.getShortName()));\n+\t\t\t//we want to set login of group\n+\t\t\tAttribute loginAttribute = getPerunBl().getAttributesManagerBl().getAttribute(sess, group, loginAttributeDefinition.getName());\n+\t\t\tif(loginAttribute.getValue() == null) throw new InternalErrorException(\"For purpose of setting attributes for group \" + group + \" we need to have not empty group login \" + loginAttribute);", "originalCommit": "44410ce86e5d0f1302207ff6939ffcebeea06b7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ4MDczOA==", "url": "https://github.com/CESNET/perun/pull/2764#discussion_r445480738", "bodyText": "Changed.", "author": "stavamichal", "createdAt": "2020-06-25T11:09:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3ODkxNg=="}], "type": "inlineReview", "revised_code": {"commit": "bb7656279d0d5902cf13b0b89df1c75ee1892213", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\nindex 732a6ce0b..75390b87c 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/GroupsManagerBlImpl.java\n\n@@ -3665,7 +3665,7 @@ public class GroupsManagerBlImpl implements GroupsManagerBl {\n \n \t\t\t//we want to set login of group\n \t\t\tAttribute loginAttribute = getPerunBl().getAttributesManagerBl().getAttribute(sess, group, loginAttributeDefinition.getName());\n-\t\t\tif(loginAttribute.getValue() == null) throw new InternalErrorException(\"For purpose of setting attributes for group \" + group + \" we need to have not empty group login \" + loginAttribute);\n+\t\t\tif(loginAttribute.getValue() == null) throw new InternalErrorException(\"For purpose of setting attributes for \" + group + \" we need to have not empty group login \" + loginAttribute);\n \t\t\tmembersQueryAttribute.setValue(baseMembersQuery.getValue().toString().replace(\"?\", loginAttribute.valueAsString()));\n \n \t\t\tgetPerunBl().getAttributesManagerBl().setAttributes(sess, group, Arrays.asList(baseMemberExtsource, lightWeightSynchronization, synchronizationInterval, synchroEnabled, membersQueryAttribute, synchronizationTimes, extSourceNameAttr));\n"}}, {"oid": "bb7656279d0d5902cf13b0b89df1c75ee1892213", "url": "https://github.com/CESNET/perun/commit/bb7656279d0d5902cf13b0b89df1c75ee1892213", "message": "Set login as argument of base group members query in structure sync\n\n - replace short name of group by its login in query for sub-groups of\n base group while setting members query attribute\n - the main identification of group is now its login, not name", "committedDate": "2020-06-25T11:08:37Z", "type": "commit"}, {"oid": "bb7656279d0d5902cf13b0b89df1c75ee1892213", "url": "https://github.com/CESNET/perun/commit/bb7656279d0d5902cf13b0b89df1c75ee1892213", "message": "Set login as argument of base group members query in structure sync\n\n - replace short name of group by its login in query for sub-groups of\n base group while setting members query attribute\n - the main identification of group is now its login, not name", "committedDate": "2020-06-25T11:08:37Z", "type": "forcePushed"}]}