{"pr_number": 2661, "pr_title": "Multiple Identifiers with shibIdentityProvider", "pr_createdAt": "2020-04-08T14:02:18Z", "pr_url": "https://github.com/CESNET/perun/pull/2661", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2NzI5OQ==", "url": "https://github.com/CESNET/perun/pull/2661#discussion_r405967299", "bodyText": "You can use one public static String identifier, instead create a duplicate of it.", "author": "stavamichal", "createdAt": "2020-04-09T05:40:26Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/PerunBlImpl.java", "diffHunk": "@@ -118,6 +118,7 @@\n \n \tprivate final static Set<String> dontLookupUsersForLogins = BeansUtils.getCoreConfig().getDontLookupUsers();\n \tprivate final static Set<String> extSourcesWithMultipleIdentifiers = BeansUtils.getCoreConfig().getExtSourcesMultipleIdentifiers();\n+\tprivate final static String shibIdentityProvider_key = \"originIdentityProvider\";", "originalCommit": "a936e9d7f1b7064c55f354f0fd59b59d8377a980", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA5MjY0MA==", "url": "https://github.com/CESNET/perun/pull/2661#discussion_r406092640", "bodyText": "Fixed", "author": "balcirakpeter", "createdAt": "2020-04-09T09:57:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk2NzI5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "5de436fe8d1d76e205e3e6abeece9cb9f9b2a627", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/PerunBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/PerunBlImpl.java\nindex b690e29c9..ca02ddb59 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/PerunBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/PerunBlImpl.java\n\n@@ -118,7 +118,6 @@ public class PerunBlImpl implements PerunBl {\n \n \tprivate final static Set<String> dontLookupUsersForLogins = BeansUtils.getCoreConfig().getDontLookupUsers();\n \tprivate final static Set<String> extSourcesWithMultipleIdentifiers = BeansUtils.getCoreConfig().getExtSourcesMultipleIdentifiers();\n-\tprivate final static String shibIdentityProvider_key = \"originIdentityProvider\";\n \n \tpublic PerunBlImpl() {\n \n"}}, {"oid": "5de436fe8d1d76e205e3e6abeece9cb9f9b2a627", "url": "https://github.com/CESNET/perun/commit/5de436fe8d1d76e205e3e6abeece9cb9f9b2a627", "message": "Multiple Identifiers with shibIdentityProvider\n\nProblem:  Multiple identifiers did not work alongside with original IdPs functionality,\n          because configuration for multiple identifiers had set proxy id\n\t\t  but principals extSource contained original Idp id. Therefore,\n\t\t  the principal's extSource was never found in multiple identifiers list,\n\t\t  thus the additional identifiers were not used.\nSolution: Checking, if the principal's extSource is in the list of multiple identifiers configuration,\n          was changed. It does not check principal's extSource but principal's originIdentityProvider,\n\t\t  which is set to proxy id when a user logs in through some federation.", "committedDate": "2020-04-09T09:54:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwOTE5OQ==", "url": "https://github.com/CESNET/perun/pull/2661#discussion_r406109199", "bodyText": "I believe this can be removed now.", "author": "zlamalp", "createdAt": "2020-04-09T10:27:34Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AuthzResolverBlImpl.java", "diffHunk": "@@ -97,6 +97,7 @@\n \tprivate static final String SET_ROLE = \"SET\";\n \n \tprivate final static Set<String> extSourcesWithMultipleIdentifiers = BeansUtils.getCoreConfig().getExtSourcesMultipleIdentifiers();\n+\tprivate final static String shibIdentityProvider_key = \"originIdentityProvider\";", "originalCommit": "5de436fe8d1d76e205e3e6abeece9cb9f9b2a627", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExMjQ4Mw==", "url": "https://github.com/CESNET/perun/pull/2661#discussion_r406112483", "bodyText": "My bad, fixed.", "author": "balcirakpeter", "createdAt": "2020-04-09T10:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjEwOTE5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "bacca8b53f42e6934ad0e7f49abb919ec1b55d6b", "chunk": "diff --git a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AuthzResolverBlImpl.java b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AuthzResolverBlImpl.java\nindex f32ce900e..4ff64bac2 100644\n--- a/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AuthzResolverBlImpl.java\n+++ b/perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/AuthzResolverBlImpl.java\n\n@@ -97,7 +97,6 @@ public class AuthzResolverBlImpl implements AuthzResolverBl {\n \tprivate static final String SET_ROLE = \"SET\";\n \n \tprivate final static Set<String> extSourcesWithMultipleIdentifiers = BeansUtils.getCoreConfig().getExtSourcesMultipleIdentifiers();\n-\tprivate final static String shibIdentityProvider_key = \"originIdentityProvider\";\n \n \t/**\n \t * Prepare necessary structures and resolve access rights for the session's principal.\n"}}, {"oid": "bacca8b53f42e6934ad0e7f49abb919ec1b55d6b", "url": "https://github.com/CESNET/perun/commit/bacca8b53f42e6934ad0e7f49abb919ec1b55d6b", "message": "Multiple Identifiers with shibIdentityProvider\n\nProblem:  Multiple identifiers did not work alongside with original IdPs functionality,\n          because configuration for multiple identifiers had set proxy id\n\t\t  but principals extSource contained original Idp id. Therefore,\n\t\t  the principal's extSource was never found in multiple identifiers list,\n\t\t  thus the additional identifiers were not used.\nSolution: Checking, if the principal's extSource is in the list of multiple identifiers configuration,\n          was changed. It does not check principal's extSource but principal's originIdentityProvider,\n\t\t  which is set to proxy id when a user logs in through some federation.", "committedDate": "2020-04-09T10:32:57Z", "type": "commit"}, {"oid": "bacca8b53f42e6934ad0e7f49abb919ec1b55d6b", "url": "https://github.com/CESNET/perun/commit/bacca8b53f42e6934ad0e7f49abb919ec1b55d6b", "message": "Multiple Identifiers with shibIdentityProvider\n\nProblem:  Multiple identifiers did not work alongside with original IdPs functionality,\n          because configuration for multiple identifiers had set proxy id\n\t\t  but principals extSource contained original Idp id. Therefore,\n\t\t  the principal's extSource was never found in multiple identifiers list,\n\t\t  thus the additional identifiers were not used.\nSolution: Checking, if the principal's extSource is in the list of multiple identifiers configuration,\n          was changed. It does not check principal's extSource but principal's originIdentityProvider,\n\t\t  which is set to proxy id when a user logs in through some federation.", "committedDate": "2020-04-09T10:32:57Z", "type": "forcePushed"}]}