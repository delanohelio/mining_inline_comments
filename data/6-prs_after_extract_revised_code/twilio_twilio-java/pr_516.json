{"pr_number": 516, "pr_title": "fix: Do not include null values in JWT payloads", "pr_createdAt": "2020-02-09T16:21:57Z", "pr_url": "https://github.com/twilio/twilio-java/pull/516", "timeline": [{"oid": "cf10fd829c66c84df33f4f0d1ee4f0a01d17daf6", "url": "https://github.com/twilio/twilio-java/commit/cf10fd829c66c84df33f4f0d1ee4f0a01d17daf6", "message": "do not include null values in JWT payloads", "committedDate": "2020-02-09T16:17:50Z", "type": "commit"}, {"oid": "742d14a05f088abaa8515de5af60ca2da9d16a68", "url": "https://github.com/twilio/twilio-java/commit/742d14a05f088abaa8515de5af60ca2da9d16a68", "message": "restore formatting", "committedDate": "2020-02-09T16:31:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE3MDA0MA==", "url": "https://github.com/twilio/twilio-java/pull/516#discussion_r377170040", "bodyText": "Changes looks fine, but there's a lot of duplicated code in this test class. Could you refactor the obvious bits? Also, the other tests use a JWT parser to validate the payload rather than an object mapper. I prefer making this one uniform with the others so we know the payload conforms rather than what an object mapper produces.", "author": "childish-sambino", "createdAt": "2020-02-10T16:25:17Z", "path": "src/test/java/com/twilio/jwt/accesstoken/AccessTokenTest.java", "diffHunk": "@@ -336,4 +338,18 @@ public void testVoiceTokenWithoutIncoming() {\n         Assert.assertEquals(\"AP123\", outgoing.get(\"application_sid\"));\n         Assert.assertEquals(\"bar\", outgoingParams.get(\"foo\"));\n     }\n+\n+    @Test()\n+    public void testNullValues() throws JsonProcessingException {", "originalCommit": "742d14a05f088abaa8515de5af60ca2da9d16a68", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c3a6f8c3a94d4b28ad9c41663dd8aa46d09c925c", "chunk": "diff --git a/src/test/java/com/twilio/jwt/accesstoken/AccessTokenTest.java b/src/test/java/com/twilio/jwt/accesstoken/AccessTokenTest.java\nindex df854683e..71eaba50a 100644\n--- a/src/test/java/com/twilio/jwt/accesstoken/AccessTokenTest.java\n+++ b/src/test/java/com/twilio/jwt/accesstoken/AccessTokenTest.java\n\n@@ -340,16 +301,21 @@ public class AccessTokenTest {\n     }\n \n     @Test()\n-    public void testNullValues() throws JsonProcessingException {\n-        ObjectMapper mapper = new ObjectMapper();\n-        ChatGrant grant = new ChatGrant()\n-            .setDeploymentRoleSid(\"RL123\")\n-            .setPushCredentialSid(\"CR123\")\n-            .setServiceSid(\"IS123\");\n-        String payload = mapper.writeValueAsString(grant);\n-        Assert.assertFalse(payload.contains(\"endpoint_id\"));\n-        Assert.assertTrue(payload.contains(\"deployment_role_sid\"));\n-        Assert.assertTrue(payload.contains(\"push_credential_sid\"));\n-        Assert.assertTrue(payload.contains(\"service_sid\"));\n+    public void testNullValues() {\n+        ChatGrant cg = new ChatGrant().setDeploymentRoleSid(\"RL123\");\n+        Jwt token =\n+            new AccessToken.Builder(ACCOUNT_SID, SIGNING_KEY_SID, SECRET)\n+                .grant(cg)\n+                .build();\n+\n+        Claims claims = getClaimFromJwtToken(token);\n+        \n+        validateToken(claims);\n+\n+        Map<String, Object> decodedGrants = (Map<String, Object>) claims.get(\"grants\");\n+        Map<String, Object> grant = (Map<String, Object>) decodedGrants.get(\"chat\");\n+\n+        Assert.assertEquals(\"RL123\", grant.get(\"deployment_role_sid\"));\n+        Assert.assertFalse(grant.containsKey(\"endpoint_id\"));\n     }\n }\n"}}, {"oid": "c3a6f8c3a94d4b28ad9c41663dd8aa46d09c925c", "url": "https://github.com/twilio/twilio-java/commit/c3a6f8c3a94d4b28ad9c41663dd8aa46d09c925c", "message": "refactor some duplicate code, use jwt parser", "committedDate": "2020-02-10T20:35:38Z", "type": "commit"}]}