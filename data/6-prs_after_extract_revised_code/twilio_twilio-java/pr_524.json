{"pr_number": 524, "pr_title": "feat: add error details to rest and api exceptions", "pr_createdAt": "2020-04-22T17:16:20Z", "pr_url": "https://github.com/twilio/twilio-java/pull/524", "timeline": [{"oid": "d7cc88de5ae576fca488758811f6c18be25c931a", "url": "https://github.com/twilio/twilio-java/commit/d7cc88de5ae576fca488758811f6c18be25c931a", "message": "add error details to rest and api exceptions", "committedDate": "2020-04-22T17:12:52Z", "type": "commit"}, {"oid": "5a2c95f0f266cc6f53c9e2c40393d6fdd456b8e2", "url": "https://github.com/twilio/twilio-java/commit/5a2c95f0f266cc6f53c9e2c40393d6fdd456b8e2", "message": "fix documentation", "committedDate": "2020-04-22T18:49:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM3MDYxNQ==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r413370615", "bodyText": "Getting this warning from SonarLint: https://rules.sonarsource.com/java/RSPEC-1948", "author": "thinkingserious", "createdAt": "2020-04-22T22:17:41Z", "path": "src/main/java/com/twilio/exception/ApiException.java", "diffHunk": "@@ -1,20 +1,23 @@\n package com.twilio.exception;\n \n+import java.util.Map;\n+\n public class ApiException extends TwilioException {\n \n     private static final long serialVersionUID = -3228320166955630014L;\n \n     private final Integer code;\n     private final String moreInfo;\n     private final Integer status;\n+    private final Map<String, Object> details;", "originalCommit": "5a2c95f0f266cc6f53c9e2c40393d6fdd456b8e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQwNjAwOA==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r413406008", "bodyText": "I can see the issue, why it is complaining, but the concrete type creation is in Jackson, and i wouldn't want to override that. Fwiw, jackson creates LinkedHashMap<> and its serializable", "author": "ashish-s", "createdAt": "2020-04-22T23:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzM3MDYxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "chunk": "diff --git a/src/main/java/com/twilio/exception/ApiException.java b/src/main/java/com/twilio/exception/ApiException.java\nindex aba4805fb..e88b968a6 100644\n--- a/src/main/java/com/twilio/exception/ApiException.java\n+++ b/src/main/java/com/twilio/exception/ApiException.java\n\n@@ -9,7 +9,7 @@ public class ApiException extends TwilioException {\n     private final Integer code;\n     private final String moreInfo;\n     private final Integer status;\n-    private final Map<String, Object> details;\n+    private final Map<String,Object> details;\n \n     /**\n      * Create a new API Exception.\n"}}, {"oid": "cff4d88efa922d690df0c444306ebd3d99b0ba02", "url": "https://github.com/twilio/twilio-java/commit/cff4d88efa922d690df0c444306ebd3d99b0ba02", "message": "add test for new constructor", "committedDate": "2020-04-22T23:31:25Z", "type": "commit"}, {"oid": "b3afd34928b3cb219d15428ae0661bc01dfbf2b4", "url": "https://github.com/twilio/twilio-java/commit/b3afd34928b3cb219d15428ae0661bc01dfbf2b4", "message": "add yoyodyne generated code", "committedDate": "2020-04-24T16:51:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NzA1Mw==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414777053", "bodyText": "nit: assertEquals(\"Details\", details, error.getDetails());", "author": "thinkingserious", "createdAt": "2020-04-24T18:25:52Z", "path": "src/test/java/com/twilio/exception/ApiExceptionTest.java", "diffHunk": "@@ -29,13 +33,25 @@ public void twoArgConstructorShouldPreserveMessageAndCause() {\n     }\n \n     @Test\n-    public void fullConstructorShouldPreserveAllValues() {\n+    public void fiveArgConstructorShouldPreserveAllValues() {\n         ApiException error = new ApiException(anyMessage, anyErrorCode, anyMoreInfo, anyHttpStatus, anyCause);\n         assertEquals(\"Message\", anyMessage, error.getMessage());\n         assertSame(\"Cause\", anyCause, error.getCause());\n         assertEquals(\"More info\", anyMoreInfo, error.getMoreInfo());\n         assertEquals(\"Error code\", anyErrorCode, error.getCode().intValue());\n         assertEquals(\"Status code\", anyHttpStatus, error.getStatusCode().intValue());\n+        assertNull(\"Details\", error.getDetails());\n+    }\n+\n+    @Test\n+    public void fullConstructorShouldPreserveAllValues() {\n+        ApiException error = new ApiException(anyMessage, anyErrorCode, anyMoreInfo, anyHttpStatus, details, anyCause);\n+        assertEquals(\"Message\", anyMessage, error.getMessage());\n+        assertSame(\"Cause\", anyCause, error.getCause());\n+        assertEquals(\"More info\", anyMoreInfo, error.getMoreInfo());\n+        assertEquals(\"Error code\", anyErrorCode, error.getCode().intValue());\n+        assertEquals(\"Status code\", anyHttpStatus, error.getStatusCode().intValue());\n+        assertEquals(\"Details\", error.getDetails(), details);", "originalCommit": "b3afd34928b3cb219d15428ae0661bc01dfbf2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNDcxMQ==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414814711", "bodyText": "removed that constructor", "author": "ashish-s", "createdAt": "2020-04-24T19:33:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NzA1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "chunk": "diff --git a/src/test/java/com/twilio/exception/ApiExceptionTest.java b/src/test/java/com/twilio/exception/ApiExceptionTest.java\nindex 2ba95ba87..53f97dcb0 100644\n--- a/src/test/java/com/twilio/exception/ApiExceptionTest.java\n+++ b/src/test/java/com/twilio/exception/ApiExceptionTest.java\n\n@@ -33,25 +35,35 @@ public class ApiExceptionTest {\n     }\n \n     @Test\n-    public void fiveArgConstructorShouldPreserveAllValues() {\n+    public void fullConstructorShouldPreserveAllValues() {\n         ApiException error = new ApiException(anyMessage, anyErrorCode, anyMoreInfo, anyHttpStatus, anyCause);\n         assertEquals(\"Message\", anyMessage, error.getMessage());\n         assertSame(\"Cause\", anyCause, error.getCause());\n         assertEquals(\"More info\", anyMoreInfo, error.getMoreInfo());\n         assertEquals(\"Error code\", anyErrorCode, error.getCode().intValue());\n         assertEquals(\"Status code\", anyHttpStatus, error.getStatusCode().intValue());\n-        assertNull(\"Details\", error.getDetails());\n     }\n \n     @Test\n-    public void fullConstructorShouldPreserveAllValues() {\n-        ApiException error = new ApiException(anyMessage, anyErrorCode, anyMoreInfo, anyHttpStatus, details, anyCause);\n-        assertEquals(\"Message\", anyMessage, error.getMessage());\n-        assertSame(\"Cause\", anyCause, error.getCause());\n-        assertEquals(\"More info\", anyMoreInfo, error.getMoreInfo());\n-        assertEquals(\"Error code\", anyErrorCode, error.getCode().intValue());\n-        assertEquals(\"Status code\", anyHttpStatus, error.getStatusCode().intValue());\n-        assertEquals(\"Details\", error.getDetails(), details);\n+    public void restConstructorShouldPreserveValues() {\n+        final String errorJson = \"{\\n\" +\n+                                 \"  \\\"code\\\": 20001,\\n\" +\n+                                 \"  \\\"message\\\": \\\"Bad request\\\",\\n\" +\n+                                 \"  \\\"more_info\\\": \\\"https://www.twilio.com/docs/errors/20001\\\",\\n\" +\n+                                 \"  \\\"status\\\": 400,\\n\" +\n+                                 \"  \\\"details\\\": {\\n\" +\n+                                 \"  \\t\\\"foo\\\":\\\"bar\\\"\\n\" +\n+                                 \"  }\\n\" +\n+                                 \"}\\n\";\n+\n+        final RestException restException = RestException.fromJson(new ByteArrayInputStream(errorJson.getBytes()),\n+                                                                   OBJECT_MAPPER);\n+        ApiException error = new ApiException(restException);\n+        assertEquals(20001, (int) error.getCode());\n+        assertEquals(400, (int) error.getStatusCode());\n+        assertEquals(\"https://www.twilio.com/docs/errors/20001\", error.getMoreInfo());\n+        assertEquals(\"Bad request\", error.getMessage());\n+        assertEquals(\"details\", Collections.singletonMap(\"foo\", \"bar\"), error.getDetails());\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4MTQ2MA==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414781460", "bodyText": "Can't we just pass restException into an ApiException constructor? Then future changes won't update so many files.", "author": "childish-sambino", "createdAt": "2020-04-24T18:33:16Z", "path": "src/main/java/com/twilio/rest/accounts/v1/credential/AwsCreator.java", "diffHunk": "@@ -89,6 +89,7 @@ public Aws create(final TwilioRestClient client) {\n                 restException.getCode(),\n                 restException.getMoreInfo(),\n                 restException.getStatus(),\n+                restException.getDetails(),", "originalCommit": "b3afd34928b3cb219d15428ae0661bc01dfbf2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4MzA3OA==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414783078", "bodyText": "yeah thats a good idea, let me do that instead", "author": "ashish-s", "createdAt": "2020-04-24T18:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4MTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNDk4Mw==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414814983", "bodyText": "@childish-sambino removed the old constructor and added a new one with restException", "author": "ashish-s", "createdAt": "2020-04-24T19:34:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4MTQ2MA=="}], "type": "inlineReview", "revised_code": {"commit": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "chunk": "diff --git a/src/main/java/com/twilio/rest/accounts/v1/credential/AwsCreator.java b/src/main/java/com/twilio/rest/accounts/v1/credential/AwsCreator.java\nindex 40ce09f06..f0b5b8b8c 100644\n--- a/src/main/java/com/twilio/rest/accounts/v1/credential/AwsCreator.java\n+++ b/src/main/java/com/twilio/rest/accounts/v1/credential/AwsCreator.java\n\n@@ -83,15 +83,7 @@ public class AwsCreator extends Creator<Aws> {\n             if (restException == null) {\n                 throw new ApiException(\"Server Error, no content\");\n             }\n-\n-            throw new ApiException(\n-                restException.getMessage(),\n-                restException.getCode(),\n-                restException.getMoreInfo(),\n-                restException.getStatus(),\n-                restException.getDetails(),\n-                null\n-            );\n+            throw new ApiException(restException);\n         }\n \n         return Aws.fromJson(response.getStream(), client.getObjectMapper());\n"}}, {"oid": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "url": "https://github.com/twilio/twilio-java/commit/c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "message": "switch to rest exception constructor for creating ApiException", "committedDate": "2020-04-24T19:32:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNzIzNQ==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414817235", "bodyText": "nit: spacing String, Object", "author": "childish-sambino", "createdAt": "2020-04-24T19:38:15Z", "path": "src/main/java/com/twilio/exception/ApiException.java", "diffHunk": "@@ -1,12 +1,15 @@\n package com.twilio.exception;\n \n+import java.util.Map;\n+\n public class ApiException extends TwilioException {\n \n     private static final long serialVersionUID = -3228320166955630014L;\n \n     private final Integer code;\n     private final String moreInfo;\n     private final Integer status;\n+    private final Map<String,Object> details;", "originalCommit": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e11174c99da789c3bb67a65b992523dd6e0dcea6", "chunk": "diff --git a/src/main/java/com/twilio/exception/ApiException.java b/src/main/java/com/twilio/exception/ApiException.java\nindex e88b968a6..7950db2ab 100644\n--- a/src/main/java/com/twilio/exception/ApiException.java\n+++ b/src/main/java/com/twilio/exception/ApiException.java\n\n@@ -9,7 +9,7 @@ public class ApiException extends TwilioException {\n     private final Integer code;\n     private final String moreInfo;\n     private final Integer status;\n-    private final Map<String,Object> details;\n+    private final Map<String, Object> details;\n \n     /**\n      * Create a new API Exception.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNzU4Mw==", "url": "https://github.com/twilio/twilio-java/pull/524#discussion_r414817583", "bodyText": "Same nit.", "author": "childish-sambino", "createdAt": "2020-04-24T19:38:52Z", "path": "src/main/java/com/twilio/exception/RestException.java", "diffHunk": "@@ -31,11 +33,13 @@\n      */\n     @JsonCreator\n     private RestException(@JsonProperty(\"status\") final int status, @JsonProperty(\"message\") final String message,\n-                          @JsonProperty(\"code\") final Integer code, @JsonProperty(\"more_info\") final String moreInfo) {\n+                          @JsonProperty(\"code\") final Integer code, @JsonProperty(\"more_info\") final String moreInfo,\n+                          @JsonProperty(\"details\") final Map<String,Object> details) {", "originalCommit": "c3eabcd0ebb667e521c5ba506f05a7f5f332366c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e11174c99da789c3bb67a65b992523dd6e0dcea6", "chunk": "diff --git a/src/main/java/com/twilio/exception/RestException.java b/src/main/java/com/twilio/exception/RestException.java\nindex cdd2e2046..e03f8db38 100644\n--- a/src/main/java/com/twilio/exception/RestException.java\n+++ b/src/main/java/com/twilio/exception/RestException.java\n\n@@ -34,7 +34,7 @@ public class RestException {\n     @JsonCreator\n     private RestException(@JsonProperty(\"status\") final int status, @JsonProperty(\"message\") final String message,\n                           @JsonProperty(\"code\") final Integer code, @JsonProperty(\"more_info\") final String moreInfo,\n-                          @JsonProperty(\"details\") final Map<String,Object> details) {\n+                          @JsonProperty(\"details\") final Map<String, Object> details) {\n         this.status = status;\n         this.message = message;\n         this.code = code;\n"}}, {"oid": "e11174c99da789c3bb67a65b992523dd6e0dcea6", "url": "https://github.com/twilio/twilio-java/commit/e11174c99da789c3bb67a65b992523dd6e0dcea6", "message": "fix spacing issues", "committedDate": "2020-04-24T19:53:52Z", "type": "commit"}]}