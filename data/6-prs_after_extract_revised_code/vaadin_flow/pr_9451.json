{"pr_number": 9451, "pr_title": "feat: Serve theme static files from VAADIN/static", "pr_createdAt": "2020-11-20T09:58:34Z", "pr_url": "https://github.com/vaadin/flow/pull/9451", "timeline": [{"oid": "b088d805652b7db7a642b772e5635b0dd5576ad3", "url": "https://github.com/vaadin/flow/commit/b088d805652b7db7a642b772e5635b0dd5576ad3", "message": "feat: Serve theme static files from VAADIN/static\n\nStatic files in META-INF/VAADIN/static will now be served\non request to VAADIN/static.\nAdded new webpack loader that changes app theme\ncss urls targeting ./ to be VAADIN/static/ instead.\n\nFixes #9405", "committedDate": "2020-11-20T09:57:24Z", "type": "commit"}, {"oid": "d25cc506118629a906121cd36f1e5830578da70a", "url": "https://github.com/vaadin/flow/commit/d25cc506118629a906121cd36f1e5830578da70a", "message": "expect theme-loader", "committedDate": "2020-11-20T10:30:26Z", "type": "commit"}, {"oid": "84588d133fa429fecfdc340fafd74f85c5ae00b3", "url": "https://github.com/vaadin/flow/commit/84588d133fa429fecfdc340fafd74f85c5ae00b3", "message": "update: theme-loader only updates url if file exists by path.", "committedDate": "2020-11-20T12:05:03Z", "type": "commit"}, {"oid": "25d12923738b3e98c65c1bfcaac93d76a4ae316b", "url": "https://github.com/vaadin/flow/commit/25d12923738b3e98c65c1bfcaac93d76a4ae316b", "message": "Merge branch 'master' into issues/9405_theme_static_files\n\n# Conflicts:\n#\tflow-tests/test-themes/frontend/theme/app-theme/global.css", "committedDate": "2020-11-20T12:52:07Z", "type": "commit"}, {"oid": "cb7d2d50f91fc64c5bb9e458a84af10e40846215", "url": "https://github.com/vaadin/flow/commit/cb7d2d50f91fc64c5bb9e458a84af10e40846215", "message": "Fix theme test paths", "committedDate": "2020-11-20T12:53:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2OTU1OQ==", "url": "https://github.com/vaadin/flow/pull/9451#discussion_r527669559", "bodyText": "We could verify that a file that is not intended to be copied is not actually copied (and served), maybe like .css or theme.json", "author": "pleku", "createdAt": "2020-11-20T12:49:09Z", "path": "flow-server/src/test/java/com/vaadin/flow/server/StaticFileServerTest.java", "diffHunk": "@@ -488,6 +488,37 @@ public void serveStaticBundleBuildResource() throws IOException {\n         assertBundleBuildResource(pathInfo);\n     }\n \n+    @Test\n+    public void contextAndServletPath_serveStaticFileResource()\n+            throws IOException {\n+        String pathInfo = \"/VAADIN/static/img/bg.jpg\";\n+        setupRequestURI(\"/context\", \"/servlet\", pathInfo);\n+        assertBundleBuildResource(pathInfo);\n+    }\n+\n+    @Test\n+    public void ServletPath_serveStaticFileResource()\n+            throws IOException {\n+        String pathInfo = \"/VAADIN/static/img/bg.jpg\";\n+        setupRequestURI(\"\", \"/servlet\", pathInfo);\n+        assertBundleBuildResource(pathInfo);\n+    }\n+\n+    @Test\n+    public void contextPath_serveStaticFileResource()\n+            throws IOException {\n+        String pathInfo = \"/VAADIN/static/img/bg.jpg\";\n+        setupRequestURI(\"/context\", \"\", pathInfo);\n+        assertBundleBuildResource(pathInfo);\n+    }\n+\n+    @Test\n+    public void serveStaticFileResource() throws IOException {\n+        String pathInfo = \"/VAADIN/static/img/bg.jpg\";\n+        setupRequestURI(\"\", \"\", pathInfo);\n+        assertBundleBuildResource(pathInfo);\n+    }\n+", "originalCommit": "84588d133fa429fecfdc340fafd74f85c5ae00b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ5Nzc2MA==", "url": "https://github.com/vaadin/flow/pull/9451#discussion_r528497760", "bodyText": "This can only be done in the IT test as here we don't copy anything and anything in VAADIN/static should be shared.", "author": "caalador", "createdAt": "2020-11-23T06:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY2OTU1OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "7e63eb7c5408f09431f4d4c03f7fa00b19cbe725", "url": "https://github.com/vaadin/flow/commit/7e63eb7c5408f09431f4d4c03f7fa00b19cbe725", "message": "Handle CSS imports with theme-loader\n\ncorrectly update urls with path navigation.", "committedDate": "2020-11-23T09:34:33Z", "type": "commit"}, {"oid": "9563620d6e7b27d3df59da538c1acd2d0c9f2199", "url": "https://github.com/vaadin/flow/commit/9563620d6e7b27d3df59da538c1acd2d0c9f2199", "message": "Accept ./ and ../ on URL", "committedDate": "2020-11-23T13:05:49Z", "type": "commit"}]}