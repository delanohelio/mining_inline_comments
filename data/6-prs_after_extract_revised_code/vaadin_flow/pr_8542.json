{"pr_number": 8542, "pr_title": "Live reload: construct correct push URL when both service URL (and context path) and liveReloadPath are given", "pr_createdAt": "2020-06-10T14:10:42Z", "pr_url": "https://github.com/vaadin/flow/pull/8542", "timeline": [{"oid": "d2117d8ab4429d96d887254bba4a847b1ed6be54", "url": "https://github.com/vaadin/flow/commit/d2117d8ab4429d96d887254bba4a847b1ed6be54", "message": "Live reload: construct correct push URL when both service url (and context path) and liveReloadPath are given", "committedDate": "2020-06-10T14:04:10Z", "type": "commit"}, {"oid": "6f17767eb9f1965d010430441c7a41e9a08d82c9", "url": "https://github.com/vaadin/flow/commit/6f17767eb9f1965d010430441c7a41e9a08d82c9", "message": "Move logic for determining push URL to ApplicationConnection", "committedDate": "2020-06-11T10:22:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438699830", "bodyText": "So the reload connection URL is just the same URL as the application URL?\nIs it correct actually ?\nReload channel will use the application channel.\nWon't they overlap ?", "author": "denis-anisimov", "createdAt": "2020-06-11T10:48:32Z", "path": "flow-client/src/main/java/com/vaadin/client/ApplicationConnection.java", "diffHunk": "@@ -94,9 +94,16 @@ public ApplicationConnection(\n             Console.log(\n                     \"Vaadin application servlet version: \" + servletVersion);\n \n+            String reloadConnectionUrl;\n+            if (applicationConfiguration.getLiveReloadPath() != null) {\n+                reloadConnectionUrl = applicationConfiguration\n+                        .getContextRootUrl()\n+                        + applicationConfiguration.getLiveReloadPath();\n+            } else {\n+                reloadConnectionUrl = applicationConfiguration.getServiceUrl();", "originalCommit": "6f17767eb9f1965d010430441c7a41e9a08d82c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcwMDQ4NQ==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438700485", "bodyText": "OR this is not a complete URL actually ?\nWill it be used to append query parameters ?\nThen from the comment above : looks like the name is confusing because it's not final URL....", "author": "denis-anisimov", "createdAt": "2020-06-11T10:49:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcxMjI3Ng==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438712276", "bodyText": "If I'm not wrong a resource and query string are appended. In that sense it is not a complete URL.", "author": "jm-ferreira", "createdAt": "2020-06-11T11:16:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcyNDA2Ng==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438724066", "bodyText": "This part of the code only constructs the first part of the URL, which in the normal case is the application URL. The exception is when there is a context-relative push URL (in case of Spring) and then we use that instead. The remainder of the URL (query parameters) are the same in both cases.", "author": "joheriks", "createdAt": "2020-06-11T11:42:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODcyNzEwMw==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438727103", "bodyText": "I would may be call it reloadConnectionBaseUri.\nBut may be it doesn't really matter.", "author": "denis-anisimov", "createdAt": "2020-06-11T11:49:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODczNTU2OA==", "url": "https://github.com/vaadin/flow/pull/8542#discussion_r438735568", "bodyText": "Agree, that is a better name. Updated.", "author": "joheriks", "createdAt": "2020-06-11T12:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODY5OTgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "b5193faf38ec7ca8b7316d1fc078c58c3ac39d91", "chunk": "diff --git a/flow-client/src/main/java/com/vaadin/client/ApplicationConnection.java b/flow-client/src/main/java/com/vaadin/client/ApplicationConnection.java\nindex 1a4d201766..51f0c4a89d 100644\n--- a/flow-client/src/main/java/com/vaadin/client/ApplicationConnection.java\n+++ b/flow-client/src/main/java/com/vaadin/client/ApplicationConnection.java\n\n@@ -94,16 +94,16 @@ public class ApplicationConnection {\n             Console.log(\n                     \"Vaadin application servlet version: \" + servletVersion);\n \n-            String reloadConnectionUrl;\n+            String reloadConnectionBaseUri;\n             if (applicationConfiguration.getLiveReloadPath() != null) {\n-                reloadConnectionUrl = applicationConfiguration\n+                reloadConnectionBaseUri = applicationConfiguration\n                         .getContextRootUrl()\n                         + applicationConfiguration.getLiveReloadPath();\n             } else {\n-                reloadConnectionUrl = applicationConfiguration.getServiceUrl();\n+                reloadConnectionBaseUri = applicationConfiguration.getServiceUrl();\n             }\n             if (applicationConfiguration.isDevmodeGizmoEnabled()) {\n-                createDevModeGizmo(reloadConnectionUrl,\n+                createDevModeGizmo(reloadConnectionBaseUri,\n                         applicationConfiguration.getLiveReloadBackend(),\n                         applicationConfiguration.getSpringBootDevToolsPort());\n             }\n"}}, {"oid": "b5193faf38ec7ca8b7316d1fc078c58c3ac39d91", "url": "https://github.com/vaadin/flow/commit/b5193faf38ec7ca8b7316d1fc078c58c3ac39d91", "message": "s/reloadConnectionUrl/reloadConnectionBaseUri/", "committedDate": "2020-06-11T12:06:26Z", "type": "commit"}]}