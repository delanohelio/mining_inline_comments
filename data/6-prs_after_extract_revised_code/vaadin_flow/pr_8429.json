{"pr_number": 8429, "pr_title": "New add item methods", "pr_createdAt": "2020-05-27T11:12:00Z", "pr_url": "https://github.com/vaadin/flow/pull/8429", "timeline": [{"oid": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "url": "https://github.com/vaadin/flow/commit/a3ece6c8f55572c259ea8ad7ce6a064e43806330", "message": "New add item methods\n\nAdded method to add\nitem before or after another item.", "committedDate": "2020-05-27T11:25:00Z", "type": "commit"}, {"oid": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "url": "https://github.com/vaadin/flow/commit/a3ece6c8f55572c259ea8ad7ce6a064e43806330", "message": "New add item methods\n\nAdded method to add\nitem before or after another item.", "committedDate": "2020-05-27T11:25:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1MjY4NQ==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431052685", "bodyText": "I was thinking about these methods (and the refresh methods) yesterday but didn't yet create an issue.\nDo we have an example of using these in any of the components showing why it is needed over add() and then applying sorting ?", "author": "pleku", "createdAt": "2020-05-27T11:40:52Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java", "diffHunk": "@@ -89,13 +87,42 @@\n      */\n     V removeItem(T item);\n \n+    /**\n+     * Add an item after the given target item.\n+     *\n+     * @param item\n+     *         item to add\n+     * @param after\n+     *         item after which to add the item at\n+     * @return this ListDataView instance\n+     * @throws UnsupportedOperationException\n+     *         if backing collection doesn't support modification\n+     * @throws IndexOutOfBoundsException\n+     *         if given index is outside of item set\n+     */\n+    V addItemAfter(T item, T after);", "originalCommit": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NTM4Mw==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431055383", "bodyText": "From gridDemo:\n        insert.getSubMenu().addItem(\"Insert a row above\", event -> {\n            Optional<Person> item = event.getItem();\n            if (!item.isPresent()) {\n                // no selected row\n                return;\n            }\n            List<Person> items = dataView.getItems();\n            items.add(items.indexOf(item.get()), createItems(1).get(0));\n            grid.getDataProvider().refreshAll();\n        });\n        insert.getSubMenu().add(new Hr());\n        insert.getSubMenu().addItem(\"Insert a row below\", event -> {\n            Optional<Person> item = event.getItem();\n            if (!item.isPresent()) {\n                // no selected row\n                return;\n            }\n            List<Person> items = dataView.getItems();\n            items.add(items.indexOf(item.get()) + 1, createItems(1).get(0));\n            grid.getDataProvider().refreshAll();\n        });", "author": "caalador", "createdAt": "2020-05-27T11:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1MjY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODU2Ng==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431058566", "bodyText": "Yes that will be simplified nicely", "author": "pleku", "createdAt": "2020-05-27T11:52:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1MjY4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "bed9269a50383830629b5ac01fed3125a7b36869", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\nindex c1c55d5505..5f9b47eb33 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n\n@@ -97,8 +97,8 @@ public interface ListDataView<T, V extends ListDataView<T, ?>> extends DataView<\n      * @return this ListDataView instance\n      * @throws UnsupportedOperationException\n      *         if backing collection doesn't support modification\n-     * @throws IndexOutOfBoundsException\n-     *         if given index is outside of item set\n+     * @throws IllegalArgumentException\n+     *         if item doesn't exist or collection is not a list\n      */\n     V addItemAfter(T item, T after);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDEyNg==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431054126", "bodyText": "Maybe just give the real type be here in the exception ? And for before method too", "author": "pleku", "createdAt": "2020-05-27T11:43:47Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java", "diffHunk": "@@ -130,6 +132,35 @@ public boolean isItemPresent(T item) {\n         return this;\n     }\n \n+    @Override\n+    public AbstractListDataView<T> addItemAfter(T item, T after) {\n+        final Collection<T> items = getDataProvider().getItems();\n+        if(!items.contains(after)) {\n+            throw new IllegalArgumentException(\"Item to insert after is not available in the data\");\n+        }\n+        if(items instanceof List) {\n+            ((List<T>)items).add(((List<T>) items).indexOf(after)+1, item);\n+            getDataProvider().refreshAll();\n+            return this;\n+        }\n+        throw new IllegalArgumentException(\"DataProvider collection is not a list.\");", "originalCommit": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODQ0OQ==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431058449", "bodyText": "added", "author": "caalador", "createdAt": "2020-05-27T11:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDEyNg=="}], "type": "inlineReview", "revised_code": {"commit": "bed9269a50383830629b5ac01fed3125a7b36869", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java\nindex 9ba4ef3400..404f941fbc 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/AbstractListDataView.java\n\n@@ -139,11 +139,12 @@ public abstract class AbstractListDataView<T> extends AbstractDataView<T>\n             throw new IllegalArgumentException(\"Item to insert after is not available in the data\");\n         }\n         if(items instanceof List) {\n-            ((List<T>)items).add(((List<T>) items).indexOf(after)+1, item);\n+            final List<T> itemList = (List<T>) items;\n+            itemList.add(itemList.indexOf(after)+1, item);\n             getDataProvider().refreshAll();\n             return this;\n         }\n-        throw new IllegalArgumentException(\"DataProvider collection is not a list.\");\n+        throw new IllegalArgumentException(String.format(\"DataProvider collection '%s' is not a list.\", items.getClass().getSimpleName()));\n     }\n \n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDI4Mg==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431054282", "bodyText": "given index ??", "author": "pleku", "createdAt": "2020-05-27T11:44:06Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java", "diffHunk": "@@ -89,13 +87,42 @@\n      */\n     V removeItem(T item);\n \n+    /**\n+     * Add an item after the given target item.\n+     *\n+     * @param item\n+     *         item to add\n+     * @param after\n+     *         item after which to add the item at\n+     * @return this ListDataView instance\n+     * @throws UnsupportedOperationException\n+     *         if backing collection doesn't support modification\n+     * @throws IndexOutOfBoundsException\n+     *         if given index is outside of item set\n+     */\n+    V addItemAfter(T item, T after);\n+\n+    /**\n+     * Add an item before the given target item.\n+     *\n+     * @param item\n+     *         item to add\n+     * @param before\n+     *         item before which to add the item at\n+     * @return this ListDataView instance\n+     * @throws UnsupportedOperationException\n+     *         if backing collection doesn't support modification\n+     * @throws IndexOutOfBoundsException\n+     *         if given index is outside of item set", "originalCommit": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODQ1Ng==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431058456", "bodyText": "fixed.", "author": "caalador", "createdAt": "2020-05-27T11:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDI4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "bed9269a50383830629b5ac01fed3125a7b36869", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\nindex c1c55d5505..5f9b47eb33 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n\n@@ -97,8 +97,8 @@ public interface ListDataView<T, V extends ListDataView<T, ?>> extends DataView<\n      * @return this ListDataView instance\n      * @throws UnsupportedOperationException\n      *         if backing collection doesn't support modification\n-     * @throws IndexOutOfBoundsException\n-     *         if given index is outside of item set\n+     * @throws IllegalArgumentException\n+     *         if item doesn't exist or collection is not a list\n      */\n     V addItemAfter(T item, T after);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDI5NQ==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431054295", "bodyText": "given index ??", "author": "pleku", "createdAt": "2020-05-27T11:44:08Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java", "diffHunk": "@@ -89,13 +87,42 @@\n      */\n     V removeItem(T item);\n \n+    /**\n+     * Add an item after the given target item.\n+     *\n+     * @param item\n+     *         item to add\n+     * @param after\n+     *         item after which to add the item at\n+     * @return this ListDataView instance\n+     * @throws UnsupportedOperationException\n+     *         if backing collection doesn't support modification\n+     * @throws IndexOutOfBoundsException\n+     *         if given index is outside of item set", "originalCommit": "a3ece6c8f55572c259ea8ad7ce6a064e43806330", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODQ4NA==", "url": "https://github.com/vaadin/flow/pull/8429#discussion_r431058484", "bodyText": "fixed.", "author": "caalador", "createdAt": "2020-05-27T11:52:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1NDI5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "bed9269a50383830629b5ac01fed3125a7b36869", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\nindex c1c55d5505..5f9b47eb33 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/ListDataView.java\n\n@@ -97,8 +97,8 @@ public interface ListDataView<T, V extends ListDataView<T, ?>> extends DataView<\n      * @return this ListDataView instance\n      * @throws UnsupportedOperationException\n      *         if backing collection doesn't support modification\n-     * @throws IndexOutOfBoundsException\n-     *         if given index is outside of item set\n+     * @throws IllegalArgumentException\n+     *         if item doesn't exist or collection is not a list\n      */\n     V addItemAfter(T item, T after);\n \n"}}, {"oid": "bed9269a50383830629b5ac01fed3125a7b36869", "url": "https://github.com/vaadin/flow/commit/bed9269a50383830629b5ac01fed3125a7b36869", "message": "Minor fixes to exception and javadoc.", "committedDate": "2020-05-27T11:52:06Z", "type": "commit"}, {"oid": "15c9231c5c49366a95624d437985593fd7cda8b7", "url": "https://github.com/vaadin/flow/commit/15c9231c5c49366a95624d437985593fd7cda8b7", "message": "Update javadoc\n\nNote that item is added to the\nunsorted and unfiltered list.", "committedDate": "2020-05-27T11:54:49Z", "type": "commit"}]}