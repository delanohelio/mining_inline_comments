{"pr_number": 9172, "pr_title": "fix: only register endpoint request handler when endpoint presents", "pr_createdAt": "2020-10-14T06:53:32Z", "pr_url": "https://github.com/vaadin/flow/pull/9172", "timeline": [{"oid": "7f96a0d37d0148e71242ea9a4b2aa940097fea51", "url": "https://github.com/vaadin/flow/commit/7f96a0d37d0148e71242ea9a4b2aa940097fea51", "message": "fix: only register endpoint request handler when endpoint presents", "committedDate": "2020-10-14T06:52:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYwNzI0Mg==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r504607242", "bodyText": "Just a question; would it be better to use Custom Conditional to only activate the controller if the @Endpoint annotation is used? Or is this over-engineered because you guys think about removing spring? https://reflectoring.io/spring-boot-conditionals/#custom-conditions", "author": "knoobie", "createdAt": "2020-10-14T11:38:18Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java", "diffHunk": "@@ -94,6 +97,7 @@\n @RestController\n @Import({ VaadinConnectControllerConfiguration.class,\n         VaadinEndpointProperties.class })\n+@ConditionalOnProperty(value = VAADIN_ENDPINT_ENABLED, havingValue = \"true\")", "originalCommit": "7f96a0d37d0148e71242ea9a4b2aa940097fea51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYxOTAwMg==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r504619002", "bodyText": "Hi @knoobie, thanks for the comment. I was also thinking about using a Custom Condition in the beginning, but then realized that we are already scanning the Endpoints at build time, so we can just reuse that instead of having another check in a custom condition.\nAlso for an extreme case, if there is only one class that has @Endpoint annotation, but without any public methods, then the annotation scanning-based custom condition would still active the Vaadin controller while the solution in this PR won't.\nAnother big reason is what you mentioned, we might remove the spring dependency in the future, so the check won't be necessary, thus like to have a minimal effort solution.", "author": "haijian-vaadin", "createdAt": "2020-10-14T11:59:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYwNzI0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f16ff62ffef91efcca81a00d4f098d60f286615a", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java b/flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java\nindex 8efaaaa79d..66d38d8424 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/connect/VaadinConnectController.java\n\n@@ -97,7 +97,7 @@ import static com.vaadin.flow.server.Constants.VAADIN_ENDPINT_ENABLED;\n @RestController\n @Import({ VaadinConnectControllerConfiguration.class,\n         VaadinEndpointProperties.class })\n-@ConditionalOnProperty(value = VAADIN_ENDPINT_ENABLED, havingValue = \"true\")\n+@ConditionalOnProperty(value = VAADIN_ENDPOINT_ENABLED, havingValue = \"true\")\n public class VaadinConnectController {\n     /**\n      * A qualifier to override the request and response default json mapper.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI5Njc2MA==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r506296760", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String VAADIN_ENDPINT_ENABLED = \"endpoint.enabled\";\n          \n          \n            \n                public static final String VAADIN_ENDPOINT_ENABLED = \"endpoint.enabled\";\n          \n      \n    \n    \n  \n\nThere's a typo in the constant. BTW, should it be a public constant (from API maintenance point of view this means it can't easily be removed or renamed later) or could it be put inside com.vaadin.flow.server.connect (e.g., within an internal package)?", "author": "joheriks", "createdAt": "2020-10-16T11:02:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/Constants.java", "diffHunk": "@@ -412,6 +412,8 @@\n     // Non-default port currently not supported (#7970)\n     public static final int SPRING_BOOT_DEFAULT_LIVE_RELOAD_PORT = 35729;\n \n+    public static final String VAADIN_ENDPINT_ENABLED = \"endpoint.enabled\";", "originalCommit": "7f96a0d37d0148e71242ea9a4b2aa940097fea51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMTgzMQ==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r506311831", "bodyText": "Very good point, instead of create a new internal package inside connect, I reused a flow internal package and added a new InternalConstants, please help to take another look", "author": "haijian-vaadin", "createdAt": "2020-10-16T11:21:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI5Njc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM0MTcxNA==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r506341714", "bodyText": "\ud83d\udc4d. Looks like the package name may need updating.", "author": "joheriks", "createdAt": "2020-10-16T11:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI5Njc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM0NDY3Nw==", "url": "https://github.com/vaadin/flow/pull/9172#discussion_r506344677", "bodyText": "Good spot, thanks. Thought VS Code would have done that automatically for me.", "author": "haijian-vaadin", "createdAt": "2020-10-16T12:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjI5Njc2MA=="}], "type": "inlineReview", "revised_code": {"commit": "f16ff62ffef91efcca81a00d4f098d60f286615a", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/Constants.java b/flow-server/src/main/java/com/vaadin/flow/server/Constants.java\nindex cc95893909..b296ba60e4 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/Constants.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/Constants.java\n\n@@ -412,8 +412,6 @@ public final class Constants implements Serializable {\n     // Non-default port currently not supported (#7970)\n     public static final int SPRING_BOOT_DEFAULT_LIVE_RELOAD_PORT = 35729;\n \n-    public static final String VAADIN_ENDPINT_ENABLED = \"endpoint.enabled\";\n-\n     private Constants() {\n         // prevent instantiation constants class only\n     }\n"}}, {"oid": "f16ff62ffef91efcca81a00d4f098d60f286615a", "url": "https://github.com/vaadin/flow/commit/f16ff62ffef91efcca81a00d4f098d60f286615a", "message": "move constant to internal package", "committedDate": "2020-10-16T11:19:42Z", "type": "commit"}, {"oid": "882539c3524b0576649d0a7b8c3c5520f9f2c968", "url": "https://github.com/vaadin/flow/commit/882539c3524b0576649d0a7b8c3c5520f9f2c968", "message": "update package name", "committedDate": "2020-10-16T12:02:10Z", "type": "commit"}, {"oid": "c228de12297485145038127180600a812fb545cf", "url": "https://github.com/vaadin/flow/commit/c228de12297485145038127180600a812fb545cf", "message": "fix sonar issue", "committedDate": "2020-10-16T12:59:12Z", "type": "commit"}]}