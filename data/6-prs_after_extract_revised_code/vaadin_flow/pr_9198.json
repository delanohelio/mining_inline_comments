{"pr_number": 9198, "pr_title": "feat: disposable filter setup API in data communicator", "pr_createdAt": "2020-10-19T12:29:54Z", "pr_url": "https://github.com/vaadin/flow/pull/9198", "timeline": [{"oid": "6d0e7aded18c6c7071e5b180194214c2afc0fb1f", "url": "https://github.com/vaadin/flow/commit/6d0e7aded18c6c7071e5b180194214c2afc0fb1f", "message": "Disposable filter setup API in data communicator", "committedDate": "2020-10-19T12:22:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNzAxNQ==", "url": "https://github.com/vaadin/flow/pull/9198#discussion_r507727015", "bodyText": "Maybe requestFlush is better name", "author": "pleku", "createdAt": "2020-10-19T13:01:51Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -225,17 +304,36 @@ public DataCommunicator(DataGenerator<T> dataGenerator,\n     }\n \n     /**\n-     * Sets the requested range of data to be sent.\n+     * Sets the requested range of data to be sent and requests the data of this\n+     * range from the data provider immediately.\n      *\n      * @param start\n      *            the start of the requested range\n      * @param length\n      *            the end of the requested range\n      */\n     public void setRequestedRange(int start, int length) {\n+        setRequestedRange(start, length, true);\n+    }\n+\n+    /**\n+     * Sets the requested range of data to be sent and sets whether the data\n+     * should be requested immediately or not.\n+     * \n+     * @param start\n+     *            the start of the requested range\n+     * @param length\n+     *            the end of the requested range\n+     * @param requestNow\n+     *            if {@code true}, the data will be requested immediately,\n+     *            otherwise it will just set the range.\n+     */\n+    public void setRequestedRange(int start, int length, boolean requestNow) {", "originalCommit": "6d0e7aded18c6c7071e5b180194214c2afc0fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMzNTAyOA==", "url": "https://github.com/vaadin/flow/pull/9198#discussion_r508335028", "bodyText": "I reverted the changes for setRequestedRange because actually this extra flush call will anyway merged with the flush from filter slot callback into the one call, so it's not necessary for CB.", "author": "mshabarov", "createdAt": "2020-10-20T09:07:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcyNzAxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "11021d2f6ed5330d58d147651d10a10c05f1eceb", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\nindex cbea89727b..3051d8c125 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\n\n@@ -304,8 +311,7 @@ public class DataCommunicator<T> implements Serializable {\n     }\n \n     /**\n-     * Sets the requested range of data to be sent and requests the data of this\n-     * range from the data provider immediately.\n+     * Sets the requested range of data to be sent.\n      *\n      * @param start\n      *            the start of the requested range\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMDAxNg==", "url": "https://github.com/vaadin/flow/pull/9198#discussion_r507730016", "bodyText": "What is a disposable filter ?\nThe semantics should be explained in this method", "author": "pleku", "createdAt": "2020-10-19T13:06:51Z", "path": "flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java", "diffHunk": "@@ -306,16 +404,26 @@ public void confirmUpdate(int updateId) {\n      * @param initialFilter\n      *            the initial filter value to use, or <code>null</code> to not\n      *            use any initial filter value\n+     * @param permanentFilter\n+     *            if {@code true}, then the initial filter is considered as a\n+     *            permanent and won't be discarded after the next call to data\n+     *            provider, otherwise it will be treated as a disposable filter\n+     *            and will be discarded", "originalCommit": "6d0e7aded18c6c7071e5b180194214c2afc0fb1f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMzNTI1MQ==", "url": "https://github.com/vaadin/flow/pull/9198#discussion_r508335251", "bodyText": "Made a clarifications in javadocs", "author": "mshabarov", "createdAt": "2020-10-20T09:07:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMDAxNg=="}], "type": "inlineReview", "revised_code": {"commit": "11021d2f6ed5330d58d147651d10a10c05f1eceb", "chunk": "diff --git a/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java b/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\nindex cbea89727b..3051d8c125 100644\n--- a/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\n+++ b/flow-data/src/main/java/com/vaadin/flow/data/provider/DataCommunicator.java\n\n@@ -398,6 +385,14 @@ public class DataCommunicator<T> implements Serializable {\n      * This method also sets the data communicator to defined size - meaning\n      * that the given data provider is queried for size and previous size\n      * estimates are discarded.\n+     * <p>\n+     * This method allows to define the lifespan for the given filter. It can be\n+     * set as a permanent, i.e. it will be stored in the data communicator and\n+     * used for any calls to data provider until further change through returned\n+     * consumer. Otherwise, it will be considered as a disposable filter, i.e.\n+     * with a lifespan of just one requested range call to data provider, and\n+     * then it will be erased and not took into account in the further calls\n+     * until further change through returned consumer.\n      *\n      * @param dataProvider\n      *            the data provider to set, not <code>null</code>\n"}}, {"oid": "11021d2f6ed5330d58d147651d10a10c05f1eceb", "url": "https://github.com/vaadin/flow/commit/11021d2f6ed5330d58d147651d10a10c05f1eceb", "message": "Fix review comments and get rid of flush call while confirming updates", "committedDate": "2020-10-20T09:04:47Z", "type": "commit"}, {"oid": "f7ae092b1a933f5e3c5f8908c51ff181cdbb8f94", "url": "https://github.com/vaadin/flow/commit/f7ae092b1a933f5e3c5f8908c51ff181cdbb8f94", "message": "Add unit tests", "committedDate": "2020-10-21T08:25:54Z", "type": "commit"}]}