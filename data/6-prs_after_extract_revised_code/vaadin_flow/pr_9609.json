{"pr_number": 9609, "pr_title": "refactor: simplify ResourceProvider", "pr_createdAt": "2020-12-08T11:57:44Z", "pr_url": "https://github.com/vaadin/flow/pull/9609", "timeline": [{"oid": "677c4026c2955d49be858e089c6491f266bd90b6", "url": "https://github.com/vaadin/flow/commit/677c4026c2955d49be858e089c6491f266bd90b6", "message": "refactor: simplify ResourceProvider, first step\n\nfixes #9605", "committedDate": "2020-12-08T11:56:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI4NjA0Mg==", "url": "https://github.com/vaadin/flow/pull/9609#discussion_r538286042", "bodyText": "temp changes: this will be removed completely in the second step: resourceProvider.getApplicationResource won't need the first arg anymore.", "author": "denis-anisimov", "createdAt": "2020-12-08T11:58:44Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/BootstrapUtils.java", "diffHunk": "@@ -257,8 +257,12 @@ private static InputStream getInlineResourceStream(VaadinRequest request,\n         VaadinService service = request.getService();\n         ResourceProvider resourceProvider = service.getContext()\n                 .getAttribute(Lookup.class).lookup(ResourceProvider.class);\n-        URL appResource = resourceProvider.getApplicationResource(service,\n-                file);\n+        Class<?> clazz = null;\n+        if (service instanceof VaadinServletService) {", "originalCommit": "677c4026c2955d49be858e089c6491f266bd90b6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d0366f8523ad40ad6220bedea99a7c2cac8d98f", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/BootstrapUtils.java b/flow-server/src/main/java/com/vaadin/flow/server/BootstrapUtils.java\nindex 6677afe93a..207143c3f6 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/BootstrapUtils.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/BootstrapUtils.java\n\n@@ -257,12 +257,7 @@ class BootstrapUtils {\n         VaadinService service = request.getService();\n         ResourceProvider resourceProvider = service.getContext()\n                 .getAttribute(Lookup.class).lookup(ResourceProvider.class);\n-        Class<?> clazz = null;\n-        if (service instanceof VaadinServletService) {\n-            clazz = ((VaadinServletService) service).getServlet().getClass();\n-        }\n-        URL appResource = clazz == null ? null\n-                : resourceProvider.getApplicationResource(clazz, file);\n+        URL appResource = resourceProvider.getApplicationResource(file);\n \n         InputStream stream = null;\n         try {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI4NjE5NQ==", "url": "https://github.com/vaadin/flow/pull/9609#discussion_r538286195", "bodyText": "temp changes: this will be removed completely in the second step: resourceProvider.getApplicationResource won't need the first arg anymore.", "author": "denis-anisimov", "createdAt": "2020-12-08T11:58:56Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java", "diffHunk": "@@ -608,7 +609,13 @@ private static InputStream getStatsFromClassPath(VaadinService service) {\n                 .replaceFirst(\"^/\", \"\");\n         ResourceProvider resourceProvider = service.getContext()\n                 .getAttribute(Lookup.class).lookup(ResourceProvider.class);\n-        URL statsUrl = resourceProvider.getApplicationResource(service, stats);\n+        Class<?> appClass = null;", "originalCommit": "677c4026c2955d49be858e089c6491f266bd90b6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d0366f8523ad40ad6220bedea99a7c2cac8d98f", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java b/flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java\nindex 8d1b8c8baf..4b0e11943e 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/frontend/FrontendUtils.java\n\n@@ -609,13 +608,7 @@ public class FrontendUtils {\n                 .replaceFirst(\"^/\", \"\");\n         ResourceProvider resourceProvider = service.getContext()\n                 .getAttribute(Lookup.class).lookup(ResourceProvider.class);\n-        Class<?> appClass = null;\n-        if (service instanceof VaadinServletService) {\n-            appClass = ((VaadinServletService) service).getServlet().getClass();\n-        }\n-\n-        URL statsUrl = appClass == null ? null\n-                : resourceProvider.getApplicationResource(appClass, stats);\n+        URL statsUrl = resourceProvider.getApplicationResource(stats);\n         InputStream stream = null;\n         try {\n             stream = statsUrl == null ? null : statsUrl.openStream();\n"}}, {"oid": "c76d6c9f3b253966003b08dcbabcb4232d4c9036", "url": "https://github.com/vaadin/flow/commit/c76d6c9f3b253966003b08dcbabcb4232d4c9036", "message": "fix: correct mock vaadin service", "committedDate": "2020-12-08T12:50:19Z", "type": "commit"}, {"oid": "7d0366f8523ad40ad6220bedea99a7c2cac8d98f", "url": "https://github.com/vaadin/flow/commit/7d0366f8523ad40ad6220bedea99a7c2cac8d98f", "message": "fix: remove the first arg of getApplicationResource(s) completely", "committedDate": "2020-12-08T13:53:43Z", "type": "commit"}, {"oid": "ee4bb2c0509a8e97a1a84ffa2bdb159751ac627f", "url": "https://github.com/vaadin/flow/commit/ee4bb2c0509a8e97a1a84ffa2bdb159751ac627f", "message": "fix: correct javadocs", "committedDate": "2020-12-09T06:19:13Z", "type": "commit"}, {"oid": "bcecbde8f236e53b7164d6f2eaed39f1e2ad57ca", "url": "https://github.com/vaadin/flow/commit/bcecbde8f236e53b7164d6f2eaed39f1e2ad57ca", "message": "fix: correct mock", "committedDate": "2020-12-09T08:11:00Z", "type": "commit"}, {"oid": "bcecbde8f236e53b7164d6f2eaed39f1e2ad57ca", "url": "https://github.com/vaadin/flow/commit/bcecbde8f236e53b7164d6f2eaed39f1e2ad57ca", "message": "fix: correct mock", "committedDate": "2020-12-09T08:11:00Z", "type": "forcePushed"}]}