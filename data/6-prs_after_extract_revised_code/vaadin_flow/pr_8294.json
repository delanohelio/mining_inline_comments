{"pr_number": 8294, "pr_title": "Store vaadin hash to node_modules 2.1", "pr_createdAt": "2020-05-11T10:08:29Z", "pr_url": "https://github.com/vaadin/flow/pull/8294", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjkzNzUwMw==", "url": "https://github.com/vaadin/flow/pull/8294#discussion_r422937503", "bodyText": "Reduce the number of conditional operators (4) used in the expression (maximum allowed 3).", "author": "vaadin-bot", "createdAt": "2020-05-11T10:19:36Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java", "diffHunk": "@@ -76,7 +122,32 @@ private boolean shouldRunNpmInstall() {\n             assert installedPackages != null;\n             return installedPackages.length == 0", "originalCommit": "db007013e142b9aff645e3ebe4b9161d1603197f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7bdfd6fbab6e0f8c4424bdc1207038f88f6ac79c", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java b/flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java\nindex ae2055a20b..6865c70030 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/frontend/TaskRunNpmInstall.java\n\n@@ -130,25 +130,27 @@ public class TaskRunNpmInstall implements FallibleCommand {\n \n     private boolean isVaadinHashUpdated() {\n         final File localHashFile = getLocalHashFile();\n-        if (localHashFile.exists()) {\n-            try {\n-                String fileContent = FileUtils\n-                        .readFileToString(localHashFile, UTF_8.name());\n-                JsonObject content = Json.parse(fileContent);\n-                if (content.hasKey(HASH_KEY)) {\n-                    final JsonObject packageJson = packageUpdater\n-                            .getMainPackageJson();\n-                    if(packageJson == null || !packageJson.hasKey(HASH_KEY)){\n-                        return false;\n-                    }\n-                    return !content.getString(HASH_KEY)\n-                            .equals(packageJson.getString(HASH_KEY));\n+        if (!localHashFile.exists()) {\n+            return true;\n+        }\n+        try {\n+            String fileContent = FileUtils\n+                    .readFileToString(localHashFile, UTF_8.name());\n+            JsonObject content = Json.parse(fileContent);\n+            if (content.hasKey(HASH_KEY)) {\n+                final JsonObject packageJson = packageUpdater\n+                        .getMainPackageJson();\n+                if (packageJson == null || !packageJson.hasKey(HASH_KEY)) {\n+                    return false;\n                 }\n-            } catch (IOException e) {\n-                packageUpdater.log()\n-                        .warn(\"Failed to load hashes forcing npm execution\", e);\n+                return !content.getString(HASH_KEY)\n+                        .equals(packageJson.getString(HASH_KEY));\n             }\n+        } catch (IOException e) {\n+            packageUpdater.log()\n+                    .warn(\"Failed to load hashes forcing npm execution\", e);\n         }\n+\n         return true;\n     }\n \n"}}, {"oid": "7bdfd6fbab6e0f8c4424bdc1207038f88f6ac79c", "url": "https://github.com/vaadin/flow/commit/7bdfd6fbab6e0f8c4424bdc1207038f88f6ac79c", "message": "Store vaadin hash to node_modules 2.1\n\nGenerate a full hash to mainPackageJson\nand store it after npm install to\nnode_modules/.vaadin\n\nFixes #8182", "committedDate": "2020-05-11T11:16:11Z", "type": "forcePushed"}, {"oid": "13e4ddeb7f4785d961390b80312b7e19489a17f9", "url": "https://github.com/vaadin/flow/commit/13e4ddeb7f4785d961390b80312b7e19489a17f9", "message": "Store vaadin hash to node_modules 2.1\n\nGenerate a full hash to mainPackageJson\nand store it after npm install to\nnode_modules/.vaadin\n\nFixes #8182", "committedDate": "2020-05-11T11:35:46Z", "type": "commit"}, {"oid": "13e4ddeb7f4785d961390b80312b7e19489a17f9", "url": "https://github.com/vaadin/flow/commit/13e4ddeb7f4785d961390b80312b7e19489a17f9", "message": "Store vaadin hash to node_modules 2.1\n\nGenerate a full hash to mainPackageJson\nand store it after npm install to\nnode_modules/.vaadin\n\nFixes #8182", "committedDate": "2020-05-11T11:35:46Z", "type": "forcePushed"}]}