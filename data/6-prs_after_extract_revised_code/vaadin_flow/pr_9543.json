{"pr_number": 9543, "pr_title": "feat: Enable importing CSS from node_modules", "pr_createdAt": "2020-11-30T17:18:49Z", "pr_url": "https://github.com/vaadin/flow/pull/9543", "timeline": [{"oid": "9b25ea8b2b253319f85406ef98f277dbcbf725ba", "url": "https://github.com/vaadin/flow/commit/9b25ea8b2b253319f85406ef98f277dbcbf725ba", "message": "feat: Enable importing CSS from node_modules (#9410)", "committedDate": "2020-11-30T17:16:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NjYzNw==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533096637", "bodyText": "Lots of unrelated formatting changes in the test file.\nCould you check the TeamWiki Code style section. indentation at least seems different", "author": "caalador", "createdAt": "2020-12-01T06:18:24Z", "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java", "diffHunk": "@@ -38,11 +39,11 @@\n     public void secondTheme_staticFilesNotCopied() {\n         getDriver().get(getRootURL() + \"/path/VAADIN/static/img/bg.jpg\");\n         Assert.assertFalse(\"app-theme static files should be copied\",\n-            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));", "originalCommit": "9b25ea8b2b253319f85406ef98f277dbcbf725ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzEzMjExMg==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r533132112", "bodyText": "Reverted. My formatter setting was disappear somehow.", "author": "tanbt", "createdAt": "2020-12-01T07:50:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzA5NjYzNw=="}], "type": "inlineReview", "revised_code": {"commit": "d8474de155c1c6632a03db28ddaa43b0eca8743f", "chunk": "diff --git a/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java b/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\nindex c51ba38e20..e70d4dbb26 100644\n--- a/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\n+++ b/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\n\n@@ -39,11 +39,11 @@ public class ThemeIT extends ChromeBrowserTest {\n     public void secondTheme_staticFilesNotCopied() {\n         getDriver().get(getRootURL() + \"/path/VAADIN/static/img/bg.jpg\");\n         Assert.assertFalse(\"app-theme static files should be copied\",\n-                driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));\n+            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));\n \n         getDriver().get(getRootURL() + \"/path/VAADIN/static/no-copy.txt\");\n         Assert.assertTrue(\"no-copy theme should not be handled\",\n-                driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));\n+            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));\n     }\n \n     @Test\n"}}, {"oid": "c2b0d5c62bf4c83d0c6381e7e275663fec1dac07", "url": "https://github.com/vaadin/flow/commit/c2b0d5c62bf4c83d0c6381e7e275663fec1dac07", "message": "Update based on comments", "committedDate": "2020-12-01T07:34:49Z", "type": "commit"}, {"oid": "2bb8d35a1ce095c730a312711f9bdd9279d3673b", "url": "https://github.com/vaadin/flow/commit/2bb8d35a1ce095c730a312711f9bdd9279d3673b", "message": "Reformat", "committedDate": "2020-12-01T07:41:35Z", "type": "commit"}, {"oid": "d8474de155c1c6632a03db28ddaa43b0eca8743f", "url": "https://github.com/vaadin/flow/commit/d8474de155c1c6632a03db28ddaa43b0eca8743f", "message": "Reformat", "committedDate": "2020-12-01T07:49:04Z", "type": "commit"}, {"oid": "490533abc27b0867e66e930da09ba9bcbda09bc9", "url": "https://github.com/vaadin/flow/commit/490533abc27b0867e66e930da09ba9bcbda09bc9", "message": "Allow webpack css loader to import from node_modules", "committedDate": "2020-12-01T08:23:17Z", "type": "commit"}, {"oid": "b286d64eb31b4f9a0649c829cd3a82b54992d2fb", "url": "https://github.com/vaadin/flow/commit/b286d64eb31b4f9a0649c829cd3a82b54992d2fb", "message": "Fix the commit above - wrong config place", "committedDate": "2020-12-01T08:28:30Z", "type": "commit"}, {"oid": "f57db68ca8256b95f4058faa6cff957c38edade6", "url": "https://github.com/vaadin/flow/commit/f57db68ca8256b95f4058faa6cff957c38edade6", "message": "File-loader only copies files used as imports in .js files", "committedDate": "2020-12-01T09:23:55Z", "type": "commit"}, {"oid": "2c4f25c0f9a0d8ad57bb058d683adbfaad1803ed", "url": "https://github.com/vaadin/flow/commit/2c4f25c0f9a0d8ad57bb058d683adbfaad1803ed", "message": "Add file-loader to NodeUpdater", "committedDate": "2020-12-01T10:08:28Z", "type": "commit"}, {"oid": "736739b299c704f28c7bc2beee37f3e1b86f2fdd", "url": "https://github.com/vaadin/flow/commit/736739b299c704f28c7bc2beee37f3e1b86f2fdd", "message": "Fix test for import CSS", "committedDate": "2020-12-01T15:14:11Z", "type": "commit"}, {"oid": "953a82b99e087a080cb900743b7c2a9675c1756d", "url": "https://github.com/vaadin/flow/commit/953a82b99e087a080cb900743b7c2a9675c1756d", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-01T15:34:47Z", "type": "commit"}, {"oid": "27777eb143aca8715060170b6e29ec4a159ae08b", "url": "https://github.com/vaadin/flow/commit/27777eb143aca8715060170b6e29ec4a159ae08b", "message": "Allow importing css not only from node_modules", "committedDate": "2020-12-01T17:55:26Z", "type": "commit"}, {"oid": "b856802ce3473029a052060cd10eae0c42e176c1", "url": "https://github.com/vaadin/flow/commit/b856802ce3473029a052060cd10eae0c42e176c1", "message": "Also allow import css from frontend/theme", "committedDate": "2020-12-01T18:35:23Z", "type": "commit"}, {"oid": "ed0f83de1ce77adb02b282b47c0b346d0a66ab50", "url": "https://github.com/vaadin/flow/commit/ed0f83de1ce77adb02b282b47c0b346d0a66ab50", "message": "Skip translating external URLs", "committedDate": "2020-12-02T07:56:14Z", "type": "commit"}, {"oid": "83edc8f9bfc42d08d0bc3466269df3bf79f08d90", "url": "https://github.com/vaadin/flow/commit/83edc8f9bfc42d08d0bc3466269df3bf79f08d90", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-02T07:59:09Z", "type": "commit"}, {"oid": "cca1dc2f3d50dccef1091f11232b4c0ccd6163ba", "url": "https://github.com/vaadin/flow/commit/cca1dc2f3d50dccef1091f11232b4c0ccd6163ba", "message": "correct the path for background-image", "committedDate": "2020-12-04T10:48:42Z", "type": "commit"}, {"oid": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "url": "https://github.com/vaadin/flow/commit/be290d7635a2d32b3c47601adea19b18ee53dcd0", "message": "merged with master", "committedDate": "2020-12-04T11:19:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2MjU0OQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537262549", "bodyText": "Remove the extra file-loader as it was added from the merge in master. see 3 lines down", "author": "caalador", "createdAt": "2020-12-07T06:34:42Z", "path": "flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java", "diffHunk": "@@ -303,6 +303,7 @@ static void addVaadinDefaultsToJson(JsonObject json) {\n         defaults.put(\"compression-webpack-plugin\", \"4.0.1\");\n         defaults.put(\"webpack-merge\", \"4.2.2\");\n         defaults.put(\"css-loader\", \"4.2.1\");\n+        defaults.put(\"file-loader\", \"6.1.0\");", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzcxODg0Ng==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537718846", "bodyText": "Done.", "author": "taefi", "createdAt": "2020-12-07T18:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2MjU0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "786ec8c2f8d40fb094227998551f6334a32bbcef", "chunk": "diff --git a/flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java b/flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java\nindex ca49bd628f..8c96021f7e 100644\n--- a/flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java\n+++ b/flow-server/src/main/java/com/vaadin/flow/server/frontend/NodeUpdater.java\n\n@@ -303,7 +303,6 @@ public abstract class NodeUpdater implements FallibleCommand {\n         defaults.put(\"compression-webpack-plugin\", \"4.0.1\");\n         defaults.put(\"webpack-merge\", \"4.2.2\");\n         defaults.put(\"css-loader\", \"4.2.1\");\n-        defaults.put(\"file-loader\", \"6.1.0\");\n         defaults.put(\"extract-loader\", \"5.1.0\");\n         defaults.put(\"lit-css-loader\", \"0.0.4\");\n         defaults.put(\"file-loader\", \"6.1.0\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDM0OQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537264349", "bodyText": "Should this check for something more. Are we certain the resource is available just because the css has been applied and no exceptions are on the console?\nShould we also check the resource e.g.\n        getDriver().get(getRootURL() + \"/path/VAADIN/static/[THE_RESOURCE_THAT_IS_EXPECTED]\");\n        Assert.assertFalse(\"Font resource should be available\",\n            driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));", "author": "caalador", "createdAt": "2020-12-07T06:39:41Z", "path": "flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java", "diffHunk": "@@ -79,6 +80,16 @@ public void applicationTheme_GlobalCss_isUsed() {\n             driver.getPageSource().contains(\"Could not navigate\"));\n     }\n \n+    @Test\n+    public void applicationTheme_importCSS_isUsed() {\n+        open();\n+        checkLogsForErrors();\n+\n+        Assert.assertEquals(\"Imported FontAwesome css file should be applied.\",\n+                \"\\\"Font Awesome 5 Brands\\\"\", $(SpanElement.class).id(FONTAWESOME_ID)\n+                        .getCssValue(\"font-family\"));", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3MjAxOQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538472019", "bodyText": "Done.", "author": "taefi", "createdAt": "2020-12-08T15:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDM0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "4c8a22c8da0b861e1145510321f35ad66dda21eb", "chunk": "diff --git a/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java b/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\nindex aeb42154ed..5be840b620 100644\n--- a/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\n+++ b/flow-tests/test-themes/src/test/java/com/vaadin/flow/uitest/ui/theme/ThemeIT.java\n\n@@ -85,9 +86,21 @@ public class ThemeIT extends ChromeBrowserTest {\n         open();\n         checkLogsForErrors();\n \n-        Assert.assertEquals(\"Imported FontAwesome css file should be applied.\",\n-                \"\\\"Font Awesome 5 Brands\\\"\", $(SpanElement.class).id(FONTAWESOME_ID)\n+        Assert.assertEquals(\n+            \"Imported FontAwesome css file should be applied.\",\n+            \"\\\"Font Awesome 5 Free\\\"\", $(SpanElement.class).id(FONTAWESOME_ID)\n                         .getCssValue(\"font-family\"));\n+\n+        String iconUnicode = getCssPseudoElementValue(FONTAWESOME_ID,\n+                                          \"::before\");\n+        Assert.assertEquals(\n+           \"Font-Icon from FontAwesome css file should be applied.\",\n+           \"\\\"\\uf0f4\\\"\", iconUnicode);\n+\n+        getDriver().get(getRootURL() +\n+                \"/path/VAADIN/static/@fortawesome/fontawesome-free/webfonts/fa-solid-900.svg\");\n+        Assert.assertFalse(\"Font resource should be available\",\n+                driver.getPageSource().contains(\"HTTP ERROR 404 Not Found\"));\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDcwMQ==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r537264701", "bodyText": "Does this give something visible or should we add a icon class name also?", "author": "caalador", "createdAt": "2020-12-07T06:40:42Z", "path": "flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java", "diffHunk": "@@ -45,12 +46,16 @@ public ThemeView() {\n         Span octopuss = new Span();\n         octopuss.setId(OCTOPUSS_ID);\n \n+        Span faText = new Span(\"This test is FontAwesome.\");\n+        faText.setClassName(\"fab\");", "originalCommit": "be290d7635a2d32b3c47601adea19b18ee53dcd0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3MTk3MA==", "url": "https://github.com/vaadin/flow/pull/9543#discussion_r538471970", "bodyText": "Added an Icon. Done.", "author": "taefi", "createdAt": "2020-12-08T15:04:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzI2NDcwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "4c8a22c8da0b861e1145510321f35ad66dda21eb", "chunk": "diff --git a/flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java b/flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java\nindex fc86e89ae8..4e45791c8f 100644\n--- a/flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java\n+++ b/flow-tests/test-themes/src/main/java/com/vaadin/flow/uitest/ui/theme/ThemeView.java\n\n@@ -47,7 +47,7 @@ public class ThemeView extends Div {\n         octopuss.setId(OCTOPUSS_ID);\n \n         Span faText = new Span(\"This test is FontAwesome.\");\n-        faText.setClassName(\"fab\");\n+        faText.setClassName(\"fas fa-coffee\");\n         faText.setId(FONTAWESOME_ID);\n \n         Image snowFlake = new Image(\n"}}, {"oid": "786ec8c2f8d40fb094227998551f6334a32bbcef", "url": "https://github.com/vaadin/flow/commit/786ec8c2f8d40fb094227998551f6334a32bbcef", "message": "omit duplicate definition of file-loader dependency", "committedDate": "2020-12-07T18:09:16Z", "type": "commit"}, {"oid": "3a06b5480711616ed24538d7d1850a9a06e8d8a6", "url": "https://github.com/vaadin/flow/commit/3a06b5480711616ed24538d7d1850a9a06e8d8a6", "message": "removed the leading path in butterfly selector", "committedDate": "2020-12-08T12:46:26Z", "type": "commit"}, {"oid": "4c8a22c8da0b861e1145510321f35ad66dda21eb", "url": "https://github.com/vaadin/flow/commit/4c8a22c8da0b861e1145510321f35ad66dda21eb", "message": "apply review comments", "committedDate": "2020-12-08T15:02:51Z", "type": "commit"}, {"oid": "59df29f32ceafcdb99e4ccef230f40a1fcf0a297", "url": "https://github.com/vaadin/flow/commit/59df29f32ceafcdb99e4ccef230f40a1fcf0a297", "message": "increase app theme plugin version", "committedDate": "2020-12-08T22:42:14Z", "type": "commit"}, {"oid": "21350169bae0a31a0289c54b52d26c9d45a7c762", "url": "https://github.com/vaadin/flow/commit/21350169bae0a31a0289c54b52d26c9d45a7c762", "message": "Merge branch 'master' into issues/9410-import-css", "committedDate": "2020-12-09T06:42:13Z", "type": "commit"}]}