{"pr_number": 7353, "pr_title": "Restore deprecated API for executing JS", "pr_createdAt": "2020-01-15T07:42:31Z", "pr_url": "https://github.com/vaadin/flow/pull/7353", "timeline": [{"oid": "69d2b1aee0dba55422503835c0578b64b61ae100", "url": "https://github.com/vaadin/flow/commit/69d2b1aee0dba55422503835c0578b64b61ae100", "message": "Restore deprecated API for executing JS\n\nRemoval of the deprecated methods for executing JS would cause lots of\notherwise compatible add-ons to stop working. Updating those add-ons to\nuse the new API would instead make it so that the same version of the\nadd-on cannot be used with both Vaadin 10 and Vaadin 15. For these\nreasons, these three methods are restored as simple shorthands that\ndelegate to the non-deprecated methods.", "committedDate": "2020-01-15T07:41:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MjY1OQ==", "url": "https://github.com/vaadin/flow/pull/7353#discussion_r366762659", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-01-15T09:11:18Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/page/Page.java", "diffHunk": "@@ -284,6 +303,42 @@ public void addDynamicImport(String expression) {\n         addDependency(new Dependency(Type.DYNAMIC_IMPORT, expression));\n     }\n \n+    // When updating JavaDocs here, keep in sync with Element.executeJavaScript\n+    /**\n+     * Asynchronously runs the given JavaScript expression in the browser. The\n+     * given parameters will be available to the expression as variables named\n+     * <code>$0</code>, <code>$1</code>, and so on. Supported parameter types\n+     * are:\n+     * <ul>\n+     * <li>{@link String}\n+     * <li>{@link Integer}\n+     * <li>{@link Double}\n+     * <li>{@link Boolean}\n+     * <li>{@link JsonValue}\n+     * <li>{@link Element} (will be sent as <code>null</code> if the server-side\n+     * element instance is not attached when the invocation is sent to the\n+     * client)\n+     * </ul>\n+     * Note that the parameter variables can only be used in contexts where a\n+     * JavaScript variable can be used. You should for instance do\n+     * <code>'prefix' + $0</code> instead of <code>'prefix$0'</code> and\n+     * <code>value[$0]</code> instead of <code>value.$0</code> since JavaScript\n+     * variables aren't evaluated inside strings or property names.\n+     *\n+     * @param expression\n+     *            the JavaScript expression to invoke\n+     * @param parameters\n+     *            parameters to pass to the expression\n+     * @return a callback for canceling the execution if not yet sent to browser\n+     * @deprecated Use {@link #executeJs(String,Serializable...)} instead since\n+     *             it also allows getting return value back.\n+     */\n+    @Deprecated\n+    public ExecutionCanceler executeJavaScript(String expression,", "originalCommit": "69d2b1aee0dba55422503835c0578b64b61ae100", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MjY3MA==", "url": "https://github.com/vaadin/flow/pull/7353#discussion_r366762670", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-01-15T09:11:20Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/page/Page.java", "diffHunk": "@@ -128,6 +128,25 @@ public void remove() {\n \n     private ResizeEventReceiver resizeReceiver;\n \n+    /**\n+     * Callback method for canceling executable javascript set with\n+     * {@link Page#executeJs(String, Serializable...)}.\n+     *\n+     * @deprecated superseded by {@link PendingJavaScriptResult}\n+     */\n+    @FunctionalInterface\n+    @Deprecated\n+    public interface ExecutionCanceler extends Serializable {", "originalCommit": "69d2b1aee0dba55422503835c0578b64b61ae100", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MjY4MQ==", "url": "https://github.com/vaadin/flow/pull/7353#discussion_r366762681", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-01-15T09:11:21Z", "path": "flow-server/src/main/java/com/vaadin/flow/dom/Element.java", "diffHunk": "@@ -1593,6 +1622,43 @@ public PendingJavaScriptResult callJsFunction(String functionName,\n                 + paramPlaceholderString + \")\", jsParameters);\n     }\n \n+    // When updating JavaDocs here, keep in sync with Page.executeJavaScript\n+    /**\n+     * Asynchronously runs the given JavaScript expression in the browser in the\n+     * context of this element. This element will be available to the expression\n+     * as <code>this</code>. The given parameters will be available as variables\n+     * named <code>$0</code>, <code>$1</code>, and so on. Supported parameter\n+     * types are:\n+     * <ul>\n+     * <li>{@link String}\n+     * <li>{@link Integer}\n+     * <li>{@link Double}\n+     * <li>{@link Boolean}\n+     * <li>{@link JsonValue}\n+     * <li>{@link Element} (will be sent as <code>null</code> if the server-side\n+     * element instance is not attached when the invocation is sent to the\n+     * client)\n+     * </ul>\n+     * Note that the parameter variables can only be used in contexts where a\n+     * JavaScript variable can be used. You should for instance do\n+     * <code>'prefix' + $0</code> instead of <code>'prefix$0'</code> and\n+     * <code>value[$0]</code> instead of <code>value.$0</code> since JavaScript\n+     * variables aren't evaluated inside strings or property names.\n+     *\n+     * @param expression\n+     *            the JavaScript expression to invoke\n+     * @param parameters\n+     *            parameters to pass to the expression\n+     * @deprecated Use {@link #executeJs(String,Serializable...)} instead since\n+     *             it also allows getting return value back.\n+     */\n+    @Deprecated\n+    public void executeJavaScript(String expression,", "originalCommit": "69d2b1aee0dba55422503835c0578b64b61ae100", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MjY4OA==", "url": "https://github.com/vaadin/flow/pull/7353#discussion_r366762688", "bodyText": "Do not forget to remove this deprecated code someday.", "author": "vaadin-bot", "createdAt": "2020-01-15T09:11:22Z", "path": "flow-server/src/main/java/com/vaadin/flow/dom/Element.java", "diffHunk": "@@ -1550,6 +1550,35 @@ public String getOuterHTML() {\n         return ComponentUtil.componentFromElement(this, componentType, false);\n     }\n \n+    /**\n+     * Calls the given function on the element with the given arguments.\n+     * <p>\n+     * The function will be called after all pending DOM updates have completed,\n+     * at the same time that {@link Page#executeJs(String, Serializable...)}\n+     * calls are invoked.\n+     * <p>\n+     * If the element is not attached, the function call will be deferred until\n+     * the element is attached.\n+     *\n+     * @see JsonCodec JsonCodec for supported argument types\n+     *\n+     * @param functionName\n+     *            the name of the function to call, may contain dots to indicate\n+     *            a function on a property.\n+     * @param arguments\n+     *            the arguments to pass to the function. Must be of a type\n+     *            supported by the communication mechanism, as defined by\n+     *            {@link JsonCodec}\n+     *\n+     * @deprecated Use {@link #callJsFunction(String,Serializable...)} instead\n+     *             since it also allows getting return value back.\n+     */\n+    @Deprecated\n+    public void callFunction(String functionName, Serializable... arguments) {", "originalCommit": "69d2b1aee0dba55422503835c0578b64b61ae100", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njc2MjcwNA==", "url": "https://github.com/vaadin/flow/pull/7353#discussion_r366762704", "bodyText": "Remove this use of \"ExecutionCanceler\"; it is deprecated.", "author": "vaadin-bot", "createdAt": "2020-01-15T09:11:23Z", "path": "flow-server/src/main/java/com/vaadin/flow/component/page/PendingJavaScriptResult.java", "diffHunk": "@@ -40,7 +41,8 @@\n  * @author Vaadin Ltd\n  * @since 2.0\n  */\n-public interface PendingJavaScriptResult extends Serializable {\n+public interface PendingJavaScriptResult\n+        extends Serializable, ExecutionCanceler {", "originalCommit": "69d2b1aee0dba55422503835c0578b64b61ae100", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}