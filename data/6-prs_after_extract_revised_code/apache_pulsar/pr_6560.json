{"pr_number": 6560, "pr_title": "Fix: topic with one partition cannot be updated", "pr_createdAt": "2020-03-19T06:11:10Z", "pr_url": "https://github.com/apache/pulsar/pull/6560", "timeline": [{"oid": "4b8aeac3a63ccaf6df276457beb934a4649b3e7d", "url": "https://github.com/apache/pulsar/commit/4b8aeac3a63ccaf6df276457beb934a4649b3e7d", "message": "Fix: topic with one partition cannot be updated", "committedDate": "2020-03-19T06:14:01Z", "type": "commit"}, {"oid": "4b8aeac3a63ccaf6df276457beb934a4649b3e7d", "url": "https://github.com/apache/pulsar/commit/4b8aeac3a63ccaf6df276457beb934a4649b3e7d", "message": "Fix: topic with one partition cannot be updated", "committedDate": "2020-03-19T06:14:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTExNjUxMw==", "url": "https://github.com/apache/pulsar/pull/6560#discussion_r395116513", "bodyText": "Shouldn't this be changed into < 1 ?", "author": "merlimat", "createdAt": "2020-03-19T15:31:58Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java", "diffHunk": "@@ -2162,11 +2162,6 @@ private PersistentReplicator getReplicatorReference(String replName, PersistentT\n         String path = path(PARTITIONED_TOPIC_PATH_ZNODE, topicName.getPersistenceNamingEncoding());\n         CompletableFuture<Void> result = new CompletableFuture<>();\n         pulsar().getBrokerService().fetchPartitionedTopicMetadataAsync(topicName).thenAccept(partitionMetadata -> {\n-            if (partitionMetadata.partitions <= 1) {", "originalCommit": "4b8aeac3a63ccaf6df276457beb934a4649b3e7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIwODkxNw==", "url": "https://github.com/apache/pulsar/pull/6560#discussion_r395208917", "bodyText": "No, it means to throw exception if partitionMetadata.partitions == 0 (which is the case when topic is not partitioned), though not throwing it when partitionMetadata.partitions == 1 (as we're incorrectly doing now) or when partitionMetadata.partitions > 1 (which is already correctly handled).", "author": "merlimat", "createdAt": "2020-03-19T17:44:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTExNjUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTIxMTE0Mg==", "url": "https://github.com/apache/pulsar/pull/6560#discussion_r395211142", "bodyText": "will fix", "author": "jerrypeng", "createdAt": "2020-03-19T17:47:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTExNjUxMw=="}], "type": "inlineReview", "revised_code": {"commit": "d1feb43bfff34366294656be6f91597702a041bc", "chunk": "diff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\nindex 8c2a0ccd4fa..8555b65b6e2 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java\n\n@@ -2162,6 +2162,11 @@ public class PersistentTopicsBase extends AdminResource {\n         String path = path(PARTITIONED_TOPIC_PATH_ZNODE, topicName.getPersistenceNamingEncoding());\n         CompletableFuture<Void> result = new CompletableFuture<>();\n         pulsar().getBrokerService().fetchPartitionedTopicMetadataAsync(topicName).thenAccept(partitionMetadata -> {\n+            if (partitionMetadata.partitions < 1) {\n+                result.completeExceptionally(new RestException(Status.CONFLICT, \"Topic is not partitioned topic\"));\n+                return;\n+            }\n+\n             if (partitionMetadata.partitions >= numPartitions) {\n                 result.completeExceptionally(new RestException(Status.CONFLICT,\n                         \"number of partitions must be more than existing \" + partitionMetadata.partitions));\n"}}, {"oid": "d1feb43bfff34366294656be6f91597702a041bc", "url": "https://github.com/apache/pulsar/commit/d1feb43bfff34366294656be6f91597702a041bc", "message": "addressing issue", "committedDate": "2020-03-19T17:53:20Z", "type": "commit"}]}