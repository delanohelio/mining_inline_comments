{"pr_number": 7164, "pr_title": "fix get partitioned metadata  throws NullPointerException", "pr_createdAt": "2020-06-04T03:53:25Z", "pr_url": "https://github.com/apache/pulsar/pull/7164", "timeline": [{"oid": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687", "url": "https://github.com/apache/pulsar/commit/419fd5c7b8c8282c25b1731df65a2ce56ffd5687", "message": "fix get partitioned metadata  throws NullPointerException", "committedDate": "2020-06-04T04:46:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0ODk1NQ==", "url": "https://github.com/apache/pulsar/pull/7164#discussion_r435348955", "bodyText": "We should return an error in the future at this point, otherwise we're moving the NPE somewhere else", "author": "merlimat", "createdAt": "2020-06-04T15:30:12Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "diffHunk": "@@ -1918,6 +1918,9 @@ private void createPendingLoadTopic() {\n     }\n \n     public CompletableFuture<PartitionedTopicMetadata> fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(TopicName topicName) {\n+        if(pulsar.getNamespaceService() == null){\n+            return CompletableFuture.completedFuture(null);", "originalCommit": "419fd5c7b8c8282c25b1731df65a2ce56ffd5687", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY3NzIyOQ==", "url": "https://github.com/apache/pulsar/pull/7164#discussion_r435677229", "bodyText": "OK", "author": "liudezhi2098", "createdAt": "2020-06-05T03:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0ODk1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "db934b901479aa62a70634762467a4867ecd5d25", "chunk": "diff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java\nindex 69fdc7348e6..388d74c9bd8 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java\n\n@@ -1919,7 +1919,7 @@ public class BrokerService implements Closeable, ZooKeeperCacheListener<Policies\n \n     public CompletableFuture<PartitionedTopicMetadata> fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(TopicName topicName) {\n         if(pulsar.getNamespaceService() == null){\n-            return CompletableFuture.completedFuture(null);\n+            return FutureUtil.failedFuture(new NullPointerException(\"namespaceService is null\"));\n         }\n         return pulsar.getNamespaceService().checkTopicExists(topicName)\n                 .thenCompose(topicExists -> {\n"}}, {"oid": "e5a16778683fbc87955b010dfe97872a75231fd9", "url": "https://github.com/apache/pulsar/commit/e5a16778683fbc87955b010dfe97872a75231fd9", "message": "fix get partitioned metadata  throws NullPointerException", "committedDate": "2020-06-05T06:13:05Z", "type": "commit"}, {"oid": "db934b901479aa62a70634762467a4867ecd5d25", "url": "https://github.com/apache/pulsar/commit/db934b901479aa62a70634762467a4867ecd5d25", "message": " return an error in the future", "committedDate": "2020-06-05T06:13:05Z", "type": "commit"}, {"oid": "db934b901479aa62a70634762467a4867ecd5d25", "url": "https://github.com/apache/pulsar/commit/db934b901479aa62a70634762467a4867ecd5d25", "message": " return an error in the future", "committedDate": "2020-06-05T06:13:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQyMTczMA==", "url": "https://github.com/apache/pulsar/pull/7164#discussion_r436421730", "bodyText": "I think we should return an explicit error to tell the application that the namespace service is not ready.", "author": "sijie", "createdAt": "2020-06-08T01:19:17Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java", "diffHunk": "@@ -1918,6 +1918,9 @@ private void createPendingLoadTopic() {\n     }\n \n     public CompletableFuture<PartitionedTopicMetadata> fetchPartitionedTopicMetadataCheckAllowAutoCreationAsync(TopicName topicName) {\n+        if(pulsar.getNamespaceService() == null){\n+            return FutureUtil.failedFuture(new NullPointerException(\"namespaceService is null\"));", "originalCommit": "db934b901479aa62a70634762467a4867ecd5d25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}