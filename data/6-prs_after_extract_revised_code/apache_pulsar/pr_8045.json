{"pr_number": 8045, "pr_title": "Add an REST endpoint to trigger backlogQuotaCheck", "pr_createdAt": "2020-09-12T15:05:46Z", "pr_url": "https://github.com/apache/pulsar/pull/8045", "timeline": [{"oid": "c765dc316324e997bc0ab3d67500212c5fd9e70f", "url": "https://github.com/apache/pulsar/commit/c765dc316324e997bc0ab3d67500212c5fd9e70f", "message": "add an REST endpoint to trigger backlogQuotaCheck", "committedDate": "2020-09-12T15:00:54Z", "type": "commit"}, {"oid": "9e85b45ceadaea6f17e557278dd8bb533f46ed45", "url": "https://github.com/apache/pulsar/commit/9e85b45ceadaea6f17e557278dd8bb533f46ed45", "message": "fix testDuplication often fails", "committedDate": "2020-09-12T16:02:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDA5NA==", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434094", "bodyText": "I don't think we use CamelCase for naming the endpoint. We can rename it to /backlog-quota-check.", "author": "sijie", "createdAt": "2020-09-15T07:05:53Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java", "diffHunk": "@@ -255,6 +256,26 @@ public InternalConfigurationData getInternalConfigurationData() {\n         return pulsar().getInternalConfigurationData();\n     }\n \n+    @GET\n+    @Path(\"/backlogQuotaCheck\")", "originalCommit": "9e85b45ceadaea6f17e557278dd8bb533f46ed45", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e1ccce0930eef34903c56e7d231327a7705e8059", "chunk": "diff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java\nindex 947de108cbc..48eb8bc2121 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java\n\n@@ -257,7 +257,7 @@ public class BrokersBase extends AdminResource {\n     }\n \n     @GET\n-    @Path(\"/backlogQuotaCheck\")\n+    @Path(\"/backlog-quota-check\")\n     @ApiOperation(value = \"An REST endpoint to trigger backlogQuotaCheck\")\n     @ApiResponses(value = {\n             @ApiResponse(code = 200, message = \"Everything is OK\"),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDMyMw==", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434323", "bodyText": "why do we need to add sleep here?", "author": "sijie", "createdAt": "2020-09-15T07:06:20Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java", "diffHunk": "@@ -69,6 +69,7 @@ public void testDuplicationApi() throws Exception {\n         assertNull(enabled);\n \n         admin.topics().enableDeduplication(topicName, true);\n+        Thread.sleep(1000);", "originalCommit": "9e85b45ceadaea6f17e557278dd8bb533f46ed45", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e1ccce0930eef34903c56e7d231327a7705e8059", "chunk": "diff --git a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java\nindex 6cd46df0a1d..faa010af791 100644\n--- a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java\n+++ b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java\n\n@@ -69,7 +69,6 @@ public class TopicDuplicationTest extends ProducerConsumerBase {\n         assertNull(enabled);\n \n         admin.topics().enableDeduplication(topicName, true);\n-        Thread.sleep(1000);\n         for (int i = 0; i < 50; i++) {\n             if (admin.topics().getMaxUnackedMessagesOnSubscription(topicName) != null) {\n                 break;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQzNDUxOA==", "url": "https://github.com/apache/pulsar/pull/8045#discussion_r488434518", "bodyText": "same comment as above.", "author": "sijie", "createdAt": "2020-09-15T07:06:44Z", "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java", "diffHunk": "@@ -135,5 +146,6 @@ public CmdBrokers(PulsarAdmin admin) {\n         jcommander.addCommand(\"get-internal-config\", new GetInternalConfigurationCmd());\n         jcommander.addCommand(\"get-runtime-config\", new GetRuntimeConfigCmd());\n         jcommander.addCommand(\"healthcheck\", new HealthcheckCmd());\n+        jcommander.addCommand(\"backlogQuotaCheck\", new BacklogQuotaCheckCmd());", "originalCommit": "9e85b45ceadaea6f17e557278dd8bb533f46ed45", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e1ccce0930eef34903c56e7d231327a7705e8059", "chunk": "diff --git a/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java b/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java\nindex 6ac1d5f7af6..b356938acba 100644\n--- a/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java\n+++ b/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java\n\n@@ -146,6 +146,6 @@ public class CmdBrokers extends CmdBase {\n         jcommander.addCommand(\"get-internal-config\", new GetInternalConfigurationCmd());\n         jcommander.addCommand(\"get-runtime-config\", new GetRuntimeConfigCmd());\n         jcommander.addCommand(\"healthcheck\", new HealthcheckCmd());\n-        jcommander.addCommand(\"backlogQuotaCheck\", new BacklogQuotaCheckCmd());\n+        jcommander.addCommand(\"backlog-quota-check\", new BacklogQuotaCheckCmd());\n     }\n }\n"}}, {"oid": "e1ccce0930eef34903c56e7d231327a7705e8059", "url": "https://github.com/apache/pulsar/commit/e1ccce0930eef34903c56e7d231327a7705e8059", "message": "fix style", "committedDate": "2020-09-15T07:37:33Z", "type": "commit"}, {"oid": "2aa76cc600eb78956cd5960a7c5982487e9c71a5", "url": "https://github.com/apache/pulsar/commit/2aa76cc600eb78956cd5960a7c5982487e9c71a5", "message": "Merge branch 'master' into endpoint", "committedDate": "2020-09-17T02:25:21Z", "type": "commit"}]}