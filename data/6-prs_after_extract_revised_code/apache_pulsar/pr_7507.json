{"pr_number": 7507, "pr_title": "The test should wait until the worker leader is ready, otherwise the request to create function will fail", "pr_createdAt": "2020-07-10T21:15:13Z", "pr_url": "https://github.com/apache/pulsar/pull/7507", "timeline": [{"oid": "2049ea10fef21e62c7ab9e9833f5984210f1843b", "url": "https://github.com/apache/pulsar/commit/2049ea10fef21e62c7ab9e9833f5984210f1843b", "message": "The test should wait until the worker leader is ready, otherwise the request to create function will fail", "committedDate": "2020-07-10T21:12:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4MjA4Mw==", "url": "https://github.com/apache/pulsar/pull/7507#discussion_r453082083", "bodyText": "I would put this in the setup method", "author": "jerrypeng", "createdAt": "2020-07-10T21:19:45Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java", "diffHunk": "@@ -1493,6 +1493,7 @@ public void testPulsarFunctionStatus() throws Exception {\n \n     @Test(dataProvider = \"validRoleName\")\n     public void testAuthorization(boolean validRoleName) throws Exception {\n+        functionsWorkerService.getLeaderService().waitLeaderInit();", "originalCommit": "2049ea10fef21e62c7ab9e9833f5984210f1843b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4MjEzNA==", "url": "https://github.com/apache/pulsar/pull/7507#discussion_r453082134", "bodyText": "at the end of the setup method", "author": "jerrypeng", "createdAt": "2020-07-10T21:19:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4MjA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4NjYzMg==", "url": "https://github.com/apache/pulsar/pull/7507#discussion_r453086632", "bodyText": "done", "author": "merlimat", "createdAt": "2020-07-10T21:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4MjA4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "e8b7dfbaee3c565e45257f17329096d00a9363df", "chunk": "diff --git a/pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java b/pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java\nindex 30581ea83ed..456ab4b78c2 100644\n--- a/pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java\n+++ b/pulsar-broker/src/test/java/org/apache/pulsar/io/PulsarFunctionE2ETest.java\n\n@@ -1493,8 +1497,6 @@ public class PulsarFunctionE2ETest {\n \n     @Test(dataProvider = \"validRoleName\")\n     public void testAuthorization(boolean validRoleName) throws Exception {\n-        functionsWorkerService.getLeaderService().waitLeaderInit();\n-\n         final String namespacePortion = \"io\";\n         final String replNamespace = tenant + \"/\" + namespacePortion;\n         final String sinkTopic = \"persistent://\" + replNamespace + \"/output\";\n"}}, {"oid": "e8b7dfbaee3c565e45257f17329096d00a9363df", "url": "https://github.com/apache/pulsar/commit/e8b7dfbaee3c565e45257f17329096d00a9363df", "message": "Moved to test setup", "committedDate": "2020-07-10T21:32:10Z", "type": "commit"}]}