{"pr_number": 8824, "pr_title": "[Issue 8338][Function Worker] Splitting the authentication logic of function worker and client", "pr_createdAt": "2020-12-04T06:49:33Z", "pr_url": "https://github.com/apache/pulsar/pull/8824", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMDAzOA==", "url": "https://github.com/apache/pulsar/pull/8824#discussion_r535900038", "bodyText": "Don't use boolean. This would cause a compatibility issue. The worker service is not able to start with an old configuration.\nUse boxed Boolean.\nprivate Boolean brokerClientAuthenticationEnabled = null;\n\nThen add an implementation isBrokerClientAuthenticationEnabled to check if brokerClientAuthenticationEnabled is set or not. If brokerClientAuthenticationEnabled is not set, fall back to use authenticationEnabled.\npublic boolean isBrokerClientAuthenticationEnabled() {\n    if (brokerClientAuthenticationEnabled != null) {\n        return brokerClientAuthenticationEnabled;\n    } else {\n        return authenticationEnabled;\n    }\n}", "author": "sijie", "createdAt": "2020-12-04T07:50:21Z", "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java", "diffHunk": "@@ -273,6 +273,11 @@\n         doc = \"The frequency of instance liveness check, in milliseconds\"\n     )\n     private long instanceLivenessCheckFreqMs;\n+    @FieldContext(\n+            category = CATEGORY_CLIENT_SECURITY,\n+            doc = \"Whether to enable the broker client authentication used by function workers to talk to brokers\"\n+    )\n+    private boolean brokerClientAuthenticationEnabled = false;", "originalCommit": "ea3adcff255e62950dc4b26288bfe1ec6ddeaa48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwNzkwOQ==", "url": "https://github.com/apache/pulsar/pull/8824#discussion_r535907909", "bodyText": "@sijie Done.", "author": "nodece", "createdAt": "2020-12-04T08:05:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMDAzOA=="}], "type": "inlineReview", "revised_code": {"commit": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "chunk": "diff --git a/pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java b/pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\nindex fdbcd8ce246..18f1a966d77 100644\n--- a/pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\n+++ b/pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java\n\n@@ -277,7 +277,14 @@ public class WorkerConfig implements Serializable, PulsarConfiguration {\n             category = CATEGORY_CLIENT_SECURITY,\n             doc = \"Whether to enable the broker client authentication used by function workers to talk to brokers\"\n     )\n-    private boolean brokerClientAuthenticationEnabled = false;\n+    private Boolean brokerClientAuthenticationEnabled = null;\n+    public boolean isBrokerClientAuthenticationEnabled() {\n+        if (brokerClientAuthenticationEnabled != null) {\n+            return brokerClientAuthenticationEnabled;\n+        } else {\n+            return authenticationEnabled;\n+        }\n+    }\n     @FieldContext(\n         category = CATEGORY_CLIENT_SECURITY,\n         doc = \"The authentication plugin used by function workers to talk to brokers\"\n"}}, {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>", "committedDate": "2020-12-04T08:05:38Z", "type": "commit"}, {"oid": "c4f197d7ac8f93303068c57cece05cbbf029c11f", "url": "https://github.com/apache/pulsar/commit/c4f197d7ac8f93303068c57cece05cbbf029c11f", "message": "Splitting the authentication logic of function worker and client\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>", "committedDate": "2020-12-04T08:05:38Z", "type": "forcePushed"}]}