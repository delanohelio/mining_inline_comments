{"pr_number": 6193, "pr_title": "Fix get schema version in HttpLookupService.", "pr_createdAt": "2020-02-03T16:35:44Z", "pr_url": "https://github.com/apache/pulsar/pull/6193", "timeline": [{"oid": "10ec8fece780d6e03c39466d2e545f91e4cd2634", "url": "https://github.com/apache/pulsar/commit/10ec8fece780d6e03c39466d2e545f91e4cd2634", "message": "Fix get schema version in HttpLookupService.", "committedDate": "2020-02-03T16:26:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI1MTgzMw==", "url": "https://github.com/apache/pulsar/pull/6193#discussion_r374251833", "bodyText": "hmm. this would result in copying memory. and it is not thread-safe.\nI would suggest just using ByteBuffer.wrap(bytes) to get a ByteBuffer and then read the long number.", "author": "sijie", "createdAt": "2020-02-03T18:00:09Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java", "diffHunk": "@@ -176,5 +176,12 @@ public void close() throws Exception {\n         httpClient.close();\n     }\n \n+    private long bytesToLong(byte[] bytes) {\n+        schemaVersionConvertBuffer.clear();\n+        schemaVersionConvertBuffer.put(bytes, 0, bytes.length);", "originalCommit": "10ec8fece780d6e03c39466d2e545f91e4cd2634", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1c5455a3748484cd1f75e35ce90f11cdfcfb20ff", "chunk": "diff --git a/pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java\nindex 68fdcefcecf..5bc3bcd135f 100644\n--- a/pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java\n+++ b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java\n\n@@ -176,12 +175,5 @@ public class HttpLookupService implements LookupService {\n         httpClient.close();\n     }\n \n-    private long bytesToLong(byte[] bytes) {\n-        schemaVersionConvertBuffer.clear();\n-        schemaVersionConvertBuffer.put(bytes, 0, bytes.length);\n-        schemaVersionConvertBuffer.flip();\n-        return schemaVersionConvertBuffer.getLong();\n-    }\n-\n     private static final Logger log = LoggerFactory.getLogger(HttpLookupService.class);\n }\n"}}, {"oid": "1c5455a3748484cd1f75e35ce90f11cdfcfb20ff", "url": "https://github.com/apache/pulsar/commit/1c5455a3748484cd1f75e35ce90f11cdfcfb20ff", "message": "Apply comment", "committedDate": "2020-02-04T00:39:14Z", "type": "commit"}, {"oid": "c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "url": "https://github.com/apache/pulsar/commit/c9f0b74b131f3d8c90a3edc4dc72e415e6d0f1f5", "message": "Merge remote-tracking branch 'apache/master' into fix_get_schema_by_version", "committedDate": "2020-02-04T19:26:02Z", "type": "commit"}, {"oid": "d62818e4b6c24f4f8e0f81b340a5a1fe41ef3901", "url": "https://github.com/apache/pulsar/commit/d62818e4b6c24f4f8e0f81b340a5a1fe41ef3901", "message": "Fix get schema version in HttpLookupService.", "committedDate": "2020-02-06T13:04:16Z", "type": "commit"}, {"oid": "8eb079061013c53d8b0a9d284d95afab0c755efd", "url": "https://github.com/apache/pulsar/commit/8eb079061013c53d8b0a9d284d95afab0c755efd", "message": "Apply comment", "committedDate": "2020-02-06T13:04:16Z", "type": "commit"}, {"oid": "8eb079061013c53d8b0a9d284d95afab0c755efd", "url": "https://github.com/apache/pulsar/commit/8eb079061013c53d8b0a9d284d95afab0c755efd", "message": "Apply comment", "committedDate": "2020-02-06T13:04:16Z", "type": "forcePushed"}, {"oid": "ca8886e64c2f36731bf8bae8e758886abc5258dd", "url": "https://github.com/apache/pulsar/commit/ca8886e64c2f36731bf8bae8e758886abc5258dd", "message": "Merge remote-tracking branch 'codelipenghui/fix_get_schema_by_version' into fix_get_schema_by_version", "committedDate": "2020-02-06T23:50:41Z", "type": "commit"}, {"oid": "63f8c5a967fb2d546793f5fe6415b7a3b20d7718", "url": "https://github.com/apache/pulsar/commit/63f8c5a967fb2d546793f5fe6415b7a3b20d7718", "message": "Merge remote-tracking branch 'apache/master' into fix_get_schema_by_version", "committedDate": "2020-02-06T23:51:02Z", "type": "commit"}]}