{"pr_number": 8143, "pr_title": "[ISSUE 6408] Fix NumberFormatException", "pr_createdAt": "2020-09-27T14:31:14Z", "pr_url": "https://github.com/apache/pulsar/pull/8143", "timeline": [{"oid": "52191bb3c414be99ef05e4ab9e9d40a4f68486f7", "url": "https://github.com/apache/pulsar/commit/52191bb3c414be99ef05e4ab9e9d40a4f68486f7", "message": "fix NumberFormatException", "committedDate": "2020-09-27T14:21:25Z", "type": "commit"}, {"oid": "d319797a3d0d66c843b6b2ae1335b4f90bb334a7", "url": "https://github.com/apache/pulsar/commit/d319797a3d0d66c843b6b2ae1335b4f90bb334a7", "message": "change name", "committedDate": "2020-09-27T14:29:02Z", "type": "commit"}, {"oid": "4b48c9380e7b91ffc27d02ddb62cf1542bcab7d0", "url": "https://github.com/apache/pulsar/commit/4b48c9380e7b91ffc27d02ddb62cf1542bcab7d0", "message": "change throw exception", "committedDate": "2020-09-27T14:46:29Z", "type": "commit"}, {"oid": "819aa8dac27b8cab492847fbdef2ca40964d132f", "url": "https://github.com/apache/pulsar/commit/819aa8dac27b8cab492847fbdef2ca40964d132f", "message": "change code style", "committedDate": "2020-09-27T14:52:50Z", "type": "commit"}, {"oid": "e943d1b2f637a402b302ff79b78bba091d40481d", "url": "https://github.com/apache/pulsar/commit/e943d1b2f637a402b302ff79b78bba091d40481d", "message": "Merge branch 'master' into exception", "committedDate": "2020-09-27T23:12:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODAwMDg5MQ==", "url": "https://github.com/apache/pulsar/pull/8143#discussion_r498000891", "bodyText": "Can you abstract this into one common function?", "author": "sijie", "createdAt": "2020-10-01T06:02:08Z", "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/FunctionsImpl.java", "diffHunk": "@@ -801,7 +859,10 @@ private void downloadFile(String destinationPath, WebTarget target) throws Pulsa\n         try {\n             downloadFileAsync(destinationPath, target).get(this.readTimeoutMs, TimeUnit.MILLISECONDS);\n         } catch (ExecutionException e) {\n-            throw (PulsarAdminException) e.getCause();\n+            if (e.getCause() instanceof PulsarAdminException) {", "originalCommit": "e943d1b2f637a402b302ff79b78bba091d40481d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2dd80a72a2ae84a6ca16edf03ef0a4c57b140bc5", "chunk": "diff --git a/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/FunctionsImpl.java b/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/FunctionsImpl.java\nindex 6413fb9efe4..41da287202d 100644\n--- a/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/FunctionsImpl.java\n+++ b/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/FunctionsImpl.java\n\n@@ -859,9 +827,7 @@ public class FunctionsImpl extends ComponentResource implements Functions {\n         try {\n             downloadFileAsync(destinationPath, target).get(this.readTimeoutMs, TimeUnit.MILLISECONDS);\n         } catch (ExecutionException e) {\n-            if (e.getCause() instanceof PulsarAdminException) {\n-                throw (PulsarAdminException) e.getCause();\n-            }\n+            handlePulsarAdminException(e);\n             throw new PulsarAdminException(e.getCause());\n         } catch (InterruptedException e) {\n             Thread.currentThread().interrupt();\n"}}, {"oid": "2dd80a72a2ae84a6ca16edf03ef0a4c57b140bc5", "url": "https://github.com/apache/pulsar/commit/2dd80a72a2ae84a6ca16edf03ef0a4c57b140bc5", "message": "abstract into one common function", "committedDate": "2020-10-01T06:38:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MzYxNg==", "url": "https://github.com/apache/pulsar/pull/8143#discussion_r502753616", "bodyText": "I have a little doubt. Is this fixed the problem that the pulsar function does not support multi-service URLs?", "author": "jianyun8023", "createdAt": "2020-10-10T06:26:14Z", "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/PulsarAdmin.java", "diffHunk": "@@ -189,7 +191,11 @@ public PulsarAdmin(String serviceUrl,\n         this.client = clientBuilder.build();\n \n         this.serviceUrl = serviceUrl;\n-        root = client.target(serviceUrl);\n+        ServiceURI serviceUri = ServiceURI.create(serviceUrl);\n+        root = client.target(String.format(\"%s://%s\"\n+                , serviceUri.getServiceScheme()\n+                , serviceUri.getServiceHosts()[ThreadLocalRandom.current()\n+                        .nextInt(serviceUri.getServiceHosts().length)]));\n ", "originalCommit": "2dd80a72a2ae84a6ca16edf03ef0a4c57b140bc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1NTYzMg==", "url": "https://github.com/apache/pulsar/pull/8143#discussion_r502755632", "bodyText": "I have a little doubt. Is this fixed the problem that the pulsar function does not support multi-service URLs?\n\nYes, when we create a Function, the Client initiates a request. Since multi-service URLs are not supported here, a NumberFormatException will be thrown.\nWhen you restore this code, then update the jar to the lib, create a Function with cli, you can reproduce the previous bug.", "author": "315157973", "createdAt": "2020-10-10T06:50:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc1MzYxNg=="}], "type": "inlineReview", "revised_code": null}]}