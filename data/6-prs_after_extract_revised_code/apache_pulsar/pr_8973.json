{"pr_number": 8973, "pr_title": "Make function supports to use package command", "pr_createdAt": "2020-12-16T14:18:30Z", "pr_url": "https://github.com/apache/pulsar/pull/8973", "timeline": [{"oid": "1a534b61f9eade650f73ba704ded3b31c9500b2a", "url": "https://github.com/apache/pulsar/commit/1a534b61f9eade650f73ba704ded3b31c9500b2a", "message": "Make function supports to use package command\n---\n\nMaster Issue: #8676\n\n*Motivation*\n\nWe have a new package management service which can manage all\nthe packages. We can use that in the Pulsar Function which will\nmake the function packages are easier to manage.\n\n*Modifications*\n\n- Support new package type url", "committedDate": "2020-12-16T14:13:32Z", "type": "commit"}, {"oid": "5e40e17d09bed496d92856817b409b51d94090b4", "url": "https://github.com/apache/pulsar/commit/5e40e17d09bed496d92856817b409b51d94090b4", "message": "Add unit tests and support package name for update function", "committedDate": "2020-12-17T09:40:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIwNjQ1Mg==", "url": "https://github.com/apache/pulsar/pull/8973#discussion_r548206452", "bodyText": "Don't we need authentication and authorization plugin for downloading the packages?", "author": "sijie", "createdAt": "2020-12-23T20:24:41Z", "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntime.java", "diffHunk": "@@ -868,6 +876,39 @@ public void deleteService() throws InterruptedException {\n                 userCodeFilePath);\n     }\n \n+    private List<String> getPackageDownloadCommand(String packageName, String userCodeFilePath) {\n+        // add auth plugin and parameters if necessary\n+        if (authenticationEnabled && authConfig != null) {\n+            if (isNotBlank(authConfig.getClientAuthenticationPlugin())\n+                && isNotBlank(authConfig.getClientAuthenticationParameters())\n+                && instanceConfig.getFunctionAuthenticationSpec() != null) {\n+                return Arrays.asList(\n+                    pulsarRootDir + configAdminCLI,\n+                    \"--auth-plugin\",\n+                    authConfig.getClientAuthenticationPlugin(),\n+                    \"--auth-params\",\n+                    authConfig.getClientAuthenticationParameters(),\n+                    \"--admin-url\",\n+                    pulsarAdminUrl,\n+                    \"packages\",\n+                    \"download\",\n+                    packageName,\n+                    \"--path\",\n+                    userCodeFilePath);\n+            }\n+        }\n+\n+        return Arrays.asList(", "originalCommit": "5e40e17d09bed496d92856817b409b51d94090b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUzMjM4OA==", "url": "https://github.com/apache/pulsar/pull/8973#discussion_r549532388", "bodyText": "Yes. We need. Already add auth plugin at line 879.", "author": "zymap", "createdAt": "2020-12-29T01:01:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODIwNjQ1Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f3b8dfb2bbf8826e8999398f9346b46d890c44b8", "url": "https://github.com/apache/pulsar/commit/f3b8dfb2bbf8826e8999398f9346b46d890c44b8", "message": "Merge remote-tracking branch 'apache/master' into package-management-function-runtime", "committedDate": "2020-12-29T01:02:56Z", "type": "commit"}]}