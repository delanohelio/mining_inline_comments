{"pr_number": 7705, "pr_title": "[pulsar-client] Remove UUID generation on sending message", "pr_createdAt": "2020-07-31T01:22:51Z", "pr_url": "https://github.com/apache/pulsar/pull/7705", "timeline": [{"oid": "7e49954b7f8258edd68aefedb51a2fdeecf0ebeb", "url": "https://github.com/apache/pulsar/commit/7e49954b7f8258edd68aefedb51a2fdeecf0ebeb", "message": "[pulsar-client] Remove UUID generation on sending message", "committedDate": "2020-07-31T01:14:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5MDAwNg==", "url": "https://github.com/apache/pulsar/pull/7705#discussion_r463890006", "bodyText": "This will always be the same as producerName. If the client overrides it, the server will use that name, but if a producer with same name is already connected, it will instead error it out", "author": "merlimat", "createdAt": "2020-07-31T23:51:33Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java", "diffHunk": "@@ -103,7 +102,15 @@\n     private final BatchMessageContainerBase batchMessageContainer;\n     private CompletableFuture<MessageId> lastSendFuture = CompletableFuture.completedFuture(null);\n \n-    // Globally unique producer name\n+    /**\n+     * Globally unique producer name generated by server. It should be the same as {@link #producerName} unless user\n+     * configures {@link ProducerConfigurationData::setProducerName}.", "originalCommit": "7e49954b7f8258edd68aefedb51a2fdeecf0ebeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkzNzc5NQ==", "url": "https://github.com/apache/pulsar/pull/7705#discussion_r463937795", "bodyText": "I have changed it but I don't think user_producer_id + sequence_id can create UUID because user_producer_id can be reused by other producer later on and sequence_id can start with 0 again and it will create a duplicate combination which will not be unique across messages on the topic and that can be issue for message chunking.\neg:\nProducer P1 gives name userProducer1 and publish message with sequenceId=0. Now that process died and another process created producer with similar name userProducer1 and started message with sequenceId=0 in which case UUID will not be unique.\nTherefore, using serverProducerName always gives a guarantee for unique producer-id and UUID. Adding new string serverProducerId will not create any overhead as well. So, can you please let me know your thought on it.", "author": "rdhabalia", "createdAt": "2020-08-01T08:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5MDAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDcwMzA4OA==", "url": "https://github.com/apache/pulsar/pull/7705#discussion_r464703088", "bodyText": "@merlimat did you get chance to read my above comment before merging the PR?", "author": "rdhabalia", "createdAt": "2020-08-03T22:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5MDAwNg=="}], "type": "inlineReview", "revised_code": {"commit": "7e3e481213946436df5ed9c60d6c2e701fb731be", "chunk": "diff --git a/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java\nindex a9bccd855c5..b2f00b2e2bb 100644\n--- a/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java\n+++ b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java\n\n@@ -102,15 +102,7 @@ public class ProducerImpl<T> extends ProducerBase<T> implements TimerTask, Conne\n     private final BatchMessageContainerBase batchMessageContainer;\n     private CompletableFuture<MessageId> lastSendFuture = CompletableFuture.completedFuture(null);\n \n-    /**\n-     * Globally unique producer name generated by server. It should be the same as {@link #producerName} unless user\n-     * configures {@link ProducerConfigurationData::setProducerName}.\n-     */\n-    private String serverProducerName;\n-    /**\n-     * Globally unique producer name unless user configures producer name explicitly using\n-     * {@link ProducerConfigurationData::setProducerName}.\n-     */\n+    // Globally unique producer name\n     private String producerName;\n     private boolean userProvidedProducerName = false;\n \n"}}, {"oid": "7e3e481213946436df5ed9c60d6c2e701fb731be", "url": "https://github.com/apache/pulsar/commit/7e3e481213946436df5ed9c60d6c2e701fb731be", "message": "fix prod name", "committedDate": "2020-08-01T01:12:52Z", "type": "commit"}]}