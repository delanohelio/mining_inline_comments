{"pr_number": 6456, "pr_title": "[Issue 6394] Add configuration to disable auto creation of subscriptions", "pr_createdAt": "2020-03-02T13:58:28Z", "pr_url": "https://github.com/apache/pulsar/pull/6456", "timeline": [{"oid": "6ceb9e6f7489d74ace53915d461e50321edac5f4", "url": "https://github.com/apache/pulsar/commit/6ceb9e6f7489d74ace53915d461e50321edac5f4", "message": "Add configuration to disable auto creation of subscriptions.", "committedDate": "2020-03-02T13:56:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxMjg1MQ==", "url": "https://github.com/apache/pulsar/pull/6456#discussion_r386612851", "bodyText": "@murong00\nCan you add a test to cover the case - if allowAutoSubscriptionCreation is disabled people can still create a subscription using pulsar-admin?", "author": "sijie", "createdAt": "2020-03-02T19:49:54Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoTopicCreationTest.java", "diffHunk": "@@ -104,6 +104,24 @@ public void testAutoTopicCreationDisableIfNonPartitionedTopicAlreadyExist() thro\n         assertTrue(admin.namespaces().getTopics(\"prop/ns-abc\").contains(topicName));\n     }\n \n+    @Test\n+    public void testAutoSubscriptionCreationDisable() throws Exception{", "originalCommit": "6ceb9e6f7489d74ace53915d461e50321edac5f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njc4MDI1OQ==", "url": "https://github.com/apache/pulsar/pull/6456#discussion_r386780259", "bodyText": "Added.", "author": "murong00", "createdAt": "2020-03-03T03:25:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxMjg1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "12630cab0fa6bd8a1c2b1f13c8d42490da77be12", "chunk": "diff --git a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoTopicCreationTest.java b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoTopicCreationTest.java\nindex 9ad764451cb..e5b7e0c8bdf 100644\n--- a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoTopicCreationTest.java\n+++ b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoTopicCreationTest.java\n\n@@ -122,6 +123,24 @@ public class BrokerServiceAutoTopicCreationTest extends BrokerTestBase{\n         assertFalse(admin.topics().getSubscriptions(topicName).contains(subscriptionName));\n     }\n \n+    @Test\n+    public void testSubscriptionCreationWithAutoCreationDisable() throws Exception{\n+        pulsar.getConfiguration().setAllowAutoSubscriptionCreation(false);\n+\n+        final String topicName = \"persistent://prop/ns-abc/test-topic\";\n+        final String subscriptionName = \"test-topic-sub\";\n+\n+        admin.topics().createNonPartitionedTopic(topicName);\n+        assertFalse(admin.topics().getSubscriptions(topicName).contains(subscriptionName));\n+\n+        // Create the subscription by PulsarAdmin\n+        admin.topics().createSubscription(topicName, subscriptionName, MessageId.earliest);\n+        assertTrue(admin.topics().getSubscriptions(topicName).contains(subscriptionName));\n+\n+        // Subscribe operation should be successful\n+        pulsarClient.newConsumer().topic(topicName).subscriptionName(subscriptionName).subscribe();\n+    }\n+\n     /**\n      * CheckAllowAutoCreation's default value is false.\n      * So using getPartitionedTopicMetadata() directly will not produce partitioned topic\n"}}, {"oid": "12630cab0fa6bd8a1c2b1f13c8d42490da77be12", "url": "https://github.com/apache/pulsar/commit/12630cab0fa6bd8a1c2b1f13c8d42490da77be12", "message": "Add a unit test to cover subscription creation", "committedDate": "2020-03-03T03:23:28Z", "type": "commit"}, {"oid": "5bc343d8ffd20a8a8627591e18d4036ac30c7383", "url": "https://github.com/apache/pulsar/commit/5bc343d8ffd20a8a8627591e18d4036ac30c7383", "message": "Fix the flaky test", "committedDate": "2020-03-03T06:21:20Z", "type": "commit"}]}