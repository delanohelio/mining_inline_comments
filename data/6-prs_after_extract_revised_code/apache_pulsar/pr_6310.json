{"pr_number": 6310, "pr_title": "Enable get precise backlog and backlog without delayed messages.", "pr_createdAt": "2020-02-12T14:23:50Z", "pr_url": "https://github.com/apache/pulsar/pull/6310", "timeline": [{"oid": "f20807ed1047dbb9deab00631d1364af06e25ead", "url": "https://github.com/apache/pulsar/commit/f20807ed1047dbb9deab00631d1364af06e25ead", "message": "Enable get precise backlog and backlog with delayed messages.", "committedDate": "2020-02-12T14:20:49Z", "type": "commit"}, {"oid": "2ac4885a24733eee49e70a3203a5a161b1a2071a", "url": "https://github.com/apache/pulsar/commit/2ac4885a24733eee49e70a3203a5a161b1a2071a", "message": "Fix checkstyle", "committedDate": "2020-02-12T14:35:55Z", "type": "commit"}, {"oid": "d9493be6871d8a8135ce7600f670459087d2a37b", "url": "https://github.com/apache/pulsar/commit/d9493be6871d8a8135ce7600f670459087d2a37b", "message": "Add docs.", "committedDate": "2020-02-13T02:16:56Z", "type": "commit"}, {"oid": "d3a191a550d9856dec6d2186b9ee8ab8e0f90594", "url": "https://github.com/apache/pulsar/commit/d3a191a550d9856dec6d2186b9ee8ab8e0f90594", "message": "Apply comment", "committedDate": "2020-02-14T12:10:58Z", "type": "commit"}, {"oid": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "url": "https://github.com/apache/pulsar/commit/5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "message": "Fix unit test", "committedDate": "2020-02-14T13:13:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgxMA==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874810", "bodyText": "just a suggestion for future tasks:\nif we are changing a method to add another flag, it would be better to add an overloaded method rather than directly updating the original method. It will reduce the number of files to be changed.\ndefault long getNumberOfEntriesInBacklog() {\n    return getNumberOfEntriesInBacklog(false);\n}\n\nlong getNumberOfEntriesInBacklog(boolean isPreciseBacklog);", "author": "sijie", "createdAt": "2020-02-16T04:39:36Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java", "diffHunk": "@@ -53,7 +53,7 @@ default void removeConsumer(Consumer consumer) throws BrokerServiceException {\n \n     Dispatcher getDispatcher();\n \n-    long getNumberOfEntriesInBacklog();\n+    long getNumberOfEntriesInBacklog(boolean isPreciseBacklog);", "originalCommit": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDk5OQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874999", "bodyText": "Got it.", "author": "codelipenghui", "createdAt": "2020-02-16T04:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgxMA=="}], "type": "inlineReview", "revised_code": {"commit": "3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "chunk": "diff --git a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java\nindex a468afb744a..f7d96875239 100644\n--- a/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java\n+++ b/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java\n\n@@ -53,7 +53,7 @@ public interface Subscription {\n \n     Dispatcher getDispatcher();\n \n-    long getNumberOfEntriesInBacklog(boolean isPreciseBacklog);\n+    long getNumberOfEntriesInBacklog(boolean getPreciseBacklog);\n \n     default long getNumberOfEntriesDelayed() {\n         return 0;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379874829", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"--is-precise-backlog\" }, description = \"Set true to get precise backlog\")\n          \n          \n            \n                        \"--get-precise-backlog\" }, description = \"Set true to get precise backlog\")", "author": "sijie", "createdAt": "2020-02-16T04:40:24Z", "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java", "diffHunk": "@@ -370,10 +370,14 @@ void run() throws PulsarAdminException {\n         @Parameter(description = \"persistent://tenant/namespace/topic\\n\", required = true)\n         private java.util.List<String> params;\n \n+        @Parameter(names = { \"-ipb\",\n+            \"--is-precise-backlog\" }, description = \"Set true to get precise backlog\")", "originalCommit": "5df8abe4ae85ecba403f606b4bb29d0ae83de9c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NTAwNQ==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379875005", "bodyText": "yes, get-precise-backlog is better.", "author": "codelipenghui", "createdAt": "2020-02-16T04:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTkwMTI0Ng==", "url": "https://github.com/apache/pulsar/pull/6310#discussion_r379901246", "bodyText": "@sijie Has been renamed, PTAL.", "author": "codelipenghui", "createdAt": "2020-02-16T12:54:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTg3NDgyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "chunk": "diff --git a/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java b/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java\nindex c22aeedf063..f5954cf38ba 100644\n--- a/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java\n+++ b/pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java\n\n@@ -370,14 +370,14 @@ public class CmdTopics extends CmdBase {\n         @Parameter(description = \"persistent://tenant/namespace/topic\\n\", required = true)\n         private java.util.List<String> params;\n \n-        @Parameter(names = { \"-ipb\",\n-            \"--is-precise-backlog\" }, description = \"Set true to get precise backlog\")\n-        private boolean isPreciseBacklog = false;\n+        @Parameter(names = { \"-gpb\",\n+            \"--get-precise-backlog\" }, description = \"Set true to get precise backlog\")\n+        private boolean getPreciseBacklog = false;\n \n         @Override\n         void run() throws PulsarAdminException {\n             String topic = validateTopicName(params);\n-            print(topics.getStats(topic, isPreciseBacklog));\n+            print(topics.getStats(topic, getPreciseBacklog));\n         }\n     }\n \n"}}, {"oid": "3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "url": "https://github.com/apache/pulsar/commit/3e209dd496c0fc3dd75e9178c25d3850e6d5a1fc", "message": "Rename is-precise-backlog to get-precise-backlog.", "committedDate": "2020-02-16T12:52:52Z", "type": "commit"}]}