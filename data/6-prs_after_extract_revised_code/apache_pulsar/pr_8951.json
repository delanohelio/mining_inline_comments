{"pr_number": 8951, "pr_title": "consumer support update stats with specified stats", "pr_createdAt": "2020-12-14T09:45:04Z", "pr_url": "https://github.com/apache/pulsar/pull/8951", "timeline": [{"oid": "49e7b1e1d46d85bc01afb40c4f720e461daa16e8", "url": "https://github.com/apache/pulsar/commit/49e7b1e1d46d85bc01afb40c4f720e461daa16e8", "message": "consumer support update stats with specified stats", "committedDate": "2020-12-14T10:15:10Z", "type": "forcePushed"}, {"oid": "f81f3e6f893a95cdcd5ff791a5b1a9c871d37ed6", "url": "https://github.com/apache/pulsar/commit/f81f3e6f893a95cdcd5ff791a5b1a9c871d37ed6", "message": "consumer support update stats with specified stats", "committedDate": "2020-12-14T12:35:29Z", "type": "commit"}, {"oid": "f81f3e6f893a95cdcd5ff791a5b1a9c871d37ed6", "url": "https://github.com/apache/pulsar/commit/f81f3e6f893a95cdcd5ff791a5b1a9c871d37ed6", "message": "consumer support update stats with specified stats", "committedDate": "2020-12-14T12:35:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk4ODA5MQ==", "url": "https://github.com/apache/pulsar/pull/8951#discussion_r542988091", "bodyText": "Is there anything related to seek? IMO, the test should move to org.apache.pulsar.broker.stats.ConsumerStatsTest", "author": "BewareMyPower", "createdAt": "2020-12-15T02:03:36Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java", "diffHunk": "@@ -493,4 +494,29 @@ public void testOnlyCloseActiveConsumerForSingleActiveConsumerDispatcherWhenSeek\n         }\n         assertTrue(hasConsumerNotDisconnected);\n     }\n+\n+    @Test\n+    public void testUpdateStatsForSingleActiveConsumerDispatcherWhenSeek() throws Exception {", "originalCommit": "f81f3e6f893a95cdcd5ff791a5b1a9c871d37ed6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAwMjU0Mg==", "url": "https://github.com/apache/pulsar/pull/8951#discussion_r543002542", "bodyText": "@BewareMyPower I thought it's related to subscription consumer. You are right, it's the best to move to org.apache.pulsar.broker.stats.ConsumerStatsTest", "author": "dockerzhang", "createdAt": "2020-12-15T02:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjk4ODA5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "fe7cbc47547401b487e23694c3c07f9c89bc4c53", "chunk": "diff --git a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java\nindex 17fe80170fc..b8dfbc8a16b 100644\n--- a/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java\n+++ b/pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java\n\n@@ -494,29 +493,4 @@ public class SubscriptionSeekTest extends BrokerTestBase {\n         }\n         assertTrue(hasConsumerNotDisconnected);\n     }\n-\n-    @Test\n-    public void testUpdateStatsForSingleActiveConsumerDispatcherWhenSeek() throws Exception {\n-        final String topicName = \"persistent://prop/use/ns-abc/testUpdateStatsForSingleActiveConsumerDispatcherWhenSeek\";\n-        // Disable pre-fetch in consumer to track the messages received\n-        pulsarClient.newConsumer()\n-                .topic(topicName)\n-                .subscriptionType(SubscriptionType.Shared)\n-                .subscriptionName(\"my-subscription\")\n-                .subscribe();\n-\n-        PersistentTopic topicRef = (PersistentTopic) pulsar.getBrokerService().getTopicReference(topicName).get();\n-        assertNotNull(topicRef);\n-        assertEquals(topicRef.getSubscriptions().size(), 1);\n-        List<Consumer> consumers = topicRef.getSubscriptions().get(\"my-subscription\").getConsumers();\n-        assertEquals(consumers.size(), 1);\n-        ConsumerStats consumerStats = new ConsumerStats();\n-        consumerStats.msgOutCounter = 10;\n-        consumerStats.bytesOutCounter = 1280;\n-        consumers.get(0).updateStats(consumerStats);\n-        ConsumerStats updatedStats = consumers.get(0).getStats();\n-\n-        assertEquals(updatedStats.msgOutCounter, 10);\n-        assertEquals(updatedStats.bytesOutCounter, 1280);\n-    }\n }\n"}}, {"oid": "fe7cbc47547401b487e23694c3c07f9c89bc4c53", "url": "https://github.com/apache/pulsar/commit/fe7cbc47547401b487e23694c3c07f9c89bc4c53", "message": "move UT to ConsumerStatsTest", "committedDate": "2020-12-15T03:55:52Z", "type": "commit"}]}