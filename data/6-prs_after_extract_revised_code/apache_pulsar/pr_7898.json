{"pr_number": 7898, "pr_title": "[Pulsar SQL] Fix Pulsar SQL CI test", "pr_createdAt": "2020-08-26T02:20:48Z", "pr_url": "https://github.com/apache/pulsar/pull/7898", "timeline": [{"oid": "04b8626d294fc4a99bfe42988b83fd1ca13a681a", "url": "https://github.com/apache/pulsar/commit/04b8626d294fc4a99bfe42988b83fd1ca13a681a", "message": "Set ClassLoader for creating ClientBuilder if specify the ClassLoader.", "committedDate": "2020-08-26T02:15:37Z", "type": "commit"}, {"oid": "2ff874bb654de9405b44e4c15242c59ee0816b41", "url": "https://github.com/apache/pulsar/commit/2ff874bb654de9405b44e4c15242c59ee0816b41", "message": "fix", "committedDate": "2020-08-26T02:16:37Z", "type": "commit"}, {"oid": "6b8048c82cd9f46a4888ab32a822d6fd5279ae90", "url": "https://github.com/apache/pulsar/commit/6b8048c82cd9f46a4888ab32a822d6fd5279ae90", "message": "fix", "committedDate": "2020-08-26T02:32:56Z", "type": "commit"}, {"oid": "aa0abccf753c709ad33791f09696be9f97c52a41", "url": "https://github.com/apache/pulsar/commit/aa0abccf753c709ad33791f09696be9f97c52a41", "message": "fix", "committedDate": "2020-08-26T02:37:15Z", "type": "commit"}, {"oid": "77bb1e20921ff9807feaad65a00f9e2d4eb32a81", "url": "https://github.com/apache/pulsar/commit/77bb1e20921ff9807feaad65a00f9e2d4eb32a81", "message": "fix", "committedDate": "2020-08-26T03:59:33Z", "type": "commit"}, {"oid": "0e98c186f6ed117110b3405663aa08a9d89cac9f", "url": "https://github.com/apache/pulsar/commit/0e98c186f6ed117110b3405663aa08a9d89cac9f", "message": "fix", "committedDate": "2020-08-26T05:22:19Z", "type": "commit"}, {"oid": "be5a5776d74a3fbb04859ae19f4afd10c04b8d83", "url": "https://github.com/apache/pulsar/commit/be5a5776d74a3fbb04859ae19f4afd10c04b8d83", "message": "the `joda-time` is not included in the `io.airlift:bootstrap:0.199`, so we need to add it.", "committedDate": "2020-08-26T08:03:17Z", "type": "commit"}, {"oid": "8c6880b90ba390edd9d663ac8b26ad33b760ba2e", "url": "https://github.com/apache/pulsar/commit/8c6880b90ba390edd9d663ac8b26ad33b760ba2e", "message": "fix", "committedDate": "2020-08-26T10:08:28Z", "type": "commit"}, {"oid": "642c4d9df823b56316852b0ac13e2bcbe203923a", "url": "https://github.com/apache/pulsar/commit/642c4d9df823b56316852b0ac13e2bcbe203923a", "message": "fix", "committedDate": "2020-08-26T10:52:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU3NTIxNA==", "url": "https://github.com/apache/pulsar/pull/7898#discussion_r477575214", "bodyText": "I don't think this is the best way to get the logs of containers as they will be sprinkled across the whole test log.  We should just upload relevant log artifacts.  All the containers already dump its logs in compressed format (please reference: https://github.com/apache/pulsar/blob/master/tests/integration/src/test/java/org/apache/pulsar/tests/integration/utils/DockerUtils.java#L117) .  We just need to upload the logs as artifacts at when the test is done running so that users can download all the logs to view/debug.  This is what was done when we were on Jenkins.", "author": "jerrypeng", "createdAt": "2020-08-26T20:38:56Z", "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java", "diffHunk": "@@ -146,6 +146,26 @@ public void start() {\n \n         beforeStart();\n         super.start();\n+        if (this.getContainerName().contains(\"presto-worker\")) {", "originalCommit": "642c4d9df823b56316852b0ac13e2bcbe203923a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk2MjM4MA==", "url": "https://github.com/apache/pulsar/pull/7898#discussion_r477962380", "bodyText": "Yes, that's right. Thanks for your comments.", "author": "gaoran10", "createdAt": "2020-08-27T02:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU3NTIxNA=="}], "type": "inlineReview", "revised_code": {"commit": "8f75a4e362932db8334289d11bb5ae15deb513d7", "chunk": "diff --git a/tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java b/tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java\nindex 65d20f3d033..ae5e57a203d 100644\n--- a/tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java\n+++ b/tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java\n\n@@ -146,26 +146,6 @@ public abstract class PulsarContainer<SelfT extends PulsarContainer<SelfT>> exte\n \n         beforeStart();\n         super.start();\n-        if (this.getContainerName().contains(\"presto-worker\")) {\n-            this.tailContainerLog();\n-            DockerUtils.runCommandAsync(this.dockerClient, this.getContainerId(),\n-                    \"mkdir\", \"-p\",\n-                    \"/var/log/pulsar\");\n-            DockerUtils.runCommandAsync(this.dockerClient, this.getContainerId(),\n-                    \"touch\",\n-                    \"/var/log/pulsar/presto_worker.log\");\n-            DockerUtils.runCommandAsync(this.getDockerClient(), this.getContainerId(),\n-                    \"tail\", \"-f\", \"/var/log/pulsar/presto_worker.log\");\n-\n-            DockerUtils.runCommandAsync(this.dockerClient, this.getContainerId(),\n-                    \"mkdir\", \"-p\",\n-                    \"/pulsar/lib/presto/var/log\");\n-            DockerUtils.runCommandAsync(this.dockerClient, this.getContainerId(),\n-                    \"touch\",\n-                    \"/pulsar/lib/presto/var/log/server.log\");\n-            DockerUtils.runCommandAsync(this.getDockerClient(), this.getContainerId(),\n-                    \"tail\", \"-f\", \"/pulsar/lib/presto/var/log/server.log\");\n-        }\n         log.info(\"Start pulsar service {} at container {}\", serviceName, containerName);\n     }\n \n"}}, {"oid": "8f75a4e362932db8334289d11bb5ae15deb513d7", "url": "https://github.com/apache/pulsar/commit/8f75a4e362932db8334289d11bb5ae15deb513d7", "message": "remove test log", "committedDate": "2020-08-27T02:30:45Z", "type": "commit"}]}