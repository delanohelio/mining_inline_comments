{"pr_number": 1254, "pr_title": "Fixes #1244: Incorrect pagination with ToMany filtering", "pr_createdAt": "2020-03-30T18:16:39Z", "pr_url": "https://github.com/yahoo/elide/pull/1254", "timeline": [{"oid": "6fe38230a5dbe6ede24c73bd68e6625966a1e130", "url": "https://github.com/yahoo/elide/commit/6fe38230a5dbe6ede24c73bd68e6625966a1e130", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-03-31T18:05:01Z", "type": "forcePushed"}, {"oid": "7a40e9978683f942198c26b06cf141e8ae50c551", "url": "https://github.com/yahoo/elide/commit/7a40e9978683f942198c26b06cf141e8ae50c551", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-03-31T20:22:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTQzNw==", "url": "https://github.com/yahoo/elide/pull/1254#discussion_r402679437", "bodyText": "There's a more readable way to build these using a parser:\nfilterParser.parseFilterExpression(\"name==drum\", Item.class, false);", "author": "aklish", "createdAt": "2020-04-03T00:59:05Z", "path": "elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java", "diffHunk": "@@ -128,6 +129,56 @@ public void testRootFetchWithJoinFilter() {\n         assertEquals(expected, actual);\n     }\n \n+    @Test\n+    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() {\n+        final Pagination pagination = Pagination.fromOffsetAndLimit(10, 0, false);\n+        List<Path.PathElement> chapterTitlePath = Arrays.asList(", "originalCommit": "7a40e9978683f942198c26b06cf141e8ae50c551", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5NTI1OA==", "url": "https://github.com/yahoo/elide/pull/1254#discussion_r402795258", "bodyText": "ok, I just copied this from other test :)", "author": "bukajsytlos", "createdAt": "2020-04-03T07:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTQzNw=="}], "type": "inlineReview", "revised_code": {"commit": "b985b4f4c45cac664887f6c4fcf6bba7d890a36f", "chunk": "diff --git a/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java b/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\nindex fa16c8db5..5a61c6be5 100644\n--- a/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\n+++ b/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\n\n@@ -130,26 +120,11 @@ public class RootCollectionFetchQueryBuilderTest {\n     }\n \n     @Test\n-    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() {\n+    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() throws ParseException {\n         final Pagination pagination = Pagination.fromOffsetAndLimit(10, 0, false);\n-        List<Path.PathElement> chapterTitlePath = Arrays.asList(\n-                new Path.PathElement(Author.class, Book.class, BOOKS),\n-                new Path.PathElement(Book.class, Chapter.class, \"chapters\"),\n-                new Path.PathElement(Chapter.class, String.class, TITLE)\n-        );\n-\n-        FilterPredicate titlePredicate = new InPredicate(\n-                new Path(chapterTitlePath),\n-                \"ABC\", \"DEF\");\n \n-        List<Path.PathElement>  publisherNamePath = Arrays.asList(\n-                new Path.PathElement(Author.class, Book.class, BOOKS),\n-                new Path.PathElement(Book.class, Publisher.class, PUBLISHER),\n-                new Path.PathElement(Publisher.class, String.class, \"name\")\n-        );\n-\n-        FilterPredicate publisherNamePredicate = new InPredicate(\n-                new Path(publisherNamePath), \"Pub1\");\n+        final FilterExpression titlePredicate = filterParser.parseFilterExpression(\"books.chapters.title=in=('ABC','DEF')\", Author.class, true);\n+        final FilterExpression publisherNamePredicate = filterParser.parseFilterExpression(\"books.publisher.name=in='Pub1'\", Author.class, true);\n \n         OrFilterExpression expression = new OrFilterExpression(titlePredicate, publisherNamePredicate);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTgxMQ==", "url": "https://github.com/yahoo/elide/pull/1254#discussion_r402679811", "bodyText": "Can we test the exception behavior as well?", "author": "aklish", "createdAt": "2020-04-03T01:00:31Z", "path": "elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java", "diffHunk": "@@ -128,6 +129,56 @@ public void testRootFetchWithJoinFilter() {\n         assertEquals(expected, actual);\n     }\n \n+    @Test\n+    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() {", "originalCommit": "7a40e9978683f942198c26b06cf141e8ae50c551", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5NTAzNA==", "url": "https://github.com/yahoo/elide/pull/1254#discussion_r402795034", "bodyText": "yes, there is/are failing tests right now because of this, but I am struggling little bit with running and debugging them locally. when I resolve that, I'll try to write test for this case", "author": "bukajsytlos", "createdAt": "2020-04-03T07:45:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY3OTgxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b985b4f4c45cac664887f6c4fcf6bba7d890a36f", "chunk": "diff --git a/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java b/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\nindex fa16c8db5..5a61c6be5 100644\n--- a/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\n+++ b/elide-datastore/elide-datastore-hibernate/src/test/java/com/yahoo/elide/datastores/hibernate/hql/RootCollectionFetchQueryBuilderTest.java\n\n@@ -130,26 +120,11 @@ public class RootCollectionFetchQueryBuilderTest {\n     }\n \n     @Test\n-    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() {\n+    public void testDistinctRootFetchWithToManyJoinFilterAndPagination() throws ParseException {\n         final Pagination pagination = Pagination.fromOffsetAndLimit(10, 0, false);\n-        List<Path.PathElement> chapterTitlePath = Arrays.asList(\n-                new Path.PathElement(Author.class, Book.class, BOOKS),\n-                new Path.PathElement(Book.class, Chapter.class, \"chapters\"),\n-                new Path.PathElement(Chapter.class, String.class, TITLE)\n-        );\n-\n-        FilterPredicate titlePredicate = new InPredicate(\n-                new Path(chapterTitlePath),\n-                \"ABC\", \"DEF\");\n \n-        List<Path.PathElement>  publisherNamePath = Arrays.asList(\n-                new Path.PathElement(Author.class, Book.class, BOOKS),\n-                new Path.PathElement(Book.class, Publisher.class, PUBLISHER),\n-                new Path.PathElement(Publisher.class, String.class, \"name\")\n-        );\n-\n-        FilterPredicate publisherNamePredicate = new InPredicate(\n-                new Path(publisherNamePath), \"Pub1\");\n+        final FilterExpression titlePredicate = filterParser.parseFilterExpression(\"books.chapters.title=in=('ABC','DEF')\", Author.class, true);\n+        final FilterExpression publisherNamePredicate = filterParser.parseFilterExpression(\"books.publisher.name=in='Pub1'\", Author.class, true);\n \n         OrFilterExpression expression = new OrFilterExpression(titlePredicate, publisherNamePredicate);\n \n"}}, {"oid": "b985b4f4c45cac664887f6c4fcf6bba7d890a36f", "url": "https://github.com/yahoo/elide/commit/b985b4f4c45cac664887f6c4fcf6bba7d890a36f", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-04-06T06:59:55Z", "type": "forcePushed"}, {"oid": "6eaae3c6c316963280bc24269bf475c0ad6154db", "url": "https://github.com/yahoo/elide/commit/6eaae3c6c316963280bc24269bf475c0ad6154db", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-04-06T09:12:52Z", "type": "forcePushed"}, {"oid": "fa9af4192683e828dd2c9b02501788b947966c70", "url": "https://github.com/yahoo/elide/commit/fa9af4192683e828dd2c9b02501788b947966c70", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-04-06T10:13:07Z", "type": "commit"}, {"oid": "fa9af4192683e828dd2c9b02501788b947966c70", "url": "https://github.com/yahoo/elide/commit/fa9af4192683e828dd2c9b02501788b947966c70", "message": "Fixes #1244: Incorrect pagination with ToMany filtering", "committedDate": "2020-04-06T10:13:07Z", "type": "forcePushed"}, {"oid": "a1a441856fd3bdfa0a22840d76a2647b582c653a", "url": "https://github.com/yahoo/elide/commit/a1a441856fd3bdfa0a22840d76a2647b582c653a", "message": "Merge branch 'master' into bugfix/elide-1244-wrong-result-count-filter-to-many-pagination", "committedDate": "2020-04-12T02:24:36Z", "type": "commit"}, {"oid": "3534e942eeefb263d6309d8c113db7081f4668b9", "url": "https://github.com/yahoo/elide/commit/3534e942eeefb263d6309d8c113db7081f4668b9", "message": "Merge branch 'master' into bugfix/elide-1244-wrong-result-count-filter-to-many-pagination", "committedDate": "2020-04-12T02:27:33Z", "type": "commit"}]}