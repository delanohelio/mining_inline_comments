{"pr_number": 1275, "pr_title": "Short Circuit Filter Expression Security If User Checks would pass/fail.", "pr_createdAt": "2020-04-21T18:25:15Z", "pr_url": "https://github.com/yahoo/elide/pull/1275", "timeline": [{"oid": "9855f6587b50b4fd364b99133e37615dd665d6a1", "url": "https://github.com/yahoo/elide/commit/9855f6587b50b4fd364b99133e37615dd665d6a1", "message": "Fleshed out optimization to bypass relationship fetches for filter security evaluation if User Check would pass/fail", "committedDate": "2020-04-21T18:22:31Z", "type": "commit"}, {"oid": "99b0de064e053afa659a747015f2aeeb2c05a448", "url": "https://github.com/yahoo/elide/commit/99b0de064e053afa659a747015f2aeeb2c05a448", "message": "Added unit tests for changes to permission executor", "committedDate": "2020-04-21T19:08:56Z", "type": "commit"}, {"oid": "db689788488d8b2688418278927894ab71e94a05", "url": "https://github.com/yahoo/elide/commit/db689788488d8b2688418278927894ab71e94a05", "message": "Finished unit tests", "committedDate": "2020-04-21T19:29:48Z", "type": "commit"}, {"oid": "32bc9f1eca5a54702b84b7da23174e9c531ae65d", "url": "https://github.com/yahoo/elide/commit/32bc9f1eca5a54702b84b7da23174e9c531ae65d", "message": "added explicit check that data store transaction was not invoked", "committedDate": "2020-04-21T19:42:19Z", "type": "commit"}, {"oid": "f7a3453dfda0e424b3d3003761afb70c49980bfa", "url": "https://github.com/yahoo/elide/commit/f7a3453dfda0e424b3d3003761afb70c49980bfa", "message": "Fixing bug", "committedDate": "2020-04-21T20:17:49Z", "type": "commit"}, {"oid": "9d822edd8757e4ff2be00547366d865b8d01eca8", "url": "https://github.com/yahoo/elide/commit/9d822edd8757e4ff2be00547366d865b8d01eca8", "message": "Merge branch 'master' into ShortCircuitRelationshipFetches", "committedDate": "2020-04-21T20:39:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ4MjI5MA==", "url": "https://github.com/yahoo/elide/pull/1275#discussion_r412482290", "bodyText": "If this is FAIL should we return FAIL here too?", "author": "wcekan", "createdAt": "2020-04-21T20:50:52Z", "path": "elide-core/src/main/java/com/yahoo/elide/core/VerifyFieldAccessFilterExpressionVisitor.java", "diffHunk": "@@ -74,6 +85,28 @@ public Boolean visitPredicate(FilterPredicate filterPredicate) {\n         return resource.getRelationChecked(fieldName, Optional.empty(), Optional.empty(), Optional.empty()).stream();\n     }\n \n+    private ExpressionResult evaluateUserChecks(Path path) {\n+        PermissionExecutor executor = resource.getRequestScope().getPermissionExecutor();\n+\n+        ExpressionResult result = ExpressionResult.PASS;\n+\n+        for (Path.PathElement element : path.getPathElements()) {\n+            try {\n+                result = executor.checkUserPermissions(\n+                        element.getType(),\n+                        ReadPermission.class,\n+                        element.getFieldName());\n+            } catch (ForbiddenAccessException e) {\n+                return ExpressionResult.FAIL;\n+            }\n+\n+            if (result == ExpressionResult.DEFERRED) {", "originalCommit": "9d822edd8757e4ff2be00547366d865b8d01eca8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1d94404555895aa8bdcaa870707ebf45dbd31bb8", "chunk": "diff --git a/elide-core/src/main/java/com/yahoo/elide/core/VerifyFieldAccessFilterExpressionVisitor.java b/elide-core/src/main/java/com/yahoo/elide/core/VerifyFieldAccessFilterExpressionVisitor.java\nindex d8723c122..bef755f10 100644\n--- a/elide-core/src/main/java/com/yahoo/elide/core/VerifyFieldAccessFilterExpressionVisitor.java\n+++ b/elide-core/src/main/java/com/yahoo/elide/core/VerifyFieldAccessFilterExpressionVisitor.java\n\n@@ -100,7 +100,7 @@ public class VerifyFieldAccessFilterExpressionVisitor implements FilterExpressio\n                 return ExpressionResult.FAIL;\n             }\n \n-            if (result == ExpressionResult.DEFERRED) {\n+            if (result == ExpressionResult.DEFERRED || result == ExpressionResult.FAIL) {\n                 return result;\n             }\n         }\n"}}, {"oid": "1d94404555895aa8bdcaa870707ebf45dbd31bb8", "url": "https://github.com/yahoo/elide/commit/1d94404555895aa8bdcaa870707ebf45dbd31bb8", "message": "Inspection comment", "committedDate": "2020-04-21T20:53:26Z", "type": "commit"}, {"oid": "e36c5a6a7e515856e637aca725f57d2d28633213", "url": "https://github.com/yahoo/elide/commit/e36c5a6a7e515856e637aca725f57d2d28633213", "message": "Merge branch 'ShortCircuitRelationshipFetches' of github.com:yahoo/elide into ShortCircuitRelationshipFetches", "committedDate": "2020-04-21T20:53:51Z", "type": "commit"}, {"oid": "a66998005909b1d75c941dcb01647d53f159943e", "url": "https://github.com/yahoo/elide/commit/a66998005909b1d75c941dcb01647d53f159943e", "message": "Minor fix", "committedDate": "2020-04-21T20:54:55Z", "type": "commit"}]}