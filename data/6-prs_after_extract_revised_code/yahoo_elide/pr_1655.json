{"pr_number": 1655, "pr_title": "Validation for tableSource", "pr_createdAt": "2020-11-10T14:36:58Z", "pr_url": "https://github.com/yahoo/elide/pull/1655", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxMjA1Nw==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r520612057", "bodyText": "Adding all fields here, do we need to somehow ensure its a dimension ?", "author": "rishi-aga", "createdAt": "2020-11-10T14:39:16Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -83,11 +85,35 @@\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                            new ModelMapValue(className, prepareImport(pkgName, className)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n+\n+    private static Set<String> getFieldNames(Class<?> cls) {\n+        Set<String> fieldNames = new HashSet<String>();\n+        getAllFieldNames(cls, fieldNames);\n+        return fieldNames;\n+    }\n+\n+    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {\n+\n+        if (cls == Object.class) {\n+            return;\n+        }\n+\n+        getAllFieldNames(cls.getSuperclass(), fieldNames);\n+\n+        fieldNames.addAll(", "originalCommit": "bf4cc71118d5c15a33b4aba3bde797ba350064fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c998aac9286fdea8d029ada15071976989fd9af9", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\nindex f32472698..d2681b76f 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n\n@@ -79,41 +78,22 @@ public class ElideDynamicEntityCompiler {\n     private static Map<ModelMapKey, ModelMapValue> createMapping() {\n         Map<ModelMapKey, ModelMapValue> map = new HashMap<>();\n         Set<Class<?>> includeClasses = ClassScanner.getAnnotatedClasses(Arrays.asList(Include.class));\n+        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+        includeClasses.forEach(dictionary::bindEntity);\n         includeClasses.forEach(cls -> {\n-            String modelName = EntityDictionary.getEntityName(cls);\n+            String modelName = dictionary.getJsonAliasFor(cls);\n             String modelVersion = EntityDictionary.getModelVersion(cls);\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n+            Set<String> fieldNames = new HashSet<String>(dictionary.getAllFields(cls));\n+\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), fieldNames));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n \n-    private static Set<String> getFieldNames(Class<?> cls) {\n-        Set<String> fieldNames = new HashSet<String>();\n-        getAllFieldNames(cls, fieldNames);\n-        return fieldNames;\n-    }\n-\n-    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {\n-\n-        if (cls == Object.class) {\n-            return;\n-        }\n-\n-        getAllFieldNames(cls.getSuperclass(), fieldNames);\n-\n-        fieldNames.addAll(\n-            Arrays.stream(cls.getDeclaredFields())\n-                .filter(field -> !field.isSynthetic() && !Modifier.isStatic(field.getModifiers()))\n-                .map(field -> field.getName())\n-                .collect(Collectors.toList()\n-            )\n-        );\n-    }\n-\n     /**\n      * Parse dynamic config path.\n      * @param path : Dynamic config hjsons root location\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcxOTIzMw==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r520719233", "bodyText": "This is duplicating logic in EntityDictionary/EntityBinding but not correctly.  The more logic we add here, the more I think we need to leverage a private EntityDictionary rather than duplicate the logic.", "author": "aklish", "createdAt": "2020-11-10T16:57:29Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -83,11 +85,35 @@\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                            new ModelMapValue(className, prepareImport(pkgName, className)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n+\n+    private static Set<String> getFieldNames(Class<?> cls) {\n+        Set<String> fieldNames = new HashSet<String>();\n+        getAllFieldNames(cls, fieldNames);\n+        return fieldNames;\n+    }\n+\n+    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {", "originalCommit": "bf4cc71118d5c15a33b4aba3bde797ba350064fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0ODMzMg==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r522348332", "bodyText": "created private EntityDictionary.", "author": "rishi-aga", "createdAt": "2020-11-12T19:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcxOTIzMw=="}], "type": "inlineReview", "revised_code": {"commit": "c998aac9286fdea8d029ada15071976989fd9af9", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\nindex f32472698..d2681b76f 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n\n@@ -79,41 +78,22 @@ public class ElideDynamicEntityCompiler {\n     private static Map<ModelMapKey, ModelMapValue> createMapping() {\n         Map<ModelMapKey, ModelMapValue> map = new HashMap<>();\n         Set<Class<?>> includeClasses = ClassScanner.getAnnotatedClasses(Arrays.asList(Include.class));\n+        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+        includeClasses.forEach(dictionary::bindEntity);\n         includeClasses.forEach(cls -> {\n-            String modelName = EntityDictionary.getEntityName(cls);\n+            String modelName = dictionary.getJsonAliasFor(cls);\n             String modelVersion = EntityDictionary.getModelVersion(cls);\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n+            Set<String> fieldNames = new HashSet<String>(dictionary.getAllFields(cls));\n+\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), fieldNames));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n \n-    private static Set<String> getFieldNames(Class<?> cls) {\n-        Set<String> fieldNames = new HashSet<String>();\n-        getAllFieldNames(cls, fieldNames);\n-        return fieldNames;\n-    }\n-\n-    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {\n-\n-        if (cls == Object.class) {\n-            return;\n-        }\n-\n-        getAllFieldNames(cls.getSuperclass(), fieldNames);\n-\n-        fieldNames.addAll(\n-            Arrays.stream(cls.getDeclaredFields())\n-                .filter(field -> !field.isSynthetic() && !Modifier.isStatic(field.getModifiers()))\n-                .map(field -> field.getName())\n-                .collect(Collectors.toList()\n-            )\n-        );\n-    }\n-\n     /**\n      * Parse dynamic config path.\n      * @param path : Dynamic config hjsons root location\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDcxOTYzOQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r520719639", "bodyText": "Elide \"fields\" can either be methods or attributes.  The logic is a bit complicated and we don't want to duplicate it.", "author": "aklish", "createdAt": "2020-11-10T16:58:02Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -83,11 +85,35 @@\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                            new ModelMapValue(className, prepareImport(pkgName, className)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n+\n+    private static Set<String> getFieldNames(Class<?> cls) {\n+        Set<String> fieldNames = new HashSet<String>();\n+        getAllFieldNames(cls, fieldNames);\n+        return fieldNames;\n+    }\n+\n+    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {\n+\n+        if (cls == Object.class) {\n+            return;\n+        }\n+\n+        getAllFieldNames(cls.getSuperclass(), fieldNames);\n+\n+        fieldNames.addAll(\n+            Arrays.stream(cls.getDeclaredFields())", "originalCommit": "bf4cc71118d5c15a33b4aba3bde797ba350064fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c998aac9286fdea8d029ada15071976989fd9af9", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\nindex f32472698..d2681b76f 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n\n@@ -79,41 +78,22 @@ public class ElideDynamicEntityCompiler {\n     private static Map<ModelMapKey, ModelMapValue> createMapping() {\n         Map<ModelMapKey, ModelMapValue> map = new HashMap<>();\n         Set<Class<?>> includeClasses = ClassScanner.getAnnotatedClasses(Arrays.asList(Include.class));\n+        EntityDictionary dictionary = new EntityDictionary(new HashMap<>());\n+        includeClasses.forEach(dictionary::bindEntity);\n         includeClasses.forEach(cls -> {\n-            String modelName = EntityDictionary.getEntityName(cls);\n+            String modelName = dictionary.getJsonAliasFor(cls);\n             String modelVersion = EntityDictionary.getModelVersion(cls);\n             String className = cls.getSimpleName();\n             String pkgName = cls.getPackage().getName();\n+            Set<String> fieldNames = new HashSet<String>(dictionary.getAllFields(cls));\n+\n             map.put(new ModelMapKey(modelName, modelVersion),\n-                    new ModelMapValue(className, prepareImport(pkgName, className), getFieldNames(cls)));\n+                    new ModelMapValue(className, prepareImport(pkgName, className), fieldNames));\n         });\n \n         return Collections.unmodifiableMap(map);\n     }\n \n-    private static Set<String> getFieldNames(Class<?> cls) {\n-        Set<String> fieldNames = new HashSet<String>();\n-        getAllFieldNames(cls, fieldNames);\n-        return fieldNames;\n-    }\n-\n-    private static void getAllFieldNames(Class<?> cls, Set<String> fieldNames) {\n-\n-        if (cls == Object.class) {\n-            return;\n-        }\n-\n-        getAllFieldNames(cls.getSuperclass(), fieldNames);\n-\n-        fieldNames.addAll(\n-            Arrays.stream(cls.getDeclaredFields())\n-                .filter(field -> !field.isSynthetic() && !Modifier.isStatic(field.getModifiers()))\n-                .map(field -> field.getName())\n-                .collect(Collectors.toList()\n-            )\n-        );\n-    }\n-\n     /**\n      * Parse dynamic config path.\n      * @param path : Dynamic config hjsons root location\n"}}, {"oid": "30122ff1899529b35714a525a995be8dd7628ce2", "url": "https://github.com/yahoo/elide/commit/30122ff1899529b35714a525a995be8dd7628ce2", "message": "Validation for tableSource", "committedDate": "2020-11-12T13:49:36Z", "type": "forcePushed"}, {"oid": "c998aac9286fdea8d029ada15071976989fd9af9", "url": "https://github.com/yahoo/elide/commit/c998aac9286fdea8d029ada15071976989fd9af9", "message": "Review Comments", "committedDate": "2020-11-12T14:52:18Z", "type": "forcePushed"}, {"oid": "6a110a796620ea22fa5a51c916cf10dcf980b172", "url": "https://github.com/yahoo/elide/commit/6a110a796620ea22fa5a51c916cf10dcf980b172", "message": "Review Comments", "committedDate": "2020-11-12T19:04:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0NTk2NQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r522345965", "bodyText": "Is there a reason these functions need to be static?", "author": "aklish", "createdAt": "2020-11-12T19:04:17Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -271,4 +277,16 @@ public static String getStaticModelClassImport(String modelName, String modelVer\n         ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));\n         return value != null ? value.getClassImport() : defaultValue;\n     }\n+\n+    /**\n+     * Checks if field exists in referenced static model.\n+     * @param modelName model name.\n+     * @param modelVersion model version.\n+     * @param fieldName field name to check.\n+     * @return true if model has the field defined else false\n+     */\n+    public static boolean staticModelContainsField(String modelName, String modelVersion, String fieldName) {", "originalCommit": "c998aac9286fdea8d029ada15071976989fd9af9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NTU5Nw==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r524365597", "bodyText": "defined as static so that it can be used for both DynamicConfigValidator and HandlebarsHydrator easily.", "author": "rishi-aga", "createdAt": "2020-11-16T15:44:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM0NTk2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "8307c08be5930e332f93bd49901c84c1e5072e07", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\nindex d2681b76f..384077577 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n\n@@ -282,11 +282,33 @@ public class ElideDynamicEntityCompiler {\n      * Checks if field exists in referenced static model.\n      * @param modelName model name.\n      * @param modelVersion model version.\n-     * @param fieldName field name to check.\n-     * @return true if model has the field defined else false\n+     * @return set of fields \n      */\n-    public static boolean staticModelContainsField(String modelName, String modelVersion, String fieldName) {\n+    public static Set<String> staticModelFields(String modelName, String modelVersion) {\n+        ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));\n+        return value != null ? value.getFieldNames() : null;\n+    }\n+\n+    /**\n+     * Check if provided (modelName, modelVersion) is defined.\n+     * @param modelName model name.\n+     * @param modelVersion model version.\n+     * @return true is provided (modelName, modelVersion) exists.\n+     */\n+    public static boolean isStaticModel(String modelName, String modelVersion) {\n+        return STATIC_MODEL_DETAILS.containsKey(new ModelMapKey(modelName, modelVersion));\n+    }\n+\n+    /**\n+     * Check if provided (modelName, modelVersion) has provided field.\n+     * @param modelName model name.\n+     * @param modelVersion model version.\n+     * @param fieldName field name.\n+     * @return true is provided (modelName, modelVersion) has provided field.\n+     */\n+    public static boolean staticModelHasField(String modelName, String modelVersion, String fieldName) {\n         ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));\n         return value != null ? value.getFieldNames().contains(fieldName) : false;\n     }\n+    \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjM4NQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r522352385", "bodyText": "I wonder if it would be clearer if some of these methods were moved to ElideTableConfig.", "author": "aklish", "createdAt": "2020-11-12T19:13:02Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java", "diffHunk": "@@ -343,16 +337,77 @@ private static void validateConfigForMissingVariables(String config, Map<String,\n     private static boolean validateTableConfig(ElideTableConfig elideTableConfig) {\n         for (Table table : elideTableConfig.getTables()) {\n             validateSql(table.getSql());\n-            table.getDimensions().forEach(dim -> validateSql(dim.getDefinition()));\n+            table.getDimensions().forEach(dim -> {\n+                validateSql(dim.getDefinition());\n+                validateTableSource(elideTableConfig, dim.getTableSource());\n+            });\n             table.getMeasures().forEach(measure -> validateSql(measure.getDefinition()));\n             table.getJoins().forEach(join -> validateJoin(join, elideTableConfig));\n         }\n+\n         return true;\n     }\n \n+    private static void validateTableSource(ElideTableConfig elideTableConfig, String tableSource) {\n+        if (isNullOrEmpty(tableSource)) {\n+            return; // Nothing to validate\n+        }\n+\n+        String[] split = tableSource.split(\"\\\\.\");\n+        if (split.length != 2) {\n+            throw new IllegalStateException(\"Invalid tableSource: \" + tableSource\n+                            + \". tableSource must be in format: modelName.columnName\");\n+        }\n+        String modelName = split[0];\n+        String fieldName = split[1];\n+\n+        if (!staticModelContainsField(modelName, NO_VERSION, fieldName)\n+                        && !dynamicModelContainsField(elideTableConfig, modelName, fieldName)) {\n+            throw new IllegalStateException(\"Invalid tableSource : \" + tableSource + \" . Either model : \" + modelName\n+                            + \" is undefined or field : \" + fieldName + \" is undefined for this model.\");\n+        }\n+    }\n+\n+    private static boolean dynamicModelContainsField(ElideTableConfig elideTableConfig, String modelName,\n+                    String fieldName) {\n+        if (getNames(elideTableConfig.getTables()).contains(modelName)", "originalCommit": "6a110a796620ea22fa5a51c916cf10dcf980b172", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2Mzc4MQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r524363781", "bodyText": "updated.", "author": "rishi-aga", "createdAt": "2020-11-16T15:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjM4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "8307c08be5930e332f93bd49901c84c1e5072e07", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\nindex 95c8eded6..6a83338e8 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n\n@@ -330,24 +300,49 @@ public class DynamicConfigValidator {\n     }\n \n     /**\n-     * Validate table sql and column definition provided in table configs.\n+     * Validate table configs.\n      * @param elideTableConfig ElideTableConfig\n-     * @return boolean true if all sql/definition passes validation\n+     * @return boolean true if all provided table properties passes validation\n      */\n     private static boolean validateTableConfig(ElideTableConfig elideTableConfig) {\n         for (Table table : elideTableConfig.getTables()) {\n+\n+            validateExtend(elideTableConfig, table.getExtend());\n             validateSql(table.getSql());\n+            Set<String> tableFields = new HashSet<>();\n+\n             table.getDimensions().forEach(dim -> {\n+                validateFieldNameUniqueness(tableFields, dim.getName(), table.getName());\n                 validateSql(dim.getDefinition());\n                 validateTableSource(elideTableConfig, dim.getTableSource());\n             });\n-            table.getMeasures().forEach(measure -> validateSql(measure.getDefinition()));\n-            table.getJoins().forEach(join -> validateJoin(join, elideTableConfig));\n+\n+            table.getMeasures().forEach(measure -> {\n+                validateFieldNameUniqueness(tableFields, measure.getName(), table.getName());\n+                validateSql(measure.getDefinition());\n+            });\n+\n+            table.getJoins().forEach(join -> {\n+                validateFieldNameUniqueness(tableFields, join.getName(), table.getName());\n+                validateJoin(join, elideTableConfig);\n+            });\n         }\n \n         return true;\n     }\n \n+    private static void validateFieldNameUniqueness(Set<String> alreadyFoundFields, String fieldName,\n+                    String tableName) {\n+        if (!alreadyFoundFields.add(fieldName.toLowerCase(Locale.ENGLISH))) {\n+            throw new IllegalStateException(String.format(\"Duplicate!! Field name: %s is not unique for table: %s\",\n+                            fieldName, tableName));\n+        }\n+    }\n+\n+    /**\n+     * Validates tableSource is in format: modelName.logicalColumnName and refers to a defined model and a defined\n+     * column with in that model.\n+     */\n     private static void validateTableSource(ElideTableConfig elideTableConfig, String tableSource) {\n         if (isNullOrEmpty(tableSource)) {\n             return; // Nothing to validate\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjY3Ng==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r522352676", "bodyText": "We should break these errors out to help the developer.", "author": "aklish", "createdAt": "2020-11-12T19:13:34Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java", "diffHunk": "@@ -343,16 +337,77 @@ private static void validateConfigForMissingVariables(String config, Map<String,\n     private static boolean validateTableConfig(ElideTableConfig elideTableConfig) {\n         for (Table table : elideTableConfig.getTables()) {\n             validateSql(table.getSql());\n-            table.getDimensions().forEach(dim -> validateSql(dim.getDefinition()));\n+            table.getDimensions().forEach(dim -> {\n+                validateSql(dim.getDefinition());\n+                validateTableSource(elideTableConfig, dim.getTableSource());\n+            });\n             table.getMeasures().forEach(measure -> validateSql(measure.getDefinition()));\n             table.getJoins().forEach(join -> validateJoin(join, elideTableConfig));\n         }\n+\n         return true;\n     }\n \n+    private static void validateTableSource(ElideTableConfig elideTableConfig, String tableSource) {\n+        if (isNullOrEmpty(tableSource)) {\n+            return; // Nothing to validate\n+        }\n+\n+        String[] split = tableSource.split(\"\\\\.\");\n+        if (split.length != 2) {\n+            throw new IllegalStateException(\"Invalid tableSource: \" + tableSource\n+                            + \". tableSource must be in format: modelName.columnName\");\n+        }\n+        String modelName = split[0];\n+        String fieldName = split[1];\n+\n+        if (!staticModelContainsField(modelName, NO_VERSION, fieldName)\n+                        && !dynamicModelContainsField(elideTableConfig, modelName, fieldName)) {\n+            throw new IllegalStateException(\"Invalid tableSource : \" + tableSource + \" . Either model : \" + modelName\n+                            + \" is undefined or field : \" + fieldName + \" is undefined for this model.\");", "originalCommit": "6a110a796620ea22fa5a51c916cf10dcf980b172", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2MzU3MQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r524363571", "bodyText": "sure.", "author": "rishi-aga", "createdAt": "2020-11-16T15:42:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1MjY3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "8307c08be5930e332f93bd49901c84c1e5072e07", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\nindex 95c8eded6..6a83338e8 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n\n@@ -330,24 +300,49 @@ public class DynamicConfigValidator {\n     }\n \n     /**\n-     * Validate table sql and column definition provided in table configs.\n+     * Validate table configs.\n      * @param elideTableConfig ElideTableConfig\n-     * @return boolean true if all sql/definition passes validation\n+     * @return boolean true if all provided table properties passes validation\n      */\n     private static boolean validateTableConfig(ElideTableConfig elideTableConfig) {\n         for (Table table : elideTableConfig.getTables()) {\n+\n+            validateExtend(elideTableConfig, table.getExtend());\n             validateSql(table.getSql());\n+            Set<String> tableFields = new HashSet<>();\n+\n             table.getDimensions().forEach(dim -> {\n+                validateFieldNameUniqueness(tableFields, dim.getName(), table.getName());\n                 validateSql(dim.getDefinition());\n                 validateTableSource(elideTableConfig, dim.getTableSource());\n             });\n-            table.getMeasures().forEach(measure -> validateSql(measure.getDefinition()));\n-            table.getJoins().forEach(join -> validateJoin(join, elideTableConfig));\n+\n+            table.getMeasures().forEach(measure -> {\n+                validateFieldNameUniqueness(tableFields, measure.getName(), table.getName());\n+                validateSql(measure.getDefinition());\n+            });\n+\n+            table.getJoins().forEach(join -> {\n+                validateFieldNameUniqueness(tableFields, join.getName(), table.getName());\n+                validateJoin(join, elideTableConfig);\n+            });\n         }\n \n         return true;\n     }\n \n+    private static void validateFieldNameUniqueness(Set<String> alreadyFoundFields, String fieldName,\n+                    String tableName) {\n+        if (!alreadyFoundFields.add(fieldName.toLowerCase(Locale.ENGLISH))) {\n+            throw new IllegalStateException(String.format(\"Duplicate!! Field name: %s is not unique for table: %s\",\n+                            fieldName, tableName));\n+        }\n+    }\n+\n+    /**\n+     * Validates tableSource is in format: modelName.logicalColumnName and refers to a defined model and a defined\n+     * column with in that model.\n+     */\n     private static void validateTableSource(ElideTableConfig elideTableConfig, String tableSource) {\n         if (isNullOrEmpty(tableSource)) {\n             return; // Nothing to validate\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1Mjg5MQ==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r522352891", "bodyText": "Seems like another function that could be moved to ElideTableConfig?", "author": "aklish", "createdAt": "2020-11-12T19:14:00Z", "path": "elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java", "diffHunk": "@@ -185,21 +180,20 @@ private void flagDimensionsToOverride(Table table, Set<Table> parentTables) {\n         Table current = table;\n \n         while (current != null && current.getExtend() != null && !current.getExtend().equals(\"\")) {\n-            Table parent = getTableByName(current.getExtend().trim());\n+            Table parent = getTableByName(this.elideTableConfig, current.getExtend().trim());\n             parentTables.add(parent);\n             current = parent;\n         }\n         return parentTables;\n     }\n \n-    private Table getTableByName(String tableName) {\n-        Table tableByName = this.elideTableConfig.getTables().stream().filter(\n-                table -> table.getName().equals(tableName)).findFirst().orElse(null);\n-\n-        if (tableByName != null) {\n-            return tableByName;\n-        }\n-        throw new IllegalStateException(\"Table \" + tableName + \" is not defined in Dynamic Config.\");\n+    private static Table getTableByName(ElideTableConfig elideTableConfig, String tableName) {\n+        return elideTableConfig.getTables()", "originalCommit": "6a110a796620ea22fa5a51c916cf10dcf980b172", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2MzYzOA==", "url": "https://github.com/yahoo/elide/pull/1655#discussion_r524363638", "bodyText": "updated.", "author": "rishi-aga", "createdAt": "2020-11-16T15:42:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM1Mjg5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "8307c08be5930e332f93bd49901c84c1e5072e07", "chunk": "diff --git a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\nindex 95c8eded6..6a83338e8 100644\n--- a/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n+++ b/elide-model-config/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/validator/DynamicConfigValidator.java\n\n@@ -135,65 +137,33 @@ public class DynamicConfigValidator {\n         this.setDbVariables(readVariableConfig(Config.DBVARIABLE));\n         this.elideSQLDBConfig.setDbconfigs(readDbConfig());\n         this.elideTableConfig.setTables(readTableConfig());\n-        populateInheritanceHierarchy();\n         validateRequiredConfigsProvided();\n         validateNameUniqueness(this.elideSQLDBConfig.getDbconfigs());\n         validateNameUniqueness(this.elideTableConfig.getTables());\n         validateTableConfig(this.elideTableConfig);\n         validateJoinedTablesDBConnectionName(this.elideTableConfig);\n+        populateInheritanceHierarchy(this.elideTableConfig);\n     }\n \n-    private void populateInheritanceHierarchy() {\n-        for (Table table : this.elideTableConfig.getTables()) {\n-            Set<Table> parentTables = getParents(table);\n-            if (parentTables.size() > 0) {\n-                flagMeasuresToOverride(table, parentTables);\n-                flagDimensionsToOverride(table, parentTables);\n-            }\n-        }\n-    }\n-\n-    private void flagMeasuresToOverride(Table table, Set<Table> parentTables) {\n-        Set<String> parentClassMeasures = new HashSet<>();\n-        parentTables.forEach(obj -> parentClassMeasures.addAll(getNames(obj.getMeasures())));\n+    private static void populateInheritanceHierarchy(ElideTableConfig elideTableConfig) {\n+        for (Table table : elideTableConfig.getTables()) {\n \n-        table.getMeasures().forEach(measure -> {\n-            if (parentClassMeasures.contains(measure.getName())) {\n-                measure.setOverride(true);\n-            }\n-        });\n-    }\n+            if (table.hasParent()) {\n+                Table parent = table.getParent(elideTableConfig);\n \n-    private void flagDimensionsToOverride(Table table, Set<Table> parentTables) {\n-        Set<String> parentClassDimensions = new HashSet<>();\n-        parentTables.forEach(obj -> parentClassDimensions.addAll(getNames(obj.getDimensions())));\n+                table.getMeasures().forEach(measure -> {\n+                    if (parent.hasField(elideTableConfig, measure.getName())) {\n+                        measure.setOverride(true);\n+                    }\n+                });\n \n-        table.getDimensions().forEach(dimension -> {\n-            if (parentClassDimensions.contains(dimension.getName())) {\n-                dimension.setOverride(true);\n+                table.getDimensions().forEach(dimension -> {\n+                    if (parent.hasField(elideTableConfig, dimension.getName())) {\n+                        dimension.setOverride(true);\n+                    }\n+                });\n             }\n-        });\n-    }\n-\n-    private Set<Table> getParents(Table table) {\n-        Set<Table> parentTables = new HashSet<>();\n-        Table current = table;\n-\n-        while (current != null && current.getExtend() != null && !current.getExtend().equals(\"\")) {\n-            Table parent = getTableByName(this.elideTableConfig, current.getExtend().trim());\n-            parentTables.add(parent);\n-            current = parent;\n         }\n-        return parentTables;\n-    }\n-\n-    private static Table getTableByName(ElideTableConfig elideTableConfig, String tableName) {\n-        return elideTableConfig.getTables()\n-                        .stream()\n-                        .filter(t -> t.getName().equals(tableName))\n-                        .findFirst()\n-                        .orElseThrow(() -> new IllegalStateException(\n-                                        \"Undefined model: \" + tableName + \" in Dynamic Config.\"));\n     }\n \n     /**\n"}}, {"oid": "f20e59338888d5ab4a20001fcc344fce436d03a6", "url": "https://github.com/yahoo/elide/commit/f20e59338888d5ab4a20001fcc344fce436d03a6", "message": "Validation for tableSource", "committedDate": "2020-11-15T14:28:30Z", "type": "commit"}, {"oid": "39e3559bd00e6900bbb92671a7248649e0e64cda", "url": "https://github.com/yahoo/elide/commit/39e3559bd00e6900bbb92671a7248649e0e64cda", "message": "Review Comments", "committedDate": "2020-11-15T14:28:30Z", "type": "commit"}, {"oid": "8307c08be5930e332f93bd49901c84c1e5072e07", "url": "https://github.com/yahoo/elide/commit/8307c08be5930e332f93bd49901c84c1e5072e07", "message": "Review comments: consolidate methods", "committedDate": "2020-11-16T03:00:25Z", "type": "commit"}, {"oid": "8307c08be5930e332f93bd49901c84c1e5072e07", "url": "https://github.com/yahoo/elide/commit/8307c08be5930e332f93bd49901c84c1e5072e07", "message": "Review comments: consolidate methods", "committedDate": "2020-11-16T03:00:25Z", "type": "forcePushed"}, {"oid": "666968c03d76fec226956612c1d4cd593bf61a1d", "url": "https://github.com/yahoo/elide/commit/666968c03d76fec226956612c1d4cd593bf61a1d", "message": "Checkstyle fixes", "committedDate": "2020-11-16T15:25:19Z", "type": "commit"}, {"oid": "c1fb28de3a7414dc5147008ad049af0300d4c4da", "url": "https://github.com/yahoo/elide/commit/c1fb28de3a7414dc5147008ad049af0300d4c4da", "message": "Minor Changes", "committedDate": "2020-11-16T15:39:07Z", "type": "commit"}, {"oid": "48f127e5674a1bfff3b99192366a7abe8a1cd366", "url": "https://github.com/yahoo/elide/commit/48f127e5674a1bfff3b99192366a7abe8a1cd366", "message": "Update elideTableSchema.json", "committedDate": "2020-11-16T16:54:04Z", "type": "commit"}]}