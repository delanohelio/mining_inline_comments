{"pr_number": 1606, "pr_title": "Lookup Join Class from static defined models", "pr_createdAt": "2020-10-21T15:55:41Z", "pr_url": "https://github.com/yahoo/elide/pull/1606", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMDczMw==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509410733", "bodyText": "There is a NO_VERSION constant you can use here. you can use here.", "author": "aklish", "createdAt": "2020-10-21T16:00:44Z", "path": "elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java", "diffHunk": "@@ -193,4 +194,23 @@ public String trimColumnReferences(String str) {\n         }\n         return str;\n     }\n+\n+    /**\n+     * Get Class Name for provided modelName from static models if available else default value.\n+     * @param modelName model name.\n+     * @return class name.\n+     */\n+    public String getJoinClassName(String modelName) {\n+        return ElideDynamicEntityCompiler.getStaticModelClassName(modelName, EMPTY_STRING,", "originalCommit": "8213e8ec336197d4f9754d1e91a8e043eff463ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQyOTc5Nw==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509429797", "bodyText": "\ud83d\udc4d", "author": "rishi-aga", "createdAt": "2020-10-21T16:28:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMDczMw=="}], "type": "inlineReview", "revised_code": {"commit": "6b74590db86baf8abfcab46f786c9471927b581b", "chunk": "diff --git a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\nindex dbc14ba3d..3d46fa3f9 100644\n--- a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\n+++ b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\n\n@@ -187,30 +194,11 @@ public class HandlebarsHelper {\n      */\n     public String trimColumnReferences(String str) {\n         Matcher matcher = REFERENCE_PARENTHESES.matcher(str);\n-\n+        String expr = str;\n         while (matcher.find()) {\n             String reference = matcher.group(1);\n-            str = str.replace(reference, reference.trim());\n+            expr = expr.replace(reference, reference.trim());\n         }\n-        return str;\n-    }\n-\n-    /**\n-     * Get Class Name for provided modelName from static models if available else default value.\n-     * @param modelName model name.\n-     * @return class name.\n-     */\n-    public String getJoinClassName(String modelName) {\n-        return ElideDynamicEntityCompiler.getStaticModelClassName(modelName, EMPTY_STRING,\n-                        capitalizeFirstLetter(modelName));\n-    }\n-\n-    /**\n-     * Get Class Import for provided modelName from static models if available.\n-     * @param modelName model name.\n-     * @return import statement.\n-     */\n-    public String getJoinClassImport(String modelName) {\n-        return ElideDynamicEntityCompiler.getStaticModelClassImport(modelName, EMPTY_STRING, EMPTY_STRING);\n+        return expr;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMDgzMA==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509410830", "bodyText": "same comment.", "author": "aklish", "createdAt": "2020-10-21T16:00:52Z", "path": "elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java", "diffHunk": "@@ -193,4 +194,23 @@ public String trimColumnReferences(String str) {\n         }\n         return str;\n     }\n+\n+    /**\n+     * Get Class Name for provided modelName from static models if available else default value.\n+     * @param modelName model name.\n+     * @return class name.\n+     */\n+    public String getJoinClassName(String modelName) {\n+        return ElideDynamicEntityCompiler.getStaticModelClassName(modelName, EMPTY_STRING,\n+                        capitalizeFirstLetter(modelName));\n+    }\n+\n+    /**\n+     * Get Class Import for provided modelName from static models if available.\n+     * @param modelName model name.\n+     * @return import statement.\n+     */\n+    public String getJoinClassImport(String modelName) {\n+        return ElideDynamicEntityCompiler.getStaticModelClassImport(modelName, EMPTY_STRING, EMPTY_STRING);", "originalCommit": "8213e8ec336197d4f9754d1e91a8e043eff463ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQyOTkwNg==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509429906", "bodyText": "\ud83d\udc4d", "author": "rishi-aga", "createdAt": "2020-10-21T16:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMDgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "6b74590db86baf8abfcab46f786c9471927b581b", "chunk": "diff --git a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\nindex dbc14ba3d..3d46fa3f9 100644\n--- a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\n+++ b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/parser/handlebars/HandlebarsHelper.java\n\n@@ -187,30 +194,11 @@ public class HandlebarsHelper {\n      */\n     public String trimColumnReferences(String str) {\n         Matcher matcher = REFERENCE_PARENTHESES.matcher(str);\n-\n+        String expr = str;\n         while (matcher.find()) {\n             String reference = matcher.group(1);\n-            str = str.replace(reference, reference.trim());\n+            expr = expr.replace(reference, reference.trim());\n         }\n-        return str;\n-    }\n-\n-    /**\n-     * Get Class Name for provided modelName from static models if available else default value.\n-     * @param modelName model name.\n-     * @return class name.\n-     */\n-    public String getJoinClassName(String modelName) {\n-        return ElideDynamicEntityCompiler.getStaticModelClassName(modelName, EMPTY_STRING,\n-                        capitalizeFirstLetter(modelName));\n-    }\n-\n-    /**\n-     * Get Class Import for provided modelName from static models if available.\n-     * @param modelName model name.\n-     * @return import statement.\n-     */\n-    public String getJoinClassImport(String modelName) {\n-        return ElideDynamicEntityCompiler.getStaticModelClassImport(modelName, EMPTY_STRING, EMPTY_STRING);\n+        return expr;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMTk4MQ==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509411981", "bodyText": "We should use these lookups to validate the joins as well (so we don't get a cryptic error here if they put down a class that doesn't exist).", "author": "aklish", "createdAt": "2020-10-21T16:02:31Z", "path": "elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java", "diffHunk": "@@ -201,4 +238,38 @@ public ClassLoader getClassLoader() {\n                .map(Class::getName)\n                .collect(Collectors.toList());\n     }\n+\n+    /**\n+     * Prepare Import statement.\n+     * @param pkgName package name.\n+     * @param className class name.\n+     * @return complete import statement.\n+     */\n+    private static String prepareImport(String pkgName, String className) {\n+        return IMPORT + pkgName + DOT + className + SEMI_COLON;\n+    }\n+\n+    /**\n+     * Get Class Name for provided (modelName, modelVersion).\n+     * @param modelName model name.\n+     * @param modelVersion model version.\n+     * @param defaultValue default value.\n+     * @return class name for provided (modelName, modelVersion) if available else default value.\n+     */\n+    public static String getStaticModelClassName(String modelName, String modelVersion, String defaultValue) {\n+        ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));", "originalCommit": "8213e8ec336197d4f9754d1e91a8e043eff463ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQ4Nzg5Mw==", "url": "https://github.com/yahoo/elide/pull/1606#discussion_r509487893", "bodyText": "Added validation on Join's to value", "author": "rishi-aga", "createdAt": "2020-10-21T17:38:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxMTk4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "6b74590db86baf8abfcab46f786c9471927b581b", "chunk": "diff --git a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\nindex b75e80f85..33e503a70 100644\n--- a/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n+++ b/elide-contrib/elide-dynamic-config-helpers/src/main/java/com/yahoo/elide/contrib/dynamicconfighelpers/compile/ElideDynamicEntityCompiler.java\n\n@@ -238,38 +201,4 @@ public class ElideDynamicEntityCompiler {\n                .map(Class::getName)\n                .collect(Collectors.toList());\n     }\n-\n-    /**\n-     * Prepare Import statement.\n-     * @param pkgName package name.\n-     * @param className class name.\n-     * @return complete import statement.\n-     */\n-    private static String prepareImport(String pkgName, String className) {\n-        return IMPORT + pkgName + DOT + className + SEMI_COLON;\n-    }\n-\n-    /**\n-     * Get Class Name for provided (modelName, modelVersion).\n-     * @param modelName model name.\n-     * @param modelVersion model version.\n-     * @param defaultValue default value.\n-     * @return class name for provided (modelName, modelVersion) if available else default value.\n-     */\n-    public static String getStaticModelClassName(String modelName, String modelVersion, String defaultValue) {\n-        ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));\n-        return value != null ? value.getClassName() : defaultValue;\n-    }\n-\n-    /**\n-     * Get Class Import for provided (modelName, modelVersion).\n-     * @param modelName model name.\n-     * @param modelVersion model version.\n-     * @param defaultValue default value.\n-     * @return import statement for provided (modelName, modelVersion) if available else default value.\n-     */\n-    public static String getStaticModelClassImport(String modelName, String modelVersion, String defaultValue) {\n-        ModelMapValue value = STATIC_MODEL_DETAILS.get(new ModelMapKey(modelName, modelVersion));\n-        return value != null ? value.getClassImport() : defaultValue;\n-    }\n }\n"}}, {"oid": "6b74590db86baf8abfcab46f786c9471927b581b", "url": "https://github.com/yahoo/elide/commit/6b74590db86baf8abfcab46f786c9471927b581b", "message": "Standardize template substitutions for Join Expressions", "committedDate": "2020-10-27T17:05:37Z", "type": "commit"}, {"oid": "61ba19397ba8319d8a8ed72e88fdd2af3b1d5318", "url": "https://github.com/yahoo/elide/commit/61ba19397ba8319d8a8ed72e88fdd2af3b1d5318", "message": "Allow physical column references from referred table in parent table.", "committedDate": "2020-10-27T17:10:25Z", "type": "commit"}, {"oid": "671b29b3879e456c50288e6666782a431b6e1d80", "url": "https://github.com/yahoo/elide/commit/671b29b3879e456c50288e6666782a431b6e1d80", "message": "Lookup Join Class from static defined models", "committedDate": "2020-10-27T17:10:26Z", "type": "commit"}, {"oid": "f58017847cbdb57d9f10c543293644a9561321fe", "url": "https://github.com/yahoo/elide/commit/f58017847cbdb57d9f10c543293644a9561321fe", "message": "Review Comments", "committedDate": "2020-10-27T17:10:26Z", "type": "commit"}, {"oid": "4ede13a361884334cb8469a48dd9c7dcdfa09ea5", "url": "https://github.com/yahoo/elide/commit/4ede13a361884334cb8469a48dd9c7dcdfa09ea5", "message": "Clean up", "committedDate": "2020-10-27T17:10:26Z", "type": "commit"}, {"oid": "4ede13a361884334cb8469a48dd9c7dcdfa09ea5", "url": "https://github.com/yahoo/elide/commit/4ede13a361884334cb8469a48dd9c7dcdfa09ea5", "message": "Clean up", "committedDate": "2020-10-27T17:10:26Z", "type": "forcePushed"}, {"oid": "ff02f81d6380fe830e0d0734a04c70ff2db41c34", "url": "https://github.com/yahoo/elide/commit/ff02f81d6380fe830e0d0734a04c70ff2db41c34", "message": "Cleanup", "committedDate": "2020-10-27T17:16:35Z", "type": "commit"}, {"oid": "56c7b388ae47e15b318097e659608dda9c50d71e", "url": "https://github.com/yahoo/elide/commit/56c7b388ae47e15b318097e659608dda9c50d71e", "message": "Codacy errors:", "committedDate": "2020-10-27T17:24:47Z", "type": "commit"}]}