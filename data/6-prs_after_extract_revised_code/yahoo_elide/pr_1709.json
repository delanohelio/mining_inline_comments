{"pr_number": 1709, "pr_title": "Dynamic Model tests to AggregationDataStoreIntegrationTest", "pr_createdAt": "2020-12-04T17:28:46Z", "pr_url": "https://github.com/yahoo/elide/pull/1709", "timeline": [{"oid": "d912a99ad7b9c5a06059097e6831795535b0cd99", "url": "https://github.com/yahoo/elide/commit/d912a99ad7b9c5a06059097e6831795535b0cd99", "message": "moved testcases", "committedDate": "2020-12-04T17:25:08Z", "type": "commit"}, {"oid": "8c5347e35c32df5d18b5f4a59afdb6b32d6c2cab", "url": "https://github.com/yahoo/elide/commit/8c5347e35c32df5d18b5f4a59afdb6b32d6c2cab", "message": "add filtertemplate test", "committedDate": "2020-12-04T17:25:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzNzI0MA==", "url": "https://github.com/yahoo/elide/pull/1709#discussion_r536337240", "bodyText": "We can move the filter test cases to Aggregation store IT test. But I think there may be some merit in running DynamicConfigTest.jsonApiGetTest() in Spring separately. It will help us in testing and making sure that any changes to bean configurations do not break Spring Applications.\n@aklish Thoughts?", "author": "moizarafat", "createdAt": "2020-12-04T19:41:30Z", "path": "elide-spring/elide-spring-boot-autoconfigure/src/test/java/example/tests/DynamicConfigTest.java", "diffHunk": "@@ -1,113 +0,0 @@\n-/*\n- * Copyright 2020, Yahoo Inc.\n- * Licensed under the Apache License, Version 2.0\n- * See LICENSE file in project root for terms.\n- */\n-package example.tests;\n-\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.attr;\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.attributes;\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.data;\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.id;\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.resource;\n-import static com.yahoo.elide.test.jsonapi.JsonApiDSL.type;\n-import static io.restassured.RestAssured.when;\n-import static org.hamcrest.CoreMatchers.hasItems;\n-import static org.hamcrest.Matchers.equalTo;\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import com.yahoo.elide.core.exceptions.HttpStatus;\n-import org.junit.jupiter.api.Test;\n-import org.springframework.test.context.jdbc.Sql;\n-import org.springframework.test.context.jdbc.SqlMergeMode;\n-\n-/**\n- * Dynamic Configuration functional test.\n- * TODO - All of the tests in this file need to migrate over to AggregationDataStore so they are not duplicated\n- * here and in standalone tests.\n- */\n-@SqlMergeMode(SqlMergeMode.MergeMode.MERGE)\n-@Sql(executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD,\n-        statements = \"CREATE TABLE PlayerStats (name varchar(255) not null,\"\n-                + \"\\t\\t countryId varchar(255), createdOn timestamp, updatedOn timestamp,\"\n-                + \"\\t\\t highScore bigint, primary key (name));\"\n-                + \"CREATE TABLE PlayerCountry (id varchar(255) not null,\"\n-                + \"\\t\\t isoCode varchar(255), primary key (id));\"\n-                + \"INSERT INTO PlayerStats (name,countryId,createdOn,updatedOn) VALUES\\n\"\n-                + \"\\t\\t('SerenaWilliams','1','2000-10-10','2001-10-10');\"\n-                + \"INSERT INTO PlayerCountry (id,isoCode) VALUES\\n\"\n-                + \"\\t\\t('2','IND');\"\n-                + \"INSERT INTO PlayerCountry (id,isoCode) VALUES\\n\"\n-                + \"\\t\\t('1','USA');\")\n-@Sql(executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD,\n-statements = \"DROP TABLE PlayerStats; DROP TABLE PlayerCountry;\")\n-public class DynamicConfigTest extends IntegrationTest {\n-    /**\n-     * This test demonstrates an example test using the JSON-API DSL.\n-     * @throws InterruptedException\n-     */\n-\n-    @Test\n-    public void jsonApiGetTest() {", "originalCommit": "8c5347e35c32df5d18b5f4a59afdb6b32d6c2cab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzODQ1NQ==", "url": "https://github.com/yahoo/elide/pull/1709#discussion_r536338455", "bodyText": "Instead of a separate java file, may be it could just run as part of ControllerTest or AggregationStoreTest", "author": "moizarafat", "createdAt": "2020-12-04T19:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMzNzI0MA=="}], "type": "inlineReview", "revised_code": {"commit": "722d6580d17826e8ace9b77a72db5782f8f01e85", "chunk": "diff --git a/elide-spring/elide-spring-boot-autoconfigure/src/test/java/example/tests/DynamicConfigTest.java b/elide-spring/elide-spring-boot-autoconfigure/src/test/java/example/tests/DynamicConfigTest.java\nnew file mode 100644\nindex 000000000..45172c777\n--- /dev/null\n+++ b/elide-spring/elide-spring-boot-autoconfigure/src/test/java/example/tests/DynamicConfigTest.java\n\n@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2020, Yahoo Inc.\n+ * Licensed under the Apache License, Version 2.0\n+ * See LICENSE file in project root for terms.\n+ */\n+package example.tests;\n+\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.attr;\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.attributes;\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.data;\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.id;\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.resource;\n+import static com.yahoo.elide.test.jsonapi.JsonApiDSL.type;\n+import static io.restassured.RestAssured.when;\n+import static org.hamcrest.CoreMatchers.hasItems;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import com.yahoo.elide.core.exceptions.HttpStatus;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.test.context.jdbc.Sql;\n+import org.springframework.test.context.jdbc.SqlMergeMode;\n+\n+/**\n+ * Dynamic Configuration functional test.\n+ * TODO - All of the tests in this file need to migrate over to AggregationDataStore so they are not duplicated\n+ * here and in standalone tests.\n+ */\n+@SqlMergeMode(SqlMergeMode.MergeMode.MERGE)\n+@Sql(executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD,\n+        statements = \"CREATE TABLE PlayerStats (name varchar(255) not null,\"\n+                + \"\\t\\t countryId varchar(255), createdOn timestamp, updatedOn timestamp,\"\n+                + \"\\t\\t highScore bigint, primary key (name));\"\n+                + \"CREATE TABLE PlayerCountry (id varchar(255) not null,\"\n+                + \"\\t\\t isoCode varchar(255), primary key (id));\"\n+                + \"INSERT INTO PlayerStats (name,countryId,createdOn,updatedOn) VALUES\\n\"\n+                + \"\\t\\t('SerenaWilliams','1','2000-10-10','2001-10-10');\"\n+                + \"INSERT INTO PlayerCountry (id,isoCode) VALUES\\n\"\n+                + \"\\t\\t('2','IND');\"\n+                + \"INSERT INTO PlayerCountry (id,isoCode) VALUES\\n\"\n+                + \"\\t\\t('1','USA');\")\n+@Sql(executionPhase = Sql.ExecutionPhase.AFTER_TEST_METHOD,\n+statements = \"DROP TABLE PlayerStats; DROP TABLE PlayerCountry;\")\n+public class DynamicConfigTest extends IntegrationTest {\n+    /**\n+     * This test demonstrates an example test using the JSON-API DSL.\n+     * @throws InterruptedException\n+     */\n+\n+    @Test\n+    public void jsonApiGetTest() {\n+        String apiGetViewRequest = when()\n+                .get(\"/json/playerStats?filter=createdOn>=1999-01-01;createdOn<2001-01-01\")\n+                .then()\n+                .body(equalTo(\n+                        data(\n+                                resource(\n+                                        type(\"playerStats\"),\n+                                        id(\"0\"),\n+                                        attributes(\n+                                                attr(\"countryCode\", \"USA\"),\n+                                                attr(\"createdOn\", \"2000-10-10\"),\n+                                                attr(\"highScore\", null),\n+                                                attr(\"name\", \"SerenaWilliams\"),\n+                                                attr(\"updatedOn\", \"2001-10\")\n+                                        )\n+                                )\n+                        ).toJSON())\n+                )\n+                .statusCode(HttpStatus.SC_OK).extract().response().asString();\n+        String apiGetViewExpected = \"{\\\"data\\\":[{\\\"type\\\":\\\"playerStats\\\",\\\"id\\\":\\\"0\\\",\\\"attributes\\\":{\\\"countryCode\\\":\\\"USA\\\",\\\"createdOn\\\":\\\"2000-10-10\\\",\\\"highScore\\\":null,\\\"name\\\":\\\"SerenaWilliams\\\",\\\"updatedOn\\\":\\\"2001-10\\\"}}]}\";\n+        assertEquals(apiGetViewExpected, apiGetViewRequest);\n+    }\n+\n+    @SqlMergeMode(SqlMergeMode.MergeMode.MERGE)\n+    @Sql(executionPhase = Sql.ExecutionPhase.BEFORE_TEST_METHOD,\n+            statements = \"INSERT INTO PlayerStats (name,countryId,createdOn,updatedOn) VALUES\\n\"\n+                    + \"\\t\\t('SaniaMirza','2','2000-10-10','2001-10-10');\")\n+    @Test\n+    public void jsonApiGetMultiTest() {\n+        when()\n+                .get(\"/json/playerStats?filter=createdOn>=1999-01-01;createdOn<2002-01-01\")\n+                .then()\n+                .body(\"data.id\", hasItems(\"1\"))\n+                .body(\"data.attributes.name\", hasItems(\"SaniaMirza\", \"SerenaWilliams\"))\n+                .body(\"data.attributes.countryCode\", hasItems(\"USA\", \"IND\"))\n+                .statusCode(HttpStatus.SC_OK);\n+    }\n+\n+\n+    @Test\n+    public void missingClientFilterTest() {\n+        String expectedError = \"Querying playerStats requires a mandatory filter: \"\n+                + \"createdOn&gt;={{start}};createdOn&lt;{{end}}\";\n+\n+        when()\n+                .get(\"/json/playerStats\")\n+                .then()\n+                .body(\"errors.detail\", hasItems(expectedError))\n+                .statusCode(HttpStatus.SC_BAD_REQUEST);\n+    }\n+\n+    @Test\n+    public void incompleteClientFilterTest() {\n+        String expectedError = \"Querying playerStats requires a mandatory filter: \"\n+                + \"createdOn&gt;={{start}};createdOn&lt;{{end}}\";\n+\n+        when()\n+                .get(\"/json/playerStats?createdOn>=1999-01-01\")\n+                .then()\n+                .body(\"errors.detail\", hasItems(expectedError))\n+                .statusCode(HttpStatus.SC_BAD_REQUEST);\n+    }\n+}\n"}}, {"oid": "313452f948d6cab63379a7c185c0c6fdb0cc8782", "url": "https://github.com/yahoo/elide/commit/313452f948d6cab63379a7c185c0c6fdb0cc8782", "message": "Merge branch 'elide-5.x' into elide-5.x-dynamic-model-it", "committedDate": "2020-12-07T17:26:17Z", "type": "commit"}, {"oid": "722d6580d17826e8ace9b77a72db5782f8f01e85", "url": "https://github.com/yahoo/elide/commit/722d6580d17826e8ace9b77a72db5782f8f01e85", "message": "Revert \"moved testcases\"\n\nThis reverts commit d912a99ad7b9c5a06059097e6831795535b0cd99.", "committedDate": "2020-12-07T17:33:58Z", "type": "commit"}, {"oid": "a8db2fc00f18eae975a1669778ef3ae728be1219", "url": "https://github.com/yahoo/elide/commit/a8db2fc00f18eae975a1669778ef3ae728be1219", "message": "revert dynamic test", "committedDate": "2020-12-07T17:36:16Z", "type": "commit"}, {"oid": "1214029e0aea8ea17fe7a132cfbed851a1d59875", "url": "https://github.com/yahoo/elide/commit/1214029e0aea8ea17fe7a132cfbed851a1d59875", "message": "Merge branch 'elide-5.x-dynamic-model-it' of github.com:yahoo/elide into elide-5.x-dynamic-model-it", "committedDate": "2020-12-07T17:36:46Z", "type": "commit"}, {"oid": "7e23ea12ae9db45b4a4de4b882b3cb6212dd6959", "url": "https://github.com/yahoo/elide/commit/7e23ea12ae9db45b4a4de4b882b3cb6212dd6959", "message": "remove todo", "committedDate": "2020-12-07T17:48:53Z", "type": "commit"}]}