{"pr_number": 8395, "pr_title": "Simultaneous app start/stop on all nodes #8360", "pr_createdAt": "2020-09-22T15:13:00Z", "pr_url": "https://github.com/enonic/xp/pull/8395", "timeline": [{"oid": "b4c94cbf640ca2d7a24a6f67b7cc021c6f1f61d6", "url": "https://github.com/enonic/xp/commit/b4c94cbf640ca2d7a24a6f67b7cc021c6f1f61d6", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T06:50:10Z", "type": "forcePushed"}, {"oid": "3a4187a4407f6360e030b7e15727e0c05c547ae2", "url": "https://github.com/enonic/xp/commit/3a4187a4407f6360e030b7e15727e0c05c547ae2", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T06:58:23Z", "type": "forcePushed"}, {"oid": "fd3f29fc421989c4b937db1da1744dae81f31570", "url": "https://github.com/enonic/xp/commit/fd3f29fc421989c4b937db1da1744dae81f31570", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T07:21:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxMzI3OQ==", "url": "https://github.com/enonic/xp/pull/8395#discussion_r493513279", "bodyText": "What about default block?", "author": "anatol-sialitski", "createdAt": "2020-09-23T12:10:17Z", "path": "modules/core/core-app/src/main/java/com/enonic/xp/core/impl/app/event/ApplicationClusterEventListener.java", "diffHunk": "@@ -17,100 +19,81 @@\n public class ApplicationClusterEventListener\n     implements EventListener\n {\n-    private ApplicationService applicationService;\n+    private final ApplicationService applicationService;\n+\n+    @Activate\n+    public ApplicationClusterEventListener( @Reference final ApplicationService applicationService )\n+    {\n+        this.applicationService = applicationService;\n+    }\n \n     @Override\n     public void onEvent( final Event event )\n     {\n-        if ( event != null )\n+        if ( !event.isLocalOrigin() )\n         {\n-            if ( event.isLocalOrigin() )\n-            {\n-                return;\n-            }\n-\n             doHandleEvent( event );\n         }\n     }\n \n     private void doHandleEvent( final Event event )\n     {\n-        final String type = event.getType();\n-\n-        if ( type.equals( ApplicationClusterEvents.EVENT_TYPE ) )\n+        if ( ApplicationClusterEvents.EVENT_TYPE.equals( event.getType() ) )\n         {\n-            final String eventSubType = event.getValueAs( String.class, ApplicationClusterEvents.EVENT_TYPE_KEY ).get();\n-\n-            switch ( eventSubType )\n-            {\n-                case ApplicationClusterEvents.INSTALLED:\n-                    handleInstalledEvent( event );\n-                    break;\n-                case ApplicationClusterEvents.STATE_CHANGE:\n-                    handleStateChangedEvent( event );\n-                    break;\n-                case ApplicationClusterEvents.UNINSTALLED:\n-                    handleUninstalledEvent( event );\n-                    break;\n-            }\n+            event.getValueAs( String.class, ApplicationClusterEvents.EVENT_TYPE_KEY ).\n+                ifPresent( eventSubType -> {\n+                    switch ( eventSubType )\n+                    {\n+                        case ApplicationClusterEvents.INSTALLED:\n+                            handleInstalledEvent( event );\n+                            break;\n+                        case ApplicationClusterEvents.UNINSTALL:\n+                            handleUninstallEvent( event );\n+                            break;\n+                        case ApplicationClusterEvents.START:\n+                            handleStartEvent( event );\n+                            break;\n+                        case ApplicationClusterEvents.STOP:\n+                            handleStopEvent( event );\n+                            break;", "originalCommit": "fd3f29fc421989c4b937db1da1744dae81f31570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYwODc3Nw==", "url": "https://github.com/enonic/xp/pull/8395#discussion_r493608777", "bodyText": "default wasn't there, and there is nothing to do in default", "author": "rymsha", "createdAt": "2020-09-23T13:50:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxMzI3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "2612e74933b427d0cdb83790484d26504c968abf", "chunk": "diff --git a/modules/core/core-app/src/main/java/com/enonic/xp/core/impl/app/event/ApplicationClusterEventListener.java b/modules/core/core-app/src/main/java/com/enonic/xp/core/impl/app/event/ApplicationClusterEventListener.java\nindex c9c8a19a7e..2de431f63c 100644\n--- a/modules/core/core-app/src/main/java/com/enonic/xp/core/impl/app/event/ApplicationClusterEventListener.java\n+++ b/modules/core/core-app/src/main/java/com/enonic/xp/core/impl/app/event/ApplicationClusterEventListener.java\n\n@@ -19,6 +21,8 @@ import com.enonic.xp.node.NodeId;\n public class ApplicationClusterEventListener\n     implements EventListener\n {\n+    private static final Logger LOG = LoggerFactory.getLogger( ApplicationClusterEventListener.class );\n+\n     private final ApplicationService applicationService;\n \n     @Activate\n"}}, {"oid": "2612e74933b427d0cdb83790484d26504c968abf", "url": "https://github.com/enonic/xp/commit/2612e74933b427d0cdb83790484d26504c968abf", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T14:23:27Z", "type": "forcePushed"}, {"oid": "055fe2ff7e11b1e379457c11a8d2eacbb6ee3c2a", "url": "https://github.com/enonic/xp/commit/055fe2ff7e11b1e379457c11a8d2eacbb6ee3c2a", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T14:35:46Z", "type": "commit"}, {"oid": "055fe2ff7e11b1e379457c11a8d2eacbb6ee3c2a", "url": "https://github.com/enonic/xp/commit/055fe2ff7e11b1e379457c11a8d2eacbb6ee3c2a", "message": "Simultaneous app start/stop on all nodes #8360", "committedDate": "2020-09-23T14:35:46Z", "type": "forcePushed"}]}