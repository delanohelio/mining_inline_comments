{"pr_number": 8246, "pr_title": "POC: inherited filed should affect data inheritance, but not path #8217", "pr_createdAt": "2020-07-22T11:35:21Z", "pr_url": "https://github.com/enonic/xp/pull/8246", "timeline": [{"oid": "8488dffe1ea745929652a977c67ec51651016f5e", "url": "https://github.com/enonic/xp/commit/8488dffe1ea745929652a977c67ec51651016f5e", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-22T13:00:17Z", "type": "forcePushed"}, {"oid": "9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "url": "https://github.com/enonic/xp/commit/9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-22T13:09:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzNjcwNg==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r458836706", "bodyText": "Use stream.distinct", "author": "rymsha", "createdAt": "2020-07-22T14:30:42Z", "path": "modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/ContentSummaryJson.java", "diffHunk": "@@ -44,7 +48,7 @@ public ContentSummaryJson( final Content content, final ContentIconUrlResolver i\n         this.thumbnailJson = content.hasThumbnail() ? new ThumbnailJson( content.getThumbnail() ) : null;\n         this.isSite = content.isSite();\n         this.isPage = content.hasPage();\n-        this.inherited = content.isInherited();\n+        this.inherit = new ArrayList( new TreeSet( content.getInherit() ) );", "originalCommit": "9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cac97200534edbc0d5ada0062cf2302bc945f24", "chunk": "diff --git a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/ContentSummaryJson.java b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/ContentSummaryJson.java\nindex fa3fe8dee7..944352f1f3 100644\n--- a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/ContentSummaryJson.java\n+++ b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/json/content/ContentSummaryJson.java\n\n@@ -48,7 +47,10 @@ public class ContentSummaryJson\n         this.thumbnailJson = content.hasThumbnail() ? new ThumbnailJson( content.getThumbnail() ) : null;\n         this.isSite = content.isSite();\n         this.isPage = content.hasPage();\n-        this.inherit = new ArrayList( new TreeSet( content.getInherit() ) );\n+        this.inherit = content.getInherit().\n+            stream().\n+            sorted().\n+            collect( Collectors.toList() );\n         this.childOrderJson = content.getChildOrder() != null ? new ChildOrderJson( content.getChildOrder() ) : null;\n         this.contentState = content.getContentState().toString();\n         this.publish = content.getPublishInfo() != null ? new ContentPublishInfoJson( content.getPublishInfo() ) : null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzODQ5Ng==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r458838496", "bodyText": "Collection instead of Set", "author": "rymsha", "createdAt": "2020-07-22T14:33:07Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java", "diffHunk": "@@ -378,9 +380,12 @@ public Builder createSiteTemplateFolder( final boolean createSiteTemplateFolder\n             return this;\n         }\n \n-        public Builder inherited( final boolean inherited )\n+        public Builder inherit( final Set<ContentInheritType> inherit )", "originalCommit": "9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cac97200534edbc0d5ada0062cf2302bc945f24", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\nindex 6d460b6cdf..9271642922 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\n\n@@ -380,7 +381,7 @@ public final class CreateContentParams\n             return this;\n         }\n \n-        public Builder inherit( final Set<ContentInheritType> inherit )\n+        public Builder inherit( final Collection<ContentInheritType> inherit )\n         {\n             if ( inherit != null )\n             {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0MzIwMg==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r458843202", "bodyText": "use Enum::name as it is guaranteed to be stable", "author": "rymsha", "createdAt": "2020-07-22T14:39:25Z", "path": "modules/core/core-content/src/main/java/com/enonic/xp/core/impl/content/serializer/ContentDataSerializer.java", "diffHunk": "@@ -242,6 +246,17 @@ private void addWorkflowInfo( final PropertySet contentAsData, final WorkflowInf\n         }\n     }\n \n+    private void addInherit( final PropertySet contentAsData, final Set<ContentInheritType> inherit )\n+    {\n+        if ( inherit != null )\n+        {\n+            contentAsData.ifNotNull().addStrings( INHERIT, inherit.\n+                stream().\n+                map( Enum::toString ).", "originalCommit": "9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cac97200534edbc0d5ada0062cf2302bc945f24", "chunk": "diff --git a/modules/core/core-content/src/main/java/com/enonic/xp/core/impl/content/serializer/ContentDataSerializer.java b/modules/core/core-content/src/main/java/com/enonic/xp/core/impl/content/serializer/ContentDataSerializer.java\nindex c7af02994a..649c99ec0c 100644\n--- a/modules/core/core-content/src/main/java/com/enonic/xp/core/impl/content/serializer/ContentDataSerializer.java\n+++ b/modules/core/core-content/src/main/java/com/enonic/xp/core/impl/content/serializer/ContentDataSerializer.java\n\n@@ -252,7 +252,7 @@ public class ContentDataSerializer\n         {\n             contentAsData.ifNotNull().addStrings( INHERIT, inherit.\n                 stream().\n-                map( Enum::toString ).\n+                map( Enum::name ).\n                 collect( Collectors.toSet() ) );\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0NjkwNw==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r458846907", "bodyText": "Immutable EnumSet", "author": "rymsha", "createdAt": "2020-07-22T14:44:18Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java", "diffHunk": "@@ -416,7 +418,7 @@ public int hashCode()\n \n         protected boolean hasChildren;\n \n-        protected boolean inherited;\n+        protected ImmutableSet.Builder<ContentInheritType> inherit = ImmutableSet.builder();", "originalCommit": "9c8a3170e97525ecf4e5a7e0864b607f7074eda2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cac97200534edbc0d5ada0062cf2302bc945f24", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\nindex e5f6a5e1d5..d979331375 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\n\n@@ -418,7 +418,7 @@ public class Content\n \n         protected boolean hasChildren;\n \n-        protected ImmutableSet.Builder<ContentInheritType> inherit = ImmutableSet.builder();\n+        protected EnumSet<ContentInheritType> inherit = EnumSet.noneOf( ContentInheritType.class );\n \n         protected ChildOrder childOrder;\n \n"}}, {"oid": "9cac97200534edbc0d5ada0062cf2302bc945f24", "url": "https://github.com/enonic/xp/commit/9cac97200534edbc0d5ada0062cf2302bc945f24", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-23T09:05:42Z", "type": "forcePushed"}, {"oid": "9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "url": "https://github.com/enonic/xp/commit/9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-23T10:17:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM3NjIwOA==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r459376208", "bodyText": "Why do you need null check?", "author": "rymsha", "createdAt": "2020-07-23T11:15:23Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java", "diffHunk": "@@ -378,9 +381,12 @@ public Builder createSiteTemplateFolder( final boolean createSiteTemplateFolder\n             return this;\n         }\n \n-        public Builder inherited( final boolean inherited )\n+        public Builder inherit( final Collection<ContentInheritType> inherit )\n         {\n-            this.inherited = inherited;\n+            if ( inherit != null )", "originalCommit": "9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQzOTk5NA==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r459439994", "bodyText": "to avoid NPE if someone will send it here(CreateContentParams is PublicApi)", "author": "vbradnitski", "createdAt": "2020-07-23T13:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM3NjIwOA=="}], "type": "inlineReview", "revised_code": {"commit": "cace5e74620dde44c233cf391cf4da5a47e85aa4", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\nindex 9271642922..2fcf1bf220 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentParams.java\n\n@@ -383,10 +383,7 @@ public final class CreateContentParams\n \n         public Builder inherit( final Collection<ContentInheritType> inherit )\n         {\n-            if ( inherit != null )\n-            {\n-                this.inherit.addAll( inherit );\n-            }\n+            this.inherit.addAll( inherit );\n             return this;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM3NjQxMg==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r459376412", "bodyText": "Allow Collection", "author": "rymsha", "createdAt": "2020-07-23T11:15:49Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java", "diffHunk": "@@ -387,9 +389,12 @@ public Builder workflowInfo( final WorkflowInfo workflowInfo )\n             return this;\n         }\n \n-        public Builder inherited( final boolean inherited )\n+        public Builder inherit( final Set<ContentInheritType> inherit )", "originalCommit": "9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cace5e74620dde44c233cf391cf4da5a47e85aa4", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\nindex 131d2a931e..e62ce776af 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\n\n@@ -389,12 +390,10 @@ public class CreateContentTranslatorParams\n             return this;\n         }\n \n-        public Builder inherit( final Set<ContentInheritType> inherit )\n+        public Builder inherit( final Collection<ContentInheritType> inherit )\n         {\n-            if ( inherit != null )\n-            {\n-                this.inherit.addAll( inherit );\n-            }\n+            this.inherit.addAll( inherit );\n+\n             return this;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM3NjUyOQ==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r459376529", "bodyText": "Why would you need null check?", "author": "rymsha", "createdAt": "2020-07-23T11:16:05Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java", "diffHunk": "@@ -387,9 +389,12 @@ public Builder workflowInfo( final WorkflowInfo workflowInfo )\n             return this;\n         }\n \n-        public Builder inherited( final boolean inherited )\n+        public Builder inherit( final Set<ContentInheritType> inherit )\n         {\n-            this.inherited = inherited;\n+            if ( inherit != null )", "originalCommit": "9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cace5e74620dde44c233cf391cf4da5a47e85aa4", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\nindex 131d2a931e..e62ce776af 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/CreateContentTranslatorParams.java\n\n@@ -389,12 +390,10 @@ public class CreateContentTranslatorParams\n             return this;\n         }\n \n-        public Builder inherit( final Set<ContentInheritType> inherit )\n+        public Builder inherit( final Collection<ContentInheritType> inherit )\n         {\n-            if ( inherit != null )\n-            {\n-                this.inherit.addAll( inherit );\n-            }\n+            this.inherit.addAll( inherit );\n+\n             return this;\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM3NzQ2OQ==", "url": "https://github.com/enonic/xp/pull/8246#discussion_r459377469", "bodyText": "It differs from CreateContentParams.\nThere inherit is an immutable final field set from a builder.", "author": "rymsha", "createdAt": "2020-07-23T11:18:12Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/UpdateContentParams.java", "diffHunk": "@@ -26,7 +27,7 @@\n \n     private boolean requireValid;\n \n-    private boolean inherited = false;\n+    private Set<ContentInheritType> inherit = Set.of();", "originalCommit": "9c830b7b9d68d6ea0003a5d56cd2681dea7876fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "cace5e74620dde44c233cf391cf4da5a47e85aa4", "url": "https://github.com/enonic/xp/commit/cace5e74620dde44c233cf391cf4da5a47e85aa4", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-23T14:08:45Z", "type": "commit"}, {"oid": "cace5e74620dde44c233cf391cf4da5a47e85aa4", "url": "https://github.com/enonic/xp/commit/cace5e74620dde44c233cf391cf4da5a47e85aa4", "message": "POC: inherited filed should affect data inheritance, but not path #8217", "committedDate": "2020-07-23T14:08:45Z", "type": "forcePushed"}]}