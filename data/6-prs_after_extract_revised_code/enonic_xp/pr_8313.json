{"pr_number": 8313, "pr_title": "snapshot restore `latest` option support #8222", "pr_createdAt": "2020-08-28T13:55:00Z", "pr_url": "https://github.com/enonic/xp/pull/8313", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMyOTczMg==", "url": "https://github.com/enonic/xp/pull/8313#discussion_r479329732", "bodyText": "We are slowly getting away from Guava. We don't use Iterables class (almost) anywhere else.\nlist.get( list.size() - 1 ) is not perfect but good enough alternative.\nIt would be also good to check if size is not 0 and throw exception with clear message: \"No snapshots found\" for ex.", "author": "rymsha", "createdAt": "2020-08-28T14:11:30Z", "path": "modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/elasticsearch/snapshot/SnapshotServiceImpl.java", "diffHunk": "@@ -96,15 +98,29 @@ public RestoreResult restore( final RestoreParams restoreParams )\n     private RestoreResult doRestore( final RestoreParams restoreParams )\n     {\n         checkSnapshotRepository();\n-        validateSnapshot( restoreParams.getSnapshotName() );\n+\n+        String snapshotName;\n+\n+        if ( restoreParams.isLatest() )\n+        {\n+            final SnapshotResult snapshotResult = Iterables.getLast( list() );", "originalCommit": "de805860d29c27f58cf141f985aaabe28ac162c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTM3NDM5MA==", "url": "https://github.com/enonic/xp/pull/8313#discussion_r479374390", "bodyText": "solved", "author": "anatol-sialitski", "createdAt": "2020-08-28T15:21:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMyOTczMg=="}], "type": "inlineReview", "revised_code": {"commit": "17113e64422092963d0f3c8b61b672ba0cecc605", "chunk": "diff --git a/modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/elasticsearch/snapshot/SnapshotServiceImpl.java b/modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/elasticsearch/snapshot/SnapshotServiceImpl.java\nindex a023b0e889..b635419d76 100644\n--- a/modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/elasticsearch/snapshot/SnapshotServiceImpl.java\n+++ b/modules/core/core-repo/src/main/java/com/enonic/xp/repo/impl/elasticsearch/snapshot/SnapshotServiceImpl.java\n\n@@ -99,18 +97,7 @@ public class SnapshotServiceImpl\n     {\n         checkSnapshotRepository();\n \n-        String snapshotName;\n-\n-        if ( restoreParams.isLatest() )\n-        {\n-            final SnapshotResult snapshotResult = Iterables.getLast( list() );\n-\n-            snapshotName = snapshotResult.getName();\n-        }\n-        else\n-        {\n-            snapshotName = restoreParams.getSnapshotName();\n-        }\n+        final String snapshotName = restoreParams.isLatest() ? determineNameOfLatestSnapshot() : restoreParams.getSnapshotName();\n \n         validateSnapshot( snapshotName );\n \n"}}, {"oid": "17113e64422092963d0f3c8b61b672ba0cecc605", "url": "https://github.com/enonic/xp/commit/17113e64422092963d0f3c8b61b672ba0cecc605", "message": "snapshot restore `latest` option support #8222", "committedDate": "2020-08-28T15:19:17Z", "type": "commit"}, {"oid": "17113e64422092963d0f3c8b61b672ba0cecc605", "url": "https://github.com/enonic/xp/commit/17113e64422092963d0f3c8b61b672ba0cecc605", "message": "snapshot restore `latest` option support #8222", "committedDate": "2020-08-28T15:19:17Z", "type": "forcePushed"}]}