{"pr_number": 8081, "pr_title": "Resolving component name fails when attached content is not found #8080", "pr_createdAt": "2020-05-13T14:27:02Z", "pr_url": "https://github.com/enonic/xp/pull/8081", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg4MDg0Mw==", "url": "https://github.com/enonic/xp/pull/8081#discussion_r424880843", "bodyText": "Missing test annotation", "author": "rymsha", "createdAt": "2020-05-14T05:35:43Z", "path": "modules/admin/admin-impl/src/test/java/com/enonic/xp/admin/impl/rest/resource/content/ComponentNameResolverImplTest.java", "diffHunk": "@@ -0,0 +1,124 @@\n+package com.enonic.xp.admin.impl.rest.resource.content;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+\n+import com.enonic.xp.content.Content;\n+import com.enonic.xp.content.ContentId;\n+import com.enonic.xp.content.ContentNotFoundException;\n+import com.enonic.xp.content.ContentPath;\n+import com.enonic.xp.content.ContentService;\n+import com.enonic.xp.region.ComponentName;\n+import com.enonic.xp.region.FragmentComponent;\n+import com.enonic.xp.region.ImageComponent;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+\n+public class ComponentNameResolverImplTest\n+{\n+    private ComponentNameResolverImpl componentNameResolver;\n+\n+    private ContentService contentService;\n+\n+    @BeforeEach\n+    public void init()\n+    {\n+        componentNameResolver = new ComponentNameResolverImpl();\n+        contentService = Mockito.mock( ContentService.class );\n+\n+        componentNameResolver.setContentService( contentService );\n+    }\n+\n+    @Test\n+    public void testResolveEmptyImageComponent()\n+        throws Exception\n+    {\n+        final ImageComponent imageComponent = ImageComponent.create().build();\n+\n+        final ComponentName result = componentNameResolver.resolve( imageComponent );\n+\n+        assertEquals( imageComponent.getName(), result );\n+    }\n+\n+    @Test\n+    public void testResolveImageComponent()\n+        throws Exception\n+    {\n+        final Content imageContent = createContent();\n+        final ImageComponent imageComponent = ImageComponent.create().image( ContentId.from( \"id\" ) ).build();\n+\n+        Mockito.when( contentService.getById( imageComponent.getImage() ) ).thenReturn( imageContent );\n+\n+        final ComponentName result = componentNameResolver.resolve( imageComponent );\n+\n+        assertEquals( imageContent.getDisplayName(), result.toString() );\n+    }\n+\n+    @Test\n+    public void testResolveMissingImageComponent()\n+        throws Exception\n+    {\n+        final ContentId imageComponentId = ContentId.from( \"imageCompId\" );\n+        final ImageComponent imageComponent = ImageComponent.create().image( imageComponentId ).build();\n+\n+        Mockito.when( contentService.getById( imageComponent.getImage() ) ).thenThrow(\n+            new ContentNotFoundException( imageComponentId, null ) );\n+\n+        final ComponentName result = componentNameResolver.resolve( imageComponent );\n+\n+        assertEquals( imageComponent.getName(), result );\n+    }\n+\n+    public void testResolveEmptyFragmentComponent()", "originalCommit": "b48e4b5c4f577553aaacecf8b17f0c710033d379", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk4NDcwMA==", "url": "https://github.com/enonic/xp/pull/8081#discussion_r424984700", "bodyText": "Updated", "author": "ashklianko", "createdAt": "2020-05-14T09:06:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg4MDg0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "c3965a6a035946b555546ccac4b635f866a50bbd", "chunk": "diff --git a/modules/admin/admin-impl/src/test/java/com/enonic/xp/admin/impl/rest/resource/content/ComponentNameResolverImplTest.java b/modules/admin/admin-impl/src/test/java/com/enonic/xp/admin/impl/rest/resource/content/ComponentNameResolverImplTest.java\nindex 40f4608bf9..fe6cb26f7d 100644\n--- a/modules/admin/admin-impl/src/test/java/com/enonic/xp/admin/impl/rest/resource/content/ComponentNameResolverImplTest.java\n+++ b/modules/admin/admin-impl/src/test/java/com/enonic/xp/admin/impl/rest/resource/content/ComponentNameResolverImplTest.java\n\n@@ -70,6 +70,7 @@ public class ComponentNameResolverImplTest\n         assertEquals( imageComponent.getName(), result );\n     }\n \n+    @Test\n     public void testResolveEmptyFragmentComponent()\n         throws Exception\n     {\n"}}, {"oid": "c3965a6a035946b555546ccac4b635f866a50bbd", "url": "https://github.com/enonic/xp/commit/c3965a6a035946b555546ccac4b635f866a50bbd", "message": "Resolving component name fails when attached content is not found #8080", "committedDate": "2020-05-15T07:37:08Z", "type": "commit"}, {"oid": "c3965a6a035946b555546ccac4b635f866a50bbd", "url": "https://github.com/enonic/xp/commit/c3965a6a035946b555546ccac4b635f866a50bbd", "message": "Resolving component name fails when attached content is not found #8080", "committedDate": "2020-05-15T07:37:08Z", "type": "forcePushed"}]}