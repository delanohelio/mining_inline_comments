{"pr_number": 8486, "pr_title": "Distributable tasks (second iteration)", "pr_createdAt": "2020-11-16T16:53:37Z", "pr_url": "https://github.com/enonic/xp/pull/8486", "timeline": [{"oid": "3c8c27c4986c9eafcf911a0395609a306913083f", "url": "https://github.com/enonic/xp/commit/3c8c27c4986c9eafcf911a0395609a306913083f", "message": "save", "committedDate": "2020-11-17T08:07:45Z", "type": "forcePushed"}, {"oid": "7c2b1a0c5315e1256ef453d12110fa24c6eb3337", "url": "https://github.com/enonic/xp/commit/7c2b1a0c5315e1256ef453d12110fa24c6eb3337", "message": "save", "committedDate": "2020-11-17T08:22:31Z", "type": "forcePushed"}, {"oid": "a0ab1f70c42de3afe839a802496b9cc8a76c62da", "url": "https://github.com/enonic/xp/commit/a0ab1f70c42de3afe839a802496b9cc8a76c62da", "message": "save", "committedDate": "2020-11-17T10:17:43Z", "type": "forcePushed"}, {"oid": "f190073a1b451646596759359b6de02fab59fdaf", "url": "https://github.com/enonic/xp/commit/f190073a1b451646596759359b6de02fab59fdaf", "message": "save", "committedDate": "2020-11-17T11:43:31Z", "type": "forcePushed"}, {"oid": "86f5cfb0f637167d1d4e5a4d23588a414f099210", "url": "https://github.com/enonic/xp/commit/86f5cfb0f637167d1d4e5a4d23588a414f099210", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-17T14:39:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI1NjY5Ng==", "url": "https://github.com/enonic/xp/pull/8486#discussion_r525256696", "bodyText": "rename to data", "author": "anatol-sialitski", "createdAt": "2020-11-17T15:34:26Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/task/SubmitTaskParams.java", "diffHunk": "@@ -46,8 +38,6 @@ public static Builder create()\n \n         private PropertyTree config;", "originalCommit": "86f5cfb0f637167d1d4e5a4d23588a414f099210", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bede5b4247a3e20ed978985fa49c11fd55404202", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/task/SubmitTaskParams.java b/modules/core/core-api/src/main/java/com/enonic/xp/task/SubmitTaskParams.java\nindex dd9f91abe0..26df822801 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/task/SubmitTaskParams.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/task/SubmitTaskParams.java\n\n@@ -36,7 +36,7 @@ public final class SubmitTaskParams\n     {\n         private DescriptorKey descriptorKey;\n \n-        private PropertyTree config;\n+        private PropertyTree data;\n \n         private Builder()\n         {\n"}}, {"oid": "bede5b4247a3e20ed978985fa49c11fd55404202", "url": "https://github.com/enonic/xp/commit/bede5b4247a3e20ed978985fa49c11fd55404202", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-17T15:37:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI2OTQ2MQ==", "url": "https://github.com/enonic/xp/pull/8486#discussion_r525269461", "bodyText": "final, in order to uniform :)", "author": "anatol-sialitski", "createdAt": "2020-11-17T15:49:29Z", "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/script/NamedTaskScriptFactoryImpl.java", "diffHunk": "@@ -24,16 +25,29 @@\n \n     private final TaskDescriptorService taskDescriptorService;\n \n+    private final PropertyTreeMarshallerService propertyTreeMarshallerService;\n+\n     @Activate\n     public NamedTaskScriptFactoryImpl( @Reference final PortalScriptService scriptService,\n-                                       @Reference final TaskDescriptorService taskDescriptorService )\n+                                       @Reference final TaskDescriptorService taskDescriptorService,\n+                                       @Reference PropertyTreeMarshallerService propertyTreeMarshallerService )", "originalCommit": "bede5b4247a3e20ed978985fa49c11fd55404202", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d023809eb6f0139c2d613004f91281abc0c4c8e", "chunk": "diff --git a/modules/core/core-task/src/main/java/com/enonic/xp/impl/task/script/NamedTaskScriptFactoryImpl.java b/modules/core/core-task/src/main/java/com/enonic/xp/impl/task/script/NamedTaskScriptFactoryImpl.java\nindex 0d93bd6bd4..89d1a1753c 100644\n--- a/modules/core/core-task/src/main/java/com/enonic/xp/impl/task/script/NamedTaskScriptFactoryImpl.java\n+++ b/modules/core/core-task/src/main/java/com/enonic/xp/impl/task/script/NamedTaskScriptFactoryImpl.java\n\n@@ -30,7 +30,7 @@ public class NamedTaskScriptFactoryImpl\n     @Activate\n     public NamedTaskScriptFactoryImpl( @Reference final PortalScriptService scriptService,\n                                        @Reference final TaskDescriptorService taskDescriptorService,\n-                                       @Reference PropertyTreeMarshallerService propertyTreeMarshallerService )\n+                                       @Reference final PropertyTreeMarshallerService propertyTreeMarshallerService )\n     {\n         this.scriptService = scriptService;\n         this.taskDescriptorService = taskDescriptorService;\n"}}, {"oid": "7d023809eb6f0139c2d613004f91281abc0c4c8e", "url": "https://github.com/enonic/xp/commit/7d023809eb6f0139c2d613004f91281abc0c4c8e", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-17T15:52:38Z", "type": "forcePushed"}, {"oid": "f9438d5ea50f8385360deae400a92a8766ee53cd", "url": "https://github.com/enonic/xp/commit/f9438d5ea50f8385360deae400a92a8766ee53cd", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-18T07:53:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkzODc5Ng==", "url": "https://github.com/enonic/xp/pull/8486#discussion_r525938796", "bodyText": "LinkedHashMap", "author": "rymsha", "createdAt": "2020-11-18T09:32:48Z", "path": "modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/BaseContentHandler.java", "diffHunk": "@@ -145,13 +139,12 @@ PropertyTree createPropertyTree( final Map<String, Object> value, final ContentT\n             return null;\n         }\n \n-        final ObjectNode root = createJson( value );\n-\n-        if ( root.has( ContentPropertyNames.SITECONFIG ) )\n+        if ( value.containsKey( ContentPropertyNames.SITECONFIG ) )\n         {\n-            root.remove( ContentPropertyNames.SITECONFIG );\n+            Map<String, Object> newValue = new HashMap<>( value );", "originalCommit": "f9438d5ea50f8385360deae400a92a8766ee53cd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "165b18842a7785a93e7d570212ba8b586f45f69f", "chunk": "diff --git a/modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/BaseContentHandler.java b/modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/BaseContentHandler.java\nindex ce9c096e41..6f80e30f54 100644\n--- a/modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/BaseContentHandler.java\n+++ b/modules/lib/lib-content/src/main/java/com/enonic/xp/lib/content/BaseContentHandler.java\n\n@@ -141,7 +141,7 @@ public abstract class BaseContentHandler\n \n         if ( value.containsKey( ContentPropertyNames.SITECONFIG ) )\n         {\n-            Map<String, Object> newValue = new HashMap<>( value );\n+            Map<String, Object> newValue = new LinkedHashMap<>( value );\n             newValue.remove( ContentPropertyNames.SITECONFIG );\n \n             final PropertyTree result = this.translateToPropertyTree( newValue, contentTypeName );\n"}}, {"oid": "165b18842a7785a93e7d570212ba8b586f45f69f", "url": "https://github.com/enonic/xp/commit/165b18842a7785a93e7d570212ba8b586f45f69f", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-18T09:48:23Z", "type": "commit"}, {"oid": "165b18842a7785a93e7d570212ba8b586f45f69f", "url": "https://github.com/enonic/xp/commit/165b18842a7785a93e7d570212ba8b586f45f69f", "message": "Distributable tasks (second iteration) #8486", "committedDate": "2020-11-18T09:48:23Z", "type": "forcePushed"}]}