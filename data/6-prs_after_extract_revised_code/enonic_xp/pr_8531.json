{"pr_number": 8531, "pr_title": "Anonymous audit-log events #8511", "pr_createdAt": "2020-12-07T14:54:21Z", "pr_url": "https://github.com/enonic/xp/pull/8531", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU3MTQ5MA==", "url": "https://github.com/enonic/xp/pull/8531#discussion_r537571490", "bodyText": "Do we use this field at all? We should not, probably as we should not trust the caller.", "author": "rymsha", "createdAt": "2020-12-07T14:56:53Z", "path": "modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/content/json/UpdateContentJson.java", "diffHunk": "@@ -59,10 +60,14 @@\n         final PropertyTree contentData = PropertyTreeJson.fromJson( propertyArrayJsonList );\n         final ExtraDatas extraDatas = parseExtradata( extraDataJsonList );\n \n+        final PrincipalKey modifier = ContextAccessor.current().getAuthInfo().getUser() != null\n+            ? ContextAccessor.current().getAuthInfo().getUser().getKey()\n+            : PrincipalKey.ofAnonymous();\n+\n         this.updateContentParams = new UpdateContentParams().\n             requireValid( Boolean.parseBoolean( requireValid ) ).\n             contentId( ContentId.from( contentId ) ).\n-            modifier( PrincipalKey.ofAnonymous() ).\n+            modifier( modifier ).", "originalCommit": "4f93091f8a1149d1f3ce0b4e4f6f22e353df8df3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "871899a6641de0f01a69884652a34db7c05c2038", "chunk": "diff --git a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/content/json/UpdateContentJson.java b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/content/json/UpdateContentJson.java\nindex c7e775b035..ce1d71c0b3 100644\n--- a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/content/json/UpdateContentJson.java\n+++ b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/content/json/UpdateContentJson.java\n\n@@ -60,14 +59,9 @@ public final class UpdateContentJson\n         final PropertyTree contentData = PropertyTreeJson.fromJson( propertyArrayJsonList );\n         final ExtraDatas extraDatas = parseExtradata( extraDataJsonList );\n \n-        final PrincipalKey modifier = ContextAccessor.current().getAuthInfo().getUser() != null\n-            ? ContextAccessor.current().getAuthInfo().getUser().getKey()\n-            : PrincipalKey.ofAnonymous();\n-\n         this.updateContentParams = new UpdateContentParams().\n             requireValid( Boolean.parseBoolean( requireValid ) ).\n             contentId( ContentId.from( contentId ) ).\n-            modifier( modifier ).\n             editor( edit -> {\n                 edit.data = contentData;\n                 edit.extraDatas = extraDatas;\n"}}, {"oid": "871899a6641de0f01a69884652a34db7c05c2038", "url": "https://github.com/enonic/xp/commit/871899a6641de0f01a69884652a34db7c05c2038", "message": "Anonymous audit-log events #8511", "committedDate": "2020-12-07T15:49:27Z", "type": "commit"}, {"oid": "871899a6641de0f01a69884652a34db7c05c2038", "url": "https://github.com/enonic/xp/commit/871899a6641de0f01a69884652a34db7c05c2038", "message": "Anonymous audit-log events #8511", "committedDate": "2020-12-07T15:49:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNzA2MA==", "url": "https://github.com/enonic/xp/pull/8531#discussion_r537627060", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.modifier = modifier;", "author": "rymsha", "createdAt": "2020-12-07T16:06:51Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/UpdateContentParams.java", "diffHunk": "@@ -40,6 +40,7 @@ public UpdateContentParams contentId( final ContentId contentId )\n         return this;\n     }\n \n+    @Deprecated\n     public UpdateContentParams modifier( final PrincipalKey modifier )\n     {\n         this.modifier = modifier;", "originalCommit": "871899a6641de0f01a69884652a34db7c05c2038", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyOTM4NA==", "url": "https://github.com/enonic/xp/pull/8531#discussion_r537629384", "bodyText": "And all unused private fields should be deleted as well", "author": "rymsha", "createdAt": "2020-12-07T16:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyNzA2MA=="}], "type": "inlineReview", "revised_code": null}]}