{"pr_number": 8016, "pr_title": "Project language update fails on null #8014", "pr_createdAt": "2020-04-10T08:35:06Z", "pr_url": "https://github.com/enonic/xp/pull/8016", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0Mzc1MQ==", "url": "https://github.com/enonic/xp/pull/8016#discussion_r406843751", "bodyText": "!isBlank()", "author": "rymsha", "createdAt": "2020-04-10T16:50:19Z", "path": "modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/json/ModifyLanguageParamsJson.java", "diffHunk": "@@ -17,7 +18,10 @@\n     ModifyLanguageParamsJson( @JsonProperty(\"name\") final String name, @JsonProperty(\"language\") final String language )\n     {\n         this.name = ProjectName.from( name );\n-        this.language = Locale.forLanguageTag( language );\n+        this.language = Optional.ofNullable( language ).\n+            filter( lang -> !lang.trim().isEmpty() ).", "originalCommit": "dab44ad24a3ae4ab43a45a91c853617d40c3fa4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7594beaacc457e19ea79776bf871f6f4b67725c", "chunk": "diff --git a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/json/ModifyLanguageParamsJson.java b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/json/ModifyLanguageParamsJson.java\nindex b14a6bcb0d..e6b8fd1785 100644\n--- a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/json/ModifyLanguageParamsJson.java\n+++ b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/json/ModifyLanguageParamsJson.java\n\n@@ -19,7 +19,7 @@ public final class ModifyLanguageParamsJson\n     {\n         this.name = ProjectName.from( name );\n         this.language = Optional.ofNullable( language ).\n-            filter( lang -> !lang.trim().isEmpty() ).\n+            filter( lang -> !lang.isBlank() ).\n             map( Locale::forLanguageTag ).\n             orElse( null );\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0NDc3Ng==", "url": "https://github.com/enonic/xp/pull/8016#discussion_r406844776", "bodyText": "To improve readability return optional from doApplyLanguage", "author": "rymsha", "createdAt": "2020-04-10T16:52:45Z", "path": "modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/ProjectResource.java", "diffHunk": "@@ -97,8 +97,9 @@ public ProjectJson modify( final MultipartForm form )\n     @Path(\"modifyLanguage\")\n     public String modifyLanguage( final ModifyLanguageParamsJson params )\n     {\n-        return doApplyLanguage( params.getName(), params.getLanguage() ).\n-            toLanguageTag();\n+        return Optional.ofNullable( doApplyLanguage( params.getName(), params.getLanguage() ) ).", "originalCommit": "dab44ad24a3ae4ab43a45a91c853617d40c3fa4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7594beaacc457e19ea79776bf871f6f4b67725c", "chunk": "diff --git a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/ProjectResource.java b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/ProjectResource.java\nindex 2ddb1fd10e..1057e25ec3 100644\n--- a/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/ProjectResource.java\n+++ b/modules/admin/admin-impl/src/main/java/com/enonic/xp/admin/impl/rest/resource/project/ProjectResource.java\n\n@@ -97,7 +97,7 @@ public final class ProjectResource\n     @Path(\"modifyLanguage\")\n     public String modifyLanguage( final ModifyLanguageParamsJson params )\n     {\n-        return Optional.ofNullable( doApplyLanguage( params.getName(), params.getLanguage() ) ).\n+        return doApplyLanguage( params.getName(), params.getLanguage() ).\n             map( Locale::toLanguageTag ).\n             orElse( null );\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0NTc1Ng==", "url": "https://github.com/enonic/xp/pull/8016#discussion_r406845756", "bodyText": "getters to class of itself look very suspicions. What was wrong with direct field access?", "author": "rymsha", "createdAt": "2020-04-10T16:55:03Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java", "diffHunk": "@@ -444,31 +444,31 @@ protected Builder()\n \n         protected Builder( final Content source )\n         {\n-            this.id = source.id;\n-            this.valid = source.valid;\n-            this.parentPath = source.parentPath;\n-            this.name = source.name;\n-            this.type = source.type;\n-            this.data = source.data != null ? source.data.copy() : null;\n-            this.attachments = source.attachments;\n-            this.extraDatas = source.extraDatas != null ? source.extraDatas.copy() : null;\n-            this.displayName = source.displayName;\n-            this.owner = source.owner;\n-            this.createdTime = source.createdTime;\n-            this.modifiedTime = source.modifiedTime;\n-            this.creator = source.creator;\n-            this.modifier = source.modifier;\n-            this.hasChildren = source.hasChildren;\n-            this.page = source.page != null ? source.page.copy() : null;\n-            this.thumbnail = source.thumbnail;\n-            this.childOrder = source.childOrder;\n-            this.permissions = source.permissions;\n-            this.inheritPermissions = source.inheritPermissions;\n-            this.language = source.language;\n-            this.contentState = source.contentState;\n-            this.publishInfo = source.publishInfo;\n-            this.processedReferences = ContentIds.create().addAll( source.processedReferences );\n-            this.workflowInfo = source.workflowInfo;\n+            this.id = source.getId();", "originalCommit": "dab44ad24a3ae4ab43a45a91c853617d40c3fa4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7594beaacc457e19ea79776bf871f6f4b67725c", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java b/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\nindex c3ede56cd9..56ba49386c 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/content/Content.java\n\n@@ -444,31 +444,31 @@ public class Content\n \n         protected Builder( final Content source )\n         {\n-            this.id = source.getId();\n-            this.valid = source.isValid();\n-            this.parentPath = source.getParentPath();\n-            this.name = source.getName();\n-            this.type = source.getType();\n-            this.data = source.getData() != null ? source.getData().copy() : null;\n-            this.attachments = source.getAttachments();\n-            this.extraDatas = source.getAllExtraData() != null ? source.getAllExtraData().copy() : null;\n-            this.displayName = source.getDisplayName();\n-            this.owner = source.getOwner();\n-            this.createdTime = source.getCreatedTime();\n-            this.modifiedTime = source.getModifiedTime();\n-            this.creator = source.getCreator();\n-            this.modifier = source.getModifier();\n-            this.hasChildren = source.hasChildren();\n-            this.page = source.getPage() != null ? source.getPage().copy() : null;\n-            this.thumbnail = source.getThumbnail();\n-            this.childOrder = source.getChildOrder();\n-            this.permissions = source.getPermissions();\n-            this.inheritPermissions = source.inheritsPermissions();\n-            this.language = source.getLanguage();\n-            this.contentState = source.getContentState();\n-            this.publishInfo = source.getPublishInfo();\n-            this.processedReferences = ContentIds.create().addAll( source.getProcessedReferences() );\n-            this.workflowInfo = source.getWorkflowInfo();\n+            this.id = source.id;\n+            this.valid = source.valid;\n+            this.parentPath = source.parentPath;\n+            this.name = source.name;\n+            this.type = source.type;\n+            this.data = source.data != null ? source.data.copy() : null;\n+            this.attachments = source.attachments;\n+            this.extraDatas = source.extraDatas != null ? source.extraDatas.copy() : null;\n+            this.displayName = source.displayName;\n+            this.owner = source.owner;\n+            this.createdTime = source.createdTime;\n+            this.modifiedTime = source.modifiedTime;\n+            this.creator = source.creator;\n+            this.modifier = source.modifier;\n+            this.hasChildren = source.hasChildren;\n+            this.page = source.page != null ? source.page.copy() : null;\n+            this.thumbnail = source.thumbnail;\n+            this.childOrder = source.childOrder;\n+            this.permissions = source.permissions;\n+            this.inheritPermissions = source.inheritPermissions;\n+            this.language = source.language;\n+            this.contentState = source.contentState;\n+            this.publishInfo = source.publishInfo;\n+            this.processedReferences = ContentIds.create().addAll( source.processedReferences );\n+            this.workflowInfo = source.workflowInfo;\n         }\n \n         public BUILDER parentPath( final ContentPath path )\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg0NzU4NQ==", "url": "https://github.com/enonic/xp/pull/8016#discussion_r406847585", "bodyText": "this is not exact conversion. Exact one is !nullToEmpty( owner ).isBlank()\nBut why do we need this null guard? What cand of caller tries to add null owner/editor/author/...?", "author": "rymsha", "createdAt": "2020-04-10T16:59:04Z", "path": "modules/core/core-api/src/main/java/com/enonic/xp/project/ProjectPermissions.java", "diffHunk": "@@ -105,7 +103,7 @@ private Builder( final ProjectPermissions source )\n \n         public Builder addOwner( final String owner )\n         {\n-            if ( StringUtils.isNotBlank( owner ) )\n+            if ( owner != null )", "originalCommit": "dab44ad24a3ae4ab43a45a91c853617d40c3fa4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c7594beaacc457e19ea79776bf871f6f4b67725c", "chunk": "diff --git a/modules/core/core-api/src/main/java/com/enonic/xp/project/ProjectPermissions.java b/modules/core/core-api/src/main/java/com/enonic/xp/project/ProjectPermissions.java\nindex 4261bdac03..a76f109c4d 100644\n--- a/modules/core/core-api/src/main/java/com/enonic/xp/project/ProjectPermissions.java\n+++ b/modules/core/core-api/src/main/java/com/enonic/xp/project/ProjectPermissions.java\n\n@@ -101,93 +101,33 @@ public final class ProjectPermissions\n             this.viewer.addAll( source.getViewer() );\n         }\n \n-        public Builder addOwner( final String owner )\n-        {\n-            if ( owner != null )\n-            {\n-                this.owner.add( PrincipalKey.from( owner ) );\n-            }\n-            return this;\n-        }\n-\n         public Builder addOwner( final PrincipalKey owner )\n         {\n-            if ( owner != null )\n-            {\n-                this.owner.add( owner );\n-            }\n-            return this;\n-        }\n-\n-        public Builder addEditor( final String editor )\n-        {\n-            if ( editor != null )\n-            {\n-                this.editor.add( PrincipalKey.from( editor ) );\n-            }\n+            this.owner.add( owner );\n             return this;\n         }\n \n         public Builder addEditor( final PrincipalKey editor )\n         {\n-            if ( editor != null )\n-            {\n-                this.editor.add( editor );\n-            }\n-            return this;\n-        }\n-\n-        public Builder addAuthor( final String author )\n-        {\n-            if ( author != null )\n-            {\n-                this.author.add( PrincipalKey.from( author ) );\n-            }\n+            this.editor.add( editor );\n             return this;\n         }\n \n         public Builder addAuthor( final PrincipalKey author )\n         {\n-            if ( author != null )\n-            {\n-                this.author.add( author );\n-            }\n-            return this;\n-        }\n-\n-        public Builder addContributor( final String contributor )\n-        {\n-            if ( contributor != null )\n-            {\n-                this.contributor.add( PrincipalKey.from( contributor ) );\n-            }\n+            this.author.add( author );\n             return this;\n         }\n \n         public Builder addContributor( final PrincipalKey contributor )\n         {\n-            if ( contributor != null )\n-            {\n-                this.contributor.add( contributor );\n-            }\n-            return this;\n-        }\n-\n-        public Builder addViewer( final String viewer )\n-        {\n-            if ( viewer != null )\n-            {\n-                this.viewer.add( PrincipalKey.from( viewer ) );\n-            }\n+            this.contributor.add( contributor );\n             return this;\n         }\n \n         public Builder addViewer( final PrincipalKey viewer )\n         {\n-            if ( viewer != null )\n-            {\n-                this.viewer.add( viewer );\n-            }\n+            this.viewer.add( viewer );\n             return this;\n         }\n \n"}}, {"oid": "c7594beaacc457e19ea79776bf871f6f4b67725c", "url": "https://github.com/enonic/xp/commit/c7594beaacc457e19ea79776bf871f6f4b67725c", "message": "Project language update fails on null #8014", "committedDate": "2020-04-14T11:09:20Z", "type": "commit"}, {"oid": "c7594beaacc457e19ea79776bf871f6f4b67725c", "url": "https://github.com/enonic/xp/commit/c7594beaacc457e19ea79776bf871f6f4b67725c", "message": "Project language update fails on null #8014", "committedDate": "2020-04-14T11:09:20Z", "type": "forcePushed"}]}