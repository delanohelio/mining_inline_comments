{"pr_number": 7909, "pr_title": "Use Hazelcast for Events Tasks and sessions #7752", "pr_createdAt": "2020-02-24T17:56:02Z", "pr_url": "https://github.com/enonic/xp/pull/7909", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcxMDEyNQ==", "url": "https://github.com/enonic/xp/pull/7909#discussion_r383710125", "bodyText": "@rymsha why do you use two times @Activate annotation?", "author": "anatol-sialitski", "createdAt": "2020-02-25T07:59:42Z", "path": "modules/core/core-event/src/main/java/com/enonic/xp/core/impl/event/cluster/ClusterEventReceiver.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.enonic.xp.core.impl.event.cluster;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.ITopic;\n+import com.hazelcast.core.Message;\n+import com.hazelcast.core.MessageListener;\n+\n+import com.enonic.xp.event.Event;\n+import com.enonic.xp.event.EventPublisher;\n+\n+@Component(immediate = true)\n+public final class ClusterEventReceiver\n+    implements MessageListener<Event>\n+{\n+    private final EventPublisher eventPublisher;\n+\n+    private final ITopic<Event> topic;\n+\n+    private String registrationId;\n+\n+    @Activate\n+    public ClusterEventReceiver( @Reference final HazelcastInstance hazelcastInstance, @Reference final EventPublisher eventPublisher )\n+    {\n+        this.topic = hazelcastInstance.getTopic( ClusterEventSender.ACTION );\n+        this.eventPublisher = eventPublisher;\n+    }\n+\n+    @Activate", "originalCommit": "e360c67141c9863cc08080783e8f435ac0bfbb06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzc2MDYzNQ==", "url": "https://github.com/enonic/xp/pull/7909#discussion_r383760635", "bodyText": "One for \"constructor injection\", another for real activation logic.", "author": "rymsha", "createdAt": "2020-02-25T09:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcxMDEyNQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "url": "https://github.com/enonic/xp/commit/5ac55d2646ac6f7680ea634f6cd0020f0539b1aa", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752", "committedDate": "2020-02-25T09:47:29Z", "type": "forcePushed"}, {"oid": "c461c933c2233bd1828d8af6c4dd37ddfe297712", "url": "https://github.com/enonic/xp/commit/c461c933c2233bd1828d8af6c4dd37ddfe297712", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752", "committedDate": "2020-02-26T08:27:26Z", "type": "forcePushed"}, {"oid": "aa30902a7e1484d39a3b0128427c5100f631d301", "url": "https://github.com/enonic/xp/commit/aa30902a7e1484d39a3b0128427c5100f631d301", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752", "committedDate": "2020-02-27T12:25:28Z", "type": "forcePushed"}, {"oid": "35f06cb57fb220ebb36f991f55165686b46c3887", "url": "https://github.com/enonic/xp/commit/35f06cb57fb220ebb36f991f55165686b46c3887", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752", "committedDate": "2020-02-27T13:28:32Z", "type": "commit"}, {"oid": "35f06cb57fb220ebb36f991f55165686b46c3887", "url": "https://github.com/enonic/xp/commit/35f06cb57fb220ebb36f991f55165686b46c3887", "message": "ES7 and cluster: new Events and Tasks must not use ES Transport #7752", "committedDate": "2020-02-27T13:28:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMzODA2Mg==", "url": "https://github.com/enonic/xp/pull/7909#discussion_r384338062", "bodyText": "I guess will be better to rename ACTION to TOPIC", "author": "anatol-sialitski", "createdAt": "2020-02-26T08:34:11Z", "path": "modules/core/core-event/src/main/java/com/enonic/xp/core/impl/event/cluster/ClusterEventSender.java", "diffHunk": "@@ -18,47 +16,20 @@\n {\n     public static final String ACTION = \"xp/event\";", "originalCommit": "c461c933c2233bd1828d8af6c4dd37ddfe297712", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMzOTM2Mg==", "url": "https://github.com/enonic/xp/pull/7909#discussion_r384339362", "bodyText": "I guess will be better to rename ACTION to EXECUTOR_SERVICE", "author": "anatol-sialitski", "createdAt": "2020-02-26T08:36:58Z", "path": "modules/core/core-task/src/main/java/com/enonic/xp/impl/task/ClusteredTaskManagerImpl.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.enonic.xp.impl.task;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.Future;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Reference;\n+\n+import com.hazelcast.core.HazelcastInstance;\n+import com.hazelcast.core.IExecutorService;\n+import com.hazelcast.core.Member;\n+import com.hazelcast.util.ExceptionUtil;\n+\n+import com.enonic.xp.impl.task.distributed.AllTasksReporter;\n+import com.enonic.xp.impl.task.distributed.RunningTasksReporter;\n+import com.enonic.xp.impl.task.distributed.SerializableFunction;\n+import com.enonic.xp.impl.task.distributed.SingleTaskReporter;\n+import com.enonic.xp.impl.task.distributed.TasksReporterCallable;\n+import com.enonic.xp.task.TaskId;\n+import com.enonic.xp.task.TaskInfo;\n+\n+@Component\n+public final class ClusteredTaskManagerImpl\n+    implements ClusteredTaskManager\n+{\n+    private static final long TRANSPORT_REQUEST_TIMEOUT_SECONDS = 5L;\n+\n+    public static final String ACTION = \"xp/task\";", "originalCommit": "c461c933c2233bd1828d8af6c4dd37ddfe297712", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}