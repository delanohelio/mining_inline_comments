{"pr_number": 412, "pr_title": "[KOGITO-1492] Allow direct injection of event listeners", "pr_createdAt": "2020-04-03T07:13:17Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/412", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDQ4NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402790485", "bodyText": "@kostola\nHi! What's the need of the \"return this\" ?", "author": "gitgabrio", "createdAt": "2020-04-03T07:36:29Z", "path": "drools/drools-core/src/main/java/org/drools/core/config/CachedRuleEventListenerConfig.java", "diffHunk": "@@ -24,22 +24,32 @@\n \n public class CachedRuleEventListenerConfig implements RuleEventListenerConfig {\n \n-    private final List<AgendaEventListener> agendaEventListeners = new ArrayList<>();\n-    private final List<RuleRuntimeEventListener> ruleRuntimeListeners = new ArrayList<>();\n+    private final List<AgendaEventListener> agendaListeners;\n+    private final List<RuleRuntimeEventListener> ruleRuntimeListeners;\n+\n+    public CachedRuleEventListenerConfig() {\n+        agendaListeners = new ArrayList<>();\n+        ruleRuntimeListeners = new ArrayList<>();\n+    }\n+\n+    public CachedRuleEventListenerConfig(List<AgendaEventListener> agendaListeners, List<RuleRuntimeEventListener> ruleRuntimeListeners) {\n+        this.agendaListeners = agendaListeners;\n+        this.ruleRuntimeListeners = ruleRuntimeListeners;\n+    }\n \n     public CachedRuleEventListenerConfig register(AgendaEventListener listener) {\n-        agendaEventListeners.add(listener);\n+        agendaListeners.add(listener);\n         return this;", "originalCommit": "8414397b46b0141ad108ed89a6fde5a5ec04d086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxMzM1Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402913356", "bodyText": "this is unrelated to this PR. The API was supposed to allow chaining.", "author": "evacchi", "createdAt": "2020-04-03T10:34:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk3OTUwMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402979500", "bodyText": "@evacchi\nYup, I saw it is not related to this PR.\nI'm asking because it seems to lead to something like\nnew CachedRuleEventListenerConfig(...).register(....).somethingelse(...) that looks a lot like a mixed pattern (maybe better avoided, IMHO)", "author": "gitgabrio", "createdAt": "2020-04-03T12:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM5MjU3NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405392575", "bodyText": "This is just a renaming. Let's discuss the API structure separately \ud83d\ude09", "author": "kostola", "createdAt": "2020-04-08T09:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDQ4NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDcyOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402790728", "bodyText": "@kostola\nSame question as above", "author": "gitgabrio", "createdAt": "2020-04-03T07:36:57Z", "path": "drools/drools-core/src/main/java/org/drools/core/config/CachedRuleEventListenerConfig.java", "diffHunk": "@@ -24,22 +24,32 @@\n \n public class CachedRuleEventListenerConfig implements RuleEventListenerConfig {\n \n-    private final List<AgendaEventListener> agendaEventListeners = new ArrayList<>();\n-    private final List<RuleRuntimeEventListener> ruleRuntimeListeners = new ArrayList<>();\n+    private final List<AgendaEventListener> agendaListeners;\n+    private final List<RuleRuntimeEventListener> ruleRuntimeListeners;\n+\n+    public CachedRuleEventListenerConfig() {\n+        agendaListeners = new ArrayList<>();\n+        ruleRuntimeListeners = new ArrayList<>();\n+    }\n+\n+    public CachedRuleEventListenerConfig(List<AgendaEventListener> agendaListeners, List<RuleRuntimeEventListener> ruleRuntimeListeners) {\n+        this.agendaListeners = agendaListeners;\n+        this.ruleRuntimeListeners = ruleRuntimeListeners;\n+    }\n \n     public CachedRuleEventListenerConfig register(AgendaEventListener listener) {\n-        agendaEventListeners.add(listener);\n+        agendaListeners.add(listener);\n         return this;\n     }\n-    \n+\n     public CachedRuleEventListenerConfig register(RuleRuntimeEventListener listener) {\n         ruleRuntimeListeners.add(listener);", "originalCommit": "8414397b46b0141ad108ed89a6fde5a5ec04d086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM5Mjc4Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405392787", "bodyText": "Same answer as above \ud83d\ude04", "author": "kostola", "createdAt": "2020-04-08T09:38:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5MDcyOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5Mjk3OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402792979", "bodyText": "@kostola\nHi! It looks like the whole method could be a class in itself; splitting it would allow far easier testing, IMHO.", "author": "gitgabrio", "createdAt": "2020-04-03T07:41:20Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/ApplicationGenerator.java", "diffHunk": "@@ -148,11 +151,11 @@ CompilationUnit compilationUnit() {\n             annotator.withInjection(configField);\n         } else {\n             configField = new FieldDeclaration()\n-                .addModifier(Modifier.Keyword.PROTECTED)\n-                .addVariable(new VariableDeclarator()\n-                                     .setType(Config.class.getCanonicalName())\n-                                     .setName(\"config\")\n-                                     .setInitializer(configGenerator.newInstance()));\n+                    .addModifier(Modifier.Keyword.PROTECTED)\n+                    .addVariable(new VariableDeclarator()\n+                            .setType(Config.class.getCanonicalName())\n+                            .setName(\"config\")\n+                            .setInitializer(new NullLiteralExpr() /* TODO: fix this - configGenerator.newInstance() */));", "originalCommit": "8414397b46b0141ad108ed89a6fde5a5ec04d086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM5MzI1NA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405393254", "bodyText": "Resolving since this code is outdated after moving the refactoring out of this PR.", "author": "kostola", "createdAt": "2020-04-08T09:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5Mjk3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "0b7b7f292c57851297c8ae189630029cc7babfea", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/ApplicationGenerator.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/ApplicationGenerator.java\nindex 0b29ee4e08..8a21077a9e 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/ApplicationGenerator.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/ApplicationGenerator.java\n\n@@ -151,11 +148,11 @@ public class ApplicationGenerator {\n             annotator.withInjection(configField);\n         } else {\n             configField = new FieldDeclaration()\n-                    .addModifier(Modifier.Keyword.PROTECTED)\n-                    .addVariable(new VariableDeclarator()\n-                            .setType(Config.class.getCanonicalName())\n-                            .setName(\"config\")\n-                            .setInitializer(new NullLiteralExpr() /* TODO: fix this - configGenerator.newInstance() */));\n+                .addModifier(Modifier.Keyword.PROTECTED)\n+                .addVariable(new VariableDeclarator()\n+                                     .setType(Config.class.getCanonicalName())\n+                                     .setName(\"config\")\n+                                     .setInitializer(configGenerator.newInstance()));\n         }\n         cls.addMember(configField);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg3MjA1Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r402872057", "bodyText": "Is APPLICATION_CONFIG still used?", "author": "r00ta", "createdAt": "2020-04-03T09:19:01Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/GeneratedFile.java", "diffHunk": "@@ -23,6 +23,7 @@\n         APPLICATION,\n         APPLICATION_SECTION,\n         APPLICATION_CONFIG,", "originalCommit": "8414397b46b0141ad108ed89a6fde5a5ec04d086", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM5MzMzOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405393338", "bodyText": "Resolving since this code is outdated after moving the refactoring out of this PR.", "author": "kostola", "createdAt": "2020-04-08T09:39:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg3MjA1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "0b7b7f292c57851297c8ae189630029cc7babfea", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/GeneratedFile.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/GeneratedFile.java\nindex c3120897e3..ce405586f9 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/GeneratedFile.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/GeneratedFile.java\n\n@@ -23,7 +23,6 @@ public class GeneratedFile {\n         APPLICATION,\n         APPLICATION_SECTION,\n         APPLICATION_CONFIG,\n-        APPLICATION_CONFIG_FACTORY,\n         PROCESS,\n         PROCESS_INSTANCE,\n         REST,\n"}}, {"oid": "369e1d468c38a028c9d7e457d4b6aa8553ce64e8", "url": "https://github.com/kiegroup/kogito-runtimes/commit/369e1d468c38a028c9d7e457d4b6aa8553ce64e8", "message": "[KOGITO-1492] Add flags to include/exclude sections in ConfigFactoryGenerator", "committedDate": "2020-04-06T08:40:42Z", "type": "forcePushed"}, {"oid": "32223ea1d710ad450b2a0e5c386e1af930a0b6b5", "url": "https://github.com/kiegroup/kogito-runtimes/commit/32223ea1d710ad450b2a0e5c386e1af930a0b6b5", "message": "[KOGITO-1492] Generate ConfigProducer with more verbose template instead of ConfigFactory", "committedDate": "2020-04-07T07:24:42Z", "type": "forcePushed"}, {"oid": "0b7b7f292c57851297c8ae189630029cc7babfea", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0b7b7f292c57851297c8ae189630029cc7babfea", "message": "[KOGITO-1492] Merge EventListeners and EventListenerConfigs in RuleConfig", "committedDate": "2020-04-07T11:03:09Z", "type": "forcePushed"}, {"oid": "89f0963547c83e62784ae2c217c1574b9ff60d89", "url": "https://github.com/kiegroup/kogito-runtimes/commit/89f0963547c83e62784ae2c217c1574b9ff60d89", "message": "[KOGITO-1492] Reduce code duplication and fix code smells", "committedDate": "2020-04-08T09:05:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxMjI1MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405612250", "bodyText": "I am not in love with this class, starting with the name CodegenUtils, it easily makes it the target for a \"dump\" containing anything. I see that you only moved it, but the number of methods has grown a lot.\nIn general, I usually create \"topic\" modules like Fields, Types, etc...\nbut in this case I would argue that the constructors found in javaparser are in general more than enough.\nVariableDeclarator etc etc is definitely a bit boring to use, but then just add a shorthand for variable declarator :)\nbesides, I think that this code is mostly unused, right?", "author": "evacchi", "createdAt": "2020-04-08T15:28:01Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java", "diffHunk": "@@ -0,0 +1,316 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import com.github.javaparser.ast.Modifier;\n+import com.github.javaparser.ast.NodeList;\n+import com.github.javaparser.ast.body.FieldDeclaration;\n+import com.github.javaparser.ast.body.MethodDeclaration;\n+import com.github.javaparser.ast.body.Parameter;\n+import com.github.javaparser.ast.body.VariableDeclarator;\n+import com.github.javaparser.ast.expr.Expression;\n+import com.github.javaparser.ast.expr.NameExpr;\n+import com.github.javaparser.ast.expr.ObjectCreationExpr;\n+import com.github.javaparser.ast.expr.SimpleName;\n+import com.github.javaparser.ast.expr.VariableDeclarationExpr;\n+import com.github.javaparser.ast.stmt.BlockStmt;\n+import com.github.javaparser.ast.stmt.IfStmt;\n+import com.github.javaparser.ast.stmt.ReturnStmt;\n+import com.github.javaparser.ast.type.ClassOrInterfaceType;\n+import com.github.javaparser.ast.type.Type;\n+import org.kie.kogito.codegen.di.DependencyInjectionAnnotator;\n+\n+public class CodegenUtils {", "originalCommit": "89f0963547c83e62784ae2c217c1574b9ff60d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxNTU1NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406015555", "bodyText": "In my idea, this class is useful to make the code-generation code more readable, since a lot of common patterns in JavaParser are constantly repeated (e.g. creating a variable, a generic type definition, etc.).\nHere is a snippet in which some of those methods are used: https://github.com/kiegroup/kogito-runtimes/pull/412/files#diff-50ac5c7365b5b0682209e3695be81b51R105-R133\nI would like to keep this class. I agree with you on splitting it into several *Utils classes to avoid having a big dump of everything in the end, maybe moving all of them in a dedicated utils subpackage.\nI think I'm using all of these methods somehow, but not all the overloaded version, which could be cleaned up as well.\nIn addition, there was already a CodegenUtils class in the process subpackage that was instead used all around in rules and decisions as well. I moved those methods in this class.\nLet me know what you think about my suggestions.", "author": "kostola", "createdAt": "2020-04-09T07:43:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxMjI1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2MzY0Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406663647", "bodyText": "I simplified CodegenUtils keeping only the meaningful methods.", "author": "kostola", "createdAt": "2020-04-10T08:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxMjI1MA=="}], "type": "inlineReview", "revised_code": {"commit": "0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\nindex 26cec865be..88eae44691 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\n\n@@ -27,6 +27,7 @@ import com.github.javaparser.ast.body.MethodDeclaration;\n import com.github.javaparser.ast.body.Parameter;\n import com.github.javaparser.ast.body.VariableDeclarator;\n import com.github.javaparser.ast.expr.Expression;\n+import com.github.javaparser.ast.expr.MethodCallExpr;\n import com.github.javaparser.ast.expr.NameExpr;\n import com.github.javaparser.ast.expr.ObjectCreationExpr;\n import com.github.javaparser.ast.expr.SimpleName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNDAxMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405614013", "bodyText": "I mean is this more readable than:\n        new FieldDeclaration()\n                .setModifiers(PUBLIC)\n                .addVariable(new VariableDeclarator(type, name))\nor even:\n        new FieldDeclaration(nodeList(PUBLIC, new VariableDeclarator(type, name))", "author": "evacchi", "createdAt": "2020-04-08T15:30:18Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java", "diffHunk": "@@ -0,0 +1,316 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen;\n+\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import com.github.javaparser.ast.Modifier;\n+import com.github.javaparser.ast.NodeList;\n+import com.github.javaparser.ast.body.FieldDeclaration;\n+import com.github.javaparser.ast.body.MethodDeclaration;\n+import com.github.javaparser.ast.body.Parameter;\n+import com.github.javaparser.ast.body.VariableDeclarator;\n+import com.github.javaparser.ast.expr.Expression;\n+import com.github.javaparser.ast.expr.NameExpr;\n+import com.github.javaparser.ast.expr.ObjectCreationExpr;\n+import com.github.javaparser.ast.expr.SimpleName;\n+import com.github.javaparser.ast.expr.VariableDeclarationExpr;\n+import com.github.javaparser.ast.stmt.BlockStmt;\n+import com.github.javaparser.ast.stmt.IfStmt;\n+import com.github.javaparser.ast.stmt.ReturnStmt;\n+import com.github.javaparser.ast.type.ClassOrInterfaceType;\n+import com.github.javaparser.ast.type.Type;\n+import org.kie.kogito.codegen.di.DependencyInjectionAnnotator;\n+\n+public class CodegenUtils {\n+\n+    private static final Modifier.Keyword[] NONE = new Modifier.Keyword[]{};\n+    private static final Modifier.Keyword[] PUBLIC = new Modifier.Keyword[]{Modifier.Keyword.PUBLIC};\n+    private static final Modifier.Keyword[] PROTECTED = new Modifier.Keyword[]{Modifier.Keyword.PROTECTED};\n+    private static final Modifier.Keyword[] PRIVATE = new Modifier.Keyword[]{Modifier.Keyword.PRIVATE};\n+\n+    public static ClassOrInterfaceType genericType(Class<?> outer, Class<?> inner) {\n+        return genericType(outer.getCanonicalName(), inner.getCanonicalName());\n+    }\n+\n+    public static ClassOrInterfaceType genericType(String outer, Class<?> inner) {\n+        return genericType(outer, inner.getCanonicalName());\n+    }\n+\n+    public static ClassOrInterfaceType genericType(Class<?> outer, String inner) {\n+        return genericType(outer.getCanonicalName(), inner);\n+    }\n+\n+    public static ClassOrInterfaceType genericType(String outer, String inner) {\n+        return new ClassOrInterfaceType(null, outer).setTypeArguments(new ClassOrInterfaceType(null, inner));\n+    }\n+\n+    public static FieldDeclaration field(Modifier.Keyword[] modifiers, Type type, String name) {\n+        return new FieldDeclaration()\n+                .setModifiers(modifiers)\n+                .addVariable(variableDeclarator(type, name));\n+    }\n+\n+    public static FieldDeclaration field(Modifier.Keyword[] modifiers, Type type, String name, Expression expr) {\n+        return new FieldDeclaration()\n+                .setModifiers(modifiers)\n+                .addVariable(variableDeclarator(type, name, expr));\n+    }\n+\n+    public static FieldDeclaration field(Modifier.Keyword[] modifiers, Class<?> type, String name) {\n+        return new FieldDeclaration()\n+                .setModifiers(modifiers)\n+                .addVariable(variableDeclarator(type, name));\n+    }", "originalCommit": "89f0963547c83e62784ae2c217c1574b9ff60d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAyMTkyNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406021927", "bodyText": "Probably my knowledge of JavaParser APIs is not deep enough. I can clean this up if you want.", "author": "kostola", "createdAt": "2020-04-09T07:55:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNDAxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY2Mzk5Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406663996", "bodyText": "I removed this utils method to use JavaParser APIs directly as you suggested.", "author": "kostola", "createdAt": "2020-04-10T08:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNDAxMw=="}], "type": "inlineReview", "revised_code": {"commit": "0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\nindex 26cec865be..88eae44691 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/CodegenUtils.java\n\n@@ -27,6 +27,7 @@ import com.github.javaparser.ast.body.MethodDeclaration;\n import com.github.javaparser.ast.body.Parameter;\n import com.github.javaparser.ast.body.VariableDeclarator;\n import com.github.javaparser.ast.expr.Expression;\n+import com.github.javaparser.ast.expr.MethodCallExpr;\n import com.github.javaparser.ast.expr.NameExpr;\n import com.github.javaparser.ast.expr.ObjectCreationExpr;\n import com.github.javaparser.ast.expr.SimpleName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzkyMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405617922", "bodyText": "I am not against this change per se, but why is it needed?", "author": "evacchi", "createdAt": "2020-04-08T15:35:37Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/di/DependencyInjectionAnnotator.java", "diffHunk": "@@ -42,140 +43,184 @@\n  */\n public interface DependencyInjectionAnnotator {\n \n+    /**\n+     * Annotates given node with name annotation e.g. Named, Qualifier\n+     *\n+     * @param node node to be annotated\n+     */\n+    <T extends NodeWithAnnotations<?>> T withNamed(T node, String name);\n+\n     /**\n      * Annotates given node with application level annotations e.g. ApplicationScoped, Component\n+     *\n      * @param node node to be annotated\n      */\n-    void withApplicationComponent(NodeWithAnnotations<?> node);\n-    \n+    <T extends NodeWithAnnotations<?>> T withApplicationComponent(T node);", "originalCommit": "89f0963547c83e62784ae2c217c1574b9ff60d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjAxMTMyMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406011322", "bodyText": "This syntax allows to keep the old behavior but also chain calls together.\nI used it and I think it makes the code more concise, like this: https://github.com/kiegroup/kogito-runtimes/pull/412/files#diff-50ac5c7365b5b0682209e3695be81b51R74", "author": "kostola", "createdAt": "2020-04-09T07:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYzNzU1NA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406637554", "bodyText": "ok thanks for the clarification. I don't think the self-recursive type is required unless you need to explicitly to access metods of the subtype, which I don't think is the case. Let's keep it, but FYI it can be simplified for readability", "author": "evacchi", "createdAt": "2020-04-10T07:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTYxNzkyMg=="}], "type": "inlineReview", "revised_code": {"commit": "0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/di/DependencyInjectionAnnotator.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/di/DependencyInjectionAnnotator.java\nindex dc7631d789..caf548eb28 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/di/DependencyInjectionAnnotator.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/di/DependencyInjectionAnnotator.java\n\n@@ -82,6 +82,22 @@ public interface DependencyInjectionAnnotator {\n      */\n     <T extends NodeWithAnnotations<?>> T withNamedSingletonComponent(T node, String name);\n \n+    /**\n+     * Annotates given node with bean producer annotations e.g. Produces, Bean\n+     *\n+     * @param node node to be annotated\n+     */\n+    <T extends NodeWithAnnotations<?>> T withBeanProducer(T node);\n+\n+    /**\n+     * Annotates given node with bean producer annotations e.g. Produces, Bean\n+     *\n+     * @param node node to be annotated\n+     */\n+    default <T extends NodeWithAnnotations<?>> T withNamedBeanProducer(T node, String name) {\n+        return withNamed(withBeanProducer(node), name);\n+    }\n+\n     /**\n      * Annotates given node with injection annotations e.g. Inject, Autowire\n      *\n"}}, {"oid": "0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "message": "[KOGITO-1492] Add DecisionConfig to Config and generated ApplicationConfig", "committedDate": "2020-04-10T07:42:31Z", "type": "commit"}, {"oid": "c629eefa9892c6ec6ba418533d496610930432b5", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c629eefa9892c6ec6ba418533d496610930432b5", "message": "[KOGITO-1492] Merge EventListeners and EventListenerConfigs in DecisionConfig and ProcessConfig", "committedDate": "2020-04-10T07:42:31Z", "type": "commit"}, {"oid": "97d95551a90260566ca017947648e067093530b4", "url": "https://github.com/kiegroup/kogito-runtimes/commit/97d95551a90260566ca017947648e067093530b4", "message": "[KOGITO-1492] Merge EventListeners and EventListenerConfigs in RuleConfig", "committedDate": "2020-04-10T07:42:31Z", "type": "commit"}, {"oid": "66e632a0efd145da220f8de4eb560be3cb3829c4", "url": "https://github.com/kiegroup/kogito-runtimes/commit/66e632a0efd145da220f8de4eb560be3cb3829c4", "message": "[KOGITO-1492] Inject listeners in DecisionModels", "committedDate": "2020-04-10T07:42:31Z", "type": "commit"}, {"oid": "59815ff2f477001a2b9a5e99bbe809c0420cfe3a", "url": "https://github.com/kiegroup/kogito-runtimes/commit/59815ff2f477001a2b9a5e99bbe809c0420cfe3a", "message": "[KOGITO-1492] Fix error on empty multiple autowired references in Spring Boot", "committedDate": "2020-04-10T07:42:32Z", "type": "commit"}, {"oid": "7d5386d7bc8d9798120ced743317b1a3add81560", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7d5386d7bc8d9798120ced743317b1a3add81560", "message": "[KOGITO-1492] Fix DecisionContainerGenerator::setupStatements", "committedDate": "2020-04-10T07:42:32Z", "type": "commit"}, {"oid": "7969c1b62819e38b13d7348a0f2a6aacf72c1aa9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7969c1b62819e38b13d7348a0f2a6aacf72c1aa9", "message": "[KOGITO-1492] Reduce code duplication and fix code smells", "committedDate": "2020-04-10T07:42:32Z", "type": "commit"}, {"oid": "78ccd1074fe922b58a3276e405e3d0fe5fef219c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/78ccd1074fe922b58a3276e405e3d0fe5fef219c", "message": "[KOGITO-1492] Reduce size of CodegenUtils", "committedDate": "2020-04-10T08:32:51Z", "type": "commit"}, {"oid": "78ccd1074fe922b58a3276e405e3d0fe5fef219c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/78ccd1074fe922b58a3276e405e3d0fe5fef219c", "message": "[KOGITO-1492] Reduce size of CodegenUtils", "committedDate": "2020-04-10T08:32:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ5NjM1OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r405496358", "bodyText": "I think most of the other classes use a dedicated method to perform this check (i.e. link ). What about change it to be consistent?", "author": "danielezonca", "createdAt": "2020-04-08T12:46:29Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/config/DecisionConfigGenerator.java", "diffHunk": "@@ -0,0 +1,133 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.codegen.decision.config;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import com.github.javaparser.ast.NodeList;\n+import com.github.javaparser.ast.body.BodyDeclaration;\n+import com.github.javaparser.ast.body.FieldDeclaration;\n+import com.github.javaparser.ast.body.MethodDeclaration;\n+import com.github.javaparser.ast.expr.MethodCallExpr;\n+import com.github.javaparser.ast.expr.NameExpr;\n+import com.github.javaparser.ast.expr.ObjectCreationExpr;\n+import com.github.javaparser.ast.expr.ThisExpr;\n+import com.github.javaparser.ast.stmt.BlockStmt;\n+import com.github.javaparser.ast.stmt.ReturnStmt;\n+import org.kie.dmn.api.core.event.DMNRuntimeEventListener;\n+import org.kie.kogito.codegen.di.DependencyInjectionAnnotator;\n+import org.kie.kogito.decision.DecisionEventListenerConfig;\n+import org.kie.kogito.dmn.config.CachedDecisionEventListenerConfig;\n+import org.kie.kogito.dmn.config.DefaultDecisionEventListenerConfig;\n+import org.kie.kogito.dmn.config.StaticDecisionConfig;\n+\n+import static org.kie.kogito.codegen.CodegenUtils.field;\n+import static org.kie.kogito.codegen.CodegenUtils.genericType;\n+import static org.kie.kogito.codegen.CodegenUtils.newObject;\n+import static org.kie.kogito.codegen.CodegenUtils.parameter;\n+import static org.kie.kogito.codegen.CodegenUtils.privateField;\n+import static org.kie.kogito.codegen.CodegenUtils.privateMethod;\n+import static org.kie.kogito.codegen.ConfigGenerator.callMerge;\n+\n+public class DecisionConfigGenerator {\n+\n+    private static final String METHOD_EXTRACT_DECISION_EVENT_LISTENER_CONFIG = \"extract_decisionEventListenerConfig\";\n+    private static final String METHOD_MERGE_DECISION_EVENT_LISTENER_CONFIG = \"merge_decisionEventListenerConfig\";\n+    private static final String VAR_DECISION_EVENT_LISTENER_CONFIG = \"decisionEventListenerConfigs\";\n+    private static final String VAR_DEFAULT_DECISION_EVENT_LISTENER_CONFIG = \"defaultDecisionEventListenerConfig\";\n+    private static final String VAR_DMN_RUNTIME_EVENT_LISTENERS = \"dmnRuntimeEventListeners\";\n+\n+    private DependencyInjectionAnnotator annotator;\n+\n+    private List<BodyDeclaration<?>> members = new ArrayList<>();\n+\n+    public ObjectCreationExpr newInstance() {\n+        if (annotator != null) {", "originalCommit": "89f0963547c83e62784ae2c217c1574b9ff60d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3OTk0Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406679943", "bodyText": "@danielezonca all the *ConfigGenerator classes (and a few others) don't implement the useInjection method but checks directly for annotator != null.\nI agree that we should make it consistent.\nDo you want me to change everywhere (or at least all the *ConfigGenerator classes)?", "author": "kostola", "createdAt": "2020-04-10T09:24:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ5NjM1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjcxNTQ5NA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/412#discussion_r406715494", "bodyText": "Ok so in this case it is fine to keep it. Can you please just create a new ticket to review/refactor this check?", "author": "danielezonca", "createdAt": "2020-04-10T11:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ5NjM1OA=="}], "type": "inlineReview", "revised_code": {"commit": "0793cdabfccaa2b3699ba6b7b56b43aa452f17f7", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/config/DecisionConfigGenerator.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/config/DecisionConfigGenerator.java\nindex 4e5190f3fe..235f91a4e6 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/config/DecisionConfigGenerator.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/decision/config/DecisionConfigGenerator.java\n\n@@ -16,41 +16,27 @@\n package org.kie.kogito.codegen.decision.config;\n \n import java.util.ArrayList;\n-import java.util.Collection;\n import java.util.List;\n \n+import com.github.javaparser.ast.Modifier.Keyword;\n import com.github.javaparser.ast.NodeList;\n import com.github.javaparser.ast.body.BodyDeclaration;\n import com.github.javaparser.ast.body.FieldDeclaration;\n-import com.github.javaparser.ast.body.MethodDeclaration;\n+import com.github.javaparser.ast.body.VariableDeclarator;\n import com.github.javaparser.ast.expr.MethodCallExpr;\n import com.github.javaparser.ast.expr.NameExpr;\n import com.github.javaparser.ast.expr.ObjectCreationExpr;\n-import com.github.javaparser.ast.expr.ThisExpr;\n-import com.github.javaparser.ast.stmt.BlockStmt;\n-import com.github.javaparser.ast.stmt.ReturnStmt;\n-import org.kie.dmn.api.core.event.DMNRuntimeEventListener;\n+import com.github.javaparser.ast.expr.SimpleName;\n+import com.github.javaparser.ast.type.ClassOrInterfaceType;\n+import org.kie.kogito.codegen.CodegenUtils;\n import org.kie.kogito.codegen.di.DependencyInjectionAnnotator;\n import org.kie.kogito.decision.DecisionEventListenerConfig;\n-import org.kie.kogito.dmn.config.CachedDecisionEventListenerConfig;\n import org.kie.kogito.dmn.config.DefaultDecisionEventListenerConfig;\n import org.kie.kogito.dmn.config.StaticDecisionConfig;\n \n-import static org.kie.kogito.codegen.CodegenUtils.field;\n-import static org.kie.kogito.codegen.CodegenUtils.genericType;\n-import static org.kie.kogito.codegen.CodegenUtils.newObject;\n-import static org.kie.kogito.codegen.CodegenUtils.parameter;\n-import static org.kie.kogito.codegen.CodegenUtils.privateField;\n-import static org.kie.kogito.codegen.CodegenUtils.privateMethod;\n-import static org.kie.kogito.codegen.ConfigGenerator.callMerge;\n-\n public class DecisionConfigGenerator {\n \n-    private static final String METHOD_EXTRACT_DECISION_EVENT_LISTENER_CONFIG = \"extract_decisionEventListenerConfig\";\n-    private static final String METHOD_MERGE_DECISION_EVENT_LISTENER_CONFIG = \"merge_decisionEventListenerConfig\";\n-    private static final String VAR_DECISION_EVENT_LISTENER_CONFIG = \"decisionEventListenerConfigs\";\n-    private static final String VAR_DEFAULT_DECISION_EVENT_LISTENER_CONFIG = \"defaultDecisionEventListenerConfig\";\n-    private static final String VAR_DMN_RUNTIME_EVENT_LISTENERS = \"dmnRuntimeEventListeners\";\n+    private static final String DEFAULT_PROCESS_EVENT_LISTENER_CONFIG = \"defaultDecisionEventListenerConfig\";\n \n     private DependencyInjectionAnnotator annotator;\n \n"}}]}