{"pr_number": 656, "pr_title": "[KOGITO-2893] Detach Business Key from ID", "pr_createdAt": "2020-07-28T08:36:53Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/656", "timeline": [{"oid": "30409395fb6355ea0b7b446023fb4be8b3afd62d", "url": "https://github.com/kiegroup/kogito-runtimes/commit/30409395fb6355ea0b7b446023fb4be8b3afd62d", "message": "[KOGITO-2893] Add businessKey to model and Get request\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-28T14:55:12Z", "type": "forcePushed"}, {"oid": "04ef9e3a1cbaff867435e3c11dc52209b008296d", "url": "https://github.com/kiegroup/kogito-runtimes/commit/04ef9e3a1cbaff867435e3c11dc52209b008296d", "message": "[KOGITO-2893] Use key as ID and update using PUT\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-29T18:02:35Z", "type": "forcePushed"}, {"oid": "7ca42e36c7bf931cd3d5cae1196fc442690b5dd5", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7ca42e36c7bf931cd3d5cae1196fc442690b5dd5", "message": "[KOGITO-2893] Use key as ID and update using PUT\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-29T18:05:35Z", "type": "forcePushed"}, {"oid": "4decf806587c619fb671ccd99e3fd245d5f682c7", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4decf806587c619fb671ccd99e3fd245d5f682c7", "message": "[KOGITO-2893] Use key as ID and update using PUT\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-29T18:07:58Z", "type": "forcePushed"}, {"oid": "e29c47ecae236e8db0aef137120c4aaae8684693", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e29c47ecae236e8db0aef137120c4aaae8684693", "message": "[KOGITO-2893] Use key as ID and update using PUT\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-29T21:11:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r462931581", "bodyText": "In general, I agree the PUT method should be used to update the resource, in his case the variables, so it should not be a POST as it was, but on the other hand, creating a new resource using a PUT is not proper behavior, what about creating the resource in the POST method but sending the ID inside the body (the resource with the ID) or one other position would be the same as it is here with the ID on the path but using a POST instead of a PUT just to create and let the PUT exclusively to do the update operation. WDYT?", "author": "tiagodolphine", "createdAt": "2020-07-30T11:29:05Z", "path": "kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java", "diffHunk": "@@ -104,18 +98,20 @@\n         });\n     }\n     \n-    @POST()\n+    @PUT()\n     @Path(\"/{id}\")\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<$Type$Output> updateModel_$name$(@PathParam(\"id\") String id, $Type$ resource) {\n+    public CompletionStage<$Type$Output> createOrUpdateModel_$name$(@Context HttpHeaders httpHeaders,\n+                                                                    @PathParam(\"id\") String id,\n+                                                                    $Type$ resource) {\n         return CompletableFuture.supplyAsync(() -> {\n             return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n                 ProcessInstance<$Type$> pi = process.instances()\n                         .findById(id)\n                         .orElse(null);\n                 if (pi == null) {\n-                    return null;\n+                    return createProcessInstance(httpHeaders, id, resource);", "originalCommit": "e29c47ecae236e8db0aef137120c4aaae8684693", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk0NDAyOQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r462944029", "bodyText": "Well, looking at the RFC https://www.w3.org/Protocols/rfc2616/rfc2616-sec9.html#sec9.6\n\nPUT\n... If the Request-URI does not point to an existing resource, and that URI is capable of being defined as a new resource by the requesting user agent, the origin server can create the resource with that URI. If a new resource is created, the origin server MUST inform the user agent via the 201 (Created) response...\n\nSo using the PUT can be a solution as you did, and in case the resource does not exist the HTTP code on the response should be 201 instead of 200.", "author": "tiagodolphine", "createdAt": "2020-07-30T11:56:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI3MDIzOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r463270238", "bodyText": "Yes, I've done it this way.", "author": "ruromero", "createdAt": "2020-07-30T21:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkzMTU4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ad8f38f07c5fae3d8e30c7265024b647e11af886", "chunk": "diff --git a/kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java b/kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java\nindex d2db27732a..83fff10738 100644\n--- a/kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/ReactiveRestResourceTemplate.java\n\n@@ -26,150 +26,111 @@ import org.kie.kogito.auth.SecurityPolicy;\n import org.kie.kogito.process.Process;\n import org.kie.kogito.process.ProcessInstance;\n import org.kie.kogito.process.ProcessInstanceExecutionException;\n+import org.kie.kogito.process.ProcessInstanceReadMode;\n import org.kie.kogito.process.WorkItem;\n import org.kie.kogito.process.workitem.Policy;\n+import org.kie.kogito.services.uow.UnitOfWorkExecutor;\n+import org.kie.kogito.services.identity.StaticIdentityProvider;\n+import org.kie.kogito.auth.IdentityProvider;\n \n @Path(\"/$name$\")\n public class $Type$ReactiveResource {\n \n     Process<$Type$> process;\n-    \n+\n     Application application;\n \n     @POST()\n     @Produces(MediaType.APPLICATION_JSON)\n-    @Consumes(MediaType.APPLICATION_JSON)    \n-    public CompletionStage<$Type$Output> createResource_$name$(@Context HttpHeaders httpHeaders, $Type$Input resource) {\n-        if (resource == null) {\n-            resource = new $Type$Input();\n-        }\n-        final $Type$Input value = resource;\n-        return CompletableFuture.supplyAsync(() -> {\n-            return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(),\n-                    () -> createProcessInstance(httpHeaders, null, mapInput(value, new $Type$()))\n-            );\n-        });\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<$Type$Output> createResource_$name$(@Context HttpHeaders httpHeaders,\n+                                                               @QueryParam(\"businessKey\") String businessKey,\n+                                                               $Type$Input resource) {\n+        return CompletableFuture.supplyAsync(() -> UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(),\n+            () -> {\n+                $Type$Input inputModel = resource != null ? resource : new $Type$Input();\n+                ProcessInstance<$Type$> pi = process.createInstance(inputModel.toModel());\n+                String startFromNode = httpHeaders.getHeaderString(\"X-KOGITO-StartFromNode\");\n+                if (startFromNode != null) {\n+                    pi.startFrom(startFromNode);\n+                } else {\n+                    pi.start();\n+                }\n+                return pi.checkError().variables().toOutput();\n+            })\n+        );\n     }\n \n     @GET()\n     @Produces(MediaType.APPLICATION_JSON)\n     public CompletionStage<List<$Type$Output>> getResources_$name$() {\n-        return CompletableFuture.supplyAsync(() -> {\n-            if(businessKey != null) {\n-                return process.instances().values().stream()\n-                        .filter(pi -> businessKey.equals(pi.businessKey()))\n-                        .map(pi -> mapOutput(new $Type$Output(), pi.variables()))\n-                        .collect(Collectors.toList());\n-            }\n-            return process.instances().values().stream()\n-                    .map(pi -> mapOutput(new $Type$Output(), pi.variables()))\n-                    .collect(Collectors.toList());\n-        });   \n+        return CompletableFuture.supplyAsync(() -> process.instances().values().stream()\n+                                                          .map(pi -> pi.variables().toOutput())\n+                                                          .collect(Collectors.toList()));\n     }\n \n     @GET()\n     @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public CompletionStage<$Type$Output> getResource_$name$(@PathParam(\"id\") String id) {\n-        return CompletableFuture.supplyAsync(() -> {\n-            return process.instances()\n-                    .findById(id)\n-                    .map(pi -> mapOutput(new $Type$Output(), pi.variables()))\n-                    .orElse(null);\n-        });\n+        return CompletableFuture.supplyAsync(() -> process.instances()\n+                                                          .findById(id, ProcessInstanceReadMode.READ_ONLY)\n+                                                          .map(pi -> pi.variables().toOutput())\n+                                                          .orElse(null));\n     }\n-    \n+\n     @DELETE()\n     @Path(\"/{id}\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public CompletionStage<$Type$Output> deleteResource_$name$(@PathParam(\"id\") final String id) {\n-        return CompletableFuture.supplyAsync(() -> {\n-            return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n-                ProcessInstance<$Type$> pi = process.instances()\n-                        .findById(id)\n-                        .orElse(null);\n-                if (pi == null) {\n-                    return null;\n-                } else {\n-                    pi.abort();\n-                    return getModel(pi);\n-                }\n-            });\n-        });\n+        return CompletableFuture.supplyAsync(() -> UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(),\n+            () -> process\n+                    .instances()\n+                    .findById(id)\n+                    .map(pi -> {\n+                        pi.abort();\n+                        return pi.checkError().variables().toOutput();\n+                    })\n+                    .orElse(null))\n+        );\n     }\n-    \n+\n     @PUT()\n     @Path(\"/{id}\")\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<$Type$Output> createOrUpdateModel_$name$(@Context HttpHeaders httpHeaders,\n-                                                                    @PathParam(\"id\") String id,\n-                                                                    $Type$ resource) {\n-        return CompletableFuture.supplyAsync(() -> {\n-            return org.kie.kogito.services.uow.UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n-                ProcessInstance<$Type$> pi = process.instances()\n-                        .findById(id)\n-                        .orElse(null);\n-                if (pi == null) {\n-                    return createProcessInstance(httpHeaders, id, resource);\n-                } else {\n-                    pi.updateVariables(resource);\n-                    return mapOutput(new $Type$Output(), pi.variables());\n-                }\n-            });\n-        });\n+    public CompletionStage<$Type$Output> updateModel_$name$(@PathParam(\"id\") String id, $Type$ resource) {\n+        return CompletableFuture.supplyAsync(() -> UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(),\n+            () -> process\n+                    .instances()\n+                    .findById(id)\n+                    .map(pi -> pi.updateVariables(resource).toOutput())\n+                    .orElse(null))\n+        );\n     }\n     \n     @GET()\n     @Path(\"/{id}/tasks\")\n     @Produces(MediaType.APPLICATION_JSON)\n-    public CompletionStage<Map<String, String>> getTasks_$name$(@PathParam(\"id\") String id, @QueryParam(\"user\") final String user, @QueryParam(\"group\") final List<String> groups) {\n-        return CompletableFuture.supplyAsync(() -> {\n-            return process.instances()\n-                    .findById(id)\n-                    .map(pi -> pi.workItems(policies(user, groups)))\n-                    .map(l -> l.stream().collect(Collectors.toMap(WorkItem::getId, WorkItem::getName)))\n-                    .orElse(null);\n-        });\n+    public CompletionStage<Map<String, String>> getTasks_$name$(@PathParam(\"id\") String id,\n+                                                                @QueryParam(\"user\") final String user,\n+                                                                @QueryParam(\"group\") final List<String> groups) {\n+        return CompletableFuture.supplyAsync(() -> process.instances()\n+                                                          .findById(id, ProcessInstanceReadMode.READ_ONLY)\n+                                                          .map(pi -> pi.workItems(policies(user, groups)))\n+                                                          .map(l -> l.stream().collect(Collectors.toMap(WorkItem::getId,\n+                                                                                                        WorkItem::getName)))\n+                                                          .orElse(null));\n     }\n \n-    protected $Type$Output createProcessInstance(HttpHeaders httpHeaders, String id, $Type$ resource) {\n-        ProcessInstance<$Type$> pi = process.createInstance(id, resource);\n-        String startFromNode = httpHeaders.getHeaderString(\"X-KOGITO-StartFromNode\");\n-        if (startFromNode != null) {\n-            pi.startFrom(startFromNode);\n-        } else {\n-            pi.start();\n-        }\n-        return getModel(pi);\n-    }\n-\n-    protected $Type$Output getModel(ProcessInstance<$Type$> pi) {\n-        if (pi.status() == ProcessInstance.STATE_ERROR && pi.error().isPresent()) {\n-            throw new ProcessInstanceExecutionException(pi.id(), pi.error().get().failedNodeId(), pi.error().get().errorMessage());\n-        }\n-        \n-        return mapOutput(new $Type$Output(), pi.variables());\n-    }\n-    \n     protected Policy[] policies(String user, List<String> groups) {\n         if (user == null) {\n             return new Policy[0];\n-        } \n-        org.kie.kogito.auth.IdentityProvider identity = null;\n+        }\n+        IdentityProvider identity = null;\n         if (user != null) {\n-            identity = new org.kie.kogito.services.identity.StaticIdentityProvider(user, groups);\n+            identity = new StaticIdentityProvider(user, groups);\n         }\n-        return new Policy[] {SecurityPolicy.of(identity)};\n-    }\n-    \n-    protected $Type$ mapInput($Type$Input input, $Type$ resource) {\n-        resource.fromMap(input.toMap());\n-        return resource;\n-    }\n-    \n-    protected $Type$Output mapOutput($Type$Output output, $Type$ resource) {\n-        output.fromMap(resource.toMap());\n-        return output;\n+        return new Policy[]{SecurityPolicy.of(identity)};\n     }\n }\n"}}, {"oid": "295babb35385e7780fce201434498a7541b67980", "url": "https://github.com/kiegroup/kogito-runtimes/commit/295babb35385e7780fce201434498a7541b67980", "message": "[KOGITO-2893] Return 201 created and throw 404 Exceptions\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-07-30T21:02:52Z", "type": "forcePushed"}, {"oid": "bc4a1c0d04dbf4224da41fec59d18a767e18c2cf", "url": "https://github.com/kiegroup/kogito-runtimes/commit/bc4a1c0d04dbf4224da41fec59d18a767e18c2cf", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-05T09:46:08Z", "type": "forcePushed"}, {"oid": "ed186ec7a7ff012b13648e5bdfbf529c0f9d4dc4", "url": "https://github.com/kiegroup/kogito-runtimes/commit/ed186ec7a7ff012b13648e5bdfbf529c0f9d4dc4", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-05T10:03:21Z", "type": "forcePushed"}, {"oid": "43afb07f73dd60f7d30b937c7800d1e1601b2263", "url": "https://github.com/kiegroup/kogito-runtimes/commit/43afb07f73dd60f7d30b937c7800d1e1601b2263", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-05T14:09:58Z", "type": "forcePushed"}, {"oid": "ad8f38f07c5fae3d8e30c7265024b647e11af886", "url": "https://github.com/kiegroup/kogito-runtimes/commit/ad8f38f07c5fae3d8e30c7265024b647e11af886", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-10T16:13:21Z", "type": "forcePushed"}, {"oid": "f3196ce44e54639e960a39490a1d1a6b11dda21b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f3196ce44e54639e960a39490a1d1a6b11dda21b", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-10T19:44:12Z", "type": "forcePushed"}, {"oid": "cb94e77e14e4562894cd00e198965500c0d6363b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/cb94e77e14e4562894cd00e198965500c0d6363b", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-10T20:48:25Z", "type": "forcePushed"}, {"oid": "e3eafb459ce8eecde18810fe75d4eff5c048b7b9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e3eafb459ce8eecde18810fe75d4eff5c048b7b9", "message": "[KOGITO-2893] Fix affected tests\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-11T06:46:53Z", "type": "forcePushed"}, {"oid": "6664d4508f4cf6c3458a768fa4b0e9e18a490190", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6664d4508f4cf6c3458a768fa4b0e9e18a490190", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-11T15:20:33Z", "type": "forcePushed"}, {"oid": "4090eb3b3899dd77e1b319eacd8fdda3d3f1482f", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4090eb3b3899dd77e1b319eacd8fdda3d3f1482f", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T13:07:36Z", "type": "forcePushed"}, {"oid": "c3f587c832ec1068f926984aaf8c1c3c0631a8d3", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c3f587c832ec1068f926984aaf8c1c3c0631a8d3", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T15:39:50Z", "type": "forcePushed"}, {"oid": "25a81f0d2f468941645ef19a14478e02050c8a31", "url": "https://github.com/kiegroup/kogito-runtimes/commit/25a81f0d2f468941645ef19a14478e02050c8a31", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T16:33:10Z", "type": "forcePushed"}, {"oid": "3655bf59a1745c087bcf8c8d68c665537aae2576", "url": "https://github.com/kiegroup/kogito-runtimes/commit/3655bf59a1745c087bcf8c8d68c665537aae2576", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T17:05:51Z", "type": "forcePushed"}, {"oid": "4534a2857fb5ea10306667ae454eefe1749d61e9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4534a2857fb5ea10306667ae454eefe1749d61e9", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T17:07:06Z", "type": "forcePushed"}, {"oid": "0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b", "message": "[KOGITO-2893] Detach BusinessKey from ID and align status codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-12T17:13:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469491110", "bodyText": "Is it necessary to update the documentation regarding this modification? probably for the other points as well where the REST APIs are being changed, maybe create a JIRA for it, WDYT?", "author": "tiagodolphine", "createdAt": "2020-08-12T19:30:25Z", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -25,18 +25,15 @@\n                                       pi.workItems().stream().filter(wi -> wi.getName().equals(\"$taskName$\"))\n                                         .findFirst();\n                               if (task.isPresent()) {\n-                                  return Response.ok(pi.variables().toOutput())\n-                                                 .header(\"Link\", \"</\" + id + \"/$taskName$/\" + task.get().getId() +\n-                                                                 \">; rel='instance'\")\n-                                                 .build();\n+                                  return Response.created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build()).build();", "originalCommit": "0e2f86f48bb03ebedbe8e5a840624330f1aa2c8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTUyMDY2OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469520668", "bodyText": "Done https://issues.redhat.com/browse/KOGITO-3068", "author": "ruromero", "createdAt": "2020-08-12T20:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY1MTczNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469651735", "bodyText": "In my opinion docs changes should be part of the JIRA that is causing the changes.\nAlso, I think we should continue to return the output variables of task as processes that were created.", "author": "cristianonicolai", "createdAt": "2020-08-13T01:56:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ5MTExMA=="}], "type": "inlineReview", "revised_code": {"commit": "a7a3f120007d293a5a21a25e74e344af7bd5f467", "chunk": "diff --git a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\nindex 921e80b845..f78123a3d9 100644\n--- a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n\n@@ -25,7 +25,10 @@ public class $Type$Resource {\n                                       pi.workItems().stream().filter(wi -> wi.getName().equals(\"$taskName$\"))\n                                         .findFirst();\n                               if (task.isPresent()) {\n-                                  return Response.created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build()).build();\n+                                  return Response\n+                                          .created(uriInfo.getAbsolutePathBuilder().path(task.get().getId()).build())\n+                                          .entity(pi.variables().toOutput())\n+                                          .build();\n                               }\n                               return javax.ws.rs.core.Response.status(javax.ws.rs.core.Response.Status.NOT_FOUND).build();\n                           })\n"}}, {"oid": "a7a3f120007d293a5a21a25e74e344af7bd5f467", "url": "https://github.com/kiegroup/kogito-runtimes/commit/a7a3f120007d293a5a21a25e74e344af7bd5f467", "message": "[KOGITO-2893] Return entity when created\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-13T11:57:02Z", "type": "forcePushed"}, {"oid": "5b7b39f1c7fe8fc51436c6d6eb8572c7473655aa", "url": "https://github.com/kiegroup/kogito-runtimes/commit/5b7b39f1c7fe8fc51436c6d6eb8572c7473655aa", "message": "[KOGITO-2893] Return entity when created\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-13T12:48:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTk5MDU0OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/656#discussion_r469990549", "bodyText": "Is seems the same changes are missing on the Spring templates, like SpringRestResourceTemplate.java", "author": "tiagodolphine", "createdAt": "2020-08-13T14:23:56Z", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java", "diffHunk": "@@ -35,54 +40,56 @@\n import org.kie.kogito.auth.IdentityProvider;\n import org.jbpm.process.instance.impl.humantask.HumanTaskTransition;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n @Path(\"/$name$\")\n public class $Type$Resource {\n \n     Process<$Type$> process;\n \n     Application application;\n \n-    @POST()\n+    @POST\n     @Produces(MediaType.APPLICATION_JSON)\n     @Consumes(MediaType.APPLICATION_JSON)\n-    public $Type$Output createResource_$name$(@Context HttpHeaders httpHeaders,\n+    public Response createResource_$name$(@Context HttpHeaders httpHeaders,\n+                                              @Context UriInfo uriInfo,\n                                               @QueryParam(\"businessKey\") String businessKey,\n                                               $Type$Input resource) {\n         return UnitOfWorkExecutor.executeInUnitOfWork(application.unitOfWorkManager(), () -> {\n             $Type$Input inputModel = resource != null ? resource : new $Type$Input();\n             ProcessInstance<$Type$> pi = process.createInstance(businessKey, inputModel.toModel());\n             String startFromNode = httpHeaders.getHeaderString(\"X-KOGITO-StartFromNode\");\n+\n             if (startFromNode != null) {\n                 pi.startFrom(startFromNode);\n             } else {\n                 pi.start();\n             }\n-            return pi.checkError().variables().toOutput();\n+            UriBuilder uriBuilder = uriInfo.getAbsolutePathBuilder().path(pi.id());\n+            return Response.created(uriBuilder.build())", "originalCommit": "5b7b39f1c7fe8fc51436c6d6eb8572c7473655aa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b63be2dba92ddb5bd6c3d7ee9c8c2139f8fc41cf", "chunk": "diff --git a/kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java b/kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java\nindex e0a10e2cdd..d98907a3fe 100644\n--- a/kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/RestResourceTemplate.java\n\n@@ -66,7 +66,7 @@ public class $Type$Resource {\n             }\n             UriBuilder uriBuilder = uriInfo.getAbsolutePathBuilder().path(pi.id());\n             return Response.created(uriBuilder.build())\n-                    .entity(pi.variables().toOutput())\n+                    .entity(pi.checkError().variables().toOutput())\n                     .build();\n         });\n     }\n"}}, {"oid": "b63be2dba92ddb5bd6c3d7ee9c8c2139f8fc41cf", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b63be2dba92ddb5bd6c3d7ee9c8c2139f8fc41cf", "message": "[KOGITO-2893] Fix missing checkError\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-19T09:06:39Z", "type": "forcePushed"}, {"oid": "f6ada4e142e3bd8c7a925bc02bde93e1da25e5a0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f6ada4e142e3bd8c7a925bc02bde93e1da25e5a0", "message": "[KOGITO-2893] Detach business key from ID and updated response codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-19T09:17:18Z", "type": "forcePushed"}, {"oid": "c8948393d598d24806a8767a20fc1644e691126f", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c8948393d598d24806a8767a20fc1644e691126f", "message": "[KOGITO-2893] Detach business key from ID and updated response codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-24T10:51:25Z", "type": "forcePushed"}, {"oid": "f02f669c87eb5c925a9d0fc4a9594ec819f16f53", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f02f669c87eb5c925a9d0fc4a9594ec819f16f53", "message": "[KOGITO-2893] Detach business key from ID and updated response codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-24T13:43:27Z", "type": "forcePushed"}, {"oid": "f923b123cde215080b46d9a302ae40307fdd4033", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f923b123cde215080b46d9a302ae40307fdd4033", "message": "[KOGITO-2893] Detach business key from ID and updated response codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-26T13:38:10Z", "type": "commit"}, {"oid": "f923b123cde215080b46d9a302ae40307fdd4033", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f923b123cde215080b46d9a302ae40307fdd4033", "message": "[KOGITO-2893] Detach business key from ID and updated response codes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-26T13:38:10Z", "type": "forcePushed"}]}