{"pr_number": 698, "pr_title": "[KOGITO-2902] Checked exceptions in user code", "pr_createdAt": "2020-08-13T10:57:21Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/698", "timeline": [{"oid": "b3e4a45dea2970ceb54440068df3573db028bd74", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b3e4a45dea2970ceb54440068df3573db028bd74", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-13T12:32:25Z", "type": "forcePushed"}, {"oid": "07f914252a622af46a2b7d6c7a84d43c4d7b9927", "url": "https://github.com/kiegroup/kogito-runtimes/commit/07f914252a622af46a2b7d6c7a84d43c4d7b9927", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:27:30Z", "type": "forcePushed"}, {"oid": "4359eab26a872efe9721cf6b694571ca41098646", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4359eab26a872efe9721cf6b694571ca41098646", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:35:13Z", "type": "forcePushed"}, {"oid": "6c7498f30286e66851fd990a0eb411efe4b931e9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6c7498f30286e66851fd990a0eb411efe4b931e9", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:35:52Z", "type": "forcePushed"}, {"oid": "0d03fbfdb96cb2288413b41c720bab85cdb383e5", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0d03fbfdb96cb2288413b41c720bab85cdb383e5", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:50:55Z", "type": "forcePushed"}, {"oid": "55f5973964ce5aec97d355236bc6225ca5c64af0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/55f5973964ce5aec97d355236bc6225ca5c64af0", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:52:41Z", "type": "forcePushed"}, {"oid": "dd2ad8dce7cf56d422c4bf98edd5782039a155fa", "url": "https://github.com/kiegroup/kogito-runtimes/commit/dd2ad8dce7cf56d422c4bf98edd5782039a155fa", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-17T17:54:30Z", "type": "forcePushed"}, {"oid": "ccc985e5d15f09d02546463e8c478b36138436c8", "url": "https://github.com/kiegroup/kogito-runtimes/commit/ccc985e5d15f09d02546463e8c478b36138436c8", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-18T12:45:09Z", "type": "forcePushed"}, {"oid": "0b8d154615b6104661912f8a2010f52a6d1c96f0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0b8d154615b6104661912f8a2010f52a6d1c96f0", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-18T15:43:09Z", "type": "forcePushed"}, {"oid": "c7faf65280d2c64a45bb84ebfb3d8169df5a5f06", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c7faf65280d2c64a45bb84ebfb3d8169df5a5f06", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-18T15:49:04Z", "type": "forcePushed"}, {"oid": "1d4f8ae59e472fc642ecf1eeab77d7359b035c49", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1d4f8ae59e472fc642ecf1eeab77d7359b035c49", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-18T15:50:04Z", "type": "forcePushed"}, {"oid": "0d2306c911ec328035a32f77b734dd88594376ea", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0d2306c911ec328035a32f77b734dd88594376ea", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-18T15:51:46Z", "type": "forcePushed"}, {"oid": "0e5bd311ed353a90a25b7a422c2e27408f13947a", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0e5bd311ed353a90a25b7a422c2e27408f13947a", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T08:01:03Z", "type": "forcePushed"}, {"oid": "4a1783c5fb1fc9bddc3112855faa9a8cc95d25f8", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4a1783c5fb1fc9bddc3112855faa9a8cc95d25f8", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T08:03:54Z", "type": "forcePushed"}, {"oid": "95b2872f1fe96329bb4927c910c5b5c735d0d828", "url": "https://github.com/kiegroup/kogito-runtimes/commit/95b2872f1fe96329bb4927c910c5b5c735d0d828", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T08:04:26Z", "type": "forcePushed"}, {"oid": "ac368f4e6e37ac6f09a0fabc9b376ae40522672a", "url": "https://github.com/kiegroup/kogito-runtimes/commit/ac368f4e6e37ac6f09a0fabc9b376ae40522672a", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T08:55:30Z", "type": "forcePushed"}, {"oid": "9025b4c286a74337a497e483ce2ef32395927904", "url": "https://github.com/kiegroup/kogito-runtimes/commit/9025b4c286a74337a497e483ce2ef32395927904", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T09:11:12Z", "type": "forcePushed"}, {"oid": "74561fd4d5e98f6a04171bf96b8b2ac8b7116498", "url": "https://github.com/kiegroup/kogito-runtimes/commit/74561fd4d5e98f6a04171bf96b8b2ac8b7116498", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T10:19:35Z", "type": "forcePushed"}, {"oid": "a3c9c6ac8d4d6a87011f8798f3bd078738481931", "url": "https://github.com/kiegroup/kogito-runtimes/commit/a3c9c6ac8d4d6a87011f8798f3bd078738481931", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T10:25:37Z", "type": "forcePushed"}, {"oid": "a429a067d10521e47310b47bd65750305eda82be", "url": "https://github.com/kiegroup/kogito-runtimes/commit/a429a067d10521e47310b47bd65750305eda82be", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T10:30:48Z", "type": "forcePushed"}, {"oid": "81ccd593b372bfd7ab7deb2c7023fbdb0f8cc9e6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/81ccd593b372bfd7ab7deb2c7023fbdb0f8cc9e6", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T10:36:34Z", "type": "forcePushed"}, {"oid": "c2f39319229e07c0ba8967ea5590dba9384bb78d", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c2f39319229e07c0ba8967ea5590dba9384bb78d", "message": "[KOGITO-2902] Checked exceptions in user code", "committedDate": "2020-08-19T10:42:35Z", "type": "forcePushed"}, {"oid": "7dabf91d96d2f7160b66b1a80599f8d7d3aa170b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7dabf91d96d2f7160b66b1a80599f8d7d3aa170b", "message": "ClassLoader getMethod altenative approach", "committedDate": "2020-08-19T12:18:09Z", "type": "forcePushed"}, {"oid": "9c2dcd62a5d29f9339d3e379265c28757bb31e63", "url": "https://github.com/kiegroup/kogito-runtimes/commit/9c2dcd62a5d29f9339d3e379265c28757bb31e63", "message": "[KOGITO-2902] Changing unit test\n\nAlthough working before this JIRA, for the purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-19T13:37:26Z", "type": "forcePushed"}, {"oid": "c9e3b92502acc181bf666450c64749f96e10b133", "url": "https://github.com/kiegroup/kogito-runtimes/commit/c9e3b92502acc181bf666450c64749f96e10b133", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest wasalso  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-19T14:49:50Z", "type": "forcePushed"}, {"oid": "b680cc58c8d8c75ec778fa2943764476cff05278", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b680cc58c8d8c75ec778fa2943764476cff05278", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T09:28:34Z", "type": "forcePushed"}, {"oid": "09a779a861fadad1fe4780c9efd53df7470c0988", "url": "https://github.com/kiegroup/kogito-runtimes/commit/09a779a861fadad1fe4780c9efd53df7470c0988", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T09:29:12Z", "type": "forcePushed"}, {"oid": "2ddfebb809c37c36c611859e453ff17b1a1ee9fc", "url": "https://github.com/kiegroup/kogito-runtimes/commit/2ddfebb809c37c36c611859e453ff17b1a1ee9fc", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T09:29:39Z", "type": "forcePushed"}, {"oid": "695a1b946a6825c7eb1d71ce629ef7520d13fc60", "url": "https://github.com/kiegroup/kogito-runtimes/commit/695a1b946a6825c7eb1d71ce629ef7520d13fc60", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T09:40:31Z", "type": "forcePushed"}, {"oid": "e5d9f7004f4bcfc7e28771ec7db7dafea493b070", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e5d9f7004f4bcfc7e28771ec7db7dafea493b070", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T11:56:09Z", "type": "forcePushed"}, {"oid": "abb21a2d3ab6eb59edbb603360d48da8ea1c3a31", "url": "https://github.com/kiegroup/kogito-runtimes/commit/abb21a2d3ab6eb59edbb603360d48da8ea1c3a31", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-20T12:01:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM1MzU5MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r474353591", "bodyText": "maybe would be good to test some form o method overloading as well, making sure we get the correct one?", "author": "cristianonicolai", "createdAt": "2020-08-21T01:12:48Z", "path": "jbpm/jbpm-flow-builder/src/test/java/org/jbpm/compiler/canonical/ReflectionUtilsTest.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.jbpm.compiler.canonical;\n+\n+import java.lang.reflect.Method;\n+import java.util.Arrays;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class ReflectionUtilsTest {\n+\n+    private static class ServiceExample {\n+\n+        @SuppressWarnings(\"unused\")\n+        public int primitiveType(String s, int a) {\n+            return a;\n+        }\n+\n+        @SuppressWarnings(\"unused\")\n+        public Float wrapperType(String s, Float a) {\n+            return a;\n+        }\n+    }\n+\n+    @Test\n+    public void testGetMethod() throws ReflectiveOperationException {", "originalCommit": "abb21a2d3ab6eb59edbb603360d48da8ea1c3a31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDU4MjM0OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r474582349", "bodyText": "Ok done", "author": "fjtirado", "createdAt": "2020-08-21T09:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM1MzU5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f8012ea7de148a28aaecf5e23d72e860b7bedd74", "chunk": "diff --git a/jbpm/jbpm-flow-builder/src/test/java/org/jbpm/compiler/canonical/ReflectionUtilsTest.java b/jbpm/jbpm-flow-builder/src/test/java/org/jbpm/compiler/canonical/ReflectionUtilsTest.java\nindex 1c0c281c3c..738fd4f4b1 100644\n--- a/jbpm/jbpm-flow-builder/src/test/java/org/jbpm/compiler/canonical/ReflectionUtilsTest.java\n+++ b/jbpm/jbpm-flow-builder/src/test/java/org/jbpm/compiler/canonical/ReflectionUtilsTest.java\n\n@@ -20,7 +20,7 @@ import java.util.Arrays;\n \n import org.junit.jupiter.api.Test;\n \n-import static org.junit.jupiter.api.Assertions.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n \n public class ReflectionUtilsTest {\n \n"}}, {"oid": "f8012ea7de148a28aaecf5e23d72e860b7bedd74", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f8012ea7de148a28aaecf5e23d72e860b7bedd74", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-21T09:36:41Z", "type": "forcePushed"}, {"oid": "276fb720d7515c48b425ec0f325b6cf4cccda27b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/276fb720d7515c48b425ec0f325b6cf4cccda27b", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-21T09:41:33Z", "type": "forcePushed"}, {"oid": "3dc71b26e7f813ee2de8967b57d6175bf61547a6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/3dc71b26e7f813ee2de8967b57d6175bf61547a6", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-21T09:54:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxMzYwNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r474813605", "bodyText": "Are there any of the integration-tests processes calling the hello, with the exception? I mean to test this exception use case.", "author": "tiagodolphine", "createdAt": "2020-08-21T16:51:34Z", "path": "integration-tests/integration-tests-quarkus/src/main/java/org/kie/kogito/integrationtests/HelloService.java", "diffHunk": "@@ -28,21 +30,20 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(HelloService.class);\n \n-    public String hello(String name) {\n+    public String hello(String name) throws IOException {\n+        if (name.equals(\"exception\")) {", "originalCommit": "3dc71b26e7f813ee2de8967b57d6175bf61547a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQxODEwNA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475418104", "bodyText": "No, but the scenario I wanted to test is not the exception being thrown, but the exception being properly handled by code generator (that the generated code compiles).\nRegarding exception handling itself, checked exception is wrapped inside a WorkITemHandlerError, which is tested in ErrorEventTest.", "author": "fjtirado", "createdAt": "2020-08-24T08:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxMzYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQzMjc1Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475432757", "bodyText": "Anyway, Im going to add test case that throws Exception for integration purposes", "author": "fjtirado", "createdAt": "2020-08-24T08:42:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgxMzYwNQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "942582e686fa231a2cc546e1750960a258376455", "url": "https://github.com/kiegroup/kogito-runtimes/commit/942582e686fa231a2cc546e1750960a258376455", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-24T08:43:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4MTk0OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475481949", "bodyText": "I would throw ex2 if the last caught exception was ex2. In case the exception messages are different, it can cause confusions.", "author": "MarianMacik", "createdAt": "2020-08-24T09:53:34Z", "path": "jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.jbpm.compiler.canonical;\n+\n+import java.lang.reflect.Method;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public class ReflectionUtils {\n+\n+    private ReflectionUtils() {}\n+\n+    private static Map<Class<?>, Class<?>> wrappers2Primitive = new ConcurrentHashMap<>();\n+\n+    static {\n+        wrappers2Primitive.put(Boolean.class, boolean.class);\n+        wrappers2Primitive.put(Byte.class, byte.class);\n+        wrappers2Primitive.put(Character.class, char.class);\n+        wrappers2Primitive.put(Double.class, double.class);\n+        wrappers2Primitive.put(Float.class, float.class);\n+        wrappers2Primitive.put(Integer.class, int.class);\n+        wrappers2Primitive.put(Long.class, long.class);\n+        wrappers2Primitive.put(Short.class, short.class);\n+    }\n+\n+    public static boolean isWrapper(Class<?> clazz) {\n+        return wrappers2Primitive.containsKey(clazz);\n+    }\n+\n+    public static Class<?> getPrimitive(Class<?> clazz) {\n+        return wrappers2Primitive.get(clazz);\n+    }\n+    \n+    public static Method\n+        getMethod(ClassLoader cl,\n+                  Class<?> clazz,\n+                  String methodName,\n+                  Collection<String> parameterTypes) throws ReflectiveOperationException {\n+        \n+        boolean hasPrimitive = false;\n+        Class<?>[] methodParameters = new Class<?> [parameterTypes.size()];\n+        Class<?>[] primitiveParameters = new Class<?> [parameterTypes.size()];\n+        \n+        Iterator<String> iter = parameterTypes.iterator(); \n+        int i = 0;\n+        while (iter.hasNext()) {\n+            String parameter = iter.next();\n+            if (!parameter.contains(\".\")) {\n+                parameter = \"java.lang.\" + parameter;\n+            }\n+            Class<?> parameterClass = cl.loadClass(parameter);\n+            methodParameters[i] = parameterClass;\n+            Class<?> primitive = wrappers2Primitive.get(parameterClass);\n+            if (primitive != null) {\n+                primitiveParameters[i] = primitive;\n+                hasPrimitive = true;\n+            } else {\n+                primitiveParameters[i] = parameterClass;\n+            }\n+            i++;\n+        }\n+        try {\n+            return clazz.getMethod(methodName, methodParameters);\n+        }\n+        catch (NoSuchMethodException ex) {\n+            if (hasPrimitive) {\n+               try {\n+                   return clazz.getMethod(methodName,primitiveParameters);\n+               }\n+               catch (NoSuchMethodException ex2) {", "originalCommit": "942582e686fa231a2cc546e1750960a258376455", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNjMxMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475526310", "bodyText": "Searching for method with primitive arguments  is a fallback mechanism in case the service is declared using primitive , the real issue is that the method with the wrapper cannot be found and thats the exception that has be thrown (the second exception can be safely ignored, as which will be ignoring a SQL exception in close method that hides the real SQL exception)", "author": "fjtirado", "createdAt": "2020-08-24T11:13:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4MTk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU0MjU5Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475542597", "bodyText": "In that case at least a log message would be helpful.", "author": "MarianMacik", "createdAt": "2020-08-24T11:47:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4MTk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU1NzA0MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475557040", "bodyText": "Sure", "author": "fjtirado", "createdAt": "2020-08-24T12:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4MTk0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "chunk": "diff --git a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\nindex 0756c1312c..6d6d35857d 100644\n--- a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\n+++ b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\n\n@@ -21,10 +21,15 @@ import java.util.Iterator;\n import java.util.Map;\n import java.util.concurrent.ConcurrentHashMap;\n \n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n public class ReflectionUtils {\n \n     private ReflectionUtils() {}\n \n+    private static final Logger logger = LoggerFactory.getLogger(ReflectionUtils.class);\n+\n     private static Map<Class<?>, Class<?>> wrappers2Primitive = new ConcurrentHashMap<>();\n \n     static {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4Mjk2MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475482960", "bodyText": "Please use the full name in constants, i.e. EXCEPTION_NAME.", "author": "MarianMacik", "createdAt": "2020-08-24T09:55:11Z", "path": "jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ServiceTaskDescriptor.java", "diffHunk": "@@ -19,47 +19,61 @@\n import java.lang.reflect.Method;\n import java.text.MessageFormat;\n import java.util.Arrays;\n+import java.util.Collection;\n import java.util.Collections;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n-import java.util.stream.Collectors;\n \n import com.github.javaparser.StaticJavaParser;\n import com.github.javaparser.ast.CompilationUnit;\n import com.github.javaparser.ast.Modifier;\n+import com.github.javaparser.ast.NodeList;\n import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;\n import com.github.javaparser.ast.body.FieldDeclaration;\n import com.github.javaparser.ast.body.MethodDeclaration;\n+import com.github.javaparser.ast.body.Parameter;\n import com.github.javaparser.ast.body.VariableDeclarator;\n+import com.github.javaparser.ast.expr.AssignExpr;\n import com.github.javaparser.ast.expr.CastExpr;\n import com.github.javaparser.ast.expr.Expression;\n import com.github.javaparser.ast.expr.MethodCallExpr;\n import com.github.javaparser.ast.expr.NameExpr;\n import com.github.javaparser.ast.expr.NullLiteralExpr;\n+import com.github.javaparser.ast.expr.ObjectCreationExpr;\n+import com.github.javaparser.ast.expr.SimpleName;\n import com.github.javaparser.ast.expr.StringLiteralExpr;\n import com.github.javaparser.ast.expr.VariableDeclarationExpr;\n import com.github.javaparser.ast.stmt.BlockStmt;\n+import com.github.javaparser.ast.stmt.CatchClause;\n+import com.github.javaparser.ast.stmt.ExpressionStmt;\n import com.github.javaparser.ast.stmt.ReturnStmt;\n+import com.github.javaparser.ast.stmt.Statement;\n+import com.github.javaparser.ast.stmt.ThrowStmt;\n+import com.github.javaparser.ast.stmt.TryStmt;\n import com.github.javaparser.ast.type.ClassOrInterfaceType;\n+import com.github.javaparser.ast.type.Type;\n+import com.github.javaparser.ast.type.UnionType;\n import org.jbpm.process.core.ParameterDefinition;\n import org.jbpm.workflow.core.node.DataAssociation;\n import org.jbpm.workflow.core.node.WorkItemNode;\n import org.kie.api.runtime.process.WorkItem;\n import org.kie.api.runtime.process.WorkItemHandler;\n import org.kie.api.runtime.process.WorkItemManager;\n-\n-import static java.util.stream.Collectors.joining;\n+import org.kie.kogito.process.workitem.WorkItemExecutionError;\n \n public class ServiceTaskDescriptor {\n \n+    private static final String RESULT_NAME = \"result\";\n+    private static final String EXC_NAME = \"ex\";", "originalCommit": "942582e686fa231a2cc546e1750960a258376455", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNTQ0Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475525447", "bodyText": "Done", "author": "fjtirado", "createdAt": "2020-08-24T11:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ4Mjk2MA=="}], "type": "inlineReview", "revised_code": {"commit": "1b7a1a02a42d2b7db3ffbae24d9866d74764cd18", "chunk": "diff --git a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ServiceTaskDescriptor.java b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ServiceTaskDescriptor.java\nindex c79b8c66ec..2d88bea525 100644\n--- a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ServiceTaskDescriptor.java\n+++ b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ServiceTaskDescriptor.java\n\n@@ -65,7 +65,7 @@ import org.kie.kogito.process.workitem.WorkItemExecutionError;\n public class ServiceTaskDescriptor {\n \n     private static final String RESULT_NAME = \"result\";\n-    private static final String EXC_NAME = \"ex\";\n+    private static final String EXCEPTION_NAME = \"ex\";\n \n     private final ClassLoader contextClassLoader;\n     private final String interfaceName;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NzQzNg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475497436", "bodyText": "So this functionality is here to support either:\nmethod(String a, Float b, Integer c)\nor\nmethod(String a, float a, int b)\nso nothing in between.\nI think that the current BPMN modeller knows only wrapper types, so if somebody calls a method with arguments String, Float and Integer and a service will have only String, float and Integer parameters, it will fail to find the method.\nI don't mean we should support all combinations, just asking if I understand it correctly.", "author": "MarianMacik", "createdAt": "2020-08-24T10:22:41Z", "path": "jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ *  Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *        http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ */\n+package org.jbpm.compiler.canonical;\n+\n+import java.lang.reflect.Method;\n+import java.util.Collection;\n+import java.util.Iterator;\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+public class ReflectionUtils {\n+\n+    private ReflectionUtils() {}\n+\n+    private static Map<Class<?>, Class<?>> wrappers2Primitive = new ConcurrentHashMap<>();\n+\n+    static {\n+        wrappers2Primitive.put(Boolean.class, boolean.class);\n+        wrappers2Primitive.put(Byte.class, byte.class);\n+        wrappers2Primitive.put(Character.class, char.class);\n+        wrappers2Primitive.put(Double.class, double.class);\n+        wrappers2Primitive.put(Float.class, float.class);\n+        wrappers2Primitive.put(Integer.class, int.class);\n+        wrappers2Primitive.put(Long.class, long.class);\n+        wrappers2Primitive.put(Short.class, short.class);\n+    }\n+\n+    public static boolean isWrapper(Class<?> clazz) {\n+        return wrappers2Primitive.containsKey(clazz);\n+    }\n+\n+    public static Class<?> getPrimitive(Class<?> clazz) {\n+        return wrappers2Primitive.get(clazz);\n+    }\n+    \n+    public static Method\n+        getMethod(ClassLoader cl,\n+                  Class<?> clazz,\n+                  String methodName,\n+                  Collection<String> parameterTypes) throws ReflectiveOperationException {\n+        \n+        boolean hasPrimitive = false;\n+        Class<?>[] methodParameters = new Class<?> [parameterTypes.size()];\n+        Class<?>[] primitiveParameters = new Class<?> [parameterTypes.size()];\n+        \n+        Iterator<String> iter = parameterTypes.iterator(); \n+        int i = 0;\n+        while (iter.hasNext()) {\n+            String parameter = iter.next();\n+            if (!parameter.contains(\".\")) {\n+                parameter = \"java.lang.\" + parameter;\n+            }\n+            Class<?> parameterClass = cl.loadClass(parameter);\n+            methodParameters[i] = parameterClass;\n+            Class<?> primitive = wrappers2Primitive.get(parameterClass);\n+            if (primitive != null) {\n+                primitiveParameters[i] = primitive;\n+                hasPrimitive = true;\n+            } else {\n+                primitiveParameters[i] = parameterClass;\n+            }\n+            i++;\n+        }\n+        try {\n+            return clazz.getMethod(methodName, methodParameters);\n+        }\n+        catch (NoSuchMethodException ex) {\n+            if (hasPrimitive) {\n+               try {\n+                   return clazz.getMethod(methodName,primitiveParameters);", "originalCommit": "942582e686fa231a2cc546e1750960a258376455", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTUyNzcyNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475527727", "bodyText": "Initially implementation of this PR was not supporting primitive version of the method, but one of the service classes in our test is using primitive and was failing, so I think, rather than changing the test (which I did for HotReloadTest, because the approach used to load the classes was not recommended by Quarkus guys), why not supporting both?\nSupport is partial though, because the service method should either user all wrapper or all primitive (I prefer to use getMethod rather thatn getMethods and search), but I think this is a safer assumption for now.\nIf it turns out to not be a right assumption in the future, we will just have to change the implementation in ReflectionUtils (and use getMEthods and a type name comparator that considers primitive and wrapper types to be the same class)", "author": "fjtirado", "createdAt": "2020-08-24T11:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTU0MzE0Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/698#discussion_r475543142", "bodyText": "OK, makes sense.", "author": "MarianMacik", "createdAt": "2020-08-24T11:48:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTQ5NzQzNg=="}], "type": "inlineReview", "revised_code": {"commit": "6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "chunk": "diff --git a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\nindex 0756c1312c..6d6d35857d 100644\n--- a/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\n+++ b/jbpm/jbpm-flow-builder/src/main/java/org/jbpm/compiler/canonical/ReflectionUtils.java\n\n@@ -21,10 +21,15 @@ import java.util.Iterator;\n import java.util.Map;\n import java.util.concurrent.ConcurrentHashMap;\n \n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n public class ReflectionUtils {\n \n     private ReflectionUtils() {}\n \n+    private static final Logger logger = LoggerFactory.getLogger(ReflectionUtils.class);\n+\n     private static Map<Class<?>, Class<?>> wrappers2Primitive = new ConcurrentHashMap<>();\n \n     static {\n"}}, {"oid": "1b7a1a02a42d2b7db3ffbae24d9866d74764cd18", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1b7a1a02a42d2b7db3ffbae24d9866d74764cd18", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-24T11:11:18Z", "type": "forcePushed"}, {"oid": "2b7177ba259220f2864bfe2c0e24a775dcaafc30", "url": "https://github.com/kiegroup/kogito-runtimes/commit/2b7177ba259220f2864bfe2c0e24a775dcaafc30", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-24T11:21:11Z", "type": "forcePushed"}, {"oid": "6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-24T12:17:04Z", "type": "commit"}, {"oid": "6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6bb3ab3c33120f65e8e48c2a57b7b6cd5780afc9", "message": "[KOGITO-2902] Checked exceptions in user code\n\nModifying service task descriptor to resolve the list of exceptions\nthrown by a service method, catch them and rethrow as a\nWorkItemHandlerError one\n\nHotReloadTest was also  modified. Although working before this JIRA, for\nthe purposes of this test I think\njava files should not be added as txt (standard classloader is not\nfinding these classes, which is limiting), they should be added as\nclasses and modified using modifySource file as indicated in this link", "committedDate": "2020-08-24T12:17:04Z", "type": "forcePushed"}]}