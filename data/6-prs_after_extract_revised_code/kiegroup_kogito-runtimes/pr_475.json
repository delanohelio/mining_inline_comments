{"pr_number": 475, "pr_title": "Code formatting and debug logs", "pr_createdAt": "2020-04-24T09:27:58Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/475", "timeline": [{"oid": "3f364b98765c05b8c8b5ed1b3caa06a42e5f9188", "url": "https://github.com/kiegroup/kogito-runtimes/commit/3f364b98765c05b8c8b5ed1b3caa06a42e5f9188", "message": "Code formatting and debug logs", "committedDate": "2020-04-24T09:26:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNjIyOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/475#discussion_r416736228", "bodyText": "What is our current code style? Somewhere it is one param per line, somewhere it is all on one line.", "author": "MarianMacik", "createdAt": "2020-04-28T16:03:56Z", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/process/instance/ProcessRuntimeImpl.java", "diffHunk": "@@ -77,219 +77,211 @@\n import org.kie.services.time.impl.CommandServiceTimerJobFactoryManager;\n \n public class ProcessRuntimeImpl implements InternalProcessRuntime {\n-\t\n-\tprivate InternalKnowledgeRuntime kruntime;\n-\t\n-\tprivate ProcessInstanceManager processInstanceManager;\n-\tprivate SignalManager signalManager;\n-\tprivate JobsService jobService;\n-\tprivate ProcessEventSupport processEventSupport;\n-\tprivate UnitOfWorkManager unitOfWorkManager;\n-\n-\tpublic ProcessRuntimeImpl(InternalKnowledgeRuntime kruntime) {\n-\t\tthis.kruntime = kruntime;\n+\n+    private InternalKnowledgeRuntime kruntime;\n+    private ProcessInstanceManager processInstanceManager;\n+    private SignalManager signalManager;\n+    private JobsService jobService;\n+    private ProcessEventSupport processEventSupport;\n+    private UnitOfWorkManager unitOfWorkManager;\n+\n+    public ProcessRuntimeImpl(InternalKnowledgeRuntime kruntime) {\n+        this.kruntime = kruntime;\n         TimerService timerService = kruntime.getTimerService();\n-        if ( !(timerService.getTimerJobFactoryManager() instanceof CommandServiceTimerJobFactoryManager) ) {\n-            timerService.setTimerJobFactoryManager( new ThreadSafeTrackableTimeJobFactoryManager() );\n+        if (!(timerService.getTimerJobFactoryManager() instanceof CommandServiceTimerJobFactoryManager)) {\n+            timerService.setTimerJobFactoryManager(new ThreadSafeTrackableTimeJobFactoryManager());\n         }\n \n-\t\t((CompositeClassLoader) getRootClassLoader()).addClassLoader( getClass().getClassLoader() );\n-\t\tinitProcessInstanceManager();\n-\t\tinitSignalManager();\t\t\n-\t\tunitOfWorkManager = new DefaultUnitOfWorkManager(new CollectingUnitOfWorkFactory());\n-\t\tjobService = new InMemoryJobService(this, unitOfWorkManager);\n+        ((CompositeClassLoader) getRootClassLoader()).addClassLoader(getClass().getClassLoader());\n+        initProcessInstanceManager();\n+        initSignalManager();\n+        unitOfWorkManager = new DefaultUnitOfWorkManager(new CollectingUnitOfWorkFactory());\n+        jobService = new InMemoryJobService(this, unitOfWorkManager);\n         processEventSupport = new ProcessEventSupport(unitOfWorkManager);\n         if (isActive()) {\n-            initProcessEventListeners();                   \n+            initProcessEventListeners();\n             initStartTimers();\n         }\n-        initProcessActivationListener(); \n-\t}\n-\t\n-\tpublic void initStartTimers() {\n-\t    KieBase kbase = kruntime.getKieBase();\n+        initProcessActivationListener();\n+    }\n+\n+    public ProcessRuntimeImpl(InternalWorkingMemory workingMemory) {\n+        TimerService timerService = workingMemory.getTimerService();\n+        if (!(timerService.getTimerJobFactoryManager() instanceof CommandServiceTimerJobFactoryManager)) {\n+            timerService.setTimerJobFactoryManager(new ThreadSafeTrackableTimeJobFactoryManager());\n+        }\n+\n+        this.kruntime = (InternalKnowledgeRuntime) workingMemory.getKnowledgeRuntime();\n+        initProcessInstanceManager();\n+        initSignalManager();\n+        unitOfWorkManager = new DefaultUnitOfWorkManager(new CollectingUnitOfWorkFactory());\n+        jobService = new InMemoryJobService(this, unitOfWorkManager);\n+        processEventSupport = new ProcessEventSupport(unitOfWorkManager);\n+        if (isActive()) {\n+            initProcessEventListeners();\n+            initStartTimers();\n+        }\n+        initProcessActivationListener();\n+    }\n+\n+    public void initStartTimers() {\n+        KieBase kbase = kruntime.getKieBase();\n         Collection<Process> processes = kbase.getProcesses();\n         for (Process process : processes) {\n             RuleFlowProcess p = (RuleFlowProcess) process;\n             List<StartNode> startNodes = p.getTimerStart();\n             if (startNodes != null && !startNodes.isEmpty()) {\n-                \n+\n                 for (StartNode startNode : startNodes) {\n                     if (startNode != null && startNode.getTimer() != null) {\n-                                               \n-                        jobService.scheduleProcessJob(ProcessJobDescription.of(createTimerInstance(startNode.getTimer(), kruntime), p.getId()));                       \n+                        jobService.scheduleProcessJob(ProcessJobDescription.of(createTimerInstance(startNode.getTimer(), kruntime), p.getId()));\n                     }\n                 }\n             }\n         }\n     }\n \n-\tpublic ProcessRuntimeImpl(InternalWorkingMemory workingMemory) {\n-        TimerService timerService = workingMemory.getTimerService();\n-        if ( !(timerService.getTimerJobFactoryManager() instanceof CommandServiceTimerJobFactoryManager) ) {\n-            timerService.setTimerJobFactoryManager( new ThreadSafeTrackableTimeJobFactoryManager() );\n-        }\n-\t\t\n-\t\tthis.kruntime = (InternalKnowledgeRuntime) workingMemory.getKnowledgeRuntime();\n-\t\tinitProcessInstanceManager();\n-\t\tinitSignalManager();\t\t\n-\t\tunitOfWorkManager = new DefaultUnitOfWorkManager(new CollectingUnitOfWorkFactory());\n-\t\tjobService = new InMemoryJobService(this, unitOfWorkManager);\n-        processEventSupport = new ProcessEventSupport(unitOfWorkManager);\n-        if (isActive()) {\n-            initProcessEventListeners();                   \n-            initStartTimers();\n+    private void initProcessInstanceManager() {\n+        processInstanceManager = new DefaultProcessInstanceManagerFactory().createProcessInstanceManager(kruntime);\n+    }\n+\n+    private void initSignalManager() {\n+        signalManager = new DefaultSignalManagerFactory().createSignalManager(kruntime);\n+    }\n+\n+    private ClassLoader getRootClassLoader() {\n+        KieBase kbase = ((InternalKnowledgeBase) kruntime.getKieBase());\n+        if (kbase != null) {\n+            return ((InternalKnowledgeBase) kbase).getRootClassLoader();\n         }\n-        initProcessActivationListener();\n-\t}\n-\t\n-\tprivate void initProcessInstanceManager() {\n-\t\tprocessInstanceManager = new DefaultProcessInstanceManagerFactory().createProcessInstanceManager(kruntime);\n-\t\t\n-\t}\n-\t\n-\tprivate void initSignalManager() {\t\n-\t\tsignalManager = new DefaultSignalManagerFactory().createSignalManager(kruntime);\n-\t\t\n-\t}\n-\t\n-\tprivate ClassLoader getRootClassLoader() {\n-\t\tKieBase kbase = ((InternalKnowledgeBase) kruntime.getKieBase());\n-\t\tif (kbase != null) {\n-\t\t\treturn ((InternalKnowledgeBase) kbase).getRootClassLoader();\n-\t\t}\n-\t\tCompositeClassLoader result = new CompositeClassLoader();\n-\t\tresult.addClassLoader(Thread.currentThread().getContextClassLoader());\n-\t\treturn result;\n-\t}\n-\t\n+        CompositeClassLoader result = new CompositeClassLoader();\n+        result.addClassLoader(Thread.currentThread().getContextClassLoader());\n+        return result;\n+    }\n+\n     public ProcessInstance startProcess(final String processId) {\n         return startProcess(processId, null);\n     }\n \n     public ProcessInstance startProcess(String processId,\n                                         Map<String, Object> parameters) {", "originalCommit": "3f364b98765c05b8c8b5ed1b3caa06a42e5f9188", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc0MTc2OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/475#discussion_r416741768", "bodyText": "this is a leftover from a previous style, we used to enforce one parameter per line.", "author": "cristianonicolai", "createdAt": "2020-04-28T16:11:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNjIyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjc0Nzg4OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/475#discussion_r416747888", "bodyText": "thanks", "author": "MarianMacik", "createdAt": "2020-04-28T16:20:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjczNjIyOA=="}], "type": "inlineReview", "revised_code": null}]}