{"pr_number": 332, "pr_title": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "pr_createdAt": "2020-02-25T13:43:56Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/332", "timeline": [{"oid": "b17b34c70c8d5ec8c02e4db050aa76e37bb47002", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b17b34c70c8d5ec8c02e4db050aa76e37bb47002", "message": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "committedDate": "2020-02-25T15:26:07Z", "type": "forcePushed"}, {"oid": "5c25f817f04f6fb47ef48febcbdd7c7473a925dc", "url": "https://github.com/kiegroup/kogito-runtimes/commit/5c25f817f04f6fb47ef48febcbdd7c7473a925dc", "message": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "committedDate": "2020-02-25T16:19:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzMDU0Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/332#discussion_r384130542", "bodyText": "Probably the variable should be called classDotName?", "author": "MarianMacik", "createdAt": "2020-02-25T21:15:55Z", "path": "kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java", "diffHunk": "@@ -323,7 +323,11 @@ private ApplicationGenerator createApplicationGenerator(Path projectPath, Launch\n                 .getClassByName(createDotName(persistenceFactoryClass)) != null;\n \n         GeneratorContext context = GeneratorContext.ofResourcePath(projectPath.resolve(\"src/main/resources\").toFile());\n-        context.withBuildContext(new QuarkusKogitoBuildContext());\n+        context.withBuildContext(new QuarkusKogitoBuildContext((className) -> {\n+                DotName classNotName = createDotName(className);", "originalCommit": "5c25f817f04f6fb47ef48febcbdd7c7473a925dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI5MDY2Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/332#discussion_r384290667", "bodyText": "fixed", "author": "mswiderski", "createdAt": "2020-02-26T06:08:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzMDU0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "acade1e3f5c8434b45e69d47cf2af75a84cb4e08", "chunk": "diff --git a/kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java b/kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java\nindex 67285fa445..e7c1bb0b01 100644\n--- a/kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java\n+++ b/kogito-quarkus-extension/deployment/src/main/java/org/kie/kogito/quarkus/deployment/KogitoAssetsProcessor.java\n\n@@ -323,9 +323,9 @@ public class KogitoAssetsProcessor {\n                 .getClassByName(createDotName(persistenceFactoryClass)) != null;\n \n         GeneratorContext context = GeneratorContext.ofResourcePath(projectPath.resolve(\"src/main/resources\").toFile());\n-        context.withBuildContext(new QuarkusKogitoBuildContext((className) -> {\n-                DotName classNotName = createDotName(className);\n-                return !combinedIndexBuildItem.getIndex().getAnnotations(classNotName).isEmpty() || combinedIndexBuildItem.getIndex().getClassByName(classNotName) != null;\n+        context.withBuildContext(new QuarkusKogitoBuildContext(className -> {\n+                DotName classDotName = createDotName(className);\n+                return !combinedIndexBuildItem.getIndex().getAnnotations(classDotName).isEmpty() || combinedIndexBuildItem.getIndex().getClassByName(classDotName) != null;\n                 \n         }));\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzNDE4OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/332#discussion_r384134188", "bodyText": "Is this constructor even used anywhere? I see that you actually use the other one, which means you override the resolver function everywhere in the end.", "author": "MarianMacik", "createdAt": "2020-02-25T21:23:20Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/context/QuarkusKogitoBuildContext.java", "diffHunk": "@@ -15,6 +15,30 @@\n \n package org.kie.kogito.codegen.context;\n \n+import java.util.function.Function;\n+\n public class QuarkusKogitoBuildContext implements KogitoBuildContext {\n+\n+    private Function<String, Boolean> classAvailabilityResolver;\n+    \n     \n+    public QuarkusKogitoBuildContext() {\n+        this((className) -> {\n+            try {\n+                Thread.currentThread().getContextClassLoader().loadClass(className);\n+                return true;\n+            } catch (ClassNotFoundException e) {\n+                return false;\n+            }\n+        });\n+    }", "originalCommit": "5c25f817f04f6fb47ef48febcbdd7c7473a925dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDI5MDQ5Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/332#discussion_r384290493", "bodyText": "this was just to fix the kogito quarkus extension that was still (and most likely is the same case atm) the io.quarkus kogito extension ... so once that is fixed this constructor won't be used.", "author": "mswiderski", "createdAt": "2020-02-26T06:07:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzNDE4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ0Mzk4OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/332#discussion_r384443989", "bodyText": "Thanks.", "author": "MarianMacik", "createdAt": "2020-02-26T11:49:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzNDE4OA=="}], "type": "inlineReview", "revised_code": {"commit": "acade1e3f5c8434b45e69d47cf2af75a84cb4e08", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/context/QuarkusKogitoBuildContext.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/context/QuarkusKogitoBuildContext.java\nindex ce9d398e19..e9e5274c43 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/context/QuarkusKogitoBuildContext.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/context/QuarkusKogitoBuildContext.java\n\n@@ -15,15 +15,15 @@\n \n package org.kie.kogito.codegen.context;\n \n-import java.util.function.Function;\n+import java.util.function.Predicate;\n \n public class QuarkusKogitoBuildContext implements KogitoBuildContext {\n \n-    private Function<String, Boolean> classAvailabilityResolver;\n+    private Predicate<String> classAvailabilityResolver;\n     \n     \n     public QuarkusKogitoBuildContext() {\n-        this((className) -> {\n+        this(className -> {\n             try {\n                 Thread.currentThread().getContextClassLoader().loadClass(className);\n                 return true;\n"}}, {"oid": "acade1e3f5c8434b45e69d47cf2af75a84cb4e08", "url": "https://github.com/kiegroup/kogito-runtimes/commit/acade1e3f5c8434b45e69d47cf2af75a84cb4e08", "message": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "committedDate": "2020-02-26T06:35:32Z", "type": "forcePushed"}, {"oid": "1e01c32cb2a51dff346d2e58846dba33cca0cbee", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1e01c32cb2a51dff346d2e58846dba33cca0cbee", "message": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "committedDate": "2020-02-26T16:13:54Z", "type": "commit"}, {"oid": "1e01c32cb2a51dff346d2e58846dba33cca0cbee", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1e01c32cb2a51dff346d2e58846dba33cca0cbee", "message": "KOGITO-1264 - Allow to use Validation API to enhance generated REST api", "committedDate": "2020-02-26T16:13:54Z", "type": "forcePushed"}]}