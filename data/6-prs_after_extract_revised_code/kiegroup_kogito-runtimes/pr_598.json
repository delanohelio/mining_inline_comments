{"pr_number": 598, "pr_title": "[KOGITO-2449] Generate endpoints for json schema", "pr_createdAt": "2020-06-30T19:31:43Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/598", "timeline": [{"oid": "2632ed33b4d2f7c9450f1734fa47e5fc2d0857a2", "url": "https://github.com/kiegroup/kogito-runtimes/commit/2632ed33b4d2f7c9450f1734fa47e5fc2d0857a2", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoint.\n\nThis is for pure json schema retrieval (only process id and task name\nare needed)\n\nThis will be extended to include dynamic one (including info for custom\ntask life cycle, which will require process instance id, task id, user\nand group)", "committedDate": "2020-07-01T13:19:58Z", "type": "forcePushed"}, {"oid": "baee599bdbc9ea1c5d125684c23947f18fb97517", "url": "https://github.com/kiegroup/kogito-runtimes/commit/baee599bdbc9ea1c5d125684c23947f18fb97517", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoint.\n\nThis is for pure json schema retrieval (only process id and task name\nare needed)\n\nThis will be extended to include dynamic one (including info for custom\ntask life cycle, which will require process instance id, task id, user\nand group)", "committedDate": "2020-07-01T17:34:45Z", "type": "forcePushed"}, {"oid": "832b907f4a846702ded426d902cacf4233b0ace4", "url": "https://github.com/kiegroup/kogito-runtimes/commit/832b907f4a846702ded426d902cacf4233b0ace4", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoint.\n\nThis is for pure json schema retrieval (only process id and task name\nare needed)\n\nThis will be extended to include dynamic one (including info for custom\ntask life cycle, which will require process instance id, task id, user\nand group)", "committedDate": "2020-07-02T09:43:26Z", "type": "forcePushed"}, {"oid": "09280ed86f85ab11112d672b9c87999f0cbf7864", "url": "https://github.com/kiegroup/kogito-runtimes/commit/09280ed86f85ab11112d672b9c87999f0cbf7864", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-02T14:45:34Z", "type": "forcePushed"}, {"oid": "e0d373fdad8ca00ba8ce765cde4fc9f29c1d8e9c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e0d373fdad8ca00ba8ce765cde4fc9f29c1d8e9c", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-02T14:56:49Z", "type": "forcePushed"}, {"oid": "0464de9a7b6ef5d95f5543e60e0d1a8ed6be1a3e", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0464de9a7b6ef5d95f5543e60e0d1a8ed6be1a3e", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-02T15:01:59Z", "type": "forcePushed"}, {"oid": "8f92fb05f84d3e5cc2c968f9d4d57d172c801c7b", "url": "https://github.com/kiegroup/kogito-runtimes/commit/8f92fb05f84d3e5cc2c968f9d4d57d172c801c7b", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-02T15:49:31Z", "type": "forcePushed"}, {"oid": "cb86d3bed4ec3319322e892097ab8f205b6c9bc1", "url": "https://github.com/kiegroup/kogito-runtimes/commit/cb86d3bed4ec3319322e892097ab8f205b6c9bc1", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T09:21:30Z", "type": "forcePushed"}, {"oid": "1eb4bdea3b3cc8d61b36f7f978e496252a1e6dc1", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1eb4bdea3b3cc8d61b36f7f978e496252a1e6dc1", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T09:45:24Z", "type": "forcePushed"}, {"oid": "dc3dae561f225bd093afef2be47164a180c791d2", "url": "https://github.com/kiegroup/kogito-runtimes/commit/dc3dae561f225bd093afef2be47164a180c791d2", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T09:51:08Z", "type": "forcePushed"}, {"oid": "b22f40f89b2d5210c670d19f6612d3eb246ce79d", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b22f40f89b2d5210c670d19f6612d3eb246ce79d", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T09:54:24Z", "type": "forcePushed"}, {"oid": "0a3a0a5a3f943c3b516fdb0088a5da6f7c392182", "url": "https://github.com/kiegroup/kogito-runtimes/commit/0a3a0a5a3f943c3b516fdb0088a5da6f7c392182", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T11:00:21Z", "type": "forcePushed"}, {"oid": "1cdfdba510538a55daa94a828e5c5196fa5751d6", "url": "https://github.com/kiegroup/kogito-runtimes/commit/1cdfdba510538a55daa94a828e5c5196fa5751d6", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-03T11:51:08Z", "type": "forcePushed"}, {"oid": "4fc6eaafa48514b06fde75e90a732c83746cef7e", "url": "https://github.com/kiegroup/kogito-runtimes/commit/4fc6eaafa48514b06fde75e90a732c83746cef7e", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-06T11:26:03Z", "type": "forcePushed"}, {"oid": "268f9d715cbe92f61a112ebd03b70236c12373b1", "url": "https://github.com/kiegroup/kogito-runtimes/commit/268f9d715cbe92f61a112ebd03b70236c12373b1", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-06T11:38:25Z", "type": "forcePushed"}, {"oid": "456452a3f0e0cfd889e10e06f18c82d132354bb4", "url": "https://github.com/kiegroup/kogito-runtimes/commit/456452a3f0e0cfd889e10e06f18c82d132354bb4", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-06T11:56:49Z", "type": "forcePushed"}, {"oid": "f16e4fa146f492d930364f6577b61ee45882117c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/f16e4fa146f492d930364f6577b61ee45882117c", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-06T12:41:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwMjI0Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r450702242", "bodyText": "I am not really fond of adding this public method to ProcessInstance, as it is a property of the WorkItem. Shouldn't this be a method on WorkItemManager maybe?", "author": "evacchi", "createdAt": "2020-07-07T08:39:58Z", "path": "api/kogito-api/src/main/java/org/kie/kogito/process/ProcessInstance.java", "diffHunk": "@@ -130,6 +130,13 @@\n      * @throws WorkItemNotFoundException in case work item with given id does not exist\n      */\n     void transitionWorkItem(String id, Transition<?> transition);\n+    \n+    /**\n+     * Identify phases that are available to be transition to for a particular work item\n+     * @param id work item \n+     * @return id of the phases that can be transitioned to\n+     */\n+    Set<String> allowedPhases (String id);", "originalCommit": "f16e4fa146f492d930364f6577b61ee45882117c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc1MDIzNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r450750237", "bodyText": "This is also defined in WorkItermManager, but as per other methods of this interface (like completeWorkItem or abortWorkItem), it is also exposed in ProcessIntance to allow being called from the generated code.\nI mean, Im following the pre existing policy here ;)\nProbably it will  be better to create a getWorkItemManager in process instance and do not have to duplicate methods in both interfaces.\nI can do that, but we need to discuss it first", "author": "fjtirado", "createdAt": "2020-07-07T10:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwMjI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI3NDYyMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452274622", "bodyText": "ok makes sense; in fact, I am not fond of those other methods either -- there was no \"policy\" in place when they were added hehe. So let's keep this around, but let's plan another refactoring maybe", "author": "evacchi", "createdAt": "2020-07-09T14:48:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwMjI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc1NTc1Ng==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452755756", "bodyText": "fair enough, we need to revisit all of these methods", "author": "fjtirado", "createdAt": "2020-07-10T10:16:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwMjI0Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTY4Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r450705682", "bodyText": "are we consistent with the way process \"id\", process \"package\", process \"name\" are used? IIRC IDs are unqualified, while we have package+name otherwise; not 100% sure but seeing the package here feels inconsistent @cristianonicolai @tiagobento ?", "author": "evacchi", "createdAt": "2020-07-07T08:45:12Z", "path": "kogito-codegen/src/test/java/org/kie/kogito/codegen/JsonSchemaGeneratorTest.java", "diffHunk": "@@ -40,7 +40,7 @@\n \n     private enum Color {GREEN, WHITE};\n     \n-    @UserTask(taskName = \"test\", processName = \"test\")\n+    @UserTask(taskName = \"test\", processName = \"org.jbpm.test\")", "originalCommit": "f16e4fa146f492d930364f6577b61ee45882117c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDc1MDkwMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r450750900", "bodyText": "I feel including package name will guarantee the uniqueneness of process name. As can be seen in the test, this will basically affects name of the schema, where \".\" are replaced by \"#\"", "author": "fjtirado", "createdAt": "2020-07-07T10:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTY4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI3NDk0Mg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452274942", "bodyText": "ok I was trying to make sure we're consistent across the other usages of process ids/names. Let's keep it for now", "author": "evacchi", "createdAt": "2020-07-09T14:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTY4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2MjQ0NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452662445", "bodyText": "name and package are different properties for a process. It might be valid to cover that the generation won't break because \".\" are included but I dont think this is a common use.", "author": "cristianonicolai", "createdAt": "2020-07-10T07:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDcwNTY4Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "cf5f3551db3b7d15dc90c6cad90bf981584ce79d", "url": "https://github.com/kiegroup/kogito-runtimes/commit/cf5f3551db3b7d15dc90c6cad90bf981584ce79d", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-07T10:11:28Z", "type": "forcePushed"}, {"oid": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "url": "https://github.com/kiegroup/kogito-runtimes/commit/899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-07T14:58:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0Mzg4MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451043881", "bodyText": "I think it can be used the SpringBootTest.WebEnvironment.RANDOM_PORT to avoid conflicts.", "author": "tiagodolphine", "createdAt": "2020-07-07T17:55:35Z", "path": "integration-tests/integration-tests-springboot/src/it/integration-tests-springboot-it/src/test/java/org/kie/kogito/integrationtests/springboot/JsonSchemaTest.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.integrationtests.springboot;\n+\n+\n+import io.restassured.RestAssured;\n+import io.restassured.http.ContentType;\n+import org.junit.jupiter.api.Test;\n+\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.test.annotation.DirtiesContext;\n+\n+import static io.restassured.RestAssured.given;\n+import static io.restassured.module.jsv.JsonSchemaValidator.matchesJsonSchemaInClasspath;\n+\n+@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT, classes = KogitoSpringbootApplication.class)", "originalCommit": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5OTYwMg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451399602", "bodyText": "For the sake of record, tried Random_port as suggested, but the test failed for some obscure reason, so switching back to defined one.", "author": "fjtirado", "createdAt": "2020-07-08T09:13:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA0Mzg4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5fcc18f7161653620eb3b48074c7f197181ad966", "chunk": "diff --git a/integration-tests/integration-tests-springboot/src/it/integration-tests-springboot-it/src/test/java/org/kie/kogito/integrationtests/springboot/JsonSchemaTest.java b/integration-tests/integration-tests-springboot/src/it/integration-tests-springboot-it/src/test/java/org/kie/kogito/integrationtests/springboot/JsonSchemaTest.java\nindex 54889c1bff..037588e51c 100644\n--- a/integration-tests/integration-tests-springboot/src/it/integration-tests-springboot-it/src/test/java/org/kie/kogito/integrationtests/springboot/JsonSchemaTest.java\n+++ b/integration-tests/integration-tests-springboot/src/it/integration-tests-springboot-it/src/test/java/org/kie/kogito/integrationtests/springboot/JsonSchemaTest.java\n\n@@ -27,7 +27,7 @@ import org.springframework.test.annotation.DirtiesContext;\n import static io.restassured.RestAssured.given;\n import static io.restassured.module.jsv.JsonSchemaValidator.matchesJsonSchemaInClasspath;\n \n-@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.DEFINED_PORT, classes = KogitoSpringbootApplication.class)\n+@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT, classes = KogitoSpringbootApplication.class)\n @DirtiesContext(classMode = DirtiesContext.ClassMode.AFTER_EACH_TEST_METHOD)\n public class JsonSchemaTest {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA3NjQ4Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451076483", "bodyText": "formatting", "author": "tiagodolphine", "createdAt": "2020-07-07T18:56:03Z", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jbpm.util;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Map;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+\n+public class JsonSchemaUtil {\n+\n+    private JsonSchemaUtil() {}\n+    \n+    private static ObjectMapper mapper = new ObjectMapper();\n+    private static Path jsonDir = Paths.get(\"META-INF\", \"jsonSchema\");\n+\n+    public static String getJsonSchemaName(String processId, String taskName) {\n+        return processId.replace('.', '#') + \"_\" + taskName;\n+    }\n+\n+    public static Path getJsonDir() {\n+        return jsonDir;\n+    }\n+\n+    public static String getFileName(String key) {\n+        return key + \".json\";\n+    }\n+\n+    public static Map<String,Object> load(ClassLoader cl, String processId, String taskName) {\n+        Path jsonFile = jsonDir.resolve(getFileName(getJsonSchemaName(processId, taskName)));\n+        try (InputStream in = cl.getResourceAsStream(jsonFile.toString())) {\n+            if (in == null) {\n+                throw new IllegalArgumentException(\"Cannot find file \" + jsonFile + \" in classpath\");\n+            }\n+            return load(in);\n+        } catch (IOException io) {\n+            throw new IllegalStateException(\"Error loading schema \" + jsonFile, io);\n+        }\n+    }\n+\n+    public static Map<String,Object> load(InputStream in) throws IOException {\n+        return mapper.readValue(in,new TypeReference<Map<String, Object>>() {\n+        });\n+    }", "originalCommit": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6aa6cb993cc75bea47227ee8a61f959f58403b6c", "chunk": "diff --git a/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java b/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\nindex b25651e0c3..8c74214c23 100644\n--- a/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\n+++ b/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\n\n@@ -12,7 +12,7 @@ import com.fasterxml.jackson.databind.ObjectMapper;\n public class JsonSchemaUtil {\n \n     private JsonSchemaUtil() {}\n-    \n+\n     private static ObjectMapper mapper = new ObjectMapper();\n     private static Path jsonDir = Paths.get(\"META-INF\", \"jsonSchema\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA3NzUzMA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451077530", "bodyText": "could it be renamed to JsonSchemaUtilTest?", "author": "tiagodolphine", "createdAt": "2020-07-07T18:57:58Z", "path": "jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package org.jbpm.util;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Map;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JsonSchemaTest {", "originalCommit": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6aa6cb993cc75bea47227ee8a61f959f58403b6c", "chunk": "diff --git a/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaTest.java b/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\nsimilarity index 98%\nrename from jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaTest.java\nrename to jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\nindex bcf23c45ff..46adada622 100644\n--- a/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaTest.java\n+++ b/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\n\n@@ -10,7 +10,7 @@ import org.junit.jupiter.api.Test;\n import static org.junit.jupiter.api.Assertions.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertTrue;\n \n-public class JsonSchemaTest {\n+public class JsonSchemaUtilTest {\n     \n     \n     private final static String example =\"{\\\"$schema\\\": \\\"http://json-schema.org/draft-07/schema#\\\",\\n\" + \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA4NjI1Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451086253", "bodyText": "It seems there is too much logic for Rest resource class, wouldn't worth extracting this logic to another class, in this way it could be reused in both springboot and quarkus, anyway just a suggestion.", "author": "tiagodolphine", "createdAt": "2020-07-07T19:14:53Z", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -75,7 +75,23 @@\n             return null;\n         }\n     }\n+\n+    @GET()\n+    @Path(\"$taskName$/form\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Map<String,Object> getSchema() {\n+        return JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n+    }\n     \n+    @GET()\n+    @Path(\"/{id}/$taskName$/{workItemId}/form\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId) {\n+        Map<String,Object> jsonSchema = JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");", "originalCommit": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5NjYyMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451396623", "bodyText": "Hmmm,I agree with the principle, that is why most logic is included in JsonSchemaUtils (instead of what is done in other methods present in this template) , but in the code that remains in the template we are just  specifying params and calling processIntance to retrieve the allowed phases (and including there in the map if there is any).\nI think the logic that is currently in the template is the logic that is needed (there has to be some copy paste between this and spring  template anyway), because it seems natural to interact with ProcessInstance  in the REST controller  and not inside the utility class (which is defined in flow project, due to the lack of a better common place)\nInitially, (see my comment to Edoardo in this PR) I have included a jsonschema class in the api, but it does not reduce substantially the logic here (we still need to resolve processintance and call allowedPhases), so I remove it since api project follow a differnet inteface-base approach with no dependency with jackson.", "author": "fjtirado", "createdAt": "2020-07-08T09:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA4NjI1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "chunk": "diff --git a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\nindex 9be13bdaf6..0d2a845666 100644\n--- a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n\n@@ -77,14 +77,14 @@ public class $Type$Resource {\n     }\n \n     @GET()\n-    @Path(\"$taskName$/form\")\n+    @Path(\"$taskName$/schema\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public Map<String,Object> getSchema() {\n         return JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n     }\n     \n     @GET()\n-    @Path(\"/{id}/$taskName$/{workItemId}/form\")\n+    @Path(\"/{id}/$taskName$/{workItemId}/schema\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId) {\n         Map<String,Object> jsonSchema = JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451092006", "bodyText": "What about using a different name for the resource path instead of form, I mean something like schema, or any more generic one, the term form recalls me UI, I think a more generic term would be better, WDYT?", "author": "tiagodolphine", "createdAt": "2020-07-07T19:25:50Z", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -75,7 +75,23 @@\n             return null;\n         }\n     }\n+\n+    @GET()\n+    @Path(\"$taskName$/form\")", "originalCommit": "899b245fed5509fea4029dadbd6eb87b4d3cc1aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM5OTk0MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451399941", "bodyText": "hmmm, I initially proposed schema, but Pere believe it was better to use form.\nWhatever you decide is fine for me ; )", "author": "fjtirado", "createdAt": "2020-07-08T09:13:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQwMjQ3OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451402478", "bodyText": "then to make both happy use @Path(\"$taskName$/formschema\") :)", "author": "mswiderski", "createdAt": "2020-07-08T09:18:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQzNzQ2Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451437463", "bodyText": "I like this salomonic solution ;), so if nobody speak up in the next 24 hours Ill use that ;)", "author": "fjtirado", "createdAt": "2020-07-08T10:19:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ1MDc2Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451450763", "bodyText": "@fjtirado @tiagodolphine If you ask me, form name is my personal preference because it's going to be the main use in my case, but I agree that it represents the task schema, so I'll be ok with whatever decision we make. Also @mswiderski option works for me \ud83d\udc4d", "author": "pefernan", "createdAt": "2020-07-08T10:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ3ODAxNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451478015", "bodyText": "I was just questioning it because from the REST perspective the resource name on the path should represent what is returned/created etc... so when I look at /form it seems that a form will be returned, and in fact what is retuned is a schema.", "author": "tiagodolphine", "createdAt": "2020-07-08T11:41:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NjMxNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r451486317", "bodyText": "Tiago is right, from rest point of view this is the schema of the task, the fact that is used for the form should not be part of the resource name.\nThinking about this carefully, my preferred name wil be actually metadata, because what we are really returning is metadata information about a particular task. The fact that we are using json schema to represent the metadata should not be part of the REST name either.\nSince Im kind of new, what should be do when there is not agreement? we should reach one or author decides ?;)", "author": "fjtirado", "createdAt": "2020-07-08T11:57:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA1MDUzMQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452050531", "bodyText": "@fjtirado to me is ok either name you use, I think that calling it forms looks like a name too focused to UI, so changing it to schema seems a better option for me.", "author": "pefernan", "createdAt": "2020-07-09T08:27:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA4ODYxOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452088618", "bodyText": "Ok, lets use schema", "author": "fjtirado", "createdAt": "2020-07-09T09:31:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5MjAwNg=="}], "type": "inlineReview", "revised_code": {"commit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "chunk": "diff --git a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\nindex 9be13bdaf6..0d2a845666 100644\n--- a/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n+++ b/kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java\n\n@@ -77,14 +77,14 @@ public class $Type$Resource {\n     }\n \n     @GET()\n-    @Path(\"$taskName$/form\")\n+    @Path(\"$taskName$/schema\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public Map<String,Object> getSchema() {\n         return JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n     }\n     \n     @GET()\n-    @Path(\"/{id}/$taskName$/{workItemId}/form\")\n+    @Path(\"/{id}/$taskName$/{workItemId}/schema\")\n     @Produces(MediaType.APPLICATION_JSON)\n     public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId) {\n         Map<String,Object> jsonSchema = JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n"}}, {"oid": "6aa6cb993cc75bea47227ee8a61f959f58403b6c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/6aa6cb993cc75bea47227ee8a61f959f58403b6c", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-08T09:10:44Z", "type": "forcePushed"}, {"oid": "5fcc18f7161653620eb3b48074c7f197181ad966", "url": "https://github.com/kiegroup/kogito-runtimes/commit/5fcc18f7161653620eb3b48074c7f197181ad966", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-08T09:13:58Z", "type": "forcePushed"}, {"oid": "d35c6ca9a8e3bdd643602c87d3b76fd4b56936e1", "url": "https://github.com/kiegroup/kogito-runtimes/commit/d35c6ca9a8e3bdd643602c87d3b76fd4b56936e1", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-08T10:17:08Z", "type": "forcePushed"}, {"oid": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "url": "https://github.com/kiegroup/kogito-runtimes/commit/b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-09T09:35:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NDcyNQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452654725", "bodyText": "missing headers", "author": "cristianonicolai", "createdAt": "2020-07-10T06:51:29Z", "path": "jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package org.jbpm.util;", "originalCommit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODkwOA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452748908", "bodyText": "uppsss ;)", "author": "fjtirado", "createdAt": "2020-07-10T10:01:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NDcyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "380a86a4bc3c32ab592791ccea81c25e9f263db0", "chunk": "diff --git a/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java b/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\nindex 8c74214c23..0976de35e9 100644\n--- a/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\n+++ b/jbpm/jbpm-flow/src/main/java/org/jbpm/util/JsonSchemaUtil.java\n\n@@ -1,3 +1,17 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n package org.jbpm.util;\n \n import java.io.IOException;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NTAwMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452655003", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void testJsonSchema() throws IOException\n          \n          \n            \n                {\n          \n          \n            \n                void testJsonSchema() throws IOException {", "author": "cristianonicolai", "createdAt": "2020-07-10T06:52:10Z", "path": "jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package org.jbpm.util;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Map;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class JsonSchemaUtilTest {\n+    \n+    \n+    private final static String example =\"{\\\"$schema\\\": \\\"http://json-schema.org/draft-07/schema#\\\",\\n\" + \n+            \"    \\\"type\\\": \\\"object\\\",\\n\" + \n+            \"    \\\"properties\\\": {\\n\" + \n+            \"        \\\"traveller\\\": {\\n\" + \n+            \"            \\\"type\\\": \\\"object\\\",\\n\" + \n+            \"            \\\"properties\\\": {\\n\" + \n+            \"                \\\"address\\\": {\\n\" + \n+            \"                    \\\"type\\\": \\\"object\\\",\\n\" + \n+            \"                    \\\"properties\\\": {\\n\" + \n+            \"                        \\\"city\\\": {\\n\" + \n+            \"                            \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                        },\\n\" + \n+            \"                        \\\"country\\\": {\\n\" + \n+            \"                            \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                        },\\n\" + \n+            \"                        \\\"street\\\": {\\n\" + \n+            \"                            \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                        },\\n\" + \n+            \"                        \\\"zipCode\\\": {\\n\" + \n+            \"                            \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                        }\\n\" + \n+            \"                    }\\n\" + \n+            \"                },\\n\" + \n+            \"                \\\"email\\\": {\\n\" + \n+            \"                    \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                },\\n\" + \n+            \"                \\\"firstName\\\": {\\n\" + \n+            \"                    \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                },\\n\" + \n+            \"                \\\"lastName\\\": {\\n\" + \n+            \"                    \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                },\\n\" + \n+            \"                \\\"nationality\\\": {\\n\" + \n+            \"                    \\\"type\\\": \\\"string\\\"\\n\" + \n+            \"                }\\n\" + \n+            \"            },\\n\" + \n+            \"            \\\"input\\\": true\\n\" + \n+            \"        },\\n\" + \n+            \"        \\\"approved\\\": {\\n\" + \n+            \"            \\\"type\\\": \\\"boolean\\\",\\n\" + \n+            \"            \\\"output\\\": true\\n\" + \n+            \"        }\\n\" + \n+            \"    }}\";\n+    \n+    @Test\n+    void testJsonSchema() throws IOException\n+    {", "originalCommit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODc1OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452748759", "bodyText": "Done", "author": "fjtirado", "createdAt": "2020-07-10T10:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NTAwMw=="}], "type": "inlineReview", "revised_code": {"commit": "380a86a4bc3c32ab592791ccea81c25e9f263db0", "chunk": "diff --git a/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java b/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\nindex 46adada622..6554ac2df1 100644\n--- a/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\n+++ b/jbpm/jbpm-flow/src/test/java/org/jbpm/util/JsonSchemaUtilTest.java\n\n@@ -58,8 +58,7 @@ public class JsonSchemaUtilTest {\n             \"    }}\";\n     \n     @Test\n-    void testJsonSchema() throws IOException\n-    {\n+    void testJsonSchema() throws IOException {\n         InputStream in = new ByteArrayInputStream(example.getBytes());\n         Map<String,Object> schemaMap = JsonSchemaUtil.load(in);\n         assertEquals (\"object\", schemaMap.get(\"type\"));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NTE3OA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452655178", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private CustomPropertyDefinition getInputOutput (FieldScope f, SchemaGenerationContext context)\n          \n          \n            \n                {\n          \n          \n            \n                private CustomPropertyDefinition getInputOutput (FieldScope f, SchemaGenerationContext context) {", "author": "cristianonicolai", "createdAt": "2020-07-10T06:52:35Z", "path": "kogito-codegen/src/main/java/org/kie/kogito/codegen/JsonSchemaGenerator.java", "diffHunk": "@@ -107,15 +111,25 @@ private JsonSchemaGenerator(Stream<Class<?>> stream) {\n             }\n             try (ByteArrayOutputStream outputStream = new ByteArrayOutputStream()) {\n                 writer.writeValue(outputStream, merged);\n-                files.add(new GeneratedFile(Type.JSON_SCHEMA, entry.getKey() + \".json\", outputStream.toByteArray()));\n+                files.add(new GeneratedFile(Type.JSON_SCHEMA, JsonSchemaUtil.getFileName(entry.getKey()), outputStream.toByteArray()));\n             }\n         }\n         return files;\n     }\n+    \n+    private CustomPropertyDefinition getInputOutput (FieldScope f, SchemaGenerationContext context)\n+    {", "originalCommit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0ODY1Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452748657", "bodyText": "File formatted properly now, thanks", "author": "fjtirado", "createdAt": "2020-07-10T10:01:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY1NTE3OA=="}], "type": "inlineReview", "revised_code": {"commit": "380a86a4bc3c32ab592791ccea81c25e9f263db0", "chunk": "diff --git a/kogito-codegen/src/main/java/org/kie/kogito/codegen/JsonSchemaGenerator.java b/kogito-codegen/src/main/java/org/kie/kogito/codegen/JsonSchemaGenerator.java\nindex 993d891b33..116ee8821c 100644\n--- a/kogito-codegen/src/main/java/org/kie/kogito/codegen/JsonSchemaGenerator.java\n+++ b/kogito-codegen/src/main/java/org/kie/kogito/codegen/JsonSchemaGenerator.java\n\n@@ -116,15 +115,14 @@ public class JsonSchemaGenerator {\n         }\n         return files;\n     }\n-    \n-    private CustomPropertyDefinition getInputOutput (FieldScope f, SchemaGenerationContext context)\n-    {\n+\n+    private CustomPropertyDefinition getInputOutput(FieldScope f, SchemaGenerationContext context) {\n         UserTaskParam param = f.getAnnotation(UserTaskParam.class);\n         ObjectNode objectNode = context.createDefinition(f.getDeclaredType());\n         if (param != null) {\n             objectNode.put(param.value().toString().toLowerCase(), true);\n         }\n-        return new CustomPropertyDefinition(objectNode,AttributeInclusion.NO);\n+        return new CustomPropertyDefinition(objectNode, AttributeInclusion.NO);\n     }\n \n     private static String getKey(Class<?> c) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2MTAzOQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452661039", "bodyText": "@fjtirado instead of doing allowed phases via process instances. You could have access or inject here the ApplicationConfig, from there you can get ProcessConfig.workItemHandlers and retrieve the WorkItemHandler for human tasks. That way, allowedPhases is only added to WorkItemHandler wdyt?", "author": "cristianonicolai", "createdAt": "2020-07-10T07:06:32Z", "path": "kogito-codegen/src/main/resources/class-templates/RestResourceUserTaskTemplate.java", "diffHunk": "@@ -75,7 +75,23 @@\n             return null;\n         }\n     }\n+\n+    @GET()\n+    @Path(\"$taskName$/schema\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Map<String,Object> getSchema() {\n+        return JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n+    }\n     \n+    @GET()\n+    @Path(\"/{id}/$taskName$/{workItemId}/schema\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public Map<String,Object> getSchemaAndPhases(@PathParam(\"id\") final String id, @PathParam(\"workItemId\") final String workItemId) {\n+        Map<String,Object> jsonSchema = JsonSchemaUtil.load(this.getClass().getClassLoader(),process.id(),\"$taskName$\");\n+        process.instances().findById(id).ifPresent(pi ->jsonSchema.put(\"phases\",pi.allowedPhases(workItemId)));", "originalCommit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc0NzA3NQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452747075", "bodyText": "Although it is true that WorkItermHandler can be obtained through Config (thanks for pointing this out), one problem remains. In order to retrieve allowed phases, we need the current status of the workitem, and workitems are stored in WorkItemManager, not WorkItemHandler. This is the same situation than for complete or abort workItem, and I guess this is the reason complete and abort work item are exposed in ProcessInstance inteface.", "author": "fjtirado", "createdAt": "2020-07-10T09:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2MTAzOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2MjUwNw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452662507", "bodyText": "remove?", "author": "cristianonicolai", "createdAt": "2020-07-10T07:09:46Z", "path": "kogito-codegen/src/test/java/org/kie/kogito/codegen/tests/UserTaskTest.java", "diffHunk": "@@ -135,8 +136,12 @@ public void testBasicUserTaskProcessPhases() throws Exception {\n         assertEquals(Active.ID, wi.getPhase());\n         assertEquals(Active.STATUS, wi.getPhaseStatus());\n \n-        processInstance.transitionWorkItem(workItems.get(0).getId(), new HumanTaskTransition(Complete.ID, null, securityPolicy));\n+        String workItemId = workItems.get(0).getId();\n+        assertFalse(processInstance.allowedPhases(workItemId).isEmpty());\n+        processInstance.transitionWorkItem(workItemId, new HumanTaskTransition(Complete.ID, null, securityPolicy));\n         assertThat(processInstance.status()).isEqualTo(ProcessInstance.STATE_ACTIVE);\n+        ", "originalCommit": "b3f52fffef51ff5bf98db0ca2fe4cf6dcbe002c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjczNjgyMw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/598#discussion_r452736823", "bodyText": "hmmm, this check was there for the transitionworkitem, unless wrongly specified initially, I think it should stay.", "author": "fjtirado", "createdAt": "2020-07-10T09:38:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2MjUwNw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "380a86a4bc3c32ab592791ccea81c25e9f263db0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/380a86a4bc3c32ab592791ccea81c25e9f263db0", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-10T09:40:46Z", "type": "commit"}, {"oid": "380a86a4bc3c32ab592791ccea81c25e9f263db0", "url": "https://github.com/kiegroup/kogito-runtimes/commit/380a86a4bc3c32ab592791ccea81c25e9f263db0", "message": "[KOGITO-2449] Generate endpoints for json schema\n\nDraft for schema endpoin (I have to figure unit test for this  and\nswagger documentation)\n\nIt generates two endpoints. One static that includes json schema\nwith two additional metadata (input/output) of the form\n/{processId}/{taskName}. And one\ndynamic,/{processId}/{processInstanceId}/{taskName}/{taskId}/forms,\nwhich returns the same than the static one plus an extra field called\nphases with the set of allowed phases or that task from the current\nphase.", "committedDate": "2020-07-10T09:40:46Z", "type": "forcePushed"}]}