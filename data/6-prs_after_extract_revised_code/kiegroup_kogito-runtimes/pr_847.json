{"pr_number": 847, "pr_title": "[KOGITO-3690] Fix DecisionModelResourcesProvider codegen in case of multiple DMN models", "pr_createdAt": "2020-10-23T08:18:58Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/847", "timeline": [{"oid": "ac83bb4b7cd8a932256b088a4286a067a5898e84", "url": "https://github.com/kiegroup/kogito-runtimes/commit/ac83bb4b7cd8a932256b088a4286a067a5898e84", "message": "[KOGITO-3690] Fix DecisionModelResourcesProvider codegen in case of multiple DMN models", "committedDate": "2020-10-23T08:14:29Z", "type": "commit"}, {"oid": "3e5a709d5140b6801b4f20d6c0c3f3ef9c40827c", "url": "https://github.com/kiegroup/kogito-runtimes/commit/3e5a709d5140b6801b4f20d6c0c3f3ef9c40827c", "message": "[KOGITO-3690] Fix DecisionModelResourcesProvider codegen in case of multiple DMN models", "committedDate": "2020-10-23T08:18:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyMDg0Mw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/847#discussion_r510720843", "bodyText": "Is it worth checking the add statements has different DefaultDecisionModelResource instances?\nThe old, broken way, had two adds but they were for the same instance.", "author": "manstis", "createdAt": "2020-10-23T08:28:50Z", "path": "kogito-codegen/src/test/java/org/kie/kogito/codegen/decision/DecisionModelResourcesProviderGeneratorTest.java", "diffHunk": "@@ -95,5 +108,12 @@ public void generateDecisionModelResourcesProvider() throws Exception {\n \n         final NameExpr nameExpr = call.getScope().get().asNameExpr();\n         assertEquals(nameExpr.getName().getIdentifier(), \"resourcePaths\");\n+\n+        long numberOfAddStms = body.getStatements().stream()", "originalCommit": "3e5a709d5140b6801b4f20d6c0c3f3ef9c40827c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDc4MjQ5MA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/847#discussion_r510782490", "bodyText": "Good point, done with 496d42b", "author": "danielezonca", "createdAt": "2020-10-23T10:15:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyMDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg0Mzk3NA==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/847#discussion_r510843974", "bodyText": "Sweet.", "author": "manstis", "createdAt": "2020-10-23T12:19:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDcyMDg0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "496d42bb9e6b5495dae2546b8e1d9b8e9c929243", "chunk": "diff --git a/kogito-codegen/src/test/java/org/kie/kogito/codegen/decision/DecisionModelResourcesProviderGeneratorTest.java b/kogito-codegen/src/test/java/org/kie/kogito/codegen/decision/DecisionModelResourcesProviderGeneratorTest.java\nindex fbf257070d..e4e50d01d9 100644\n--- a/kogito-codegen/src/test/java/org/kie/kogito/codegen/decision/DecisionModelResourcesProviderGeneratorTest.java\n+++ b/kogito-codegen/src/test/java/org/kie/kogito/codegen/decision/DecisionModelResourcesProviderGeneratorTest.java\n\n@@ -110,10 +115,28 @@ public class DecisionModelResourcesProviderGeneratorTest {\n         assertEquals(nameExpr.getName().getIdentifier(), \"resourcePaths\");\n \n         long numberOfAddStms = body.getStatements().stream()\n-                .filter(stm -> stm.isExpressionStmt() &&\n-                        stm.asExpressionStmt().getExpression().isMethodCallExpr() &&\n-                        \"add\".equals(stm.asExpressionStmt().getExpression().asMethodCallExpr().getName().getIdentifier()))\n+                .filter(this::isAddStatement)\n                 .count();\n         assertEquals(numberOfModels, numberOfAddStms);\n+\n+        List<NodeList<Expression>> defaultDecisionModelResources = body.getStatements().stream()\n+                .filter(this::isAddStatement)\n+                .map(stm -> stm.asExpressionStmt().getExpression().asMethodCallExpr().getArguments())\n+                .collect(toList());\n+\n+        // verify .add(..) number of parameters\n+        defaultDecisionModelResources.forEach(nodeList -> assertEquals(1, nodeList.size()));\n+\n+        Set<String> distinctDefaultDecisionModelResources = defaultDecisionModelResources.stream()\n+                .map(nodeList -> nodeList.get(0).toString())\n+                .collect(toSet());\n+\n+        assertEquals(defaultDecisionModelResources.size(), distinctDefaultDecisionModelResources.size());\n+    }\n+\n+    private boolean isAddStatement(Statement stm) {\n+        return stm.isExpressionStmt() &&\n+                stm.asExpressionStmt().getExpression().isMethodCallExpr() &&\n+                \"add\".equals(stm.asExpressionStmt().getExpression().asMethodCallExpr().getName().getIdentifier());\n     }\n }\n"}}, {"oid": "496d42bb9e6b5495dae2546b8e1d9b8e9c929243", "url": "https://github.com/kiegroup/kogito-runtimes/commit/496d42bb9e6b5495dae2546b8e1d9b8e9c929243", "message": "[KOGITO-3690] Improve test coverage", "committedDate": "2020-10-23T10:14:56Z", "type": "commit"}, {"oid": "640f30b1b7ed445a5206978c349829e34b223f04", "url": "https://github.com/kiegroup/kogito-runtimes/commit/640f30b1b7ed445a5206978c349829e34b223f04", "message": "[KOGITO-3690] Fix code smell", "committedDate": "2020-10-23T11:18:48Z", "type": "commit"}]}