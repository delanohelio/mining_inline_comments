{"pr_number": 275, "pr_title": "bring back removed persistence generator for kogito maven plugin", "pr_createdAt": "2020-01-07T14:25:56Z", "pr_url": "https://github.com/kiegroup/kogito-runtimes/pull/275", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwMjAxMQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/275#discussion_r363802011", "bodyText": "SonarCloud has noticed:\nFrom drools:\n@deprecated will be remove after the next release, please create an instance yourself\npublic static JavaCompilerFactory getInstance() {\n\nThough it has been there for ~9 years or even more, so not sure if it is relevant. But it would be better to not use deprecated methods in new code.", "author": "MarianMacik", "createdAt": "2020-01-07T15:26:31Z", "path": "kogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/ProcessClassesMojo.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Copyright 2019 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.kogito.maven.plugin;\n+\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+import java.net.URL;\n+import java.net.URLClassLoader;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.drools.compiler.commons.jci.compilers.CompilationResult;\n+import org.drools.compiler.commons.jci.compilers.JavaCompiler;\n+import org.drools.compiler.commons.jci.compilers.JavaCompilerFactory;\n+import org.drools.compiler.commons.jci.compilers.JavaCompilerSettings;\n+import org.drools.compiler.compiler.io.memory.MemoryFileSystem;\n+import org.drools.compiler.rule.builder.dialect.java.JavaDialectConfiguration;\n+import org.kie.kogito.Model;\n+import org.kie.kogito.codegen.ApplicationGenerator;\n+import org.kie.kogito.codegen.GeneratedFile;\n+import org.kie.kogito.codegen.process.persistence.PersistenceGenerator;\n+import org.kie.kogito.codegen.process.persistence.proto.ReflectionProtoGenerator;\n+import org.kie.kogito.process.ProcessInstancesFactory;\n+import org.reflections.Reflections;\n+import org.reflections.util.ConfigurationBuilder;\n+\n+@Mojo(name = \"process-model-classes\",\n+      requiresDependencyResolution = ResolutionScope.RUNTIME,\n+      requiresProject = true,\n+      defaultPhase = LifecyclePhase.PROCESS_CLASSES)\n+public class ProcessClassesMojo extends AbstractKieMojo {\n+    \n+    @SuppressWarnings(\"deprecation\")\n+    private static final JavaCompiler JAVA_COMPILER = JavaCompilerFactory.getInstance().loadCompiler(JavaDialectConfiguration.CompilerType.NATIVE, \"1.8\");", "originalCommit": "2b37b83a942e2ccdb597cf882cdfa76e977144ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDE5Nzc5Nw==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/275#discussion_r364197797", "bodyText": "@MarianMacik updated, hope this time will be good", "author": "mswiderski", "createdAt": "2020-01-08T12:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwMjAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI0NTY2OQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/275#discussion_r364245669", "bodyText": "In the end Mario decided to make it a singleton using enum and leave that method, so you can revert back. Sorry for the confusion :) But at least we dismissed the deprecation which shouldn't have been there.", "author": "MarianMacik", "createdAt": "2020-01-08T14:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwMjAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI1MzA3MQ==", "url": "https://github.com/kiegroup/kogito-runtimes/pull/275#discussion_r364253071", "bodyText": "reverted", "author": "mswiderski", "createdAt": "2020-01-08T14:19:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzgwMjAxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "e421d24983bb35c4b444c3cf6380284132736690", "chunk": "diff --git a/kogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/ProcessClassesMojo.java b/kogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/ProcessClassesMojo.java\nindex ac0c4d19bb..81b529b373 100644\n--- a/kogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/ProcessClassesMojo.java\n+++ b/kogito-maven-plugin/src/main/java/org/kie/kogito/maven/plugin/ProcessClassesMojo.java\n\n@@ -57,9 +57,8 @@ import org.reflections.util.ConfigurationBuilder;\n       requiresProject = true,\n       defaultPhase = LifecyclePhase.PROCESS_CLASSES)\n public class ProcessClassesMojo extends AbstractKieMojo {\n-    \n-    @SuppressWarnings(\"deprecation\")\n-    private static final JavaCompiler JAVA_COMPILER = JavaCompilerFactory.getInstance().loadCompiler(JavaDialectConfiguration.CompilerType.NATIVE, \"1.8\");\n+        \n+    private static final JavaCompiler JAVA_COMPILER = new JavaCompilerFactory().loadCompiler(JavaDialectConfiguration.CompilerType.NATIVE, \"1.8\");\n \n \n     @Parameter(defaultValue = \"${project}\", readonly = true, required = true)\n"}}, {"oid": "e421d24983bb35c4b444c3cf6380284132736690", "url": "https://github.com/kiegroup/kogito-runtimes/commit/e421d24983bb35c4b444c3cf6380284132736690", "message": "bring back removed persistence generator for kogito maven plugin", "committedDate": "2020-01-08T12:01:34Z", "type": "forcePushed"}, {"oid": "7577d853010eabd88571c66ef951ac3d81fce409", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7577d853010eabd88571c66ef951ac3d81fce409", "message": "bring back removed persistence generator for kogito maven plugin", "committedDate": "2020-01-08T14:18:20Z", "type": "commit"}, {"oid": "7577d853010eabd88571c66ef951ac3d81fce409", "url": "https://github.com/kiegroup/kogito-runtimes/commit/7577d853010eabd88571c66ef951ac3d81fce409", "message": "bring back removed persistence generator for kogito maven plugin", "committedDate": "2020-01-08T14:18:20Z", "type": "forcePushed"}]}