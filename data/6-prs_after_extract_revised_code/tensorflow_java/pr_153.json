{"pr_number": 153, "pr_title": "[TypeRefact] Added `Shaped` interface shared across different containers", "pr_createdAt": "2020-11-19T02:37:15Z", "pr_url": "https://github.com/tensorflow/java/pull/153", "timeline": [{"oid": "ff45e77e50eacf30e41f3797847f9a6a1e260097", "url": "https://github.com/tensorflow/java/commit/ff45e77e50eacf30e41f3797847f9a6a1e260097", "message": "Added `Shaped` interface shared across different containers", "committedDate": "2020-11-19T02:30:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5MTMyMQ==", "url": "https://github.com/tensorflow/java/pull/153#discussion_r527691321", "bodyText": "Perhaps while changing this line, get rid of the extraneous toString()?", "author": "deansher", "createdAt": "2020-11-20T13:30:45Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/nn/SigmoidCrossEntropyWithLogits.java", "diffHunk": "@@ -63,11 +63,11 @@\n   @Endpoint(name = \"sigmoidCrossEntropyWithLogits\")\n   public static <T extends TNumber> Operand<T> sigmoidCrossEntropyWithLogits(\n       Scope scope, Operand<T> labels, Operand<T> logits) {\n-    if (!isCompatible(labels.asOutput().shape(), logits.asOutput().shape())) {\n+    if (!isCompatible(labels.shape(), logits.shape())) {\n       throw new IllegalArgumentException(\n           String.format(\n               \"logits and labels must have the same shape (%s vs %s)\",\n-              labels.asOutput().shape().toString(), logits.asOutput().shape()));\n+              labels.shape().toString(), logits.shape()));", "originalCommit": "ff45e77e50eacf30e41f3797847f9a6a1e260097", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8a58b9c9fae10a0d0c1d4e893768dd585c27b72d", "chunk": "diff --git a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/nn/SigmoidCrossEntropyWithLogits.java b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/nn/SigmoidCrossEntropyWithLogits.java\nindex cfb9663f..e823ed9f 100644\n--- a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/nn/SigmoidCrossEntropyWithLogits.java\n+++ b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/nn/SigmoidCrossEntropyWithLogits.java\n\n@@ -67,7 +67,7 @@ public class SigmoidCrossEntropyWithLogits {\n       throw new IllegalArgumentException(\n           String.format(\n               \"logits and labels must have the same shape (%s vs %s)\",\n-              labels.shape().toString(), logits.shape()));\n+              labels.shape(), logits.shape()));\n     }\n     scope = scope.withSubScope(\"SigmoidCrossEntropyWithLogits\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5NDE3OA==", "url": "https://github.com/tensorflow/java/pull/153#discussion_r527694178", "bodyText": "Perhaps add some override-specific documentation explaining that this returns the shape of the Output rather than the shape of a resulting eager-mode tensor?", "author": "deansher", "createdAt": "2020-11-20T13:36:03Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Operand.java", "diffHunk": "@@ -76,4 +78,9 @@\n   default T data() {\n     return asOutput().tensor().data();\n   }\n+\n+  @Override\n+  default Shape shape() {", "originalCommit": "ff45e77e50eacf30e41f3797847f9a6a1e260097", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8a58b9c9fae10a0d0c1d4e893768dd585c27b72d", "chunk": "diff --git a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Operand.java b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Operand.java\nindex bf999c93..3f13e100 100644\n--- a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Operand.java\n+++ b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Operand.java\n\n@@ -79,6 +79,9 @@ public interface Operand<T extends TType> extends Op, Shaped {\n     return asOutput().tensor().data();\n   }\n \n+  /**\n+   * Returns the (possibly partially known) shape of the tensor referred to by the {@link Output} of this operand.\n+   */\n   @Override\n   default Shape shape() {\n     return asOutput().shape();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5ODQyMg==", "url": "https://github.com/tensorflow/java/pull/153#discussion_r527698422", "bodyText": "Even though this method now overrides a method of Operand, perhaps still carry over the class-specific documentation that has the reminder (possibly partially known)?", "author": "deansher", "createdAt": "2020-11-20T13:43:40Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Output.java", "diffHunk": "@@ -84,6 +80,11 @@ public Shape shape() {\n     return (Tensor<T>) operation.tensor(index);\n   }\n \n+  @Override\n+  public Shape shape() {", "originalCommit": "ff45e77e50eacf30e41f3797847f9a6a1e260097", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8a58b9c9fae10a0d0c1d4e893768dd585c27b72d", "chunk": "diff --git a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Output.java b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Output.java\nindex ec0a4f09..f7977c78 100644\n--- a/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Output.java\n+++ b/tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Output.java\n\n@@ -80,6 +80,9 @@ public final class Output<T extends TType> implements Operand<T> {\n     return (Tensor<T>) operation.tensor(index);\n   }\n \n+  /**\n+   * Returns the (possibly partially known) shape of the tensor referred to by this output.\n+   */\n   @Override\n   public Shape shape() {\n     return operation.shape(index);\n"}}, {"oid": "8a58b9c9fae10a0d0c1d4e893768dd585c27b72d", "url": "https://github.com/tensorflow/java/commit/8a58b9c9fae10a0d0c1d4e893768dd585c27b72d", "message": "Override default Javadoc for `shape()`", "committedDate": "2020-11-20T16:38:11Z", "type": "commit"}]}