{"pr_number": 755, "pr_title": "Fix NPE in Reaper", "pr_createdAt": "2020-04-14T07:29:37Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/755", "timeline": [{"oid": "c20e4a20d70a1b7c4396cbccb8dfb24060665208", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/c20e4a20d70a1b7c4396cbccb8dfb24060665208", "message": "Fix NPE in Reaper", "committedDate": "2020-04-14T07:29:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA0OTE3OA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/755#discussion_r408049178", "bodyText": "Under which circumstances would either of these be null?\nYou can use java.util.Objects.equals BTW.", "author": "jglick", "createdAt": "2020-04-14T10:59:19Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pod/retention/Reaper.java", "diffHunk": "@@ -139,7 +140,7 @@ public void eventReceived(Watcher.Action action, Pod pod) {\n                         continue;\n                     }\n                     KubernetesSlave ks = (KubernetesSlave) n;\n-                    if (ks.getNamespace().equals(ns) && ks.getPodName().equals(name)) {\n+                    if (StringUtils.equals(ks.getNamespace(), ns) && StringUtils.equals(ks.getPodName(), name)) {", "originalCommit": "c20e4a20d70a1b7c4396cbccb8dfb24060665208", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc5MjA3Nw==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/755#discussion_r408792077", "bodyText": "I think there can be a race condition between Reaper and KubernetesLauncher. In particular, namespace is not set immediately when KubernetesSlave is created. And i've definitely seen occurrences of the NPE when launching a lot of agents concurrently.", "author": "Vlatombe", "createdAt": "2020-04-15T12:08:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODA0OTE3OA=="}], "type": "inlineReview", "revised_code": {"commit": "ab252458b143bc86a7e1d82eb9a5da32aca562b6", "chunk": "diff --git a/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pod/retention/Reaper.java b/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pod/retention/Reaper.java\nindex 14af619e..255b56a9 100644\n--- a/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pod/retention/Reaper.java\n+++ b/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pod/retention/Reaper.java\n\n@@ -140,7 +140,7 @@ public class Reaper extends ComputerListener implements Watcher<Pod> {\n                         continue;\n                     }\n                     KubernetesSlave ks = (KubernetesSlave) n;\n-                    if (StringUtils.equals(ks.getNamespace(), ns) && StringUtils.equals(ks.getPodName(), name)) {\n+                    if (Objects.equals(ks.getNamespace(), ns) && Objects.equals(ks.getPodName(), name)) {\n                         LOGGER.info(() -> ns + \"/\" + name + \" was just deleted, so removing corresponding Jenkins agent\");\n                         try {\n                             jenkins.removeNode(ks);\n"}}, {"oid": "ab252458b143bc86a7e1d82eb9a5da32aca562b6", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/ab252458b143bc86a7e1d82eb9a5da32aca562b6", "message": "Use Objects.equals instead", "committedDate": "2020-04-15T12:06:39Z", "type": "commit"}]}