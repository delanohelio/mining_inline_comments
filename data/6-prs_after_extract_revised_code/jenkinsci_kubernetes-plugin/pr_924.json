{"pr_number": 924, "pr_title": "[JENKINS-62502] `ContainerExecDecorator` should escape double quotes", "pr_createdAt": "2020-12-23T14:26:07Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/924", "timeline": [{"oid": "cf7ad805ef85cd06f5d56d810b417aa82de37bb3", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/cf7ad805ef85cd06f5d56d810b417aa82de37bb3", "message": "[JENKINS-62502] ContainerExecDecorator should escape double quotes", "committedDate": "2020-12-23T14:25:15Z", "type": "commit"}, {"oid": "65526f657dc39383b559275aa82bc68e691cbc09", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/65526f657dc39383b559275aa82bc68e691cbc09", "message": "Merge branch 'master' into JENKINS-62502", "committedDate": "2021-01-11T09:18:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTEyMjEyOQ==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/924#discussion_r555122129", "bodyText": ":groan:\n@kerogers-cloudbees you were also looking at this code IIRC?", "author": "jglick", "createdAt": "2021-01-11T15:21:57Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/ContainerExecDecorator.java", "diffHunk": "@@ -653,7 +653,8 @@ private static void doExec(PrintStream in, PrintStream out, boolean[] masks, Str\n \n         // BourneShellScript.launchWithCookie escapes $ as $$, we convert it to \\$\n         for (String cmd : starter.cmds()) {\n-            String fixedCommand = cmd.replaceAll(\"\\\\$\\\\$\", \"\\\\\\\\\\\\$\");\n+            String fixedCommand = cmd.replaceAll(\"\\\\$\\\\$\", \"\\\\\\\\\\\\$\")\n+                    .replaceAll(\"\\\\\\\"\", \"\\\\\\\\\\\"\");", "originalCommit": "65526f657dc39383b559275aa82bc68e691cbc09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTIwOTU0Ng==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/924#discussion_r555209546", "bodyText": "I was looking at this, but I ended up not doing anything with it yet because this where the commands are edited, not the env vars.\nFWIW I do think using Matcher.quoteReplacement(\"\\\\$\") is easier to read than \"\\\\\\\\\\\\$", "author": "kerogers-cloudbees", "createdAt": "2021-01-11T17:16:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTEyMjEyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "bc9cec7f341145d8d18d012f0cdfa0616d1bb4ae", "chunk": "diff --git a/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/ContainerExecDecorator.java b/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/ContainerExecDecorator.java\nindex 2c0b41c2..1827b78c 100755\n--- a/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/ContainerExecDecorator.java\n+++ b/src/main/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/ContainerExecDecorator.java\n\n@@ -653,8 +654,8 @@ public class ContainerExecDecorator extends LauncherDecorator implements Seriali\n \n         // BourneShellScript.launchWithCookie escapes $ as $$, we convert it to \\$\n         for (String cmd : starter.cmds()) {\n-            String fixedCommand = cmd.replaceAll(\"\\\\$\\\\$\", \"\\\\\\\\\\\\$\")\n-                    .replaceAll(\"\\\\\\\"\", \"\\\\\\\\\\\"\");\n+            String fixedCommand = cmd.replaceAll(\"\\\\$\\\\$\", Matcher.quoteReplacement(\"\\\\$\"))\n+                    .replaceAll(\"\\\\\\\"\", Matcher.quoteReplacement(\"\\\\\\\"\"));\n \n             String oldRemoteDir = null;\n             FilePath oldRemoteDirFilepath = starter.pwd();\n"}}, {"oid": "bc9cec7f341145d8d18d012f0cdfa0616d1bb4ae", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/bc9cec7f341145d8d18d012f0cdfa0616d1bb4ae", "message": "Use Matcher.quoteReplacement for a bit better legibility", "committedDate": "2021-01-14T13:30:00Z", "type": "commit"}, {"oid": "3f63d590e71320d8c4f43eae3e8789d333c808c1", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/3f63d590e71320d8c4f43eae3e8789d333c808c1", "message": "Merge branch 'master' into JENKINS-62502", "committedDate": "2021-01-15T09:09:11Z", "type": "commit"}]}