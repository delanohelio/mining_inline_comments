{"pr_number": 750, "pr_title": "Prevent NPE when null set in container's volume mounts", "pr_createdAt": "2020-04-04T18:01:28Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/750", "timeline": [{"oid": "3796eddb72852df34962e2315bf34ccf75c600e0", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/3796eddb72852df34962e2315bf34ccf75c600e0", "message": "Prevent NPE when null set in container's volume mounts\n\nSigned-off-by: arjantijms <arjan.tijms@gmail.com>", "committedDate": "2020-04-04T17:52:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwODI3MA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/750#discussion_r403508270", "bodyText": "Or we could just check v != null here, right?", "author": "jglick", "createdAt": "2020-04-04T19:36:39Z", "path": "src/main/java/org/csanchez/jenkins/plugins/kubernetes/PodTemplateBuilder.java", "diffHunk": "@@ -256,6 +256,12 @@ public Pod build() {\n         if (jnlp.getResources() == null) {\n             jnlp.setResources(new ContainerBuilder().editOrNewResources().addToRequests(\"cpu\", new Quantity(\"100m\")).addToRequests(\"memory\", new Quantity(\"256Mi\")).endResources().build().getResources());\n         }\n+        \n+        // If the volume mounts of any container has been set to null, set it to empty list.\n+        // Without this being done the code below would throw a NPE if such null existed.\n+        pod.getSpec().getContainers().stream()\n+               .filter(c -> c.getVolumeMounts() == null)\n+               .forEach(c -> c.setVolumeMounts(new ArrayList<>()));\n \n         // default workspace volume, add an empty volume to share the workspace across the pod\n         if (pod.getSpec().getVolumes().stream().noneMatch(v -> WORKSPACE_VOLUME_NAME.equals(v.getName()))) {", "originalCommit": "3796eddb72852df34962e2315bf34ccf75c600e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUxMDYyMA==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/750#discussion_r403510620", "bodyText": "At line 273 c.getVolumeMounts().stream() will then still throw a NPE. If you check that for null as well, then it will prevent the NPE, but not add the default volume mount as intended.", "author": "arjantijms", "createdAt": "2020-04-04T20:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwODI3MA=="}], "type": "inlineReview", "revised_code": null}]}