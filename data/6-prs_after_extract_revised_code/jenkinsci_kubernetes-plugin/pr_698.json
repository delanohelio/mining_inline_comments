{"pr_number": 698, "pr_title": "[JENKINS-60886] Add podRetention attribute to Kubernetes Declarative Agent", "pr_createdAt": "2020-01-29T12:17:16Z", "pr_url": "https://github.com/jenkinsci/kubernetes-plugin/pull/698", "timeline": [{"oid": "af1e9c1648655e16dc107250b4463d03fcdf2daf", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/af1e9c1648655e16dc107250b4463d03fcdf2daf", "message": "[JENKINS-60886] Add podRetention attribute to Kubernetes Declarative Agent", "committedDate": "2020-01-29T12:16:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM4MTE1Ng==", "url": "https://github.com/jenkinsci/kubernetes-plugin/pull/698#discussion_r372381156", "bodyText": "Could you merge this test with declarative ? Each new Jenkins-based test adds a time overhead.", "author": "Vlatombe", "createdAt": "2020-01-29T13:29:28Z", "path": "src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentTest.java", "diffHunk": "@@ -152,4 +153,18 @@ public void declarativeWithNestedExplicitInheritance() throws Exception {\n         r.assertLogContains(\"Apache Maven 3.3.9\", b);\n         r.assertLogNotContains(\"go version go1.6.3\", b);\n     }\n+\n+    @Issue(\"JENKINS-60886\")\n+    @Test\n+    public void declarativeWithPodRetention() throws Exception {", "originalCommit": "af1e9c1648655e16dc107250b4463d03fcdf2daf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e11402fee17d0290ae98ca94e5a185347a3058a8", "chunk": "diff --git a/src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentTest.java b/src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentTest.java\nindex a43041fe..5ebe4498 100644\n--- a/src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentTest.java\n+++ b/src/test/java/org/csanchez/jenkins/plugins/kubernetes/pipeline/KubernetesDeclarativeAgentTest.java\n\n@@ -153,18 +157,4 @@ public class KubernetesDeclarativeAgentTest extends AbstractKubernetesPipelineTe\n         r.assertLogContains(\"Apache Maven 3.3.9\", b);\n         r.assertLogNotContains(\"go version go1.6.3\", b);\n     }\n-\n-    @Issue(\"JENKINS-60886\")\n-    @Test\n-    public void declarativeWithPodRetention() throws Exception {\n-        assertNotNull(createJobThenScheduleRun());\n-        r.assertBuildStatusSuccess(r.waitForCompletion(b));\n-        r.assertLogContains(\"Apache Maven 3.3.9\", b);\n-        FlowNode podTemplateNode = new DepthFirstScanner().findFirstMatch(b.getExecution(), Predicates.and(new NodeStepTypePredicate(\"podTemplate\"), FlowScanningUtils.hasActionPredicate(ArgumentsAction.class)));\n-        assertNotNull(\"recorded arguments for podTemplate\", podTemplateNode);\n-        Map<String, Object> arguments = podTemplateNode.getAction(ArgumentsAction.class).getArguments();\n-        UninstantiatedDescribable podRetention = (UninstantiatedDescribable) arguments.get(\"podRetention\");\n-        assertNotNull(podRetention);\n-        assertTrue(\"no junk in arguments: \" + podRetention.getModel().getType(), podRetention.getModel().getType().equals(OnFailure.class));\n-    }\n }\n"}}, {"oid": "e11402fee17d0290ae98ca94e5a185347a3058a8", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/e11402fee17d0290ae98ca94e5a185347a3058a8", "message": "[JENKINS-60886] Consolidate test in declarative()", "committedDate": "2020-01-30T00:08:40Z", "type": "commit"}, {"oid": "51576f3e7ffc3061f8dbf2d8084ab55a45ea7d53", "url": "https://github.com/jenkinsci/kubernetes-plugin/commit/51576f3e7ffc3061f8dbf2d8084ab55a45ea7d53", "message": "[JENKINS-60886] Cleanup file", "committedDate": "2020-01-30T00:18:32Z", "type": "commit"}]}