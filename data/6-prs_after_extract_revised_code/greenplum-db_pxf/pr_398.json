{"pr_number": 398, "pr_title": "Spring boot Performance", "pr_createdAt": "2020-06-30T15:51:59Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/398", "timeline": [{"oid": "d0a2ff6a1b6cd6c586ae0e0393d113b351760a9c", "url": "https://github.com/greenplum-db/pxf/commit/d0a2ff6a1b6cd6c586ae0e0393d113b351760a9c", "message": "Add more information for performance testing", "committedDate": "2020-06-26T20:50:47Z", "type": "commit"}, {"oid": "943eaed41d51d8a062b19835b98f27f6fac46947", "url": "https://github.com/greenplum-db/pxf/commit/943eaed41d51d8a062b19835b98f27f6fac46947", "message": "set connection-timeout to -1", "committedDate": "2020-06-26T20:58:46Z", "type": "commit"}, {"oid": "4ef9ce22919f4a36a90a849cbd28517aa387b8e4", "url": "https://github.com/greenplum-db/pxf/commit/4ef9ce22919f4a36a90a849cbd28517aa387b8e4", "message": "120s for connection timeout", "committedDate": "2020-06-29T20:32:57Z", "type": "commit"}, {"oid": "6731b6beee011662655962faec1b0db7bf9ae5b4", "url": "https://github.com/greenplum-db/pxf/commit/6731b6beee011662655962faec1b0db7bf9ae5b4", "message": " 120s -> 240s", "committedDate": "2020-06-30T01:08:30Z", "type": "commit"}, {"oid": "c5856dd5109e3def529dddbf95d6eede535243bc", "url": "https://github.com/greenplum-db/pxf/commit/c5856dd5109e3def529dddbf95d6eede535243bc", "message": "600s", "committedDate": "2020-06-30T10:49:15Z", "type": "commit"}, {"oid": "f54380bac9a19fd716a4607ea5a8dccd91b3d36a", "url": "https://github.com/greenplum-db/pxf/commit/f54380bac9a19fd716a4607ea5a8dccd91b3d36a", "message": "600s -> 10m", "committedDate": "2020-06-30T15:08:23Z", "type": "commit"}, {"oid": "b76f640de7bd084f323bb353aef5fba18f007c10", "url": "https://github.com/greenplum-db/pxf/commit/b76f640de7bd084f323bb353aef5fba18f007c10", "message": "fix typo", "committedDate": "2020-06-30T15:48:22Z", "type": "commit"}, {"oid": "d65d7ddfa21849ccaae894e94dee01a3a9cf7586", "url": "https://github.com/greenplum-db/pxf/commit/d65d7ddfa21849ccaae894e94dee01a3a9cf7586", "message": "Graceful shutdown", "committedDate": "2020-06-30T16:33:53Z", "type": "commit"}, {"oid": "e4292b34ff1d296b1940a80dac208930d679dd62", "url": "https://github.com/greenplum-db/pxf/commit/e4292b34ff1d296b1940a80dac208930d679dd62", "message": "10m -> 5m", "committedDate": "2020-06-30T16:46:44Z", "type": "commit"}, {"oid": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "url": "https://github.com/greenplum-db/pxf/commit/b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "message": "Use PXF_CONNECTION_TIMEOUT to tune the connection timeout", "committedDate": "2020-06-30T19:15:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTcwMw==", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448629703", "bodyText": "wonder, should we still log at WARN level here to be consistent. Extra context if debug is on is ok.", "author": "denalex", "createdAt": "2020-07-01T21:38:05Z", "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java", "diffHunk": "@@ -77,9 +77,9 @@ private Void writeToInternal(OutputStream out) throws IOException {\n             // Occurs whenever client (GPDB) decides to end the connection\n             if (LOG.isDebugEnabled()) {\n                 // Stacktrace in debug\n-                LOG.debug(\"Remote connection closed by GPDB\", e);\n+                LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), e);", "originalCommit": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzNTgxNw==", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448635817", "bodyText": "good point", "author": "frankgh", "createdAt": "2020-07-01T21:53:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTcwMw=="}], "type": "inlineReview", "revised_code": {"commit": "607bee17bd054d4cc22410f02b631b9a31793de9", "chunk": "diff --git a/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java b/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java\nindex 0c705add..b0540846 100644\n--- a/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java\n+++ b/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/BridgeResponse.java\n\n@@ -77,7 +77,7 @@ public class BridgeResponse implements StreamingResponseBody {\n             // Occurs whenever client (GPDB) decides to end the connection\n             if (LOG.isDebugEnabled()) {\n                 // Stacktrace in debug\n-                LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), e);\n+                LOG.warn(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), e);\n             } else {\n                 LOG.warn(\"Remote connection closed by GPDB (segment {}) (Enable debug for stacktrace)\", context.getSegmentId());\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyOTkwNw==", "url": "https://github.com/greenplum-db/pxf/pull/398#discussion_r448629907", "bodyText": "same question about WARN level.", "author": "denalex", "createdAt": "2020-07-01T21:38:39Z", "path": "server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java", "diffHunk": "@@ -160,9 +160,9 @@ public WritableResource(BridgeFactory bridgeFactory, SecurityService securitySer\n                 // Occurs whenever client (GPDB) decides to end the connection\n                 if (LOG.isDebugEnabled()) {\n                     // Stacktrace in debug\n-                    LOG.debug(\"Remote connection closed by GPDB\", cae);\n+                    LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), cae);", "originalCommit": "b4e4357e7ab3aba74b65cb89f8f60b7640d95223", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "607bee17bd054d4cc22410f02b631b9a31793de9", "chunk": "diff --git a/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java b/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java\nindex 4c60638a..2963da80 100644\n--- a/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java\n+++ b/server/pxf-service/src/main/java/org/greenplum/pxf/service/rest/WritableResource.java\n\n@@ -160,7 +160,7 @@ public class WritableResource extends BaseResource {\n                 // Occurs whenever client (GPDB) decides to end the connection\n                 if (LOG.isDebugEnabled()) {\n                     // Stacktrace in debug\n-                    LOG.debug(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), cae);\n+                    LOG.warn(String.format(\"Remote connection closed by GPDB (segment %s)\", context.getSegmentId()), cae);\n                 } else {\n                     LOG.warn(\"Remote connection closed by GPDB (segment {}) (Enable debug for stacktrace)\", context.getSegmentId());\n                 }\n"}}, {"oid": "f746932de44b791536fdb60e86e10af500896b76", "url": "https://github.com/greenplum-db/pxf/commit/f746932de44b791536fdb60e86e10af500896b76", "message": "Update server/pxf-service/src/scripts/pxf\n\nCo-authored-by: Alexander Denissov <denalex@users.noreply.github.com>", "committedDate": "2020-07-01T21:56:59Z", "type": "commit"}, {"oid": "607bee17bd054d4cc22410f02b631b9a31793de9", "url": "https://github.com/greenplum-db/pxf/commit/607bee17bd054d4cc22410f02b631b9a31793de9", "message": "Address PR feedback", "committedDate": "2020-07-01T21:58:52Z", "type": "commit"}, {"oid": "6ee91fee0e64c611657b7cf350783256ed9486ca", "url": "https://github.com/greenplum-db/pxf/commit/6ee91fee0e64c611657b7cf350783256ed9486ca", "message": "Address PR feedback. Add SPRING_LIFECYCLE_TIMEOUT_PER_SHUTDOWN_PHASE variable in pxf-env", "committedDate": "2020-07-01T22:14:30Z", "type": "commit"}, {"oid": "f8a88a602e787b62d326b86095a75d6978585034", "url": "https://github.com/greenplum-db/pxf/commit/f8a88a602e787b62d326b86095a75d6978585034", "message": "remove enabling graceful shutdown", "committedDate": "2020-07-01T22:28:52Z", "type": "commit"}]}