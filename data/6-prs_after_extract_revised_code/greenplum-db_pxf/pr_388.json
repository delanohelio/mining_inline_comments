{"pr_number": 388, "pr_title": "Migrate pxf-hive to Spring Boot", "pr_createdAt": "2020-06-18T22:14:56Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/388", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzOTEzNw==", "url": "https://github.com/greenplum-db/pxf/pull/388#discussion_r442539137", "bodyText": "what if it is a subclass, does it need configuration also ? ideally should check class-level isAssignableFrom but this is existing code, I guess, so no need to change.", "author": "denalex", "createdAt": "2020-06-18T22:39:44Z", "path": "server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/utilities/HiveUtilities.java", "diffHunk": "@@ -115,25 +110,27 @@\n     }\n \n     /**\n-     * Verifies modifiers are null or integers.\n-     * Modifier is a value assigned to a type,\n-     * e.g. size of a varchar - varchar(size).\n+     * Creates the partition InputFormat.\n      *\n-     * @param modifiers type modifiers to be verified\n-     * @return whether modifiers are null or integers\n+     * @param inputFormatName input format class name\n+     * @param jobConf         configuration data for the Hadoop framework\n+     * @return a {@link org.apache.hadoop.mapred.InputFormat} derived object\n+     * @throws Exception if failed to create input format\n      */\n-    private static boolean verifyIntegerModifiers(String[] modifiers) {\n-        if (modifiers == null) {\n-            return true;\n-        }\n-        for (String modifier : modifiers) {\n-            if (StringUtils.isBlank(modifier) || !StringUtils.isNumeric(modifier)) {\n-                return false;\n-            }\n+    public InputFormat<?, ?> makeInputFormat(String inputFormatName,\n+                                             JobConf jobConf)\n+            throws Exception {\n+        Class<?> c = Class.forName(inputFormatName, true,\n+                JavaUtils.getClassLoader());\n+        InputFormat<?, ?> inputFormat = (InputFormat<?, ?>) c.getDeclaredConstructor().newInstance();\n+\n+        if (\"org.apache.hadoop.mapred.TextInputFormat\".equals(inputFormatName)) {\n+            // TextInputFormat needs a special configuration\n+            ((TextInputFormat) inputFormat).configure(jobConf);", "originalCommit": "fa4094f20ae35f9e401f8a43dc97faf940519b90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4MDEzOA==", "url": "https://github.com/greenplum-db/pxf/pull/388#discussion_r442580138", "bodyText": "We can change it I guess", "author": "frankgh", "createdAt": "2020-06-19T01:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzOTEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4MzU4NA==", "url": "https://github.com/greenplum-db/pxf/pull/388#discussion_r442583584", "bodyText": "instead of harcoding the string , I am doing class.getName now", "author": "frankgh", "createdAt": "2020-06-19T01:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUzOTEzNw=="}], "type": "inlineReview", "revised_code": {"commit": "e07c45427c38f2f0e4897fe28996740243bd9319", "chunk": "diff --git a/server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/utilities/HiveUtilities.java b/server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/utilities/HiveUtilities.java\nindex e690d7f37..52b34e669 100644\n--- a/server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/utilities/HiveUtilities.java\n+++ b/server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/utilities/HiveUtilities.java\n\n@@ -124,7 +124,7 @@ public class HiveUtilities {\n                 JavaUtils.getClassLoader());\n         InputFormat<?, ?> inputFormat = (InputFormat<?, ?>) c.getDeclaredConstructor().newInstance();\n \n-        if (\"org.apache.hadoop.mapred.TextInputFormat\".equals(inputFormatName)) {\n+        if (TextInputFormat.class.getName().equals(inputFormatName)) {\n             // TextInputFormat needs a special configuration\n             ((TextInputFormat) inputFormat).configure(jobConf);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU0MDA5MQ==", "url": "https://github.com/greenplum-db/pxf/pull/388#discussion_r442540091", "bodyText": "what if someone in China runs this ? would their default charset be different ?", "author": "denalex", "createdAt": "2020-06-18T22:42:37Z", "path": "server/pxf-jdbc/src/main/java/org/greenplum/pxf/plugins/jdbc/JdbcAccessor.java", "diffHunk": "@@ -325,7 +326,7 @@ private String getQueryText() {\n             if (LOG.isDebugEnabled()) {\r\n                 LOG.debug(\"Reading text of query={} from {}\", queryName, queryFile.getCanonicalPath());\r\n             }\r\n-            queryText = FileUtils.readFileToString(queryFile);\r\n+            queryText = FileUtils.readFileToString(queryFile, Charset.defaultCharset());\r", "originalCommit": "fa4094f20ae35f9e401f8a43dc97faf940519b90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU4MDA5Mg==", "url": "https://github.com/greenplum-db/pxf/pull/388#discussion_r442580092", "bodyText": "FileUtils.readFileToString(String) is deprecated, so I switched to using FileUtils.readFileToString(String, Charset) with the default implementation. Effectively making no changes to the current implementation.", "author": "frankgh", "createdAt": "2020-06-19T01:12:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU0MDA5MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "cc4336b9cf32b4cd6340e388fd1dfc74e3cd424b", "url": "https://github.com/greenplum-db/pxf/commit/cc4336b9cf32b4cd6340e388fd1dfc74e3cd424b", "message": "Migrate pxf-hive to Spring Boot\n\n- Update top level build.gradle to include pxf-hive\n- Add new build.gradle for pxf-hive\n- all existing unit tests should be ported to junit 5\n- The hive group for automation is passing", "committedDate": "2020-06-18T23:13:18Z", "type": "commit"}, {"oid": "cc4336b9cf32b4cd6340e388fd1dfc74e3cd424b", "url": "https://github.com/greenplum-db/pxf/commit/cc4336b9cf32b4cd6340e388fd1dfc74e3cd424b", "message": "Migrate pxf-hive to Spring Boot\n\n- Update top level build.gradle to include pxf-hive\n- Add new build.gradle for pxf-hive\n- all existing unit tests should be ported to junit 5\n- The hive group for automation is passing", "committedDate": "2020-06-18T23:13:18Z", "type": "forcePushed"}, {"oid": "e07c45427c38f2f0e4897fe28996740243bd9319", "url": "https://github.com/greenplum-db/pxf/commit/e07c45427c38f2f0e4897fe28996740243bd9319", "message": "Address PR feedback", "committedDate": "2020-06-19T01:15:16Z", "type": "commit"}, {"oid": "261e39acf9ed5e40cc9f1022e1109833a2403b51", "url": "https://github.com/greenplum-db/pxf/commit/261e39acf9ed5e40cc9f1022e1109833a2403b51", "message": "Fix expected message for HiveTest#columnNameMismatch", "committedDate": "2020-06-19T01:21:17Z", "type": "commit"}, {"oid": "d832c9002603a4ec7c0e7c699aa59fcc04b5a371", "url": "https://github.com/greenplum-db/pxf/commit/d832c9002603a4ec7c0e7c699aa59fcc04b5a371", "message": "Remove flakiness from testMultiThreadedAccessToFragments test", "committedDate": "2020-06-19T02:13:00Z", "type": "commit"}, {"oid": "621db71bbc7af58cf04b9cf41b9ff4bdbe7926b2", "url": "https://github.com/greenplum-db/pxf/commit/621db71bbc7af58cf04b9cf41b9ff4bdbe7926b2", "message": "Improve FakeRequestParser", "committedDate": "2020-06-19T11:05:28Z", "type": "commit"}, {"oid": "8719d68ee0de96eeb2fc5c5b9106bb846e7db8eb", "url": "https://github.com/greenplum-db/pxf/commit/8719d68ee0de96eeb2fc5c5b9106bb846e7db8eb", "message": "Route java.util.logging to Log4j 2\n\nTo ensure that debug logging performed using java.util.logging is routed\ninto Log4j 2, configure its JDK logging adapter by setting the\njava.util.logging.manager system property to\norg.apache.logging.log4j.jul.LogManager.\n\nhttps://docs.spring.io/spring-boot/docs/1.5.x/reference/html/howto-logging.html#howto-configure-log4j-for-logging", "committedDate": "2020-06-19T16:03:06Z", "type": "commit"}]}