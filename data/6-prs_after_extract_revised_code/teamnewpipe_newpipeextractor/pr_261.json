{"pr_number": 261, "pr_title": "Update YouTube to material version ", "pr_createdAt": "2020-02-25T20:56:24Z", "pr_url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/261", "timeline": [{"oid": "39bf1ff1eba51a059944d9f54872f9596823f8d1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/39bf1ff1eba51a059944d9f54872f9596823f8d1", "message": "Add ytInitialData regex", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "be3e20e263a88ed63c901164e6875ddf82279210", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/be3e20e263a88ed63c901164e6875ddf82279210", "message": "Adapt most channel changes", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "7dcc9f159bb7280fd97f48af42cf5c2b3c182e27", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7dcc9f159bb7280fd97f48af42cf5c2b3c182e27", "message": "Stream: fix uploader avatar url", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "655c9997956147d2f16ef577e2c271d5ecb5d522", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/655c9997956147d2f16ef577e2c271d5ecb5d522", "message": "Detect disabled subriber count correctly\n\nFix parsing of kiosk name", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "21253abd9b6d45695198733c16e638d67e597eb8", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/21253abd9b6d45695198733c16e638d67e597eb8", "message": "Use Firefox ESR User-Agent: 68", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "b705515da06ff2ebca28bed2bb513e4f94f6a94a", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b705515da06ff2ebca28bed2bb513e4f94f6a94a", "message": "Adapt most playlist fields", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "a34e5c18e1fc838715414542d55f9e3a638bdfd9", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a34e5c18e1fc838715414542d55f9e3a638bdfd9", "message": "Trending StreamInfoItemCollecetor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "3ec422a54253e6267b6359924b7ee0c02a3b537e", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3ec422a54253e6267b6359924b7ee0c02a3b537e", "message": "Fix like/dislike parsing", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "12166ca60ce88544140e3aba1f88ff3c7356eefe", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/12166ca60ce88544140e3aba1f88ff3c7356eefe", "message": "[StreamExtractor] Add fallback method for uploader avatar url", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "7bfc0e62c665863ac3e3be0716400eca58162be2", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7bfc0e62c665863ac3e3be0716400eca58162be2", "message": "Fix getRelatedStreams() in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "127c4d589323a48c5561e39a82c6a32e51afaa7f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/127c4d589323a48c5561e39a82c6a32e51afaa7f", "message": "Fix getNextStream() in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "10e9c16d8cca05e6fa76e18667de064c38c06edc", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/10e9c16d8cca05e6fa76e18667de064c38c06edc", "message": "Fix LiveStream view count", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "f33f9466ce6a09437523e0803ff56ee59b6d1679", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f33f9466ce6a09437523e0803ff56ee59b6d1679", "message": "Fix testDescription() in ChannelExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "af49b3c48777dfb002401cc7680766312ae96a6b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/af49b3c48777dfb002401cc7680766312ae96a6b", "message": "Fix live streams in extractVideoPreviewInfo()", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "b88188d4198ec81d0d4d78c2b55a07a53a073769", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b88188d4198ec81d0d4d78c2b55a07a53a073769", "message": "Move stuff from extractVideoPreviewInfo() into YoutubeStreamInfoItemExtractor and partially fix search", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "957db062efeade07fb5c121308236a06c52fdad6", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/957db062efeade07fb5c121308236a06c52fdad6", "message": "Fix getting uploader for videoRenderer", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "38aabc6acac601b1d0343517ae0357bfcf76f9d6", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/38aabc6acac601b1d0343517ae0357bfcf76f9d6", "message": "Use plain YoutubeStreamInfoItemExtractor in YoutubeTrendingExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "5816202cc7a6d055a996f9783f701cd60cb1cbe2", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5816202cc7a6d055a996f9783f701cd60cb1cbe2", "message": "Move getInitialData() method to YouTubeParsingHelper\n\nRename ytInitialData to initialData", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "4e57e589cee1842104fcb9af2b8e1d668c304187", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4e57e589cee1842104fcb9af2b8e1d668c304187", "message": "Fix first channel page", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "316fe0109df23dd3e6db25274d85508203308090", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/316fe0109df23dd3e6db25274d85508203308090", "message": "Fix first playlist page", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "7442f91aa619a57b73ece4ca43160420585e1464", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7442f91aa619a57b73ece4ca43160420585e1464", "message": "Don't assume which channel tab is videos", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "3187116a63cda7ddc2e7f68d3571fc7f353f476e", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3187116a63cda7ddc2e7f68d3571fc7f353f476e", "message": "Handle premium videos", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "8aea4d445b62b92ffeeb7fc22b3d0af5e244e809", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8aea4d445b62b92ffeeb7fc22b3d0af5e244e809", "message": "Reimplement YoutubeChannelInfoItemExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "4462cbe3f154e8fbf08c9d5f0bb1be9febe8ee71", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4462cbe3f154e8fbf08c9d5f0bb1be9febe8ee71", "message": "Reimplement YoutubePlaylistInfoItemExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "6d20b2b1d0011f6f26adfbd02715cd3d8b7b80c6", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/6d20b2b1d0011f6f26adfbd02715cd3d8b7b80c6", "message": "Fix NPE on collecting page items", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "51fb26625a9db58de7c7647ae4461cd3c09fe98e", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/51fb26625a9db58de7c7647ae4461cd3c09fe98e", "message": "Implement getSubscriberCount() in YoutubeChannelInfoItemExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "c7360e4a468b5c657b2a95e640282d0773881156", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c7360e4a468b5c657b2a95e640282d0773881156", "message": "Fix getThumbnailUrl() in YoutubeChannelInfoItemExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "1eca63089b88e4c27c38e70fe17760cf89ab00db", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1eca63089b88e4c27c38e70fe17760cf89ab00db", "message": "Count private and deleted videos as ad", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "a38ab9b791ac118e3fbd7e33fc5d2dc9e3bb795c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a38ab9b791ac118e3fbd7e33fc5d2dc9e3bb795c", "message": "Return null if channel has no banner", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "2dfa2187ffb6c8a6a04143d2811aa9e368936fbb", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/2dfa2187ffb6c8a6a04143d2811aa9e368936fbb", "message": "Implement pagination in YoutubeChannelExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "627ab2459f90969c987e7463fcfcaf2fc93c8a10", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/627ab2459f90969c987e7463fcfcaf2fc93c8a10", "message": "Uncomment fetchPage()", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "4039409820e9a3f82f9727c25d4bb1759c8576ec", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4039409820e9a3f82f9727c25d4bb1759c8576ec", "message": "Fix getLikeCount() for certain streams", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "c0a8e0188967db4e8ae84b5f0acbe2fd61b1119c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/c0a8e0188967db4e8ae84b5f0acbe2fd61b1119c", "message": "Implement pagination in YoutubePlaylistExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "5d883d100c96233a4f068f1853e11297bb5533fe", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5d883d100c96233a4f068f1853e11297bb5533fe", "message": "Implement pagination in YoutubeSearchExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "5842b9ad37f760289f74856832e1db0076a5502e", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5842b9ad37f760289f74856832e1db0076a5502e", "message": "Add getClientVersion()  and HARDCODED_CLIENT_VERSION to YouTubeParsingHelper\n\nPrefer hardcoded client version above the current one when making requests to retrieve the same JSON structure for each request.", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "583e9c157182d05f9e8b7bbd5dae211216a7ab76", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/583e9c157182d05f9e8b7bbd5dae211216a7ab76", "message": "Fix getPage()\n\nSomeone should check if there are unstaged changes before committing...", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "dd4dd849dce1238df9a818f0e97a68282037b288", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/dd4dd849dce1238df9a818f0e97a68282037b288", "message": "Get client version dynamically in YouTubeSearchExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "02b59903fa5a3c8d0c83166862d12ecf5febf1ff", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/02b59903fa5a3c8d0c83166862d12ecf5febf1ff", "message": "Remove useless code", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "f13c0288cc0c8a94f741095bc207c0e744a3f5bf", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f13c0288cc0c8a94f741095bc207c0e744a3f5bf", "message": "Reimplement some methods in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "76d54abdbf00729c7ced10e753a13c39e11f7794", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/76d54abdbf00729c7ced10e753a13c39e11f7794", "message": "Reimplement more methods in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "26ea3dceb6ea696b09a018f009c14d9cbe210d4d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/26ea3dceb6ea696b09a018f009c14d9cbe210d4d", "message": "Fix getViewCount() in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "f39603f6ef75dbdcde341b723868c89f086e8d6c", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f39603f6ef75dbdcde341b723868c89f086e8d6c", "message": "Implement getUploadDate() in YouTubeStreamInfoItemExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "9efcc61ca6ed25499d4367f8ff95c34ea8db6047", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/9efcc61ca6ed25499d4367f8ff95c34ea8db6047", "message": "Adapt some tests to match the new URLs", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "eed29ea734ae3008d80f5754ca2cab7eed0578df", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/eed29ea734ae3008d80f5754ca2cab7eed0578df", "message": "Return null for related streams at age restricted videos", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "ecfc27a92c9a57345eca43305d7eb3ce625ce2ce", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ecfc27a92c9a57345eca43305d7eb3ce625ce2ce", "message": "Implement fallback methods for getDescription() and getTextualUploadDate() in YouTubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "8e6be880d7641d3a722a12da308cb5046ab49249", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8e6be880d7641d3a722a12da308cb5046ab49249", "message": "Simplify getId() in YoutubeChannelExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "bbe1a3cd6263388876397a6a14940e76933f0bd3", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/bbe1a3cd6263388876397a6a14940e76933f0bd3", "message": "Use getVideo(Primary|Secondary)InfoRenderer()", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "5d08c343227e44ebc6bb8acca73072e2e2878fa5", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5d08c343227e44ebc6bb8acca73072e2e2878fa5", "message": "Fix parsing upload date in YoutubeStreamExtractor", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "0fff03038ed285a2e1f2610b5d6eaab97c75ee35", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0fff03038ed285a2e1f2610b5d6eaab97c75ee35", "message": "Get description with correct links", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "26fb44595f7af1f00d50a0fec2b4ec84a3625337", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/26fb44595f7af1f00d50a0fec2b4ec84a3625337", "message": "Fix parsing description", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "729fd2eaeec758019604b987c6d43522f4879c01", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/729fd2eaeec758019604b987c6d43522f4879c01", "message": "Fix parsing description for navigationEndpoint without urlEndpoint", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "5a35300a5e3fc0221a6349351306a964e74adfb7", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/5a35300a5e3fc0221a6349351306a964e74adfb7", "message": "Fix parsing upload date for premiered streams", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"oid": "96285e08151ef5a48afdd7ba28b7857924ddd6ca", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/96285e08151ef5a48afdd7ba28b7857924ddd6ca", "message": "Fix getUploadDate() for premiered videos with a given date", "committedDate": "2020-02-25T20:51:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMwMDUzMQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/261#discussion_r384300531", "bodyText": "@TobiGr @wb9688\nI noticed that this page is very heavy to download, about 300~400KB per request.\nWhat do you think of using the pbj parameter? Using it offers a big advantage: it's a JSON formatted response which is, as you might've imagine, much less error prone to parse (it is basically the initialData already extracted).\nAnother thing is that the size would be as tiny, or even tinier than it was, a gziped 15~20KB response.\nHere's an example using the /videos endpoint (could be another one as well or even the \"root\", but this one seems to be sufficient to parse all the things we need, like description, name, etc.):\ncurl 'https://www.youtube.com/channel/UCLA_DiR1FfKNvjuUpBHmylQ/videos?pbj=1' \\\n    -H 'x-youtube-client-name: 1' -H 'x-youtube-client-version: 2.20200224.11.00' \\\n    -H 'User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:68.0) Gecko/20100101 Firefox/68.0' \\\n    -H 'Accept-Encoding: gzip' --compressed -v | jq > videos.pbj1.json\nIt looks like the only headers that we need are those two, which maybe we can just hardcode it (who knows how long it remains valid) or even find some lightweight method to get it dynamically.\nI'll investigate more about it later.\nPS: This is used throughout YouTube, replacing the channel with a video url works like a charm. Worth investigating as well.", "author": "mauriciocolli", "createdAt": "2020-02-26T06:46:53Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeChannelExtractor.java", "diffHunk": "@@ -59,11 +67,13 @@ public void onFetchPage(@Nonnull Downloader downloader) throws IOException, Extr\n         String channelUrl = super.getUrl() + CHANNEL_URL_PARAMETERS;\n         final Response response = downloader.get(channelUrl, getExtractorLocalization());\n         doc = YoutubeParsingHelper.parseAndCheckPage(channelUrl, response);\n+        initialData = YoutubeParsingHelper.getInitialData(response.responseBody());", "originalCommit": "96285e08151ef5a48afdd7ba28b7857924ddd6ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMwMjIwMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/261#discussion_r384302200", "bodyText": "We're using pbj for YoutubeSearchExtractor's next pages iirc, I just didn't realize that's possible with all pages. I don't think we could do that with YoutubeStreamExtractor though. I'll work on implementing that, see #262.", "author": "wb9688", "createdAt": "2020-02-26T06:52:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMwMDUzMQ=="}], "type": "inlineReview", "revised_code": null}]}