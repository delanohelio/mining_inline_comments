{"pr_number": 17989, "pr_title": "[Communcation] - Common - Renaming CommunicationUserCredential to CommunicationTokenCredential", "pr_createdAt": "2020-12-05T03:23:31Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17989", "timeline": [{"oid": "940b1e9279610f963f30c2454f85c3b21a6fe77f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/940b1e9279610f963f30c2454f85c3b21a6fe77f", "message": "Renaming CommunicationUserCredential to CommunicationTokenCredential", "committedDate": "2020-12-05T03:22:27Z", "type": "commit"}, {"oid": "a9c6baf21a6c28509d31de9a8c62bad6da083a6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a9c6baf21a6c28509d31de9a8c62bad6da083a6b", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into renameUserCredential", "committedDate": "2020-12-07T20:32:25Z", "type": "commit"}, {"oid": "1c6c6dc7915bcc7773f14b6d4cff59ba0f465664", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1c6c6dc7915bcc7773f14b6d4cff59ba0f465664", "message": "Fixing build", "committedDate": "2020-12-07T23:51:46Z", "type": "commit"}, {"oid": "56851a58555365e10574adba590911afbf615a1d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/56851a58555365e10574adba590911afbf615a1d", "message": "update read me", "committedDate": "2020-12-08T00:15:15Z", "type": "commit"}, {"oid": "80a5e0ab8d78d629ea6523983175b13d724509b8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/80a5e0ab8d78d629ea6523983175b13d724509b8", "message": "Remove unneeded export", "committedDate": "2020-12-08T00:39:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk1OTkyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17989#discussion_r537959925", "bodyText": "let's rename these variables too", "author": "RezaJooyandeh", "createdAt": "2020-12-08T01:23:13Z", "path": "sdk/communication/azure-communication-common/src/test/java/com/azure/communication/common/CommunicationTokenCredentialTests.java", "diffHunk": "@@ -374,7 +374,7 @@ public void shouldCallRefresherOnlyOnceWhileRefreshingIsInProgress()\n     public void withoutInitialTokenShouldCallFresherOnlyOnceWhileRefreshingIsInProgress()\n         throws InterruptedException, ExecutionException, IOException {\n         longRunningRefresher.resetCallCount();\n-        CommunicationUserCredential userCredential = new CommunicationUserCredential(longRunningRefresher);\n+        CommunicationTokenCredential userCredential = new CommunicationTokenCredential(longRunningRefresher);", "originalCommit": "80a5e0ab8d78d629ea6523983175b13d724509b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNTk0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17989#discussion_r538005940", "bodyText": "good catch! Thanks Reza", "author": "minnieliu", "createdAt": "2020-12-08T03:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk1OTkyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "4e66d689da4a0b28c872e8307a3fad87071911c0", "chunk": "diff --git a/sdk/communication/azure-communication-common/src/test/java/com/azure/communication/common/CommunicationTokenCredentialTests.java b/sdk/communication/azure-communication-common/src/test/java/com/azure/communication/common/CommunicationTokenCredentialTests.java\nindex 657b2205793..72bf799f666 100644\n--- a/sdk/communication/azure-communication-common/src/test/java/com/azure/communication/common/CommunicationTokenCredentialTests.java\n+++ b/sdk/communication/azure-communication-common/src/test/java/com/azure/communication/common/CommunicationTokenCredentialTests.java\n\n@@ -359,29 +359,29 @@ public class CommunicationTokenCredentialTests {\n         longRunningRefresher.setOnCallReturn(countDownLatch::countDown);\n         String tokenStr = tokenMocker.generateRawToken(\"resourceId\", \"userIdentity\", -5 * 60);\n \n-        CommunicationTokenCredential userCredential = new CommunicationTokenCredential(longRunningRefresher, tokenStr, true);\n+        CommunicationTokenCredential tokenCredential = new CommunicationTokenCredential(longRunningRefresher, tokenStr, true);\n \n         countDownLatch.await();\n         assertEquals(1, longRunningRefresher.numCalls());\n         for (int i = 0; i < 3; i++) {\n-            userCredential.getToken();\n+            tokenCredential.getToken();\n             assertEquals(1, longRunningRefresher.numCalls(), \"No additional call is made by getToken\");\n         }\n-        userCredential.close();\n+        tokenCredential.close();\n     }\n \n     @Test\n     public void withoutInitialTokenShouldCallFresherOnlyOnceWhileRefreshingIsInProgress()\n         throws InterruptedException, ExecutionException, IOException {\n         longRunningRefresher.resetCallCount();\n-        CommunicationTokenCredential userCredential = new CommunicationTokenCredential(longRunningRefresher);\n-        userCredential.getToken();\n+        CommunicationTokenCredential tokenCredential = new CommunicationTokenCredential(longRunningRefresher);\n+        tokenCredential.getToken();\n         assertEquals(1, longRunningRefresher.numCalls());\n         for (int i = 0; i < 3; i++) {\n-            userCredential.getToken();\n+            tokenCredential.getToken();\n             assertEquals(1, longRunningRefresher.numCalls(), \"No additional calls made by getToken call\");\n         }\n-        userCredential.close();\n+        tokenCredential.close();\n     }\n \n     class MockExceptionFutureRefresher implements TokenRefresher {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2MDMxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17989#discussion_r537960310", "bodyText": "Is this because CommunicationTokenCredential.getToken returns a Future instead of a Promise?", "author": "RezaJooyandeh", "createdAt": "2020-12-08T01:24:14Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/implementation/CommunicationBearerTokenCredential.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.communication.chat.implementation;\n+\n+import java.util.concurrent.ExecutionException;\n+\n+import com.azure.communication.common.CommunicationTokenCredential;\n+import com.azure.core.credential.AccessToken;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.credential.TokenRequestContext;\n+\n+import reactor.core.publisher.Mono;\n+\n+/**\n+ * This class serves as a CommunicationTokenCredential wrapper that \n+ * allows using BearerAuthenticationPolicy in different clients\n+ */\n+public class CommunicationBearerTokenCredential implements TokenCredential {\n+    private final CommunicationTokenCredential credential;\n+\n+    /**\n+     * Creates a CommunicationTokenCredential\n+     *\n+     * @param communicationTokenCredential The {@link CommunicationTokenCredential} to use \n+     * in the BearerAuthenticationPolicy.\n+     */\n+    public CommunicationBearerTokenCredential(CommunicationTokenCredential communicationTokenCredential) {\n+        credential = communicationTokenCredential;\n+    }\n+\n+    @Override\n+    public Mono<AccessToken> getToken(TokenRequestContext request) {\n+        try {\n+            return Mono.just(credential.getToken().get());", "originalCommit": "80a5e0ab8d78d629ea6523983175b13d724509b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNDQwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17989#discussion_r538004402", "bodyText": "Yes, this is currently copied over from the original file. I am currently prepping another PR to address the Future -> Mono task", "author": "minnieliu", "createdAt": "2020-12-08T03:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk2MDMxMA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "4e66d689da4a0b28c872e8307a3fad87071911c0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4e66d689da4a0b28c872e8307a3fad87071911c0", "message": "Addressing PR comments", "committedDate": "2020-12-08T03:33:11Z", "type": "commit"}]}