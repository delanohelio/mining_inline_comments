{"pr_number": 13449, "pr_title": "Fix for stored procedure retry", "pr_createdAt": "2020-07-23T16:12:44Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13449", "timeline": [{"oid": "e2ea8822b1a60b47727e8d0828d19b5861196847", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e2ea8822b1a60b47727e8d0828d19b5861196847", "message": "fix for stored procedure retry throttle", "committedDate": "2020-07-23T16:11:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxMTQ4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459611485", "bodyText": "test method name java style.", "author": "moderakh", "createdAt": "2020-07-23T17:27:55Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java", "diffHunk": "@@ -0,0 +1,81 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.cosmos.implementation;\n+\n+import com.azure.cosmos.BridgeInternal;\n+import com.azure.cosmos.models.PartitionKey;\n+import org.mockito.stubbing.Answer;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.UUID;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.anyObject;\n+import static org.mockito.Mockito.doAnswer;\n+\n+public class StoredProcedureRetryThrottleTest extends TestSuiteBase {\n+    private final static int TIMEOUT = 10000;\n+\n+    private SpyClientUnderTestFactory.ClientWithGatewaySpy client;\n+    private DocumentCollection createdCollection;\n+\n+    public StoredProcedureRetryThrottleTest() {}\n+\n+    @Test(groups = { \"long\" }, timeOut = TIMEOUT)\n+    public void StoredProcedureRetryThrottle() {", "originalCommit": "e2ea8822b1a60b47727e8d0828d19b5861196847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxMzQxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459613416", "bodyText": "oops, sorry, will change right now", "author": "xinlian12", "createdAt": "2020-07-23T17:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxMTQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxNTkxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459615916", "bodyText": "updated~", "author": "xinlian12", "createdAt": "2020-07-23T17:35:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYxMTQ4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "302edd044fc8b7a4deea649d40651f00726d9c63", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java b/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\nindex 59da8c7427d..28f9a68cae0 100644\n--- a/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\n+++ b/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\n\n@@ -28,7 +28,7 @@ public class StoredProcedureRetryThrottleTest extends TestSuiteBase {\n     public StoredProcedureRetryThrottleTest() {}\n \n     @Test(groups = { \"long\" }, timeOut = TIMEOUT)\n-    public void StoredProcedureRetryThrottle() {\n+    public void storedProcedureRetryThrottle() {\n         client = SpyClientUnderTestFactory.createClientWithGatewaySpy(createGatewayRxDocumentClient());\n \n         StoredProcedure storedProcedure = new StoredProcedure();\n"}}, {"oid": "302edd044fc8b7a4deea649d40651f00726d9c63", "url": "https://github.com/Azure/azure-sdk-for-java/commit/302edd044fc8b7a4deea649d40651f00726d9c63", "message": "method name java style", "committedDate": "2020-07-23T17:34:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMTA1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459631058", "bodyText": "Can we put this test in \"emulator\" group ?", "author": "kushagraThapar", "createdAt": "2020-07-23T18:01:39Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java", "diffHunk": "@@ -0,0 +1,81 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.cosmos.implementation;\n+\n+import com.azure.cosmos.BridgeInternal;\n+import com.azure.cosmos.models.PartitionKey;\n+import org.mockito.stubbing.Answer;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+import reactor.core.publisher.Mono;\n+\n+import java.util.UUID;\n+import java.util.concurrent.atomic.AtomicInteger;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Matchers.anyObject;\n+import static org.mockito.Mockito.doAnswer;\n+\n+public class StoredProcedureRetryThrottleTest extends TestSuiteBase {\n+    private final static int TIMEOUT = 10000;\n+\n+    private SpyClientUnderTestFactory.ClientWithGatewaySpy client;\n+    private DocumentCollection createdCollection;\n+\n+    public StoredProcedureRetryThrottleTest() {}\n+\n+    @Test(groups = { \"long\" }, timeOut = TIMEOUT)", "originalCommit": "302edd044fc8b7a4deea649d40651f00726d9c63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0MTM5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459641392", "bodyText": "changed to emulator group. can I know what is the concern here?", "author": "xinlian12", "createdAt": "2020-07-23T18:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMTA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY1ODkwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459658908", "bodyText": "Of course, since this test is not a very big test and uses mocking, so it won't take much resources.\nRunning it in \"emulator\" group makes sure it runs in the small CI that automatically triggers when we create the PR.\nWhereas if you run the test in \"long\" group, then you will have to trigger full live CI to run this test case - which doesn't make sense for these quick test cases.", "author": "kushagraThapar", "createdAt": "2020-07-23T18:51:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMTA1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY3Mzg1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13449#discussion_r459673854", "bodyText": "got it, thanks for the explanation~", "author": "xinlian12", "createdAt": "2020-07-23T19:19:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTYzMTA1OA=="}], "type": "inlineReview", "revised_code": {"commit": "dfc753cee63beeb3de5f162ea7c07ad01a1166d7", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java b/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\nindex 28f9a68cae0..55204b4bf18 100644\n--- a/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\n+++ b/sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/implementation/StoredProcedureRetryThrottleTest.java\n\n@@ -27,7 +27,7 @@ public class StoredProcedureRetryThrottleTest extends TestSuiteBase {\n \n     public StoredProcedureRetryThrottleTest() {}\n \n-    @Test(groups = { \"long\" }, timeOut = TIMEOUT)\n+    @Test(groups = { \"emulator\" }, timeOut = TIMEOUT)\n     public void storedProcedureRetryThrottle() {\n         client = SpyClientUnderTestFactory.createClientWithGatewaySpy(createGatewayRxDocumentClient());\n \n"}}, {"oid": "dfc753cee63beeb3de5f162ea7c07ad01a1166d7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dfc753cee63beeb3de5f162ea7c07ad01a1166d7", "message": "change to emulator group", "committedDate": "2020-07-23T18:19:00Z", "type": "commit"}]}