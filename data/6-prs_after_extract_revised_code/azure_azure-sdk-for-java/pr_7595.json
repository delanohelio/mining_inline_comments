{"pr_number": 7595, "pr_title": "Fixed ShareStats bug", "pr_createdAt": "2020-01-22T00:17:43Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7595", "timeline": [{"oid": "d723467f4c2c4ace5367266421d492ab63e01342", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d723467f4c2c4ace5367266421d492ab63e01342", "message": "Fixed ShareStats bug", "committedDate": "2020-01-22T00:17:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODMyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7595#discussion_r369868327", "bodyText": "Don't we want Math.ceil() of these values so we round up?", "author": "rickle-msft", "createdAt": "2020-01-22T23:50:59Z", "path": "sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareAsyncClient.java", "diffHunk": "@@ -1086,7 +1087,9 @@ public String generateSas(ShareServiceSasSignatureValues shareServiceSasSignatur\n     }\n \n     private Response<ShareStatistics> mapGetStatisticsResponse(SharesGetStatisticsResponse response) {\n-        ShareStatistics shareStatistics = new ShareStatistics((int) (response.getValue().getShareUsageBytes() / 1024));\n+        ShareStatistics shareStatistics =\n+            new ShareStatistics((int) (response.getValue().getShareUsageBytes() / (Constants.GB)),", "originalCommit": "d723467f4c2c4ace5367266421d492ab63e01342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODkwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7595#discussion_r369868905", "bodyText": "It might also be better for the new constructor to just take a long and we calculate the share usage in bytes in the constructor.", "author": "rickle-msft", "createdAt": "2020-01-22T23:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODMyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI4OTc5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7595#discussion_r370289797", "bodyText": "Done", "author": "gapra-msft", "createdAt": "2020-01-23T18:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODMyNw=="}], "type": "inlineReview", "revised_code": {"commit": "52e085e80a7a0097ad828fdf7a5fd0c86006a097", "chunk": "diff --git a/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareAsyncClient.java b/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareAsyncClient.java\nindex dedcfdc0314..4c769dc0757 100644\n--- a/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareAsyncClient.java\n+++ b/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/ShareAsyncClient.java\n\n@@ -1088,8 +1088,7 @@ public class ShareAsyncClient {\n \n     private Response<ShareStatistics> mapGetStatisticsResponse(SharesGetStatisticsResponse response) {\n         ShareStatistics shareStatistics =\n-            new ShareStatistics((int) (response.getValue().getShareUsageBytes() / (Constants.GB)),\n-                response.getValue().getShareUsageBytes());\n+            new ShareStatistics(response.getValue().getShareUsageBytes());\n \n         return new SimpleResponse<>(response, shareStatistics);\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODU3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7595#discussion_r369868572", "bodyText": "It might be better to default this to -1 so that customers can tell the difference between not set and empty share", "author": "rickle-msft", "createdAt": "2020-01-22T23:51:48Z", "path": "sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareStatistics.java", "diffHunk": "@@ -16,6 +17,18 @@\n      */\n     public ShareStatistics(int shareUsageInGB) {\n         this.shareUsageInGB = shareUsageInGB;\n+        this.shareUsageInBytes = 0;", "originalCommit": "d723467f4c2c4ace5367266421d492ab63e01342", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MDM2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7595#discussion_r370290363", "bodyText": "Done", "author": "gapra-msft", "createdAt": "2020-01-23T18:44:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg2ODU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "52e085e80a7a0097ad828fdf7a5fd0c86006a097", "chunk": "diff --git a/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareStatistics.java b/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareStatistics.java\nindex f5c0c23fe8b..de17ac514cb 100644\n--- a/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareStatistics.java\n+++ b/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareStatistics.java\n\n@@ -17,17 +19,16 @@ public final class ShareStatistics {\n      */\n     public ShareStatistics(int shareUsageInGB) {\n         this.shareUsageInGB = shareUsageInGB;\n-        this.shareUsageInBytes = 0;\n+        this.shareUsageInBytes = -1;\n     }\n \n     /**\n      * Creates an instance of storage statistics for a Share.\n      *\n-     * @param shareUsageInGB Size in GB of the Share\n      * @param shareUsageInBytes Size in bytes of the Share\n      */\n-    public ShareStatistics(int shareUsageInGB, long shareUsageInBytes) {\n-        this.shareUsageInGB = shareUsageInGB;\n+    public ShareStatistics(long shareUsageInBytes) {\n+        this.shareUsageInGB = (int) Math.ceil(shareUsageInBytes / Constants.GB);\n         this.shareUsageInBytes = shareUsageInBytes;\n     }\n \n"}}, {"oid": "52e085e80a7a0097ad828fdf7a5fd0c86006a097", "url": "https://github.com/Azure/azure-sdk-for-java/commit/52e085e80a7a0097ad828fdf7a5fd0c86006a097", "message": "Addressed PR comments", "committedDate": "2020-01-23T18:44:14Z", "type": "commit"}, {"oid": "57438b6adf5394f0cf756e58cb3ab1d38189cfd2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/57438b6adf5394f0cf756e58cb3ab1d38189cfd2", "message": "removed unused import", "committedDate": "2020-01-23T19:18:04Z", "type": "commit"}, {"oid": "e603e7f876d14c613ef13248f376f72fc6a25527", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e603e7f876d14c613ef13248f376f72fc6a25527", "message": "trying to fix ceil analyze issue", "committedDate": "2020-01-23T22:33:21Z", "type": "commit"}, {"oid": "21dfe764ec1a2c73a090e12a38444f587157d94c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/21dfe764ec1a2c73a090e12a38444f587157d94c", "message": "Changed tests to support ceil", "committedDate": "2020-01-23T23:29:41Z", "type": "commit"}, {"oid": "a6fdbe25bdc082ad0f4d5c78fd79c5c1a8fe34c2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a6fdbe25bdc082ad0f4d5c78fd79c5c1a8fe34c2", "message": "Merge branch 'master' into storage/shareGetStatsTest", "committedDate": "2020-01-24T16:25:53Z", "type": "commit"}, {"oid": "fa1d2c4c2a67a0ec34982cfa9f064f8ddc5cf2ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa1d2c4c2a67a0ec34982cfa9f064f8ddc5cf2ba", "message": "Merge branch 'master' into storage/shareGetStatsTest", "committedDate": "2020-01-28T21:48:41Z", "type": "commit"}]}