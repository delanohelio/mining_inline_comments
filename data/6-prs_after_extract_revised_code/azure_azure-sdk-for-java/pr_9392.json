{"pr_number": 9392, "pr_title": "Add EnvVar AZURE_AUTHORITY_HOST", "pr_createdAt": "2020-03-23T07:00:03Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9392", "timeline": [{"oid": "1f1cbd58b0dc314dafb5381b21273fe1519f0e01", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f1cbd58b0dc314dafb5381b21273fe1519f0e01", "message": "add env authorityhost", "committedDate": "2020-03-23T02:36:23Z", "type": "commit"}, {"oid": "93afcb85632a84e65f9bcf2463b8afd7d2347758", "url": "https://github.com/Azure/azure-sdk-for-java/commit/93afcb85632a84e65f9bcf2463b8afd7d2347758", "message": "add env authorityhost", "committedDate": "2020-03-23T06:54:57Z", "type": "commit"}, {"oid": "2ea0e325e5f4f3f6f16ac91cd4cceec7722f6716", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2ea0e325e5f4f3f6f16ac91cd4cceec7722f6716", "message": "add .clone()", "committedDate": "2020-03-23T09:23:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2OTAzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9392#discussion_r396569034", "bodyText": "Is there a need to have a short lived clone of the global configuration? If anything it may be better to use it directly as it could load into static memory the environment setting and will be accessed quicker in the future.", "author": "alzimmermsft", "createdAt": "2020-03-23T16:08:25Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java", "diffHunk": "@@ -26,7 +27,9 @@\n      * Creates an instance of IdentityClientOptions with default settings.\n      */\n     public IdentityClientOptions() {\n-        authorityHost = DEFAULT_AUTHORITY_HOST;\n+        Configuration configuration = Configuration.getGlobalConfiguration().clone();", "originalCommit": "2ea0e325e5f4f3f6f16ac91cd4cceec7722f6716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg3Njc5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9392#discussion_r396876797", "bodyText": "I followed they way in SharedTokenCacheCredential\uff0cit cloned a configuration in its constructor.", "author": "Luyunmt", "createdAt": "2020-03-24T03:00:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2OTAzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg3NzIzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9392#discussion_r396877232", "bodyText": "Removed clone.", "author": "Luyunmt", "createdAt": "2020-03-24T03:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2OTAzNA=="}], "type": "inlineReview", "revised_code": {"commit": "28228409c08cd351e00ddeec6c751af406871c60", "chunk": "diff --git a/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java b/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\nindex 44c96cd4aab..d36973fec49 100644\n--- a/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\n+++ b/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\n\n@@ -27,9 +27,8 @@ public final class IdentityClientOptions {\n      * Creates an instance of IdentityClientOptions with default settings.\n      */\n     public IdentityClientOptions() {\n-        Configuration configuration = Configuration.getGlobalConfiguration().clone();\n-        authorityHost = configuration.contains(configuration.PROPERTY_AZURE_AUTHORITY_HOST)\n-        ? configuration.get(configuration.PROPERTY_AZURE_AUTHORITY_HOST) : DEFAULT_AUTHORITY_HOST;\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        authorityHost = configuration.get(Configuration.PROPERTY_AZURE_AUTHORITY_HOST, DEFAULT_AUTHORITY_HOST);\n         maxRetry = MAX_RETRY_DEFAULT_LIMIT;\n         retryTimeout = i -> Duration.ofSeconds((long) Math.pow(2, i.getSeconds() - 1));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3MDM5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9392#discussion_r396570391", "bodyText": "Configuration has a T get(String configurationName, T defaultValue) method that could simplify this logic.\nauthorityHost = configuration.get(Configuration.PROPERTY_AZURE_AUTHORITY_HOST, DEFAULT_AUTHORITY_HOST);", "author": "alzimmermsft", "createdAt": "2020-03-23T16:10:07Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java", "diffHunk": "@@ -26,7 +27,9 @@\n      * Creates an instance of IdentityClientOptions with default settings.\n      */\n     public IdentityClientOptions() {\n-        authorityHost = DEFAULT_AUTHORITY_HOST;\n+        Configuration configuration = Configuration.getGlobalConfiguration().clone();\n+        authorityHost = configuration.contains(configuration.PROPERTY_AZURE_AUTHORITY_HOST)\n+        ? configuration.get(configuration.PROPERTY_AZURE_AUTHORITY_HOST) : DEFAULT_AUTHORITY_HOST;", "originalCommit": "2ea0e325e5f4f3f6f16ac91cd4cceec7722f6716", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "28228409c08cd351e00ddeec6c751af406871c60", "chunk": "diff --git a/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java b/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\nindex 44c96cd4aab..d36973fec49 100644\n--- a/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\n+++ b/sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClientOptions.java\n\n@@ -27,9 +27,8 @@ public final class IdentityClientOptions {\n      * Creates an instance of IdentityClientOptions with default settings.\n      */\n     public IdentityClientOptions() {\n-        Configuration configuration = Configuration.getGlobalConfiguration().clone();\n-        authorityHost = configuration.contains(configuration.PROPERTY_AZURE_AUTHORITY_HOST)\n-        ? configuration.get(configuration.PROPERTY_AZURE_AUTHORITY_HOST) : DEFAULT_AUTHORITY_HOST;\n+        Configuration configuration = Configuration.getGlobalConfiguration();\n+        authorityHost = configuration.get(Configuration.PROPERTY_AZURE_AUTHORITY_HOST, DEFAULT_AUTHORITY_HOST);\n         maxRetry = MAX_RETRY_DEFAULT_LIMIT;\n         retryTimeout = i -> Duration.ofSeconds((long) Math.pow(2, i.getSeconds() - 1));\n     }\n"}}, {"oid": "28228409c08cd351e00ddeec6c751af406871c60", "url": "https://github.com/Azure/azure-sdk-for-java/commit/28228409c08cd351e00ddeec6c751af406871c60", "message": "remove .clone()", "committedDate": "2020-03-24T01:43:21Z", "type": "commit"}, {"oid": "3dbaa67b087ad757bb8c1036eb8a8592452d26d6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3dbaa67b087ad757bb8c1036eb8a8592452d26d6", "message": "change azureidentity azurecore version in pom.xml", "committedDate": "2020-04-01T02:13:19Z", "type": "commit"}, {"oid": "e8439671fa6d086be73fd008c090f2c67084b2cc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e8439671fa6d086be73fd008c090f2c67084b2cc", "message": "Merge branch 'master' into FixENVVars", "committedDate": "2020-04-01T07:18:13Z", "type": "commit"}, {"oid": "02c59a28e108869b1cc99794dc7e861b959d625f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/02c59a28e108869b1cc99794dc7e861b959d625f", "message": "Merge branch 'master' into FixENVVars", "committedDate": "2020-04-02T23:02:11Z", "type": "commit"}]}