{"pr_number": 15212, "pr_title": "Mgmt: make createAsync return Mono<ModelT>", "pr_createdAt": "2020-09-15T08:23:35Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15212", "timeline": [{"oid": "63a34749741a7c00f490e228a78643f656afc9c4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/63a34749741a7c00f490e228a78643f656afc9c4", "message": "update interface", "committedDate": "2020-09-15T03:02:16Z", "type": "commit"}, {"oid": "233fbad269a8ce9dc06fa5ec8a6ebdcdb0a704c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/233fbad269a8ce9dc06fa5ec8a6ebdcdb0a704c6", "message": "fix compile error", "committedDate": "2020-09-15T03:13:17Z", "type": "commit"}, {"oid": "1adf00d4bc7ef397cededf47dbe7cb172054ceeb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1adf00d4bc7ef397cededf47dbe7cb172054ceeb", "message": "fix test error", "committedDate": "2020-09-15T06:58:04Z", "type": "commit"}, {"oid": "c05fbd47be879acd143355f41585291ebf7aa115", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c05fbd47be879acd143355f41585291ebf7aa115", "message": "create stream test to get from azure", "committedDate": "2020-09-15T08:19:12Z", "type": "commit"}, {"oid": "cc5acd2a6970725323180a737d9e63775c14baeb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cc5acd2a6970725323180a737d9e63775c14baeb", "message": "add comment for taskgroup invoke", "committedDate": "2020-09-15T08:19:37Z", "type": "commit"}, {"oid": "f7dfdbc2f1cfb46263748571f12c4fec703d7b19", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f7dfdbc2f1cfb46263748571f12c4fec703d7b19", "message": "record", "committedDate": "2020-09-15T08:19:52Z", "type": "commit"}, {"oid": "f98420e0f08ddc4d7a04bfe688840433f6ac7c5b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f98420e0f08ddc4d7a04bfe688840433f6ac7c5b", "message": "remove test suppress", "committedDate": "2020-09-15T08:21:58Z", "type": "commit"}, {"oid": "787cbb6cb3090143128a36a139c4882ba3cb2b16", "url": "https://github.com/Azure/azure-sdk-for-java/commit/787cbb6cb3090143128a36a139c4882ba3cb2b16", "message": "fix compile warning", "committedDate": "2020-09-15T09:05:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxMjYxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488512614", "bodyText": "Why need a cast? Does it need Flux<Indexable>?", "author": "weidongxu-microsoft", "createdAt": "2020-09-15T09:14:17Z", "path": "sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/RoleAssignmentHelper.java", "diffHunk": "@@ -94,7 +94,7 @@ public RoleAssignmentHelper withAccessTo(final String scope, final BuiltInRole a\n                     .withBuiltInRole(asRole)\n                     .withScope(resourceScope)\n                     .createAsync()\n-                    .last()\n+                    .cast(Indexable.class)", "originalCommit": "787cbb6cb3090143128a36a139c4882ba3cb2b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUyMzA4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488523086", "bodyText": "Some are dependency or post dependency, some are in test for Flux", "author": "ChenTanyi", "createdAt": "2020-09-15T09:30:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxMjYxNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxMzIzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488513237", "bodyText": "Seems just indexable.id()?", "author": "weidongxu-microsoft", "createdAt": "2020-09-15T09:15:17Z", "path": "sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/ServicePrincipalImpl.java", "diffHunk": "@@ -199,7 +199,7 @@ public String applicationId() {\n                                 .createAsync())\n                     .doOnNext(\n                         indexable ->\n-                            cachedRoleAssignments.put(((RoleAssignment) indexable).id(), (RoleAssignment) indexable))\n+                            cachedRoleAssignments.put((indexable).id(), indexable))", "originalCommit": "787cbb6cb3090143128a36a139c4882ba3cb2b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEyMjE4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r489122188", "bodyText": "done", "author": "ChenTanyi", "createdAt": "2020-09-16T02:21:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxMzIzNw=="}], "type": "inlineReview", "revised_code": {"commit": "a83be5056a0b68eda6eb0ffa7a05326b38b78752", "chunk": "diff --git a/sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/ServicePrincipalImpl.java b/sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/ServicePrincipalImpl.java\nindex 99972ecac54..f38c4164742 100644\n--- a/sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/ServicePrincipalImpl.java\n+++ b/sdk/resourcemanager/azure-resourcemanager-authorization/src/main/java/com/azure/resourcemanager/authorization/implementation/ServicePrincipalImpl.java\n\n@@ -199,7 +200,7 @@ class ServicePrincipalImpl extends CreatableUpdatableImpl<ServicePrincipal, Serv\n                                 .createAsync())\n                     .doOnNext(\n                         indexable ->\n-                            cachedRoleAssignments.put((indexable).id(), indexable))\n+                            cachedRoleAssignments.put(indexable.id(), indexable))\n                     .last()\n                     .map(\n                         indexable -> {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNDA3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488514072", "bodyText": "If it is Mono, do not name it flux.", "author": "weidongxu-microsoft", "createdAt": "2020-09-15T09:16:45Z", "path": "sdk/resourcemanager/azure-resourcemanager-compute/src/test/java/com/azure/resourcemanager/compute/VirtualMachinePopularImageTests.java", "diffHunk": "@@ -44,7 +45,7 @@ public void canCreateAllPopularImageVM() {\n         }\n \n         for (KnownLinuxVirtualMachineImage image : KnownLinuxVirtualMachineImage.values()) {\n-            Flux<Indexable> flux = computeManager.virtualMachines()\n+            Mono<VirtualMachine> flux = computeManager.virtualMachines()", "originalCommit": "787cbb6cb3090143128a36a139c4882ba3cb2b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNDM0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488514348", "bodyText": "Same for vmFluxes.", "author": "weidongxu-microsoft", "createdAt": "2020-09-15T09:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNDA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTEyMjIyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r489122226", "bodyText": "done", "author": "ChenTanyi", "createdAt": "2020-09-16T02:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNDA3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "a83be5056a0b68eda6eb0ffa7a05326b38b78752", "chunk": "diff --git a/sdk/resourcemanager/azure-resourcemanager-compute/src/test/java/com/azure/resourcemanager/compute/VirtualMachinePopularImageTests.java b/sdk/resourcemanager/azure-resourcemanager-compute/src/test/java/com/azure/resourcemanager/compute/VirtualMachinePopularImageTests.java\nindex b8d2edc15ab..cf7dfcc3e81 100644\n--- a/sdk/resourcemanager/azure-resourcemanager-compute/src/test/java/com/azure/resourcemanager/compute/VirtualMachinePopularImageTests.java\n+++ b/sdk/resourcemanager/azure-resourcemanager-compute/src/test/java/com/azure/resourcemanager/compute/VirtualMachinePopularImageTests.java\n\n@@ -41,11 +41,11 @@ public class VirtualMachinePopularImageTests extends ComputeManagementTest {\n                 .withAdminPassword(password())\n                 .withSize(VirtualMachineSizeTypes.STANDARD_B1S)\n                 .createAsync();\n-            vmFluxes.add(flux);\n+            vmMonos.add(mono);\n         }\n \n         for (KnownLinuxVirtualMachineImage image : KnownLinuxVirtualMachineImage.values()) {\n-            Mono<VirtualMachine> flux = computeManager.virtualMachines()\n+            Mono<VirtualMachine> mono = computeManager.virtualMachines()\n                 .define(generateRandomResourceName(\"vm\", 10))\n                 .withRegion(Region.US_SOUTH_CENTRAL)\n                 .withNewResourceGroup(rgName)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNjYyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488516624", "bodyText": "Likely this if is no longer needed?", "author": "weidongxu-microsoft", "createdAt": "2020-09-15T09:20:56Z", "path": "sdk/resourcemanager/azure-resourcemanager-samples/src/main/java/com/azure/resourcemanager/appservice/samples/ManageWebAppSourceControlAsync.java", "diffHunk": "@@ -70,9 +70,9 @@ public static boolean runSample(final Azure azure) {\n                     .withJavaVersion(JavaVersion.JAVA_8_NEWEST)\n                     .withWebContainer(WebContainer.TOMCAT_8_0_NEWEST)\n                     .createAsync()\n-                    .flatMap(indexable -> {\n+                    .flatMapMany(indexable -> {\n                         if (indexable instanceof WebApp) {", "originalCommit": "787cbb6cb3090143128a36a139c4882ba3cb2b16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUyMTk4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r488521989", "bodyText": "Yes, there are lots of if not needed, but I don't want to change so much.", "author": "ChenTanyi", "createdAt": "2020-09-15T09:29:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNjYyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3NDMzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15212#discussion_r489174331", "bodyText": "fixed, it cause spotbugs error", "author": "ChenTanyi", "createdAt": "2020-09-16T05:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUxNjYyNA=="}], "type": "inlineReview", "revised_code": {"commit": "116dab0794fe653f84cb0daeadbee6c10efae3e8", "chunk": "diff --git a/sdk/resourcemanager/azure-resourcemanager-samples/src/main/java/com/azure/resourcemanager/appservice/samples/ManageWebAppSourceControlAsync.java b/sdk/resourcemanager/azure-resourcemanager-samples/src/main/java/com/azure/resourcemanager/appservice/samples/ManageWebAppSourceControlAsync.java\nindex d3b2c969fb8..5705f622e45 100644\n--- a/sdk/resourcemanager/azure-resourcemanager-samples/src/main/java/com/azure/resourcemanager/appservice/samples/ManageWebAppSourceControlAsync.java\n+++ b/sdk/resourcemanager/azure-resourcemanager-samples/src/main/java/com/azure/resourcemanager/appservice/samples/ManageWebAppSourceControlAsync.java\n\n@@ -70,24 +69,20 @@ public final class ManageWebAppSourceControlAsync {\n                     .withJavaVersion(JavaVersion.JAVA_8_NEWEST)\n                     .withWebContainer(WebContainer.TOMCAT_8_0_NEWEST)\n                     .createAsync()\n-                    .flatMapMany(indexable -> {\n-                        if (indexable instanceof WebApp) {\n-                            WebApp app = indexable;\n-                            System.out.println(\"Created web app \" + app.name());\n-                            return Flux.merge(\n-                                    Flux.just(indexable),\n-                                    app.getPublishingProfileAsync()\n-                                    .map(publishingProfile -> {\n-                                        System.out.println(\"Deploying helloworld.war to \" + app1Name + \" through FTP...\");\n-                                        Utils.uploadFileViaFtp(publishingProfile,\n-                                                \"helloworld.war\",\n-                                                ManageWebAppSourceControlAsync.class.getResourceAsStream(\"/helloworld.war\"));\n-\n-                                        System.out.println(\"Deployment helloworld.war to web app \" + app1Name + \" completed\");\n-                                        return publishingProfile;\n-                                    }));\n-                        }\n-                        return Flux.just(indexable);\n+                    .flatMapMany(app -> {\n+                        System.out.println(\"Created web app \" + app.name());\n+                        return Flux.merge(\n+                                Flux.just(app),\n+                                app.getPublishingProfileAsync()\n+                                .map(publishingProfile -> {\n+                                    System.out.println(\"Deploying helloworld.war to \" + app1Name + \" through FTP...\");\n+                                    Utils.uploadFileViaFtp(publishingProfile,\n+                                            \"helloworld.war\",\n+                                            ManageWebAppSourceControlAsync.class.getResourceAsStream(\"/helloworld.war\"));\n+\n+                                    System.out.println(\"Deployment helloworld.war to web app \" + app1Name + \" completed\");\n+                                    return publishingProfile;\n+                                }));\n                     });\n \n             System.out.println(\"Creating another web app \" + app2Name + \" in resource group \" + rgName + \"...\");\n"}}, {"oid": "a83be5056a0b68eda6eb0ffa7a05326b38b78752", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a83be5056a0b68eda6eb0ffa7a05326b38b78752", "message": "change some naming", "committedDate": "2020-09-16T02:19:11Z", "type": "commit"}, {"oid": "9dbb09d08b1963ccd296dfbd153d75eae984594f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9dbb09d08b1963ccd296dfbd153d75eae984594f", "message": "remove Utils.rootResource", "committedDate": "2020-09-16T02:19:57Z", "type": "commit"}, {"oid": "217b9b79ddaec3a030c44bc1e173065569fa673d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/217b9b79ddaec3a030c44bc1e173065569fa673d", "message": "add convert to management exception in taskgroup", "committedDate": "2020-09-16T02:46:20Z", "type": "commit"}, {"oid": "b269cc732221fa946e99b8aa7fa3214ba3f9ebbc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b269cc732221fa946e99b8aa7fa3214ba3f9ebbc", "message": "fix record", "committedDate": "2020-09-16T03:00:46Z", "type": "commit"}, {"oid": "116dab0794fe653f84cb0daeadbee6c10efae3e8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/116dab0794fe653f84cb0daeadbee6c10efae3e8", "message": "fix spotbugs", "committedDate": "2020-09-16T05:24:04Z", "type": "commit"}, {"oid": "c0b036a5e2812d962e94449502a88448b89cdf92", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c0b036a5e2812d962e94449502a88448b89cdf92", "message": "add changelog", "committedDate": "2020-09-16T05:40:34Z", "type": "commit"}, {"oid": "9970955f4aef4b794b0fc200e5ad8860b8433a74", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9970955f4aef4b794b0fc200e5ad8860b8433a74", "message": "Merge branch 'master' into createAsync", "committedDate": "2020-09-16T06:18:07Z", "type": "commit"}, {"oid": "588878054dbc3c8164d4ec8f32bf8e731559ce8a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/588878054dbc3c8164d4ec8f32bf8e731559ce8a", "message": "fix AggregatedManagementException", "committedDate": "2020-09-16T06:33:51Z", "type": "commit"}]}