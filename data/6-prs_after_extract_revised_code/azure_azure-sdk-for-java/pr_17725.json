{"pr_number": 17725, "pr_title": "fix: unit test coverage for KeyVault Secrets", "pr_createdAt": "2020-11-20T13:53:03Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17725", "timeline": [{"oid": "7b85f91eb3819481100bafab30cd62b2508c668a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b85f91eb3819481100bafab30cd62b2508c668a", "message": "fix: unit test coverage for KeyVault Secrets", "committedDate": "2020-11-20T13:44:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE4MTc5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17725#discussion_r529181794", "bodyText": "The difference between this method and the one above is that this one accepts a polling duration, while both use a PollerFlux under the hood.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n          \n          \n            \n                public void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion) {", "author": "vcolin7", "createdAt": "2020-11-24T03:40:50Z", "path": "sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretAsyncClientTest.java", "diffHunk": "@@ -310,6 +310,17 @@ public void recoverDeletedSecretNotFound(HttpClient httpClient, SecretServiceVer\n             .verifyErrorSatisfies(ex -> assertRestException(ex, ResourceNotFoundException.class, HttpURLConnection.HTTP_NOT_FOUND));\n     }\n \n+    /**\n+     * Tests that an attempt to recover a non existing deleted secret throws an error on a soft-delete enabled vault.\n+     */\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {", "originalCommit": "7b85f91eb3819481100bafab30cd62b2508c668a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19304604d82d277a809077b611d9be6ee5c9cd13", "chunk": "diff --git a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretAsyncClientTest.java b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretAsyncClientTest.java\nindex 404d56235ba..500cedeec09 100644\n--- a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretAsyncClientTest.java\n+++ b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretAsyncClientTest.java\n\n@@ -315,7 +315,7 @@ public class SecretAsyncClientTest extends SecretClientTestBase {\n      */\n     @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n     @MethodSource(\"getTestParameters\")\n-    public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n+    public void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n         initializeClient(httpClient, serviceVersion);\n         StepVerifier.create(client.beginRecoverDeletedSecret(\"non-existing\", Duration.ofSeconds(1)))\n             .verifyErrorSatisfies(ex -> assertRestException(ex, ResourceNotFoundException.class, HttpURLConnection.HTTP_NOT_FOUND));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE4MjAxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17725#discussion_r529182018", "bodyText": "Same comment as above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n          \n          \n            \n                public void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion) {", "author": "vcolin7", "createdAt": "2020-11-24T03:41:43Z", "path": "sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTest.java", "diffHunk": "@@ -262,6 +262,16 @@ public void recoverDeletedSecretNotFound(HttpClient httpClient, SecretServiceVer\n         assertRestException(() -> client.beginRecoverDeletedSecret(\"non-existing\"), ResourceNotFoundException.class, HttpResponseStatus.NOT_FOUND.code());\n     }\n \n+    /**\n+     * Tests that an attempt to recover a non existing deleted secret throws an error on a soft-delete enabled vault.\n+     */\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {", "originalCommit": "7b85f91eb3819481100bafab30cd62b2508c668a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19304604d82d277a809077b611d9be6ee5c9cd13", "chunk": "diff --git a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTest.java b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTest.java\nindex ef1b6113ac5..0bc060f0f45 100644\n--- a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTest.java\n+++ b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTest.java\n\n@@ -267,7 +267,7 @@ public class SecretClientTest extends SecretClientTestBase {\n      */\n     @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n     @MethodSource(\"getTestParameters\")\n-    public void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n+    public void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion) {\n         initializeClient(httpClient, serviceVersion);\n         assertRestException(() -> client.beginRecoverDeletedSecret(\"non-existing\", Duration.ofSeconds(1)), ResourceNotFoundException.class, HttpResponseStatus.NOT_FOUND.code());\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTE4MjA5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17725#discussion_r529182090", "bodyText": "Same comment as above.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public abstract void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion);\n          \n          \n            \n                public abstract void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion);", "author": "vcolin7", "createdAt": "2020-11-24T03:41:56Z", "path": "sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java", "diffHunk": "@@ -248,6 +248,9 @@ void recoverDeletedSecretRunner(Consumer<KeyVaultSecret> testRunner) {\n     @Test\n     public abstract void recoverDeletedSecretNotFound(HttpClient httpClient, SecretServiceVersion serviceVersion);\n \n+    @Test\n+    public abstract void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion);", "originalCommit": "7b85f91eb3819481100bafab30cd62b2508c668a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19304604d82d277a809077b611d9be6ee5c9cd13", "chunk": "diff --git a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java\nindex 9de74b8ca6c..a6f175d36fe 100644\n--- a/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java\n+++ b/sdk/keyvault/azure-security-keyvault-secrets/src/test/java/com/azure/security/keyvault/secrets/SecretClientTestBase.java\n\n@@ -249,7 +249,7 @@ public abstract class SecretClientTestBase extends TestBase {\n     public abstract void recoverDeletedSecretNotFound(HttpClient httpClient, SecretServiceVersion serviceVersion);\n \n     @Test\n-    public abstract void recoverDeletedSecretNotFoundWithPoller(HttpClient httpClient, SecretServiceVersion serviceVersion);\n+    public abstract void recoverDeletedSecretNotFoundWithPollingDuration(HttpClient httpClient, SecretServiceVersion serviceVersion);\n \n     @Test\n     public abstract void backupSecret(HttpClient httpClient, SecretServiceVersion serviceVersion);\n"}}, {"oid": "19304604d82d277a809077b611d9be6ee5c9cd13", "url": "https://github.com/Azure/azure-sdk-for-java/commit/19304604d82d277a809077b611d9be6ee5c9cd13", "message": "fixes: naming convention as suggested", "committedDate": "2020-11-24T17:45:00Z", "type": "commit"}]}