{"pr_number": 7130, "pr_title": "Reactor netty connection pooling", "pr_createdAt": "2020-01-05T10:18:57Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7130", "timeline": [{"oid": "61f466e96a22c3bb87814660ca726728f95f1de0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/61f466e96a22c3bb87814660ca726728f95f1de0", "message": "Added some logging around open connections", "committedDate": "2019-12-18T06:09:40Z", "type": "commit"}, {"oid": "a3ac4b5cc9737ad1a1f06afba7db2a9ad246e8ca", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a3ac4b5cc9737ad1a1f06afba7db2a9ad246e8ca", "message": "Removed extra logging", "committedDate": "2019-12-19T01:52:06Z", "type": "commit"}, {"oid": "a29cabd22d2334ef2ad90424fcd6dc9f76403428", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a29cabd22d2334ef2ad90424fcd6dc9f76403428", "message": "Removed dispose calls to re-use connection", "committedDate": "2020-01-05T10:04:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTI2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7130#discussion_r363105263", "bodyText": "Might the method override be removed now that the body of close is empty?", "author": "David-Noble-at-work", "createdAt": "2020-01-05T17:03:39Z", "path": "sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/http/ReactorNettyClient.java", "diffHunk": "@@ -172,31 +172,26 @@ public HttpHeaders headers() {\n \n         @Override\n         public Flux<ByteBuf> body() {\n-            return bodyIntern().doFinally(s -> this.close());\n+            return bodyIntern();\n         }\n \n         @Override\n         public Mono<byte[]> bodyAsByteArray() {\n-            return bodyIntern().aggregate().asByteArray().doFinally(s -> this.close());\n+            return bodyIntern().aggregate().asByteArray();\n         }\n \n         @Override\n         public Mono<String> bodyAsString() {\n-            return bodyIntern().aggregate().asString().doFinally(s -> this.close());\n+            return bodyIntern().aggregate().asString();\n         }\n \n         @Override\n         public Mono<String> bodyAsString(Charset charset) {\n-            return bodyIntern().aggregate().asString(charset).doFinally(s -> this.close());\n+            return bodyIntern().aggregate().asString(charset);\n         }\n \n         @Override\n         public void close() {\n-            if (reactorNettyConnection.channel().eventLoop().inEventLoop()) {\n-                reactorNettyConnection.dispose();\n-            } else {\n-                reactorNettyConnection.channel().eventLoop().execute(reactorNettyConnection::dispose);\n-            }\n         }", "originalCommit": "a29cabd22d2334ef2ad90424fcd6dc9f76403428", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwODE1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7130#discussion_r363108156", "bodyText": "Makes sense, will remove the empty method.", "author": "kushagraThapar", "createdAt": "2020-01-05T18:03:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTI2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwOTAwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7130#discussion_r363109004", "bodyText": "Done", "author": "kushagraThapar", "createdAt": "2020-01-05T18:22:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNTI2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b0b9b05fd266949d96d1949904a3e38c6e9011f7", "chunk": "diff --git a/sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/http/ReactorNettyClient.java b/sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/http/ReactorNettyClient.java\nindex f44b4d15b8e..424f4886b77 100644\n--- a/sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/http/ReactorNettyClient.java\n+++ b/sdk/cosmos/microsoft-azure-cosmos/src/main/java/com/azure/data/cosmos/internal/http/ReactorNettyClient.java\n\n@@ -190,10 +190,6 @@ class ReactorNettyClient implements HttpClient {\n             return bodyIntern().aggregate().asString(charset);\n         }\n \n-        @Override\n-        public void close() {\n-        }\n-\n         private ByteBufFlux bodyIntern() {\n             return reactorNettyConnection.inbound().receive();\n         }\n"}}, {"oid": "b0b9b05fd266949d96d1949904a3e38c6e9011f7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0b9b05fd266949d96d1949904a3e38c6e9011f7", "message": "Removed empty close method", "committedDate": "2020-01-05T18:10:11Z", "type": "commit"}, {"oid": "e70554038817eee7bf214044f9c94ac54a468c9e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e70554038817eee7bf214044f9c94ac54a468c9e", "message": "Merge branch 'master' into reactor-netty-connection-pooling", "committedDate": "2020-01-05T18:10:56Z", "type": "commit"}]}