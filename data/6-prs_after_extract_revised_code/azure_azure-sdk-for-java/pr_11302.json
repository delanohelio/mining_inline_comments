{"pr_number": 11302, "pr_title": "mgmt update default subscription logic", "pr_createdAt": "2020-05-19T09:05:05Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11302", "timeline": [{"oid": "d84b3bce8b0a37fdb1430384e4cd188d22182a49", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d84b3bce8b0a37fdb1430384e4cd188d22182a49", "message": "mgmt update default subscription logic", "committedDate": "2020-05-19T08:52:38Z", "type": "commit"}, {"oid": "c693a51fa3cfc754f52dfe44e99de31378c53530", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c693a51fa3cfc754f52dfe44e99de31378c53530", "message": "fix checkstyle", "committedDate": "2020-05-19T08:58:24Z", "type": "commit"}, {"oid": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "message": "fix comment", "committedDate": "2020-05-19T09:05:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MDg3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427150873", "bodyText": "Is it possible to find a more specific exception type? RuntimeException is generally only viewed as abstract base class. Maybe IllegalStateException, or InvalidArgumentException (if we take that defaultSubscription only works for 1 subscription).", "author": "weidongxu-microsoft", "createdAt": "2020-05-19T09:12:08Z", "path": "sdk/management/azure/src/main/java/com/azure/management/Azure.java", "diffHunk": "@@ -325,8 +331,25 @@ public Azure withSubscription(String subscriptionId) {\n         @Override\n         public Azure withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                throw logger.logExceptionAsError(\n-                    new IllegalArgumentException(\"Please specify the subscription ID for resource management.\"));\n+                List<Subscription> subscriptions = new ArrayList<>();\n+                this.subscriptions().list().forEach(subscription -> {\n+                    subscriptions.add(subscription);\n+                });\n+                if (subscriptions.size() == 0) {\n+                    throw logger.logExceptionAsError(\n+                        new RuntimeException(\"Please create a subscription before you start resource management. \"", "originalCommit": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2MjE0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427162146", "bodyText": "Two candidates:\n\nIllegalStateException :\n\n\nSignals that a method has been invoked at an illegal or inappropriate time. In other words, the Java environment or Java application is not in an appropriate state for the requested operation.\n\n\nUnsupportedOperationException :\n\n\nThrown to indicate that the requested operation is not supported.\n\nMaybe UnsupportedOperationException is better? The withDefaultSubscription() is not supported when no subscription found or more than one subscription found.", "author": "xseeseesee", "createdAt": "2020-05-19T09:30:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MDg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2NDY1Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427164656", "bodyText": "UnsupportedOperationException is not good here. It is most commonly used in optional operation, which can be left unimplemented at all (like https://docs.oracle.com/javase/7/docs/api/java/util/Collection.html#add(E)).\nSo I would vote IllegalStateException.", "author": "weidongxu-microsoft", "createdAt": "2020-05-19T09:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MDg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE2OTA4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427169084", "bodyText": "Got it. It's not the same as InvalidOperationException in csharp. So it's like the withDefaultSubscription() cannot be done at this time due to some restrictions if we pick IllegalStateException.", "author": "xseeseesee", "createdAt": "2020-05-19T09:41:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MDg3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6195ffdeb86e644721914fb71d15595483cb094d", "chunk": "diff --git a/sdk/management/azure/src/main/java/com/azure/management/Azure.java b/sdk/management/azure/src/main/java/com/azure/management/Azure.java\nindex 47ad183d5db..db109977f73 100644\n--- a/sdk/management/azure/src/main/java/com/azure/management/Azure.java\n+++ b/sdk/management/azure/src/main/java/com/azure/management/Azure.java\n\n@@ -331,25 +327,7 @@ public final class Azure {\n         @Override\n         public Azure withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                List<Subscription> subscriptions = new ArrayList<>();\n-                this.subscriptions().list().forEach(subscription -> {\n-                    subscriptions.add(subscription);\n-                });\n-                if (subscriptions.size() == 0) {\n-                    throw logger.logExceptionAsError(\n-                        new RuntimeException(\"Please create a subscription before you start resource management. \"\n-                            + \"To learn more, see: https://azure.microsoft.com/en-us/free/.\"));\n-                } else if (subscriptions.size() > 1) {\n-                    StringBuilder stringBuilder = new StringBuilder();\n-                    stringBuilder.append(\"More than one subscription found in your tenant. \"\n-                        + \"Please specify which one below is desired for resource management.\");\n-                    subscriptions.forEach(subscription -> {\n-                        stringBuilder.append(\"\\n\" + subscription.displayName() + \" : \" + subscription.subscriptionId());\n-                    });\n-                    throw logger.logExceptionAsError(new RuntimeException(stringBuilder.toString()));\n-                } else {\n-                    profile.withSubscriptionId(subscriptions.get(0).subscriptionId());\n-                }\n+                profile.withSubscriptionId(Utils.subscriptionId(this.subscriptions().list()));\n             }\n             return new Azure(httpPipeline, profile, this);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzE1MTc3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11302#discussion_r427151772", "bodyText": "Is it possible to share some code?\nMaybe Azure could call some util method in Resources?", "author": "weidongxu-microsoft", "createdAt": "2020-05-19T09:13:32Z", "path": "sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java", "diffHunk": "@@ -192,8 +198,25 @@ public ResourceManager withSubscription(String subscriptionId) {\n         @Override\n         public ResourceManager withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                throw logger.logExceptionAsError(\n-                    new IllegalArgumentException(\"Please specify the subscription ID for resource management.\"));\n+                List<Subscription> subscriptions = new ArrayList<>();\n+                this.subscriptions().list().forEach(subscription -> {\n+                    subscriptions.add(subscription);\n+                });\n+                if (subscriptions.size() == 0) {", "originalCommit": "3f97d7f9b1859df2c3b7eceab12f76fcf48b2de5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6195ffdeb86e644721914fb71d15595483cb094d", "chunk": "diff --git a/sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java b/sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java\nindex 0bb1c9ef7a4..031c3e032af 100644\n--- a/sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java\n+++ b/sdk/resources/mgmt/src/main/java/com/azure/management/resources/implementation/ResourceManager.java\n\n@@ -198,25 +193,7 @@ public final class ResourceManager extends ManagerBase implements HasInner<Resou\n         @Override\n         public ResourceManager withDefaultSubscription() {\n             if (profile.subscriptionId() == null) {\n-                List<Subscription> subscriptions = new ArrayList<>();\n-                this.subscriptions().list().forEach(subscription -> {\n-                    subscriptions.add(subscription);\n-                });\n-                if (subscriptions.size() == 0) {\n-                    throw logger.logExceptionAsError(\n-                        new RuntimeException(\"Please create a subscription before you start resource management. \"\n-                            + \"To learn more, see: https://azure.microsoft.com/en-us/free/.\"));\n-                } else if (subscriptions.size() > 1) {\n-                    StringBuilder stringBuilder = new StringBuilder();\n-                    stringBuilder.append(\"More than one subscription found in your tenant. \"\n-                        + \"Please specify which one below is desired for resource management.\");\n-                    subscriptions.forEach(subscription -> {\n-                        stringBuilder.append(\"\\n\" + subscription.displayName() + \" : \" + subscription.subscriptionId());\n-                    });\n-                    throw logger.logExceptionAsError(new RuntimeException(stringBuilder.toString()));\n-                } else {\n-                    profile.withSubscriptionId(subscriptions.get(0).subscriptionId());\n-                }\n+                profile.withSubscriptionId(Utils.subscriptionId(this.subscriptions().list()));\n             }\n             return new ResourceManager(httpPipeline, profile, sdkContext);\n         }\n"}}, {"oid": "9f250c98bc9fc591c0cb29f5945e5c4c9ce82ff9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9f250c98bc9fc591c0cb29f5945e5c4c9ce82ff9", "message": "Merge branch 'master' into update-azure-client", "committedDate": "2020-05-20T02:22:18Z", "type": "commit"}, {"oid": "6195ffdeb86e644721914fb71d15595483cb094d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6195ffdeb86e644721914fb71d15595483cb094d", "message": "use IllegalStateException instead of RuntimeException", "committedDate": "2020-05-20T03:09:01Z", "type": "commit"}, {"oid": "e94f2f550586ed04f70c496411da916c6437b4a9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e94f2f550586ed04f70c496411da916c6437b4a9", "message": "update description", "committedDate": "2020-05-20T04:53:24Z", "type": "commit"}]}