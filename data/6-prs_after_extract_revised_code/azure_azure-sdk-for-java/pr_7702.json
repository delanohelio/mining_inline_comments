{"pr_number": 7702, "pr_title": "Improve performance of default logger", "pr_createdAt": "2020-01-24T20:51:40Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7702", "timeline": [{"oid": "3a811a69eb50ad6d6c29e64e067751a9e66b5be5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a811a69eb50ad6d6c29e64e067751a9e66b5be5", "message": "Performance improvements to DefaultLogger", "committedDate": "2020-01-21T22:22:22Z", "type": "commit"}, {"oid": "fa2229ffb5ae37d4b62e0ad89d6f17bb294cab60", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa2229ffb5ae37d4b62e0ad89d6f17bb294cab60", "message": "Logger performance", "committedDate": "2020-01-24T05:40:49Z", "type": "commit"}, {"oid": "26b9a0e915541ca56bb8cc18dfb0d091cd474875", "url": "https://github.com/Azure/azure-sdk-for-java/commit/26b9a0e915541ca56bb8cc18dfb0d091cd474875", "message": "Remove unwanted code", "committedDate": "2020-01-24T10:52:21Z", "type": "commit"}, {"oid": "af79c5a76aeefc3921c93dbb2de703ad39426672", "url": "https://github.com/Azure/azure-sdk-for-java/commit/af79c5a76aeefc3921c93dbb2de703ad39426672", "message": "Cleanup", "committedDate": "2020-01-24T11:21:33Z", "type": "commit"}, {"oid": "bffbbb1a101fbaea8a233c16af8e3678e352c408", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bffbbb1a101fbaea8a233c16af8e3678e352c408", "message": "Fix unit tests", "committedDate": "2020-01-24T11:31:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA0MDU1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#discussion_r371040553", "bodyText": "configuredLogLevel is only ever set here in the constructor. I wonder if it is worth doing a micro-optimisation here to determine which log levels are valid and pre-compute the boolean conditions here, to simplify the isTraceEnabled, etc methods?", "author": "JonathanGiles", "createdAt": "2020-01-27T00:37:12Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java", "diffHunk": "@@ -45,11 +52,16 @@ public DefaultLogger(Class<?> clazz) {\n      * class name passes in.\n      */\n     public DefaultLogger(String className) {\n+        String classPath;\n         try {\n-            this.classPath = Class.forName(className).getCanonicalName();\n+            classPath = Class.forName(className).getCanonicalName();\n         } catch (ClassNotFoundException e) {\n-            this.classPath = className;\n+            classPath = className;\n         }\n+        this.classPath = classPath;\n+        this.configuredLogLevel =\n+            LogLevel.fromString(Configuration.getGlobalConfiguration().get(Configuration.PROPERTY_AZURE_LOG_LEVEL))\n+                .getLogLevel();", "originalCommit": "bffbbb1a101fbaea8a233c16af8e3678e352c408", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA2OTU5OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7702#discussion_r371069598", "bodyText": "Yeah, I had initially done it that way to have booleans for each of the log levels but the performance improvements were not noticeable by doing that way vs the current approach.\nMoreover, is*Enabled methods in DefaultLogger are much faster than their logback counterparts (557664530 ops/sec vs 501866764 ops/sec). So, didn't want to micro-optimize.\nHowever, if you think evaluating it once in the constructor will improve overall readability, I am fine with making this change.", "author": "srnagar", "createdAt": "2020-01-27T05:38:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTA0MDU1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "08d87e0d8a315ca37a49ee494ad60c1f207d1aaa", "chunk": "diff --git a/sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java b/sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java\nindex 007e0a861f0..628c25e5b38 100644\n--- a/sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java\n+++ b/sdk/core/azure-core/src/main/java/com/azure/core/implementation/logging/DefaultLogger.java\n\n@@ -59,9 +63,16 @@ public final class DefaultLogger extends MarkerIgnoringBase {\n             classPath = className;\n         }\n         this.classPath = classPath;\n-        this.configuredLogLevel =\n+        int configuredLogLevel =\n             LogLevel.fromString(Configuration.getGlobalConfiguration().get(Configuration.PROPERTY_AZURE_LOG_LEVEL))\n                 .getLogLevel();\n+\n+        isTraceEnabled = LogLevel.VERBOSE.getLogLevel() > configuredLogLevel;\n+        isDebugEnabled = LogLevel.VERBOSE.getLogLevel() >= configuredLogLevel;\n+        isInfoEnabled = LogLevel.INFORMATIONAL.getLogLevel() >= configuredLogLevel;\n+        isWarnEnabled = LogLevel.WARNING.getLogLevel() >= configuredLogLevel;\n+        isErrorEnabled = LogLevel.ERROR.getLogLevel() >= configuredLogLevel;\n+\n     }\n \n     /**\n"}}, {"oid": "08d87e0d8a315ca37a49ee494ad60c1f207d1aaa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/08d87e0d8a315ca37a49ee494ad60c1f207d1aaa", "message": "Pre-compute log level enabled check", "committedDate": "2020-01-27T23:49:11Z", "type": "commit"}]}