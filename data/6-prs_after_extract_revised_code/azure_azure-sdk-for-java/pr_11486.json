{"pr_number": 11486, "pr_title": "Added a null check for a JsonWebKey's id in CryptographyAsyncClient.", "pr_createdAt": "2020-05-28T01:05:07Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11486", "timeline": [{"oid": "93ab295ac899999da6911e0d02b9eb0e5ddcc8d6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/93ab295ac899999da6911e0d02b9eb0e5ddcc8d6", "message": "Added a null check for a JsonWebKey's id in CryptographyAsyncClient.", "committedDate": "2020-05-28T01:02:03Z", "type": "commit"}, {"oid": "df0207d8ce6b4876edce5b4bd9b230e21354d2db", "url": "https://github.com/Azure/azure-sdk-for-java/commit/df0207d8ce6b4876edce5b4bd9b230e21354d2db", "message": "Modified tests for JWK id null check.", "committedDate": "2020-05-28T05:53:25Z", "type": "commit"}, {"oid": "df0207d8ce6b4876edce5b4bd9b230e21354d2db", "url": "https://github.com/Azure/azure-sdk-for-java/commit/df0207d8ce6b4876edce5b4bd9b230e21354d2db", "message": "Modified tests for JWK id null check.", "committedDate": "2020-05-28T05:53:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjcyOTE2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11486#discussion_r432729166", "bodyText": "Adding the check here, means LocalCryptographyClient will be required to provide an id too.\nThis seems like a requirement only for LocalKeyEncryptionKeyClient / LocalKeyEncryptionKeyAsyncClient", "author": "g2vinay", "createdAt": "2020-05-29T20:51:36Z", "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/CryptographyAsyncClient.java", "diffHunk": "@@ -79,6 +79,9 @@\n         if (!jsonWebKey.isValid()) {\n             throw new IllegalArgumentException(\"Json Web Key is not valid\");\n         }\n+        if (jsonWebKey.getId() == null) {\n+            throw new IllegalArgumentException(\"Json Web Key's id property is not configured\");", "originalCommit": "df0207d8ce6b4876edce5b4bd9b230e21354d2db", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e61c497246f58047d8ed0cc99a73846d1978ebe1", "chunk": "diff --git a/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/CryptographyAsyncClient.java b/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/CryptographyAsyncClient.java\nindex 8103212eb42..59875958301 100644\n--- a/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/CryptographyAsyncClient.java\n+++ b/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/CryptographyAsyncClient.java\n\n@@ -79,13 +79,9 @@ public class CryptographyAsyncClient {\n         if (!jsonWebKey.isValid()) {\n             throw new IllegalArgumentException(\"Json Web Key is not valid\");\n         }\n-        if (jsonWebKey.getId() == null) {\n-            throw new IllegalArgumentException(\"Json Web Key's id property is not configured\");\n-        }\n         if (jsonWebKey.getKeyOps() == null) {\n             throw new IllegalArgumentException(\"Json Web Key's key operations property is not configured\");\n         }\n-\n         if (jsonWebKey.getKeyType() == null) {\n             throw new IllegalArgumentException(\"Json Web Key's key type property is not configured\");\n         }\n"}}, {"oid": "e61c497246f58047d8ed0cc99a73846d1978ebe1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e61c497246f58047d8ed0cc99a73846d1978ebe1", "message": "Moved Key ID validation from CryptographyAsyncClient to LocalKeyEncryptionKeyClientBuilder. Changed test files to reflect this.", "committedDate": "2020-06-01T05:53:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyMDcwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11486#discussion_r435620701", "bodyText": "Update the docs above to reflect the exception.", "author": "g2vinay", "createdAt": "2020-06-04T23:59:01Z", "path": "sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/LocalKeyEncryptionKeyClientBuilder.java", "diffHunk": "@@ -58,6 +58,9 @@ public KeyEncryptionKey buildKeyEncryptionKey(JsonWebKey key) {\n         if (key == null) {\n             throw logger.logExceptionAsError(new IllegalStateException(\n                 \"Json Web key value cannot be null and is required to create local key encryption key async client.\"));\n+        } else if (key.getId() == null) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(", "originalCommit": "e61c497246f58047d8ed0cc99a73846d1978ebe1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0b2f6f7ef61724e6fe72498cd111a75949828c76", "chunk": "diff --git a/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/LocalKeyEncryptionKeyClientBuilder.java b/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/LocalKeyEncryptionKeyClientBuilder.java\nindex 8fe34da83d0..6f7316962e0 100644\n--- a/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/LocalKeyEncryptionKeyClientBuilder.java\n+++ b/sdk/keyvault/azure-security-keyvault-keys/src/main/java/com/azure/security/keyvault/keys/cryptography/LocalKeyEncryptionKeyClientBuilder.java\n\n@@ -53,6 +53,7 @@ public final class LocalKeyEncryptionKeyClientBuilder {\n      *\n      * @return A {@link LocalKeyEncryptionKeyAsyncClient} with the options set from the builder.\n      * @throws IllegalStateException If {@code key} is not set.\n+     * @throws IllegalArgumentException If {@code key} has no id.\n      */\n     public Mono<? extends AsyncKeyEncryptionKey> buildAsyncKeyEncryptionKey(JsonWebKey key) {\n         if (key == null) {\n"}}, {"oid": "0b2f6f7ef61724e6fe72498cd111a75949828c76", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0b2f6f7ef61724e6fe72498cd111a75949828c76", "message": "Updated Javadoc on `LocalKeyEncryptionKeyClientBuilder.buildAsyncKeyEncryptionKey`", "committedDate": "2020-06-05T20:26:53Z", "type": "commit"}, {"oid": "0b2f6f7ef61724e6fe72498cd111a75949828c76", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0b2f6f7ef61724e6fe72498cd111a75949828c76", "message": "Updated Javadoc on `LocalKeyEncryptionKeyClientBuilder.buildAsyncKeyEncryptionKey`", "committedDate": "2020-06-05T20:26:53Z", "type": "forcePushed"}]}