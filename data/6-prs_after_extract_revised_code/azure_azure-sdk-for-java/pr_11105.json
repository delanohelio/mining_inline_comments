{"pr_number": 11105, "pr_title": "Updated direct connection config APIs and docs", "pr_createdAt": "2020-05-12T22:41:32Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/11105", "timeline": [{"oid": "e2b0f16b32d4d85602d28344bdc36956faea2424", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e2b0f16b32d4d85602d28344bdc36956faea2424", "message": "Updated direct connection config APIs and docs", "committedDate": "2020-05-12T22:40:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NTI3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424075272", "bodyText": "what does 0 as idle connection timeout mean?", "author": "moderakh", "createdAt": "2020-05-12T22:43:08Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -10,26 +10,25 @@\n  */\n public final class DirectConnectionConfig {\n     //  Constants\n-    private static final Duration DEFAULT_IDLE_CHANNEL_TIMEOUT = Duration.ZERO;\n     private static final Duration DEFAULT_IDLE_ENDPOINT_TIMEOUT = Duration.ofSeconds(70L);\n-    private static final int DEFAULT_MAX_CHANNELS_PER_ENDPOINT = 30;\n+    private static final int DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT = 30;\n     private static final int DEFAULT_MAX_REQUESTS_PER_ENDPOINT = 10;\n \n     private Duration connectionTimeout;\n-    private Duration idleChannelTimeout;\n+    private Duration idleConnectionTimeout;\n     private Duration idleEndpointTimeout;\n-    private int maxChannelsPerEndpoint;\n-    private int maxRequestsPerChannel;\n+    private int maxConnectionsPerEndpoint;\n+    private int maxRequestsPerConnection;\n \n     /**\n      * Constructor.\n      */\n     public DirectConnectionConfig() {\n         this.connectionTimeout = null;\n-        this.idleChannelTimeout = DEFAULT_IDLE_CHANNEL_TIMEOUT;\n+        this.idleConnectionTimeout = Duration.ZERO;", "originalCommit": "e2b0f16b32d4d85602d28344bdc36956faea2424", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NjU1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424076553", "bodyText": "I have referred this in docs in get/set API.", "author": "kushagraThapar", "createdAt": "2020-05-12T22:46:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NTI3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex 9d78606aa4b..d7986345861 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -24,7 +24,6 @@ public final class DirectConnectionConfig {\n      * Constructor.\n      */\n     public DirectConnectionConfig() {\n-        this.connectionTimeout = null;\n         this.idleConnectionTimeout = Duration.ZERO;\n         this.idleEndpointTimeout = DEFAULT_IDLE_ENDPOINT_TIMEOUT;\n         this.maxConnectionsPerEndpoint = DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NTc3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424075778", "bodyText": "this.connectionTimeout = null;\t\nwhy is this null?", "author": "moderakh", "createdAt": "2020-05-12T22:44:33Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -10,26 +10,25 @@\n  */\n public final class DirectConnectionConfig {\n     //  Constants\n-    private static final Duration DEFAULT_IDLE_CHANNEL_TIMEOUT = Duration.ZERO;\n     private static final Duration DEFAULT_IDLE_ENDPOINT_TIMEOUT = Duration.ofSeconds(70L);\n-    private static final int DEFAULT_MAX_CHANNELS_PER_ENDPOINT = 30;\n+    private static final int DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT = 30;\n     private static final int DEFAULT_MAX_REQUESTS_PER_ENDPOINT = 10;\n \n     private Duration connectionTimeout;\n-    private Duration idleChannelTimeout;\n+    private Duration idleConnectionTimeout;\n     private Duration idleEndpointTimeout;\n-    private int maxChannelsPerEndpoint;\n-    private int maxRequestsPerChannel;\n+    private int maxConnectionsPerEndpoint;\n+    private int maxRequestsPerConnection;\n \n     /**\n      * Constructor.\n      */\n     public DirectConnectionConfig() {\n         this.connectionTimeout = null;", "originalCommit": "e2b0f16b32d4d85602d28344bdc36956faea2424", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODYzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424098632", "bodyText": "will get rid of the redundant initializer.", "author": "kushagraThapar", "createdAt": "2020-05-12T23:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3NTc3OA=="}], "type": "inlineReview", "revised_code": {"commit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex 9d78606aa4b..d7986345861 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -24,7 +24,6 @@ public final class DirectConnectionConfig {\n      * Constructor.\n      */\n     public DirectConnectionConfig() {\n-        this.connectionTimeout = null;\n         this.idleConnectionTimeout = Duration.ZERO;\n         this.idleEndpointTimeout = DEFAULT_IDLE_ENDPOINT_TIMEOUT;\n         this.maxConnectionsPerEndpoint = DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3Njg2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424076864", "bodyText": "if the user switches to DirectHttps some of these will not be relevant.", "author": "moderakh", "createdAt": "2020-05-12T22:47:34Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -98,49 +117,57 @@ public DirectConnectionConfig setIdleEndpointTimeout(Duration idleEndpointTimeou\n     }\n \n     /**\n-     * Gets the max channels per endpoint\n-     * @return the max channels per endpoint\n+     * Gets the max connections per endpoint\n+     * Default value is 30\n+     *\n+     * @return the max connections per endpoint\n      */\n-    public int getMaxChannelsPerEndpoint() {\n-        return maxChannelsPerEndpoint;\n+    public int getMaxConnectionsPerEndpoint() {\n+        return maxConnectionsPerEndpoint;\n     }\n \n     /**\n-     * Sets the max channels per endpoint\n-     * @param maxChannelsPerEndpoint the max channels per endpoint\n+     * Sets the max connections per endpoint\n+     * Default value is 30\n+     *\n+     * @param maxConnectionsPerEndpoint the max connections per endpoint\n      * @return the {@link DirectConnectionConfig}\n      */\n-    public DirectConnectionConfig setMaxChannelsPerEndpoint(int maxChannelsPerEndpoint) {\n-        this.maxChannelsPerEndpoint = maxChannelsPerEndpoint;\n+    public DirectConnectionConfig setMaxConnectionsPerEndpoint(int maxConnectionsPerEndpoint) {\n+        this.maxConnectionsPerEndpoint = maxConnectionsPerEndpoint;\n         return this;\n     }\n \n     /**\n-     * Gets the max requests per endpoint\n+     * Gets the max requests per connection per endpoint\n+     * Default value is 10\n+     *\n      * @return the max requests per endpoint\n      */\n-    public int getMaxRequestsPerChannel() {\n-        return maxRequestsPerChannel;\n+    public int getMaxRequestsPerConnection() {", "originalCommit": "e2b0f16b32d4d85602d28344bdc36956faea2424", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5ODQ2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424098469", "bodyText": "Yups, DirectHttps is anyway not supported programatically. We also don't want to encourage it, but I get your point.\nMay be we should call this config as DirectTcpConnectionConfig ?", "author": "kushagraThapar", "createdAt": "2020-05-12T23:54:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3Njg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5OTAzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424199030", "bodyText": "Direct from CX will always be TCP.\nHttps might be hacky workaround which is best avoided (Service team doesn't recommended it).\nRefering HTTPS in code docs if-any will lead a ambiguity/confuson.\nIf Https is configured and some are not applicable, one options to fail at runtime which is okey.", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA3Njg2NA=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex 9d78606aa4b..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -118,6 +135,8 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the max connections per endpoint\n+     * This represents the size of connection pool for a specific endpoint\n+     *\n      * Default value is 30\n      *\n      * @return the max connections per endpoint\n"}}, {"oid": "21fc319ed05ed3195f3d315ea07837e15c397b15", "url": "https://github.com/Azure/azure-sdk-for-java/commit/21fc319ed05ed3195f3d315ea07837e15c397b15", "message": "Removed redundant initializer", "committedDate": "2020-05-13T00:35:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5MzM3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424193370", "bodyText": "Is 'direct client' mean Direct TCP connection?\nClient & connection overload confusing.", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:10:15Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +39,20 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU0OTQzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424549435", "bodyText": "direct client means direct tcp client itself, and not connections.\ndirect client creates connections, and this timeout defines how much time before we drop connection establishment.", "author": "kushagraThapar", "createdAt": "2020-05-13T15:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5MzM3MA=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -41,7 +45,11 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the connection timeout for direct client,\n-     * represents timeout for establishing connections with an endpoint\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDE0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424194149", "bodyText": "Is it to keep the connections warm?\nHow are broken connections identified? How will it impact the latencies/performance?", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:12:32Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -62,25 +62,38 @@ public DirectConnectionConfig setConnectionTimeout(Duration connectionTimeout) {\n     }\n \n     /**\n-     * Gets the idle channel timeout\n-     * @return idle channel timeout\n+     * Gets the idle connection timeout for direct client\n+     * Default value is {@link Duration#ZERO}", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MjExMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424582110", "bodyText": "Yes, to keep connections warm. When the connections are closed, rntbd logs it.\nWe have seen a connection establishment takes anywhere between 200ms - 300ms .", "author": "kushagraThapar", "createdAt": "2020-05-13T16:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDE0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -63,8 +75,10 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the idle connection timeout for direct client\n+     *\n      * Default value is {@link Duration#ZERO}\n-     * Direct client doesn't close connections to an endpoint\n+     *\n+     * Direct client doesn't close a single connection to an endpoint\n      * by default unless specified.\n      *\n      * @return idle connection timeout\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDQxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424194419", "bodyText": "Guidance on when to tune to what values will help CX.", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:13:08Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +39,20 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,\n+     * represents timeout for establishing connections with an endpoint\n+     *", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NTgyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424575825", "bodyText": "Guidance on these can vary based on customer, case to case. Referring material in perf guide will help and as you mentioned we can refer the perf guide in this docs.", "author": "kushagraThapar", "createdAt": "2020-05-13T16:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDQxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -41,7 +45,11 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the connection timeout for direct client,\n-     * represents timeout for establishing connections with an endpoint\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDcyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424194725", "bodyText": "Cover defaults details.", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:13:54Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +39,20 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,\n+     * represents timeout for establishing connections with an endpoint\n+     *\n      * @return direct connection timeout\n      */\n     public Duration getConnectionTimeout() {\n         return connectionTimeout;\n     }\n \n     /**\n-     *  Sets the direct connection timeout\n+     *  Sets the connection timeout for direct client,", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NTkzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424575932", "bodyText": "Will do.", "author": "kushagraThapar", "createdAt": "2020-05-13T16:34:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NDcyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -41,7 +45,11 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the connection timeout for direct client,\n-     * represents timeout for establishing connections with an endpoint\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NTUyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424195524", "bodyText": "Include references to the Java perf best practices.", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:16:08Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -10,26 +10,24 @@\n  */\n public final class DirectConnectionConfig {\n     //  Constants\n-    private static final Duration DEFAULT_IDLE_CHANNEL_TIMEOUT = Duration.ZERO;", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3NjI2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424576262", "bodyText": "Cool, will do.", "author": "kushagraThapar", "createdAt": "2020-05-13T16:35:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5NTUyNA=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -3,10 +3,14 @@\n \n package com.azure.cosmos;\n \n+import io.netty.channel.ChannelOption;\n+\n import java.time.Duration;\n \n /**\n  * Represents the connection config with {@link ConnectionMode#DIRECT} associated with Cosmos Client in the Azure Cosmos DB database service.\n+ * For performance tips on how to optimize Direct connection configuration,\n+ * refer to performance tips guide: https://docs.microsoft.com/en-us/azure/cosmos-db/performance-tips-java-sdk-v4-sql?tabs=api-async\n  */\n public final class DirectConnectionConfig {\n     //  Constants\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5ODAzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424198039", "bodyText": "Am not fully clear on endpointIdletimeout vs connecitonideltimeout.\nLets please cover at depth the details.\nHow about a conceptual MD file in Github which can be referenced?\nWe can extend it with patterns and guidance (some parts might eventually get promoted to docs).\nAlso please refer the performance guide references across code docs extensively.\n/cc: @David-Noble-at-work , @moderakh", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:23:05Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -98,49 +116,57 @@ public DirectConnectionConfig setIdleEndpointTimeout(Duration idleEndpointTimeou\n     }\n \n     /**\n-     * Gets the max channels per endpoint\n-     * @return the max channels per endpoint\n+     * Gets the max connections per endpoint\n+     * Default value is 30", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU3OTUyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424579524", "bodyText": "endpoint is a pool of connections per replica. I will improve the documentation around this.\nWe initially had a MD file explaining Rntbd architecture. I will work with @David-Noble-at-work  to introduce it back if we can.", "author": "kushagraThapar", "createdAt": "2020-05-13T16:40:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE5ODAzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -117,6 +135,8 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the max connections per endpoint\n+     * This represents the size of connection pool for a specific endpoint\n+     *\n      * Default value is 30\n      *\n      * @return the max connections per endpoint\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMDExOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424200118", "bodyText": "How about stating how these manifest for netty underlying for advanced users?", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:28:42Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +39,20 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,\n+     * represents timeout for establishing connections with an endpoint\n+     *\n      * @return direct connection timeout\n      */\n     public Duration getConnectionTimeout() {", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY1OTcwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424659702", "bodyText": "Sure, will attach respective Netty links here.", "author": "kushagraThapar", "createdAt": "2020-05-13T18:52:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMDExOA=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -41,7 +45,11 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the connection timeout for direct client,\n-     * represents timeout for establishing connections with an endpoint\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMjkwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424202900", "bodyText": "connection vs socket vs others: Is there guidance or patterns from azure SDK's?", "author": "kirankumarkolli", "createdAt": "2020-05-13T06:36:05Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +39,20 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,\n+     * represents timeout for establishing connections with an endpoint\n+     *\n      * @return direct connection timeout\n      */\n     public Duration getConnectionTimeout() {", "originalCommit": "21fc319ed05ed3195f3d315ea07837e15c397b15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU4MTQ1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424581455", "bodyText": "So far we have seen connection - as that is the easiest concept for an end user.\nHttp client from azure-core -> \n  \n    \n      azure-sdk-for-java/sdk/core/azure-core-http-jdk-httpclient/src/main/java/com/azure/core/http/jdk/httpclient/JdkAsyncHttpClientBuilder.java\n    \n    \n         Line 73\n      in\n      fc26120\n    \n    \n    \n    \n\n        \n          \n           public JdkAsyncHttpClientBuilder connectionTimeout(Duration connectionTimeout) { \n        \n    \n  \n\n\nIt uses connectionTimeout as well.", "author": "kushagraThapar", "createdAt": "2020-05-13T16:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDIwMjkwMA=="}], "type": "inlineReview", "revised_code": {"commit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex d7986345861..6130f247ebe 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -41,7 +45,11 @@ public final class DirectConnectionConfig {\n \n     /**\n      * Gets the connection timeout for direct client,\n-     * represents timeout for establishing connections with an endpoint\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"oid": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6aba9ca80d32a810083f688c1c6ac37f2f498782", "message": "Updated docs with performance tips guide", "committedDate": "2020-05-13T19:00:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5NjgwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424696805", "bodyText": "DEFAULT_MAX_REQUESTS_PER_ENDPOINT should be DEFAULT_MAX_REQUESTS_PER_CONNECTION", "author": "David-Noble-at-work", "createdAt": "2020-05-13T20:00:13Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -3,33 +3,35 @@\n \n package com.azure.cosmos;\n \n+import io.netty.channel.ChannelOption;\n+\n import java.time.Duration;\n \n /**\n  * Represents the connection config with {@link ConnectionMode#DIRECT} associated with Cosmos Client in the Azure Cosmos DB database service.\n+ * For performance tips on how to optimize Direct connection configuration,\n+ * refer to performance tips guide: https://docs.microsoft.com/en-us/azure/cosmos-db/performance-tips-java-sdk-v4-sql?tabs=api-async\n  */\n public final class DirectConnectionConfig {\n     //  Constants\n-    private static final Duration DEFAULT_IDLE_CHANNEL_TIMEOUT = Duration.ZERO;\n     private static final Duration DEFAULT_IDLE_ENDPOINT_TIMEOUT = Duration.ofSeconds(70L);\n-    private static final int DEFAULT_MAX_CHANNELS_PER_ENDPOINT = 30;\n+    private static final int DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT = 30;\n     private static final int DEFAULT_MAX_REQUESTS_PER_ENDPOINT = 10;", "originalCommit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwNzYyMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424707623", "bodyText": "Good catch, thanks.", "author": "kushagraThapar", "createdAt": "2020-05-13T20:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5NjgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "5b47627d76980e6cbcd66d0ccbd95f136462674f", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex 6130f247ebe..9c4ec55867d 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -15,8 +15,9 @@ import java.time.Duration;\n public final class DirectConnectionConfig {\n     //  Constants\n     private static final Duration DEFAULT_IDLE_ENDPOINT_TIMEOUT = Duration.ofSeconds(70L);\n+    private static final Duration DEFAULT_CONNECTION_TIMEOUT = Duration.ofSeconds(60L);\n     private static final int DEFAULT_MAX_CONNECTIONS_PER_ENDPOINT = 30;\n-    private static final int DEFAULT_MAX_REQUESTS_PER_ENDPOINT = 10;\n+    private static final int DEFAULT_MAX_REQUESTS_PER_CONNECTION = 10;\n \n     private Duration connectionTimeout;\n     private Duration idleConnectionTimeout;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwMDMzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424700333", "bodyText": "It is the idleConnectionTimeout that defaults to zero. The connectTimeout defaults to the value of requestTimeout: 60 seconds prior to this PR.", "author": "David-Noble-at-work", "createdAt": "2020-05-13T20:06:59Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java", "diffHunk": "@@ -41,18 +43,28 @@ public static DirectConnectionConfig getDefaultConfig() {\n         return new DirectConnectionConfig();\n     }\n \n-    //  TODO: (DANOBLE) - To update these docs.\n-\n     /**\n-     * Gets the direct connection timeout\n+     * Gets the connection timeout for direct client,\n+     * represents timeout for establishing connections with an endpoint.\n+     *\n+     * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n+     *\n+     * By default, the connection timeout is disabled, unless specified by user.\n+     *\n      * @return direct connection timeout\n      */\n     public Duration getConnectionTimeout() {\n         return connectionTimeout;\n     }\n \n     /**\n-     *  Sets the direct connection timeout\n+     * Sets the connection timeout for direct client,", "originalCommit": "6aba9ca80d32a810083f688c1c6ac37f2f498782", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwODA5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/11105#discussion_r424708094", "bodyText": "Cool, will add default value here - and will add the constant too..", "author": "kushagraThapar", "createdAt": "2020-05-13T20:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDcwMDMzMw=="}], "type": "inlineReview", "revised_code": {"commit": "5b47627d76980e6cbcd66d0ccbd95f136462674f", "chunk": "diff --git a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\nindex 6130f247ebe..9c4ec55867d 100644\n--- a/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n+++ b/sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/DirectConnectionConfig.java\n\n@@ -49,7 +51,7 @@ public final class DirectConnectionConfig {\n      *\n      * Configures timeout for underlying Netty Channel {@link ChannelOption#CONNECT_TIMEOUT_MILLIS}\n      *\n-     * By default, the connection timeout is disabled, unless specified by user.\n+     * By default, the connection timeout is 60 seconds.\n      *\n      * @return direct connection timeout\n      */\n"}}, {"oid": "5b47627d76980e6cbcd66d0ccbd95f136462674f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b47627d76980e6cbcd66d0ccbd95f136462674f", "message": "Updated default connection timeout value and other documentation", "committedDate": "2020-05-13T20:23:59Z", "type": "commit"}]}