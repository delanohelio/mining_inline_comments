{"pr_number": 14587, "pr_title": "SB Track2 : SubQueue Implementation", "pr_createdAt": "2020-08-28T09:07:02Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/14587", "timeline": [{"oid": "4e5c4e64bd8af5d4109bcf5fde5abe2721b2b411", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4e5c4e64bd8af5d4109bcf5fde5abe2721b2b411", "message": "SubQueue Implementation", "committedDate": "2020-08-28T09:04:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMjYxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14587#discussion_r479302619", "bodyText": "I would throw instead of just logging it.", "author": "conniey", "createdAt": "2020-08-28T13:42:47Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -447,13 +439,18 @@ private static String getEntityPath(ClientLogger logger, MessagingEntityType ent\n                     new IllegalArgumentException(\"Unknown entity type: \" + entityType));\n         }\n \n-        return entityPath;\n-    }\n+        switch (subQueue) {\n+            case NONE:\n+            case TRANSFER_QUEUE:\n+                break;\n+            case DEAD_LETTER_QUEUE:\n+                entityPath += \"/$deadletterqueue\";\n+                break;\n+            default:\n+                logger.warning(\"Unsupported value of subqueue type {}.\", subQueue);", "originalCommit": "4e5c4e64bd8af5d4109bcf5fde5abe2721b2b411", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b05e8ca5df00184d15d1bf17bacce141ec3f284", "chunk": "diff --git a/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java b/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java\nindex c9bac92ea7a..42e90f70050 100644\n--- a/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java\n+++ b/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java\n\n@@ -441,13 +443,16 @@ public final class ServiceBusClientBuilder {\n \n         switch (subQueue) {\n             case NONE:\n-            case TRANSFER_QUEUE:\n+                break;\n+            case TRANSFER_DEAD_LETTER_QUEUE:\n+                entityPath += TRANSFER_DEAD_LETTER_QUEUE_NAME_SUFFIX;\n                 break;\n             case DEAD_LETTER_QUEUE:\n-                entityPath += \"/$deadletterqueue\";\n+                entityPath += DEAD_LETTER_QUEUE_NAME_SUFFIX;\n                 break;\n             default:\n-                logger.warning(\"Unsupported value of subqueue type {}.\", subQueue);\n+                throw logger.logExceptionAsError(new IllegalArgumentException(\"Unsupported value of subqueue type: \"\n+                    + subQueue));\n         }\n \n         return entityPath;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMzI4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14587#discussion_r479303287", "bodyText": "Why none? Don't we have some parameter user's set?", "author": "conniey", "createdAt": "2020-08-28T13:43:27Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusClientBuilder.java", "diffHunk": "@@ -716,7 +713,8 @@ public ServiceBusSessionReceiverClientBuilder topicName(String topicName) {\n         public ServiceBusReceiverAsyncClient buildAsyncClient() {\n             final MessagingEntityType entityType = validateEntityPaths(logger, connectionStringEntityName, topicName,\n                 queueName);\n-            final String entityPath = getEntityPath(logger, entityType, queueName, topicName, subscriptionName);\n+            final String entityPath = getEntityPath(logger, entityType, queueName, topicName, subscriptionName,\n+                SubQueue.NONE);", "originalCommit": "4e5c4e64bd8af5d4109bcf5fde5abe2721b2b411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2ODkzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14587#discussion_r479468931", "bodyText": "Any sub queue are accessed via non-session receiver, confirmed with dotnet also.\nThus we are not exposing subQueue() in session receiver builder. That is why I am passing NONE.", "author": "hemanttanwar", "createdAt": "2020-08-28T18:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMzI4Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTMwMzYzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/14587#discussion_r479303635", "bodyText": "nit: empty line.", "author": "conniey", "createdAt": "2020-08-28T13:43:48Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/models/SubQueue.java", "diffHunk": "@@ -0,0 +1,31 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.messaging.servicebus.models;\n+\n+import com.azure.messaging.servicebus.ServiceBusReceiverAsyncClient;\n+import com.azure.messaging.servicebus.ServiceBusReceiverClient;\n+\n+/**\n+ * Defines values for sub queue type.\n+ */\n+public enum SubQueue {\n+    /** Connect to the default entity (directly to the queue or subscription) **/\n+    NONE,\n+\n+    /**\n+     * Azure Service Bus queues and topic subscriptions provide a secondary subqueue, called a dead-letter queue (DLQ).\n+     * The dead-letter queue doesn't need to be explicitly created and can't be deleted or otherwise managed\n+     * independent of the main entity.\n+     * <p>\n+     * This is builder for creating  {@link ServiceBusReceiverClient} and {@link ServiceBusReceiverAsyncClient} to\n+     * consume dead-letter messages from Service Bus entity.\n+     */\n+", "originalCommit": "4e5c4e64bd8af5d4109bcf5fde5abe2721b2b411", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b05e8ca5df00184d15d1bf17bacce141ec3f284", "chunk": "diff --git a/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/models/SubQueue.java b/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/models/SubQueue.java\nindex b4acbe444f3..7cba5797965 100644\n--- a/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/models/SubQueue.java\n+++ b/sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/models/SubQueue.java\n\n@@ -7,25 +7,31 @@ import com.azure.messaging.servicebus.ServiceBusReceiverAsyncClient;\n import com.azure.messaging.servicebus.ServiceBusReceiverClient;\n \n /**\n- * Defines values for sub queue type.\n+ * Azure Service Bus queues and topic subscriptions provide a secondary subqueue, called a dead-letter queue (DLQ).\n+ * The dead-letter queue doesn't need to be explicitly created and can't be deleted or otherwise managed\n+ * independent of the main entity.\n+ *\n+ * @see <a href=\"https://docs.microsoft.com/azure/service-bus-messaging/service-bus-dead-letter-queues\">Dead-letter Queues</a>\n  */\n public enum SubQueue {\n-    /** Connect to the default entity (directly to the queue or subscription) **/\n+    /**\n+     * Connect to the default entity (directly to the queue or subscription)\n+     */\n     NONE,\n \n     /**\n-     * Azure Service Bus queues and topic subscriptions provide a secondary subqueue, called a dead-letter queue (DLQ).\n-     * The dead-letter queue doesn't need to be explicitly created and can't be deleted or otherwise managed\n-     * independent of the main entity.\n+     * This value to indicate dead-letter queue.\n      * <p>\n      * This is builder for creating  {@link ServiceBusReceiverClient} and {@link ServiceBusReceiverAsyncClient} to\n      * consume dead-letter messages from Service Bus entity.\n      */\n-\n      DEAD_LETTER_QUEUE,\n \n     /**\n-     * This value indicate transfer deadletter queue.\n+     * This value to indicate transfer dead-letter queue.\n+     *<p>\n+     * This is builder for creating  {@link ServiceBusReceiverClient} and {@link ServiceBusReceiverAsyncClient} to\n+     * consume transfer dead-letter messages from Service Bus entity.\n      */\n-    TRANSFER_QUEUE;\n+    TRANSFER_DEAD_LETTER_QUEUE;\n }\n"}}, {"oid": "5b05e8ca5df00184d15d1bf17bacce141ec3f284", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b05e8ca5df00184d15d1bf17bacce141ec3f284", "message": "Added impl for transfer deadletter queue", "committedDate": "2020-08-28T18:24:06Z", "type": "commit"}, {"oid": "319ee6f8cf84c7b5ba7eeeb791e7da0fe65fb138", "url": "https://github.com/Azure/azure-sdk-for-java/commit/319ee6f8cf84c7b5ba7eeeb791e7da0fe65fb138", "message": "Fix unit test.", "committedDate": "2020-08-31T20:10:24Z", "type": "commit"}, {"oid": "55f5dde4302365d254cf549b3451de12315823fa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/55f5dde4302365d254cf549b3451de12315823fa", "message": "Remove unwanted files", "committedDate": "2020-08-31T20:13:51Z", "type": "commit"}]}