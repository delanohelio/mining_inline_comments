{"pr_number": 9018, "pr_title": "Smoke Test: use configurable authority host", "pr_createdAt": "2020-03-12T04:36:27Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9018", "timeline": [{"oid": "430b67cf881f779ce753c2552b0fc6fd0387bd5c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/430b67cf881f779ce753c2552b0fc6fd0387bd5c", "message": "use EnvironmentCredentialBuilder to build client with configurable authority host", "committedDate": "2020-03-12T04:33:58Z", "type": "commit"}, {"oid": "560daa1a99102986b21dd820bfe5fac0432ae0ac", "url": "https://github.com/Azure/azure-sdk-for-java/commit/560daa1a99102986b21dd820bfe5fac0432ae0ac", "message": "show pom.xml in addition to showing resolved dependencies", "committedDate": "2020-03-12T04:42:48Z", "type": "commit"}, {"oid": "7599df6b65f6d0c8e6efad831f4a85abee335c1e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7599df6b65f6d0c8e6efad831f4a85abee335c1e", "message": "set default variables as secrets", "committedDate": "2020-03-12T04:45:34Z", "type": "commit"}, {"oid": "72e3a1eaa2e53140ddd2f6854f524f793dc05b7a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/72e3a1eaa2e53140ddd2f6854f524f793dc05b7a", "message": "sans dash", "committedDate": "2020-03-12T04:46:24Z", "type": "commit"}, {"oid": "0a2d07d21cc646da2c1f18a16b04efcdc2833b42", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0a2d07d21cc646da2c1f18a16b04efcdc2833b42", "message": "set variables via script", "committedDate": "2020-03-12T05:01:58Z", "type": "commit"}, {"oid": "09fc34517ecb44c3ae9147de298ef3417a689a28", "url": "https://github.com/Azure/azure-sdk-for-java/commit/09fc34517ecb44c3ae9147de298ef3417a689a28", "message": ".keys", "committedDate": "2020-03-12T05:08:23Z", "type": "commit"}, {"oid": "6b6d55f008da16e890c314d99e42a89b542be2ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b6d55f008da16e890c314d99e42a89b542be2ba", "message": "add support for government cloud configuration", "committedDate": "2020-03-12T05:31:02Z", "type": "commit"}, {"oid": "62dc10fc8add372bbffb016b2017db1b7d9bd061", "url": "https://github.com/Azure/azure-sdk-for-java/commit/62dc10fc8add372bbffb016b2017db1b7d9bd061", "message": "whitespace", "committedDate": "2020-03-12T05:32:00Z", "type": "commit"}, {"oid": "e4a586d67d04314bfa6a0933800ad8f9a43e1c33", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e4a586d67d04314bfa6a0933800ad8f9a43e1c33", "message": "more whitespace", "committedDate": "2020-03-12T05:32:28Z", "type": "commit"}, {"oid": "788c0c251f2c47217a961a3d801a5e1f506f282a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/788c0c251f2c47217a961a3d801a5e1f506f282a", "message": "success -> succeeded", "committedDate": "2020-03-12T05:39:41Z", "type": "commit"}, {"oid": "c8d82302e00907ebb965f455ad5888f83b7ef49d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c8d82302e00907ebb965f455ad5888f83b7ef49d", "message": "revert pom.xml changes that pin dev versions", "committedDate": "2020-03-13T19:01:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODU1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9018#discussion_r392508550", "bodyText": "I would prefer that we keep the test with DAC and then use reflection to set the authority host until this is fixed:  #8626\nThat way the test is consistent across languages: Test DAC and we can remove the reflection once that issue is resolved.  @g2vinay", "author": "jongio", "createdAt": "2020-03-13T22:10:31Z", "path": "common/smoke-tests/src/main/java/com/azure/KeyVaultSecrets.java", "diffHunk": "@@ -47,16 +47,19 @@ public static void main(String[] args) {\n         LOGGER.info(\"IDENTITY - CREDENTIAL\");\n         LOGGER.info(\"---------------------\");\n \n-        /* DefaultAzureCredentialBuilder() is expecting the following environment variables:\n+        /* EnvironmentCredentialBuilder() is expecting the following environment variables:", "originalCommit": "c8d82302e00907ebb965f455ad5888f83b7ef49d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODkzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9018#discussion_r392508933", "bodyText": "It was implemented in the beta here: \n  \n    \n      azure-sdk-for-java/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\n    \n    \n         Line 21\n      in\n      5dd0c40\n    \n    \n    \n    \n\n        \n          \n           public DefaultAzureCredentialBuilder authorityHost(String authorityHost) { \n        \n    \n  \n\n\nSo, ideally this test runs against beta and we use that.", "author": "jongio", "createdAt": "2020-03-13T22:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODU1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUzNjg3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9018#discussion_r392536870", "bodyText": "Smoke tests run from the latest nightly packages available. Here it is succeeding with the new syntax: https://dev.azure.com/azure-sdk/internal/_build/results?buildId=296102&view=results", "author": "danieljurek", "createdAt": "2020-03-14T00:27:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwODU1MA=="}], "type": "inlineReview", "revised_code": {"commit": "23ec95ec0ab9a311536edaa793e8faf3248768f9", "chunk": "diff --git a/common/smoke-tests/src/main/java/com/azure/KeyVaultSecrets.java b/common/smoke-tests/src/main/java/com/azure/KeyVaultSecrets.java\nindex 9b33e9c35b9..b56bbada5c6 100644\n--- a/common/smoke-tests/src/main/java/com/azure/KeyVaultSecrets.java\n+++ b/common/smoke-tests/src/main/java/com/azure/KeyVaultSecrets.java\n\n@@ -47,16 +47,18 @@ public class KeyVaultSecrets {\n         LOGGER.info(\"IDENTITY - CREDENTIAL\");\n         LOGGER.info(\"---------------------\");\n \n-        /* EnvironmentCredentialBuilder() is expecting the following environment variables:\n+        /* DefaultAzureCredentialBuilder() is expecting the following environment variables:\n          * AZURE_CLIENT_ID\n          * AZURE_CLIENT_SECRET\n          * AZURE_TENANT_ID\n-         * AZURE_AUTHORITY_HOST\n+         *\n+         * AZURE_AUTHORITY_HOST -- this is supplied to the credential builder\n+         * for use in other clouds\n          */\n         secretClient = new SecretClientBuilder()\n             .vaultUrl(System.getenv(\"AZURE_PROJECT_URL\"))\n             .credential(\n-                new EnvironmentCredentialBuilder()\n+                new DefaultAzureCredentialBuilder()\n                     .authorityHost(System.getenv(\"AZURE_AUTHORITY_HOST\"))\n                     .build()\n             ).buildClient();\n"}}, {"oid": "23ec95ec0ab9a311536edaa793e8faf3248768f9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/23ec95ec0ab9a311536edaa793e8faf3248768f9", "message": "supply authorityHost to DefaultAzureCrednetialBuilder", "committedDate": "2020-03-14T00:16:47Z", "type": "commit"}, {"oid": "e750acee708e306e629390eb3e456ec6ea371987", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e750acee708e306e629390eb3e456ec6ea371987", "message": "import the correct object", "committedDate": "2020-03-14T00:20:57Z", "type": "commit"}]}