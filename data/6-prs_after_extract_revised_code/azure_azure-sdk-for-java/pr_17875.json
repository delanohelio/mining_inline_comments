{"pr_number": 17875, "pr_title": "Mgmt: Cosmos update to 2020 09", "pr_createdAt": "2020-11-30T08:08:16Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17875", "timeline": [{"oid": "8f97ef0bf74074c7dcb9fc4c147fcf544fc71a1f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f97ef0bf74074c7dcb9fc4c147fcf544fc71a1f", "message": "update cosmos api specs", "committedDate": "2020-11-30T01:58:28Z", "type": "commit"}, {"oid": "aede0480ae135add2660db562a68ce5d2363ae8a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/aede0480ae135add2660db562a68ce5d2363ae8a", "message": "generate cosmos 2020 09", "committedDate": "2020-11-30T02:04:15Z", "type": "commit"}, {"oid": "23e38299f2ab89a416a9c0e117e587484759055f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/23e38299f2ab89a416a9c0e117e587484759055f", "message": "add with ip rules and deprecated ipRangeFileter", "committedDate": "2020-11-30T03:01:40Z", "type": "commit"}, {"oid": "04ed6ab963b666be137f58dfa6f57fd7fd939e4a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/04ed6ab963b666be137f58dfa6f57fd7fd939e4a", "message": "session records", "committedDate": "2020-11-30T07:52:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxMzI4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17875#discussion_r532413281", "bodyText": "CoreUtils.isNullOrEmpty", "author": "weidongxu-microsoft", "createdAt": "2020-11-30T08:18:40Z", "path": "sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java", "diffHunk": "@@ -362,7 +368,17 @@ public CosmosDBAccountImpl withDataModelGremlin() {\n \n     @Override\n     public CosmosDBAccountImpl withIpRangeFilter(String ipRangeFilter) {\n-        this.innerModel().withIpRangeFilter(ipRangeFilter);\n+        List<IpAddressOrRange> rules = new ArrayList<>();\n+        for (String ip : ipRangeFilter.split(\",\")) {\n+            rules.add(new IpAddressOrRange().withIpAddressOrRange(ip));\n+        }", "originalCommit": "23e38299f2ab89a416a9c0e117e587484759055f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxNDQxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17875#discussion_r532414413", "bodyText": "done", "author": "ChenTanyi", "createdAt": "2020-11-30T08:20:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxMzI4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "0e64ecbfd50b56445ee145973c5d9f9f75163264", "chunk": "diff --git a/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java b/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\nindex 1eec0099f10..380dfc857ad 100644\n--- a/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\n+++ b/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\n\n@@ -369,8 +373,10 @@ class CosmosDBAccountImpl\n     @Override\n     public CosmosDBAccountImpl withIpRangeFilter(String ipRangeFilter) {\n         List<IpAddressOrRange> rules = new ArrayList<>();\n-        for (String ip : ipRangeFilter.split(\",\")) {\n-            rules.add(new IpAddressOrRange().withIpAddressOrRange(ip));\n+        if (!CoreUtils.isNullOrEmpty(ipRangeFilter)) {\n+            for (String ip : ipRangeFilter.split(\",\")) {\n+                rules.add(new IpAddressOrRange().withIpAddressOrRange(ip));\n+            }\n         }\n         this.innerModel().withIpRules(rules);\n         return this;\n"}}, {"oid": "0e64ecbfd50b56445ee145973c5d9f9f75163264", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e64ecbfd50b56445ee145973c5d9f9f75163264", "message": "check empty for ip range filter", "committedDate": "2020-11-30T08:20:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxNDgyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17875#discussion_r532414826", "bodyText": "Collections.unmodifiableList?", "author": "xseeseesee", "createdAt": "2020-11-30T08:21:36Z", "path": "sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java", "diffHunk": "@@ -76,7 +77,12 @@ public DatabaseAccountOfferType databaseAccountOfferType() {\n \n     @Override\n     public String ipRangeFilter() {\n-        return this.innerModel().ipRangeFilter();\n+        return this.ipRules().stream().map(IpAddressOrRange::ipAddressOrRange).collect(Collectors.joining(\",\"));\n+    }\n+\n+    @Override\n+    public List<IpAddressOrRange> ipRules() {\n+        return this.innerModel().ipRules();", "originalCommit": "23e38299f2ab89a416a9c0e117e587484759055f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxNTg2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17875#discussion_r532415860", "bodyText": "done", "author": "ChenTanyi", "createdAt": "2020-11-30T08:23:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxNDgyNg=="}], "type": "inlineReview", "revised_code": {"commit": "d21181e0010080eaf0cb56fa29e1d8c52dc1ca6b", "chunk": "diff --git a/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java b/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\nindex 1eec0099f10..c4ff69b1c5b 100644\n--- a/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\n+++ b/sdk/resourcemanager/azure-resourcemanager-cosmos/src/main/java/com/azure/resourcemanager/cosmos/implementation/CosmosDBAccountImpl.java\n\n@@ -77,12 +79,15 @@ class CosmosDBAccountImpl\n \n     @Override\n     public String ipRangeFilter() {\n+        if (CoreUtils.isNullOrEmpty(ipRules())) {\n+            return null;\n+        }\n         return this.ipRules().stream().map(IpAddressOrRange::ipAddressOrRange).collect(Collectors.joining(\",\"));\n     }\n \n     @Override\n     public List<IpAddressOrRange> ipRules() {\n-        return this.innerModel().ipRules();\n+        return Collections.unmodifiableList(this.innerModel().ipRules());\n     }\n \n     @Override\n"}}, {"oid": "d21181e0010080eaf0cb56fa29e1d8c52dc1ca6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d21181e0010080eaf0cb56fa29e1d8c52dc1ca6b", "message": "use unmodifiableList", "committedDate": "2020-11-30T08:23:23Z", "type": "commit"}, {"oid": "076e79f5f35c0a9ed02b7256ca6497ffa8d21a2a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/076e79f5f35c0a9ed02b7256ca6497ffa8d21a2a", "message": "session records", "committedDate": "2020-11-30T09:53:53Z", "type": "commit"}, {"oid": "ecb464e88b25db722eab20edbd1125532a85b5ed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ecb464e88b25db722eab20edbd1125532a85b5ed", "message": "skip revapi for cosmos due to upgrade", "committedDate": "2020-12-01T02:25:09Z", "type": "commit"}, {"oid": "5d789937e1d56a42c969870fe0c1d005d44c7edb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d789937e1d56a42c969870fe0c1d005d44c7edb", "message": "update okhttp version", "committedDate": "2020-12-01T02:42:47Z", "type": "commit"}]}