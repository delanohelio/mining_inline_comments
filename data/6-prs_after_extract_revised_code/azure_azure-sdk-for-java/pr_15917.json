{"pr_number": 15917, "pr_title": "Hide Communication Client Credentials and Refactor", "pr_createdAt": "2020-10-03T01:05:36Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15917", "timeline": [{"oid": "078e4c2d3fbd07c146bb4cca7e9468d2ec34ec56", "url": "https://github.com/Azure/azure-sdk-for-java/commit/078e4c2d3fbd07c146bb4cca7e9468d2ec34ec56", "message": "Hide Communication Client Credential", "committedDate": "2020-10-02T00:17:44Z", "type": "commit"}, {"oid": "2d1ce678559b8c0d3b95dfc1e5269fb47112ee55", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d1ce678559b8c0d3b95dfc1e5269fb47112ee55", "message": "Adding support of directly passing in connectionString to builder", "committedDate": "2020-10-02T22:59:00Z", "type": "commit"}, {"oid": "b53693e541f0aa6aefee485ecbae78c4fb1e5d1b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b53693e541f0aa6aefee485ecbae78c4fb1e5d1b", "message": "Merge with master and update the phone number admin", "committedDate": "2020-10-03T00:30:05Z", "type": "commit"}, {"oid": "781f16e2f93e4e56f75e1939bd6dec48308c9b8c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/781f16e2f93e4e56f75e1939bd6dec48308c9b8c", "message": "Update Readme", "committedDate": "2020-10-03T00:32:29Z", "type": "commit"}, {"oid": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c9579a1dc3de8e96726d5494e4ecf5858013ac15", "message": "Renaming variables and fixing ReadMe", "committedDate": "2020-10-03T00:58:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjAwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499102004", "bodyText": "setAccessKeyNull", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:12:39Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberClientBuilderTest.java", "diffHunk": "@@ -295,7 +294,7 @@ public void setHttpClientNull() {\n     @Test()\n     public void setCredentialNull() {", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab339a008a69bdf384c3615f638bd599c085bab", "chunk": "diff --git a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberClientBuilderTest.java b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberClientBuilderTest.java\nindex 6bfa2b53ea..012ce8ceba 100644\n--- a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberClientBuilderTest.java\n+++ b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberClientBuilderTest.java\n\n@@ -292,7 +292,7 @@ public class PhoneNumberClientBuilderTest {\n     }\n \n     @Test()\n-    public void setCredentialNull() {\n+    public void setAccessKeyNull() {\n         assertThrows(NullPointerException.class, () -> {\n             this.clientBuilder.accessKey(null);\n         });\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjAyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499102024", "bodyText": "nit: extra indent. Also CONNECTION_STRING", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:12:54Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberIntegrationTestBase.java", "diffHunk": "@@ -21,6 +21,8 @@\n         Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ACCESS_KEY\");\n     private static final String ENV_ENDPOINT =\n         Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ENDPOINT\");\n+        protected static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0802d98a3fbf9f683d9193cbed0611cfcfa54343", "chunk": "diff --git a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberIntegrationTestBase.java b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberIntegrationTestBase.java\nindex f0642af087..6716b2d6c0 100644\n--- a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberIntegrationTestBase.java\n+++ b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberIntegrationTestBase.java\n\n@@ -15,12 +15,10 @@ import java.security.NoSuchAlgorithmException;\n import static org.junit.jupiter.api.Assertions.fail;\n \n public class PhoneNumberIntegrationTestBase extends TestBase {\n-    private static final String PLAYBACK_ACCESS_KEY = \"QWNjZXNzS2V5\";\n-    private static final String PLAYBACK_ENDPOINT = \"https://REDACTED.communication.azure.com\";\n     private static final String ENV_ACCESS_KEY =\n-        Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ACCESS_KEY\");\n+        Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ACCESS_KEY\", \"QWNjZXNzS2V5\");\n     private static final String ENV_ENDPOINT =\n-        Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ENDPOINT\");\n+        Configuration.getGlobalConfiguration().get(\"COMMUNICATION_SERVICE_ENDPOINT\", \"https://REDACTED.communication.azure.com\");\n         protected static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()\n         .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://REDACTED.communication.azure.com/;accesskey=QWNjZXNzS2V5\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjcxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499102710", "bodyText": "Let's talk about this a bit more. I wonder if somehow sha256HMAC instantiation and init should be moved to a builder mechanism to avoid throwing exceptions or maybe the first time that we call appendAuthorizationHeaders we set it up. @srnagar what do you think?", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:21:00Z", "path": "sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/CommunicationClientCredential.java", "diffHunk": "@@ -53,14 +53,20 @@\n     /**\n      * Requires resource access key to create the credential\n      * @param accessKey resource access key as provided by Azure in Base64 format\n-     * @throws NoSuchAlgorithmException if HmacSHA256 is not available\n-     * @throws InvalidKeyException if accessKey provided is not valid\n      */\n-    public CommunicationClientCredential(String accessKey) throws NoSuchAlgorithmException, InvalidKeyException {\n+    public CommunicationClientCredential(String accessKey) {\n         Objects.requireNonNull(accessKey, \"'accessKey' cannot be null\");\n         byte[] key = Base64.getDecoder().decode(accessKey);\n-        sha256HMAC = Mac.getInstance(\"HmacSHA256\");\n-        sha256HMAC.init(new SecretKeySpec(key, \"HmacSHA256\"));\n+        Mac sha256HMAC = null;\n+        try {\n+            sha256HMAC = Mac.getInstance(\"HmacSHA256\");\n+            sha256HMAC.init(new SecretKeySpec(key, \"HmacSHA256\"));\n+        } catch (NoSuchAlgorithmException e) {\n+            e.printStackTrace();", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgwNzM0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499807340", "bodyText": "We do use builders for creating credentials in azure-identity.\nWe also use constructors as well for creating some credentials. So, both patterns are acceptable.", "author": "srnagar", "createdAt": "2020-10-05T18:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgwODI3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499808277", "bodyText": "Regarding the exception handling itself, if the sha256HMAC cannot be instantiated, we should throw this error but it should be a RuntimeException instead of a checked exception. Also, we should not use e.printStackTrace(). Log the and throw the exception instead using ClientLogger.", "author": "srnagar", "createdAt": "2020-10-05T19:01:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgxMzI4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499813282", "bodyText": "Done, thanks Srikanta!", "author": "minnieliu", "createdAt": "2020-10-05T19:10:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjcxMA=="}], "type": "inlineReview", "revised_code": {"commit": "cd95f897dda6ba4b72d3c94ce1eac84f8fd4e9f2", "chunk": "diff --git a/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/CommunicationClientCredential.java b/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/CommunicationClientCredential.java\nindex 20eae25bbd..c6249aa8c7 100644\n--- a/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/CommunicationClientCredential.java\n+++ b/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/CommunicationClientCredential.java\n\n@@ -62,9 +62,9 @@ public final class CommunicationClientCredential {\n             sha256HMAC = Mac.getInstance(\"HmacSHA256\");\n             sha256HMAC.init(new SecretKeySpec(key, \"HmacSHA256\"));\n         } catch (NoSuchAlgorithmException e) {\n-            e.printStackTrace();\n+            throw logger.logExceptionAsError(new RuntimeException(e));\n         } catch (InvalidKeyException e) {\n-            e.printStackTrace();\n+            throw logger.logExceptionAsError(new RuntimeException(e));\n         }\n         this.sha256HMAC = sha256HMAC;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjg4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499102883", "bodyText": "Does not azure core already have an implementation of this that we can use?", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:23:19Z", "path": "sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java", "diffHunk": "@@ -0,0 +1,72 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.communication.common;\n+\n+import java.util.Objects;\n+\n+public class ConnectionString {", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwNDc5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499104796", "bodyText": "I checked Azure Core because I saw for C# there is existing implementation, but nothing there for Java unfortunately", "author": "minnieliu", "createdAt": "2020-10-03T01:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMjg4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "0ab339a008a69bdf384c3615f638bd599c085bab", "chunk": "diff --git a/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java b/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java\nindex 7f6e331e41..7421c601b2 100644\n--- a/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java\n+++ b/sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java\n\n@@ -4,6 +4,9 @@ package com.azure.communication.common;\n \n import java.util.Objects;\n \n+/**\n+ * Parse and store Connection String values\n+ */\n public class ConnectionString {\n     private static final String TOKEN_VALUE_SEPARATOR = \"=\";\n     private static final String TOKEN_VALUE_PAIR_DELIMITER = \";\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMzA5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499103094", "bodyText": "Do you mind replacing this fake url with a sanitized one?", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:25:46Z", "path": "sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java", "diffHunk": "@@ -35,25 +30,34 @@\n     static final String ENDPOINT = Configuration.getGlobalConfiguration()\n         .get(\"SMS_SERVICE_ENDPOINT\", \"https://playback.sms.azurefd.net\");\n \n-    CommunicationClientCredential credential;\n-\n-    public SmsLiveTestBase() {\n-        try {\n-            credential = new CommunicationClientCredential(ACCESSKEY);\n-        } catch (InvalidKeyException e) {\n-            credential = null;\n-            fail(e.getMessage());\n-        } catch (NoSuchAlgorithmException e) {\n-            credential = null;\n-            fail(e.getMessage());\n-        }\n-    }\n+    static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()\n+        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://playback.sms.azurefd.net/;accesskey=VGhpcyBpcyBhIHRlc3Q=\");", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab339a008a69bdf384c3615f638bd599c085bab", "chunk": "diff --git a/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java b/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\nindex 4664a414d7..2ba2aadbbc 100644\n--- a/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\n+++ b/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\n\n@@ -28,10 +28,10 @@ public class SmsLiveTestBase extends TestBase {\n         .get(\"SMS_SERVICE_ACCESS_KEY\", DEFAULT_ACCESS_KEY);\n \n     static final String ENDPOINT = Configuration.getGlobalConfiguration()\n-        .get(\"SMS_SERVICE_ENDPOINT\", \"https://playback.sms.azurefd.net\");\n+        .get(\"SMS_SERVICE_ENDPOINT\", \"https://REDACTED.communication.azure.com\");\n \n-    static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()\n-        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://playback.sms.azurefd.net/;accesskey=VGhpcyBpcyBhIHRlc3Q=\");\n+    static final String CONNECTION_STRING = Configuration.getGlobalConfiguration()\n+        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://REDACTED.communication.azure.com/;accesskey=VGhpcyBpcyBhIHRlc3Q=\");\n \n     protected SmsClientBuilder getSmsClientBuilder() {\n         SmsClientBuilder builder = new SmsClientBuilder();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTEwMzQxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r499103416", "bodyText": "CONNECTION_STRING", "author": "RezaJooyandeh", "createdAt": "2020-10-03T01:29:41Z", "path": "sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java", "diffHunk": "@@ -35,25 +30,34 @@\n     static final String ENDPOINT = Configuration.getGlobalConfiguration()\n         .get(\"SMS_SERVICE_ENDPOINT\", \"https://playback.sms.azurefd.net\");\n \n-    CommunicationClientCredential credential;\n-\n-    public SmsLiveTestBase() {\n-        try {\n-            credential = new CommunicationClientCredential(ACCESSKEY);\n-        } catch (InvalidKeyException e) {\n-            credential = null;\n-            fail(e.getMessage());\n-        } catch (NoSuchAlgorithmException e) {\n-            credential = null;\n-            fail(e.getMessage());\n-        }\n-    }\n+    static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()", "originalCommit": "c9579a1dc3de8e96726d5494e4ecf5858013ac15", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ab339a008a69bdf384c3615f638bd599c085bab", "chunk": "diff --git a/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java b/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\nindex 4664a414d7..2ba2aadbbc 100644\n--- a/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\n+++ b/sdk/communication/azure-communication-sms/src/test/java/com/azure/communication/sms/SmsLiveTestBase.java\n\n@@ -28,10 +28,10 @@ public class SmsLiveTestBase extends TestBase {\n         .get(\"SMS_SERVICE_ACCESS_KEY\", DEFAULT_ACCESS_KEY);\n \n     static final String ENDPOINT = Configuration.getGlobalConfiguration()\n-        .get(\"SMS_SERVICE_ENDPOINT\", \"https://playback.sms.azurefd.net\");\n+        .get(\"SMS_SERVICE_ENDPOINT\", \"https://REDACTED.communication.azure.com\");\n \n-    static final String CONNECTIONSTRING = Configuration.getGlobalConfiguration()\n-        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://playback.sms.azurefd.net/;accesskey=VGhpcyBpcyBhIHRlc3Q=\");\n+    static final String CONNECTION_STRING = Configuration.getGlobalConfiguration()\n+        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://REDACTED.communication.azure.com/;accesskey=VGhpcyBpcyBhIHRlc3Q=\");\n \n     protected SmsClientBuilder getSmsClientBuilder() {\n         SmsClientBuilder builder = new SmsClientBuilder();\n"}}, {"oid": "0802d98a3fbf9f683d9193cbed0611cfcfa54343", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0802d98a3fbf9f683d9193cbed0611cfcfa54343", "message": "Fix failing tests", "committedDate": "2020-10-03T01:38:04Z", "type": "commit"}, {"oid": "0ab339a008a69bdf384c3615f638bd599c085bab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ab339a008a69bdf384c3615f638bd599c085bab", "message": "Fix build and addressing comments", "committedDate": "2020-10-03T02:07:51Z", "type": "commit"}, {"oid": "2e2bc03a57ebfd580171358c44b22200db1dc8b6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2e2bc03a57ebfd580171358c44b22200db1dc8b6", "message": "Fix build and addressing comments", "committedDate": "2020-10-03T04:07:40Z", "type": "commit"}, {"oid": "cd95f897dda6ba4b72d3c94ce1eac84f8fd4e9f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cd95f897dda6ba4b72d3c94ce1eac84f8fd4e9f2", "message": "Throw unchecked exceptions in communicationClientCredential", "committedDate": "2020-10-05T19:05:23Z", "type": "commit"}, {"oid": "10d935b0b6eacbf35af1a1b2a209c91e66da1fe0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/10d935b0b6eacbf35af1a1b2a209c91e66da1fe0", "message": "Cleanup outstanding items", "committedDate": "2020-10-05T21:10:40Z", "type": "commit"}, {"oid": "1816ad3ebd5dc312c4b7d080456a81b60d90551f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1816ad3ebd5dc312c4b7d080456a81b60d90551f", "message": "Cleaning up outstanding small issues", "committedDate": "2020-10-05T21:27:17Z", "type": "commit"}, {"oid": "2002fac8f82d4b312b30038b9ce6fc894389b633", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2002fac8f82d4b312b30038b9ce6fc894389b633", "message": "Merge", "committedDate": "2020-10-05T21:28:06Z", "type": "commit"}, {"oid": "ce07dc204b19c5ac4e9f2063533775eee7bbbbfc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ce07dc204b19c5ac4e9f2063533775eee7bbbbfc", "message": "Fix redacted response files", "committedDate": "2020-10-05T22:03:45Z", "type": "commit"}, {"oid": "f51e6aae0a3a9ea3374559e72dd6a9554267d37a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f51e6aae0a3a9ea3374559e72dd6a9554267d37a", "message": "Updating changelogs", "committedDate": "2020-10-05T23:34:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUyNzI3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r500527279", "bodyText": "Move the annotation to new line above the test case.", "author": "srnagar", "createdAt": "2020-10-06T18:57:32Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityAsyncTests.java", "diffHunk": "@@ -29,6 +29,16 @@ protected void beforeTest() {\n         asyncClient = getCommunicationIdentityClient().buildAsyncClient();\n     }\n \n+    @Test void createAsyncIdentityClientUsingConnectionString() {", "originalCommit": "f51e6aae0a3a9ea3374559e72dd6a9554267d37a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0OTcxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r500549712", "bodyText": "Done", "author": "minnieliu", "createdAt": "2020-10-06T19:39:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUyNzI3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "bc072382d081b07941295ea298a59b1b59d80a34", "chunk": "diff --git a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityAsyncTests.java b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityAsyncTests.java\nindex fbfe558961..406b76fac2 100644\n--- a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityAsyncTests.java\n+++ b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityAsyncTests.java\n\n@@ -29,7 +29,8 @@ public class CommunicationIdentityAsyncTests extends CommunicationIdentityClient\n         asyncClient = getCommunicationIdentityClient().buildAsyncClient();\n     }\n \n-    @Test void createAsyncIdentityClientUsingConnectionString() {\n+    @Test\n+    public void createAsyncIdentityClientUsingConnectionString() {\n         asyncClient = getCommunicationIdentityClientUsingConnectionString().buildAsyncClient();\n         assertNotNull(asyncClient);\n         // Smoke testing identity client by creating user\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUyNzc4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r500527784", "bodyText": "nit: Use underscores to split multiple words - MOCK_ACCESS_KEY, MOCK_CONNECTION_STRING", "author": "srnagar", "createdAt": "2020-10-06T18:58:22Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityBuilderTests.java", "diffHunk": "@@ -24,7 +22,8 @@\n \n public class CommunicationIdentityBuilderTests {\n     static final String MOCKURL = \"https://chitchat.dev.communication.azure.net/\";\n-    static final String MOCKTOKEN = \"HuZVBcRKEA+TW30GBzdsmRyqitKk1dHj2OBtTsgRe2mzlxWUHGh06CdOVJwp07JKuss1k+/YeXL4dYXPF5El4Q==\";\n+    static final String MOCKACCESSKEY = \"HuZVBcRKEA+TW30GBzdsmRyqitKk1dHj2OBtTsgRe2mzlxWUHGh06CdOVJwp07JKuss1k+/YeXL4dYXPF5El4Q==\";", "originalCommit": "f51e6aae0a3a9ea3374559e72dd6a9554267d37a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0OTc4MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r500549780", "bodyText": "Done, thank you.", "author": "minnieliu", "createdAt": "2020-10-06T19:39:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUyNzc4NA=="}], "type": "inlineReview", "revised_code": {"commit": "bc072382d081b07941295ea298a59b1b59d80a34", "chunk": "diff --git a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityBuilderTests.java b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityBuilderTests.java\nindex 3778c34bf8..b86f00ecc8 100644\n--- a/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityBuilderTests.java\n+++ b/sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityBuilderTests.java\n\n@@ -21,9 +21,9 @@ import org.junit.jupiter.api.Test;\n import reactor.core.publisher.Mono;\n \n public class CommunicationIdentityBuilderTests {\n-    static final String MOCKURL = \"https://chitchat.dev.communication.azure.net/\";\n-    static final String MOCKACCESSKEY = \"HuZVBcRKEA+TW30GBzdsmRyqitKk1dHj2OBtTsgRe2mzlxWUHGh06CdOVJwp07JKuss1k+/YeXL4dYXPF5El4Q==\";\n-    static final String MOCKCONNECTIONSTRING = \"endpoint=https://chitchat.dev.communication.azure.net//;accesskey=HuZVBcRKEA+TW30GBzdsmRyqitKk1dHj2OBtTsgRe2mzlxWUHGh06CdOVJwp07JKuss1k+/YeXL4dYXPF5El4Q==\";\n+    static final String MOCK_URL = \"https://REDACTED.communication.azure.com\";\n+    static final String MOCK_ACCESS_KEY = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaGfQSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJVadQssw5c\";\n+    static final String MOCK_CONNECTION_STRING = \"endpoint=https://REDACTED.communication.azure.com/;accesskey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaGfQSflKxwRJSMeKKF2QT4fwpMeJf36POk6yJVadQssw5c\";\n \n     static class NoOpHttpClient implements HttpClient {\n         @Override\n"}}, {"oid": "bc072382d081b07941295ea298a59b1b59d80a34", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bc072382d081b07941295ea298a59b1b59d80a34", "message": "Addressing final review comments", "committedDate": "2020-10-06T19:38:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1NTcyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505755724", "bodyText": "Make this class final and also add @Immutable annotation. Also, the user doesn't directly create this type, so, it can be moved to implementation package.", "author": "srnagar", "createdAt": "2020-10-15T18:29:56Z", "path": "sdk/communication/azure-communication-common/src/main/java/com/azure/communication/common/ConnectionString.java", "diffHunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+package com.azure.communication.common;\n+\n+import java.util.Objects;\n+\n+/**\n+ * Parse and store Connection String values\n+ */\n+public class ConnectionString {", "originalCommit": "bc072382d081b07941295ea298a59b1b59d80a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk0OTg5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505949890", "bodyText": "@srnagar The Connection String is also used in other packages like administration and SMS. Given this, we won't be able to put it into implementation folder right? Unless we also export the implementation folder which we probably do not want?", "author": "minnieliu", "createdAt": "2020-10-16T01:00:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1NTcyNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1OTc1OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505759759", "bodyText": "TestBase class has a method called getHttpClients() which returns a list of all available HTTP clients. You can use that method instead. That will allow you to test your service with multiple HTTP clients.", "author": "srnagar", "createdAt": "2020-10-15T18:37:10Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/CommunicationIdentityClientTestBase.java", "diffHunk": "@@ -19,41 +15,54 @@\n \n public class CommunicationIdentityClientTestBase extends TestBase {\n     protected static final TestMode TEST_MODE = initializeTestMode();\n-\n     protected static final String ENDPOINT = Configuration.getGlobalConfiguration()\n-        .get(\"ADMINISTRATION_SERVICE_ENDPOINT\", \"https://yourresource.communication.azure.com\");\n+        .get(\"ADMINISTRATION_SERVICE_ENDPOINT\", \"https://REDACTED.communication.azure.com\");\n+\n+    protected static final String ACCESSKEYRAW = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\";\n+    protected static final String ACCESSKEYENCODED = Base64.getEncoder().encodeToString(ACCESSKEYRAW.getBytes());\n+    protected static final String ACCESSKEY = Configuration.getGlobalConfiguration()\n+        .get(\"ADMINISTRATION_SERVICE_ACCESS_TOKEN\", ACCESSKEYENCODED);\n \n-    protected static final String MOCKACCESSTOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c\";\n-    protected static final String MOCKACCESSTOKENENCODED = Base64.getEncoder().encodeToString(MOCKACCESSTOKEN.getBytes());\n-    protected static final String ACCESSTOKEN = Configuration.getGlobalConfiguration()\n-        .get(\"ADMINISTRATION_SERVICE_ACCESS_TOKEN\", MOCKACCESSTOKENENCODED);\n+    protected static final String CONNECTION_STRING = Configuration.getGlobalConfiguration()\n+        .get(\"COMMUNICATION_CONNECTION_STRING\", \"endpoint=https://REDACTED.communication.azure.com/;accesskey=\" + ACCESSKEYENCODED);\n     \n     protected CommunicationIdentityClientBuilder getCommunicationIdentityClient() {\n-        try {\n-            CommunicationClientCredential credential = new CommunicationClientCredential(ACCESSTOKEN);\n-            CommunicationIdentityClientBuilder builder = new CommunicationIdentityClientBuilder();\n-            builder.endpoint(ENDPOINT)\n-                .credential(credential);\n-    \n-            if (interceptorManager.isPlaybackMode()) {\n-                builder.httpClient(interceptorManager.getPlaybackClient());\n-                return builder;\n-            } else {\n-                HttpClient client = new NettyAsyncHttpClientBuilder().build();\n-                builder.httpClient(client);\n-            }\n-    \n-            if (!interceptorManager.isLiveMode()) {\n-                builder.addPolicy(interceptorManager.getRecordPolicy());\n-            }\n-    \n+        CommunicationIdentityClientBuilder builder = new CommunicationIdentityClientBuilder();\n+        builder.endpoint(ENDPOINT)\n+            .accessKey(ACCESSKEY);\n+\n+        if (interceptorManager.isPlaybackMode()) {\n+            builder.httpClient(interceptorManager.getPlaybackClient());\n+            return builder;\n+        } else {\n+            HttpClient client = new NettyAsyncHttpClientBuilder().build();", "originalCommit": "bc072382d081b07941295ea298a59b1b59d80a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTkzMDQ1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505930457", "bodyText": "How would this work since builder.httpClient(client); only takes in one client?", "author": "minnieliu", "createdAt": "2020-10-16T00:03:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc1OTc1OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MDU3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505760572", "bodyText": "If the user doesn't have to create the CommunicationClientCredential instance directly, can that type be moved to implementation package?", "author": "srnagar", "createdAt": "2020-10-15T18:38:46Z", "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/CommunicationIdentityClientBuilder.java", "diffHunk": "@@ -70,12 +71,29 @@ public CommunicationIdentityClientBuilder pipeline(HttpPipeline pipeline) {\n     /**\n      * Set credential to use\n      *\n-     * @param credential credential for signing, overridden by the\n-     * pipeline field.\n+     * @param accessKey access key for initalizing CommunicationClientCredential\n      * @return CommunicationIdentityClientBuilder\n      */\n-    public CommunicationIdentityClientBuilder credential(CommunicationClientCredential credential) {\n-        this.credential = Objects.requireNonNull(credential, \"'credential' cannot be null.\");\n+    public CommunicationIdentityClientBuilder accessKey(String accessKey) {\n+        Objects.requireNonNull(accessKey, \"'accessKey' cannot be null.\");\n+        this.credential = new CommunicationClientCredential(accessKey);", "originalCommit": "bc072382d081b07941295ea298a59b1b59d80a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk1MDE2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15917#discussion_r505950162", "bodyText": "@srnagar Same as the ConnectionString comment, the CommunicationClientCredential is used in other packages as well. Let me know what your thoughts are on this.", "author": "minnieliu", "createdAt": "2020-10-16T01:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MDU3Mg=="}], "type": "inlineReview", "revised_code": null}]}