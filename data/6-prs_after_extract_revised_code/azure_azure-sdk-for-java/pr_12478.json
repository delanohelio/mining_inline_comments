{"pr_number": 12478, "pr_title": "Return azure core HttpResponseException for service side exceptions", "pr_createdAt": "2020-06-24T05:48:26Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12478", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjMwMDU2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12478#discussion_r446300565", "bodyText": "sourceUrl -> invalidSourceUrl", "author": "mssfang", "createdAt": "2020-06-26T16:55:34Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java", "diffHunk": "@@ -167,8 +170,12 @@ public void recognizeReceiptDataTextDetails(HttpClient httpClient, FormRecognize\n     @MethodSource(\"com.azure.ai.formrecognizer.TestUtils#getTestParameters\")\n     public void recognizeReceiptInvalidSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion) {\n         client = getFormRecognizerAsyncClient(httpClient, serviceVersion);\n-        invalidSourceUrlRunner((sourceUrl) -> assertThrows(ErrorResponseException.class,\n-            () -> client.beginRecognizeReceiptsFromUrl(sourceUrl).getSyncPoller()));\n+        invalidSourceUrlRunner((sourceUrl) -> {", "originalCommit": "d4dfceb5c739a931db35d78fea25d6aa577a3c7c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c620abd02aecd7517ff264be9d324119aa3864a", "chunk": "diff --git a/sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java b/sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java\nindex 1de448665ee..65af5592d3a 100644\n--- a/sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java\n+++ b/sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java\n\n@@ -170,11 +170,12 @@ public class FormRecognizerAsyncClientTest extends FormRecognizerClientTestBase\n     @MethodSource(\"com.azure.ai.formrecognizer.TestUtils#getTestParameters\")\n     public void recognizeReceiptInvalidSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion) {\n         client = getFormRecognizerAsyncClient(httpClient, serviceVersion);\n-        invalidSourceUrlRunner((sourceUrl) -> {\n-            ErrorResponseException errorResponseException = assertThrows(ErrorResponseException.class,\n-                () -> client.beginRecognizeReceiptsFromUrl(sourceUrl).getSyncPoller().getFinalResult());\n-            assertEquals(INVALID_IMAGE_URL_ERROR_CODE, errorResponseException.getValue().getCode());\n-            assertEquals(IMAGE_URL_IS_BADLY_FORMATTED_ERROR_MESSAGE, errorResponseException.getValue().getMessage());\n+        invalidSourceUrlRunner((invalidSourceUrl) -> {\n+            HttpResponseException errorResponseException = assertThrows(HttpResponseException.class,\n+                () -> client.beginRecognizeReceiptsFromUrl(invalidSourceUrl).getSyncPoller().getFinalResult());\n+            ErrorInformation errorInformation = (ErrorInformation) errorResponseException.getValue();\n+            assertEquals(INVALID_IMAGE_URL_ERROR_CODE, errorInformation.getCode());\n+            assertEquals(IMAGE_URL_IS_BADLY_FORMATTED_ERROR_MESSAGE, errorInformation.getMessage());\n         });\n     }\n \n"}}, {"oid": "8c620abd02aecd7517ff264be9d324119aa3864a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8c620abd02aecd7517ff264be9d324119aa3864a", "message": "map to HttpResponseException", "committedDate": "2020-06-26T22:05:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTM4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12478#discussion_r446431382", "bodyText": "@srnagar Does this seem like something we would want the autorest to be doing for the client ?", "author": "samvaity", "createdAt": "2020-06-26T22:07:13Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/implementation/Utility.java", "diffHunk": "@@ -187,4 +190,21 @@ Pair readBytes(int cnt) {\n             return this;\n         }\n     }\n+\n+    /**\n+     * Mapping a {@link ErrorResponseException} to {@link HttpResponseException} if exist. Otherwise, return\n+     * original {@link Throwable}.\n+     *\n+     * @param throwable A {@link Throwable}.\n+     * @return A {@link HttpResponseException} or the original throwable type.\n+     */\n+    public static Throwable mapToHttpResponseExceptionIfExist(Throwable throwable) {", "originalCommit": "8c620abd02aecd7517ff264be9d324119aa3864a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzNTI3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12478#discussion_r446435272", "bodyText": "Yes, I think it is better to define in swagger or make it configurable on swagger readme. Search has the same problem.", "author": "sima-zhu", "createdAt": "2020-06-26T22:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTM4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ0OTIzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12478#discussion_r446449231", "bodyText": "AutoRest will always provide the most specific error response. It's for the convenience layer to determine if it should be converted to a more generic exception type.", "author": "srnagar", "createdAt": "2020-06-26T23:20:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTM4Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8dd8bb0ddd7b8d5dbab07e08e258f82c462ce149", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8dd8bb0ddd7b8d5dbab07e08e258f82c462ce149", "message": "Simplify service exception", "committedDate": "2020-06-26T22:16:19Z", "type": "commit"}, {"oid": "8dd8bb0ddd7b8d5dbab07e08e258f82c462ce149", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8dd8bb0ddd7b8d5dbab07e08e258f82c462ce149", "message": "Simplify service exception", "committedDate": "2020-06-26T22:16:19Z", "type": "forcePushed"}, {"oid": "d10c28e0db201d327b7847906d5a92645d209de7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d10c28e0db201d327b7847906d5a92645d209de7", "message": "update formatting", "committedDate": "2020-06-27T01:46:20Z", "type": "commit"}, {"oid": "d10c28e0db201d327b7847906d5a92645d209de7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d10c28e0db201d327b7847906d5a92645d209de7", "message": "update formatting", "committedDate": "2020-06-27T01:46:20Z", "type": "forcePushed"}]}