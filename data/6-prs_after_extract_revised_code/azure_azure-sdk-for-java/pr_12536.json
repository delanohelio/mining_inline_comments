{"pr_number": 12536, "pr_title": "Replace RequestOptions with Context Policy", "pr_createdAt": "2020-06-26T20:20:52Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12536", "timeline": [{"oid": "e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "message": "Remove RequestOptions from public APIs", "committedDate": "2020-06-26T20:17:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NzM3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446397379", "bodyText": "Could you turn off the code reformatting?", "author": "sima-zhu", "createdAt": "2020-06-26T20:34:31Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java", "diffHunk": "@@ -40,9 +40,10 @@\n import com.azure.search.documents.implementation.models.SuggestDocumentsResult;\n import com.azure.search.documents.implementation.models.SuggestOptions;\n import com.azure.search.documents.implementation.models.SuggestRequest;\n+import reactor.core.publisher.Mono;\n+", "originalCommit": "e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxMjE1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446412155", "bodyText": "Will revert this change.", "author": "alzimmermsft", "createdAt": "2020-06-26T21:11:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NzM3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "e1197212a1696604d428a06d6acfd234927b40ec", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\nindex 35f15115a35..10e76672849 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\n\n@@ -40,10 +40,10 @@ import com.azure.search.documents.implementation.models.SearchRequest;\n import com.azure.search.documents.implementation.models.SuggestDocumentsResult;\n import com.azure.search.documents.implementation.models.SuggestOptions;\n import com.azure.search.documents.implementation.models.SuggestRequest;\n-import reactor.core.publisher.Mono;\n \n import java.util.List;\n import java.util.UUID;\n+import reactor.core.publisher.Mono;\n \n /** An instance of this class provides access to all the operations defined in Documents. */\n public final class DocumentsImpl {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NzU0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446397548", "bodyText": "Remember to remove the parameters", "author": "sima-zhu", "createdAt": "2020-06-26T20:34:59Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchAsyncClient.java", "diffHunk": "@@ -189,13 +185,13 @@ HttpPipeline getHttpPipeline() {\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<Response<IndexDocumentsResult>> uploadDocumentsWithResponse(Iterable<?> documents,\n-        IndexDocumentsOptions options, RequestOptions requestOptions) {\n-        return withContext(context -> uploadDocumentsWithResponse(documents, options, requestOptions, context));\n+        IndexDocumentsOptions options) {", "originalCommit": "e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxMTExMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446411110", "bodyText": "Not following completely on this request. Which parameters need to be removed?", "author": "alzimmermsft", "createdAt": "2020-06-26T21:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NzU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMjcwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446422706", "bodyText": "Sorry, I mean the JAVADOC", "author": "sima-zhu", "createdAt": "2020-06-26T21:40:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5NzU0OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5ODIxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446398214", "bodyText": "Could you show the example of how to set request id?", "author": "sima-zhu", "createdAt": "2020-06-26T20:36:34Z", "path": "sdk/search/azure-search-documents/src/samples/java/com/azure/search/documents/AutoCompleteExample.java", "diffHunk": "@@ -46,11 +43,8 @@ private static void autoCompleteWithOneTermContext(SearchClient searchClient) {\n         AutocompleteOptions params = new AutocompleteOptions().setAutocompleteMode(\n             AutocompleteMode.ONE_TERM_WITH_CONTEXT);\n \n-        RequestOptions requestOptions = new RequestOptions()\n-            .setClientRequestId(UUID.randomUUID());\n-\n         PagedIterableBase<AutocompleteItem, AutocompletePagedResponse> results = searchClient.autocomplete(\"coffee m\",", "originalCommit": "e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxMDU5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446410594", "bodyText": "I'll add an example of how to add per-request x-ms-client-request-id in the next commit.", "author": "alzimmermsft", "createdAt": "2020-06-26T21:07:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5ODIxNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5OTAyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446399027", "bodyText": "Could you have a test on setting request id?", "author": "sima-zhu", "createdAt": "2020-06-26T20:38:43Z", "path": "sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/indexes/IndexersManagementSyncTests.java", "diffHunk": "@@ -190,7 +188,7 @@ public void canCreateAndListIndexerNames() {\n         searchIndexerClient.createIndexer(indexer2);\n         indexersToDelete.add(indexer2.getName());\n \n-        Iterator<String> indexersRes = searchIndexerClient.listIndexerNames(generateRequestOptions(), Context.NONE)\n+        Iterator<String> indexersRes = searchIndexerClient.listIndexerNames(Context.NONE)", "originalCommit": "e21f4e95e336b54f5ca7e6f251bb715ec44e9a26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQxMDkwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446410905", "bodyText": "Will add a few tests. As a heads up we never validated the x-ms-client-request-id returned from the service match what was set in RequestOptions so this will be even more important to do.", "author": "alzimmermsft", "createdAt": "2020-06-26T21:08:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjM5OTAyNw=="}], "type": "inlineReview", "revised_code": {"commit": "3f09df8a2718c300b4e9f82f4f2052387644af0e", "chunk": "diff --git a/sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/indexes/IndexersManagementSyncTests.java b/sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/indexes/IndexersManagementSyncTests.java\nindex b398beb62f7..89683b844bf 100644\n--- a/sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/indexes/IndexersManagementSyncTests.java\n+++ b/sdk/search/azure-search-documents/src/test/java/com/azure/search/documents/indexes/IndexersManagementSyncTests.java\n\n@@ -180,9 +183,10 @@ public class IndexersManagementSyncTests extends SearchTestBase {\n         String dataSourceName = createDataSource();\n \n         SearchIndexer indexer1 = createBaseTestIndexerObject(indexName, dataSourceName);\n-        indexer1.setName(\"a\" + indexer1.getName());\n+        mutateName(indexer1, \"a\" + indexer1.getName());\n+\n         SearchIndexer indexer2 = createBaseTestIndexerObject(indexName, dataSourceName);\n-        indexer2.setName(\"b\" + indexer2.getName());\n+        mutateName(indexer2, \"b\" + indexer2.getName());\n         searchIndexerClient.createIndexer(indexer1);\n         indexersToDelete.add(indexer1.getName());\n         searchIndexerClient.createIndexer(indexer2);\n"}}, {"oid": "a6b1483dd75f357de685185a57ee97715ce01bbb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a6b1483dd75f357de685185a57ee97715ce01bbb", "message": "Add new samples and tests for passing per API call x-ms-client-request-id", "committedDate": "2020-06-26T23:00:07Z", "type": "commit"}, {"oid": "e1197212a1696604d428a06d6acfd234927b40ec", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e1197212a1696604d428a06d6acfd234927b40ec", "message": "Add new samples and tests for passing per API call x-ms-client-request-id", "committedDate": "2020-06-26T23:00:20Z", "type": "commit"}, {"oid": "3f09df8a2718c300b4e9f82f4f2052387644af0e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f09df8a2718c300b4e9f82f4f2052387644af0e", "message": "Merged in master, fixed README samples", "committedDate": "2020-06-26T23:23:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1MTgyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446451827", "bodyText": "Remove this. :)", "author": "sima-zhu", "createdAt": "2020-06-26T23:34:45Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java", "diffHunk": "@@ -40,6 +40,7 @@\n import com.azure.search.documents.implementation.models.SuggestDocumentsResult;\n import com.azure.search.documents.implementation.models.SuggestOptions;\n import com.azure.search.documents.implementation.models.SuggestRequest;\n+", "originalCommit": "3f09df8a2718c300b4e9f82f4f2052387644af0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1MzY3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12536#discussion_r446453679", "bodyText": "Done!", "author": "alzimmermsft", "createdAt": "2020-06-26T23:45:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ1MTgyNw=="}], "type": "inlineReview", "revised_code": {"commit": "97425a111da8284867cbb66a9c34e492b76c2dcd", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\nindex 10e76672849..688ef298019 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/implementation/DocumentsImpl.java\n\n@@ -40,7 +40,6 @@ import com.azure.search.documents.implementation.models.SearchRequest;\n import com.azure.search.documents.implementation.models.SuggestDocumentsResult;\n import com.azure.search.documents.implementation.models.SuggestOptions;\n import com.azure.search.documents.implementation.models.SuggestRequest;\n-\n import java.util.List;\n import java.util.UUID;\n import reactor.core.publisher.Mono;\n"}}, {"oid": "97425a111da8284867cbb66a9c34e492b76c2dcd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/97425a111da8284867cbb66a9c34e492b76c2dcd", "message": "Remove bad whitespace", "committedDate": "2020-06-26T23:44:48Z", "type": "commit"}, {"oid": "a81fde6561e95a46192e9e994e17552e8e097e85", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a81fde6561e95a46192e9e994e17552e8e097e85", "message": "Fix places where context wasn't passed properly", "committedDate": "2020-06-27T00:23:10Z", "type": "commit"}]}