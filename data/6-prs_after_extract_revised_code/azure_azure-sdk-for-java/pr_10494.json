{"pr_number": 10494, "pr_title": "Change MatchCondition to onlyIfUnchanged bool", "pr_createdAt": "2020-04-24T16:25:57Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10494", "timeline": [{"oid": "7445e4d645a880d8a9170c138402631931638106", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7445e4d645a880d8a9170c138402631931638106", "message": "Change MatchCondition to onlyIfUnchanged bool", "committedDate": "2020-04-24T16:17:31Z", "type": "commit"}, {"oid": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2f31db334c8c9734a72bab61649c3c21205ffa1c", "message": "Update the change log", "committedDate": "2020-04-24T16:31:58Z", "type": "commit"}, {"oid": "5ffc8ebc56cd9ed8e10a8a6443f1331737e73603", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ffc8ebc56cd9ed8e10a8a6443f1331737e73603", "message": "temp changes", "committedDate": "2020-04-24T16:33:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MzE1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414773157", "bodyText": "Why did we add null check here but nowhere else?", "author": "alzimmermsft", "createdAt": "2020-04-24T18:19:12Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -295,23 +308,29 @@ public Indexer getIndexer(String indexerName) {\n      * @param indexerName the name of the indexer to delete\n      */\n     public void deleteIndexer(String indexerName) {\n-        deleteIndexerWithResponse(indexerName, null, null, Context.NONE);\n+        deleteIndexerWithResponse(new Indexer().setName(indexerName), null, null, Context.NONE);\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search indexer.\n      *\n-     * @param indexerName the name of the indexer to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param indexer the search {@link Indexer}\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n      * doesn't match specified values\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context the context\n      * @return a response signalling completion.\n      */\n-    public Response<Void> deleteIndexerWithResponse(String indexerName, MatchConditions accessCondition,\n+    public Response<Void> deleteIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        return asyncClient.deleteIndexerWithResponse(indexerName, accessCondition, requestOptions, context).block();\n+        Objects.requireNonNull(indexer, \"Indexer cannot be 'null'.\");", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -308,29 +297,24 @@ public final class SearchServiceClient {\n      * @param indexerName the name of the indexer to delete\n      */\n     public void deleteIndexer(String indexerName) {\n-        deleteIndexerWithResponse(new Indexer().setName(indexerName), null, null, Context.NONE);\n+        deleteIndexerWithResponse(new Indexer().setName(indexerName), false, null, Context.NONE);\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search indexer.\n      *\n      * @param indexer the search {@link Indexer}\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context the context\n      * @return a response signalling completion.\n      */\n-    public Response<Void> deleteIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,\n+    public Response<Void> deleteIndexerWithResponse(Indexer indexer, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        Objects.requireNonNull(indexer, \"Indexer cannot be 'null'.\");\n-        MatchConditions accessCondition = new MatchConditions();\n-\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged? accessCondition.setIfMatch(indexer.getETag())\n-            : accessCondition;\n-        return asyncClient.deleteIndexerWithResponse(indexer.getName(), accessCondition, requestOptions, context)\n-            .block();\n+        String etag = onlyIfUnchanged ? indexer.getETag() : null;\n+        return asyncClient.deleteIndexerWithResponse(indexer.getName(), etag, requestOptions, context).block();\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MzY5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414773694", "bodyText": "Let's just update the internal APIs to take the onlyIfUnchanged boolean instead of adding the logic twice.", "author": "alzimmermsft", "createdAt": "2020-04-24T18:20:07Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -83,15 +85,18 @@ public DataSource createOrUpdateDataSource(DataSource dataSource) {\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n      * @param dataSource the definition of the data source to create or update\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n      * doesn't match specified values\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return a response containing data source that was created or updated.\n      */\n-    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource,\n-        MatchConditions accessCondition, RequestOptions requestOptions, Context context) {\n+    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, Boolean onlyIfUnchanged,\n+        RequestOptions requestOptions, Context context) {\n+        MatchConditions accessCondition = new MatchConditions();\n+        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged ?\n+            accessCondition.setIfMatch(dataSource.getETag()) : accessCondition;\n         return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, accessCondition, requestOptions, context)", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NTUwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414785505", "bodyText": "I am hoping service team will change the swagger sooner.\nWe need to change to ifMatch and ifNoneMatch to match the headers.", "author": "sima-zhu", "createdAt": "2020-04-24T18:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MzY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgxNTYyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414815629", "bodyText": "Will remove from transformer and clean up MatchConditions related changes.", "author": "sima-zhu", "createdAt": "2020-04-24T19:35:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3MzY5NA=="}], "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -78,26 +78,23 @@ public final class SearchServiceClient {\n      * @return the data source that was created or updated.\n      */\n     public DataSource createOrUpdateDataSource(DataSource dataSource) {\n-        return createOrUpdateDataSourceWithResponse(dataSource, null, null, Context.NONE).getValue();\n+        return createOrUpdateDataSourceWithResponse(dataSource, false, null, Context.NONE).getValue();\n     }\n \n     /**\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n-     * @param dataSource the definition of the data source to create or update\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param dataSource the {@link DataSource} to create or update\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return a response containing data source that was created or updated.\n      */\n-    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, Boolean onlyIfUnchanged,\n+    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        MatchConditions accessCondition = new MatchConditions();\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged ?\n-            accessCondition.setIfMatch(dataSource.getETag()) : accessCondition;\n-        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, accessCondition, requestOptions, context)\n+        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, onlyIfUnchanged, requestOptions, context)\n             .block();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NDYzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414774631", "bodyText": "Why are only the sync methods updated?", "author": "alzimmermsft", "createdAt": "2020-04-24T18:21:38Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -231,15 +241,18 @@ public Indexer createOrUpdateIndexer(Indexer indexer) {\n      * Creates a new Azure Cognitive Search indexer or updates an indexer if it already exists.\n      *\n      * @param indexer The definition of the indexer to create or update.\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n      * doesn't match specified values\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return A response object containing the Indexer.\n      */\n-    public Response<Indexer> createOrUpdateIndexerWithResponse(Indexer indexer, MatchConditions accessCondition,\n+    public Response<Indexer> createOrUpdateIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NTYyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414785627", "bodyText": "That's a miss", "author": "sima-zhu", "createdAt": "2020-04-24T18:40:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NDYzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -234,26 +226,23 @@ public final class SearchServiceClient {\n      * @return a response containing the created Indexer.\n      */\n     public Indexer createOrUpdateIndexer(Indexer indexer) {\n-        return createOrUpdateIndexerWithResponse(indexer, null, null, Context.NONE).getValue();\n+        return createOrUpdateIndexerWithResponse(indexer, false, null, Context.NONE).getValue();\n     }\n \n     /**\n      * Creates a new Azure Cognitive Search indexer or updates an indexer if it already exists.\n      *\n-     * @param indexer The definition of the indexer to create or update.\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param indexer The {@link Indexer} to create or update.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return A response object containing the Indexer.\n      */\n-    public Response<Indexer> createOrUpdateIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,\n+    public Response<Indexer> createOrUpdateIndexerWithResponse(Indexer indexer, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        MatchConditions accessCondition = new MatchConditions();\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged ? accessCondition.setIfMatch(indexer.getETag())\n-            : accessCondition;\n-        return asyncClient.createOrUpdateIndexerWithResponse(indexer, accessCondition, requestOptions, context).block();\n+        return asyncClient.createOrUpdateIndexerWithResponse(indexer, onlyIfUnchanged, requestOptions, context).block();\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NTY1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414775652", "bodyText": "Why use a Boolean? boolean should work the same without having the confusing null case.", "author": "alzimmermsft", "createdAt": "2020-04-24T18:23:25Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -83,15 +85,18 @@ public DataSource createOrUpdateDataSource(DataSource dataSource) {\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n      * @param dataSource the definition of the data source to create or update\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n      * doesn't match specified values\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return a response containing data source that was created or updated.\n      */\n-    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource,\n-        MatchConditions accessCondition, RequestOptions requestOptions, Context context) {\n+    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, Boolean onlyIfUnchanged,", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NjAyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414796024", "bodyText": "Yes, not sure about which user prefers.\nI am happy to make it boolean", "author": "sima-zhu", "createdAt": "2020-04-24T18:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NTY1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -78,26 +78,23 @@ public final class SearchServiceClient {\n      * @return the data source that was created or updated.\n      */\n     public DataSource createOrUpdateDataSource(DataSource dataSource) {\n-        return createOrUpdateDataSourceWithResponse(dataSource, null, null, Context.NONE).getValue();\n+        return createOrUpdateDataSourceWithResponse(dataSource, false, null, Context.NONE).getValue();\n     }\n \n     /**\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n-     * @param dataSource the definition of the data source to create or update\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param dataSource the {@link DataSource} to create or update\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return a response containing data source that was created or updated.\n      */\n-    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, Boolean onlyIfUnchanged,\n+    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        MatchConditions accessCondition = new MatchConditions();\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged ?\n-            accessCondition.setIfMatch(dataSource.getETag()) : accessCondition;\n-        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, accessCondition, requestOptions, context)\n+        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, onlyIfUnchanged, requestOptions, context)\n             .block();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NTc1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414775755", "bodyText": "Need to update Javadocs", "author": "alzimmermsft", "createdAt": "2020-04-24T18:23:35Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -83,15 +85,18 @@ public DataSource createOrUpdateDataSource(DataSource dataSource) {\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n      * @param dataSource the definition of the data source to create or update\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -78,26 +78,23 @@ public final class SearchServiceClient {\n      * @return the data source that was created or updated.\n      */\n     public DataSource createOrUpdateDataSource(DataSource dataSource) {\n-        return createOrUpdateDataSourceWithResponse(dataSource, null, null, Context.NONE).getValue();\n+        return createOrUpdateDataSourceWithResponse(dataSource, false, null, Context.NONE).getValue();\n     }\n \n     /**\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n-     * @param dataSource the definition of the data source to create or update\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param dataSource the {@link DataSource} to create or update\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context additional context that is passed through the HTTP pipeline during the service call\n      * @return a response containing data source that was created or updated.\n      */\n-    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, Boolean onlyIfUnchanged,\n+    public Response<DataSource> createOrUpdateDataSourceWithResponse(DataSource dataSource, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        MatchConditions accessCondition = new MatchConditions();\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged ?\n-            accessCondition.setIfMatch(dataSource.getETag()) : accessCondition;\n-        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, accessCondition, requestOptions, context)\n+        return asyncClient.createOrUpdateDataSourceWithResponse(dataSource, onlyIfUnchanged, requestOptions, context)\n             .block();\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NjU5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414776596", "bodyText": "Not a huge fan to switching this to Indexer just to support simpler ETag matching. We switched the burden from creating a simple MatchConditions class to creating a Indexer class.", "author": "alzimmermsft", "createdAt": "2020-04-24T18:24:59Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java", "diffHunk": "@@ -295,23 +308,29 @@ public Indexer getIndexer(String indexerName) {\n      * @param indexerName the name of the indexer to delete\n      */\n     public void deleteIndexer(String indexerName) {\n-        deleteIndexerWithResponse(indexerName, null, null, Context.NONE);\n+        deleteIndexerWithResponse(new Indexer().setName(indexerName), null, null, Context.NONE);\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search indexer.\n      *\n-     * @param indexerName the name of the indexer to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n+     * @param indexer the search {@link Indexer}\n+     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n      * doesn't match specified values\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context the context\n      * @return a response signalling completion.\n      */\n-    public Response<Void> deleteIndexerWithResponse(String indexerName, MatchConditions accessCondition,\n+    public Response<Void> deleteIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,", "originalCommit": "2f31db334c8c9734a72bab61649c3c21205ffa1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5NzczNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414797734", "bodyText": "Exactly a valid point.\n@heaths do you have any comments on this?", "author": "sima-zhu", "createdAt": "2020-04-24T19:01:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NjU5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwOTQ1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414809454", "bodyText": "See https://azure.github.io/azure-sdk/general_design.html#conditional-requests\nThis is a pattern established in AppConfiguration and simplifies how developers use ETag. No one else seems to expose MatchConditions directly. But even if we did, in order to use the ETag of an index (or any model), you would've had to retrieved it. So you already have it, right?", "author": "heaths", "createdAt": "2020-04-24T19:23:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc3NjU5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b39027596fdb36639555221ef131f29b4cf8cd6f", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\nindex f2012e7a795..64cd06b7834 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceClient.java\n\n@@ -308,29 +297,24 @@ public final class SearchServiceClient {\n      * @param indexerName the name of the indexer to delete\n      */\n     public void deleteIndexer(String indexerName) {\n-        deleteIndexerWithResponse(new Indexer().setName(indexerName), null, null, Context.NONE);\n+        deleteIndexerWithResponse(new Indexer().setName(indexerName), false, null, Context.NONE);\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search indexer.\n      *\n      * @param indexer the search {@link Indexer}\n-     * @param onlyIfUnchanged the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @param context the context\n      * @return a response signalling completion.\n      */\n-    public Response<Void> deleteIndexerWithResponse(Indexer indexer, Boolean onlyIfUnchanged,\n+    public Response<Void> deleteIndexerWithResponse(Indexer indexer, boolean onlyIfUnchanged,\n         RequestOptions requestOptions, Context context) {\n-        Objects.requireNonNull(indexer, \"Indexer cannot be 'null'.\");\n-        MatchConditions accessCondition = new MatchConditions();\n-\n-        accessCondition = onlyIfUnchanged != null && onlyIfUnchanged? accessCondition.setIfMatch(indexer.getETag())\n-            : accessCondition;\n-        return asyncClient.deleteIndexerWithResponse(indexer.getName(), accessCondition, requestOptions, context)\n-            .block();\n+        String etag = onlyIfUnchanged ? indexer.getETag() : null;\n+        return asyncClient.deleteIndexerWithResponse(indexer.getName(), etag, requestOptions, context).block();\n     }\n \n     /**\n"}}, {"oid": "b39027596fdb36639555221ef131f29b4cf8cd6f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b39027596fdb36639555221ef131f29b4cf8cd6f", "message": "Make changes to service api layer.", "committedDate": "2020-04-24T21:42:53Z", "type": "commit"}, {"oid": "1751422f1f2ca86fd8a32a1119e12e7b7eb7cfee", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1751422f1f2ca86fd8a32a1119e12e7b7eb7cfee", "message": "Fixed failed tests", "committedDate": "2020-04-24T22:09:56Z", "type": "commit"}, {"oid": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "message": "Added deleteafter tags for rg", "committedDate": "2020-04-24T22:18:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMDc0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414900744", "bodyText": "Let's push this logic into the package private method this calls into", "author": "alzimmermsft", "createdAt": "2020-04-24T22:36:43Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -271,37 +273,40 @@ public String getEndpoint() {\n     /**\n      * Delete a DataSource\n      *\n-     * @param dataSourceName the name of the data source for deletion\n+     * @param dataSourceName the name of the {@link DataSource} for deletion\n      * @return a void Mono\n      */\n     public Mono<Void> deleteDataSource(String dataSourceName) {\n-        return deleteDataSourceWithResponse(dataSourceName, null, null).flatMap(FluxUtil::toMono);\n+        return withContext(context ->\n+            deleteDataSourceWithResponse(dataSourceName, null, null, context).flatMap(FluxUtil::toMono));\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search data source.\n      *\n-     * @param dataSourceName The name of the data source to delete.\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param dataSource The {@link DataSource} to delete.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @return a mono response\n      */\n-    public Mono<Response<Void>> deleteDataSourceWithResponse(String dataSourceName, MatchConditions accessCondition,\n+    public Mono<Response<Void>> deleteDataSourceWithResponse(DataSource dataSource, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n+        Objects.requireNonNull(dataSource, \"'DataSource' cannot be null\");\n+        String etag = onlyIfUnchanged ? dataSource.getETag() : null;", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -293,8 +292,7 @@ public final class SearchServiceAsyncClient {\n      */\n     public Mono<Response<Void>> deleteDataSourceWithResponse(DataSource dataSource, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        Objects.requireNonNull(dataSource, \"'DataSource' cannot be null\");\n-        String etag = onlyIfUnchanged ? dataSource.getETag() : null;\n+        String etag = getETagFromResource(dataSource, onlyIfUnchanged);\n         return withContext(context ->\n             deleteDataSourceWithResponse(dataSource.getName(), etag, requestOptions, context));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMDg4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414900881", "bodyText": "Let's push this logic into the package private method this calls.", "author": "alzimmermsft", "createdAt": "2020-04-24T22:37:11Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -462,40 +469,42 @@ public String getEndpoint() {\n      * @return a response signalling completion.\n      */\n     public Mono<Void> deleteIndexer(String indexerName) {\n-        return deleteIndexerWithResponse(indexerName, null, null).flatMap(FluxUtil::toMono);\n+        return withContext(context -> deleteIndexerWithResponse(indexerName, null, null, context)\n+            .flatMap(FluxUtil::toMono));\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search indexer.\n      *\n-     * @param indexerName the name of the indexer to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param indexer the {@link Indexer} to delete\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @return a response signalling completion.\n      */\n-    public Mono<Response<Void>> deleteIndexerWithResponse(String indexerName, MatchConditions accessCondition,\n+    public Mono<Response<Void>> deleteIndexerWithResponse(Indexer indexer, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        return withContext(context -> deleteIndexerWithResponse(indexerName, accessCondition, requestOptions, context));\n+        Objects.requireNonNull(indexer, \"'Indexer' cannot be null\");\n+        String etag = onlyIfUnchanged ? indexer.getETag() : null;", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -485,8 +482,7 @@ public final class SearchServiceAsyncClient {\n      */\n     public Mono<Response<Void>> deleteIndexerWithResponse(Indexer indexer, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        Objects.requireNonNull(indexer, \"'Indexer' cannot be null\");\n-        String etag = onlyIfUnchanged ? indexer.getETag() : null;\n+        String etag = getETagFromResource(indexer, onlyIfUnchanged);\n         return withContext(context -> deleteIndexerWithResponse(indexer.getName(), etag, requestOptions, context));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMTAzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414901036", "bodyText": "Let's push this logic into the package private method this calls.", "author": "alzimmermsft", "createdAt": "2020-04-24T22:37:42Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -794,29 +806,31 @@ public String getEndpoint() {\n      * @return a response signalling completion.\n      */\n     public Mono<Void> deleteIndex(String indexName) {\n-        return deleteIndexWithResponse(indexName, null, null).flatMap(FluxUtil::toMono);\n+        return withContext(context -> deleteIndexWithResponse(indexName, null, null, null).flatMap(FluxUtil::toMono));\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search index and all the documents it contains.\n      *\n-     * @param indexName the name of the index to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param index the {@link Index} to delete.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @return a response signalling completion.\n      */\n-    public Mono<Response<Void>> deleteIndexWithResponse(String indexName, MatchConditions accessCondition,\n+    public Mono<Response<Void>> deleteIndexWithResponse(Index index, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        return withContext(context -> deleteIndexWithResponse(indexName, accessCondition, requestOptions, context));\n+        Objects.requireNonNull(index, \"'Index' cannot be null.\");\n+        String etag = onlyIfUnchanged ? index.getETag() : null;", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -821,8 +816,7 @@ public final class SearchServiceAsyncClient {\n      */\n     public Mono<Response<Void>> deleteIndexWithResponse(Index index, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        Objects.requireNonNull(index, \"'Index' cannot be null.\");\n-        String etag = onlyIfUnchanged ? index.getETag() : null;\n+        String etag = getETagFromResource(index, onlyIfUnchanged);\n         return withContext(context -> deleteIndexWithResponse(index.getName(), etag, requestOptions, context));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMTIwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414901200", "bodyText": "Let's push this logic into the package private this method calls.", "author": "alzimmermsft", "createdAt": "2020-04-24T22:38:12Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -1035,30 +1052,33 @@ public String getEndpoint() {\n      * @return a response signalling completion.\n      */\n     public Mono<Void> deleteSkillset(String skillsetName) {\n-        return deleteSkillsetWithResponse(skillsetName, null, null).flatMap(FluxUtil::toMono);\n+        return withContext(context -> deleteSkillsetWithResponse(skillsetName, null, null, context)\n+            .flatMap(FluxUtil::toMono));\n     }\n \n     /**\n      * Deletes a cognitive skillset in an Azure Cognitive Search service.\n      *\n-     * @param skillsetName the name of the skillset to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param skillset the {@link Skillset} to delete.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @return a response signalling completion.\n      */\n-    public Mono<Response<Void>> deleteSkillsetWithResponse(String skillsetName, MatchConditions accessCondition,\n+    public Mono<Response<Void>> deleteSkillsetWithResponse(Skillset skillset, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n+        Objects.requireNonNull(skillset, \"'Skillset' cannot be null.\");\n+        String etag = onlyIfUnchanged ? skillset.getETag() : null;", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -1068,8 +1061,7 @@ public final class SearchServiceAsyncClient {\n      */\n     public Mono<Response<Void>> deleteSkillsetWithResponse(Skillset skillset, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        Objects.requireNonNull(skillset, \"'Skillset' cannot be null.\");\n-        String etag = onlyIfUnchanged ? skillset.getETag() : null;\n+        String etag = getETagFromResource(skillset, onlyIfUnchanged);\n         return withContext(context ->\n             deleteSkillsetWithResponse(skillset.getName(), etag, requestOptions, context));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMTMzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r414901337", "bodyText": "Let's push this logic into the package private method this calls.", "author": "alzimmermsft", "createdAt": "2020-04-24T22:38:39Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -1221,34 +1244,37 @@ public String getEndpoint() {\n     /**\n      * Deletes an Azure Cognitive Search synonym map.\n      *\n-     * @param synonymMapName the name of the synonym map to delete\n+     * @param synonymMapName the name of the {@link SynonymMap} to delete\n      * @return a response signalling completion.\n      */\n     public Mono<Void> deleteSynonymMap(String synonymMapName) {\n-        return deleteSynonymMapWithResponse(synonymMapName, null, null).flatMap(FluxUtil::toMono);\n+        return withContext(context -> deleteSynonymMapWithResponse(synonymMapName, null, null, context)\n+            .flatMap(FluxUtil::toMono));\n     }\n \n     /**\n      * Deletes an Azure Cognitive Search synonym map.\n      *\n-     * @param synonymMapName the name of the synonym map to delete\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param synonymMap the {@link SynonymMap} to delete.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means\n+     * operation will apply only if etag matches. Otherwise, false.\n      * @param requestOptions additional parameters for the operation. Contains the tracking ID sent with the request to\n      * help with debugging\n      * @return a response signalling completion.\n      */\n-    public Mono<Response<Void>> deleteSynonymMapWithResponse(String synonymMapName, MatchConditions accessCondition,\n+    public Mono<Response<Void>> deleteSynonymMapWithResponse(SynonymMap synonymMap, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n+        Objects.requireNonNull(synonymMap, \"'SynonymMap' cannot be null\");\n+        String etag = onlyIfUnchanged ? synonymMap.getETag() : null;", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -1264,8 +1255,7 @@ public final class SearchServiceAsyncClient {\n      */\n     public Mono<Response<Void>> deleteSynonymMapWithResponse(SynonymMap synonymMap, boolean onlyIfUnchanged,\n         RequestOptions requestOptions) {\n-        Objects.requireNonNull(synonymMap, \"'SynonymMap' cannot be null\");\n-        String etag = onlyIfUnchanged ? synonymMap.getETag() : null;\n+        String etag = getETagFromResource(synonymMap, onlyIfUnchanged);\n         return withContext(context ->\n             deleteSynonymMapWithResponse(synonymMap.getName(), etag, requestOptions, context));\n     }\n"}}, {"oid": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "message": "Added package private helper method", "committedDate": "2020-04-25T05:16:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUzNTkzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r415535934", "bodyText": "The documentation shouldn't contain implementation details.\n@param onlyIfUnchanged {@code true} to update if the {@code dataSource} is the same as the current service value. {@code false} to always update existing value.", "author": "conniey", "createdAt": "2020-04-27T06:09:58Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -117,36 +117,38 @@ public String getEndpoint() {\n     /**\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n-     * @param dataSource the definition of the data source to create or update\n+     * @param dataSource The definition of the {@link DataSource} to create or update.\n      * @return the data source that was created or updated.\n      */\n     public Mono<DataSource> createOrUpdateDataSource(DataSource dataSource) {\n-        return createOrUpdateDataSourceWithResponse(dataSource, null, null).map(Response::getValue);\n+        return createOrUpdateDataSourceWithResponse(dataSource, false, null).map(Response::getValue);\n     }\n \n     /**\n      * Creates a new Azure Cognitive Search data source or updates a data source if it already exists.\n      *\n-     * @param dataSource The definition of the data source to create or update.\n-     * @param accessCondition the condition where the operation will be performed if the ETag on the server matches or\n-     * doesn't match specified values\n+     * @param dataSource The definition of the {@link DataSource} to create or update.\n+     * @param onlyIfUnchanged boolean to indicate whether to check etag before perform the operation. True means", "originalCommit": "13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUzNjE2MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r415536161", "bodyText": "Same with any other instances of this.", "author": "conniey", "createdAt": "2020-04-27T06:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTUzNTkzNA=="}], "type": "inlineReview", "revised_code": {"commit": "af0871f358abbea14807eefd1abf2857c1caa238", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 18eac40739b..553049cae56 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -142,13 +142,12 @@ public final class SearchServiceAsyncClient {\n \n     Mono<Response<DataSource>> createOrUpdateDataSourceWithResponse(DataSource dataSource,\n         boolean onlyIfUnchanged, RequestOptions requestOptions, Context context) {\n-        Objects.requireNonNull(dataSource, \"'DataSource' cannot be null.\");\n-        String ifMatch = onlyIfUnchanged ? dataSource.getETag() : null;\n+        String etag = getETagFromResource(dataSource, onlyIfUnchanged);\n         try {\n             return restClient\n                 .dataSources()\n-                .createOrUpdateWithRestResponseAsync(dataSource.getName(),\n-                    dataSource, ifMatch, null, requestOptions, context)\n+                .createOrUpdateWithRestResponseAsync(dataSource.getName(), dataSource, etag, null,\n+                    requestOptions, context)\n                 .map(Function.identity());\n         } catch (RuntimeException ex) {\n             return monoError(logger, ex);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk1NzgwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10494#discussion_r415957806", "bodyText": "Let's remove this method and keep ETag retrieval scoped to the individual call. Right now this is using reflection to retrieve a known field when using an Index, Indexer, etc.\nLet's keep the logic simple and repetitive in the package private methods that call into the implementation layer by having them use getETag on the object they are working with.", "author": "alzimmermsft", "createdAt": "2020-04-27T16:22:08Z", "path": "sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java", "diffHunk": "@@ -1286,4 +1302,13 @@ public String getEndpoint() {\n             return monoError(logger, ex);\n         }\n     }\n+\n+    protected String getETagFromResource(Object resource, boolean onlyIfUnchanged) {", "originalCommit": "5656545c9c7ace67c3ece0dc3de8ca74510a6dda", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c4dfef51f1ac66cd57a40a7d4e7e6ca4cba862ed", "chunk": "diff --git a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\nindex 553049cae56..f608b96138b 100644\n--- a/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n+++ b/sdk/search/azure-search-documents/src/main/java/com/azure/search/documents/SearchServiceAsyncClient.java\n\n@@ -1302,13 +1312,4 @@ public final class SearchServiceAsyncClient {\n             return monoError(logger, ex);\n         }\n     }\n-\n-    protected String getETagFromResource(Object resource, boolean onlyIfUnchanged) {\n-        Objects.requireNonNull(resource);\n-        try {\n-            return onlyIfUnchanged ? (String) resource.getClass().getMethod(\"getETag\").invoke(resource) : null;\n-        } catch (Exception ex) {\n-            return null;\n-        }\n-    }\n }\n"}}, {"oid": "af0871f358abbea14807eefd1abf2857c1caa238", "url": "https://github.com/Azure/azure-sdk-for-java/commit/af0871f358abbea14807eefd1abf2857c1caa238", "message": "Revert \"Added deleteafter tags for rg\"\n\nThis reverts commit 13aafac4a41fcabd56d5b32a5e5ecdc7c43622d6.", "committedDate": "2020-04-27T16:54:29Z", "type": "commit"}, {"oid": "c314858e253cc0e91540f904d4fa070e03d08f95", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c314858e253cc0e91540f904d4fa070e03d08f95", "message": "Update comments", "committedDate": "2020-04-27T17:13:34Z", "type": "commit"}, {"oid": "c4dfef51f1ac66cd57a40a7d4e7e6ca4cba862ed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4dfef51f1ac66cd57a40a7d4e7e6ca4cba862ed", "message": "Revert \"Added package private helper method\"\n\nThis reverts commit 5656545c9c7ace67c3ece0dc3de8ca74510a6dda.", "committedDate": "2020-04-27T17:55:07Z", "type": "commit"}]}