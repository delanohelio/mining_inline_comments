{"pr_number": 18071, "pr_title": "modify AzureOAuth2ResponseErrorHandler.class name and add notes.", "pr_createdAt": "2020-12-10T09:20:53Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/18071", "timeline": [{"oid": "4fa95bd881d5720c42af31fa7f988f09018f6bf8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4fa95bd881d5720c42af31fa7f988f09018f6bf8", "message": "add notes for class", "committedDate": "2020-12-10T09:13:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3NzQ3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18071#discussion_r540577479", "bodyText": "It's better to add one space after //.\nHere, /* */ is better than //.\nWe can break line if link is too long.", "author": "chenrujun", "createdAt": "2020-12-10T23:30:40Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADConditionalAccessResponseErrorHandler.java", "diffHunk": "@@ -49,6 +49,8 @@ public void handleError(ClientHttpResponse response) throws IOException {\n         if (oauth2Error == null) {\n             oauth2Error = this.oauth2ErrorConverter.read(OAuth2Error.class, response);\n         }\n+        //Handle conditional access policy, step 1.\n+        //About conditional access: https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa", "originalCommit": "4fa95bd881d5720c42af31fa7f988f09018f6bf8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f90e8f9d930501593669460059292b619ec25fcf", "chunk": "diff --git a/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADConditionalAccessResponseErrorHandler.java b/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADConditionalAccessResponseErrorHandler.java\nindex 514a67c8f19..209b8b63d0c 100644\n--- a/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADConditionalAccessResponseErrorHandler.java\n+++ b/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AADConditionalAccessResponseErrorHandler.java\n\n@@ -49,8 +49,10 @@ public class AADConditionalAccessResponseErrorHandler implements ResponseErrorHa\n         if (oauth2Error == null) {\n             oauth2Error = this.oauth2ErrorConverter.read(OAuth2Error.class, response);\n         }\n-        //Handle conditional access policy, step 1.\n-        //About conditional access: https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa\n+        /**\n+         *  Handle conditional access policy, step 1.\n+         *  https://docs.microsoft.com/en-us/azure/active-directory/conditional-access/howto-conditional-access-policy-all-users-mfa\n+         */\n         throw new OAuth2AuthorizationException(oauth2Error);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU3ODEwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/18071#discussion_r540578103", "bodyText": "It's better to add a space after //.\nIt's better to move it to line 46.", "author": "chenrujun", "createdAt": "2020-12-10T23:32:09Z", "path": "sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureOAuthenticationFailureHandler.java", "diffHunk": "@@ -31,7 +31,7 @@ public AzureOAuthenticationFailureHandler() {\n     public void onAuthenticationFailure(HttpServletRequest request,\n                                         HttpServletResponse response,\n                                         AuthenticationException exception) throws IOException, ServletException {\n-\n+        //Handle conditional access policy, step 2.", "originalCommit": "4fa95bd881d5720c42af31fa7f988f09018f6bf8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f90e8f9d930501593669460059292b619ec25fcf", "chunk": "diff --git a/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureOAuthenticationFailureHandler.java b/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureOAuthenticationFailureHandler.java\nindex 9fa58a0d7d7..086ea2c1ac1 100644\n--- a/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureOAuthenticationFailureHandler.java\n+++ b/sdk/spring/azure-spring-boot/src/main/java/com/azure/spring/aad/webapp/AzureOAuthenticationFailureHandler.java\n\n@@ -31,10 +31,11 @@ public class AzureOAuthenticationFailureHandler implements AuthenticationFailure\n     public void onAuthenticationFailure(HttpServletRequest request,\n                                         HttpServletResponse response,\n                                         AuthenticationException exception) throws IOException, ServletException {\n-        //Handle conditional access policy, step 2.\n         String claims = Optional.of(exception)\n+                                .filter(e -> e instanceof OAuth2AuthenticationException)\n                                 .map(e -> (OAuth2AuthenticationException) e)\n                                 .map(OAuth2AuthenticationException::getError)\n+                                .filter(e -> e instanceof AzureOAuth2Error)\n                                 .map(e -> (AzureOAuth2Error) e)\n                                 .map(AzureOAuth2Error::getClaims)\n                                 .orElse(null);\n"}}, {"oid": "f90e8f9d930501593669460059292b619ec25fcf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f90e8f9d930501593669460059292b619ec25fcf", "message": "add notes and perfect program", "committedDate": "2020-12-11T06:30:33Z", "type": "commit"}]}