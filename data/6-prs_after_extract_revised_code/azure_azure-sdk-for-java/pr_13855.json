{"pr_number": 13855, "pr_title": "[TA] Added offset and length support in CatorizedEntities and LinkedEntitiesMatch", "pr_createdAt": "2020-08-07T04:41:43Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13855", "timeline": [{"oid": "2e95d29b8d2058e93d99d2bdd08a8192cd7e4770", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2e95d29b8d2058e93d99d2bdd08a8192cd7e4770", "message": "added offset and length for CategorizedEntities and LinkedEntitesMatch", "committedDate": "2020-08-07T04:37:58Z", "type": "commit"}, {"oid": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "message": "refactor other endpoint besides analyze sentiment", "committedDate": "2020-08-07T05:45:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA5MTg4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467091889", "bodyText": "@maririos made this comment on my PR too, but it would be clearer if this was \"Get the offset of the linked entity match text\"", "author": "iscai-msft", "createdAt": "2020-08-07T14:53:56Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java", "diffHunk": "@@ -51,4 +79,22 @@ public double getConfidenceScore() {\n     public String getText() {\n         return this.text;\n     }\n+\n+    /**\n+     * Get the offset of entity text.", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2993377e5acf9e0fd9a2f5c9ae7008583eedc36a", "chunk": "diff --git a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\nindex f676249bc7c..fee189c2713 100644\n--- a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\n+++ b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\n\n@@ -72,7 +72,7 @@ public final class LinkedEntityMatch {\n     }\n \n     /**\n-     * Get the text property: Entity text as appears in the request.\n+     * Get the linked entity match text property: Entity text as appears in the request.\n      *\n      * @return The text value.\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzA5MzM0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467093341", "bodyText": "next time can you make these other test changes in another PR, it's a little hard to see what actual tests were added for offset and length", "author": "iscai-msft", "createdAt": "2020-08-07T14:56:18Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsClientTestBase.java", "diffHunk": "@@ -484,6 +521,8 @@ static void validateCategorizedEntity(\n         CategorizedEntity expectedCategorizedEntity, CategorizedEntity actualCategorizedEntity) {\n         assertEquals(expectedCategorizedEntity.getSubcategory(), actualCategorizedEntity.getSubcategory());\n         assertEquals(expectedCategorizedEntity.getText(), actualCategorizedEntity.getText());\n+        assertEquals(expectedCategorizedEntity.getOffset(), actualCategorizedEntity.getOffset());", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5MDYzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467190639", "bodyText": "should we keep the offset and length after confidenceScore so that someone that depended on previous constructor would use this by just appending properties?", "author": "maririos", "createdAt": "2020-08-07T18:02:31Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/CategorizedEntity.java", "diffHunk": "@@ -43,6 +53,28 @@ public CategorizedEntity(String text, EntityCategory category, String subcategor\n         this.category = category;\n         this.subcategory = subcategory;\n         this.confidenceScore = confidenceScore;\n+        this.offset = 0;\n+        this.length = 0;\n+    }\n+\n+    /**\n+     * Creates a {@link CategorizedEntity} model that describes entity.\n+     *\n+     * @param text The entity text as appears in the request.\n+     * @param category The entity category, such as Person/Location/Org/SSN etc.\n+     * @param subcategory The entity subcategory, such as Age/Year/TimeRange etc.\n+     * @param offset The start position for the entity text.\n+     * @param length The length for the entity text.\n+     * @param confidenceScore A confidence score between 0 and 1 of the extracted entity.\n+     */\n+    public CategorizedEntity(String text, EntityCategory category, String subcategory, int offset, int length,", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2993377e5acf9e0fd9a2f5c9ae7008583eedc36a", "chunk": "diff --git a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/CategorizedEntity.java b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/CategorizedEntity.java\nindex 13eb9597adf..ac8e3566c83 100644\n--- a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/CategorizedEntity.java\n+++ b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/CategorizedEntity.java\n\n@@ -59,16 +59,15 @@ public final class CategorizedEntity {\n \n     /**\n      * Creates a {@link CategorizedEntity} model that describes entity.\n-     *\n      * @param text The entity text as appears in the request.\n      * @param category The entity category, such as Person/Location/Org/SSN etc.\n      * @param subcategory The entity subcategory, such as Age/Year/TimeRange etc.\n+     * @param confidenceScore A confidence score between 0 and 1 of the extracted entity.\n      * @param offset The start position for the entity text.\n      * @param length The length for the entity text.\n-     * @param confidenceScore A confidence score between 0 and 1 of the extracted entity.\n      */\n-    public CategorizedEntity(String text, EntityCategory category, String subcategory, int offset, int length,\n-        double confidenceScore) {\n+    public CategorizedEntity(String text, EntityCategory category, String subcategory, double confidenceScore,\n+        int offset, int length) {\n         this.text = text;\n         this.category = category;\n         this.subcategory = subcategory;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5MDkxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467190916", "bodyText": "linked entity text...", "author": "maririos", "createdAt": "2020-08-07T18:03:10Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java", "diffHunk": "@@ -51,4 +79,22 @@ public double getConfidenceScore() {\n     public String getText() {\n         return this.text;\n     }\n+\n+    /**\n+     * Get the offset of entity text.\n+     *\n+     * @return The offset of entity text.\n+     */\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    /**\n+     * Get the length of entity text.", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2993377e5acf9e0fd9a2f5c9ae7008583eedc36a", "chunk": "diff --git a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\nindex f676249bc7c..fee189c2713 100644\n--- a/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\n+++ b/sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/LinkedEntityMatch.java\n\n@@ -72,7 +72,7 @@ public final class LinkedEntityMatch {\n     }\n \n     /**\n-     * Get the text property: Entity text as appears in the request.\n+     * Get the linked entity match text property: Entity text as appears in the request.\n      *\n      * @return The text value.\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5NTcxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467195711", "bodyText": "is this just cleanup? or what is the motivation for these changes", "author": "maririos", "createdAt": "2020-08-07T18:13:07Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TestUtils.java", "diffHunk": "@@ -144,22 +144,24 @@\n      * @return A {@link DetectLanguageResultCollection}.\n      */\n     static DetectLanguageResultCollection getExpectedBatchDetectedLanguages() {\n-        DetectedLanguage detectedLanguage1 = new DetectedLanguage(\"English\", \"en\", 0.0, null);\n-        DetectedLanguage detectedLanguage2 = new DetectedLanguage(\"Spanish\", \"es\", 0.0, null);\n-        DetectedLanguage detectedLanguage3 = new DetectedLanguage(\"(Unknown)\", \"(Unknown)\", 0.0, null);\n-\n-        TextDocumentStatistics textDocumentStatistics1 = new TextDocumentStatistics(26, 1);\n-        TextDocumentStatistics textDocumentStatistics2 = new TextDocumentStatistics(40, 1);\n-        TextDocumentStatistics textDocumentStatistics3 = new TextDocumentStatistics(6, 1);\n+        final TextDocumentBatchStatistics textDocumentBatchStatistics = new TextDocumentBatchStatistics(3, 3, 0, 3);", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5NzE5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467197193", "bodyText": "To add getDetectedLanguageEnglish(), getDetectedLanguageSpanish(), and getUnknownDetectedLanguage() helper methods. These result repeatedly used over many place, such as atomic operation.", "author": "mssfang", "createdAt": "2020-08-07T18:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5NTcxMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5Njc5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r467196795", "bodyText": "my concern with having all this tests to look at specific values is that if the service changes something about their model, then our test will fail.\nMake sure whenever u call this that the model-version is set to avoid it", "author": "maririos", "createdAt": "2020-08-07T18:15:18Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TestUtils.java", "diffHunk": "@@ -217,32 +218,40 @@ static RecognizeEntitiesResult getExpectedBatchCategorizedEntities2() {\n      * @return A {@link RecognizeLinkedEntitiesResultCollection}.\n      */\n     static RecognizeLinkedEntitiesResultCollection getExpectedBatchLinkedEntities() {\n-        LinkedEntityMatch linkedEntityMatch1 = new LinkedEntityMatch(\"Seattle\", 0.0);\n-        LinkedEntityMatch linkedEntityMatch2 = new LinkedEntityMatch(\"Microsoft\", 0.0);\n+        final TextDocumentBatchStatistics textDocumentBatchStatistics = new TextDocumentBatchStatistics(2, 2, 0, 2);\n+        final List<RecognizeLinkedEntitiesResult> recognizeLinkedEntitiesResultList =\n+            Arrays.asList(\n+                new RecognizeLinkedEntitiesResult(\n+                    \"0\", new TextDocumentStatistics(44, 1), null,\n+                    new LinkedEntityCollection(new IterableStream<>(getLinkedEntitiesList1()), null)),\n+                new RecognizeLinkedEntitiesResult(\n+                    \"1\", new TextDocumentStatistics(20, 1), null,\n+                    new LinkedEntityCollection(new IterableStream<>(getLinkedEntitiesList2()), null)));\n+        return new RecognizeLinkedEntitiesResultCollection(recognizeLinkedEntitiesResultList, DEFAULT_MODEL_VERSION, textDocumentBatchStatistics);\n+    }\n \n-        LinkedEntity linkedEntity1 = new LinkedEntity(\n-            \"Seattle\", new IterableStream<>(Collections.singletonList(linkedEntityMatch1)),\n+    /**\n+     * Helper method to get the expected linked Entities List 1\n+     */\n+    static List<LinkedEntity> getLinkedEntitiesList1() {", "originalCommit": "bd47a0dc9a2716a875d7cbe7e63e2f8221fcfc80", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE0NDc3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13855#discussion_r468144777", "bodyText": "Sounds good. Will take care of model-version in another PR. Since TA hasn't apply the model version in other APIs.\nissue created: #13943", "author": "mssfang", "createdAt": "2020-08-10T19:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE5Njc5NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "2993377e5acf9e0fd9a2f5c9ae7008583eedc36a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2993377e5acf9e0fd9a2f5c9ae7008583eedc36a", "message": "address feedbacks", "committedDate": "2020-08-10T19:55:08Z", "type": "commit"}]}