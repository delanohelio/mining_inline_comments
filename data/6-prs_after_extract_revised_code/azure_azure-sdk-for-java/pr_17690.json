{"pr_number": 17690, "pr_title": "Fix Connection Closing on Timeout", "pr_createdAt": "2020-11-19T20:53:33Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17690", "timeline": [{"oid": "e7b2464e4b12ebd9757ae720af3e84c601abef75", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7b2464e4b12ebd9757ae720af3e84c601abef75", "message": "Close connection when timeout occurs", "committedDate": "2020-11-18T21:25:27Z", "type": "commit"}, {"oid": "b474fa01e1dabaa6d9857238e9edda115e617892", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b474fa01e1dabaa6d9857238e9edda115e617892", "message": "Add CHANGELOG entry", "committedDate": "2020-11-19T20:52:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyNjIyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17690#discussion_r527326224", "bodyText": "Why is this check required? Can this method be called multiple times? If yes, what's the impact of trying to close the context each time?", "author": "srnagar", "createdAt": "2020-11-20T00:57:36Z", "path": "sdk/core/azure-core-http-netty/src/main/java/com/azure/core/http/netty/implementation/ReadTimeoutHandler.java", "diffHunk": "@@ -65,6 +66,10 @@ private void readTimeoutRunnable(ChannelHandlerContext ctx) {\n         }\n \n         // No progress has been made since the last timeout event, channel has timed out.\n-        ctx.fireExceptionCaught(new TimeoutException(String.format(READ_TIMED_OUT_MESSAGE, timeoutMillis)));\n+        if (!closed) {", "originalCommit": "b474fa01e1dabaa6d9857238e9edda115e617892", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg4NTc2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17690#discussion_r527885765", "bodyText": "The check is there to ensure that we don't fire the exception multiple times. As for what happens if close is called multiple times I am not certain and can take a look into this.", "author": "alzimmermsft", "createdAt": "2020-11-20T18:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyNjIyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkxMDQ3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17690#discussion_r527910471", "bodyText": "Looked into the safety of calling close multiple times and the answer is unknown as this will trigger the close handler for other handlers, so it would be dependent on the configuration of the Netty pipeline. In our default instance it is safe to call multiple times but that isn't a guarantee.", "author": "alzimmermsft", "createdAt": "2020-11-20T18:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMyNjIyNA=="}], "type": "inlineReview", "revised_code": null}]}