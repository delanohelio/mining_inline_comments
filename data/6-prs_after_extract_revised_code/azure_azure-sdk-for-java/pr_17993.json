{"pr_number": 17993, "pr_title": "Fix memory leak in ServiceBusReceiverAsyncClient client lock containers", "pr_createdAt": "2020-12-05T23:32:20Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17993", "timeline": [{"oid": "8b3923c625ef1248ffcaf69b173d9408d5882eec", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b3923c625ef1248ffcaf69b173d9408d5882eec", "message": "Closing lock containers fields in order to fix a memory leak.\n\nLockContainer constructor subscribes to Flux (cleanupOperation) and its consumer was not getting disposed under a async client close call.", "committedDate": "2020-12-05T21:41:08Z", "type": "commit"}, {"oid": "3f1ff8dbe3d54ec8c35403a8df7daa753e52015e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f1ff8dbe3d54ec8c35403a8df7daa753e52015e", "message": "Unit testing that lock containers are closed under async client close call.", "committedDate": "2020-12-05T22:38:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MTc2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17993#discussion_r537541768", "bodyText": "In hindsight, I could have made these dependencies, so we wouldn't have to add these package-private methods to assert behaviour. Next time! :)", "author": "conniey", "createdAt": "2020-12-07T14:18:58Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -1312,4 +1315,12 @@ private Throwable mapError(Throwable throwable, ServiceBusErrorSource errorSourc\n     boolean isConnectionClosed() {\n         return this.connectionProcessor.isChannelClosed();\n     }\n+\n+    boolean isManagementNodeLocksClosed() {", "originalCommit": "3f1ff8dbe3d54ec8c35403a8df7daa753e52015e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYyMzQ0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17993#discussion_r537623448", "bodyText": "That would be nice. I got the same feeling when trying to figure out how to write the unit tests. :D", "author": "marciopd", "createdAt": "2020-12-07T16:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU0MTc2OA=="}], "type": "inlineReview", "revised_code": null}]}