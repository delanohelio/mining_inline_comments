{"pr_number": 17925, "pr_title": "fix consumer processError in the service bus example", "pr_createdAt": "2020-12-02T09:16:31Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17925", "timeline": [{"oid": "e84cf271267e8cedb6487c5df5463b4b97c2c2af", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e84cf271267e8cedb6487c5df5463b4b97c2c2af", "message": "fix consumer process error in the service bus example\n\n(cherry picked from commit 83dc4c38813905452dd578b746321bb8f6043a0a)", "committedDate": "2020-12-01T17:25:29Z", "type": "commit"}, {"oid": "a77ddaed8f28d7432a087bc85f0b575cfcf987cc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a77ddaed8f28d7432a087bc85f0b575cfcf987cc", "message": "add embedme for code example of processore client", "committedDate": "2020-12-02T23:13:35Z", "type": "commit"}, {"oid": "6c4ae6f95a681e016572f02c565f58b6b8c3ac26", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c4ae6f95a681e016572f02c565f58b6b8c3ac26", "message": "change default strings", "committedDate": "2020-12-02T23:17:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU3Mzc2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17925#discussion_r534573764", "bodyText": "Add .disableAutoComplete()\nBy default autoComplete is enabled,  this means this SDK will internally  complete the message for you and user do not need to call messageContext.complete() .\nBut since we want to show how  user can disable this feature  by calling disableAutoComplete and complete it manually (like you do in  processMessage Consumer).\nWe had this bug in readme and it was  left over,  since you are touching this specific part, you can fix this also.  Thank You", "author": "hemanttanwar", "createdAt": "2020-12-03T00:24:57Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReadmeSamples.java", "diffHunk": "@@ -206,4 +207,38 @@ public void createSynchronousServiceBusDeadLetterQueueReceiver() {\n             .subQueue(SubQueue.DEAD_LETTER_QUEUE)\n             .buildClient();\n     }\n+\n+    /**\n+     * Code sample for creating a Service Bus Processor Client.\n+     */\n+    public void createServiceBusProcessorClient() {\n+        // Sample code that processes a single message\n+        Consumer<ServiceBusReceivedMessageContext> processMessage = messageContext -> {\n+            try {\n+                System.out.println(messageContext.getMessage().getMessageId());\n+                // other message processing code\n+                messageContext.complete();\n+            } catch (Exception ex) {\n+                messageContext.abandon();\n+            }\n+        };\n+\n+        // Sample code that gets called if there's an error\n+        Consumer<ServiceBusErrorContext> processError = errorContext -> {\n+            System.err.println(\"Error occurred while receiving message: \" + errorContext.getException());\n+        };\n+\n+        // create the processor client via the builder and its sub-builder\n+        ServiceBusProcessorClient processorClient = new ServiceBusClientBuilder()\n+                                        .connectionString(\"<< CONNECTION STRING FOR THE SERVICE BUS NAMESPACE >>\")\n+                                        .processor()\n+                                        .queueName(\"<< QUEUE NAME >>\")\n+                                        .processMessage(processMessage)", "originalCommit": "6c4ae6f95a681e016572f02c565f58b6b8c3ac26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDg0NTM5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17925#discussion_r534845392", "bodyText": "I used disableAutoComplete in a project to fix exactly the issue you wrote.\nI added the change to the pull request.", "author": "frascu", "createdAt": "2020-12-03T07:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU3Mzc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "853be0a6a8a121da4e02b77c27aee81c9699e086", "chunk": "diff --git a/sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReadmeSamples.java b/sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReadmeSamples.java\nindex d4767ca198f..83761bb4822 100644\n--- a/sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReadmeSamples.java\n+++ b/sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReadmeSamples.java\n\n@@ -235,6 +235,7 @@ public class ReadmeSamples {\n                                         .queueName(\"<< QUEUE NAME >>\")\n                                         .processMessage(processMessage)\n                                         .processError(processError)\n+                                        .disableAutoComplete()\n                                         .buildProcessorClient();\n \n         // Starts the processor in the background and returns immediately\n"}}, {"oid": "853be0a6a8a121da4e02b77c27aee81c9699e086", "url": "https://github.com/Azure/azure-sdk-for-java/commit/853be0a6a8a121da4e02b77c27aee81c9699e086", "message": "add disableAutoComplete to complete/abandon the message manually", "committedDate": "2020-12-03T07:46:18Z", "type": "commit"}]}