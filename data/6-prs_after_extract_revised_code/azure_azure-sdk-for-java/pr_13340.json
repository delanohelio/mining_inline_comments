{"pr_number": 13340, "pr_title": "Update OffsetDateTime Handling during Deserialization", "pr_createdAt": "2020-07-20T21:08:51Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13340", "timeline": [{"oid": "da12174e042924b7fe9b046cf06a028ba93ab605", "url": "https://github.com/Azure/azure-sdk-for-java/commit/da12174e042924b7fe9b046cf06a028ba93ab605", "message": "Add OffsetDateTime deserializer and update JacksonAdapter to use the new deserializer", "committedDate": "2020-07-20T21:05:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk2MjE2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13340#discussion_r458962166", "bodyText": "Do we need to expose this? It's only used once in this class so I can see it being rolled into the method above. I don't think it would change testing strategy either.", "author": "conniey", "createdAt": "2020-07-22T17:29:27Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/DateTimeDeserializer.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.util.serializer;\n+\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.module.SimpleModule;\n+\n+import java.io.IOException;\n+import java.time.LocalDateTime;\n+import java.time.OffsetDateTime;\n+import java.time.ZoneOffset;\n+import java.time.format.DateTimeFormatter;\n+import java.time.temporal.TemporalAccessor;\n+import java.time.temporal.TemporalQueries;\n+\n+/**\n+ * Custom deserializer that handles converting ISO8601 dates into {@link OffsetDateTime} objects.\n+ */\n+class DateTimeDeserializer extends JsonDeserializer<OffsetDateTime> {\n+    private static final SimpleModule MODULE;\n+\n+    static {\n+        MODULE = new SimpleModule().addDeserializer(OffsetDateTime.class, new DateTimeDeserializer());\n+    }\n+\n+    /**\n+     * Gets a module wrapping this deserializer as an adapter for the Jackson ObjectMapper.\n+     *\n+     * @return A {@link SimpleModule} to be plugged onto Jackson ObjectMapper.\n+     */\n+    public static SimpleModule getModule() {\n+        return MODULE;\n+    }\n+\n+    @Override\n+    public OffsetDateTime deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n+        throws IOException {\n+        return deserialize(jsonParser.getValueAsString());\n+    }\n+\n+    static OffsetDateTime deserialize(String offsetDateTimeString) {", "originalCommit": "da12174e042924b7fe9b046cf06a028ba93ab605", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk3MDg0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13340#discussion_r458970847", "bodyText": "Removed", "author": "alzimmermsft", "createdAt": "2020-07-22T17:43:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk2MjE2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "64cdf7ebf0ad3151871d9bd9a4d0624d228a40a7", "chunk": "diff --git a/sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/DateTimeDeserializer.java b/sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/DateTimeDeserializer.java\nindex 211dc2a9534..1725fb02c2c 100644\n--- a/sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/DateTimeDeserializer.java\n+++ b/sdk/core/azure-core/src/main/java/com/azure/core/util/serializer/DateTimeDeserializer.java\n\n@@ -36,14 +36,10 @@ class DateTimeDeserializer extends JsonDeserializer<OffsetDateTime> {\n     }\n \n     @Override\n-    public OffsetDateTime deserialize(JsonParser jsonParser, DeserializationContext deserializationContext)\n-        throws IOException {\n-        return deserialize(jsonParser.getValueAsString());\n-    }\n-\n-    static OffsetDateTime deserialize(String offsetDateTimeString) {\n+    public OffsetDateTime deserialize(JsonParser parser, DeserializationContext context) throws IOException {\n         TemporalAccessor temporal = DateTimeFormatter.ISO_DATE_TIME\n-            .parseBest(offsetDateTimeString, OffsetDateTime::from, LocalDateTime::from);\n+            .parseBest(parser.getValueAsString(), OffsetDateTime::from, LocalDateTime::from);\n+\n         if (temporal.query(TemporalQueries.offset()) == null) {\n             return LocalDateTime.from(temporal).atOffset(ZoneOffset.UTC);\n         } else {\n"}}, {"oid": "ae523cd4836650d6a6c69e0cc5ace38e20701d57", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae523cd4836650d6a6c69e0cc5ace38e20701d57", "message": "Merge branch 'master' into AzCore_DateTimeOffsetDeserialization", "committedDate": "2020-07-22T17:33:00Z", "type": "commit"}, {"oid": "64cdf7ebf0ad3151871d9bd9a4d0624d228a40a7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/64cdf7ebf0ad3151871d9bd9a4d0624d228a40a7", "message": "Removed package private static", "committedDate": "2020-07-22T17:41:55Z", "type": "commit"}]}