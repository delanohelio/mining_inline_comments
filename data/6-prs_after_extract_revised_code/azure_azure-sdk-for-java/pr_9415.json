{"pr_number": 9415, "pr_title": "update default azure credential config", "pr_createdAt": "2020-03-24T01:12:25Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9415", "timeline": [{"oid": "15a4a0e1b7fed3212f8a1643b70b52b296d56e34", "url": "https://github.com/Azure/azure-sdk-for-java/commit/15a4a0e1b7fed3212f8a1643b70b52b296d56e34", "message": "update default azure credential config", "committedDate": "2020-03-24T01:07:06Z", "type": "commit"}, {"oid": "a377a1dfa839b62efd94cbf6691620d135aa8c4c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a377a1dfa839b62efd94cbf6691620d135aa8c4c", "message": "update tests", "committedDate": "2020-03-24T20:20:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NjM5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r397986394", "bodyText": "Do you think that we need the boolean parameter? Should builder.excludeEnvironmentCredential() just set excludeEnvironmentCredential to true?", "author": "schaabs", "createdAt": "2020-03-25T16:19:04Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -23,6 +34,57 @@ public DefaultAzureCredentialBuilder authorityHost(String authorityHost) {\n         return this;\n     }\n \n+\n+    /**\n+     * Specifies whether the {@link EnvironmentCredential} will be excluded from the {@link DefaultAzureCredential}\n+     * authentication flow. Setting to true disables reading authentication details from the process' environment\n+     * variables.\n+     *\n+     * @param shouldExclude the status indicating to exclude the credential or not.\n+     * @return An updated instance of this builder with the Environment credential exclusion set as specified.\n+     */\n+    public DefaultAzureCredentialBuilder excludeEnvironmentCredential(boolean shouldExclude) {", "originalCommit": "a377a1dfa839b62efd94cbf6691620d135aa8c4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE3ODA3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401178077", "bodyText": "Yeah, agreed and updated.\nJust curious, in .NET I didn't see this pattern though.", "author": "g2vinay", "createdAt": "2020-03-31T19:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NjM5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1ODU3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401958575", "bodyText": "in .NET we don't have builders or setters ;)", "author": "schaabs", "createdAt": "2020-04-01T22:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NjM5NA=="}], "type": "inlineReview", "revised_code": {"commit": "6fbbc63146b39ec168542e42bb028c4201733252", "chunk": "diff --git a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\nindex 7ffae8dc0dd..3055e845af7 100644\n--- a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\n+++ b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\n\n@@ -36,52 +36,47 @@ public class DefaultAzureCredentialBuilder extends CredentialBuilderBase<Default\n \n \n     /**\n-     * Specifies whether the {@link EnvironmentCredential} will be excluded from the {@link DefaultAzureCredential}\n-     * authentication flow. Setting to true disables reading authentication details from the process' environment\n+     * Excludes the {@link EnvironmentCredential} from the {@link DefaultAzureCredential}\n+     * authentication flow and disables reading authentication details from the process' environment\n      * variables.\n      *\n-     * @param shouldExclude the status indicating to exclude the credential or not.\n      * @return An updated instance of this builder with the Environment credential exclusion set as specified.\n      */\n-    public DefaultAzureCredentialBuilder excludeEnvironmentCredential(boolean shouldExclude) {\n-        excludeEnvironmentCredential = shouldExclude;\n+    public DefaultAzureCredentialBuilder excludeEnvironmentCredential() {\n+        excludeEnvironmentCredential = true;\n         return this;\n     }\n \n     /**\n-     * Specifies whether the {@link ManagedIdentityCredential} will be excluded from the {@link DefaultAzureCredential}\n-     * authentication flow. Setting to true disables authenticating with managed identity endpoints.\n+     * Excludes the {@link ManagedIdentityCredential} from the {@link DefaultAzureCredential}\n+     * authentication flow and disables authenticating with managed identity endpoints.\n      *\n-     * @param shouldExclude the status indicating to exclude the credential or not.\n      * @return An updated instance of this builder with the Managed Identity credential exclusion set as specified.\n      */\n-    public DefaultAzureCredentialBuilder excludeManagedIdentityCredential(boolean shouldExclude) {\n-        excludeManagedIdentityCredential = shouldExclude;\n+    public DefaultAzureCredentialBuilder excludeManagedIdentityCredential() {\n+        excludeManagedIdentityCredential = true;\n         return this;\n     }\n \n     /**\n-     * Specifies whether the {@link SharedTokenCacheCredential} will be excluded from the {@link DefaultAzureCredential}\n-     * authentication flow. Setting to true disables single sign on authentication with development tools which write\n+     * Excludes the {@link SharedTokenCacheCredential} from the {@link DefaultAzureCredential}\n+     * authentication flow and disables single sign on authentication with development tools which write\n      * to the shared token cache.\n      *\n-     * @param shouldExclude the status indicating to exclude the credential or not.\n      * @return An updated instance of this builder with the Shared Token Cache credential exclusion set as specified.\n      */\n-    public DefaultAzureCredentialBuilder excludeSharedTokenCacheCredential(boolean shouldExclude) {\n-        excludeSharedTokenCacheCredential = shouldExclude;\n+    public DefaultAzureCredentialBuilder excludeSharedTokenCacheCredential() {\n+        excludeSharedTokenCacheCredential = true;\n         return this;\n     }\n \n     /**\n-     * Specifies whether the {@link AzureCliCredential} will be excluded from the {@link DefaultAzureCredential}\n-     * authentication flow.\n+     * Excludes the {@link AzureCliCredential} from the {@link DefaultAzureCredential} authentication flow.\n      *\n-     * @param shouldExclude the status indicating to exclude the credential or not.\n      * @return An updated instance of this builder with the Azure Cli credential exclusion set as specified.\n      */\n-    public DefaultAzureCredentialBuilder excludeAzureCliCredential(boolean shouldExclude) {\n-        excludeAzureCliCredential = shouldExclude;\n+    public DefaultAzureCredentialBuilder excludeAzureCliCredential() {\n+        excludeAzureCliCredential = true;\n         return this;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NzU4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r397987584", "bodyText": "In .NET the interactive browser credential is also part of the DefaultAzureCredential but it is excluded by default.", "author": "schaabs", "createdAt": "2020-03-25T16:20:39Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -12,6 +17,12 @@\n  * @see DefaultAzureCredential\n  */\n public class DefaultAzureCredentialBuilder extends CredentialBuilderBase<DefaultAzureCredentialBuilder> {\n+    private boolean excludeEnvironmentCredential;\n+    private boolean excludeManagedIdentityCredential;\n+    private boolean excludeSharedTokenCacheCredential;\n+    private boolean excludeAzureCliCredential;", "originalCommit": "a377a1dfa839b62efd94cbf6691620d135aa8c4c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE3ODI4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401178283", "bodyText": "Yep, I'll be adding in separate PR and test it appropriately.", "author": "g2vinay", "createdAt": "2020-03-31T20:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NzU4NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6fbbc63146b39ec168542e42bb028c4201733252", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6fbbc63146b39ec168542e42bb028c4201733252", "message": "update the setters", "committedDate": "2020-03-31T19:58:14Z", "type": "commit"}, {"oid": "6ad2f66962a7a1c8366f884e63f23e0055a0b7b7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ad2f66962a7a1c8366f884e63f23e0055a0b7b7", "message": "update tests", "committedDate": "2020-03-31T20:11:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1NjA5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401956092", "bodyText": "Is there a reason to build a List in the builder and convert to ArrayDeque here?", "author": "jianghaolu", "createdAt": "2020-04-01T22:52:24Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java", "diffHunk": "@@ -32,13 +32,9 @@\n      * If these environment variables are not available, then this will use the Shared MSAL\n      * token cache.\n      *\n-     * @param identityClientOptions the options to configure the IdentityClient\n+     * @param tokenCredentials the list of credentials to execute for authentication.\n      */\n-    DefaultAzureCredential(IdentityClientOptions identityClientOptions) {\n-        super(new ArrayDeque<>(Arrays.asList(new EnvironmentCredential(identityClientOptions),\n-            new ManagedIdentityCredential(null, identityClientOptions),\n-            new SharedTokenCacheCredential(null, null, \"04b07795-8ddb-461a-bbee-02f9e1bf7b46\",\n-                identityClientOptions),\n-            new AzureCliCredential(identityClientOptions))));\n+    DefaultAzureCredential(List<TokenCredential> tokenCredentials) {", "originalCommit": "6ad2f66962a7a1c8366f884e63f23e0055a0b7b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f1445863cd87698e2f53cff42a764b7fd97effe6", "chunk": "diff --git a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java\nindex 13876063bbc..4aa9c1578bc 100644\n--- a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java\n+++ b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredential.java\n\n@@ -34,7 +34,7 @@ public final class DefaultAzureCredential extends ChainedTokenCredential {\n      *\n      * @param tokenCredentials the list of credentials to execute for authentication.\n      */\n-    DefaultAzureCredential(List<TokenCredential> tokenCredentials) {\n-        super(new ArrayDeque<>(tokenCredentials));\n+    DefaultAzureCredential(ArrayDeque<TokenCredential> tokenCredentials) {\n+        super(tokenCredentials);\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1NzAxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401957015", "bodyText": "We can simply build a Deque here?", "author": "jianghaolu", "createdAt": "2020-04-01T22:54:54Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java", "diffHunk": "@@ -50,6 +107,31 @@ public DefaultAzureCredentialBuilder executorService(ExecutorService executorSer\n      * @return a {@link DefaultAzureCredential} with the current configurations.\n      */\n     public DefaultAzureCredential build() {\n-        return new DefaultAzureCredential(identityClientOptions);\n+        return new DefaultAzureCredential(getCredentialsChain());\n+    }\n+\n+    private List<TokenCredential> getCredentialsChain() {\n+        List<TokenCredential> output = new ArrayList<>(4);", "originalCommit": "6ad2f66962a7a1c8366f884e63f23e0055a0b7b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f1445863cd87698e2f53cff42a764b7fd97effe6", "chunk": "diff --git a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\nindex 3055e845af7..ec8dea0b3b8 100644\n--- a/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\n+++ b/sdk/identity/azure-identity/src/main/java/com/azure/identity/DefaultAzureCredentialBuilder.java\n\n@@ -110,8 +111,8 @@ public class DefaultAzureCredentialBuilder extends CredentialBuilderBase<Default\n         return new DefaultAzureCredential(getCredentialsChain());\n     }\n \n-    private List<TokenCredential> getCredentialsChain() {\n-        List<TokenCredential> output = new ArrayList<>(4);\n+    private ArrayDeque<TokenCredential> getCredentialsChain() {\n+        ArrayDeque<TokenCredential> output = new ArrayDeque<>(4);\n         if (!excludeEnvironmentCredential) {\n             output.add(new EnvironmentCredential(identityClientOptions));\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1NzQ4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9415#discussion_r401957487", "bodyText": "too much indentation?", "author": "jianghaolu", "createdAt": "2020-04-01T22:56:11Z", "path": "sdk/identity/azure-identity/src/test/java/com/azure/identity/DefaultAzureCredentialTest.java", "diffHunk": "@@ -132,4 +132,84 @@ public void testNoCredentialWorks() throws Exception {\n                                                    + \"[\\\\$\\\\w]+\\\\$\\\\d*,\\\\s+AzureCliCredential[\\\\$\\\\w\\\\s\\\\.]+\"))\n             .verify();\n     }\n+\n+    @Test(expected = IllegalArgumentException.class)\n+    public void testExcludeCredentials() throws Exception {\n+        DefaultAzureCredential credential = new DefaultAzureCredentialBuilder()\n+                                                .excludeEnvironmentCredential()", "originalCommit": "6ad2f66962a7a1c8366f884e63f23e0055a0b7b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "f1445863cd87698e2f53cff42a764b7fd97effe6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f1445863cd87698e2f53cff42a764b7fd97effe6", "message": "add credentials", "committedDate": "2020-04-03T00:07:59Z", "type": "commit"}, {"oid": "8eccd340ee61ede84027d8a2872a5045223b5271", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8eccd340ee61ede84027d8a2872a5045223b5271", "message": "fix checkstyle", "committedDate": "2020-04-03T00:18:50Z", "type": "commit"}]}