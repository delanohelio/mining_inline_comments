{"pr_number": 8469, "pr_title": "test on one resource group", "pr_createdAt": "2020-02-24T22:43:33Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8469", "timeline": [{"oid": "bb05bb109f6a22b50aee9a38f6633691dff2f173", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb05bb109f6a22b50aee9a38f6633691dff2f173", "message": "Added empty json", "committedDate": "2020-02-25T20:04:45Z", "type": "commit"}, {"oid": "bb05bb109f6a22b50aee9a38f6633691dff2f173", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb05bb109f6a22b50aee9a38f6633691dff2f173", "message": "Added empty json", "committedDate": "2020-02-25T20:04:45Z", "type": "forcePushed"}, {"oid": "9cfc9c52dbfc386565a35f3ccc6e9a30407515f6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9cfc9c52dbfc386565a35f3ccc6e9a30407515f6", "message": "add minimum set of json", "committedDate": "2020-02-25T20:11:44Z", "type": "commit"}, {"oid": "2cec52aa4323b591e755180140344368761f2d05", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2cec52aa4323b591e755180140344368761f2d05", "message": "some changes", "committedDate": "2020-02-25T20:34:55Z", "type": "commit"}, {"oid": "8a1cac604727ce9c9f049b802655fc047adfc293", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a1cac604727ce9c9f049b802655fc047adfc293", "message": "some changes on create resource", "committedDate": "2020-02-25T20:44:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyNjMyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8469#discussion_r384126329", "bodyText": "We may need to create a resource group name, will need to handle logic slightly differently here.\nWhen tests are running in an Azure Pipeline we should trust that the resource group name is associated to an existing resource group. If there isn't a resource group environment variable we need to create the resource group, this will be needed when running tests locally. Additionally, running tests locally could support using the environment variable for resource group but it shouldn't create the group, if it doesn't exist it is on the person running the tests but we need to document this well.", "author": "alzimmermsft", "createdAt": "2020-02-25T21:07:27Z", "path": "sdk/search/azure-search/src/test/java/com/azure/search/test/environment/setup/AzureSearchResources.java", "diffHunk": "@@ -113,9 +115,10 @@ public void deleteService() {\n     /**\n      * Creates the Resource Group in Azure. This should be run at @BeforeAll\n      */\n-    public void createResourceGroup(TestResourceNamer testResourceNamer) {\n+    public void createResourceGroup() {\n         if (resourceGroup == null) {\n-            String resourceGroupName = testResourceNamer.randomName(RESOURCE_GROUP_NAME_PREFIX, 24);\n+            String resourceGroupName = Configuration.getGlobalConfiguration().get(AZURE_RESOURCEGROUP_NAME);\n+            //String resourceGroupName = testResourceNamer.randomName(RESOURCE_GROUP_NAME_PREFIX, 24);", "originalCommit": "8a1cac604727ce9c9f049b802655fc047adfc293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0MzA3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8469#discussion_r384143073", "bodyText": "Change the logic here to\nif  resourceGroup exists, get the resource group.\nIf resourceGroup not exist, create an resource group.\nBy doing this, the entire test run only needs one resource group, so it does not need to delete every test class, which answered your question below.", "author": "sima-zhu", "createdAt": "2020-02-25T21:41:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyNjMyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "b15e2155608636a5515d9cfaa6d6d2c5df8bb8cd", "chunk": "diff --git a/sdk/search/azure-search/src/test/java/com/azure/search/test/environment/setup/AzureSearchResources.java b/sdk/search/azure-search/src/test/java/com/azure/search/test/environment/setup/AzureSearchResources.java\nindex 59ed5eec789..1e0746c32ac 100644\n--- a/sdk/search/azure-search/src/test/java/com/azure/search/test/environment/setup/AzureSearchResources.java\n+++ b/sdk/search/azure-search/src/test/java/com/azure/search/test/environment/setup/AzureSearchResources.java\n\n@@ -116,8 +116,13 @@ public class AzureSearchResources {\n      * Creates the Resource Group in Azure. This should be run at @BeforeAll\n      */\n     public void createResourceGroup() {\n-        if (resourceGroup == null) {\n-            String resourceGroupName = Configuration.getGlobalConfiguration().get(AZURE_RESOURCEGROUP_NAME);\n+        String resourceGroupName = Configuration.getGlobalConfiguration().get(AZURE_RESOURCEGROUP_NAME);\n+        if (azure.resourceGroups().checkExistence(resourceGroupName)) {\n+            System.out.println(\"Fetching Resource Group: \" + resourceGroupName);\n+            resourceGroup = azure.resourceGroups()\n+                .getByName(resourceGroupName);\n+        } else {\n+\n             //String resourceGroupName = testResourceNamer.randomName(RESOURCE_GROUP_NAME_PREFIX, 24);\n             System.out.println(\"Creating Resource Group: \" + resourceGroupName);\n             resourceGroup = azure.resourceGroups()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyNjY4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8469#discussion_r384126687", "bodyText": "Any particular reason we are adding a call the resource group creation but removing one to group deletion?", "author": "alzimmermsft", "createdAt": "2020-02-25T21:08:15Z", "path": "sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java", "diffHunk": "@@ -113,11 +113,12 @@\n     @BeforeAll\n     public static void beforeAll() {\n         initializeAzureResources();\n+        azureSearchResources.createResourceGroup();\n     }\n \n     @AfterAll\n     public static void afterAll() {\n-        azureSearchResources.deleteResourceGroup();\n+        //azureSearchResources.deleteResourceGroup();", "originalCommit": "8a1cac604727ce9c9f049b802655fc047adfc293", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0NDA3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8469#discussion_r384144073", "bodyText": "One resource group for the entire tests, so there is no need to delete for every test class", "author": "sima-zhu", "createdAt": "2020-02-25T21:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyNjY4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b15e2155608636a5515d9cfaa6d6d2c5df8bb8cd", "chunk": "diff --git a/sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java b/sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java\nindex d74ec165376..16bbbfac070 100644\n--- a/sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java\n+++ b/sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java\n\n@@ -113,7 +113,10 @@ public abstract class SearchServiceTestBase extends TestBase {\n     @BeforeAll\n     public static void beforeAll() {\n         initializeAzureResources();\n-        azureSearchResources.createResourceGroup();\n+        if (!playbackMode()) {\n+            azureSearchResources.initialize();\n+            azureSearchResources.createResourceGroup();\n+        }\n     }\n \n     @AfterAll\n"}}, {"oid": "b15e2155608636a5515d9cfaa6d6d2c5df8bb8cd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b15e2155608636a5515d9cfaa6d6d2c5df8bb8cd", "message": "change location for resource group", "committedDate": "2020-02-25T21:31:28Z", "type": "commit"}, {"oid": "4bcaa4ea19423a3706ba2c9437e134f2afc150ee", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4bcaa4ea19423a3706ba2c9437e134f2afc150ee", "message": "Added location param", "committedDate": "2020-02-25T21:32:30Z", "type": "commit"}, {"oid": "00854147173b16a75ff7321bde7e4ee85815c1e4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/00854147173b16a75ff7321bde7e4ee85815c1e4", "message": "revert the location", "committedDate": "2020-02-25T21:37:44Z", "type": "commit"}, {"oid": "5e0195f8996657c0fa6f665bb59d78dc6fb09693", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e0195f8996657c0fa6f665bb59d78dc6fb09693", "message": "Clean the code.", "committedDate": "2020-02-25T22:15:23Z", "type": "commit"}]}