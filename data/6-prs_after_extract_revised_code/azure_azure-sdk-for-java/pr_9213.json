{"pr_number": 9213, "pr_title": "Cosmos api review iteration", "pr_createdAt": "2020-03-19T01:40:10Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9213", "timeline": [{"oid": "55232b57f4c2227b9cd6b7d0479631c7eb59250e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/55232b57f4c2227b9cd6b7d0479631c7eb59250e", "message": "Updated ChangedFeedProcessor and CosmosClientBuilder to update the public APIs to follow builder pattern.\nRemoved getters from CosmosClientBuilder", "committedDate": "2020-03-18T23:36:49Z", "type": "commit"}, {"oid": "1c8f373a0010da90da8693c1ec509e86550139f7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1c8f373a0010da90da8693c1ec509e86550139f7", "message": "Moved CosmosPagedIterable and CosmosPagedFlux to util package", "committedDate": "2020-03-19T00:06:51Z", "type": "commit"}, {"oid": "912b1bdcb9201c4daf06bd3b153013551de301d9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/912b1bdcb9201c4daf06bd3b153013551de301d9", "message": "Moved DatabaseAccount to implementation package", "committedDate": "2020-03-19T00:52:02Z", "type": "commit"}, {"oid": "45430979a39967d981ae66bc44d387d1f7fd891d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/45430979a39967d981ae66bc44d387d1f7fd891d", "message": "Removed public constructors from HashIndex, RangeIndex", "committedDate": "2020-03-19T01:03:51Z", "type": "commit"}, {"oid": "7e3ca23444a53c295176caf2225012f9e01ec181", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e3ca23444a53c295176caf2225012f9e01ec181", "message": "Updated CosmosResourceType to upper case ENUM", "committedDate": "2020-03-19T01:12:48Z", "type": "commit"}, {"oid": "129a3382bb1827e3030fcddddd4691cfff6e6292", "url": "https://github.com/Azure/azure-sdk-for-java/commit/129a3382bb1827e3030fcddddd4691cfff6e6292", "message": "Changed getMap from public to protected in JsonSerializable", "committedDate": "2020-03-19T01:30:52Z", "type": "commit"}, {"oid": "df46f65e3e0ee16e1541c240ab8306b0843c5633", "url": "https://github.com/Azure/azure-sdk-for-java/commit/df46f65e3e0ee16e1541c240ab8306b0843c5633", "message": "Merge branch 'master' into cosmos_api_review_iteration", "committedDate": "2020-03-19T02:07:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NDQyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394754424", "bodyText": "If these methods are not public on builder, and we are not providing getters on the client, How can enduser get the config of the client after creating it?", "author": "mbhaskar", "createdAt": "2020-03-19T02:21:17Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/CosmosClientBuilder.java", "diffHunk": "@@ -255,7 +255,7 @@ public CosmosClientBuilder setConsistencyLevel(ConsistencyLevel desiredConsisten\n      *\n      * @return the connection policy\n      */\n-    public ConnectionPolicy getConnectionPolicy() {", "originalCommit": "129a3382bb1827e3030fcddddd4691cfff6e6292", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NzA2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394757065", "bodyText": "They don't need to.. We discussed it, and end user should not need to get the config of the client they built.\nJust in case if they need it, we will make them available on the client itself, and not on the builder.", "author": "kushagraThapar", "createdAt": "2020-03-19T02:31:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1OTU0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394759547", "bodyText": "I strongly feel it will be good to have these getters atleast on the client. I would have missed the discussion, but even .NET sdk has these getters public https://github.com/Azure/azure-cosmos-dotnet-v3/blob/f2e9d97d176fecdbe186c13575db06f7539b75e3/Microsoft.Azure.Cosmos/src/CosmosClientOptions.cs#L161\nThis can be done separately out of this PR if required but should be tracked.", "author": "mbhaskar", "createdAt": "2020-03-19T02:41:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NDQyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3OTE5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394779192", "bodyText": "Yeah, I thought so too, but I couldn't present a solid argument, as in why end user needs them, since end user is already setting these values on the builder. If they need to access it again, they can get it from the place they initially set it in the builder.\nLet me know if you have a strong use case, may be I am missing something.", "author": "kushagraThapar", "createdAt": "2020-03-19T04:02:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc1NDQyNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc2NzA5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394767099", "bodyText": "it looks like the ChangeFeedProcessorOptions still has setters. Should we rename those as well to be consistent with the other changes? BTW my preference is to prefix these using \"with\" but that's probably for a later SDK version :-)", "author": "milismsft", "createdAt": "2020-03-19T03:12:17Z", "path": "sdk/cosmos/azure-cosmos/src/test/java/com/azure/cosmos/rx/ChangeFeedProcessorTest.java", "diffHunk": "@@ -81,11 +81,11 @@ public void readFeedDocumentsStartFromBeginning() {\n             ChangeFeedProcessorTest.log.info(\"END processing from thread {}\", Thread.currentThread().getId());\n         }; \n         changeFeedProcessor = ChangeFeedProcessor.changeFeedProcessorBuilder()\n-            .setHostName(hostName)\n-            .setHandleChanges(itemConsumer)\n-            .setFeedContainer(createdFeedCollection)\n-            .setLeaseContainer(createdLeaseCollection)\n-            .setOptions(new ChangeFeedProcessorOptions()\n+            .hostName(hostName)\n+            .handleChanges(itemConsumer)\n+            .feedContainer(createdFeedCollection)\n+            .leaseContainer(createdLeaseCollection)\n+            .options(new ChangeFeedProcessorOptions()\n                 .setLeaseRenewInterval(Duration.ofSeconds(20))", "originalCommit": "df46f65e3e0ee16e1541c240ab8306b0843c5633", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc3NTQwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394775407", "bodyText": "I feel we are going back and forth with removing set as prefix and then adding it back again and then removing it again. !!", "author": "moderakh", "createdAt": "2020-03-19T03:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc2NzA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDgxNjE3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394816174", "bodyText": "The resulting ChangeFeedProcessor object is immutable, it cannot be updated after it was built. ChangeFeedProcessorOptions might look like a POJO but in this case it acts almost as a builder; the getters are only used by the internal implementation.\nLet's stick with what we have, and get this SDK GA'ed as soon as we can.\nAnd for those curious, some background story about my comment. In the ARM Java Fluent SDK we used with* for methods returning \"this\", and could be chained in a Fluent/builder like pattern. We also accept setters and getters, the difference was that the setters will have to return \"void\" and never \"this\", while for the getters the explicit contract was that a network/long operation call must be made in order to return the value.", "author": "milismsft", "createdAt": "2020-03-19T06:36:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc2NzA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg0NDQyMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9213#discussion_r394844423", "bodyText": "Sounds good Milis. Thanks for the explanation, appreciate it. I agree with what you have said on returning thison \"with\" methods vs returning void on \"set\" methods.", "author": "kushagraThapar", "createdAt": "2020-03-19T07:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDc2NzA5OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1c0c100f8fdfec8a53a2afdd50598425193deb95", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1c0c100f8fdfec8a53a2afdd50598425193deb95", "message": "Fixed DatabaseAccount spot bug", "committedDate": "2020-03-19T04:00:09Z", "type": "commit"}, {"oid": "3052e674f7e352e1da02e82dd5d2ef5e0159d2ba", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3052e674f7e352e1da02e82dd5d2ef5e0159d2ba", "message": "Fixed CosmosAuthorizationTokenResolverTest", "committedDate": "2020-03-19T05:50:08Z", "type": "commit"}, {"oid": "b0dd615e4a095593f2e04b295eba006e3c5f4684", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0dd615e4a095593f2e04b295eba006e3c5f4684", "message": "Fixed Cosmos Resource Type enum change", "committedDate": "2020-03-19T07:58:24Z", "type": "commit"}, {"oid": "ac25901cb9e05474ba94312937970c41340866b5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ac25901cb9e05474ba94312937970c41340866b5", "message": "Merge branch 'master' into cosmos_api_review_iteration", "committedDate": "2020-03-19T16:32:58Z", "type": "commit"}, {"oid": "0a6bb5f236654b27885d860533c9bf26894fbb3f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0a6bb5f236654b27885d860533c9bf26894fbb3f", "message": "Merge branch 'master' into cosmos_api_review_iteration", "committedDate": "2020-03-19T18:34:35Z", "type": "commit"}]}