{"pr_number": 1445, "pr_title": "SAMZA-2604: Datamodel change to capture physical container id for AM HA", "pr_createdAt": "2020-11-19T19:07:22Z", "pr_url": "https://github.com/apache/samza/pull/1445", "timeline": [{"oid": "eeb7ab73762b8081430dd752ce71cc18c096ca4b", "url": "https://github.com/apache/samza/commit/eeb7ab73762b8081430dd752ce71cc18c096ca4b", "message": "Introduce config for cluster based job coordinator high availability", "committedDate": "2020-11-17T19:47:01Z", "type": "commit"}, {"oid": "1a58b6dee7969021c3b97659e65f58eac0f355eb", "url": "https://github.com/apache/samza/commit/1a58b6dee7969021c3b97659e65f58eac0f355eb", "message": "SAMZA-2604: Data model change to capture physical container id mapping for AM HA", "committedDate": "2020-11-19T18:58:15Z", "type": "commit"}, {"oid": "14370d9fa0d79781deafffcde3d15ab12c087ddb", "url": "https://github.com/apache/samza/commit/14370d9fa0d79781deafffcde3d15ab12c087ddb", "message": "address comments", "committedDate": "2020-11-30T22:49:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk5MjM2NQ==", "url": "https://github.com/apache/samza/pull/1445#discussion_r532992365", "bodyText": "Can go inside the ifPresent block so that we don't create it unless it is available? Why this is optional by the way? Seems like this is required and we should bail out. unless its used in local flow where it isn't populated.", "author": "mynameborat", "createdAt": "2020-12-01T00:27:00Z", "path": "samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java", "diffHunk": "@@ -151,10 +151,9 @@ private static void run(\n \n       if (new JobConfig(config).getJobCoordinatorHighAvailabilityEnabled()) {\n         ExecutionContainerIdManager executionContainerIdManager = new ExecutionContainerIdManager(\n-            new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionContainerIdMapping.TYPE));\n-        if (executionContainerIdManager != null && execEnvContainerId.isPresent()) {\n-          executionContainerIdManager.writeExecutionEnvironmentContainerIdMapping(containerId, execEnvContainerId.get());\n-        }\n+            new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionEnvContainerIdMapping.TYPE));", "originalCommit": "14370d9fa0d79781deafffcde3d15ab12c087ddb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ab68cad1bd3a66e28d2f387540cc77624bdd341f", "chunk": "diff --git a/samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java b/samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java\nindex 8e042a3dd..6acda1b52 100644\n--- a/samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java\n+++ b/samza-core/src/main/java/org/apache/samza/runtime/ContainerLaunchUtil.java\n\n@@ -150,10 +150,11 @@ public class ContainerLaunchUtil {\n       }\n \n       if (new JobConfig(config).getJobCoordinatorHighAvailabilityEnabled()) {\n-        ExecutionContainerIdManager executionContainerIdManager = new ExecutionContainerIdManager(\n-            new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionEnvContainerIdMapping.TYPE));\n-        execEnvContainerIdOptional.ifPresent(execEnvContainerId ->\n-            executionContainerIdManager.writeExecutionEnvironmentContainerIdMapping(containerId, execEnvContainerId));\n+        execEnvContainerIdOptional.ifPresent(execEnvContainerId -> {\n+          ExecutionContainerIdManager executionContainerIdManager = new ExecutionContainerIdManager(\n+              new NamespaceAwareCoordinatorStreamStore(coordinatorStreamStore, SetExecutionEnvContainerIdMapping.TYPE));\n+          executionContainerIdManager.writeExecutionEnvironmentContainerIdMapping(containerId, execEnvContainerId);\n+        });\n       }\n \n       container.run();\n"}}, {"oid": "ab68cad1bd3a66e28d2f387540cc77624bdd341f", "url": "https://github.com/apache/samza/commit/ab68cad1bd3a66e28d2f387540cc77624bdd341f", "message": "address comments", "committedDate": "2020-12-01T00:35:25Z", "type": "commit"}, {"oid": "fa33b34f890d3a1402d5eeb6b9621f1fd7210e08", "url": "https://github.com/apache/samza/commit/fa33b34f890d3a1402d5eeb6b9621f1fd7210e08", "message": "merge master", "committedDate": "2020-12-01T06:15:46Z", "type": "commit"}]}