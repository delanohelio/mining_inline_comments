{"pr_number": 1354, "pr_title": "SAMZA-2518: Update JobCoordinatorLaunchUtil to fetch launch config from metadata store.", "pr_createdAt": "2020-04-30T22:06:46Z", "pr_url": "https://github.com/apache/samza/pull/1354", "timeline": [{"oid": "5ad0273e213f310e7a2a609b36bd3b8217459be7", "url": "https://github.com/apache/samza/commit/5ad0273e213f310e7a2a609b36bd3b8217459be7", "message": "SAMZA-2518: Update JobCoordinatorLaunchUtil to fetch launch config from metadata store.\n\nDesign:\nhttps://cwiki.apache.org/confluence/display/SAMZA/SEP-23%3A+Simplify+Job+Runner\n\nChanges:\n1. Add readLaunchConfigFromCoordinatorStream() in CoordinatorStreamUtil\n2. Add an extra step in JobCoordinatorLaunchUtil to invoke readLaunchConfigFromCoordinatorStream()\n\nAPI Changes:\nNone\n\nUpgrade Instructions:\nNone\n\nUsage Instructions:\nNone\n\nTests:\nUnit Tests", "committedDate": "2020-04-30T22:02:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MDQ0OA==", "url": "https://github.com/apache/samza/pull/1354#discussion_r418670448", "bodyText": "nit pick: new CoordinatorStreamStore(CoordinatorStreamUtil.buildCoordinatorStreamConfig(fullConfig), new MetricsRegistryMap());", "author": "rmatharu", "createdAt": "2020-05-01T18:21:14Z", "path": "samza-core/src/main/java/org/apache/samza/clustermanager/JobCoordinatorLaunchUtil.java", "diffHunk": "@@ -57,14 +58,17 @@ public static void run(SamzaApplication app, Config config) {\n       throw new SamzaException(\"Only support single remote job is supported.\");\n     }\n \n-    Config finalConfig = jobConfigs.get(0);\n+    Config fullConfig = jobConfigs.get(0);\n+    MetricsRegistryMap metrics = new MetricsRegistryMap();\n+    MetadataStore", "originalCommit": "5ad0273e213f310e7a2a609b36bd3b8217459be7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3ODM3NA==", "url": "https://github.com/apache/samza/pull/1354#discussion_r418678374", "bodyText": "Cannot do it because the same MetricsRegistryMap needs to be passed in ClusterBasedJobCoordinator's constructor as well.", "author": "kw2542", "createdAt": "2020-05-01T18:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MDQ0OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTA1OQ==", "url": "https://github.com/apache/samza/pull/1354#discussion_r418671059", "bodyText": "Could we use the\npublic boolean isAutosizingConfig(String configParam)\nmethod in JobConfig for this?", "author": "rmatharu", "createdAt": "2020-05-01T18:22:29Z", "path": "samza-core/src/main/java/org/apache/samza/config/JobConfig.java", "diffHunk": "@@ -132,7 +132,7 @@\n \n   // Auto-sizing related configs that take precedence over respective sizing confings job.container.count, etc,\n   // *only* when job.autosizing.enabled is true. Otherwise current behavior is maintained.\n-  private static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing\n+  public static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing", "originalCommit": "5ad0273e213f310e7a2a609b36bd3b8217459be7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3ODA3MQ==", "url": "https://github.com/apache/samza/pull/1354#discussion_r418678071", "bodyText": "Updated", "author": "kw2542", "createdAt": "2020-05-01T18:38:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY3MTA1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "142087e76731230570115c6079b2846e815aa47e", "chunk": "diff --git a/samza-core/src/main/java/org/apache/samza/config/JobConfig.java b/samza-core/src/main/java/org/apache/samza/config/JobConfig.java\nindex 31e264ba..dc036445 100644\n--- a/samza-core/src/main/java/org/apache/samza/config/JobConfig.java\n+++ b/samza-core/src/main/java/org/apache/samza/config/JobConfig.java\n\n@@ -132,7 +132,7 @@ public class JobConfig extends MapConfig {\n \n   // Auto-sizing related configs that take precedence over respective sizing confings job.container.count, etc,\n   // *only* when job.autosizing.enabled is true. Otherwise current behavior is maintained.\n-  public static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing\n+  private static final String JOB_AUTOSIZING_CONFIG_PREFIX = \"job.autosizing.\"; // used to determine if a config is related to autosizing\n   public static final String JOB_AUTOSIZING_ENABLED = JOB_AUTOSIZING_CONFIG_PREFIX + \"enabled\";\n   public static final String JOB_AUTOSIZING_CONTAINER_COUNT = JOB_AUTOSIZING_CONFIG_PREFIX + \"container.count\";\n   public static final String JOB_AUTOSIZING_CONTAINER_THREAD_POOL_SIZE = JOB_AUTOSIZING_CONFIG_PREFIX + \"container.thread.pool.size\";\n"}}, {"oid": "142087e76731230570115c6079b2846e815aa47e", "url": "https://github.com/apache/samza/commit/142087e76731230570115c6079b2846e815aa47e", "message": "Update to address comments", "committedDate": "2020-05-01T19:35:30Z", "type": "commit"}, {"oid": "759336d37d8bc90aebebb0b2f76c9fac3ed7400d", "url": "https://github.com/apache/samza/commit/759336d37d8bc90aebebb0b2f76c9fac3ed7400d", "message": "Simplify implementation", "committedDate": "2020-05-04T23:23:59Z", "type": "commit"}]}