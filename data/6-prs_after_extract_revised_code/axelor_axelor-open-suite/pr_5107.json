{"pr_number": 5107, "pr_title": "RM26380 Fix NPE when computing volume on LogisticalForm", "pr_createdAt": "2020-03-12T10:30:23Z", "pr_url": "https://github.com/axelor/axelor-open-suite/pull/5107", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUzOTM5OA==", "url": "https://github.com/axelor/axelor-open-suite/pull/5107#discussion_r391539398", "bodyText": "Please add brackets { } even if there is only one line.", "author": "ale-axelor", "createdAt": "2020-03-12T10:50:27Z", "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java", "diffHunk": "@@ -482,9 +482,11 @@ public void computeTotals(LogisticalForm logisticalForm) throws LogisticalFormEr\n             totalGrossMass = totalGrossMass.add(logisticalFormLine.getGrossMass());\n           }\n \n-          totalVolume =\n-              totalVolume.add(\n-                  logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper));\n+          BigDecimal toAdd = logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper);\n+          if (toAdd == null)", "originalCommit": "c4925945f494f06aad4e75cef09267ef88d78bf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a6a4ef4bdb7d344fa2f50ca4372f5d35bdd25f13", "chunk": "diff --git a/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java b/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\nindex 0fe08a8ae6..0eb89c29a2 100644\n--- a/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\n+++ b/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\n\n@@ -483,10 +483,12 @@ public class LogisticalFormServiceImpl implements LogisticalFormService {\n           }\n \n           BigDecimal toAdd = logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper);\n-          if (toAdd == null)\n-            throw new LogisticalFormError(logisticalForm, IExceptionMessage.LOGISTICAL_FORM_INVALID_DIMENSIONS);\n-          else\n+          if (toAdd == null) {\n+            throw new LogisticalFormError(\n+                logisticalForm, IExceptionMessage.LOGISTICAL_FORM_INVALID_DIMENSIONS);\n+          } else {\n             totalVolume = totalVolume.add(toAdd);\n+          }\n         } else if (stockMoveLine != null) {\n           totalNetMass =\n               totalNetMass.add(logisticalFormLine.getQty().multiply(stockMoveLine.getNetMass()));\n"}}, {"oid": "a6a4ef4bdb7d344fa2f50ca4372f5d35bdd25f13", "url": "https://github.com/axelor/axelor-open-suite/commit/a6a4ef4bdb7d344fa2f50ca4372f5d35bdd25f13", "message": "RM26380 Fix NPE when computing volume on LogisticalForm", "committedDate": "2020-03-12T12:32:18Z", "type": "forcePushed"}, {"oid": "6ab13ba07c07ca52bd624b0a652e256458603c4f", "url": "https://github.com/axelor/axelor-open-suite/commit/6ab13ba07c07ca52bd624b0a652e256458603c4f", "message": "RM26380 Fix NPE when computing volume on LogisticalForm", "committedDate": "2020-03-12T12:35:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTE3MDU4NA==", "url": "https://github.com/axelor/axelor-open-suite/pull/5107#discussion_r395170584", "bodyText": "please call I18n.get() here or the exception will not be translated.", "author": "ale-axelor", "createdAt": "2020-03-19T16:47:19Z", "path": "axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java", "diffHunk": "@@ -482,9 +482,13 @@ public void computeTotals(LogisticalForm logisticalForm) throws LogisticalFormEr\n             totalGrossMass = totalGrossMass.add(logisticalFormLine.getGrossMass());\n           }\n \n-          totalVolume =\n-              totalVolume.add(\n-                  logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper));\n+          BigDecimal toAdd = logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper);\n+          if (toAdd == null) {\n+            throw new LogisticalFormError(\n+                logisticalForm, IExceptionMessage.LOGISTICAL_FORM_INVALID_DIMENSIONS);", "originalCommit": "6ab13ba07c07ca52bd624b0a652e256458603c4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "451ba7806e3fe1a8de2f5237c9a3df8778cbe9d3", "chunk": "diff --git a/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java b/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\nindex 0eb89c29a2..1f2cbc32f4 100644\n--- a/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\n+++ b/axelor-stock/src/main/java/com/axelor/apps/stock/service/LogisticalFormServiceImpl.java\n\n@@ -485,7 +485,7 @@ public class LogisticalFormServiceImpl implements LogisticalFormService {\n           BigDecimal toAdd = logisticalFormLineService.evalVolume(logisticalFormLine, scriptHelper);\n           if (toAdd == null) {\n             throw new LogisticalFormError(\n-                logisticalForm, IExceptionMessage.LOGISTICAL_FORM_INVALID_DIMENSIONS);\n+                logisticalForm, I18n.get(IExceptionMessage.LOGISTICAL_FORM_INVALID_DIMENSIONS));\n           } else {\n             totalVolume = totalVolume.add(toAdd);\n           }\n"}}, {"oid": "451ba7806e3fe1a8de2f5237c9a3df8778cbe9d3", "url": "https://github.com/axelor/axelor-open-suite/commit/451ba7806e3fe1a8de2f5237c9a3df8778cbe9d3", "message": "RM26380 Fix NPE when computing volume on LogisticalForm", "committedDate": "2020-03-24T13:52:20Z", "type": "commit"}, {"oid": "451ba7806e3fe1a8de2f5237c9a3df8778cbe9d3", "url": "https://github.com/axelor/axelor-open-suite/commit/451ba7806e3fe1a8de2f5237c9a3df8778cbe9d3", "message": "RM26380 Fix NPE when computing volume on LogisticalForm", "committedDate": "2020-03-24T13:52:20Z", "type": "forcePushed"}, {"oid": "43e926d758982f9a215ab8562e7c0c676a7eb1b8", "url": "https://github.com/axelor/axelor-open-suite/commit/43e926d758982f9a215ab8562e7c0c676a7eb1b8", "message": "Merge branch 'dev' into dev-26380", "committedDate": "2020-03-25T14:37:14Z", "type": "commit"}]}