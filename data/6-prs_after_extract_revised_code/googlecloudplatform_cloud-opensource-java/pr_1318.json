{"pr_number": 1318, "pr_title": "remove @VisibleForTesting method", "pr_createdAt": "2020-03-28T11:45:13Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1318", "timeline": [{"oid": "64858d42ceeec58e020db9e9245d961ff7781b97", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/64858d42ceeec58e020db9e9245d961ff7781b97", "message": "remove @VisibleForTesting method", "committedDate": "2020-03-28T11:44:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg4NzUxMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1318#discussion_r399887511", "bodyText": "Before: 2 lines with 2 variables\nAfter: 6 lines with 4 variables\nI see the before is better.", "author": "suztomo", "createdAt": "2020-03-30T01:35:31Z", "path": "linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java", "diffHunk": "@@ -96,23 +115,17 @@ public void testBomSnapshot()\n         .inOrder();\n   }\n \n-  private final SymbolProblem classNotFoundProblem =\n-      new SymbolProblem(new ClassSymbol(\"java.lang.Integer\"), ErrorType.CLASS_NOT_FOUND, null);\n-  private final SymbolProblem methodNotFoundProblem =\n-      new SymbolProblem(\n-          new MethodSymbol(\n-              \"io.grpc.protobuf.ProtoUtils\",\n-              \"marshaller\",\n-              \"(Lcom/google/protobuf/Message;)Lio/grpc/MethodDescriptor$Marshaller;\",\n-              false),\n-          ErrorType.SYMBOL_NOT_FOUND,\n-          new ClassFile(ClassPathEntry.of(\"foo:b:1.0.0\", \"foo/b-1.0.0.jar\"), \"java.lang.Object\"));\n-\n   @Test\n   public void generateMessageForNewError() {\n     Set<SymbolProblem> baselineProblems = ImmutableSet.of(classNotFoundProblem);\n-    ClassPathEntry jarA = ClassPathEntry.of(\"foo:a:1.2.3\", \"foo/a-1.2.3.jar\");\n-    ClassPathEntry jarB = ClassPathEntry.of(\"foo:b:1.0.0\", \"foo/b-1.0.0.jar\");\n+    \n+    Artifact artifactA = new DefaultArtifact(\"foo:a:1.2.3\")\n+        .setFile(new File(\"foo/a-1.2.3.jar\"));\n+    Artifact artifactB = new DefaultArtifact(\"foo:b:1.0.0\")\n+        .setFile(new File(\"foo/b-1.0.0.jar\"));\n+    \n+    ClassPathEntry jarA = new ClassPathEntry(artifactA);\n+    ClassPathEntry jarB = new ClassPathEntry(artifactB);", "originalCommit": "64858d42ceeec58e020db9e9245d961ff7781b97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDExNzEyMQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1318#discussion_r400117121", "bodyText": "Arguably we don't have the right constructors yet. However the model code seems to be OK with this, and it's nice to keep the tests as close to the model code as reasonable. But my main goal is to remove a method that's only needed for testing. That's always a good thing.\nCould this become a test utility? Perhaps. Or we could use test fixtures to avoid duplicating code for object creation.", "author": "elharo", "createdAt": "2020-03-30T11:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg4NzUxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI0NzUxNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1318#discussion_r400247514", "bodyText": "I agree that the removal of the test-only method is a good thing if the lost benefit is minimal.\n\nCould this become a test utility? Perhaps.\n\nWould you implement this of() as a test utility?\nI haven't thought about setting up test fixtures for the test cases. If you think that's even better, I'm interested in what it looks like.", "author": "suztomo", "createdAt": "2020-03-30T14:42:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg4NzUxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "463ac42430e2a1cbbbeefb02d620e85e2ca8f382", "chunk": "diff --git a/linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java b/linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java\nindex 9e18dbba..e4b969d8 100644\n--- a/linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java\n+++ b/linkage-monitor/src/test/java/com/google/cloud/tools/dependencies/linkagemonitor/LinkageMonitorTest.java\n\n@@ -119,13 +119,9 @@ public class LinkageMonitorTest {\n   public void generateMessageForNewError() {\n     Set<SymbolProblem> baselineProblems = ImmutableSet.of(classNotFoundProblem);\n     \n-    Artifact artifactA = new DefaultArtifact(\"foo:a:1.2.3\")\n-        .setFile(new File(\"foo/a-1.2.3.jar\"));\n-    Artifact artifactB = new DefaultArtifact(\"foo:b:1.0.0\")\n-        .setFile(new File(\"foo/b-1.0.0.jar\"));\n-    \n+    Artifact artifactA = new DefaultArtifact(\"foo:a:1.2.3\").setFile(new File(\"foo/a-1.2.3.jar\"));\n     ClassPathEntry jarA = new ClassPathEntry(artifactA);\n-    ClassPathEntry jarB = new ClassPathEntry(artifactB);\n+    \n     ImmutableSetMultimap<SymbolProblem, ClassFile> snapshotProblems =\n         ImmutableSetMultimap.of(\n             classNotFoundProblem, // This is in baseline. It should not be printed\n"}}, {"oid": "697dd306a8b1714cec2af1f70d96e71c35981ff3", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/697dd306a8b1714cec2af1f70d96e71c35981ff3", "message": "Merge branch 'master' into of", "committedDate": "2020-03-30T11:20:01Z", "type": "commit"}, {"oid": "f2b99c2825a9659b48a690bf4f8452e9a44cf527", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f2b99c2825a9659b48a690bf4f8452e9a44cf527", "message": "Merge branch 'master' into of", "committedDate": "2020-03-30T15:43:09Z", "type": "commit"}, {"oid": "318533e0222a4be584118316407e4beb98388d19", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/318533e0222a4be584118316407e4beb98388d19", "message": "Merge branch 'of' of github.com:GoogleCloudPlatform/cloud-opensource-java into of", "committedDate": "2020-03-30T15:44:05Z", "type": "commit"}, {"oid": "a62c29c3cda64841246818403a1f91fa2f8d116a", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a62c29c3cda64841246818403a1f91fa2f8d116a", "message": "Merge branch 'master' into of", "committedDate": "2020-03-30T15:44:14Z", "type": "commit"}, {"oid": "463ac42430e2a1cbbbeefb02d620e85e2ca8f382", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/463ac42430e2a1cbbbeefb02d620e85e2ca8f382", "message": "reuse variable", "committedDate": "2020-03-30T16:09:01Z", "type": "commit"}, {"oid": "09875bcfda95d9e33a2beb0c9247ae0aeb3ddaf1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/09875bcfda95d9e33a2beb0c9247ae0aeb3ddaf1", "message": "Merge branch 'master' into of", "committedDate": "2020-04-01T12:23:20Z", "type": "commit"}, {"oid": "dde0e75a054b74a1d45eeac0274f7e249ceb9319", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/dde0e75a054b74a1d45eeac0274f7e249ceb9319", "message": "remove duplicate code", "committedDate": "2020-04-01T12:39:45Z", "type": "commit"}, {"oid": "038fb7c5e1a0c93ff0b06d597ac8273fd2815854", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/038fb7c5e1a0c93ff0b06d597ac8273fd2815854", "message": "Merge branch 'master' into of", "committedDate": "2020-04-02T15:19:01Z", "type": "commit"}, {"oid": "f84ec4f3408001fc9ca965874740f5f1540237b5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f84ec4f3408001fc9ca965874740f5f1540237b5", "message": "destatic setUp", "committedDate": "2020-04-02T15:20:37Z", "type": "commit"}, {"oid": "804785eab93754a71c821a20f01ecf7e13c99f7e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/804785eab93754a71c821a20f01ecf7e13c99f7e", "message": "unused import", "committedDate": "2020-04-02T15:23:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY2NjYxMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1318#discussion_r402666610", "bodyText": "This is a normal factory method. Nothing special for tests.", "author": "suztomo", "createdAt": "2020-04-03T00:12:36Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ClassPathEntry.java", "diffHunk": "@@ -95,12 +92,6 @@ public String toString() {\n     }\n   }\n \n-  @VisibleForTesting\n-  public static ClassPathEntry of(String coordinates, String filePath) {", "originalCommit": "804785eab93754a71c821a20f01ecf7e13c99f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}