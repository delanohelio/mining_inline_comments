{"pr_number": 1523, "pr_title": "LinkageProblem class to replace Multimap<SymbolProblem, ClassFile>", "pr_createdAt": "2020-07-10T04:06:07Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523", "timeline": [{"oid": "52150ffc47982f9a81688a46a68088fe7ec8292a", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/52150ffc47982f9a81688a46a68088fe7ec8292a", "message": "IntelliJ renaming", "committedDate": "2020-07-09T20:41:06Z", "type": "commit"}, {"oid": "f868f0344d965b96538b1bea34cd88b339adbaf9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f868f0344d965b96538b1bea34cd88b339adbaf9", "message": "dependencies module compiles", "committedDate": "2020-07-09T22:00:03Z", "type": "commit"}, {"oid": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/28269c9d3ee138fa48d7c461eb3523d8f6551554", "message": "in progress", "committedDate": "2020-07-10T04:04:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1Mjk1Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452852953", "bodyText": "This probably doesn't need to be a multimap anymore since LinkageProblem points to the class file.", "author": "elharo", "createdAt": "2020-07-10T13:45:10Z", "path": "boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java", "diffHunk": "@@ -49,28 +49,28 @@ public void testForNewLinkageErrors()\n     Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n     Bom bom = Bom.readBom(bomFile);\n \n-    ImmutableSetMultimap<SymbolProblem, ClassFile> oldProblems =\n+    ImmutableSetMultimap<LinkageProblem, ClassFile> oldProblems =", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkwNTUwMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452905502", "bodyText": "Yes, updated.", "author": "suztomo", "createdAt": "2020-07-10T15:11:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1Mjk1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "e0512e76961547d64e707efaf0cb3f27d7d61766", "chunk": "diff --git a/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java b/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\nindex 234f181c..63264e0c 100644\n--- a/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\n+++ b/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\n\n@@ -49,39 +49,23 @@ public class MaximumLinkageErrorsTest {\n     Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n     Bom bom = Bom.readBom(bomFile);\n \n-    ImmutableSetMultimap<LinkageProblem, ClassFile> oldProblems =\n+    ImmutableSet<LinkageProblem> oldProblems =\n         LinkageChecker.create(baseline).findSymbolProblems();\n     LinkageChecker checker = LinkageChecker.create(bom);\n-    ImmutableSetMultimap<LinkageProblem, ClassFile> currentProblems = checker.findSymbolProblems();\n+    ImmutableSet<LinkageProblem> currentProblems = checker.findSymbolProblems();\n \n     // This only tests for newly missing methods, not new references to\n     // previously missing methods.\n     SetView<LinkageProblem> newProblems =\n-        Sets.difference(currentProblems.keySet(), oldProblems.keySet());\n+        Sets.difference(currentProblems, oldProblems);\n \n     // Check that no new linkage errors have been introduced since the baseline\n     StringBuilder message = new StringBuilder(\"Baseline BOM: \" + baselineCoordinates + \"\\n\");\n     if (!newProblems.isEmpty()) {\n       message.append(\"Newly introduced problems:\\n\");\n-      for (LinkageProblem problem : newProblems) {\n-        message.append(problem + \" referenced from \" + currentProblems.get(problem) + \"\\n\");\n-      }\n+      message.append(LinkageProblem.formatLinkageProblems(newProblems));\n       Assert.fail(message.toString());\n     }\n-\n-    // If that passes, check whether there are any new references to missing methods:\n-    for (LinkageProblem problem : currentProblems.keySet()) {\n-      ImmutableSet<ClassFile> oldReferences = oldProblems.get(problem);\n-      ImmutableSet<ClassFile> currentReferences = currentProblems.get(problem);\n-      SetView<ClassFile> newReferences = Sets.difference(currentReferences, oldReferences);\n-      if (!newReferences.isEmpty()) {\n-        message.append(\"Newly introduced classes linking to \" + problem + \":\\n\");\n-        for (ClassFile classFile : newReferences) {\n-          message.append(\"Link from \" + classFile + \"\\n\");\n-        }\n-        Assert.fail(message.toString());\n-      }\n-    }\n   }\n \n   private String findLatestNonSnapshotVersion() throws MavenRepositoryException {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1MzAzOA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452853038", "bodyText": "ditto", "author": "elharo", "createdAt": "2020-07-10T13:45:17Z", "path": "boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java", "diffHunk": "@@ -49,28 +49,28 @@ public void testForNewLinkageErrors()\n     Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n     Bom bom = Bom.readBom(bomFile);\n \n-    ImmutableSetMultimap<SymbolProblem, ClassFile> oldProblems =\n+    ImmutableSetMultimap<LinkageProblem, ClassFile> oldProblems =\n         LinkageChecker.create(baseline).findSymbolProblems();\n     LinkageChecker checker = LinkageChecker.create(bom);\n-    ImmutableSetMultimap<SymbolProblem, ClassFile> currentProblems = checker.findSymbolProblems();\n+    ImmutableSetMultimap<LinkageProblem, ClassFile> currentProblems = checker.findSymbolProblems();", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjkwNTU0Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452905542", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T15:11:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1MzAzOA=="}], "type": "inlineReview", "revised_code": {"commit": "e0512e76961547d64e707efaf0cb3f27d7d61766", "chunk": "diff --git a/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java b/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\nindex 234f181c..63264e0c 100644\n--- a/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\n+++ b/boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java\n\n@@ -49,39 +49,23 @@ public class MaximumLinkageErrorsTest {\n     Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n     Bom bom = Bom.readBom(bomFile);\n \n-    ImmutableSetMultimap<LinkageProblem, ClassFile> oldProblems =\n+    ImmutableSet<LinkageProblem> oldProblems =\n         LinkageChecker.create(baseline).findSymbolProblems();\n     LinkageChecker checker = LinkageChecker.create(bom);\n-    ImmutableSetMultimap<LinkageProblem, ClassFile> currentProblems = checker.findSymbolProblems();\n+    ImmutableSet<LinkageProblem> currentProblems = checker.findSymbolProblems();\n \n     // This only tests for newly missing methods, not new references to\n     // previously missing methods.\n     SetView<LinkageProblem> newProblems =\n-        Sets.difference(currentProblems.keySet(), oldProblems.keySet());\n+        Sets.difference(currentProblems, oldProblems);\n \n     // Check that no new linkage errors have been introduced since the baseline\n     StringBuilder message = new StringBuilder(\"Baseline BOM: \" + baselineCoordinates + \"\\n\");\n     if (!newProblems.isEmpty()) {\n       message.append(\"Newly introduced problems:\\n\");\n-      for (LinkageProblem problem : newProblems) {\n-        message.append(problem + \" referenced from \" + currentProblems.get(problem) + \"\\n\");\n-      }\n+      message.append(LinkageProblem.formatLinkageProblems(newProblems));\n       Assert.fail(message.toString());\n     }\n-\n-    // If that passes, check whether there are any new references to missing methods:\n-    for (LinkageProblem problem : currentProblems.keySet()) {\n-      ImmutableSet<ClassFile> oldReferences = oldProblems.get(problem);\n-      ImmutableSet<ClassFile> currentReferences = currentProblems.get(problem);\n-      SetView<ClassFile> newReferences = Sets.difference(currentReferences, oldReferences);\n-      if (!newReferences.isEmpty()) {\n-        message.append(\"Newly introduced classes linking to \" + problem + \":\\n\");\n-        for (ClassFile classFile : newReferences) {\n-          message.append(\"Link from \" + classFile + \"\\n\");\n-        }\n-        Assert.fail(message.toString());\n-      }\n-    }\n   }\n \n   private String findLatestNonSnapshotVersion() throws MavenRepositoryException {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1MzUzNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452853535", "bodyText": "relevantLinkage", "author": "elharo", "createdAt": "2020-07-10T13:46:11Z", "path": "dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java", "diffHunk": "@@ -273,9 +272,8 @@ static Configuration configureFreemarker() {\n           Artifact artifact = entry.getKey();\n           ImmutableSet<ClassPathEntry> jarsInDependencyTree =\n               classPathResult.getClassPathEntries(Artifacts.toCoordinates(artifact));\n-          Map<ClassPathEntry, ImmutableSetMultimap<SymbolProblem, String>>\n-              relevantSymbolProblemTable =\n-                  Maps.filterKeys(symbolProblemTable, jarsInDependencyTree::contains);\n+          Map<ClassPathEntry, ImmutableSet<LinkageProblem>> relevantlinkageProblemTable =", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NzkzNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452887935", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-07-10T14:43:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1MzUzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java b/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\nindex b282d02b..cbe68de2 100644\n--- a/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\n+++ b/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\n\n@@ -272,7 +272,7 @@ public class DashboardMain {\n           Artifact artifact = entry.getKey();\n           ImmutableSet<ClassPathEntry> jarsInDependencyTree =\n               classPathResult.getClassPathEntries(Artifacts.toCoordinates(artifact));\n-          Map<ClassPathEntry, ImmutableSet<LinkageProblem>> relevantlinkageProblemTable =\n+          Map<ClassPathEntry, ImmutableSet<LinkageProblem>> relevantLinkageProblemTable =\n               Maps.filterKeys(linkageProblemTable, jarsInDependencyTree::contains);\n \n           ArtifactResults results =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NDI5OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452854298", "bodyText": "2020?", "author": "elharo", "createdAt": "2020-07-10T13:47:28Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4ODE0OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452888148", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T14:43:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NDI5OA=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NDkwNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452854904", "bodyText": "does this need to be public?", "author": "elharo", "createdAt": "2020-07-10T13:48:28Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A linkage error.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public final class LinkageProblem {\n+\n+  private final ErrorType errorType;\n+  private final Symbol symbol;\n+  private final ClassFile containingClass;\n+  private final ClassFile sourceClass;\n+\n+  @VisibleForTesting\n+  public LinkageProblem(", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4OTMwNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452889306", "bodyText": "Yes, it's public because LinkageMonitorTest and FreemarkerTest (outside 'dependencies' module) use this constructor.", "author": "suztomo", "createdAt": "2020-07-10T14:45:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NDkwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MzkwNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453053905", "bodyText": "Now this constructor is package-private.", "author": "suztomo", "createdAt": "2020-07-10T20:05:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NDkwNA=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NTA1Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452855053", "bodyText": "errorType --> reason", "author": "elharo", "createdAt": "2020-07-10T13:48:44Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A linkage error.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public final class LinkageProblem {\n+\n+  private final ErrorType errorType;\n+  private final Symbol symbol;\n+  private final ClassFile containingClass;\n+  private final ClassFile sourceClass;\n+\n+  @VisibleForTesting\n+  public LinkageProblem(\n+      Symbol symbol,\n+      ErrorType errorType,\n+      @Nullable ClassFile containingClass,\n+      ClassFile sourceClass) {\n+    Preconditions.checkNotNull(symbol);\n+\n+    // After finding symbol problem, there is no need to have SuperClassSymbol over ClassSymbol.\n+    this.symbol =\n+        symbol instanceof SuperClassSymbol ? new ClassSymbol(symbol.getClassBinaryName()) : symbol;\n+    this.errorType = Preconditions.checkNotNull(errorType);\n+    this.containingClass = containingClass;\n+    this.sourceClass = Preconditions.checkNotNull(sourceClass);\n+  }\n+\n+  /** Returns the errorType why the symbol was not resolved. */", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg5MTc4Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452891787", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T14:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NTA1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NTc0OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452855749", "bodyText": "its --> their", "author": "elharo", "createdAt": "2020-07-10T13:49:55Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A linkage error.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public final class LinkageProblem {\n+\n+  private final ErrorType errorType;\n+  private final Symbol symbol;\n+  private final ClassFile containingClass;\n+  private final ClassFile sourceClass;\n+\n+  @VisibleForTesting\n+  public LinkageProblem(\n+      Symbol symbol,\n+      ErrorType errorType,\n+      @Nullable ClassFile containingClass,\n+      ClassFile sourceClass) {\n+    Preconditions.checkNotNull(symbol);\n+\n+    // After finding symbol problem, there is no need to have SuperClassSymbol over ClassSymbol.\n+    this.symbol =\n+        symbol instanceof SuperClassSymbol ? new ClassSymbol(symbol.getClassBinaryName()) : symbol;\n+    this.errorType = Preconditions.checkNotNull(errorType);\n+    this.containingClass = containingClass;\n+    this.sourceClass = Preconditions.checkNotNull(sourceClass);\n+  }\n+\n+  /** Returns the errorType why the symbol was not resolved. */\n+  ErrorType getErrorType() {\n+    return errorType;\n+  }\n+\n+  /** Returns the target symbol that was not resolved. */\n+  public Symbol getSymbol() {\n+    return symbol;\n+  }\n+\n+  /**\n+   * Returns the class that is expected to contain the symbol. If the symbol is a method or a field,\n+   * then this is the class where the symbol was expected to be found. If the symbol is an inner\n+   * class, this is the outer class that was expected to contain the inner class. If the symbol is\n+   * an outer class, this is null.\n+   */\n+  @Nullable\n+  public ClassFile getContainingClass() {\n+    return containingClass;\n+  }\n+\n+  /** Returns the source of the invalid reference which this linkage error represents. */\n+  public ClassFile getSourceClass() {\n+    return sourceClass;\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    if (this == other) {\n+      return true;\n+    }\n+    if (other == null || getClass() != other.getClass()) {\n+      return false;\n+    }\n+    LinkageProblem that = (LinkageProblem) other;\n+    return errorType == that.errorType\n+        && symbol.equals(that.symbol)\n+        && Objects.equals(containingClass, that.containingClass)\n+        && Objects.equals(sourceClass, that.sourceClass);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(errorType, symbol, containingClass, sourceClass);\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    return formatSymbolProblem() + \" referenced by \" + sourceClass;\n+  }\n+\n+  /**\n+   * Returns description of the problem on the symbol. This description does not include the {@code\n+   * sourceClass}. This value is useful when grouping {@link LinkageProblem}s by its symbols.", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg5MzA4Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452893086", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-07-10T14:51:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NTc0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NzYyNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452857626", "bodyText": "I guess I'm missing something but I don't see anywhere a linkageproblem is created except in test code", "author": "elharo", "createdAt": "2020-07-10T13:52:51Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A linkage error.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public final class LinkageProblem {\n+\n+  private final ErrorType errorType;\n+  private final Symbol symbol;\n+  private final ClassFile containingClass;\n+  private final ClassFile sourceClass;\n+\n+  @VisibleForTesting\n+  public LinkageProblem(", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg5MTMyNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452891326", "bodyText": "Right. Apart from LinkageChecker, this constructor is used by tests.", "author": "suztomo", "createdAt": "2020-07-10T14:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NzYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk3MzU2OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452973569", "bodyText": "so where/how does LinkageChecker create them? I don't see that in this PR.", "author": "elharo", "createdAt": "2020-07-10T17:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NzYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk4NjExMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452986110", "bodyText": "The large diff in LinkageChecker.java is not rendered by default. Find 'LinkageChecker.java' and expand the diff before searching for \"new LinkageProblem\":", "author": "suztomo", "createdAt": "2020-07-10T17:47:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1NzYyNg=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1ODQ3MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452858470", "bodyText": "In general \"type\" variables in classes are a code smell in object oriented languages. By default I expect types to be indicated by class/object types. Should that be done here?", "author": "elharo", "createdAt": "2020-07-10T13:54:19Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright 2019 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+import javax.annotation.Nullable;\n+\n+/**\n+ * A linkage error.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public final class LinkageProblem {\n+\n+  private final ErrorType errorType;", "originalCommit": "28269c9d3ee138fa48d7c461eb3523d8f6551554", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg5ODIxNA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452898214", "bodyText": "Right \"ErrorType\" might be too generic. But I would exclude that renaming from this PR.", "author": "suztomo", "createdAt": "2020-07-10T14:59:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1ODQ3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk3MjYwOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452972609", "bodyText": "I'm not suggesting a renaming. I'm suggesting you don't wan this field at all. Type information should be conveyed by subtypes. Among other benefits that enables different subtypes to have methods and data specific to that type.", "author": "elharo", "createdAt": "2020-07-10T17:19:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1ODQ3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk4NjMyMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452986323", "bodyText": "So far, I don't see any need to have different subtypes. Current ErrorType enum is sufficient. When we encounter the need of differentiating them with error-specific fields, I'll apply the subtyping.", "author": "suztomo", "createdAt": "2020-07-10T17:48:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg1ODQ3MA=="}], "type": "inlineReview", "revised_code": {"commit": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 98de30e2..904ee48d 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright 2019 Google LLC.\n+ * Copyright 2020 Google LLC.\n  *\n  * Licensed under the Apache License, Version 2.0 (the \"License\");\n  * you may not use this file except in compliance with the License.\n"}}, {"oid": "e0512e76961547d64e707efaf0cb3f27d7d61766", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e0512e76961547d64e707efaf0cb3f27d7d61766", "message": "Compiles", "committedDate": "2020-07-10T14:41:09Z", "type": "commit"}, {"oid": "6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/6dce0c57ef9f98b79ab966153aee28b576f3a3d8", "message": "Added test", "committedDate": "2020-07-10T15:33:56Z", "type": "commit"}, {"oid": "24891f2f356da77f011240a8dcbc73f0f26c0227", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/24891f2f356da77f011240a8dcbc73f0f26c0227", "message": "Renamed symbols", "committedDate": "2020-07-10T15:55:58Z", "type": "commit"}, {"oid": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4a3daa4341e3490abd1ae346c00ffb2547511ad1", "message": "format", "committedDate": "2020-07-10T15:57:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0MDIwNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452940206", "bodyText": "The check 2 lines above invalidate new references to existing symbol problems if any.\nIt was checking 2 types of errors\n\nNew linkage errors on symbols problem\nNew references to existing problems", "author": "suztomo", "createdAt": "2020-07-10T16:13:58Z", "path": "boms/integration-tests/src/test/java/com/google/cloud/MaximumLinkageErrorsTest.java", "diffHunk": "@@ -49,39 +47,22 @@ public void testForNewLinkageErrors()\n     Path bomFile = Paths.get(\"../cloud-oss-bom/pom.xml\");\n     Bom bom = Bom.readBom(bomFile);\n \n-    ImmutableSetMultimap<SymbolProblem, ClassFile> oldProblems =\n-        LinkageChecker.create(baseline).findSymbolProblems();\n+    ImmutableSet<LinkageProblem> oldProblems =\n+        LinkageChecker.create(baseline).findLinkageProblems();\n     LinkageChecker checker = LinkageChecker.create(bom);\n-    ImmutableSetMultimap<SymbolProblem, ClassFile> currentProblems = checker.findSymbolProblems();\n+    ImmutableSet<LinkageProblem> currentProblems = checker.findLinkageProblems();\n \n     // This only tests for newly missing methods, not new references to\n     // previously missing methods.\n-    SetView<SymbolProblem> newProblems =\n-        Sets.difference(currentProblems.keySet(), oldProblems.keySet());\n+    SetView<LinkageProblem> newProblems = Sets.difference(currentProblems, oldProblems);\n \n     // Check that no new linkage errors have been introduced since the baseline\n     StringBuilder message = new StringBuilder(\"Baseline BOM: \" + baselineCoordinates + \"\\n\");\n     if (!newProblems.isEmpty()) {\n       message.append(\"Newly introduced problems:\\n\");\n-      for (SymbolProblem problem : newProblems) {\n-        message.append(problem + \" referenced from \" + currentProblems.get(problem) + \"\\n\");\n-      }\n+      message.append(LinkageProblem.formatLinkageProblems(newProblems));\n       Assert.fail(message.toString());\n     }\n-    \n-    // If that passes, check whether there are any new references to missing methods:\n-    for (SymbolProblem problem : currentProblems.keySet()) {\n-      ImmutableSet<ClassFile> oldReferences = oldProblems.get(problem);\n-      ImmutableSet<ClassFile> currentReferences = currentProblems.get(problem);\n-      SetView<ClassFile> newReferences = Sets.difference(currentReferences, oldReferences);\n-      if (!newReferences.isEmpty()) {\n-        message.append(\"Newly introduced classes linking to \" + problem + \":\\n\");\n-        for (ClassFile classFile : newReferences) {\n-          message.append(\"Link from \" + classFile + \"\\n\");\n-        }\n-        Assert.fail(message.toString());\n-      }\n-    }", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0NjEwMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r452946100", "bodyText": "This is public because DashboardMain touches this class.", "author": "suztomo", "createdAt": "2020-07-10T16:25:24Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/Symbol.java", "diffHunk": "@@ -27,7 +27,7 @@\n  * @see <a href=\"https://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html#jvms-5.1\">Java\n  *     Virtual Machine Specification: The Run-Time Constant Pool</a>\n  */\n-abstract class Symbol {\n+public abstract class Symbol {", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwMTI5Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453001293", "bodyText": "Is it possible for these three arguments to indicate more than one linkage problem?", "author": "elharo", "createdAt": "2020-07-10T18:19:47Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -238,7 +238,8 @@ private boolean problemFilter(Map.Entry<SymbolProblem, ClassFile> entry) {\n    *     Virtual Machine Specification: 5.4.3.4. Interface Method Resolution</a>\n    */\n   @VisibleForTesting\n-  Optional<SymbolProblem> findSymbolProblem(ClassFile classFile, MethodSymbol symbol) {\n+  Optional<LinkageProblem> findLinkageProblem(\n+      ClassFile classFile, MethodSymbol symbol, ClassFile sourceClassFile) {", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1NjA2OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453056068", "bodyText": "No, it's at most one.", "author": "suztomo", "createdAt": "2020-07-10T20:11:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwMTI5Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwMzM3Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453003377", "bodyText": "github won't let me put this comment on line 254 but classFileLocation --> classPathEntry\ncontainingClassFile should probably be targetClassFile", "author": "elharo", "createdAt": "2020-07-10T18:24:12Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -256,18 +257,21 @@ private boolean problemFilter(Map.Entry<SymbolProblem, ClassFile> entry) {\n \n       if (!isClassAccessibleFrom(targetJavaClass, sourceClassName)) {\n         return Optional.of(\n-            new SymbolProblem(symbol, ErrorType.INACCESSIBLE_CLASS, containingClassFile));\n+            new LinkageProblem(", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1NjY2Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453056663", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T20:12:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwMzM3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex f63f752a..c96f29f9 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -257,14 +257,12 @@ public class LinkageChecker {\n \n       if (!isClassAccessibleFrom(targetJavaClass, sourceClassName)) {\n         return Optional.of(\n-            new LinkageProblem(\n-                symbol, ErrorType.INACCESSIBLE_CLASS, containingClassFile, sourceClassFile));\n+            new InaccessibleClassProblem(symbol, sourceClassFile, containingClassFile));\n       }\n \n       if (targetJavaClass.isInterface() != symbol.isInterfaceMethod()) {\n         return Optional.of(\n-            new LinkageProblem(\n-                symbol, ErrorType.INCOMPATIBLE_CLASS_CHANGE, containingClassFile, sourceClassFile));\n+            new IncompatibleClassChangeProblem(symbol, sourceClassFile, containingClassFile));\n       }\n \n       // Check the existence of the parent class or interface for the class\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNDQ2MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453004461", "bodyText": "To me it feels like the natural order is\nsourceClass\ntargetClass\ntargetSymbol\nand the type should be a subclass of LinkageProblem", "author": "elharo", "createdAt": "2020-07-10T18:26:32Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -300,28 +305,30 @@ private boolean problemFilter(Map.Entry<SymbolProblem, ClassFile> entry) {\n \n       // The class is in class path but the symbol is not found\n       return Optional.of(\n-          new SymbolProblem(symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile));\n+          new LinkageProblem(\n+              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1Mjg3NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453052874", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T20:03:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNDQ2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex f63f752a..c96f29f9 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -304,16 +301,13 @@ public class LinkageChecker {\n       }\n \n       // The class is in class path but the symbol is not found\n-      return Optional.of(\n-          new LinkageProblem(\n-              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));\n+      return Optional.of(new SymbolNotFoundProblem(symbol, sourceClassFile, containingClassFile));\n     } catch (ClassNotFoundException ex) {\n       if (classDumper.catchesLinkageErrorOnClass(sourceClassName)) {\n         return Optional.empty();\n       }\n       ClassSymbol classSymbol = new ClassSymbol(symbol.getClassBinaryName());\n-      return Optional.of(\n-          new LinkageProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null, sourceClassFile));\n+      return Optional.of(new ClassNotFoundProblem(classSymbol, sourceClassFile));\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNDg0Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453004843", "bodyText": "Here, if we define ClassNotFoundProblem then there's no need for the null third argument that doesn't apply", "author": "elharo", "createdAt": "2020-07-10T18:27:21Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -300,28 +305,30 @@ private boolean problemFilter(Map.Entry<SymbolProblem, ClassFile> entry) {\n \n       // The class is in class path but the symbol is not found\n       return Optional.of(\n-          new SymbolProblem(symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile));\n+          new LinkageProblem(\n+              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));\n     } catch (ClassNotFoundException ex) {\n       if (classDumper.catchesLinkageErrorOnClass(sourceClassName)) {\n         return Optional.empty();\n       }\n       ClassSymbol classSymbol = new ClassSymbol(symbol.getClassBinaryName());\n-      return Optional.of(new SymbolProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null));\n+      return Optional.of(\n+          new LinkageProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null, sourceClassFile));", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAxMzc0MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453013741", "bodyText": "That makes sense. Let me create these subclasses.", "author": "suztomo", "createdAt": "2020-07-10T18:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNDg0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1NzcyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453057725", "bodyText": "Now ErrorType has been removed and SymbolProblem's subclasses replaced the role.", "author": "suztomo", "createdAt": "2020-07-10T20:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNDg0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex f63f752a..c96f29f9 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -304,16 +301,13 @@ public class LinkageChecker {\n       }\n \n       // The class is in class path but the symbol is not found\n-      return Optional.of(\n-          new LinkageProblem(\n-              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));\n+      return Optional.of(new SymbolNotFoundProblem(symbol, sourceClassFile, containingClassFile));\n     } catch (ClassNotFoundException ex) {\n       if (classDumper.catchesLinkageErrorOnClass(sourceClassName)) {\n         return Optional.empty();\n       }\n       ClassSymbol classSymbol = new ClassSymbol(symbol.getClassBinaryName());\n-      return Optional.of(\n-          new LinkageProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null, sourceClassFile));\n+      return Optional.of(new ClassNotFoundProblem(classSymbol, sourceClassFile));\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNTEyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453005125", "bodyText": "{@link AbstractMethodError}s at", "author": "elharo", "createdAt": "2020-07-10T18:27:56Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -300,28 +305,30 @@ private boolean problemFilter(Map.Entry<SymbolProblem, ClassFile> entry) {\n \n       // The class is in class path but the symbol is not found\n       return Optional.of(\n-          new SymbolProblem(symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile));\n+          new LinkageProblem(\n+              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));\n     } catch (ClassNotFoundException ex) {\n       if (classDumper.catchesLinkageErrorOnClass(sourceClassName)) {\n         return Optional.empty();\n       }\n       ClassSymbol classSymbol = new ClassSymbol(symbol.getClassBinaryName());\n-      return Optional.of(new SymbolProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null));\n+      return Optional.of(\n+          new LinkageProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null, sourceClassFile));\n     }\n   }\n \n   /**\n    * Returns the linkage errors for unimplemented methods in {@code classFile}. Such unimplemented\n    * methods manifest as {@link AbstractMethodError} in runtime.", "originalCommit": "4a3daa4341e3490abd1ae346c00ffb2547511ad1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1Njg1Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453056853", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T20:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzAwNTEyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex f63f752a..c96f29f9 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -304,16 +301,13 @@ public class LinkageChecker {\n       }\n \n       // The class is in class path but the symbol is not found\n-      return Optional.of(\n-          new LinkageProblem(\n-              symbol, ErrorType.SYMBOL_NOT_FOUND, containingClassFile, sourceClassFile));\n+      return Optional.of(new SymbolNotFoundProblem(symbol, sourceClassFile, containingClassFile));\n     } catch (ClassNotFoundException ex) {\n       if (classDumper.catchesLinkageErrorOnClass(sourceClassName)) {\n         return Optional.empty();\n       }\n       ClassSymbol classSymbol = new ClassSymbol(symbol.getClassBinaryName());\n-      return Optional.of(\n-          new LinkageProblem(classSymbol, ErrorType.CLASS_NOT_FOUND, null, sourceClassFile));\n+      return Optional.of(new ClassNotFoundProblem(classSymbol, sourceClassFile));\n     }\n   }\n \n"}}, {"oid": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "message": "LinkageProblem subclasses", "committedDate": "2020-07-10T19:56:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MDgxNw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453050817", "bodyText": "The format string usage is strange.", "author": "elharo", "createdAt": "2020-07-10T19:58:18Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The referenced method is not implemented in the class but the class is declared to implement the\n+ * method. Such unimplemented methods manifest as {@link AbstractMethodError} in runtime.\n+ */\n+class AbstractMethodProblem extends IncompatibleLinkageProblem {\n+  AbstractMethodProblem(Symbol symbol, ClassFile sourceClass, ClassFile targetClass) {\n+    super(\"%s is not accessible\", symbol, sourceClass, targetClass);", "originalCommit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1NDc1MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453054751", "bodyText": "Reverted to \" is not accessible\".", "author": "suztomo", "createdAt": "2020-07-10T20:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MDgxNw=="}], "type": "inlineReview", "revised_code": {"commit": "c86c3455068bb899bedc642df13e793c299d9b89", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\nindex f480202d..1a4ed9ec 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\n\n@@ -21,7 +21,7 @@ package com.google.cloud.tools.opensource.classpath;\n  * method. Such unimplemented methods manifest as {@link AbstractMethodError} in runtime.\n  */\n class AbstractMethodProblem extends IncompatibleLinkageProblem {\n-  AbstractMethodProblem(Symbol symbol, ClassFile sourceClass, ClassFile targetClass) {\n-    super(\"%s is not accessible\", symbol, sourceClass, targetClass);\n+  AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, Symbol symbol) {\n+    super(\"is not accessible\", sourceClass, targetClass, symbol);\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MTE1Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453051156", "bodyText": "and both --> when both\nis present -> are present", "author": "elharo", "createdAt": "2020-07-10T19:59:11Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import java.util.Objects;\n+\n+/**\n+ * LinkageProblem caused by an invalid reference and both source class and target class is present.", "originalCommit": "3c6c5a9e21a1f9b42d53b2149dfba4c8a3b9676e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1NDQ1MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453054450", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-10T20:06:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA1MTE1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "c86c3455068bb899bedc642df13e793c299d9b89", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\nindex d8954897..5898fb55 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\n\n@@ -19,17 +19,16 @@ package com.google.cloud.tools.opensource.classpath;\n import java.util.Objects;\n \n /**\n- * LinkageProblem caused by an invalid reference and both source class and target class is present.\n+ * LinkageProblem caused by an invalid reference when both source class and target class are\n+ * present.\n  */\n abstract class IncompatibleLinkageProblem extends LinkageProblem {\n   private final ClassFile targetClass;\n \n   IncompatibleLinkageProblem(\n-      String symbolProblemMessageFormat,\n-      Symbol symbol,\n-      ClassFile sourceClass,\n-      ClassFile targetClass) {\n-    super(symbolProblemMessageFormat, sourceClass, symbol);\n+      String symbolProblemMessage,\n+      ClassFile sourceClass, ClassFile targetClass, Symbol symbol) {\n+    super(symbolProblemMessage, sourceClass, symbol);\n     this.targetClass = targetClass;\n   }\n \n"}}, {"oid": "c86c3455068bb899bedc642df13e793c299d9b89", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c86c3455068bb899bedc642df13e793c299d9b89", "message": "ErrorType removed", "committedDate": "2020-07-10T20:14:38Z", "type": "commit"}, {"oid": "c4753cba55e7ee3193224cffb9734a995d108f8b", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c4753cba55e7ee3193224cffb9734a995d108f8b", "message": "format", "committedDate": "2020-07-10T20:28:20Z", "type": "commit"}, {"oid": "737e6f908dfe47bcff5026f32cc56434dd9e2c51", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/737e6f908dfe47bcff5026f32cc56434dd9e2c51", "message": "Argument reordering", "committedDate": "2020-07-10T20:33:11Z", "type": "commit"}, {"oid": "eb77ca97e2e7013003447f7bc9d962b60a3a6ebe", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/eb77ca97e2e7013003447f7bc9d962b60a3a6ebe", "message": "Format", "committedDate": "2020-07-10T20:33:54Z", "type": "commit"}, {"oid": "c01fd4d8e92a847a5fb950f20cbbde0be20f6f45", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/c01fd4d8e92a847a5fb950f20cbbde0be20f6f45", "message": "Fixed visibility", "committedDate": "2020-07-10T21:16:18Z", "type": "commit"}, {"oid": "ce1bf0a04c03a1bb275524ee1cd7aef8f78196f9", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/ce1bf0a04c03a1bb275524ee1cd7aef8f78196f9", "message": "Updated LinkageProblem usage", "committedDate": "2020-07-10T22:30:43Z", "type": "commit"}, {"oid": "a5d244198c178f8182fee6c6fcb0f90a4cbd4d5d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/a5d244198c178f8182fee6c6fcb0f90a4cbd4d5d", "message": "Merge remote-tracking branch 'origin/master' into linkage-problem", "committedDate": "2020-07-12T12:58:56Z", "type": "commit"}, {"oid": "aba62a6015ac2237bcd612c7adb53844921af892", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/aba62a6015ac2237bcd612c7adb53844921af892", "message": "Javadoc", "committedDate": "2020-07-13T02:37:37Z", "type": "commit"}, {"oid": "e9b354d50cb645c1bdc94b0069370d363205754e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/e9b354d50cb645c1bdc94b0069370d363205754e", "message": "Fixed accessor", "committedDate": "2020-07-13T04:33:08Z", "type": "commit"}, {"oid": "cb9a736994372bd9db872736f3b98e997532b79c", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/cb9a736994372bd9db872736f3b98e997532b79c", "message": "javadoc", "committedDate": "2020-07-13T05:50:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MjE2Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453592162", "bodyText": "in runtime --> at runtime.", "author": "elharo", "createdAt": "2020-07-13T11:46:15Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n+ * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n+ * as {@link AbstractMethodError}s in runtime.", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYwOTE5Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453609193", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-07-13T12:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MjE2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\nindex 6df52f24..211ffb86 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/AbstractMethodProblem.java\n\n@@ -19,10 +19,11 @@ package com.google.cloud.tools.opensource.classpath;\n /**\n  * The referenced {@code methodSymbol} is not implemented in the {@code targetClass} but the class\n  * is declared to implement the method by {@code sourceClass}. Such unimplemented methods manifest\n- * as {@link AbstractMethodError}s in runtime.\n+ * as {@link AbstractMethodError}s at runtime.\n  */\n final class AbstractMethodProblem extends IncompatibleLinkageProblem {\n   AbstractMethodProblem(ClassFile sourceClass, ClassFile targetClass, MethodSymbol methodSymbol) {\n-    super(\"is not accessible\", sourceClass, targetClass, methodSymbol);\n+    super(\"is not implemented in the class\", sourceClass, targetClass,\n+        methodSymbol);\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MzY1OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453593658", "bodyText": "writeXmlEvents --> writeLinkageProblem", "author": "elharo", "createdAt": "2020-07-13T11:49:31Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ExclusionFiles.java", "diffHunk": "@@ -192,17 +190,16 @@ private static void insertIndent(InputStream inputStream, OutputStream outputStr\n     indentTransformer.transform(new StreamSource(inputStream), new StreamResult(outputStream));\n   }\n \n-  private static void writeXmlEvents(\n-      XMLEventWriter writer, SymbolProblem symbolProblem, ClassFile classFile)\n+  private static void writeXmlEvents(XMLEventWriter writer, LinkageProblem linkageProblem)", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYwOTY4MA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453609680", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-13T12:21:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MzY1OA=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ExclusionFiles.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ExclusionFiles.java\nindex 059d9518..8ec88543 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ExclusionFiles.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/ExclusionFiles.java\n\n@@ -190,7 +190,7 @@ class ExclusionFiles {\n     indentTransformer.transform(new StreamSource(inputStream), new StreamResult(outputStream));\n   }\n \n-  private static void writeXmlEvents(XMLEventWriter writer, LinkageProblem linkageProblem)\n+  private static void writeXmlLinkageProblem(XMLEventWriter writer, LinkageProblem linkageProblem)\n       throws XMLStreamException {\n     writer.add(eventFactory.createStartElement(LINKAGE_ERROR_TAG, null, null));\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MzkzMw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453593933", "bodyText": "different package than the target class", "author": "elharo", "createdAt": "2020-07-13T11:50:07Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleClassProblem.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The {@code classSymbol} is inaccessible to the {@code sourceClass} as per {@code sourceClass}'s\n+ * definition of the class symbol.\n+ *\n+ * <p>If the source class is in a different package, the class or one of its enclosing types is not", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMDAwMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453610000", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-13T12:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5MzkzMw=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleClassProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleClassProblem.java\nindex 3217caa5..272040cb 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleClassProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleClassProblem.java\n\n@@ -20,9 +20,9 @@ package com.google.cloud.tools.opensource.classpath;\n  * The {@code classSymbol} is inaccessible to the {@code sourceClass} as per {@code sourceClass}'s\n  * definition of the class symbol.\n  *\n- * <p>If the source class is in a different package, the class or one of its enclosing types is not\n- * public. If the source class is in the same package, the class or one of its enclosing types is\n- * private.\n+ * <p>If the source class is in a different package than the target class, the class or one of its\n+ * enclosing types is not public. If the source class is in the same package, the class or one of\n+ * its enclosing types is private.\n  */\n final class InaccessibleClassProblem extends IncompatibleLinkageProblem {\n   InaccessibleClassProblem(ClassFile sourceClass, ClassFile targetClass, Symbol classSymbol) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDE3OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453594179", "bodyText": "different package than the target class", "author": "elharo", "createdAt": "2020-07-13T11:50:38Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The {@code symbol} (method or field) defined in {@code targetClass} is inaccessible to the {@code\n+ * sourceClass}.\n+ *\n+ * <p>If the source class is in a different package, the member is not public. If the source is in", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMDI2OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453610268", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-13T12:23:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDE3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\nindex 3119bf91..71a826ed 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\n\n@@ -20,9 +20,9 @@ package com.google.cloud.tools.opensource.classpath;\n  * The {@code symbol} (method or field) defined in {@code targetClass} is inaccessible to the {@code\n  * sourceClass}.\n  *\n- * <p>If the source class is in a different package, the member is not public. If the source is in\n- * the same package, the class is private. If the source is a subclass of the target class, the\n- * member is not protected or public.\n+ * <p>If the source class is in a different package than the target class, the member is not public.\n+ * If the source is in the same package, the member is private. If the source is a subclass of the\n+ * target class, the member is not protected or public.\n  */\n final class InaccessibleMemberProblem extends IncompatibleLinkageProblem {\n   InaccessibleMemberProblem(ClassFile sourceClass, ClassFile targetClass, Symbol symbol) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDM0Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453594347", "bodyText": "class is private --> member is private", "author": "elharo", "createdAt": "2020-07-13T11:51:00Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The {@code symbol} (method or field) defined in {@code targetClass} is inaccessible to the {@code\n+ * sourceClass}.\n+ *\n+ * <p>If the source class is in a different package, the member is not public. If the source is in\n+ * the same package, the class is private. If the source is a subclass of the target class, the", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMDQ1Nw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453610457", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-13T12:23:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDM0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\nindex 3119bf91..71a826ed 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/InaccessibleMemberProblem.java\n\n@@ -20,9 +20,9 @@ package com.google.cloud.tools.opensource.classpath;\n  * The {@code symbol} (method or field) defined in {@code targetClass} is inaccessible to the {@code\n  * sourceClass}.\n  *\n- * <p>If the source class is in a different package, the member is not public. If the source is in\n- * the same package, the class is private. If the source is a subclass of the target class, the\n- * member is not protected or public.\n+ * <p>If the source class is in a different package than the target class, the member is not public.\n+ * If the source is in the same package, the member is private. If the source is a subclass of the\n+ * target class, the member is not protected or public.\n  */\n final class InaccessibleMemberProblem extends IncompatibleLinkageProblem {\n   InaccessibleMemberProblem(ClassFile sourceClass, ClassFile targetClass, Symbol symbol) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDc0NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453594744", "bodyText": "I don't see why the second case is breaking. I'm probably missing something here, but if you can explain it to me offline, it would helpful. Thanks.", "author": "elharo", "createdAt": "2020-07-13T11:51:57Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleClassChangeProblem.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+/**\n+ * The {@code symbol} (class or interface) defined in {@code targetClass} is not binary-compatible\n+ * with the {@code sourceClass}.\n+ *\n+ * <p>An example case of breaking binary-compatibility is when a superclass changes a method to\n+ * {@code final} and a subclass is still overriding the method. Another example is when there is a\n+ * method call to an interface and the interface is changed to a class with the same name.", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMjQwNg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453612406", "bodyText": "It's \"If C is not an interface, interface method resolution throws an IncompatibleClassChangeError.\"\nhttps://docs.oracle.com/javase/specs/jvms/se8/html/jvms-5.html#jvms-5.4.3.4", "author": "suztomo", "createdAt": "2020-07-13T12:27:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NDc0NA=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleClassChangeProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleClassChangeProblem.java\nindex aebdc336..d43a8534 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleClassChangeProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleClassChangeProblem.java\n\n@@ -22,7 +22,8 @@ package com.google.cloud.tools.opensource.classpath;\n  *\n  * <p>An example case of breaking binary-compatibility is when a superclass changes a method to\n  * {@code final} and a subclass is still overriding the method. Another example is when there is a\n- * method call to an interface and the interface is changed to a class with the same name.\n+ * method call to an interface and the interface is changed to a class with the same name. For\n+ * details, see \"Interface Method Resolution\" below).\n  *\n  * @see <a href=\"https://docs.oracle.com/javase/specs/jls/se8/html/jls-13.html#jls-13.4.9\">Java\n  *     Language Specification: 13.4.9. final Fields and static Constant Variables</a>\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NTU5Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453595596", "bodyText": "if block doesn't seem needed here", "author": "elharo", "createdAt": "2020-07-13T11:53:52Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -136,28 +133,29 @@ private LinkageChecker(\n \n   /**\n    * Searches the classpath for linkage errors.\n-   * \n-   * @return {@link SymbolProblem}s found in the class path and referencing classes\n+   *\n+   * @return {@link LinkageProblem}s found in the class path and referencing classes\n    * @throws IOException I/O error reading files in the classpath\n    */\n-  public ImmutableSetMultimap<SymbolProblem, ClassFile> findSymbolProblems() throws IOException {\n-    // Having Problem in key will dedup SymbolProblems\n-    ImmutableSetMultimap.Builder<SymbolProblem, ClassFile> problemToClass =\n-        ImmutableSetMultimap.builder();\n-    \n+  public ImmutableSet<LinkageProblem> findLinkageProblems() throws IOException {\n+    ImmutableSet.Builder<LinkageProblem> problemToClass = ImmutableSet.builder();\n+\n+    // This sourceClassFile is a source of references to other symbols.\n     for (ClassFile classFile : symbolReferences.getClassFiles()) {\n       ImmutableSet<ClassSymbol> classSymbols = symbolReferences.getClassSymbols(classFile);\n-\n       for (ClassSymbol classSymbol : classSymbols) {\n         if (classSymbol instanceof SuperClassSymbol) {\n-          ImmutableList<SymbolProblem> problems =\n-              findAbstractParentProblems(classFile, (SuperClassSymbol) classSymbol);\n-          if (!problems.isEmpty()) {\n-            String superClassName = classSymbol.getClassBinaryName();\n-            ClassPathEntry superClassLocation = classDumper.findClassLocation(superClassName);\n+          String superClassName = classSymbol.getClassBinaryName();\n+          ClassPathEntry superClassLocation = classDumper.findClassLocation(superClassName);\n+          if (superClassLocation != null) {\n             ClassFile superClassFile = new ClassFile(superClassLocation, superClassName);\n-            for (SymbolProblem problem : problems) {\n-              problemToClass.put(problem, superClassFile);\n+            ImmutableList<LinkageProblem> problems =\n+                findAbstractParentProblems(\n+                    classFile, (SuperClassSymbol) classSymbol, superClassFile);\n+            if (!problems.isEmpty()) {", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMzQ0OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453623449", "bodyText": "Good catch. Fixed.", "author": "suztomo", "createdAt": "2020-07-13T12:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NTU5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex 39ffe593..9a509cc0 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -152,10 +152,8 @@ public class LinkageChecker {\n             ImmutableList<LinkageProblem> problems =\n                 findAbstractParentProblems(\n                     classFile, (SuperClassSymbol) classSymbol, superClassFile);\n-            if (!problems.isEmpty()) {\n-              for (LinkageProblem problem : problems) {\n-                problemToClass.add(problem);\n-              }\n+            for (LinkageProblem problem : problems) {\n+              problemToClass.add(problem);\n             }\n           }\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NTcyMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453595722", "bodyText": "if block isn't needed", "author": "elharo", "createdAt": "2020-07-13T11:54:08Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -167,19 +165,22 @@ private LinkageChecker(\n         String classFileName = classDumper.getFileName(classBinaryName);\n         if (!classFileNames.contains(classFileName)) {\n           if (classSymbol instanceof InterfaceSymbol) {\n-            ImmutableList<SymbolProblem> problems =\n-                findInterfaceProblems(classFile, (InterfaceSymbol) classSymbol);\n-            if (!problems.isEmpty()) {\n-              String interfaceName = classSymbol.getClassBinaryName();\n-              ClassPathEntry interfaceLocation = classDumper.findClassLocation(interfaceName);\n+            String interfaceName = classSymbol.getClassBinaryName();\n+            ClassPathEntry interfaceLocation = classDumper.findClassLocation(interfaceName);\n+            if (interfaceLocation != null) {\n               ClassFile interfaceClassFile = new ClassFile(interfaceLocation, interfaceName);\n-              for (SymbolProblem problem : problems) {\n-                problemToClass.put(problem, interfaceClassFile);\n+              ImmutableList<LinkageProblem> problems =\n+                  findInterfaceProblems(\n+                      classFile, (InterfaceSymbol) classSymbol, interfaceClassFile);\n+              if (!problems.isEmpty()) {", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMzYwNw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453623607", "bodyText": "Fixed.", "author": "suztomo", "createdAt": "2020-07-13T12:47:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NTcyMg=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\nindex 39ffe593..9a509cc0 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java\n\n@@ -172,10 +170,8 @@ public class LinkageChecker {\n               ImmutableList<LinkageProblem> problems =\n                   findInterfaceProblems(\n                       classFile, (InterfaceSymbol) classSymbol, interfaceClassFile);\n-              if (!problems.isEmpty()) {\n-                for (LinkageProblem problem : problems) {\n-                  problemToClass.add(problem);\n-                }\n+              for (LinkageProblem problem : problems) {\n+                problemToClass.add(problem);\n               }\n             }\n           } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NjQwMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453596402", "bodyText": "weird that this is filtering after building. Could you simply not add the elements we don't want in the first place.", "author": "elharo", "createdAt": "2020-07-13T11:55:28Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -205,26 +206,25 @@ private LinkageChecker(\n         String classBinaryName = fieldSymbol.getClassBinaryName();\n         String classFileName = classDumper.getFileName(classBinaryName);\n         if (!classFileNames.contains(classFileName)) {\n-          findSymbolProblem(classFile, fieldSymbol)\n-              .ifPresent(problem -> problemToClass.put(problem, classFile.topLevelClassFile()));\n+          findLinkageProblem(classFile, fieldSymbol, classFile.topLevelClassFile())\n+              .ifPresent(problemToClass::add);\n         }\n       }\n     }\n \n     // Filter classes in whitelist\n-    SetMultimap<SymbolProblem, ClassFile> filteredMap =\n-        Multimaps.filterEntries(problemToClass.build(), this::problemFilter);\n-    return ImmutableSetMultimap.copyOf(filteredMap);\n+    ImmutableSet<LinkageProblem> filteredMap =\n+        problemToClass.build().stream().filter(this::problemFilter).collect(toImmutableSet());", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyODg3NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453628874", "bodyText": "That would duplicate if (problemFilter(linkageProblem)) { problemToClass.add... } every time LinkageProblem is created.\nBy filtering the linkage problems at the end, we're reducing the scattered piece of code into one place.", "author": "suztomo", "createdAt": "2020-07-13T12:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NjQwMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NzY1Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453597652", "bodyText": "toString() can be inferred here", "author": "elharo", "createdAt": "2020-07-13T11:57:51Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+\n+/**\n+ * A linkage error describing an invalid reference from {@code sourceClass} to {@code symbol}.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public abstract class LinkageProblem {\n+\n+  private final Symbol symbol;\n+  private final ClassFile sourceClass;\n+  private final String symbolProblemMessage;\n+\n+  /**\n+   * A linkage error describing an invalid reference.\n+   *\n+   * @param symbolProblemMessage human-friendly description of this linkage error. Used in\n+   *     conjunction with {@code symbol}, this value explains why we consider the reference to\n+   *     {@code symbol} as a linkage error.\n+   * @param sourceClass the source of the invalid reference.\n+   * @param symbol the target of the invalid reference\n+   */\n+  LinkageProblem(String symbolProblemMessage, ClassFile sourceClass, Symbol symbol) {\n+    this.symbolProblemMessage = Preconditions.checkNotNull(symbolProblemMessage);\n+    Preconditions.checkNotNull(symbol);\n+\n+    // After finding symbol problem, there is no need to have SuperClassSymbol over ClassSymbol.\n+    this.symbol =\n+        symbol instanceof SuperClassSymbol ? new ClassSymbol(symbol.getClassBinaryName()) : symbol;\n+    this.sourceClass = Preconditions.checkNotNull(sourceClass);\n+  }\n+\n+  /** Returns the target symbol that was not resolved. */\n+  public Symbol getSymbol() {\n+    return symbol;\n+  }\n+\n+  /** Returns the source of the invalid reference which this linkage error represents. */\n+  public ClassFile getSourceClass() {\n+    return sourceClass;\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    if (this == other) {\n+      return true;\n+    }\n+    if (other == null || getClass() != other.getClass()) {\n+      return false;\n+    }\n+    LinkageProblem that = (LinkageProblem) other;\n+    return symbol.equals(that.symbol) && Objects.equals(sourceClass, that.sourceClass);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(symbol, sourceClass);\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    return formatSymbolProblem() + \" referenced by \" + sourceClass;\n+  }\n+\n+  /**\n+   * Returns the description of the problem on the {@code symbol}. This description does not include\n+   * the {@code sourceClass}. This value is useful when grouping {@link LinkageProblem}s by their\n+   * {@code symbol}s.\n+   */\n+  public String formatSymbolProblem() {\n+    return symbol.toString() + \" \" + symbolProblemMessage;", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMzA3NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453613075", "bodyText": "Removed .toString().", "author": "suztomo", "createdAt": "2020-07-13T12:28:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5NzY1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 9b9d2e7f..9dd2c063 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -20,6 +20,7 @@ import com.google.common.base.Preconditions;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableListMultimap;\n import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Iterables;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Maps;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5OTAyMg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453599022", "bodyText": "Feels like another instance of using a data structure to stand in for a more specific type. Also feels very specific to one use case. Perhaps the Map can be pushed into the class so instead there's a method that returns the source classes given a linkage problem.\nAlso, I expect Set or Collection fits better here than List unless order is significant for some reason.", "author": "elharo", "createdAt": "2020-07-13T12:00:25Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+\n+/**\n+ * A linkage error describing an invalid reference from {@code sourceClass} to {@code symbol}.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public abstract class LinkageProblem {\n+\n+  private final Symbol symbol;\n+  private final ClassFile sourceClass;\n+  private final String symbolProblemMessage;\n+\n+  /**\n+   * A linkage error describing an invalid reference.\n+   *\n+   * @param symbolProblemMessage human-friendly description of this linkage error. Used in\n+   *     conjunction with {@code symbol}, this value explains why we consider the reference to\n+   *     {@code symbol} as a linkage error.\n+   * @param sourceClass the source of the invalid reference.\n+   * @param symbol the target of the invalid reference\n+   */\n+  LinkageProblem(String symbolProblemMessage, ClassFile sourceClass, Symbol symbol) {\n+    this.symbolProblemMessage = Preconditions.checkNotNull(symbolProblemMessage);\n+    Preconditions.checkNotNull(symbol);\n+\n+    // After finding symbol problem, there is no need to have SuperClassSymbol over ClassSymbol.\n+    this.symbol =\n+        symbol instanceof SuperClassSymbol ? new ClassSymbol(symbol.getClassBinaryName()) : symbol;\n+    this.sourceClass = Preconditions.checkNotNull(sourceClass);\n+  }\n+\n+  /** Returns the target symbol that was not resolved. */\n+  public Symbol getSymbol() {\n+    return symbol;\n+  }\n+\n+  /** Returns the source of the invalid reference which this linkage error represents. */\n+  public ClassFile getSourceClass() {\n+    return sourceClass;\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    if (this == other) {\n+      return true;\n+    }\n+    if (other == null || getClass() != other.getClass()) {\n+      return false;\n+    }\n+    LinkageProblem that = (LinkageProblem) other;\n+    return symbol.equals(that.symbol) && Objects.equals(sourceClass, that.sourceClass);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(symbol, sourceClass);\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    return formatSymbolProblem() + \" referenced by \" + sourceClass;\n+  }\n+\n+  /**\n+   * Returns the description of the problem on the {@code symbol}. This description does not include\n+   * the {@code sourceClass}. This value is useful when grouping {@link LinkageProblem}s by their\n+   * {@code symbol}s.\n+   */\n+  public String formatSymbolProblem() {\n+    return symbol.toString() + \" \" + symbolProblemMessage;\n+  }\n+\n+  /** Returns mapping from symbol problem description to the names of the source classes. */\n+  public static ImmutableMap<String, ImmutableList<String>> groupBySymbolProblem(", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYyMTA4Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453621086", "bodyText": "I don't think a LinkageProblem instance should hold multiple source classes. If that map (or set) is inside LinkageProblem class, it makes LinkageProblems always grouped by the target symbols. When rendering symbol problems, it's not always the case; the dashboard groups linkage errors by the source source class's jar first and then groups them by target symbols. Also, the nested structure makes difficult to find new linkage errors; without the that map inside LinkageProblem, it can just use Sets.difference(). Grouping linkage errors by source class or target symbols is just a presentation (in groupBySymbolProblem's case, it's for the dashboard). Linkage errors' data type should not dictate that grouping. We should keeping the structure flat and group them when necessary.\nUpdated to ImmutableSet as I don't need duplicate. We need (ImmutableSet's) deterministic ordering for the assertions in the linkage error output in tests.", "author": "suztomo", "createdAt": "2020-07-13T12:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5OTAyMg=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 9b9d2e7f..9dd2c063 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -20,6 +20,7 @@ import com.google.common.base.Preconditions;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableListMultimap;\n import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Iterables;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Maps;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5OTcxOQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453599719", "bodyText": "symbol --> linkage?", "author": "elharo", "createdAt": "2020-07-13T12:01:55Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import com.google.common.base.Preconditions;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableListMultimap;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Iterables;\n+import com.google.common.collect.ListMultimap;\n+import com.google.common.collect.Maps;\n+import com.google.common.collect.Multimaps;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.Set;\n+\n+/**\n+ * A linkage error describing an invalid reference from {@code sourceClass} to {@code symbol}.\n+ *\n+ * @see <a href=\"https://jlbp.dev/glossary.html#linkage-error\">Java Dependency Glossary: Linkage\n+ *     Error</a>\n+ */\n+public abstract class LinkageProblem {\n+\n+  private final Symbol symbol;\n+  private final ClassFile sourceClass;\n+  private final String symbolProblemMessage;\n+\n+  /**\n+   * A linkage error describing an invalid reference.\n+   *\n+   * @param symbolProblemMessage human-friendly description of this linkage error. Used in\n+   *     conjunction with {@code symbol}, this value explains why we consider the reference to\n+   *     {@code symbol} as a linkage error.\n+   * @param sourceClass the source of the invalid reference.\n+   * @param symbol the target of the invalid reference\n+   */\n+  LinkageProblem(String symbolProblemMessage, ClassFile sourceClass, Symbol symbol) {\n+    this.symbolProblemMessage = Preconditions.checkNotNull(symbolProblemMessage);\n+    Preconditions.checkNotNull(symbol);\n+\n+    // After finding symbol problem, there is no need to have SuperClassSymbol over ClassSymbol.\n+    this.symbol =\n+        symbol instanceof SuperClassSymbol ? new ClassSymbol(symbol.getClassBinaryName()) : symbol;\n+    this.sourceClass = Preconditions.checkNotNull(sourceClass);\n+  }\n+\n+  /** Returns the target symbol that was not resolved. */\n+  public Symbol getSymbol() {\n+    return symbol;\n+  }\n+\n+  /** Returns the source of the invalid reference which this linkage error represents. */\n+  public ClassFile getSourceClass() {\n+    return sourceClass;\n+  }\n+\n+  @Override\n+  public boolean equals(Object other) {\n+    if (this == other) {\n+      return true;\n+    }\n+    if (other == null || getClass() != other.getClass()) {\n+      return false;\n+    }\n+    LinkageProblem that = (LinkageProblem) other;\n+    return symbol.equals(that.symbol) && Objects.equals(sourceClass, that.sourceClass);\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    return Objects.hash(symbol, sourceClass);\n+  }\n+\n+  @Override\n+  public final String toString() {\n+    return formatSymbolProblem() + \" referenced by \" + sourceClass;\n+  }\n+\n+  /**\n+   * Returns the description of the problem on the {@code symbol}. This description does not include\n+   * the {@code sourceClass}. This value is useful when grouping {@link LinkageProblem}s by their\n+   * {@code symbol}s.\n+   */\n+  public String formatSymbolProblem() {\n+    return symbol.toString() + \" \" + symbolProblemMessage;\n+  }\n+\n+  /** Returns mapping from symbol problem description to the names of the source classes. */", "originalCommit": "e9b354d50cb645c1bdc94b0069370d363205754e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzYxMzI1OA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453613258", "bodyText": "It's symbol problem as it's return value is formatSymbolProblem().", "author": "suztomo", "createdAt": "2020-07-13T12:28:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU5OTcxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\nindex 9b9d2e7f..9dd2c063 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageProblem.java\n\n@@ -20,6 +20,7 @@ import com.google.common.base.Preconditions;\n import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableListMultimap;\n import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n import com.google.common.collect.Iterables;\n import com.google.common.collect.ListMultimap;\n import com.google.common.collect.Maps;\n"}}, {"oid": "64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/64aee2ea3236f76d0cd35cf8ca4e0a3627fe91d6", "message": "Applied review", "committedDate": "2020-07-13T13:01:58Z", "type": "commit"}, {"oid": "725add2d0c84ba0a827eb2e7a419696e41e8c6ee", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/725add2d0c84ba0a827eb2e7a419696e41e8c6ee", "message": "Format", "committedDate": "2020-07-13T13:04:21Z", "type": "commit"}, {"oid": "32c0314ba2dfc06b12d7b2968d0a78a5441ae24d", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/32c0314ba2dfc06b12d7b2968d0a78a5441ae24d", "message": "at runtime", "committedDate": "2020-07-13T13:20:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MDc4Mg==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453690782", "bodyText": "count --> counts", "author": "elharo", "createdAt": "2020-07-13T14:28:47Z", "path": "dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java", "diffHunk": "@@ -357,24 +355,31 @@ private static ArtifactResults generateArtifactReport(\n           collectLatestVersions(globalDependencies), transitiveDependencies);\n \n       long totalLinkageErrorCount =\n-          symbolProblemTable.values().stream()\n-              .flatMap(problemToClasses -> problemToClasses.keySet().stream())\n-              .distinct()\n+          linkageProblemTable.values().stream()\n+              .flatMap(problemToClasses -> problemToClasses.stream().map(LinkageProblem::getSymbol))\n+              .distinct() // The dashboard count linkage errors by the symbols", "originalCommit": "32c0314ba2dfc06b12d7b2968d0a78a5441ae24d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MjM4Mw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453782383", "bodyText": "Fixed", "author": "suztomo", "createdAt": "2020-07-13T16:39:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MDc4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "43f134f9fb67b9f0f7dc1360d00a2e070b946132", "chunk": "diff --git a/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java b/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\nindex 3243d654..f5e00d9e 100644\n--- a/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\n+++ b/dashboard/src/main/java/com/google/cloud/tools/opensource/dashboard/DashboardMain.java\n\n@@ -357,7 +357,7 @@ public class DashboardMain {\n       long totalLinkageErrorCount =\n           linkageProblemTable.values().stream()\n               .flatMap(problemToClasses -> problemToClasses.stream().map(LinkageProblem::getSymbol))\n-              .distinct() // The dashboard count linkage errors by the symbols\n+              .distinct() // The dashboard counts linkage errors by the symbols\n               .count();\n \n       Template report = configuration.getTemplate(\"/templates/component.ftl\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MzcyNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453693725", "bodyText": "String.format seems like overkill here", "author": "elharo", "createdAt": "2020-07-13T14:32:44Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 Google LLC.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.tools.opensource.classpath;\n+\n+import java.util.Objects;\n+\n+/**\n+ * A {@link LinkageProblem} caused by an invalid reference when both {@code sourceClass} and {@code\n+ * targetClass} are present in the class path.\n+ */\n+public abstract class IncompatibleLinkageProblem extends LinkageProblem {\n+  private final ClassFile targetClass;\n+\n+  IncompatibleLinkageProblem(\n+      String symbolProblemMessage, ClassFile sourceClass, ClassFile targetClass, Symbol symbol) {\n+    super(symbolProblemMessage, sourceClass, symbol);\n+    this.targetClass = targetClass;\n+  }\n+\n+  @Override\n+  public String formatSymbolProblem() {\n+    String jarInfo =\n+        targetClass != null ? String.format(\"(%s) \", targetClass.getClassPathEntry()) : \"\";", "originalCommit": "32c0314ba2dfc06b12d7b2968d0a78a5441ae24d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MzU4OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453783589", "bodyText": "Updated.", "author": "suztomo", "createdAt": "2020-07-13T16:41:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MzcyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "43f134f9fb67b9f0f7dc1360d00a2e070b946132", "chunk": "diff --git a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\nindex add6f751..28888eda 100644\n--- a/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\n+++ b/dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/IncompatibleLinkageProblem.java\n\n@@ -33,8 +33,7 @@ public abstract class IncompatibleLinkageProblem extends LinkageProblem {\n \n   @Override\n   public String formatSymbolProblem() {\n-    String jarInfo =\n-        targetClass != null ? String.format(\"(%s) \", targetClass.getClassPathEntry()) : \"\";\n+    String jarInfo = \"(\" + targetClass.getClassPathEntry() + \") \";\n     return jarInfo + super.formatSymbolProblem();\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NTc3OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453695779", "bodyText": "if blocks testing subtypes suggests there's a missed opportunity to use polymorphism. Could the logic of each if block be pushed into a method in ClassSymbol and its subtypes instead?", "author": "elharo", "createdAt": "2020-07-13T14:35:37Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/classpath/LinkageChecker.java", "diffHunk": "@@ -136,28 +133,27 @@ private LinkageChecker(\n \n   /**\n    * Searches the classpath for linkage errors.\n-   * \n-   * @return {@link SymbolProblem}s found in the class path and referencing classes\n+   *\n+   * @return {@link LinkageProblem}s found in the class path and referencing classes\n    * @throws IOException I/O error reading files in the classpath\n    */\n-  public ImmutableSetMultimap<SymbolProblem, ClassFile> findSymbolProblems() throws IOException {\n-    // Having Problem in key will dedup SymbolProblems\n-    ImmutableSetMultimap.Builder<SymbolProblem, ClassFile> problemToClass =\n-        ImmutableSetMultimap.builder();\n-    \n+  public ImmutableSet<LinkageProblem> findLinkageProblems() throws IOException {\n+    ImmutableSet.Builder<LinkageProblem> problemToClass = ImmutableSet.builder();\n+\n+    // This sourceClassFile is a source of references to other symbols.\n     for (ClassFile classFile : symbolReferences.getClassFiles()) {\n       ImmutableSet<ClassSymbol> classSymbols = symbolReferences.getClassSymbols(classFile);\n-\n       for (ClassSymbol classSymbol : classSymbols) {\n         if (classSymbol instanceof SuperClassSymbol) {", "originalCommit": "32c0314ba2dfc06b12d7b2968d0a78a5441ae24d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4ODI0Ng==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1523#discussion_r453788246", "bodyText": "Created an issue for your idea. #1529, as I feel worried that this PR is getting too many changes to finish, beyond \"LinkageProblem class to replace Multimap<SymbolProblem, ClassFile>\"", "author": "suztomo", "createdAt": "2020-07-13T16:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5NTc3OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "43f134f9fb67b9f0f7dc1360d00a2e070b946132", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/43f134f9fb67b9f0f7dc1360d00a2e070b946132", "message": "Applied review", "committedDate": "2020-07-13T16:49:24Z", "type": "commit"}, {"oid": "b58bd9daf0e45f50c4b4e40f3d3f602b07cf08f5", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b58bd9daf0e45f50c4b4e40f3d3f602b07cf08f5", "message": "Merge branch 'master' into linkage-problem", "committedDate": "2020-07-13T19:17:50Z", "type": "commit"}]}