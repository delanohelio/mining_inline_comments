{"pr_number": 1854, "pr_title": "Split testComponent_linkageCheckResult into Java 8 and Java 11", "pr_createdAt": "2020-12-02T16:17:07Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1854", "timeline": [{"oid": "4df9ec58e4866907e92f694e4fddd08f3371959e", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/4df9ec58e4866907e92f694e4fddd08f3371959e", "message": "Split testComponent_linkageCheckResult to 8 and 11", "committedDate": "2020-12-02T16:15:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NjUzMA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1854#discussion_r534356530", "bodyText": "This should be explained here, not just in the PR description.", "author": "elharo", "createdAt": "2020-12-02T17:38:25Z", "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java", "diffHunk": "@@ -314,6 +317,34 @@ public void testComponent_linkageCheckResult() throws IOException, ParsingExcept\n                 + \" referenced from 21 classes \u25b6\"); // '\u25b6' is the toggle button\n   }\n \n+  @Test\n+  public void testComponent_linkageCheckResult_java11() throws IOException, ParsingException {\n+    String javaVersion = System.getProperty(\"java.version\");\n+    // javaMajorVersion is 1 when we use Java 8. Still good indicator to ensure Java 11 or higher.\n+    int javaMajorVersion = Integer.parseInt(javaVersion.split(\"\\\\.\")[0]);\n+    Assume.assumeTrue(javaMajorVersion >= 11);\n+\n+    // version used in libraries-bom 1.0.0\n+    Document document = parseOutputFile(\n+        \"com.google.http-client_google-http-client-appengine_1.29.1.html\");\n+    Nodes reports = document.query(\"//p[@class='jar-linkage-report']\");\n+    Assert.assertEquals(2, reports.size());\n+    // This number differs between Java 8 and Java 11", "originalCommit": "4df9ec58e4866907e92f694e4fddd08f3371959e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM5Nzk1NQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1854#discussion_r534397955", "bodyText": "Yes, updated.", "author": "suztomo", "createdAt": "2020-12-02T18:42:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NjUzMA=="}], "type": "inlineReview", "revised_code": {"commit": "fc04b9271dbf0d7c62b411b51361f924bacc2ffa", "chunk": "diff --git a/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java b/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\nindex 99552596..bfb73155 100644\n--- a/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\n+++ b/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\n\n@@ -324,12 +324,17 @@ public class DashboardTest {\n     int javaMajorVersion = Integer.parseInt(javaVersion.split(\"\\\\.\")[0]);\n     Assume.assumeTrue(javaMajorVersion >= 11);\n \n-    // version used in libraries-bom 1.0.0\n+    // The version used in libraries-bom 1.0.0. The google-http-client-appengine has been known to\n+    // have linkage errors in its dependencies (\"commons-logging:commons-logging:1.2\" and\n+    // \"com.google.appengine:appengine-api-1.0-sdk:1.9.71\").\n     Document document = parseOutputFile(\n         \"com.google.http-client_google-http-client-appengine_1.29.1.html\");\n     Nodes reports = document.query(\"//p[@class='jar-linkage-report']\");\n     Assert.assertEquals(2, reports.size());\n-    // This number differs between Java 8 and Java 11\n+\n+    // This number of linkage errors differs between Java 8 and Java 11 for the javax.activation\n+    // package removal (JEP 320: Remove the Java EE and CORBA Modules). For the detail, see\n+    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1849.\n     Truth.assertThat(trimAndCollapseWhiteSpace(reports.get(0).getValue()))\n         .isEqualTo(\"105 target classes causing linkage errors referenced from 562 source classes.\");\n     Truth.assertThat(trimAndCollapseWhiteSpace(reports.get(1).getValue()))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NzQzNQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1854#discussion_r534357435", "bodyText": "Is this difference still present in more recent http clients? If not, we could simply update the version we use for the test.\nIf it is present, we should probably file a bug against the http client since it should work with Java 11.", "author": "elharo", "createdAt": "2020-12-02T17:39:42Z", "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java", "diffHunk": "@@ -314,6 +317,34 @@ public void testComponent_linkageCheckResult() throws IOException, ParsingExcept\n                 + \" referenced from 21 classes \u25b6\"); // '\u25b6' is the toggle button\n   }\n \n+  @Test\n+  public void testComponent_linkageCheckResult_java11() throws IOException, ParsingException {\n+    String javaVersion = System.getProperty(\"java.version\");\n+    // javaMajorVersion is 1 when we use Java 8. Still good indicator to ensure Java 11 or higher.\n+    int javaMajorVersion = Integer.parseInt(javaVersion.split(\"\\\\.\")[0]);\n+    Assume.assumeTrue(javaMajorVersion >= 11);\n+\n+    // version used in libraries-bom 1.0.0\n+    Document document = parseOutputFile(\n+        \"com.google.http-client_google-http-client-appengine_1.29.1.html\");", "originalCommit": "4df9ec58e4866907e92f694e4fddd08f3371959e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQwMTczNw==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1854#discussion_r534401737", "bodyText": "Added more description. This test does not check the difference between Java 8 and Java 11. Rather, this test ensures that the dashboard generated using Java 11 has the expected linkage error section.\nFor the linkage errors in google-http-client-appengine, the two artifacts (\"commons-logging:commons-logging:1.2\" and \"com.google.appengine:appengine-api-1.0-sdk:1.9.71\") still show the (known) linkage errors. They are present in Java 8 too: https://storage.googleapis.com/cloud-opensource-java-dashboard/com.google.cloud/libraries-bom/snapshot/com.google.http-client_google-http-client-appengine_1.38.0.html", "author": "suztomo", "createdAt": "2020-12-02T18:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NzQzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "fc04b9271dbf0d7c62b411b51361f924bacc2ffa", "chunk": "diff --git a/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java b/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\nindex 99552596..bfb73155 100644\n--- a/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\n+++ b/dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java\n\n@@ -324,12 +324,17 @@ public class DashboardTest {\n     int javaMajorVersion = Integer.parseInt(javaVersion.split(\"\\\\.\")[0]);\n     Assume.assumeTrue(javaMajorVersion >= 11);\n \n-    // version used in libraries-bom 1.0.0\n+    // The version used in libraries-bom 1.0.0. The google-http-client-appengine has been known to\n+    // have linkage errors in its dependencies (\"commons-logging:commons-logging:1.2\" and\n+    // \"com.google.appengine:appengine-api-1.0-sdk:1.9.71\").\n     Document document = parseOutputFile(\n         \"com.google.http-client_google-http-client-appengine_1.29.1.html\");\n     Nodes reports = document.query(\"//p[@class='jar-linkage-report']\");\n     Assert.assertEquals(2, reports.size());\n-    // This number differs between Java 8 and Java 11\n+\n+    // This number of linkage errors differs between Java 8 and Java 11 for the javax.activation\n+    // package removal (JEP 320: Remove the Java EE and CORBA Modules). For the detail, see\n+    // https://github.com/GoogleCloudPlatform/cloud-opensource-java/issues/1849.\n     Truth.assertThat(trimAndCollapseWhiteSpace(reports.get(0).getValue()))\n         .isEqualTo(\"105 target classes causing linkage errors referenced from 562 source classes.\");\n     Truth.assertThat(trimAndCollapseWhiteSpace(reports.get(1).getValue()))\n"}}, {"oid": "fd0dba44a98337c4055d0dac7c3c36b167d165af", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/fd0dba44a98337c4055d0dac7c3c36b167d165af", "message": "Merge remote-tracking branch 'origin/master' into i1849", "committedDate": "2020-12-02T18:51:38Z", "type": "commit"}, {"oid": "fc04b9271dbf0d7c62b411b51361f924bacc2ffa", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/fc04b9271dbf0d7c62b411b51361f924bacc2ffa", "message": "Added comment on the linkage errors", "committedDate": "2020-12-02T18:54:08Z", "type": "commit"}]}