{"pr_number": 1250, "pr_title": "Removing DependencyGraphBuilder's cache", "pr_createdAt": "2020-02-24T21:33:20Z", "pr_url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1250", "timeline": [{"oid": "f3fd12c788c4b55445342de077288d81813e0464", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/f3fd12c788c4b55445342de077288d81813e0464", "message": "Removing cache", "committedDate": "2020-02-24T21:32:14Z", "type": "commit"}, {"oid": "93a47f51faa7526c8ee28fb0f1ead92fb8f3d716", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/93a47f51faa7526c8ee28fb0f1ead92fb8f3d716", "message": "Merge branch 'master' into remove_cache", "committedDate": "2020-02-25T01:57:28Z", "type": "commit"}, {"oid": "b0ab52bf2d0e04dfe15867bfbecd2f0b6ee59d44", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/b0ab52bf2d0e04dfe15867bfbecd2f0b6ee59d44", "message": "Fixed DashboardTest.testGlobalUpperBoundUpgradeMessage", "committedDate": "2020-02-25T19:16:56Z", "type": "commit"}, {"oid": "140d39b59b74f71d2a57d2be2c0adef61c667b25", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/commit/140d39b59b74f71d2a57d2be2c0adef61c667b25", "message": "Fixed testComponent_failure", "committedDate": "2020-02-25T19:40:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5MTY1NA==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1250#discussion_r384091654", "bodyText": "In the previous PR 1239, I thought local upper bound check for this artifact has became green, but it still has an old protobuf-java.", "author": "suztomo", "createdAt": "2020-02-25T19:55:01Z", "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java", "diffHunk": "@@ -333,13 +333,13 @@ public void testComponent_failure() throws IOException, ParsingException {\n     Document document = parseOutputFile(\n         \"com.google.api.grpc_grpc-google-common-protos_1.14.0.html\");\n \n-    // com.google.api.grpc:grpc-google-common-protos:1.14.0 selects the highest version of all\n-    // dependencies.\n+    // com.google.api.grpc:grpc-google-common-protos:1.14.0 has no green section", "originalCommit": "140d39b59b74f71d2a57d2be2c0adef61c667b25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5Mjk5OQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1250#discussion_r384092999", "bodyText": "The previous commit 1239 unexpectedly added optional transitive dependencies in the tree. It was mixing cache for full dependency tree and normal dependency tree (the latter is used by Dashboard's dependency upgrade)", "author": "suztomo", "createdAt": "2020-02-25T19:57:30Z", "path": "dashboard/src/test/java/com/google/cloud/tools/opensource/dashboard/DashboardTest.java", "diffHunk": "@@ -404,14 +404,10 @@ public void testGlobalUpperBoundUpgradeMessage() throws IOException, ParsingExce\n         document.query(\"//li[@class='global-upper-bound-dependency-upgrade']\");\n \n     // The artifact report should contain the following 6 global upper bound dependency upgrades:\n-    //   Upgrade com.google.code.findbugs:jsr305:jar:1.3.9 to version \"3.0.2\"\n-    //   Upgrade com.google.errorprone:error_prone_annotations:jar:2.0.2 to version \"2.3.2\"\n     //   Upgrade com.google.guava:guava:jar:19.0 to version \"27.1-android\"\n-    //   Upgrade com.google.j2objc:j2objc-annotations:jar:0.1 to version \"1.1\"\n     //   Upgrade com.google.protobuf:protobuf-java:jar:3.6.1 to version \"3.7.1\"\n-    //   Upgrade org.codehaus.mojo:animal-sniffer-annotations:jar:1.14 to version \"1.17\"\n-    Truth.assertThat(globalUpperBoundDependencyUpgradeNodes.size()).isEqualTo(6);", "originalCommit": "140d39b59b74f71d2a57d2be2c0adef61c667b25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA5MzY3MQ==", "url": "https://github.com/GoogleCloudPlatform/cloud-opensource-java/pull/1250#discussion_r384093671", "bodyText": "This cache was meant to be used only for full dependency tree. But the implementation used this same cache for both full dependency tree and normal dependency tree. This bug caused the Dashboard test failure (Circle CI)", "author": "suztomo", "createdAt": "2020-02-25T19:58:48Z", "path": "dependencies/src/main/java/com/google/cloud/tools/opensource/dependencies/DependencyGraphBuilder.java", "diffHunk": "@@ -90,9 +88,6 @@\n     detectOsProperties().forEach(System::setProperty);\n   }\n \n-  // caching cuts time by about a factor of 4. Dependency class's equality includes exclusions.\n-  private final Map<Dependency, DependencyNode> cacheForFullDependency = new HashMap<>();", "originalCommit": "140d39b59b74f71d2a57d2be2c0adef61c667b25", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}