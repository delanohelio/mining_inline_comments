{"pr_number": 3679, "pr_title": "Retry reroute with max_latency strategy", "pr_createdAt": "2020-08-11T08:31:28Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3679", "timeline": [{"oid": "53caa059daad2793471418709bcb43cb6fb92410", "url": "https://github.com/telstra/open-kilda/commit/53caa059daad2793471418709bcb43cb6fb92410", "message": "Rework MAX_LATENCY path computation strategy\n\nWhen flow with MAX_LATENCY path computation strategy is rerouted or updated and path with required latency and bandwidth is not found then system should try to build a path without latency restrictions. If flow has a path that violates latency or bandwidth requirements then the flow should be in DEGRADED state.", "committedDate": "2020-08-13T19:08:11Z", "type": "forcePushed"}, {"oid": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "url": "https://github.com/telstra/open-kilda/commit/e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "message": "Rework MAX_LATENCY path computation strategy\n\nWhen flow with MAX_LATENCY path computation strategy is rerouted or updated and path with required latency and bandwidth is not found then system should try to build a path without latency restrictions. If flow has a path that violates latency or bandwidth requirements then the flow should be in DEGRADED state.", "committedDate": "2020-08-14T10:25:46Z", "type": "commit"}, {"oid": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "url": "https://github.com/telstra/open-kilda/commit/e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "message": "Rework MAX_LATENCY path computation strategy\n\nWhen flow with MAX_LATENCY path computation strategy is rerouted or updated and path with required latency and bandwidth is not found then system should try to build a path without latency restrictions. If flow has a path that violates latency or bandwidth requirements then the flow should be in DEGRADED state.", "committedDate": "2020-08-14T10:25:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY0NzY1Ng==", "url": "https://github.com/telstra/open-kilda/pull/3679#discussion_r474647656", "bodyText": "em... as far as I saw the code of PathComputer - in this case, it will use flow.getPathComputationStrategy() twice. First time as a \"normal\" strategy, second time as a \"backup\" strategy.", "author": "surabujin", "createdAt": "2020-08-21T11:48:55Z", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/reroute/actions/AllocatePrimaryResourcesAction.java", "diffHunk": "@@ -70,15 +70,18 @@ protected void allocate(FlowRerouteFsm stateMachine)\n \n         log.debug(\"Finding a new primary path for flow {}\", flowId);\n \n-        PathPair potentialPath;\n+        GetPathsResult potentialPath;\n         if (stateMachine.isIgnoreBandwidth()) {\n             boolean originalIgnoreBandwidth = flow.isIgnoreBandwidth();\n             flow.setIgnoreBandwidth(true);\n-            potentialPath = pathComputer.getPath(flow);\n+            potentialPath = pathComputer.getPath(flow, getBackUpStrategies(flow.getPathComputationStrategy()));\n             flow.setIgnoreBandwidth(originalIgnoreBandwidth);\n         } else {\n-            potentialPath = pathComputer.getPath(flow, flow.getFlowPathIds());\n+            potentialPath = pathComputer.getPath(\n+                    flow, flow.getFlowPathIds(), getBackUpStrategies(flow.getPathComputationStrategy()));", "originalCommit": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY1Mjk3Ng==", "url": "https://github.com/telstra/open-kilda/pull/3679#discussion_r474652976", "bodyText": "Bad/unhandy API...\nAdd one mandatory strategy argument and raise an obvious exception in case of failure. In this case caller will be responsible for loop over required strategies and will alway know with strategy was used (no need to pass it via response).", "author": "surabujin", "createdAt": "2020-08-21T12:01:34Z", "path": "src-java/kilda-pce/src/main/java/org/openkilda/pce/PathComputer.java", "diffHunk": "@@ -38,8 +38,9 @@\n      * @param flow the {@link Flow} instance\n      * @return {@link PathPair} instances\n      */\n-    default PathPair getPath(Flow flow) throws UnroutableFlowException, RecoverableException {\n-        return getPath(flow, Collections.emptyList());\n+    default GetPathsResult getPath(Flow flow, PathComputationStrategy... backUpStrategies)", "originalCommit": "e4a7d5b814e8acfbebf8b4bc17101189f10178c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}