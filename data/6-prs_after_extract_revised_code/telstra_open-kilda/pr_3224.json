{"pr_number": 3224, "pr_title": "Fixed display of `diverse_with` field in response via APIv2.", "pr_createdAt": "2020-02-20T13:26:59Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3224", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk5ODQ3Mg==", "url": "https://github.com/telstra/open-kilda/pull/3224#discussion_r381998472", "bodyText": "why is it array, not list?", "author": "timofei-durakov", "createdAt": "2020-02-20T13:31:14Z", "path": "src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java", "diffHunk": "@@ -164,6 +164,9 @@\n     @JsonProperty(\"path_computation_strategy\")\n     private PathComputationStrategy pathComputationStrategy;\n \n+    @JsonProperty(\"diverse_with\")\n+    private String[] diverseWith;", "originalCommit": "a78fb16916cf4ff191847272402c3b7fb726756c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAwNDc2MQ==", "url": "https://github.com/telstra/open-kilda/pull/3224#discussion_r382004761", "bodyText": "Changed to Set.", "author": "dpoltavets", "createdAt": "2020-02-20T13:42:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk5ODQ3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "871425afdff23e9cd7f72d1714e0739ffeca2097", "chunk": "diff --git a/src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java b/src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java\nindex 648a424be..325dec7f0 100644\n--- a/src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java\n+++ b/src-java/base-topology/base-messaging/src/main/java/org/openkilda/messaging/model/FlowDto.java\n\n@@ -165,7 +166,7 @@ public class FlowDto implements Serializable {\n     private PathComputationStrategy pathComputationStrategy;\n \n     @JsonProperty(\"diverse_with\")\n-    private String[] diverseWith;\n+    private Set<String> diverseWith;\n \n     public FlowDto() {\n     }\n"}}, {"oid": "871425afdff23e9cd7f72d1714e0739ffeca2097", "url": "https://github.com/telstra/open-kilda/commit/871425afdff23e9cd7f72d1714e0739ffeca2097", "message": "Fixed display of `diverse_with` field in response via APIv2", "committedDate": "2020-02-20T13:41:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA2MjkwNA==", "url": "https://github.com/telstra/open-kilda/pull/3224#discussion_r387062904", "bodyText": "Does it make sense to fetch a collection of Flow entities and then return just flow ids? Please, consider a new method in the repository.", "author": "sergii-iakovenko", "createdAt": "2020-03-03T14:40:10Z", "path": "src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java", "diffHunk": "@@ -101,4 +101,11 @@ protected boolean isRemoveCustomerPortSharedCatchRule(String flowId,\n \n         return flowIds.size() == 1 && flowIds.iterator().next().equals(flowId);\n     }\n+\n+    protected Set<String> getDiverseWithFlowIds(Flow flow) {\n+        return flowRepository.findByGroupId(flow.getGroupId()).stream()", "originalCommit": "7517e2cab3ab821c4bf0c79ee088ae47d223e2f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODIzMzgxNQ==", "url": "https://github.com/telstra/open-kilda/pull/3224#discussion_r388233815", "bodyText": "Fixed.", "author": "dpoltavets", "createdAt": "2020-03-05T11:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzA2MjkwNA=="}], "type": "inlineReview", "revised_code": {"commit": "6f13e16c246e7bc0188a771f3e77e0d5c437b52b", "chunk": "diff --git a/src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java b/src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java\nindex feb5992ff..a0010ab4b 100644\n--- a/src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java\n+++ b/src-java/flowhs-topology/flowhs-storm-topology/src/main/java/org/openkilda/wfm/topology/flowhs/fsm/common/actions/FlowProcessingAction.java\n\n@@ -103,8 +103,7 @@ public abstract class FlowProcessingAction<T extends FlowProcessingFsm<T, S, E,\n     }\n \n     protected Set<String> getDiverseWithFlowIds(Flow flow) {\n-        return flowRepository.findByGroupId(flow.getGroupId()).stream()\n-                .map(Flow::getFlowId)\n+        return flowRepository.findFlowsIdByGroupId(flow.getGroupId()).stream()\n                 .filter(flowId -> !flowId.equals(flow.getFlowId()))\n                 .collect(Collectors.toSet());\n     }\n"}}, {"oid": "6f13e16c246e7bc0188a771f3e77e0d5c437b52b", "url": "https://github.com/telstra/open-kilda/commit/6f13e16c246e7bc0188a771f3e77e0d5c437b52b", "message": "improve FlowDiversityV2Spec to conver #2701 (#3241)", "committedDate": "2020-03-05T11:23:55Z", "type": "forcePushed"}, {"oid": "526c00cc4206d9c110ed6299df512adb0c29f9b5", "url": "https://github.com/telstra/open-kilda/commit/526c00cc4206d9c110ed6299df512adb0c29f9b5", "message": "Fixed display of `diverse_with` field in response via APIv2", "committedDate": "2020-03-05T12:13:52Z", "type": "commit"}, {"oid": "c4095c0db360af5eb8df7c7c4ee54a4ba6d6e2bc", "url": "https://github.com/telstra/open-kilda/commit/c4095c0db360af5eb8df7c7c4ee54a4ba6d6e2bc", "message": "improve FlowDiversityV2Spec to conver #2701 (#3241)", "committedDate": "2020-03-05T12:13:52Z", "type": "forcePushed"}, {"oid": "f261adba1713960faac3500bd6677ae7d3061a21", "url": "https://github.com/telstra/open-kilda/commit/f261adba1713960faac3500bd6677ae7d3061a21", "message": "improve FlowDiversityV2Spec to conver #2701 (#3241)", "committedDate": "2020-03-05T13:33:56Z", "type": "commit"}, {"oid": "f261adba1713960faac3500bd6677ae7d3061a21", "url": "https://github.com/telstra/open-kilda/commit/f261adba1713960faac3500bd6677ae7d3061a21", "message": "improve FlowDiversityV2Spec to conver #2701 (#3241)", "committedDate": "2020-03-05T13:33:56Z", "type": "forcePushed"}]}