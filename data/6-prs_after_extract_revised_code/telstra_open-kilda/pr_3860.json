{"pr_number": 3860, "pr_title": "Zero downtime version", "pr_createdAt": "2020-11-18T15:58:27Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3860", "timeline": [{"oid": "15933dbe16eb4e9b01726418fc583ccd76d130c5", "url": "https://github.com/telstra/open-kilda/commit/15933dbe16eb4e9b01726418fc583ccd76d130c5", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-18T16:24:27Z", "type": "forcePushed"}, {"oid": "5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "url": "https://github.com/telstra/open-kilda/commit/5fd1e7172ecb3031ff8ea2da249ae4162a57b822", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-18T21:12:02Z", "type": "forcePushed"}, {"oid": "a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "url": "https://github.com/telstra/open-kilda/commit/a15c3c2fe3b0084f521ba0e3b93fa587b670362d", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-25T07:47:47Z", "type": "forcePushed"}, {"oid": "7c355ff9dd99f600058e70857098e7dd49db5505", "url": "https://github.com/telstra/open-kilda/commit/7c355ff9dd99f600058e70857098e7dd49db5505", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-25T08:02:44Z", "type": "forcePushed"}, {"oid": "2fe227ca01b450cf92c155ff4857be30645262db", "url": "https://github.com/telstra/open-kilda/commit/2fe227ca01b450cf92c155ff4857be30645262db", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-25T08:53:29Z", "type": "forcePushed"}, {"oid": "b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "url": "https://github.com/telstra/open-kilda/commit/b4806dbfc47c5e1d78e1e522f13b9a139b12ed30", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-25T12:16:03Z", "type": "forcePushed"}, {"oid": "9a7739e7f426097764848b114801d50a93d8385f", "url": "https://github.com/telstra/open-kilda/commit/9a7739e7f426097764848b114801d50a93d8385f", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-26T06:45:54Z", "type": "forcePushed"}, {"oid": "17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "url": "https://github.com/telstra/open-kilda/commit/17bdb1df124f02b5ef6d95b7c34c3ab80e925f1b", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-26T06:52:29Z", "type": "forcePushed"}, {"oid": "f3466d8906943bc9ad25dcbf647340600951116c", "url": "https://github.com/telstra/open-kilda/commit/f3466d8906943bc9ad25dcbf647340600951116c", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-27T11:10:11Z", "type": "forcePushed"}, {"oid": "7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "url": "https://github.com/telstra/open-kilda/commit/7217ea96d1231913a7a77fe283d8d9d823eb2f7d", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-11-28T07:59:05Z", "type": "forcePushed"}, {"oid": "d61fd07c6bb30636262ca96c7df0d1366423d10d", "url": "https://github.com/telstra/open-kilda/commit/d61fd07c6bb30636262ca96c7df0d1366423d10d", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-12-02T07:41:34Z", "type": "forcePushed"}, {"oid": "f3341a630fc323fceacf05a08234479336a08baf", "url": "https://github.com/telstra/open-kilda/commit/f3341a630fc323fceacf05a08234479336a08baf", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-12-04T07:26:41Z", "type": "commit"}, {"oid": "f3341a630fc323fceacf05a08234479336a08baf", "url": "https://github.com/telstra/open-kilda/commit/f3341a630fc323fceacf05a08234479336a08baf", "message": "Zero-downtime upgrade PoC: added build_version", "committedDate": "2020-12-04T07:26:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1OTUyOQ==", "url": "https://github.com/telstra/open-kilda/pull/3860#discussion_r536259529", "bodyText": "As for me, it looks like you need some \"generic\" (with java generics) class responsible for publishing to a single node (with shared zk-client if it is possible) and some closure for the set of such publishers. This approach is much more scalable than the current one.", "author": "surabujin", "createdAt": "2020-12-04T17:29:22Z", "path": "src-java/blue-green/src/main/java/org/openkilda/bluegreen/ZkWatchDog.java", "diffHunk": "@@ -32,19 +32,28 @@\n public class ZkWatchDog extends ZkClient implements DataCallback {\n \n     private static final String SIGNAL = \"signal\";\n+    private static final String BUILD_VERSION = \"build-version\";\n+\n     @VisibleForTesting\n     protected String signalPath;\n     private Signal signal;\n \n+    @VisibleForTesting\n+    protected String buildVersionPath;\n+    private String buildVersion;\n+\n     @VisibleForTesting\n     Set<LifeCycleObserver> observers = new HashSet<>();\n+    @VisibleForTesting\n+    Set<BuildVersionObserver> buildVersionObservers = new HashSet<>();", "originalCommit": "f3341a630fc323fceacf05a08234479336a08baf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}