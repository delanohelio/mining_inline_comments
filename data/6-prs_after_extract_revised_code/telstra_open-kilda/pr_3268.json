{"pr_number": 3268, "pr_title": "Add ISL busy check when deleting ISL.", "pr_createdAt": "2020-03-06T10:09:28Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3268", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgzNTg2Ng==", "url": "https://github.com/telstra/open-kilda/pull/3268#discussion_r392835866", "bodyText": "write unit tests for that", "author": "timofei-durakov", "createdAt": "2020-03-16T07:51:55Z", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -126,9 +130,18 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n             throw new IslNotFoundException(sourceSwitch, sourcePort, destinationSwitch, destinationPort);\n         }\n \n-        if (isls.stream().anyMatch(x -> x.getStatus() == IslStatus.ACTIVE)) {", "originalCommit": "b2149d77722119d2fc92c12b90fd3634f35e0edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc1OTcxMw==", "url": "https://github.com/telstra/open-kilda/pull/3268#discussion_r408759713", "bodyText": "Tests have been added.", "author": "dpoltavets", "createdAt": "2020-04-15T11:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjgzNTg2Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c73c62fec015334558cef0df19bb6d0bf59c1d29", "url": "https://github.com/telstra/open-kilda/commit/c73c62fec015334558cef0df19bb6d0bf59c1d29", "message": "Added ISL busy check when deleting ISL.", "committedDate": "2020-04-15T10:53:03Z", "type": "commit"}, {"oid": "c73c62fec015334558cef0df19bb6d0bf59c1d29", "url": "https://github.com/telstra/open-kilda/commit/c73c62fec015334558cef0df19bb6d0bf59c1d29", "message": "Added ISL busy check when deleting ISL.", "committedDate": "2020-04-15T10:53:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU5NjQ3OQ==", "url": "https://github.com/telstra/open-kilda/pull/3268#discussion_r414596479", "bodyText": "nit: I'd implement new method to fetch ids, instead of full objects", "author": "timofei-durakov", "createdAt": "2020-04-24T13:57:13Z", "path": "src-java/nbworker-topology/nbworker-storm-topology/src/main/java/org/openkilda/wfm/topology/nbworker/services/LinkOperationsService.java", "diffHunk": "@@ -126,9 +130,18 @@ public LinkOperationsService(ILinkOperationsServiceCarrier carrier,\n             throw new IslNotFoundException(sourceSwitch, sourcePort, destinationSwitch, destinationPort);\n         }\n \n-        if (isls.stream().anyMatch(x -> x.getStatus() == IslStatus.ACTIVE)) {\n-            throw new IllegalIslStateException(sourceSwitch, sourcePort, destinationSwitch, destinationPort,\n-                    \"ISL must NOT be in active state.\");\n+        if (!force) {\n+            if (isls.stream().anyMatch(x -> x.getStatus() == IslStatus.ACTIVE)) {\n+                throw new IllegalIslStateException(sourceSwitch, sourcePort, destinationSwitch, destinationPort,\n+                        \"ISL must NOT be in active state.\");\n+            }\n+\n+            Collection<FlowPath> flowPaths = flowPathRepository.findWithPathSegment(sourceSwitch, sourcePort,", "originalCommit": "c73c62fec015334558cef0df19bb6d0bf59c1d29", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}