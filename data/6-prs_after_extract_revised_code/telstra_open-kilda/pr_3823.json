{"pr_number": 3823, "pr_title": "Lock GRPC low level particularity into a single wrapper", "pr_createdAt": "2020-11-03T18:22:02Z", "pr_url": "https://github.com/telstra/open-kilda/pull/3823", "timeline": [{"oid": "b8d8369480fcb99448c0ef0021b1fa8d3afd5cdf", "url": "https://github.com/telstra/open-kilda/commit/b8d8369480fcb99448c0ef0021b1fa8d3afd5cdf", "message": "Lock GRPC low level particularity into a single wrapper", "committedDate": "2020-11-04T18:20:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5MTcyMA==", "url": "https://github.com/telstra/open-kilda/pull/3823#discussion_r542491720", "bodyText": "Rename method param as well.", "author": "rozdy", "createdAt": "2020-12-14T15:50:10Z", "path": "src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/controller/NoviflowController.java", "diffHunk": "@@ -129,7 +129,7 @@\n     public CompletableFuture<EnableLogMessagesResponse> enableLogOferrors(\n             @PathVariable(\"switch_address\") String switchAddress,\n             @RequestBody LogOferrorsDto logOferrors) {\n-        return grpcService.enableLogOferror(switchAddress, logOferrors);\n+        return grpcService.enableLogOfError(switchAddress, logOferrors);", "originalCommit": "b8d8369480fcb99448c0ef0021b1fa8d3afd5cdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MjU0MA==", "url": "https://github.com/telstra/open-kilda/pull/3823#discussion_r543142540", "bodyText": "done", "author": "surabujin", "createdAt": "2020-12-15T08:30:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5MTcyMA=="}], "type": "inlineReview", "revised_code": {"commit": "480ef14a77a9546d7dc7c9c055173641201cce0e", "chunk": "diff --git a/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/controller/NoviflowController.java b/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/controller/NoviflowController.java\nindex fddac8631..26b7514a2 100644\n--- a/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/controller/NoviflowController.java\n+++ b/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/controller/NoviflowController.java\n\n@@ -126,10 +126,10 @@ public class NoviflowController {\n             response = EnableLogMessagesResponse.class)\n     @PutMapping(path = \"/{switch_address}/logoferrors\")\n     @ResponseStatus(HttpStatus.OK)\n-    public CompletableFuture<EnableLogMessagesResponse> enableLogOferrors(\n+    public CompletableFuture<EnableLogMessagesResponse> enableLogOfErrors(\n             @PathVariable(\"switch_address\") String switchAddress,\n-            @RequestBody LogOferrorsDto logOferrors) {\n-        return grpcService.enableLogOfError(switchAddress, logOferrors);\n+            @RequestBody LogOferrorsDto ofErrorsDto) {\n+        return grpcService.enableLogOfError(switchAddress, ofErrorsDto);\n     }\n \n     @ApiOperation(value = \"Get a remote log server configuration for the switch\", response = RemoteLogServer.class)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5MzI0MA==", "url": "https://github.com/telstra/open-kilda/pull/3823#discussion_r542493240", "bodyText": "Can we change Consumer<Void> to Runnable here?", "author": "rozdy", "createdAt": "2020-12-14T15:52:04Z", "path": "src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/client/GrpcSession.java", "diffHunk": "@@ -418,9 +395,36 @@ public void shutdown() {\n      * @return {@link CompletableFuture} with operation result.\n      */\n     public CompletableFuture<Optional<PacketInOutStats>> getPacketInOutStats() {\n-        GrpcResponseObserver<PacketInOutStats> observer = new GrpcResponseObserver<>(address, GET_PACKET_IN_OUT_STATS);\n         log.info(\"Getting packet in out stats for switch {}\", address);\n-        stub.showStatsPacketInOut(ShowPacketInOutStats.newBuilder().build(), observer);\n-        return observer.future.thenApply(responses -> responses.stream().findFirst());\n+\n+        GrpcResponseObserver<PacketInOutStats> observer = new GrpcResponseObserver<>(address, GET_PACKET_IN_OUT_STATS);\n+        extendChain(\n+                dummy -> stub.showStatsPacketInOut(ShowPacketInOutStats.newBuilder().build(), observer),\n+                observer.future);\n+        return observer.future\n+                .thenApply(responses -> responses.stream().findFirst());\n+    }\n+\n+    private synchronized void extendChain(Consumer<Void> action, CompletableFuture<?> operation) {", "originalCommit": "b8d8369480fcb99448c0ef0021b1fa8d3afd5cdf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0MjY2Nw==", "url": "https://github.com/telstra/open-kilda/pull/3823#discussion_r543142667", "bodyText": "yes, replaced", "author": "surabujin", "createdAt": "2020-12-15T08:30:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQ5MzI0MA=="}], "type": "inlineReview", "revised_code": {"commit": "480ef14a77a9546d7dc7c9c055173641201cce0e", "chunk": "diff --git a/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/client/GrpcSession.java b/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/client/GrpcSession.java\nindex 8e11e7782..ac95efffb 100644\n--- a/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/client/GrpcSession.java\n+++ b/src-java/grpc-speaker/grpc-service/src/main/java/org/openkilda/grpc/speaker/client/GrpcSession.java\n\n@@ -399,15 +398,15 @@ public class GrpcSession implements Closeable {\n \n         GrpcResponseObserver<PacketInOutStats> observer = new GrpcResponseObserver<>(address, GET_PACKET_IN_OUT_STATS);\n         extendChain(\n-                dummy -> stub.showStatsPacketInOut(ShowPacketInOutStats.newBuilder().build(), observer),\n+                () -> stub.showStatsPacketInOut(ShowPacketInOutStats.newBuilder().build(), observer),\n                 observer.future);\n         return observer.future\n                 .thenApply(responses -> responses.stream().findFirst());\n     }\n \n-    private synchronized void extendChain(Consumer<Void> action, CompletableFuture<?> operation) {\n+    private synchronized void extendChain(Runnable action, CompletableFuture<?> operation) {\n         chain = CompletableFuture.allOf(\n-                chain.whenComplete((v, e) -> action.accept(null)), operation)\n+                chain.whenComplete((v, e) -> action.run()), operation)\n                 .handle((dummy, e) -> {\n                     // clean exceptional status\n                     return null;\n"}}, {"oid": "480ef14a77a9546d7dc7c9c055173641201cce0e", "url": "https://github.com/telstra/open-kilda/commit/480ef14a77a9546d7dc7c9c055173641201cce0e", "message": "Lock GRPC low level particularity into a single wrapper", "committedDate": "2020-12-15T08:30:06Z", "type": "commit"}, {"oid": "480ef14a77a9546d7dc7c9c055173641201cce0e", "url": "https://github.com/telstra/open-kilda/commit/480ef14a77a9546d7dc7c9c055173641201cce0e", "message": "Lock GRPC low level particularity into a single wrapper", "committedDate": "2020-12-15T08:30:06Z", "type": "forcePushed"}]}