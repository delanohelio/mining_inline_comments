{"pr_number": 7471, "pr_title": "IGNITE-12701 : Disallow silent deactivation in CLI and REST.", "pr_createdAt": "2020-02-25T09:45:54Z", "pr_url": "https://github.com/apache/ignite/pull/7471", "timeline": [{"oid": "6ecdbf8fbd36e6c95c2786deefafc05d71993f93", "url": "https://github.com/apache/ignite/commit/6ecdbf8fbd36e6c95c2786deefafc05d71993f93", "message": "IGNITE-12597 : first impl", "committedDate": "2020-02-03T16:20:07Z", "type": "commit"}, {"oid": "4d4aae017a153636e31438202d2a586a137e957e", "url": "https://github.com/apache/ignite/commit/4d4aae017a153636e31438202d2a586a137e957e", "message": "IGNITE-12597 : + checking of reuse-data-region system property", "committedDate": "2020-02-04T09:31:32Z", "type": "commit"}, {"oid": "f36c5791314431affdeca626020c8d8ee86dfe08", "url": "https://github.com/apache/ignite/commit/f36c5791314431affdeca626020c8d8ee86dfe08", "message": "IGNITE-12597 : + fix in the JMX", "committedDate": "2020-02-04T13:22:00Z", "type": "commit"}, {"oid": "1aac619c3c2124aa6944b266a0c3b7c6dddc46af", "url": "https://github.com/apache/ignite/commit/1aac619c3c2124aa6944b266a0c3b7c6dddc46af", "message": "IGNITE-12597 : Think is ready except the JMX tests", "committedDate": "2020-02-04T14:48:30Z", "type": "commit"}, {"oid": "e0f6ac491d512cb1ff439290b3f372893d88ca06", "url": "https://github.com/apache/ignite/commit/e0f6ac491d512cb1ff439290b3f372893d88ca06", "message": "IGNITE-12597 : Think the ticket is done. Attempt #1.", "committedDate": "2020-02-04T16:39:25Z", "type": "commit"}, {"oid": "172c4320636902f6ab58a08f41c851ba06cecc22", "url": "https://github.com/apache/ignite/commit/172c4320636902f6ab58a08f41c851ba06cecc22", "message": "IGNITE-12597 : Small fix in messages.", "committedDate": "2020-02-04T16:57:25Z", "type": "commit"}, {"oid": "9149f0ac13dd9a7edb8ce91f75aa327db2ee84ba", "url": "https://github.com/apache/ignite/commit/9149f0ac13dd9a7edb8ce91f75aa327db2ee84ba", "message": "IGNITE-12597 : Fixed checking of erase-mem-on-deactivation-flag. Now within the job, not on client node.", "committedDate": "2020-02-05T13:44:28Z", "type": "commit"}, {"oid": "9a90f533020aa475fb2166731ecd53cbe17fba09", "url": "https://github.com/apache/ignite/commit/9a90f533020aa475fb2166731ecd53cbe17fba09", "message": "IGNITE-12597 : Fixed checking of erase-mem-on-deactivation-flag. Now within the job, not on client node.", "committedDate": "2020-02-05T17:36:15Z", "type": "commit"}, {"oid": "4dfd7f8dbd259d301b2f5a3c06c3feaf76960ff3", "url": "https://github.com/apache/ignite/commit/4dfd7f8dbd259d301b2f5a3c06c3feaf76960ff3", "message": "IGNITE-12597 : Lost fixws after review", "committedDate": "2020-02-05T17:42:03Z", "type": "commit"}, {"oid": "edd2a52af20227cb3881a0bd1bdacf716782baf7", "url": "https://github.com/apache/ignite/commit/edd2a52af20227cb3881a0bd1bdacf716782baf7", "message": "IGNITE-12597 : fix after review.", "committedDate": "2020-02-06T10:50:49Z", "type": "commit"}, {"oid": "5d2dc697105c0445eac64ab9bdac69314ed296ff", "url": "https://github.com/apache/ignite/commit/5d2dc697105c0445eac64ab9bdac69314ed296ff", "message": "deleteme", "committedDate": "2020-02-06T12:56:23Z", "type": "commit"}, {"oid": "3fa51ccb7a089ab64df9597b43581a3fa18aba76", "url": "https://github.com/apache/ignite/commit/3fa51ccb7a089ab64df9597b43581a3fa18aba76", "message": "IGNITE-12597 : fix after review #n.", "committedDate": "2020-02-06T13:59:17Z", "type": "commit"}, {"oid": "cd26b383174dfb7460a016f52441d6d9945e5cbb", "url": "https://github.com/apache/ignite/commit/cd26b383174dfb7460a016f52441d6d9945e5cbb", "message": "IGNITE-12597 : fix.", "committedDate": "2020-02-06T14:07:10Z", "type": "commit"}, {"oid": "fbb406faeb24938ab332bb44c8fcd2cb67b3fa5e", "url": "https://github.com/apache/ignite/commit/fbb406faeb24938ab332bb44c8fcd2cb67b3fa5e", "message": "IGNITE-12597 : Removed checking of reuse-mem-on-deactivate. Useless. Won't work.", "committedDate": "2020-02-07T08:33:27Z", "type": "commit"}, {"oid": "d80a31088fea24d2e653fce3298ba27d74afa965", "url": "https://github.com/apache/ignite/commit/d80a31088fea24d2e653fce3298ba27d74afa965", "message": "IGNITE-12597 : Minor fixes.", "committedDate": "2020-02-07T09:11:59Z", "type": "commit"}, {"oid": "7f0920c76b37a7c43efc741985ca3991a9d27c75", "url": "https://github.com/apache/ignite/commit/7f0920c76b37a7c43efc741985ca3991a9d27c75", "message": "IGNITE-12597 : Redeem IgniteMXBean", "committedDate": "2020-02-07T12:49:53Z", "type": "commit"}, {"oid": "64a1f84c7f6620aa86dc8802a0c44aa221ec9bb7", "url": "https://github.com/apache/ignite/commit/64a1f84c7f6620aa86dc8802a0c44aa221ec9bb7", "message": "IGNITE-12597 : code style", "committedDate": "2020-02-07T13:24:47Z", "type": "commit"}, {"oid": "ea322f78f09783e0f2e392b4b6852e3c013b2e44", "url": "https://github.com/apache/ignite/commit/ea322f78f09783e0f2e392b4b6852e3c013b2e44", "message": "IGNITE-12597 : fix force-change-state.", "committedDate": "2020-02-07T14:42:56Z", "type": "commit"}, {"oid": "f06d4dd6a101c7e2458be4e13fd752c4026d601a", "url": "https://github.com/apache/ignite/commit/f06d4dd6a101c7e2458be4e13fd752c4026d601a", "message": "IGNITE-12597 : fix.", "committedDate": "2020-02-07T15:36:47Z", "type": "commit"}, {"oid": "46635a33332b34411dab27f91d61fa24fdd516e2", "url": "https://github.com/apache/ignite/commit/46635a33332b34411dab27f91d61fa24fdd516e2", "message": "IGNITE-12597 : spell fix.", "committedDate": "2020-02-07T15:42:40Z", "type": "commit"}, {"oid": "7ff1a3b9097cdabd87acd859b9998a70487f31d1", "url": "https://github.com/apache/ignite/commit/7ff1a3b9097cdabd87acd859b9998a70487f31d1", "message": "IGNITE-12597 : removed exception throwing for the internal calls satbility.", "committedDate": "2020-02-10T10:43:49Z", "type": "commit"}, {"oid": "7b2512a369005a919e2d3152067e571addf38d3d", "url": "https://github.com/apache/ignite/commit/7b2512a369005a919e2d3152067e571addf38d3d", "message": "IGNITE-12646 : checking of deactivation returned", "committedDate": "2020-02-10T14:56:29Z", "type": "commit"}, {"oid": "7ab38188998371f0bbdd2306fd855b2eb70b4533", "url": "https://github.com/apache/ignite/commit/7ab38188998371f0bbdd2306fd855b2eb70b4533", "message": "IGNITE-12646 : Suggestion of fixing mbean interface IgniteMXBean.", "committedDate": "2020-02-11T09:46:30Z", "type": "commit"}, {"oid": "fbc2de5694540f26ba3c95a6912c6956417b43d2", "url": "https://github.com/apache/ignite/commit/fbc2de5694540f26ba3c95a6912c6956417b43d2", "message": "IGNITE-12646 : + some javadoc", "committedDate": "2020-02-11T11:13:34Z", "type": "commit"}, {"oid": "5eef09766ac96bddd5a0807715803e95314ae804", "url": "https://github.com/apache/ignite/commit/5eef09766ac96bddd5a0807715803e95314ae804", "message": "IGNITE-12646 : + enchanced javadoc", "committedDate": "2020-02-11T11:33:19Z", "type": "commit"}, {"oid": "508e35d4ea18203a050b61ecfe7f0c710992aa71", "url": "https://github.com/apache/ignite/commit/508e35d4ea18203a050b61ecfe7f0c710992aa71", "message": "IGNITE-12646 : changed IgniteCluster, Ignite, IgniteMXBean", "committedDate": "2020-02-12T15:17:00Z", "type": "commit"}, {"oid": "b12428fb1f6cad191c943be9b549bf27ed976c50", "url": "https://github.com/apache/ignite/commit/b12428fb1f6cad191c943be9b549bf27ed976c50", "message": "IGNITE-12646 : another exception", "committedDate": "2020-02-13T08:31:37Z", "type": "commit"}, {"oid": "4dea12dba9c4ebc3ae07d4ca64df0f9ac4112b8e", "url": "https://github.com/apache/ignite/commit/4dea12dba9c4ebc3ae07d4ca64df0f9ac4112b8e", "message": "IGNITE-12646 : fix of import", "committedDate": "2020-02-13T11:38:24Z", "type": "commit"}, {"oid": "5520fe83831fd3f769a16ff81c86179c9935966b", "url": "https://github.com/apache/ignite/commit/5520fe83831fd3f769a16ff81c86179c9935966b", "message": "IGNITE-12646 : first working version of\nnew IgniteCluster#state(ClusterState, boolean force)", "committedDate": "2020-02-13T17:39:39Z", "type": "commit"}, {"oid": "622a9b562e0d97a68d2918c476df4b73b767fc5f", "url": "https://github.com/apache/ignite/commit/622a9b562e0d97a68d2918c476df4b73b767fc5f", "message": "IGNITE-12614 : fixed REST, java tests.", "committedDate": "2020-02-14T13:13:28Z", "type": "commit"}, {"oid": "8c6f22684e37585d05137e94ab66a2740108cbde", "url": "https://github.com/apache/ignite/commit/8c6f22684e37585d05137e94ab66a2740108cbde", "message": "IGNITE-12701 : fix after review", "committedDate": "2020-02-19T23:37:13Z", "type": "commit"}, {"oid": "7ee19a544e4c460df6cdcde470cc6b4e07f417ca", "url": "https://github.com/apache/ignite/commit/7ee19a544e4c460df6cdcde470cc6b4e07f417ca", "message": "IGNITE-12701 : redeem.", "committedDate": "2020-02-20T09:30:43Z", "type": "commit"}, {"oid": "5dadef11b6f02780fc082be615cec380d0df8925", "url": "https://github.com/apache/ignite/commit/5dadef11b6f02780fc082be615cec380d0df8925", "message": "Merge branch 'master' into IGNITE-12701-2", "committedDate": "2020-02-20T09:33:01Z", "type": "commit"}, {"oid": "a7e940f185020babdba897e3771210562d1ecf5c", "url": "https://github.com/apache/ignite/commit/a7e940f185020babdba897e3771210562d1ecf5c", "message": "IGNITE-12701 : minor comment fit.", "committedDate": "2020-02-20T09:46:56Z", "type": "commit"}, {"oid": "6830ec85b22c91592b2eaa642833f719c278de27", "url": "https://github.com/apache/ignite/commit/6830ec85b22c91592b2eaa642833f719c278de27", "message": "IGNITE-12701 : minor fix.", "committedDate": "2020-02-20T10:33:49Z", "type": "commit"}, {"oid": "bf9ddc254d1d56d9bc5c34d9e00644d8eeaa1410", "url": "https://github.com/apache/ignite/commit/bf9ddc254d1d56d9bc5c34d9e00644d8eeaa1410", "message": "IGNITE-12701 : review fixes.", "committedDate": "2020-02-20T10:42:38Z", "type": "commit"}, {"oid": "29f0e626d0b4162d6b4c243a9a7a2f137a14ddb8", "url": "https://github.com/apache/ignite/commit/29f0e626d0b4162d6b4c243a9a7a2f137a14ddb8", "message": "IGNITE-12701 : back to checking of state change through the discovery.", "committedDate": "2020-02-20T12:22:53Z", "type": "commit"}, {"oid": "11ae88b8ff8a22383110f43666422a2cb1a06aa4", "url": "https://github.com/apache/ignite/commit/11ae88b8ff8a22383110f43666422a2cb1a06aa4", "message": "IGNITE-12701 : critical fix.", "committedDate": "2020-02-20T12:38:29Z", "type": "commit"}, {"oid": "8f9bf803fc7de508f17b1eadac964bd153a9093a", "url": "https://github.com/apache/ignite/commit/8f9bf803fc7de508f17b1eadac964bd153a9093a", "message": "IGNITE-12701 : codestyle fix.", "committedDate": "2020-02-20T12:54:58Z", "type": "commit"}, {"oid": "b547ea67e8ef48da70f1cad291c0339708f0eabc", "url": "https://github.com/apache/ignite/commit/b547ea67e8ef48da70f1cad291c0339708f0eabc", "message": "IGNITE-12701 : removed API change.", "committedDate": "2020-02-20T14:30:57Z", "type": "commit"}, {"oid": "01e7437bb98b55b2daba43afb05259351d32eaad", "url": "https://github.com/apache/ignite/commit/01e7437bb98b55b2daba43afb05259351d32eaad", "message": "IGNITE-12701 : minority.", "committedDate": "2020-02-20T14:31:43Z", "type": "commit"}, {"oid": "01c33150f2c404e7b4353e3040aa9d2e50796042", "url": "https://github.com/apache/ignite/commit/01c33150f2c404e7b4353e3040aa9d2e50796042", "message": "IGNITE-12701 : minority review fix.", "committedDate": "2020-02-21T13:28:00Z", "type": "commit"}, {"oid": "348a6572d948ae102111a3d28d32ac9dd82621d2", "url": "https://github.com/apache/ignite/commit/348a6572d948ae102111a3d28d32ac9dd82621d2", "message": "IGNITE-12701 : last review.", "committedDate": "2020-02-21T17:05:23Z", "type": "commit"}, {"oid": "d545decebb4f91790810f1909693c48c6fbdd43c", "url": "https://github.com/apache/ignite/commit/d545decebb4f91790810f1909693c48c6fbdd43c", "message": "Merge branch 'master' into IGNITE-12701-3", "committedDate": "2020-02-25T09:37:02Z", "type": "commit"}, {"oid": "856c9fffc159b866903b72c1304bc4fb87474573", "url": "https://github.com/apache/ignite/commit/856c9fffc159b866903b72c1304bc4fb87474573", "message": "IGNITE-12701 : fix resetting params in the commands.", "committedDate": "2020-02-25T14:33:30Z", "type": "commit"}, {"oid": "d613f41a3cdd4c0ed9ef1588199d9076ab91e8e9", "url": "https://github.com/apache/ignite/commit/d613f41a3cdd4c0ed9ef1588199d9076ab91e8e9", "message": "Merge branch 'master' into IGNITE-12701-3", "committedDate": "2020-02-26T08:23:20Z", "type": "commit"}, {"oid": "d2e4c94275b8b7d0f9ea8569bf85a11886918df8", "url": "https://github.com/apache/ignite/commit/d2e4c94275b8b7d0f9ea8569bf85a11886918df8", "message": "IGNITE-12701 : attempt to fix nodeJS thin client test", "committedDate": "2020-02-26T09:06:20Z", "type": "commit"}, {"oid": "7d9c80e75fd4936d45feda368d7c086791a796e4", "url": "https://github.com/apache/ignite/commit/7d9c80e75fd4936d45feda368d7c086791a796e4", "message": "IGNITE-12701 : minority.", "committedDate": "2020-02-26T10:09:26Z", "type": "commit"}, {"oid": "9721954fda2a965463aa58118c6278047f28617e", "url": "https://github.com/apache/ignite/commit/9721954fda2a965463aa58118c6278047f28617e", "message": "IGNITE-12701 : critical fix : checking the feature before deactivation.", "committedDate": "2020-02-27T11:20:00Z", "type": "commit"}, {"oid": "74c887f21b4d6a0d35cb10421a23a5ed2ad0b139", "url": "https://github.com/apache/ignite/commit/74c887f21b4d6a0d35cb10421a23a5ed2ad0b139", "message": "IGNITE-12701 : fixes after review.", "committedDate": "2020-03-02T15:34:35Z", "type": "commit"}, {"oid": "4c71889614811ad7fda17e2455ad41129224dd6b", "url": "https://github.com/apache/ignite/commit/4c71889614811ad7fda17e2455ad41129224dd6b", "message": "IGNITE-12701 : fixes after review.", "committedDate": "2020-03-02T15:43:31Z", "type": "commit"}, {"oid": "e4bef99689e162ca5c12963176495fc0993f5777", "url": "https://github.com/apache/ignite/commit/e4bef99689e162ca5c12963176495fc0993f5777", "message": "IGNITE-12701 : fixes after review 2.", "committedDate": "2020-03-02T16:16:58Z", "type": "commit"}, {"oid": "dead070be2947865ce134cfaecc26193fd0d7d8a", "url": "https://github.com/apache/ignite/commit/dead070be2947865ce134cfaecc26193fd0d7d8a", "message": "IGNITE-12701 : fixes after review 3.", "committedDate": "2020-03-02T17:27:24Z", "type": "commit"}, {"oid": "af9505557b23cc45691da2dcb16b28ef0ab0d550", "url": "https://github.com/apache/ignite/commit/af9505557b23cc45691da2dcb16b28ef0ab0d550", "message": "Minor javadoc update.", "committedDate": "2020-03-04T07:51:38Z", "type": "commit"}, {"oid": "5b916b4f57e9798714c7f045e89af5a6dd1ec0f2", "url": "https://github.com/apache/ignite/commit/5b916b4f57e9798714c7f045e89af5a6dd1ec0f2", "message": "Update GridClientClusterState.java", "committedDate": "2020-03-04T07:52:06Z", "type": "commit"}, {"oid": "4cfa09cb64b4432b29ed82f1362fc22169ef15b1", "url": "https://github.com/apache/ignite/commit/4cfa09cb64b4432b29ed82f1362fc22169ef15b1", "message": "Update GridClientClusterState.java", "committedDate": "2020-03-04T07:52:35Z", "type": "commit"}, {"oid": "71eaa948138f9862b5f66d164462eb81d67ba3b3", "url": "https://github.com/apache/ignite/commit/71eaa948138f9862b5f66d164462eb81d67ba3b3", "message": "Update IgniteCluster.java", "committedDate": "2020-03-04T07:54:04Z", "type": "commit"}, {"oid": "fe02d6fd61593375085ae1b2d1f812127cef3569", "url": "https://github.com/apache/ignite/commit/fe02d6fd61593375085ae1b2d1f812127cef3569", "message": "Update GridClientConnection.java", "committedDate": "2020-03-04T07:55:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTE2Mg==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387499162", "bodyText": "Do we need this line? Default force value is false already.", "author": "nizhikov", "createdAt": "2020-03-04T07:58:26Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java", "diffHunk": "@@ -91,6 +98,18 @@\n         catch (IllegalArgumentException e) {\n             throw new IllegalArgumentException(\"Can't parse new cluster state. State: \" + s, e);\n         }\n+\n+        force = false;", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NzExNw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387547117", "bodyText": "Do we need this line? Default force value is false already.\n\nYes, we need this. Commands are statefull unfortunately. Without this, next command usage will go with previous value 'force' param.", "author": "Vladsz83", "createdAt": "2020-03-04T09:37:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTE2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java b/modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java\nindex b0c9f03778..b8196bca6d 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/commandline/ClusterStateChangeCommand.java\n\n@@ -99,13 +99,13 @@ public class ClusterStateChangeCommand implements Command<ClusterState> {\n             throw new IllegalArgumentException(\"Can't parse new cluster state. State: \" + s, e);\n         }\n \n-        force = false;\n+        forceDeactivation = false;\n \n         if (argIter.hasNextArg()) {\n             String arg = argIter.peekNextArg();\n \n             if (FORCE_COMMAND.equalsIgnoreCase(arg)) {\n-                force = true;\n+                forceDeactivation = true;\n \n                 argIter.nextArg(\"\");\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTM3Nw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387499377", "bodyText": "Do we need this line? Default force value is false already.", "author": "nizhikov", "createdAt": "2020-03-04T07:58:58Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java", "diffHunk": "@@ -78,6 +81,21 @@\n         return null;\n     }\n \n+    /** {@inheritDoc} */\n+    @Override public void parseArguments(CommandArgIterator argIter) {\n+        force = false;", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0NzI2Ng==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387547266", "bodyText": "Do we need this line? Default force value is false already.\n\nYes, we need this. Commands are statefull unfortunately. Without this, next command usage will go with previous value 'force' param.", "author": "Vladsz83", "createdAt": "2020-03-04T09:37:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5OTM3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java b/modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java\nindex 5f7a9a7a6f..aac6581708 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/commandline/DeactivateCommand.java\n\n@@ -83,13 +83,13 @@ public class DeactivateCommand implements Command<Void> {\n \n     /** {@inheritDoc} */\n     @Override public void parseArguments(CommandArgIterator argIter) {\n-        force = false;\n+        forceDeactivation = false;\n \n         if (argIter.hasNextArg()) {\n             String arg = argIter.peekNextArg();\n \n             if (FORCE_COMMAND.equalsIgnoreCase(arg)) {\n-                force = true;\n+                forceDeactivation = true;\n \n                 argIter.nextArg(\"\");\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387506990", "bodyText": "Why the default value is true?", "author": "nizhikov", "createdAt": "2020-03-04T08:18:10Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java", "diffHunk": "@@ -71,6 +71,9 @@\n     @GridToStringExclude\n     @Nullable private transient ServiceDeploymentActions serviceDeploymentActions;\n \n+    /** Forced change of cluster state. */\n+    private boolean force = true;", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU0ODc4Nw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387548787", "bodyText": "Why the default value is true?\n\nFor backward compatibility and due to general idea. Within this ticket we prevent unsafe deactivation only where required. Most of the deactivation requests are still forced. Like through Ignite, IgniteMXBean, IgniteCluster etc. Also there is usage of this message from another places:\nGridClusterStateProcessor#autoAdjustExchangeActions(), GridClusterStateProcessor#autoAdjustInMemoryClusterState()", "author": "Vladsz83", "createdAt": "2020-03-04T09:39:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1MjcwMQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387552701", "bodyText": "I think we should make force == false by default and explicitly pass true when required.", "author": "nizhikov", "createdAt": "2020-03-04T09:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjk5MA=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java\nindex bdf1e7a37a..c61cd98693 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/ChangeGlobalStateMessage.java\n\n@@ -71,8 +71,8 @@ public class ChangeGlobalStateMessage implements DiscoveryCustomMessage {\n     @GridToStringExclude\n     @Nullable private transient ServiceDeploymentActions serviceDeploymentActions;\n \n-    /** Forced change of cluster state. */\n-    private boolean force = true;\n+    /** Forced deactivation. */\n+    private boolean forceDeactivation = true;\n \n     /**\n      * @param reqId State change request ID.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzUyNA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387507524", "bodyText": "Why this deletion?", "author": "nizhikov", "createdAt": "2020-03-04T08:19:22Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MzIxNw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387563217", "bodyText": "Why this deletion?\n\nTo simplify and reduce internal API and code base. There were already 2 changeGlobalState(). First, I introduced new one with \u2018force\u2019 not to change previous API. There 3 methods (2 of them deprecated) became a mesh. After all, as it is internal API, I suggest to keep one change-state method. Isn\u2019t it better?", "author": "Vladsz83", "createdAt": "2020-03-04T10:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzUyNA=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\nindex f1de611755..2f345f06c8 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n\n@@ -946,7 +944,7 @@ public class GridClusterStateProcessor extends GridProcessorAdapter implements I\n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n         ClusterState state,\n-        boolean force,\n+        boolean forceDeactivation,\n         Collection<? extends BaselineNode> baselineNodes,\n         boolean forceChangeBaselineTopology,\n         boolean isAutoAdjust\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzgxMQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387507811", "bodyText": "Why this deletion?", "author": "nizhikov", "createdAt": "2020-03-04T08:20:00Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2MzgwNQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387563805", "bodyText": "Why this deletion?\n\nSame as above (\"To simplify and reduce internal API and code base...\")", "author": "Vladsz83", "createdAt": "2020-03-04T10:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNzgxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\nindex 3262310bfd..7ae1bb9f5f 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\n\n@@ -110,7 +110,7 @@ public interface IGridClusterStateProcessor extends GridProcessor {\n \n     /**\n      * @param state New cluster state.\n-     * @param force If {@code True} skips checking of the operation safety.\n+     * @param forceDeactivation If {@code True}, skips checking of the deactivation safety.\n      * @param baselineNodes New baseline nodes.\n      * @param forceChangeBaselineTopology Force change baseline topology.\n      * @param isAutoAdjust Auto adjusting flag.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTE0MQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509141", "bodyText": "We should rename this flag to forceDeactivation because it value apply to the deactivation command only.", "author": "nizhikov", "createdAt": "2020-03-04T08:22:55Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.processors.rest.client.message;\n+\n+import java.io.IOException;\n+import java.io.ObjectInput;\n+import java.io.ObjectOutput;\n+import org.apache.ignite.cluster.ClusterState;\n+\n+/**\n+ * Enchanced version of {@link GridClientClusterStateRequest}.\n+ * Introduced to support forced version of the change state command and keep backward compatibility\n+ * with nodes of old version that may occur in cluster at the rolling updates.\n+ */\n+public class GridClientClusterStateRequestV2 extends GridClientClusterStateRequest {\n+    /** */\n+    private static final long serialVersionUID = 0L;\n+\n+    /** Forced change of cluster state. */\n+    private boolean force;", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NDY3Ng==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387564676", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTE0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java\nindex 551ee3c3b9..119c00f234 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequestV2.java\n\n@@ -31,8 +31,8 @@ public class GridClientClusterStateRequestV2 extends GridClientClusterStateReque\n     /** */\n     private static final long serialVersionUID = 0L;\n \n-    /** Forced change of cluster state. */\n-    private boolean force;\n+    /** If {@code True}, cluster deactivation will be forced. */\n+    private boolean forceDeactivation;\n \n     /**\n      * @param state New cluster state.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTU0Nw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509547", "bodyText": "We should rename this flag to forceDeactivation because it value applies to the deactivation command only.", "author": "nizhikov", "createdAt": "2020-03-04T08:23:42Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java", "diffHunk": "@@ -108,30 +108,20 @@ boolean onStateChangeMessage(AffinityTopologyVersion topVer,\n     /** */\n     void cacheProcessorStarted();\n \n-    /**\n-     * @param activate New cluster state.\n-     * @param baselineNodes New baseline nodes.\n-     * @param forceChangeBaselineTopology Force change baseline topology.\n-     * @return State change future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean)} instead.\n-     */\n-    @Deprecated\n-    IgniteInternalFuture<?> changeGlobalState(\n-        boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    );\n-\n     /**\n      * @param state New cluster state.\n+     * @param force If {@code True} skips checking of the operation safety.", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjEzNA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566134", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:10:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTU0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\nindex 3262310bfd..7ae1bb9f5f 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/IGridClusterStateProcessor.java\n\n@@ -110,7 +110,7 @@ public interface IGridClusterStateProcessor extends GridProcessor {\n \n     /**\n      * @param state New cluster state.\n-     * @param force If {@code True} skips checking of the operation safety.\n+     * @param forceDeactivation If {@code True}, skips checking of the deactivation safety.\n      * @param baselineNodes New baseline nodes.\n      * @param forceChangeBaselineTopology Force change baseline topology.\n      * @param isAutoAdjust Auto adjusting flag.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTc2NA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509764", "bodyText": "We should rename this flag to forceDeactivation because its value applies to the deactivation command only.", "author": "nizhikov", "createdAt": "2020-03-04T08:24:06Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1045,6 +1025,7 @@ else if (ClusterState.active(state)) {\n     /** */\n     private IgniteInternalFuture<?> changeGlobalState0(\n         ClusterState state,\n+        boolean force,", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjE5NA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566194", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\nindex f1de611755..2f345f06c8 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n\n@@ -1025,7 +1023,7 @@ public class GridClusterStateProcessor extends GridProcessorAdapter implements I\n     /** */\n     private IgniteInternalFuture<?> changeGlobalState0(\n         ClusterState state,\n-        boolean force,\n+        boolean forceDeactivation,\n         BaselineTopology blt,\n         boolean forceChangeBaselineTopology,\n         boolean isAutoAdjust\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTkwMw==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387509903", "bodyText": "We should rename this flag to forceDeactivation because its value applies to the deactivation command only.", "author": "nizhikov", "createdAt": "2020-03-04T08:24:26Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -924,49 +945,8 @@ protected IgniteCheckedException concurrentStateChangeError(ClusterState state,\n \n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(activate, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /** {@inheritDoc} */\n-    @Override public IgniteInternalFuture<?> changeGlobalState(\n-        ClusterState state,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology\n-    ) {\n-        return changeGlobalState(state, baselineNodes, forceChangeBaselineTopology, false);\n-    }\n-\n-    /**\n-     * @param activate New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     * @deprecated Use {@link #changeGlobalState(ClusterState, Collection, boolean, boolean)} instead.\n-     */\n-    @Deprecated\n-    public IgniteInternalFuture<?> changeGlobalState(\n-        final boolean activate,\n-        Collection<? extends BaselineNode> baselineNodes,\n-        boolean forceChangeBaselineTopology,\n-        boolean isAutoAdjust\n-    ) {\n-        return changeGlobalState(activate ? ACTIVE : INACTIVE, baselineNodes, forceChangeBaselineTopology, isAutoAdjust);\n-    }\n-\n-    /**\n-     * @param state New activate state.\n-     * @param baselineNodes New BLT nodes.\n-     * @param forceChangeBaselineTopology Force change BLT.\n-     * @param isAutoAdjust Auto adjusting flag.\n-     * @return Global change state future.\n-     */\n-    public IgniteInternalFuture<?> changeGlobalState(\n         ClusterState state,\n+        boolean force,", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2NjI5OA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387566298", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwOTkwMw=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\nindex f1de611755..2f345f06c8 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n\n@@ -946,7 +944,7 @@ public class GridClusterStateProcessor extends GridProcessorAdapter implements I\n     /** {@inheritDoc} */\n     @Override public IgniteInternalFuture<?> changeGlobalState(\n         ClusterState state,\n-        boolean force,\n+        boolean forceDeactivation,\n         Collection<? extends BaselineNode> baselineNodes,\n         boolean forceChangeBaselineTopology,\n         boolean isAutoAdjust\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNTMyNQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387515325", "bodyText": "We should change \"can\" to \"will\" because there is no case when in-memory data will not be lost after deactivation.\nSo correct message to the user\n`Deactivation stopped. Cluster has in-memory caches(without persistence). During deactivation, in-memory data will be lost.'", "author": "nizhikov", "createdAt": "2020-03-04T08:36:11Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -115,6 +118,11 @@\n     /** */\n     private static final String METASTORE_CURR_BLT_KEY = \"metastoreBltKey\";\n \n+    /** Warning of unsafe deactivation. */\n+    public static final String DATA_LOST_ON_DEACTIVATION_WARNING =\n+        \"Cluster has caches configured without persistence. \" +\n+            \"During deactivation in-memory data and objects can be lost!\";", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2ODEyMA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387568120", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:13:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNTMyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\nindex f1de611755..2f345f06c8 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java\n\n@@ -119,9 +119,8 @@ public class GridClusterStateProcessor extends GridProcessorAdapter implements I\n     private static final String METASTORE_CURR_BLT_KEY = \"metastoreBltKey\";\n \n     /** Warning of unsafe deactivation. */\n-    public static final String DATA_LOST_ON_DEACTIVATION_WARNING =\n-        \"Cluster has caches configured without persistence. \" +\n-            \"During deactivation in-memory data and objects can be lost!\";\n+    public static final String DATA_LOST_ON_DEACTIVATION_WARNING = \"Deactivation stopped. Cluster has in-memory caches \" +\n+        \"(without persistence). During deactivation, in-memory data will be lost!\";\n \n     /** */\n     private boolean inMemoryMode;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzAzMQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387517031", "bodyText": "typo: externalization", "author": "nizhikov", "createdAt": "2020-03-04T08:39:45Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java", "diffHunk": "@@ -69,6 +70,21 @@ public static GridClientClusterStateRequest state(ClusterState state) {\n         return msg;\n     }\n \n+    /** Default constructor for the exernalization. */", "originalCommit": "fe02d6fd61593375085ae1b2d1f812127cef3569", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU2ODQ1MA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r387568450", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-04T10:14:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxNzAzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f273dd65e980a7361507f37f0114b781733aea72", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java\nindex 84442a85f6..8f5993c04a 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/rest/client/message/GridClientClusterStateRequest.java\n\n@@ -70,7 +70,7 @@ public class GridClientClusterStateRequest extends GridClientAbstractMessage {\n         return msg;\n     }\n \n-    /** Default constructor for the exernalization. */\n+    /** Default constructor for the externalization. */\n     public GridClientClusterStateRequest() {\n         // No op.\n     }\n"}}, {"oid": "f273dd65e980a7361507f37f0114b781733aea72", "url": "https://github.com/apache/ignite/commit/f273dd65e980a7361507f37f0114b781733aea72", "message": "IGNITE-12701 : fixes after review 4.", "committedDate": "2020-03-04T11:24:28Z", "type": "commit"}, {"oid": "ef2ab3b1da544a493620869ea06ecf833a51a621", "url": "https://github.com/apache/ignite/commit/ef2ab3b1da544a493620869ea06ecf833a51a621", "message": "IGNITE-12701 : fixes after review 5", "committedDate": "2020-03-04T12:52:00Z", "type": "commit"}, {"oid": "ef2ab3b1da544a493620869ea06ecf833a51a621", "url": "https://github.com/apache/ignite/commit/ef2ab3b1da544a493620869ea06ecf833a51a621", "message": "IGNITE-12701 : fixes after review 5", "committedDate": "2020-03-04T12:52:00Z", "type": "forcePushed"}, {"oid": "ec3d67a59ea1c7ccca87c8d3acf0dcd81dedd0e6", "url": "https://github.com/apache/ignite/commit/ec3d67a59ea1c7ccca87c8d3acf0dcd81dedd0e6", "message": "IGNITE-12701 : ChangeGlobalStateMessage is now forced by default.", "committedDate": "2020-03-04T13:07:50Z", "type": "commit"}, {"oid": "d982a8b30e15ddc6bab172755ed5dbcdc41390ec", "url": "https://github.com/apache/ignite/commit/d982a8b30e15ddc6bab172755ed5dbcdc41390ec", "message": "IGNITE-12701 : minor change of an error message.", "committedDate": "2020-03-04T13:13:27Z", "type": "commit"}, {"oid": "e476bd012d9e5707c71ebfe60164e5ce7d344a8f", "url": "https://github.com/apache/ignite/commit/e476bd012d9e5707c71ebfe60164e5ce7d344a8f", "message": "IGNITE-12701 : fixed after prereview 6", "committedDate": "2020-03-04T13:46:45Z", "type": "commit"}, {"oid": "280e9a73fc19891795f9755a303f05af468ed099", "url": "https://github.com/apache/ignite/commit/280e9a73fc19891795f9755a303f05af468ed099", "message": "IGNITE-12701 : reverted change global state methods.", "committedDate": "2020-03-04T14:25:26Z", "type": "commit"}, {"oid": "63bd6a937c39d1f92411d8b31ed30867bc23d97e", "url": "https://github.com/apache/ignite/commit/63bd6a937c39d1f92411d8b31ed30867bc23d97e", "message": "IGNITE-12701 : reverted proj settings.", "committedDate": "2020-03-04T14:26:58Z", "type": "commit"}, {"oid": "2f751f5b69925796caa9fec0f96bd7c7c2b4ec1d", "url": "https://github.com/apache/ignite/commit/2f751f5b69925796caa9fec0f96bd7c7c2b4ec1d", "message": "IGNITE-12701 : reverted proj settings.", "committedDate": "2020-03-04T14:36:14Z", "type": "commit"}, {"oid": "1de9983fc466a695860055809490e46bac2b56e9", "url": "https://github.com/apache/ignite/commit/1de9983fc466a695860055809490e46bac2b56e9", "message": "IGNITE-12701 : Fix of comments, spelling, @code True->true / false / null.", "committedDate": "2020-03-04T15:00:41Z", "type": "commit"}, {"oid": "51671d4fe79779327a944111cce5981d22f60d8e", "url": "https://github.com/apache/ignite/commit/51671d4fe79779327a944111cce5981d22f60d8e", "message": "IGNITE-12701 : Fix of comments, spelling, @code True->true / false / null 2.", "committedDate": "2020-03-04T15:17:15Z", "type": "commit"}, {"oid": "285fc7e0f84d3ef7da7b9ae2c825e664bfbdb5c2", "url": "https://github.com/apache/ignite/commit/285fc7e0f84d3ef7da7b9ae2c825e664bfbdb5c2", "message": "IGNITE-12701 : aalse -> false", "committedDate": "2020-03-04T15:20:48Z", "type": "commit"}, {"oid": "ae802fc8c0920363d3d7562e39915ac675cd024c", "url": "https://github.com/apache/ignite/commit/ae802fc8c0920363d3d7562e39915ac675cd024c", "message": "IGNITE-12701 : better 'fails if' description.", "committedDate": "2020-03-04T15:49:43Z", "type": "commit"}, {"oid": "9ff6109a5641fc8f089e0197a77c6b6e77b7e5fc", "url": "https://github.com/apache/ignite/commit/9ff6109a5641fc8f089e0197a77c6b6e77b7e5fc", "message": "IGNITE-12701 : better 'fails if' description 2.", "committedDate": "2020-03-04T16:02:27Z", "type": "commit"}, {"oid": "d15d5db4abb0ce4ca65c155bd6a98b5732d63128", "url": "https://github.com/apache/ignite/commit/d15d5db4abb0ce4ca65c155bd6a98b5732d63128", "message": "IGNITE-12701 : breakline.", "committedDate": "2020-03-04T16:04:34Z", "type": "commit"}, {"oid": "9fc2258e53541a04cd8915a78166ef7376211a80", "url": "https://github.com/apache/ignite/commit/9fc2258e53541a04cd8915a78166ef7376211a80", "message": "IGNITE-12701 : better see.", "committedDate": "2020-03-04T16:05:48Z", "type": "commit"}, {"oid": "95d82effba125e738e8f9e2b9ae5504c1cdbd744", "url": "https://github.com/apache/ignite/commit/95d82effba125e738e8f9e2b9ae5504c1cdbd744", "message": "IGNITE-12701 : better see.", "committedDate": "2020-03-04T16:06:13Z", "type": "commit"}, {"oid": "415fe1ccee9fdc914a12d14d03e6e4a4975cf257", "url": "https://github.com/apache/ignite/commit/415fe1ccee9fdc914a12d14d03e6e4a4975cf257", "message": "IGNITE-12701 : minorities.", "committedDate": "2020-03-04T16:25:44Z", "type": "commit"}, {"oid": "e06295902b987a8d9768133114bf5f9bd573903a", "url": "https://github.com/apache/ignite/commit/e06295902b987a8d9768133114bf5f9bd573903a", "message": "IGNITE-12701 : fixed notes of data loss.", "committedDate": "2020-03-06T11:56:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzNzY4OQ==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r389037689", "bodyText": "It's not clear why we force deactivation here.", "author": "nizhikov", "createdAt": "2020-03-06T17:23:48Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cluster/GridClusterStateProcessor.java", "diffHunk": "@@ -1617,6 +1643,7 @@ public ExchangeActions autoAdjustExchangeActions(ExchangeActions exchActs) {\n                 ctx.localNodeId(),\n                 null,\n                 ClusterState.active(clusterState.state()) ? clusterState.state() : ACTIVE,\n+                true,", "originalCommit": "e06295902b987a8d9768133114bf5f9bd573903a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTg3ODU5OA==", "url": "https://github.com/apache/ignite/pull/7471#discussion_r389878598", "bodyText": "It's not clear why we force deactivation here.\n\nAll previous internal changes of cluster state were forced. Thus, all current internal changes of cluster are considered forced. Only the exceptions are the user commands being translated to not-forced internal calls without flag \u2018force\u2019 passed.", "author": "Vladsz83", "createdAt": "2020-03-09T18:25:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAzNzY4OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "bdcb9977e46baeb2dab610bca250625eceff3f2f", "url": "https://github.com/apache/ignite/commit/bdcb9977e46baeb2dab610bca250625eceff3f2f", "message": "IGNITE-12703 : fixes after review.", "committedDate": "2020-03-09T21:06:29Z", "type": "commit"}, {"oid": "d47374b62f6e35cec7c9fc7cb46dc0b69e72f07b", "url": "https://github.com/apache/ignite/commit/d47374b62f6e35cec7c9fc7cb46dc0b69e72f07b", "message": "IGNITE-12703: Same comments.", "committedDate": "2020-03-09T21:39:11Z", "type": "commit"}, {"oid": "9d8061248b4bc6d3309767c11549a832d3e540f5", "url": "https://github.com/apache/ignite/commit/9d8061248b4bc6d3309767c11549a832d3e540f5", "message": "IGNITE-12703 + comments", "committedDate": "2020-03-10T09:12:55Z", "type": "commit"}, {"oid": "27f77f17443c3f6d29af2f233a656a4303e17285", "url": "https://github.com/apache/ignite/commit/27f77f17443c3f6d29af2f233a656a4303e17285", "message": "IGNITE-12703 : renaming, refactoring.", "committedDate": "2020-03-11T09:49:10Z", "type": "commit"}, {"oid": "6aad2027d7478087f6ba82dff82524cac875cc41", "url": "https://github.com/apache/ignite/commit/6aad2027d7478087f6ba82dff82524cac875cc41", "message": "IGNITE-12703 : reverted minority.", "committedDate": "2020-03-11T09:58:30Z", "type": "commit"}, {"oid": "b07817dcf4946145b7e174ef24f6503857287ded", "url": "https://github.com/apache/ignite/commit/b07817dcf4946145b7e174ef24f6503857287ded", "message": "IGNITE-12703 : major fix.", "committedDate": "2020-03-11T12:57:54Z", "type": "commit"}, {"oid": "c9078caca771bbcf2a5989f6d1e8261f0c8d4858", "url": "https://github.com/apache/ignite/commit/c9078caca771bbcf2a5989f6d1e8261f0c8d4858", "message": "IGNITE-12703 : + comment.", "committedDate": "2020-03-11T12:59:15Z", "type": "commit"}, {"oid": "8eea0b3ebd57a597487a993f9534ec983b2b3fc6", "url": "https://github.com/apache/ignite/commit/8eea0b3ebd57a597487a993f9534ec983b2b3fc6", "message": "IGNITE-12703 : + breakline.", "committedDate": "2020-03-11T13:01:56Z", "type": "commit"}, {"oid": "861b5ec3e53463241ab38c2afc83dd87f24f4789", "url": "https://github.com/apache/ignite/commit/861b5ec3e53463241ab38c2afc83dd87f24f4789", "message": "IGNITE-12703 : removed testInternalForcedDeactivation()", "committedDate": "2020-03-11T15:48:12Z", "type": "commit"}]}