{"pr_number": 7434, "pr_title": "IGNITE-7276 .NET: Enable/disable cache statistics in runtime", "pr_createdAt": "2020-02-15T20:25:43Z", "pr_url": "https://github.com/apache/ignite/pull/7434", "timeline": [{"oid": "f99fba6d7ba60c6298f3232926d3ade2c6856548", "url": "https://github.com/apache/ignite/commit/f99fba6d7ba60c6298f3232926d3ade2c6856548", "message": "IGNITE-7276 - ICache.EnableStatistics started", "committedDate": "2020-01-26T19:30:35Z", "type": "commit"}, {"oid": "9d822d53141319f111622fc990c761e6b7f11d88", "url": "https://github.com/apache/ignite/commit/9d822d53141319f111622fc990c761e6b7f11d88", "message": "Merge branch 'master' into IGNITE-7276-enable-cluster-stats\n\n# Conflicts:\n#\tmodules/platforms/dotnet/Apache.Ignite.Core/Impl/Cache/CacheOp.cs", "committedDate": "2020-02-06T22:23:54Z", "type": "commit"}, {"oid": "ba93a4f92e4f551b59aa44504023edb76abbff21", "url": "https://github.com/apache/ignite/commit/ba93a4f92e4f551b59aa44504023edb76abbff21", "message": "IGNITE-7276 - cache enable stats.", "committedDate": "2020-02-08T14:06:27Z", "type": "commit"}, {"oid": "08bee16128509fdb30cc4420e1c7890a689129d2", "url": "https://github.com/apache/ignite/commit/08bee16128509fdb30cc4420e1c7890a689129d2", "message": "IGNITE-7276 - cache enable stats.", "committedDate": "2020-02-15T20:06:43Z", "type": "commit"}, {"oid": "b7536bf2acd575cb55b679d70ef0848f93151746", "url": "https://github.com/apache/ignite/commit/b7536bf2acd575cb55b679d70ef0848f93151746", "message": "IGNITE-7276 - cache enable stats.", "committedDate": "2020-02-16T00:28:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMDEyNA==", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380320124", "bodyText": "val == FALSE ? false : true -> val == TRUE ?", "author": "ptupitsyn", "createdAt": "2020-02-17T18:20:49Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java", "diffHunk": "@@ -1174,6 +1177,11 @@ private void loadCache0(BinaryRawReaderEx reader, boolean loc) {\n             case OP_PRELOAD_PARTITION:\n                 cache.preloadPartition((int)val);\n \n+                return TRUE;\n+\n+            case OP_ENABLE_STATISTICS:\n+                cache.enableStatistics(val == FALSE ? false : true);", "originalCommit": "b7536bf2acd575cb55b679d70ef0848f93151746", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca457183c45a09d26030a165ea1ad30a7a220d46", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java\nindex 1d14013b9b..ca4eb15ca6 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cache/PlatformCache.java\n\n@@ -1180,7 +1180,7 @@ public class PlatformCache extends PlatformAbstractTarget {\n                 return TRUE;\n \n             case OP_ENABLE_STATISTICS:\n-                cache.enableStatistics(val == FALSE ? false : true);\n+                cache.enableStatistics(val == TRUE);\n \n                 return TRUE;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMyMTM0NA==", "url": "https://github.com/apache/ignite/pull/7434#discussion_r380321344", "bodyText": "Please use public API when possible: platformCtx.kernalContext().grid().cluster().enableStatistics(cacheNames, enabled)\nThere is a difference in exception handling and GridKernalGateway.readLock call.", "author": "ptupitsyn", "createdAt": "2020-02-17T18:24:39Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java", "diffHunk": "@@ -356,6 +359,22 @@ public PlatformClusterGroup(PlatformContext platformCtx, ClusterGroupEx prj) {\n                 return TRUE;\n             }\n \n+            case OP_ENABLE_STATISTICS: {\n+                boolean enabled = reader.readBoolean();\n+\n+                int cnt = reader.readInt();\n+\n+                Collection<String> cacheNames = new ArrayList<>(cnt);\n+\n+                for (int i = 0; i < cnt; i++) {\n+                    cacheNames.add(reader.readString());\n+                }\n+\n+                platformCtx.kernalContext().cache().enableStatistics(cacheNames, enabled);", "originalCommit": "b7536bf2acd575cb55b679d70ef0848f93151746", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "91931feb785e3deac64f282120c89d42e5cc92f0", "chunk": "diff --git a/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java b/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java\nindex 60f10a39bf..0fec6841cf 100644\n--- a/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java\n+++ b/modules/core/src/main/java/org/apache/ignite/internal/processors/platform/cluster/PlatformClusterGroup.java\n\n@@ -370,7 +370,7 @@ public class PlatformClusterGroup extends PlatformAbstractTarget {\n                     cacheNames.add(reader.readString());\n                 }\n \n-                platformCtx.kernalContext().cache().enableStatistics(cacheNames, enabled);\n+                platformCtx.kernalContext().grid().cluster().enableStatistics(cacheNames, enabled);\n \n                 return TRUE;\n             }\n"}}, {"oid": "91931feb785e3deac64f282120c89d42e5cc92f0", "url": "https://github.com/apache/ignite/commit/91931feb785e3deac64f282120c89d42e5cc92f0", "message": "IGNITE-7276 - switch to public API", "committedDate": "2020-02-17T18:37:59Z", "type": "commit"}, {"oid": "ca457183c45a09d26030a165ea1ad30a7a220d46", "url": "https://github.com/apache/ignite/commit/ca457183c45a09d26030a165ea1ad30a7a220d46", "message": "IGNITE-7276 - clean up", "committedDate": "2020-02-17T18:46:32Z", "type": "commit"}, {"oid": "1d5bbf6f648b76e3f7b81e92f5edf8b05e3080cf", "url": "https://github.com/apache/ignite/commit/1d5bbf6f648b76e3f7b81e92f5edf8b05e3080cf", "message": "IGNITE-7276 - fixes after review.", "committedDate": "2020-02-17T19:11:42Z", "type": "commit"}, {"oid": "b9e40ea47966c6162cc351eda3058a20e851a197", "url": "https://github.com/apache/ignite/commit/b9e40ea47966c6162cc351eda3058a20e851a197", "message": "IGNITE-7276 - extra tests", "committedDate": "2020-02-19T07:18:06Z", "type": "commit"}, {"oid": "953eca5a6f38eb43650e9d66f5c6185c76d5624c", "url": "https://github.com/apache/ignite/commit/953eca5a6f38eb43650e9d66f5c6185c76d5624c", "message": "IGNITE-7276 - refactor tests", "committedDate": "2020-02-22T20:30:57Z", "type": "commit"}]}