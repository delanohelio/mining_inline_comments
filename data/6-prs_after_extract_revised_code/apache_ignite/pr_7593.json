{"pr_number": 7593, "pr_title": "IGNITE-12790 introduce distributed SQL configuration and ability to disable SQL functions ", "pr_createdAt": "2020-03-31T15:01:55Z", "pr_url": "https://github.com/apache/ignite/pull/7593", "timeline": [{"oid": "3259d07659d33b88aa0594af0469a076fd9c2942", "url": "https://github.com/apache/ignite/commit/3259d07659d33b88aa0594af0469a076fd9c2942", "message": "IGNITE-12790 introduce distributed SQL configuration and disable insecure SQL functions", "committedDate": "2020-03-31T15:01:16Z", "type": "commit"}, {"oid": "011d441ab7780aa0eb9c054d1ed55a19713e97ba", "url": "https://github.com/apache/ignite/commit/011d441ab7780aa0eb9c054d1ed55a19713e97ba", "message": "Merge branch 'apache-master' into ignite-12790\n\n# Conflicts:\n#\tmodules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/IgniteH2Indexing.java", "committedDate": "2020-04-03T08:54:51Z", "type": "commit"}, {"oid": "7776ed5a286589424e32de14ab9a080bd612cbad", "url": "https://github.com/apache/ignite/commit/7776ed5a286589424e32de14ab9a080bd612cbad", "message": "IGNITE-12790 fix typo", "committedDate": "2020-04-03T08:55:41Z", "type": "commit"}, {"oid": "c6b030388f414c44644f6465c663f71566bea201", "url": "https://github.com/apache/ignite/commit/c6b030388f414c44644f6465c663f71566bea201", "message": "Merge branch 'apache-master' into ignite-12790", "committedDate": "2020-04-03T08:57:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU5OTI3Mg==", "url": "https://github.com/apache/ignite/pull/7593#discussion_r404599272", "bodyText": "Javadoc", "author": "AMashenkov", "createdAt": "2020-04-07T07:38:02Z", "path": "modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/FunctionsManager.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.processors.query.h2;\n+\n+import java.lang.reflect.Field;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Objects;\n+import java.util.Set;\n+import org.h2.expression.Function;\n+\n+/**\n+ * SQL function manager.\n+ */\n+@SuppressWarnings(\"unchecked\")\n+public class FunctionsManager {\n+    /** Original H2 functions set. */\n+    private static HashMap<String, Object> origFuncs;\n+\n+    /** Current H2 functions set. */\n+    private static HashMap<String, Object> funcs;\n+\n+    static {\n+        try {\n+            Field fldFUNCTIONS = Function.class.getDeclaredField(\"FUNCTIONS\");\n+\n+            fldFUNCTIONS.setAccessible(true);\n+\n+            funcs = (HashMap<String, Object>)fldFUNCTIONS.get(Class.class);\n+\n+            origFuncs = new HashMap<>(funcs);\n+        }\n+        catch (NoSuchFieldException | IllegalAccessException e) {\n+            e.printStackTrace();\n+        }\n+    }\n+\n+    /**\n+     *\n+     */\n+    public FunctionsManager(DistributedSqlConfiguration distSqlCfg) {\n+        assert Objects.nonNull(funcs);\n+        assert Objects.nonNull(origFuncs);\n+        distSqlCfg.listenDisabledFunctions(this::updateDisabledFunctions);\n+    }\n+\n+    /**\n+     *\n+     */\n+    private void updateDisabledFunctions(String s, HashSet<String> oldFuncs, HashSet<String> newFuncs) {", "originalCommit": "c6b030388f414c44644f6465c663f71566bea201", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4a57e84639ff82490b3fde57784173c160a50cd1", "chunk": "diff --git a/modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/FunctionsManager.java b/modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/FunctionsManager.java\nindex 9be9b38538..fae51039cc 100644\n--- a/modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/FunctionsManager.java\n+++ b/modules/indexing/src/main/java/org/apache/ignite/internal/processors/query/h2/FunctionsManager.java\n\n@@ -36,6 +36,7 @@ public class FunctionsManager {\n     private static HashMap<String, Object> funcs;\n \n     static {\n+        // Extract from H2 the set of available functions.\n         try {\n             Field fldFUNCTIONS = Function.class.getDeclaredField(\"FUNCTIONS\");\n \n"}}, {"oid": "4a57e84639ff82490b3fde57784173c160a50cd1", "url": "https://github.com/apache/ignite/commit/4a57e84639ff82490b3fde57784173c160a50cd1", "message": "IGNITE-12790 javadoc", "committedDate": "2020-04-07T08:10:15Z", "type": "commit"}, {"oid": "39d85136dadcc9b6b69da359896ef2e0896a1d0e", "url": "https://github.com/apache/ignite/commit/39d85136dadcc9b6b69da359896ef2e0896a1d0e", "message": "Merge branch 'apache-master' into ignite-12790", "committedDate": "2020-04-07T08:23:20Z", "type": "commit"}, {"oid": "17337dbd235b47de4e04dce8f87c191030343118", "url": "https://github.com/apache/ignite/commit/17337dbd235b47de4e04dce8f87c191030343118", "message": "IGNITE-12790: fix case when metastorage is not available", "committedDate": "2020-04-14T14:54:23Z", "type": "commit"}, {"oid": "a82b7863adaa79a4f04fabf45ca5f576ec750018", "url": "https://github.com/apache/ignite/commit/a82b7863adaa79a4f04fabf45ca5f576ec750018", "message": "Merge branch 'apache-master' into ignite-12790", "committedDate": "2020-04-14T14:54:46Z", "type": "commit"}, {"oid": "f0cb2ffbbc936edbb4620d279a9854682edaedfb", "url": "https://github.com/apache/ignite/commit/f0cb2ffbbc936edbb4620d279a9854682edaedfb", "message": "IGNITE-12790: fix compilation", "committedDate": "2020-04-15T10:15:18Z", "type": "commit"}, {"oid": "9e33d3fe0c668624185cfcdf71bccf9279952a56", "url": "https://github.com/apache/ignite/commit/9e33d3fe0c668624185cfcdf71bccf9279952a56", "message": "IGNITE-12790: fix imports", "committedDate": "2020-04-15T10:45:52Z", "type": "commit"}, {"oid": "8dc684ad1c0d48e2eca55de9b7e853823dd7f48e", "url": "https://github.com/apache/ignite/commit/8dc684ad1c0d48e2eca55de9b7e853823dd7f48e", "message": "Merge branch 'apache-master' into ignite-12790", "committedDate": "2020-04-15T13:51:36Z", "type": "commit"}, {"oid": "2db7cd7fa3a82d5601c4bf02422b835a93f70a8c", "url": "https://github.com/apache/ignite/commit/2db7cd7fa3a82d5601c4bf02422b835a93f70a8c", "message": "IGNITE-12790: fix ML test", "committedDate": "2020-04-15T15:18:25Z", "type": "commit"}, {"oid": "efd1ea919e961ff9157176521c46886998ba15ed", "url": "https://github.com/apache/ignite/commit/efd1ea919e961ff9157176521c46886998ba15ed", "message": "IGNITE-12790: fix comment", "committedDate": "2020-04-15T15:28:14Z", "type": "commit"}, {"oid": "f670e07c3f887c8605b92376f37c2d30361685dc", "url": "https://github.com/apache/ignite/commit/f670e07c3f887c8605b92376f37c2d30361685dc", "message": "IGNITE-12790: fix ML test", "committedDate": "2020-04-15T17:54:39Z", "type": "commit"}, {"oid": "77cbbecb71683f0f40033a06e63dc1620b6345cb", "url": "https://github.com/apache/ignite/commit/77cbbecb71683f0f40033a06e63dc1620b6345cb", "message": "IGNITE-12790: fix ML test", "committedDate": "2020-04-15T19:40:07Z", "type": "commit"}, {"oid": "62cb2f952107d3172fdca8e034ec8938ff129a11", "url": "https://github.com/apache/ignite/commit/62cb2f952107d3172fdca8e034ec8938ff129a11", "message": "IGNITE-12790: add TODO", "committedDate": "2020-04-16T08:15:30Z", "type": "commit"}]}