{"pr_number": 8984, "pr_title": "Enabling custom URL for APIM Publisher", "pr_createdAt": "2020-07-15T13:03:12Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8984", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4NTQ3Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8984#discussion_r458585477", "bodyText": "Better not to catch ClassCastException. Ideally, you should check the instance type and continue.", "author": "ruks", "createdAt": "2020-07-22T07:19:47Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -10557,6 +10557,69 @@ public static Map getTenantBasedStoreDomainMapping(String tenantDomain) throws A\n         return null;\n     }\n \n+    public static Map getTenantBasedPublisherDomainMapping(String tenantDomain) throws APIManagementException {\n+\n+        try {\n+            Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n+                    getGovernanceSystemRegistry();\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(APIConstants.API_DOMAIN_MAPPING_TENANT_ID_IDENTIFIER, tenantDomain);\n+            if (registry.resourceExists(resourcePath)) {\n+                Resource resource = registry.get(resourcePath);\n+                String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n+                JSONParser parser = new JSONParser();\n+                JSONObject mappings = (JSONObject) parser.parse(content);\n+                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_PUBLISHER)) {\n+                    return (Map) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_PUBLISHER);\n+                }\n+            }\n+        } catch (RegistryException e) {\n+            String msg = \"Error while retrieving publisher domain mappings from registry\";\n+            throw new APIManagementException(msg, e);\n+        } catch (ClassCastException e) {", "originalCommit": "245720d90aaae7b3e5d3f6a2b5ff5371d7b98b9e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5f711741d2e3a555ec96c725a24db78d28533f61", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\nindex db32012a028..04aa5451e24 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\n@@ -10562,14 +10715,14 @@ public final class APIUtil {\n         try {\n             Registry registry = ServiceReferenceHolder.getInstance().getRegistryService().\n                     getGovernanceSystemRegistry();\n-            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(APIConstants.API_DOMAIN_MAPPING_TENANT_ID_IDENTIFIER, tenantDomain);\n+            String resourcePath = APIConstants.API_DOMAIN_MAPPINGS.replace(\"<tenant-id>\", tenantDomain);\n             if (registry.resourceExists(resourcePath)) {\n                 Resource resource = registry.get(resourcePath);\n                 String content = new String((byte[]) resource.getContent(), Charset.defaultCharset());\n                 JSONParser parser = new JSONParser();\n                 JSONObject mappings = (JSONObject) parser.parse(content);\n-                if (mappings.containsKey(APIConstants.API_DOMAIN_MAPPINGS_PUBLISHER)) {\n-                    return (Map) mappings.get(APIConstants.API_DOMAIN_MAPPINGS_PUBLISHER);\n+                if (mappings.containsKey(APIConstants.API_PUBLISHER)) {\n+                    return (Map) mappings.get(APIConstants.API_PUBLISHER);\n                 }\n             }\n         } catch (RegistryException e) {\n"}}, {"oid": "5f711741d2e3a555ec96c725a24db78d28533f61", "url": "https://github.com/wso2/carbon-apimgt/commit/5f711741d2e3a555ec96c725a24db78d28533f61", "message": "APIUtil implementation for Publisher Custom URl", "committedDate": "2020-07-22T09:50:52Z", "type": "commit"}, {"oid": "1c4855c6aca049dec1f2c1772ae954c710c2cb8f", "url": "https://github.com/wso2/carbon-apimgt/commit/1c4855c6aca049dec1f2c1772ae954c710c2cb8f", "message": "Publisher custom url jaggery changes", "committedDate": "2020-07-22T09:50:52Z", "type": "commit"}, {"oid": "469259fd743af41bf0fb4f7f3aaab35ae035a093", "url": "https://github.com/wso2/carbon-apimgt/commit/469259fd743af41bf0fb4f7f3aaab35ae035a093", "message": "Publisher custom url jaggery changes", "committedDate": "2020-07-22T09:50:52Z", "type": "commit"}, {"oid": "aebea8c1cba81bb8b649e266aef8c4f3f441ac9d", "url": "https://github.com/wso2/carbon-apimgt/commit/aebea8c1cba81bb8b649e266aef8c4f3f441ac9d", "message": "Fixing review comments", "committedDate": "2020-07-22T09:50:53Z", "type": "commit"}, {"oid": "b012dcd48f9ee083067cffcd38390049127b5f10", "url": "https://github.com/wso2/carbon-apimgt/commit/b012dcd48f9ee083067cffcd38390049127b5f10", "message": "Fixing publisher custom url mapping", "committedDate": "2020-07-22T09:50:53Z", "type": "commit"}, {"oid": "d4b625fbc36f5a8d6896d40490e4a8822fd707c0", "url": "https://github.com/wso2/carbon-apimgt/commit/d4b625fbc36f5a8d6896d40490e4a8822fd707c0", "message": "Fix formatting issues in cherry-picked commits", "committedDate": "2020-07-22T09:50:53Z", "type": "commit"}, {"oid": "d4b625fbc36f5a8d6896d40490e4a8822fd707c0", "url": "https://github.com/wso2/carbon-apimgt/commit/d4b625fbc36f5a8d6896d40490e4a8822fd707c0", "message": "Fix formatting issues in cherry-picked commits", "committedDate": "2020-07-22T09:50:53Z", "type": "forcePushed"}, {"oid": "4508d94313e2a62e9bcbf832a060624a7fac357d", "url": "https://github.com/wso2/carbon-apimgt/commit/4508d94313e2a62e9bcbf832a060624a7fac357d", "message": "Remove duplicate code segments in cherry-picked code", "committedDate": "2020-07-22T11:05:56Z", "type": "commit"}]}