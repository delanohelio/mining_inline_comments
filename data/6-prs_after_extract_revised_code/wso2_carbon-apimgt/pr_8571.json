{"pr_number": 8571, "pr_title": "Add version support to endpoint registry", "pr_createdAt": "2020-05-25T13:06:40Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8571", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyOTY3NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r429929675", "bodyText": "When creating new version, don't we need to check whether the {name, version} combination already exists.", "author": "vithu30", "createdAt": "2020-05-25T13:16:54Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java", "diffHunk": "@@ -234,4 +236,23 @@ public void updateEndpointRegistry(String registryId, String registryName, Endpo\n \n     }\n \n+    /**\n+     * Creates a new version of an Endpoint Registry Entry\n+     *\n+     * @param entryId       Registry Entry Identifier(UUID)\n+     * @param registryEntry EndpointRegistryEntry\n+     * @param version       New version of the Registry Entry\n+     * @return entryID UUID of the created Registry Entry\n+     * @throws APIManagementException if failed to delete the Endpoint Registry Entry\n+     */\n+    public String createNewEntryVersion(String entryId, EndpointRegistryEntry registryEntry, String version)\n+            throws APIManagementException {\n+        registryEntry.setVersion(version);\n+        if (apiMgtDAO.isRegistryEntryNameExists(registryEntry)) {", "originalCommit": "5c5da1a068df22ed505777e3e9d879a7b4d6e5e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzMDUxNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r429930515", "bodyText": "isRegistryEntryNameExists method is now altered to do that. Shall we rename this method then to isRegistryEntryNameVersionExists ?", "author": "ChamodDamitha", "createdAt": "2020-05-25T13:18:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyOTY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzMzQxMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r429933410", "bodyText": "Ah right that does not work. we need two methods. Otherwise addRegistryEntry resource can be used to create versions too. Will fix that", "author": "ChamodDamitha", "createdAt": "2020-05-25T13:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyOTY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzNjk4Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r429936982", "bodyText": "Fixed", "author": "ChamodDamitha", "createdAt": "2020-05-25T13:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyOTY3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "530060ddf14a9b8e7b5f09b3ee2180d02415ef4f", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\nindex cf512ba4de5..0604123d5be 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\n\n@@ -248,7 +248,7 @@ public class EndpointRegistryImpl implements EndpointRegistry {\n     public String createNewEntryVersion(String entryId, EndpointRegistryEntry registryEntry, String version)\n             throws APIManagementException {\n         registryEntry.setVersion(version);\n-        if (apiMgtDAO.isRegistryEntryNameExists(registryEntry)) {\n+        if (apiMgtDAO.isRegistryEntryNameAndVersionExists(registryEntry)) {\n             APIUtil.handleResourceAlreadyExistsException(\"Endpoint Registry Entry with name '\"\n                     + registryEntry.getName() + \"' and version '\" + registryEntry.getVersion() + \"' already exists\");\n         }\n"}}, {"oid": "530060ddf14a9b8e7b5f09b3ee2180d02415ef4f", "url": "https://github.com/wso2/carbon-apimgt/commit/530060ddf14a9b8e7b5f09b3ee2180d02415ef4f", "message": "Add version support to endpoint registry", "committedDate": "2020-05-25T13:32:07Z", "type": "forcePushed"}, {"oid": "0e46f2ff6d320fb6c266ccc4eac68b67d6433f0f", "url": "https://github.com/wso2/carbon-apimgt/commit/0e46f2ff6d320fb6c266ccc4eac68b67d6433f0f", "message": "Add version support to endpoint registry", "committedDate": "2020-05-25T20:26:14Z", "type": "forcePushed"}, {"oid": "cb1f2004cec529f69b27c2a9431038f92b2d1fe4", "url": "https://github.com/wso2/carbon-apimgt/commit/cb1f2004cec529f69b27c2a9431038f92b2d1fe4", "message": "Add version support to endpoint registry", "committedDate": "2020-05-26T06:56:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxODk4OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r430218988", "bodyText": "Seems the length exceeded. Shall we move it to new line?", "author": "vithu30", "createdAt": "2020-05-26T07:47:59Z", "path": "components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/EndpointRegistry.java", "diffHunk": "@@ -73,22 +73,25 @@ EndpointRegistryInfo getEndpointRegistryByUUID(String registryId, String tenantD\n     /**\n      * Returns all entries belong to a given endpoint registry\n      *\n-     * @param sortBy     Name of the sorting field\n-     * @param sortOrder  Order of sorting (asc or desc)\n-     * @param limit      Limit\n-     * @param offset     Offset\n-     * @param registryId UUID of the endpoint registry\n-     * @param serviceType The endpoint service type\n-     * @param definitionType Then endpoint definition type\n-     * @param entryName The registry entry name\n+     * @param sortBy          Name of the sorting field\n+     * @param sortOrder       Order of sorting (asc or desc)\n+     * @param limit           Limit\n+     * @param offset          Offset\n+     * @param registryId      UUID of the endpoint registry\n+     * @param serviceType     The endpoint service type\n+     * @param definitionType  Then endpoint definition type\n+     * @param entryName       The registry entry name\n      * @param serviceCategory The service category\n+     * @param version         The version of registry entry\n+     * @param exactNameMatch  Whether to perform exact search on name\n      * @return A list of EndpointRegistryEntry objects\n      * @throws APIManagementException if failed to get entries of an Endpoint Registry\n      */\n     List<EndpointRegistryEntry> getEndpointRegistryEntries(String sortBy, String sortOrder, int limit,\n                                                            int offset, String registryId, String serviceType,\n                                                            String definitionType, String entryName,\n-                                                           String serviceCategory) throws APIManagementException;\n+                                                           String serviceCategory, String version, boolean exactNameMatch)", "originalCommit": "5a72e7d62b3b36c7ec4b0297f8c0f9997b413d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3NjA3Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r430276072", "bodyText": "Fixed in 87488e4", "author": "ChamodDamitha", "createdAt": "2020-05-26T09:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxODk4OA=="}], "type": "inlineReview", "revised_code": {"commit": "87488e47290991acb8a72cc73514501903bdd81c", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/EndpointRegistry.java b/components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/EndpointRegistry.java\nindex 93b430618a8..2cbc8bb5468 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/EndpointRegistry.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.api/src/main/java/org/wso2/carbon/apimgt/api/EndpointRegistry.java\n\n@@ -90,8 +90,8 @@ public interface EndpointRegistry {\n     List<EndpointRegistryEntry> getEndpointRegistryEntries(String sortBy, String sortOrder, int limit,\n                                                            int offset, String registryId, String serviceType,\n                                                            String definitionType, String entryName,\n-                                                           String serviceCategory, String version, boolean exactNameMatch)\n-            throws APIManagementException;\n+                                                           String serviceCategory, String version,\n+                                                           boolean exactNameMatch) throws APIManagementException;\n \n     /**\n      * Returns details of a specific Endpoint Registry Entry\n"}}, {"oid": "21ce9862c39260ad9cbbb2db321ccea865c0a971", "url": "https://github.com/wso2/carbon-apimgt/commit/21ce9862c39260ad9cbbb2db321ccea865c0a971", "message": "Add version support to endpoint registry", "committedDate": "2020-05-26T07:54:12Z", "type": "commit"}, {"oid": "de354e7b31c9bc4637a80af5e551435f03047469", "url": "https://github.com/wso2/carbon-apimgt/commit/de354e7b31c9bc4637a80af5e551435f03047469", "message": "Add exact match for version when filtering endpoint registry entries", "committedDate": "2020-05-26T07:54:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIyMzYzMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r430223633", "bodyText": "Can't we set the version to EndpointRegistryEntry object  in API impl class?", "author": "vithu30", "createdAt": "2020-05-26T07:56:02Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java", "diffHunk": "@@ -234,4 +236,23 @@ public void updateEndpointRegistry(String registryId, String registryName, Endpo\n \n     }\n \n+    /**\n+     * Creates a new version of an Endpoint Registry Entry\n+     *\n+     * @param entryId       Registry Entry Identifier(UUID)\n+     * @param registryEntry EndpointRegistryEntry\n+     * @param version       New version of the Registry Entry\n+     * @return entryID UUID of the created Registry Entry\n+     * @throws APIManagementException if failed to delete the Endpoint Registry Entry\n+     */\n+    public String createNewEntryVersion(String entryId, EndpointRegistryEntry registryEntry, String version)\n+            throws APIManagementException {\n+        registryEntry.setVersion(version);", "originalCommit": "5a72e7d62b3b36c7ec4b0297f8c0f9997b413d6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3NTk4Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8571#discussion_r430275986", "bodyText": "Fixed in 87488e4", "author": "ChamodDamitha", "createdAt": "2020-05-26T09:24:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIyMzYzMw=="}], "type": "inlineReview", "revised_code": {"commit": "87488e47290991acb8a72cc73514501903bdd81c", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\nindex 4bf87b5a6f5..e77e0be5163 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/EndpointRegistryImpl.java\n\n@@ -241,13 +241,11 @@ public class EndpointRegistryImpl implements EndpointRegistry {\n      *\n      * @param entryId       Registry Entry Identifier(UUID)\n      * @param registryEntry EndpointRegistryEntry\n-     * @param version       New version of the Registry Entry\n      * @return entryID UUID of the created Registry Entry\n      * @throws APIManagementException if failed to delete the Endpoint Registry Entry\n      */\n-    public String createNewEntryVersion(String entryId, EndpointRegistryEntry registryEntry, String version)\n+    public String createNewEntryVersion(String entryId, EndpointRegistryEntry registryEntry)\n             throws APIManagementException {\n-        registryEntry.setVersion(version);\n         if (apiMgtDAO.isRegistryEntryNameAndVersionExists(registryEntry)) {\n             APIUtil.handleResourceAlreadyExistsException(\"Endpoint Registry Entry with name '\"\n                     + registryEntry.getName() + \"' and version '\" + registryEntry.getVersion() + \"' already exists\");\n"}}, {"oid": "f4133bfa366fd1bf7a6723ef14b0f4c118727299", "url": "https://github.com/wso2/carbon-apimgt/commit/f4133bfa366fd1bf7a6723ef14b0f4c118727299", "message": "Change Endpoint registry entry new-version resource name", "committedDate": "2020-05-26T07:56:15Z", "type": "commit"}, {"oid": "f4133bfa366fd1bf7a6723ef14b0f4c118727299", "url": "https://github.com/wso2/carbon-apimgt/commit/f4133bfa366fd1bf7a6723ef14b0f4c118727299", "message": "Change Endpoint registry entry new-version resource name", "committedDate": "2020-05-26T07:56:15Z", "type": "forcePushed"}, {"oid": "87488e47290991acb8a72cc73514501903bdd81c", "url": "https://github.com/wso2/carbon-apimgt/commit/87488e47290991acb8a72cc73514501903bdd81c", "message": "Fix review comments", "committedDate": "2020-05-26T09:23:42Z", "type": "commit"}]}