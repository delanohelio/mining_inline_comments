{"pr_number": 8300, "pr_title": "Modified response of OAS/Swagger validation in API creation", "pr_createdAt": "2020-03-03T12:06:16Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8300", "timeline": [{"oid": "56cc4dc03f7226eb5e6ffde69fc8257222b95cb7", "url": "https://github.com/wso2/carbon-apimgt/commit/56cc4dc03f7226eb5e6ffde69fc8257222b95cb7", "message": "modified response of OAS/Swagger validation in API creation. To Use OAS/Swagger Servers/Host parameter to populate endpoint URL", "committedDate": "2020-03-03T11:44:40Z", "type": "commit"}, {"oid": "f91d5423c33c3e178ad441582dd623039b6fed9a", "url": "https://github.com/wso2/carbon-apimgt/commit/f91d5423c33c3e178ad441582dd623039b6fed9a", "message": "modified response of OAS/Swagger validation in API creation. To Use OAS/Swagger Servers/Host parameter to populate endpoint URL", "committedDate": "2020-03-03T11:44:40Z", "type": "commit"}, {"oid": "ddb9971bebeb4d576e0d556d58707138875cd7b6", "url": "https://github.com/wso2/carbon-apimgt/commit/ddb9971bebeb4d576e0d556d58707138875cd7b6", "message": "modified response of OAS/Swagger validation in API creation. To Use OAS/Swagger Servers/Host parameter to populate endpoint URL", "committedDate": "2020-03-03T11:56:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU1NDgwMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8300#discussion_r387554801", "bodyText": "This may cause null pointer exception, ArrayIndexOutofBound exception if the servers are not defined.\nNeed to check whether the openAPI.getServers() method for null.", "author": "menakaj", "createdAt": "2020-03-04T09:50:15Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java", "diffHunk": "@@ -506,7 +507,8 @@ public APIDefinitionValidationResponse validateAPIDefinition(String apiDefinitio\n             OpenAPI openAPI = parseAttemptForV3.getOpenAPI();\n             io.swagger.v3.oas.models.info.Info info = openAPI.getInfo();\n             OASParserUtil.updateValidationResponseAsSuccess(validationResponse, apiDefinition, openAPI.getOpenapi(),\n-                    info.getTitle(), info.getVersion(), null, info.getDescription());\n+                    info.getTitle(), info.getVersion(), null, info.getDescription(),\n+                    openAPI.getServers().get(0).getUrl());", "originalCommit": "ddb9971bebeb4d576e0d556d58707138875cd7b6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "41ae626b1d124549970b73844c4cf03699c98c62", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\nindex 7611c39d0a3..2352bc6d4b0 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\n\n@@ -508,7 +508,7 @@ public class OAS3Parser extends APIDefinition {\n             io.swagger.v3.oas.models.info.Info info = openAPI.getInfo();\n             OASParserUtil.updateValidationResponseAsSuccess(validationResponse, apiDefinition, openAPI.getOpenapi(),\n                     info.getTitle(), info.getVersion(), null, info.getDescription(),\n-                    openAPI.getServers().get(0).getUrl());\n+                    openAPI.getServers()==null ? null : openAPI.getServers().get(0).getUrl());\n             validationResponse.setParser(this);\n             if (returnJsonContent) {\n                 if (!apiDefinition.trim().startsWith(\"{\")) { // not a json (it is yaml)\n"}}, {"oid": "41ae626b1d124549970b73844c4cf03699c98c62", "url": "https://github.com/wso2/carbon-apimgt/commit/41ae626b1d124549970b73844c4cf03699c98c62", "message": "Added condition to avoid possible error scenario - ArrayIndexOutofBounds", "committedDate": "2020-03-04T10:00:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYyNjYzNA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8300#discussion_r387626634", "bodyText": "Shouldn't we check null and empty both? Below is also a valid one.\nservers:\n  []", "author": "malinthaprasan", "createdAt": "2020-03-04T12:12:02Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java", "diffHunk": "@@ -506,7 +507,8 @@ public APIDefinitionValidationResponse validateAPIDefinition(String apiDefinitio\n             OpenAPI openAPI = parseAttemptForV3.getOpenAPI();\n             io.swagger.v3.oas.models.info.Info info = openAPI.getInfo();\n             OASParserUtil.updateValidationResponseAsSuccess(validationResponse, apiDefinition, openAPI.getOpenapi(),\n-                    info.getTitle(), info.getVersion(), null, info.getDescription());\n+                    info.getTitle(), info.getVersion(), null, info.getDescription(),\n+                    openAPI.getServers()==null ? null : openAPI.getServers().get(0).getUrl());", "originalCommit": "41ae626b1d124549970b73844c4cf03699c98c62", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a86233e8f248ff4097675b3c73bc6c154fff9a13", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\nindex 2352bc6d4b0..79a4015a6f9 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/definitions/OAS3Parser.java\n\n@@ -508,7 +508,7 @@ public class OAS3Parser extends APIDefinition {\n             io.swagger.v3.oas.models.info.Info info = openAPI.getInfo();\n             OASParserUtil.updateValidationResponseAsSuccess(validationResponse, apiDefinition, openAPI.getOpenapi(),\n                     info.getTitle(), info.getVersion(), null, info.getDescription(),\n-                    openAPI.getServers()==null ? null : openAPI.getServers().get(0).getUrl());\n+                    (openAPI.getServers()==null || openAPI.getServers().isEmpty() ) ? null : openAPI.getServers().get(0).getUrl());\n             validationResponse.setParser(this);\n             if (returnJsonContent) {\n                 if (!apiDefinition.trim().startsWith(\"{\")) { // not a json (it is yaml)\n"}}, {"oid": "a86233e8f248ff4097675b3c73bc6c154fff9a13", "url": "https://github.com/wso2/carbon-apimgt/commit/a86233e8f248ff4097675b3c73bc6c154fff9a13", "message": "handled empty input array", "committedDate": "2020-03-05T04:55:47Z", "type": "commit"}, {"oid": "1817a801e03cfb84af9c5dcf4833b2d66c48ff93", "url": "https://github.com/wso2/carbon-apimgt/commit/1817a801e03cfb84af9c5dcf4833b2d66c48ff93", "message": "added multiple servers to the response", "committedDate": "2020-03-06T11:41:10Z", "type": "commit"}]}