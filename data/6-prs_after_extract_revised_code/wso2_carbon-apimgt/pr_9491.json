{"pr_number": 9491, "pr_title": "Adding changes related to API revision retrieval path", "pr_createdAt": "2020-12-11T05:33:54Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/9491", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcwMzA0MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/9491#discussion_r540703040", "bodyText": "Formatting issue", "author": "mushthaq33", "createdAt": "2020-12-11T05:37:16Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java", "diffHunk": "@@ -4311,6 +4336,11 @@ private APIDTO getAPIByID(String apiId) {\n             String tenantDomain = RestApiCommonUtil.getLoggedInUserTenantDomain();\n             APIProvider apiProvider = RestApiCommonUtil.getLoggedInUserProvider();\n             API api = apiProvider.getAPIbyUUID(apiId, tenantDomain);\n+            APIRevision apiRevision = ApiMgtDAO.getInstance().checkAPIUUIDIsARevisionUUID(apiId);\n+            if (apiRevision != null && !StringUtils.isEmpty(apiRevision.getApiUUID()) ){", "originalCommit": "3af61ab4b74fdde8f4457c035b4bfe2d157892bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcwOTY5MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/9491#discussion_r540709690", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-12-11T05:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDcwMzA0MA=="}], "type": "inlineReview", "revised_code": {"commit": "a25993bbbc6781dab65c567cab2dea5bc8aa181d", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java b/components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java\nindex a208e4b918d..09313bb8c08 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.rest.api.publisher.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/publisher/v1/impl/ApisApiServiceImpl.java\n\n@@ -4337,7 +4337,7 @@ public class ApisApiServiceImpl implements ApisApiService {\n             APIProvider apiProvider = RestApiCommonUtil.getLoggedInUserProvider();\n             API api = apiProvider.getAPIbyUUID(apiId, tenantDomain);\n             APIRevision apiRevision = ApiMgtDAO.getInstance().checkAPIUUIDIsARevisionUUID(apiId);\n-            if (apiRevision != null && !StringUtils.isEmpty(apiRevision.getApiUUID()) ){\n+            if (apiRevision != null && !StringUtils.isEmpty(apiRevision.getApiUUID())) {\n                 api.setRevision(true);\n                 api.setRevisionedApiId(apiRevision.getApiUUID());\n             }\n"}}, {"oid": "a25993bbbc6781dab65c567cab2dea5bc8aa181d", "url": "https://github.com/wso2/carbon-apimgt/commit/a25993bbbc6781dab65c567cab2dea5bc8aa181d", "message": "adding changes to API revision retrieval path", "committedDate": "2020-12-11T05:56:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA3MzE1Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/9491#discussion_r542073157", "bodyText": "need to have space before \"in\"", "author": "chamilaadhi", "createdAt": "2020-12-14T02:38:46Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java", "diffHunk": "@@ -15700,4 +15704,29 @@ public APIRevision getRevisionByRevisionUUID(String revisionUUID) throws APIMana\n         }\n         return revisionList;\n     }\n+\n+    /**\n+     * Get a provided api uuid is in the revision db table\n+     *\n+     * @return String apiUUID\n+     * @throws APIManagementException if an error occurs while checking revision table\n+     */\n+    public APIRevision checkAPIUUIDIsARevisionUUID(String apiUUID) throws APIManagementException {\n+        APIRevision apiRevision = new APIRevision();\n+        try (Connection connection = APIMgtDBUtil.getConnection();\n+             PreparedStatement statement = connection\n+                     .prepareStatement(SQLConstants.APIRevisionSqlConstants.GET_REVISION_APIID_BY_REVISION_UUID)) {\n+            statement.setString(1, apiUUID);\n+            try (ResultSet rs = statement.executeQuery()) {\n+                while (rs.next()) {\n+                    apiRevision.setApiUUID(rs.getString(1));\n+                    apiRevision.setId(rs.getInt(2));\n+                    apiRevision.setRevisionUUID(apiUUID);\n+                }\n+            }\n+        } catch (SQLException e) {\n+            handleException(\"Failed to search UUID: \" + apiUUID + \"in the revision db table\", e);", "originalCommit": "a25993bbbc6781dab65c567cab2dea5bc8aa181d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEwMzQ2NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/9491#discussion_r542103464", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-12-14T04:26:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjA3MzE1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c5f0dce495bd0bd70b2868910c01b755d2ae428f", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java\nindex 601c8792d38..911cc7bcbf3 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/dao/ApiMgtDAO.java\n\n@@ -15725,7 +15725,7 @@ public class ApiMgtDAO {\n                 }\n             }\n         } catch (SQLException e) {\n-            handleException(\"Failed to search UUID: \" + apiUUID + \"in the revision db table\", e);\n+            handleException(\"Failed to search UUID: \" + apiUUID + \" in the revision db table\", e);\n         }\n         return apiRevision;\n     }\n"}}, {"oid": "c5f0dce495bd0bd70b2868910c01b755d2ae428f", "url": "https://github.com/wso2/carbon-apimgt/commit/c5f0dce495bd0bd70b2868910c01b755d2ae428f", "message": "adding changes to API revision retrieval path", "committedDate": "2020-12-14T04:25:11Z", "type": "commit"}, {"oid": "c5f0dce495bd0bd70b2868910c01b755d2ae428f", "url": "https://github.com/wso2/carbon-apimgt/commit/c5f0dce495bd0bd70b2868910c01b755d2ae428f", "message": "adding changes to API revision retrieval path", "committedDate": "2020-12-14T04:25:11Z", "type": "forcePushed"}]}