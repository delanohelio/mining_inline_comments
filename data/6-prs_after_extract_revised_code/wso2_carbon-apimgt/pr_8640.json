{"pr_number": 8640, "pr_title": "[Admin-REST API] API to get role-scope mapping.", "pr_createdAt": "2020-06-03T06:13:58Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8640", "timeline": [{"oid": "dcf7ef6fd8d9378b40c0d77aec4807ef7b993d38", "url": "https://github.com/wso2/carbon-apimgt/commit/dcf7ef6fd8d9378b40c0d77aec4807ef7b993d38", "message": "Added api to get role-scope mapping.", "committedDate": "2020-06-03T06:09:57Z", "type": "commit"}, {"oid": "ddfef475ff8177fa377f2d5edcc6e65f8294785f", "url": "https://github.com/wso2/carbon-apimgt/commit/ddfef475ff8177fa377f2d5edcc6e65f8294785f", "message": "Merge branch 'master' into admin-rest-api", "committedDate": "2020-06-03T06:17:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1MzU2NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449553564", "bodyText": "Shall we catch the specific Exception here?", "author": "vithu30", "createdAt": "2020-07-03T12:17:51Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/impl/SettingsApiServiceImpl.java", "diffHunk": "@@ -92,4 +93,23 @@ public Response settingsScopesScopeGet(String username, String scopeName, Messag\n         }\n         return Response.ok().entity(scopeSettingsDTO).build();\n     }\n+\n+    /**\n+     * Get all scopes and respective roles\n+     *\n+     * @return Role-Scope list\n+     */\n+    @Override\n+    public Response settingsScopesGet(MessageContext messageContext) {\n+        try {\n+            Map<String, String> roleScopeMapping = APIUtil.getRESTAPIScopesForTenant(MultitenantUtils\n+                    .getTenantDomain(RestApiUtil.getLoggedInUsername()));\n+            ScopeListDTO scopeListDTO = SettingsMappingUtil.fromScopeListToScopeListDTO(roleScopeMapping);\n+            return Response.ok().entity(scopeListDTO).build();\n+        } catch (Exception e) {", "originalCommit": "ddfef475ff8177fa377f2d5edcc6e65f8294785f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MTM5Nw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449991397", "bodyText": "PR has been reverted", "author": "Meruja", "createdAt": "2020-07-06T05:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1MzU2NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1NDEzNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449554137", "bodyText": "Shall we format this line?", "author": "vithu30", "createdAt": "2020-07-03T12:19:19Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.admin.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/admin/v1/utils/mappings/SettingsMappingUtil.java", "diffHunk": "@@ -136,4 +137,33 @@ private static SettingsKeyManagerConfigurationDTO fromKeyManagerConfigurationToS\n         }\n         return authorizedScopes;\n     }\n+\n+    /**\n+     * Convert list of API Scope to ScopeListDTO\n+     *\n+     * @param roleScopeMapping Map of a Role Scope  Mapping\n+     * @return ScopeListDTO list containing role scope mapping data\n+     */\n+    public static ScopeListDTO fromScopeListToScopeListDTO(Map<String, String>  roleScopeMapping) {\n+        ScopeListDTO scopeListDTO = new ScopeListDTO();\n+        scopeListDTO.setList(fromRoleScopeMapToRoleScopeDTOList(roleScopeMapping));\n+        return scopeListDTO;\n+    }\n+\n+    /**\n+     * Converts api role-scope mapping to RoleScopeDTO List.\n+     *\n+     * @param roleScopeMapping Map of a Role Scope  Mapping\n+     * @return RoleScopeDTO list\n+     */\n+    private static List<ScopeDTO>  fromRoleScopeMapToRoleScopeDTOList(Map<String, String>  roleScopeMapping) {\n+        List<ScopeDTO> scopeDTOs = new ArrayList<>(roleScopeMapping.size());\n+        for (Map.Entry<String, String>  mapping : roleScopeMapping.entrySet()) {\n+            ScopeDTO roleScopeDTO = new ScopeDTO();\n+                roleScopeDTO.setScope(mapping.getKey());", "originalCommit": "ddfef475ff8177fa377f2d5edcc6e65f8294785f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTk5MTQyMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8640#discussion_r449991423", "bodyText": "PR has been reverted", "author": "Meruja", "createdAt": "2020-07-06T05:31:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTU1NDEzNw=="}], "type": "inlineReview", "revised_code": null}]}