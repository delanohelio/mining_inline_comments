{"pr_number": 8555, "pr_title": "Adding Event Notifier base component", "pr_createdAt": "2020-05-22T09:23:53Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/8555", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0Njc4NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429646785", "bodyText": "These Events need to send after subscription approved", "author": "tharindu1st", "createdAt": "2020-05-24T15:15:19Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -3188,6 +3195,12 @@ public void removeSubscription(SubscribedAPI subscription) throws APIManagementE\n                         + \") removed from app \" + appName;\n                 log.debug(logMessage);\n             }\n+\n+            SubscriptionEvent subscriptionEvent = new SubscriptionEvent(UUID.randomUUID().toString(),", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MjEwOQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430192109", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:53:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0Njc4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5NjA3Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430196073", "bodyText": "still not fixed", "author": "tharindu1st", "createdAt": "2020-05-26T07:02:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0Njc4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "411130f4094660c4d5fda44edc0798b39bc8019e", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\nindex 0995418e0de..af9e8db6475 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n\n@@ -3196,11 +3389,24 @@ public class APIConsumerImpl extends AbstractAPIManager implements APIConsumer {\n                 log.debug(logMessage);\n             }\n \n-            SubscriptionEvent subscriptionEvent = new SubscriptionEvent(UUID.randomUUID().toString(),\n-                    System.currentTimeMillis(), APIConstants.EventType.SUBSCRIPTIONS_DELETE.name(), tenantId, subscription.getSubscriptionId(),\n-                    identifier.getUUID(),application.getId(), identifier.getTier(), subscription.getSubStatus());\n-            APIUtil.sendNotification(subscriptionEvent, APIConstants.NotifierType.SUBSCRIPTIONS.name());\n-\n+            // get the workflow state once the executor is executed.\n+            WorkflowDTO wfDTO = apiMgtDAO.retrieveWorkflowFromInternalReference(Integer.toString(application.getId()),\n+                    WorkflowConstants.WF_TYPE_AM_SUBSCRIPTION_DELETION);\n+            // only send the notification if approved\n+            // wfDTO is null when simple wf executor is used because wf state is not stored in the db and is always approved.\n+            if (wfDTO != null) {\n+                if (WorkflowStatus.APPROVED.equals(wfDTO.getStatus())) {\n+                    SubscriptionEvent subscriptionEvent = new SubscriptionEvent(UUID.randomUUID().toString(),\n+                            System.currentTimeMillis(), APIConstants.EventType.SUBSCRIPTIONS_DELETE.name(), tenantId, subscription.getSubscriptionId(),\n+                            identifier.getUUID(),application.getId(), identifier.getTier(), subscription.getSubStatus());\n+                    APIUtil.sendNotification(subscriptionEvent, APIConstants.NotifierType.SUBSCRIPTIONS.name());\n+                }\n+            } else {\n+                SubscriptionEvent subscriptionEvent = new SubscriptionEvent(UUID.randomUUID().toString(),\n+                        System.currentTimeMillis(), APIConstants.EventType.SUBSCRIPTIONS_DELETE.name(), tenantId, subscription.getSubscriptionId(),\n+                        identifier.getUUID(),application.getId(), identifier.getTier(), subscription.getSubStatus());\n+                APIUtil.sendNotification(subscriptionEvent, APIConstants.NotifierType.SUBSCRIPTIONS.name());\n+            }\n         } else {\n             throw new APIManagementException(\"Subscription for UUID:\" + uuid +\" does not exist.\");\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NjgzMA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429646830", "bodyText": "same goes here as well", "author": "tharindu1st", "createdAt": "2020-05-24T15:15:41Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -3408,6 +3421,12 @@ public int addApplication(Application application, String userId)\n             Thread recommendationThread = new Thread(extractor);\n             recommendationThread.start();\n         }\n+\n+        ApplicationEvent applicationEvent = new ApplicationEvent(UUID.randomUUID().toString(), System.currentTimeMillis()\n+                , APIConstants.EventType.APPLICATION_CREATE.name(), tenantId, applicationId, application.getName(), application.getTokenType(),\n+                application.getTier());", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MjE4Mw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430192183", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NjgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\nindex 0995418e0de..fa6d1f3d4ac 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n\n@@ -3421,12 +3582,13 @@ public class APIConsumerImpl extends AbstractAPIManager implements APIConsumer {\n             Thread recommendationThread = new Thread(extractor);\n             recommendationThread.start();\n         }\n-\n-        ApplicationEvent applicationEvent = new ApplicationEvent(UUID.randomUUID().toString(), System.currentTimeMillis()\n-                , APIConstants.EventType.APPLICATION_CREATE.name(), tenantId, applicationId, application.getName(), application.getTokenType(),\n-                application.getTier());\n-        APIUtil.sendNotification(applicationEvent, APIConstants.NotifierType.APPLICATION.name());\n-\n+        String status = apiMgtDAO.getApplicationStatusById(applicationId);\n+        if (WorkflowStatus.APPROVED.toString().equals(status)) {\n+            ApplicationEvent applicationEvent = new ApplicationEvent(UUID.randomUUID().toString(), System.currentTimeMillis()\n+                    , APIConstants.EventType.APPLICATION_CREATE.name(), tenantId, applicationId, application.getName(), application.getTokenType(),\n+                    application.getTier(), application.getGroupId());\n+            APIUtil.sendNotification(applicationEvent, APIConstants.NotifierType.APPLICATION.name());\n+        }\n         return applicationId;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4Mzc5OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429683799", "bodyText": "change * to exact class names", "author": "isharac", "createdAt": "2020-05-24T23:05:10Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -85,6 +85,7 @@\n import org.wso2.carbon.apimgt.impl.dto.TierPermissionDTO;\n import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n import org.wso2.carbon.apimgt.impl.factory.KeyManagerHolder;\n+import org.wso2.carbon.apimgt.impl.notifier.events.*;", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTk0NA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191944", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4Mzc5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\nindex 0995418e0de..fa6d1f3d4ac 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n\n@@ -85,7 +85,9 @@ import org.wso2.carbon.apimgt.impl.dto.SubscriptionWorkflowDTO;\n import org.wso2.carbon.apimgt.impl.dto.TierPermissionDTO;\n import org.wso2.carbon.apimgt.impl.dto.WorkflowDTO;\n import org.wso2.carbon.apimgt.impl.factory.KeyManagerHolder;\n-import org.wso2.carbon.apimgt.impl.notifier.events.*;\n+import org.wso2.carbon.apimgt.impl.notifier.events.ApplicationEvent;\n+import org.wso2.carbon.apimgt.impl.notifier.events.ApplicationRegistrationEvent;\n+import org.wso2.carbon.apimgt.impl.notifier.events.SubscriptionEvent;\n import org.wso2.carbon.apimgt.impl.internal.ServiceReferenceHolder;\n import org.wso2.carbon.apimgt.impl.monetization.DefaultMonetizationImpl;\n import org.wso2.carbon.apimgt.impl.recommendationmgt.RecommendationEnvironment;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTAxMQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429685011", "bodyText": "this event has to go to completeApplicationRegistration", "author": "isharac", "createdAt": "2020-05-24T23:20:17Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -3906,6 +3936,11 @@ else if (APIConstants.API_KEY_TYPE_SANDBOX.equals(tokenType)) { // if\n             APIUtil.logAuditMessage(APIConstants.AuditLogConstants.APPLICATION, appLogObject.toString(),\n                     APIConstants.AuditLogConstants.UPDATED, this.username);\n \n+            ApplicationRegistrationEvent applicationRegistrationEvent = new ApplicationRegistrationEvent(", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTc1OQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191759", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:52:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTAxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\nindex 0995418e0de..fa6d1f3d4ac 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n\n@@ -3940,7 +4099,6 @@ public class APIConsumerImpl extends AbstractAPIManager implements APIConsumer {\n                     UUID.randomUUID().toString(), System.currentTimeMillis(), APIConstants.EventType.APPLICATION_REGISTRATION_CREATE.name(),\n                     tenantId, application.getId(), applicationInfo.getClientId(), application.getTokenType());\n             APIUtil.sendNotification(applicationRegistrationEvent, APIConstants.NotifierType.APPLICATION_REGISTRATION.name());\n-\n             return keyDetails;\n         } catch (WorkflowException e) {\n             log.error(\"Could not execute Workflow\", e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTAyNw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429685027", "bodyText": "this as well", "author": "isharac", "createdAt": "2020-05-24T23:20:33Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java", "diffHunk": "@@ -4050,6 +4085,12 @@ else if (APIConstants.API_KEY_TYPE_SANDBOX.equals(tokenType)) {\n             appLogObject.put(\"Generated keys for application\", application.getName());\n             APIUtil.logAuditMessage(APIConstants.AuditLogConstants.APPLICATION, appLogObject.toString(),\n                     APIConstants.AuditLogConstants.UPDATED, this.username);\n+", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTg1OA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191858", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:52:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTAyNw=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\nindex 0995418e0de..fa6d1f3d4ac 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/APIConsumerImpl.java\n\n@@ -4085,12 +4243,10 @@ public class APIConsumerImpl extends AbstractAPIManager implements APIConsumer {\n             appLogObject.put(\"Generated keys for application\", application.getName());\n             APIUtil.logAuditMessage(APIConstants.AuditLogConstants.APPLICATION, appLogObject.toString(),\n                     APIConstants.AuditLogConstants.UPDATED, this.username);\n-\n             ApplicationRegistrationEvent applicationRegistrationEvent = new ApplicationRegistrationEvent(\n                     UUID.randomUUID().toString(), System.currentTimeMillis(), APIConstants.EventType.APPLICATION_REGISTRATION_CREATE.name(),\n                     tenantId, application.getId(), applicationInfo.getClientId(), application.getTokenType());\n             APIUtil.sendNotification(applicationRegistrationEvent, APIConstants.NotifierType.APPLICATION_REGISTRATION.name());\n-\n             return keyDetails;\n         } catch (WorkflowException e) {\n             log.error(\"Could not execute Workflow\", e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTI2Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429685262", "bodyText": "change to absolute imports", "author": "isharac", "createdAt": "2020-05-24T23:23:17Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java", "diffHunk": "@@ -49,6 +49,8 @@\n import org.wso2.carbon.apimgt.impl.factory.KeyManagerHolder;\n import org.wso2.carbon.apimgt.impl.factory.SQLConstantManagerFactory;\n import org.wso2.carbon.apimgt.impl.handlers.UserPostSelfRegistrationHandler;\n+import org.wso2.carbon.apimgt.impl.notifier.*;", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTU0Mg==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191542", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:51:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\nindex ffef48f4f9a..5f16cec0af3 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n\n@@ -49,8 +49,12 @@ import org.wso2.carbon.apimgt.impl.dto.ThrottleProperties;\n import org.wso2.carbon.apimgt.impl.factory.KeyManagerHolder;\n import org.wso2.carbon.apimgt.impl.factory.SQLConstantManagerFactory;\n import org.wso2.carbon.apimgt.impl.handlers.UserPostSelfRegistrationHandler;\n-import org.wso2.carbon.apimgt.impl.notifier.*;\n import org.wso2.carbon.apimgt.impl.notifier.Notifier;\n+import org.wso2.carbon.apimgt.impl.notifier.SubscriptionsNotifier;\n+import org.wso2.carbon.apimgt.impl.notifier.ApisNotifier;\n+import org.wso2.carbon.apimgt.impl.notifier.ApplicationNotifier;\n+import org.wso2.carbon.apimgt.impl.notifier.ApplicationRegistrationNotifier;\n+import org.wso2.carbon.apimgt.impl.notifier.PolicyNotifier;\n import org.wso2.carbon.apimgt.impl.observers.APIStatusObserverList;\n import org.wso2.carbon.apimgt.impl.observers.CommonConfigDeployer;\n import org.wso2.carbon.apimgt.impl.observers.KeyMgtConfigDeployer;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTQ5MQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429685491", "bodyText": "we can merge these two lines\nbundleContext.registerService(Notifier.class.getName(), new SubscriptionsNotifier(), null);", "author": "isharac", "createdAt": "2020-05-24T23:25:55Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java", "diffHunk": "@@ -169,6 +172,19 @@ protected void activate(ComponentContext componentContext) throws Exception {\n             bundleContext.registerService(Axis2ConfigurationContextObserver.class.getName(), tenantLoadMessageSender, null);\n             KeyMgtConfigDeployer keyMgtConfigDeployer = new KeyMgtConfigDeployer();\n             bundleContext.registerService(Axis2ConfigurationContextObserver.class.getName(), keyMgtConfigDeployer, null);\n+\n+            //Registering Notifiers\n+            Notifier subscriptionsNotifier = new SubscriptionsNotifier();", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTQ3MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191470", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTQ5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\nindex ffef48f4f9a..5f16cec0af3 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n\n@@ -174,16 +178,11 @@ public class APIManagerComponent {\n             bundleContext.registerService(Axis2ConfigurationContextObserver.class.getName(), keyMgtConfigDeployer, null);\n \n             //Registering Notifiers\n-            Notifier subscriptionsNotifier = new SubscriptionsNotifier();\n-            bundleContext.registerService(Notifier.class.getName(), subscriptionsNotifier, null);\n-            Notifier apisNotifier = new ApisNotifier();\n-            bundleContext.registerService(Notifier.class.getName(), apisNotifier, null);\n-            Notifier applicationNotifier = new ApplicationNotifier();\n-            bundleContext.registerService(Notifier.class.getName(), applicationNotifier, null);\n-            Notifier applicationRegistrationNotifier = new ApplicationRegistrationNotifier();\n-            bundleContext.registerService(Notifier.class.getName(), applicationRegistrationNotifier, null);\n-            Notifier policyNotifier = new PolicyNotifier();\n-            bundleContext.registerService(Notifier.class.getName(),policyNotifier, null);\n+            bundleContext.registerService(Notifier.class.getName(), new SubscriptionsNotifier(), null);\n+            bundleContext.registerService(Notifier.class.getName(), new ApisNotifier(), null);\n+            bundleContext.registerService(Notifier.class.getName(),  new ApplicationNotifier(), null);\n+            bundleContext.registerService(Notifier.class.getName(), new ApplicationRegistrationNotifier(), null);\n+            bundleContext.registerService(Notifier.class.getName(),new PolicyNotifier(), null);\n \n             APIManagerConfigurationServiceImpl configurationService = new APIManagerConfigurationServiceImpl(configuration);\n             ServiceReferenceHolder.getInstance().setAPIManagerConfigurationService(configurationService);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTkwOA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429685908", "bodyText": "shouldn't this be removeNotifiers?", "author": "isharac", "createdAt": "2020-05-24T23:30:55Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java", "diffHunk": "@@ -731,5 +747,25 @@ private void setupAccessTokenGenerator(){\n             ServiceReferenceHolder.getInstance().setAccessTokenGenerator(accessTokenGenerator);\n         }\n     }\n+\n+    @Reference(\n+            name = \"notifier.component\",\n+            service = Notifier.class,\n+            cardinality = ReferenceCardinality.MULTIPLE,\n+            policy = ReferencePolicy.DYNAMIC,\n+            unbind = \"removeNotifier\")", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTM3Ng==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191376", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:51:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NTkwOA=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\nindex ffef48f4f9a..5f16cec0af3 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/internal/APIManagerComponent.java\n\n@@ -753,7 +752,7 @@ public class APIManagerComponent {\n             service = Notifier.class,\n             cardinality = ReferenceCardinality.MULTIPLE,\n             policy = ReferencePolicy.DYNAMIC,\n-            unbind = \"removeNotifier\")\n+            unbind = \"removeNotifiers\")\n     protected void addNotifier(Notifier notifier) {\n         List<Notifier> notifierList = ServiceReferenceHolder.getInstance().getNotifiersMap().get(notifier.getType());\n         if (notifierList == null) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NjE3MA==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429686170", "bodyText": "Shall we change this to builder pattern?", "author": "isharac", "createdAt": "2020-05-24T23:34:21Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/APIEvent.java", "diffHunk": "@@ -0,0 +1,123 @@\n+package org.wso2.carbon.apimgt.impl.notifier.events;\n+\n+import java.util.Objects;\n+\n+public class APIEvent extends Event {\n+\n+    private String apiName;\n+    private int apiId;\n+    private String apiVersion;\n+    private String apiContext;\n+    private String apiProvider;\n+    private String apiType;\n+    private String apiStatus;\n+\n+    public APIEvent(String eventId, long timestamp, String type, int tenantId, String apiName, int apiId,", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "efb26ea42ba9c417e5aa952aeb64402d8d33b3a7", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/APIEvent.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/APIEvent.java\nindex d9f23416a77..ba02408d9ac 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/APIEvent.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/APIEvent.java\n\n@@ -1,3 +1,21 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n package org.wso2.carbon.apimgt.impl.notifier.events;\n \n import java.util.Objects;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NjUyNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429686525", "bodyText": "We need the group_id as well.", "author": "isharac", "createdAt": "2020-05-24T23:38:43Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/ApplicationEvent.java", "diffHunk": "@@ -0,0 +1,84 @@\n+package org.wso2.carbon.apimgt.impl.notifier.events;\n+\n+import java.util.Objects;\n+\n+public class ApplicationEvent extends Event {\n+    private int applicationId;\n+    private String applicationName;\n+    private String tokenType;\n+    private String applicationPolicy;\n+\n+    public ApplicationEvent(String eventId, long timestamp, String type, int tenantId,int applicationId,\n+                            String applicationName, String tokenType, String applicationPolicy) {\n+        this.eventId = eventId;\n+        this.timeStamp = timestamp;\n+        this.type = type;\n+        this.tenantId = tenantId;\n+        this.applicationId = applicationId;\n+        this.applicationName = applicationName;\n+        this.tokenType = tokenType;\n+        this.applicationPolicy = applicationPolicy;", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTMwMw==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191303", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NjUyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/ApplicationEvent.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/ApplicationEvent.java\nindex b50d5d09825..46440fbee88 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/ApplicationEvent.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/notifier/events/ApplicationEvent.java\n\n@@ -7,9 +7,10 @@ public class ApplicationEvent extends Event {\n     private String applicationName;\n     private String tokenType;\n     private String applicationPolicy;\n+    private String groupId;\n \n     public ApplicationEvent(String eventId, long timestamp, String type, int tenantId,int applicationId,\n-                            String applicationName, String tokenType, String applicationPolicy) {\n+                            String applicationName, String tokenType, String applicationPolicy, String groupId) {\n         this.eventId = eventId;\n         this.timeStamp = timestamp;\n         this.type = type;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NzIyNQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r429687225", "bodyText": "need the space after the .", "author": "isharac", "createdAt": "2020-05-24T23:46:31Z", "path": "components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java", "diffHunk": "@@ -539,6 +535,23 @@ public static void updateAPIProductDependencies(API api, Registry registry) thro\n         }\n     }\n \n+    /**\n+     * This method used to send Notifications\n+     *\n+     * @param event        Event object\n+     * @param notifierType eventType\n+     */\n+    public static void sendNotification(org.wso2.carbon.apimgt.impl.notifier.events.Event event, String notifierType) {\n+        List<Notifier> notifierList = ServiceReferenceHolder.getInstance().getNotifiersMap().get(notifierType);\n+        notifierList.forEach((notifier) -> {\n+            try {\n+                notifier.publishEvent(event);\n+            } catch (NotifierException e) {\n+                log.error(\"Error when publish \" + event + \" through notifier:\" + notifierType + \" .Error:\" + e);", "originalCommit": "82c3e214a4f10e24d7ac461141ac9fbb3eae9f3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE5MTI0NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/8555#discussion_r430191245", "bodyText": "resolved", "author": "CrowleyRajapakse", "createdAt": "2020-05-26T06:51:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY4NzIyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "4643b428cdfb27800502e2b41f007e8af350f389", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\nindex fda5fc1d8b1..c2698ebcd40 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.impl/src/main/java/org/wso2/carbon/apimgt/impl/utils/APIUtil.java\n\n@@ -547,7 +548,7 @@ public final class APIUtil {\n             try {\n                 notifier.publishEvent(event);\n             } catch (NotifierException e) {\n-                log.error(\"Error when publish \" + event + \" through notifier:\" + notifierType + \" .Error:\" + e);\n+                log.error(\"Error when publish \" + event + \" through notifier:\" + notifierType + \". Error:\" + e);\n             }\n         });\n     }\n"}}, {"oid": "4643b428cdfb27800502e2b41f007e8af350f389", "url": "https://github.com/wso2/carbon-apimgt/commit/4643b428cdfb27800502e2b41f007e8af350f389", "message": "Adding event notifier base component", "committedDate": "2020-05-26T06:49:09Z", "type": "forcePushed"}, {"oid": "411130f4094660c4d5fda44edc0798b39bc8019e", "url": "https://github.com/wso2/carbon-apimgt/commit/411130f4094660c4d5fda44edc0798b39bc8019e", "message": "Adding event notifier base component", "committedDate": "2020-05-26T13:19:29Z", "type": "forcePushed"}, {"oid": "d618cb7ef5cc58a627ce65e93919d4f22c24dc83", "url": "https://github.com/wso2/carbon-apimgt/commit/d618cb7ef5cc58a627ce65e93919d4f22c24dc83", "message": "Adding event notifier base component", "committedDate": "2020-05-27T03:51:54Z", "type": "forcePushed"}, {"oid": "efb26ea42ba9c417e5aa952aeb64402d8d33b3a7", "url": "https://github.com/wso2/carbon-apimgt/commit/efb26ea42ba9c417e5aa952aeb64402d8d33b3a7", "message": "Adding event notifier base component", "committedDate": "2020-05-27T05:05:03Z", "type": "forcePushed"}, {"oid": "0fe0ef401b6cf67118bf786dd799fa4511e3b0a4", "url": "https://github.com/wso2/carbon-apimgt/commit/0fe0ef401b6cf67118bf786dd799fa4511e3b0a4", "message": "Adding event notifier base component", "committedDate": "2020-05-27T06:23:07Z", "type": "commit"}, {"oid": "0fe0ef401b6cf67118bf786dd799fa4511e3b0a4", "url": "https://github.com/wso2/carbon-apimgt/commit/0fe0ef401b6cf67118bf786dd799fa4511e3b0a4", "message": "Adding event notifier base component", "committedDate": "2020-05-27T06:23:07Z", "type": "forcePushed"}]}