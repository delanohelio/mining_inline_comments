{"pr_number": 9307, "pr_title": "Fixing subscription blocking update issue", "pr_createdAt": "2020-10-09T04:56:17Z", "pr_url": "https://github.com/wso2/carbon-apimgt/pull/9307", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI2NTI4NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/9307#discussion_r502265285", "bodyText": "do we need to do body.getStatus() since there was a condition to check equals", "author": "tharindu1st", "createdAt": "2020-10-09T08:18:51Z", "path": "components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/SubscriptionsApiServiceImpl.java", "diffHunk": "@@ -270,10 +271,14 @@ public Response subscriptionsSubscriptionIdPut(SubscriptionDTO body, String subs\n             String currentThrottlingPolicy = body.getThrottlingPolicy();\n             String requestedThrottlingPolicy = body.getRequestedThrottlingPolicy();\n \n+            SubscribedAPI subscribedAPI = ApiMgtDAO.getInstance()\n+                    .getSubscriptionByUUID(subscriptionId);\n             //Check whether the subscription status is not empty and also not blocked\n-            if (body.getStatus() != null) {\n+            if (body.getStatus() != null && subscribedAPI != null) {", "originalCommit": "063f1776e9fe90837bd9248da2747e7e9df2ac2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI3ODM1NQ==", "url": "https://github.com/wso2/carbon-apimgt/pull/9307#discussion_r502278355", "bodyText": "if the body.getStatus() is null we are sending error message saying payload should contain subscription status kind of message. if body.getStatus() is not null then we are checking if it's in blocked or on hold status", "author": "CrowleyRajapakse", "createdAt": "2020-10-09T08:42:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI2NTI4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "009e0c828b1658a191a7a25cdea662d388b5c4c4", "chunk": "diff --git a/components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/SubscriptionsApiServiceImpl.java b/components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/SubscriptionsApiServiceImpl.java\nindex 7b28cb5563c..2e254865d88 100644\n--- a/components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/SubscriptionsApiServiceImpl.java\n+++ b/components/apimgt/org.wso2.carbon.apimgt.rest.api.store.v1/src/main/java/org/wso2/carbon/apimgt/rest/api/store/v1/impl/SubscriptionsApiServiceImpl.java\n\n@@ -280,7 +280,7 @@ public class SubscriptionsApiServiceImpl implements SubscriptionsApiService {\n                         || \"ON_HOLD\".equals(subscribedAPI.getSubStatus())\n                         || \"REJECTED\".equals(subscribedAPI.getSubStatus())) {\n                     RestApiUtil.handleBadRequest(\n-                            \"Cannot update subscriptions with provided status\", log);\n+                            \"Cannot update subscriptions with provided or existing status\", log);\n                     return null;\n                 }\n             } else {\n"}}, {"oid": "009e0c828b1658a191a7a25cdea662d388b5c4c4", "url": "https://github.com/wso2/carbon-apimgt/commit/009e0c828b1658a191a7a25cdea662d388b5c4c4", "message": "fixing subscription blocking update issue", "committedDate": "2020-10-09T08:44:17Z", "type": "commit"}, {"oid": "009e0c828b1658a191a7a25cdea662d388b5c4c4", "url": "https://github.com/wso2/carbon-apimgt/commit/009e0c828b1658a191a7a25cdea662d388b5c4c4", "message": "fixing subscription blocking update issue", "committedDate": "2020-10-09T08:44:17Z", "type": "forcePushed"}]}