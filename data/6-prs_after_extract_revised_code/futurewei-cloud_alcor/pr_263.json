{"pr_number": 263, "pr_title": "[Port Manager] Bug Fixes for Delete Ports, Duplicated Port-SG Binding", "pr_createdAt": "2020-06-23T22:12:27Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/263", "timeline": [{"oid": "5be6e3fa22cac8cc2dc1e24496e245e0b53e0899", "url": "https://github.com/futurewei-cloud/alcor/commit/5be6e3fa22cac8cc2dc1e24496e245e0b53e0899", "message": "Replace neighborCache key with vpc id", "committedDate": "2020-06-23T22:06:55Z", "type": "commit"}, {"oid": "7d89c3dcb790c4452568c57b772bf2dca203a3d7", "url": "https://github.com/futurewei-cloud/alcor/commit/7d89c3dcb790c4452568c57b772bf2dca203a3d7", "message": "Fix duplicated issue of port-SG binding", "committedDate": "2020-06-24T00:05:54Z", "type": "commit"}, {"oid": "c5a6bc28776d5b9f418a5a451fddacf7830a57bd", "url": "https://github.com/futurewei-cloud/alcor/commit/c5a6bc28776d5b9f418a5a451fddacf7830a57bd", "message": "Refactor createPortAndNeighborBulk", "committedDate": "2020-06-24T00:22:41Z", "type": "commit"}, {"oid": "d5dc729d8efcafb63fb58588900d67fe2d10e4c8", "url": "https://github.com/futurewei-cloud/alcor/commit/d5dc729d8efcafb63fb58588900d67fe2d10e4c8", "message": "Revert GET SGs as used to build NetwworkConfiguration", "committedDate": "2020-06-24T03:39:30Z", "type": "commit"}, {"oid": "d4d9d1b99c6e32d92be3c7892dd4d8e64faff386", "url": "https://github.com/futurewei-cloud/alcor/commit/d4d9d1b99c6e32d92be3c7892dd4d8e64faff386", "message": "Formating a few PM files", "committedDate": "2020-06-24T04:47:09Z", "type": "commit"}, {"oid": "9a996a22a37125ea846de4ba9fd9e69bd1316f20", "url": "https://github.com/futurewei-cloud/alcor/commit/9a996a22a37125ea846de4ba9fd9e69bd1316f20", "message": "Remove redundant neighbor_info for ports on the same host", "committedDate": "2020-06-24T05:41:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2NDg0OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/263#discussion_r444664849", "bodyText": "btw, Please add neighborCache= cacheFactory.getCache(PortNeighbors.class);  to the constructor, Thanks!", "author": "chenpiaoping", "createdAt": "2020-06-24T06:09:16Z", "path": "services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java", "diffHunk": "@@ -116,18 +116,19 @@ public void createPortAndNeighborBulk(List<PortEntity> portEntities, Map<String,\n             //Add neighborInfos to neighborCache\n             if (neighbors != null) {\n                 for (Map.Entry<String, List<NeighborInfo>> entry: neighbors.entrySet()) {\n-                    PortNeighbors portNeighbors = neighborCache.get(entry.getKey());", "originalCommit": "c5a6bc28776d5b9f418a5a451fddacf7830a57bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY4MDE0MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/263#discussion_r444680141", "bodyText": "Sure. Fixed in a758e18", "author": "xieus", "createdAt": "2020-06-24T06:49:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2NDg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyODM5Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/263#discussion_r444928396", "bodyText": "hello @chenpiaoping It seems that there are some corner cases to be covered by UTs. Could you please add those UTs when you get a chance? Thanks.", "author": "xieus", "createdAt": "2020-06-24T14:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2NDg0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzM1NDg2Mw==", "url": "https://github.com/futurewei-cloud/alcor/pull/263#discussion_r447354863", "bodyText": "ok", "author": "chenpiaoping", "createdAt": "2020-06-30T01:32:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY2NDg0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "a758e1848834c30726ea0c395dea2542c34dc66b", "chunk": "diff --git a/services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java b/services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java\nindex f1fcb26a..f643477f 100644\n--- a/services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java\n+++ b/services/port_manager/src/main/java/com/futurewei/alcor/portmanager/repo/PortRepository.java\n\n@@ -115,7 +117,7 @@ public class PortRepository {\n \n             //Add neighborInfos to neighborCache\n             if (neighbors != null) {\n-                for (Map.Entry<String, List<NeighborInfo>> entry: neighbors.entrySet()) {\n+                for (Map.Entry<String, List<NeighborInfo>> entry : neighbors.entrySet()) {\n                     String vpcId = entry.getKey();\n                     PortNeighbors portNeighbors = neighborCache.get(vpcId);\n                     if (portNeighbors == null) {\n"}}, {"oid": "a758e1848834c30726ea0c395dea2542c34dc66b", "url": "https://github.com/futurewei-cloud/alcor/commit/a758e1848834c30726ea0c395dea2542c34dc66b", "message": "Fix PortRepository constructor", "committedDate": "2020-06-24T06:47:46Z", "type": "commit"}]}