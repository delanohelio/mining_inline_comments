{"pr_number": 511, "pr_title": "[Hotfix] Fix Issue #506 and Issue #505", "pr_createdAt": "2020-12-09T04:57:08Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/511", "timeline": [{"oid": "24b9b76ae349f277ac55f1cc11e81636d1569b6d", "url": "https://github.com/futurewei-cloud/alcor/commit/24b9b76ae349f277ac55f1cc11e81636d1569b6d", "message": "commit message", "committedDate": "2020-10-07T21:49:22Z", "type": "commit"}, {"oid": "08ec421662ef56559a388e6c7308aa47cfd07a6b", "url": "https://github.com/futurewei-cloud/alcor/commit/08ec421662ef56559a388e6c7308aa47cfd07a6b", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-07T22:00:25Z", "type": "commit"}, {"oid": "2507b8fc44a4ca94da310b73c11453cec9f2504b", "url": "https://github.com/futurewei-cloud/alcor/commit/2507b8fc44a4ca94da310b73c11453cec9f2504b", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-15T17:12:49Z", "type": "commit"}, {"oid": "8cab6bfa9573926c29b9f8dbbeab732a9de1da7e", "url": "https://github.com/futurewei-cloud/alcor/commit/8cab6bfa9573926c29b9f8dbbeab732a9de1da7e", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-15T23:33:06Z", "type": "commit"}, {"oid": "d9d2a5822429286e2b01ce0842f16cb70dc5168f", "url": "https://github.com/futurewei-cloud/alcor/commit/d9d2a5822429286e2b01ce0842f16cb70dc5168f", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-16T16:57:50Z", "type": "commit"}, {"oid": "daba98ee8949b91b2b77f74c6fbb30529355ee51", "url": "https://github.com/futurewei-cloud/alcor/commit/daba98ee8949b91b2b77f74c6fbb30529355ee51", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-20T00:03:13Z", "type": "commit"}, {"oid": "b813735c5032b70928a2304007875824f5ccedca", "url": "https://github.com/futurewei-cloud/alcor/commit/b813735c5032b70928a2304007875824f5ccedca", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-22T17:43:05Z", "type": "commit"}, {"oid": "fd9a9847b0f42c5a7fd089ea09fa6f24233d008e", "url": "https://github.com/futurewei-cloud/alcor/commit/fd9a9847b0f42c5a7fd089ea09fa6f24233d008e", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-28T19:40:54Z", "type": "commit"}, {"oid": "e44875aa2fa685b2252647f413c704dce7a21611", "url": "https://github.com/futurewei-cloud/alcor/commit/e44875aa2fa685b2252647f413c704dce7a21611", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-29T18:42:59Z", "type": "commit"}, {"oid": "98dcf0dbb1c950ee71a0d663a7042cbce30d24ed", "url": "https://github.com/futurewei-cloud/alcor/commit/98dcf0dbb1c950ee71a0d663a7042cbce30d24ed", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-10-30T22:44:46Z", "type": "commit"}, {"oid": "a9c3a47d74ba5fffbe13746ee4e33af0fbb394fe", "url": "https://github.com/futurewei-cloud/alcor/commit/a9c3a47d74ba5fffbe13746ee4e33af0fbb394fe", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-11-03T23:40:18Z", "type": "commit"}, {"oid": "f058bd1edef55af8ab0e25cb7b043fa6c04c272f", "url": "https://github.com/futurewei-cloud/alcor/commit/f058bd1edef55af8ab0e25cb7b043fa6c04c272f", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-11-05T07:42:35Z", "type": "commit"}, {"oid": "08d4a6f7da0d94caef77156cbb27fa05965eff9a", "url": "https://github.com/futurewei-cloud/alcor/commit/08d4a6f7da0d94caef77156cbb27fa05965eff9a", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-11-05T19:07:01Z", "type": "commit"}, {"oid": "ef0b4fe4b03ddcc00904f1d603d020648846c34f", "url": "https://github.com/futurewei-cloud/alcor/commit/ef0b4fe4b03ddcc00904f1d603d020648846c34f", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-11-18T22:54:01Z", "type": "commit"}, {"oid": "bf29fc71c3dba26a3a166b859fd10be380f03400", "url": "https://github.com/futurewei-cloud/alcor/commit/bf29fc71c3dba26a3a166b859fd10be380f03400", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-02T21:06:36Z", "type": "commit"}, {"oid": "b23608afa9dfcd50c2c172672f9a104ccb0e7f21", "url": "https://github.com/futurewei-cloud/alcor/commit/b23608afa9dfcd50c2c172672f9a104ccb0e7f21", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-03T18:09:47Z", "type": "commit"}, {"oid": "d2e742c1d2b83f4679c833b90c4f065fda6b61d4", "url": "https://github.com/futurewei-cloud/alcor/commit/d2e742c1d2b83f4679c833b90c4f065fda6b61d4", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-04T06:54:24Z", "type": "commit"}, {"oid": "7b1f333fde18b70f971d51d4181b20f401ee038e", "url": "https://github.com/futurewei-cloud/alcor/commit/7b1f333fde18b70f971d51d4181b20f401ee038e", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-08T19:25:36Z", "type": "commit"}, {"oid": "0599937a476aa1b217733736bd29e7ee6a353df1", "url": "https://github.com/futurewei-cloud/alcor/commit/0599937a476aa1b217733736bd29e7ee6a353df1", "message": "update", "committedDate": "2020-12-09T04:53:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MjcwMQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545392701", "bodyText": "@kevin-zhonghao Please check PM's new API for port count in a subnet, it should be {\"/project/{project_id}/subnet-port-count/{subnet_id}. This api will only return non-gateway port count. If it's not zero, the subnet cannot be deleted. If it returns zero, we need to ask PM to delete the gateway port first before delete the subnet.", "author": "cj-chung", "createdAt": "2020-12-17T20:46:13Z", "path": "services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java", "diffHunk": "@@ -523,8 +523,10 @@ public ResponseId deleteSubnetState(@PathVariable String projectId, @PathVariabl\n             } else {\n                 rangeId = ipV6RangeId;\n             }\n-//            Boolean checkIfAnyPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n-//            if (checkIfAnyPortInSubnet) {\n+\n+            // TODO: check if there is any gateway / non-gateway port for the subnet, waiting for PM new API\n+//            Boolean checkIfAnyNoneGatewayPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n+//            if (checkIfAnyNoneGatewayPortInSubnet) {\n //                throw new HavePortInSubnet();\n //            }", "originalCommit": "0599937a476aa1b217733736bd29e7ee6a353df1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4OTg0Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545989846", "bodyText": "Sure", "author": "kevin-zhonghao", "createdAt": "2020-12-18T17:46:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MjcwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "487948d56ef157677b6cee9b5818fb98fa5fc640", "chunk": "diff --git a/services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java b/services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java\nindex 2eb7b5b5..ab0d5932 100644\n--- a/services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java\n+++ b/services/subnet_manager/src/main/java/com/futurewei/alcor/subnet/controller/SubnetController.java\n\n@@ -523,10 +523,8 @@ public class SubnetController {\n             } else {\n                 rangeId = ipV6RangeId;\n             }\n-\n-            // TODO: check if there is any gateway / non-gateway port for the subnet, waiting for PM new API\n-//            Boolean checkIfAnyNoneGatewayPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n-//            if (checkIfAnyNoneGatewayPortInSubnet) {\n+//            Boolean checkIfAnyPortInSubnet = this.subnetService.checkIfAnyPortInSubnet(rangeId);\n+//            if (checkIfAnyPortInSubnet) {\n //                throw new HavePortInSubnet();\n //            }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5OTgzNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545399834", "bodyText": "@kevin-zhonghao please prepare a RouterUpdateInfo object here for request body. @chenpiaoping's code for this API requires RouterUpdateInfo object.", "author": "cj-chung", "createdAt": "2020-12-17T20:59:17Z", "path": "services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java", "diffHunk": "@@ -81,4 +81,10 @@ public void updatePort(String projectid, String portId, PortEntity portEntity) {\n         HttpEntity<PortWebJson> request = new HttpEntity<>(new PortWebJson(portEntity));\n         restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n     }\n+\n+    @Override\n+    public void updateL3Neighbors(String projectid, List<String> gatewayPorts) {\n+        String portManagerServiceUrl = portUrl + \"/project/\" + projectid + \"/update-l3-neighbors\";\n+        //restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n+    }", "originalCommit": "0599937a476aa1b217733736bd29e7ee6a353df1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk4OTk0OQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/511#discussion_r545989949", "bodyText": "Added it", "author": "kevin-zhonghao", "createdAt": "2020-12-18T17:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5OTgzNA=="}], "type": "inlineReview", "revised_code": {"commit": "487948d56ef157677b6cee9b5818fb98fa5fc640", "chunk": "diff --git a/services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java b/services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java\nindex e55b1827..9ba26424 100644\n--- a/services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java\n+++ b/services/route_manager/src/main/java/com/futurewei/alcor/route/service/Impl/RouterToPMServiceImpl.java\n\n@@ -81,10 +81,4 @@ public class RouterToPMServiceImpl implements RouterToPMService {\n         HttpEntity<PortWebJson> request = new HttpEntity<>(new PortWebJson(portEntity));\n         restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n     }\n-\n-    @Override\n-    public void updateL3Neighbors(String projectid, List<String> gatewayPorts) {\n-        String portManagerServiceUrl = portUrl + \"/project/\" + projectid + \"/update-l3-neighbors\";\n-        //restTemplate.put(portManagerServiceUrl, request, PortWebJson.class);\n-    }\n }\n"}}, {"oid": "487948d56ef157677b6cee9b5818fb98fa5fc640", "url": "https://github.com/futurewei-cloud/alcor/commit/487948d56ef157677b6cee9b5818fb98fa5fc640", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-17T23:36:00Z", "type": "commit"}, {"oid": "1e6275907484bea5acb75edf40a3b711fdae9073", "url": "https://github.com/futurewei-cloud/alcor/commit/1e6275907484bea5acb75edf40a3b711fdae9073", "message": "Merge branch 'new_master' into fix/issue_506_505", "committedDate": "2020-12-17T23:36:41Z", "type": "commit"}, {"oid": "602c7f9381f18da19079c25517606647ce19e382", "url": "https://github.com/futurewei-cloud/alcor/commit/602c7f9381f18da19079c25517606647ce19e382", "message": "update", "committedDate": "2020-12-18T17:43:16Z", "type": "commit"}, {"oid": "ce19ed1296214ee9b4e9e93aea768bfb9bf05db4", "url": "https://github.com/futurewei-cloud/alcor/commit/ce19ed1296214ee9b4e9e93aea768bfb9bf05db4", "message": "update", "committedDate": "2020-12-18T21:43:21Z", "type": "commit"}, {"oid": "4358c990732dff3f9ef49235b583ca5f2d3f0417", "url": "https://github.com/futurewei-cloud/alcor/commit/4358c990732dff3f9ef49235b583ca5f2d3f0417", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-19T00:02:58Z", "type": "commit"}, {"oid": "fb907eec414e25053f35e756a757751307ad854c", "url": "https://github.com/futurewei-cloud/alcor/commit/fb907eec414e25053f35e756a757751307ad854c", "message": "Merge branch 'new_master' into fix/issue_506_505", "committedDate": "2020-12-19T00:03:38Z", "type": "commit"}, {"oid": "b61fcc12f3bf26a163ee4eeca55a2d90de7d984e", "url": "https://github.com/futurewei-cloud/alcor/commit/b61fcc12f3bf26a163ee4eeca55a2d90de7d984e", "message": "update", "committedDate": "2020-12-22T18:29:41Z", "type": "commit"}, {"oid": "e851cce68da26d4e2787e9a8c8b92fef044ef8ba", "url": "https://github.com/futurewei-cloud/alcor/commit/e851cce68da26d4e2787e9a8c8b92fef044ef8ba", "message": "Merge branch 'master' of https://github.com/futurewei-cloud/alcor into new_master", "committedDate": "2020-12-22T18:30:43Z", "type": "commit"}, {"oid": "fc24c1f01006147e57dd4442efd6977cf7e5c780", "url": "https://github.com/futurewei-cloud/alcor/commit/fc24c1f01006147e57dd4442efd6977cf7e5c780", "message": "Merge branch 'new_master' into fix/issue_506_505", "committedDate": "2020-12-22T18:31:13Z", "type": "commit"}, {"oid": "8af5732bd44945885f1972ee1d057cf3a8fd4419", "url": "https://github.com/futurewei-cloud/alcor/commit/8af5732bd44945885f1972ee1d057cf3a8fd4419", "message": "update", "committedDate": "2020-12-23T00:14:19Z", "type": "commit"}, {"oid": "bf4b11d86e49be4099bbcdb600ddf808a3e4bf0f", "url": "https://github.com/futurewei-cloud/alcor/commit/bf4b11d86e49be4099bbcdb600ddf808a3e4bf0f", "message": "Merge branch 'master' into fix/issue_506_505", "committedDate": "2021-01-12T06:31:03Z", "type": "commit"}]}