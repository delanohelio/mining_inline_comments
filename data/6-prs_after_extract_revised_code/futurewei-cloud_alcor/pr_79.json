{"pr_number": 79, "pr_title": "Preliminary support of node management and switch assignment", "pr_createdAt": "2020-01-07T03:11:01Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/79", "timeline": [{"oid": "a3129ea85e5ca21d7686904f25d39c7e8d8f0f94", "url": "https://github.com/futurewei-cloud/alcor/commit/a3129ea85e5ca21d7686904f25d39c7e8d8f0f94", "message": "Update port get/post APIs", "committedDate": "2019-12-31T00:07:19Z", "type": "commit"}, {"oid": "2c098871a9e14e99fe3c903537eb797bb9cd1272", "url": "https://github.com/futurewei-cloud/alcor/commit/2c098871a9e14e99fe3c903537eb797bb9cd1272", "message": "Update post/put port APIs", "committedDate": "2019-12-31T20:26:55Z", "type": "commit"}, {"oid": "5ec144b6413a91740d1868d336f8f5a827dcd159", "url": "https://github.com/futurewei-cloud/alcor/commit/5ec144b6413a91740d1868d336f8f5a827dcd159", "message": "Add Response id in delete API", "committedDate": "2019-12-31T22:48:54Z", "type": "commit"}, {"oid": "be93767c0cca7f1e9af3d897ac2b35ae50956469", "url": "https://github.com/futurewei-cloud/alcor/commit/be93767c0cca7f1e9af3d897ac2b35ae50956469", "message": "Update get subnet api", "committedDate": "2019-12-31T23:07:24Z", "type": "commit"}, {"oid": "ff72f30252f1b309acbe572fd87b2f144b58e176", "url": "https://github.com/futurewei-cloud/alcor/commit/ff72f30252f1b309acbe572fd87b2f144b58e176", "message": "Add goal state programmer", "committedDate": "2020-01-06T19:10:34Z", "type": "commit"}, {"oid": "8bde607a1da74161447efaec04b00c6f0a70148c", "url": "https://github.com/futurewei-cloud/alcor/commit/8bde607a1da74161447efaec04b00c6f0a70148c", "message": "Merge branch 'master' into api/vpc", "committedDate": "2020-01-06T19:13:18Z", "type": "commit"}, {"oid": "3ca0603c7300b575d476ae63c7eb428569f1afe8", "url": "https://github.com/futurewei-cloud/alcor/commit/3ca0603c7300b575d476ae63c7eb428569f1afe8", "message": "Support random switch assignments, standardize port creation", "committedDate": "2020-01-07T02:57:10Z", "type": "commit"}, {"oid": "c847cae1247f671f4dfd9c14f90b6ae5636d5466", "url": "https://github.com/futurewei-cloud/alcor/commit/c847cae1247f671f4dfd9c14f90b6ae5636d5466", "message": "Update copyright statements", "committedDate": "2020-01-07T03:05:03Z", "type": "commit"}, {"oid": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "url": "https://github.com/futurewei-cloud/alcor/commit/0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "message": "Update copyright statements cont", "committedDate": "2020-01-07T03:06:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTIzMw==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363609233", "bodyText": "I wonder if it is better to do:\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.*;\nInstead of the below since all the three lines are from alcor:\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\nimport com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.NodeManager;", "author": "er1cthe0ne", "createdAt": "2020-01-07T06:39:13Z", "path": "src/com/futurewei/alcor/controller/app/AlcorControllerApp.java", "diffHunk": "@@ -23,7 +23,9 @@\n import com.futurewei.alcor.controller.app.onebox.OneBoxUtil;\n import com.futurewei.alcor.controller.cache.config.*;\n import com.futurewei.alcor.controller.model.HostInfo;\n-import com.futurewei.alcor.controller.resourcemgr.physical.DataCenterConfigLoader;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;", "originalCommit": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3NzUwMg==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363877502", "bodyText": "nodemgmt is not a big package. Will update as suggested.", "author": "xieus", "createdAt": "2020-01-07T18:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTIzMw=="}], "type": "inlineReview", "revised_code": {"commit": "e2f186f0e46cbaae9460ecd42e738f9b80767085", "chunk": "diff --git a/src/com/futurewei/alcor/controller/app/AlcorControllerApp.java b/src/com/futurewei/alcor/controller/app/AlcorControllerApp.java\nindex 05b73f6f7..e61b4b0db 100644\n--- a/src/com/futurewei/alcor/controller/app/AlcorControllerApp.java\n+++ b/src/com/futurewei/alcor/controller/app/AlcorControllerApp.java\n\n@@ -23,9 +23,7 @@ import com.futurewei.alcor.controller.app.onebox.OneBoxConfig;\n import com.futurewei.alcor.controller.app.onebox.OneBoxUtil;\n import com.futurewei.alcor.controller.cache.config.*;\n import com.futurewei.alcor.controller.model.HostInfo;\n-import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfigLoader;\n-import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\n-import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.NodeManager;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.*;\n import org.springframework.boot.CommandLineRunner;\n import org.springframework.boot.SpringApplication;\n import org.springframework.boot.autoconfigure.SpringBootApplication;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTU3Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363609576", "bodyText": "would it be better to set IS_K8S and IS_Onebox to false as default and change it to true when needed?", "author": "er1cthe0ne", "createdAt": "2020-01-07T06:40:54Z", "path": "src/com/futurewei/alcor/controller/app/onebox/OneBoxConfig.java", "diffHunk": "@@ -29,6 +29,7 @@\n \n public class OneBoxConfig {\n \n+    public static boolean IS_K8S = true;", "originalCommit": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4MTc5MQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363881791", "bodyText": "True, but it doesn't quite matter if hard-coded.. Instead we should update controller config to set up those parameters actually which we will do in next PR.", "author": "xieus", "createdAt": "2020-01-07T18:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwOTU3Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363611320", "bodyText": "nextInt expect a positive number, correct me if I am wrong, what if:\nmax = -100\nmin = -1000\nmax - min = -1100", "author": "er1cthe0ne", "createdAt": "2020-01-07T06:49:27Z", "path": "src/com/futurewei/alcor/controller/utilities/Common.java", "diffHunk": "@@ -26,4 +27,14 @@\n \n         return bytes;\n     }\n+\n+    public static int getRandomNumberInRange(int min, int max) {\n+\n+        if (min >= max) {\n+            throw new IllegalArgumentException(\"Max must be greater than min\");\n+        }\n+\n+        Random r = new Random();\n+        return r.nextInt((max - min) + 1) + min;", "originalCommit": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3Nzg2Ng==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363877866", "bodyText": "Are you sure that (-100) - (-1000) = -1100 ? :-)", "author": "xieus", "createdAt": "2020-01-07T18:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg3ODkxNQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363878915", "bodyText": ":) I am not sure now when I look at it this morning...", "author": "er1cthe0ne", "createdAt": "2020-01-07T18:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTMyMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTc4Nw==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363611787", "bodyText": "is this function for OneBox only? If yes, it will be better to name this function accordingly.", "author": "er1cthe0ne", "createdAt": "2020-01-07T06:51:52Z", "path": "src/com/futurewei/alcor/controller/web/util/ControllerUtil.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+Copyright 2019 The Alcor Authors.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+        you may not use this file except in compliance with the License.\n+        You may obtain a copy of the License at\n+\n+        http://www.apache.org/licenses/LICENSE-2.0\n+\n+        Unless required by applicable law or agreed to in writing, software\n+        distributed under the License is distributed on an \"AS IS\" BASIS,\n+        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+        See the License for the specific language governing permissions and\n+        limitations under the License.\n+*/\n+package com.futurewei.alcor.controller.web.util;\n+\n+import com.futurewei.alcor.controller.app.onebox.OneBoxConfig;\n+import com.futurewei.alcor.controller.model.HostInfo;\n+import com.futurewei.alcor.controller.model.PortState;\n+import com.futurewei.alcor.controller.model.SubnetState;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.GoalStateWorker;\n+import com.futurewei.alcor.controller.resourcemgr.physical.goalstatemgmt.PortProgramInfo;\n+import com.futurewei.alcor.controller.resourcemgr.physical.nodemgmt.DataCenterConfig;\n+\n+public class ControllerUtil {\n+\n+    public static PortState CreatePort(PortState portState) {\n+\n+        HostInfo epHost = DataCenterConfig.nodeManager.getHostInfoById(portState.getBindingHostId());\n+        PortState customerPortState = ControllerUtil.AssignVipMacToPort(portState, OneBoxConfig.epCounter);\n+        SubnetState customerSubnetState = ControllerConfig.customerSubnetState;\n+        HostInfo[] transitSwitchHostsForSubnet = ControllerConfig.transitSwitchHosts;\n+\n+        System.out.println(\"EP host counter :\" + OneBoxConfig.epHostCounter + \"| ep counter: \" + OneBoxConfig.epCounter);\n+        OneBoxConfig.epCounter++;", "originalCommit": "0d1c4e1bb5dfc294d3009065ca9ffe9e600d9819", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg4MzEyOQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/79#discussion_r363883129", "bodyText": "This is for general usage actually. It has been updated with the correct config.", "author": "xieus", "createdAt": "2020-01-07T18:20:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYxMTc4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "e2f186f0e46cbaae9460ecd42e738f9b80767085", "chunk": "diff --git a/src/com/futurewei/alcor/controller/web/util/ControllerUtil.java b/src/com/futurewei/alcor/controller/web/util/ControllerUtil.java\nindex 38a1a7cd4..81627c959 100644\n--- a/src/com/futurewei/alcor/controller/web/util/ControllerUtil.java\n+++ b/src/com/futurewei/alcor/controller/web/util/ControllerUtil.java\n\n@@ -15,7 +15,6 @@ Licensed under the Apache License, Version 2.0 (the \"License\");\n */\n package com.futurewei.alcor.controller.web.util;\n \n-import com.futurewei.alcor.controller.app.onebox.OneBoxConfig;\n import com.futurewei.alcor.controller.model.HostInfo;\n import com.futurewei.alcor.controller.model.PortState;\n import com.futurewei.alcor.controller.model.SubnetState;\n"}}, {"oid": "e2f186f0e46cbaae9460ecd42e738f9b80767085", "url": "https://github.com/futurewei-cloud/alcor/commit/e2f186f0e46cbaae9460ecd42e738f9b80767085", "message": "Add ephost count to controller config", "committedDate": "2020-01-07T18:21:13Z", "type": "commit"}]}