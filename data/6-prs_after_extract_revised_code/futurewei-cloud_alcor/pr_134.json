{"pr_number": 134, "pr_title": "VPC Manager service module", "pr_createdAt": "2020-03-24T23:38:56Z", "pr_url": "https://github.com/futurewei-cloud/alcor/pull/134", "timeline": [{"oid": "a81d90c0c4b33c3a4ee7165b4f787aff53d440ff", "url": "https://github.com/futurewei-cloud/alcor/commit/a81d90c0c4b33c3a4ee7165b4f787aff53d440ff", "message": "vpcmanager", "committedDate": "2020-03-24T23:00:44Z", "type": "commit"}, {"oid": "93da5e40ad87f49cfc891b56a8618c25567b9c40", "url": "https://github.com/futurewei-cloud/alcor/commit/93da5e40ad87f49cfc891b56a8618c25567b9c40", "message": "vpc manager service update", "committedDate": "2020-03-24T23:35:04Z", "type": "commit"}, {"oid": "bb7c1ffd71e6ab1c1019b874322b18e239f0be61", "url": "https://github.com/futurewei-cloud/alcor/commit/bb7c1ffd71e6ab1c1019b874322b18e239f0be61", "message": "Merge pull request #1 from futurewei-cloud/master\n\nReplace Redis with Apache Ignite for in memory cache and db (#129)", "committedDate": "2020-03-25T16:12:19Z", "type": "commit"}, {"oid": "2b6a43fb0ae185b880969b49ce852434d1799a24", "url": "https://github.com/futurewei-cloud/alcor/commit/2b6a43fb0ae185b880969b49ce852434d1799a24", "message": "vpc manager directory structure update", "committedDate": "2020-03-25T18:26:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMDkxMA==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398830910", "bodyText": "If this is a generated code, they should be generated on the compile time, not stored in the src directory. Check how we handled it in the alcor/src directory.", "author": "xieus", "createdAt": "2020-03-26T19:19:09Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/constants/Common.java", "diffHunk": "@@ -0,0 +1,709 @@\n+// Generated by the protocol buffer compiler.  DO NOT EDIT!", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/constants/Common.java b/common-service/src/main/java/com/futurewei/common/constants/Common.java\nsimilarity index 99%\nrename from vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/constants/Common.java\nrename to common-service/src/main/java/com/futurewei/common/constants/Common.java\nindex 5b605068..636b993e 100644\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/constants/Common.java\n+++ b/common-service/src/main/java/com/futurewei/common/constants/Common.java\n\n@@ -1,7 +1,7 @@\n // Generated by the protocol buffer compiler.  DO NOT EDIT!\n // source: common.proto\n \n-package com.futurewei.vpcmanager.comm.constants;\n+package com.futurewei.common.constants;\n \n public final class Common {\n     private Common() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMTUzNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398831537", "bodyText": "Cache and logging are common across microservices. Let us move out of the vpcmanager directory.", "author": "xieus", "createdAt": "2020-03-26T19:20:07Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/exception/CacheException.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package com.futurewei.vpcmanager.comm.exception;", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/exception/CacheException.java b/common-service/src/main/java/com/futurewei/common/exception/CacheException.java\nsimilarity index 88%\nrename from vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/exception/CacheException.java\nrename to common-service/src/main/java/com/futurewei/common/exception/CacheException.java\nindex 67493d37..7e553810 100644\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/comm/exception/CacheException.java\n+++ b/common-service/src/main/java/com/futurewei/common/exception/CacheException.java\n\n@@ -1,4 +1,4 @@\n-package com.futurewei.vpcmanager.comm.exception;\n+package com.futurewei.common.exception;\n \n public class CacheException extends Exception {\n     private static final long serialVersionUID = 1L;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMjAzNA==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398832034", "bodyText": "Move this file. It is not needed as machine.json.", "author": "xieus", "createdAt": "2020-03-26T19:20:58Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/config/DataCenterConfig.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/DataCenterConfig.java b/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/DataCenterConfig.java\ndeleted file mode 100644\nindex ca7959f1..00000000\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/DataCenterConfig.java\n+++ /dev/null\n\n@@ -1,22 +0,0 @@\n-/*\n-Copyright 2019 The Alcor Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-        you may not use this file except in compliance with the License.\n-        You may obtain a copy of the License at\n-\n-        http://www.apache.org/licenses/LICENSE-2.0\n-\n-        Unless required by applicable law or agreed to in writing, software\n-        distributed under the License is distributed on an \"AS IS\" BASIS,\n-        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-        See the License for the specific language governing permissions and\n-        limitations under the License.\n-*/\n-package com.futurewei.vpcmanager.config;\n-\n-import com.futurewei.vpcmanager.entity.NodeManager;\n-\n-public class DataCenterConfig {\n-    public static NodeManager nodeManager = null;\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMjI3OA==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398832278", "bodyText": "common directory?", "author": "xieus", "createdAt": "2020-03-26T19:21:24Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/config/IgniteConfiguration.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/IgniteConfiguration.java b/common-service/src/main/java/com/futurewei/common/config/IgniteConfiguration.java\nsimilarity index 92%\nrename from vpcmanager/src/main/java/com/futurewei/vpcmanager/config/IgniteConfiguration.java\nrename to common-service/src/main/java/com/futurewei/common/config/IgniteConfiguration.java\nindex 70cd8094..3dffe46d 100644\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/IgniteConfiguration.java\n+++ b/common-service/src/main/java/com/futurewei/common/config/IgniteConfiguration.java\n\n@@ -14,10 +14,10 @@ Licensed under the Apache License, Version 2.0 (the \"License\");\n         limitations under the License.\n */\n \n-package com.futurewei.vpcmanager.config;\n+package com.futurewei.common.config;\n \n-import com.futurewei.vpcmanager.comm.logging.Logger;\n-import com.futurewei.vpcmanager.comm.logging.LoggerFactory;\n+import com.futurewei.common.logging.Logger;\n+import com.futurewei.common.logging.LoggerFactory;\n import org.apache.ignite.Ignition;\n import org.apache.ignite.client.ClientException;\n import org.apache.ignite.client.IgniteClient;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMjQ5NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398832495", "bodyText": "Remove this file.", "author": "xieus", "createdAt": "2020-03-26T19:21:46Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/config/OneBoxConfig.java", "diffHunk": "@@ -0,0 +1,190 @@\n+/*", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/OneBoxConfig.java b/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/OneBoxConfig.java\ndeleted file mode 100644\nindex 10f848c9..00000000\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/config/OneBoxConfig.java\n+++ /dev/null\n\n@@ -1,190 +0,0 @@\n-/*\n-Copyright 2019 The Alcor Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-        you may not use this file except in compliance with the License.\n-        You may obtain a copy of the License at\n-\n-        http://www.apache.org/licenses/LICENSE-2.0\n-\n-        Unless required by applicable law or agreed to in writing, software\n-        distributed under the License is distributed on an \"AS IS\" BASIS,\n-        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-        See the License for the specific language governing permissions and\n-        limitations under the License.\n-*/\n-\n-package com.futurewei.vpcmanager.config;\n-\n-import com.futurewei.vpcmanager.entity.HostInfo;\n-import com.futurewei.vpcmanager.entity.VpcState;\n-\n-import java.io.BufferedWriter;\n-import java.io.File;\n-import java.io.FileWriter;\n-import java.io.IOException;\n-import java.util.List;\n-\n-public class OneBoxConfig {\n-\n-    public static boolean IS_K8S = true;\n-    public static boolean IS_Onebox = true;\n-    public static boolean IS_PARALLEL = true;\n-    public static int TEST_NUM_PORTS = 1000;\n-\n-    public static String HOST_ID_PREFIX = \"es8-\";\n-    public static int GRPC_SERVER_PORT = 50005;\n-    public static long Tunnel_Id = 3000;\n-\n-    // TODO: figure out to store integer value over 127 in a byte\n-    public static int OVERFLOW_IP_CONVERSION = 256;\n-    public static byte FIRST_IP_BLOCK = (byte) (172 - OVERFLOW_IP_CONVERSION);\n-\n-    public static FileWriter TIME_STAMP_FILE;\n-    public static BufferedWriter TIME_STAMP_WRITER;\n-    public static String LOG_FILE_PATH = \"timestamp.log\";\n-\n-    public static long TOTAL_TIME = 0;\n-    public static int TOTAL_REQUEST = 0;\n-    public static long MAX_TIME = Long.MIN_VALUE;\n-    public static long MIN_TIME = Long.MAX_VALUE;\n-    public static long APP_START_TS = 0;\n-\n-    public static String gRPCServerIp = \"172.17.0.1\";\n-    public static int[] gRPCServerPortForSubnet1 = {\n-            50001,\n-            50002,\n-            50003,\n-            50004,\n-            50009,\n-            50010\n-    };\n-\n-    static {\n-        try {\n-            File file = new File(LOG_FILE_PATH);\n-            if (!file.exists()) {\n-                file.createNewFile();\n-            }\n-\n-            TIME_STAMP_FILE = new FileWriter(file);\n-            TIME_STAMP_WRITER = new BufferedWriter(TIME_STAMP_FILE);\n-        } catch (IOException e) {\n-            e.printStackTrace();\n-        }\n-    }\n-\n-    /////////////////////////////////\n-    // Virtual network resources\n-    /////////////////////////////////\n-    public static String VETH_NAME = \"veth0\";\n-\n-    public static String projectId = \"dbf72700-5106-4a7a-918f-a016853911f8\";\n-    public static String vpcId = \"99d9d709-8478-4b46-9f3f-2206b1023fd3\";\n-    public static String subnetId = \"9fd87d97-7164-4f6b-b116-e9fdf30c6339\";\n-\n-    public static String subnet1Id = \"d973934b-93e8-42fa-ac91-bf0cdb84fffc\";\n-    public static String subnet2Id = \"8cb94df3-05bd-45d1-95c0-1ad75f929810\";\n-    public static String ep1Id = \"89e72582-b4fc-4e4e-b46a-6eee650e03f5\";\n-    public static String ep2Id = \"34bf0cec-0969-4635-b9a9-dd32611f35a4\";\n-    public static String ep3Id = \"64353fd7-b60c-4108-93ff-ecaa6b63a6a3\";\n-    public static String ep4Id = \"cae2df90-4a50-437e-a3f2-e3b742c8fbf8\";\n-    public static String ep5Id = \"364d2bbd-2def-4c70-9965-9ffd2165f43a\";\n-    public static String ep6Id = \"c60fe503-88a2-4198-a3be-85c197acd9db\";\n-    public static String ep7Id = \"38e45f95-5ea7-4d0a-9027-886febc27bdc\";\n-    public static String ep8Id = \"b81abf49-87ab-4a58-b457-93dc5a0dabac\";\n-\n-    public static VpcState customerVpcState =\n-            new VpcState(projectId, vpcId,\n-                    \"SuperVpc\",\n-                    \"10.0.0.0/16\");\n-\n-    // Large VPC\n-\n-    /////////////////////////////////\n-    // Physical network resources\n-    /////////////////////////////////\n-    public static String GATEWAY_MAC_ADDRESS = \"02:42:ac:11:00:0d\"; //\"0e:73:ae:c8:FF:FF\";\n-\n-    public static String TRANSIT_SWTICH_1_HOST_ID = \"switchhost_0\";\n-    public static byte[] TRANSIT_SWITCH_1_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 11};\n-    public static String TRANSIT_SWITCH_1_MAC = \"02:42:ac:11:00:0b\";\n-\n-    public static String TRANSIT_SWTICH_2_HOST_ID = \"switchhost_1\";\n-    public static byte[] TRANSIT_SWITCH_2_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 12};\n-    public static String TRANSIT_SWITCH_2_MAC = \"02:42:ac:11:00:0c\";\n-\n-    public static String TRANSIT_SWTICH_3_HOST_ID = \"switchhost_2\";\n-    public static byte[] TRANSIT_SWITCH_3_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 13};\n-    public static String TRANSIT_SWITCH_3_MAC = \"02:42:ac:11:00:0d\";\n-\n-    public static String TRANSIT_SWTICH_4_HOST_ID = \"switchhost_3\";\n-    public static byte[] TRANSIT_SWITCH_4_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 14};\n-    public static String TRANSIT_SWITCH_4_MAC = \"02:42:ac:11:00:0e\";\n-\n-    public static String TRANSIT_ROUTER_1_HOST_ID = \"routerhost_0\";\n-    public static byte[] TRANSIT_ROUTER_1_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 15};\n-    public static String TRANSIT_ROUTER_1_MAC = \"02:42:ac:11:00:0f\";\n-\n-    public static String TRANSIT_ROUTER_2_HOST_ID = \"routerhost_1\";\n-    public static byte[] TRANSIT_ROUTER_2_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 16};\n-    public static String TRANSIT_ROUTER_2_MAC = \"02:42:ac:11:00:10\";\n-\n-//    public static HostInfo[] transitRouterHosts = {\n-//            new HostInfo(\"vpc1-transit-router1\", \"transit router1 host\", DemoConfig.TRANSIT_ROUTER_1_IP, DemoConfig.TRANSIT_ROUTER_1_MAC),\n-//            new HostInfo(\"vpc1-transit-router2\", \"transit router2 host\", DemoConfig.TRANSIT_ROUTER_2_IP, DemoConfig.TRANSIT_ROUTER_2_MAC)\n-//    };\n-\n-    //    public static HostInfo[] transitRouterHosts = {\n-//            new HostInfo(\"vpc1-transit-router1\", \"transit router1 host\", new byte[]{FIRST_IP_BLOCK,17,0,(byte)(15)}, \"02:42:ac:11:00:0f\", 50011),\n-//            new HostInfo(\"vpc1-transit-router2\", \"transit router2 host\", new byte[]{FIRST_IP_BLOCK,17,0,(byte)(16)}, \"02:42:ac:11:00:10\", 50012)\n-//    };\n-    // Large VPC\n-    // (byte)(205-OVERFLOW_IP_CONVERSION)\n-    public static HostInfo[] transitRouterHosts = {\n-            new HostInfo(\"vpc1-transit-router1\", \"transit router1 host\", new byte[]{FIRST_IP_BLOCK, 17, 0, (byte) (6)}, \"02:42:ac:11:00:06\", 50001)\n-    };\n-\n-    public static HostInfo[] transitSwitchHosts = {\n-            new HostInfo(\"switchhost_0\", \"switchhost_0\", new byte[]{FIRST_IP_BLOCK, 17, 0, (byte) (7)}, \"02:42:ac:11:00:07\", 50002),\n-            new HostInfo(\"switchhost_1\", \"switchhost_1\", new byte[]{FIRST_IP_BLOCK, 17, 0, (byte) (8)}, \"02:42:ac:11:00:08\", 50003),\n-            new HostInfo(\"switchhost_2\", \"switchhost_2\", new byte[]{FIRST_IP_BLOCK, 17, 0, (byte) (9)}, \"02:42:ac:11:00:09\", 50004)\n-    };\n-\n-    public static String EP1_ID = \"ephost_0\";\n-    public static byte[] EP1_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 3};\n-    public static String EP1_HOST_MAC = \"02:42:ac:11:00:03\";\n-\n-    public static String EP2_ID = \"ephost_1\";\n-    public static byte[] EP2_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 4};\n-    public static String EP2_HOST_MAC = \"02:42:ac:11:00:04\";\n-\n-    public static String EP3_ID = \"ephost_2\";\n-    public static byte[] EP3_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 5};\n-    public static String EP3_HOST_MAC = \"02:42:ac:11:00:05\";\n-\n-    public static String EP4_ID = \"ephost_3\";\n-    public static byte[] EP4_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 6};\n-    public static String EP4_HOST_MAC = \"02:42:ac:11:00:06\";\n-\n-    public static String EP5_ID = \"ephost_4\";\n-    public static byte[] EP5_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 7};\n-    public static String EP5_HOST_MAC = \"02:42:ac:11:00:07\";\n-\n-    public static String EP6_ID = \"ephost_5\";\n-    public static byte[] EP6_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 8};\n-    public static String EP6_HOST_MAC = \"02:42:ac:11:00:08\";\n-\n-    public static String EP7_ID = \"ephost_6\";\n-    public static byte[] EP7_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 9};\n-    public static String EP7_HOST_MAC = \"02:42:ac:11:00:09\";\n-\n-    public static String EP8_ID = \"ephost_7\";\n-    public static byte[] EP8_HOST_IP = new byte[]{FIRST_IP_BLOCK, 17, 0, 10};\n-    public static String EP8_HOST_MAC = \"02:42:ac:11:00:0a\";\n-\n-    public static int epHostCounter = 0;\n-    public static List<HostInfo> epHosts = null;\n-    public static int epCounter = 0;\n-    public static int EP_PER_HOST = 1;\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMzMyNw==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398833327", "bodyText": "All common db related files should be moved out of vpcmanager directory.", "author": "xieus", "createdAt": "2020-03-26T19:23:14Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/dao/ICachePublisher.java", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/dao/ICachePublisher.java b/common-service/src/main/java/com/futurewei/common/repo/ICachePublisher.java\nsimilarity index 94%\nrename from vpcmanager/src/main/java/com/futurewei/vpcmanager/dao/ICachePublisher.java\nrename to common-service/src/main/java/com/futurewei/common/repo/ICachePublisher.java\nindex b8fd1295..43ef2589 100644\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/dao/ICachePublisher.java\n+++ b/common-service/src/main/java/com/futurewei/common/repo/ICachePublisher.java\n\n@@ -14,7 +14,7 @@ Licensed under the Apache License, Version 2.0 (the \"License\");\n         limitations under the License.\n */\n \n-package com.futurewei.vpcmanager.dao;\n+package com.futurewei.common.repo;\n \n public interface ICachePublisher {\n     void publish(final String message);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMzU5NQ==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398833595", "bodyText": "Remove this file.", "author": "xieus", "createdAt": "2020-03-26T19:23:44Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/HostInfo.java", "diffHunk": "@@ -0,0 +1,109 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/HostInfo.java b/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/HostInfo.java\ndeleted file mode 100644\nindex 28d39525..00000000\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/HostInfo.java\n+++ /dev/null\n\n@@ -1,109 +0,0 @@\n-/*\n-Copyright 2019 The Alcor Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-        you may not use this file except in compliance with the License.\n-        You may obtain a copy of the License at\n-\n-        http://www.apache.org/licenses/LICENSE-2.0\n-\n-        Unless required by applicable law or agreed to in writing, software\n-        distributed under the License is distributed on an \"AS IS\" BASIS,\n-        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-        See the License for the specific language governing permissions and\n-        limitations under the License.\n-*/\n-\n-package com.futurewei.vpcmanager.entity;\n-\n-import com.futurewei.vpcmanager.comm.logging.Logger;\n-import com.futurewei.vpcmanager.comm.logging.LoggerFactory;\n-import lombok.Data;\n-\n-import java.net.InetAddress;\n-import java.net.UnknownHostException;\n-import java.util.logging.Level;\n-import java.util.regex.Matcher;\n-import java.util.regex.Pattern;\n-\n-@Data\n-public class HostInfo {\n-\n-    private String id;\n-    private InetAddress localIp;\n-    private String macAddress;\n-    private int gRPCServerPort;\n-\n-    public HostInfo(String hostId, String hostName, byte[] ipAddress, String macAddress, int gRPCServerPort) {\n-        this(hostId, hostName, ipAddress, macAddress);\n-        this.gRPCServerPort = gRPCServerPort;\n-    }\n-\n-    public HostInfo(String hostId, String hostName, byte[] ipAddress, String macAddress) {\n-\n-        Logger logger = LoggerFactory.getLogger();\n-\n-        this.id = hostId;\n-\n-        try {\n-            this.localIp = InetAddress.getByAddress(hostName, ipAddress);\n-            if (this.validate(macAddress)) {\n-                this.macAddress = macAddress;\n-            } else {\n-                this.macAddress = null;\n-            }\n-        } catch (UnknownHostException e) {\n-            logger.log(Level.SEVERE, \"Invalid ip address\" + ipAddress, e);\n-        }\n-    }\n-\n-    public String getHostName() {\n-        return this.localIp.getHostName();\n-    }\n-\n-    public String getHostIpAddress() {\n-        return this.localIp.getHostAddress();\n-    }\n-\n-    public String getHostMacAddress() {\n-        return this.macAddress;\n-    }\n-\n-    private boolean validate(String mac) {\n-        Pattern p = Pattern.compile(\"^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$\");\n-        Matcher m = p.matcher(mac);\n-        return m.find();\n-    }\n-\n-    public String getId() {\n-        return id;\n-    }\n-\n-    public void setId(String id) {\n-        this.id = id;\n-    }\n-\n-    public InetAddress getLocalIp() {\n-        return localIp;\n-    }\n-\n-    public void setLocalIp(InetAddress localIp) {\n-        this.localIp = localIp;\n-    }\n-\n-    public String getMacAddress() {\n-        return macAddress;\n-    }\n-\n-    public void setMacAddress(String macAddress) {\n-        this.macAddress = macAddress;\n-    }\n-\n-    public int getGRPCServerPort() {\n-        return gRPCServerPort;\n-    }\n-\n-    public void setGRPCServerPort(int gRPCServerPort) {\n-        this.gRPCServerPort = gRPCServerPort;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzMzc4Mg==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398833782", "bodyText": "Remove.", "author": "xieus", "createdAt": "2020-03-26T19:24:00Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/NodeManager.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/NodeManager.java b/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/NodeManager.java\ndeleted file mode 100644\nindex 1cf5c9e0..00000000\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/entity/NodeManager.java\n+++ /dev/null\n\n@@ -1,118 +0,0 @@\n-/*\n-Copyright 2019 The Alcor Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-        you may not use this file except in compliance with the License.\n-        You may obtain a copy of the License at\n-\n-        http://www.apache.org/licenses/LICENSE-2.0\n-\n-        Unless required by applicable law or agreed to in writing, software\n-        distributed under the License is distributed on an \"AS IS\" BASIS,\n-        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-        See the License for the specific language governing permissions and\n-        limitations under the License.\n-*/\n-\n-package com.futurewei.vpcmanager.entity;\n-\n-import com.futurewei.vpcmanager.comm.logging.Logger;\n-import com.futurewei.vpcmanager.comm.logging.LoggerFactory;\n-import com.futurewei.vpcmanager.utils.CommonUtil;\n-import lombok.Data;\n-\n-import java.util.ArrayList;\n-import java.util.HashMap;\n-import java.util.List;\n-import java.util.logging.Level;\n-\n-@Data\n-public class NodeManager {\n-    private static int GRPC_SERVER_PORT = 50001;\n-    private List<HostInfo> nodes;\n-    private HashMap<String, HostInfo> nodeMap;\n-\n-    public NodeManager(List<HostInfo> hosts) {\n-        Logger logger = LoggerFactory.getLogger();\n-        logger.entering(this.getClass().getName(), \"NodeManager(List<HostInfo> hosts)\");\n-\n-        this.nodes = NodeManager.LoadNodes(hosts);\n-        for (HostInfo host : hosts) {\n-            System.out.println(host);\n-            logger.log(Level.INFO, \"Log:\" + host);\n-        }\n-        this.BuildMapFromNodeIdToInfo(this.nodes);\n-        logger.exiting(this.getClass().getName(), \"NodeManager(List<HostInfo> hosts)\");\n-\n-    }\n-\n-    private static List<HostInfo> LoadNodes(List<HostInfo> hosts) {\n-        List<HostInfo> hostInfoList = new ArrayList<>(hosts);\n-        for (int i = 0; i < hostInfoList.size(); i++) {\n-            HostInfo host = hostInfoList.get(i);\n-            host.setGRPCServerPort(NodeManager.GRPC_SERVER_PORT);\n-        }\n-\n-        return hostInfoList;\n-    }\n-\n-    public HostInfo getHostInfoById(String hostId) {\n-        Logger logger = LoggerFactory.getLogger();\n-        if (this.nodeMap != null) { //&& !Strings.isNullOrEmpty(hostId)) {\n-            logger.log(Level.INFO, \"Log:\" + \"[NodeManager] Host id: \" + hostId + \" info:\" + this.nodeMap.get(hostId));\n-            return this.nodeMap.get(hostId);\n-        }\n-        logger.log(Level.WARNING, \"[NodeManager] node map is empty\");\n-        return null;\n-    }\n-\n-    public HostInfo[] getRandomHosts(int count) {\n-        HostInfo[] randomHosts = new HostInfo[count];\n-\n-        for (int i = 0; i < count; i++) {\n-            int index = CommonUtil.getRandomNumberInRange(0, this.getNodes().size() - 1);\n-            randomHosts[i] = this.getNodes().get(index);\n-        }\n-\n-        return randomHosts;\n-    }\n-\n-    private void BuildMapFromNodeIdToInfo(List<HostInfo> hosts) {\n-        Logger logger = LoggerFactory.getLogger();\n-        logger.log(Level.INFO, \"Entering BuildMapFromNodeIdToInfo\");\n-        if (hosts != null) {\n-            if (this.nodeMap == null) {\n-                this.nodeMap = new HashMap<>();\n-            }\n-\n-            logger.log(Level.INFO, \"hosts size : \" + hosts.size());\n-            for (HostInfo host : hosts) {\n-                this.nodeMap.put(host.getId(), host);\n-            }\n-        }\n-    }\n-\n-    public static int getGrpcServerPort() {\n-        return GRPC_SERVER_PORT;\n-    }\n-\n-    public static void setGrpcServerPort(int grpcServerPort) {\n-        GRPC_SERVER_PORT = grpcServerPort;\n-    }\n-\n-    public List<HostInfo> getNodes() {\n-        return nodes;\n-    }\n-\n-    public void setNodes(List<HostInfo> nodes) {\n-        this.nodes = nodes;\n-    }\n-\n-    public HashMap<String, HostInfo> getNodeMap() {\n-        return nodeMap;\n-    }\n-\n-    public void setNodeMap(HashMap<String, HostInfo> nodeMap) {\n-        this.nodeMap = nodeMap;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgzNDIwOA==", "url": "https://github.com/futurewei-cloud/alcor/pull/134#discussion_r398834208", "bodyText": "Remove.", "author": "xieus", "createdAt": "2020-03-26T19:24:37Z", "path": "vpcmanager/src/main/java/com/futurewei/vpcmanager/utils/OneBoxUtil.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+Copyright 2019 The Alcor Authors.", "originalCommit": "2b6a43fb0ae185b880969b49ce852434d1799a24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "49ad0b0272ef71832af87ff93ab68c80a8300121", "chunk": "diff --git a/vpcmanager/src/main/java/com/futurewei/vpcmanager/utils/OneBoxUtil.java b/vpcmanager/src/main/java/com/futurewei/vpcmanager/utils/OneBoxUtil.java\ndeleted file mode 100644\nindex 6f8b7762..00000000\n--- a/vpcmanager/src/main/java/com/futurewei/vpcmanager/utils/OneBoxUtil.java\n+++ /dev/null\n\n@@ -1,53 +0,0 @@\n-/*\n-Copyright 2019 The Alcor Authors.\n-\n-Licensed under the Apache License, Version 2.0 (the \"License\");\n-        you may not use this file except in compliance with the License.\n-        You may obtain a copy of the License at\n-\n-        http://www.apache.org/licenses/LICENSE-2.0\n-\n-        Unless required by applicable law or agreed to in writing, software\n-        distributed under the License is distributed on an \"AS IS\" BASIS,\n-        WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-        See the License for the specific language governing permissions and\n-        limitations under the License.\n-*/\n-\n-package com.futurewei.vpcmanager.utils;\n-\n-import com.futurewei.vpcmanager.config.OneBoxConfig;\n-import com.futurewei.vpcmanager.entity.HostInfo;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-// NOTE: This file is only used for demo purpose.\n-//       Please don't use it in production\n-public class OneBoxUtil {\n-\n-    private static final int THREADS_LIMIT = 100;\n-    private static final int TIMEOUT = 600;\n-\n-\n-    public static List<HostInfo> LoadNodes(List<HostInfo> hosts) {\n-        List<HostInfo> hostInfoList = new ArrayList<>(hosts);\n-        for (int i = 0; i < hostInfoList.size(); i++) {\n-            HostInfo host = hostInfoList.get(i);\n-            host.setGRPCServerPort(OneBoxConfig.GRPC_SERVER_PORT + i);\n-        }\n-\n-        return hostInfoList;\n-    }\n-\n-    // This function generates port state solely based on the container host\n-\n-    private static String GenereateMacAddress(int index) {\n-        return \"0e:73:ae:c8:\" + Integer.toHexString((index + 6) / 256) + \":\" + Integer.toHexString((index + 6) % 256);\n-    }\n-\n-    private static String GenereateIpAddress(int index) {\n-        return \"10.0.\" + (index + 6) / 256 + \".\" + (index + 6) % 256;\n-    }\n-\n-}\n"}}, {"oid": "49ad0b0272ef71832af87ff93ab68c80a8300121", "url": "https://github.com/futurewei-cloud/alcor/commit/49ad0b0272ef71832af87ff93ab68c80a8300121", "message": "common service and updated vpcmanager", "committedDate": "2020-03-27T07:02:52Z", "type": "commit"}, {"oid": "c9935f10df13ca8e7cfff10ad9f07fdbfc61eb4f", "url": "https://github.com/futurewei-cloud/alcor/commit/c9935f10df13ca8e7cfff10ad9f07fdbfc61eb4f", "message": "Rename directory name from Common-service to lib", "committedDate": "2020-03-27T07:28:26Z", "type": "commit"}, {"oid": "3f04333e9042ae0c9577c875f9c430a3d78b5aa2", "url": "https://github.com/futurewei-cloud/alcor/commit/3f04333e9042ae0c9577c875f9c430a3d78b5aa2", "message": "Move lib files under com.futurewei.alcor.common", "committedDate": "2020-03-27T07:34:01Z", "type": "commit"}, {"oid": "715675ee72a3518e87c9280a57ffe52fa242b3e8", "url": "https://github.com/futurewei-cloud/alcor/commit/715675ee72a3518e87c9280a57ffe52fa242b3e8", "message": "fix package paths in lib", "committedDate": "2020-03-27T07:53:44Z", "type": "commit"}, {"oid": "4de3c83ba533eb941ab9a2392f863eda36baa0a9", "url": "https://github.com/futurewei-cloud/alcor/commit/4de3c83ba533eb941ab9a2392f863eda36baa0a9", "message": "Rename package path to com.futurewei.alcor.vpcmanager", "committedDate": "2020-03-27T08:04:01Z", "type": "commit"}, {"oid": "8d2a24da02a5540318f52d288030fbab99b776b6", "url": "https://github.com/futurewei-cloud/alcor/commit/8d2a24da02a5540318f52d288030fbab99b776b6", "message": "Update common jar and use latest package path in vpcmanager", "committedDate": "2020-03-27T08:12:46Z", "type": "commit"}, {"oid": "84b4cd58ce61c78df855a5feca4bed2b6c4cc760", "url": "https://github.com/futurewei-cloud/alcor/commit/84b4cd58ce61c78df855a5feca4bed2b6c4cc760", "message": "update vpc manager jar package name", "committedDate": "2020-03-27T08:14:40Z", "type": "commit"}, {"oid": "00328559311fede7087bf48ed328008e748f2b0b", "url": "https://github.com/futurewei-cloud/alcor/commit/00328559311fede7087bf48ed328008e748f2b0b", "message": "change Dockerfilr", "committedDate": "2020-03-27T17:19:05Z", "type": "commit"}, {"oid": "510fe4aced4f39764ac8f5a30df4783a67bef57a", "url": "https://github.com/futurewei-cloud/alcor/commit/510fe4aced4f39764ac8f5a30df4783a67bef57a", "message": "delete useless file", "committedDate": "2020-03-27T17:22:43Z", "type": "commit"}, {"oid": "2d1cca813255fedeb2cbd2662cbfb6b50e10f7b5", "url": "https://github.com/futurewei-cloud/alcor/commit/2d1cca813255fedeb2cbd2662cbfb6b50e10f7b5", "message": "Reformat some files in vpc manager", "committedDate": "2020-03-27T17:48:42Z", "type": "commit"}, {"oid": "b0a81d3ec168f2f1b55af276bcbe58d1255d1266", "url": "https://github.com/futurewei-cloud/alcor/commit/b0a81d3ec168f2f1b55af276bcbe58d1255d1266", "message": "Reformat files in common lib", "committedDate": "2020-03-27T17:55:22Z", "type": "commit"}]}