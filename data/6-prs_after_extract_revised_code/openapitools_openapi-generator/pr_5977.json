{"pr_number": 5977, "pr_title": "Restore allOf behaviour (model composition) for definition with a single schema reference", "pr_createdAt": "2020-04-19T04:52:47Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/5977", "timeline": [{"oid": "5c23b1be6071a6e1d66954b2fef5aeb35a9089ce", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5c23b1be6071a6e1d66954b2fef5aeb35a9089ce", "message": "Fixes getParentName function", "committedDate": "2020-04-19T16:33:55Z", "type": "commit"}, {"oid": "90660282c8fef67863b62a061a1666a52cc07fb2", "url": "https://github.com/OpenAPITools/openapi-generator/commit/90660282c8fef67863b62a061a1666a52cc07fb2", "message": "Updates getChildrenMap to not throw a NPE", "committedDate": "2020-04-19T16:33:55Z", "type": "commit"}, {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "message": "Updates test", "committedDate": "2020-04-19T17:00:22Z", "type": "commit"}, {"oid": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "message": "Updates test", "committedDate": "2020-04-19T17:00:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzIzMw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947233", "bodyText": "This filtering prevents a NPE from happening when getParentName returns null, that's why I deleted the comment on line 1107 on the left. If I omit this filtering, the NPE is seen when we run our tests.", "author": "spacether", "createdAt": "2020-04-19T17:04:09Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1104,9 +1104,9 @@ public static Header getHeader(OpenAPI openAPI, String name) {\n     public static Map<String, List<String>> getChildrenMap(OpenAPI openAPI) {\n         Map<String, Schema> allSchemas = getSchemas(openAPI);\n \n-        // FIXME: The collect here will throw NPE if a spec document has only a single oneOf hierarchy.\n         Map<String, List<Entry<String, Schema>>> groupedByParent = allSchemas.entrySet().stream()\n             .filter(entry -> isComposedSchema(entry.getValue()))\n+                .filter(entry -> getParentName((ComposedSchema) entry.getValue(), allSchemas)!=null)", "originalCommit": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzI2Mg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947262", "bodyText": "reverted to original code", "author": "spacether", "createdAt": "2020-04-19T17:04:22Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1165,14 +1165,6 @@ public static String getParentName(ComposedSchema composedSchema, Map<String, Sc\n         int nullSchemaChildrenCount = 0;\n         boolean hasAmbiguousParents = false;\n         List<String> refedWithoutDiscriminator = new ArrayList<>();\n-        String schemaName = \"\";\n-        for (String thisSchemaName : allSchemas.keySet()) {\n-            Schema sc = allSchemas.get(thisSchemaName);\n-            if (isComposedSchema(sc) && (ComposedSchema) sc == composedSchema) {\n-                schemaName = thisSchemaName;\n-                break;\n-            }\n-        }", "originalCommit": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk0NzI3NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/5977#discussion_r410947274", "bodyText": "reverted to original code", "author": "spacether", "createdAt": "2020-04-19T17:04:33Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/utils/ModelUtils.java", "diffHunk": "@@ -1189,10 +1181,7 @@ public static String getParentName(ComposedSchema composedSchema, Map<String, Sc\n                     } else {\n                         // not a parent since discriminator.propertyName is not set\n                         hasAmbiguousParents = true;\n-                        boolean isNotExtractedInlineSchema = !parentName.equals(schemaName+\"_allOf\");\n-                        if (isNotExtractedInlineSchema) {\n-                            refedWithoutDiscriminator.add(parentName);\n-                        }\n+                        refedWithoutDiscriminator.add(parentName);", "originalCommit": "3d3e682afaf6ab73dc2ca12d11df5e3efad8ed3b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "161e7593a6fc9ff258cf726240dc6726d90e9242", "url": "https://github.com/OpenAPITools/openapi-generator/commit/161e7593a6fc9ff258cf726240dc6726d90e9242", "message": "Runs ensure up to date", "committedDate": "2020-04-19T18:52:26Z", "type": "commit"}]}