{"pr_number": 8054, "pr_title": "Stackoverflow in toExampleValue() for python client", "pr_createdAt": "2020-11-30T21:30:29Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/8054", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAyNTA0OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8054#discussion_r533025049", "bodyText": "Shouldn't we only add a model when we have finished generating its sample?\nWhat are our recursive base cases here for cycles?\nHow about naming them seenModels because we have not finished processing it yet.", "author": "spacether", "createdAt": "2020-12-01T02:06:13Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientCodegen.java", "diffHunk": "@@ -948,6 +949,18 @@ private String toExampleValueRecursive(String modelName, Schema schema, Object o\n         if (objExample != null) {\n             example = objExample.toString();\n         }\n+\n+        // check for recursive model\n+        if (processedModels.contains(modelName)) {\n+            // have already processed this model\n+            // this happens when you have recursive or circular models\n+            return fullPrefix + modelName + closeChars;\n+        } else if(modelName != null && !modelName.isEmpty()){\n+            // if the model is non-null and non-empty, add it to the set\n+            processedModels.add(modelName);", "originalCommit": "cacc4d62ee6333d6b419d6ef25600e9876205da6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAyNjIxMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8054#discussion_r533026212", "bodyText": "I'll go back and take a look at this again, thanks.  I didn't realize that the 'ran /bin/utils/ensure-up-to-date' was required and didn't pick up on the fact that my examples had changed that.", "author": "fbl100", "createdAt": "2020-12-01T02:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAyNTA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTc4MDkwNQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8054#discussion_r541780905", "bodyText": "@spacether Got a CircleCI build error that I'm having  a hard time interpreting.  Do you mind taking a look and providing pointers for how to reproduce locally?", "author": "fbl100", "createdAt": "2020-12-12T21:08:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAyNTA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkxNTQ2Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/8054#discussion_r542915466", "bodyText": "That error is unrelated. We. can ignore it.", "author": "spacether", "createdAt": "2020-12-14T23:15:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAyNTA0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "47da5e52f334f4110b23dd1cd8bfa3341d311ef2", "chunk": "diff --git a/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientCodegen.java b/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientCodegen.java\nindex 7e7c4d4132b..68e3dc4ae07 100644\n--- a/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientCodegen.java\n+++ b/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientCodegen.java\n\n@@ -949,18 +952,11 @@ public class PythonClientCodegen extends PythonLegacyClientCodegen {\n         if (objExample != null) {\n             example = objExample.toString();\n         }\n-\n-        // check for recursive model\n-        if (processedModels.contains(modelName)) {\n-            // have already processed this model\n-            // this happens when you have recursive or circular models\n+        // checks if the current schema has already been passed in. If so, breaks the current recursive pass\n+        if (seenSchemas.contains(schema)){\n             return fullPrefix + modelName + closeChars;\n-        } else if(modelName != null && !modelName.isEmpty()){\n-            // if the model is non-null and non-empty, add it to the set\n-            processedModels.add(modelName);\n         }\n \n-\n         if (null != schema.get$ref()) {\n             Map<String, Schema> allDefinitions = ModelUtils.getSchemas(this.openAPI);\n             String ref = ModelUtils.getSimpleRef(schema.get$ref());\n"}}, {"oid": "47da5e52f334f4110b23dd1cd8bfa3341d311ef2", "url": "https://github.com/OpenAPITools/openapi-generator/commit/47da5e52f334f4110b23dd1cd8bfa3341d311ef2", "message": "Fixes issue 8052: Stackoverflow in toExampleValue() for python client\n\nAdded a Set<String> in toExampleValueRecursive() to keep track of which models we have\ngenerated to avoid an infinite recursion for recursive models.  An example of a recursive\nmodel would be a GeoJson GeometryCollection.", "committedDate": "2020-12-11T19:49:17Z", "type": "forcePushed"}, {"oid": "0cd251d923e73b5e5c6f4a9185781c28601b9032", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0cd251d923e73b5e5c6f4a9185781c28601b9032", "message": "Fixes issue 8052: Stackoverflow in toExampleValue() for python client\n\nAdded a Set<String> in toExampleValueRecursive() to keep track of which models we have\ngenerated to avoid an infinite recursion for recursive models.  An example of a recursive\nmodel would be a GeoJson GeometryCollection.", "committedDate": "2020-12-18T14:40:19Z", "type": "forcePushed"}, {"oid": "63ac823cc8dbda3cf0d6da8d65f79b8930349975", "url": "https://github.com/OpenAPITools/openapi-generator/commit/63ac823cc8dbda3cf0d6da8d65f79b8930349975", "message": "Fixes issue 8052: Stackoverflow in toExampleValue() for python client\n\nAdded a Set<String> in toExampleValueRecursive() to keep track of which models we have\ngenerated to avoid an infinite recursion for recursive models.  An example of a recursive\nmodel would be a GeoJson GeometryCollection.", "committedDate": "2020-12-24T15:49:50Z", "type": "forcePushed"}, {"oid": "3206b2b1a9e67b124b71f570d4279d1ac6fc3bda", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3206b2b1a9e67b124b71f570d4279d1ac6fc3bda", "message": "Fixes issue 8052: Stackoverflow in toExampleValue() for python client\n\nAdded a Set<String> in toExampleValueRecursive() to keep track of which models we have\ngenerated to avoid an infinite recursion for recursive models.  An example of a recursive\nmodel would be a GeoJson GeometryCollection.", "committedDate": "2020-12-28T13:50:31Z", "type": "commit"}, {"oid": "3206b2b1a9e67b124b71f570d4279d1ac6fc3bda", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3206b2b1a9e67b124b71f570d4279d1ac6fc3bda", "message": "Fixes issue 8052: Stackoverflow in toExampleValue() for python client\n\nAdded a Set<String> in toExampleValueRecursive() to keep track of which models we have\ngenerated to avoid an infinite recursion for recursive models.  An example of a recursive\nmodel would be a GeoJson GeometryCollection.", "committedDate": "2020-12-28T13:50:31Z", "type": "forcePushed"}]}