{"pr_number": 6585, "pr_title": "Enhancement/kotlin/apiclient and auth", "pr_createdAt": "2020-06-08T10:53:42Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6585", "timeline": [{"oid": "01aeb8587f62629854d538c47c4c5505c13496f5", "url": "https://github.com/OpenAPITools/openapi-generator/commit/01aeb8587f62629854d538c47c4c5505c13496f5", "message": "Add multiple auth methods to ApiClient. ApiClient more configurable", "committedDate": "2020-06-08T10:42:16Z", "type": "commit"}, {"oid": "971373d46e0c5927eedbb22bcb1b24fa0f8d5fff", "url": "https://github.com/OpenAPITools/openapi-generator/commit/971373d46e0c5927eedbb22bcb1b24fa0f8d5fff", "message": "Fixed missing close tag for isMultipart in api.mustache", "committedDate": "2020-06-08T10:43:49Z", "type": "commit"}, {"oid": "46331ed03e7db31b545d115cdd463fbcd4874eba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/46331ed03e7db31b545d115cdd463fbcd4874eba", "message": "Generated samples ./bin/kotlin-client-all.sh", "committedDate": "2020-06-08T10:44:00Z", "type": "commit"}, {"oid": "b647b3daade17aa779534c5b37c42c133182d906", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b647b3daade17aa779534c5b37c42c133182d906", "message": "Generated samples./bin/openapi3/kotlin-client-petstore-all.sh", "committedDate": "2020-06-08T10:44:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk5NzA2OA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6585#discussion_r437997068", "bodyText": "@ch4rl3x thanks for the PR. Can you please PM me via Slack on this?\nWe've a better way to add supporting files based on conditions.", "author": "wing328", "createdAt": "2020-06-10T09:43:11Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/KotlinClientCodegen.java", "diffHunk": "@@ -574,6 +583,22 @@ private void commonSupportingFiles() {\n                     }\n                 }\n \n+                if (usesRetrofit2Library() && StringUtils.isNotEmpty(operation.path) && operation.path.startsWith(\"/\")) {\n+                    operation.path = operation.path.substring(1);\n+                    if (ProcessUtils.hasOAuthMethods(objs)) {\n+                        supportingFiles.add(new SupportingFile(\"auth/ApiKeyAuth.kt.mustache\", authFolder, \"ApiKeyAuth.kt\"));\n+                        supportingFiles.add(new SupportingFile(\"auth/OAuth.kt.mustache\", authFolder, \"OAuth.kt\"));\n+                        supportingFiles.add(new SupportingFile(\"auth/OAuthFlow.kt.mustache\", authFolder, \"OAuthFlow.kt\"));\n+                        supportingFiles.add(new SupportingFile(\"auth/OAuthOkHttpClient.kt.mustache\", authFolder, \"OAuthOkHttpClient.kt\"));\n+                    }\n+                    if(ProcessUtils.hasBearerMethods(objs)) {\n+                        supportingFiles.add(new SupportingFile(\"auth/HttpBearerAuth.kt.mustache\", authFolder, \"HttpBearerAuth.kt\"));\n+                    }\n+                    if(ProcessUtils.hasHttpBasicMethods(objs)) {\n+                        supportingFiles.add(new SupportingFile(\"auth/HttpBasicAuth.kt.mustache\", authFolder, \"HttpBasicAuth.kt\"));\n+                    }", "originalCommit": "b647b3daade17aa779534c5b37c42c133182d906", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "039b25b9ba3a6c041e21765fb8be8ad326bed57b", "chunk": "diff --git a/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/KotlinClientCodegen.java b/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/KotlinClientCodegen.java\nindex 6103c6f2520..dd69d63ae12 100644\n--- a/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/KotlinClientCodegen.java\n+++ b/modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/KotlinClientCodegen.java\n\n@@ -583,20 +598,8 @@ public class KotlinClientCodegen extends AbstractKotlinCodegen {\n                     }\n                 }\n \n-                if (usesRetrofit2Library() && StringUtils.isNotEmpty(operation.path) && operation.path.startsWith(\"/\")) {\n+                if (StringUtils.isNotEmpty(operation.path) && operation.path.startsWith(\"/\")) {\n                     operation.path = operation.path.substring(1);\n-                    if (ProcessUtils.hasOAuthMethods(objs)) {\n-                        supportingFiles.add(new SupportingFile(\"auth/ApiKeyAuth.kt.mustache\", authFolder, \"ApiKeyAuth.kt\"));\n-                        supportingFiles.add(new SupportingFile(\"auth/OAuth.kt.mustache\", authFolder, \"OAuth.kt\"));\n-                        supportingFiles.add(new SupportingFile(\"auth/OAuthFlow.kt.mustache\", authFolder, \"OAuthFlow.kt\"));\n-                        supportingFiles.add(new SupportingFile(\"auth/OAuthOkHttpClient.kt.mustache\", authFolder, \"OAuthOkHttpClient.kt\"));\n-                    }\n-                    if(ProcessUtils.hasBearerMethods(objs)) {\n-                        supportingFiles.add(new SupportingFile(\"auth/HttpBearerAuth.kt.mustache\", authFolder, \"HttpBearerAuth.kt\"));\n-                    }\n-                    if(ProcessUtils.hasHttpBasicMethods(objs)) {\n-                        supportingFiles.add(new SupportingFile(\"auth/HttpBasicAuth.kt.mustache\", authFolder, \"HttpBasicAuth.kt\"));\n-                    }\n                 }\n \n                 // modify the data type of binary form parameters to a more friendly type for multiplatform builds\n"}}, {"oid": "039b25b9ba3a6c041e21765fb8be8ad326bed57b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/039b25b9ba3a6c041e21765fb8be8ad326bed57b", "message": "Use of better way to add supporting files based on conditions", "committedDate": "2020-06-10T11:12:34Z", "type": "commit"}, {"oid": "ce8f8f5caa5092c4115f908522a38bba58b19a56", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ce8f8f5caa5092c4115f908522a38bba58b19a56", "message": "Merge branch 'master' into enhancement/kotlin/apiclient_and_auth", "committedDate": "2020-06-10T11:14:46Z", "type": "commit"}, {"oid": "b70538f23cb58509059423e4e4cc638875248f22", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b70538f23cb58509059423e4e4cc638875248f22", "message": "Fixed missing check for retrofit generating auth files", "committedDate": "2020-06-10T13:29:37Z", "type": "commit"}, {"oid": "0a44be0e605dfa01a5e040e4cc138ede2cf51e0e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0a44be0e605dfa01a5e040e4cc138ede2cf51e0e", "message": "Generated samples", "committedDate": "2020-06-10T13:34:42Z", "type": "commit"}]}