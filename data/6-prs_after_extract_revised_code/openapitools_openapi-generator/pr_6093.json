{"pr_number": 6093, "pr_title": "Propagate deprecated property through $ref's", "pr_createdAt": "2020-04-28T19:58:29Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6093", "timeline": [{"oid": "867d47dd6d6ae744479af47c9f18fa4a3a22eb5b", "url": "https://github.com/OpenAPITools/openapi-generator/commit/867d47dd6d6ae744479af47c9f18fa4a3a22eb5b", "message": "Propagate deprecated property through $ref's\n\nAs $ref is supposed to completely replace the definition of a property,\nmake sure we also include the 'deprecated' property when generating the\ntype of a $ref property.\n\nThis makes a property $ref'ing a deprecated schema also become deprecated.", "committedDate": "2020-04-28T19:51:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE3Mzc1Mw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6093#discussion_r417173753", "bodyText": "@asmundg thanks for the PR. In https://github.com/OpenAPITools/openapi-generator/pull/6093/files#diff-7cb46fa53f89a458a7b7cb201d2214a8R2820, we should have \"unalias\" (dereference) the schema so looks like something wrong with the unaliasing that we need to fix. I'll take another look when I've time later this week.\nI think I've a better understanding of this fix after reviewing a bit more.\nCan you please add a comment in line 2848 to explain this particular condition (the reference model is deprecated and therefore setting the property to deprecated) ?", "author": "wing328", "createdAt": "2020-04-29T09:12:11Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java", "diffHunk": "@@ -2844,6 +2844,14 @@ public CodegenProperty fromProperty(String name, Schema p) {\n \n         if (p.getDeprecated() != null) {\n             property.deprecated = p.getDeprecated();\n+        } else if (p.get$ref() != null) {\n+            String ref = ModelUtils.getSimpleRef(p.get$ref());\n+            if (ref != null) {\n+                Schema referencedSchema = ModelUtils.getSchemas(this.openAPI).get(ref);\n+                if (referencedSchema != null && referencedSchema.getDeprecated() != null) {\n+                    property.deprecated = referencedSchema.getDeprecated();\n+                }\n+            }", "originalCommit": "867d47dd6d6ae744479af47c9f18fa4a3a22eb5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI0NzQwOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6093#discussion_r417247408", "bodyText": "Gah, I lost a comment block in rebasing there. Thanks for pointing it out.", "author": "asmundg", "createdAt": "2020-04-29T11:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE3Mzc1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6e716f49053b17485c97f9589f7d93232b36f23f", "chunk": "diff --git a/modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java b/modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java\nindex d1ca819778a..cc1aecbecc1 100644\n--- a/modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java\n+++ b/modules/openapi-generator/src/main/java/org/openapitools/codegen/DefaultCodegen.java\n\n@@ -2845,6 +2845,9 @@ public class DefaultCodegen implements CodegenConfig {\n         if (p.getDeprecated() != null) {\n             property.deprecated = p.getDeprecated();\n         } else if (p.get$ref() != null) {\n+            // Since $ref should be replaced with the model it refers\n+            // to, $ref'ing a model with 'deprecated' set should cause\n+            // the property to reflect the model's 'deprecated' value.\n             String ref = ModelUtils.getSimpleRef(p.get$ref());\n             if (ref != null) {\n                 Schema referencedSchema = ModelUtils.getSchemas(this.openAPI).get(ref);\n"}}, {"oid": "6e716f49053b17485c97f9589f7d93232b36f23f", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6e716f49053b17485c97f9589f7d93232b36f23f", "message": "Clarify why we're messing around with $ref", "committedDate": "2020-04-29T11:39:16Z", "type": "commit"}]}