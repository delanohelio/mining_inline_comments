{"pr_number": 703, "pr_title": "fix(deps, prov-service): Remove SDK-side validation of max twin depth", "pr_createdAt": "2020-02-06T22:53:08Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/703", "timeline": [{"oid": "748bc5710098426f0ae30807a40d7a61468ff0cf", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/748bc5710098426f0ae30807a40d7a61468ff0cf", "message": "fix(deps, prov-service): Remove SDK-side validation of max twin depth\n\nDepth limits may be arbitrarily changed by services, so there is no reason to validate them on the SDK side", "committedDate": "2020-02-06T22:50:46Z", "type": "commit"}, {"oid": "292156328a1b0daace597f2bea861de0153c0a07", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/292156328a1b0daace597f2bea861de0153c0a07", "message": "Merge branch 'master' into twinDepth", "committedDate": "2020-02-07T00:09:21Z", "type": "commit"}, {"oid": "0cfd49a5fc05078126b8b8affee59bcbfca6ac87", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/0cfd49a5fc05078126b8b8affee59bcbfca6ac87", "message": "to squash", "committedDate": "2020-02-07T18:29:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0NDQ5Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/703#discussion_r376644493", "bodyText": "is the allow metadata still being used for any validation?", "author": "abhipsaMisra", "createdAt": "2020-02-07T22:52:10Z", "path": "deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/ParserUtility.java", "diffHunk": "@@ -234,17 +226,7 @@ private static void validateMapInternal(Map<String, Object> map, int level, int\n             if((value != null) && (value instanceof Map))\n             {\n                 /* Codes_SRS_PARSER_UTILITY_21_052: [The validateMap shall throws IllegalArgumentException if the provided map contains more than maxLevel levels and those extra levels contain more than just metadata.] */\n-                if(level <= maxLevel)\n-                {\n-                    validateMapInternal((Map<String, Object>) value, level, maxLevel, allowMetadata);\n-                }\n-                else\n-                {\n-                    if (!mapOnlyContainsMetaData((Map<String, Object>)value))\n-                    {\n-                        throw new IllegalArgumentException(\"Map exceed maximum of \" + maxLevel + \" levels\");\n-                    }\n-                }\n+                validateMapInternal((Map<String, Object>) value, allowMetadata);", "originalCommit": "0cfd49a5fc05078126b8b8affee59bcbfca6ac87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0NDkwOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/703#discussion_r376644908", "bodyText": "there are other validations still being done; valid characters, size etc. This might be a good time to scrub through those and remove them.", "author": "abhipsaMisra", "createdAt": "2020-02-07T22:53:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0NDQ5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0NjkxNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/703#discussion_r376646914", "bodyText": "There are still a few validations on things like that which we could get rid of, sure. I'll take those out too.", "author": "timtay-microsoft", "createdAt": "2020-02-07T23:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjY0NDQ5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "e58a1d2fc1a7ce85b8953a63255a66cc0e18a39a", "chunk": "diff --git a/deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/ParserUtility.java b/deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/ParserUtility.java\nindex 307b741c8..e67e844bc 100644\n--- a/deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/ParserUtility.java\n+++ b/deps/src/main/java/com/microsoft/azure/sdk/iot/deps/serializer/ParserUtility.java\n\n@@ -226,7 +184,7 @@ public class ParserUtility\n             if((value != null) && (value instanceof Map))\n             {\n                 /* Codes_SRS_PARSER_UTILITY_21_052: [The validateMap shall throws IllegalArgumentException if the provided map contains more than maxLevel levels and those extra levels contain more than just metadata.] */\n-                validateMapInternal((Map<String, Object>) value, allowMetadata);\n+                validateMapInternal((Map<String, Object>) value);\n             }\n         }\n     }\n"}}, {"oid": "e58a1d2fc1a7ce85b8953a63255a66cc0e18a39a", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e58a1d2fc1a7ce85b8953a63255a66cc0e18a39a", "message": "to squash", "committedDate": "2020-02-07T23:12:05Z", "type": "commit"}, {"oid": "452d02fa0d75b612700b464cc78ccb0fd708e4b3", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/452d02fa0d75b612700b464cc78ccb0fd708e4b3", "message": "squash", "committedDate": "2020-02-07T23:37:11Z", "type": "commit"}]}