{"pr_number": 733, "pr_title": "Do not accept HTTP urls in Https connection constructor", "pr_createdAt": "2020-03-16T15:52:24Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/733", "timeline": [{"oid": "b8c2e7291fbbd634dd7880daa6ba42f6b7ccc5f2", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/b8c2e7291fbbd634dd7880daa6ba42f6b7ccc5f2", "message": "Do not accept HTTP urls in Https connection constructor", "committedDate": "2020-03-16T15:48:34Z", "type": "commit"}, {"oid": "5ef093a060a8d6f6ca70667e02c41ede547d7dbd", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5ef093a060a8d6f6ca70667e02c41ede547d7dbd", "message": "Fix the unit test to catch the correct exception", "committedDate": "2020-03-16T17:36:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIwMzIyOA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/733#discussion_r393203228", "bodyText": "Since this test method now checks that the constructor throws, you can rename this test method", "author": "timtay-microsoft", "createdAt": "2020-03-16T17:44:45Z", "path": "device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnectionTest.java", "diffHunk": "@@ -394,27 +394,21 @@ public void setSSLContextSetsContextWithProxy(@Mocked final SSLContext mockedCon\n     }\n \n     //Tests_SRS_HTTPSCONNECTION_34_026: [If this object uses HTTP, this function shall throw an UnsupportedOperationException.]\n-    @Test (expected = UnsupportedOperationException.class)\n+    @Test (expected = IllegalArgumentException.class)\n     public void setSSLContextThrowsIfHttp(@Mocked final SSLContext mockedContext) throws IOException, TransportException", "originalCommit": "5ef093a060a8d6f6ca70667e02c41ede547d7dbd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIwNDcyNQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/733#discussion_r393204725", "bodyText": "I totally spaced out on the name ! sure thing", "author": "azabbasi", "createdAt": "2020-03-16T17:47:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIwMzIyOA=="}], "type": "inlineReview", "revised_code": {"commit": "3789ee6b622b111c6dde17ff835a29df406e0cb1", "chunk": "diff --git a/device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnectionTest.java b/device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnectionTest.java\nindex 3f8506460..7519b973a 100644\n--- a/device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnectionTest.java\n+++ b/device/iot-device-client/src/test/java/tests/unit/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnectionTest.java\n\n@@ -395,7 +395,7 @@ public class HttpsConnectionTest\n \n     //Tests_SRS_HTTPSCONNECTION_34_026: [If this object uses HTTP, this function shall throw an UnsupportedOperationException.]\n     @Test (expected = IllegalArgumentException.class)\n-    public void setSSLContextThrowsIfHttp(@Mocked final SSLContext mockedContext) throws IOException, TransportException\n+    public void HttpsConnectionConstructorThrowsIfHttp(@Mocked final SSLContext mockedContext) throws IOException, TransportException\n     {\n         final HttpsMethod httpsMethod = HttpsMethod.POST;\n         final String field = \"test-field\";\n"}}, {"oid": "3789ee6b622b111c6dde17ff835a29df406e0cb1", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/3789ee6b622b111c6dde17ff835a29df406e0cb1", "message": "Reanaame the test to better represent the actual expectation", "committedDate": "2020-03-16T17:47:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyODk0Mw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/733#discussion_r393228943", "bodyText": "If we make this change we need to let PM know before drop it off. lets chat about this", "author": "prmathur-microsoft", "createdAt": "2020-03-16T18:25:35Z", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/transport/https/HttpsConnection.java", "diffHunk": "@@ -70,10 +70,10 @@ public HttpsConnection(URL url, HttpsMethod method, final ProxySettings proxySet\n     {\n         // Codes_SRS_HTTPSCONNECTION_11_022: [If the URI given does not use the HTTPS or HTTP protocol, the constructor shall throw an IllegalArgumentException.]\n         final String protocol = url.getProtocol();\n-        if (!protocol.equalsIgnoreCase(\"HTTPS\") && !protocol.equalsIgnoreCase(\"HTTP\"))\n+        if (!protocol.equalsIgnoreCase(\"HTTPS\"))\n         {", "originalCommit": "3789ee6b622b111c6dde17ff835a29df406e0cb1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIzMzMzMw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/733#discussion_r393233333", "bodyText": "The method signature doesn't change and if someone uses http instead of https, the SSL context will throw an exception. so I don't think there is a behavior change. The exception we throw will be slightly different though.", "author": "azabbasi", "createdAt": "2020-03-16T18:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyODk0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzI0NjUzMg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/733#discussion_r393246532", "bodyText": "I took a look through the code, and there are no instances where the SDK would ever pass \"http\" instead of \"https\", so there is no impact on our customers here. We aren't taking away http support because we never had http support", "author": "timtay-microsoft", "createdAt": "2020-03-16T18:57:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzIyODk0Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "d9514545e19275a7ebd0468af592c82593eeff62", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/d9514545e19275a7ebd0468af592c82593eeff62", "message": "Merge branch 'master' into azabbasi/5867818", "committedDate": "2020-03-21T02:13:15Z", "type": "commit"}]}