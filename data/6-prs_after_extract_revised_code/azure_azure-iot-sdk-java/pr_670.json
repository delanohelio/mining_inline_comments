{"pr_number": 670, "pr_title": "Refactor build gate to cut down on unnecessary testing", "pr_createdAt": "2020-01-08T22:18:57Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/670", "timeline": [{"oid": "45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/45c3b90deb2ded293ff6dee440b807ded4a4e6c8", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-08T22:19:18Z", "type": "forcePushed"}, {"oid": "868d1714a49b0f0713ffb633649736ac1a688068", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/868d1714a49b0f0713ffb633649736ac1a688068", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-08T22:36:30Z", "type": "forcePushed"}, {"oid": "86492c99d690f3135ae3930a5594a777ea7b0c01", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/86492c99d690f3135ae3930a5594a777ea7b0c01", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-08T22:36:55Z", "type": "forcePushed"}, {"oid": "145f2f35b9460122cb26369473e0f2b1ebba60f3", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/145f2f35b9460122cb26369473e0f2b1ebba60f3", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-09T20:02:51Z", "type": "forcePushed"}, {"oid": "f716e967ff2687d7e7bb3566c1003e468607bbd7", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/f716e967ff2687d7e7bb3566c1003e468607bbd7", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-13T18:52:19Z", "type": "forcePushed"}, {"oid": "96bc4d6a36ef86727cfdf49dcd8647d8fbd53250", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/96bc4d6a36ef86727cfdf49dcd8647d8fbd53250", "message": "refactor(e2e): Move all e2e test code into provisioning/iothub folder structure\n\nAll iothub tests must have iothub in the path somewhere, likewise for provisioning", "committedDate": "2020-01-14T19:29:53Z", "type": "commit"}, {"oid": "556233ebeb7c183f533e74cd2740aee97a21f83c", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/556233ebeb7c183f533e74cd2740aee97a21f83c", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-14T19:29:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjcyMDUxMw==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670#discussion_r366720513", "bodyText": "Nit: this wording is a bit confusing, can be reworded into something along the lines of:\nIf it is an iot hub test, will skip the test when told to skip iot hub tests", "author": "abhipsaMisra", "createdAt": "2020-01-15T07:03:31Z", "path": "iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java", "diffHunk": "@@ -37,4 +40,27 @@ protected void finished(Description description)\n     public Timeout timeout = new Timeout(E2E_TEST_TIMEOUT_MS);\n \n     public static boolean isBasicTierHub;\n+\n+    //By default, run all tests. Even if env vars aren't set\n+    public static boolean runIotHubTests = Boolean.parseBoolean(Tools.retrieveEnvironmentVariableValue(\"RUN_IOTHUB_TESTS\", \"true\"));\n+    public static boolean runProvisioningTests = Boolean.parseBoolean(Tools.retrieveEnvironmentVariableValue(\"RUN_PROVISIONING_TESTS\", \"true\"));\n+\n+    public abstract boolean isProvisioningTest();\n+    public abstract boolean isIotHubTest();\n+\n+    @Before\n+    public void checkIfTestShouldBeRun()\n+    {\n+        if (isIotHubTest())\n+        {\n+            //Will skip the test if it is an iot hub test when told to skip iot hub tests", "originalCommit": "5f1706c1bb2f8ae8d0d2492319f414578b810aac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA1MzgzNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/670#discussion_r367053834", "bodyText": "sure thing, I'll use your re-wording here and below", "author": "timtay-microsoft", "createdAt": "2020-01-15T19:06:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjcyMDUxMw=="}], "type": "inlineReview", "revised_code": {"commit": "2f94feca80c91660226253ae7dda5c5110475b8f", "chunk": "diff --git a/iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java b/iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java\nindex 4e624bf7b..a3b50564e 100644\n--- a/iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java\n+++ b/iot-e2e-tests/common/src/main/java/com/microsoft/azure/sdk/iot/common/helpers/IntegrationTest.java\n\n@@ -53,13 +53,13 @@ public abstract class IntegrationTest\n     {\n         if (isIotHubTest())\n         {\n-            //Will skip the test if it is an iot hub test when told to skip iot hub tests\n+            //If it is an iot hub test, will skip the test when told to skip iot hub tests\n             assumeTrue(runIotHubTests);\n         }\n \n         if (isProvisioningTest())\n         {\n-            //Will skip the test if it is a provisioning test when told to skip provisioning tests\n+            //If it is a provisioning test, will skip the test when told to skip provisioning tests\n             assumeTrue(runProvisioningTests);\n         }\n     }\n"}}, {"oid": "2f94feca80c91660226253ae7dda5c5110475b8f", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/2f94feca80c91660226253ae7dda5c5110475b8f", "message": "refactor(e2e): Add iothub and provisioning integration test class\n\nAll integration tests now extend from either ProvisioningIntegrationTest or IotHubIntegrationTest for the purposes of setting up the build pipeline to only run provisioning and/or iothub tests as needed", "committedDate": "2020-01-15T19:07:28Z", "type": "commit"}, {"oid": "183bbbc6b0b40ac3ce077d28e79fa0615884a408", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/183bbbc6b0b40ac3ce077d28e79fa0615884a408", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-15T19:07:28Z", "type": "commit"}, {"oid": "183bbbc6b0b40ac3ce077d28e79fa0615884a408", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/183bbbc6b0b40ac3ce077d28e79fa0615884a408", "message": "refactor(vsts): Make build pipeline not run e2e tests if no code changes would affect them\n\nChanging a readme file no longer necessitates running e2e tests, for instance.\nChanging provisioning code no longer necessitates running iot hub specific e2e tests", "committedDate": "2020-01-15T19:07:28Z", "type": "forcePushed"}, {"oid": "5f96f0d09109505c17517e10d3791ac763b52671", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/5f96f0d09109505c17517e10d3791ac763b52671", "message": "Merge branch 'master' into smartGate", "committedDate": "2020-01-15T20:21:23Z", "type": "commit"}]}