{"pr_number": 831, "pr_title": "fix(iot-dev): Fix issue where clients couldn't queue messages while reconnecting", "pr_createdAt": "2020-07-01T18:41:19Z", "pr_url": "https://github.com/Azure/azure-iot-sdk-java/pull/831", "timeline": [{"oid": "92b6c87a98bb92fbc8a03060dcc9b32f635fc02e", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/92b6c87a98bb92fbc8a03060dcc9b32f635fc02e", "message": "fix(iot-dev): Fix issue where clients couldn't queue messages while reconnecting\n\nInternalClient methods such as subscribeToTwinDesiredProperties check this isOpen method before queueing messages.\n\nThe previous behavior was to allow users to queue messages and send subscription messages even when the client is in a reconnecting state.", "committedDate": "2020-07-01T18:39:25Z", "type": "commit"}, {"oid": "e862ba9d5ac7d5c36510eea133bb9f2bf2637093", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/e862ba9d5ac7d5c36510eea133bb9f2bf2637093", "message": "squash", "committedDate": "2020-07-01T18:41:11Z", "type": "commit"}, {"oid": "67cf93e4dfa0337f44ac895972acf435cc0b4a9f", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/67cf93e4dfa0337f44ac895972acf435cc0b4a9f", "message": "Merge branch 'master' into timtay/isOpen", "committedDate": "2020-07-01T18:46:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1MzgyNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/831#discussion_r448553824", "bodyText": "\ud83d\udc4d", "author": "prmathur-microsoft", "createdAt": "2020-07-01T18:49:28Z", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceIO.java", "diffHunk": "@@ -400,12 +400,13 @@ public IotHubClientProtocol getProtocol()\n     /**\n      * Getter for the connection state.\n      *\n-     * @return a boolean true if the connection is open, or false if it is closed.\n+     * @return a boolean true if the connection is open or reconnecting, and false otherwise.\n      */", "originalCommit": "67cf93e4dfa0337f44ac895972acf435cc0b4a9f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "bac62bbd9401246e4a9c763e034d8004e633306e", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/bac62bbd9401246e4a9c763e034d8004e633306e", "message": "fixup", "committedDate": "2020-07-01T18:49:31Z", "type": "commit"}, {"oid": "28e037fb8d98ba0c71454d6d045ada2b1e232b4a", "url": "https://github.com/Azure/azure-iot-sdk-java/commit/28e037fb8d98ba0c71454d6d045ada2b1e232b4a", "message": "Merge branch 'timtay/isOpen' of https://github.com/Azure/azure-iot-sdk-java into timtay/isOpen", "committedDate": "2020-07-01T18:49:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDA0NQ==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/831#discussion_r448554045", "bodyText": "Do we already have e2e/UT reflecting this behavior?", "author": "prmathur-microsoft", "createdAt": "2020-07-01T18:49:58Z", "path": "device/iot-device-client/src/main/java/com/microsoft/azure/sdk/iot/device/DeviceIO.java", "diffHunk": "@@ -146,7 +146,7 @@ void open() throws IOException\n     {\n         synchronized (this.stateLock)\n         {\n-            if (this.state == IotHubConnectionStatus.CONNECTED || this.state == IotHubConnectionStatus.DISCONNECTED_RETRYING)\n+            if (this.isOpen())", "originalCommit": "67cf93e4dfa0337f44ac895972acf435cc0b4a9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDE1NA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/831#discussion_r448554154", "bodyText": "Just added a unit test for this", "author": "timtay-microsoft", "createdAt": "2020-07-01T18:50:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDA0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDQyNg==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/831#discussion_r448554426", "bodyText": "Some of our e2e tests were already hitting this issue sometimes which is why I caught this in the first place", "author": "timtay-microsoft", "createdAt": "2020-07-01T18:50:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDA0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYyMjcwNA==", "url": "https://github.com/Azure/azure-iot-sdk-java/pull/831#discussion_r448622704", "bodyText": "\ud83d\udc4d", "author": "prmathur-microsoft", "createdAt": "2020-07-01T21:21:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU1NDA0NQ=="}], "type": "inlineReview", "revised_code": null}]}