{"pr_number": 8369, "pr_title": "KAFKA-9771: Port patch for inter-worker Connect SSL from Jetty 9.4.25", "pr_createdAt": "2020-03-26T22:00:06Z", "pr_url": "https://github.com/apache/kafka/pull/8369", "timeline": [{"oid": "abe2f87a09f38fae21e9bbf5f5b63a1245080b8b", "url": "https://github.com/apache/kafka/commit/abe2f87a09f38fae21e9bbf5f5b63a1245080b8b", "message": "KAFKA-9771: Port patch for inter-worker Connect SSL from Jetty 9.4.25", "committedDate": "2020-03-26T21:59:41Z", "type": "commit"}, {"oid": "abe2f87a09f38fae21e9bbf5f5b63a1245080b8b", "url": "https://github.com/apache/kafka/commit/abe2f87a09f38fae21e9bbf5f5b63a1245080b8b", "message": "KAFKA-9771: Port patch for inter-worker Connect SSL from Jetty 9.4.25", "committedDate": "2020-03-26T21:59:41Z", "type": "forcePushed"}, {"oid": "b694735257bb94a63ab894c40fcba0fbfb2ca94b", "url": "https://github.com/apache/kafka/commit/b694735257bb94a63ab894c40fcba0fbfb2ca94b", "message": "KAFKA-9771: Remove unused import", "committedDate": "2020-03-26T22:22:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMTM4Nw==", "url": "https://github.com/apache/kafka/pull/8369#discussion_r398931387", "bodyText": "I do not think we want SslContextFactory.Client overwrite newSniX509ExtendedKeyManager which is supposed to be Server side. This will change Client behavior.  Could we just use  SslContextFactory.Server instead if require ClientAuth true ?", "author": "jeffhuang26", "createdAt": "2020-03-26T22:30:54Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/util/SSLUtils.java", "diffHunk": "@@ -64,7 +65,20 @@ public static SslContextFactory createServerSideSslContextFactory(WorkerConfig c\n     public static SslContextFactory createClientSideSslContextFactory(WorkerConfig config) {\n         Map<String, Object> sslConfigValues = config.valuesWithPrefixAllOrNothing(\"listeners.https.\");\n \n-        final SslContextFactory.Client ssl = new SslContextFactory.Client();\n+        // Override this method in order to avoid running into\n+        // https://github.com/eclipse/jetty.project/issues/4385, which would otherwise cause this to\n+        // break when the keystore contains multiple certificates.\n+        // The override here matches the bug fix in Jetty for that issue:\n+        // https://github.com/eclipse/jetty.project/pull/4404/files#diff-58640db0f8f2cd84b7e653d1c1540913R2188-R2193\n+        // TODO: Remove this override when the version of Jetty for the framework is bumped to\n+        //       9.4.25 or later\n+        final SslContextFactory.Client ssl = new SslContextFactory.Client() {\n+            @Override\n+            @SuppressWarnings(\"deprecation\")\n+            protected X509ExtendedKeyManager newSniX509ExtendedKeyManager(X509ExtendedKeyManager keyManager) {", "originalCommit": "b694735257bb94a63ab894c40fcba0fbfb2ca94b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMjAyMQ==", "url": "https://github.com/apache/kafka/pull/8369#discussion_r398932021", "bodyText": "This is the exact fix that Jetty uses in later versions: https://github.com/eclipse/jetty.project/pull/4404/files#diff-58640db0f8f2cd84b7e653d1c1540913R2188-R2193", "author": "C0urante", "createdAt": "2020-03-26T22:32:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0NTcxMw==", "url": "https://github.com/apache/kafka/pull/8369#discussion_r399345713", "bodyText": "Will this RestClient in Connect follower node also play Server side role to Connect leader node and follower node's hostname need be verified by Connect leader node?", "author": "jeffhuang26", "createdAt": "2020-03-27T15:25:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxNDYzOA==", "url": "https://github.com/apache/kafka/pull/8369#discussion_r399414638", "bodyText": "No, when SSL is configured on the server, the SSLUtils::createServerSideSslContextFactory method is used to create the SSL context factory which should enable hostname verification.\nIf the leader has to contact a follower it'll use its own RestClient and communicate with the follower's RestServer which will be able to perform hostname verification.", "author": "C0urante", "createdAt": "2020-03-27T17:07:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMTM4Nw=="}], "type": "inlineReview", "revised_code": null}]}