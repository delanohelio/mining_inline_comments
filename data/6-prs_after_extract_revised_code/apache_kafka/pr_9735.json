{"pr_number": 9735, "pr_title": "KAFKA-10846: Grow buffer in FileSourceStreamTask only when needed", "pr_createdAt": "2020-12-11T15:19:30Z", "pr_url": "https://github.com/apache/kafka/pull/9735", "timeline": [{"oid": "80a54365f66d19e5dde2a9cbc2dd8675fa596561", "url": "https://github.com/apache/kafka/commit/80a54365f66d19e5dde2a9cbc2dd8675fa596561", "message": "KAFKA-10846: Grow buffer in FileSourceStreamTask only when needed", "committedDate": "2020-12-11T15:18:35Z", "type": "commit"}, {"oid": "06d37fa09d138f68519ff639c07669c53fd5e231", "url": "https://github.com/apache/kafka/commit/06d37fa09d138f68519ff639c07669c53fd5e231", "message": "Add a test", "committedDate": "2020-12-16T09:39:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3OTEyMA==", "url": "https://github.com/apache/kafka/pull/9735#discussion_r545179120", "bodyText": "This new test case LGTM. However, it re-create the task. How about setting a small initial size of FileStreamSourceTask to make all test cases meet the resize?", "author": "chia7712", "createdAt": "2020-12-17T15:29:17Z", "path": "connect/file/src/test/java/org/apache/kafka/connect/file/FileStreamSourceTaskTest.java", "diffHunk": "@@ -77,6 +78,17 @@ private void replay() {\n \n     @Test\n     public void testNormalLifecycle() throws InterruptedException, IOException {\n+        normalLifecycle();\n+    }\n+\n+    @Test\n+    public void testNormalLifecycleWithResize() throws InterruptedException, IOException {\n+        task = new FileStreamSourceTask(2);", "originalCommit": "06d37fa09d138f68519ff639c07669c53fd5e231", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE4MjExMQ==", "url": "https://github.com/apache/kafka/pull/9735#discussion_r545182111", "bodyText": "Or we make each test create task instead of creating task in setup", "author": "chia7712", "createdAt": "2020-12-17T15:33:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3OTEyMA=="}], "type": "inlineReview", "revised_code": {"commit": "47026e2b4950920d86f0b9d771cc34293b989b67", "chunk": "diff --git a/connect/file/src/test/java/org/apache/kafka/connect/file/FileStreamSourceTaskTest.java b/connect/file/src/test/java/org/apache/kafka/connect/file/FileStreamSourceTaskTest.java\nindex 8194be2eab..3fbe0d619e 100644\n--- a/connect/file/src/test/java/org/apache/kafka/connect/file/FileStreamSourceTaskTest.java\n+++ b/connect/file/src/test/java/org/apache/kafka/connect/file/FileStreamSourceTaskTest.java\n\n@@ -81,13 +81,6 @@ public class FileStreamSourceTaskTest extends EasyMockSupport {\n         normalLifecycle();\n     }\n \n-    @Test\n-    public void testNormalLifecycleWithResize() throws InterruptedException, IOException {\n-        task = new FileStreamSourceTask(2);\n-        task.initialize(context);\n-        normalLifecycle();\n-    }\n-\n     private void normalLifecycle() throws InterruptedException, IOException {\n         expectOffsetLookupReturnNone();\n         replay();\n"}}, {"oid": "47026e2b4950920d86f0b9d771cc34293b989b67", "url": "https://github.com/apache/kafka/commit/47026e2b4950920d86f0b9d771cc34293b989b67", "message": "Review comments", "committedDate": "2020-12-17T15:49:10Z", "type": "commit"}, {"oid": "d974620f3a261082fe3085c6ad9a7c1749bf67e5", "url": "https://github.com/apache/kafka/commit/d974620f3a261082fe3085c6ad9a7c1749bf67e5", "message": "inline", "committedDate": "2020-12-17T16:00:28Z", "type": "commit"}]}