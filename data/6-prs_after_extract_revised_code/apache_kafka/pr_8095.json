{"pr_number": 8095, "pr_title": "MINOR: Fix unnecessary metadata fetch before group assignment", "pr_createdAt": "2020-02-12T06:30:10Z", "pr_url": "https://github.com/apache/kafka/pull/8095", "timeline": [{"oid": "424b0962bbec9e1bc656b467c7aec69676cd896f", "url": "https://github.com/apache/kafka/commit/424b0962bbec9e1bc656b467c7aec69676cd896f", "message": "MINOR: Fix unnecessary metadata fetch before group assignment", "committedDate": "2020-02-12T06:26:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODEzMzA5NA==", "url": "https://github.com/apache/kafka/pull/8095#discussion_r378133094", "bodyText": "We were accumulating topics earlier, but now we are replacing groupSubscription. I guess that is fine since we are passing in all the topics. May be worth updating the comment and also verifying that we are no longer accumulating in the unit test.", "author": "rajinisivaram", "createdAt": "2020-02-12T09:34:29Z", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java", "diffHunk": "@@ -188,13 +188,15 @@ private boolean changeSubscription(Set<String> topicsToSubscribe) {\n     /**\n      * Add topics to the current group subscription. This is used by the group leader to ensure\n      * that it receives metadata updates for all topics that the group is interested in.\n+     *\n      * @param topics The topics to add to the group subscription\n+     * @return true if the group subscription contains topics which are not part of the local subscription\n      */\n     synchronized boolean groupSubscribe(Collection<String> topics) {\n         if (!hasAutoAssignedPartitions())\n             throw new IllegalStateException(SUBSCRIPTION_EXCEPTION_MESSAGE);\n-        groupSubscription = new HashSet<>(groupSubscription);\n-        return groupSubscription.addAll(topics);\n+        groupSubscription = new HashSet<>(topics);", "originalCommit": "424b0962bbec9e1bc656b467c7aec69676cd896f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4b1c372788c6c98e0b9323b82f192c80ce9c7d5", "chunk": "diff --git a/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java b/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java\nindex cc65254545..6568c9188a 100644\n--- a/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java\n+++ b/clients/src/main/java/org/apache/kafka/clients/consumer/internals/SubscriptionState.java\n\n@@ -186,10 +186,10 @@ public class SubscriptionState {\n     }\n \n     /**\n-     * Add topics to the current group subscription. This is used by the group leader to ensure\n+     * Set the current group subscription. This is used by the group leader to ensure\n      * that it receives metadata updates for all topics that the group is interested in.\n      *\n-     * @param topics The topics to add to the group subscription\n+     * @param topics All topics from the group subscription\n      * @return true if the group subscription contains topics which are not part of the local subscription\n      */\n     synchronized boolean groupSubscribe(Collection<String> topics) {\n"}}, {"oid": "f4b1c372788c6c98e0b9323b82f192c80ce9c7d5", "url": "https://github.com/apache/kafka/commit/f4b1c372788c6c98e0b9323b82f192c80ce9c7d5", "message": "Make it clear `groupSubscribe` does not accumulate", "committedDate": "2020-02-12T16:51:59Z", "type": "commit"}]}