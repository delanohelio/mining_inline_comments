{"pr_number": 9597, "pr_title": "KAFKA-10720: Document prohibition on header mutation by SMTs", "pr_createdAt": "2020-11-16T09:35:09Z", "pr_url": "https://github.com/apache/kafka/pull/9597", "timeline": [{"oid": "2068d74831cfea6567f9ad8e148ca375b71c1e5d", "url": "https://github.com/apache/kafka/commit/2068d74831cfea6567f9ad8e148ca375b71c1e5d", "message": "KAFKA-10720: Document prohibition on header mutation by SMTs", "committedDate": "2020-11-16T09:33:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDE2MDY5Mw==", "url": "https://github.com/apache/kafka/pull/9597#discussion_r524160693", "bodyText": "Should we also make a note about mutating the key/value of the record, which is possible for Struct, Map, and Array instances?", "author": "C0urante", "createdAt": "2020-11-16T11:33:59Z", "path": "connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java", "diffHunk": "@@ -33,6 +33,9 @@\n      * Apply transformation to the {@code record} and return another record object (which may be {@code record} itself) or {@code null},\n      * corresponding to a map or filter operation respectively.\n      *\n+     * A transformation must not mutate the headers of a given {@code record}. If the headers need to be changed\n+     * a new record with different headers should be created and returned.\n+     *", "originalCommit": "2068d74831cfea6567f9ad8e148ca375b71c1e5d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0ac5aba637bee8a328b3c9ec8b887361740ad9af", "chunk": "diff --git a/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java b/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\nindex 49a019f3a1..2f6e1405af 100644\n--- a/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\n+++ b/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\n\n@@ -33,8 +33,10 @@ public interface Transformation<R extends ConnectRecord<R>> extends Configurable\n      * Apply transformation to the {@code record} and return another record object (which may be {@code record} itself) or {@code null},\n      * corresponding to a map or filter operation respectively.\n      *\n-     * A transformation must not mutate the headers of a given {@code record}. If the headers need to be changed\n-     * a new record with different headers should be created and returned.\n+     * A transformation must not mutate objects reachable from the given {@code record}\n+     * (including, but not limited to, {@link org.apache.kafka.connect.header.Headers},\n+     * {@link org.apache.kafka.connect.data.Struct Structs}, {@code Lists}, and {@code Maps}).\n+     * If such objects need to be changed, a new ConnectRecord should be created and returned.\n      *\n      * The implementation must be thread-safe.\n      */\n"}}, {"oid": "0ac5aba637bee8a328b3c9ec8b887361740ad9af", "url": "https://github.com/apache/kafka/commit/0ac5aba637bee8a328b3c9ec8b887361740ad9af", "message": "Broaden language, mention Structs, Lists and Maps explicitly", "committedDate": "2020-11-16T11:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTE2ODQwMA==", "url": "https://github.com/apache/kafka/pull/9597#discussion_r531168400", "bodyText": "Should we change {@link org.apache.kafka.connect.header.Headers} to {@link org.apache.kafka.connect.header.Headers Headers} ?", "author": "mimaison", "createdAt": "2020-11-26T17:45:53Z", "path": "connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java", "diffHunk": "@@ -33,6 +33,11 @@\n      * Apply transformation to the {@code record} and return another record object (which may be {@code record} itself) or {@code null},\n      * corresponding to a map or filter operation respectively.\n      *\n+     * A transformation must not mutate objects reachable from the given {@code record}\n+     * (including, but not limited to, {@link org.apache.kafka.connect.header.Headers},", "originalCommit": "0ac5aba637bee8a328b3c9ec8b887361740ad9af", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "acf7db00a5306805d01c0891bf0e45ed6de6ebcf", "chunk": "diff --git a/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java b/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\nindex 2f6e1405af..238a6429d1 100644\n--- a/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\n+++ b/connect/api/src/main/java/org/apache/kafka/connect/transforms/Transformation.java\n\n@@ -34,7 +34,7 @@ public interface Transformation<R extends ConnectRecord<R>> extends Configurable\n      * corresponding to a map or filter operation respectively.\n      *\n      * A transformation must not mutate objects reachable from the given {@code record}\n-     * (including, but not limited to, {@link org.apache.kafka.connect.header.Headers},\n+     * (including, but not limited to, {@link org.apache.kafka.connect.header.Headers Headers},\n      * {@link org.apache.kafka.connect.data.Struct Structs}, {@code Lists}, and {@code Maps}).\n      * If such objects need to be changed, a new ConnectRecord should be created and returned.\n      *\n"}}, {"oid": "acf7db00a5306805d01c0891bf0e45ed6de6ebcf", "url": "https://github.com/apache/kafka/commit/acf7db00a5306805d01c0891bf0e45ed6de6ebcf", "message": "Review comment", "committedDate": "2020-11-26T17:52:36Z", "type": "commit"}]}