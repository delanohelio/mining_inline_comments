{"pr_number": 8409, "pr_title": "KAFKA-6145: KIP-441 Pt. 6 Trigger probing rebalances until group is stable", "pr_createdAt": "2020-04-03T01:33:39Z", "pr_url": "https://github.com/apache/kafka/pull/8409", "timeline": [{"oid": "2cade0406e2d8ea1e3b10477eea22aea732c673d", "url": "https://github.com/apache/kafka/commit/2cade0406e2d8ea1e3b10477eea22aea732c673d", "message": "log stable assignmnet", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "bcd28772fd27366bb58fd31ff793b7bfe88a73d9", "url": "https://github.com/apache/kafka/commit/bcd28772fd27366bb58fd31ff793b7bfe88a73d9", "message": "add config for rebalance time", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "45303d6959b8ff00b507cd59015e3d59efc16ab2", "url": "https://github.com/apache/kafka/commit/45303d6959b8ff00b507cd59015e3d59efc16ab2", "message": "optional casting", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "579a0c014ca25c80b7b808ed03816390d830c9e5", "url": "https://github.com/apache/kafka/commit/579a0c014ca25c80b7b808ed03816390d830c9e5", "message": "checkstyle", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "f2d8148137c5c5f7f753d599270bafd3c6c9f4f5", "url": "https://github.com/apache/kafka/commit/f2d8148137c5c5f7f753d599270bafd3c6c9f4f5", "message": "fix test", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "c95a096ccb250d3204b6a3141d89810a2b8baea4", "url": "https://github.com/apache/kafka/commit/c95a096ccb250d3204b6a3141d89810a2b8baea4", "message": "add to test", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "d1940c91eaa9dac27dfedd71846acee33c3672fa", "url": "https://github.com/apache/kafka/commit/d1940c91eaa9dac27dfedd71846acee33c3672fa", "message": "only trigger rebalance on failed fetch end offsets when HA is enabled", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "060cc5e8e548a196ec240be69befe1209f75787a", "url": "https://github.com/apache/kafka/commit/060cc5e8e548a196ec240be69befe1209f75787a", "message": "repalce Optional with AtomicLong", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "b5fb66c564f3e41b407daa52fcd78e7af03a2a57", "url": "https://github.com/apache/kafka/commit/b5fb66c564f3e41b407daa52fcd78e7af03a2a57", "message": "fix SPAT", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "b42b1b57f92893b72561117389c5868853f5add5", "url": "https://github.com/apache/kafka/commit/b42b1b57f92893b72561117389c5868853f5add5", "message": "github comments", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "672366a1eb6a7da4e246cd46932a40346e7b742a", "url": "https://github.com/apache/kafka/commit/672366a1eb6a7da4e246cd46932a40346e7b742a", "message": "github comments, add test", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "6240f69b3ae5dc7de8fee167f900aa6369ef3066", "url": "https://github.com/apache/kafka/commit/6240f69b3ae5dc7de8fee167f900aa6369ef3066", "message": "formatting/wording suggestions", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "ea6382a68f4d4279e74ac81e2f72137404b06af2", "url": "https://github.com/apache/kafka/commit/ea6382a68f4d4279e74ac81e2f72137404b06af2", "message": "add new assignorConfiguration configs test", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "00cc2287194a255d9de97cd3047aef4e3ca94d62", "url": "https://github.com/apache/kafka/commit/00cc2287194a255d9de97cd3047aef4e3ca94d62", "message": "add test to verify enforceRebalance", "committedDate": "2020-04-08T01:51:48Z", "type": "commit"}, {"oid": "51cf963d8b8817cf7f617356b55fdfe1459a0760", "url": "https://github.com/apache/kafka/commit/51cf963d8b8817cf7f617356b55fdfe1459a0760", "message": "merge with trunk and fix", "committedDate": "2020-04-08T01:53:55Z", "type": "commit"}, {"oid": "51cf963d8b8817cf7f617356b55fdfe1459a0760", "url": "https://github.com/apache/kafka/commit/51cf963d8b8817cf7f617356b55fdfe1459a0760", "message": "merge with trunk and fix", "committedDate": "2020-04-08T01:53:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM1NTY2NA==", "url": "https://github.com/apache/kafka/pull/8409#discussion_r405355664", "bodyText": "I was more thinking about a separate unit test class AssignorConfigurationTest with a more thorough testing of all code paths, but if we feel that this should also be a follow up task, that is also fine with me.", "author": "cadonna", "createdAt": "2020-04-08T08:40:51Z", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -1845,6 +1845,28 @@ public void shouldSetAdminClientTimeout() {\n         assertThat(assignorConfiguration.getAdminClientTimeout(), is(2 * 60 * 1000));\n     }\n \n+    @Test\n+    public void shouldGetNextProbingRebalanceMs() {\n+        nextProbingRebalanceMs.set(5 * 60 * 1000L);\n+\n+        createDefaultMockTaskManager();\n+        final Map<String, Object> props = configProps();\n+        final AssignorConfiguration assignorConfiguration = new AssignorConfiguration(props);\n+\n+        assertThat(assignorConfiguration.getNextProbingRebalanceMs(props).get(), equalTo(5 * 60 * 1000L));\n+    }\n+\n+    @Test\n+    public void shouldGetTime() {\n+        time.setCurrentTimeMs(Long.MAX_VALUE);\n+\n+        createDefaultMockTaskManager();\n+        final Map<String, Object> props = configProps();\n+        final AssignorConfiguration assignorConfiguration = new AssignorConfiguration(props);\n+\n+        assertThat(assignorConfiguration.getTime(props).milliseconds(), equalTo(Long.MAX_VALUE));\n+    }\n+", "originalCommit": "51cf963d8b8817cf7f617356b55fdfe1459a0760", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxMTM2Mw==", "url": "https://github.com/apache/kafka/pull/8409#discussion_r405711363", "bodyText": "Thanks for pointing these out, @cadonna .", "author": "vvcephei", "createdAt": "2020-04-08T18:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM1NTY2NA=="}], "type": "inlineReview", "revised_code": null}]}