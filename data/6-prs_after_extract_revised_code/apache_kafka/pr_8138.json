{"pr_number": 8138, "pr_title": "KAFKA-9573: Fix JVM options to run early versions of Kafka on the latest JVMs", "pr_createdAt": "2020-02-19T15:00:06Z", "pr_url": "https://github.com/apache/kafka/pull/8138", "timeline": [{"oid": "832171dddd3071cf7a7f6915707e6a8e6fbdb600", "url": "https://github.com/apache/kafka/commit/832171dddd3071cf7a7f6915707e6a8e6fbdb600", "message": "KAFKA-9573: Fix JVM options to run previous versions of Kafka on the latest JVMs", "committedDate": "2020-02-19T14:49:30Z", "type": "commit"}, {"oid": "3b1e2ac9c8fa2ec8df0ac8a59fd567d0e317b0a6", "url": "https://github.com/apache/kafka/commit/3b1e2ac9c8fa2ec8df0ac8a59fd567d0e317b0a6", "message": "KAFKA-9573: Fix JVM options to run previous versions of Kafka on the latest JVMs", "committedDate": "2020-02-19T15:07:18Z", "type": "commit"}, {"oid": "bcc6abc5235793664c319cdb10c0a8ad67427fa2", "url": "https://github.com/apache/kafka/commit/bcc6abc5235793664c319cdb10c0a8ad67427fa2", "message": "Merge branch 'trunk' into KAFKA-9573", "committedDate": "2020-02-19T15:07:40Z", "type": "commit"}, {"oid": "5f134f549a599690d679dbb706e43918a581807e", "url": "https://github.com/apache/kafka/commit/5f134f549a599690d679dbb706e43918a581807e", "message": "KAFKA-9573: Fixing tests.", "committedDate": "2020-02-19T15:38:44Z", "type": "commit"}, {"oid": "09412c658fa8011c36736e5249231d9a45d4db75", "url": "https://github.com/apache/kafka/commit/09412c658fa8011c36736e5249231d9a45d4db75", "message": "KAFKA-9573: Fixing verifiable producer.", "committedDate": "2020-02-19T15:48:21Z", "type": "commit"}, {"oid": "8d88b73ace2f3a90700da18a03fe0dc6da461c9c", "url": "https://github.com/apache/kafka/commit/8d88b73ace2f3a90700da18a03fe0dc6da461c9c", "message": "KAFKA-9573: Fix import.", "committedDate": "2020-02-19T19:23:25Z", "type": "commit"}, {"oid": "28157dd5efb445e72da063aa4ea6c0fbbb1d3cb3", "url": "https://github.com/apache/kafka/commit/28157dd5efb445e72da063aa4ea6c0fbbb1d3cb3", "message": "KAFKA-9573: Fix import.", "committedDate": "2020-02-19T19:34:00Z", "type": "commit"}, {"oid": "0a2a70317f4807e4503b5e4eec3f07a17c46ab48", "url": "https://github.com/apache/kafka/commit/0a2a70317f4807e4503b5e4eec3f07a17c46ab48", "message": "KAFKA-9573: Version to fix options added.", "committedDate": "2020-02-20T10:19:01Z", "type": "commit"}, {"oid": "759fb4d5722fe8e1642b1cf35408ee6f46893a72", "url": "https://github.com/apache/kafka/commit/759fb4d5722fe8e1642b1cf35408ee6f46893a72", "message": "KAFKA-9573: Version to fix options added.", "committedDate": "2020-02-20T10:57:45Z", "type": "commit"}, {"oid": "623eab20e5ebb1e0de11d9cb301064e5bfffdc01", "url": "https://github.com/apache/kafka/commit/623eab20e5ebb1e0de11d9cb301064e5bfffdc01", "message": "KAFKA-9573: Version to fix options added.", "committedDate": "2020-02-20T12:06:57Z", "type": "commit"}, {"oid": "cf00524b0038795afe9b7291ad4912eda97ec9f6", "url": "https://github.com/apache/kafka/commit/cf00524b0038795afe9b7291ad4912eda97ec9f6", "message": "KAFKA-9573: syntax fix.", "committedDate": "2020-02-20T12:29:02Z", "type": "commit"}, {"oid": "355cae882f882e65fbc7c8a1dc08fd873f9ceebb", "url": "https://github.com/apache/kafka/commit/355cae882f882e65fbc7c8a1dc08fd873f9ceebb", "message": "KAFKA-9573: gc file path update.", "committedDate": "2020-02-20T13:16:47Z", "type": "commit"}, {"oid": "2c44806c3128c5f4e31acffb7fcd893d1d205d9d", "url": "https://github.com/apache/kafka/commit/2c44806c3128c5f4e31acffb7fcd893d1d205d9d", "message": "KAFKA-9573: gc file path update.", "committedDate": "2020-02-20T13:40:33Z", "type": "commit"}, {"oid": "b372d9e5bc7e41f57fdae12a57fc76c9d39c70ce", "url": "https://github.com/apache/kafka/commit/b372d9e5bc7e41f57fdae12a57fc76c9d39c70ce", "message": "KAFKA-9573: gc file path update.", "committedDate": "2020-02-20T14:04:40Z", "type": "commit"}, {"oid": "9da159423aa21223d5fc43efb284c595ded9c88f", "url": "https://github.com/apache/kafka/commit/9da159423aa21223d5fc43efb284c595ded9c88f", "message": "KAFKA-9573: gc file path update.", "committedDate": "2020-02-20T14:50:04Z", "type": "commit"}, {"oid": "50678d0b212ce41a2eba704a4a0ff89a5107a7c5", "url": "https://github.com/apache/kafka/commit/50678d0b212ce41a2eba704a4a0ff89a5107a7c5", "message": "KAFKA-9573: gc file path update.", "committedDate": "2020-02-20T14:51:11Z", "type": "commit"}, {"oid": "b639ddfd68d1e40a655839069082731c2bb0f634", "url": "https://github.com/apache/kafka/commit/b639ddfd68d1e40a655839069082731c2bb0f634", "message": "KAFKA-9573: fix jaxb-impl for jdk11.", "committedDate": "2020-02-21T09:58:23Z", "type": "commit"}, {"oid": "f825978ff03c789106fbdf99b208e75e6a59fe78", "url": "https://github.com/apache/kafka/commit/f825978ff03c789106fbdf99b208e75e6a59fe78", "message": "KAFKA-9573: fix jaxb-impl for jdk11.", "committedDate": "2020-02-21T10:49:46Z", "type": "commit"}, {"oid": "6fb636ed6bb8ddd7e07b62f710a253a1cc6b392b", "url": "https://github.com/apache/kafka/commit/6fb636ed6bb8ddd7e07b62f710a253a1cc6b392b", "message": "KAFKA-9573: fix jaxb-impl for jdk11.", "committedDate": "2020-02-21T10:57:02Z", "type": "commit"}, {"oid": "216a90454ef42facf32ae7f37aca8da4cfcc5dd7", "url": "https://github.com/apache/kafka/commit/216a90454ef42facf32ae7f37aca8da4cfcc5dd7", "message": "KAFKA-9573: fix jaxb-impl for jdk11.", "committedDate": "2020-02-21T10:59:57Z", "type": "commit"}, {"oid": "473bbccef13d5221483c2e24c296a1802317dda8", "url": "https://github.com/apache/kafka/commit/473bbccef13d5221483c2e24c296a1802317dda8", "message": "KAFKA-9573: .", "committedDate": "2020-02-21T13:10:17Z", "type": "commit"}, {"oid": "e500da1b92b1fe0f583f10531ff5709583f6614c", "url": "https://github.com/apache/kafka/commit/e500da1b92b1fe0f583f10531ff5709583f6614c", "message": "KAFKA-9573: Fixing VerifiableConsumer(Producer) to run with 0.8.2.2.", "committedDate": "2020-02-21T14:35:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxODA4OA==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r382618088", "bodyText": "Can we add this comment in every usage? Also, let's be clear about the minimum version that this class must support in the comment. Same for VerifiableProducer.", "author": "ijuma", "createdAt": "2020-02-21T14:43:11Z", "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java", "diffHunk": "@@ -663,16 +662,17 @@ public static void main(String[] args) {\n         ArgumentParser parser = argParser();\n         if (args.length == 0) {\n             parser.printHelp();\n-            Exit.exit(0);\n+            System.exit(0);\n         }\n         try {\n             final VerifiableConsumer consumer = createFromArgs(parser, args);\n-            Exit.addShutdownHook(\"verifiable-consumer-shutdown-hook\", () -> consumer.close());\n+            Runtime.getRuntime().addShutdownHook(new Thread(consumer::close, \"verifiable-consumer-shutdown-hook\"));\n \n             consumer.run();\n         } catch (ArgumentParserException e) {\n             parser.handleError(e);\n-            Exit.exit(1);\n+            //Can't use `Exit.exit` here because `Exit` doesn't exists on old version of Kafka.", "originalCommit": "e500da1b92b1fe0f583f10531ff5709583f6614c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYyMTg2MA==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r382621860", "bodyText": "Fixed.\nWith this change, upgrade_test.py passes for 0.8.8.2. I will attach results in a couple of hours.", "author": "nizhikov", "createdAt": "2020-02-21T14:49:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxODA4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYzMjUxNA==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r382632514", "bodyText": "Seems reasonable to do this in Verifiable{Producer,Consumer}, yes; the changes related to this in these two classes LGTM.", "author": "rondagostino", "createdAt": "2020-02-21T15:08:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYxODA4OA=="}], "type": "inlineReview", "revised_code": {"commit": "5192b1a33c0cedfc06b1b31c44aec253d2229319", "chunk": "diff --git a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\nindex c67869abbb..31bb7a9c54 100644\n--- a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n+++ b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n\n@@ -666,6 +667,7 @@ public class VerifiableConsumer implements Closeable, OffsetCommitCallback, Cons\n         }\n         try {\n             final VerifiableConsumer consumer = createFromArgs(parser, args);\n+            //Can't use `Exit.exit` here because `Exit` doesn't exists on old version of Kafka.\n             Runtime.getRuntime().addShutdownHook(new Thread(consumer::close, \"verifiable-consumer-shutdown-hook\"));\n \n             consumer.run();\n"}}, {"oid": "5192b1a33c0cedfc06b1b31c44aec253d2229319", "url": "https://github.com/apache/kafka/commit/5192b1a33c0cedfc06b1b31c44aec253d2229319", "message": "KAFKA-9573: Comments added.", "committedDate": "2020-02-21T14:48:31Z", "type": "commit"}, {"oid": "1611002ac6f31d0a02a7894e37cd2500a9e47b5c", "url": "https://github.com/apache/kafka/commit/1611002ac6f31d0a02a7894e37cd2500a9e47b5c", "message": "KAFKA-9573: Comments fixed.", "committedDate": "2020-02-21T14:54:15Z", "type": "commit"}, {"oid": "869e267adc1fdba60dd157284e0257690a2b1fa5", "url": "https://github.com/apache/kafka/commit/869e267adc1fdba60dd157284e0257690a2b1fa5", "message": "KAFKA-9573: Comments fixed.", "committedDate": "2020-02-21T14:55:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyMDIwOA==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r382720208", "bodyText": "nit: doesn't exist until 0.11.0.0 to be more accurate? Ditto below.", "author": "guozhangwang", "createdAt": "2020-02-21T17:51:16Z", "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java", "diffHunk": "@@ -633,7 +632,8 @@ public static VerifiableConsumer createFromArgs(ArgumentParser parser, String[]\n             brokerHostandPort = res.getString(\"brokerList\");\n         } else {\n             parser.printHelp();\n-            Exit.exit(0);\n+            //Can't use `Exit.exit` here because `Exit` doesn't exists on 0.8.2.2.", "originalCommit": "869e267adc1fdba60dd157284e0257690a2b1fa5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1OTI3Mg==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r382759272", "bodyText": "Fixed.", "author": "nizhikov", "createdAt": "2020-02-21T19:17:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyMDIwOA=="}], "type": "inlineReview", "revised_code": {"commit": "93969f0ed091f9ffe0726c4c06a483ae2bd21513", "chunk": "diff --git a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\nindex 3716b7eed5..6e71696feb 100644\n--- a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n+++ b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n\n@@ -632,7 +632,7 @@ public class VerifiableConsumer implements Closeable, OffsetCommitCallback, Cons\n             brokerHostandPort = res.getString(\"brokerList\");\n         } else {\n             parser.printHelp();\n-            //Can't use `Exit.exit` here because `Exit` doesn't exists on 0.8.2.2.\n+            //Can't use `Exit.exit` here because `Exit` doesn't exists until 0.11.0.0.\n             System.exit(0);\n         }\n         consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerHostandPort);\n"}}, {"oid": "93969f0ed091f9ffe0726c4c06a483ae2bd21513", "url": "https://github.com/apache/kafka/commit/93969f0ed091f9ffe0726c4c06a483ae2bd21513", "message": "KAFKA-9573: Code review comments fixed.", "committedDate": "2020-02-21T19:21:26Z", "type": "commit"}, {"oid": "58586a540f1c1cf9b2cc8deb828c8aa42cdb2d2b", "url": "https://github.com/apache/kafka/commit/58586a540f1c1cf9b2cc8deb828c8aa42cdb2d2b", "message": "Merge branch 'trunk' into KAFKA-9573", "committedDate": "2020-02-25T14:41:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2MDMxNA==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r386060314", "bodyText": "Can we submit the Exit changes as a separate PR? It needs to be cherry-picked to the 2.5 branch as well since it's causing system test failures.", "author": "ijuma", "createdAt": "2020-02-29T22:33:19Z", "path": "tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java", "diffHunk": "@@ -633,7 +632,8 @@ public static VerifiableConsumer createFromArgs(ArgumentParser parser, String[]\n             brokerHostandPort = res.getString(\"brokerList\");\n         } else {\n             parser.printHelp();\n-            Exit.exit(0);\n+            //Can't use `Exit.exit` here because `Exit` doesn't exists until 0.11.0.0.\n+            System.exit(0);", "originalCommit": "58586a540f1c1cf9b2cc8deb828c8aa42cdb2d2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA4MTY4Mg==", "url": "https://github.com/apache/kafka/pull/8138#discussion_r386081682", "bodyText": "Can we submit the Exit changes as a separate PR?\n\nYes, we can :)\nPlease, see - #8197", "author": "nizhikov", "createdAt": "2020-03-01T06:38:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjA2MDMxNA=="}], "type": "inlineReview", "revised_code": {"commit": "1d5845ff2ae0e2aab0fe7a178271752f13da6ee9", "chunk": "diff --git a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\nindex 6e71696feb..5be76f0006 100644\n--- a/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n+++ b/tools/src/main/java/org/apache/kafka/tools/VerifiableConsumer.java\n\n@@ -632,7 +632,7 @@ public class VerifiableConsumer implements Closeable, OffsetCommitCallback, Cons\n             brokerHostandPort = res.getString(\"brokerList\");\n         } else {\n             parser.printHelp();\n-            //Can't use `Exit.exit` here because `Exit` doesn't exists until 0.11.0.0.\n+            // Can't use `Exit.exit` here because it didn't exist until 0.11.0.0.\n             System.exit(0);\n         }\n         consumerProps.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerHostandPort);\n"}}, {"oid": "924e8f8f30886a9eed2d3ce1ae88656d5d421a25", "url": "https://github.com/apache/kafka/commit/924e8f8f30886a9eed2d3ce1ae88656d5d421a25", "message": "Merge branch 'trunk' into KAFKA-9573", "committedDate": "2020-03-01T06:24:22Z", "type": "commit"}, {"oid": "1d5845ff2ae0e2aab0fe7a178271752f13da6ee9", "url": "https://github.com/apache/kafka/commit/1d5845ff2ae0e2aab0fe7a178271752f13da6ee9", "message": "Merge branch 'trunk' into KAFKA-9573", "committedDate": "2020-03-02T05:56:03Z", "type": "commit"}, {"oid": "d695d6a419b8bc8171322541da47e92c910318d2", "url": "https://github.com/apache/kafka/commit/d695d6a419b8bc8171322541da47e92c910318d2", "message": "Merge branch 'trunk' into KAFKA-9573", "committedDate": "2020-03-16T19:23:06Z", "type": "commit"}, {"oid": "90a59a1bcc21c1cfbd5dbca717aea3c2ef3ac565", "url": "https://github.com/apache/kafka/commit/90a59a1bcc21c1cfbd5dbca717aea3c2ef3ac565", "message": "KAFKA-9573: Ignoring upgrade tests for old Kafka version if jdk version > 9", "committedDate": "2020-03-17T08:02:06Z", "type": "commit"}, {"oid": "459c8f8e197fcd3e3aab591e7366ca0827f675ca", "url": "https://github.com/apache/kafka/commit/459c8f8e197fcd3e3aab591e7366ca0827f675ca", "message": "KAFKA-9573: minor fix", "committedDate": "2020-03-17T12:54:08Z", "type": "commit"}, {"oid": "8a14254efbc98d6b8f9c620444373c4b2e12ce34", "url": "https://github.com/apache/kafka/commit/8a14254efbc98d6b8f9c620444373c4b2e12ce34", "message": "KAFKA-9573: minor fix", "committedDate": "2020-03-17T12:56:20Z", "type": "commit"}, {"oid": "834a707a5f738e0fad53ed6222925258f7d3f6e9", "url": "https://github.com/apache/kafka/commit/834a707a5f738e0fad53ed6222925258f7d3f6e9", "message": "KAFKA-9573: minor fix", "committedDate": "2020-03-17T12:59:57Z", "type": "commit"}, {"oid": "1cf6244330aeb5e1661d85278ff19aa458fb8d88", "url": "https://github.com/apache/kafka/commit/1cf6244330aeb5e1661d85278ff19aa458fb8d88", "message": "KAFKA-9573: minor fix", "committedDate": "2020-03-17T13:02:23Z", "type": "commit"}, {"oid": "8efc9a193923ffd02a81492e1dacf5f284387967", "url": "https://github.com/apache/kafka/commit/8efc9a193923ffd02a81492e1dacf5f284387967", "message": "KAFKA-9573: reverting unnecessary changes.", "committedDate": "2020-03-18T13:46:48Z", "type": "commit"}]}