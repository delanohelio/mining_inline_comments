{"pr_number": 8896, "pr_title": "KAFKA-10185: Restoration info logging", "pr_createdAt": "2020-06-18T17:28:44Z", "pr_url": "https://github.com/apache/kafka/pull/8896", "timeline": [{"oid": "6431b199f51feb7a4fc92b446780d85721e56879", "url": "https://github.com/apache/kafka/commit/6431b199f51feb7a4fc92b446780d85721e56879", "message": "KAFKA-10185: Restoration info logging", "committedDate": "2020-06-18T22:19:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkzMTM1Ng==", "url": "https://github.com/apache/kafka/pull/8896#discussion_r442931356", "bodyText": "nit: should we have a newline for each partition? Otherwise that ling maybe too long.", "author": "guozhangwang", "createdAt": "2020-06-19T16:18:20Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StoreChangelogReader.java", "diffHunk": "@@ -458,9 +462,48 @@ public void restore() {\n             }\n \n             maybeUpdateLimitOffsetsForStandbyChangelogs();\n+\n+            maybeLogRestorationProgress();\n+        }\n+    }\n+\n+    private void maybeLogRestorationProgress() {\n+        if (state == ChangelogReaderState.ACTIVE_RESTORING) {\n+            if (time.milliseconds() - lastRestoreLogTime > RESTORE_LOG_INTERVAL_MS) {\n+                final Set<TopicPartition> topicPartitions = activeRestoringChangelogs();\n+                if (!topicPartitions.isEmpty()) {\n+                    final StringBuilder builder = new StringBuilder().append(\"Restoration in progress for \")\n+                                                                     .append(topicPartitions.size())\n+                                                                     .append(\" partitions.\");\n+                    for (final TopicPartition partition : topicPartitions) {", "originalCommit": "6431b199f51feb7a4fc92b446780d85721e56879", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAwMTQ0Mg==", "url": "https://github.com/apache/kafka/pull/8896#discussion_r443001442", "bodyText": "I thought about it; while it does make the logs easier to read, it makes them harder to search (as in grep, since the line that would match the query doesn't contain all the information.\nWe do have other places where we concatenate every topic-partition on a single line, eg in the StreamsPartitionAssignor, so I think if long lines were a problem, people would already be complaining.", "author": "vvcephei", "createdAt": "2020-06-19T19:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkzMTM1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzAwNDE5Mg==", "url": "https://github.com/apache/kafka/pull/8896#discussion_r443004192", "bodyText": "Actually I do have complaints about the StreamsPartitionAssignor log entries haha :)\nAnyways, I think grep a valid reason. My rationale was that when searching for this entry, most people would use \"Restoration in progress for\" and then manually check if the particular interested partition in the following line, but I guess I'm just biased because I'm not a heavy grep user.\nIt is a quite nit comment and I won't feel strong about it. Your call.", "author": "guozhangwang", "createdAt": "2020-06-19T19:10:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkzMTM1Ng=="}], "type": "inlineReview", "revised_code": null}]}