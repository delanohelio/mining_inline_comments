{"pr_number": 9149, "pr_title": "KAFKA-10340: Improve the trace logging under connector based topic creation", "pr_createdAt": "2020-08-10T06:45:09Z", "pr_url": "https://github.com/apache/kafka/pull/9149", "timeline": [{"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "message": "KAFKA-10340: improve the logging to help user know what is going on", "committedDate": "2020-08-12T13:10:30Z", "type": "commit"}, {"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "message": "KAFKA-10340: improve the logging to help user know what is going on", "committedDate": "2020-08-12T13:10:30Z", "type": "forcePushed"}, {"oid": "b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "url": "https://github.com/apache/kafka/commit/b2a8d6236efbd61cc37d59890b9279ae20c91fdc", "message": "KAFKA-10340: improve the logging to help user know what is going on", "committedDate": "2020-08-12T13:10:30Z", "type": "forcePushed"}, {"oid": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "url": "https://github.com/apache/kafka/commit/b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KAFKA-10340", "committedDate": "2020-09-12T14:12:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MDQ4Nw==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491250487", "bodyText": "Writing one log message per record, seems excessive, even for DEBUG\nThere's a trace level message above for the record. Maybe we want to append the topic name there.", "author": "kkonstantine", "createdAt": "2020-09-19T01:20:02Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -363,6 +363,7 @@ private boolean sendRecords() {\n             try {\n                 maybeCreateTopic(record.topic());\n                 final String topic = producerRecord.topic();\n+                log.debug(\"{} is going to send record to {}\", WorkerSourceTask.this, topic);", "originalCommit": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkxMjg3Mg==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491912872", "bodyText": "OK", "author": "showuon", "createdAt": "2020-09-21T09:44:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MDQ4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "fb771714c15a704f26c34010f80f7f707fea54f1", "chunk": "diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\nindex b3b9b99c88..b209bd0c00 100644\n--- a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n\n@@ -363,7 +363,6 @@ class WorkerSourceTask extends WorkerTask {\n             try {\n                 maybeCreateTopic(record.topic());\n                 final String topic = producerRecord.topic();\n-                log.debug(\"{} is going to send record to {}\", WorkerSourceTask.this, topic);\n                 producer.send(\n                     producerRecord,\n                     (recordMetadata, e) -> {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MTgxOA==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491251818", "bodyText": "This is going to be very repetitive after the first time during which the topic might be created.\nWhat's the hint we are trying to extract here?", "author": "kkonstantine", "createdAt": "2020-09-19T01:27:52Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +410,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +", "originalCommit": "b1131ffaa1403c581ef5cd5adcae42b1cca9900d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkxNjYwNA==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r491916604", "bodyText": "@kkonstantine , thanks for the comment, what I'm trying to do here is to let the user know if the creating topic pending for a long time without response (default timeout is 30 or 60 secs), we let user know earlier that this situation might happen, and it could because the auto.create.topics.enable is disabled.", "author": "showuon", "createdAt": "2020-09-21T09:48:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTI1MTgxOA=="}], "type": "inlineReview", "revised_code": {"commit": "094ee6acc772f0532f5513f9d29e5b46f165bd01", "chunk": "diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\nindex b3b9b99c88..180a6bba3a 100644\n--- a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n\n@@ -410,9 +409,9 @@ class WorkerSourceTask extends WorkerTask {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n-            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n-                \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n-                \"to see if the topic can be auto created or not\", topic);\n+            log.trace(\"Topic creation by the connector is disabled or the topic {} was previously created.\" +\n+                \"If auto.create.topics.enable is enabled on the broker, \" +\n+                \"the topic will be created with default settings\", topic);\n             return;\n         }\n         log.info(\"The task will send records to topic '{}' for the first time. Checking \"\n"}}, {"oid": "fb771714c15a704f26c34010f80f7f707fea54f1", "url": "https://github.com/apache/kafka/commit/fb771714c15a704f26c34010f80f7f707fea54f1", "message": "KAFKA-10340: address reviewer's comment to append to trace level log", "committedDate": "2020-09-21T09:51:35Z", "type": "commit"}, {"oid": "ed949d7a7688fac66ce40207079769a5b23ddb28", "url": "https://github.com/apache/kafka/commit/ed949d7a7688fac66ce40207079769a5b23ddb28", "message": "Merge branch 'trunk' of https://github.com/apache/kafka into KAFKA-10340", "committedDate": "2020-09-21T09:52:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNjc0MQ==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r505136741", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n          \n          \n            \n                        log.trace(\"Topic creation by the connector is disabled or the topic {} was previously created.\" +", "author": "kkonstantine", "createdAt": "2020-10-15T03:03:42Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +409,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +", "originalCommit": "ed949d7a7688fac66ce40207079769a5b23ddb28", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "094ee6acc772f0532f5513f9d29e5b46f165bd01", "chunk": "diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\nindex b209bd0c00..180a6bba3a 100644\n--- a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n\n@@ -409,9 +409,9 @@ class WorkerSourceTask extends WorkerTask {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n-            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n-                \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n-                \"to see if the topic can be auto created or not\", topic);\n+            log.trace(\"Topic creation by the connector is disabled or the topic {} was previously created.\" +\n+                \"If auto.create.topics.enable is enabled on the broker, \" +\n+                \"the topic will be created with default settings\", topic);\n             return;\n         }\n         log.info(\"The task will send records to topic '{}' for the first time. Checking \"\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzNzQ2Mg==", "url": "https://github.com/apache/kafka/pull/9149#discussion_r505137462", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n          \n          \n            \n                            \"to see if the topic can be auto created or not\", topic);\n          \n          \n            \n                            \"If auto.create.topics.enable is enabled on the broker, the topic will be created with  \" +\n          \n          \n            \n                            \"default settings\", topic);", "author": "kkonstantine", "createdAt": "2020-10-15T03:06:35Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java", "diffHunk": "@@ -409,6 +409,9 @@ private boolean sendRecords() {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n+            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n+                \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n+                \"to see if the topic can be auto created or not\", topic);", "originalCommit": "ed949d7a7688fac66ce40207079769a5b23ddb28", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "094ee6acc772f0532f5513f9d29e5b46f165bd01", "chunk": "diff --git a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\nindex b209bd0c00..180a6bba3a 100644\n--- a/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n+++ b/connect/runtime/src/main/java/org/apache/kafka/connect/runtime/WorkerSourceTask.java\n\n@@ -409,9 +409,9 @@ class WorkerSourceTask extends WorkerTask {\n     // RegexRouter) topic creation can not be batched for multiple topics\n     private void maybeCreateTopic(String topic) {\n         if (!topicCreation.isTopicCreationRequired(topic)) {\n-            log.trace(\"The topic creation setting is disabled or the topic name {} is already in the topic cache.\" +\n-                \"If the topic doesn't exist, we'll rely on the auto.create.topics.enable setting in broker side \" +\n-                \"to see if the topic can be auto created or not\", topic);\n+            log.trace(\"Topic creation by the connector is disabled or the topic {} was previously created.\" +\n+                \"If auto.create.topics.enable is enabled on the broker, \" +\n+                \"the topic will be created with default settings\", topic);\n             return;\n         }\n         log.info(\"The task will send records to topic '{}' for the first time. Checking \"\n"}}, {"oid": "094ee6acc772f0532f5513f9d29e5b46f165bd01", "url": "https://github.com/apache/kafka/commit/094ee6acc772f0532f5513f9d29e5b46f165bd01", "message": "KAFKA-10340: improve the logging", "committedDate": "2020-10-15T03:19:31Z", "type": "commit"}]}