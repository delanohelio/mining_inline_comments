{"pr_number": 8647, "pr_title": "KAFKA-9669; Loosen validation of inner offsets for older message formats", "pr_createdAt": "2020-05-12T00:49:57Z", "pr_url": "https://github.com/apache/kafka/pull/8647", "timeline": [{"oid": "3bfde0f4eb8910fc81e239a3006a5736ea6bee12", "url": "https://github.com/apache/kafka/commit/3bfde0f4eb8910fc81e239a3006a5736ea6bee12", "message": "KAFKA-9669; Loosen validation of inner offsets for older message format versions", "committedDate": "2020-05-12T00:58:03Z", "type": "commit"}, {"oid": "3bfde0f4eb8910fc81e239a3006a5736ea6bee12", "url": "https://github.com/apache/kafka/commit/3bfde0f4eb8910fc81e239a3006a5736ea6bee12", "message": "KAFKA-9669; Loosen validation of inner offsets for older message format versions", "committedDate": "2020-05-12T00:58:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MTg1Mw==", "url": "https://github.com/apache/kafka/pull/8647#discussion_r423851853", "bodyText": "I'm a bit nervous about this method being in the public interface. Could we make it package private and then add a test utility method in the same package that calls it, exposing it only for tests?", "author": "ijuma", "createdAt": "2020-05-12T16:02:03Z", "path": "clients/src/main/java/org/apache/kafka/common/record/MemoryRecordsBuilder.java", "diffHunk": "@@ -587,6 +588,35 @@ public void appendUncheckedWithOffset(long offset, LegacyRecord record) {\n         }\n     }\n \n+    /**\n+     * Append a record without doing offset/magic validation (this should only be used in testing).\n+     *\n+     * @param offset The offset of the record\n+     * @param record The record to add\n+     */\n+    public void appendUncheckedWithOffset(long offset, SimpleRecord record) throws IOException {", "originalCommit": "3bfde0f4eb8910fc81e239a3006a5736ea6bee12", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MzA5Mw==", "url": "https://github.com/apache/kafka/pull/8647#discussion_r423853093", "bodyText": "Oh, we already have a public appendUncheckedWithOffset for LegacyRecord.", "author": "ijuma", "createdAt": "2020-05-12T16:03:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MTg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg2MjYzOQ==", "url": "https://github.com/apache/kafka/pull/8647#discussion_r423862639", "bodyText": "We could move these methods to a TestMemoryRecordsBuilder or something. I think risk of misuse is probably not high though.", "author": "hachikuji", "createdAt": "2020-05-12T16:17:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MTg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg3OTc1NA==", "url": "https://github.com/apache/kafka/pull/8647#discussion_r423879754", "bodyText": "Makes sense. Since we already had one such method, I'm ok with keeping as is.", "author": "ijuma", "createdAt": "2020-05-12T16:42:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MTg1Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "b174f7c272a0cdec396e613507c612ded7f96044", "url": "https://github.com/apache/kafka/commit/b174f7c272a0cdec396e613507c612ded7f96044", "message": "Add comment about internal offset validation", "committedDate": "2020-05-12T16:45:30Z", "type": "commit"}]}