{"pr_number": 8040, "pr_title": "KAFKA-6607: Commit correct offsets for transactional input data", "pr_createdAt": "2020-02-05T01:16:19Z", "pr_url": "https://github.com/apache/kafka/pull/8040", "timeline": [{"oid": "8a564d863a6fab1f46f84746e458b98bb3c17208", "url": "https://github.com/apache/kafka/commit/8a564d863a6fab1f46f84746e458b98bb3c17208", "message": "KAFKA-6607: Commit correct offsets for transactional input data", "committedDate": "2020-02-11T01:09:44Z", "type": "commit"}, {"oid": "d73faa32e31ca49c6bd13953d4621975db40d146", "url": "https://github.com/apache/kafka/commit/d73faa32e31ca49c6bd13953d4621975db40d146", "message": "Remove debug stuff", "committedDate": "2020-02-11T01:09:44Z", "type": "commit"}, {"oid": "96f63c37ec0135d1c579c36a1c4200fe56d3ea07", "url": "https://github.com/apache/kafka/commit/96f63c37ec0135d1c579c36a1c4200fe56d3ea07", "message": "Github comments", "committedDate": "2020-02-11T01:09:44Z", "type": "commit"}, {"oid": "be4557192c09d5b2473a49cfb8c5707e71999da7", "url": "https://github.com/apache/kafka/commit/be4557192c09d5b2473a49cfb8c5707e71999da7", "message": "Fix test", "committedDate": "2020-02-11T01:09:44Z", "type": "commit"}, {"oid": "7f3c62b60fc1a4a73a3770838ebbc83dcafe0a8d", "url": "https://github.com/apache/kafka/commit/7f3c62b60fc1a4a73a3770838ebbc83dcafe0a8d", "message": "Revert consumer change and fix StreamThread to not drop records", "committedDate": "2020-02-11T01:09:44Z", "type": "commit"}, {"oid": "7f3c62b60fc1a4a73a3770838ebbc83dcafe0a8d", "url": "https://github.com/apache/kafka/commit/7f3c62b60fc1a4a73a3770838ebbc83dcafe0a8d", "message": "Revert consumer change and fix StreamThread to not drop records", "committedDate": "2020-02-11T01:09:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQyNTE0Mw==", "url": "https://github.com/apache/kafka/pull/8040#discussion_r377425143", "bodyText": "maybe we can also log this as INFO for debugging purposes?", "author": "guozhangwang", "createdAt": "2020-02-11T02:41:54Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -917,6 +917,13 @@ private void addRecordsToTasks(final ConsumerRecords<byte[], byte[]> records) {\n             final StreamTask task = taskManager.activeTask(partition);\n \n             if (task == null) {\n+                if (!isRunning()) {\n+                    // if we are in PENDING_SHUTDOWN and don't find the task it implies that it was a newly assigned\n+                    // task that we just skipped to create;\n+                    // hence, we just skip adding the corresponding records\n+                    continue;", "originalCommit": "7f3c62b60fc1a4a73a3770838ebbc83dcafe0a8d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "944fe8ec3720a43d895669f340184d025c880708", "chunk": "diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\nindex 6526f7b7ba..b6b3d83e75 100644\n--- a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n\n@@ -921,6 +921,7 @@ public class StreamThread extends Thread {\n                     // if we are in PENDING_SHUTDOWN and don't find the task it implies that it was a newly assigned\n                     // task that we just skipped to create;\n                     // hence, we just skip adding the corresponding records\n+                    log.info(\"State already transits to {}, skipping the add records to non-existing task for partition {}\", state, partition);\n                     continue;\n                 }\n \n"}}, {"oid": "944fe8ec3720a43d895669f340184d025c880708", "url": "https://github.com/apache/kafka/commit/944fe8ec3720a43d895669f340184d025c880708", "message": "Github comment", "committedDate": "2020-02-11T03:10:03Z", "type": "commit"}]}