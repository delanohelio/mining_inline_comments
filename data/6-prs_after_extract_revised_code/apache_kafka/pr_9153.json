{"pr_number": 9153, "pr_title": "MINOR: Fix state transition diagram for stream threads", "pr_createdAt": "2020-08-10T12:31:52Z", "pr_url": "https://github.com/apache/kafka/pull/9153", "timeline": [{"oid": "a1fb48d192506b1a0e8cdb113596902afae1b208", "url": "https://github.com/apache/kafka/commit/a1fb48d192506b1a0e8cdb113596902afae1b208", "message": "MINOR: Fix state transition diagram for stream threads", "committedDate": "2020-08-10T12:30:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg3MTczMA==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r467871730", "bodyText": "Before this change a transition from STARTING to RUNNING was possible in the diagram. However, such a transition is not valid.", "author": "cadonna", "createdAt": "2020-08-10T12:34:23Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -93,7 +95,7 @@\n      *          |      +-----+-------+      |\n      *          +<---- | Partitions  |      |\n      *          |      | Assigned (3)| <----+\n-     *          |      +-----+-------+      |\n+     *          |      +-----+-------+      ^", "originalCommit": "a1fb48d192506b1a0e8cdb113596902afae1b208", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwMzMwMQ==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r468103301", "bodyText": "This seems a bit subtle. What if we instead break up the loop from Running --> Running below?", "author": "ableegoldman", "createdAt": "2020-08-10T18:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg3MTczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyMTI3Mw==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r468121273", "bodyText": "I had the same feeling. I will change it.", "author": "cadonna", "createdAt": "2020-08-10T19:14:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg3MTczMA=="}], "type": "inlineReview", "revised_code": {"commit": "ac178ddcd5c0c7b02ec3fef5cf1828e009aec44c", "chunk": "diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\nindex d42e30bce3..2c39e1f126 100644\n--- a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n\n@@ -90,20 +89,20 @@ public class StreamThread extends Thread {\n      *          |      | Revoked (2) | <----+\n      *          |      +-----+-------+      |\n      *          |           |  ^            |\n-     *          |           |  |            |\n      *          |           v  |            |\n      *          |      +-----+-------+      |\n      *          +<---- | Partitions  |      |\n      *          |      | Assigned (3)| <----+\n-     *          |      +-----+-------+      ^\n-     *          |            |              |\n-     *          |            |--------------+\n-     *          |            v              |\n      *          |      +-----+-------+      |\n+     *          |            |              |\n+     *          |            +<----------+  |\n+     *          |            |           |  |\n+     *          |            v           |  |\n+     *          |      +-----+-------+   |  |\n+     *          |      |             | --+  |\n      *          |      | Running (4) | ---->+\n      *          |      +-----+-------+\n      *          |            |\n-     *          |            |\n      *          |            v\n      *          |      +-----+-------+\n      *          +----> | Pending     |\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg3MjIyNw==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r467872227", "bodyText": "This valid loop was only mentioned in the notes but was not shown in the diagram.", "author": "cadonna", "createdAt": "2020-08-10T12:35:22Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -80,11 +80,13 @@\n      *          |      +-----+-------+\n      *          +<---- | Starting (1)|----->+\n      *          |      +-----+-------+      |\n-     *          |            |              |\n-     *          |            |              |\n-     *          |            v              |\n-     *          |      +-----+-------+      |\n-     *          +<---- | Partitions  |      |\n+     *          |                           |\n+     *          |                           |\n+     *          |            +<----------+  |\n+     *          |            |           |  |\n+     *          |            v           |  |\n+     *          |      +-----+-------+   |  |\n+     *          +<---- | Partitions  | --+  |", "originalCommit": "a1fb48d192506b1a0e8cdb113596902afae1b208", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwNDYzMg==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r468104632", "bodyText": "Nice catch", "author": "ableegoldman", "createdAt": "2020-08-10T18:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg3MjIyNw=="}], "type": "inlineReview", "revised_code": {"commit": "ac178ddcd5c0c7b02ec3fef5cf1828e009aec44c", "chunk": "diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\nindex d42e30bce3..2c39e1f126 100644\n--- a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n\n@@ -81,7 +81,6 @@ public class StreamThread extends Thread {\n      *          +<---- | Starting (1)|----->+\n      *          |      +-----+-------+      |\n      *          |                           |\n-     *          |                           |\n      *          |            +<----------+  |\n      *          |            |           |  |\n      *          |            v           |  |\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEwNDQyNA==", "url": "https://github.com/apache/kafka/pull/9153#discussion_r468104424", "bodyText": "It seems like this here is the problem...AFAICT this line is just to demonstrate that RUNNING -> RUNNING is valid, but it's tied in to the arrows connecting every other state that actually can't transition to Running. Can we change this to a self-contained loop like you added for PARTITIONS_REVOKED?", "author": "ableegoldman", "createdAt": "2020-08-10T18:42:47Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java", "diffHunk": "@@ -93,7 +95,7 @@\n      *          |      +-----+-------+      |\n      *          +<---- | Partitions  |      |\n      *          |      | Assigned (3)| <----+\n-     *          |      +-----+-------+      |\n+     *          |      +-----+-------+      ^\n      *          |            |              |\n      *          |            |--------------+", "originalCommit": "a1fb48d192506b1a0e8cdb113596902afae1b208", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ac178ddcd5c0c7b02ec3fef5cf1828e009aec44c", "chunk": "diff --git a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\nindex d42e30bce3..2c39e1f126 100644\n--- a/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n+++ b/streams/src/main/java/org/apache/kafka/streams/processor/internals/StreamThread.java\n\n@@ -90,20 +89,20 @@ public class StreamThread extends Thread {\n      *          |      | Revoked (2) | <----+\n      *          |      +-----+-------+      |\n      *          |           |  ^            |\n-     *          |           |  |            |\n      *          |           v  |            |\n      *          |      +-----+-------+      |\n      *          +<---- | Partitions  |      |\n      *          |      | Assigned (3)| <----+\n-     *          |      +-----+-------+      ^\n-     *          |            |              |\n-     *          |            |--------------+\n-     *          |            v              |\n      *          |      +-----+-------+      |\n+     *          |            |              |\n+     *          |            +<----------+  |\n+     *          |            |           |  |\n+     *          |            v           |  |\n+     *          |      +-----+-------+   |  |\n+     *          |      |             | --+  |\n      *          |      | Running (4) | ---->+\n      *          |      +-----+-------+\n      *          |            |\n-     *          |            |\n      *          |            v\n      *          |      +-----+-------+\n      *          +----> | Pending     |\n"}}, {"oid": "ac178ddcd5c0c7b02ec3fef5cf1828e009aec44c", "url": "https://github.com/apache/kafka/commit/ac178ddcd5c0c7b02ec3fef5cf1828e009aec44c", "message": "Include feedback", "committedDate": "2020-08-10T19:16:04Z", "type": "commit"}]}