{"pr_number": 11905, "pr_title": "Propagate reservedTo", "pr_createdAt": "2020-01-23T12:15:35Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/11905", "timeline": [{"oid": "1ccc915c58196a5dff01157781ace1aac417ba66", "url": "https://github.com/vespa-engine/vespa/commit/1ccc915c58196a5dff01157781ace1aac417ba66", "message": "Propagate reservedTo", "committedDate": "2020-01-23T12:13:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA4NzUxMQ==", "url": "https://github.com/vespa-engine/vespa/pull/11905#discussion_r370087511", "bodyText": "This is exclusively for adding config-server/controllers...", "author": "freva", "createdAt": "2020-01-23T12:24:08Z", "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/configserver/noderepository/AddNode.java", "diffHunk": "@@ -19,26 +20,30 @@\n     public final Optional<String> nodeFlavor;\n     public final Optional<FlavorOverrides> flavorOverrides;\n     public final Optional<NodeResources> nodeResources;\n+    public final Optional<TenantName> reservedTo;\n     public final NodeType nodeType;\n     public final Set<String> ipAddresses;\n     public final Set<String> additionalIpAddresses;\n \n-    public static AddNode forHost(String hostname, String nodeFlavor, Optional<FlavorOverrides> flavorOverrides, NodeType nodeType, Set<String> ipAddresses, Set<String> additionalIpAddresses) {\n-        return new AddNode(hostname, Optional.empty(), Optional.of(nodeFlavor), flavorOverrides, Optional.empty(), nodeType, ipAddresses, additionalIpAddresses);\n+    public static AddNode forHost(String hostname, String nodeFlavor, Optional<FlavorOverrides> flavorOverrides, Optional<TenantName> reservedTo, NodeType nodeType, Set<String> ipAddresses, Set<String> additionalIpAddresses) {", "originalCommit": "1ccc915c58196a5dff01157781ace1aac417ba66", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA4ODA2Mg==", "url": "https://github.com/vespa-engine/vespa/pull/11905#discussion_r370088062", "bodyText": "This is will only ever return allocated tenant nodes...", "author": "freva", "createdAt": "2020-01-23T12:25:31Z", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/restapi/application/ApplicationApiHandler.java", "diffHunk": "@@ -600,6 +600,7 @@ private HttpResponse nodes(String tenantName, String applicationName, String ins\n             Cursor nodeObject = nodesArray.addObject();\n             nodeObject.setString(\"hostname\", node.hostname().value());\n             nodeObject.setString(\"state\", valueOf(node.state()));\n+            node.reservedTo().ifPresent(tenant -> nodeObject.setString(\"reservedTo\", tenant.value()));", "originalCommit": "1ccc915c58196a5dff01157781ace1aac417ba66", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "21daf461cc6d78af6e1442775a31efa91532bcc9", "url": "https://github.com/vespa-engine/vespa/commit/21daf461cc6d78af6e1442775a31efa91532bcc9", "message": "empty, not null", "committedDate": "2020-01-23T12:48:03Z", "type": "commit"}]}