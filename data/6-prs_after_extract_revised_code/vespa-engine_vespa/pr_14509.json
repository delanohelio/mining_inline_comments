{"pr_number": 14509, "pr_title": "Run some maintainers with higher interval", "pr_createdAt": "2020-09-23T12:58:05Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/14509", "timeline": [{"oid": "efc62ebb67af59aa6410e9604961722d7f04958e", "url": "https://github.com/vespa-engine/vespa/commit/efc62ebb67af59aa6410e9604961722d7f04958e", "message": "Run some maintainers with higher interval\n\nWhen deployments exist on all config servers each server will deploy,\nso do it with 3 times higher interval", "committedDate": "2020-09-23T12:56:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYwNTQ4Nw==", "url": "https://github.com/vespa-engine/vespa/pull/14509#discussion_r493605487", "bodyText": "PeriodicApplicationMaintainer runs every minute (redeployMaintainerInterval), this is the minTimeBetweenRedeployments, so I don't think we should change this.", "author": "freva", "createdAt": "2020-09-23T13:46:38Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java", "diffHunk": "@@ -178,14 +180,14 @@ public void deconstruct() {\n             nodeMetricsCollectionInterval = Duration.ofMinutes(1);\n             operatorChangeRedeployInterval = Duration.ofMinutes(1);\n             osUpgradeActivatorInterval = zone.system().isCd() ? Duration.ofSeconds(30) : Duration.ofMinutes(5);\n-            periodicRedeployInterval = Duration.ofMinutes(30);\n+            periodicRedeployInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(90) : Duration.ofMinutes(30);", "originalCommit": "efc62ebb67af59aa6410e9604961722d7f04958e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxNTU5Mg==", "url": "https://github.com/vespa-engine/vespa/pull/14509#discussion_r493615592", "bodyText": "Ouch, yes, thanks", "author": "hmusum", "createdAt": "2020-09-23T13:58:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYwNTQ4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "ae9af2ba9c3c476ef1e228a0bc36928c013ae3f3", "chunk": "diff --git a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\nindex 02ceee37e5..dd5d9d040b 100644\n--- a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\n+++ b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\n\n@@ -180,7 +179,7 @@ public class NodeRepositoryMaintenance extends AbstractComponent {\n             nodeMetricsCollectionInterval = Duration.ofMinutes(1);\n             operatorChangeRedeployInterval = Duration.ofMinutes(1);\n             osUpgradeActivatorInterval = zone.system().isCd() ? Duration.ofSeconds(30) : Duration.ofMinutes(5);\n-            periodicRedeployInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(90) : Duration.ofMinutes(30);\n+            periodicRedeployInterval = Duration.ofMinutes(30);\n             provisionedExpiry = Duration.ofHours(4);\n             rebalancerInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(120) : Duration.ofMinutes(40);\n             redeployMaintainerInterval = Duration.ofMinutes(1);\n"}}, {"oid": "ae9af2ba9c3c476ef1e228a0bc36928c013ae3f3", "url": "https://github.com/vespa-engine/vespa/commit/ae9af2ba9c3c476ef1e228a0bc36928c013ae3f3", "message": "Redeploy interval should not change", "committedDate": "2020-09-23T14:00:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyMTU0Nw==", "url": "https://github.com/vespa-engine/vespa/pull/14509#discussion_r493621547", "bodyText": "This can also be reduced back now, it does not deploy (assume it was increased because of periodic interval change?)", "author": "freva", "createdAt": "2020-09-23T14:06:28Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java", "diffHunk": "@@ -180,12 +181,12 @@ public void deconstruct() {\n             osUpgradeActivatorInterval = zone.system().isCd() ? Duration.ofSeconds(30) : Duration.ofMinutes(5);\n             periodicRedeployInterval = Duration.ofMinutes(30);\n             provisionedExpiry = Duration.ofHours(4);\n-            rebalancerInterval = Duration.ofMinutes(40);\n+            rebalancerInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(120) : Duration.ofMinutes(40);\n             redeployMaintainerInterval = Duration.ofMinutes(1);\n             // Need to be long enough for deployment to be finished for all config model versions\n             // Should be equal to timeout for deployments\n             reservationExpiry = zone.system().isCd() ? Duration.ofMinutes(5) : Duration.ofMinutes(30);\n-            scalingSuggestionsInterval = Duration.ofMinutes(31);\n+            scalingSuggestionsInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(91) : Duration.ofMinutes(31);", "originalCommit": "ae9af2ba9c3c476ef1e228a0bc36928c013ae3f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyODQ5MA==", "url": "https://github.com/vespa-engine/vespa/pull/14509#discussion_r493628490", "bodyText": "Yes, thanks, fixed", "author": "hmusum", "createdAt": "2020-09-23T14:15:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYyMTU0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "135ac2fce54089d30ef1328efeea80ba87123627", "chunk": "diff --git a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\nindex dd5d9d040b..4f562d3960 100644\n--- a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\n+++ b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/NodeRepositoryMaintenance.java\n\n@@ -186,7 +186,7 @@ public class NodeRepositoryMaintenance extends AbstractComponent {\n             // Need to be long enough for deployment to be finished for all config model versions\n             // Should be equal to timeout for deployments\n             reservationExpiry = zone.system().isCd() ? Duration.ofMinutes(5) : Duration.ofMinutes(30);\n-            scalingSuggestionsInterval = deploymentExistsOnAllConfigServers ? Duration.ofMinutes(91) : Duration.ofMinutes(31);\n+            scalingSuggestionsInterval = Duration.ofMinutes(31);\n             spareCapacityMaintenanceInterval = Duration.ofMinutes(10);\n             throttlePolicy = NodeFailer.ThrottlePolicy.hosted;\n \n"}}, {"oid": "135ac2fce54089d30ef1328efeea80ba87123627", "url": "https://github.com/vespa-engine/vespa/commit/135ac2fce54089d30ef1328efeea80ba87123627", "message": "No need for different intervals, maintainer does not deploy", "committedDate": "2020-09-23T14:14:41Z", "type": "commit"}, {"oid": "94b206e75e62b6e0878f66b5a4f1f071c187ff73", "url": "https://github.com/vespa-engine/vespa/commit/94b206e75e62b6e0878f66b5a4f1f071c187ff73", "message": "Run some more maintainers with higher interval", "committedDate": "2020-09-23T14:25:03Z", "type": "commit"}]}