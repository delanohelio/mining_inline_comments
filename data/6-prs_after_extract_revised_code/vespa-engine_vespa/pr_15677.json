{"pr_number": 15677, "pr_title": "Jonmv/reindexing over multiple clusters", "pr_createdAt": "2020-12-04T13:02:55Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15677", "timeline": [{"oid": "abccb89f36406b31542cc534128abe75bc643fd3", "url": "https://github.com/vespa-engine/vespa/commit/abccb89f36406b31542cc534128abe75bc643fd3", "message": "Revert \"Revert \"Expand config to allow mulitple clusters per reindexer\"\"\n\nThis reverts commit 42ea6785dc38a600153501a463df312ef9dd2721.", "committedDate": "2020-12-04T12:55:11Z", "type": "commit"}, {"oid": "2deea20f246624d08b384e7c9a78b65c3aed8900", "url": "https://github.com/vespa-engine/vespa/commit/2deea20f246624d08b384e7c9a78b65c3aed8900", "message": "Expect NPE when we should expect NPE, and avoid IAE due to illegal config", "committedDate": "2020-12-04T13:02:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA4NjA5NQ==", "url": "https://github.com/vespa-engine/vespa/pull/15677#discussion_r536086095", "bodyText": "A bit weird to have a NPE as part of the expected behaviour", "author": "bjorncs", "createdAt": "2020-12-04T13:06:28Z", "path": "clustercontroller-reindexer/src/test/java/ai/vespa/reindexing/ReindexingMaintainerTest.java", "diffHunk": "@@ -39,8 +39,9 @@ void testParsing() {\n                                 manager));\n \n         // Unknown document type fails\n-        assertThrows(IllegalArgumentException.class,\n+        assertThrows(NullPointerException.class,", "originalCommit": "2deea20f246624d08b384e7c9a78b65c3aed8900", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5d17334d1d65b45c13c3962831fab03760c34ffb", "chunk": "diff --git a/clustercontroller-reindexer/src/test/java/ai/vespa/reindexing/ReindexingMaintainerTest.java b/clustercontroller-reindexer/src/test/java/ai/vespa/reindexing/ReindexingMaintainerTest.java\nindex c7ff038343..afa68debad 100644\n--- a/clustercontroller-reindexer/src/test/java/ai/vespa/reindexing/ReindexingMaintainerTest.java\n+++ b/clustercontroller-reindexer/src/test/java/ai/vespa/reindexing/ReindexingMaintainerTest.java\n\n@@ -31,18 +31,15 @@ class ReindexingMaintainerTest {\n         DocumentTypeManager manager = new DocumentTypeManager(musicConfig);\n \n         assertEquals(Map.of(manager.getDocumentType(\"music\"), Instant.ofEpochMilli(123)),\n-                     parseReady(new ReindexingConfig.Builder()\n-                                        .enabled(true)\n-                                        .clusterName(\"cluster\")\n-                                        .status(\"music\", new ReindexingConfig.Status.Builder().readyAtMillis(123))\n+                     parseReady(new ReindexingConfig.Clusters.Builder()\n+                                        .documentTypes(\"music\", new ReindexingConfig.Clusters.DocumentTypes.Builder().readyAtMillis(123))\n                                         .build(),\n                                 manager));\n \n         // Unknown document type fails\n         assertThrows(NullPointerException.class,\n-                     () -> parseReady(new ReindexingConfig.Builder()\n-                                              .clusterName(\"cluster\")\n-                                              .status(\"poetry\", new ReindexingConfig.Status.Builder().readyAtMillis(123))\n+                     () -> parseReady(new ReindexingConfig.Clusters.Builder()\n+                                              .documentTypes(\"poetry\", new ReindexingConfig.Clusters.DocumentTypes.Builder().readyAtMillis(123))\n                                               .build(),\n                                       manager));\n \n"}}, {"oid": "5d17334d1d65b45c13c3962831fab03760c34ffb", "url": "https://github.com/vespa-engine/vespa/commit/5d17334d1d65b45c13c3962831fab03760c34ffb", "message": "Support multiple clusters in one cluster controller", "committedDate": "2020-12-04T14:10:17Z", "type": "commit"}, {"oid": "db40d63bc83c57360fba480ee9e3fae8ab0477b2", "url": "https://github.com/vespa-engine/vespa/commit/db40d63bc83c57360fba480ee9e3fae8ab0477b2", "message": "Merge reindexing responses with multiple clusters in client in cfg server", "committedDate": "2020-12-04T14:50:46Z", "type": "commit"}]}