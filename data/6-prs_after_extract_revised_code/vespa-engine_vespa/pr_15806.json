{"pr_number": 15806, "pr_title": "Provide some human-readable responses to reindexing commands", "pr_createdAt": "2020-12-14T10:53:59Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15806", "timeline": [{"oid": "8dd6dbf27c66bd3682b6a40683ef1890e99cfd47", "url": "https://github.com/vespa-engine/vespa/commit/8dd6dbf27c66bd3682b6a40683ef1890e99cfd47", "message": "Provide some human-readable responses to reindexing commands", "committedDate": "2020-12-14T10:53:39Z", "type": "commit"}, {"oid": "60b73052b8fb2191c53871cc8faefa4e521c5eb7", "url": "https://github.com/vespa-engine/vespa/commit/60b73052b8fb2191c53871cc8faefa4e521c5eb7", "message": "Cleaner", "committedDate": "2020-12-14T10:57:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM0Mjc3MQ==", "url": "https://github.com/vespa-engine/vespa/pull/15806#discussion_r542342771", "bodyText": "This feels sufficiently magical that I think it'd be good to encapsulate it in a createJsonResponseWithMessage-ish method and only do the wizardry once there", "author": "vekterli", "createdAt": "2020-12-14T12:22:56Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/http/v2/ApplicationHandler.java", "diffHunk": "@@ -86,7 +88,7 @@ public HttpResponse handleDELETE(HttpRequest request) {\n \n         if (isReindexingRequest(request)) {\n             applicationRepository.modifyReindexing(applicationId, reindexing -> reindexing.enabled(false));\n-            return new JSONResponse(Response.Status.OK);\n+            return new JSONResponse(Response.Status.OK) { { object.setString(\"message\", \"Reindexing disabled\"); } };", "originalCommit": "60b73052b8fb2191c53871cc8faefa4e521c5eb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM2Njk0MA==", "url": "https://github.com/vespa-engine/vespa/pull/15806#discussion_r542366940", "bodyText": "You're right.", "author": "jonmv", "createdAt": "2020-12-14T13:04:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM0Mjc3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "cbe15ae1bd3f9bb6849cdf6e2684dcf85ce5298b", "chunk": "diff --git a/configserver/src/main/java/com/yahoo/vespa/config/server/http/v2/ApplicationHandler.java b/configserver/src/main/java/com/yahoo/vespa/config/server/http/v2/ApplicationHandler.java\nindex 9966f9c077..0b461b1096 100644\n--- a/configserver/src/main/java/com/yahoo/vespa/config/server/http/v2/ApplicationHandler.java\n+++ b/configserver/src/main/java/com/yahoo/vespa/config/server/http/v2/ApplicationHandler.java\n\n@@ -88,7 +88,7 @@ public class ApplicationHandler extends HttpHandler {\n \n         if (isReindexingRequest(request)) {\n             applicationRepository.modifyReindexing(applicationId, reindexing -> reindexing.enabled(false));\n-            return new JSONResponse(Response.Status.OK) { { object.setString(\"message\", \"Reindexing disabled\"); } };\n+            return createMessageResponse(\"Reindexing disabled\");\n         }\n \n         if (applicationRepository.delete(applicationId))\n"}}, {"oid": "cbe15ae1bd3f9bb6849cdf6e2684dcf85ce5298b", "url": "https://github.com/vespa-engine/vespa/commit/cbe15ae1bd3f9bb6849cdf6e2684dcf85ce5298b", "message": "Wrap anonymous JSONResponse implementation", "committedDate": "2020-12-14T13:04:04Z", "type": "commit"}]}