{"pr_number": 13015, "pr_title": "Use DockerImage instead of String", "pr_createdAt": "2020-04-22T11:27:45Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13015", "timeline": [{"oid": "824aa65535493c8ce7938059e4fee3bdcb5d0ed1", "url": "https://github.com/vespa-engine/vespa/commit/824aa65535493c8ce7938059e4fee3bdcb5d0ed1", "message": "Use DockerImage instead of String", "committedDate": "2020-04-22T11:27:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA2ODY4OQ==", "url": "https://github.com/vespa-engine/vespa/pull/13015#discussion_r416068689", "bodyText": "The null behaviors in this class are all over the place. endpointCertificateMetadata(String), containerEndpoints(String) ignores it, as does athenzDomain(AthenzDomain), while athenzDomain(String), and tlsSecretsKeyName(String) (correctly, IMO) resets the state.", "author": "freva", "createdAt": "2020-04-27T18:56:11Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/PrepareParams.java", "diffHunk": "@@ -153,6 +154,12 @@ public Builder endpointCertificateMetadata(String serialized) {\n         }\n \n         public Builder dockerImageRepository(String dockerImageRepository) {\n+            if (dockerImageRepository == null) return this;", "originalCommit": "824aa65535493c8ce7938059e4fee3bdcb5d0ed1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA4MDQ4Mg==", "url": "https://github.com/vespa-engine/vespa/pull/13015#discussion_r416080482", "bodyText": "Yes, good point, I'll try to clean it up", "author": "hmusum", "createdAt": "2020-04-27T19:14:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA2ODY4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "d68b6c23b59ca1292df8b85e82301d4e8516297e", "chunk": "diff --git a/configserver/src/main/java/com/yahoo/vespa/config/server/session/PrepareParams.java b/configserver/src/main/java/com/yahoo/vespa/config/server/session/PrepareParams.java\nindex df5e3d630f..e5d4cf9b1f 100644\n--- a/configserver/src/main/java/com/yahoo/vespa/config/server/session/PrepareParams.java\n+++ b/configserver/src/main/java/com/yahoo/vespa/config/server/session/PrepareParams.java\n\n@@ -147,21 +146,21 @@ public final class PrepareParams {\n         }\n \n         public Builder endpointCertificateMetadata(String serialized) {\n-            if(serialized == null) return this;\n-            Slime slime = SlimeUtils.jsonToSlime(serialized);\n-            endpointCertificateMetadata = Optional.of(EndpointCertificateMetadataSerializer.fromSlime(slime.get()));\n+            this.endpointCertificateMetadata = (serialized == null)\n+                    ? Optional.empty()\n+                    : Optional.of(EndpointCertificateMetadataSerializer.fromSlime(SlimeUtils.jsonToSlime(serialized).get()));\n             return this;\n         }\n \n         public Builder dockerImageRepository(String dockerImageRepository) {\n-            if (dockerImageRepository == null) return this;\n-            this.dockerImageRepository = Optional.of(DockerImage.fromString(dockerImageRepository));\n+            this.dockerImageRepository = (dockerImageRepository == null)\n+                    ? Optional.empty()\n+                    : Optional.of(DockerImage.fromString(dockerImageRepository));\n             return this;\n         }\n \n         public Builder dockerImageRepository(DockerImage dockerImageRepository) {\n-            if (dockerImageRepository == null) return this;\n-            this.dockerImageRepository = Optional.of(dockerImageRepository);\n+            this.dockerImageRepository = Optional.ofNullable(dockerImageRepository);\n             return this;\n         }\n \n"}}, {"oid": "d68b6c23b59ca1292df8b85e82301d4e8516297e", "url": "https://github.com/vespa-engine/vespa/commit/d68b6c23b59ca1292df8b85e82301d4e8516297e", "message": "Handle null value arguments to Builder methods better", "committedDate": "2020-04-27T19:18:15Z", "type": "commit"}, {"oid": "380bb7be6070516c0ef0e5b7963632680d45e93c", "url": "https://github.com/vespa-engine/vespa/commit/380bb7be6070516c0ef0e5b7963632680d45e93c", "message": "Merge branch 'master' into hmusum/use-docker-image-instead-of-string-3", "committedDate": "2020-04-27T19:23:07Z", "type": "commit"}]}