{"pr_number": 13489, "pr_title": "Config server refactoring, part 6", "pr_createdAt": "2020-06-04T19:16:12Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13489", "timeline": [{"oid": "2021ee5263ac84b2f81ef748308ddf13b612b162", "url": "https://github.com/vespa-engine/vespa/commit/2021ee5263ac84b2f81ef748308ddf13b612b162", "message": "Remove dead code", "committedDate": "2020-06-04T06:25:04Z", "type": "commit"}, {"oid": "be78d3ca58195e5461986f50e0597cfbf16f8810", "url": "https://github.com/vespa-engine/vespa/commit/be78d3ca58195e5461986f50e0597cfbf16f8810", "message": "Merge TenantApplications and TenantRequestHandler\n\nMove tests to ApplicationRepositoryTest or TenantApplicationsTest", "committedDate": "2020-06-04T19:15:07Z", "type": "commit"}, {"oid": "6b111969731bb4d18c2e26e817b0a205e50dc3ea", "url": "https://github.com/vespa-engine/vespa/commit/6b111969731bb4d18c2e26e817b0a205e50dc3ea", "message": "Remove debug output", "committedDate": "2020-06-05T06:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjkyNw==", "url": "https://github.com/vespa-engine/vespa/pull/13489#discussion_r435786927", "bodyText": "If all the things are directly available for injection, I suggest to do that instead of using the GlobalComponentRegistry.", "author": "gjoranv", "createdAt": "2020-06-05T09:01:04Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/TenantApplications.java", "diffHunk": "@@ -38,32 +53,43 @@\n  * @author Ulf Lilleengen\n  * @author jonmv\n  */\n-public class TenantApplications {\n+public class TenantApplications implements RequestHandler, ReloadHandler, HostValidator<ApplicationId> {\n \n     private static final Logger log = Logger.getLogger(TenantApplications.class.getName());\n \n     private final Curator curator;\n     private final Path applicationsPath;\n     private final Path locksPath;\n     private final Curator.DirectoryCache directoryCache;\n-    private final ReloadHandler reloadHandler;\n     private final Executor zkWatcherExecutor;\n+    private final Metrics metrics;\n+    private final TenantName tenant;\n+    private final List<ReloadListener> reloadListeners;\n+    private final ConfigResponseFactory responseFactory;\n+    private final HostRegistry<ApplicationId> hostRegistry;\n+    private final ApplicationMapper applicationMapper = new ApplicationMapper();\n+    private final MetricUpdater tenantMetricUpdater;\n+    private final Clock clock = Clock.systemUTC();\n \n-    private TenantApplications(Curator curator, ReloadHandler reloadHandler, TenantName tenant,\n-                               ExecutorService zkCacheExecutor, StripedExecutor<TenantName> zkWatcherExecutor) {\n-        this.curator = curator;\n+\n+    private TenantApplications(TenantName tenant, GlobalComponentRegistry registry) {", "originalCommit": "be78d3ca58195e5461986f50e0597cfbf16f8810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc5NzkzNg==", "url": "https://github.com/vespa-engine/vespa/pull/13489#discussion_r435797936", "bodyText": "Yes, agreed, just need to do it in steps", "author": "hmusum", "createdAt": "2020-06-05T09:21:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjkyNw=="}], "type": "inlineReview", "revised_code": null}]}