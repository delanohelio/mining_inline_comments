{"pr_number": 13049, "pr_title": "Add docker image repository to node details", "pr_createdAt": "2020-04-24T07:51:53Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13049", "timeline": [{"oid": "2319fe6f00fe0e1891f26f919de3ec9796752a2c", "url": "https://github.com/vespa-engine/vespa/commit/2319fe6f00fe0e1891f26f919de3ec9796752a2c", "message": "Add docker image repository to node details", "committedDate": "2020-04-24T07:51:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyOTcxOA==", "url": "https://github.com/vespa-engine/vespa/pull/13049#discussion_r414429718", "bodyText": "wanted -> current", "author": "freva", "createdAt": "2020-04-24T09:24:48Z", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java", "diffHunk": "@@ -548,6 +548,15 @@ private void logEndpoints(Map<ZoneId, List<Endpoint>> zoneEndpoints, DualLogger\n                                                                                                            : \" has config generation \" + service.currentGeneration() + \", wanted is \" + node.wantedConfigGeneration())));\n     }\n \n+\n+    private String wantedPlatform(Node node) {\n+        return node.wantedDockerImage().repository() + \":\" + node.wantedVersion();\n+    }\n+\n+    private String currentPlatform(Node node) {\n+        return node.wantedDockerImage().repository() + \":\" + node.wantedVersion();", "originalCommit": "2319fe6f00fe0e1891f26f919de3ec9796752a2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQzOTg3MA==", "url": "https://github.com/vespa-engine/vespa/pull/13049#discussion_r414439870", "bodyText": "Fixed, and did your suggestion about only showing current if different from wanted", "author": "hmusum", "createdAt": "2020-04-24T09:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyOTcxOA=="}], "type": "inlineReview", "revised_code": {"commit": "4a4b2a8e0fe79114d9e9508df2ebdd663c44e32c", "chunk": "diff --git a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java\nindex 353b82ede4..bc206011bb 100644\n--- a/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java\n+++ b/controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/InternalStepRunner.java\n\n@@ -554,7 +554,9 @@ public class InternalStepRunner implements StepRunner {\n     }\n \n     private String currentPlatform(Node node) {\n-        return node.wantedDockerImage().repository() + \":\" + node.wantedVersion();\n+        String currentRepo = node.currentDockerImage().repository();\n+        String wantedRepo = node.wantedDockerImage().repository();\n+        return (currentRepo.equals(wantedRepo) ? \"\" : currentRepo + \":\") + node.currentVersion();\n     }\n \n     private String humanize(Node.ServiceState state) {\n"}}, {"oid": "4a4b2a8e0fe79114d9e9508df2ebdd663c44e32c", "url": "https://github.com/vespa-engine/vespa/commit/4a4b2a8e0fe79114d9e9508df2ebdd663c44e32c", "message": "Only print docker image if wanted is not the same as current", "committedDate": "2020-04-24T09:39:19Z", "type": "commit"}]}