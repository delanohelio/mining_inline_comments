{"pr_number": 13445, "pr_title": "add check on console user feature flag dimension", "pr_createdAt": "2020-06-02T08:09:04Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13445", "timeline": [{"oid": "cfc0352e03e77f8ba225eabf387b11f67c81a856", "url": "https://github.com/vespa-engine/vespa/commit/cfc0352e03e77f8ba225eabf387b11f67c81a856", "message": "add check on console user feature flag dimension", "committedDate": "2020-06-02T08:08:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NjE4MQ==", "url": "https://github.com/vespa-engine/vespa/pull/13445#discussion_r433746181", "bodyText": "Add unit test: This would then fail.", "author": "hakonhall", "createdAt": "2020-06-02T09:33:14Z", "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/systemflags/v1/SystemFlagsDataArchive.java", "diffHunk": "@@ -206,6 +206,12 @@ private static void verifyValues(JsonNode root) {\n                     // Throws exception if not recognized\n                     NodeType.valueOf(nodeTypeString);\n                 });\n+            } else if (dimension.isEqualTo(DimensionHelper.toWire(FetchVector.Dimension.CONSOLE_USER_EMAIL))) {\n+                condition.get(\"values\").forEachArrayElement(conditionValue -> {\n+                    String consoleUserEmailString = conditionValue.asString()\n+                            .orElseThrow(() -> new IllegalArgumentException(\"Non-string email address: \" + conditionValue));\n+                    NodeType.valueOf(consoleUserEmailString);", "originalCommit": "cfc0352e03e77f8ba225eabf387b11f67c81a856", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyNDM4Ng==", "url": "https://github.com/vespa-engine/vespa/pull/13445#discussion_r434324386", "bodyText": "Yes, looks like I copy pasted a little too much :-)", "author": "andreer", "createdAt": "2020-06-03T05:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzc0NjE4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f27d159e300f0339417829801053bfbe8aad19c1", "chunk": "diff --git a/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/systemflags/v1/SystemFlagsDataArchive.java b/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/systemflags/v1/SystemFlagsDataArchive.java\nindex cf8ad4c3f2..e6310cc643 100644\n--- a/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/systemflags/v1/SystemFlagsDataArchive.java\n+++ b/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/systemflags/v1/SystemFlagsDataArchive.java\n\n@@ -207,11 +207,8 @@ public class SystemFlagsDataArchive {\n                     NodeType.valueOf(nodeTypeString);\n                 });\n             } else if (dimension.isEqualTo(DimensionHelper.toWire(FetchVector.Dimension.CONSOLE_USER_EMAIL))) {\n-                condition.get(\"values\").forEachArrayElement(conditionValue -> {\n-                    String consoleUserEmailString = conditionValue.asString()\n-                            .orElseThrow(() -> new IllegalArgumentException(\"Non-string email address: \" + conditionValue));\n-                    NodeType.valueOf(consoleUserEmailString);\n-                });\n+                condition.get(\"values\").forEachArrayElement(conditionValue -> conditionValue.asString()\n+                        .orElseThrow(() -> new IllegalArgumentException(\"Non-string email address: \" + conditionValue)));\n             }\n         }));\n     }\n"}}, {"oid": "f27d159e300f0339417829801053bfbe8aad19c1", "url": "https://github.com/vespa-engine/vespa/commit/f27d159e300f0339417829801053bfbe8aad19c1", "message": "test for email type validation", "committedDate": "2020-06-03T05:55:52Z", "type": "commit"}]}