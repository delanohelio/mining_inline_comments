{"pr_number": 13708, "pr_title": "Copy application package atomically", "pr_createdAt": "2020-06-25T12:04:17Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13708", "timeline": [{"oid": "b7123aab2704804928d9050a05febf9555bb6e05", "url": "https://github.com/vespa-engine/vespa/commit/b7123aab2704804928d9050a05febf9555bb6e05", "message": "Copy application package atomically\n\nFix bug where we don't do this atomically, looks like this can happend\nwhen application package is copied at the same time as config server is shut down", "committedDate": "2020-06-25T12:02:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY1NzkyNA==", "url": "https://github.com/vespa-engine/vespa/pull/13708#discussion_r445657924", "bodyText": "remove 'it'?", "author": "gjoranv", "createdAt": "2020-06-25T15:46:53Z", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/SessionRepository.java", "diffHunk": "@@ -515,6 +517,20 @@ private ApplicationPackage createApplicationPackage(File applicationFile, Applic\n         return applicationPackage;\n     }\n \n+    private void copyApp(File sourceDir, File destinationDir) throws IOException {\n+        if (destinationDir.exists())\n+            throw new RuntimeException(\"Destination dir \" + destinationDir + \" already exists\");\n+        if (! sourceDir.isDirectory())\n+            throw new IllegalArgumentException(sourceDir.getAbsolutePath() + \" is not a directory\");\n+\n+        // Copy app it atomically: Copy to default tmp dir and move to destination", "originalCommit": "b7123aab2704804928d9050a05febf9555bb6e05", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk3ODg1OA==", "url": "https://github.com/vespa-engine/vespa/pull/13708#discussion_r445978858", "bodyText": "thanks, will fix later", "author": "hmusum", "createdAt": "2020-06-26T05:44:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY1NzkyNA=="}], "type": "inlineReview", "revised_code": null}]}