{"pr_number": 13311, "pr_title": "Gjoranv/create registry from config", "pr_createdAt": "2020-05-19T20:39:58Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13311", "timeline": [{"oid": "f69d417ece3de38eb37cab2452e6e8b990f2bb8b", "url": "https://github.com/vespa-engine/vespa/commit/f69d417ece3de38eb37cab2452e6e8b990f2bb8b", "message": "Allow creating a CompiledQueryProfileRegistry from config.", "committedDate": "2020-05-19T19:02:34Z", "type": "commit"}, {"oid": "2bddef12ac48d0a57a3d7a51ba68f33a5883b9fe", "url": "https://github.com/vespa-engine/vespa/commit/2bddef12ac48d0a57a3d7a51ba68f33a5883b9fe", "message": "Add CompiledQueryProfileRegistry component for injection.", "committedDate": "2020-05-19T20:35:20Z", "type": "commit"}, {"oid": "2d941547df66cdd4f52dad9e1f979ecb58e00c19", "url": "https://github.com/vespa-engine/vespa/commit/2d941547df66cdd4f52dad9e1f979ecb58e00c19", "message": "Follow naming convention by using singular 'profileRegistry'", "committedDate": "2020-05-19T20:42:09Z", "type": "commit"}, {"oid": "31564ae8cce4125cb35990ec00fdb10206862cb2", "url": "https://github.com/vespa-engine/vespa/commit/31564ae8cce4125cb35990ec00fdb10206862cb2", "message": "Make the main constructor take a CompiledQueryProfileRegistry\n\n.. instead of QueryProfilesConfig", "committedDate": "2020-05-19T22:35:24Z", "type": "commit"}, {"oid": "98bb2cb3bc92011776cf7ff285649aa565258c2a", "url": "https://github.com/vespa-engine/vespa/commit/98bb2cb3bc92011776cf7ff285649aa565258c2a", "message": "Add the query profile registry to the set of test components\n\n.. for all integration style tests.\n\nNote that these tests were written before the DI framework, and\ntypically used the former 'handlers' config as only handlers\nand searchers could be configured at the time.", "committedDate": "2020-05-19T23:23:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNjgyMQ==", "url": "https://github.com/vespa-engine/vespa/pull/13311#discussion_r427836821", "bodyText": "Why not just do\nQueryProfileCompiler.compile(registry)\nhere?", "author": "bratseth", "createdAt": "2020-05-20T08:37:05Z", "path": "container-search/src/main/java/com/yahoo/search/query/profile/compiled/CompiledQueryProfileRegistry.java", "diffHunk": "@@ -18,6 +23,15 @@\n     \n     private final QueryProfileTypeRegistry typeRegistry;\n \n+    @Inject\n+    public CompiledQueryProfileRegistry(QueryProfilesConfig config) {\n+        QueryProfileRegistry registry = QueryProfileConfigurer.createFromConfig(config);\n+        typeRegistry = registry.getTypeRegistry();\n+        for (QueryProfile inputProfile : registry.allComponents()) {", "originalCommit": "98bb2cb3bc92011776cf7ff285649aa565258c2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MTEyNA==", "url": "https://github.com/vespa-engine/vespa/pull/13311#discussion_r427891124", "bodyText": "I didn't want to create a temporary object of the same type as the class itself. There is room for improvement, but it requires creating even more public methods and/or constructors, because the compiler is in a different package.", "author": "gjoranv", "createdAt": "2020-05-20T10:03:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzgzNjgyMQ=="}], "type": "inlineReview", "revised_code": null}]}