{"pr_number": 15078, "pr_title": "Allow patching of exclusiveTo", "pr_createdAt": "2020-10-29T08:53:35Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15078", "timeline": [{"oid": "80988fc70ffd03f99540f07e438316cb454aace7", "url": "https://github.com/vespa-engine/vespa/commit/80988fc70ffd03f99540f07e438316cb454aace7", "message": "Allow temporary patching of exclusiveTo", "committedDate": "2020-10-29T08:52:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1NzUxMA==", "url": "https://github.com/vespa-engine/vespa/pull/15078#discussion_r514157510", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                // TODO (freva): Remove after all existing hosts have been patched to correct value", "author": "freva", "createdAt": "2020-10-29T10:34:08Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java", "diffHunk": "@@ -340,6 +340,12 @@ public Node withoutReservedTo() {\n                         allocation, history, type, reports, modelName, Optional.empty(), exclusiveTo, switchHostname);\n     }\n \n+    // TODO (freva): Remove after all existing hosts have been patched to correct value", "originalCommit": "80988fc70ffd03f99540f07e438316cb454aace7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "50e1d415cb9c2c3a1fd150c63cc77e7cd4a53765", "chunk": "diff --git a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java\nindex b1a5b09680..7520a30716 100644\n--- a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java\n+++ b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java\n\n@@ -340,7 +340,6 @@ public final class Node implements Nodelike {\n                         allocation, history, type, reports, modelName, Optional.empty(), exclusiveTo, switchHostname);\n     }\n \n-    // TODO (freva): Remove after all existing hosts have been patched to correct value\n     public Node withExclusiveTo(ApplicationId exclusiveTo) {\n         return new Node(id, ipConfig, hostname, parentHostname, flavor, status, state,\n                 allocation, history, type, reports, modelName, reservedTo, Optional.ofNullable(exclusiveTo), switchHostname);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDE1NzcwMA==", "url": "https://github.com/vespa-engine/vespa/pull/15078#discussion_r514157700", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        case \"exclusiveTo\": // TODO (freva): Remove after all existing hosts have been patched to correct value\n          \n          \n            \n                        case \"exclusiveTo\":", "author": "freva", "createdAt": "2020-10-29T10:34:22Z", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java", "diffHunk": "@@ -148,6 +149,8 @@ private Node applyField(Node node, String name, Inspector value, Inspector root,\n                 return patchRequiredDiskSpeed(node, asString(value));\n             case \"reservedTo\":\n                 return value.type() == Type.NIX ? node.withoutReservedTo() : node.withReservedTo(TenantName.from(value.asString()));\n+            case \"exclusiveTo\": // TODO (freva): Remove after all existing hosts have been patched to correct value", "originalCommit": "80988fc70ffd03f99540f07e438316cb454aace7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c70388d3c7cd600abea8146b7ee7541e1df14a20", "chunk": "diff --git a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java\nindex 6988e99bdc..f275517612 100644\n--- a/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java\n+++ b/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java\n\n@@ -149,7 +149,7 @@ public class NodePatcher {\n                 return patchRequiredDiskSpeed(node, asString(value));\n             case \"reservedTo\":\n                 return value.type() == Type.NIX ? node.withoutReservedTo() : node.withReservedTo(TenantName.from(value.asString()));\n-            case \"exclusiveTo\": // TODO (freva): Remove after all existing hosts have been patched to correct value\n+            case \"exclusiveTo\":\n                 return node.withExclusiveTo(SlimeUtils.optionalString(value).map(ApplicationId::fromSerializedForm).orElse(null));\n             case \"switchHostname\":\n                 return value.type() == Type.NIX ? node.withoutSwitchHostname() : node.withSwitchHostname(value.asString());\n"}}, {"oid": "c70388d3c7cd600abea8146b7ee7541e1df14a20", "url": "https://github.com/vespa-engine/vespa/commit/c70388d3c7cd600abea8146b7ee7541e1df14a20", "message": "Update node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/NodePatcher.java\n\nCo-authored-by: Valerij Fredriksen <freva@users.noreply.github.com>", "committedDate": "2020-10-29T10:34:33Z", "type": "commit"}, {"oid": "50e1d415cb9c2c3a1fd150c63cc77e7cd4a53765", "url": "https://github.com/vespa-engine/vespa/commit/50e1d415cb9c2c3a1fd150c63cc77e7cd4a53765", "message": "Update node-repository/src/main/java/com/yahoo/vespa/hosted/provision/Node.java\n\nCo-authored-by: Valerij Fredriksen <freva@users.noreply.github.com>", "committedDate": "2020-10-29T10:34:44Z", "type": "commit"}]}