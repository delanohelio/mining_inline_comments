{"pr_number": 13468, "pr_title": "Require wantToRetire when setting wantToDeprovision", "pr_createdAt": "2020-06-03T11:08:52Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/13468", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwMTE2Ng==", "url": "https://github.com/vespa-engine/vespa/pull/13468#discussion_r434501166", "bodyText": "So I'm guessing the JSON also has to specify wantToRetire before wantToDeprovision? I'm not sure if our clients do this, or even if there is a way to force certain order for some of them?", "author": "freva", "createdAt": "2020-06-03T11:36:22Z", "path": "node-repository/src/test/java/com/yahoo/vespa/hosted/provision/restapi/NodesV2ApiTest.java", "diffHunk": "@@ -207,7 +207,7 @@ public void test_requests() throws Exception {\n                                    Utf8.toBytes(\"{\\\"modelName\\\": \\\"foo\\\"}\"), Request.Method.PATCH),\n                        \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n         assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n-                        Utf8.toBytes(\"{\\\"wantToDeprovision\\\": true}\"), Request.Method.PATCH),\n+                        Utf8.toBytes(\"{\\\"wantToRetire\\\": true, \\\"wantToDeprovision\\\": true}\"), Request.Method.PATCH),", "originalCommit": "3a876800e053b9b3d7958fdcfb4ea711c197d46e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDU1NjkyMQ==", "url": "https://github.com/vespa-engine/vespa/pull/13468#discussion_r434556921", "bodyText": "Good point. PTAL", "author": "mpolden", "createdAt": "2020-06-03T13:15:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDUwMTE2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "dbed0aaf832b9dc5b1376aa2724ddcf1125fe31f", "chunk": "diff --git a/node-repository/src/test/java/com/yahoo/vespa/hosted/provision/restapi/NodesV2ApiTest.java b/node-repository/src/test/java/com/yahoo/vespa/hosted/provision/restapi/NodesV2ApiTest.java\nindex 336bd44349..1e788e2c70 100644\n--- a/node-repository/src/test/java/com/yahoo/vespa/hosted/provision/restapi/NodesV2ApiTest.java\n+++ b/node-repository/src/test/java/com/yahoo/vespa/hosted/provision/restapi/NodesV2ApiTest.java\n\n@@ -207,8 +207,17 @@ public class NodesV2ApiTest {\n                                    Utf8.toBytes(\"{\\\"modelName\\\": \\\"foo\\\"}\"), Request.Method.PATCH),\n                        \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n         assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n-                        Utf8.toBytes(\"{\\\"wantToRetire\\\": true, \\\"wantToDeprovision\\\": true}\"), Request.Method.PATCH),\n+                        Utf8.toBytes(\"{\\\"wantToRetire\\\": true}\"), Request.Method.PATCH),\n                 \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n+        assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n+                                   Utf8.toBytes(\"{\\\"wantToDeprovision\\\": true}\"), Request.Method.PATCH),\n+                       \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n+        assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n+                                   Utf8.toBytes(\"{\\\"wantToDeprovision\\\": false, \\\"wantToRetire\\\": false}\"), Request.Method.PATCH),\n+                       \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n+        assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n+                                   Utf8.toBytes(\"{\\\"wantToDeprovision\\\": true, \\\"wantToRetire\\\": true}\"), Request.Method.PATCH),\n+                       \"{\\\"message\\\":\\\"Updated dockerhost1.yahoo.com\\\"}\");\n         tester.assertResponseContains(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\"), \"\\\"modelName\\\":\\\"foo\\\"\");\n         assertResponse(new Request(\"http://localhost:8080/nodes/v2/node/dockerhost1.yahoo.com\",\n                                    Utf8.toBytes(\"{\\\"modelName\\\": null}\"), Request.Method.PATCH),\n"}}, {"oid": "dbed0aaf832b9dc5b1376aa2724ddcf1125fe31f", "url": "https://github.com/vespa-engine/vespa/commit/dbed0aaf832b9dc5b1376aa2724ddcf1125fe31f", "message": "Require wantToRetire when setting wantToDeprovision", "committedDate": "2020-06-03T13:10:21Z", "type": "commit"}, {"oid": "8d2a0e5a3903d447fcce76558725558ea61d6bb0", "url": "https://github.com/vespa-engine/vespa/commit/8d2a0e5a3903d447fcce76558725558ea61d6bb0", "message": "Update InactiveExpirer javadoc", "committedDate": "2020-06-03T13:10:21Z", "type": "commit"}, {"oid": "8d2a0e5a3903d447fcce76558725558ea61d6bb0", "url": "https://github.com/vespa-engine/vespa/commit/8d2a0e5a3903d447fcce76558725558ea61d6bb0", "message": "Update InactiveExpirer javadoc", "committedDate": "2020-06-03T13:10:21Z", "type": "forcePushed"}]}