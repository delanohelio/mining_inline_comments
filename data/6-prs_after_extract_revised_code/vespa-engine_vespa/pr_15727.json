{"pr_number": 15727, "pr_title": "Refactor code into module that does not depend on zookeeper", "pr_createdAt": "2020-12-07T17:47:40Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/15727", "timeline": [{"oid": "f98e158a6f61cd39029f439da903f10e75e4c3fa", "url": "https://github.com/vespa-engine/vespa/commit/f98e158a6f61cd39029f439da903f10e75e4c3fa", "message": "Split out a ZKAdmin interface and implement it", "committedDate": "2020-12-07T12:37:26Z", "type": "commit"}, {"oid": "7e7b7c72b7ca4131f6f29efa0f9d63f857d9f369", "url": "https://github.com/vespa-engine/vespa/commit/7e7b7c72b7ca4131f6f29efa0f9d63f857d9f369", "message": "Merge branch 'master' into hmusum/refactor-reconfigurer", "committedDate": "2020-12-07T13:23:28Z", "type": "commit"}, {"oid": "9e82c2c81e161a1cd449456d5f8ba797762ecdcd", "url": "https://github.com/vespa-engine/vespa/commit/9e82c2c81e161a1cd449456d5f8ba797762ecdcd", "message": "Merge branch 'master' into hmusum/refactor-reconfigurer", "committedDate": "2020-12-07T13:40:47Z", "type": "commit"}, {"oid": "2effa9bfef3ad615887f4ecf3190ad87ccc22c6a", "url": "https://github.com/vespa-engine/vespa/commit/2effa9bfef3ad615887f4ecf3190ad87ccc22c6a", "message": "Retry on NewConfigNoQuorum", "committedDate": "2020-12-07T13:42:14Z", "type": "commit"}, {"oid": "b0f74766d1b2af781d93da7d2ad89c89c8e9825b", "url": "https://github.com/vespa-engine/vespa/commit/b0f74766d1b2af781d93da7d2ad89c89c8e9825b", "message": "Refactor to prepare for mving more code to zokeeper-server-common", "committedDate": "2020-12-07T17:33:23Z", "type": "commit"}, {"oid": "6e44ab449d2bb686127192c71e4dbe87091be6ee", "url": "https://github.com/vespa-engine/vespa/commit/6e44ab449d2bb686127192c71e4dbe87091be6ee", "message": "Move more code to zookeeper-server-common", "committedDate": "2020-12-07T17:47:02Z", "type": "commit"}, {"oid": "9f94fca1554fde44fd652739f3cf6e647d87184a", "url": "https://github.com/vespa-engine/vespa/commit/9f94fca1554fde44fd652739f3cf6e647d87184a", "message": "Minor fixes", "committedDate": "2020-12-07T17:54:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEzOTMzMw==", "url": "https://github.com/vespa-engine/vespa/pull/15727#discussion_r538139333", "bodyText": "Consider inlining this as (event) -> log.log(Level.INFO, event.toString()) so we don't need to have this class in every versioned module.", "author": "mpolden", "createdAt": "2020-12-08T08:36:58Z", "path": "zookeeper-server/zookeeper-server-3.5.6/src/main/java/com/yahoo/vespa/zookeeper/LoggingWatcher.java", "diffHunk": "@@ -0,0 +1,19 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.zookeeper;\n+\n+import org.apache.zookeeper.WatchedEvent;\n+import org.apache.zookeeper.Watcher;\n+\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+class LoggingWatcher implements Watcher {", "originalCommit": "9f94fca1554fde44fd652739f3cf6e647d87184a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE1MjAyOA==", "url": "https://github.com/vespa-engine/vespa/pull/15727#discussion_r538152028", "bodyText": "Yes, good point, fixed.", "author": "hmusum", "createdAt": "2020-12-08T08:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEzOTMzMw=="}], "type": "inlineReview", "revised_code": {"commit": "c51b8fe382f8647cb624f34d408d33b90778eb43", "chunk": "diff --git a/zookeeper-server/zookeeper-server-3.5.6/src/main/java/com/yahoo/vespa/zookeeper/LoggingWatcher.java b/zookeeper-server/zookeeper-server-3.5.6/src/main/java/com/yahoo/vespa/zookeeper/LoggingWatcher.java\ndeleted file mode 100644\nindex dfd99d3850..0000000000\n--- a/zookeeper-server/zookeeper-server-3.5.6/src/main/java/com/yahoo/vespa/zookeeper/LoggingWatcher.java\n+++ /dev/null\n\n@@ -1,19 +0,0 @@\n-// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n-package com.yahoo.vespa.zookeeper;\n-\n-import org.apache.zookeeper.WatchedEvent;\n-import org.apache.zookeeper.Watcher;\n-\n-import java.util.logging.Level;\n-import java.util.logging.Logger;\n-\n-class LoggingWatcher implements Watcher {\n-\n-    private static final Logger log = java.util.logging.Logger.getLogger(LoggingWatcher.class.getName());\n-\n-    @Override\n-    public void process(WatchedEvent event) {\n-        log.log(Level.INFO, event.toString());\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0MjAzNA==", "url": "https://github.com/vespa-engine/vespa/pull/15727#discussion_r538142034", "bodyText": "Consider naming it VespaZooKeeperAdmin, similar to VespaZooKeeperServer.", "author": "mpolden", "createdAt": "2020-12-08T08:41:05Z", "path": "zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/ZkAdmin.java", "diffHunk": "@@ -0,0 +1,18 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.zookeeper;\n+\n+import java.time.Duration;\n+\n+/**\n+ * Interface for administering a zookeeper cluster. Currently only supports reconfiguring a zookeeper cluster.\n+ *\n+ * @author hmusum\n+ */\n+public interface ZkAdmin {", "originalCommit": "9f94fca1554fde44fd652739f3cf6e647d87184a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE1MjA3Ng==", "url": "https://github.com/vespa-engine/vespa/pull/15727#discussion_r538152076", "bodyText": "Done", "author": "hmusum", "createdAt": "2020-12-08T08:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODE0MjAzNA=="}], "type": "inlineReview", "revised_code": {"commit": "c51b8fe382f8647cb624f34d408d33b90778eb43", "chunk": "diff --git a/zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/ZkAdmin.java b/zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/VespaZooKeeperAdmin.java\nsimilarity index 93%\nrename from zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/ZkAdmin.java\nrename to zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/VespaZooKeeperAdmin.java\nindex fb62f66256..1a7bf483ac 100644\n--- a/zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/ZkAdmin.java\n+++ b/zookeeper-server/zookeeper-server-common/src/main/java/com/yahoo/vespa/zookeeper/VespaZooKeeperAdmin.java\n\n@@ -8,7 +8,7 @@ import java.time.Duration;\n  *\n  * @author hmusum\n  */\n-public interface ZkAdmin {\n+public interface VespaZooKeeperAdmin {\n \n     void reconfigure(String connectionSpec, String joiningServers, String leavingServers) throws ReconfigException;\n \n"}}, {"oid": "c51b8fe382f8647cb624f34d408d33b90778eb43", "url": "https://github.com/vespa-engine/vespa/commit/c51b8fe382f8647cb624f34d408d33b90778eb43", "message": "Inline watcher and rename class", "committedDate": "2020-12-08T08:59:27Z", "type": "commit"}]}