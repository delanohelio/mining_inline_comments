{"pr_number": 12671, "pr_title": "Arnej/configurable distance metrics", "pr_createdAt": "2020-03-23T14:31:49Z", "pr_url": "https://github.com/vespa-engine/vespa/pull/12671", "timeline": [{"oid": "b1324afaa4cb684862debfb97a492750960cd0cf", "url": "https://github.com/vespa-engine/vespa/commit/b1324afaa4cb684862debfb97a492750960cd0cf", "message": "make HNSW distance metric configurable", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "dabdfd757930a7bb06035c718fce456326cf6f63", "url": "https://github.com/vespa-engine/vespa/commit/dabdfd757930a7bb06035c718fce456326cf6f63", "message": "add enum for selecting distance metric", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "49492f5698d52b87ee0ac98cf32d991246876125", "url": "https://github.com/vespa-engine/vespa/commit/49492f5698d52b87ee0ac98cf32d991246876125", "message": "more distance functions\n\n* extend DistanceFunction API\n* add Angular metric\n* add GeoDegrees metric", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "4867cc43efc6d92e5ff9db2924cb38280ebe7037", "url": "https://github.com/vespa-engine/vespa/commit/4867cc43efc6d92e5ff9db2924cb38280ebe7037", "message": "add unit test", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "b2bef82b64c8ddd707fa58d394eb325aac1812fb", "url": "https://github.com/vespa-engine/vespa/commit/b2bef82b64c8ddd707fa58d394eb325aac1812fb", "message": "split out DistanceFunction factory", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "fc6403cca1829df74abc0707f12023fc4857ba26", "url": "https://github.com/vespa-engine/vespa/commit/fc6403cca1829df74abc0707f12023fc4857ba26", "message": "add distance metric to HnswIndexParams", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "9be49315bc1fe7efa35eea5a244c2ce85c03c701", "url": "https://github.com/vespa-engine/vespa/commit/9be49315bc1fe7efa35eea5a244c2ce85c03c701", "message": "extend API with distance_function access", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "3967677db35ec4d9805c5a410a2a083472fb6dd1", "url": "https://github.com/vespa-engine/vespa/commit/3967677db35ec4d9805c5a410a2a083472fb6dd1", "message": "track API changes", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "63368ac60b322be2830868bd76570184c39938ed", "url": "https://github.com/vespa-engine/vespa/commit/63368ac60b322be2830868bd76570184c39938ed", "message": "use external factory for distance function", "committedDate": "2020-03-23T14:30:35Z", "type": "commit"}, {"oid": "1d3fdf021dab6ab47736feea0cd439e79360acbf", "url": "https://github.com/vespa-engine/vespa/commit/1d3fdf021dab6ab47736feea0cd439e79360acbf", "message": "use distance function from index if available\n\n* convert query tensor to same cell type as attribute\n* use DistanceFunction to calculate abstract distances for NNS\n* use DistanceFunction to convert abstract distances to rawscore\n* if no index is available, use a fallback DistanceFunction", "committedDate": "2020-03-23T14:30:36Z", "type": "commit"}, {"oid": "6e17e57db3435ccd8d5705b3bdd062ce337ff137", "url": "https://github.com/vespa-engine/vespa/commit/6e17e57db3435ccd8d5705b3bdd062ce337ff137", "message": "check that query tensor is converted correctly", "committedDate": "2020-03-23T14:30:36Z", "type": "commit"}, {"oid": "19c5bbc4a4babe52c0948a9c4c3bc5f6c1da7b85", "url": "https://github.com/vespa-engine/vespa/commit/19c5bbc4a4babe52c0948a9c4c3bc5f6c1da7b85", "message": "track API changes\n\n* also, NNS iterators no longer handles different cell types", "committedDate": "2020-03-23T14:30:36Z", "type": "commit"}, {"oid": "45af929151818ec383951d3d8b5018f690df85df", "url": "https://github.com/vespa-engine/vespa/commit/45af929151818ec383951d3d8b5018f690df85df", "message": "simplify iterator\n\n* now distance function handles cell type, so\n  iterator does not need to be templated on that.", "committedDate": "2020-03-23T14:30:36Z", "type": "commit"}, {"oid": "cb7d16718d08131e60badb1ab35521226f4ebed9", "url": "https://github.com/vespa-engine/vespa/commit/cb7d16718d08131e60badb1ab35521226f4ebed9", "message": "output distance in meters", "committedDate": "2020-03-24T07:52:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NDI0MQ==", "url": "https://github.com/vespa-engine/vespa/pull/12671#discussion_r396974241", "bodyText": "Please add copyright.", "author": "geirst", "createdAt": "2020-03-24T08:27:07Z", "path": "config-model/src/test/java/com/yahoo/searchdefinition/document/HnswIndexParamsTestCase.java", "diffHunk": "@@ -0,0 +1,53 @@\n+", "originalCommit": "4867cc43efc6d92e5ff9db2924cb38280ebe7037", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzExMjY3NQ==", "url": "https://github.com/vespa-engine/vespa/pull/12671#discussion_r397112675", "bodyText": "copyright added", "author": "arnej27959", "createdAt": "2020-03-24T12:25:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk3NDI0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "2ca2401c18a7f3a6860c85ac133493867847f791", "chunk": "diff --git a/config-model/src/test/java/com/yahoo/searchdefinition/document/HnswIndexParamsTestCase.java b/config-model/src/test/java/com/yahoo/searchdefinition/document/HnswIndexParamsTestCase.java\nindex 6ecd937af4..d687590faf 100644\n--- a/config-model/src/test/java/com/yahoo/searchdefinition/document/HnswIndexParamsTestCase.java\n+++ b/config-model/src/test/java/com/yahoo/searchdefinition/document/HnswIndexParamsTestCase.java\n\n@@ -1,4 +1,4 @@\n-\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n \n package com.yahoo.searchdefinition.document;\n \n"}}, {"oid": "7038869d09bd49ac1f75a148260c73af287cea91", "url": "https://github.com/vespa-engine/vespa/commit/7038869d09bd49ac1f75a148260c73af287cea91", "message": "unit test distance functions", "committedDate": "2020-03-24T12:06:12Z", "type": "commit"}, {"oid": "f2fa9a9059bc5570b70a687d31cbd160ed28f8cc", "url": "https://github.com/vespa-engine/vespa/commit/f2fa9a9059bc5570b70a687d31cbd160ed28f8cc", "message": "remove debug printing", "committedDate": "2020-03-24T12:06:36Z", "type": "commit"}, {"oid": "2ca2401c18a7f3a6860c85ac133493867847f791", "url": "https://github.com/vespa-engine/vespa/commit/2ca2401c18a7f3a6860c85ac133493867847f791", "message": "add copyright", "committedDate": "2020-03-24T12:07:34Z", "type": "commit"}, {"oid": "6e725e88b10d424ff5f96ba702124033fdc86733", "url": "https://github.com/vespa-engine/vespa/commit/6e725e88b10d424ff5f96ba702124033fdc86733", "message": "add reference and refactor", "committedDate": "2020-03-24T12:21:13Z", "type": "commit"}, {"oid": "5cc83640d058ef6e905093c7eafdeffc3647dc07", "url": "https://github.com/vespa-engine/vespa/commit/5cc83640d058ef6e905093c7eafdeffc3647dc07", "message": "constify DistanceFunction", "committedDate": "2020-03-24T12:24:39Z", "type": "commit"}, {"oid": "eff4e99de2506232afab12f1f984ba88958506d2", "url": "https://github.com/vespa-engine/vespa/commit/eff4e99de2506232afab12f1f984ba88958506d2", "message": "add documentation comment", "committedDate": "2020-03-24T12:27:32Z", "type": "commit"}, {"oid": "45c2c45102f06b5911e390306d3d0c54fff8f67a", "url": "https://github.com/vespa-engine/vespa/commit/45c2c45102f06b5911e390306d3d0c54fff8f67a", "message": "extend unit test", "committedDate": "2020-03-24T12:36:27Z", "type": "commit"}, {"oid": "7d102554f360621233d37b4fcd9822eb2542536e", "url": "https://github.com/vespa-engine/vespa/commit/7d102554f360621233d37b4fcd9822eb2542536e", "message": "update copyright headers", "committedDate": "2020-03-24T14:43:05Z", "type": "commit"}]}