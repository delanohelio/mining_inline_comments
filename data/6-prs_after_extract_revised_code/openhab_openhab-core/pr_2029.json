{"pr_number": 2029, "pr_title": "Added unit tests for check if persistence extension returns QuantityType if persistence service returns QuantityType", "pr_createdAt": "2020-12-29T15:57:09Z", "pr_url": "https://github.com/openhab/openhab-core/pull/2029", "timeline": [{"oid": "521dcdaa796dae131a5bd121cd84bae847669c76", "url": "https://github.com/openhab/openhab-core/commit/521dcdaa796dae131a5bd121cd84bae847669c76", "message": "Further test improvements\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-12-31T10:36:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEwMjI1NA==", "url": "https://github.com/openhab/openhab-core/pull/2029#discussion_r554102254", "bodyText": "When the class is annotated with @ExtendWith(MockitoExtension.class), the mockCloseable and afterEach method can be removed.", "author": "wborn", "createdAt": "2021-01-08T17:57:01Z", "path": "bundles/org.openhab.core.persistence/src/test/java/org/openhab/core/persistence/extensions/PersistenceExtensionsTest.java", "diffHunk": "@@ -42,53 +52,72 @@\n  */\n public class PersistenceExtensionsTest {\n \n-    public static final String TEST_NUMBER = \"Test Number\";\n-    public static final String TEST_SWITCH = \"Test Switch\";\n-\n-    @NonNullByDefault\n-    private final PersistenceServiceRegistry registry = new PersistenceServiceRegistry() {\n-\n-        private final PersistenceService testPersistenceService = new TestPersistenceService();\n-\n-        @Override\n-        public @Nullable String getDefaultId() {\n-            // not available\n-            return null;\n-        }\n-\n-        @Override\n-        public @Nullable PersistenceService getDefault() {\n-            // not available\n-            return null;\n-        }\n+    public static final String TEST_NUMBER = \"testNumber\";\n+    public static final String TEST_QUANTITY_NUMBER = \"testQuantityNumber\";\n+    public static final String TEST_SWITCH = \"testSwitch\";\n \n-        @Override\n-        public Set<PersistenceService> getAll() {\n-            return Set.of(testPersistenceService);\n-        }\n+    private @Mock UnitProvider unitProvider;\n+    private @Mock ItemRegistry mockedItemRegistry;\n \n-        @Override\n-        public @Nullable PersistenceService get(@Nullable String serviceId) {\n-            return TestPersistenceService.ID.equals(serviceId) ? testPersistenceService : null;\n-        }\n-    };\n+    private AutoCloseable mocksCloseable;\n \n-    private CoreItemFactory itemFactory;\n-    private GenericItem numberItem, switchItem;\n+    private GenericItem numberItem, quantityItem, switchItem;\n \n     @BeforeEach\n     public void setUp() {\n-        new PersistenceExtensions(registry);\n-        itemFactory = new CoreItemFactory();\n+        mocksCloseable = openMocks(this);", "originalCommit": "521dcdaa796dae131a5bd121cd84bae847669c76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEzMDY5MQ==", "url": "https://github.com/openhab/openhab-core/pull/2029#discussion_r554130691", "bodyText": "Deon.\nOnce upon a time when I submitted my changes it was not possible at all ... \ud83e\udd23", "author": "cweitkamp", "createdAt": "2021-01-08T18:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEwMjI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEzMzc5MQ==", "url": "https://github.com/openhab/openhab-core/pull/2029#discussion_r554133791", "bodyText": "There was still an issue with using it in integration tests which is fixed by #2075 . For some complicated setups of tests extending another class it may still make sense to use it.", "author": "wborn", "createdAt": "2021-01-08T19:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEwMjI1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDE2MTYzOA==", "url": "https://github.com/openhab/openhab-core/pull/2029#discussion_r554161638", "bodyText": "Yes, I am aware of that. Was just kidding.", "author": "cweitkamp", "createdAt": "2021-01-08T20:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDEwMjI1NA=="}], "type": "inlineReview", "revised_code": {"commit": "c0b88b15b05053e9a415ddbea5053b1087bb86ab", "chunk": "diff --git a/bundles/org.openhab.core.persistence/src/test/java/org/openhab/core/persistence/extensions/PersistenceExtensionsTest.java b/bundles/org.openhab.core.persistence/src/test/java/org/openhab/core/persistence/extensions/PersistenceExtensionsTest.java\nindex c756f292d..8c395a269 100644\n--- a/bundles/org.openhab.core.persistence/src/test/java/org/openhab/core/persistence/extensions/PersistenceExtensionsTest.java\n+++ b/bundles/org.openhab.core.persistence/src/test/java/org/openhab/core/persistence/extensions/PersistenceExtensionsTest.java\n\n@@ -113,7 +113,7 @@ public class PersistenceExtensionsTest {\n     }\n \n     @Test\n-    public void testHistoricStateDecimalType() {\n+    public void testHistoricDecimalTypeState() {\n         HistoricItem historicItem = PersistenceExtensions.historicState(numberItem,\n                 ZonedDateTime.of(2012, 1, 1, 0, 0, 0, 0, ZoneId.systemDefault()), TestPersistenceService.ID);\n         assertNotNull(historicItem);\n"}}, {"oid": "c0b88b15b05053e9a415ddbea5053b1087bb86ab", "url": "https://github.com/openhab/openhab-core/commit/c0b88b15b05053e9a415ddbea5053b1087bb86ab", "message": "Added unit tests for check if persistence extension returns QuantityType id persistnce service returns QuantityType\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2021-01-08T18:44:24Z", "type": "commit"}, {"oid": "16836dbc9d8b5d2da6701081ee6404b70aa41c3a", "url": "https://github.com/openhab/openhab-core/commit/16836dbc9d8b5d2da6701081ee6404b70aa41c3a", "message": "Further test improvements\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2021-01-08T18:44:25Z", "type": "commit"}, {"oid": "a812a7b4113514f5d1660f17e2eb6896afeec51e", "url": "https://github.com/openhab/openhab-core/commit/a812a7b4113514f5d1660f17e2eb6896afeec51e", "message": "Incorporated comment from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2021-01-08T18:50:47Z", "type": "commit"}, {"oid": "a812a7b4113514f5d1660f17e2eb6896afeec51e", "url": "https://github.com/openhab/openhab-core/commit/a812a7b4113514f5d1660f17e2eb6896afeec51e", "message": "Incorporated comment from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2021-01-08T18:50:47Z", "type": "forcePushed"}]}