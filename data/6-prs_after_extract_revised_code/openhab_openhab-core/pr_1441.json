{"pr_number": 1441, "pr_title": "Removed dependency on 'org.apache.commons.io'", "pr_createdAt": "2020-04-22T20:19:51Z", "pr_url": "https://github.com/openhab/openhab-core/pull/1441", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMwOTkxMw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r413309913", "bodyText": "We only need the first line. Could be changed to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        final List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n          \n          \n            \n                        return lines.isEmpty() ? \"\" : lines.get(0);\n          \n          \n            \n                        final BufferedReader reader = Files.newBufferedReader(file.toPath());\n          \n          \n            \n                        return reader.readLine();", "author": "cweitkamp", "createdAt": "2020-04-22T20:34:03Z", "path": "bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java", "diffHunk": "@@ -75,19 +73,21 @@ public static synchronized String get() {\n     private static void writeFile(File file, String content) throws IOException {\n         // create intermediary directories\n         file.getParentFile().mkdirs();\n-        try (OutputStream outputStream = new FileOutputStream(file)) {\n-            IOUtils.write(content, outputStream);\n+        try {\n+            Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n+        } catch (IOException ioe) {\n+            LOGGER.warn(\"Failed writing to file '{}': {}\", content, file.getAbsolutePath(), ioe.getMessage());\n         }\n     }\n \n     private static String readFirstLine(File file) {\n-        List<String> lines = null;\n         try {\n-            lines = IOUtils.readLines(new FileInputStream(file));\n+            final List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n+            return lines.isEmpty() ? \"\" : lines.get(0);", "originalCommit": "bf7ec179d251a0a5fcfc83dc0b51b7f316aa1a6e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java b/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\nindex dc5750202..fc01f41ad 100644\n--- a/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\n+++ b/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\n\n@@ -62,32 +61,26 @@ public class InstanceUUID {\n                     }\n                 }\n             } catch (IOException e) {\n-                LOGGER.error(\"Failed writing instance uuid file: {}\", e.getMessage());\n+                LOGGER.error(\"Failed writing the UUID file: {}\", e.getMessage());\n                 return null;\n             }\n         }\n-\n         return uuid;\n     }\n \n     private static void writeFile(File file, String content) throws IOException {\n         // create intermediary directories\n         file.getParentFile().mkdirs();\n-        try {\n-            Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n-        } catch (IOException ioe) {\n-            LOGGER.warn(\"Failed writing to file '{}': {}\", content, file.getAbsolutePath(), ioe.getMessage());\n-        }\n+        Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n     }\n \n     private static String readFirstLine(File file) {\n-        try {\n-            final List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n-            return lines.isEmpty() ? \"\" : lines.get(0);\n+        try (BufferedReader reader = Files.newBufferedReader(file.toPath(), StandardCharsets.UTF_8)) {\n+            String line;\n+            return (line = reader.readLine()) == null ? \"\" : line;\n         } catch (IOException ioe) {\n             LOGGER.warn(\"Failed reading the UUID file '{}': {}\", file.getAbsolutePath(), ioe.getMessage());\n             return \"\";\n         }\n     }\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMxMDc0Mg==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r413310742", "bodyText": "We only need the first line. Could be changed to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n          \n          \n            \n                        return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(lines.get(0));\n          \n          \n            \n                        final BufferedReader reader = Files.newBufferedReader(file.toPath());\n          \n          \n            \n                        return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(reader.readLine());", "author": "cweitkamp", "createdAt": "2020-04-22T20:35:29Z", "path": "bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java", "diffHunk": "@@ -78,13 +77,14 @@ private RsaJsonWebKey generateNewKey() throws JoseException, FileNotFoundExcepti\n \n         String keyJson = newKey.toJson(OutputControlLevel.INCLUDE_PRIVATE);\n \n-        IOUtils.write(keyJson, new FileOutputStream(file));\n+        Files.writeString(file.toPath(), keyJson, StandardCharsets.UTF_8);\n         return newKey;\n     }\n \n     private RsaJsonWebKey loadOrGenerateKey() throws FileNotFoundException, JoseException, IOException {\n         try {\n-            List<String> lines = IOUtils.readLines(new FileInputStream(KEY_FILE_PATH));\n+            File file = new File(KEY_FILE_PATH);\n+            List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n             return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(lines.get(0));", "originalCommit": "bf7ec179d251a0a5fcfc83dc0b51b7f316aa1a6e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java b/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\nindex e96248220..2f28ef121 100644\n--- a/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\n+++ b/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\n\n@@ -83,9 +85,8 @@ public class JwtHelper {\n \n     private RsaJsonWebKey loadOrGenerateKey() throws FileNotFoundException, JoseException, IOException {\n         try {\n-            File file = new File(KEY_FILE_PATH);\n-            List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n-            return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(lines.get(0));\n+            final BufferedReader reader = Files.newBufferedReader(Paths.get(KEY_FILE_PATH));\n+            return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(reader.readLine());\n         } catch (IOException | JoseException e) {\n             RsaJsonWebKey key = generateNewKey();\n             logger.debug(\"Created JWT signature key in {}\", KEY_FILE_PATH);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMxMjg5MQ==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r413312891", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    List<String> lines = Files.readAllLines(configFile.toPath(), StandardCharsets.UTF_8);\n          \n          \n            \n                    String exclusivePID = lines.size() > 0 ? getPIDFromLine(lines.get(0)) : null;\n          \n          \n            \n                    final BufferedReader reader = Files.newBufferedReader(configFile.toPath());\n          \n          \n            \n                    String exclusivePID = getPIDFromLine(reader.readLine());", "author": "cweitkamp", "createdAt": "2020-04-22T20:38:57Z", "path": "bundles/org.openhab.core.config.dispatch/src/main/java/org/openhab/core/config/dispatch/internal/ConfigDispatcher.java", "diffHunk": "@@ -300,7 +300,7 @@ private void internalProcessConfigFile(File configFile) throws IOException, File\n         String context = null;\n \n         // configuration file contains a PID Marker\n-        List<String> lines = IOUtils.readLines(new FileInputStream(configFile));\n+        List<String> lines = Files.readAllLines(configFile.toPath(), StandardCharsets.UTF_8);\n         String exclusivePID = lines.size() > 0 ? getPIDFromLine(lines.get(0)) : null;", "originalCommit": "bf7ec179d251a0a5fcfc83dc0b51b7f316aa1a6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTExNDQ5OQ==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r419114499", "bodyText": "all lines are required later (line 359)", "author": "Legion2", "createdAt": "2020-05-03T14:52:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMxMjg5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM3OTI5Nw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r419379297", "bodyText": "Correct. Thanks for the hint.", "author": "cweitkamp", "createdAt": "2020-05-04T11:49:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMxMjg5MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMxNDcwNw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r413314707", "bodyText": "Could be changed to Files.lines(file.toPath()).foreach(...)", "author": "cweitkamp", "createdAt": "2020-04-22T20:41:49Z", "path": "itests/org.openhab.core.config.dispatch.tests/src/main/java/org/openhab/core/config/dispatch/internal/ConfigDispatcherOSGiTest.java", "diffHunk": "@@ -1028,22 +1029,22 @@ private void verifyNoPropertiesForConfiguration(String pid) {\n     }\n \n     private void truncateLastLine(File file) throws IOException {\n-        List<String> lines = IOUtils.readLines(new FileInputStream(file));\n-        IOUtils.writeLines(lines.subList(0, lines.size() - 1), \"\\n\", new FileOutputStream(file));\n+        final Path path = file.toPath();\n+        List<String> lines = Files.readAllLines(path, StandardCharsets.UTF_8);\n+        Files.writeString(path, lines.subList(0, lines.size() - 1).stream().collect(Collectors.joining(\"\\n\")),\n+                StandardCharsets.UTF_8);\n     }\n \n     private String getLastModifiedValueForPoperty(String path, String property) {\n-        // This method will return null, if there are no files in the directory.\n-        final String separator = property + \"=\";\n-        String value = null;\n-\n         File file = getLastModifiedFileFromDir(path);\n         if (file == null) {\n             return null;\n         }\n-        try (FileInputStream fileInputStream = new FileInputStream(file)) {\n-            List<String> lines = IOUtils.readLines(fileInputStream);\n-            for (String line : lines) {\n+        // This method will return null, if there are no files in the directory.\n+        final String separator = property + \"=\";\n+        String value = null;\n+        try {\n+            for (String line : Files.readAllLines(file.toPath(), StandardCharsets.UTF_8)) {", "originalCommit": "bf7ec179d251a0a5fcfc83dc0b51b7f316aa1a6e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDk5Mzg3Mw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r414993873", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        LOGGER.warn(\"Failed writing to file '{}': {}\", content, file.getAbsolutePath(), ioe.getMessage());\n          \n          \n            \n                        LOGGER.warn(\"Failed writing to file '{}': {}\", file.getAbsolutePath(), ioe.getMessage());", "author": "cweitkamp", "createdAt": "2020-04-25T06:21:42Z", "path": "bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java", "diffHunk": "@@ -75,19 +73,21 @@ public static synchronized String get() {\n     private static void writeFile(File file, String content) throws IOException {\n         // create intermediary directories\n         file.getParentFile().mkdirs();\n-        try (OutputStream outputStream = new FileOutputStream(file)) {\n-            IOUtils.write(content, outputStream);\n+        try {\n+            Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n+        } catch (IOException ioe) {\n+            LOGGER.warn(\"Failed writing to file '{}': {}\", content, file.getAbsolutePath(), ioe.getMessage());", "originalCommit": "c98381499addd951126d8ec9cebf35e75b1d1372", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java b/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\nindex dc5750202..fc01f41ad 100644\n--- a/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\n+++ b/bundles/org.openhab.core.id/src/main/java/org/openhab/core/id/InstanceUUID.java\n\n@@ -62,32 +61,26 @@ public class InstanceUUID {\n                     }\n                 }\n             } catch (IOException e) {\n-                LOGGER.error(\"Failed writing instance uuid file: {}\", e.getMessage());\n+                LOGGER.error(\"Failed writing the UUID file: {}\", e.getMessage());\n                 return null;\n             }\n         }\n-\n         return uuid;\n     }\n \n     private static void writeFile(File file, String content) throws IOException {\n         // create intermediary directories\n         file.getParentFile().mkdirs();\n-        try {\n-            Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n-        } catch (IOException ioe) {\n-            LOGGER.warn(\"Failed writing to file '{}': {}\", content, file.getAbsolutePath(), ioe.getMessage());\n-        }\n+        Files.writeString(file.toPath(), content, StandardCharsets.UTF_8);\n     }\n \n     private static String readFirstLine(File file) {\n-        try {\n-            final List<String> lines = Files.readAllLines(file.toPath(), StandardCharsets.UTF_8);\n-            return lines.isEmpty() ? \"\" : lines.get(0);\n+        try (BufferedReader reader = Files.newBufferedReader(file.toPath(), StandardCharsets.UTF_8)) {\n+            String line;\n+            return (line = reader.readLine()) == null ? \"\" : line;\n         } catch (IOException ioe) {\n             LOGGER.warn(\"Failed reading the UUID file '{}': {}\", file.getAbsolutePath(), ioe.getMessage());\n             return \"\";\n         }\n     }\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0MjY0NA==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421142644", "bodyText": "Converting urls to files can cause a lot of problems if the urls don't have the right schema so create the path from a URI instead.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                for (final String line : Files.readAllLines(new File(url).toPath())) {\n          \n          \n            \n                                for (final String line : Files.readAllLines(Paths.get(URI.create(url)))) {", "author": "cpmeister", "createdAt": "2020-05-06T23:05:37Z", "path": "bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java", "diffHunk": "@@ -65,24 +66,20 @@ private InputStream createInputStream() throws AudioException {\n         try {\n             switch (extension) {\n                 case M3U_EXTENSION:\n-                    try (final InputStream isM3U = new URL(url).openStream()) {\n-                        for (final String line : IOUtils.readLines(isM3U)) {\n-                            if (!line.isEmpty() && !line.startsWith(\"#\")) {\n-                                url = line;\n-                                break;\n-                            }\n+                    for (final String line : Files.readAllLines(new File(url).toPath())) {", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java b/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\nindex 8364bbcc8..9c87a4f24 100644\n--- a/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\n+++ b/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\n\n@@ -66,7 +67,7 @@ public class URLAudioStream extends AudioStream {\n         try {\n             switch (extension) {\n                 case M3U_EXTENSION:\n-                    for (final String line : Files.readAllLines(new File(url).toPath())) {\n+                    for (final String line : Files.readAllLines(Paths.get(URI.create(url)))) {\n                         if (!line.isEmpty() && !line.startsWith(\"#\")) {\n                             url = line;\n                             break;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0Mjg4Mg==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421142882", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                for (final String line : Files.readAllLines(new File(url).toPath())) {\n          \n          \n            \n                                for (final String line : Files.readAllLines(Paths.get(URI.create(url)))) {", "author": "cpmeister", "createdAt": "2020-05-06T23:06:17Z", "path": "bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java", "diffHunk": "@@ -65,24 +66,20 @@ private InputStream createInputStream() throws AudioException {\n         try {\n             switch (extension) {\n                 case M3U_EXTENSION:\n-                    try (final InputStream isM3U = new URL(url).openStream()) {\n-                        for (final String line : IOUtils.readLines(isM3U)) {\n-                            if (!line.isEmpty() && !line.startsWith(\"#\")) {\n-                                url = line;\n-                                break;\n-                            }\n+                    for (final String line : Files.readAllLines(new File(url).toPath())) {\n+                        if (!line.isEmpty() && !line.startsWith(\"#\")) {\n+                            url = line;\n+                            break;\n                         }\n                     }\n                     break;\n                 case PLS_EXTENSION:\n-                    try (final InputStream isPLS = new URL(url).openStream()) {\n-                        for (final String line : IOUtils.readLines(isPLS)) {\n-                            if (!line.isEmpty() && line.startsWith(\"File\")) {\n-                                final Matcher matcher = PLS_STREAM_PATTERN.matcher(line);\n-                                if (matcher.find()) {\n-                                    url = matcher.group(1);\n-                                    break;\n-                                }\n+                    for (final String line : Files.readAllLines(new File(url).toPath())) {", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java b/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\nindex 8364bbcc8..9c87a4f24 100644\n--- a/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\n+++ b/bundles/org.openhab.core.audio/src/main/java/org/openhab/core/audio/URLAudioStream.java\n\n@@ -66,7 +67,7 @@ public class URLAudioStream extends AudioStream {\n         try {\n             switch (extension) {\n                 case M3U_EXTENSION:\n-                    for (final String line : Files.readAllLines(new File(url).toPath())) {\n+                    for (final String line : Files.readAllLines(Paths.get(URI.create(url)))) {\n                         if (!line.isEmpty() && !line.startsWith(\"#\")) {\n                             url = line;\n                             break;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0ODUyNw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421148527", "bodyText": "DoesoriginalInputStream.readAllBytes() not work?", "author": "cpmeister", "createdAt": "2020-05-06T23:22:58Z", "path": "bundles/org.openhab.core.model.core/src/main/java/org/openhab/core/model/core/internal/ModelRepositoryImpl.java", "diffHunk": "@@ -98,7 +98,9 @@ public boolean addOrRefreshModel(String name, final InputStream originalInputStr\n         try {\n             InputStream inputStream = null;\n             if (originalInputStream != null) {\n-                byte[] bytes = IOUtils.toByteArray(originalInputStream);\n+                final ByteArrayOutputStream output = new ByteArrayOutputStream();\n+                originalInputStream.transferTo(output);\n+                byte[] bytes = output.toByteArray();", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.model.core/src/main/java/org/openhab/core/model/core/internal/ModelRepositoryImpl.java b/bundles/org.openhab.core.model.core/src/main/java/org/openhab/core/model/core/internal/ModelRepositoryImpl.java\nindex aee387d40..efbac2bba 100644\n--- a/bundles/org.openhab.core.model.core/src/main/java/org/openhab/core/model/core/internal/ModelRepositoryImpl.java\n+++ b/bundles/org.openhab.core.model.core/src/main/java/org/openhab/core/model/core/internal/ModelRepositoryImpl.java\n\n@@ -98,9 +97,7 @@ public class ModelRepositoryImpl implements ModelRepository {\n         try {\n             InputStream inputStream = null;\n             if (originalInputStream != null) {\n-                final ByteArrayOutputStream output = new ByteArrayOutputStream();\n-                originalInputStream.transferTo(output);\n-                byte[] bytes = output.toByteArray();\n+                byte[] bytes = originalInputStream.readAllBytes();\n                 String validationResult = validateModel(name, new ByteArrayInputStream(bytes));\n                 if (validationResult != null) {\n                     logger.warn(\"Configuration model '{}' has errors, therefore ignoring it: {}\", name,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0OTI1OQ==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421149259", "bodyText": "Charset should be specified", "author": "cpmeister", "createdAt": "2020-05-06T23:25:13Z", "path": "bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java", "diffHunk": "@@ -147,16 +148,19 @@ static public String sendHttpPutRequest(String url, String contentType, String c\n      *\r\n      * @param url the URL to be used for the PUT request.\r\n      * @param contentType the content type of the given <code>content</code>\r\n-     * @param content the content to be send to the given <code>url</code> or <code>null</code> if no content should be sent.\r\n+     * @param content the content to be send to the given <code>url</code> or <code>null</code> if no content should be\r\n+     *            sent.\r\n      * @param headers the HTTP headers to be sent in the request.\r\n      * @param timeout timeout in ms\r\n      * @return the response body or <code>NULL</code> when the request went wrong\r\n      */\r\n-    static public String sendHttpPutRequest(String url, String contentType, String content, Map<String, String> headers, int timeout) {\r\n+    static public String sendHttpPutRequest(String url, String contentType, String content, Map<String, String> headers,\r\n+            int timeout) {\r\n         try {\r\n             Properties headerProperties = new Properties();\r\n             headerProperties.putAll(headers);\r\n-            return HttpUtil.executeUrl(HttpMethod.PUT.name(), url, headerProperties, IOUtils.toInputStream(content), contentType, timeout);\r\n+            return HttpUtil.executeUrl(HttpMethod.PUT.name(), url, headerProperties,\r\n+                    new ByteArrayInputStream(content.getBytes()), contentType, timeout);\r", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\nindex 3066b2ebf..3a7b83c2f 100644\n--- a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n+++ b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n\n@@ -160,7 +161,7 @@ public class HTTP {\n             Properties headerProperties = new Properties();\n             headerProperties.putAll(headers);\n             return HttpUtil.executeUrl(HttpMethod.PUT.name(), url, headerProperties,\n-                    new ByteArrayInputStream(content.getBytes()), contentType, timeout);\n+                    new ByteArrayInputStream(content.getBytes(StandardCharsets.UTF_8)), contentType, timeout);\n         } catch (IOException e) {\n             logger.error(\"Fatal transport error: {}\", e.getMessage());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0OTMzMw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421149333", "bodyText": "Charset should be specified", "author": "cpmeister", "createdAt": "2020-05-06T23:25:26Z", "path": "bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java", "diffHunk": "@@ -216,7 +220,8 @@ static public String sendHttpPostRequest(String url, String contentType, String\n     static public String sendHttpPostRequest(String url, String contentType, String content, int timeout) {\r\n         String response = null;\r\n         try {\r\n-            response = HttpUtil.executeUrl(HttpMethod.POST.name(), url, IOUtils.toInputStream(content), contentType, timeout);\r\n+            response = HttpUtil.executeUrl(HttpMethod.POST.name(), url, new ByteArrayInputStream(content.getBytes()),\r", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\nindex 3066b2ebf..3a7b83c2f 100644\n--- a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n+++ b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n\n@@ -220,8 +221,8 @@ public class HTTP {\n     static public String sendHttpPostRequest(String url, String contentType, String content, int timeout) {\n         String response = null;\n         try {\n-            response = HttpUtil.executeUrl(HttpMethod.POST.name(), url, new ByteArrayInputStream(content.getBytes()),\n-                    contentType, timeout);\n+            response = HttpUtil.executeUrl(HttpMethod.POST.name(), url,\n+                    new ByteArrayInputStream(content.getBytes(StandardCharsets.UTF_8)), contentType, timeout);\n         } catch (IOException e) {\n             logger.error(\"Fatal transport error: {}\", e.getMessage());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0OTM5OA==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421149398", "bodyText": "see above", "author": "cpmeister", "createdAt": "2020-05-06T23:25:37Z", "path": "bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java", "diffHunk": "@@ -225,19 +230,22 @@ static public String sendHttpPostRequest(String url, String contentType, String\n \r\n     /**\r\n      * Send out a POST-HTTP request. Errors will be logged, returned values just ignored.\r\n-     * \r\n+     *\r\n      * @param url the URL to be used for the GET request.\r\n      * @param contentType the content type of the given <code>content</code>\r\n-     * @param content the content to be send to the given <code>url</code> or <code>null</code> if no content should be sent.\r\n+     * @param content the content to be send to the given <code>url</code> or <code>null</code> if no content should be\r\n+     *            sent.\r\n      * @param headers the HTTP headers to be sent in the request.\r\n      * @param timeout timeout in ms\r\n      * @return the response body or <code>NULL</code> when the request went wrong\r\n      */\r\n-    public static String sendHttpPostRequest(String url, String contentType, String content, Map<String, String> headers, int timeout) {\r\n+    public static String sendHttpPostRequest(String url, String contentType, String content,\r\n+            Map<String, String> headers, int timeout) {\r\n         try {\r\n             Properties headerProperties = new Properties();\r\n             headerProperties.putAll(headers);\r\n-            return HttpUtil.executeUrl(HttpMethod.POST.name(), url, headerProperties, IOUtils.toInputStream(content), contentType, timeout);\r\n+            return HttpUtil.executeUrl(HttpMethod.POST.name(), url, headerProperties,\r\n+                    new ByteArrayInputStream(content.getBytes()), contentType, timeout);\r", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\nindex 3066b2ebf..3a7b83c2f 100644\n--- a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n+++ b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n\n@@ -245,7 +246,7 @@ public class HTTP {\n             Properties headerProperties = new Properties();\n             headerProperties.putAll(headers);\n             return HttpUtil.executeUrl(HttpMethod.POST.name(), url, headerProperties,\n-                    new ByteArrayInputStream(content.getBytes()), contentType, timeout);\n+                    new ByteArrayInputStream(content.getBytes(StandardCharsets.UTF_8)), contentType, timeout);\n         } catch (IOException e) {\n             logger.error(\"Fatal transport error: {}\", e.getMessage());\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE0OTY0Mw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421149643", "bodyText": "Same question as earlier", "author": "cpmeister", "createdAt": "2020-05-06T23:26:25Z", "path": "bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/firmware/FirmwareImpl.java", "diffHunk": "@@ -176,7 +176,9 @@ public FirmwareRestriction getFirmwareRestriction() {\n                 MessageDigest md = MessageDigest.getInstance(\"MD5\");\n \n                 try (DigestInputStream dis = new DigestInputStream(inputStream, md)) {\n-                    bytes = IOUtils.toByteArray(dis);\n+                    final ByteArrayOutputStream output = new ByteArrayOutputStream();\n+                    dis.transferTo(output);\n+                    bytes = output.toByteArray();", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/firmware/FirmwareImpl.java b/bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/firmware/FirmwareImpl.java\nindex 48798f912..ca6fefd96 100644\n--- a/bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/firmware/FirmwareImpl.java\n+++ b/bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/firmware/FirmwareImpl.java\n\n@@ -176,9 +175,7 @@ public final class FirmwareImpl implements Firmware {\n                 MessageDigest md = MessageDigest.getInstance(\"MD5\");\n \n                 try (DigestInputStream dis = new DigestInputStream(inputStream, md)) {\n-                    final ByteArrayOutputStream output = new ByteArrayOutputStream();\n-                    dis.transferTo(output);\n-                    bytes = output.toByteArray();\n+                    bytes = dis.readAllBytes();\n                 } catch (IOException ioEx) {\n                     logger.error(\"Cannot read firmware {}.\", this, ioEx);\n                     return null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTE1MjUzOA==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r421152538", "bodyText": "Charset should be specified", "author": "cpmeister", "createdAt": "2020-05-06T23:35:38Z", "path": "bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java", "diffHunk": "@@ -135,7 +135,8 @@ static public String sendHttpPutRequest(String url, String contentType, String c\n     static public String sendHttpPutRequest(String url, String contentType, String content, int timeout) {\r\n         String response = null;\r\n         try {\r\n-            response = HttpUtil.executeUrl(HttpMethod.PUT.name(), url, IOUtils.toInputStream(content), contentType, timeout);\r\n+            response = HttpUtil.executeUrl(HttpMethod.PUT.name(), url, new ByteArrayInputStream(content.getBytes()),\r", "originalCommit": "dea4b40aeba4388eed73b620afc2ae6d46653832", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "chunk": "diff --git a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\nindex 3066b2ebf..3a7b83c2f 100644\n--- a/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n+++ b/bundles/org.openhab.core.model.script/src/org/openhab/core/model/script/actions/HTTP.java\n\n@@ -135,8 +136,8 @@ public class HTTP {\n     static public String sendHttpPutRequest(String url, String contentType, String content, int timeout) {\n         String response = null;\n         try {\n-            response = HttpUtil.executeUrl(HttpMethod.PUT.name(), url, new ByteArrayInputStream(content.getBytes()),\n-                    contentType, timeout);\n+            response = HttpUtil.executeUrl(HttpMethod.PUT.name(), url,\n+                    new ByteArrayInputStream(content.getBytes(StandardCharsets.UTF_8)), contentType, timeout);\n         } catch (IOException e) {\n             logger.error(\"Fatal transport error: {}\", e.getMessage());\n         }\n"}}, {"oid": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "url": "https://github.com/openhab/openhab-core/commit/d0db3722cf20268adbc6d7e58588e00c8a0c647e", "message": "incorporated feedback from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-05-08T18:27:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjM3Nzk4Mw==", "url": "https://github.com/openhab/openhab-core/pull/1441#discussion_r422377983", "bodyText": "You should also close this reader after you are done with it", "author": "cpmeister", "createdAt": "2020-05-08T21:13:27Z", "path": "bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java", "diffHunk": "@@ -78,14 +79,14 @@ private RsaJsonWebKey generateNewKey() throws JoseException, FileNotFoundExcepti\n \n         String keyJson = newKey.toJson(OutputControlLevel.INCLUDE_PRIVATE);\n \n-        IOUtils.write(keyJson, new FileOutputStream(file));\n+        Files.writeString(file.toPath(), keyJson, StandardCharsets.UTF_8);\n         return newKey;\n     }\n \n     private RsaJsonWebKey loadOrGenerateKey() throws FileNotFoundException, JoseException, IOException {\n         try {\n-            List<String> lines = IOUtils.readLines(new FileInputStream(KEY_FILE_PATH));\n-            return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(lines.get(0));\n+            final BufferedReader reader = Files.newBufferedReader(Paths.get(KEY_FILE_PATH));", "originalCommit": "d0db3722cf20268adbc6d7e58588e00c8a0c647e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d4109ee94597786ac6ae348be6cd8989e95f95d8", "chunk": "diff --git a/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java b/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\nindex 2f28ef121..8f951c70c 100644\n--- a/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\n+++ b/bundles/org.openhab.core.io.rest.auth/src/main/java/org/openhab/core/io/rest/auth/internal/JwtHelper.java\n\n@@ -84,8 +84,7 @@ public class JwtHelper {\n     }\n \n     private RsaJsonWebKey loadOrGenerateKey() throws FileNotFoundException, JoseException, IOException {\n-        try {\n-            final BufferedReader reader = Files.newBufferedReader(Paths.get(KEY_FILE_PATH));\n+        try (final BufferedReader reader = Files.newBufferedReader(Paths.get(KEY_FILE_PATH))) {\n             return (RsaJsonWebKey) JsonWebKey.Factory.newJwk(reader.readLine());\n         } catch (IOException | JoseException e) {\n             RsaJsonWebKey key = generateNewKey();\n"}}, {"oid": "d4109ee94597786ac6ae348be6cd8989e95f95d8", "url": "https://github.com/openhab/openhab-core/commit/d4109ee94597786ac6ae348be6cd8989e95f95d8", "message": "Removed dependency on 'org.apache.commons.io'\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-05-21T09:30:27Z", "type": "commit"}, {"oid": "d4109ee94597786ac6ae348be6cd8989e95f95d8", "url": "https://github.com/openhab/openhab-core/commit/d4109ee94597786ac6ae348be6cd8989e95f95d8", "message": "Removed dependency on 'org.apache.commons.io'\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-05-21T09:30:27Z", "type": "forcePushed"}]}