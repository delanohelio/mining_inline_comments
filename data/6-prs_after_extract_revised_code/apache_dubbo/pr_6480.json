{"pr_number": 6480, "pr_title": "fix expire cache time", "pr_createdAt": "2020-07-16T13:48:56Z", "pr_url": "https://github.com/apache/dubbo/pull/6480", "timeline": [{"oid": "4dbed9fc54071813269ce7fdd2603417417d5908", "url": "https://github.com/apache/dubbo/commit/4dbed9fc54071813269ce7fdd2603417417d5908", "message": "fix expire cache time", "committedDate": "2020-07-16T13:20:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mzg1NTYyNA==", "url": "https://github.com/apache/dubbo/pull/6480#discussion_r593855624", "bodyText": "shall we check if expireThread.getTimeToLive() is zero or even negative", "author": "AlbumenJ", "createdAt": "2021-03-14T07:22:14Z", "path": "dubbo-filter/dubbo-filter-cache/src/main/java/org/apache/dubbo/cache/support/expiring/ExpiringMap.java", "diffHunk": "@@ -84,6 +84,11 @@ public V put(K key, V value) {\n     public V get(Object key) {\n         ExpiryObject object = delegateMap.get(key);\n         if (object != null) {\n+            long timeIdle = System.currentTimeMillis() - object.getLastAccessTime();\n+            if (timeIdle >= expireThread.getTimeToLive() * 1000) {", "originalCommit": "4dbed9fc54071813269ce7fdd2603417417d5908", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMDQ0ODg5Ng==", "url": "https://github.com/apache/dubbo/pull/6480#discussion_r600448896", "bodyText": "oh yes. we should be", "author": "wenbochang888", "createdAt": "2021-03-24T12:53:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU5Mzg1NTYyNA=="}], "type": "inlineReview", "revised_code": {"commit": "ccf39b7f1dd21d5f95afe69152ce0598bfcd2d57", "chunk": "diff --git a/dubbo-filter/dubbo-filter-cache/src/main/java/org/apache/dubbo/cache/support/expiring/ExpiringMap.java b/dubbo-filter/dubbo-filter-cache/src/main/java/org/apache/dubbo/cache/support/expiring/ExpiringMap.java\nindex 128b8c667..90509385d 100644\n--- a/dubbo-filter/dubbo-filter-cache/src/main/java/org/apache/dubbo/cache/support/expiring/ExpiringMap.java\n+++ b/dubbo-filter/dubbo-filter-cache/src/main/java/org/apache/dubbo/cache/support/expiring/ExpiringMap.java\n\n@@ -85,7 +85,8 @@ public class ExpiringMap<K, V> implements Map<K, V> {\n         ExpiryObject object = delegateMap.get(key);\n         if (object != null) {\n             long timeIdle = System.currentTimeMillis() - object.getLastAccessTime();\n-            if (timeIdle >= expireThread.getTimeToLive() * 1000) {\n+            int timeToLive = expireThread.getTimeToLive();\n+            if (timeToLive > 0 && timeIdle >= timeToLive * 1000) {\n                 delegateMap.remove(object.getKey());\n                 return null;\n             }\n"}}, {"oid": "ccf39b7f1dd21d5f95afe69152ce0598bfcd2d57", "url": "https://github.com/apache/dubbo/commit/ccf39b7f1dd21d5f95afe69152ce0598bfcd2d57", "message": "timeToLive > 0", "committedDate": "2021-03-24T12:54:03Z", "type": "commit"}]}