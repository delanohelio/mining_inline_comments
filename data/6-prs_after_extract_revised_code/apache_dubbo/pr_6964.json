{"pr_number": 6964, "pr_title": "[Dubbo-6963] fix bug: delete last config not take effect", "pr_createdAt": "2020-11-30T09:03:08Z", "pr_url": "https://github.com/apache/dubbo/pull/6964", "timeline": [{"oid": "abbb9b3177ebc3b6eb72f44b43ef46443400623c", "url": "https://github.com/apache/dubbo/commit/abbb9b3177ebc3b6eb72f44b43ef46443400623c", "message": "fix bug: delete last config not take effect", "committedDate": "2020-11-30T09:01:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MTY2NTc3OA==", "url": "https://github.com/apache/dubbo/pull/6964#discussion_r581665778", "bodyText": "LGTM.", "author": "chickenlj", "createdAt": "2021-02-24T06:34:42Z", "path": "dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/client/RegistryProtocol.java", "diffHunk": "@@ -653,7 +653,7 @@ public synchronized void doOverrideIfNecessary() {\n             //The current, may have been merged many times\n             URL currentUrl = exporter.getInvoker().getUrl();\n             //Merged with this configuration\n-            URL newUrl = getConfigedInvokerUrl(configurators, currentUrl);\n+            URL newUrl = getConfigedInvokerUrl(configurators, originUrl);", "originalCommit": "abbb9b3177ebc3b6eb72f44b43ef46443400623c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMTgyODY3OA==", "url": "https://github.com/apache/dubbo/pull/6964#discussion_r621828678", "bodyText": "@wikiwikiwiki Hi, thanks for your contribution.\nPlease merge the latest master branch to resolve confilcts.\n\nalready resolved", "author": "wikiwikiwiki", "createdAt": "2021-04-28T05:38:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MTY2NTc3OA=="}], "type": "inlineReview", "revised_code": {"commit": "f9d29d9bc10e08d10c29ebd961afd270f883f538", "chunk": "diff --git a/dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/client/RegistryProtocol.java b/dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java\nsimilarity index 85%\nrename from dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/client/RegistryProtocol.java\nrename to dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java\nindex 0a5c26b48..a98252e12 100644\n--- a/dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/client/RegistryProtocol.java\n+++ b/dubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java\n\n@@ -647,19 +675,19 @@ public class RegistryProtocol implements Protocol {\n             String key = getCacheKey(originInvoker);\n             ExporterChangeableWrapper<?> exporter = bounds.get(key);\n             if (exporter == null) {\n-                logger.warn(new IllegalStateException(\"error state, exporter should not be null\"));\n+                LOGGER.warn(new IllegalStateException(\"error state, exporter should not be null\"));\n                 return;\n             }\n             //The current, may have been merged many times\n             URL currentUrl = exporter.getInvoker().getUrl();\n             //Merged with this configuration\n-            URL newUrl = getConfigedInvokerUrl(configurators, originUrl);\n-            newUrl = getConfigedInvokerUrl(providerConfigurationListener.getConfigurators(), newUrl);\n-            newUrl = getConfigedInvokerUrl(serviceConfigurationListeners.get(originUrl.getServiceKey())\n+            URL newUrl = getConfiguredInvokerUrl(configurators, currentUrl);\n+            newUrl = getConfiguredInvokerUrl(providerConfigurationListener.getConfigurators(), newUrl);\n+            newUrl = getConfiguredInvokerUrl(serviceConfigurationListeners.get(originUrl.getServiceKey())\n                     .getConfigurators(), newUrl);\n             if (!currentUrl.equals(newUrl)) {\n                 RegistryProtocol.this.reExport(originInvoker, newUrl);\n-                logger.info(\"exported provider url changed, origin url: \" + originUrl +\n+                LOGGER.info(\"exported provider url changed, origin url: \" + originUrl +\n                         \", old export url: \" + currentUrl + \", new export url: \" + newUrl);\n             }\n         }\n"}}, {"oid": "f9d29d9bc10e08d10c29ebd961afd270f883f538", "url": "https://github.com/apache/dubbo/commit/f9d29d9bc10e08d10c29ebd961afd270f883f538", "message": "Merge branch 'remote-master' into fix-delete_last_config_invalid\n\n# Conflicts:\n#\tdubbo-registry/dubbo-registry-api/src/main/java/org/apache/dubbo/registry/integration/RegistryProtocol.java", "committedDate": "2021-04-28T05:28:10Z", "type": "commit"}, {"oid": "f420df160857977d9d21f5eb0386c9499ac38731", "url": "https://github.com/apache/dubbo/commit/f420df160857977d9d21f5eb0386c9499ac38731", "message": "merge master", "committedDate": "2021-04-28T05:30:30Z", "type": "commit"}]}