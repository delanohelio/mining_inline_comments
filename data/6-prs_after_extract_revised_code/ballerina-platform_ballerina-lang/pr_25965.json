{"pr_number": 25965, "pr_title": "Fix diagnostic position bug in CodeActionUtil", "pr_createdAt": "2020-09-21T07:42:04Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25965", "timeline": [{"oid": "fec20da4e6050cf6a0c5cdda479069c21b9220b2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fec20da4e6050cf6a0c5cdda479069c21b9220b2", "message": "Fix diagnostic position bug in CodeActionUtil", "committedDate": "2020-09-21T07:39:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5Njc4OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25965#discussion_r491896789", "bodyText": "Should use lineRange.startLine().offset() instead of textRange.startOffset()", "author": "SupunS", "createdAt": "2020-09-21T09:16:43Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java", "diffHunk": "@@ -176,10 +176,10 @@ public static CodeActionNodeType topLevelNodeInLine(LSContext context, TextDocum\n             Location location = diagnostic.location();\n             LineRange lineRange = location.lineRange();\n             TextRange textRange = location.textRange();\n-            int startLine = lineRange.startLine().line(); // LSP diagnostics range is 0 based\n-            int startChar = textRange.startOffset();\n-            int endLine = lineRange.endLine().line();\n-            int endChar = textRange.endOffset();\n+            int startLine = lineRange.startLine().line() - 1; // LSP diagnostics range is 0 based\n+            int startChar = textRange.startOffset() - 1;", "originalCommit": "fec20da4e6050cf6a0c5cdda479069c21b9220b2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e3050f7e7bc02dd90ac443d050961dd9b2d01209", "chunk": "diff --git a/language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java b/language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java\nindex a58ed6ff88b..04de9bc5497 100644\n--- a/language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java\n+++ b/language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java\n\n@@ -177,9 +177,9 @@ public class CodeActionUtil {\n             LineRange lineRange = location.lineRange();\n             TextRange textRange = location.textRange();\n             int startLine = lineRange.startLine().line() - 1; // LSP diagnostics range is 0 based\n-            int startChar = textRange.startOffset() - 1;\n+            int startChar = lineRange.startLine().offset() - 1;\n             int endLine = lineRange.endLine().line() - 1;\n-            int endChar = textRange.endOffset() - 1;\n+            int endChar = lineRange.endLine().offset() - 1;\n \n             if (endLine <= 0) {\n                 endLine = startLine;\n"}}, {"oid": "e3050f7e7bc02dd90ac443d050961dd9b2d01209", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e3050f7e7bc02dd90ac443d050961dd9b2d01209", "message": "Fix test fail issue", "committedDate": "2020-09-21T09:36:03Z", "type": "commit"}, {"oid": "d762b089a346ed9ed08fd31b82b15b780c801cf3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d762b089a346ed9ed08fd31b82b15b780c801cf3", "message": "Fix code bugs issues", "committedDate": "2020-09-21T09:53:10Z", "type": "commit"}]}