{"pr_number": 20506, "pr_title": "Fix NPE on duplicate field in record declaration", "pr_createdAt": "2020-01-02T09:51:22Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTEzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362691136", "bodyText": "Do we need a separate class for this? Can't we just add these cases to https://github.com/ballerina-platform/ballerina-lang/blob/v1.1.0/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/OpenRecordNegativeTest.java#L81", "author": "MaryamZi", "createdAt": "2020-01-03T02:15:07Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.test.record;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Test cases for user record definition negative test.\n+ */\n+public class RecordDefNegativeTest {", "originalCommit": "82737f26aa4c2027959e16ddc912acc4fd01c915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMjU0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362702543", "bodyText": "This test case doesn't just belong to OpenRecord (or CloseRecords). Hence I thought it'd make sense this way.", "author": "irshadnilam", "createdAt": "2020-01-03T04:14:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMzA5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362703093", "bodyText": "But we seem to be having tests for the same thing in two different places, which is not right IMO. Can we at least move those tests here?", "author": "MaryamZi", "createdAt": "2020-01-03T04:20:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwODg5OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362708899", "bodyText": "+1 will move those here", "author": "irshadnilam", "createdAt": "2020-01-03T05:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwOTU0Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362709546", "bodyText": "I have removed the mentioned duplicate-key tests, as it is tested from the tests I have added.", "author": "irshadnilam", "createdAt": "2020-01-03T05:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTEzNg=="}], "type": "inlineReview", "revised_code": {"commit": "fd510d153b8a9f1e0413b7f08e8aff1a187e9cea", "chunk": "diff --git a/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java b/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\nindex 47f4d859ff8..58bd2cb4b3a 100644\n--- a/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\n+++ b/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\n\n@@ -27,13 +27,15 @@ import org.testng.annotations.Test;\n  */\n public class RecordDefNegativeTest {\n \n-    @Test(description = \"Negative test cases for record definition\")\n+    @Test(description = \"Test usage of duplicate keys in record definition\")\n     public void duplicateKeyTest() {\n         CompileResult compileResult = BCompileUtil.compile(\"test-src/record/negative/duplicate-key-negative.bal\");\n         int errorIndex = 0;\n         BAssertUtil.validateError(compileResult, errorIndex++, \"invalid usage of record literal: duplicate key 'name'\",\n                 26, 10);\n+        BAssertUtil.validateError(compileResult, errorIndex++, \"invalid usage of record literal: duplicate key 'name'\",\n+                35, 9);\n         BAssertUtil.validateError(compileResult, errorIndex, \"invalid usage of record literal: duplicate key 'name'\",\n-                35, 13);\n+                43, 10);\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MTE5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20506#discussion_r362691191", "bodyText": "The description does not reflect what's being tested IMO.", "author": "MaryamZi", "createdAt": "2020-01-03T02:15:42Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.test.record;\n+\n+import org.ballerinalang.test.util.BAssertUtil;\n+import org.ballerinalang.test.util.BCompileUtil;\n+import org.ballerinalang.test.util.CompileResult;\n+import org.testng.annotations.Test;\n+\n+/**\n+ * Test cases for user record definition negative test.\n+ */\n+public class RecordDefNegativeTest {\n+\n+    @Test(description = \"Negative test cases for record definition\")", "originalCommit": "82737f26aa4c2027959e16ddc912acc4fd01c915", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd510d153b8a9f1e0413b7f08e8aff1a187e9cea", "chunk": "diff --git a/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java b/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\nindex 47f4d859ff8..58bd2cb4b3a 100644\n--- a/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\n+++ b/tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/record/RecordDefNegativeTest.java\n\n@@ -27,13 +27,15 @@ import org.testng.annotations.Test;\n  */\n public class RecordDefNegativeTest {\n \n-    @Test(description = \"Negative test cases for record definition\")\n+    @Test(description = \"Test usage of duplicate keys in record definition\")\n     public void duplicateKeyTest() {\n         CompileResult compileResult = BCompileUtil.compile(\"test-src/record/negative/duplicate-key-negative.bal\");\n         int errorIndex = 0;\n         BAssertUtil.validateError(compileResult, errorIndex++, \"invalid usage of record literal: duplicate key 'name'\",\n                 26, 10);\n+        BAssertUtil.validateError(compileResult, errorIndex++, \"invalid usage of record literal: duplicate key 'name'\",\n+                35, 9);\n         BAssertUtil.validateError(compileResult, errorIndex, \"invalid usage of record literal: duplicate key 'name'\",\n-                35, 13);\n+                43, 10);\n     }\n }\n"}}, {"oid": "fd510d153b8a9f1e0413b7f08e8aff1a187e9cea", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fd510d153b8a9f1e0413b7f08e8aff1a187e9cea", "message": "Fix NPE on duplicate field in record declaration", "committedDate": "2020-01-03T08:13:44Z", "type": "commit"}, {"oid": "c85f5daf00a378140e633b4e0e753f9a673becb0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c85f5daf00a378140e633b4e0e753f9a673becb0", "message": "Add test case for duplicate key as string in record type", "committedDate": "2020-01-03T08:14:16Z", "type": "commit"}]}