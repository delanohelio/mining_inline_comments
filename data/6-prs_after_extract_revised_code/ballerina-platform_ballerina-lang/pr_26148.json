{"pr_number": 26148, "pr_title": "Modify New and Init Command in accordant with the latest layout", "pr_createdAt": "2020-09-29T07:19:36Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26148", "timeline": [{"oid": "774580ca0277cb4ead2603f2eb90b368aab0a403", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/774580ca0277cb4ead2603f2eb90b368aab0a403", "message": "Modify new and init command in accordant with latest layout", "committedDate": "2020-09-29T05:00:41Z", "type": "commit"}, {"oid": "18663e540ed6cf3635122a52120d3a8b8cbdac56", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/18663e540ed6cf3635122a52120d3a8b8cbdac56", "message": "Disable AddCommand unit tests", "committedDate": "2020-09-29T05:54:03Z", "type": "commit"}, {"oid": "fee944b0c305feca8f784ab4352ba442709402fb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fee944b0c305feca8f784ab4352ba442709402fb", "message": "Modify cli-help texts for init and new command", "committedDate": "2020-09-29T07:00:13Z", "type": "commit"}, {"oid": "fda8b1c96c4f7e75d5d72b20fbe2ae694f76b25c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fda8b1c96c4f7e75d5d72b20fbe2ae694f76b25c", "message": "Fix and add tests for new command", "committedDate": "2020-09-29T07:05:46Z", "type": "commit"}, {"oid": "5a0b4df17da10c671e68f25c1c4ccbe5c4360219", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5a0b4df17da10c671e68f25c1c4ccbe5c4360219", "message": "Add unit tests for init command", "committedDate": "2020-09-29T07:06:38Z", "type": "commit"}, {"oid": "85eeb8dd999d94321ae29bea3598a5e2f6dfa461", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/85eeb8dd999d94321ae29bea3598a5e2f6dfa461", "message": "Refactor code", "committedDate": "2020-09-29T07:14:43Z", "type": "commit"}, {"oid": "10633a8d8ac4fdf6b799c43e405836ad95c2c4d0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/10633a8d8ac4fdf6b799c43e405836ad95c2c4d0", "message": "Fix test failures", "committedDate": "2020-09-29T08:13:17Z", "type": "commit"}, {"oid": "94d5cccbf912ebc0c87dbbf0cfe33686ea2802f8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/94d5cccbf912ebc0c87dbbf0cfe33686ea2802f8", "message": "Disable failing test case", "committedDate": "2020-09-30T06:20:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY4Nzk1MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26148#discussion_r497687950", "bodyText": "Let's append the e.getMessage() to the error message.", "author": "azinneera", "createdAt": "2020-09-30T17:38:15Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/NewCommand.java", "diffHunk": "@@ -97,21 +115,42 @@ public void execute() {\n         }\n \n         // Check if the command is executed inside a ballerina project\n-        Path projectRoot = ProjectDirs.findProjectRoot(path);\n+        Path projectRoot = ProjectUtils.findProjectRoot(path);\n         if (projectRoot != null) {\n             CommandUtil.printError(errStream,\n-            \"Directory is already within a Ballerina project :\" + projectRoot.toString(),\n+                    \"Directory is already within a Ballerina project :\" +\n+                            projectRoot.resolve(ProjectConstants.BALLERINA_TOML).toString(),\n+                    null,\n+                    false);\n+            return;\n+        }\n+\n+        if (!ProjectUtils.validatePkgName(packageName)) {\n+            CommandUtil.printError(errStream,\n+                    \"Invalid project name : '\" + packageName + \"' :\\n\" +\n+                            \"Project name can only contain alphanumerics, underscores and periods \" +\n+                            \"and the maximum length is 256 characters\",\n+                    null,\n+                    false);\n+            return;\n+        }\n+\n+        // Check if the template exists\n+        if (!CommandUtil.getTemplates().contains(template)) {\n+            CommandUtil.printError(errStream,\n+                    \"Template not found, use `ballerina new --help` to view available templates.\",\n                     null,\n                     false);\n             return;\n         }\n \n         try {\n             Files.createDirectories(path);\n-            CommandUtil.initProject(path);\n+            CommandUtil.initProjectByTemplate(path, packageName, template);\n         } catch (AccessDeniedException e) {\n             errStream.println(\"error: Error occurred while creating project : \" + \"Insufficient Permission\");", "originalCommit": "94d5cccbf912ebc0c87dbbf0cfe33686ea2802f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "22495161246c8e614cea45d062494d1262c44677", "chunk": "diff --git a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/NewCommand.java b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/NewCommand.java\nindex 1ade5c27f0f..780b47aec46 100644\n--- a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/NewCommand.java\n+++ b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/NewCommand.java\n\n@@ -148,7 +148,8 @@ public class NewCommand implements BLauncherCmd {\n             Files.createDirectories(path);\n             CommandUtil.initProjectByTemplate(path, packageName, template);\n         } catch (AccessDeniedException e) {\n-            errStream.println(\"error: Error occurred while creating project : \" + \"Insufficient Permission\");\n+            errStream.println(\"error: Error occurred while creating project : \" + \"Insufficient Permission : \" +\n+                    e.getMessage());\n             return;\n         } catch (IOException | URISyntaxException e) {\n             errStream.println(\"error: Error occurred while creating project : \" + e.getMessage());\n"}}, {"oid": "22495161246c8e614cea45d062494d1262c44677", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/22495161246c8e614cea45d062494d1262c44677", "message": "Address review suggestions", "committedDate": "2020-10-01T08:10:04Z", "type": "commit"}, {"oid": "ab5e5fe2dd8ac63db2f6174cb7d26c4c3a6f7e28", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ab5e5fe2dd8ac63db2f6174cb7d26c4c3a6f7e28", "message": "Merge branch 'prj_api_module_refactor' into cmd_changes", "committedDate": "2020-10-05T07:21:16Z", "type": "commit"}]}