{"pr_number": 20781, "pr_title": "Migrate to BString for ErrorValue", "pr_createdAt": "2020-01-29T08:20:05Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20781", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyMzU0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20781#discussion_r372323545", "bodyText": "The method should accept BString interface, not StringValue.", "author": "vinok88", "createdAt": "2020-01-29T11:15:18Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java", "diffHunk": "@@ -60,10 +61,16 @@\n     public static final String GENERATE_PKG_STOP = \"___stop_\";\n     public static final String GENERATE_OBJECT_CLASS_PREFIX = \".$value$\";\n \n+    @Deprecated\n     public static ErrorValue createError(String reason) {\n         return new ErrorValue(reason, new MapValueImpl<>(BTypes.typeErrorDetail));\n     }\n \n+    public static ErrorValue createError(StringValue reason) {", "originalCommit": "9dc22653d71387f0789a532f748ebbc3245a000f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "chunk": "diff --git a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\nindex 90f77f5718c..0a98ab39977 100644\n--- a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\n+++ b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\n\n@@ -66,8 +67,8 @@ public class BallerinaErrors {\n         return new ErrorValue(reason, new MapValueImpl<>(BTypes.typeErrorDetail));\n     }\n \n-    public static ErrorValue createError(StringValue reason) {\n-        return new ErrorValue(reason, new MapValueImpl<>(BTypes.typeErrorDetail));\n+    public static ErrorValue createError(BString reason) {\n+        return new ErrorValue((StringValue) reason, new MapValueImpl<>(BTypes.typeErrorDetail));\n     }\n \n     @Deprecated\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyNDA1OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20781#discussion_r372324058", "bodyText": "Same as above. All public APIs should accept BXxxx ballerina values.", "author": "vinok88", "createdAt": "2020-01-29T11:16:30Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java", "diffHunk": "@@ -72,6 +79,15 @@ public static ErrorValue createError(String reason, String detail) {\n         return new ErrorValue(reason, detailMap);\n     }\n \n+    public static ErrorValue createError(StringValue reason, String detail) {", "originalCommit": "9dc22653d71387f0789a532f748ebbc3245a000f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "chunk": "diff --git a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\nindex 90f77f5718c..0a98ab39977 100644\n--- a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\n+++ b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/BallerinaErrors.java\n\n@@ -79,12 +80,12 @@ public class BallerinaErrors {\n         return new ErrorValue(reason, detailMap);\n     }\n \n-    public static ErrorValue createError(StringValue reason, String detail) {\n+    public static ErrorValue createError(BString reason, String detail) {\n         MapValueImpl<String, Object> detailMap = new MapValueImpl<>(BTypes.typeErrorDetail);\n         if (detail != null) {\n             detailMap.put(ERROR_MESSAGE_FIELD, detail);\n         }\n-        return new ErrorValue(reason, detailMap);\n+        return new ErrorValue((StringValue) reason, detailMap);\n     }\n \n     @Deprecated\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyNjI2MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20781#discussion_r372326261", "bodyText": "Return BString", "author": "vinok88", "createdAt": "2020-01-29T11:21:44Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/ErrorValue.java", "diffHunk": "@@ -115,14 +134,26 @@ public String toString() {\n \n     /**\n      * Returns error reason.\n+     *\n      * @return reason string\n      */\n+    @Deprecated\n     public String getReason() {\n         return reason;\n     }\n \n+    /**\n+     * Returns error reason.\n+     *\n+     * @return reason string\n+     */\n+    public StringValue getErrorReason() {", "originalCommit": "9dc22653d71387f0789a532f748ebbc3245a000f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "chunk": "diff --git a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/ErrorValue.java b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/ErrorValue.java\nindex fd0a75e3a7b..98ae0f292c2 100644\n--- a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/ErrorValue.java\n+++ b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/values/ErrorValue.java\n\n@@ -147,7 +148,7 @@ public class ErrorValue extends BError implements RefValue {\n      *\n      * @return reason string\n      */\n-    public StringValue getErrorReason() {\n+    public BString getErrorReason() {\n         return StringUtils.fromString(reason);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjMyOTQyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20781#discussion_r372329425", "bodyText": "Shall we deprecate these old methods, so that we can remove them later.", "author": "vinok88", "createdAt": "2020-01-29T11:29:32Z", "path": "langlib/lang.error/src/main/java/org/ballerinalang/langlib/error/Reason.java", "diffHunk": "@@ -39,4 +40,8 @@\n     public static String reason(Strand strand, ErrorValue value) {", "originalCommit": "9dc22653d71387f0789a532f748ebbc3245a000f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "chunk": "diff --git a/langlib/lang.error/src/main/java/org/ballerinalang/langlib/error/Reason.java b/langlib/lang.error/src/main/java/org/ballerinalang/langlib/error/Reason.java\nindex 0de7102daf8..cac6ce73395 100644\n--- a/langlib/lang.error/src/main/java/org/ballerinalang/langlib/error/Reason.java\n+++ b/langlib/lang.error/src/main/java/org/ballerinalang/langlib/error/Reason.java\n\n@@ -37,11 +37,13 @@ import org.ballerinalang.natives.annotations.ReturnType;\n         returnType = {@ReturnType(type = TypeKind.STRING)})\n public class Reason {\n \n+\n+    @Deprecated\n     public static String reason(Strand strand, ErrorValue value) {\n         return value.getReason();\n     }\n \n     public static StringValue reason_bstring(Strand strand, ErrorValue value) {\n-        return value.getErrorReason();\n+        return (StringValue) value.getErrorReason();\n     }\n }\n"}}, {"oid": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "message": "Migrate to BString for ErrorValue\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/20762", "committedDate": "2020-01-29T14:27:28Z", "type": "commit"}, {"oid": "9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9c92967e6554e03cf3b0ccdc0db5c91d29cfdb59", "message": "Migrate to BString for ErrorValue\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/20762", "committedDate": "2020-01-29T14:27:28Z", "type": "forcePushed"}]}