{"pr_number": 27025, "pr_title": "Improvements to LS diagnostics, hover and import statement suggestions", "pr_createdAt": "2020-11-20T02:14:09Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025", "timeline": [{"oid": "32d86dca7f89951bf861296cf201a4d4c222b995", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/32d86dca7f89951bf861296cf201a4d4c222b995", "message": "fix diagnostics for multi-module project", "committedDate": "2020-11-17T10:40:11Z", "type": "commit"}, {"oid": "2879835957b55cba45b9cd3a1e733da868706dc8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2879835957b55cba45b9cd3a1e733da868706dc8", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev", "committedDate": "2020-11-18T03:10:33Z", "type": "commit"}, {"oid": "c814e87877720bf2df5c2a6acca9dce8302a399a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c814e87877720bf2df5c2a6acca9dce8302a399a", "message": "revamp hover support to work on project API", "committedDate": "2020-11-19T06:24:08Z", "type": "commit"}, {"oid": "bdb4f5dd87cdb1b7cd2ece627c4a069054599c53", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bdb4f5dd87cdb1b7cd2ece627c4a069054599c53", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev", "committedDate": "2020-11-19T06:28:56Z", "type": "commit"}, {"oid": "245b09ca188e7aac9963a5baea66709a314ef9b7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/245b09ca188e7aac9963a5baea66709a314ef9b7", "message": "enable pretty print for failed diagnostics checks", "committedDate": "2020-11-19T07:39:18Z", "type": "commit"}, {"oid": "a93928147fc29ae6be41f87e51b9f782519bfe78", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a93928147fc29ae6be41f87e51b9f782519bfe78", "message": "remove version keyword suggestion support", "committedDate": "2020-11-19T10:48:43Z", "type": "commit"}, {"oid": "47be20708e345e7bbcc6fac8d43c3cdbde0fc105", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/47be20708e345e7bbcc6fac8d43c3cdbde0fc105", "message": "Merge branch 'prj_api_module_refactor' into prj_api_module_refactor_dev", "committedDate": "2020-11-19T10:50:05Z", "type": "commit"}, {"oid": "408f25cca391c49727cd73f657fd572c9aed1360", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/408f25cca391c49727cd73f657fd572c9aed1360", "message": "Merge branch 'prj_api_module_refactor_dev' into dev-branch", "committedDate": "2020-11-20T02:08:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM1OTQ1Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527359452", "bodyText": "Shall we name this as DiagnosticsTest", "author": "rasika", "createdAt": "2020-11-20T02:47:48Z", "path": "language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/Diagnostics.java", "diffHunk": "@@ -0,0 +1,130 @@\n+/*\n+ *  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package org.ballerinalang.langserver.diagnostics;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+import org.ballerinalang.langserver.LSContextOperation;\n+import org.ballerinalang.langserver.common.utils.CommonUtil;\n+import org.ballerinalang.langserver.commons.DocumentServiceContext;\n+import org.ballerinalang.langserver.contexts.ContextBuilder;\n+import org.ballerinalang.langserver.diagnostic.DiagnosticsHelper;\n+import org.ballerinalang.langserver.util.FileUtils;\n+import org.ballerinalang.langserver.util.TestUtil;\n+import org.ballerinalang.langserver.workspace.BallerinaWorkspaceManager;\n+import org.eclipse.lsp4j.Diagnostic;\n+import org.eclipse.lsp4j.jsonrpc.Endpoint;\n+import org.testng.Assert;\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.InvalidPathException;\n+import java.nio.file.Path;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+/**\n+ * Diagnostics tests are covered here.\n+ * \n+ * @since 2.0.0\n+ */\n+public class Diagnostics {", "originalCommit": "408f25cca391c49727cd73f657fd572c9aed1360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM3MzQ4Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527373486", "bodyText": "+1", "author": "nadeeshaan", "createdAt": "2020-11-20T03:39:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM1OTQ1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e", "chunk": "diff --git a/language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/Diagnostics.java b/language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/DiagnosticsTest.java\nsimilarity index 99%\nrename from language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/Diagnostics.java\nrename to language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/DiagnosticsTest.java\nindex 7a0b28946f5..8dc068c2f54 100644\n--- a/language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/Diagnostics.java\n+++ b/language-server/modules/langserver-core/src/test/java/org/ballerinalang/langserver/diagnostics/DiagnosticsTest.java\n\n@@ -46,10 +46,10 @@ import java.util.Optional;\n \n /**\n  * Diagnostics tests are covered here.\n- * \n+ *\n  * @since 2.0.0\n  */\n-public class Diagnostics {\n+public class DiagnosticsTest {\n \n     private Endpoint serviceEndpoint;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2MDk5NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527360994", "bodyText": "Since the Symbol.docAttachment(); is at Symbol level, can't we have a single function to get markup content? Easier and minimum changes required to maintain against future lang changes.", "author": "rasika", "createdAt": "2020-11-20T02:53:32Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/hover/HoverUtil.java", "diffHunk": "@@ -54,80 +49,144 @@\n     /**\n      * Get the hover content.\n      *\n-     * @param context        Hover operation context\n-     * @param cursorPosition Cursor position\n+     * @param context Hover operation context\n      * @return {@link Hover} Hover content\n      */\n-    public static Hover getHover(HoverContext context, Position cursorPosition) throws TokenOrSymbolNotFoundException {\n+    public static Hover getHover(HoverContext context) {\n         Optional<SemanticModel> semanticModel = context.workspace().semanticModel(context.filePath());\n         if (semanticModel.isEmpty()) {\n             return HoverUtil.getDefaultHoverObject();\n         }\n-        // TODO: Migrate to the latest\n-        Token tokenAtCursor = TokensUtil.findTokenAtPosition(context, cursorPosition);\n-        context.setTokenAtCursor(tokenAtCursor);\n \n-        return HoverUtil.getDefaultHoverObject();\n+        Position cursorPosition = context.getCursorPosition();\n+        LinePosition linePosition = LinePosition.from(cursorPosition.getLine(), cursorPosition.getCharacter());\n+        Optional<Symbol> symbolAtCursor = semanticModel.get()\n+                .symbol(context.filePath().getFileName().getFileName().toString(), linePosition);\n+        if (symbolAtCursor.isEmpty()) {\n+            return HoverUtil.getDefaultHoverObject();\n+        }\n+\n+        switch (symbolAtCursor.get().kind()) {", "originalCommit": "408f25cca391c49727cd73f657fd572c9aed1360", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM3MzM5Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27025#discussion_r527373392", "bodyText": "We have to have separate functions since each of the construct behaves differently. For an instance, function's docs and the record's docs are completely different when considered to the class. Instead of having a single method with number of checks to bypass each case.", "author": "nadeeshaan", "createdAt": "2020-11-20T03:39:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2MDk5NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8826d68ba42ea4c94eca0cc8cd6600c07d78eb7e", "message": "rename test class", "committedDate": "2020-11-20T03:58:29Z", "type": "commit"}]}