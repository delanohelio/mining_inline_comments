{"pr_number": 20658, "pr_title": "[NATS-Streaming] Fix issue in acknowledging messages in auto-ack mode", "pr_createdAt": "2020-01-17T09:05:31Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20658", "timeline": [{"oid": "98bd33630e1209ba2dbe758ebca74bf626d2ebb2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98bd33630e1209ba2dbe758ebca74bf626d2ebb2", "message": "Fix issue in acknowledging messages in auto-ack mode\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/20516", "committedDate": "2020-01-17T08:52:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MjA3MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20658#discussion_r367892071", "bodyText": "Shall we combine this line?", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-01-17T11:30:03Z", "path": "stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java", "diffHunk": "@@ -41,8 +42,15 @@ public static void streamingAttach(ObjectValue streamingListener, ObjectValue se\n         ConcurrentHashMap<ObjectValue, StreamingListener> serviceListenerMap =\n                 (ConcurrentHashMap<ObjectValue, StreamingListener>) streamingListener\n                         .getNativeData(STREAMING_DISPATCHER_LIST);\n-        serviceListenerMap.put(service, new StreamingListener(service, BRuntime.getCurrentRuntime(),\n-                                                              streamingListener.getObjectValue(\"connection\")\n-                                                                      .getStringValue(Constants.URL)));\n+        boolean manualAck = getAckMode(service);\n+        serviceListenerMap.put(service, new StreamingListener(service, manualAck, BRuntime.getCurrentRuntime(),\n+                streamingListener.getObjectValue(\"connection\")\n+                        .getStringValue(Constants.URL)));", "originalCommit": "98bd33630e1209ba2dbe758ebca74bf626d2ebb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkxNjY2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20658#discussion_r367916660", "bodyText": "#20658 (comment)", "author": "aashikam", "createdAt": "2020-01-17T12:41:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg5MjA3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5f1f8365334bc4f28463d64d85e6407ae116a63f", "chunk": "diff --git a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\nindex b454a4f07e1..936dcbfe628 100644\n--- a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\n+++ b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\n\n@@ -44,8 +44,7 @@ public class Attach {\n                         .getNativeData(STREAMING_DISPATCHER_LIST);\n         boolean manualAck = getAckMode(service);\n         serviceListenerMap.put(service, new StreamingListener(service, manualAck, BRuntime.getCurrentRuntime(),\n-                streamingListener.getObjectValue(\"connection\")\n-                        .getStringValue(Constants.URL)));\n+                streamingListener.getObjectValue(\"connection\").getStringValue(Constants.URL)));\n     }\n \n     private static boolean getAckMode(ObjectValue service) {\n"}}, {"oid": "5f1f8365334bc4f28463d64d85e6407ae116a63f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5f1f8365334bc4f28463d64d85e6407ae116a63f", "message": "Add changes from code review", "committedDate": "2020-01-17T12:31:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkxMzY5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20658#discussion_r367913690", "bodyText": "This is not formatted according to the standard. Previous was correct.", "author": "wggihan", "createdAt": "2020-01-17T12:32:59Z", "path": "stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java", "diffHunk": "@@ -41,8 +42,15 @@ public static void streamingAttach(ObjectValue streamingListener, ObjectValue se\n         ConcurrentHashMap<ObjectValue, StreamingListener> serviceListenerMap =\n                 (ConcurrentHashMap<ObjectValue, StreamingListener>) streamingListener\n                         .getNativeData(STREAMING_DISPATCHER_LIST);\n-        serviceListenerMap.put(service, new StreamingListener(service, BRuntime.getCurrentRuntime(),\n-                                                              streamingListener.getObjectValue(\"connection\")\n-                                                                      .getStringValue(Constants.URL)));\n+        boolean manualAck = getAckMode(service);\n+        serviceListenerMap.put(service, new StreamingListener(service, manualAck, BRuntime.getCurrentRuntime(),", "originalCommit": "98bd33630e1209ba2dbe758ebca74bf626d2ebb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkzNTQzOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20658#discussion_r367935439", "bodyText": "Fixed this in 128133c", "author": "aashikam", "createdAt": "2020-01-17T13:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkxMzY5MA=="}], "type": "inlineReview", "revised_code": {"commit": "128133cde87cddcd31fc07a47ca7dada6e83fed0", "chunk": "diff --git a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\nindex b454a4f07e1..d66b916f906 100644\n--- a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\n+++ b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/consumer/Attach.java\n\n@@ -44,8 +44,8 @@ public class Attach {\n                         .getNativeData(STREAMING_DISPATCHER_LIST);\n         boolean manualAck = getAckMode(service);\n         serviceListenerMap.put(service, new StreamingListener(service, manualAck, BRuntime.getCurrentRuntime(),\n-                streamingListener.getObjectValue(\"connection\")\n-                        .getStringValue(Constants.URL)));\n+                                                              streamingListener.getObjectValue(\"connection\")\n+                                                                      .getStringValue(Constants.URL)));\n     }\n \n     private static boolean getAckMode(ObjectValue service) {\n"}}, {"oid": "128133cde87cddcd31fc07a47ca7dada6e83fed0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/128133cde87cddcd31fc07a47ca7dada6e83fed0", "message": "Fix formatting issue", "committedDate": "2020-01-17T13:29:45Z", "type": "commit"}, {"oid": "382542c900339a562d06a85eb18e06f59c247623", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/382542c900339a562d06a85eb18e06f59c247623", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into nats-master", "committedDate": "2020-01-20T01:14:52Z", "type": "commit"}]}