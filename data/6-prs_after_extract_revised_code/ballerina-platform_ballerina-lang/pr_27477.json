{"pr_number": 27477, "pr_title": "Add changes to start the trx coordinator at the initiator side", "pr_createdAt": "2020-12-14T05:04:01Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477", "timeline": [{"oid": "e2f96e113a26ef4b27dd5d1b53a367d6945ba367", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2f96e113a26ef4b27dd5d1b53a367d6945ba367", "message": "Add changes to start the trx coordinator at the initiator side", "committedDate": "2020-12-14T05:02:02Z", "type": "commit"}, {"oid": "666cbc49b488c5ca0c63346f838d7336e7cbc313", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/666cbc49b488c5ca0c63346f838d7336e7cbc313", "message": "Fix checkstyle issue", "committedDate": "2020-12-14T05:12:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTYxMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542131613", "bodyText": "without checking whether we are in a trx scope here, shall we check it in CodeAnalyzer's visit(BLangInvocation.BLangActionInvocation actionInvocation) ? We have this check there already", "author": "gimantha", "createdAt": "2020-12-14T06:01:01Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -4078,6 +4078,8 @@ private BLangOnFailClause createTrxInternalOnFail(Location pos, BLangSimpleVarRe\n \n     @Override\n     public void visit(BLangTransaction transactionNode) {\n+        boolean previousInTransactionContext = this.inTransactionContext;\n+        this.inTransactionContext = true;", "originalCommit": "666cbc49b488c5ca0c63346f838d7336e7cbc313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE1ODY4Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542158683", "bodyText": "Fixed", "author": "lasinicl", "createdAt": "2020-12-14T07:15:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMTYxMw=="}], "type": "inlineReview", "revised_code": {"commit": "9f96bd9d5cc9dbc70f1da6d94cf6a2c41eb6351f", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\nindex d178ea44ddc..aa9795a6550 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n\n@@ -4078,8 +4077,6 @@ public class Desugar extends BLangNodeVisitor {\n \n     @Override\n     public void visit(BLangTransaction transactionNode) {\n-        boolean previousInTransactionContext = this.inTransactionContext;\n-        this.inTransactionContext = true;\n         if (transactionNode.onFailClause != null) {\n             //rewrite user defined on fail within a do statement\n             BLangOnFailClause onFailClause = transactionNode.onFailClause;\n"}}, {"oid": "9f96bd9d5cc9dbc70f1da6d94cf6a2c41eb6351f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f96bd9d5cc9dbc70f1da6d94cf6a2c41eb6351f", "message": "Add suggested changes", "committedDate": "2020-12-14T06:24:34Z", "type": "commit"}, {"oid": "2009f133d61edfb209028f0b2adcbedcbbb7bdc7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2009f133d61edfb209028f0b2adcbedcbbb7bdc7", "message": "Add suggested changes", "committedDate": "2020-12-14T07:09:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4MDg0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542180840", "bodyText": "We already have a flag, called withinTransactionScope, I think we can use it", "author": "gimantha", "createdAt": "2020-12-14T08:03:10Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -575,7 +576,9 @@ public void visit(BLangTransaction transactionNode) {\n         int previousCommitCount = this.commitCount;\n         int previousRollbackCount = this.rollbackCount;\n         boolean prevCommitRollbackAllowed = this.commitRollbackAllowed;\n+        boolean prevWithinTransactionBlock = this.withinTransactionBlock;", "originalCommit": "2009f133d61edfb209028f0b2adcbedcbbb7bdc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5OTQ4OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27477#discussion_r542199488", "bodyText": "Fixed", "author": "lasinicl", "createdAt": "2020-12-14T08:36:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE4MDg0MA=="}], "type": "inlineReview", "revised_code": {"commit": "2409e46dd2d3bb3807c03182501cc065f96adec0", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java\nindex 5cb8c4ba04c..762d1a93c59 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java\n\n@@ -576,9 +575,7 @@ public class CodeAnalyzer extends BLangNodeVisitor {\n         int previousCommitCount = this.commitCount;\n         int previousRollbackCount = this.rollbackCount;\n         boolean prevCommitRollbackAllowed = this.commitRollbackAllowed;\n-        boolean prevWithinTransactionBlock = this.withinTransactionBlock;\n         this.commitRollbackAllowed = true;\n-        this.withinTransactionBlock = true;\n         this.commitCount = 0;\n         this.rollbackCount = 0;\n \n"}}, {"oid": "2409e46dd2d3bb3807c03182501cc065f96adec0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2409e46dd2d3bb3807c03182501cc065f96adec0", "message": "Add suggested changes", "committedDate": "2020-12-14T08:29:39Z", "type": "commit"}]}