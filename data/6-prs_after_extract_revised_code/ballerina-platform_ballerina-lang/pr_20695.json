{"pr_number": 20695, "pr_title": "Fix build and run commands with relative path", "pr_createdAt": "2020-01-22T05:53:49Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM4MjA2OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369382068", "bodyText": "Shall we keep as 2017 since it was added in 2017.", "author": "warunalakshitha", "createdAt": "2020-01-22T05:59:51Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- *  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\nindex 81db459c951..b2915ee039c 100644\n--- a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\n+++ b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\n\n@@ -1,5 +1,5 @@\n /*\n- *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *  Copyright (c) 2017, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n  *\n  *  WSO2 Inc. licenses this file to you under the Apache License,\n  *  Version 2.0 (the \"License\"); you may not use this file except\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM4MjA5OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369382099", "bodyText": "Year of the copy right should be the year that we commit the file. Since we add this file in 2019 we can keep as it is.", "author": "warunalakshitha", "createdAt": "2020-01-22T05:59:57Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java\nindex ccbb0ccb374..07b3c0bfb95 100644\n--- a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java\n+++ b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n  *\n  * WSO2 Inc. licenses this file to you under the Apache License,\n  * Version 2.0 (the \"License\"); you may not use this file except\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM4MjE5Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369382196", "bodyText": "This change no needed.", "author": "warunalakshitha", "createdAt": "2020-01-22T06:00:22Z", "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- *  Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\nindex 678e206aa18..45f5fca0514 100644\n--- a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n+++ b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n\n@@ -1,5 +1,5 @@\n /*\n- *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *  Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n  *\n  *  WSO2 Inc. licenses this file to you under the Apache License,\n  *  Version 2.0 (the \"License\"); you may not use this file except\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM4Mjc2OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369382768", "bodyText": "We do not need this change.", "author": "warunalakshitha", "createdAt": "2020-01-22T06:02:51Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\nindex 410c55508d8..f55dad4bba4 100644\n--- a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n+++ b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n\n@@ -1,5 +1,5 @@\n /*\n- * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ * Copyright (c) 2019, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n  *\n  * WSO2 Inc. licenses this file to you under the Apache License,\n  * Version 2.0 (the \"License\"); you may not use this file except\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MTYwMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369391602", "bodyText": "This wont give a relative path right ? validBalFilePath.resolve(\"valid-relative-path-bal-file/hello_world_relative.bal\")\nAlso we cannot have the file separate as /. Wont it break in Windows ?", "author": "hemikak", "createdAt": "2020-01-22T06:42:25Z", "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -287,6 +287,22 @@ public void testBuildAllWithArg() throws IOException {\n         Assert.assertTrue(buildLog.contains(\"too many arguments.\\n\"));\n     }\n \n+    @Test(description = \"Build .bal files with the relative path\")\n+    public void testBuildWithRelativePath() throws IOException {\n+        // valid source root path\n+        Path validBalFilePath = this.testResources.resolve(\"valid-bal-file\");\n+        BuildCommand buildCommand = new BuildCommand(validBalFilePath, printStream, printStream, false, true);\n+        new CommandLine(buildCommand).parse(String.valueOf(validBalFilePath.resolve\n+                (\"valid-relative-path-bal-file/hello_world_relative.bal\")));", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIwMjI2Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r371202266", "bodyText": "Modified with proper relative path.", "author": "parkavi11", "createdAt": "2020-01-27T12:02:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MTYwMg=="}], "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\nindex 678e206aa18..45f5fca0514 100644\n--- a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n+++ b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n\n@@ -287,22 +287,6 @@ public class BuildCommandTest extends CommandTest {\n         Assert.assertTrue(buildLog.contains(\"too many arguments.\\n\"));\n     }\n \n-    @Test(description = \"Build .bal files with the relative path\")\n-    public void testBuildWithRelativePath() throws IOException {\n-        // valid source root path\n-        Path validBalFilePath = this.testResources.resolve(\"valid-bal-file\");\n-        BuildCommand buildCommand = new BuildCommand(validBalFilePath, printStream, printStream, false, true);\n-        new CommandLine(buildCommand).parse(String.valueOf(validBalFilePath.resolve\n-                (\"valid-relative-path-bal-file/hello_world_relative.bal\")));\n-        buildCommand.execute();\n-        String buildLog = readOutput(true);\n-        readOutput(true);\n-        Assert.assertTrue(buildLog.contains(\"Compiling source\\n\" +\n-                \"\\thello_world_relative.bal\\n\" +\n-                \"\\n\" +\n-                \"Generating executables\\n\"));\n-    }\n-\n     @Test(description = \"Build bal file with no entry\")\n     public void testBuildBalFileWithNoEntry() throws IOException {\n         // valid source root path\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MjAzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369392038", "bodyText": "Do we need an integration test as well ?", "author": "hemikak", "createdAt": "2020-01-22T06:43:47Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java", "diffHunk": "@@ -94,6 +94,19 @@ public void testSingleBalFileWithJDBCUsage() throws BallerinaTestException {\n         fooRunLeecher.waitForText(10000);\n     }\n \n+    @Test(description = \"Test running bal with relative path\")\n+    public void testRunWithRelativePath() throws BallerinaTestException {", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIwMjIxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r371202215", "bodyText": "I have written an integration test for run command and for build command, unit test is written.", "author": "parkavi11", "createdAt": "2020-01-27T12:02:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MjAzOA=="}], "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\nindex 410c55508d8..f55dad4bba4 100644\n--- a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n+++ b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n\n@@ -94,6 +94,11 @@ public class SingleBalFileTestCase extends BaseTest {\n         fooRunLeecher.waitForText(10000);\n     }\n \n+    /**\n+     * Run bal with relative path.\n+     *\n+     * @throws BallerinaTestException When running commands.\n+     */\n     @Test(description = \"Test running bal with relative path\")\n     public void testRunWithRelativePath() throws BallerinaTestException {\n         String testBalFile = \"hello_world.bal\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MjEzNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r369392134", "bodyText": "I dont think we can hardcode the file separator.", "author": "hemikak", "createdAt": "2020-01-22T06:44:06Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java", "diffHunk": "@@ -94,6 +94,19 @@ public void testSingleBalFileWithJDBCUsage() throws BallerinaTestException {\n         fooRunLeecher.waitForText(10000);\n     }\n \n+    @Test(description = \"Test running bal with relative path\")\n+    public void testRunWithRelativePath() throws BallerinaTestException {\n+        String testBalFile = \"hello_world.bal\";\n+        Path testRelativeFilePath = Paths.get(\"src\", \"test\", \"resources\", \"packaging\", \"singleBalFile\",\n+                \"relative\", \"testDir\");\n+        // Run and see output\n+        String msg = \"Hello, World!\";\n+        LogLeecher fooRunLeecher = new LogLeecher(msg);\n+        balClient.runMain(\"run\", new String[]{\"../testBal/hello_world.bal\"}, new HashMap<>(), new String[0],", "originalCommit": "10c12ae658066345b83d20a31cb10e84c9091fdb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIwMTcyNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r371201726", "bodyText": "Used File.separator instead of hardcoding the path.", "author": "parkavi11", "createdAt": "2020-01-27T12:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM5MjEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "chunk": "diff --git a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\nindex 410c55508d8..f55dad4bba4 100644\n--- a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n+++ b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/packaging/SingleBalFileTestCase.java\n\n@@ -94,6 +94,11 @@ public class SingleBalFileTestCase extends BaseTest {\n         fooRunLeecher.waitForText(10000);\n     }\n \n+    /**\n+     * Run bal with relative path.\n+     *\n+     * @throws BallerinaTestException When running commands.\n+     */\n     @Test(description = \"Test running bal with relative path\")\n     public void testRunWithRelativePath() throws BallerinaTestException {\n         String testBalFile = \"hello_world.bal\";\n"}}, {"oid": "eeafbc66aed05665e81a522cffcf2c8ee7abda20", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eeafbc66aed05665e81a522cffcf2c8ee7abda20", "message": "Modify test on build command that support all OS", "committedDate": "2020-01-27T10:16:39Z", "type": "commit"}, {"oid": "97603bdad18874c180699912de66d7fa7c6350c5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/97603bdad18874c180699912de66d7fa7c6350c5", "message": "Remove unnecessary lines", "committedDate": "2020-01-27T11:55:53Z", "type": "commit"}, {"oid": "071a69eaf71dd414b43b0131006cdcbd4d6f7137", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/071a69eaf71dd414b43b0131006cdcbd4d6f7137", "message": "Modify unit test with correct path", "committedDate": "2020-01-28T01:25:50Z", "type": "commit"}, {"oid": "581c379c728844b8853efffbda8b672c05dff74e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/581c379c728844b8853efffbda8b672c05dff74e", "message": "Fix ballerina-packerina test failure", "committedDate": "2020-01-28T09:02:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2NzM3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r372267372", "bodyText": "Did you check java.nio.file.Path.relativize ?\nhttps://stackoverflow.com/questions/37747896/understanding-java-nio-file-path-relativizepath-other", "author": "hemikak", "createdAt": "2020-01-29T09:20:09Z", "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -459,6 +459,18 @@ public void testBuildCommand() throws IOException {\n         readOutput(true);\n     }\n \n+    @Test(description = \"Build a valid ballerina file with relative path\")\n+    public void testBuildWithRelativePath() throws IOException {\n+        String buildPath = \"relative\" + File.separator + \"testDir\" + File.separator + \"..\" + File.separator + \"testBal\"", "originalCommit": "581c379c728844b8853efffbda8b672c05dff74e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2ODQxMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20695#discussion_r372268413", "bodyText": "This is also fine.", "author": "hemikak", "createdAt": "2020-01-29T09:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjI2NzM3Mg=="}], "type": "inlineReview", "revised_code": null}]}