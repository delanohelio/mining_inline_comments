{"pr_number": 27165, "pr_title": "Refactor the model and behaviour for constants", "pr_createdAt": "2020-11-25T18:07:13Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/27165", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NDE4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27165#discussion_r530774182", "bodyText": "What if we return an Optional here?", "author": "nadeeshaan", "createdAt": "2020-11-26T04:58:09Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/symbols/ConstantSymbol.java", "diffHunk": "@@ -22,12 +22,19 @@\n  *\n  * @since 2.0.0\n  */\n-public interface ConstantSymbol extends VariableSymbol {\n+public interface ConstantSymbol extends VariableSymbol, SingletonTypeSymbol {\n \n     /**\n      * Get the constant value.\n      *\n      * @return {@link Object} value of the constant\n      */\n     Object constValue();\n+\n+    /**\n+     * Gets the broader type of constant expression associated with this symbol.\n+     *\n+     * @return {@link TypeSymbol} of the broader type\n+     */\n+    TypeSymbol broaderTypeDescriptor();", "originalCommit": "a8ca6c3d6d47474452c419a7f58a3f182bbf113c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3OTUzMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27165#discussion_r530779531", "bodyText": "From a language POV, no reason for broader type of a constant expr to be optional right? If there's a constant, it also has a broader type. It may become null for incomplete constant declarations?", "author": "pubudu91", "createdAt": "2020-11-26T05:20:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NDE4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDgwNTE3NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27165#discussion_r530805174", "bodyText": "Shouldn't incomplete constant declarations is a expected case?", "author": "rasika", "createdAt": "2020-11-26T06:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NDE4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTQ4NjE2NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27165#discussion_r531486164", "bodyText": "Yes, but the APIs for the most part designed to be in-line with the spec. Optionals were used in places where the spec has specified it's optional. e.g., rest param in function type", "author": "pubudu91", "createdAt": "2020-11-27T09:39:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDc3NDE4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "c516a525b8aa38faea1b75805c466e4be335ba13", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/symbols/ConstantSymbol.java b/compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/symbols/ConstantSymbol.java\nindex 111fffc5099..7b96d75702f 100644\n--- a/compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/symbols/ConstantSymbol.java\n+++ b/compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/symbols/ConstantSymbol.java\n\n@@ -22,7 +22,7 @@ package io.ballerina.compiler.api.symbols;\n  *\n  * @since 2.0.0\n  */\n-public interface ConstantSymbol extends VariableSymbol, SingletonTypeSymbol {\n+public interface ConstantSymbol extends VariableSymbol {\n \n     /**\n      * Get the constant value.\n"}}, {"oid": "4072d0790ae465272f51b03f1c9223164b28964b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4072d0790ae465272f51b03f1c9223164b28964b", "message": "Enable the disabled enum tests", "committedDate": "2020-11-30T07:57:41Z", "type": "forcePushed"}, {"oid": "526d75f962c866e808e4bca5ea56c82f243745c1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/526d75f962c866e808e4bca5ea56c82f243745c1", "message": "Enable the disabled enum tests", "committedDate": "2020-12-03T04:44:36Z", "type": "forcePushed"}, {"oid": "c516a525b8aa38faea1b75805c466e4be335ba13", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c516a525b8aa38faea1b75805c466e4be335ba13", "message": "Use the actual symbol for BLangUserDefinedType for looking up symbols", "committedDate": "2020-12-07T06:01:13Z", "type": "commit"}, {"oid": "04c5358f39a98fc20529c8e337dbb2cc11f91821", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/04c5358f39a98fc20529c8e337dbb2cc11f91821", "message": "Make ConstantSymbol a type symbol", "committedDate": "2020-12-07T06:01:18Z", "type": "commit"}, {"oid": "8b7d9aa275ff7a63845d8bc8726df444d2ace91a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8b7d9aa275ff7a63845d8bc8726df444d2ace91a", "message": "Change constants' type to singleton type", "committedDate": "2020-12-07T06:01:18Z", "type": "commit"}, {"oid": "eb1246f28fa4c2b991b1504f09a30a1d191c22d9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eb1246f28fa4c2b991b1504f09a30a1d191c22d9", "message": "Override langLibMethods() for singleton type", "committedDate": "2020-12-07T06:01:19Z", "type": "commit"}, {"oid": "a619cedd6cf62e07bdbd3373f291ed870fb7643e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a619cedd6cf62e07bdbd3373f291ed870fb7643e", "message": "Add more tests for constants as a type", "committedDate": "2020-12-07T06:01:19Z", "type": "commit"}, {"oid": "e6823826d3835eb43636a05e714bcc7e5d0f56d0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e6823826d3835eb43636a05e714bcc7e5d0f56d0", "message": "Fix broken ExpressionContextTest test cases", "committedDate": "2020-12-07T06:01:19Z", "type": "commit"}, {"oid": "583d09a53597e83ea054beed98146b83505d13fe", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/583d09a53597e83ea054beed98146b83505d13fe", "message": "Fix broken ClassDefContextTest test case", "committedDate": "2020-12-07T06:01:20Z", "type": "commit"}, {"oid": "280da8982e8a083a0cc1bfeeca3ee275d7d14708", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/280da8982e8a083a0cc1bfeeca3ee275d7d14708", "message": "Fix broken RecordTypeDescriptorTest test cases", "committedDate": "2020-12-07T06:01:20Z", "type": "commit"}, {"oid": "22c5fe9d76a9a9206c07206356da61ba0f538126", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/22c5fe9d76a9a9206c07206356da61ba0f538126", "message": "Fix broken StatementContextTest test cases", "committedDate": "2020-12-07T06:01:20Z", "type": "commit"}, {"oid": "65e7e9797b75c9713cd103a787c7b651c2c86a03", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/65e7e9797b75c9713cd103a787c7b651c2c86a03", "message": "Add an API to get the broader type of a constant", "committedDate": "2020-12-07T06:01:20Z", "type": "commit"}, {"oid": "aaa8678bc5a3c53a6425b0cb4b05559fa72550b0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aaa8678bc5a3c53a6425b0cb4b05559fa72550b0", "message": "Improve constant filtering logic in array typedesc context and fix tests", "committedDate": "2020-12-07T06:01:21Z", "type": "commit"}, {"oid": "3aac28da0c64943773732065a84551b1e9dd3b3b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3aac28da0c64943773732065a84551b1e9dd3b3b", "message": "Fix checkstyle failure", "committedDate": "2020-12-07T06:01:21Z", "type": "commit"}, {"oid": "12ecb29424fd0799dda701e950ac46651d49466b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12ecb29424fd0799dda701e950ac46651d49466b", "message": "Enable the disabled enum tests", "committedDate": "2020-12-07T06:01:21Z", "type": "commit"}, {"oid": "12ecb29424fd0799dda701e950ac46651d49466b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/12ecb29424fd0799dda701e950ac46651d49466b", "message": "Enable the disabled enum tests", "committedDate": "2020-12-07T06:01:21Z", "type": "forcePushed"}, {"oid": "0869b0899c4855bb31c2151770e7e731276be076", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0869b0899c4855bb31c2151770e7e731276be076", "message": "Fix broken lang server tests", "committedDate": "2020-12-07T07:48:09Z", "type": "commit"}]}