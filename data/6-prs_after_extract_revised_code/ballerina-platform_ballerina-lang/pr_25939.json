{"pr_number": 25939, "pr_title": "Change observe module functions used by ballerina/http to isolated", "pr_createdAt": "2020-09-18T11:00:26Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25939", "timeline": [{"oid": "75515b80f91d62e3cdfc04ae7c08b58434a028d1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/75515b80f91d62e3cdfc04ae7c08b58434a028d1", "message": "Update observe lib module functions which are currently used by ballerina/http module to isolated\n\n# Since all the functions in ballerina/http had been changed to \"isolated\", to support this, observe modules's functions that are currently used by ballerina/http had been changed to isolated. Ideally we should make all the function in observe lib isolated.", "committedDate": "2020-09-18T10:03:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyNTU5OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25939#discussion_r490925599", "bodyText": "do we need to change this to ConcurrentHashMap ?", "author": "Kishanthan", "createdAt": "2020-09-18T12:49:17Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/ObserverContext.java", "diffHunk": "@@ -73,9 +73,9 @@\n     private boolean isSystemSpan;\n \n     public ObserverContext() {\n-        this.properties = new HashMap<>();\n-        this.mainTags = new HashMap<>();\n-        this.additionalTags = new HashMap<>();\n+        this.properties = new ConcurrentHashMap<>();", "originalCommit": "75515b80f91d62e3cdfc04ae7c08b58434a028d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyNzgwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25939#discussion_r490927807", "bodyText": "Since this had not been an issue so far, I have reverted this change with 6294955. I will verify this further and add back the ConcurrentHashMaps later if needed.", "author": "nadundesilva", "createdAt": "2020-09-18T12:53:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyNTU5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "62949558fcaffac152102ab246d94114db89cf97", "chunk": "diff --git a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/ObserverContext.java b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/ObserverContext.java\nindex 4042a5b5344..dd79c323724 100644\n--- a/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/ObserverContext.java\n+++ b/bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/ObserverContext.java\n\n@@ -73,9 +73,9 @@ public class ObserverContext {\n     private boolean isSystemSpan;\n \n     public ObserverContext() {\n-        this.properties = new ConcurrentHashMap<>();\n-        this.mainTags = new ConcurrentHashMap<>();\n-        this.additionalTags = new ConcurrentHashMap<>();\n+        this.properties = new HashMap<>();\n+        this.mainTags = new HashMap<>();\n+        this.additionalTags = new HashMap<>();\n     }\n \n     public void addProperty(String key, Object value) {\n"}}, {"oid": "62949558fcaffac152102ab246d94114db89cf97", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62949558fcaffac152102ab246d94114db89cf97", "message": "Revert added ConcurrentHashMaps\n\n# Since ConcurrentHashMaps may introduce a perf hit and since we have no issues so far with HashMaps, we will revert this change. This needs to be tested and verified to see if it is thread safe or not.", "committedDate": "2020-09-18T12:51:32Z", "type": "commit"}]}