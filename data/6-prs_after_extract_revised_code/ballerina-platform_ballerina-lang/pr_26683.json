{"pr_number": 26683, "pr_title": "Encode the ballerina generated names for jvm", "pr_createdAt": "2020-10-29T14:27:23Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683", "timeline": [{"oid": "17a9b404f6d9a959d2a469a5bfe77da026365af6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/17a9b404f6d9a959d2a469a5bfe77da026365af6", "message": "Improve encoding scheme", "committedDate": "2020-10-29T14:15:58Z", "type": "commit"}, {"oid": "522d248dcfaca4a5ff29e75d98daffa0dbdcf3ac", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/522d248dcfaca4a5ff29e75d98daffa0dbdcf3ac", "message": "Refine test methods", "committedDate": "2020-10-29T14:15:58Z", "type": "commit"}, {"oid": "6d3ab0c7454fb447191d0657ffb817cf92ff54b1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6d3ab0c7454fb447191d0657ffb817cf92ff54b1", "message": "Add integration tests", "committedDate": "2020-11-01T08:38:11Z", "type": "commit"}, {"oid": "804ae2d61027b67f33a40f656c1f9ad466ef485a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/804ae2d61027b67f33a40f656c1f9ad466ef485a", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into fix-#18720", "committedDate": "2020-11-01T11:54:14Z", "type": "commit"}, {"oid": "ab7d0c29331227d7f414e9ba53ed8b1ae43ad532", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ab7d0c29331227d7f414e9ba53ed8b1ae43ad532", "message": "Fix readonly test", "committedDate": "2020-11-01T15:35:06Z", "type": "commit"}, {"oid": "8b670adc98ef7a6ffa04711b309e4f027c9c7015", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8b670adc98ef7a6ffa04711b309e4f027c9c7015", "message": "Fix checkstyle errors", "committedDate": "2020-11-01T16:22:47Z", "type": "commit"}, {"oid": "18e67b7180de08d27db566bdb0023f6bbae4c7c4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/18e67b7180de08d27db566bdb0023f6bbae4c7c4", "message": "Fix user defined identifier clash", "committedDate": "2020-11-02T13:49:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4NDIxMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683#discussion_r516484212", "bodyText": "shall we make the value $0046 a constant as it is used in multiple locations.", "author": "riyafa", "createdAt": "2020-11-03T08:12:21Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmPackageGen.java", "diffHunk": "@@ -225,7 +226,7 @@ private static boolean isLangModule(BIRPackage moduleId) {\n         if (!BALLERINA.equals(moduleId.org.value)) {\n             return false;\n         }\n-        return moduleId.name.value.indexOf(\"lang.\") == 0 || moduleId.name.equals(Names.JAVA);\n+        return moduleId.name.value.indexOf(\"lang$0046\") == 0 || moduleId.name.equals(Names.JAVA);", "originalCommit": "d8a1dc742500a8aa64d8bf89750dcf0c54b65a18", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "744b830c650a728d675b4245fa906ff61a35f858", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmPackageGen.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmPackageGen.java\nindex 7956ee8be64..4be4463b983 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmPackageGen.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/JvmPackageGen.java\n\n@@ -226,7 +227,7 @@ public class JvmPackageGen {\n         if (!BALLERINA.equals(moduleId.org.value)) {\n             return false;\n         }\n-        return moduleId.name.value.indexOf(\"lang$0046\") == 0 || moduleId.name.equals(Names.JAVA);\n+        return moduleId.name.value.indexOf(\"lang\" + ENCODED_DOT_CHARACTER) == 0 || moduleId.name.equals(Names.JAVA);\n     }\n \n     private static void generatePackageVariable(BIRGlobalVariableDcl globalVar, ClassWriter cw) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4OTI3MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683#discussion_r516489270", "bodyText": "can we change the since value?", "author": "riyafa", "createdAt": "2020-11-03T08:22:40Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/FieldNameHashComparator.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.wso2.ballerinalang.compiler.bir.codegen.internal;\n+\n+import io.ballerina.runtime.IdentifierUtils;\n+import org.wso2.ballerinalang.compiler.semantics.model.types.NamedNode;\n+\n+import java.util.Comparator;\n+\n+/**\n+ * BIR Param name comparator to sort according its hash code.\n+ *\n+ * @since 1.2.0", "originalCommit": "d8a1dc742500a8aa64d8bf89750dcf0c54b65a18", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "744b830c650a728d675b4245fa906ff61a35f858", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/FieldNameHashComparator.java b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/FieldNameHashComparator.java\nindex 316315c7977..f71293bdb4c 100644\n--- a/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/FieldNameHashComparator.java\n+++ b/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/codegen/internal/FieldNameHashComparator.java\n\n@@ -25,7 +25,7 @@ import java.util.Comparator;\n /**\n  * BIR Param name comparator to sort according its hash code.\n  *\n- * @since 1.2.0\n+ * @since 2.0.0\n  */\n public class FieldNameHashComparator implements Comparator<NamedNode> {\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ5MDEzMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683#discussion_r516490130", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package org.ballerinalang.test.identifier;\n          \n          \n            \n            package org.ballerinalang.test.identifier;", "author": "riyafa", "createdAt": "2020-11-03T08:24:25Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.ballerinalang.test.identifier;", "originalCommit": "d8a1dc742500a8aa64d8bf89750dcf0c54b65a18", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fcb6aff4dd37d38b3cb646a7465bf35513d7d22a", "chunk": "diff --git a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\nindex 095a1daeebc..589d46a6256 100644\n--- a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\n+++ b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\n\n@@ -15,6 +15,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n+\n package org.ballerinalang.test.identifier;\n \n import org.ballerinalang.test.BaseTest;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUwMTA5NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683#discussion_r516501095", "bodyText": "can we check whether this is needed. I think runMain will fail if the tests fails. Shall we  check if that is the case? Similar for the other test cases.", "author": "riyafa", "createdAt": "2020-11-03T08:45:17Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.ballerinalang.test.identifier;\n+\n+import org.ballerinalang.test.BaseTest;\n+import org.ballerinalang.test.context.BMainInstance;\n+import org.ballerinalang.test.context.BallerinaTestException;\n+import org.ballerinalang.test.context.LogLeecher;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import java.io.File;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+\n+/**\n+ * Test cases to verify name clashes between generated identifiers.\n+ *\n+ *  @since 2.0.0\n+ */\n+public class IdentifierLiteralTest  extends BaseTest {\n+\n+    private static final String testFileLocation = Paths.get(\"src\", \"test\", \"resources\", \"identifier\")\n+            .toAbsolutePath().toString();\n+    private BMainInstance bMainInstance;\n+\n+    @BeforeClass\n+    public void setup() throws BallerinaTestException {\n+        bMainInstance = new BMainInstance(balServer);\n+    }\n+\n+    @Test(description = \"Test clashes in module names contain '.' and '_'\")\n+    public void testModuleIdentifierClash() throws BallerinaTestException {\n+        Path projectPath = Paths.get(testFileLocation, \"ModuleNameClashProject\")\n+                .toAbsolutePath();\n+        LogLeecher runLeecher = new LogLeecher(\"1 passing\");", "originalCommit": "d8a1dc742500a8aa64d8bf89750dcf0c54b65a18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU5MzA1Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26683#discussion_r516593053", "bodyText": "The runMain method does not fail for test failures. So we need to verify it externally.", "author": "HindujaB", "createdAt": "2020-11-03T11:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjUwMTA5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "fcb6aff4dd37d38b3cb646a7465bf35513d7d22a", "chunk": "diff --git a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\nindex 095a1daeebc..589d46a6256 100644\n--- a/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\n+++ b/tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/identifier/IdentifierLiteralTest.java\n\n@@ -15,6 +15,7 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n+\n package org.ballerinalang.test.identifier;\n \n import org.ballerinalang.test.BaseTest;\n"}}, {"oid": "744b830c650a728d675b4245fa906ff61a35f858", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/744b830c650a728d675b4245fa906ff61a35f858", "message": "Add constant", "committedDate": "2020-11-03T11:33:27Z", "type": "forcePushed"}, {"oid": "fcb6aff4dd37d38b3cb646a7465bf35513d7d22a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fcb6aff4dd37d38b3cb646a7465bf35513d7d22a", "message": "Add new lines", "committedDate": "2020-11-04T13:30:12Z", "type": "commit"}, {"oid": "33006c026ad3d273465269f463ef42b7311e9197", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/33006c026ad3d273465269f463ef42b7311e9197", "message": "Merge branch 'master' into fix-#18720", "committedDate": "2020-11-04T13:35:28Z", "type": "commit"}, {"oid": "33006c026ad3d273465269f463ef42b7311e9197", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/33006c026ad3d273465269f463ef42b7311e9197", "message": "Merge branch 'master' into fix-#18720", "committedDate": "2020-11-04T13:35:28Z", "type": "forcePushed"}, {"oid": "d7127e464541532b5326d730c506d3f6b7f13d3c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d7127e464541532b5326d730c506d3f6b7f13d3c", "message": "Remove package prefix in generated names", "committedDate": "2020-11-05T07:23:29Z", "type": "commit"}, {"oid": "bd993da5f89bf37129c7a6470c1d2a29fb0c3057", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bd993da5f89bf37129c7a6470c1d2a29fb0c3057", "message": "Merge branch 'master'", "committedDate": "2020-11-05T07:24:06Z", "type": "commit"}, {"oid": "934ab39ded9081f2915625035fca49fe33cb7a2b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/934ab39ded9081f2915625035fca49fe33cb7a2b", "message": "Merge branch 'master'", "committedDate": "2020-11-10T06:07:24Z", "type": "commit"}, {"oid": "d420bea210483c2dc08488d6290f780bb87ed158", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d420bea210483c2dc08488d6290f780bb87ed158", "message": "Change importing IdentifierUtils package name", "committedDate": "2020-11-10T06:12:17Z", "type": "commit"}, {"oid": "293141f260af27a0798edaffa86dcb546e12b3d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/293141f260af27a0798edaffa86dcb546e12b3d2", "message": "Modify package visibility of IdentifierUtils for tooling", "committedDate": "2020-11-10T06:17:18Z", "type": "commit"}, {"oid": "5b4bc32f91ffa0da80aad2e8f98480b01e2c381a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5b4bc32f91ffa0da80aad2e8f98480b01e2c381a", "message": "Fix compilation error", "committedDate": "2020-11-10T06:40:03Z", "type": "commit"}, {"oid": "7cd97a15f7187228a3c50787865beac8bc3e2e38", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7cd97a15f7187228a3c50787865beac8bc3e2e38", "message": "Fix checkstyle errors", "committedDate": "2020-11-10T07:55:16Z", "type": "commit"}]}