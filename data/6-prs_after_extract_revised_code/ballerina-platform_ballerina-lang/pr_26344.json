{"pr_number": 26344, "pr_title": "Validate missing key expr in invalid member access expressions in parser", "pr_createdAt": "2020-10-14T06:20:40Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26344", "timeline": [{"oid": "6664d45b523f69f2c5030fe882412cc685cccde3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6664d45b523f69f2c5030fe882412cc685cccde3", "message": "Validate missing key expr in invalid member access expressions", "committedDate": "2020-10-14T06:17:53Z", "type": "commit"}, {"oid": "5df89ffea9e6e94becabfe2899f1fc80d8241ff5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5df89ffea9e6e94becabfe2899f1fc80d8241ff5", "message": "Jballerina unit test", "committedDate": "2020-10-14T06:18:20Z", "type": "commit"}, {"oid": "1703da5fae798944b58df53f7801ba5933bdb4a7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1703da5fae798944b58df53f7801ba5933bdb4a7", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into bug-fix", "committedDate": "2020-10-14T10:58:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMTc0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26344#discussion_r504631741", "bodyText": "Inside the same method, there seems to be multiple places where we call STNodeFactory.createNodeList(member); with member possibly being null.\nShall we fix those as well? :)", "author": "SupunS", "createdAt": "2020-10-14T12:22:26Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -14165,7 +14165,15 @@ private STNode parseTypedBindingPatternOrMemberAccessRhs(STNode typeDescOrExpr,\n             case CLOSE_BRACE_TOKEN: // T[a]}\n             case COMMA_TOKEN:// T[a],\n                 if (context == ParserRuleContext.AMBIGUOUS_STMT) {\n-                    keyExpr = STNodeFactory.createNodeList(member);\n+                    if (member == null) {\n+                        STNode missingVarRef = STNodeFactory.createSimpleNameReferenceNode(\n+                                SyntaxErrors.createMissingToken(SyntaxKind.IDENTIFIER_TOKEN));\n+                        keyExpr = STNodeFactory.createNodeList(missingVarRef);\n+                        closeBracket = SyntaxErrors.addDiagnostic(closeBracket,\n+                                DiagnosticErrorCode.ERROR_MISSING_KEY_EXPR_IN_MEMBER_ACCESS_EXPR);\n+                    } else {\n+                        keyExpr = STNodeFactory.createNodeList(member);\n+                    }", "originalCommit": "1703da5fae798944b58df53f7801ba5933bdb4a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2MDY1NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26344#discussion_r504760654", "bodyText": "+1", "author": "rdulmina", "createdAt": "2020-10-14T15:14:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDYzMTc0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "4886671e01aa82b982b43b1ca59e73cd71d1d293", "chunk": "diff --git a/compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java b/compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java\nindex 8c5f28507de..d08926be9be 100644\n--- a/compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java\n+++ b/compiler/ballerina-parser/src/main/java/io/ballerina/compiler/internal/parser/BallerinaParser.java\n\n@@ -14165,15 +14165,7 @@ public class BallerinaParser extends AbstractParser {\n             case CLOSE_BRACE_TOKEN: // T[a]}\n             case COMMA_TOKEN:// T[a],\n                 if (context == ParserRuleContext.AMBIGUOUS_STMT) {\n-                    if (member == null) {\n-                        STNode missingVarRef = STNodeFactory.createSimpleNameReferenceNode(\n-                                SyntaxErrors.createMissingToken(SyntaxKind.IDENTIFIER_TOKEN));\n-                        keyExpr = STNodeFactory.createNodeList(missingVarRef);\n-                        closeBracket = SyntaxErrors.addDiagnostic(closeBracket,\n-                                DiagnosticErrorCode.ERROR_MISSING_KEY_EXPR_IN_MEMBER_ACCESS_EXPR);\n-                    } else {\n-                        keyExpr = STNodeFactory.createNodeList(member);\n-                    }\n+                    keyExpr = getKeyExpr(member);\n                     return STNodeFactory.createIndexedExpressionNode(typeDescOrExpr, openBracket, keyExpr,\n                             closeBracket);\n                 }\n"}}, {"oid": "4886671e01aa82b982b43b1ca59e73cd71d1d293", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4886671e01aa82b982b43b1ca59e73cd71d1d293", "message": "Handle other places where key expr can be null", "committedDate": "2020-10-14T15:15:26Z", "type": "commit"}]}