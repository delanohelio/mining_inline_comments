{"pr_number": 26050, "pr_title": "Fix debugger for BString related runtime changes", "pr_createdAt": "2020-09-24T04:22:43Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26050", "timeline": [{"oid": "e01391bb5274b2d8c38ce17b892e4a10c26e3c5b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e01391bb5274b2d8c38ce17b892e4a10c26e3c5b", "message": "Update debug variable implementation to support quoted identifiers", "committedDate": "2020-09-19T10:29:19Z", "type": "commit"}, {"oid": "c7a6b4ae230c0581ba630b3a08819531cf67c77f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c7a6b4ae230c0581ba630b3a08819531cf67c77f", "message": "Refactor identifier utils in order to be accessible from the debugger", "committedDate": "2020-09-22T06:01:27Z", "type": "commit"}, {"oid": "5fafc4ef1a714c3c68ca55923c51f7f0c807946e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5fafc4ef1a714c3c68ca55923c51f7f0c807946e", "message": "Refactor debug expression evaluation impl to support quoted identifiers", "committedDate": "2020-09-22T07:51:29Z", "type": "commit"}, {"oid": "9f8aa8c894eea2ba2ff7289af5143824789eed00", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f8aa8c894eea2ba2ff7289af5143824789eed00", "message": "Fix records and objects representation to support quoted identifiers", "committedDate": "2020-09-22T12:20:35Z", "type": "commit"}, {"oid": "65c8e84ee68ef03819d8554f69264369417888a7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/65c8e84ee68ef03819d8554f69264369417888a7", "message": "Resolve conflicts with master\n\n# Conflicts:\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/diagnostic/BLangDiagnosticLog.java", "committedDate": "2020-09-23T04:31:54Z", "type": "commit"}, {"oid": "5f6ed2272934316fd4fa5e0e11b55551bcec7716", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5f6ed2272934316fd4fa5e0e11b55551bcec7716", "message": "Add minor fixes", "committedDate": "2020-09-23T06:13:24Z", "type": "commit"}, {"oid": "71c4fbbd17f3180aa8c22d33016dbce8f25f90e6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/71c4fbbd17f3180aa8c22d33016dbce8f25f90e6", "message": "Update evaluation engine to convert all the string literals into BString instances", "committedDate": "2020-09-23T07:30:05Z", "type": "commit"}, {"oid": "433d89166688de40052598a40fa1e47dfcda1e0d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/433d89166688de40052598a40fa1e47dfcda1e0d", "message": "Fix string concatenation in debug expression evaluation", "committedDate": "2020-09-23T08:18:52Z", "type": "commit"}, {"oid": "df715d57d89c04f8bdcd4fa1c95506a47125534d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/df715d57d89c04f8bdcd4fa1c95506a47125534d", "message": "Add tests for function invocation evaluation with string args", "committedDate": "2020-09-24T11:52:07Z", "type": "commit"}, {"oid": "df715d57d89c04f8bdcd4fa1c95506a47125534d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/df715d57d89c04f8bdcd4fa1c95506a47125534d", "message": "Add tests for function invocation evaluation with string args", "committedDate": "2020-09-24T11:52:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc1OTYzNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26050#discussion_r494759634", "bodyText": "We can use the FROM_STRING_METHOD constant here too.", "author": "Dilhasha", "createdAt": "2020-09-25T05:44:33Z", "path": "misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/EvaluationUtils.java", "diffHunk": "@@ -105,7 +109,31 @@ public static BExpressionValue make(SuspendedContext context, double val) {\n         return new BExpressionValue(context, context.getAttachedVm().mirrorOf(val));\n     }\n \n-    public static BExpressionValue make(SuspendedContext context, String val) {\n-        return new BExpressionValue(context, context.getAttachedVm().mirrorOf(val));\n+    public static BExpressionValue make(SuspendedContext context, String val) throws EvaluationException {\n+        val = removeRedundantQuotes(val);\n+        Value bStringVal = getAsBString(context, val);\n+        return new BExpressionValue(context, bStringVal);\n+    }\n+\n+    /**\n+     * Converts the user given string literal into an {@link org.ballerinalang.jvm.api.values.BString} instance.\n+     *\n+     * @param context suspended debug context\n+     * @param val     string value\n+     * @return {@link org.ballerinalang.jvm.api.values.BString} instance\n+     */\n+    private static Value getAsBString(SuspendedContext context, String val) throws EvaluationException {\n+        List<ReferenceType> cls = context.getAttachedVm().classesByName(B_STRING_UTILS_CLASS);\n+        if (cls.isEmpty()) {\n+            cls = Collections.singletonList(loadClass(context, B_STRING_UTILS_CLASS, \"fromString\"));", "originalCommit": "df715d57d89c04f8bdcd4fa1c95506a47125534d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2NTEwNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26050#discussion_r494765106", "bodyText": "Yeah seems I've missed it somehow. Fixed with 32fbe2e. Thanks!", "author": "NipunaRanasinghe", "createdAt": "2020-09-25T06:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc1OTYzNA=="}], "type": "inlineReview", "revised_code": {"commit": "32fbe2ec4c6d0b5ef068996df00abd3b4c245a61", "chunk": "diff --git a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/EvaluationUtils.java b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/EvaluationUtils.java\nindex 68e0be0c75a..e1df24493e3 100644\n--- a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/EvaluationUtils.java\n+++ b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/evaluation/EvaluationUtils.java\n\n@@ -125,7 +125,7 @@ public class EvaluationUtils {\n     private static Value getAsBString(SuspendedContext context, String val) throws EvaluationException {\n         List<ReferenceType> cls = context.getAttachedVm().classesByName(B_STRING_UTILS_CLASS);\n         if (cls.isEmpty()) {\n-            cls = Collections.singletonList(loadClass(context, B_STRING_UTILS_CLASS, \"fromString\"));\n+            cls = Collections.singletonList(loadClass(context, B_STRING_UTILS_CLASS, FROM_STRING_METHOD));\n         }\n         List<Method> methods = cls.get(0).methodsByName(FROM_STRING_METHOD);\n         if (methods.isEmpty()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2MDMzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26050#discussion_r494760336", "bodyText": "is there a small formatting issue?", "author": "Dilhasha", "createdAt": "2020-09-25T05:46:55Z", "path": "misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/variable/VariableUtils.java", "diffHunk": "@@ -203,10 +203,10 @@ static boolean isJson(Value value) {\n         return Optional.of(methods.get(0));\n     }\n \n-    private static String removeRedundantQuotes(String str) {\n+     public static String removeRedundantQuotes(String str) {", "originalCommit": "df715d57d89c04f8bdcd4fa1c95506a47125534d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2NTQ2OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26050#discussion_r494765469", "bodyText": "Yes it is. Fixed with 32fbe2e.", "author": "NipunaRanasinghe", "createdAt": "2020-09-25T06:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc2MDMzNg=="}], "type": "inlineReview", "revised_code": {"commit": "32fbe2ec4c6d0b5ef068996df00abd3b4c245a61", "chunk": "diff --git a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/variable/VariableUtils.java b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/variable/VariableUtils.java\nindex 78516b55782..a13483abd0a 100644\n--- a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/variable/VariableUtils.java\n+++ b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/variable/VariableUtils.java\n\n@@ -203,7 +203,7 @@ public class VariableUtils {\n         return Optional.of(methods.get(0));\n     }\n \n-     public static String removeRedundantQuotes(String str) {\n+    public static String removeRedundantQuotes(String str) {\n         do {\n             str = str.replaceAll(ADDITIONAL_QUOTES_REMOVE_REGEX, \"\");\n         } while (str.startsWith(\"\\\"\") || str.endsWith(\"\\\"\"));\n"}}, {"oid": "32fbe2ec4c6d0b5ef068996df00abd3b4c245a61", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/32fbe2ec4c6d0b5ef068996df00abd3b4c245a61", "message": "Add review suggestions", "committedDate": "2020-09-25T06:01:46Z", "type": "commit"}]}