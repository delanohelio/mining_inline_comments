{"pr_number": 23819, "pr_title": "Fix Maven resolver CLI Improvements", "pr_createdAt": "2020-06-08T19:36:25Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/23819", "timeline": [{"oid": "29cde56a520c9eb50dd82327a1b29627c7200870", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/29cde56a520c9eb50dd82327a1b29627c7200870", "message": "Execute maven resolver task before compile", "committedDate": "2020-06-08T03:39:18Z", "type": "commit"}, {"oid": "0f0251f80290d91c9c196b4c841bc9c66db1379b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0f0251f80290d91c9c196b4c841bc9c66db1379b", "message": "Improve message", "committedDate": "2020-06-08T03:39:18Z", "type": "commit"}, {"oid": "9c5bcc9bb276a7034f584de1aac66e7ae083fb65", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9c5bcc9bb276a7034f584de1aac66e7ae083fb65", "message": "Fix dependency order", "committedDate": "2020-06-08T17:31:39Z", "type": "commit"}, {"oid": "fe209299d24b8b67dcc82e35cc73491d8b793523", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fe209299d24b8b67dcc82e35cc73491d8b793523", "message": "Improve progress bar texts", "committedDate": "2020-06-08T18:54:45Z", "type": "commit"}, {"oid": "7a96315f1f1b1b4be0e5cb1edddc26fc99b2d154", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a96315f1f1b1b4be0e5cb1edddc26fc99b2d154", "message": "Fix clean entire target directory", "committedDate": "2020-06-08T19:54:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA3ODM1OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23819#discussion_r437078358", "bodyText": "The CompileTask seems to be repeated here, wondering if it is intentional.", "author": "IrushiL", "createdAt": "2020-06-09T00:54:30Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java", "diffHunk": "@@ -401,10 +401,11 @@ public void execute() {\n         TaskExecutor taskExecutor = new TaskExecutor.TaskBuilder()\n                 .addTask(new CleanTargetDirTask(), isSingleFileBuild)   // clean the target directory(projects only)\n                 .addTask(new CreateTargetDirTask()) // create target directory\n+                .addTask(new ResolveMavenDependenciesTask())\n                 .addTask(new CompileTask(skipCopyLibsFromDist)) // compile the modules\n+                .addTask(new CompileTask()) // compile the modules", "originalCommit": "7a96315f1f1b1b4be0e5cb1edddc26fc99b2d154", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "89176206aabc06c2be932a15412c80b0bf5bd597", "chunk": "diff --git a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\nindex 0931e44a415..e87e5d9a05b 100644\n--- a/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\n+++ b/cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\n\n@@ -403,7 +403,6 @@ public class BuildCommand implements BLauncherCmd {\n                 .addTask(new CreateTargetDirTask()) // create target directory\n                 .addTask(new ResolveMavenDependenciesTask())\n                 .addTask(new CompileTask(skipCopyLibsFromDist)) // compile the modules\n-                .addTask(new CompileTask()) // compile the modules\n                 .addTask(new CreateLockFileTask(), this.skipLock || isSingleFileBuild)  // create a lock file if\n                                                             // the given skipLock flag does not exist(projects only)\n                 .addTask(new CreateBaloTask(), isSingleFileBuild)   // create the BALOs for modules (projects only)\n"}}, {"oid": "89176206aabc06c2be932a15412c80b0bf5bd597", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/89176206aabc06c2be932a15412c80b0bf5bd597", "message": "Remove extra compile task", "committedDate": "2020-06-09T03:48:06Z", "type": "commit"}, {"oid": "7d61dd41dca302fe9bdfd20f55668d9a481da534", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7d61dd41dca302fe9bdfd20f55668d9a481da534", "message": "Revert maven resolver task order", "committedDate": "2020-06-09T03:57:13Z", "type": "commit"}, {"oid": "ba8edc098a47b6c5f67645de95d832a287f932a8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ba8edc098a47b6c5f67645de95d832a287f932a8", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into maven-resolver\n\n# Conflicts:\n#\tcli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/BuildCommand.java\n#\tcli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/cmd/RunCommand.java", "committedDate": "2020-06-30T10:02:42Z", "type": "commit"}, {"oid": "1561c2b419d7d681ecb170dd1652bfcad9765f6b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1561c2b419d7d681ecb170dd1652bfcad9765f6b", "message": "Fix clean command test", "committedDate": "2020-07-01T05:30:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODE2ODcxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23819#discussion_r448168717", "bodyText": "The directories should point to balo and caches here right?", "author": "IrushiL", "createdAt": "2020-07-01T07:26:58Z", "path": "cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java", "diffHunk": "@@ -532,8 +532,16 @@ public void testCleanCommand() {\n         CleanCommand cleanCommand = new CleanCommand(Paths.get(System.getProperty(\"user.dir\")), false);\n         new CommandLine(cleanCommand).parse(\"--sourceroot\", this.testResources.resolve(\"valid-project\").toString());\n         cleanCommand.execute();\n-        Path target = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME);\n-        Assert.assertFalse(Files.exists(target), \"Check if target directory is deleted\");\n+        Path bin = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n+                + File.separator + ProjectDirConstants.BIN_DIR_NAME);\n+        Path balo = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n+                + File.separator + ProjectDirConstants.BIN_DIR_NAME);\n+        Path caches = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n+                + File.separator + ProjectDirConstants.BIN_DIR_NAME);", "originalCommit": "1561c2b419d7d681ecb170dd1652bfcad9765f6b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c08afec504d63b8edea7d4c712a240d7f64dee42", "chunk": "diff --git a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\nindex 42e43b007ae..3e51adfccab 100644\n--- a/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n+++ b/cli/ballerina-packerina/src/test/java/org/ballerinalang/packerina/cmd/BuildCommandTest.java\n\n@@ -535,9 +535,9 @@ public class BuildCommandTest extends CommandTest {\n         Path bin = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n                 + File.separator + ProjectDirConstants.BIN_DIR_NAME);\n         Path balo = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n-                + File.separator + ProjectDirConstants.BIN_DIR_NAME);\n+                + File.separator + ProjectDirConstants.TARGET_BALO_DIRECTORY);\n         Path caches = this.testResources.resolve(\"valid-project\").resolve(ProjectDirConstants.TARGET_DIR_NAME\n-                + File.separator + ProjectDirConstants.BIN_DIR_NAME);\n+                + File.separator + ProjectDirConstants.CACHES_DIR_NAME);\n \n         Assert.assertFalse(Files.exists(bin), \"Check if bin directory is deleted\");\n         Assert.assertFalse(Files.exists(balo), \"Check if balo directory is deleted\");\n"}}, {"oid": "c08afec504d63b8edea7d4c712a240d7f64dee42", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c08afec504d63b8edea7d4c712a240d7f64dee42", "message": "Fix clean target directory names", "committedDate": "2020-07-01T11:10:14Z", "type": "commit"}, {"oid": "c08afec504d63b8edea7d4c712a240d7f64dee42", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c08afec504d63b8edea7d4c712a240d7f64dee42", "message": "Fix clean target directory names", "committedDate": "2020-07-01T11:10:14Z", "type": "forcePushed"}]}