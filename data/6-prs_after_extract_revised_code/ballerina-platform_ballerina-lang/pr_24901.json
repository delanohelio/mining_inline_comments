{"pr_number": 24901, "pr_title": "Fix service debbug hit issue", "pr_createdAt": "2020-07-22T17:31:21Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901", "timeline": [{"oid": "282f00d5f9b7df09eba07656a43494c76913ed13", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/282f00d5f9b7df09eba07656a43494c76913ed13", "message": "Fix service debbug hit issue", "committedDate": "2020-07-22T17:27:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwODU4MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459208580", "bodyText": "@praveennadarajah Shall we add a comment explaining that in here we have handled the service files specifically and the reason behind that?", "author": "NipunaRanasinghe", "createdAt": "2020-07-23T04:29:09Z", "path": "misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java", "diffHunk": "@@ -86,4 +89,24 @@ public static boolean isBlank(String str) {\n         }\n         return srcNames;\n     }\n+\n+    /**\n+     * Get relative path when a bal file is inside a directory.\n+     *\n+     * @param sourcePath     source path\n+     * @param patternMatcher pattern matcher string\n+     * @param sourceName     source name\n+     * @param fileName       file name\n+     * @return relative path\n+     */\n+    public static String getDirectoryRelativePath(String sourcePath, String patternMatcher, String sourceName,\n+                                                  String fileName) {\n+        Pattern pattern = Pattern.compile(SERVICE_REGEX);\n+        Matcher matcher = pattern.matcher(patternMatcher);\n+        if (matcher.find()) {\n+            return sourcePath;\n+        } else {\n+            return sourcePath.replace(sourceName, fileName);\n+        }\n+    }", "originalCommit": "282f00d5f9b7df09eba07656a43494c76913ed13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxODAxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459218017", "bodyText": "Added comments.", "author": "praveennadarajah", "createdAt": "2020-07-23T05:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwODU4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyMzU0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459223543", "bodyText": "Looks good!", "author": "NipunaRanasinghe", "createdAt": "2020-07-23T05:37:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIwODU4MA=="}], "type": "inlineReview", "revised_code": {"commit": "c2111bc9bf3df2757349d02abc033245d23d39c1", "chunk": "diff --git a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\nindex 66a73424d67..b6dc18ed009 100644\n--- a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\n+++ b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\n\n@@ -101,8 +101,13 @@ public class PackageUtils {\n      */\n     public static String getDirectoryRelativePath(String sourcePath, String patternMatcher, String sourceName,\n                                                   String fileName) {\n+        // When a bal file is inside a directory, the source path is constructed appropriately for services.\n+        // But for non service bal files, [directory/file] path occurring twice in source path.\n+        // We are handling this by using service regex. If patternMatcher does not contain service regex,\n+        // appropriate adjustment is made for source path else not.\n         Pattern pattern = Pattern.compile(SERVICE_REGEX);\n         Matcher matcher = pattern.matcher(patternMatcher);\n+\n         if (matcher.find()) {\n             return sourcePath;\n         } else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMTI4OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459211288", "bodyText": "What do you mean by patternMatcher here? AFAIR this the reference location path of the source that we are rectifying, right? we can think of using an appropriate arg name instead.", "author": "NipunaRanasinghe", "createdAt": "2020-07-23T04:42:54Z", "path": "misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java", "diffHunk": "@@ -86,4 +89,24 @@ public static boolean isBlank(String str) {\n         }\n         return srcNames;\n     }\n+\n+    /**\n+     * Get relative path when a bal file is inside a directory.\n+     *\n+     * @param sourcePath     source path\n+     * @param patternMatcher pattern matcher string\n+     * @param sourceName     source name\n+     * @param fileName       file name\n+     * @return relative path\n+     */\n+    public static String getDirectoryRelativePath(String sourcePath, String patternMatcher, String sourceName,", "originalCommit": "282f00d5f9b7df09eba07656a43494c76913ed13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxOTkwMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459219903", "bodyText": "Yes, patternMatcher refers to \"reference location\" in one instance and \"reference type\" in another instance. I think renaming patternMatcher to \"reference\" would work fine. WDYT?", "author": "praveennadarajah", "createdAt": "2020-07-23T05:21:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMTI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyMzM2Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459223363", "bodyText": "+1 for reference/referencePath", "author": "NipunaRanasinghe", "createdAt": "2020-07-23T05:36:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMTI4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyNzcxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24901#discussion_r459227717", "bodyText": "Renamed to reference.", "author": "praveennadarajah", "createdAt": "2020-07-23T05:54:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIxMTI4OA=="}], "type": "inlineReview", "revised_code": {"commit": "c2111bc9bf3df2757349d02abc033245d23d39c1", "chunk": "diff --git a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\nindex 66a73424d67..b6dc18ed009 100644\n--- a/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\n+++ b/misc/debug-adapter/modules/debug-adapter-core/src/main/java/org/ballerinalang/debugadapter/utils/PackageUtils.java\n\n@@ -101,8 +101,13 @@ public class PackageUtils {\n      */\n     public static String getDirectoryRelativePath(String sourcePath, String patternMatcher, String sourceName,\n                                                   String fileName) {\n+        // When a bal file is inside a directory, the source path is constructed appropriately for services.\n+        // But for non service bal files, [directory/file] path occurring twice in source path.\n+        // We are handling this by using service regex. If patternMatcher does not contain service regex,\n+        // appropriate adjustment is made for source path else not.\n         Pattern pattern = Pattern.compile(SERVICE_REGEX);\n         Matcher matcher = pattern.matcher(patternMatcher);\n+\n         if (matcher.find()) {\n             return sourcePath;\n         } else {\n"}}, {"oid": "c2111bc9bf3df2757349d02abc033245d23d39c1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c2111bc9bf3df2757349d02abc033245d23d39c1", "message": "Add review changes", "committedDate": "2020-07-23T05:08:23Z", "type": "commit"}, {"oid": "75c35a7c7935cf0568cabea3d14bfd4c135beca3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/75c35a7c7935cf0568cabea3d14bfd4c135beca3", "message": "Add review changes", "committedDate": "2020-07-23T05:53:22Z", "type": "commit"}, {"oid": "c671c1c3fc7010faf48c7f67de0ff1df4208dbc2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c671c1c3fc7010faf48c7f67de0ff1df4208dbc2", "message": "Add minor changes", "committedDate": "2020-07-23T06:06:25Z", "type": "commit"}]}