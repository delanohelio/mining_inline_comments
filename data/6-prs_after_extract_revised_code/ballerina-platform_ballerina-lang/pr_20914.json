{"pr_number": 20914, "pr_title": "Fix error handling bug", "pr_createdAt": "2020-02-07T08:34:18Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20914", "timeline": [{"oid": "aa9643cc70f4dfed04a0b3ba3d78bc55af17a907", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa9643cc70f4dfed04a0b3ba3d78bc55af17a907", "message": "Fix error handling bug", "committedDate": "2020-02-07T08:29:39Z", "type": "commit"}, {"oid": "d6775c55789bdbb27d3bcc257d7a159a62416949", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d6775c55789bdbb27d3bcc257d7a159a62416949", "message": "Change the error message", "committedDate": "2020-02-07T08:32:15Z", "type": "commit"}, {"oid": "e2d9221c3a05ac967cd510b901651476352ce493", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2d9221c3a05ac967cd510b901651476352ce493", "message": "Merge https://github.com/ballerina-platform/ballerina-lang into jwt_error", "committedDate": "2020-02-07T08:39:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI3OTUxNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20914#discussion_r376279514", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        return CryptoUtils.createError(\"Key cannot be recovered by using given keyAlias [\" + keyAlias +\n          \n          \n            \n                                \"] and keyPassword [\" + keyPassword + \"]\");\n          \n          \n            \n                        return CryptoUtils.createError(\"Key cannot be recovered by using given key alias: [\" + keyAlias + \"] +\n          \n          \n            \n                                     \" and key password: [\" + keyPassword + \"]\");", "author": "ldclakmal", "createdAt": "2020-02-07T09:01:08Z", "path": "stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java", "diffHunk": "@@ -85,6 +78,13 @@ public static Object decodePrivateKey(Object keyStoreValue, String keyAlias, Str\n             throw CryptoUtils.createError(\"PKCS12 key store not found at: \" + keyStoreFile.getAbsoluteFile());\n         } catch (KeyStoreException | CertificateException | IOException e) {\n             throw CryptoUtils.createError(\"Unable to open keystore: \" + e.getMessage());\n+        } catch (NoSuchAlgorithmException e) {\n+            return CryptoUtils.createError(\"Algorithm for key recovery is not found: \" + e.getMessage());\n+        } catch (NullPointerException e) {\n+            return CryptoUtils.createError(\"Key cannot be recovered by using given keyAlias [\" + keyAlias +\n+                    \"] and keyPassword [\" + keyPassword + \"]\");", "originalCommit": "e2d9221c3a05ac967cd510b901651476352ce493", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d87a7e9679d3d475a1524ab2c13bdfae4b301117", "chunk": "diff --git a/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java b/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\nindex dbd9c613810..18cb4401d7d 100644\n--- a/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\n+++ b/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\n\n@@ -81,8 +81,8 @@ public class Decode {\n         } catch (NoSuchAlgorithmException e) {\n             return CryptoUtils.createError(\"Algorithm for key recovery is not found: \" + e.getMessage());\n         } catch (NullPointerException e) {\n-            return CryptoUtils.createError(\"Key cannot be recovered by using given keyAlias [\" + keyAlias +\n-                    \"] and keyPassword [\" + keyPassword + \"]\");\n+            return CryptoUtils.createError(\"Key cannot be recovered by using given key alias: [\" + keyAlias +\n+                         \"] and key password: [\" + keyPassword + \"]\");\n         } catch (UnrecoverableKeyException e) {\n             return CryptoUtils.createError(\"Key cannot be recovered: \" + e.getMessage());\n         }\n"}}, {"oid": "d87a7e9679d3d475a1524ab2c13bdfae4b301117", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d87a7e9679d3d475a1524ab2c13bdfae4b301117", "message": "Fix suggested changes", "committedDate": "2020-02-07T09:08:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNTM5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20914#discussion_r376535393", "bodyText": "If we consider security best practices, is it ok to have the keyPassword in error message and logs? @ldclakmal", "author": "anupama-pathirage", "createdAt": "2020-02-07T18:19:48Z", "path": "stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java", "diffHunk": "@@ -85,6 +78,13 @@ public static Object decodePrivateKey(Object keyStoreValue, String keyAlias, Str\n             throw CryptoUtils.createError(\"PKCS12 key store not found at: \" + keyStoreFile.getAbsoluteFile());\n         } catch (KeyStoreException | CertificateException | IOException e) {\n             throw CryptoUtils.createError(\"Unable to open keystore: \" + e.getMessage());\n+        } catch (NoSuchAlgorithmException e) {\n+            return CryptoUtils.createError(\"Algorithm for key recovery is not found: \" + e.getMessage());\n+        } catch (NullPointerException e) {\n+            return CryptoUtils.createError(\"Key cannot be recovered by using given key alias: [\" + keyAlias +\n+                         \"] and key password: [\" + keyPassword + \"]\");", "originalCommit": "d87a7e9679d3d475a1524ab2c13bdfae4b301117", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU3ODcxNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20914#discussion_r376578714", "bodyText": "Fixed.", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-02-07T19:55:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg2NDMyOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20914#discussion_r376864329", "bodyText": "If we consider security best practices, is it ok to have the keyPassword in error message and logs? @ldclakmal\n\nYes we cannot. Sorry, I missed it.", "author": "ldclakmal", "createdAt": "2020-02-10T04:28:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjUzNTM5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "76dd630d859c87b9d254d2e45b0bfd98a7e2f459", "chunk": "diff --git a/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java b/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\nindex 18cb4401d7d..092d1d05a46 100644\n--- a/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\n+++ b/stdlib/crypto/src/main/java/org/ballerinalang/stdlib/crypto/nativeimpl/Decode.java\n\n@@ -82,7 +82,7 @@ public class Decode {\n             return CryptoUtils.createError(\"Algorithm for key recovery is not found: \" + e.getMessage());\n         } catch (NullPointerException e) {\n             return CryptoUtils.createError(\"Key cannot be recovered by using given key alias: [\" + keyAlias +\n-                         \"] and key password: [\" + keyPassword + \"]\");\n+                         \"] and key password\");\n         } catch (UnrecoverableKeyException e) {\n             return CryptoUtils.createError(\"Key cannot be recovered: \" + e.getMessage());\n         }\n"}}, {"oid": "76dd630d859c87b9d254d2e45b0bfd98a7e2f459", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/76dd630d859c87b9d254d2e45b0bfd98a7e2f459", "message": "Fix the comment", "committedDate": "2020-02-07T19:54:09Z", "type": "commit"}]}