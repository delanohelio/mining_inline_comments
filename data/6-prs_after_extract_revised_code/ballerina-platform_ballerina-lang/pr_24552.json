{"pr_number": 24552, "pr_title": "Add support for nested transaction blocks", "pr_createdAt": "2020-07-02T07:03:06Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24552", "timeline": [{"oid": "ae22227a0f91a7e97025ba200cc8c57fbe6f28b9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ae22227a0f91a7e97025ba200cc8c57fbe6f28b9", "message": "Add nested transaction tests", "committedDate": "2020-06-30T10:52:18Z", "type": "commit"}, {"oid": "62c3ec8f6cbf39d1c8dba30d2a7fd9167b34f0d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/62c3ec8f6cbf39d1c8dba30d2a7fd9167b34f0d5", "message": "Add nested transaction support", "committedDate": "2020-06-30T10:53:21Z", "type": "commit"}, {"oid": "f4cc60c317139abda036fdca990d3a4050ad65ed", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f4cc60c317139abda036fdca990d3a4050ad65ed", "message": "Use transaction body scope in lamda func creation", "committedDate": "2020-06-30T17:04:12Z", "type": "commit"}, {"oid": "521a8103146f5142a98104836962fefdb48d6a7b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/521a8103146f5142a98104836962fefdb48d6a7b", "message": "Add nested transaction support to runtime", "committedDate": "2020-07-01T05:55:20Z", "type": "commit"}, {"oid": "651d2d6eb8d4f824cfdb7b6a4a8f076eac7e8f71", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/651d2d6eb8d4f824cfdb7b6a4a8f076eac7e8f71", "message": "Add tests for nested transactions", "committedDate": "2020-07-02T06:52:56Z", "type": "commit"}, {"oid": "e940111554cca29bb9979823c60a50cd49f16896", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e940111554cca29bb9979823c60a50cd49f16896", "message": "Disable failing tests", "committedDate": "2020-07-02T06:53:59Z", "type": "commit"}, {"oid": "85ccb9f9ea7aab4b917b6f1ae310162129371f2b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/85ccb9f9ea7aab4b917b6f1ae310162129371f2b", "message": "Fix typo", "committedDate": "2020-07-02T07:06:48Z", "type": "commit"}, {"oid": "571f7d9864671147b4b16d1fc7c78ac14fa69f47", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/571f7d9864671147b4b16d1fc7c78ac14fa69f47", "message": "Fix negative test case", "committedDate": "2020-07-02T08:13:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk2MjU4Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24552#discussion_r448962587", "bodyText": "@gimantha Shall we remove these commented line in next PR.", "author": "mohanvive", "createdAt": "2020-07-02T12:24:12Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CodeAnalyzer.java", "diffHunk": "@@ -506,21 +508,32 @@ public void visit(BLangTransaction transactionNode) {\n             return;\n         }\n         boolean previousWithinTxScope = this.withinTransactionScope;\n+        boolean previousWithinTrxBlock = this.withinTransactionBlock;\n         int previousCommitCount = this.commitCount;\n         int previousRollbackCount = this.rollbackCount;\n         boolean prevCommitRollbackAllowed = this.commitRollbackAllowed;\n         this.commitRollbackAllowed = true;\n         this.commitCount = 0;\n         this.rollbackCount = 0;\n+\n+        if (this.withinTransactionBlock) {\n+            this.innerTransactionBlock = transactionNode;\n+        }\n+\n         this.withinTransactionScope = true;\n-        this.loopWithintransactionCheckStack.push(false);\n-        this.returnWithintransactionCheckStack.push(false);\n-        this.doneWithintransactionCheckStack.push(false);\n+\n+        if (!this.withinTransactionBlock) {\n+            this.withinTransactionBlock = true;\n+        }\n+\n+        this.loopWithinTransactionCheckStack.push(false);\n+        this.returnWithinTransactionCheckStack.push(false);\n+        this.doneWithinTransactionCheckStack.push(false);\n         this.returnWithinLambdaWrappingCheckStack.push(false);\n         this.transactionCount++;\n-        if (this.transactionCount > 1) {\n-            this.dlog.error(transactionNode.pos, DiagnosticCode.NESTED_TRANSACTIONS_ARE_INVALID);\n-        }\n+//        if (this.transactionCount > 1) {", "originalCommit": "571f7d9864671147b4b16d1fc7c78ac14fa69f47", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}