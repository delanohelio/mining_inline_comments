{"pr_number": 25824, "pr_title": "Improve delayed type resolving for function type", "pr_createdAt": "2020-09-15T13:47:41Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25824", "timeline": [{"oid": "6045554f5b6f0cfa7cc5bb49ec6dcfb4da1c0745", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6045554f5b6f0cfa7cc5bb49ec6dcfb4da1c0745", "message": "Improve delayed type resolving for function type", "committedDate": "2020-09-15T13:43:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc4NTY4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25824#discussion_r488785685", "bodyText": "Is it correct that this error is getting logged? Only Context is an unknown type here, right? Even though there are errors when attempting to resolve FunctionEntry's members, it is not unknown?", "author": "MaryamZi", "createdAt": "2020-09-15T16:04:28Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/expressions/lambda/FunctionPointersNegativeTest.java", "diffHunk": "@@ -34,9 +34,11 @@\n     public void testFunctionPointerAsVariable() {\n         CompileResult result =\n                 BCompileUtil.compile(\"test-src/expressions/lambda/negative/fp-type-mismatch1-negative.bal\");\n-        Assert.assertEquals(result.getErrorCount(), 1);\n+        Assert.assertEquals(result.getErrorCount(), 3);\n         BAssertUtil.validateError(result, 0, \"incompatible types: expected 'function (string,int) returns \" +\n                 \"(boolean)', found 'function (string,float) returns (boolean)'\", 2, 53);\n+        BAssertUtil.validateError(result, 1, \"unknown type 'Context'\", 10, 29);\n+        BAssertUtil.validateError(result, 2, \"unknown type 'FunctionEntry'\", 12, 5);", "originalCommit": "6045554f5b6f0cfa7cc5bb49ec6dcfb4da1c0745", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyNDE1Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25824#discussion_r488824153", "bodyText": "This error message at index 2 is due to the behavior of tuple, the behavior added by this PR for function type is similar.\nSample for SLP preview 3:\n\ntype A object {\n    K i;\n\n    function __init(K i) {\n        self.i = i;\n    }\n};\n\ntype B [A, K];\n\ntype C B|A|D;\n\ntype D record {\n    K i;\n    B j;\n    C k;\n};\n\noutput:\nerror: .::main.bal:10:9: unknown type 'A'\nerror: .::main.bal:10:12: unknown type 'K'\nerror: .::main.bal:12:10: unknown type 'A'\nerror: .::main.bal:12:12: unknown type 'D'\nerror: .::main.bal:3:5: unknown type 'K'\nerror: .::main.bal:15:5: unknown type 'K'\nerror: .::main.bal:16:5: unknown type 'B'\nerror: .::main.bal:17:5: unknown type 'C'\nerror: .::main.bal:5:21: unknown type 'K'", "author": "rdhananjaya", "createdAt": "2020-09-15T17:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc4NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzNTkxNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25824#discussion_r488835916", "bodyText": "The output doesn't seem consistent right? An \"unknown type 'B'\" error is only logged for the usage as a field in D and not for the definition of C?\nFor the following sample, there is only one error.\ntype FunctionType record {\n    Context c;\n};\n\ntype FunctionEntry [FunctionType, typedesc<anydata>];\nmap<FunctionEntry> functions = { };\nerror: .::test.bal:2:5: unknown type 'Context'\nI guess we can go ahead with these changes for the time-being. But shall we create an issue to revisit this and make the errors consistent?", "author": "MaryamZi", "createdAt": "2020-09-15T17:23:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc4NTY4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTExOTkwMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25824#discussion_r489119903", "bodyText": "Issue created: #25831", "author": "rdhananjaya", "createdAt": "2020-09-16T02:13:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc4NTY4NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c045ec869c0d69f509c27d1d3c48ea56ff419fb5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c045ec869c0d69f509c27d1d3c48ea56ff419fb5", "message": "Merge branch 'master' of github.com:ballerina-platform/ballerina-lang into fix-function-type-type-resolving-issue", "committedDate": "2020-09-16T05:05:34Z", "type": "commit"}, {"oid": "afc41d2c2fec58ce6d4ae4a35064890c0ebcbe86", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/afc41d2c2fec58ce6d4ae4a35064890c0ebcbe86", "message": "Fix merge error", "committedDate": "2020-09-16T05:19:55Z", "type": "commit"}, {"oid": "cc79e33fc41fddb9a195094115c5d3cc3a59565e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cc79e33fc41fddb9a195094115c5d3cc3a59565e", "message": "Fix type error checking logic", "committedDate": "2020-09-16T07:26:10Z", "type": "commit"}, {"oid": "22d883907155af039f06c65ce0d20e433c7b6f56", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/22d883907155af039f06c65ce0d20e433c7b6f56", "message": "Fix failing lang-server test cases", "committedDate": "2020-09-16T07:48:04Z", "type": "commit"}, {"oid": "22d883907155af039f06c65ce0d20e433c7b6f56", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/22d883907155af039f06c65ce0d20e433c7b6f56", "message": "Fix failing lang-server test cases", "committedDate": "2020-09-16T07:48:04Z", "type": "forcePushed"}, {"oid": "0af97583ae34304736b17790d2845cfaad972ae9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0af97583ae34304736b17790d2845cfaad972ae9", "message": "Fixup unit test code", "committedDate": "2020-09-16T09:04:57Z", "type": "commit"}, {"oid": "0af97583ae34304736b17790d2845cfaad972ae9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0af97583ae34304736b17790d2845cfaad972ae9", "message": "Fixup unit test code", "committedDate": "2020-09-16T09:04:57Z", "type": "forcePushed"}]}