{"pr_number": 25979, "pr_title": "Fix the formatter cli issue of not detecting source changes", "pr_createdAt": "2020-09-21T10:58:26Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25979", "timeline": [{"oid": "0becd6dc67e2c2c56160cf0125b5dd1eeef3222a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0becd6dc67e2c2c56160cf0125b5dd1eeef3222a", "message": "Fix the formatter cli issue", "committedDate": "2020-09-21T10:56:19Z", "type": "commit"}, {"oid": "cdaeabfca9013cfea82c772021687d82303d63cb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cdaeabfca9013cfea82c772021687d82303d63cb", "message": "Fix checkstyle error", "committedDate": "2020-09-21T11:13:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk4MTY5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25979#discussion_r491981691", "bodyText": "Is it okay not to close the stream?", "author": "pramodya1994", "createdAt": "2020-09-21T11:51:04Z", "path": "misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java", "diffHunk": "@@ -311,9 +311,9 @@ private static boolean isBallerinaProject(Path path) {\n     private static void writeFile(String filePath, String content) throws IOException {\n         OutputStreamWriter fileWriter = null;\n         try {\n-            try (FileOutputStream fileStream = new FileOutputStream(new File(filePath))) {\n-                fileWriter = new OutputStreamWriter(fileStream, StandardCharsets.UTF_8);\n-            }\n+            File newFile = new File(filePath);\n+            FileOutputStream fileStream = new FileOutputStream(newFile);", "originalCommit": "cdaeabfca9013cfea82c772021687d82303d63cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAwMzEzMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25979#discussion_r492003132", "bodyText": "Done. There was an issue with try-with-resources closing the output stream before writing to the file. Due to that I separately closed both the output stream and the file writer inside the finally block.", "author": "IrushiL", "createdAt": "2020-09-21T12:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk4MTY5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "15eda282f2ed5098bd9be6ff054cc669c07c62be", "chunk": "diff --git a/misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java b/misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java\nindex 9d58281363c..ea3c976ae99 100644\n--- a/misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java\n+++ b/misc/formatter/modules/formatter-cli/src/main/java/org/ballerinalang/formatter/cli/FormatUtil.java\n\n@@ -310,15 +310,19 @@ class FormatUtil {\n      */\n     private static void writeFile(String filePath, String content) throws IOException {\n         OutputStreamWriter fileWriter = null;\n+        FileOutputStream fileStream = null;\n         try {\n             File newFile = new File(filePath);\n-            FileOutputStream fileStream = new FileOutputStream(newFile);\n+            fileStream = new FileOutputStream(newFile);\n             fileWriter = new OutputStreamWriter(fileStream, StandardCharsets.UTF_8);\n             fileWriter.write(content);\n         } finally {\n             if (fileWriter != null) {\n                 fileWriter.close();\n             }\n+            if (fileStream != null) {\n+                fileStream.close();\n+            }\n         }\n     }\n \n"}}, {"oid": "15eda282f2ed5098bd9be6ff054cc669c07c62be", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/15eda282f2ed5098bd9be6ff054cc669c07c62be", "message": "Fix a review comment", "committedDate": "2020-09-21T12:24:00Z", "type": "commit"}]}