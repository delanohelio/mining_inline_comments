{"pr_number": 26293, "pr_title": "Add package level compilation to ProjectAPI", "pr_createdAt": "2020-10-09T09:27:21Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293", "timeline": [{"oid": "76885beb33f19685387cf69d2717ada7b24f8501", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/76885beb33f19685387cf69d2717ada7b24f8501", "message": "Use correct packageId for module load response", "committedDate": "2020-10-09T06:43:23Z", "type": "commit"}, {"oid": "e60da94f067304bdf867e482ff3c370cee92e1ff", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e60da94f067304bdf867e482ff3c370cee92e1ff", "message": "Add package level compilation to PorjectAPI", "committedDate": "2020-10-09T06:44:57Z", "type": "commit"}, {"oid": "ff244a5ea4667a452f229c2294b74f2f0e43d463", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ff244a5ea4667a452f229c2294b74f2f0e43d463", "message": "Include transitive dependencies for module dependencies", "committedDate": "2020-10-09T09:09:07Z", "type": "commit"}, {"oid": "782746f62c6f97552413c74f20b727d8ddf564b6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/782746f62c6f97552413c74f20b727d8ddf564b6", "message": "Add test to verify package compilation", "committedDate": "2020-10-09T09:09:45Z", "type": "commit"}, {"oid": "6b1017574c8e1f3e10805b50682066e3a480227e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6b1017574c8e1f3e10805b50682066e3a480227e", "message": "Merge with remote", "committedDate": "2020-10-09T09:15:05Z", "type": "commit"}, {"oid": "9024e2c01a78a158dacb70eea7576cbb19ef114d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9024e2c01a78a158dacb70eea7576cbb19ef114d", "message": "Include transitive dependencies for module dependencies", "committedDate": "2020-10-09T09:22:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzNTg5NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293#discussion_r502335895", "bodyText": "moduleContext hides the class level field defined in L41. Can we use other name for this?", "author": "pramodya1994", "createdAt": "2020-10-09T10:28:37Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/build/ModuleCompilation.java", "diffHunk": "@@ -66,9 +66,21 @@\n         return new DependencyGraph<>(dependencyIdMap);\n     }\n \n-    void addModuleDependencies(ModuleId moduleId, Map<ModuleId, Set<ModuleId>> dependencyIdMap) {\n+    private void addModuleDependencies(ModuleId moduleId, Map<ModuleId, Set<ModuleId>> dependencyIdMap) {\n         Package pkg = packageResolver.getPackage(moduleId.packageId());\n         Collection<ModuleId> directDependencies = pkg.moduleDependencyGraph().getDirectDependencies(moduleId);\n+\n+        ModuleContext moduleContext = pkg.packageContext().moduleContext(moduleId);", "originalCommit": "b0ebc6185a51aa808d112e1649e9a94ac2cb534a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzOTA3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293#discussion_r502339072", "bodyText": "I was on it.", "author": "Kishanthan", "createdAt": "2020-10-09T10:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzNTg5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "edd05e26187f1ab55ca52110c2118e5151d51bdb", "chunk": "diff --git a/compiler/ballerina-lang/src/main/java/io/ballerina/build/ModuleCompilation.java b/compiler/ballerina-lang/src/main/java/io/ballerina/build/ModuleCompilation.java\nindex d26d134b9dc..5c8ee4e3100 100644\n--- a/compiler/ballerina-lang/src/main/java/io/ballerina/build/ModuleCompilation.java\n+++ b/compiler/ballerina-lang/src/main/java/io/ballerina/build/ModuleCompilation.java\n\n@@ -68,7 +70,8 @@ public class ModuleCompilation {\n \n     private void addModuleDependencies(ModuleId moduleId, Map<ModuleId, Set<ModuleId>> dependencyIdMap) {\n         Package pkg = packageResolver.getPackage(moduleId.packageId());\n-        Collection<ModuleId> directDependencies = pkg.moduleDependencyGraph().getDirectDependencies(moduleId);\n+        Collection<ModuleId> directDependencies = new HashSet<>(pkg.moduleDependencyGraph().\n+                getDirectDependencies(moduleId));\n \n         ModuleContext moduleContext = pkg.packageContext().moduleContext(moduleId);\n         for (ModuleDependency moduleDependency : moduleContext.dependencies()) {\n"}}, {"oid": "edd05e26187f1ab55ca52110c2118e5151d51bdb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/edd05e26187f1ab55ca52110c2118e5151d51bdb", "message": "Add package level compilation to ProjectAPI", "committedDate": "2020-10-09T10:29:08Z", "type": "forcePushed"}, {"oid": "2791bc671d8896ec2860023d85303b92aa4fd4c1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2791bc671d8896ec2860023d85303b92aa4fd4c1", "message": "Add package level compilation to ProjectAPI", "committedDate": "2020-10-09T10:31:49Z", "type": "forcePushed"}, {"oid": "daad2e90982019a66eb86e841f2f1c0d759719bb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/daad2e90982019a66eb86e841f2f1c0d759719bb", "message": "Add package level compilation to ProjectAPI", "committedDate": "2020-10-09T10:33:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM0NDE0NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293#discussion_r502344144", "bodyText": "@sameerajayasoma , using currentPkg.packageId() seems to be a bug here which was the issue for package dependencies becoming empty (which we saw during the debug session)", "author": "Kishanthan", "createdAt": "2020-10-09T10:46:07Z", "path": "project-api/ballerina-projects/src/main/java/io/ballerina/projects/env/CustomPackageResolver.java", "diffHunk": "@@ -65,7 +65,8 @@ public CustomPackageResolver(Project project) {\n                 // TODO load the module from the custom_project_dir\n                 module = loadFromCustomProjectDir(modLoadRequest);\n             }\n-            modLoadResponses.add(new ModuleLoadResponse(currentPkg.packageId(), module.moduleId(), modLoadRequest));\n+            modLoadResponses.add(new ModuleLoadResponse(module.packageInstance().packageId(), module.moduleId(),", "originalCommit": "daad2e90982019a66eb86e841f2f1c0d759719bb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM4MjE3Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293#discussion_r502382172", "bodyText": "I think we should get packageName from the Ballerina.toml file. At some places, we are taking the project directory name as the default package name. I think this creates errors.", "author": "pramodya1994", "createdAt": "2020-10-09T12:08:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM0NDE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxOTY2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26293#discussion_r502419660", "bodyText": "AFAIR, here we are only considering the PackageId.", "author": "sameerajayasoma", "createdAt": "2020-10-09T13:16:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjM0NDE0NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "90b2e8bd5ad285882e104f6992a12fc191155fbb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90b2e8bd5ad285882e104f6992a12fc191155fbb", "message": "Add package level compilation to ProjectAPI", "committedDate": "2020-10-09T10:51:43Z", "type": "commit"}, {"oid": "90b2e8bd5ad285882e104f6992a12fc191155fbb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/90b2e8bd5ad285882e104f6992a12fc191155fbb", "message": "Add package level compilation to ProjectAPI", "committedDate": "2020-10-09T10:51:43Z", "type": "forcePushed"}]}