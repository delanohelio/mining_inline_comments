{"pr_number": 20657, "pr_title": "[NATS-Streaming] Fix issue in acknowledging messages in auto-ack mode", "pr_createdAt": "2020-01-17T09:04:59Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20657", "timeline": [{"oid": "1d413bccb7d76cd5fbf0a2a34c8d8c01a59ca9ef", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1d413bccb7d76cd5fbf0a2a34c8d8c01a59ca9ef", "message": "Fix issue in acknowledging messages in auto-ack mode\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/20516", "committedDate": "2020-01-17T08:48:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg0OTgxNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20657#discussion_r367849816", "bodyText": "Shall we make the error message like \"Invalid operation, manual acknowledge is not supported in auto ACK mode.\"", "author": "daneshk", "createdAt": "2020-01-17T09:49:41Z", "path": "stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/message/Ack.java", "diffHunk": "@@ -31,8 +31,14 @@\n \n     public static Object externAck(ObjectValue message) {\n         Message streamingMessage = (Message) message.getNativeData(Constants.NATS_STREAMING_MSG);\n+        boolean manualAck = (Boolean) message.getNativeData(Constants.NATS_STREAMING_MANUAL_ACK);\n         try {\n-            streamingMessage.ack();\n+            if (manualAck) {\n+                streamingMessage.ack();\n+            } else {\n+                return BallerinaErrors.createError(Constants.NATS_ERROR_CODE, \"error in trying to manually\" +\n+                        \" acknowledge the message in auto ack mode.\");", "originalCommit": "1d413bccb7d76cd5fbf0a2a34c8d8c01a59ca9ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzkwODg0OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20657#discussion_r367908848", "bodyText": "Agreed. Sounds better.", "author": "aashikam", "createdAt": "2020-01-17T12:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg0OTgxNg=="}], "type": "inlineReview", "revised_code": {"commit": "93e09a2a52bab3983d933f775949b17b0ab21b01", "chunk": "diff --git a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/message/Ack.java b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/message/Ack.java\nindex c7541a8bc3d..f1fd7fa3f6d 100644\n--- a/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/message/Ack.java\n+++ b/stdlib/messaging/nats/src/main/java/org/ballerinalang/nats/streaming/message/Ack.java\n\n@@ -36,8 +36,8 @@ public class Ack {\n             if (manualAck) {\n                 streamingMessage.ack();\n             } else {\n-                return BallerinaErrors.createError(Constants.NATS_ERROR_CODE, \"error in trying to manually\" +\n-                        \" acknowledge the message in auto ack mode.\");\n+                return BallerinaErrors.createError(Constants.NATS_ERROR_CODE, \"Invalid operation, \" +\n+                        \"manual acknowledgement is not supported in auto ACK mode.\");\n             }\n             return null;\n         } catch (IOException e) {\n"}}, {"oid": "93e09a2a52bab3983d933f775949b17b0ab21b01", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/93e09a2a52bab3983d933f775949b17b0ab21b01", "message": "Add changes from code review", "committedDate": "2020-01-17T12:22:09Z", "type": "commit"}, {"oid": "0ab9e1ad5d17d2f4098554afd75fdd1442eac5aa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0ab9e1ad5d17d2f4098554afd75fdd1442eac5aa", "message": "Fix formatting issue", "committedDate": "2020-01-17T13:28:27Z", "type": "commit"}, {"oid": "81194ae5adc0bb9d40540b455dcb9a05c81494ec", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/81194ae5adc0bb9d40540b455dcb9a05c81494ec", "message": "Merge branch 'ballerina-1.1.x' of https://github.com/ballerina-platform/ballerina-lang into nats-issue-1.1.x", "committedDate": "2020-01-20T01:16:18Z", "type": "commit"}]}