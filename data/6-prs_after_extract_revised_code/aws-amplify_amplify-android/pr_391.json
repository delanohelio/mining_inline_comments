{"pr_number": 391, "pr_title": "Use File instead of String input parameters", "pr_createdAt": "2020-04-22T03:59:35Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/391", "timeline": [{"oid": "16d04062281b99c45f366907136d0c00b892bd28", "url": "https://github.com/aws-amplify/amplify-android/commit/16d04062281b99c45f366907136d0c00b892bd28", "message": "Use File instead of String input parameters\n\nCurrently downloadFile and uploadFile expect a String with the local\npath for the source file and destination file respectively. To move us\ncloser to iOS and to simplify the iOS, use a File instead as the input\nparameter.", "committedDate": "2020-04-22T03:37:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2NTIwMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412665203", "bodyText": "Can we kill the declaration on L96, now? Is String local still used?", "author": "jamesonwilliams", "createdAt": "2020-04-22T04:42:42Z", "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageDownloadTest.java", "diffHunk": "@@ -101,14 +101,12 @@ public static void setUpOnce() throws Exception {\n         // Upload large test file\n         largeFile = new RandomTempFile(LARGE_FILE_NAME, LARGE_FILE_SIZE);\n         key = LARGE_FILE_NAME;\n-        local = largeFile.getAbsolutePath();", "originalCommit": "16d04062281b99c45f366907136d0c00b892bd28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkyMDg5Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412920897", "bodyText": "It isn't, I missed it. TIL: Analyze -> Run Inspection By Name... -> Unused Declarations!", "author": "jpignata", "createdAt": "2020-04-22T12:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2NTIwMw=="}], "type": "inlineReview", "revised_code": {"commit": "54ca1468bfab20cd3172c87da147dc036b515bc4", "chunk": "diff --git a/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageDownloadTest.java b/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageDownloadTest.java\nindex e777528d..8d9be3c2 100644\n--- a/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageDownloadTest.java\n+++ b/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageDownloadTest.java\n\n@@ -93,7 +93,6 @@ public final class AWSS3StorageDownloadTest {\n \n         // Upload to PUBLIC for consistency\n         String key;\n-        String local;\n         StorageUploadFileOptions uploadOptions = StorageUploadFileOptions.builder()\n                 .accessLevel(TESTING_ACCESS_LEVEL)\n                 .build();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2NzQ4Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412667482", "bodyText": "This existed before this PR -- but just noting it since I saw it:\nfileName is a weird name for the first argument, in these various calls to SynchronousStorage#uploadFile(String, File, StorageOptions). I think it should be named remoteKey, right?", "author": "jamesonwilliams", "createdAt": "2020-04-22T04:50:05Z", "path": "aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadAccessLevelTest.java", "diffHunk": "@@ -88,9 +88,8 @@ public void setUp() throws Exception {\n         mobileClient.signOut();\n \n         // Create a new file to upload\n-        File fileToUpload = new RandomTempFile(UPLOAD_SIZE);\n-        fileName = fileToUpload.getName();\n-        filePath = fileToUpload.getPath();\n+        uploadFile = new RandomTempFile(UPLOAD_SIZE);\n+        fileName = uploadFile.getName();", "originalCommit": "16d04062281b99c45f366907136d0c00b892bd28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzMDU1Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412930556", "bodyText": "Cool. I thought perhaps there was a reason for this difference I was missing. Renamed.", "author": "jpignata", "createdAt": "2020-04-22T12:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2NzQ4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "54ca1468bfab20cd3172c87da147dc036b515bc4", "chunk": "diff --git a/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadAccessLevelTest.java b/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadAccessLevelTest.java\nindex 4f165515..8142cf55 100644\n--- a/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadAccessLevelTest.java\n+++ b/aws-storage-s3/src/androidTest/java/com/amplifyframework/storage/s3/AWSS3StorageUploadAccessLevelTest.java\n\n@@ -89,7 +89,7 @@ public final class AWSS3StorageUploadAccessLevelTest {\n \n         // Create a new file to upload\n         uploadFile = new RandomTempFile(UPLOAD_SIZE);\n-        fileName = uploadFile.getName();\n+        remoteKey = uploadFile.getName();\n \n         // Override this per test-case\n         uploadOptions = StorageUploadFileOptions.defaultInstance();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2OTEzMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412669131", "bodyText": "We have a utility in the code base called RandomTempFile, I think that could be a good replacement to these File.createTemptFile(..., ...) calls:\n\nIt can throw some kind of a E extends RuntimeException, which would prevent the need for us to snake this IOException through, and onto every @Test;\nInstead of passing \"data\" every time, we could let the RandomTempFile populate some random string data.", "author": "jamesonwilliams", "createdAt": "2020-04-22T04:55:17Z", "path": "aws-storage-s3/src/test/java/com/amplifyframework/storage/s3/StorageComponentTest.java", "diffHunk": "@@ -144,11 +145,12 @@ public void testGenerateUrlGetsPresignedUrl() throws StorageException {\n      * invokes the registered AWSS3StoragePlugin instance and returns a\n      * {@link StorageDownloadFileResult} with correct file path.\n      * @throws StorageException when an error is encountered while downloading\n+     * @throws IOException when a temporary file cannot be created\n      */\n     @Test\n-    public void testDownloadToFileGetsFile() throws StorageException {\n+    public void testDownloadToFileGetsFile() throws StorageException, IOException {\n         final String fromRemoteKey = RandomString.string();\n-        final String toLocalPath = RandomString.string();\n+        final File toLocalFile = File.createTempFile(\"download\", \"data\");", "originalCommit": "16d04062281b99c45f366907136d0c00b892bd28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxOTQ0MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412919441", "bodyText": "The second parameter is actually a suffix, or file extension, so it's just creating an empty text file called {prefix}.{suffix}. RandomTempFile sounds better for upload tests, however for download tests we'd still like an empty file. (Narrator: Which he could accommodate using the default constructor on RandomTempFile.)", "author": "jpignata", "createdAt": "2020-04-22T12:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2OTEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkzNTM5NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/391#discussion_r412935395", "bodyText": "RandomTempFile also can throw an IOException, so instead I left the throws declaration on each @Test if it was the only one, if not I up-scoped to Exception. Let me know if you had something else in mind.", "author": "jpignata", "createdAt": "2020-04-22T12:25:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY2OTEzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "54ca1468bfab20cd3172c87da147dc036b515bc4", "chunk": "diff --git a/aws-storage-s3/src/test/java/com/amplifyframework/storage/s3/StorageComponentTest.java b/aws-storage-s3/src/test/java/com/amplifyframework/storage/s3/StorageComponentTest.java\nindex 25476fa8..0d972240 100644\n--- a/aws-storage-s3/src/test/java/com/amplifyframework/storage/s3/StorageComponentTest.java\n+++ b/aws-storage-s3/src/test/java/com/amplifyframework/storage/s3/StorageComponentTest.java\n\n@@ -144,13 +148,13 @@ public final class StorageComponentTest {\n      * Test that calling download file method from Storage category correctly\n      * invokes the registered AWSS3StoragePlugin instance and returns a\n      * {@link StorageDownloadFileResult} with correct file path.\n-     * @throws StorageException when an error is encountered while downloading\n-     * @throws IOException when a temporary file cannot be created\n+     *\n+     * @throws Exception when an error is encountered while downloading\n      */\n     @Test\n-    public void testDownloadToFileGetsFile() throws StorageException, IOException {\n+    public void testDownloadToFileGetsFile() throws Exception {\n         final String fromRemoteKey = RandomString.string();\n-        final File toLocalFile = File.createTempFile(\"download\", \"data\");\n+        final File toLocalFile = new RandomTempFile();\n \n         // Since we use a mock StorageService, it will return a null\n         // result by default. We need a non-null transfer observer.\n"}}, {"oid": "54ca1468bfab20cd3172c87da147dc036b515bc4", "url": "https://github.com/aws-amplify/amplify-android/commit/54ca1468bfab20cd3172c87da147dc036b515bc4", "message": "Addressing PR feedback", "committedDate": "2020-04-22T13:10:07Z", "type": "commit"}]}