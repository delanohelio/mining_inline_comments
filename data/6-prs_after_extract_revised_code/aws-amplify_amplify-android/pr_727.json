{"pr_number": 727, "pr_title": "Search the logs on the developer menu", "pr_createdAt": "2020-08-14T15:24:50Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/727", "timeline": [{"oid": "0897c71144a67e50dcb278c6001218573b6a7b7d", "url": "https://github.com/aws-amplify/amplify-android/commit/0897c71144a67e50dcb278c6001218573b6a7b7d", "message": "added search functionality to dev menu logs screen", "committedDate": "2020-08-12T22:10:59Z", "type": "commit"}, {"oid": "769701585e63ba69d5ac82fc2e582c48e1e54b29", "url": "https://github.com/aws-amplify/amplify-android/commit/769701585e63ba69d5ac82fc2e582c48e1e54b29", "message": "added animation for displaying logs search results", "committedDate": "2020-08-13T17:00:22Z", "type": "commit"}, {"oid": "c6518d701f0a553f7b2147163a5da8f922846016", "url": "https://github.com/aws-amplify/amplify-android/commit/c6518d701f0a553f7b2147163a5da8f922846016", "message": "factored out search logs functionality into a method and hide soft input keyboard when searching logs", "committedDate": "2020-08-13T19:04:15Z", "type": "commit"}, {"oid": "a92792df867dc1db38c371532ab53e218f6d9322", "url": "https://github.com/aws-amplify/amplify-android/commit/a92792df867dc1db38c371532ab53e218f6d9322", "message": "removed code to hide soft keyboard when searching logs", "committedDate": "2020-08-14T15:18:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc4NDY2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470784661", "bodyText": "Could you use a SearchView instead of an EditText here?  I believe it is basically just a wrapper around an EditText, but you get a lot of additional search functionality for free, like:\n\na search icon on the left side\na search button on the keyboard, which I believe is the more standard way for search to work, instead of having a button on the right side.\nIf your Android device has a hardware Search button, it'll actually work.", "author": "richardmcclellan", "createdAt": "2020-08-14T18:19:13Z", "path": "core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java", "diffHunk": "@@ -39,10 +46,23 @@ public DevMenuLogsFragment() { }\n     public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                              Bundle savedInstanceState) {\n         // Inflate the layout for this fragment\n-        View logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n+        logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n         // Display the logs (if any).\n-        TextView logsText = logsView.findViewById(R.id.logs_text);\n-        logsText.setText(DeveloperMenu.singletonInstance(getContext()).getLogs());\n+        developerMenu = DeveloperMenu.singletonInstance(getContext());\n+        logsText = logsView.findViewById(R.id.logs_text);\n+        logsText.setText(developerMenu.getLogs());\n+        // Search the logs when the search button is pressed.\n+        logsView.findViewById(R.id.search_logs_button).setOnClickListener(view -> searchLogs());\n         return logsView;\n     }\n+\n+    /**\n+     * Display the logs (if any) that contain the search query.\n+     */\n+    private void searchLogs() {\n+        EditText searchText = logsView.findViewById(R.id.search_logs_field);", "originalCommit": "a92792df867dc1db38c371532ab53e218f6d9322", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgzMTU2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470831561", "bodyText": "I initially tried to use a SearchView instead of EditText, but the search icon that should be displayed to the left of the SearchView was not visible. The XML attribute used to set this icon is only available in API level 21+, yet Android still allocates space for the icon to the left of where the user would enter a query. Setting margin and padding to 0 does not remove the extra space for the icon. The result is shown in the picture below. I think having the extra space to the left of the SearchView looks strange and I could not find a way to either align the SearchView to the left or have an equal amount of space on either side of the SearchView.", "author": "eeatonaws", "createdAt": "2020-08-14T19:40:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc4NDY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg0NDU2Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470844566", "bodyText": "Can you fix this by using androidx.appcompat.widget.SearchView instead of android.widget.SearchView?", "author": "richardmcclellan", "createdAt": "2020-08-14T20:12:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc4NDY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1ODE5Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470858197", "bodyText": "Yes, although it will require making Theme.AppCompat the parent style for the activity, which changes the styling of many components on the developer menu, but I should be able to fix the styling issues.\nEdit: The extra padding to the left of the SearchView can be removed using negative padding.", "author": "eeatonaws", "createdAt": "2020-08-14T20:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc4NDY2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "f4f9c6b62ac2ca270f4bbdc9b04e4ad6d989113f", "chunk": "diff --git a/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java b/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\nindex ca64a232..16c0ed37 100644\n--- a/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\n+++ b/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\n\n@@ -46,23 +39,26 @@ public final class DevMenuLogsFragment extends Fragment {\n     public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                              Bundle savedInstanceState) {\n         // Inflate the layout for this fragment\n-        logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n+        View logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n         // Display the logs (if any).\n-        developerMenu = DeveloperMenu.singletonInstance(getContext());\n-        logsText = logsView.findViewById(R.id.logs_text);\n+        DeveloperMenu developerMenu = DeveloperMenu.singletonInstance(getContext());\n+        TextView logsText = logsView.findViewById(R.id.logs_text);\n         logsText.setText(developerMenu.getLogs());\n         // Search the logs when the search button is pressed.\n-        logsView.findViewById(R.id.search_logs_button).setOnClickListener(view -> searchLogs());\n-        return logsView;\n-    }\n+        SearchView searchLogsView = logsView.findViewById(R.id.search_logs_field);\n+        searchLogsView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {\n+            @Override\n+            public boolean onQueryTextSubmit(String searchText) {\n+                return false;\n+            }\n \n-    /**\n-     * Display the logs (if any) that contain the search query.\n-     */\n-    private void searchLogs() {\n-        EditText searchText = logsView.findViewById(R.id.search_logs_field);\n-        searchText.clearFocus();\n-        logsText.setText(getString(R.string.placeholder_logs));\n-        logsText.setText(developerMenu.getFilteredLogs(searchText.getText().toString()));\n+            @Override\n+            public boolean onQueryTextChange(String searchText) {\n+                logsText.setText(R.string.placeholder_logs);\n+                logsText.setText(developerMenu.getFilteredLogs(searchText));\n+                return true;\n+            }\n+        });\n+        return logsView;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc5MTE1NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470791154", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (searchText == null || searchText.isEmpty()) {\n          \n          \n            \n                    if (Empty.check(searchText)) {", "author": "richardmcclellan", "createdAt": "2020-08-14T18:26:51Z", "path": "core/src/main/java/com/amplifyframework/devmenu/DeveloperMenu.java", "diffHunk": "@@ -129,6 +129,32 @@ public String getLogs() {\n         }\n     }\n \n+    /**\n+     * Returns a String representation of the stored logs that contain the given\n+     * String, or all logs if the given String is null or the empty string.\n+     * @param searchText the text to search for in the logs\n+     * @return the stored logs as a String.\n+     */\n+    public String getFilteredLogs(String searchText) {\n+        if (searchText == null || searchText.isEmpty()) {", "originalCommit": "a92792df867dc1db38c371532ab53e218f6d9322", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4f9c6b62ac2ca270f4bbdc9b04e4ad6d989113f", "chunk": "diff --git a/core/src/main/java/com/amplifyframework/devmenu/DeveloperMenu.java b/core/src/main/java/com/amplifyframework/devmenu/DeveloperMenu.java\nindex 2a6c23f4..ed05bcf2 100644\n--- a/core/src/main/java/com/amplifyframework/devmenu/DeveloperMenu.java\n+++ b/core/src/main/java/com/amplifyframework/devmenu/DeveloperMenu.java\n\n@@ -136,7 +137,7 @@ public final class DeveloperMenu implements ShakeDetector.Listener {\n      * @return the stored logs as a String.\n      */\n     public String getFilteredLogs(String searchText) {\n-        if (searchText == null || searchText.isEmpty()) {\n+        if (Empty.check(searchText)) {\n             return getLogs();\n         }\n         List<LogEntry> logs = loggingPlugin.getLogs();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc5NTUwMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/727#discussion_r470795501", "bodyText": "Instead of having an explicit button, could you just display results in real time, updating them each time a new character is entered in the search bar?    If you use a SearchView, you could implement this with the onQueryTextChanged() method in OnQueryTextListener.", "author": "richardmcclellan", "createdAt": "2020-08-14T18:31:58Z", "path": "core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java", "diffHunk": "@@ -39,10 +46,23 @@ public DevMenuLogsFragment() { }\n     public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                              Bundle savedInstanceState) {\n         // Inflate the layout for this fragment\n-        View logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n+        logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n         // Display the logs (if any).\n-        TextView logsText = logsView.findViewById(R.id.logs_text);\n-        logsText.setText(DeveloperMenu.singletonInstance(getContext()).getLogs());\n+        developerMenu = DeveloperMenu.singletonInstance(getContext());\n+        logsText = logsView.findViewById(R.id.logs_text);\n+        logsText.setText(developerMenu.getLogs());\n+        // Search the logs when the search button is pressed.\n+        logsView.findViewById(R.id.search_logs_button).setOnClickListener(view -> searchLogs());", "originalCommit": "a92792df867dc1db38c371532ab53e218f6d9322", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4f9c6b62ac2ca270f4bbdc9b04e4ad6d989113f", "chunk": "diff --git a/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java b/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\nindex ca64a232..16c0ed37 100644\n--- a/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\n+++ b/core/src/main/java/com/amplifyframework/devmenu/DevMenuLogsFragment.java\n\n@@ -46,23 +39,26 @@ public final class DevMenuLogsFragment extends Fragment {\n     public View onCreateView(LayoutInflater inflater, ViewGroup container,\n                              Bundle savedInstanceState) {\n         // Inflate the layout for this fragment\n-        logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n+        View logsView = inflater.inflate(R.layout.dev_menu_fragment_logs, container, false);\n         // Display the logs (if any).\n-        developerMenu = DeveloperMenu.singletonInstance(getContext());\n-        logsText = logsView.findViewById(R.id.logs_text);\n+        DeveloperMenu developerMenu = DeveloperMenu.singletonInstance(getContext());\n+        TextView logsText = logsView.findViewById(R.id.logs_text);\n         logsText.setText(developerMenu.getLogs());\n         // Search the logs when the search button is pressed.\n-        logsView.findViewById(R.id.search_logs_button).setOnClickListener(view -> searchLogs());\n-        return logsView;\n-    }\n+        SearchView searchLogsView = logsView.findViewById(R.id.search_logs_field);\n+        searchLogsView.setOnQueryTextListener(new SearchView.OnQueryTextListener() {\n+            @Override\n+            public boolean onQueryTextSubmit(String searchText) {\n+                return false;\n+            }\n \n-    /**\n-     * Display the logs (if any) that contain the search query.\n-     */\n-    private void searchLogs() {\n-        EditText searchText = logsView.findViewById(R.id.search_logs_field);\n-        searchText.clearFocus();\n-        logsText.setText(getString(R.string.placeholder_logs));\n-        logsText.setText(developerMenu.getFilteredLogs(searchText.getText().toString()));\n+            @Override\n+            public boolean onQueryTextChange(String searchText) {\n+                logsText.setText(R.string.placeholder_logs);\n+                logsText.setText(developerMenu.getFilteredLogs(searchText));\n+                return true;\n+            }\n+        });\n+        return logsView;\n     }\n }\n"}}, {"oid": "f4f9c6b62ac2ca270f4bbdc9b04e4ad6d989113f", "url": "https://github.com/aws-amplify/amplify-android/commit/f4f9c6b62ac2ca270f4bbdc9b04e4ad6d989113f", "message": "replaced EditText with SearchView for searching logs", "committedDate": "2020-08-17T16:40:33Z", "type": "commit"}, {"oid": "67503bfd8518377733c73165033c8a96dab3665e", "url": "https://github.com/aws-amplify/amplify-android/commit/67503bfd8518377733c73165033c8a96dab3665e", "message": "add newline at end of dev_menu_styles", "committedDate": "2020-08-17T16:44:06Z", "type": "commit"}, {"oid": "171651e2030431e4f9ce02cc7fd05ee6b3f2b49f", "url": "https://github.com/aws-amplify/amplify-android/commit/171651e2030431e4f9ce02cc7fd05ee6b3f2b49f", "message": "update comment for searching the logs", "committedDate": "2020-08-17T16:46:12Z", "type": "commit"}, {"oid": "264b9ebb9aefb822050a04ef15bf8a17a8e60230", "url": "https://github.com/aws-amplify/amplify-android/commit/264b9ebb9aefb822050a04ef15bf8a17a8e60230", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu-search-logs", "committedDate": "2020-08-18T16:04:21Z", "type": "commit"}, {"oid": "035db3bbf77e1eaf7f648a48974da4feebe5f867", "url": "https://github.com/aws-amplify/amplify-android/commit/035db3bbf77e1eaf7f648a48974da4feebe5f867", "message": "fixed import order in DeveloperMenu", "committedDate": "2020-08-18T16:08:29Z", "type": "commit"}]}