{"pr_number": 670, "pr_title": "chore(datastore) Represent lastChangedAt as Temporal.Timestamp instead of long", "pr_createdAt": "2020-07-24T23:17:54Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/670", "timeline": [{"oid": "388d767fca15a1aeaa3593034185e2e7f0878d09", "url": "https://github.com/aws-amplify/amplify-android/commit/388d767fca15a1aeaa3593034185e2e7f0878d09", "message": "chore(datastore) Represent lastChangedAt as Temporal.Timestamp instead of long", "committedDate": "2020-07-24T23:11:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDAyNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r460370026", "bodyText": "Will this require the SQL table to be reprovisioned?", "author": "jamesonwilliams", "createdAt": "2020-07-25T05:56:48Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/appsync/ModelMetadata.java", "diffHunk": "@@ -37,7 +38,7 @@\n     private final @ModelField(targetType = \"ID\", isRequired = true) String id;\n     private final @ModelField(targetType = \"Boolean\") Boolean _deleted;\n     private final @ModelField(targetType = \"Int\") Integer _version;\n-    private final @ModelField(targetType = \"AWSTimestamp\") Long _lastChangedAt;", "originalCommit": "388d767fca15a1aeaa3593034185e2e7f0878d09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzNDM5MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r461234390", "bodyText": "^If so, will this be considered a breaking change?", "author": "raphkim", "createdAt": "2020-07-27T23:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkxMTI1Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r465911257", "bodyText": "No, it will not require the SQL table to be reprovisioned, since it will still be stored as a Long either way.  That said, thanks for asking this question - I realized that the SQLiteModelFieldTypeConverter doesn't support AWSTimestamp yet, so I will add that.", "author": "richardmcclellan", "createdAt": "2020-08-05T18:09:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDAyNg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDA3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r460370070", "bodyText": "Why not your cool Temporal.now(), in all places, instead?", "author": "jamesonwilliams", "createdAt": "2020-07-25T05:57:44Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncMocking.java", "diffHunk": "@@ -101,7 +101,7 @@ public static CreateConfigurator onCreate(AppSync mock) {\n \n                 // Pass back a ModelWithMetadata. Model is the one provided.\n                 ModelMetadata metadata =\n-                    new ModelMetadata(capturedModel.getId(), false, 1, Time.now());\n+                    new ModelMetadata(capturedModel.getId(), false, 1, new Temporal.Timestamp());", "originalCommit": "388d767fca15a1aeaa3593034185e2e7f0878d09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQxMzcyOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r460413728", "bodyText": "Oops, missed this one!  Will change.", "author": "richardmcclellan", "createdAt": "2020-07-25T15:08:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDA3MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDEwMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r460370100", "bodyText": "You could make a Temporal.timestamp(long, TimeUnit) util, too, that might be cool.", "author": "jamesonwilliams", "createdAt": "2020-07-25T05:58:12Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncResponseDeserializerTest.java", "diffHunk": "@@ -61,7 +61,7 @@ public void awsDateTypesCanBeDeserialized() {\n                 .build();\n         Boolean deleted = false;\n         Integer version = 42;\n-        Long lastChangedAt = Long.valueOf(1594858827);\n+        Temporal.Timestamp lastChangedAt = new Temporal.Timestamp(1594858827, TimeUnit.SECONDS);", "originalCommit": "388d767fca15a1aeaa3593034185e2e7f0878d09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxMjQyMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r464512421", "bodyText": "Agreed, that would be nice.  Maybe in a subsequent PR.", "author": "richardmcclellan", "createdAt": "2020-08-03T16:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDM3MDEwMA=="}], "type": "inlineReview", "revised_code": {"commit": "3f66d397a06e24cfb22eabb9cd1f2afd6538eed3", "chunk": "diff --git a/aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncResponseDeserializerTest.java b/aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncResponseDeserializerTest.java\ndeleted file mode 100644\nindex 6b55e379..00000000\n--- a/aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncResponseDeserializerTest.java\n+++ /dev/null\n\n@@ -1,78 +0,0 @@\n-/*\n- * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\").\n- * You may not use this file except in compliance with the License.\n- * A copy of the License is located at\n- *\n- *  http://aws.amazon.com/apache2.0\n- *\n- * or in the \"license\" file accompanying this file. This file is distributed\n- * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n- * express or implied. See the License for the specific language governing\n- * permissions and limitations under the License.\n- */\n-\n-package com.amplifyframework.datastore.appsync;\n-\n-import com.amplifyframework.api.ApiException;\n-import com.amplifyframework.api.graphql.GraphQLResponse;\n-import com.amplifyframework.core.model.temporal.Temporal;\n-import com.amplifyframework.testmodels.meeting.Meeting;\n-import com.amplifyframework.testutils.Resources;\n-\n-import org.junit.Before;\n-import org.junit.Test;\n-\n-import java.util.concurrent.TimeUnit;\n-\n-import static org.junit.Assert.assertEquals;\n-\n-public class AppSyncResponseDeserializerTest {\n-    private AppSyncResponseDeserializer appSyncResponseDeserializer;\n-\n-    /**\n-     * Set up the object under test, an AppSyncResponseDeserializer.\n-     */\n-    @Before\n-    public void setup() {\n-        this.appSyncResponseDeserializer = new AppSyncResponseDeserializer();\n-    }\n-\n-    /**\n-     * {@link Temporal.Date}, {@link Temporal.DateTime}, {@link Temporal.Time}, and {@link Temporal.Timestamp} all\n-     * have different JSON representations. It must be possible to recover the Java type which\n-     * models the JSON representation of each.\n-     * @throws ApiException If the response factory fails to construct a response,\n-     *                      perhaps because deserialization to one of these types\n-     *                      has failed.\n-     */\n-    @Test\n-    public void awsDateTypesCanBeDeserialized() {\n-        // Expect\n-        String meetingId = \"45a5f600-8aa8-41ac-a529-aed75036f5be\";\n-        Meeting meeting = Meeting.builder()\n-                .name(\"meeting0\")\n-                .id(meetingId)\n-                .date(new Temporal.Date(\"2001-02-03\"))\n-                .dateTime(new Temporal.DateTime(\"2001-02-03T01:30Z\"))\n-                .time(new Temporal.Time(\"01:22\"))\n-                .timestamp(new Temporal.Timestamp(1234567890000L, TimeUnit.MILLISECONDS))\n-                .build();\n-        Boolean deleted = false;\n-        Integer version = 42;\n-        Temporal.Timestamp lastChangedAt = new Temporal.Timestamp(1594858827, TimeUnit.SECONDS);\n-        ModelMetadata modelMetadata = new ModelMetadata(meetingId, deleted, version, lastChangedAt);\n-        ModelWithMetadata<Meeting> modelWithMetadata = new ModelWithMetadata<>(meeting, modelMetadata);\n-        GraphQLResponse<ModelWithMetadata<Meeting>> expected = new GraphQLResponse<>(modelWithMetadata, null);\n-\n-        // Act\n-        final String responseString = Resources.readAsString(\"meeting-response.json\");\n-\n-        final GraphQLResponse<ModelWithMetadata<Meeting>> response =\n-                appSyncResponseDeserializer.deserialize(responseString, Meeting.class);\n-\n-        // Assert\n-        assertEquals(expected, response);\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzMjY4OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r461232689", "bodyText": "nice \ud83d\udc4d", "author": "raphkim", "createdAt": "2020-07-27T23:44:05Z", "path": "aws-api-appsync/src/main/java/com/amplifyframework/core/model/temporal/Temporal.java", "diffHunk": "@@ -434,6 +434,14 @@ public Timestamp(@NonNull java.util.Date date) {\n             this(date.getTime(), TimeUnit.MILLISECONDS);\n         }\n \n+        /**\n+         * Returns a new Timestamp instance that represents the current system time.\n+         * @return a new Timestamp instance that represents the current system time.\n+         */\n+        public static Timestamp now() {\n+            return new Timestamp();\n+        }", "originalCommit": "388d767fca15a1aeaa3593034185e2e7f0878d09", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzMzU2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r461233560", "bodyText": "Just making sure: this change is scoped only to model metadata right? Codegen won't be affected?", "author": "raphkim", "createdAt": "2020-07-27T23:46:45Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/appsync/ModelMetadata.java", "diffHunk": "@@ -37,7 +38,7 @@\n     private final @ModelField(targetType = \"ID\", isRequired = true) String id;\n     private final @ModelField(targetType = \"Boolean\") Boolean _deleted;\n     private final @ModelField(targetType = \"Int\") Integer _version;\n-    private final @ModelField(targetType = \"AWSTimestamp\") Long _lastChangedAt;\n+    private final @ModelField(targetType = \"AWSTimestamp\") Temporal.Timestamp _lastChangedAt;", "originalCommit": "388d767fca15a1aeaa3593034185e2e7f0878d09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDUxMTk2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r464511960", "bodyText": "Correct, no impact on codegen.", "author": "richardmcclellan", "createdAt": "2020-08-03T16:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIzMzU2MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "48004f8bb6ce23e174c21b9ae6661749db042a70", "url": "https://github.com/aws-amplify/amplify-android/commit/48004f8bb6ce23e174c21b9ae6661749db042a70", "message": "Temporal.Timestamp.now()", "committedDate": "2020-08-03T16:07:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU5NDcyOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/670#discussion_r473594728", "bodyText": "We could potentially create Temporal.Timestamp.seconds(123_123L) and Temporal.Timestamp.milliseconds(123_123_000L) utility factories?", "author": "jamesonwilliams", "createdAt": "2020-08-20T05:09:13Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/TestModelWithMetadataInstances.java", "diffHunk": "@@ -53,12 +61,18 @@\n                 .rating(3)\n                 .id(\"83ceb757-c8c8-4b6a-bee0-a43afb53a73a\")\n                 .build(),\n-            new ModelMetadata(\"83ceb757-c8c8-4b6a-bee0-a43afb53a73a\", null, 5, 123123L)\n+            new ModelMetadata(\"83ceb757-c8c8-4b6a-bee0-a43afb53a73a\",\n+                    null,\n+                    5,\n+                    new Temporal.Timestamp(123123L, TimeUnit.SECONDS))\n         );\n     public static final ModelWithMetadata<Post> DELETED_DRUM_POST =\n         new ModelWithMetadata<>(\n             DRUM_POST.getModel(),\n-            new ModelMetadata(\"83ceb757-c8c8-4b6a-bee0-a43afb53a73a\", Boolean.TRUE, 5, 123123L)\n+            new ModelMetadata(\"83ceb757-c8c8-4b6a-bee0-a43afb53a73a\",\n+                    Boolean.TRUE,\n+                    5,\n+                    new Temporal.Timestamp(123123L, TimeUnit.SECONDS))", "originalCommit": "48004f8bb6ce23e174c21b9ae6661749db042a70", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "3f66d397a06e24cfb22eabb9cd1f2afd6538eed3", "url": "https://github.com/aws-amplify/amplify-android/commit/3f66d397a06e24cfb22eabb9cd1f2afd6538eed3", "message": "Merge from main", "committedDate": "2020-09-15T22:52:00Z", "type": "commit"}, {"oid": "0e698cddadbae0ae30e9a66979fe662df245a1ac", "url": "https://github.com/aws-amplify/amplify-android/commit/0e698cddadbae0ae30e9a66979fe662df245a1ac", "message": "checkstyle", "committedDate": "2020-09-15T23:57:32Z", "type": "commit"}, {"oid": "c416dd86bb2c8f5bd64d9850b54b731b3cf6ff12", "url": "https://github.com/aws-amplify/amplify-android/commit/c416dd86bb2c8f5bd64d9850b54b731b3cf6ff12", "message": "checkstyle", "committedDate": "2020-09-16T01:24:26Z", "type": "commit"}, {"oid": "ba5a39ff24d517d160a9ec905bd4d2736377b29b", "url": "https://github.com/aws-amplify/amplify-android/commit/ba5a39ff24d517d160a9ec905bd4d2736377b29b", "message": "compile error", "committedDate": "2020-09-16T03:56:57Z", "type": "commit"}, {"oid": "111b2edbd0e15108beb84598c25db9acfe60c6a8", "url": "https://github.com/aws-amplify/amplify-android/commit/111b2edbd0e15108beb84598c25db9acfe60c6a8", "message": "checkstyle", "committedDate": "2020-09-16T04:03:09Z", "type": "commit"}]}