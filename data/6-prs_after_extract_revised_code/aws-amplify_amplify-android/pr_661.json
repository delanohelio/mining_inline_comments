{"pr_number": 661, "pr_title": "Sends proper user agent for Auth", "pr_createdAt": "2020-07-22T19:28:50Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/661", "timeline": [{"oid": "31d9acf8c966dd0c15dbf1a50cab24520bbe4612", "url": "https://github.com/aws-amplify/amplify-android/commit/31d9acf8c966dd0c15dbf1a50cab24520bbe4612", "message": "Sends proper user agent for Auth", "committedDate": "2020-07-22T19:26:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0NjE1Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/661#discussion_r459046156", "bodyText": "It's a bad practice to mutate method arguments. Here, the following occurs:\n\npluginConfiguration has state A.\nconfigure(..., pluginConfiguration, ...) runs.\npluginConfiguration has state B.\n\nInstead, I would do:\nJSONObject mobileClientConfig = new JSONObject(pluginConfiguration);\nmobileClientConfig.put(\"UserAgentOverride\", UserAgent.string());", "author": "jamesonwilliams", "createdAt": "2020-07-22T19:55:50Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -124,6 +126,14 @@ public void configure(\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n         LogFactory.setLevel(LogFactory.Level.OFF);\n \n+        try {\n+            pluginConfiguration.put(\"UserAgentOverride\", UserAgent.string());", "originalCommit": "31d9acf8c966dd0c15dbf1a50cab24520bbe4612", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA1ODMwMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/661#discussion_r459058301", "bodyText": "Done", "author": "TrekSoft", "createdAt": "2020-07-22T20:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA0NjE1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b34a635301dfc21f46881254afd02b67734c7102", "chunk": "diff --git a/aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java b/aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java\nindex 3485316a..b19865e9 100644\n--- a/aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java\n+++ b/aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java\n\n@@ -124,10 +124,12 @@ public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n     ) throws AuthException {\n         final CountDownLatch latch = new CountDownLatch(1);\n         final AtomicReference<Exception> asyncException = new AtomicReference<>();\n+        JSONObject mobileClientConfig;\n         LogFactory.setLevel(LogFactory.Level.OFF);\n \n         try {\n-            pluginConfiguration.put(\"UserAgentOverride\", UserAgent.string());\n+            mobileClientConfig = new JSONObject(pluginConfiguration.toString());\n+            mobileClientConfig.put(\"UserAgentOverride\", UserAgent.string());\n         } catch (JSONException exception) {\n             throw new AuthException(\"Failed to set user agent string\",\n                     exception,\n"}}, {"oid": "b34a635301dfc21f46881254afd02b67734c7102", "url": "https://github.com/aws-amplify/amplify-android/commit/b34a635301dfc21f46881254afd02b67734c7102", "message": "Addresses PR feedback", "committedDate": "2020-07-22T20:18:36Z", "type": "commit"}]}