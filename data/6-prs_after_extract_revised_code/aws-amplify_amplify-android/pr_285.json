{"pr_number": 285, "pr_title": "Refactor storage options to abstract out common properties", "pr_createdAt": "2020-02-26T21:12:07Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/285", "timeline": [{"oid": "4cc1b5dea34bcf16c0efc41f4d8cad4b22be804a", "url": "https://github.com/aws-amplify/amplify-android/commit/4cc1b5dea34bcf16c0efc41f4d8cad4b22be804a", "message": "Refactor storage options to abstract out common properties", "committedDate": "2020-02-26T20:55:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyOTk4MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/285#discussion_r384829980", "bodyText": "Will the run time exception get caught for sure? Or should you just throw a storage exception directly, to be sure/safe? Same for all in this file", "author": "jamesonwilliams", "createdAt": "2020-02-26T23:29:25Z", "path": "aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/utils/S3RequestUtils.java", "diffHunk": "@@ -64,9 +83,30 @@ private static String getAccessLevelPrefix(\n             @NonNull String identityId\n     ) {\n         if (accessLevel.equals(StorageAccessLevel.PRIVATE) || accessLevel.equals(StorageAccessLevel.PROTECTED)) {\n-            return accessLevel.name().toLowerCase(Locale.US) + \"/\" + identityId + \"/\";\n+            return accessLevel.name().toLowerCase(Locale.US) + BUCKET_SEPARATOR + identityId;\n         } else {\n-            return accessLevel.name().toLowerCase(Locale.US) + \"/\";\n+            return accessLevel.name().toLowerCase(Locale.US);\n         }\n     }\n+\n+    @NonNull\n+    private static String getAccessLevelPrefix(@NonNull StorageOptions options) {\n+        StorageAccessLevel accessLevel = options.getAccessLevel();\n+        if (accessLevel == null) {\n+            throw new RuntimeException(new StorageException(", "originalCommit": "4cc1b5dea34bcf16c0efc41f4d8cad4b22be804a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0ODgwNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/285#discussion_r384848806", "bodyText": "These utility methods aren't yet used anywhere to be honest. I just remembered that I went through the trouble of abstracting out options to make it easier to test, but I realized that I didn't actually use it anywhere. I think this will be used later on in one of the refactors once we are done with the testing shenanigans, so we'll see exactly how this utility gets used.", "author": "raphkim", "createdAt": "2020-02-27T00:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgyOTk4MA=="}], "type": "inlineReview", "revised_code": {"commit": "dcff061b0a3edad544730a155c6c2375128479c1", "chunk": "diff --git a/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/utils/S3RequestUtils.java b/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/utils/S3RequestUtils.java\nindex 69d1f641..2223525a 100644\n--- a/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/utils/S3RequestUtils.java\n+++ b/aws-storage-s3/src/main/java/com/amplifyframework/storage/s3/utils/S3RequestUtils.java\n\n@@ -61,22 +59,6 @@ public final class S3RequestUtils {\n         return getAccessLevelPrefix(accessLevel, identityId) + BUCKET_SEPARATOR + key;\n     }\n \n-    /**\n-     * See {@link S3RequestUtils#getServiceKey(StorageAccessLevel, String, String)}.\n-     *\n-     * @param options Storage options to specify accessor and access level\n-     *                of the request\n-     * @param key User-friendly key to access the item\n-     * @return Formatted key to be used internally by S3 plugin\n-     */\n-    @NonNull\n-    public static String getServiceKey(\n-            @NonNull StorageOptions options,\n-            @NonNull String key\n-    ) {\n-        return getAccessLevelPrefix(options) + BUCKET_SEPARATOR + key;\n-    }\n-\n     @NonNull\n     private static String getAccessLevelPrefix(\n             @NonNull StorageAccessLevel accessLevel,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMDIzNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/285#discussion_r384830235", "bodyText": "I think this could be non-public, since only the sub classes get used outside of this package. Right?", "author": "jamesonwilliams", "createdAt": "2020-02-26T23:30:18Z", "path": "core/src/main/java/com/amplifyframework/storage/options/StorageOptions.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.storage.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.core.async.Options;\n+import com.amplifyframework.storage.StorageAccessLevel;\n+\n+/**\n+ * Storage options interface requires that every\n+ * storage operation will inspect the provided options\n+ * instance for access level and target ID.\n+ */\n+public abstract class StorageOptions implements Options {", "originalCommit": "4cc1b5dea34bcf16c0efc41f4d8cad4b22be804a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0OTAxOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/285#discussion_r384849019", "bodyText": "ah shoot you are right. I'm pretty sure I fixed it before, but not sure why its public again now.", "author": "raphkim", "createdAt": "2020-02-27T00:29:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMDIzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg0OTYxNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/285#discussion_r384849617", "bodyText": "OH it's because I added the bit for S3RequestUtils... I'll just get rid of that since I don't plan on using it just yet.", "author": "raphkim", "createdAt": "2020-02-27T00:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDgzMDIzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "dcff061b0a3edad544730a155c6c2375128479c1", "chunk": "diff --git a/core/src/main/java/com/amplifyframework/storage/options/StorageOptions.java b/core/src/main/java/com/amplifyframework/storage/options/StorageOptions.java\nindex 8e814790..9628cbc0 100644\n--- a/core/src/main/java/com/amplifyframework/storage/options/StorageOptions.java\n+++ b/core/src/main/java/com/amplifyframework/storage/options/StorageOptions.java\n\n@@ -26,7 +26,7 @@ import com.amplifyframework.storage.StorageAccessLevel;\n  * storage operation will inspect the provided options\n  * instance for access level and target ID.\n  */\n-public abstract class StorageOptions implements Options {\n+abstract class StorageOptions implements Options {\n     private final StorageAccessLevel accessLevel;\n     private final String targetIdentityId;\n \n"}}, {"oid": "dcff061b0a3edad544730a155c6c2375128479c1", "url": "https://github.com/aws-amplify/amplify-android/commit/dcff061b0a3edad544730a155c6c2375128479c1", "message": "Revert additional utilities from S3RequestUtils", "committedDate": "2020-02-27T00:32:42Z", "type": "commit"}]}