{"pr_number": 8230, "pr_title": "Study-view: Fix bug in genefilter applier", "pr_createdAt": "2020-12-22T15:31:55Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/8230", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM1NTcxNw==", "url": "https://github.com/cBioPortal/cbioportal/pull/8230#discussion_r547355717", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                .filter(molecularProfileId -> molecularProfileMap.containsKey(molecularProfileId))\n          \n          \n            \n                                .map(molecularProfileId -> molecularProfileMap.get(molecularProfileId))\n          \n          \n            \n                                .filter(molecularProfileMap::containsKey)\n          \n          \n            \n                                .map(molecularProfileMap::get)", "author": "Luke-Sikina", "createdAt": "2020-12-22T15:54:01Z", "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -414,14 +414,24 @@ private void splitGeneFiltersByMolecularAlterationType(List<GeneFilter> genefilt\n         for (GeneFilter genefilter : genefilters) {\n \n             List<MolecularProfile> filteredMolecularProfiles = genefilter.getMolecularProfileIds().stream()\n+                    // need this filter criteria since profile id might be present\n+                    // in filter but the study might already been filtered out\n+                    .filter(molecularProfileId -> molecularProfileMap.containsKey(molecularProfileId))\n                     .map(molecularProfileId -> molecularProfileMap.get(molecularProfileId))", "originalCommit": "6f9061b10d14958337c733cadf57bbd392a4c03f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "chunk": "diff --git a/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java b/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\nindex 12ef7c0cb..e22f6b7fc 100644\n--- a/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\n+++ b/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\n\n@@ -416,8 +416,8 @@ public class StudyViewFilterApplier {\n             List<MolecularProfile> filteredMolecularProfiles = genefilter.getMolecularProfileIds().stream()\n                     // need this filter criteria since profile id might be present\n                     // in filter but the study might already been filtered out\n-                    .filter(molecularProfileId -> molecularProfileMap.containsKey(molecularProfileId))\n-                    .map(molecularProfileId -> molecularProfileMap.get(molecularProfileId))\n+                    .filter(molecularProfileMap::containsKey)\n+                    .map(molecularProfileMap::get)\n                     .collect(Collectors.toList());\n \n             Set<MolecularAlterationType> alterationTypes = filteredMolecularProfiles.stream()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM1ODQ5Mw==", "url": "https://github.com/cBioPortal/cbioportal/pull/8230#discussion_r547358493", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                .map(molecularProfile -> molecularProfile.getStableId())\n          \n          \n            \n                                .map(MolecularProfile::getStableId)", "author": "Luke-Sikina", "createdAt": "2020-12-22T15:58:41Z", "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -414,14 +414,24 @@ private void splitGeneFiltersByMolecularAlterationType(List<GeneFilter> genefilt\n         for (GeneFilter genefilter : genefilters) {\n \n             List<MolecularProfile> filteredMolecularProfiles = genefilter.getMolecularProfileIds().stream()\n+                    // need this filter criteria since profile id might be present\n+                    // in filter but the study might already been filtered out\n+                    .filter(molecularProfileId -> molecularProfileMap.containsKey(molecularProfileId))\n                     .map(molecularProfileId -> molecularProfileMap.get(molecularProfileId))\n                     .collect(Collectors.toList());\n \n             Set<MolecularAlterationType> alterationTypes = filteredMolecularProfiles.stream()\n-                    .map(MolecularProfile::getMolecularAlterationType).collect(Collectors.toSet());\n+                    .map(MolecularProfile::getMolecularAlterationType)\n+                    .collect(Collectors.toSet());\n \n             Set<String> dataTypes = filteredMolecularProfiles.stream().map(MolecularProfile::getDatatype)\n                     .collect(Collectors.toSet());\n+            \n+            Set<String> filteredMolecularProfileIds = filteredMolecularProfiles\n+                    .stream()\n+                    .map(molecularProfile -> molecularProfile.getStableId())", "originalCommit": "6f9061b10d14958337c733cadf57bbd392a4c03f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "chunk": "diff --git a/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java b/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\nindex 12ef7c0cb..e22f6b7fc 100644\n--- a/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\n+++ b/web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java\n\n@@ -416,8 +416,8 @@ public class StudyViewFilterApplier {\n             List<MolecularProfile> filteredMolecularProfiles = genefilter.getMolecularProfileIds().stream()\n                     // need this filter criteria since profile id might be present\n                     // in filter but the study might already been filtered out\n-                    .filter(molecularProfileId -> molecularProfileMap.containsKey(molecularProfileId))\n-                    .map(molecularProfileId -> molecularProfileMap.get(molecularProfileId))\n+                    .filter(molecularProfileMap::containsKey)\n+                    .map(molecularProfileMap::get)\n                     .collect(Collectors.toList());\n \n             Set<MolecularAlterationType> alterationTypes = filteredMolecularProfiles.stream()\n"}}, {"oid": "a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "url": "https://github.com/cBioPortal/cbioportal/commit/a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "message": "Study-view: Fix bug in genefilter applier", "committedDate": "2020-12-22T16:42:27Z", "type": "commit"}, {"oid": "a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "url": "https://github.com/cBioPortal/cbioportal/commit/a4bf7d4f3aab9cd561b208b92f3825aa98339aa6", "message": "Study-view: Fix bug in genefilter applier", "committedDate": "2020-12-22T16:42:27Z", "type": "forcePushed"}]}