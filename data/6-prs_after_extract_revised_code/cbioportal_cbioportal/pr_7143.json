{"pr_number": 7143, "pr_title": "Study view: Fix error while calculating databin NA counts", "pr_createdAt": "2020-02-10T18:08:29Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7143", "timeline": [{"oid": "5ef5140338998ee89db0069b7715931c0ad7fecf", "url": "https://github.com/cBioPortal/cbioportal/commit/5ef5140338998ee89db0069b7715931c0ad7fecf", "message": "Study view: Fix error while calculating databin NA counts", "committedDate": "2020-02-10T19:03:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM1ODg3OA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7143#discussion_r380358878", "bodyText": "since now this became a rather complex multiple line filtering logic, instead of copying and pasting it everywhere should we create a method for it?", "author": "onursumer", "createdAt": "2020-02-17T20:40:22Z", "path": "web/src/test/java/org/cbioportal/web/util/DataBinnerTest.java", "diffHunk": "@@ -686,13 +689,19 @@ public void testStaticDataBinnerFilter() {\n \n         List<ClinicalData> unfilteredClinicalData = mockClinicalData(attributeId, studyId, values);\n         List<String> unfilteredPatientIds =\n-            unfilteredClinicalData.stream().map(ClinicalData::getPatientId).collect(Collectors.toList());\n+            unfilteredClinicalData\n+            .stream()\n+            .map(datum-> studyViewFilterUtil.getCaseUniqueKey(datum.getStudyId(), datum.getPatientId()))\n+            .collect(Collectors.toList());", "originalCommit": "5ef5140338998ee89db0069b7715931c0ad7fecf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6949322732189395cdb3df4c39771b6e8c9b8db1", "chunk": "diff --git a/web/src/test/java/org/cbioportal/web/util/DataBinnerTest.java b/web/src/test/java/org/cbioportal/web/util/DataBinnerTest.java\nindex 16d90dfc1..075250227 100644\n--- a/web/src/test/java/org/cbioportal/web/util/DataBinnerTest.java\n+++ b/web/src/test/java/org/cbioportal/web/util/DataBinnerTest.java\n\n@@ -689,19 +697,13 @@ public class DataBinnerTest {\n \n         List<ClinicalData> unfilteredClinicalData = mockClinicalData(attributeId, studyId, values);\n         List<String> unfilteredPatientIds =\n-            unfilteredClinicalData\n-            .stream()\n-            .map(datum-> studyViewFilterUtil.getCaseUniqueKey(datum.getStudyId(), datum.getPatientId()))\n-            .collect(Collectors.toList());\n+            getCaseIds(unfilteredClinicalData, true);\n         List<DataBin> unfilteredDataBins = dataBinner.calculateClinicalDataBins(\n             clinicalDataBinFilter, ClinicalDataType.PATIENT, unfilteredClinicalData, unfilteredPatientIds);\n         \n         List<ClinicalData> filteredClinicalData = unfilteredClinicalData.subList(0, 108); // (0, 60] interval\n         List<String> filteredPatientIds =\n-            filteredClinicalData\n-            .stream()\n-            .map(datum-> studyViewFilterUtil.getCaseUniqueKey(datum.getStudyId(), datum.getPatientId()))\n-            .collect(Collectors.toList());\n+            getCaseIds(filteredClinicalData, true);\n         List<DataBin> filteredDataBins = dataBinner.calculateClinicalDataBins(clinicalDataBinFilter,\n                 ClinicalDataType.PATIENT, filteredClinicalData, unfilteredClinicalData, filteredPatientIds,\n                 unfilteredPatientIds);\n"}}, {"oid": "6949322732189395cdb3df4c39771b6e8c9b8db1", "url": "https://github.com/cBioPortal/cbioportal/commit/6949322732189395cdb3df4c39771b6e8c9b8db1", "message": "Study view: Fix error while calculating databin NA counts", "committedDate": "2020-02-18T15:31:12Z", "type": "commit"}, {"oid": "6949322732189395cdb3df4c39771b6e8c9b8db1", "url": "https://github.com/cBioPortal/cbioportal/commit/6949322732189395cdb3df4c39771b6e8c9b8db1", "message": "Study view: Fix error while calculating databin NA counts", "committedDate": "2020-02-18T15:31:12Z", "type": "forcePushed"}]}