{"pr_number": 1495, "pr_title": "Improve the error handling of invalid `sla` definition in SessionMonitorExecutor", "pr_createdAt": "2020-12-08T09:03:26Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1495", "timeline": [{"oid": "1b1d478c9cdce4e1b72788767a631ae0189783c2", "url": "https://github.com/treasure-data/digdag/commit/1b1d478c9cdce4e1b72788767a631ae0189783c2", "message": "Take care of workflow config error gracefully in SessionMonitorExecutor", "committedDate": "2020-12-08T06:01:11Z", "type": "commit"}, {"oid": "41a6d2d3145f732f4af4a6a6a54ae87bc4963758", "url": "https://github.com/treasure-data/digdag/commit/41a6d2d3145f732f4af4a6a6a54ae87bc4963758", "message": "Add tests", "committedDate": "2020-12-08T08:07:57Z", "type": "commit"}, {"oid": "d18901c939b05562fd085e686033dd704bbde198", "url": "https://github.com/treasure-data/digdag/commit/d18901c939b05562fd085e686033dd704bbde198", "message": "Avoid delaying other monitors and retrying a lot", "committedDate": "2020-12-08T12:45:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODM0MDk4MA==", "url": "https://github.com/treasure-data/digdag/pull/1495#discussion_r538340980", "bodyText": "Returning Optional.absent() prevents retries.", "author": "komamitsu", "createdAt": "2020-12-08T13:01:10Z", "path": "digdag-core/src/main/java/io/digdag/core/session/SessionMonitorExecutor.java", "diffHunk": "@@ -94,8 +96,15 @@ public void run()\n         try {\n             tm.begin(() -> {\n                 sm.lockReadySessionMonitors(Instant.now(), (storedMonitor) -> {\n-                    // runMonitor needs to return next runtime if this monitor should run again later\n-                    return runMonitor(storedMonitor);\n+                    try {\n+                        // runMonitor needs to return next runtime if this monitor should run again later\n+                        return runMonitor(storedMonitor);\n+                    }\n+                    catch (ModelValidationException | ConfigException e) {\n+                        logger.error(\n+                                \"Failed to schedule a session monitor task due to deterministic error. This won't be retried.\", e);\n+                        return Optional.absent();", "originalCommit": "d18901c939b05562fd085e686033dd704bbde198", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}