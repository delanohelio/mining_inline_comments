{"pr_number": 1378, "pr_title": "Fix TD operator for creating table/database to retry when it does not exist", "pr_createdAt": "2020-03-16T08:36:38Z", "pr_url": "https://github.com/treasure-data/digdag/pull/1378", "timeline": [{"oid": "490d6f121e479cae246e99c34b939b01b34269c6", "url": "https://github.com/treasure-data/digdag/commit/490d6f121e479cae246e99c34b939b01b34269c6", "message": "Fix TD operator for creating table/database to retry when it does not exist", "committedDate": "2020-03-16T08:35:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzkyMg==", "url": "https://github.com/treasure-data/digdag/pull/1378#discussion_r393417922", "bodyText": "I confirmed to  you, createDatabase() will not fail even though already exist it.\nSo it is ok.", "author": "yoyama", "createdAt": "2020-03-17T02:58:15Z", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TDOperator.java", "diffHunk": "@@ -137,6 +137,10 @@ public void ensureDatabaseCreated(String name)\n             throws TDClientException\n     {\n         runWithRetry(() -> client.createDatabase(name), TDClientHttpConflictException.class);\n+        // Check database existing and retry only once if it doesn't exit by session error(WM-763)\n+        if (!client.existsDatabase(name)){\n+            runWithRetry(() -> client.createDatabase(name), TDClientHttpConflictException.class);", "originalCommit": "490d6f121e479cae246e99c34b939b01b34269c6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzk4MA==", "url": "https://github.com/treasure-data/digdag/pull/1378#discussion_r393417980", "bodyText": "Ditto.", "author": "yoyama", "createdAt": "2020-03-17T02:58:29Z", "path": "digdag-standards/src/main/java/io/digdag/standards/operator/td/TDOperator.java", "diffHunk": "@@ -150,6 +154,10 @@ public void ensureTableCreated(String tableName)\n     {\n         // TODO set include_v=false option\n         runWithRetry(() -> client.createTable(database, tableName), TDClientHttpConflictException.class);\n+        // Check table existing and retry only once if it doesn't exit by session error(WM-763)\n+        if (!client.existsTable(database, tableName)){\n+            runWithRetry(() -> client.createTable(database, tableName), TDClientHttpConflictException.class);", "originalCommit": "490d6f121e479cae246e99c34b939b01b34269c6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}