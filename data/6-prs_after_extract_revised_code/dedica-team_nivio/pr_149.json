{"pr_number": 149, "pr_title": "concurrency issues in Test with DirectoryWatcher", "pr_createdAt": "2020-06-03T22:00:24Z", "pr_url": "https://github.com/dedica-team/nivio/pull/149", "timeline": [{"oid": "4ff3f35f11d5559f8ad21a59d843cffbf318faa6", "url": "https://github.com/dedica-team/nivio/commit/4ff3f35f11d5559f8ad21a59d843cffbf318faa6", "message": "increasing the Thread.sleep() time after changing the file contents allows the application to register the change event (tested on macOS 10.15.4 with openjdk version \"11.0.7\" 2020-04-14)", "committedDate": "2020-06-03T21:58:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTgwNQ==", "url": "https://github.com/dedica-team/nivio/pull/149#discussion_r435011805", "bodyText": "Can't we use SystemUtils.IS_OS_MAC_OSX here? Or a lower value? 50 seconds build delay is a bit much for regular CI builds.", "author": "bonndan", "createdAt": "2020-06-04T06:06:34Z", "path": "src/test/java/de/bonndan/nivio/input/DirectoryWatcherTest.java", "diffHunk": "@@ -39,7 +39,7 @@ public void testFileChange() throws IOException, InterruptedException, TimeoutEx\n \n         Thread.sleep(1000);\n         Files.write(tempFile.toPath(), \"Hallo\".getBytes(), StandardOpenOption.CREATE, StandardOpenOption.APPEND, StandardOpenOption.WRITE);\n-        Thread.sleep(1000);\n+        Thread.sleep(50000);", "originalCommit": "4ff3f35f11d5559f8ad21a59d843cffbf318faa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTE0MDYzNA==", "url": "https://github.com/dedica-team/nivio/pull/149#discussion_r435140634", "bodyText": "Sure. Although I am not sure yet why we are seeing this behaviour. Of course it comes to mind, that it is related to the different file systems. I would still want to check out the build without the Thread.sleep() on e.g. Windows 10 and Windows Server 2016.\nYou are running the build on your machine on what system? Linux?\nIn any case, we should investigate the underlying issue, if it is not already fixed with the mentioned PR.", "author": "mfbieber", "createdAt": "2020-06-04T10:06:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxMTgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "d3de7b920df4136ffad36cf86d38a3829259e685", "chunk": "diff --git a/src/test/java/de/bonndan/nivio/input/DirectoryWatcherTest.java b/src/test/java/de/bonndan/nivio/input/DirectoryWatcherTest.java\nindex 6801e357..6a90d663 100644\n--- a/src/test/java/de/bonndan/nivio/input/DirectoryWatcherTest.java\n+++ b/src/test/java/de/bonndan/nivio/input/DirectoryWatcherTest.java\n\n@@ -39,7 +40,7 @@ class DirectoryWatcherTest {\n \n         Thread.sleep(1000);\n         Files.write(tempFile.toPath(), \"Hallo\".getBytes(), StandardOpenOption.CREATE, StandardOpenOption.APPEND, StandardOpenOption.WRITE);\n-        Thread.sleep(50000);\n+        Thread.sleep(SystemUtils.IS_OS_MAC_OSX ? 50000 : 1000); //#147\n \n         ArgumentCaptor<FSChangeEvent> captor = ArgumentCaptor.forClass(FSChangeEvent.class);\n         verify(publisher).publishEvent(captor.capture());\n"}}, {"oid": "d3de7b920df4136ffad36cf86d38a3829259e685", "url": "https://github.com/dedica-team/nivio/commit/d3de7b920df4136ffad36cf86d38a3829259e685", "message": "[#147] long thread sleep only on OSX", "committedDate": "2020-06-04T06:36:49Z", "type": "commit"}, {"oid": "8d6a9c1d688f901100b9e8b9612d7b27593bce21", "url": "https://github.com/dedica-team/nivio/commit/8d6a9c1d688f901100b9e8b9612d7b27593bce21", "message": "[#147] long thread sleep not on linux", "committedDate": "2020-06-04T10:33:10Z", "type": "commit"}]}