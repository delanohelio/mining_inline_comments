{"pr_number": 252, "pr_title": "[#231] Add ArchUnit tests", "pr_createdAt": "2020-09-06T17:29:04Z", "pr_url": "https://github.com/dedica-team/nivio/pull/252", "timeline": [{"oid": "4a733bc04d11d441b6527f731fe14278d1ce05c0", "url": "https://github.com/dedica-team/nivio/commit/4a733bc04d11d441b6527f731fe14278d1ce05c0", "message": "[#231] Add do_not_access_STD_streams ArchUnit test\n\nItemIndex: Use LOGGER.warn() instead of ex.printStackTrace()", "committedDate": "2020-09-06T17:22:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MjE5MA==", "url": "https://github.com/dedica-team/nivio/pull/252#discussion_r488742190", "bodyText": "\ud83d\udc4d", "author": "Matthimatiker", "createdAt": "2020-09-15T15:05:06Z", "path": "src/main/java/de/bonndan/nivio/model/ItemIndex.java", "diffHunk": "@@ -241,7 +245,7 @@ public int indexForSearch() {\n             ireader.close();\n             return facets.getAllDims(10);\n         } catch (IOException e) {\n-            e.printStackTrace();\n+            LOGGER.warn(\"Unable to get the facets for the given query error: \", e);", "originalCommit": "4a733bc04d11d441b6527f731fe14278d1ce05c0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0MzI5MQ==", "url": "https://github.com/dedica-team/nivio/pull/252#discussion_r488743291", "bodyText": "More readable \ud83d\udc4d", "author": "Matthimatiker", "createdAt": "2020-09-15T15:06:27Z", "path": "src/main/java/de/bonndan/nivio/model/ItemIndex.java", "diffHunk": "@@ -259,8 +263,8 @@ public int indexForSearch() {\n \n         List<Document> documents = new ArrayList<>();\n         // Iterate through the results:\n-        for (int i = 0; i < hits.length; i++) {\n-            Document hitDoc = isearcher.doc(hits[i].doc);\n+        for (ScoreDoc hit : hits) {", "originalCommit": "4a733bc04d11d441b6527f731fe14278d1ce05c0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0NDk5Nw==", "url": "https://github.com/dedica-team/nivio/pull/252#discussion_r488744997", "bodyText": "You could move the classes into a test attribute, even a static one.\nUsually, the classes are used by many (if not all) ArchUnit tests and collecting the data from byte code is expensive.", "author": "Matthimatiker", "createdAt": "2020-09-15T15:08:49Z", "path": "src/test/java/de/bonndan/nivio/ArchTest.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package de.bonndan.nivio;\n+\n+import com.tngtech.archunit.core.domain.JavaClasses;\n+import com.tngtech.archunit.core.importer.ClassFileImporter;\n+import com.tngtech.archunit.core.importer.ImportOption;\n+import org.junit.jupiter.api.Test;\n+\n+import static com.tngtech.archunit.library.GeneralCodingRules.NO_CLASSES_SHOULD_ACCESS_STANDARD_STREAMS;\n+\n+class ArchTest {\n+    @Test\n+    void do_not_access_STD_streams() {\n+        JavaClasses classes = new ClassFileImporter()\n+                .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_JARS)\n+                .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_TESTS)\n+                .importClasspath();", "originalCommit": "4a733bc04d11d441b6527f731fe14278d1ce05c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQxMTg0NA==", "url": "https://github.com/dedica-team/nivio/pull/252#discussion_r503411844", "bodyText": "I took over to do this to merge this PR. I need ArchUnit for Issue 317!", "author": "mfbieber", "createdAt": "2020-10-12T16:38:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc0NDk5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "47f397cea8c1cae46972f49557c80ec0c2b3cfb0", "chunk": "diff --git a/src/test/java/de/bonndan/nivio/ArchTest.java b/src/test/java/de/bonndan/nivio/ArchTest.java\nindex bbe796e7..8098b8be 100644\n--- a/src/test/java/de/bonndan/nivio/ArchTest.java\n+++ b/src/test/java/de/bonndan/nivio/ArchTest.java\n\n@@ -8,12 +8,14 @@ import org.junit.jupiter.api.Test;\n import static com.tngtech.archunit.library.GeneralCodingRules.NO_CLASSES_SHOULD_ACCESS_STANDARD_STREAMS;\n \n class ArchTest {\n+\n+    private static final JavaClasses classes = new ClassFileImporter()\n+            .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_JARS)\n+            .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_TESTS)\n+            .importClasspath();\n+\n     @Test\n     void do_not_access_STD_streams() {\n-        JavaClasses classes = new ClassFileImporter()\n-                .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_JARS)\n-                .withImportOption(ImportOption.Predefined.DO_NOT_INCLUDE_TESTS)\n-                .importClasspath();\n         NO_CLASSES_SHOULD_ACCESS_STANDARD_STREAMS.check(classes);\n     }\n \n"}}, {"oid": "47f397cea8c1cae46972f49557c80ec0c2b3cfb0", "url": "https://github.com/dedica-team/nivio/commit/47f397cea8c1cae46972f49557c80ec0c2b3cfb0", "message": "moved classes for archUnit to static class attribute", "committedDate": "2020-10-12T16:34:14Z", "type": "commit"}, {"oid": "73aa45a56c0cb3508d3a7e3e46c990a4622f9b75", "url": "https://github.com/dedica-team/nivio/commit/73aa45a56c0cb3508d3a7e3e46c990a4622f9b75", "message": "Merge remote-tracking branch 'origin/develop' into feature/231/arch-unit", "committedDate": "2020-10-12T17:08:50Z", "type": "commit"}, {"oid": "21864963ebb7340a8c9dcb25a6a0d56425b22ab5", "url": "https://github.com/dedica-team/nivio/commit/21864963ebb7340a8c9dcb25a6a0d56425b22ab5", "message": "using specific jackson-databind dependency", "committedDate": "2020-10-12T17:10:14Z", "type": "commit"}]}