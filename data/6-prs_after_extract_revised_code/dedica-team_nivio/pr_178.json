{"pr_number": 178, "pr_title": "Bugfix/169/url helper", "pr_createdAt": "2020-07-07T11:52:45Z", "pr_url": "https://github.com/dedica-team/nivio/pull/178", "timeline": [{"oid": "9b19ea23ce8ee0e7fb1d2ae95c939f38d9cd2fab", "url": "https://github.com/dedica-team/nivio/commit/9b19ea23ce8ee0e7fb1d2ae95c939f38d9cd2fab", "message": "[#169] URLHelper.getURL fix\n\nuse 'file:///' instead of 'file:' as prefix\nhttps://en.wikipedia.org/wiki/File_URI_scheme#Examples\n\nremove unused import 'java.nio.file.Files'", "committedDate": "2020-07-01T16:05:06Z", "type": "commit"}, {"oid": "0b337f62b79bd893e6ea21de7388700b00a82ace", "url": "https://github.com/dedica-team/nivio/commit/0b337f62b79bd893e6ea21de7388700b00a82ace", "message": "Merge branch 'develop' into bugfix/169/URLHelper", "committedDate": "2020-07-06T10:44:31Z", "type": "commit"}, {"oid": "33da478f25c162f4a39d24fe14daf7e9e1bd3853", "url": "https://github.com/dedica-team/nivio/commit/33da478f25c162f4a39d24fe14daf7e9e1bd3853", "message": "add URLHelperTest", "committedDate": "2020-07-06T15:50:34Z", "type": "commit"}, {"oid": "d891e2dd8fd99ec31d82e5e9cbd185163bff3498", "url": "https://github.com/dedica-team/nivio/commit/d891e2dd8fd99ec31d82e5e9cbd185163bff3498", "message": "update Seed,StartupListener,SeedTest\n\nSeed: make getLocations return a List<String> , move URL logic to StartupListener.getUrls,remove ESCAPE_AUTHORITY var and toURL function\n\nStartupListener: Update getUrls to create URLs", "committedDate": "2020-07-06T16:42:57Z", "type": "commit"}, {"oid": "84cfadc8b3ebb4d95040be1ce4397356ab9bdc76", "url": "https://github.com/dedica-team/nivio/commit/84cfadc8b3ebb4d95040be1ce4397356ab9bdc76", "message": "Merge branch 'develop' into bugfix/169/URLHelper", "committedDate": "2020-07-07T08:58:18Z", "type": "commit"}, {"oid": "80b4fca970b1ca6a3c87296b4902def9718173c8", "url": "https://github.com/dedica-team/nivio/commit/80b4fca970b1ca6a3c87296b4902def9718173c8", "message": "[#169] code cleanup", "committedDate": "2020-07-07T15:29:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk1Njg1Mg==", "url": "https://github.com/dedica-team/nivio/pull/178#discussion_r450956852", "bodyText": "\ud83d\udc4d for removing this completely", "author": "bonndan", "createdAt": "2020-07-07T15:34:08Z", "path": "src/main/java/de/bonndan/nivio/input/Seed.java", "diffHunk": "@@ -12,21 +11,30 @@\n import java.nio.file.Path;\n import java.nio.file.Paths;\n import java.util.ArrayList;\n+import java.util.Arrays;\n import java.util.List;\n \n /**\n  * Evaluation of the SEED environment variable.\n- *\n- *\n  */\n public class Seed {\n \n+    public static final String DEMO = \"DEMO\";\n     private static final Logger logger = LoggerFactory.getLogger(Seed.class);\n+    @Value(\"${SEED:}\")\n+    private String seed;\n \n-    public static final String DEMO = \"DEMO\";\n+    public Seed() {\n \n-    static boolean ESCAPE_AUTHORITY = SystemUtils.IS_OS_WINDOWS;", "originalCommit": "80b4fca970b1ca6a3c87296b4902def9718173c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a49ee35a132e2c203422c816bcbbfb30967ac4df", "chunk": "diff --git a/src/main/java/de/bonndan/nivio/input/Seed.java b/src/main/java/de/bonndan/nivio/input/Seed.java\nindex 471889ae..d76a4f0b 100644\n--- a/src/main/java/de/bonndan/nivio/input/Seed.java\n+++ b/src/main/java/de/bonndan/nivio/input/Seed.java\n\n@@ -25,7 +25,6 @@ public class Seed {\n     private String seed;\n \n     public Seed() {\n-\n     }\n \n     public Seed(String seed) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk1ODI1Mw==", "url": "https://github.com/dedica-team/nivio/pull/178#discussion_r450958253", "bodyText": "Please consider to move the try-catch inside the loop over seed.getLocations(), so we're able to report single broken URLs and keep the rest.", "author": "bonndan", "createdAt": "2020-07-07T15:36:14Z", "path": "src/main/java/de/bonndan/nivio/input/StartupListener.java", "diffHunk": "@@ -57,7 +58,19 @@ public void onApplicationEvent(final ApplicationReadyEvent event) {\n         List<URL> landscapeDescriptionLocations = new ArrayList<>();\n         try {", "originalCommit": "80b4fca970b1ca6a3c87296b4902def9718173c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a49ee35a132e2c203422c816bcbbfb30967ac4df", "chunk": "diff --git a/src/main/java/de/bonndan/nivio/input/StartupListener.java b/src/main/java/de/bonndan/nivio/input/StartupListener.java\nindex 1cb363b6..0554c306 100644\n--- a/src/main/java/de/bonndan/nivio/input/StartupListener.java\n+++ b/src/main/java/de/bonndan/nivio/input/StartupListener.java\n\n@@ -55,28 +50,17 @@ public class StartupListener implements ApplicationListener<ApplicationReadyEven\n     }\n \n     private List<URL> getUrls(Seed seed) {\n-        List<URL> landscapeDescriptionLocations = new ArrayList<>();\n-        try {\n-            if (seed.hasValue()) {\n-                List<String> strList = seed.getLocations();\n-                List<String> errorMsgList = new ArrayList<>();\n-                for (String s : strList) {\n-                    URL tmpURL = URLHelper.getURL(s);\n-                    if (tmpURL != null) {\n-                        landscapeDescriptionLocations.add(tmpURL);\n-                    } else {\n-                        errorMsgList.add(\"Failed to create URL from \" + s);\n-                    }\n-                }\n-                if (errorMsgList.size() > 0) {\n-                    throw new MalformedURLException(String.join(\", \", errorMsgList));\n-                }\n-            }\n-            if (!StringUtils.isEmpty(System.getenv(Seed.DEMO))) {\n-                landscapeDescriptionLocations.addAll(seed.getDemoFiles());\n+        List<URL> landscapeDescriptionLocations = new ArrayList<>(seed.getDemoFiles());\n+        for (String s : seed.getLocations()) {\n+            URL tmpURL = URLHelper.getURL(s);\n+            if (tmpURL != null) {\n+                landscapeDescriptionLocations.add(tmpURL);\n+                continue;\n             }\n-        } catch (MalformedURLException e) {\n-            ProcessingException processingException = new ProcessingException(\"Failed to initialize watchers from seed\", e);\n+            ProcessingException processingException = new ProcessingException(\n+                    \"Failed to initialize watchers from seed\",\n+                    new MalformedURLException(\"Failed to create URL from \" + s)\n+            );\n             publisher.publishEvent(new ProcessingErrorEvent(this, processingException));\n         }\n         return landscapeDescriptionLocations;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODYzNA==", "url": "https://github.com/dedica-team/nivio/pull/178#discussion_r450968634", "bodyText": "@basseur will hate that ;)", "author": "bonndan", "createdAt": "2020-07-07T15:51:46Z", "path": "src/main/java/de/bonndan/nivio/util/URLHelper.java", "diffHunk": "@@ -13,38 +13,39 @@\n import java.util.Objects;\n \n public class URLHelper {\n-\n     public static boolean isLocal(URL url) {\n         return Objects.nonNull(url) && url.toString().startsWith(\"file:/\");\n     }\n \n     /**\n      * Returns an URL is the string is an URL.\n-     *\n+     * <p>\n      * Tries to create an URL if a path is given.\n      *\n      * @param url string url or local path to file\n      * @return an URL or null\n      */\n     @Nullable\n     public static URL getURL(String url) {\n-        if (url == null) {\n+        if (url == null)", "originalCommit": "80b4fca970b1ca6a3c87296b4902def9718173c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "a49ee35a132e2c203422c816bcbbfb30967ac4df", "url": "https://github.com/dedica-team/nivio/commit/a49ee35a132e2c203422c816bcbbfb30967ac4df", "message": "[#169] cleanup\n\nSeed: remove hasValue, update getDemoFiles to return an empty List<URL> if DEMO env var is not set\n\nStartupListener: cleanup getUrls Function", "committedDate": "2020-07-08T08:48:53Z", "type": "commit"}]}