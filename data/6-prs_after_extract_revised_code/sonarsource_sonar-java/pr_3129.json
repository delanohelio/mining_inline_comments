{"pr_number": 3129, "pr_title": "SONARJAVA-3447 FN on S2259 when a method is annotated with spring's annotation @Nullable", "pr_createdAt": "2020-08-06T08:31:18Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3129", "timeline": [{"oid": "1a8a23101535f61495cb74e51bdba8d47bc5f13f", "url": "https://github.com/SonarSource/sonar-java/commit/1a8a23101535f61495cb74e51bdba8d47bc5f13f", "message": "SONARJAVA-3447 FN on S2259 when a method is annotated with spring's annotation @Nullable", "committedDate": "2020-08-06T08:01:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg0ODk1MQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3129#discussion_r466848951", "bodyText": "you can avoid calling two times syntaxNode.symbol().metadata() by storing it first.", "author": "m-g-sonar", "createdAt": "2020-08-07T06:35:45Z", "path": "java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java", "diffHunk": "@@ -222,7 +222,9 @@ public ProgramState checkPostStatement(CheckerContext context, Tree syntaxNode)\n   }\n \n   private static boolean isAnnotatedCheckForNull(MethodInvocationTree syntaxNode) {\n-    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\");\n+    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\")", "originalCommit": "1a8a23101535f61495cb74e51bdba8d47bc5f13f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c2a775f62913b75addc45f956f0ebd98986304c", "chunk": "diff --git a/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java b/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\nindex 83ad7296e..e6f8abcf9 100644\n--- a/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\n+++ b/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\n\n@@ -221,12 +224,6 @@ public class NullDereferenceCheck extends SECheck {\n     return Lists.newArrayList(context.getState());\n   }\n \n-  private static boolean isAnnotatedCheckForNull(MethodInvocationTree syntaxNode) {\n-    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\")\n-      // Despite the name, Spring Nullable is meant to be used as CheckForNull\n-      || syntaxNode.symbol().metadata().isAnnotatedWith(\"org.springframework.lang.Nullable\");\n-  }\n-\n   @Override\n   public void checkEndOfExecutionPath(CheckerContext context, ConstraintManager constraintManager) {\n     EXCEPTIONAL_YIELD_CHECKER.reportOnExceptionalYield(context.getNode(), this);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg1MTAyNw==", "url": "https://github.com/SonarSource/sonar-java/pull/3129#discussion_r466851027", "bodyText": "In fact, I think we should rather rely on the NullnessAnnotationUtils class here, and move this method there.\nThere is already a list of nullable annotations, and I believe we should do another pass on the Nullable annotations list, to check if some of them are in fact strong nullness constraints (a la javax CheckForNull), and not weak (a la javax Nullable), to be used in such context.", "author": "m-g-sonar", "createdAt": "2020-08-07T06:41:19Z", "path": "java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java", "diffHunk": "@@ -222,7 +222,9 @@ public ProgramState checkPostStatement(CheckerContext context, Tree syntaxNode)\n   }\n \n   private static boolean isAnnotatedCheckForNull(MethodInvocationTree syntaxNode) {\n-    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\");\n+    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\")\n+      // Despite the name, Spring Nullable is meant to be used as CheckForNull\n+      || syntaxNode.symbol().metadata().isAnnotatedWith(\"org.springframework.lang.Nullable\");", "originalCommit": "1a8a23101535f61495cb74e51bdba8d47bc5f13f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c2a775f62913b75addc45f956f0ebd98986304c", "chunk": "diff --git a/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java b/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\nindex 83ad7296e..e6f8abcf9 100644\n--- a/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\n+++ b/java-frontend/src/main/java/org/sonar/java/se/checks/NullDereferenceCheck.java\n\n@@ -221,12 +224,6 @@ public class NullDereferenceCheck extends SECheck {\n     return Lists.newArrayList(context.getState());\n   }\n \n-  private static boolean isAnnotatedCheckForNull(MethodInvocationTree syntaxNode) {\n-    return syntaxNode.symbol().metadata().isAnnotatedWith(\"javax.annotation.CheckForNull\")\n-      // Despite the name, Spring Nullable is meant to be used as CheckForNull\n-      || syntaxNode.symbol().metadata().isAnnotatedWith(\"org.springframework.lang.Nullable\");\n-  }\n-\n   @Override\n   public void checkEndOfExecutionPath(CheckerContext context, ConstraintManager constraintManager) {\n     EXCEPTIONAL_YIELD_CHECKER.reportOnExceptionalYield(context.getNode(), this);\n"}}, {"oid": "8c2a775f62913b75addc45f956f0ebd98986304c", "url": "https://github.com/SonarSource/sonar-java/commit/8c2a775f62913b75addc45f956f0ebd98986304c", "message": "Move static method to NullableAnnotationUtils", "committedDate": "2020-08-07T08:55:06Z", "type": "commit"}]}