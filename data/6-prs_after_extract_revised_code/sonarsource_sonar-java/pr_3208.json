{"pr_number": 3208, "pr_title": "Fix too many assertions issue", "pr_createdAt": "2020-09-22T16:05:28Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3208", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwNTYyMQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3208#discussion_r493405621", "bodyText": "Just a small comment about this: I'm not a big fan of having two classes at the same level in a compilation unit, just one being not public. I would prefer to make it a public static method inside the other one, or a dedicated class in its own compilation unit.\nAlso, what about making it inherit from AssertJ's AbstractAssert?\nhttps://joel-costigliola.github.io/assertj/assertj-core-custom-assertions.html", "author": "m-g-sonar", "createdAt": "2020-09-23T10:08:58Z", "path": "external-reports/src/test/java/org/sonar/java/externalreport/PmdSensorTest.java", "diffHunk": "@@ -218,3 +223,66 @@ private static String language(Path file) {\n     return path.substring(path.lastIndexOf('.') + 1);\n   }\n }\n+\n+class ExternalIssueAsserter {", "originalCommit": "c0a2b0082da4b784949cb440b87d67c713f89d7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5NzQ3NQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3208#discussion_r493697475", "bodyText": "I thought about AssertJ approach. Unfortunately, I am not sure we'll benefit much from it. Cause we still have to implement all needed assertions logic.\nI also changed the logic of assertions, so there is only one point to get an assertion error and we'll have all the error messages collected.", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-09-23T15:43:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwNTYyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA3MzQ2OQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3208#discussion_r494073469", "bodyText": "Fine by me :)\nI just believe that the more we stay closer from how AssertJ operate, the higher is the chance to have it reused somewhere in our own tests.", "author": "m-g-sonar", "createdAt": "2020-09-24T06:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwNTYyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "2457b10dea59095250bba2ae43b73fa360d5eb43", "chunk": "diff --git a/external-reports/src/test/java/org/sonar/java/externalreport/PmdSensorTest.java b/external-reports/src/test/java/org/sonar/java/externalreport/PmdSensorTest.java\nindex d09856f97..510f00474 100644\n--- a/external-reports/src/test/java/org/sonar/java/externalreport/PmdSensorTest.java\n+++ b/external-reports/src/test/java/org/sonar/java/externalreport/PmdSensorTest.java\n\n@@ -223,66 +225,3 @@ class PmdSensorTest {\n     return path.substring(path.lastIndexOf('.') + 1);\n   }\n }\n-\n-class ExternalIssueAsserter {\n-  static ExternalIssueAsserter assertExternalIssue(ExternalIssue issue) {\n-    return new ExternalIssueAsserter(issue);\n-  }\n-\n-  private final ExternalIssue issue;\n-\n-  public ExternalIssueAsserter(ExternalIssue issue) {\n-    this.issue = issue;\n-  }\n-\n-  public ExternalIssueAsserter fileName(String fileName) {\n-    assertThat(issue.primaryLocation().inputComponent().key()).isEqualTo(fileName);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter engineId(String engineId) {\n-    assertThat(issue.engineId()).isEqualTo(engineId);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter ruleId(String ruleId) {\n-    assertThat(issue.ruleId()).isEqualTo(ruleId);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter ruleKey(String ruleKey) {\n-    assertThat(issue.ruleKey().rule()).isEqualTo(ruleKey);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter ruleType(RuleType ruleType) {\n-    assertThat(issue.type()).isEqualTo(ruleType);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter severity(Severity severity) {\n-    assertThat(issue.severity()).isEqualTo(severity);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter message(String message) {\n-    assertThat(issue.primaryLocation().message()).isEqualTo(message);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter textRange(TextRange textRange) {\n-    assertThat(issue.primaryLocation().textRange()).isEqualTo(textRange);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter textRangeStartLine(int textRangeStartLine) {\n-    assertThat(issue.primaryLocation().textRange().start().line()).isEqualTo(textRangeStartLine);\n-    return this;\n-  }\n-\n-  public ExternalIssueAsserter remediationEffort(int remediationEffort) {\n-    assertThat(issue.remediationEffort()).isEqualTo(remediationEffort);\n-    return this;\n-  }\n-}\n-\n"}}, {"oid": "2457b10dea59095250bba2ae43b73fa360d5eb43", "url": "https://github.com/SonarSource/sonar-java/commit/2457b10dea59095250bba2ae43b73fa360d5eb43", "message": "Refactoring", "committedDate": "2020-09-23T15:38:59Z", "type": "forcePushed"}, {"oid": "b2bc852c07e1aa359322e0f00c017912ba7700a0", "url": "https://github.com/SonarSource/sonar-java/commit/b2bc852c07e1aa359322e0f00c017912ba7700a0", "message": "Refactoring", "committedDate": "2020-09-23T15:44:21Z", "type": "forcePushed"}, {"oid": "239fa0d94ba21c7a0e05190297a8bcece757b7f9", "url": "https://github.com/SonarSource/sonar-java/commit/239fa0d94ba21c7a0e05190297a8bcece757b7f9", "message": "Refactoring", "committedDate": "2020-09-23T15:53:54Z", "type": "forcePushed"}, {"oid": "499de01dc1623c5b2106e26537dbf6200779afc5", "url": "https://github.com/SonarSource/sonar-java/commit/499de01dc1623c5b2106e26537dbf6200779afc5", "message": "Fix too many assertions issue by introducing chained assertions", "committedDate": "2020-09-24T07:54:20Z", "type": "commit"}, {"oid": "499de01dc1623c5b2106e26537dbf6200779afc5", "url": "https://github.com/SonarSource/sonar-java/commit/499de01dc1623c5b2106e26537dbf6200779afc5", "message": "Fix too many assertions issue by introducing chained assertions", "committedDate": "2020-09-24T07:54:20Z", "type": "forcePushed"}, {"oid": "a77fdc7e7e4ffcaf6789c809b4ca4e0b4f9f27a3", "url": "https://github.com/SonarSource/sonar-java/commit/a77fdc7e7e4ffcaf6789c809b4ca4e0b4f9f27a3", "message": "Extend AssertJ class assertion approach", "committedDate": "2020-09-24T08:28:33Z", "type": "commit"}, {"oid": "a77fdc7e7e4ffcaf6789c809b4ca4e0b4f9f27a3", "url": "https://github.com/SonarSource/sonar-java/commit/a77fdc7e7e4ffcaf6789c809b4ca4e0b4f9f27a3", "message": "Extend AssertJ class assertion approach", "committedDate": "2020-09-24T08:28:33Z", "type": "forcePushed"}]}