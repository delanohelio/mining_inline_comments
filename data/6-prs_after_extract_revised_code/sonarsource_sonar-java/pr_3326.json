{"pr_number": 3326, "pr_title": "SONARJAVA-2154 Remove usages of guava annotations from java-frontend module", "pr_createdAt": "2020-12-07T10:20:29Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3326", "timeline": [{"oid": "503230a4ad0ff931f8242503e8bbd4c4af34eac3", "url": "https://github.com/SonarSource/sonar-java/commit/503230a4ad0ff931f8242503e8bbd4c4af34eac3", "message": "Remove usages of com.google.common.base package from java-frontend module", "committedDate": "2020-12-07T14:31:48Z", "type": "forcePushed"}, {"oid": "568a9d61b3778ef8a65158bcbd3ac5aaa2a2372d", "url": "https://github.com/SonarSource/sonar-java/commit/568a9d61b3778ef8a65158bcbd3ac5aaa2a2372d", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-08T11:20:52Z", "type": "forcePushed"}, {"oid": "11998f2c5c0a1e39cf6e6eb676e8384bd4fc4abc", "url": "https://github.com/SonarSource/sonar-java/commit/11998f2c5c0a1e39cf6e6eb676e8384bd4fc4abc", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-08T11:26:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ5MjkyMA==", "url": "https://github.com/SonarSource/sonar-java/pull/3326#discussion_r538492920", "bodyText": "If I understand correctly, this code is inspired by the one from Guava, and is used to detect loops at the same time. Still, I believe it could use a few comments explaining the idea behind it.\nIn addition, we should cover this code somehow.", "author": "quentin-jaquier-sonarsource", "createdAt": "2020-12-08T15:23:20Z", "path": "java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java", "diffHunk": "@@ -305,4 +304,21 @@ private final void forEach(Collection<SubscriptionVisitor> visitors, Consumer<Su\n       }\n     }\n   }\n+  private static Throwable getRootCause(Throwable throwable) {", "originalCommit": "4b40f81983cff3537cbd6884b72167f148ee1dc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMjk1NA==", "url": "https://github.com/SonarSource/sonar-java/pull/3326#discussion_r539202954", "bodyText": "Yes, the code is actually the same as in guava. It uses the standard algorithm to find a loop, which is having 2 pointers. one normal and other 2x times slower, increments on each second iteration. And if at some point 2 pointers are equal it means that we have a cycle here.", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-12-09T10:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ5MjkyMA=="}], "type": "inlineReview", "revised_code": {"commit": "3966ef074c7e47e0f0463ccdb2691dedc38a6d58", "chunk": "diff --git a/java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java b/java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java\nindex 332238cc4..eb76ccec0 100644\n--- a/java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java\n+++ b/java-frontend/src/main/java/org/sonar/java/model/VisitorsBridge.java\n\n@@ -304,21 +305,4 @@ public class VisitorsBridge {\n       }\n     }\n   }\n-  private static Throwable getRootCause(Throwable throwable) {\n-    Throwable slowPointer = throwable;\n-\n-    Throwable cause;\n-    for(boolean advanceSlowPointer = false; (cause = throwable.getCause()) != null; advanceSlowPointer = !advanceSlowPointer) {\n-      throwable = cause;\n-      if (cause == slowPointer) {\n-        throw new IllegalArgumentException(\"Loop in causal chain detected.\", cause);\n-      }\n-\n-      if (advanceSlowPointer) {\n-        slowPointer = slowPointer.getCause();\n-      }\n-    }\n-\n-    return throwable;\n-  }\n }\n"}}, {"oid": "3966ef074c7e47e0f0463ccdb2691dedc38a6d58", "url": "https://github.com/SonarSource/sonar-java/commit/3966ef074c7e47e0f0463ccdb2691dedc38a6d58", "message": "SONARJAVA-2154 Remove usages of guava VisibleForTesting annotation from sonar-java-frontend module", "committedDate": "2020-12-09T09:47:15Z", "type": "commit"}, {"oid": "e9f9c2b6ff116de1f5b885d793bdaf5dce285c9a", "url": "https://github.com/SonarSource/sonar-java/commit/e9f9c2b6ff116de1f5b885d793bdaf5dce285c9a", "message": "SONARJAVA-2154 Remove usages of guava Beta annotation from sonar-java-frontend module", "committedDate": "2020-12-09T09:48:07Z", "type": "commit"}, {"oid": "334d381329284e84e7c93ffd7e6222dff303d512", "url": "https://github.com/SonarSource/sonar-java/commit/334d381329284e84e7c93ffd7e6222dff303d512", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-09T10:17:13Z", "type": "forcePushed"}, {"oid": "94380ec2e77c03f3b0f45f981b2ce492278a48a5", "url": "https://github.com/SonarSource/sonar-java/commit/94380ec2e77c03f3b0f45f981b2ce492278a48a5", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-09T10:49:13Z", "type": "forcePushed"}, {"oid": "554f06d6739fce1ad1d4a8e7e3cdc41e2eb15b4a", "url": "https://github.com/SonarSource/sonar-java/commit/554f06d6739fce1ad1d4a8e7e3cdc41e2eb15b4a", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-09T10:53:02Z", "type": "forcePushed"}, {"oid": "c2c08795c9c6a96f601d9a73cae46538178dae14", "url": "https://github.com/SonarSource/sonar-java/commit/c2c08795c9c6a96f601d9a73cae46538178dae14", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-09T11:06:17Z", "type": "commit"}, {"oid": "c2c08795c9c6a96f601d9a73cae46538178dae14", "url": "https://github.com/SonarSource/sonar-java/commit/c2c08795c9c6a96f601d9a73cae46538178dae14", "message": "SONARJAVA-2154 Remove usages of guava base package from java-frontend module", "committedDate": "2020-12-09T11:06:17Z", "type": "forcePushed"}]}