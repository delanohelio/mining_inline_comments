{"pr_number": 3357, "pr_title": "SONARJAVA-3555 S4830: Report issues on empty implementations of X509ExtendedTrustManager methods", "pr_createdAt": "2020-12-17T13:54:37Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3357", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNzU3NQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3357#discussion_r545717575", "bodyText": "I suppose you haven't face it yet. But each time there is a call to hasSemantic() we're removing this condition. It was useful before frontend was migrated to Eclipse now it's not actually emulating real behaviour, because Eclipse try to resolve as much as possible and put unknown in case uf incomplete semantic.\nSo now we're removing it and adding tests .withoutSemantic() (If it fails you need to review issues and understand why this is happening)", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-12-18T09:45:29Z", "path": "java-checks/src/main/java/org/sonar/java/checks/security/ServerCertificatesCheck.java", "diffHunk": "@@ -38,12 +38,22 @@\n @DeprecatedRuleKey(ruleKey = \"S4424\", repositoryKey = \"java\")\n @Rule(key = \"S4830\")\n public class ServerCertificatesCheck extends IssuableSubscriptionVisitor {\n+  private static final String JAVA_LANG_STRING = \"java.lang.String\";\n+  private static final String X509_CERTIFICATE_ARRAY = \"java.security.cert.X509Certificate[]\";\n \n-  private static final MethodMatchers CHECK_MATCHER = MethodMatchers.create()\n-    .ofSubTypes(\"javax.net.ssl.X509TrustManager\")\n-    .names(\"checkClientTrusted\", \"checkServerTrusted\")\n-    .addParametersMatcher(\"java.security.cert.X509Certificate[]\", \"java.lang.String\")\n-    .build();\n+  private static final MethodMatchers TRUST_MANAGER_MATCHER = MethodMatchers.or(\n+    MethodMatchers.create()\n+      .ofSubTypes(\"javax.net.ssl.X509TrustManager\")\n+      .names(\"checkClientTrusted\", \"checkServerTrusted\")\n+      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING)\n+      .build(),\n+    MethodMatchers.create()\n+      .ofSubTypes(\"javax.net.ssl.X509ExtendedTrustManager\")\n+      .names(\"checkClientTrusted\", \"checkServerTrusted\")\n+      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING, \"java.net.Socket\")\n+      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING, \"javax.net.ssl.SSLEngine\")\n+      .build()\n+  );\n \n   @Override\n   public List<Tree.Kind> nodesToVisit() {", "originalCommit": "09a2ded81190ad40368c3eaeda95844dc41fff5c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "96f02cb2e7926620943e98e2b6e6dc8ee2a9c0bf", "chunk": "diff --git a/java-checks/src/main/java/org/sonar/java/checks/security/ServerCertificatesCheck.java b/java-checks/src/main/java/org/sonar/java/checks/security/ServerCertificatesCheck.java\nindex 538b08a1a..144d783cf 100644\n--- a/java-checks/src/main/java/org/sonar/java/checks/security/ServerCertificatesCheck.java\n+++ b/java-checks/src/main/java/org/sonar/java/checks/security/ServerCertificatesCheck.java\n\n@@ -38,22 +38,24 @@ import org.sonarsource.analyzer.commons.annotations.DeprecatedRuleKey;\n @DeprecatedRuleKey(ruleKey = \"S4424\", repositoryKey = \"java\")\n @Rule(key = \"S4830\")\n public class ServerCertificatesCheck extends IssuableSubscriptionVisitor {\n-  private static final String JAVA_LANG_STRING = \"java.lang.String\";\n-  private static final String X509_CERTIFICATE_ARRAY = \"java.security.cert.X509Certificate[]\";\n \n-  private static final MethodMatchers TRUST_MANAGER_MATCHER = MethodMatchers.or(\n-    MethodMatchers.create()\n-      .ofSubTypes(\"javax.net.ssl.X509TrustManager\")\n-      .names(\"checkClientTrusted\", \"checkServerTrusted\")\n-      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING)\n-      .build(),\n-    MethodMatchers.create()\n-      .ofSubTypes(\"javax.net.ssl.X509ExtendedTrustManager\")\n-      .names(\"checkClientTrusted\", \"checkServerTrusted\")\n-      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING, \"java.net.Socket\")\n-      .addParametersMatcher(X509_CERTIFICATE_ARRAY, JAVA_LANG_STRING, \"javax.net.ssl.SSLEngine\")\n-      .build()\n-  );\n+  private static final MethodMatchers CHECK_MATCHER = MethodMatchers.create()\n+    .ofSubTypes(\"javax.net.ssl.X509TrustManager\", \"javax.net.ssl.X509ExtendedTrustManager\")\n+    .names(\"checkClientTrusted\", \"checkServerTrusted\")\n+    .addParametersMatcher(\"java.security.cert.X509Certificate[]\", \"java.lang.String\")\n+    .build();\n+\n+  private static final MethodMatchers SOCKET_BASED_MATCHER = MethodMatchers.create()\n+    .ofSubTypes(\"javax.net.ssl.X509ExtendedTrustManager\")\n+    .names(\"checkClientTrusted\", \"checkServerTrusted\")\n+    .addParametersMatcher(\"java.security.cert.X509Certificate[]\", \"java.lang.String\", \"java.net.Socket\")\n+    .build();\n+\n+  private static final MethodMatchers SSLENGINE_BASED_MATCHER = MethodMatchers.create()\n+    .ofSubTypes(\"javax.net.ssl.X509ExtendedTrustManager\")\n+    .names(\"checkClientTrusted\", \"checkServerTrusted\")\n+    .addParametersMatcher(\"java.security.cert.X509Certificate[]\", \"java.lang.String\", \"javax.net.ssl.SSLEngine\")\n+    .build();\n \n   @Override\n   public List<Tree.Kind> nodesToVisit() {\n"}}, {"oid": "96f02cb2e7926620943e98e2b6e6dc8ee2a9c0bf", "url": "https://github.com/SonarSource/sonar-java/commit/96f02cb2e7926620943e98e2b6e6dc8ee2a9c0bf", "message": "SONARJAVA-3555 S4830: Report issues on empty implementations of X509ExtendedTrustManager methods", "committedDate": "2020-12-18T11:00:39Z", "type": "commit"}, {"oid": "97588078c5037973820e8512a60b539d5e47d9a2", "url": "https://github.com/SonarSource/sonar-java/commit/97588078c5037973820e8512a60b539d5e47d9a2", "message": "SONARJAVA-3555 S4830: Refactor method matching", "committedDate": "2020-12-18T11:00:39Z", "type": "commit"}, {"oid": "3560c9dbf35c1db2517eb9ae4b5b0f945cc387c7", "url": "https://github.com/SonarSource/sonar-java/commit/3560c9dbf35c1db2517eb9ae4b5b0f945cc387c7", "message": "SONARJAVA-3555 S4830: Remove guard against use without semantic", "committedDate": "2020-12-18T11:00:39Z", "type": "commit"}, {"oid": "3560c9dbf35c1db2517eb9ae4b5b0f945cc387c7", "url": "https://github.com/SonarSource/sonar-java/commit/3560c9dbf35c1db2517eb9ae4b5b0f945cc387c7", "message": "SONARJAVA-3555 S4830: Remove guard against use without semantic", "committedDate": "2020-12-18T11:00:39Z", "type": "forcePushed"}]}