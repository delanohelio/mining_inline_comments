{"pr_number": 309, "pr_title": "[Optimization] Memoize results of resolveIndexPatterns for Bulk requests", "pr_createdAt": "2020-03-23T11:34:51Z", "pr_url": "https://github.com/opensearch-project/security/pull/309", "timeline": [{"oid": "28735a232083be890efd184e2373c0b35f90664d", "url": "https://github.com/opensearch-project/security/commit/28735a232083be890efd184e2373c0b35f90664d", "message": "Speedup resolveIndexPatterns, using per-request resolve mask\n\nIntroduce per request resolve mask, this allows us to bypass the whole resolveIndexPatterns+builder.add combo\nif multiple writes in one request go to the same alias/index. This is the common case in bulk indexing.", "committedDate": "2020-03-23T12:05:38Z", "type": "commit"}, {"oid": "28735a232083be890efd184e2373c0b35f90664d", "url": "https://github.com/opensearch-project/security/commit/28735a232083be890efd184e2373c0b35f90664d", "message": "Speedup resolveIndexPatterns, using per-request resolve mask\n\nIntroduce per request resolve mask, this allows us to bypass the whole resolveIndexPatterns+builder.add combo\nif multiple writes in one request go to the same alias/index. This is the common case in bulk indexing.", "committedDate": "2020-03-23T12:05:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwOTMyNA==", "url": "https://github.com/opensearch-project/security/pull/309#discussion_r399009324", "bodyText": "The only comment that is related to new variable name. Not very intuitive.\nI was thinking initially to renamed it to \"isSearchOrFieldsCapabilitiesRequest\", but Vlad suggested a better one \"enableCrossClusterResolution\", since this variable is basically indicating if we need to do cross-cluster resolution based on type of the request.", "author": "dinusX", "createdAt": "2020-03-27T03:00:37Z", "path": "src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java", "diffHunk": "@@ -161,7 +159,7 @@ private static final boolean isLocalAll(final String... requestedPatterns) {\n         return false;\n     }\n \n-    private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final Object request, final String... requestedPatterns0) {\n+    private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final boolean isSearchOrFieldsCapabilities, final String... requestedPatterns0) {", "originalCommit": "28735a232083be890efd184e2373c0b35f90664d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMxMzgxOA==", "url": "https://github.com/opensearch-project/security/pull/309#discussion_r399313818", "bodyText": "Done, sounds  better for sure", "author": "DmitryOlshansky", "createdAt": "2020-03-27T14:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwOTMyNA=="}], "type": "inlineReview", "revised_code": {"commit": "3141e3b4785168b07ffa8715c73d6836ccd26bc7", "chunk": "diff --git a/src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java b/src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java\nindex 56b4b864..2265f0bc 100644\n--- a/src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java\n+++ b/src/main/java/com/amazon/opendistroforelasticsearch/security/resolver/IndexResolverReplacer.java\n\n@@ -159,7 +159,7 @@ public final class IndexResolverReplacer implements DCFListener {\n         return false;\n     }\n \n-    private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final boolean isSearchOrFieldsCapabilities, final String... requestedPatterns0) {\n+    private Resolved resolveIndexPatterns(final IndicesOptions indicesOptions, final boolean enableCrossClusterResolution, final String... requestedPatterns0) {\n \n         if(log.isTraceEnabled()) {\n             log.trace(\"resolve requestedPatterns: \"+ Arrays.toString(requestedPatterns0));\n"}}, {"oid": "3141e3b4785168b07ffa8715c73d6836ccd26bc7", "url": "https://github.com/opensearch-project/security/commit/3141e3b4785168b07ffa8715c73d6836ccd26bc7", "message": "Rename parameter as per review", "committedDate": "2020-03-27T16:17:23Z", "type": "commit"}, {"oid": "3141e3b4785168b07ffa8715c73d6836ccd26bc7", "url": "https://github.com/opensearch-project/security/commit/3141e3b4785168b07ffa8715c73d6836ccd26bc7", "message": "Rename parameter as per review", "committedDate": "2020-03-27T16:17:23Z", "type": "forcePushed"}]}