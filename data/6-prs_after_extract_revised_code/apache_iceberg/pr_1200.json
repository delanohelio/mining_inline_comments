{"pr_number": 1200, "pr_title": "HadoopCatalog.dropNamespace throw NamespaceNotEmptyException when Namespace is not empty", "pr_createdAt": "2020-07-14T03:06:43Z", "pr_url": "https://github.com/apache/iceberg/pull/1200", "timeline": [{"oid": "b74a2093e5a0ac7a472ba887f5d5c4704c61665f", "url": "https://github.com/apache/iceberg/commit/b74a2093e5a0ac7a472ba887f5d5c4704c61665f", "message": "HadoopCatalog.dropNamespace should throw NamespaceNotEmptyException when Namespace is not empty", "committedDate": "2020-07-14T03:03:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMTI4NA==", "url": "https://github.com/apache/iceberg/pull/1200#discussion_r454121284", "bodyText": "listStatus returns an array which means it lists all the files before returning. Should we use listFiles which returns an Iterator. Iterator could be a lot more efficient as we do not need to list all the underlying files in the dir and we can simply do listFiles.hasNext", "author": "rdsr", "createdAt": "2020-07-14T06:02:20Z", "path": "core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java", "diffHunk": "@@ -276,8 +277,11 @@ public boolean dropNamespace(Namespace namespace) {\n     }\n \n     try {\n-      return fs.delete(nsPath, false /* recursive */);\n+      if (fs.listStatus(nsPath).length != 0) {", "originalCommit": "b74a2093e5a0ac7a472ba887f5d5c4704c61665f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEzNjIxMw==", "url": "https://github.com/apache/iceberg/pull/1200#discussion_r454136213", "bodyText": "Good point! Sounds good to me. We can use listStatusIterator.", "author": "JingsongLi", "createdAt": "2020-07-14T06:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMTI4NA=="}], "type": "inlineReview", "revised_code": {"commit": "1cad65e4893b746b365c0b6169e927244e80c008", "chunk": "diff --git a/core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java b/core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java\nindex b1df7b4d9..b9766424c 100644\n--- a/core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java\n+++ b/core/src/main/java/org/apache/iceberg/hadoop/HadoopCatalog.java\n\n@@ -277,7 +277,7 @@ public class HadoopCatalog extends BaseMetastoreCatalog implements Closeable, Su\n     }\n \n     try {\n-      if (fs.listStatus(nsPath).length != 0) {\n+      if (fs.listStatusIterator(nsPath).hasNext()) {\n         throw new NamespaceNotEmptyException(\"Namespace \" + namespace + \" is not empty.\");\n       }\n \n"}}, {"oid": "1cad65e4893b746b365c0b6169e927244e80c008", "url": "https://github.com/apache/iceberg/commit/1cad65e4893b746b365c0b6169e927244e80c008", "message": "Fix comments", "committedDate": "2020-07-14T06:42:23Z", "type": "commit"}]}