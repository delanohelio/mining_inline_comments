{"pr_number": 1149, "pr_title": "Support namespaces in SparkCatalog", "pr_createdAt": "2020-07-01T04:36:02Z", "pr_url": "https://github.com/apache/iceberg/pull/1149", "timeline": [{"oid": "c742c1e2762e1dfaf1d99bbbfbc8911c04ae1075", "url": "https://github.com/apache/iceberg/commit/c742c1e2762e1dfaf1d99bbbfbc8911c04ae1075", "message": "Support namespaces in SparkCatalog.", "committedDate": "2020-07-01T04:42:18Z", "type": "forcePushed"}, {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "url": "https://github.com/apache/iceberg/commit/1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "message": "Support namespaces in SparkCatalog.", "committedDate": "2020-07-01T17:56:57Z", "type": "commit"}, {"oid": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "url": "https://github.com/apache/iceberg/commit/1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "message": "Support namespaces in SparkCatalog.", "committedDate": "2020-07-01T17:56:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NjQyMw==", "url": "https://github.com/apache/iceberg/pull/1149#discussion_r448646423", "bodyText": "Maybe I'm missing something here, but doesn't this actually break for HadoopCatalog without the default set of keys (it'll drop through and be rejected in the else block)?", "author": "danielcweeks", "createdAt": "2020-07-01T22:22:42Z", "path": "spark3/src/main/java/org/apache/iceberg/spark/SparkCatalog.java", "diffHunk": "@@ -228,13 +247,141 @@ public void invalidateTable(Identifier ident) {\n     }\n   }\n \n+  @Override\n+  public Identifier[] listTables(String[] namespace) {\n+    return icebergCatalog.listTables(Namespace.of(namespace)).stream()\n+        .map(ident -> Identifier.of(ident.namespace().levels(), ident.name()))\n+        .toArray(Identifier[]::new);\n+  }\n+\n+  @Override\n+  public String[] defaultNamespace() {\n+    if (defaultNamespace != null) {\n+      return defaultNamespace;\n+    }\n+\n+    return new String[0];\n+  }\n+\n+  @Override\n+  public String[][] listNamespaces() {\n+    if (asNamespaceCatalog != null) {\n+      return asNamespaceCatalog.listNamespaces().stream()\n+          .map(Namespace::levels)\n+          .toArray(String[][]::new);\n+    }\n+\n+    return new String[0][];\n+  }\n+\n+  @Override\n+  public String[][] listNamespaces(String[] namespace) throws NoSuchNamespaceException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        return asNamespaceCatalog.listNamespaces(Namespace.of(namespace)).stream()\n+            .map(Namespace::levels)\n+            .toArray(String[][]::new);\n+      } catch (org.apache.iceberg.exceptions.NoSuchNamespaceException e) {\n+        throw new NoSuchNamespaceException(namespace);\n+      }\n+    }\n+\n+    throw new NoSuchNamespaceException(namespace);\n+  }\n+\n+  @Override\n+  public Map<String, String> loadNamespaceMetadata(String[] namespace) throws NoSuchNamespaceException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        return asNamespaceCatalog.loadNamespaceMetadata(Namespace.of(namespace));\n+      } catch (org.apache.iceberg.exceptions.NoSuchNamespaceException e) {\n+        throw new NoSuchNamespaceException(namespace);\n+      }\n+    }\n+\n+    throw new NoSuchNamespaceException(namespace);\n+  }\n+\n+  @Override\n+  public void createNamespace(String[] namespace, Map<String, String> metadata) throws NamespaceAlreadyExistsException {\n+    if (asNamespaceCatalog != null) {\n+      try {\n+        if (asNamespaceCatalog instanceof HadoopCatalog && DEFAULT_NS_KEYS.equals(metadata.keySet())) {", "originalCommit": "1b7c104ffa75a813b49e3943f92a4dfe79dbda07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1MzQ3Mg==", "url": "https://github.com/apache/iceberg/pull/1149#discussion_r448653472", "bodyText": "Yes, that is the expected behavior if you create a namespace with metadata properties in the Hadoop catalog because there is nowhere to store them.", "author": "rdblue", "createdAt": "2020-07-01T22:43:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NjQyMw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "26f43d951f3d66a527244c8bc1b803aa08e22d4e", "url": "https://github.com/apache/iceberg/commit/26f43d951f3d66a527244c8bc1b803aa08e22d4e", "message": "Fix checkstyle problem in TestNamespaceSQL.", "committedDate": "2020-07-01T22:50:58Z", "type": "commit"}, {"oid": "396f23ba5dfa498892d6c1e712934893f03ce51b", "url": "https://github.com/apache/iceberg/commit/396f23ba5dfa498892d6c1e712934893f03ce51b", "message": "Make SparkCatalogTestBase abstract to avoid running it as a suite.", "committedDate": "2020-07-01T23:02:13Z", "type": "commit"}]}