{"pr_number": 1318, "pr_title": "Add equality field IDs to DeleteFile", "pr_createdAt": "2020-08-11T00:30:20Z", "pr_url": "https://github.com/apache/iceberg/pull/1318", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI4MjA3Ng==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468282076", "bodyText": "nit: incomplete sentence?", "author": "chenjunjiedada", "createdAt": "2020-08-11T01:57:34Z", "path": "api/src/main/java/org/apache/iceberg/ContentFile.java", "diffHunk": "@@ -97,6 +97,17 @@\n    */\n   List<Long> splitOffsets();\n \n+  /**\n+   * Returns the set of field IDs used for equality comparison, in equality delete files.\n+   * <p>\n+   * An equality delete file may contain additional data fields that are not used by equality\n+   * comparison. The subset of columns in a delete file to be used in equality comparison are\n+   * tracked by ID. Extra columns can be used to", "originalCommit": "146752e92f5ce067d773eb433fd16c42d0437291", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg3MDk3Nw==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468870977", "bodyText": "Fixed. Thanks!", "author": "rdblue", "createdAt": "2020-08-11T21:19:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI4MjA3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ba18751a16789e9f09f8e93381279bb331f03599", "chunk": "diff --git a/api/src/main/java/org/apache/iceberg/ContentFile.java b/api/src/main/java/org/apache/iceberg/ContentFile.java\nindex 423fe0192..625efffab 100644\n--- a/api/src/main/java/org/apache/iceberg/ContentFile.java\n+++ b/api/src/main/java/org/apache/iceberg/ContentFile.java\n\n@@ -102,7 +107,8 @@ public interface ContentFile<F> {\n    * <p>\n    * An equality delete file may contain additional data fields that are not used by equality\n    * comparison. The subset of columns in a delete file to be used in equality comparison are\n-   * tracked by ID. Extra columns can be used to\n+   * tracked by ID. Extra columns can be used to reconstruct changes and metrics from extra\n+   * columns are used during job planning.\n    *\n    * @return IDs of the fields used in equality comparison with the records in this delete file\n    */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxNzM1OA==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468317358", "bodyText": "If the data class pattern in Iceberg is:\n\nstores (primitive) arrays in class field.\nprovides List method to return this field.\n\nCan we add ArrayUtil class to provide toPrimitive and toList utils?", "author": "JingsongLi", "createdAt": "2020-08-11T04:20:02Z", "path": "core/src/main/java/org/apache/iceberg/BaseFile.java", "diffHunk": "@@ -385,7 +399,24 @@ public String toString() {\n         .add(\"lower_bounds\", lowerBounds)\n         .add(\"upper_bounds\", upperBounds)\n         .add(\"key_metadata\", keyMetadata == null ? \"null\" : \"(redacted)\")\n-        .add(\"split_offsets\", splitOffsets == null ? \"null\" : splitOffsets)\n+        .add(\"split_offsets\", splitOffsets == null ? \"null\" : splitOffsets())\n+        .add(\"equality_ids\", equalityIds == null ? \"null\" : equalityFieldIds())\n         .toString();\n   }\n+\n+  private static int[] toIntArray(List<Integer> ints) {", "originalCommit": "146752e92f5ce067d773eb433fd16c42d0437291", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg3MTA1Mw==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r468871053", "bodyText": "Moved to ArrayUtil.", "author": "rdblue", "createdAt": "2020-08-11T21:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODMxNzM1OA=="}], "type": "inlineReview", "revised_code": {"commit": "ba18751a16789e9f09f8e93381279bb331f03599", "chunk": "diff --git a/core/src/main/java/org/apache/iceberg/BaseFile.java b/core/src/main/java/org/apache/iceberg/BaseFile.java\nindex a0be6a007..24860bd2a 100644\n--- a/core/src/main/java/org/apache/iceberg/BaseFile.java\n+++ b/core/src/main/java/org/apache/iceberg/BaseFile.java\n\n@@ -404,19 +414,4 @@ abstract class BaseFile<F>\n         .toString();\n   }\n \n-  private static int[] toIntArray(List<Integer> ints) {\n-    if (ints != null) {\n-      return ints.stream().mapToInt(v -> v).toArray();\n-    } else {\n-      return null;\n-    }\n-  }\n-\n-  private static long[] toLongArray(List<Long> longs) {\n-    if (longs != null) {\n-      return longs.stream().mapToLong(v -> v).toArray();\n-    } else {\n-      return null;\n-    }\n-  }\n }\n"}}, {"oid": "ba18751a16789e9f09f8e93381279bb331f03599", "url": "https://github.com/apache/iceberg/commit/ba18751a16789e9f09f8e93381279bb331f03599", "message": "Add equality field IDs to DeleteFile.", "committedDate": "2020-08-11T23:40:27Z", "type": "commit"}, {"oid": "ba18751a16789e9f09f8e93381279bb331f03599", "url": "https://github.com/apache/iceberg/commit/ba18751a16789e9f09f8e93381279bb331f03599", "message": "Add equality field IDs to DeleteFile.", "committedDate": "2020-08-11T23:40:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzMjA2NA==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r469032064", "bodyText": "I think there might be a minor typo here - maybe after 'from extra'", "author": "rdsr", "createdAt": "2020-08-12T06:27:07Z", "path": "api/src/main/java/org/apache/iceberg/ContentFile.java", "diffHunk": "@@ -102,6 +102,18 @@\n    */\n   List<Long> splitOffsets();\n \n+  /**\n+   * Returns the set of field IDs used for equality comparison, in equality delete files.\n+   * <p>\n+   * An equality delete file may contain additional data fields that are not used by equality\n+   * comparison. The subset of columns in a delete file to be used in equality comparison are\n+   * tracked by ID. Extra columns can be used to reconstruct changes and metrics from extra", "originalCommit": "ba18751a16789e9f09f8e93381279bb331f03599", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ0ODQ1OQ==", "url": "https://github.com/apache/iceberg/pull/1318#discussion_r469448459", "bodyText": "I think it was intended. The second half of the sentence is \"Metrics from extra columns are used during job planning\". We might be able to rephrase it to avoid the double \"extra columns\", but I wanted to be clear that the metrics are coming from the extra columns.", "author": "rdblue", "createdAt": "2020-08-12T18:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzMjA2NA=="}], "type": "inlineReview", "revised_code": null}]}