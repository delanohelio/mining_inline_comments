{"pr_number": 734, "pr_title": "HIVE: On alter table prevent hive from recursively scanning the complete table dir", "pr_createdAt": "2020-01-12T09:02:41Z", "pr_url": "https://github.com/apache/iceberg/pull/734", "timeline": [{"oid": "a7b25ea822357917556b50643855ad4462682106", "url": "https://github.com/apache/iceberg/commit/a7b25ea822357917556b50643855ad4462682106", "message": "Hive: Do not collect table stats on alterTable\n\nwithout this property every update to iceberg table triggers a complete stats collection on the table directory", "committedDate": "2020-01-11T21:19:54Z", "type": "commit"}, {"oid": "db2cf7444d4883cb317c3a2b4cd47982544a1810", "url": "https://github.com/apache/iceberg/commit/db2cf7444d4883cb317c3a2b4cd47982544a1810", "message": "Fix checkStyle", "committedDate": "2020-01-11T21:29:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMwNjA1Mg==", "url": "https://github.com/apache/iceberg/pull/734#discussion_r366306052", "bodyText": "Nit: Iceberg uses 4 spaces for continued indentation and ImmutableMap from Guava.\nWhat about this?\nEnvironmentContext envContext = new EnvironmentContext(\n    ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n);\nclient.alter_table(database, tableName, tbl, envContext);", "author": "aokolnychyi", "createdAt": "2020-01-14T12:17:11Z", "path": "hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java", "diffHunk": "@@ -163,7 +165,10 @@ protected void doCommit(TableMetadata base, TableMetadata metadata) {\n \n       if (base != null) {\n         metaClients.run(client -> {\n-          client.alter_table(database, tableName, tbl);\n+          client.alter_table(database, tableName, tbl,", "originalCommit": "db2cf7444d4883cb317c3a2b4cd47982544a1810", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMxMDU3MQ==", "url": "https://github.com/apache/iceberg/pull/734#discussion_r366310571", "bodyText": "Sure thing, sorry", "author": "alexey-fin", "createdAt": "2020-01-14T12:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMwNjA1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "558604820b1c1e91eb6082ae789c88e2eaaaec81", "chunk": "diff --git a/hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java b/hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java\nindex bb730c80e..2e7ce104a 100644\n--- a/hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java\n+++ b/hive/src/main/java/org/apache/iceberg/hive/HiveTableOperations.java\n\n@@ -165,10 +166,10 @@ public class HiveTableOperations extends BaseMetastoreTableOperations {\n \n       if (base != null) {\n         metaClients.run(client -> {\n-          client.alter_table(database, tableName, tbl,\n-                  new EnvironmentContext(\n-                          Collections.singletonMap(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n-                  ));\n+          EnvironmentContext envContext = new EnvironmentContext(\n+              ImmutableMap.of(StatsSetupConst.DO_NOT_UPDATE_STATS, StatsSetupConst.TRUE)\n+          );\n+          client.alter_table(database, tableName, tbl, envContext);\n           return null;\n         });\n       } else {\n"}}, {"oid": "558604820b1c1e91eb6082ae789c88e2eaaaec81", "url": "https://github.com/apache/iceberg/commit/558604820b1c1e91eb6082ae789c88e2eaaaec81", "message": "Code style corrections\nUse guava immutable map and 4 space continued indentation", "committedDate": "2020-01-14T12:28:25Z", "type": "commit"}]}