{"pr_number": 1720, "pr_title": "Publish incremental scan event during planning", "pr_createdAt": "2020-11-04T11:27:33Z", "pr_url": "https://github.com/apache/iceberg/pull/1720", "timeline": [{"oid": "225a7e14d103ad3dc390ea43caf0f3da81804a2e", "url": "https://github.com/apache/iceberg/commit/225a7e14d103ad3dc390ea43caf0f3da81804a2e", "message": "Publish incremental scan event", "committedDate": "2020-11-04T11:04:26Z", "type": "commit"}, {"oid": "1161a0bcbb3509db4fff5e7d31cca132b684aa3e", "url": "https://github.com/apache/iceberg/commit/1161a0bcbb3509db4fff5e7d31cca132b684aa3e", "message": "update comment", "committedDate": "2020-11-04T11:06:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg0MTM3Mw==", "url": "https://github.com/apache/iceberg/pull/1720#discussion_r517841373", "bodyText": "I'm in favor of check all fields as it's the only test verifying IncrementalScanEvent, but others may have different thought on this.", "author": "HeartSaVioR", "createdAt": "2020-11-05T07:32:25Z", "path": "core/src/test/java/org/apache/iceberg/TestIncrementalDataTableScan.java", "diffHunk": "@@ -78,8 +81,28 @@ public void testAppends() {\n     add(table.newAppend(), files(\"C\"));\n     add(table.newAppend(), files(\"D\"));\n     add(table.newAppend(), files(\"E\")); // 5\n+\n+    class MyListener implements Listener<IncrementalScanEvent> {\n+\n+      IncrementalScanEvent lastEvent = null;\n+\n+      public void notify(IncrementalScanEvent event) {\n+        this.lastEvent = event;\n+      }\n+\n+      public IncrementalScanEvent event() {\n+        return lastEvent;\n+      }\n+    }\n+\n+    MyListener listener1 = new MyListener();\n+    Listeners.register(listener1, IncrementalScanEvent.class);\n     filesMatch(Lists.newArrayList(\"B\", \"C\", \"D\", \"E\"), appendsBetweenScan(1, 5));\n+    Assert.assertTrue(listener1.event().fromSnapshotId() == 1);", "originalCommit": "1161a0bcbb3509db4fff5e7d31cca132b684aa3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzkyMDM1MQ==", "url": "https://github.com/apache/iceberg/pull/1720#discussion_r517920351", "bodyText": "Thanks @HeartSaVioR!  I have updated the test to fetch and check all the fields of this event.", "author": "skambha", "createdAt": "2020-11-05T09:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg0MTM3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "0a60c5fc617bf3705b823b0e87f460949f6405a1", "chunk": "diff --git a/core/src/test/java/org/apache/iceberg/TestIncrementalDataTableScan.java b/core/src/test/java/org/apache/iceberg/TestIncrementalDataTableScan.java\nindex 2d9f5279a..1f9b93f10 100644\n--- a/core/src/test/java/org/apache/iceberg/TestIncrementalDataTableScan.java\n+++ b/core/src/test/java/org/apache/iceberg/TestIncrementalDataTableScan.java\n\n@@ -103,6 +103,9 @@ public class TestIncrementalDataTableScan extends TableTestBase {\n     filesMatch(Lists.newArrayList(\"C\", \"D\", \"E\"), appendsBetweenScan(2, 5));\n     Assert.assertTrue(listener1.event().fromSnapshotId() == 2);\n     Assert.assertTrue(listener1.event().toSnapshotId() == 5);\n+    Assert.assertEquals(table.schema(), listener1.event().projection());\n+    Assert.assertEquals(Expressions.alwaysTrue(), listener1.event().filter());\n+    Assert.assertEquals(\"test\", listener1.event().tableName());\n   }\n \n   @Test\n"}}, {"oid": "0a60c5fc617bf3705b823b0e87f460949f6405a1", "url": "https://github.com/apache/iceberg/commit/0a60c5fc617bf3705b823b0e87f460949f6405a1", "message": "address review comments", "committedDate": "2020-11-05T09:32:04Z", "type": "commit"}]}