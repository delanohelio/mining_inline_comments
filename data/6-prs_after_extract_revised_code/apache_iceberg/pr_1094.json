{"pr_number": 1094, "pr_title": "Add ignoreResiduals to TableScan", "pr_createdAt": "2020-06-04T20:31:01Z", "pr_url": "https://github.com/apache/iceberg/pull/1094", "timeline": [{"oid": "94644570c99ed3561325e59dd4e72fb6b674076e", "url": "https://github.com/apache/iceberg/commit/94644570c99ed3561325e59dd4e72fb6b674076e", "message": "Add ignoreResiduals to TableScan", "committedDate": "2020-06-04T20:18:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjc2NA==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435532764", "bodyText": "It is ugly but I don't see another way.", "author": "aokolnychyi", "createdAt": "2020-06-04T20:34:22Z", "path": "core/src/main/java/org/apache/iceberg/AllEntriesTable.java", "diffHunk": "@@ -82,18 +83,21 @@ public Schema schema() {\n \n     private Scan(\n         TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean caseSensitive, boolean colStats, Collection<String> selectedColumns,\n-        ImmutableMap<String, String> options) {\n-      super(ops, table, snapshotId, schema, rowFilter, caseSensitive, colStats, selectedColumns, options);\n+        boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n+        Collection<String> selectedColumns, ImmutableMap<String, String> options) {\n+      super(", "originalCommit": "94644570c99ed3561325e59dd4e72fb6b674076e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU0Mzk2NQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435543965", "bodyText": "The list of parameters seems really large, it produces a bunch of changes for adding a new param and it's hard to track. Would it make sense to refactor into an object like TableScanOptions or TableScanContext and create appropriate builders?", "author": "edgarRd", "createdAt": "2020-06-04T20:56:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU5NDQ0Ng==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435594446", "bodyText": "I think it is worth exploring using a builder here as a follow-up PR. @edgarRd, would you be interested to try this out?", "author": "aokolnychyi", "createdAt": "2020-06-04T22:49:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYwMzAzMQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435603031", "bodyText": "I think it's a good idea to do this, but keep in mind that we will still need to use the refinement pattern for both Scan objects and Options, so that existing instances are immutable. It would help reduce the size of changes when we add options to scans, though.", "author": "rdblue", "createdAt": "2020-06-04T23:16:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYyNDA4NQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435624085", "bodyText": "Sure, I can take a stab at it.", "author": "edgarRd", "createdAt": "2020-06-05T00:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMjc2NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTUzMzIzMg==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435533232", "bodyText": "Had to change this because files are filtered out otherwise.", "author": "aokolnychyi", "createdAt": "2020-06-04T20:35:16Z", "path": "core/src/test/java/org/apache/iceberg/TableTestBase.java", "diffHunk": "@@ -56,25 +56,25 @@\n \n   static final DataFile FILE_A = DataFiles.builder(SPEC)\n       .withPath(\"/path/to/data-a.parquet\")\n-      .withFileSizeInBytes(0)\n+      .withFileSizeInBytes(10)", "originalCommit": "94644570c99ed3561325e59dd4e72fb6b674076e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU3NDQ1NQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435574455", "bodyText": "What about not supporting this option for metadata tables? It doesn't seem necessary and if we can simplify this PR, that would be helpful.", "author": "rdblue", "createdAt": "2020-06-04T21:54:44Z", "path": "core/src/main/java/org/apache/iceberg/AllDataFilesTable.java", "diffHunk": "@@ -85,19 +86,23 @@ public Schema schema() {\n \n     private AllDataFilesTableScan(\n         TableOperations ops, Table table, Long snapshotId, Schema schema, Expression rowFilter,\n-        boolean caseSensitive, boolean colStats, Collection<String> selectedColumns, Schema fileSchema,\n+        boolean ignoreResiduals, boolean caseSensitive, boolean colStats,\n+        Collection<String> selectedColumns, Schema fileSchema,\n         ImmutableMap<String, String> options) {\n-      super(ops, table, snapshotId, schema, rowFilter, caseSensitive, colStats, selectedColumns, options);\n+      super(\n+          ops, table, snapshotId, schema, rowFilter, ignoreResiduals,\n+          caseSensitive, colStats, selectedColumns, options);", "originalCommit": "94644570c99ed3561325e59dd4e72fb6b674076e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU5MjQ5MQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435592491", "bodyText": "I don't have a strong opinion here. We have to check whether we can hit this filtering problem during our actions that rewrite metadata in the future. In metadata tables, we have either static tasks or we read Avro right now. So, we cannot really skip parts of a file like in Parquet, but it is still important to think this through. What if something changes and we start filtering out records on our side before passing records to query engines or write some metadata as Parquet? Static metadata tables have alwaysTrue as their data filter. Others, on the other hand, do have a valid data filter passed further that can cause issues.", "author": "aokolnychyi", "createdAt": "2020-06-04T22:44:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU3NDQ1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTYwMjMwOQ==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435602309", "bodyText": "I think it's fine if this is already done. You make a good point about possibly needing it later.", "author": "rdblue", "createdAt": "2020-06-04T23:14:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU3NDQ1NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU3NTA0OA==", "url": "https://github.com/apache/iceberg/pull/1094#discussion_r435575048", "bodyText": "Test looks good.", "author": "rdblue", "createdAt": "2020-06-04T21:56:17Z", "path": "core/src/test/java/org/apache/iceberg/TestDataTableScan.java", "diffHunk": "@@ -69,4 +74,36 @@ public void testTableScanHonorsSelectWithoutCaseSensitivity() {\n         scan2.schema().asStruct());\n   }\n \n+  @Test\n+  public void testTableScanHonorsIgnoreResiduals() throws IOException {", "originalCommit": "94644570c99ed3561325e59dd4e72fb6b674076e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}