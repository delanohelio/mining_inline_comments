{"pr_number": 1154, "pr_title": "Replaced RuntimeIOException with Java 8 UncheckedIOException", "pr_createdAt": "2020-07-01T15:44:42Z", "pr_url": "https://github.com/apache/iceberg/pull/1154", "timeline": [{"oid": "7f17e30e40b0a2f541ff7a1b4f065120b4c9bc77", "url": "https://github.com/apache/iceberg/commit/7f17e30e40b0a2f541ff7a1b4f065120b4c9bc77", "message": "replaced RuntimeIOException with Java 8 UncheckedIOException", "committedDate": "2020-07-01T15:38:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTg0Ng==", "url": "https://github.com/apache/iceberg/pull/1154#discussion_r448475846", "bodyText": "I do see some public APIs are being affected. E.g  createTable.  Do you guys think it is safer to make  RuntimeOIException extend UncheckedIOE instead of replacing RuntimeIOException completely?", "author": "rdsr", "createdAt": "2020-07-01T16:20:28Z", "path": "core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java", "diffHunk": "@@ -277,7 +277,7 @@ private static void deleteFiles(FileIO io, Set<ManifestFile> allManifests) {\n               }\n             }\n           } catch (IOException e) {\n-            throw new RuntimeIOException(e, \"Failed to read manifest file: \" + manifest.path());\n+            throw new UncheckedIOException(\"Failed to read manifest file: \" + manifest.path(), e);", "originalCommit": "7f17e30e40b0a2f541ff7a1b4f065120b4c9bc77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3ODY4Nw==", "url": "https://github.com/apache/iceberg/pull/1154#discussion_r448478687", "bodyText": "+1 for this idea. That would be fewer changes and is a binary compatible change.", "author": "rdblue", "createdAt": "2020-07-01T16:25:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTg0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ4ODA2NA==", "url": "https://github.com/apache/iceberg/pull/1154#discussion_r448488064", "bodyText": "So would we just make the class extend UncheckedIOException and leave everything throwing it as it is now? I personally don't like the way in the arguments it puts the exception first and the message second, I find this confusing as most other Java Exceptions do it the other way around. There is also the \"magic\" it performs to String.format things which again was a bit of a surprise and forced me to look into the internals which I rarely have to do with other Exception types I've used.\nYou guys know a lot more about how this is used but since its an Unchecked Exception is API compatibility such an issue? Perhaps there is a defined set of classes where it needs to be kept but can be removed everywhere else?", "author": "massdosage", "createdAt": "2020-07-01T16:41:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTg0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODUzNTM4OQ==", "url": "https://github.com/apache/iceberg/pull/1154#discussion_r448535389", "bodyText": "Yes, I think we would just make RuntimeIOException extend UncheckedIOException and leave the current cases as they are, since there isn't a lot of value to removing the class if it extends the more standard one.\nI hear your concern about the formatting magic and order of arguments. Here's the context:\n\nWe want to make it easy to add context into exception messages. It is too common that an exception tells you what happened, but not where it happened. So you might have a NullPointerException when writing a record field and not be told which field you need to go look at. The idea behind adding String.format into the constructors is to make it as easy as possible to build good exception messages.\nBecause we accept a format string and Object... for message formatting, we can't add the wrapped exception at the end of the arg list. The varargs parameter always consumes it. So we had to move it to the beginning.\n\nI though this was a reasonable trade-off for better exception messages. Not sure if other people agree, though.", "author": "rdblue", "createdAt": "2020-07-01T18:12:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTg0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODkyMDc2MQ==", "url": "https://github.com/apache/iceberg/pull/1154#discussion_r448920761", "bodyText": "OK, the above context makes sense, but I still think the principle of \"least surprises\" would lean me to not do this and just make sure people write good messages when they create exceptions. Anyway, at some point I think it would be good to  to have a DEVELOPERS.md (or something equivalent) for getting new developers up to speed with things like the above where the project may differ from what they are used to.\nI'll update this PR for RuntimeIOException to extend UncheckedIOException.", "author": "massdosage", "createdAt": "2020-07-02T10:59:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODQ3NTg0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "673ae0d7bb428d2471adf9fed51abf8da0890e8f", "chunk": "diff --git a/core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java b/core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java\nindex 4ff766a9e..c88082f85 100644\n--- a/core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java\n+++ b/core/src/main/java/org/apache/iceberg/BaseMetastoreCatalog.java\n\n@@ -277,7 +277,7 @@ public abstract class BaseMetastoreCatalog implements Catalog {\n               }\n             }\n           } catch (IOException e) {\n-            throw new UncheckedIOException(\"Failed to read manifest file: \" + manifest.path(), e);\n+            throw new RuntimeIOException(e, \"Failed to read manifest file: \" + manifest.path());\n           }\n         });\n   }\n"}}, {"oid": "66e400dbe836d1d5032972232951db7f86850cff", "url": "https://github.com/apache/iceberg/commit/66e400dbe836d1d5032972232951db7f86850cff", "message": "mark RuntimeIOException as deprecated, re-introduce it to api", "committedDate": "2020-07-02T10:53:17Z", "type": "commit"}, {"oid": "355364ea0c5541f0a78d19fa1f4c3e47824b0d89", "url": "https://github.com/apache/iceberg/commit/355364ea0c5541f0a78d19fa1f4c3e47824b0d89", "message": "removed file added from master by mistake", "committedDate": "2020-07-02T11:17:31Z", "type": "commit"}, {"oid": "673ae0d7bb428d2471adf9fed51abf8da0890e8f", "url": "https://github.com/apache/iceberg/commit/673ae0d7bb428d2471adf9fed51abf8da0890e8f", "message": "revert changes", "committedDate": "2020-07-03T12:59:55Z", "type": "commit"}, {"oid": "9044cf258f6f48ca1c4372624cc4cfdab9dbfdd7", "url": "https://github.com/apache/iceberg/commit/9044cf258f6f48ca1c4372624cc4cfdab9dbfdd7", "message": "fix indent", "committedDate": "2020-07-03T13:03:13Z", "type": "commit"}, {"oid": "1f4f6b6166e4d020bc8a08606e8d537b4775aeee", "url": "https://github.com/apache/iceberg/commit/1f4f6b6166e4d020bc8a08606e8d537b4775aeee", "message": "closing period", "committedDate": "2020-07-03T13:51:31Z", "type": "commit"}]}