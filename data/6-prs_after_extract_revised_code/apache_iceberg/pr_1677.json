{"pr_number": 1677, "pr_title": "Fix replaced partitions validation in SnapshotManager", "pr_createdAt": "2020-10-28T22:02:27Z", "pr_url": "https://github.com/apache/iceberg/pull/1677", "timeline": [{"oid": "64debd1e0b2a90b5ba8789dded62f0de53fb8ae2", "url": "https://github.com/apache/iceberg/commit/64debd1e0b2a90b5ba8789dded62f0de53fb8ae2", "message": "Fix replaced partitions validation in SnapshotManager.", "committedDate": "2020-10-28T22:01:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5NzgyNQ==", "url": "https://github.com/apache/iceberg/pull/1677#discussion_r514097825", "bodyText": "Dumb question here: is it safe for validateCurrentSnapshot to not check meta.currentSnapshot() != null in prior? If requiredCurrentSnapshotId is not null and meta.currentSnapshot() is null then NPE would occur, but I'm not sure the possibility about it.", "author": "HeartSaVioR", "createdAt": "2020-10-29T08:57:38Z", "path": "core/src/main/java/org/apache/iceberg/SnapshotManager.java", "diffHunk": "@@ -255,7 +255,7 @@ private static void validateNonAncestor(TableMetadata meta, long snapshotId) {\n \n   private static void validateReplacedPartitions(TableMetadata meta, Long parentId,\n                                                  PartitionSet replacedPartitions) {\n-    if (replacedPartitions != null) {\n+    if (replacedPartitions != null && meta.currentSnapshot() != null) {", "originalCommit": "64debd1e0b2a90b5ba8789dded62f0de53fb8ae2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQzODE5OA==", "url": "https://github.com/apache/iceberg/pull/1677#discussion_r514438198", "bodyText": "Looks like we should fix that one as well. I think you should be able to FF to any snapshot if there is no current snapshot. Thanks @HeartSaVioR!", "author": "rdblue", "createdAt": "2020-10-29T17:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDA5NzgyNQ=="}], "type": "inlineReview", "revised_code": null}]}