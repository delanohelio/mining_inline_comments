{"pr_number": 1772, "pr_title": "Spark: Skip DELETE if the condition is false", "pr_createdAt": "2020-11-14T01:35:31Z", "pr_url": "https://github.com/apache/iceberg/pull/1772", "timeline": [{"oid": "cd7306d6b97bbfa3c0175a21a71bff55d754257b", "url": "https://github.com/apache/iceberg/commit/cd7306d6b97bbfa3c0175a21a71bff55d754257b", "message": "Spark: Skip DELETE if the condition is false", "committedDate": "2020-11-14T01:34:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1ODcwOQ==", "url": "https://github.com/apache/iceberg/pull/1772#discussion_r524358709", "bodyText": "This is probably just me, but I would rather this just be an \"if { log } else { setup delete }\" than an \"if { log; return } setupDelete \"", "author": "RussellSpitzer", "createdAt": "2020-11-16T15:36:24Z", "path": "spark3/src/main/java/org/apache/iceberg/spark/source/SparkTable.java", "diffHunk": "@@ -159,6 +164,11 @@ public WriteBuilder newWriteBuilder(LogicalWriteInfo info) {\n   public void deleteWhere(Filter[] filters) {\n     Expression deleteExpr = SparkFilters.convert(filters);\n \n+    if (deleteExpr == Expressions.alwaysFalse()) {\n+      LOG.info(\"Skipping the delete operation as the condition is always false\");\n+      return;\n+    }", "originalCommit": "cd7306d6b97bbfa3c0175a21a71bff55d754257b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ4NDQ2Mg==", "url": "https://github.com/apache/iceberg/pull/1772#discussion_r524484462", "bodyText": "Just trying to touch fewer lines and avoid extra indentation for the block below.", "author": "aokolnychyi", "createdAt": "2020-11-16T18:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1ODcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQ5OTE4OA==", "url": "https://github.com/apache/iceberg/pull/1772#discussion_r524499188", "bodyText": "I agree with both of you. Normally, I'd prefer if/else to an extra return. But in this case it is better to return because we don't want to touch all of the lines that actually perform the delete.", "author": "rdblue", "createdAt": "2020-11-16T18:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1ODcwOQ=="}], "type": "inlineReview", "revised_code": null}]}