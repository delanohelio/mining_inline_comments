{"pr_number": 398, "pr_title": "Fix implementation for slice filter", "pr_createdAt": "2020-02-11T22:49:08Z", "pr_url": "https://github.com/HubSpot/jinjava/pull/398", "timeline": [{"oid": "868b868bf6c2805dbc3ded8ad495de7e723e774a", "url": "https://github.com/HubSpot/jinjava/commit/868b868bf6c2805dbc3ded8ad495de7e723e774a", "message": "Fix implementation for slice filter", "committedDate": "2020-02-11T22:40:49Z", "type": "commit"}, {"oid": "e562ec513906c0a0104bc9b359a49b448aa0655b", "url": "https://github.com/HubSpot/jinjava/commit/e562ec513906c0a0104bc9b359a49b448aa0655b", "message": "update tests", "committedDate": "2020-02-11T22:49:02Z", "type": "commit"}, {"oid": "00ec051d282959f291f539666156c8d2108b2e02", "url": "https://github.com/HubSpot/jinjava/commit/00ec051d282959f291f539666156c8d2108b2e02", "message": "checkstyle", "committedDate": "2020-02-12T19:54:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ4NDA1Mw==", "url": "https://github.com/HubSpot/jinjava/pull/398#discussion_r378484053", "bodyText": "Any reason we default to 3 here?", "author": "liamrharwood", "createdAt": "2020-02-12T20:05:01Z", "path": "src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java", "diffHunk": "@@ -47,7 +51,30 @@ public Object filter(Object var, JinjavaInterpreter interpreter, String... args)\n     }\n \n     int slices = NumberUtils.toInt(args[0], 3);", "originalCommit": "00ec051d282959f291f539666156c8d2108b2e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5MjA3NQ==", "url": "https://github.com/HubSpot/jinjava/pull/398#discussion_r378492075", "bodyText": "Ideally we would throw an error if args[0] wasn't provided, however we can't do that without breaking existing functionality. Somebody could be using a raw |slice out there.", "author": "mattcoley", "createdAt": "2020-02-12T20:22:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ4NDA1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "d99c04980110c3849a3f4100a44c3d1c65e37655", "chunk": "diff --git a/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java b/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\nindex 0d928ce4..50cdc35f 100644\n--- a/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\n+++ b/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\n\n@@ -69,8 +69,9 @@ public class SliceFilter implements Filter {\n     }\n \n     if (args.length > 1 && currentList != null) {\n+      Object fillWith = args[1];\n       while (currentList.size() < slices) {\n-        currentList.add(args[1]);\n+        currentList.add(fillWith);\n       }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ4NDMwOQ==", "url": "https://github.com/HubSpot/jinjava/pull/398#discussion_r378484309", "bodyText": "nit: assign args[1] to something like fillWith for clarity", "author": "liamrharwood", "createdAt": "2020-02-12T20:05:32Z", "path": "src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java", "diffHunk": "@@ -47,7 +51,30 @@ public Object filter(Object var, JinjavaInterpreter interpreter, String... args)\n     }\n \n     int slices = NumberUtils.toInt(args[0], 3);\n-    return Iterators.paddedPartition(loop, slices);\n+    if (slices <= 0) {\n+      throw new InvalidArgumentException(interpreter, this, InvalidReason.POSITIVE_NUMBER, 0, args[0]);\n+    }\n+    List<List<Object>> result = new ArrayList<>();\n+\n+    List<Object> currentList = null;\n+    int i = 0;\n+    while (loop.hasNext()) {\n+      Object next = loop.next();\n+      if (i % slices == 0) {\n+        currentList = new ArrayList<>(slices);\n+        result.add(currentList);\n+      }\n+      currentList.add(next);\n+      i++;\n+    }\n+\n+    if (args.length > 1 && currentList != null) {\n+      while (currentList.size() < slices) {\n+        currentList.add(args[1]);", "originalCommit": "00ec051d282959f291f539666156c8d2108b2e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ5MjYxMQ==", "url": "https://github.com/HubSpot/jinjava/pull/398#discussion_r378492611", "bodyText": "Done", "author": "mattcoley", "createdAt": "2020-02-12T20:23:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ4NDMwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "d99c04980110c3849a3f4100a44c3d1c65e37655", "chunk": "diff --git a/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java b/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\nindex 0d928ce4..50cdc35f 100644\n--- a/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\n+++ b/src/main/java/com/hubspot/jinjava/lib/filter/SliceFilter.java\n\n@@ -69,8 +69,9 @@ public class SliceFilter implements Filter {\n     }\n \n     if (args.length > 1 && currentList != null) {\n+      Object fillWith = args[1];\n       while (currentList.size() < slices) {\n-        currentList.add(args[1]);\n+        currentList.add(fillWith);\n       }\n     }\n \n"}}, {"oid": "d99c04980110c3849a3f4100a44c3d1c65e37655", "url": "https://github.com/HubSpot/jinjava/commit/d99c04980110c3849a3f4100a44c3d1c65e37655", "message": "better variable name", "committedDate": "2020-02-12T20:23:42Z", "type": "commit"}, {"oid": "0c368b617ec2419cf672a99461c8fb4f05d98f07", "url": "https://github.com/HubSpot/jinjava/commit/0c368b617ec2419cf672a99461c8fb4f05d98f07", "message": "Add documentation", "committedDate": "2020-02-12T20:25:18Z", "type": "commit"}]}