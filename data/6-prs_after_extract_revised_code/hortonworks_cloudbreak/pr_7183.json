{"pr_number": 7183, "pr_title": "CB-5371. Feature refactor & (E2E) remove use shared credential from the API (request)", "pr_createdAt": "2020-01-30T22:56:14Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7183", "timeline": [{"oid": "14d68a4488fb7954ef87a559442370d4f8e0da79", "url": "https://github.com/hortonworks/cloudbreak/commit/14d68a4488fb7954ef87a559442370d4f8e0da79", "message": "CB-5371. E2E tests: remove use shared credential from the API (request)", "committedDate": "2020-01-30T23:24:29Z", "type": "forcePushed"}, {"oid": "319cef120d18f0b9eb0dae0a2c11961e7b738427", "url": "https://github.com/hortonworks/cloudbreak/commit/319cef120d18f0b9eb0dae0a2c11961e7b738427", "message": "CB-5371. E2E tests: remove use shared credential from the API (request)", "committedDate": "2020-01-31T00:35:46Z", "type": "forcePushed"}, {"oid": "fa6461cb97ca2770a8eb28fbe580b0e8bc317e53", "url": "https://github.com/hortonworks/cloudbreak/commit/fa6461cb97ca2770a8eb28fbe580b0e8bc317e53", "message": "CB-5371. E2E tests: remove use shared credential from the API (request)", "committedDate": "2020-01-31T09:47:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMDMxNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7183#discussion_r373410317", "bodyText": "this logic occurs three times in this PR, maybe it is worth to extract it into some static class and call it everywhere", "author": "horadla23", "createdAt": "2020-01-31T10:25:50Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/TelemetryConverter.java", "diffHunk": "@@ -367,10 +364,12 @@ private void setReportDeploymentLogs(TelemetryRequest request, Features features\n         }\n     }\n \n-    private void setUseSharedAltusCredential(TelemetryRequest request, Features features) {\n-        if (useSharedAltusCredential && request.getFeatures() != null && request.getFeatures().getUseSharedAltusCredential() != null) {\n-            LOGGER.debug(\"Fill shared altus credential setting from telemetry feature request\");\n-            features.setUseSharedAltusCredential(request.getFeatures().getUseSharedAltusCredential());\n+    private void setUseSharedAltusCredential(Features features) {\n+        if (useSharedAltusCredential) {\n+            LOGGER.debug(\"Fill shared altus credential setting as that is enabled globally\");\n+            FeatureSetting useSharedAltusCredentialFeature = new FeatureSetting();\n+            useSharedAltusCredentialFeature.setEnabled(true);\n+            features.setUseSharedAltusCredential(useSharedAltusCredentialFeature);", "originalCommit": "fa6461cb97ca2770a8eb28fbe580b0e8bc317e53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMzIxNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7183#discussion_r373413214", "bodyText": "it's just a few steps, maybe in features object there should be a method to set this wrapper objects based on a boolean param and add a @JsonIgnore there. but that should be done to every occurrences of these feature settings, expect that this PR will be probably larger", "author": "oleewere", "createdAt": "2020-01-31T10:32:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxMDMxNw=="}], "type": "inlineReview", "revised_code": {"commit": "9a4723a06a16b90a9d93effb72aa2573c827a1d1", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/TelemetryConverter.java b/core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/TelemetryConverter.java\nindex 6d6f24ff78..4a317f176b 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/TelemetryConverter.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/TelemetryConverter.java\n\n@@ -352,24 +348,18 @@ public class TelemetryConverter {\n                 features.setReportDeploymentLogs(request.getFeatures().getReportDeploymentLogs());\n             } else {\n                 LOGGER.debug(\"Auto-filling report deployment logs telemetry settings as it is set, but missing from the request.\");\n-                FeatureSetting reportDeploymentLogsFeature = new FeatureSetting();\n-                reportDeploymentLogsFeature.setEnabled(false);\n-                features.setReportDeploymentLogs(reportDeploymentLogsFeature);\n+                features.addReportDeploymentLogs(false);\n             }\n         } else {\n             LOGGER.debug(\"Report deployment logs feature is disabled. Set feature as false.\");\n-            FeatureSetting reportDeploymentLogsFeature = new FeatureSetting();\n-            reportDeploymentLogsFeature.setEnabled(false);\n-            features.setReportDeploymentLogs(reportDeploymentLogsFeature);\n+            features.addReportDeploymentLogs(false);\n         }\n     }\n \n     private void setUseSharedAltusCredential(Features features) {\n         if (useSharedAltusCredential) {\n             LOGGER.debug(\"Fill shared altus credential setting as that is enabled globally\");\n-            FeatureSetting useSharedAltusCredentialFeature = new FeatureSetting();\n-            useSharedAltusCredentialFeature.setEnabled(true);\n-            features.setUseSharedAltusCredential(useSharedAltusCredentialFeature);\n+            features.addUseSharedAltusredential(true);\n         }\n     }\n }\n"}}, {"oid": "9a4723a06a16b90a9d93effb72aa2573c827a1d1", "url": "https://github.com/hortonworks/cloudbreak/commit/9a4723a06a16b90a9d93effb72aa2573c827a1d1", "message": "CB-5371. Feature refactor and remove use shared credential from the API (request)", "committedDate": "2020-01-31T11:10:35Z", "type": "forcePushed"}, {"oid": "9a99404c1c454db6ef32ba600a2288bf4dda2eaf", "url": "https://github.com/hortonworks/cloudbreak/commit/9a99404c1c454db6ef32ba600a2288bf4dda2eaf", "message": "CB-5371. Feature refactor and remove use shared credential from the API (request)", "committedDate": "2020-01-31T11:16:00Z", "type": "forcePushed"}, {"oid": "b20934dc06ceec246155519c9173120de1d0909a", "url": "https://github.com/hortonworks/cloudbreak/commit/b20934dc06ceec246155519c9173120de1d0909a", "message": "CB-5371. Feature refactor and remove use shared credential from the API (request)", "committedDate": "2020-01-31T11:30:42Z", "type": "commit"}, {"oid": "b20934dc06ceec246155519c9173120de1d0909a", "url": "https://github.com/hortonworks/cloudbreak/commit/b20934dc06ceec246155519c9173120de1d0909a", "message": "CB-5371. Feature refactor and remove use shared credential from the API (request)", "committedDate": "2020-01-31T11:30:42Z", "type": "forcePushed"}]}