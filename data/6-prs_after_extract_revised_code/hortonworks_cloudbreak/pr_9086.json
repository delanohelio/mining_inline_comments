{"pr_number": 9086, "pr_title": "CB-8904 Check CM version when filtering images for upgrade", "pr_createdAt": "2020-09-24T15:11:41Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9086", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwMjc4OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9086#discussion_r495102788", "bodyText": "The name should indicate that it doesn't check the CDH parcel.", "author": "keyki", "createdAt": "2020-09-25T16:31:54Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/image/locked/ParcelMatcher.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package com.sequenceiq.cloudbreak.service.upgrade.image.locked;\n+\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.Optional;\n+import java.util.function.Predicate;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.cloud.model.ClouderaManagerProduct;\n+import com.sequenceiq.cloudbreak.cloud.model.catalog.Image;\n+import com.sequenceiq.cloudbreak.cloud.model.component.StackType;\n+import com.sequenceiq.cloudbreak.service.image.PreWarmParcelParser;\n+\n+@Component\n+public class ParcelMatcher {\n+\n+    @Inject\n+    private PreWarmParcelParser preWarmParcelParser;\n+\n+    // Only compares the versions of the activated parcels\n+    public boolean isMatchingParcels(Image image, Map<String, String> activatedParcels) {", "originalCommit": "d4905eddf9d38b415f9513f052526e8f306ec6f5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5feec82f876a561eaa348655e8d0a6b6c470f62f", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/image/locked/ParcelMatcher.java b/core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/image/locked/ParcelMatcher.java\nindex d8a45dc987..50d796fef5 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/image/locked/ParcelMatcher.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/image/locked/ParcelMatcher.java\n\n@@ -22,7 +22,7 @@ public class ParcelMatcher {\n     private PreWarmParcelParser preWarmParcelParser;\n \n     // Only compares the versions of the activated parcels\n-    public boolean isMatchingParcels(Image image, Map<String, String> activatedParcels) {\n+    public boolean isMatchingNonCdhParcels(Image image, Map<String, String> activatedParcels) {\n         Map<String, String> prewarmedParcels = getPreWarmedParcels(image);\n         return isAllActivatedParcelVersionEqualExceptCdh(activatedParcels, prewarmedParcels);\n     }\n"}}, {"oid": "5feec82f876a561eaa348655e8d0a6b6c470f62f", "url": "https://github.com/hortonworks/cloudbreak/commit/5feec82f876a561eaa348655e8d0a6b6c470f62f", "message": "CB-8904 Check CM version when filtering images for upgrade\n\nUpgrade with lock components hasn't filtered images by Cloudera Manager build number.\nIn this commit an additional check has been added. Also the filtering for CM and stack\nversion has been refactored into smaller classes.", "committedDate": "2020-09-28T10:59:28Z", "type": "commit"}, {"oid": "5feec82f876a561eaa348655e8d0a6b6c470f62f", "url": "https://github.com/hortonworks/cloudbreak/commit/5feec82f876a561eaa348655e8d0a6b6c470f62f", "message": "CB-8904 Check CM version when filtering images for upgrade\n\nUpgrade with lock components hasn't filtered images by Cloudera Manager build number.\nIn this commit an additional check has been added. Also the filtering for CM and stack\nversion has been refactored into smaller classes.", "committedDate": "2020-09-28T10:59:28Z", "type": "forcePushed"}]}