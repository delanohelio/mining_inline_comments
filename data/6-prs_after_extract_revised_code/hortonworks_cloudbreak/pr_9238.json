{"pr_number": 9238, "pr_title": "CB-9227 - unable to get cluster definition on a stopped environment", "pr_createdAt": "2020-10-19T14:33:19Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9238", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2ODQxNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9238#discussion_r507968415", "bodyText": "if the source has no env crn why we woul like to query it ?", "author": "doktoric", "createdAt": "2020-10-19T18:19:48Z", "path": "core/src/main/java/com/sequenceiq/distrox/v1/distrox/converter/DistroXV1RequestToStackV4RequestConverter.java", "diffHunk": "@@ -192,14 +192,10 @@ private YarnStackV4Parameters getYarnProperties(DistroXV1Request source, Detaile\n     public DistroXV1Request convert(StackV4Request source) {\n         DistroXV1Request request = new DistroXV1Request();\n         request.setName(source.getName());\n-        DetailedEnvironmentResponse environment = null;\n         if (source.getEnvironmentCrn() != null) {\n-            environment = environmentClientService.getByCrn(source.getEnvironmentCrn());\n-            if (environment != null && environment.getEnvironmentStatus() != EnvironmentStatus.AVAILABLE) {\n-                throw new BadRequestException(String.format(\"Environment state is %s instead of AVAILABLE\", environment.getEnvironmentStatus()));\n-            }\n+            Optional<DetailedEnvironmentResponse> environment = getEnvironmentName(source.getEnvironmentCrn());", "originalCommit": "ddf7f1986731f0994dac922c2c88bf2216a19852", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk4MzA3OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9238#discussion_r507983079", "bodyText": "do we? in line 194 we have a check for the env crn. if it's null then no query happens, otherwise, we set the name based on the result of line 214", "author": "gregito", "createdAt": "2020-10-19T18:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2ODQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzNTU5MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9238#discussion_r508035591", "bodyText": "now I see that part thanks", "author": "doktoric", "createdAt": "2020-10-19T20:16:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2ODQxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "6d274e9e8d8db6060346b4f4437991f402554aec", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/distrox/v1/distrox/converter/DistroXV1RequestToStackV4RequestConverter.java b/core/src/main/java/com/sequenceiq/distrox/v1/distrox/converter/DistroXV1RequestToStackV4RequestConverter.java\nindex 6c39b68e9d..d195a12db6 100644\n--- a/core/src/main/java/com/sequenceiq/distrox/v1/distrox/converter/DistroXV1RequestToStackV4RequestConverter.java\n+++ b/core/src/main/java/com/sequenceiq/distrox/v1/distrox/converter/DistroXV1RequestToStackV4RequestConverter.java\n\n@@ -193,8 +192,7 @@ public class DistroXV1RequestToStackV4RequestConverter {\n         DistroXV1Request request = new DistroXV1Request();\n         request.setName(source.getName());\n         if (source.getEnvironmentCrn() != null) {\n-            Optional<DetailedEnvironmentResponse> environment = getEnvironmentName(source.getEnvironmentCrn());\n-            environment.ifPresent(env -> request.setEnvironmentName(getIfNotNull(env, EnvironmentBaseResponse::getName)));\n+            getEnvironmentName(source.getEnvironmentCrn()).ifPresent(envName -> request.setEnvironmentName(envName));\n         }\n         request.setImage(getIfNotNull(source.getImage(), imageConverter::convert));\n         request.setCluster(getIfNotNull(source.getCluster(), clusterConverter::convert));\n"}}, {"oid": "6d274e9e8d8db6060346b4f4437991f402554aec", "url": "https://github.com/hortonworks/cloudbreak/commit/6d274e9e8d8db6060346b4f4437991f402554aec", "message": "CB-9227 - unable to get cluster definition on a stopped environment, so removed the validation which prevents this conversion to happen in these cases", "committedDate": "2020-10-19T18:40:24Z", "type": "commit"}, {"oid": "6d274e9e8d8db6060346b4f4437991f402554aec", "url": "https://github.com/hortonworks/cloudbreak/commit/6d274e9e8d8db6060346b4f4437991f402554aec", "message": "CB-9227 - unable to get cluster definition on a stopped environment, so removed the validation which prevents this conversion to happen in these cases", "committedDate": "2020-10-19T18:40:24Z", "type": "forcePushed"}]}