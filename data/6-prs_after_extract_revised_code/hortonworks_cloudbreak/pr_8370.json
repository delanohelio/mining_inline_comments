{"pr_number": 8370, "pr_title": "CB-7182 IT fails intermittently", "pr_createdAt": "2020-06-23T08:23:18Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8370", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA2OTY2OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8370#discussion_r444069669", "bodyText": "typo in maxrety", "author": "topolyai5", "createdAt": "2020-06-23T08:56:22Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/action/v4/environment/AbstractEnvironmentAction.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package com.sequenceiq.it.cloudbreak.action.v4.environment;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.sequenceiq.it.cloudbreak.EnvironmentClient;\n+import com.sequenceiq.it.cloudbreak.action.Action;\n+import com.sequenceiq.it.cloudbreak.context.TestContext;\n+import com.sequenceiq.it.cloudbreak.dto.environment.EnvironmentTestDto;\n+import com.sequenceiq.it.cloudbreak.util.wait.WaitUtil;\n+\n+public abstract class AbstractEnvironmentAction implements Action<EnvironmentTestDto, EnvironmentClient> {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractEnvironmentAction.class);\n+\n+    @Override\n+    public EnvironmentTestDto action(TestContext testContext, EnvironmentTestDto testDto, EnvironmentClient client) throws Exception {\n+        int retries = 0;\n+        while (retries <= testDto.getWaitUtil().getMaxRetry()) {\n+            try {\n+                return environmentAction(testContext, testDto, client);\n+            } catch (Exception e) {\n+                LOGGER.info(\"Exception during executing Environment action: \", e);\n+                if (e.getMessage().contains(\"flow under operation\")) {\n+                    waitTillFlowInOperation(testDto.getWaitUtil());\n+                    retries++;\n+                } else {\n+                    throw e;\n+                }\n+            }\n+        }\n+        throw new Exception(\"Exception during executing Environment action: exceeding maxrety during waiting for flow\");", "originalCommit": "882ab3f5b62d5976fb0a45fc51a980bd242071ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA3ODMzNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8370#discussion_r444078337", "bodyText": "good catch! :)", "author": "bbihari", "createdAt": "2020-06-23T09:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA2OTY2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "36a6efb9c25f51578a18c00f74736532f0d9d24d", "chunk": "diff --git a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/action/v4/environment/AbstractEnvironmentAction.java b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/action/v4/environment/AbstractEnvironmentAction.java\nindex 3ddd13f017..cac6292142 100644\n--- a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/action/v4/environment/AbstractEnvironmentAction.java\n+++ b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/action/v4/environment/AbstractEnvironmentAction.java\n\n@@ -29,7 +29,7 @@ public abstract class AbstractEnvironmentAction implements Action<EnvironmentTes\n                 }\n             }\n         }\n-        throw new Exception(\"Exception during executing Environment action: exceeding maxrety during waiting for flow\");\n+        throw new Exception(\"Exception during executing Environment action: exceeding maxretry during waiting for flow\");\n     }\n \n     protected abstract EnvironmentTestDto environmentAction(TestContext testContext, EnvironmentTestDto testDto, EnvironmentClient client) throws Exception;\n"}}, {"oid": "36a6efb9c25f51578a18c00f74736532f0d9d24d", "url": "https://github.com/hortonworks/cloudbreak/commit/36a6efb9c25f51578a18c00f74736532f0d9d24d", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T09:12:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5MzkxMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8370#discussion_r444093911", "bodyText": "Unused variable?", "author": "lnardai", "createdAt": "2020-06-23T09:36:18Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/FreeIpaStartStopTest.java", "diffHunk": "@@ -20,6 +22,8 @@\n \n public class FreeIpaStartStopTest extends AbstractIntegrationTest {\n \n+    private static final Duration POLLING_INTERVAL = Duration.of(3000, ChronoUnit.MILLIS);", "originalCommit": "36a6efb9c25f51578a18c00f74736532f0d9d24d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExMTI3MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8370#discussion_r444111270", "bodyText": "fixed", "author": "bbihari", "createdAt": "2020-06-23T10:06:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA5MzkxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "758e09ea2f9233dd7ab32784e8c1bfd3dcf79f8d", "chunk": "diff --git a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/FreeIpaStartStopTest.java b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/FreeIpaStartStopTest.java\nindex 49adfa8f41..902c5de7fd 100644\n--- a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/FreeIpaStartStopTest.java\n+++ b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/FreeIpaStartStopTest.java\n\n@@ -22,8 +20,6 @@ import com.sequenceiq.it.cloudbreak.testcase.AbstractIntegrationTest;\n \n public class FreeIpaStartStopTest extends AbstractIntegrationTest {\n \n-    private static final Duration POLLING_INTERVAL = Duration.of(3000, ChronoUnit.MILLIS);\n-\n     @Inject\n     private FreeIPATestClient freeIPATestClient;\n \n"}}, {"oid": "758e09ea2f9233dd7ab32784e8c1bfd3dcf79f8d", "url": "https://github.com/hortonworks/cloudbreak/commit/758e09ea2f9233dd7ab32784e8c1bfd3dcf79f8d", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T10:04:40Z", "type": "forcePushed"}, {"oid": "45f28ca94d59bbc94ef7b639b3a762add0cdc02e", "url": "https://github.com/hortonworks/cloudbreak/commit/45f28ca94d59bbc94ef7b639b3a762add0cdc02e", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T13:09:00Z", "type": "forcePushed"}, {"oid": "8c5fc0385ded6f1c2ae291b1d0305cd96083172f", "url": "https://github.com/hortonworks/cloudbreak/commit/8c5fc0385ded6f1c2ae291b1d0305cd96083172f", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T13:25:55Z", "type": "forcePushed"}, {"oid": "cd7dcc0ec8d429dfa97c3e15754d822439d0d337", "url": "https://github.com/hortonworks/cloudbreak/commit/cd7dcc0ec8d429dfa97c3e15754d822439d0d337", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T14:14:43Z", "type": "commit"}, {"oid": "cd7dcc0ec8d429dfa97c3e15754d822439d0d337", "url": "https://github.com/hortonworks/cloudbreak/commit/cd7dcc0ec8d429dfa97c3e15754d822439d0d337", "message": "CB-7182 IT fails intermittently", "committedDate": "2020-06-23T14:14:43Z", "type": "forcePushed"}]}