{"pr_number": 9489, "pr_title": "CB-8945 Fix for CB Version and AppName for MOW environments", "pr_createdAt": "2020-11-20T14:47:10Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9489", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527794247", "bodyText": "this value is the same than the testParameter.get(CLOUDBREAK_SERVER_ROOT) Maybe we should use this param", "author": "topolyai5", "createdAt": "2020-11-20T16:07:35Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/ImageCatalogMockServerSetup.java", "diffHunk": "@@ -34,6 +35,9 @@\n \n     private String mockImageCatalogServer;\n \n+    @Value(\"${integrationtest.cloudbreak.server}\")", "originalCommit": "756dd4c1602b4b828c1eda9a6f8c71e24ea8e6ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgyNDM1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527824352", "bodyText": "Unfortunately we cannot use the CLOUDBREAK_SERVER_ROOT test parameter, because of this value Acquiring key CLOUDBREAK_SERVER_ROOT resulting: http://cloudera.dps.mow-dev.cloudera.com/cb here. However in case of Manowar environments we need: http://cloudera.dps.mow-dev.cloudera.com/cloud/cb:\n11:01:40.630 [main] INFO  com.sequenceiq.it.TestParameter [nolabel] - Acquiring key CLOUDBREAK_SERVER_ROOT resulting: http://cloudera.dps.mow-dev.cloudera.com/cloud/cb\n11:01:42.780 [main] INFO  c.s.i.c.m.ImageCatalogMockServerSetup [nolabel] - CB version: Appname: ****, version: 2.34.0-b72", "author": "aszegedi", "createdAt": "2020-11-20T16:53:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgyODM1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527828352", "bodyText": "CLOUDBREAK_SERVER_ROOT have been initialised at \n  \n    \n      cloudbreak/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/CloudbreakTest.java\n    \n    \n         Line 106\n      in\n      04f6b1f\n    \n    \n    \n    \n\n        \n          \n           testContext.putContextParam(CLOUDBREAK_SERVER_ROOT, server + cbRootContextPath); \n        \n    \n  \n\n\nvalues comes from \n  \n    \n      cloudbreak/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/CloudbreakTest.java\n    \n    \n        Lines 57 to 61\n      in\n      04f6b1f\n    \n    \n    \n    \n\n        \n          \n           @Value(\"${integrationtest.cloudbreak.server}\") \n        \n\n        \n          \n           private String server; \n        \n\n        \n          \n            \n        \n\n        \n          \n           @Value(\"${server.contextPath:/cb}\") \n        \n\n        \n          \n           private String cbRootContextPath;", "author": "aszegedi", "createdAt": "2020-11-20T16:57:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgzMjk2OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527832968", "bodyText": "...and this is the root of the issue. In case of Manowar environments we cannot get the CB version and AppName from the well known path that is working at our Cloud environments, for example:\n16:22:49.833 [main] INFO  com.sequenceiq.it.TestParameter [nolabel] - Acquiring key CLOUDBREAK_SERVER_ROOT resulting: http://qa-cloud.eng.hortonworks.com/cb\n16:22:51.099 [main] INFO  c.s.i.c.m.ImageCatalogMockServerSetup [nolabel] - CB version: Appname: cloudbreak, version: 2.34.0-b94\n\nThis is not working anymore, for example for MOW Dev:\n10:42:21.879 [main] INFO  com.sequenceiq.it.TestParameter [nolabel] - Acquiring key CLOUDBREAK_SERVER_ROOT resulting: http://cloudera.dps.mow-dev.cloudera.com/cb\n10:42:23.527 [main] ERROR c.s.i.c.m.ImageCatalogMockServerSetup [nolabel] - Cannot fetch the CB version\njava.lang.NullPointerException: null\n\tat com.sequenceiq.it.****.mock.ImageCatalogMockServerSetup.getCloudbreakUnderTestVersion(ImageCatalogMockServerSetup.java:55)\n\tat com.sequenceiq.it.****.mock.ImageCatalogMockServerSetup.initImageCatalogIfNecessary(ImageCatalogMockServerSetup.java:46)", "author": "aszegedi", "createdAt": "2020-11-20T17:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzgzNjg2OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527836868", "bodyText": "However we have to keep the CLOUDBREAK_SERVER_ROOT resulting: http://cloudera.dps.mow-dev.cloudera.com/cb original value for all the rest of testing. Finally we need this trick only for get the CB version and AppName for Image Catalog setup to can go through in the API Test Project and the test execution can be launched.", "author": "aszegedi", "createdAt": "2020-11-20T17:11:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg1MzQ2Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9489#discussion_r527853463", "bodyText": "Hm, I see. In this case, I've approved", "author": "topolyai5", "createdAt": "2020-11-20T17:33:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzc5NDI0Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ca8ac4b63719f241f78925c9c81c871974228e66", "url": "https://github.com/hortonworks/cloudbreak/commit/ca8ac4b63719f241f78925c9c81c871974228e66", "message": "CB-8945 Fix for CB Version and AppName for MOW environments", "committedDate": "2020-11-20T17:17:17Z", "type": "commit"}, {"oid": "ca8ac4b63719f241f78925c9c81c871974228e66", "url": "https://github.com/hortonworks/cloudbreak/commit/ca8ac4b63719f241f78925c9c81c871974228e66", "message": "CB-8945 Fix for CB Version and AppName for MOW environments", "committedDate": "2020-11-20T17:17:17Z", "type": "forcePushed"}]}