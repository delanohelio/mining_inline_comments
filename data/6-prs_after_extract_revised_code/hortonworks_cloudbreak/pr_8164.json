{"pr_number": 8164, "pr_title": "CB-7148 Configurable outbound internet traffic for the environments", "pr_createdAt": "2020-05-27T17:57:46Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8164", "timeline": [{"oid": "9ea935ffb3f55eb8dc3c609cec94679a381ddcd2", "url": "https://github.com/hortonworks/cloudbreak/commit/9ea935ffb3f55eb8dc3c609cec94679a381ddcd2", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-01T14:13:44Z", "type": "forcePushed"}, {"oid": "7cb1b7874db63a5843d1d35d6853194aadb2eb33", "url": "https://github.com/hortonworks/cloudbreak/commit/7cb1b7874db63a5843d1d35d6853194aadb2eb33", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-01T14:28:20Z", "type": "forcePushed"}, {"oid": "f9088aaf260b75a0c86806c694dff2837be6147b", "url": "https://github.com/hortonworks/cloudbreak/commit/f9088aaf260b75a0c86806c694dff2837be6147b", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-01T14:39:37Z", "type": "forcePushed"}, {"oid": "2357f260eccd0278bd9e31f3b835ae8d84c1ebf8", "url": "https://github.com/hortonworks/cloudbreak/commit/2357f260eccd0278bd9e31f3b835ae8d84c1ebf8", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-01T17:13:36Z", "type": "forcePushed"}, {"oid": "9c5bf0e1fb29ee0dd50f835dde7225730dd6e354", "url": "https://github.com/hortonworks/cloudbreak/commit/9c5bf0e1fb29ee0dd50f835dde7225730dd6e354", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-02T09:04:31Z", "type": "forcePushed"}, {"oid": "8c0a3f8db2a49b7fb58d47ab3caf548b464febdd", "url": "https://github.com/hortonworks/cloudbreak/commit/8c0a3f8db2a49b7fb58d47ab3caf548b464febdd", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-02T13:02:25Z", "type": "forcePushed"}, {"oid": "effb5b457a5e26557e2cb7422a95355e49af6916", "url": "https://github.com/hortonworks/cloudbreak/commit/effb5b457a5e26557e2cb7422a95355e49af6916", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-02T15:59:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzMzgwMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8164#discussion_r434433801", "bodyText": "Should not have :", "author": "keyki", "createdAt": "2020-06-03T09:29:34Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java", "diffHunk": "@@ -58,6 +65,9 @@\n \n     private static final String CREATED_SUBNET = \"CreatedSubnet\";\n \n+    @Value(\"${cb.aws.vpcendpoints.enabled.gateway.services:}\")", "originalCommit": "effb5b457a5e26557e2cb7422a95355e49af6916", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ed6e505a4d308a60dcc6fb461a15b41fa4188d2d", "chunk": "diff --git a/cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java b/cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java\nindex 2149281218..46f14a8103 100644\n--- a/cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java\n+++ b/cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java\n\n@@ -65,7 +65,7 @@ public class AwsLaunchService {\n \n     private static final String CREATED_SUBNET = \"CreatedSubnet\";\n \n-    @Value(\"${cb.aws.vpcendpoints.enabled.gateway.services:}\")\n+    @Value(\"${cb.aws.vpcendpoints.enabled.gateway.services}\")\n     private Set<String> enabledGatewayServices;\n \n     @Inject\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzNDgzNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8164#discussion_r434434834", "bodyText": "What AWS permissions do we need for this call?", "author": "keyki", "createdAt": "2020-06-03T09:31:13Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsLaunchService.java", "diffHunk": "@@ -287,4 +301,18 @@ private void suspendAutoscalingGoupsWhenNewInstancesAreReady(AuthenticatedContex\n         }\n         awsAutoScalingService.suspendAutoScaling(ac, stack);\n     }\n+\n+    private List<String> getPrefixListIds(AmazonEC2Client amazonEC2Client, String regionName, OutboundInternetTraffic outboundInternetTraffic) {\n+        List<String> result = List.of();\n+        if (outboundInternetTraffic == OutboundInternetTraffic.DISABLED && CollectionUtils.isNotEmpty(enabledGatewayServices)) {\n+            Set<String> gatewayRegionServices = enabledGatewayServices.stream()\n+                    .map(s -> String.format(AwsNetworkCfTemplateProvider.VPC_INTERFACE_SERVICE_ENDPOINT_NAME_PATTERN, regionName, s))\n+                    .collect(Collectors.toSet());\n+            result = amazonEC2Client.describePrefixLists().getPrefixLists().stream()", "originalCommit": "effb5b457a5e26557e2cb7422a95355e49af6916", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQ1MzgxNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8164#discussion_r434453815", "bodyText": "ec2:DescribePrefixLists", "author": "keyki", "createdAt": "2020-06-03T10:02:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQzNDgzNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ed6e505a4d308a60dcc6fb461a15b41fa4188d2d", "url": "https://github.com/hortonworks/cloudbreak/commit/ed6e505a4d308a60dcc6fb461a15b41fa4188d2d", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-03T12:45:35Z", "type": "forcePushed"}, {"oid": "19ded8e7d920e06779678bac67807cbb071203b7", "url": "https://github.com/hortonworks/cloudbreak/commit/19ded8e7d920e06779678bac67807cbb071203b7", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-03T13:22:01Z", "type": "commit"}, {"oid": "19ded8e7d920e06779678bac67807cbb071203b7", "url": "https://github.com/hortonworks/cloudbreak/commit/19ded8e7d920e06779678bac67807cbb071203b7", "message": "CB-7148 Configurable outbound internet traffic for the environments", "committedDate": "2020-06-03T13:22:01Z", "type": "forcePushed"}]}