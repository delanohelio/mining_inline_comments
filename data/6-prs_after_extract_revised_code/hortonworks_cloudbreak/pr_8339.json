{"pr_number": 8339, "pr_title": "CB-7400 Fix template builder to set skuTier based on skuName if not specified", "pr_createdAt": "2020-06-19T09:34:25Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8339", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjczNzEzMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8339#discussion_r442737132", "bodyText": "these values might be better in private static fields", "author": "lacikaaa", "createdAt": "2020-06-19T09:37:33Z", "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureTemplateBuilder.java", "diffHunk": "@@ -152,6 +154,30 @@ public String build(CloudContext cloudContext, DatabaseStack databaseStack) {\n         }\n     }\n \n+    private String getSkuTier(AzureDatabaseServerView azureDatabaseServerView) {\n+        String skuTier = azureDatabaseServerView.getSkuTier();\n+        String skuName = azureDatabaseServerView.getSkuName();\n+        if (Objects.isNull(skuTier)) {\n+            if (Objects.isNull(skuName)) {\n+                return null;\n+            } else {\n+                return getSkuTierFromSkuName(skuName);\n+            }\n+        } else {\n+            return azureDatabaseServerView.getSkuTier();\n+        }\n+    }\n+\n+    private String getSkuTierFromSkuName(String skuName) {\n+        if (Set.of(\"GP_Gen5_2\", \"GP_Gen5_4\", \"GP_Gen5_8\", \"GP_Gen5_16\", \"GP_Gen5_32\").contains(skuName)) {\n+            return \"GeneralPurpose\";\n+        } else if (Set.of(\"MO_Gen5_2\", \"MO_Gen5_4\", \"MO_Gen5_8\", \"MO_Gen5_16\", \"MO_Gen5_32\").contains(skuName)) {\n+            return \"MemoryOptimized\";", "originalCommit": "8e22fa5aa9736116cbf39910f13027f350797afd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjczODA4MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8339#discussion_r442738081", "bodyText": "Do you mean the instance types as well or just the two skuTiers (GeneralPurpose, MemoryOptimized)?", "author": "foldik", "createdAt": "2020-06-19T09:39:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjczNzEzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjc0MDI0NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8339#discussion_r442740245", "bodyText": "yes, all of them", "author": "lacikaaa", "createdAt": "2020-06-19T09:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjczNzEzMg=="}], "type": "inlineReview", "revised_code": {"commit": "4484c6032c55dbb0038f20b7bd158f638784c700", "chunk": "diff --git a/cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureTemplateBuilder.java b/cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureTemplateBuilder.java\nindex 867d41a6fb..259c92474f 100644\n--- a/cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureTemplateBuilder.java\n+++ b/cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureTemplateBuilder.java\n\n@@ -169,10 +177,10 @@ public class AzureTemplateBuilder {\n     }\n \n     private String getSkuTierFromSkuName(String skuName) {\n-        if (Set.of(\"GP_Gen5_2\", \"GP_Gen5_4\", \"GP_Gen5_8\", \"GP_Gen5_16\", \"GP_Gen5_32\").contains(skuName)) {\n-            return \"GeneralPurpose\";\n-        } else if (Set.of(\"MO_Gen5_2\", \"MO_Gen5_4\", \"MO_Gen5_8\", \"MO_Gen5_16\", \"MO_Gen5_32\").contains(skuName)) {\n-            return \"MemoryOptimized\";\n+        if (GENERAL_PUROSE_INSTANCE_TYPES.contains(skuName)) {\n+            return GENERAL_PURPOSE;\n+        } else if (MEMORY_OPTIMIZED_INSTANCE_TYPES.contains(skuName)) {\n+            return MEMORY_OPTIMIZED;\n         } else {\n             return null;\n         }\n"}}, {"oid": "4484c6032c55dbb0038f20b7bd158f638784c700", "url": "https://github.com/hortonworks/cloudbreak/commit/4484c6032c55dbb0038f20b7bd158f638784c700", "message": "CB-7400 Fix template builder to set skuTier based on skuName if not specified", "committedDate": "2020-06-19T09:43:15Z", "type": "forcePushed"}, {"oid": "9c89c3c6079bc0eee2febac5c34ba4dccb4b0fee", "url": "https://github.com/hortonworks/cloudbreak/commit/9c89c3c6079bc0eee2febac5c34ba4dccb4b0fee", "message": "CB-7400 Fix template builder to set skuTier based on skuName if not specified", "committedDate": "2020-06-19T09:44:51Z", "type": "commit"}, {"oid": "9c89c3c6079bc0eee2febac5c34ba4dccb4b0fee", "url": "https://github.com/hortonworks/cloudbreak/commit/9c89c3c6079bc0eee2febac5c34ba4dccb4b0fee", "message": "CB-7400 Fix template builder to set skuTier based on skuName if not specified", "committedDate": "2020-06-19T09:44:51Z", "type": "forcePushed"}]}