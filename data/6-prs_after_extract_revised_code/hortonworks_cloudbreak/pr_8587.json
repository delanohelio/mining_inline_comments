{"pr_number": 8587, "pr_title": "CB-8046 Remove filtering based on permissions", "pr_createdAt": "2020-07-17T14:38:30Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8587", "timeline": [{"oid": "241b28925ae52a1a09a24624d570a63f77224d97", "url": "https://github.com/hortonworks/cloudbreak/commit/241b28925ae52a1a09a24624d570a63f77224d97", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-17T14:47:57Z", "type": "forcePushed"}, {"oid": "6f862054763963a63a927a6eee01a542ae0a9968", "url": "https://github.com/hortonworks/cloudbreak/commit/6f862054763963a63a927a6eee01a542ae0a9968", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-17T15:51:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMjc4MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8587#discussion_r457312780", "bodyText": "Just a note. The list datahub page shows the create datahub button if this list sdx endpoint gives back some datalakes. So after this change a user will see this button enabled and later on will figure out he doesn't have right to create datahub beacuse there is no datalake that he can use.", "author": "foldik", "createdAt": "2020-07-20T11:52:04Z", "path": "datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java", "diffHunk": "@@ -127,7 +126,7 @@ public SdxClusterResponse getByCrn(@ResourceCrn String clusterCrn) {\n     }\n \n     @Override\n-    @FilterListBasedOnPermissions(action = AuthorizationResourceAction.DESCRIBE_DATALAKE)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.LIST_DATALAKES)\n     public List<SdxClusterResponse> list(String envName) {", "originalCommit": "6f862054763963a63a927a6eee01a542ae0a9968", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMzNTg0NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8587#discussion_r457335845", "bodyText": "Yes, this is the same as we can click on a datalake and later we may deny to describe it. I think we already discussed  disadvantages of this solution.\nAnyway authorization of buttons and UI elements is ahead of us I think.", "author": "horadla23", "createdAt": "2020-07-20T12:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMjc4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMzODQyNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8587#discussion_r457338427", "bodyText": "DatahubCreator needs be able to \"list\" datalakes in their environments in a particular environment with it's environments/listDatalakes or environemnts/describeDatalake. Since we assign this on environment level it would be easy to solve.", "author": "lnardai", "createdAt": "2020-07-20T12:30:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMjc4MA=="}], "type": "inlineReview", "revised_code": {"commit": "e66d23cc3bda7b079dfb9e89f7186cf7811a4561", "chunk": "diff --git a/datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java b/datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java\nindex 95ed2ba7fa..d227a088cc 100644\n--- a/datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java\n+++ b/datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java\n\n@@ -129,15 +131,15 @@ public class SdxController implements SdxEndpoint {\n     @CheckPermissionByAccount(action = AuthorizationResourceAction.LIST_DATALAKES)\n     public List<SdxClusterResponse> list(String envName) {\n         String userCrn = ThreadBasedUserCrnProvider.getUserCrn();\n-        List<SdxCluster> sdxClusters = sdxService.listSdx(userCrn, envName);\n+        List<SdxCluster> sdxClusters = sdxService.listSdx(userCrn);\n         return sdxClusters.stream()\n                 .map(sdx -> sdxClusterConverter.sdxClusterToResponse(sdx))\n                 .collect(Collectors.toList());\n     }\n \n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.LIST_DATALAKES)\n-    public List<SdxClusterResponse> getByEnvCrn(@ValidCrn String envCrn) {\n+    @CheckPermissionByEnvironmentCrn(action = AuthorizationResourceAction.LIST_DATALAKES)\n+    public List<SdxClusterResponse> getByEnvCrn(@EnvironmentCrn @ValidCrn String envCrn) {\n         String userCrn = ThreadBasedUserCrnProvider.getUserCrn();\n         List<SdxCluster> sdxClusters = sdxService.listSdxByEnvCrn(userCrn, envCrn);\n         return sdxClusters.stream()\n"}}, {"oid": "e66d23cc3bda7b079dfb9e89f7186cf7811a4561", "url": "https://github.com/hortonworks/cloudbreak/commit/e66d23cc3bda7b079dfb9e89f7186cf7811a4561", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T07:41:58Z", "type": "forcePushed"}, {"oid": "144e6de3b82719173e2f5c1c4e68d0b73a171ef4", "url": "https://github.com/hortonworks/cloudbreak/commit/144e6de3b82719173e2f5c1c4e68d0b73a171ef4", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T07:54:25Z", "type": "forcePushed"}, {"oid": "2c3dad149a5d40dbbfed3ecaaa546e0fe357ac8a", "url": "https://github.com/hortonworks/cloudbreak/commit/2c3dad149a5d40dbbfed3ecaaa546e0fe357ac8a", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T07:57:06Z", "type": "forcePushed"}, {"oid": "b67b0bf6384c0201a1f718ca02d4ff5200164b5b", "url": "https://github.com/hortonworks/cloudbreak/commit/b67b0bf6384c0201a1f718ca02d4ff5200164b5b", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T09:22:33Z", "type": "forcePushed"}, {"oid": "4ed054b6441d11ecbbf47ed5fe5404d48a96d977", "url": "https://github.com/hortonworks/cloudbreak/commit/4ed054b6441d11ecbbf47ed5fe5404d48a96d977", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T09:59:54Z", "type": "forcePushed"}, {"oid": "9fa807d87ea1af3bacbf2e98897ca47010ced297", "url": "https://github.com/hortonworks/cloudbreak/commit/9fa807d87ea1af3bacbf2e98897ca47010ced297", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T10:32:51Z", "type": "forcePushed"}, {"oid": "93e1fdec9a74f79dbca58fa0fbd4648cdf814ab3", "url": "https://github.com/hortonworks/cloudbreak/commit/93e1fdec9a74f79dbca58fa0fbd4648cdf814ab3", "message": "CB-8046 Remove filtering based on permissions", "committedDate": "2020-07-21T17:26:09Z", "type": "forcePushed"}, {"oid": "2bd689419020e05fd990b3cc6d5d033cbb54d779", "url": "https://github.com/hortonworks/cloudbreak/commit/2bd689419020e05fd990b3cc6d5d033cbb54d779", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T08:40:58Z", "type": "forcePushed"}, {"oid": "4d6366650e9665401df356953815b082538a17a3", "url": "https://github.com/hortonworks/cloudbreak/commit/4d6366650e9665401df356953815b082538a17a3", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T08:46:16Z", "type": "forcePushed"}, {"oid": "b89a99e3f457584e8299fce176a1ed782afa8e34", "url": "https://github.com/hortonworks/cloudbreak/commit/b89a99e3f457584e8299fce176a1ed782afa8e34", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T08:48:00Z", "type": "forcePushed"}, {"oid": "3e271211ce89fd99c5d3b8214d33b2d7d88ce0d0", "url": "https://github.com/hortonworks/cloudbreak/commit/3e271211ce89fd99c5d3b8214d33b2d7d88ce0d0", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T12:18:46Z", "type": "forcePushed"}, {"oid": "20d250f13dcce71ca25c6627ae79627609a5b0c0", "url": "https://github.com/hortonworks/cloudbreak/commit/20d250f13dcce71ca25c6627ae79627609a5b0c0", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T12:26:18Z", "type": "forcePushed"}, {"oid": "d55e6c4a2ff98326395de955136869b9e89be8de", "url": "https://github.com/hortonworks/cloudbreak/commit/d55e6c4a2ff98326395de955136869b9e89be8de", "message": "CB-8046 Remove filtering based on permissions\n\n- since filtering is performance heavy in UMS, we decided to remove filtering until further decision\n- also we intend to differentiate listing in account and listing by environment, thus we needed to add some endpoint and make some endpoint deprecated", "committedDate": "2020-07-23T12:51:19Z", "type": "forcePushed"}, {"oid": "214e534e44628811214f9a4b4e2520d21a11f62a", "url": "https://github.com/hortonworks/cloudbreak/commit/214e534e44628811214f9a4b4e2520d21a11f62a", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-23T13:51:37Z", "type": "forcePushed"}, {"oid": "69c3546ac072cd0c4e934cc1d6919dd47a3adf44", "url": "https://github.com/hortonworks/cloudbreak/commit/69c3546ac072cd0c4e934cc1d6919dd47a3adf44", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-24T09:20:30Z", "type": "forcePushed"}, {"oid": "807bd812c1e3d61fe26c2ac685818c7b62ad5218", "url": "https://github.com/hortonworks/cloudbreak/commit/807bd812c1e3d61fe26c2ac685818c7b62ad5218", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-24T10:54:45Z", "type": "forcePushed"}, {"oid": "733566c2bddbed6a9fb6e99677d5d7ee7b7316b7", "url": "https://github.com/hortonworks/cloudbreak/commit/733566c2bddbed6a9fb6e99677d5d7ee7b7316b7", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-27T06:10:40Z", "type": "forcePushed"}, {"oid": "71cfa34f368ca040a52d2cda619e7231251b3e7a", "url": "https://github.com/hortonworks/cloudbreak/commit/71cfa34f368ca040a52d2cda619e7231251b3e7a", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-28T10:49:48Z", "type": "forcePushed"}, {"oid": "edb472206953a781f1a618edc834d01fff5b2678", "url": "https://github.com/hortonworks/cloudbreak/commit/edb472206953a781f1a618edc834d01fff5b2678", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-31T06:13:49Z", "type": "commit"}, {"oid": "edb472206953a781f1a618edc834d01fff5b2678", "url": "https://github.com/hortonworks/cloudbreak/commit/edb472206953a781f1a618edc834d01fff5b2678", "message": "CB-8046 Remove filtering based on permissions\n\n- until further decision, we remove filtering for list API endpoints based on permissions", "committedDate": "2020-07-31T06:13:49Z", "type": "forcePushed"}]}