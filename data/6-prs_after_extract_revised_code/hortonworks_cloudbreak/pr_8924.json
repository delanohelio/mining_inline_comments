{"pr_number": 8924, "pr_title": "CB-8684 update checkRight API method on Util backend API", "pr_createdAt": "2020-09-03T16:46:58Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8924", "timeline": [{"oid": "f49bdd9d9693dc3b7d83006ec20b69104ce2148b", "url": "https://github.com/hortonworks/cloudbreak/commit/f49bdd9d9693dc3b7d83006ec20b69104ce2148b", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T07:31:35Z", "type": "forcePushed"}, {"oid": "781dc44a9db5a0de040f6765879f9c87661d85de", "url": "https://github.com/hortonworks/cloudbreak/commit/781dc44a9db5a0de040f6765879f9c87661d85de", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T07:46:58Z", "type": "forcePushed"}, {"oid": "59eff6fdb498c87006b48d1dfa4aca2bd9a269b2", "url": "https://github.com/hortonworks/cloudbreak/commit/59eff6fdb498c87006b48d1dfa4aca2bd9a269b2", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T07:50:47Z", "type": "forcePushed"}, {"oid": "c04e67bad49dbed817401767bc3cf9073549bb82", "url": "https://github.com/hortonworks/cloudbreak/commit/c04e67bad49dbed817401767bc3cf9073549bb82", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T07:57:36Z", "type": "forcePushed"}, {"oid": "4af5f8160a22617b99f846c713dc591a75102a6c", "url": "https://github.com/hortonworks/cloudbreak/commit/4af5f8160a22617b99f846c713dc591a75102a6c", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T11:59:18Z", "type": "forcePushed"}, {"oid": "acc06d1343f27efbd04201b16399e72a304c0760", "url": "https://github.com/hortonworks/cloudbreak/commit/acc06d1343f27efbd04201b16399e72a304c0760", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T12:38:12Z", "type": "forcePushed"}, {"oid": "9370696dd526332355b7f5a92d26e02ca3295d3f", "url": "https://github.com/hortonworks/cloudbreak/commit/9370696dd526332355b7f5a92d26e02ca3295d3f", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T13:04:47Z", "type": "forcePushed"}, {"oid": "1b0233b5fd359568fbe4b0ff651ed910006dbb8f", "url": "https://github.com/hortonworks/cloudbreak/commit/1b0233b5fd359568fbe4b0ff651ed910006dbb8f", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-07T13:44:30Z", "type": "forcePushed"}, {"oid": "3743cd3fb8f801289d6fea4a92f4733c8c275536", "url": "https://github.com/hortonworks/cloudbreak/commit/3743cd3fb8f801289d6fea4a92f4733c8c275536", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T06:37:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxNjg5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8924#discussion_r484716898", "bodyText": "Can you please use a constant map instead to be more performant?\n    private static final Map<String, AuthorizationResourceAction> BY_NAME = Stream.of(AuthorizationResourceAction.values())\n            .collect(Collectors.toUnmodifiableMap(AuthorizationResourceAction::getRight, Function.identity()));\n\n    public static AuthorizationResourceAction getByRight(String right) {\n        AuthorizationResourceAction result = BY_NAME.get(right);\n        if (result == null) {\n            throw new NotFoundException(String.format(\"Action not found by right %s\", right));\n        }\n        return result;\n    }", "author": "foldik", "createdAt": "2020-09-08T07:44:52Z", "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -93,4 +99,9 @@ public String getRight() {\n     public AuthorizationResourceType getAuthorizationResourceType() {\n         return authorizationResourceType;\n     }\n+\n+    public static AuthorizationResourceAction getByRight(String right) {\n+        return Arrays.stream(AuthorizationResourceAction.values()).filter(action -> StringUtils.equals(action.getRight(), right))\n+                .findFirst().orElseThrow(() -> new NotFoundException(String.format(\"Action not found by right %s\", right)));\n+    }", "originalCommit": "3743cd3fb8f801289d6fea4a92f4733c8c275536", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMTQ0MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8924#discussion_r484821440", "bodyText": "fixed", "author": "horadla23", "createdAt": "2020-09-08T10:41:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxNjg5OA=="}], "type": "inlineReview", "revised_code": {"commit": "137290efc6412ac288367ab83896af1d002cc17b", "chunk": "diff --git a/authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java b/authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java\nindex f79bacfaab..440eabfdf7 100644\n--- a/authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java\n+++ b/authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java\n\n@@ -101,7 +105,12 @@ public enum AuthorizationResourceAction {\n     }\n \n     public static AuthorizationResourceAction getByRight(String right) {\n-        return Arrays.stream(AuthorizationResourceAction.values()).filter(action -> StringUtils.equals(action.getRight(), right))\n-                .findFirst().orElseThrow(() -> new NotFoundException(String.format(\"Action not found by right %s\", right)));\n+        List<AuthorizationResourceAction> result = BY_RIGHT.get(right);\n+        if (result == null || result.isEmpty()) {\n+            throw new NotFoundException(String.format(\"Action not found by right %s\", right));\n+        } else if (result.size() > 1) {\n+            throw new NotFoundException(String.format(\"Multiple results found by right %s, thus we cannot lookup for action!\", right));\n+        }\n+        return result.get(0);\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxOTczNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8924#discussion_r484719734", "bodyText": "Can you please use a static final enum map for the lookup?", "author": "foldik", "createdAt": "2020-09-08T07:49:57Z", "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/util/base/RightV4.java", "diffHunk": "@@ -19,4 +31,9 @@\n     public AuthorizationResourceAction getAction() {\n         return action;\n     }\n+\n+    public static RightV4 getByAction(AuthorizationResourceAction authorizationResourceAction) {", "originalCommit": "3743cd3fb8f801289d6fea4a92f4733c8c275536", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgyMTQwMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8924#discussion_r484821400", "bodyText": "fixed", "author": "horadla23", "createdAt": "2020-09-08T10:40:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDcxOTczNA=="}], "type": "inlineReview", "revised_code": {"commit": "faa413742906363c912773e68a0822f5a5af949a", "chunk": "diff --git a/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/util/base/RightV4.java b/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/util/base/RightV4.java\nindex 8e96701903..c40a58d96b 100644\n--- a/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/util/base/RightV4.java\n+++ b/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/util/base/RightV4.java\n\n@@ -33,7 +39,10 @@ public enum RightV4 {\n     }\n \n     public static RightV4 getByAction(AuthorizationResourceAction authorizationResourceAction) {\n-        return Arrays.stream(RightV4.values()).filter(rightV4 -> rightV4.getAction().equals(authorizationResourceAction))\n-                .findFirst().orElseThrow(() -> new NotFoundException(String.format(\"Action %s not found in this enum\", authorizationResourceAction)));\n+        RightV4 result = BY_ACTION.get(authorizationResourceAction);\n+        if (result == null) {\n+            new NotFoundException(String.format(\"Action %s not found in this enum\", authorizationResourceAction));\n+        }\n+        return result;\n     }\n }\n"}}, {"oid": "8c3f9b463d1aae321d3fcaa33e5faa14ac228ecd", "url": "https://github.com/hortonworks/cloudbreak/commit/8c3f9b463d1aae321d3fcaa33e5faa14ac228ecd", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T08:46:33Z", "type": "forcePushed"}, {"oid": "faa413742906363c912773e68a0822f5a5af949a", "url": "https://github.com/hortonworks/cloudbreak/commit/faa413742906363c912773e68a0822f5a5af949a", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T08:52:59Z", "type": "forcePushed"}, {"oid": "137290efc6412ac288367ab83896af1d002cc17b", "url": "https://github.com/hortonworks/cloudbreak/commit/137290efc6412ac288367ab83896af1d002cc17b", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T10:38:06Z", "type": "forcePushed"}, {"oid": "3fcc7942b77812b0fe0338bb7e00bef56da36220", "url": "https://github.com/hortonworks/cloudbreak/commit/3fcc7942b77812b0fe0338bb7e00bef56da36220", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T11:25:50Z", "type": "forcePushed"}, {"oid": "a1648b7a63a35866cf76b80f61a96db79824ab7d", "url": "https://github.com/hortonworks/cloudbreak/commit/a1648b7a63a35866cf76b80f61a96db79824ab7d", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-08T11:48:33Z", "type": "forcePushed"}, {"oid": "7adb07f76934f3d438e96cba343d61a4db24051d", "url": "https://github.com/hortonworks/cloudbreak/commit/7adb07f76934f3d438e96cba343d61a4db24051d", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-09T06:44:01Z", "type": "forcePushed"}, {"oid": "4b9a9148fbde1628a989660c2395617dbfe2e069", "url": "https://github.com/hortonworks/cloudbreak/commit/4b9a9148fbde1628a989660c2395617dbfe2e069", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-09T10:02:24Z", "type": "commit"}, {"oid": "4b9a9148fbde1628a989660c2395617dbfe2e069", "url": "https://github.com/hortonworks/cloudbreak/commit/4b9a9148fbde1628a989660c2395617dbfe2e069", "message": "CB-8684 update checkRight API method on Util backend API", "committedDate": "2020-09-09T10:02:24Z", "type": "forcePushed"}]}