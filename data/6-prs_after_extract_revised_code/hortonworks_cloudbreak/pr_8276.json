{"pr_number": 8276, "pr_title": "CB-7294 FlowChain ends before next flow actually executed", "pr_createdAt": "2020-06-15T08:00:44Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8276", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMDEzNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#discussion_r440000137", "bodyText": "just a minor thing: as far as i see, there is a void version from required method, is it possible to use that here?", "author": "horadla23", "createdAt": "2020-06-15T08:08:28Z", "path": "flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java", "diffHunk": "@@ -145,7 +145,13 @@ private void handle(String key, Payload payload, FlowParameters flowParameters,\n                         flow.initialize(contextParams);\n                         runningFlows.put(flow, flowChainId);\n                         try {\n-                            flowLogService.save(flowParameters, flowChainId, key, payload, null, flowConfig.getClass(), flow.getCurrentState());\n+                            transactionService.required(() -> {\n+                                flowLogService.save(flowParameters, flowChainId, key, payload, null, flowConfig.getClass(), flow.getCurrentState());\n+                                if (flowChainId != null) {\n+                                    flowChains.removeLastTriggerEvent(flowChainId, flowParameters.getFlowTriggerUserCrn());\n+                                }\n+                                return null;", "originalCommit": "64da38570ce27a06ddcc26f040069cffcccaa097", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAxMDQzMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#discussion_r440010430", "bodyText": "Sure", "author": "foldik", "createdAt": "2020-06-15T08:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMDEzNw=="}], "type": "inlineReview", "revised_code": {"commit": "d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "chunk": "diff --git a/flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java b/flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java\nindex 3bfc1309dc..6a3161663a 100644\n--- a/flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java\n+++ b/flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java\n\n@@ -150,7 +150,6 @@ public class Flow2Handler implements Consumer<Event<? extends Payload>> {\n                                 if (flowChainId != null) {\n                                     flowChains.removeLastTriggerEvent(flowChainId, flowParameters.getFlowTriggerUserCrn());\n                                 }\n-                                return null;\n                             });\n                         } catch (Exception e) {\n                             LOGGER.error(\"Can't save flow: {}\", flowId);\n"}}, {"oid": "d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "url": "https://github.com/hortonworks/cloudbreak/commit/d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-15T08:27:42Z", "type": "forcePushed"}, {"oid": "ebe98cedfd80742e0c4fa7af6616c66aa454b173", "url": "https://github.com/hortonworks/cloudbreak/commit/ebe98cedfd80742e0c4fa7af6616c66aa454b173", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-16T06:58:44Z", "type": "forcePushed"}, {"oid": "aa2415d547b2fce345b4d9db28b73c63241e7129", "url": "https://github.com/hortonworks/cloudbreak/commit/aa2415d547b2fce345b4d9db28b73c63241e7129", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-16T07:56:49Z", "type": "forcePushed"}, {"oid": "acf37f928f41f545c5d630a2b31f20f821019712", "url": "https://github.com/hortonworks/cloudbreak/commit/acf37f928f41f545c5d630a2b31f20f821019712", "message": "CB-7294 Fix next flow triggering in flow chains", "committedDate": "2020-06-16T08:49:03Z", "type": "forcePushed"}, {"oid": "b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "url": "https://github.com/hortonworks/cloudbreak/commit/b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-17T07:48:20Z", "type": "forcePushed"}, {"oid": "c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "url": "https://github.com/hortonworks/cloudbreak/commit/c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-17T07:54:54Z", "type": "commit"}, {"oid": "c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "url": "https://github.com/hortonworks/cloudbreak/commit/c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "message": "CB-7294 FlowChain ends before next flow actually executed", "committedDate": "2020-06-17T07:54:54Z", "type": "forcePushed"}]}