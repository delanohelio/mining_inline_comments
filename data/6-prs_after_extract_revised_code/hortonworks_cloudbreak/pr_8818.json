{"pr_number": 8818, "pr_title": "CB-8412 Gracefully fail if gateway metadata missing during repair", "pr_createdAt": "2020-08-14T12:27:23Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8818", "timeline": [{"oid": "c050b89831e8ae405f103934ef8454c3766987e2", "url": "https://github.com/hortonworks/cloudbreak/commit/c050b89831e8ae405f103934ef8454c3766987e2", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair", "committedDate": "2020-08-14T12:51:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNTY0Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8818#discussion_r470605643", "bodyText": "Can we indicate that the gateway metadata could not be got from the provider side?", "author": "biharitomi", "createdAt": "2020-08-14T12:54:42Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java", "diffHunk": "@@ -214,6 +215,9 @@ protected void doExecute(StackScalingFlowContext context, CollectMetadataResult\n                 if (InstanceGroupType.GATEWAY == ig.getInstanceGroupType()) {\n                     Stack stack = stackService.getByIdWithListsInTransaction(context.getStack().getId());\n                     InstanceMetaData gatewayMetaData = stack.getPrimaryGatewayInstance();\n+                    if (null == gatewayMetaData && isRepair(variables)) {\n+                        throw new CloudbreakServiceException(\"Could not get instance metadata from the cloud provider.\");", "originalCommit": "c050b89831e8ae405f103934ef8454c3766987e2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java b/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java\nindex faa734a202..1db28cecda 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java\n\n@@ -216,7 +216,7 @@ public class StackUpscaleActions {\n                     Stack stack = stackService.getByIdWithListsInTransaction(context.getStack().getId());\n                     InstanceMetaData gatewayMetaData = stack.getPrimaryGatewayInstance();\n                     if (null == gatewayMetaData && isRepair(variables)) {\n-                        throw new CloudbreakServiceException(\"Could not get instance metadata from the cloud provider.\");\n+                        throw new CloudbreakServiceException(\"Could not get gateway instance metadata from the cloud provider.\");\n                     }\n                     CloudInstance gatewayInstance = metadataConverter.convert(gatewayMetaData);\n                     Selectable sshFingerPrintReq = new GetSSHFingerprintsRequest<GetSSHFingerprintsResult>(context.getCloudContext(),\n"}}, {"oid": "ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "url": "https://github.com/hortonworks/cloudbreak/commit/ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair", "committedDate": "2020-08-14T16:20:57Z", "type": "forcePushed"}, {"oid": "7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "url": "https://github.com/hortonworks/cloudbreak/commit/7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair", "committedDate": "2020-08-24T08:01:08Z", "type": "commit"}, {"oid": "7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "url": "https://github.com/hortonworks/cloudbreak/commit/7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair", "committedDate": "2020-08-24T08:01:08Z", "type": "forcePushed"}]}