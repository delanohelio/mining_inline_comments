{"pr_number": 7924, "pr_title": "CB-6729 Sdx create should not wait for stopped environment", "pr_createdAt": "2020-04-29T07:33:53Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7924", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE1MzczOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7924#discussion_r417153739", "bodyText": "I think it would make sense to prepare the code for environment currently stopping. As I see env service will wait until datahubs etc. are stopped so it may take a considerable amount if time until it is stopped.", "author": "gergopapi2", "createdAt": "2020-04-29T08:37:21Z", "path": "datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java", "diffHunk": "@@ -209,6 +211,12 @@ public SdxCluster getSdxByNameInAccount(String userCrn, String name) {\n         return Pair.of(sdxCluster, flowIdentifier);\n     }\n \n+    private void validateEnv(DetailedEnvironmentResponse environment) {\n+        if (ENV_STOPPED.equals(environment.getEnvironmentStatus())) {", "originalCommit": "69530db438384bafc5c9bd5efefece37f4fd6001", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE1NTIyNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7924#discussion_r417155226", "bodyText": "And maybe env starting should also be filtered out, as the env might only partially be functional.", "author": "gergopapi2", "createdAt": "2020-04-29T08:40:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE1MzczOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODA4Mjg3OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7924#discussion_r418082879", "bodyText": "Also it might be a good idea to collect all the env statuses to a list where the poller\nshould immediately exit + we should not allow creation. I'm guessing the 2 list should be identical.", "author": "lnardai", "createdAt": "2020-04-30T15:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE1MzczOQ=="}], "type": "inlineReview", "revised_code": {"commit": "6b6e570dfa84552bee13235b80351377b8e99168", "chunk": "diff --git a/datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java b/datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java\nindex e19402b265..d6f70e50e3 100644\n--- a/datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java\n+++ b/datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java\n\n@@ -212,7 +211,7 @@ public class SdxService implements ResourceIdProvider, ResourceBasedCrnProvider\n     }\n \n     private void validateEnv(DetailedEnvironmentResponse environment) {\n-        if (ENV_STOPPED.equals(environment.getEnvironmentStatus())) {\n+        if (environment.getEnvironmentStatus().isStopInProgressOrStopped()) {\n             throw new BadRequestException(\"Environment is stopped. Please start the environment first!\");\n         }\n     }\n"}}, {"oid": "6b6e570dfa84552bee13235b80351377b8e99168", "url": "https://github.com/hortonworks/cloudbreak/commit/6b6e570dfa84552bee13235b80351377b8e99168", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T11:41:33Z", "type": "forcePushed"}, {"oid": "c767ea03c7be3edede278724108e1016dbfb9fe6", "url": "https://github.com/hortonworks/cloudbreak/commit/c767ea03c7be3edede278724108e1016dbfb9fe6", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T11:42:50Z", "type": "forcePushed"}, {"oid": "767c8ff3243e21f3bf225ad2e9ea4fa65d4e251d", "url": "https://github.com/hortonworks/cloudbreak/commit/767c8ff3243e21f3bf225ad2e9ea4fa65d4e251d", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T12:45:12Z", "type": "forcePushed"}, {"oid": "438ea1abed5f6ae5b93e84842b832e369cce9e11", "url": "https://github.com/hortonworks/cloudbreak/commit/438ea1abed5f6ae5b93e84842b832e369cce9e11", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T13:03:58Z", "type": "forcePushed"}, {"oid": "803468cdf186324b47790ba63640f551c668d78d", "url": "https://github.com/hortonworks/cloudbreak/commit/803468cdf186324b47790ba63640f551c668d78d", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T13:04:30Z", "type": "forcePushed"}, {"oid": "b626fc98da249b23fbfa4853ae01db4ea33941af", "url": "https://github.com/hortonworks/cloudbreak/commit/b626fc98da249b23fbfa4853ae01db4ea33941af", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T13:20:54Z", "type": "commit"}, {"oid": "b626fc98da249b23fbfa4853ae01db4ea33941af", "url": "https://github.com/hortonworks/cloudbreak/commit/b626fc98da249b23fbfa4853ae01db4ea33941af", "message": "CB-6729 Sdx create should not wait for stopped environment", "committedDate": "2020-05-04T13:20:54Z", "type": "forcePushed"}]}