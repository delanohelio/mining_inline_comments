{"pr_number": 7128, "pr_title": "CB-5235 Refactor ResourceAccessDto", "pr_createdAt": "2020-01-23T09:27:20Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7128", "timeline": [{"oid": "ff59d83bc03d5af364191304f9ec5a7ec22e490d", "url": "https://github.com/hortonworks/cloudbreak/commit/ff59d83bc03d5af364191304f9ec5a7ec22e490d", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-23T10:02:00Z", "type": "forcePushed"}, {"oid": "bb777b3f2f0c99992c7c4b7953d65e4ea0901157", "url": "https://github.com/hortonworks/cloudbreak/commit/bb777b3f2f0c99992c7c4b7953d65e4ea0901157", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-24T20:58:28Z", "type": "forcePushed"}, {"oid": "b08a16a0ed6e205b37cd7ba7aa08e46a615ea69b", "url": "https://github.com/hortonworks/cloudbreak/commit/b08a16a0ed6e205b37cd7ba7aa08e46a615ea69b", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-27T08:16:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371222534", "bodyText": "Why not moving the methods if this inner class to the original class, and remove NameOrCrnReader? Why would we bother instantiating this to be able to read the NameOrCrn class?", "author": "attilapalfi92", "createdAt": "2020-01-27T12:51:39Z", "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/dto/NameOrCrn.java", "diffHunk": "@@ -0,0 +1,87 @@\n+package com.sequenceiq.cloudbreak.api.endpoint.v4.dto;\n+\n+import static com.sequenceiq.cloudbreak.util.NullUtil.throwIfNull;\n+import static org.apache.commons.lang3.StringUtils.isNotEmpty;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+\n+public class NameOrCrn {\n+\n+    private static final String NULL_DTO_EXCEPTION_MESSAGE = \"Name or crn should not be null.\";\n+\n+    private static final String NAME_MUST_BE_PROVIDED_EXCEPTION_MESSAGE = \"Name must be provided.\";\n+\n+    private static final String CRN_MUST_BE_PROVIDED_EXCEPTION_MESSAGE = \"Crn must be provided.\";\n+\n+    @VisibleForTesting\n+    final String name;\n+\n+    @VisibleForTesting\n+    final String crn;\n+\n+    private NameOrCrn(String name, String crn) {\n+        this.name = name;\n+        this.crn = crn;\n+    }\n+\n+    public static NameOrCrn ofName(String name) {\n+        if (StringUtils.isEmpty(name)) {\n+            throw new IllegalArgumentException(NAME_MUST_BE_PROVIDED_EXCEPTION_MESSAGE);\n+        }\n+        return new NameOrCrn(name, null);\n+    }\n+\n+    public static NameOrCrn ofCrn(String crn) {\n+        if (StringUtils.isEmpty(crn)) {\n+            throw new IllegalArgumentException(CRN_MUST_BE_PROVIDED_EXCEPTION_MESSAGE);\n+        }\n+        return new NameOrCrn(null, crn);\n+    }\n+\n+    @Override\n+    public String toString() {\n+        StringBuilder toString = new StringBuilder();\n+        toString.append(\"[NameOrCrn\");\n+        if (isNotEmpty(name)) {\n+            toString.append(\" of name: '\");\n+            toString.append(name);\n+        } else {\n+            toString.append(\" of crn: '\");\n+            toString.append(crn);\n+        }\n+        toString.append(\"']\");\n+        return toString.toString();\n+    }\n+\n+    public static class NameOrCrnReader {\n+\n+        private final NameOrCrn nameOrCrn;\n+\n+        private NameOrCrnReader(NameOrCrn nameOrCrn) {\n+            this.nameOrCrn = nameOrCrn;\n+        }\n+\n+        public static NameOrCrnReader create(NameOrCrn nameOrCrn) {\n+            throwIfNull(nameOrCrn, () -> new IllegalArgumentException(NULL_DTO_EXCEPTION_MESSAGE));\n+            return new NameOrCrnReader(nameOrCrn);\n+        }\n+\n+        public boolean hasName() {", "originalCommit": "b08a16a0ed6e205b37cd7ba7aa08e46a615ea69b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyNDI0NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371224245", "bodyText": "The sole purpose of this inner-class thing is an enforced null check. The original code did check for nulls. I did think a while whether to do just delete the null check (and so risk an NPE), or keep it. The (small) added value I see in enforcing null check is the opportunity to better log the error and so help diagnostics.", "author": "gergopapi2", "createdAt": "2020-01-27T12:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIzMDY3NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371230674", "bodyText": "I see. I still have doubts regarding whether it will provide us any real life diagnostic assistance. I think in most cases without this utility we would still be able to identify the source of the NPE right away.", "author": "attilapalfi92", "createdAt": "2020-01-27T13:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI4NzkxOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371287918", "bodyText": "Yeah, I have doubts as well, we do not win much. Ok, so if @gregito agrees, I would then remove the null checks. Please confirm.", "author": "gergopapi2", "createdAt": "2020-01-27T14:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI5Mjc0Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371292742", "bodyText": "IMHO NPE should never occur. if the only purpose of this NameOrCrnReader class is to ensure that nobody can create an invalid NameOrCrn instance then the null check should be there. on the other hand, null and emptiness checks should be performed at the same time (StringUtils.isEmpty also checks for null), hence one of the checks can be abandoned.", "author": "gregito", "createdAt": "2020-01-27T15:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMwMjI4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r371302287", "bodyText": "@gregito You cannot create an empty NameOrCrn object, it either contains the name or the crn. If name is null when you use NameOrCrn.ofName(name), then you get an exception right away (and the same for crn). The only thing NameOrCrn cannot guard for is that instead of creating it you pass null (could happen accidentally).\nAnother guard the class does not contain but could: if NameOrCrn was created with name, then reading the crn should throw. I think that would make sense.", "author": "gergopapi2", "createdAt": "2020-01-27T15:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkzMDU0Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/7128#discussion_r372930546", "bodyText": "Change done.", "author": "gergopapi2", "createdAt": "2020-01-30T12:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyMjUzNA=="}], "type": "inlineReview", "revised_code": {"commit": "f1ba414fc3fd24ff52b03f7563c992f4f3df0f2f", "chunk": "diff --git a/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/dto/NameOrCrn.java b/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/dto/NameOrCrn.java\nindex f37cd27dce..acfccde9fa 100644\n--- a/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/dto/NameOrCrn.java\n+++ b/core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/dto/NameOrCrn.java\n\n@@ -1,6 +1,5 @@\n package com.sequenceiq.cloudbreak.api.endpoint.v4.dto;\n \n-import static com.sequenceiq.cloudbreak.util.NullUtil.throwIfNull;\n import static org.apache.commons.lang3.StringUtils.isNotEmpty;\n \n import org.apache.commons.lang3.StringUtils;\n"}}, {"oid": "f1ba414fc3fd24ff52b03f7563c992f4f3df0f2f", "url": "https://github.com/hortonworks/cloudbreak/commit/f1ba414fc3fd24ff52b03f7563c992f4f3df0f2f", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-30T12:52:43Z", "type": "forcePushed"}, {"oid": "0a8457e738ecfad335bb98fa16bbf1df9e5c0c90", "url": "https://github.com/hortonworks/cloudbreak/commit/0a8457e738ecfad335bb98fa16bbf1df9e5c0c90", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-30T13:16:40Z", "type": "forcePushed"}, {"oid": "c59a2b146fd3c7159579bbc494d6116f199f02ea", "url": "https://github.com/hortonworks/cloudbreak/commit/c59a2b146fd3c7159579bbc494d6116f199f02ea", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-30T13:43:13Z", "type": "commit"}, {"oid": "c59a2b146fd3c7159579bbc494d6116f199f02ea", "url": "https://github.com/hortonworks/cloudbreak/commit/c59a2b146fd3c7159579bbc494d6116f199f02ea", "message": "CB-5235 Refactor ResourceAccessDto", "committedDate": "2020-01-30T13:43:13Z", "type": "forcePushed"}]}