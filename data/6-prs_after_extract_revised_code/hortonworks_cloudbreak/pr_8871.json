{"pr_number": 8871, "pr_title": "CB-8547: Use FreeIPA healthcheck for cluster proxy", "pr_createdAt": "2020-08-26T20:26:09Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8871", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM1NDQxNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8871#discussion_r478354417", "bodyText": "could you drop static and convert this class to @Component and use inject in ClusterProxyService so we can mock this class easily if we add unit tests for it?", "author": "lacikaaa", "createdAt": "2020-08-27T11:44:23Z", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/util/HealthCheckAvailabilityChecker.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.sequenceiq.freeipa.util;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+import com.sequenceiq.cloudbreak.cloud.VersionComparator;\n+import com.sequenceiq.cloudbreak.common.type.Versioned;\n+import com.sequenceiq.freeipa.entity.Stack;\n+\n+public class HealthCheckAvailabilityChecker {\n+\n+    // feature supported from 2.29\n+    private static final Versioned CDP_FREEIPA_HEALTH_AGENT_AFTER_VERSION = () -> \"2.28.0\";\n+\n+    private HealthCheckAvailabilityChecker() {\n+    }\n+\n+    public static boolean isCdpFreeIpaHeathAgentAvailable(Stack stack) {", "originalCommit": "a4145e9076a5dba021e2424638c36fb35357d9c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU0ODcyMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8871#discussion_r478548721", "bodyText": "Sure. I also updated the other availability checkers to be components.", "author": "jamisonbennett", "createdAt": "2020-08-27T16:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODM1NDQxNw=="}], "type": "inlineReview", "revised_code": {"commit": "8827f03d4836a5a8cc3b689661fc5283260c9c16", "chunk": "diff --git a/freeipa/src/main/java/com/sequenceiq/freeipa/util/HealthCheckAvailabilityChecker.java b/freeipa/src/main/java/com/sequenceiq/freeipa/util/HealthCheckAvailabilityChecker.java\nindex 24ee2bef5e..0d84f80f39 100644\n--- a/freeipa/src/main/java/com/sequenceiq/freeipa/util/HealthCheckAvailabilityChecker.java\n+++ b/freeipa/src/main/java/com/sequenceiq/freeipa/util/HealthCheckAvailabilityChecker.java\n\n@@ -1,20 +1,19 @@\n package com.sequenceiq.freeipa.util;\n \n import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n \n import com.sequenceiq.cloudbreak.cloud.VersionComparator;\n import com.sequenceiq.cloudbreak.common.type.Versioned;\n import com.sequenceiq.freeipa.entity.Stack;\n \n+@Component\n public class HealthCheckAvailabilityChecker {\n \n     // feature supported from 2.29\n     private static final Versioned CDP_FREEIPA_HEALTH_AGENT_AFTER_VERSION = () -> \"2.28.0\";\n \n-    private HealthCheckAvailabilityChecker() {\n-    }\n-\n-    public static boolean isCdpFreeIpaHeathAgentAvailable(Stack stack) {\n+    public boolean isCdpFreeIpaHeathAgentAvailable(Stack stack) {\n         if (StringUtils.isNotBlank(stack.getAppVersion())) {\n             Versioned currentVersion = () -> stack.getAppVersion();\n             return new VersionComparator().compare(currentVersion, CDP_FREEIPA_HEALTH_AGENT_AFTER_VERSION) > 0;\n"}}, {"oid": "8827f03d4836a5a8cc3b689661fc5283260c9c16", "url": "https://github.com/hortonworks/cloudbreak/commit/8827f03d4836a5a8cc3b689661fc5283260c9c16", "message": "CB-8547: Use FreeIPA healthcheck for cluster proxy\n\nRegister the FreeIPA healthcheck with cluster proxy for new clusters.\nContinue using the old login page as the status check for clusters\nthat were provisioned prior to the healthcheck's existence.\n\nThis was tested with a local deployment of cloudbreak.", "committedDate": "2020-08-27T16:31:15Z", "type": "commit"}, {"oid": "8827f03d4836a5a8cc3b689661fc5283260c9c16", "url": "https://github.com/hortonworks/cloudbreak/commit/8827f03d4836a5a8cc3b689661fc5283260c9c16", "message": "CB-8547: Use FreeIPA healthcheck for cluster proxy\n\nRegister the FreeIPA healthcheck with cluster proxy for new clusters.\nContinue using the old login page as the status check for clusters\nthat were provisioned prior to the healthcheck's existence.\n\nThis was tested with a local deployment of cloudbreak.", "committedDate": "2020-08-27T16:31:15Z", "type": "forcePushed"}]}