{"pr_number": 9023, "pr_title": "CB-8822 npe check in sdxinternaltestdto investigate", "pr_createdAt": "2020-09-16T12:01:21Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9023", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MzQzNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9023#discussion_r489393436", "bodyText": "If we can have a crn in the response but not stackresponse, it means that the response could have other useful info in it. So I think a better solution would be to handle the possible NPE in the hasSpotTermination assignment, something like this:\nboolean hasSpotTermination = Optional.ofNullable(getResponse().getStackV4Response()) .map(stack -> stack.getInstanceGroups()) .stream() .flatMap(ig -> ig.getMetadata().stream()) .anyMatch(metadata -> InstanceStatus.DELETED_BY_PROVIDER == metadata.getInstanceStatus());\nThis way we could add the response to the report without an NPE. Also it is possible that other Investigables have this issue, please check them too.", "author": "Bajzathd", "createdAt": "2020-09-16T12:22:07Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/sdx/SdxInternalTestDto.java", "diffHunk": "@@ -423,7 +423,7 @@ public SdxRepairRequest getSdxRepairRequest() {\n \n     @Override\n     public Clue investigate() {\n-        if (getResponse() == null || getResponse().getCrn() == null) {\n+        if (getResponse() == null || getResponse().getCrn() == null || getResponse().getStackV4Response() == null) {", "originalCommit": "be0497fce84c737284161583168331a8598c7c6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQzODMwOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9023#discussion_r489438309", "bodyText": "so you mean audit info still useful, whether stackresponse is null? is that what you meant?", "author": "afarsang", "createdAt": "2020-09-16T13:30:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ1NzM5Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/9023#discussion_r489457396", "bodyText": "I think it can be as it already had a crn, because without it could not have caused an NPE.", "author": "Bajzathd", "createdAt": "2020-09-16T13:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MzQzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ2NjMwMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9023#discussion_r489466302", "bodyText": "other testdtos had the potential issue too, it was a good idea to check them. Thanks", "author": "afarsang", "createdAt": "2020-09-16T14:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM5MzQzNg=="}], "type": "inlineReview", "revised_code": {"commit": "ca580fe1f3b3439345a6c76ed372fbc5d750c4ab", "chunk": "diff --git a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/sdx/SdxInternalTestDto.java b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/sdx/SdxInternalTestDto.java\nindex e808f8b3b8..185d157500 100644\n--- a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/sdx/SdxInternalTestDto.java\n+++ b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/sdx/SdxInternalTestDto.java\n\n@@ -423,7 +423,7 @@ public class SdxInternalTestDto extends AbstractSdxTestDto<SdxInternalClusterReq\n \n     @Override\n     public Clue investigate() {\n-        if (getResponse() == null || getResponse().getCrn() == null || getResponse().getStackV4Response() == null) {\n+        if (getResponse() == null || getResponse().getCrn() == null) {\n             return null;\n         }\n         AuditEventV4Responses auditEvents = AuditUtil.getAuditEvents(\n"}}, {"oid": "75ab91db9bb3a1ae8843944fd494a582188f2fe9", "url": "https://github.com/hortonworks/cloudbreak/commit/75ab91db9bb3a1ae8843944fd494a582188f2fe9", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-16T14:05:59Z", "type": "forcePushed"}, {"oid": "ca580fe1f3b3439345a6c76ed372fbc5d750c4ab", "url": "https://github.com/hortonworks/cloudbreak/commit/ca580fe1f3b3439345a6c76ed372fbc5d750c4ab", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-16T14:44:05Z", "type": "forcePushed"}, {"oid": "79f0beaea9d8c8c73ee9bcca6552686de39e7a4f", "url": "https://github.com/hortonworks/cloudbreak/commit/79f0beaea9d8c8c73ee9bcca6552686de39e7a4f", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T07:45:41Z", "type": "forcePushed"}, {"oid": "fc7e6ac6518d930526c79a1908b01d84ce36afd3", "url": "https://github.com/hortonworks/cloudbreak/commit/fc7e6ac6518d930526c79a1908b01d84ce36afd3", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T09:20:19Z", "type": "forcePushed"}, {"oid": "93429e6ceaeb8e9d6e1b9e3e4d3e692b9f6a7bdf", "url": "https://github.com/hortonworks/cloudbreak/commit/93429e6ceaeb8e9d6e1b9e3e4d3e692b9f6a7bdf", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T09:44:41Z", "type": "forcePushed"}, {"oid": "e70fe8542d1d92af739232b527b023e89c0a34fa", "url": "https://github.com/hortonworks/cloudbreak/commit/e70fe8542d1d92af739232b527b023e89c0a34fa", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T10:28:11Z", "type": "forcePushed"}, {"oid": "851eb9dd66223071dcc64864878c97d042cd1255", "url": "https://github.com/hortonworks/cloudbreak/commit/851eb9dd66223071dcc64864878c97d042cd1255", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T11:39:05Z", "type": "forcePushed"}, {"oid": "1bc525ff7a0a78fbad33d1cb3d1cfc26419a53b2", "url": "https://github.com/hortonworks/cloudbreak/commit/1bc525ff7a0a78fbad33d1cb3d1cfc26419a53b2", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T13:08:43Z", "type": "commit"}, {"oid": "1bc525ff7a0a78fbad33d1cb3d1cfc26419a53b2", "url": "https://github.com/hortonworks/cloudbreak/commit/1bc525ff7a0a78fbad33d1cb3d1cfc26419a53b2", "message": "CB-8822 npe check for investigate in testdtos", "committedDate": "2020-09-17T13:08:43Z", "type": "forcePushed"}]}