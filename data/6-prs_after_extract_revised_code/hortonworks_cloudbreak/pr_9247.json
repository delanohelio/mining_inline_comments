{"pr_number": 9247, "pr_title": "CB-9382 make sure getResourceCrnByResourceName not returns null", "pr_createdAt": "2020-10-20T11:51:23Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9247", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0MDc5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9247#discussion_r508440798", "bodyText": "maybe it is better to throw here a not found also, isn't it?", "author": "horadla23", "createdAt": "2020-10-20T12:00:00Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/blueprint/BlueprintService.java", "diffHunk": "@@ -409,7 +410,7 @@ public String getResourceCrnByResourceName(String resourceName) {\n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n         return resourceNames.stream()\n-                .map(resourceName -> blueprintRepository.findResourceCrnByNameAndAccountId(resourceName, ThreadBasedUserCrnProvider.getAccountId()))\n+                .map(resourceName -> blueprintRepository.findResourceCrnByNameAndAccountId(resourceName, ThreadBasedUserCrnProvider.getAccountId()).orElse(null))", "originalCommit": "d85bf9a3b4f59796defb4ca02d74838e2fffc464", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0MTU4MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9247#discussion_r508441581", "bodyText": "I was not sure to change the behaviour, since the old way only returned a null, but I guess it's safer to exit with an error.", "author": "lnardai", "createdAt": "2020-10-20T12:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0MDc5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0MjU4Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9247#discussion_r508442582", "bodyText": "i guess this method is used by authz framework only so i think we can change the behavior, and in long term, we should change this method anyway to use 1 db query", "author": "horadla23", "createdAt": "2020-10-20T12:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ0MDc5OA=="}], "type": "inlineReview", "revised_code": {"commit": "d9c690502e1bcf78dd2042848b60e26036a5e4e9", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/service/blueprint/BlueprintService.java b/core/src/main/java/com/sequenceiq/cloudbreak/service/blueprint/BlueprintService.java\nindex 71d0f35f02..3db723762a 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/service/blueprint/BlueprintService.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/service/blueprint/BlueprintService.java\n\n@@ -410,7 +410,8 @@ public class BlueprintService extends AbstractWorkspaceAwareResourceService<Blue\n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n         return resourceNames.stream()\n-                .map(resourceName -> blueprintRepository.findResourceCrnByNameAndAccountId(resourceName, ThreadBasedUserCrnProvider.getAccountId()).orElse(null))\n+                .map(resourceName -> blueprintRepository.findResourceCrnByNameAndAccountId(resourceName, ThreadBasedUserCrnProvider.getAccountId())\n+                        .orElseThrow(NotFoundException.notFound(\"Blueprint\", resourceName)))\n                 .collect(Collectors.toList());\n     }\n \n"}}, {"oid": "d9c690502e1bcf78dd2042848b60e26036a5e4e9", "url": "https://github.com/hortonworks/cloudbreak/commit/d9c690502e1bcf78dd2042848b60e26036a5e4e9", "message": "CB-9382 make sure getResourceCrnByResourceName for BlueprintService is not returning null and framework also responds with 404 if resourceCrn cannot be found", "committedDate": "2020-10-20T12:06:31Z", "type": "forcePushed"}, {"oid": "a8e83049d401d6049833791b4d306f11c7f7b0ce", "url": "https://github.com/hortonworks/cloudbreak/commit/a8e83049d401d6049833791b4d306f11c7f7b0ce", "message": "CB-9382 make sure getResourceCrnByResourceName for BlueprintService is not returning null and framework also responds with 404 if resourceCrn cannot be found", "committedDate": "2020-10-20T13:01:29Z", "type": "forcePushed"}, {"oid": "a81715a71db113d9d7b4d4ec41ad94e5e8f5c73a", "url": "https://github.com/hortonworks/cloudbreak/commit/a81715a71db113d9d7b4d4ec41ad94e5e8f5c73a", "message": "CB-9382 make sure getResourceCrnByResourceName for BlueprintService is not returning null and framework also responds with 404 if resourceCrn cannot be found", "committedDate": "2020-10-20T13:05:14Z", "type": "commit"}, {"oid": "a81715a71db113d9d7b4d4ec41ad94e5e8f5c73a", "url": "https://github.com/hortonworks/cloudbreak/commit/a81715a71db113d9d7b4d4ec41ad94e5e8f5c73a", "message": "CB-9382 make sure getResourceCrnByResourceName for BlueprintService is not returning null and framework also responds with 404 if resourceCrn cannot be found", "committedDate": "2020-10-20T13:05:14Z", "type": "forcePushed"}]}