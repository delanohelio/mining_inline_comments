{"pr_number": 7586, "pr_title": "Cb 5341 Update DNS entries at cluster start to new IP addresses", "pr_createdAt": "2020-03-13T17:59:07Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7586", "timeline": [{"oid": "4e3dd84ad2b1ea5a99ed781b626a52d434bf5765", "url": "https://github.com/hortonworks/cloudbreak/commit/4e3dd84ad2b1ea5a99ed781b626a52d434bf5765", "message": "cb-5341 extend ClusterPublicEndpointManagementService to handle start", "committedDate": "2020-03-13T17:37:24Z", "type": "commit"}, {"oid": "fea7fc9735c8e60a24e25fd18b572284fef9ed08", "url": "https://github.com/hortonworks/cloudbreak/commit/fea7fc9735c8e60a24e25fd18b572284fef9ed08", "message": "CB-5341 new flow step for update dns entries at cluster start", "committedDate": "2020-03-13T18:44:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY1NzIyNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7586#discussion_r392657225", "bodyText": "Looks good, can you add a few loglines in this if statement, please?", "author": "akanto", "createdAt": "2020-03-15T09:43:45Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/start/ClusterStartService.java", "diffHunk": "@@ -44,6 +47,22 @@\n     @Inject\n     private InstanceMetaDataService instanceMetaDataService;\n \n+    @Inject\n+    private ClusterPublicEndpointManagementService clusterPublicEndpointManagementService;\n+\n+    public void updateDnsEntriesInPem(Stack stack) {\n+        if (clusterPublicEndpointManagementService.manageCertificateAndDnsInPem()) {\n+            clusterPublicEndpointManagementService.start(stack);", "originalCommit": "fea7fc9735c8e60a24e25fd18b572284fef9ed08", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "918abcdf61a05d65776f5f0d5262bbfd666c6ecf", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/start/ClusterStartService.java b/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/start/ClusterStartService.java\nindex 50428b6cc2..6af1dbb89d 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/start/ClusterStartService.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/start/ClusterStartService.java\n\n@@ -52,12 +52,14 @@ public class ClusterStartService {\n \n     public void updateDnsEntriesInPem(Stack stack) {\n         if (clusterPublicEndpointManagementService.manageCertificateAndDnsInPem()) {\n+            String updatingDnsMsg = \"Updating the cluster's DNS entries in Public Endpoint Management Service.\";\n+            LOGGER.info(updatingDnsMsg);\n+            String clusterManagerIp = stackUtil.extractClusterManagerIp(stack);\n             clusterPublicEndpointManagementService.start(stack);\n             clusterService.updateClusterStatusByStackId(stack.getId(), Status.START_IN_PROGRESS);\n-            stackUpdater.updateStackStatus(stack.getId(), DetailedStackStatus.CLUSTER_OPERATION, String.format(\"Updating the cluster's DNS entries in Public \"\n-                    + \"Endpoint Management Service if applicable. Cluster manager ip: %s\", stackUtil.extractClusterManagerIp(stack)));\n-            flowMessageService.fireEventAndLog(stack.getId(), Status.UPDATE_IN_PROGRESS.name(), CLUSTER_DNS_ENTRY_UPDATE_FINISHED,\n-                    stackUtil.extractClusterManagerIp(stack));\n+            stackUpdater.updateStackStatus(stack.getId(), DetailedStackStatus.CLUSTER_OPERATION, String.format(updatingDnsMsg + \" Cluster manager ip: %s\",\n+                    clusterManagerIp));\n+            flowMessageService.fireEventAndLog(stack.getId(), Status.UPDATE_IN_PROGRESS.name(), CLUSTER_DNS_ENTRY_UPDATE_FINISHED, clusterManagerIp);\n         } else {\n             LOGGER.debug(\"Do not update states for updating DNS entries as management in Public Endpoint Management service is disabled.\");\n         }\n"}}, {"oid": "918abcdf61a05d65776f5f0d5262bbfd666c6ecf", "url": "https://github.com/hortonworks/cloudbreak/commit/918abcdf61a05d65776f5f0d5262bbfd666c6ecf", "message": "CB-5341 new flow step for update dns entries at cluster start", "committedDate": "2020-03-15T10:08:29Z", "type": "commit"}, {"oid": "918abcdf61a05d65776f5f0d5262bbfd666c6ecf", "url": "https://github.com/hortonworks/cloudbreak/commit/918abcdf61a05d65776f5f0d5262bbfd666c6ecf", "message": "CB-5341 new flow step for update dns entries at cluster start", "committedDate": "2020-03-15T10:08:29Z", "type": "forcePushed"}]}