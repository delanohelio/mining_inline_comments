{"pr_number": 7653, "pr_title": "Merge 2.19", "pr_createdAt": "2020-03-25T20:32:28Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7653", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE2OTA4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7653#discussion_r398169087", "bodyText": "I think this is incorrect resolution", "author": "keyki", "createdAt": "2020-03-25T21:06:01Z", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java", "diffHunk": "@@ -199,6 +202,51 @@ private void handleUser(UmsUsersState.Builder umsUsersStateBuilder, UsersState.B\n \n     }\n \n+    private boolean isEnvironmentUser(String enviromentCrn, GetRightsResponse rightsResponse) {", "originalCommit": "9fc8fe3b5353eeb29b000188c301e52d31015490", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ce477ce96bca6ee34c1dc2010716a49f954fb22e", "chunk": "diff --git a/freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java b/freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java\nindex dd025de542..9604c3627c 100644\n--- a/freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java\n+++ b/freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java\n\n@@ -202,51 +189,6 @@ public class UmsUsersStateProvider {\n \n     }\n \n-    private boolean isEnvironmentUser(String enviromentCrn, GetRightsResponse rightsResponse) {\n-\n-        List<RoleAssignment> rolesAssignedList = rightsResponse.getRoleAssignmentList();\n-        for (RoleAssignment roleAssigned : rolesAssignedList) {\n-            // TODO: should come from IAM Roles and check against Role Object\n-            if (roleAssigned.getRole().getCrn().contains(\"PowerUser\") ||\n-                    roleAssigned.getRole().getCrn().contains(\"EnvironmentAdmin\")) {\n-                return true;\n-                // admins are also users\n-            }\n-        }\n-\n-        List<ResourceRoleAssignment> resourceRoleAssignedList = rightsResponse.getResourceRolesAssignmentList();\n-        for (ResourceRoleAssignment resourceRoleAssigned : resourceRoleAssignedList) {\n-            // TODO: should come from IAM Roles and check against Role Object\n-            if (resourceRoleAssigned.getResourceRole().getCrn().contains(\"EnvironmentAdmin\") ||\n-                    (resourceRoleAssigned.getResourceRole().getCrn().contains(\"EnvironmentUser\"))) {\n-                return true;\n-            }\n-        }\n-\n-        return false;\n-    }\n-\n-    private boolean isEnvironmentAdmin(String enviromentCrn, GetRightsResponse rightsResponse) {\n-        List<RoleAssignment> rolesAssignedList = rightsResponse.getRoleAssignmentList();\n-        for (RoleAssignment roleAssigned : rolesAssignedList) {\n-            // TODO: should come from IAM Roles and check against Role Object\n-            if (roleAssigned.getRole().getCrn().contains(\"PowerUser\") ||\n-                    roleAssigned.getRole().getCrn().contains(\"EnvironmentAdmin\")) {\n-                return true;\n-            }\n-        }\n-\n-        List<ResourceRoleAssignment> resourceRoleAssignedList = rightsResponse.getResourceRolesAssignmentList();\n-        for (ResourceRoleAssignment resourceRoleAssigned : resourceRoleAssignedList) {\n-            // TODO: should come from IAM Roles and check against Role Object\n-            if (resourceRoleAssigned.getResourceRole().getCrn().contains(\"EnvironmentAdmin\")) {\n-                return true;\n-            }\n-        }\n-\n-        return false;\n-    }\n-\n     private void addMemberToInternalTrackingGroup(UsersState.Builder usersStateBuilder, String username) {\n         usersStateBuilder.addMemberToGroup(UserServiceConstants.CDP_USERSYNC_INTERNAL_GROUP, username);\n     }\n"}}, {"oid": "ce477ce96bca6ee34c1dc2010716a49f954fb22e", "url": "https://github.com/hortonworks/cloudbreak/commit/ce477ce96bca6ee34c1dc2010716a49f954fb22e", "message": "CB-6218 remove stackowner", "committedDate": "2020-03-26T10:12:27Z", "type": "commit"}, {"oid": "bdb9752bb2d79bfbfdcdabb325bf283a30371f21", "url": "https://github.com/hortonworks/cloudbreak/commit/bdb9752bb2d79bfbfdcdabb325bf283a30371f21", "message": "CB-6211 Create more missing index", "committedDate": "2020-03-26T10:12:27Z", "type": "commit"}, {"oid": "c7dfaf28419eaffe6ef6c69398515d0086081e40", "url": "https://github.com/hortonworks/cloudbreak/commit/c7dfaf28419eaffe6ef6c69398515d0086081e40", "message": "CB-6276 partially back-port workload admin group sync to reduce the # of groups in IPA", "committedDate": "2020-03-26T10:43:27Z", "type": "commit"}, {"oid": "c7dfaf28419eaffe6ef6c69398515d0086081e40", "url": "https://github.com/hortonworks/cloudbreak/commit/c7dfaf28419eaffe6ef6c69398515d0086081e40", "message": "CB-6276 partially back-port workload admin group sync to reduce the # of groups in IPA", "committedDate": "2020-03-26T10:43:27Z", "type": "forcePushed"}]}