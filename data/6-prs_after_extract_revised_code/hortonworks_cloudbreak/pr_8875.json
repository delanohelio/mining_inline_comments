{"pr_number": 8875, "pr_title": "CB-8559 Replace VMs should be enabled by default during runtime upgrade", "pr_createdAt": "2020-08-27T14:03:44Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8875", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODQ5MDQ0NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8875#discussion_r478490444", "bodyText": "Could we pls keep the log? It could be useful: LOGGER.debug(\"VM-s replacement after the upgrade process is {}\", replaceVms.name());", "author": "pdarvasi", "createdAt": "2020-08-27T15:06:25Z", "path": "datalake/src/main/java/com/sequenceiq/datalake/service/upgrade/SdxRuntimeUpgradeService.java", "diffHunk": "@@ -230,13 +229,7 @@ private String validateImageId(List<ImageInfoV4Response> upgradeCandidates, Stri\n     private SdxUpgradeReplaceVms shouldReplaceVmsAfterUpgrade(SdxUpgradeRequest upgradeRequest) {\n         return Optional.ofNullable(upgradeRequest)\n                 .map(SdxUpgradeRequest::getReplaceVms)\n-                .orElse(NullUtil.getIfNotNullOtherwise(upgradeRequest, this::determineReplaceVmsIfParamIsMissing, SdxUpgradeReplaceVms.DISABLED));\n-    }\n-\n-    private SdxUpgradeReplaceVms determineReplaceVmsIfParamIsMissing(SdxUpgradeRequest request) {\n-        SdxUpgradeReplaceVms replaceVms = isOsUpgrade(request) ? SdxUpgradeReplaceVms.ENABLED : SdxUpgradeReplaceVms.DISABLED;\n-        LOGGER.debug(\"VM-s replacement after the upgrade process is {}\", replaceVms.name());\n-        return replaceVms;\n+                .orElse(SdxUpgradeReplaceVms.ENABLED);", "originalCommit": "9425932a8f55aef8f1131d589e74e41d057bcc3d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bc174347d472efa32b272f2e9d6410bcac10756a", "chunk": "diff --git a/datalake/src/main/java/com/sequenceiq/datalake/service/upgrade/SdxRuntimeUpgradeService.java b/datalake/src/main/java/com/sequenceiq/datalake/service/upgrade/SdxRuntimeUpgradeService.java\nindex 17eaa1259b..73708df719 100644\n--- a/datalake/src/main/java/com/sequenceiq/datalake/service/upgrade/SdxRuntimeUpgradeService.java\n+++ b/datalake/src/main/java/com/sequenceiq/datalake/service/upgrade/SdxRuntimeUpgradeService.java\n\n@@ -227,9 +227,11 @@ public class SdxRuntimeUpgradeService {\n     }\n \n     private SdxUpgradeReplaceVms shouldReplaceVmsAfterUpgrade(SdxUpgradeRequest upgradeRequest) {\n-        return Optional.ofNullable(upgradeRequest)\n+        SdxUpgradeReplaceVms replaceVms = Optional.ofNullable(upgradeRequest)\n                 .map(SdxUpgradeRequest::getReplaceVms)\n                 .orElse(SdxUpgradeReplaceVms.ENABLED);\n+        LOGGER.debug(\"VM-s replacement after the upgrade process is {}\", replaceVms.name());\n+        return replaceVms;\n     }\n \n     public boolean isOsUpgrade(SdxUpgradeRequest request) {\n"}}, {"oid": "bc174347d472efa32b272f2e9d6410bcac10756a", "url": "https://github.com/hortonworks/cloudbreak/commit/bc174347d472efa32b272f2e9d6410bcac10756a", "message": "CB-8559 Replace VMs should be enabled by default during runtime upgrade", "committedDate": "2020-08-27T15:54:04Z", "type": "commit"}, {"oid": "bc174347d472efa32b272f2e9d6410bcac10756a", "url": "https://github.com/hortonworks/cloudbreak/commit/bc174347d472efa32b272f2e9d6410bcac10756a", "message": "CB-8559 Replace VMs should be enabled by default during runtime upgrade", "committedDate": "2020-08-27T15:54:04Z", "type": "forcePushed"}]}