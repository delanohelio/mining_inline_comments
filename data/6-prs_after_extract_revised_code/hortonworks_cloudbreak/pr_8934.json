{"pr_number": 8934, "pr_title": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "pr_createdAt": "2020-09-04T17:39:59Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8934", "timeline": [{"oid": "b6d5e8e3c38184f2481aaa43513d0a3e8b3a54b7", "url": "https://github.com/hortonworks/cloudbreak/commit/b6d5e8e3c38184f2481aaa43513d0a3e8b3a54b7", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-04T21:00:08Z", "type": "forcePushed"}, {"oid": "d830d9d7a71df8a15e80993d6cacda2f109c6cd3", "url": "https://github.com/hortonworks/cloudbreak/commit/d830d9d7a71df8a15e80993d6cacda2f109c6cd3", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-05T05:17:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MTU1OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8934#discussion_r484271559", "bodyText": "I think in this case we should simply not override the default cleanUp", "author": "Bajzathd", "createdAt": "2020-09-07T08:24:30Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/connector/PlatformAccessConfigsTestDto.java", "diffHunk": "@@ -72,7 +72,7 @@ public PlatformAccessConfigsTestDto withAvailabilityZone(String availabilityZone\n \n     @Override\n     public void cleanUp(TestContext context, CloudbreakClient cloudbreakClient) {\n-        LOGGER.debug(\"this entry point does not have any clean up operation\");\n+        LOGGER.warn(String.format(\"Cleanup WARN: 'cleanUp' is not implemented for TestDto: %s with name: %s\", this, getName()));", "originalCommit": "d830d9d7a71df8a15e80993d6cacda2f109c6cd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3ODk1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8934#discussion_r484278952", "bodyText": "So should we remove all the cleanUp' is not implemented Override from the project?", "author": "aszegedi", "createdAt": "2020-09-07T08:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MTU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMxMzU1OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8934#discussion_r484313558", "bodyText": "I think yes, and move this message to the default implementation. This way we will have less code, and truly standardized cleanUp", "author": "Bajzathd", "createdAt": "2020-09-07T09:34:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MTU1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "e9ccef581856a4e96c9b75c431f0c93cbc5a7da4", "chunk": "diff --git a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/connector/PlatformAccessConfigsTestDto.java b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/connector/PlatformAccessConfigsTestDto.java\nindex 270fd6fca1..27fa2308b3 100644\n--- a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/connector/PlatformAccessConfigsTestDto.java\n+++ b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/connector/PlatformAccessConfigsTestDto.java\n\n@@ -70,11 +69,6 @@ public class PlatformAccessConfigsTestDto extends AbstractCloudbreakTestDto<Obje\n         return this;\n     }\n \n-    @Override\n-    public void cleanUp(TestContext context, CloudbreakClient cloudbreakClient) {\n-        LOGGER.warn(String.format(\"Cleanup WARN: 'cleanUp' is not implemented for TestDto: %s with name: %s\", this, getName()));\n-    }\n-\n     @Override\n     public int order() {\n         return 500;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MzQ0NA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8934#discussion_r484273444", "bodyText": "From the message we can not tell which env was listed - the parent or the child.\nI have also refactored this test case in my PR, see here: https://github.com/hortonworks/cloudbreak/pull/8923/files#diff-68f3ed9be95a1bffc91d2b7ec253c58c\nI think we should merge these somehow here", "author": "Bajzathd", "createdAt": "2020-09-07T08:27:38Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentChildTest.java", "diffHunk": "@@ -231,4 +238,21 @@ private boolean parentNameEquals(EnvironmentTestDto environment, SimpleEnvironme\n                                 .bodyContains(method)\n                                 .exactTimes(times));\n     }\n+\n+    private Assertion<EnvironmentTestDto, EnvironmentClient> checkEnvsAreNotListedByName(List<String> environmentNames) {\n+        return (testContext, environmentTestDto, environmentClient) -> {\n+            Collection<SimpleEnvironmentResponse> simpleEnvironmentV4Respons = environmentTestDto.getResponseSimpleEnvSet();\n+            if (isNull(simpleEnvironmentV4Respons)) {\n+                throw new TestFailException(\"Environment list response is missing.\");\n+            }\n+            List<String> listedEnvironmentNames = simpleEnvironmentV4Respons.stream()\n+                    .filter(response -> !response.getEnvironmentStatus().equals(EnvironmentStatus.ARCHIVED))\n+                    .map(EnvironmentBaseResponse::getName)\n+                    .collect(Collectors.toList());\n+            if (listedEnvironmentNames.stream().anyMatch(environmentNames::contains)) {\n+                throw new TestFailException(\"Environment is listed\");", "originalCommit": "d830d9d7a71df8a15e80993d6cacda2f109c6cd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3ODMyNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8934#discussion_r484278325", "bodyText": "I think we should merge your PR first, after that rebase this PR onto master with your changes...", "author": "aszegedi", "createdAt": "2020-09-07T08:35:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MzQ0NA=="}], "type": "inlineReview", "revised_code": {"commit": "b9fc5bc7e5d7f41b96c3dea3d4ce89ddd4bc9071", "chunk": "diff --git a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentChildTest.java b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentChildTest.java\nindex 1fa5c0ebe8..87c1996da5 100644\n--- a/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentChildTest.java\n+++ b/integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentChildTest.java\n\n@@ -249,9 +249,11 @@ public class EnvironmentChildTest extends AbstractIntegrationTest {\n                     .filter(response -> !response.getEnvironmentStatus().equals(EnvironmentStatus.ARCHIVED))\n                     .map(EnvironmentBaseResponse::getName)\n                     .collect(Collectors.toList());\n-            if (listedEnvironmentNames.stream().anyMatch(environmentNames::contains)) {\n-                throw new TestFailException(\"Environment is listed\");\n-            }\n+            environmentNames.forEach(environmentName -> {\n+                if (listedEnvironmentNames.contains(environmentName)) {\n+                    throw new TestFailException(String.format(\"'%s' environment has not been deleted.\", environmentName));\n+                }\n+            });\n             return environmentTestDto;\n         };\n     }\n"}}, {"oid": "e9ccef581856a4e96c9b75c431f0c93cbc5a7da4", "url": "https://github.com/hortonworks/cloudbreak/commit/e9ccef581856a4e96c9b75c431f0c93cbc5a7da4", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-07T10:30:36Z", "type": "forcePushed"}, {"oid": "73c7e3326d6e548bf9e6763e7dbefdb487f40dee", "url": "https://github.com/hortonworks/cloudbreak/commit/73c7e3326d6e548bf9e6763e7dbefdb487f40dee", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-07T10:31:27Z", "type": "forcePushed"}, {"oid": "b9fc5bc7e5d7f41b96c3dea3d4ce89ddd4bc9071", "url": "https://github.com/hortonworks/cloudbreak/commit/b9fc5bc7e5d7f41b96c3dea3d4ce89ddd4bc9071", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-07T10:42:56Z", "type": "forcePushed"}, {"oid": "e8eb469fde7561b9af8d9568f077fe9e32fb988a", "url": "https://github.com/hortonworks/cloudbreak/commit/e8eb469fde7561b9af8d9568f077fe9e32fb988a", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-07T14:00:58Z", "type": "forcePushed"}, {"oid": "48bea8a8d516a27499e52c8b33ba75e3efde1686", "url": "https://github.com/hortonworks/cloudbreak/commit/48bea8a8d516a27499e52c8b33ba75e3efde1686", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-08T05:26:20Z", "type": "forcePushed"}, {"oid": "68cec5cb0bdbc42a9b09e7005ef5c8a215f02b0b", "url": "https://github.com/hortonworks/cloudbreak/commit/68cec5cb0bdbc42a9b09e7005ef5c8a215f02b0b", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-08T11:44:12Z", "type": "forcePushed"}, {"oid": "00c01ddbc5a151d2c85c16f7838b535d2103b598", "url": "https://github.com/hortonworks/cloudbreak/commit/00c01ddbc5a151d2c85c16f7838b535d2103b598", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-08T11:44:43Z", "type": "forcePushed"}, {"oid": "6a7ea01c0a62a2a8942a05735a243a4f460c8825", "url": "https://github.com/hortonworks/cloudbreak/commit/6a7ea01c0a62a2a8942a05735a243a4f460c8825", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-08T12:30:10Z", "type": "forcePushed"}, {"oid": "8bbc175248644cede7a21e397d551274e690a29f", "url": "https://github.com/hortonworks/cloudbreak/commit/8bbc175248644cede7a21e397d551274e690a29f", "message": "Additional fixes", "committedDate": "2020-09-08T16:54:47Z", "type": "forcePushed"}, {"oid": "2157120f0fbc406720722d3fcdb037345c8023cb", "url": "https://github.com/hortonworks/cloudbreak/commit/2157120f0fbc406720722d3fcdb037345c8023cb", "message": "Additional fixes", "committedDate": "2020-09-08T17:44:02Z", "type": "forcePushed"}, {"oid": "d9187f6a3a436230080646dd28b3c27e08141791", "url": "https://github.com/hortonworks/cloudbreak/commit/d9187f6a3a436230080646dd28b3c27e08141791", "message": "Additional fixes", "committedDate": "2020-09-08T17:50:16Z", "type": "forcePushed"}, {"oid": "1b74d74ca508cb13c48254f45e4745372ff31208", "url": "https://github.com/hortonworks/cloudbreak/commit/1b74d74ca508cb13c48254f45e4745372ff31208", "message": "Additional fixes", "committedDate": "2020-09-08T19:42:32Z", "type": "forcePushed"}, {"oid": "c25f297a20edd975e7a08e36a7a7f21354f7b4fd", "url": "https://github.com/hortonworks/cloudbreak/commit/c25f297a20edd975e7a08e36a7a7f21354f7b4fd", "message": "Additional fixes", "committedDate": "2020-09-08T20:46:25Z", "type": "forcePushed"}, {"oid": "a6e228b8b4512fe917b842cb8e40ef79ce996201", "url": "https://github.com/hortonworks/cloudbreak/commit/a6e228b8b4512fe917b842cb8e40ef79ce996201", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-10T04:41:28Z", "type": "forcePushed"}, {"oid": "043670c113476c79a9540ea9024025821657d466", "url": "https://github.com/hortonworks/cloudbreak/commit/043670c113476c79a9540ea9024025821657d466", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-10T04:43:35Z", "type": "forcePushed"}, {"oid": "1ef2c17aa21d951abe09fe9a05fcbbd5005a6311", "url": "https://github.com/hortonworks/cloudbreak/commit/1ef2c17aa21d951abe09fe9a05fcbbd5005a6311", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-10T06:37:33Z", "type": "commit"}, {"oid": "1ef2c17aa21d951abe09fe9a05fcbbd5005a6311", "url": "https://github.com/hortonworks/cloudbreak/commit/1ef2c17aa21d951abe09fe9a05fcbbd5005a6311", "message": "CB-8670 Introduce withSkipOnFail to TestDTO cleanup", "committedDate": "2020-09-10T06:37:33Z", "type": "forcePushed"}]}