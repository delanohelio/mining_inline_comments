{"pr_number": 9679, "pr_title": "ENGESC-5953 remove empty stack versions when gathering stack versions", "pr_createdAt": "2020-12-22T13:32:31Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9679", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NjU1Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9679#discussion_r547286553", "bodyText": "a log line would be nice here", "author": "pdarvasi", "createdAt": "2020-12-22T13:47:10Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java", "diffHunk": "@@ -264,12 +265,24 @@ private void addPackageVersionsFromGrain(GatewayConfig gatewayConfig, HostOrches\n         return packageVersionsByNameByHost;\n     }\n \n+    private void removeEmptyStack(ArrayList<String> stackTypedPackages, Entry<String, Map<String, String>> entry) {\n+        if (!CollectionUtils.isEmpty(stackTypedPackages)) {\n+            Set<String> keySet = entry.getValue().keySet();\n+            for (String stackTypedPackage : stackTypedPackages) {\n+                if (keySet.contains(stackTypedPackage)) {\n+                    if (StringUtils.isEmpty(entry.getValue().get(stackTypedPackage))) {\n+                        entry.getValue().remove(stackTypedPackage);", "originalCommit": "068794c2ef2c7b6339f751e7bd4af71adbe27ca8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4OTcwNQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9679#discussion_r547289705", "bodyText": "done", "author": "sodre90", "createdAt": "2020-12-22T13:53:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NjU1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "b1e7abb882db1421059ba14ed3711cf3c271a3df", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\nindex a5a8a5cb92..a9492fbcd3 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\n\n@@ -272,6 +272,7 @@ public class InstanceMetadataUpdater {\n                 if (keySet.contains(stackTypedPackage)) {\n                     if (StringUtils.isEmpty(entry.getValue().get(stackTypedPackage))) {\n                         entry.getValue().remove(stackTypedPackage);\n+                        LOGGER.info(\"Remove empty stack type: {}\", stackTypedPackage);\n                     }\n                 }\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NjcyMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9679#discussion_r547286721", "bodyText": "a unit test covering this would be good", "author": "pdarvasi", "createdAt": "2020-12-22T13:47:29Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java", "diffHunk": "@@ -264,12 +265,24 @@ private void addPackageVersionsFromGrain(GatewayConfig gatewayConfig, HostOrches\n         return packageVersionsByNameByHost;\n     }\n \n+    private void removeEmptyStack(ArrayList<String> stackTypedPackages, Entry<String, Map<String, String>> entry) {", "originalCommit": "068794c2ef2c7b6339f751e7bd4af71adbe27ca8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4OTY4MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9679#discussion_r547289681", "bodyText": "done", "author": "sodre90", "createdAt": "2020-12-22T13:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NjcyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b1e7abb882db1421059ba14ed3711cf3c271a3df", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\nindex a5a8a5cb92..a9492fbcd3 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ambari/InstanceMetadataUpdater.java\n\n@@ -272,6 +272,7 @@ public class InstanceMetadataUpdater {\n                 if (keySet.contains(stackTypedPackage)) {\n                     if (StringUtils.isEmpty(entry.getValue().get(stackTypedPackage))) {\n                         entry.getValue().remove(stackTypedPackage);\n+                        LOGGER.info(\"Remove empty stack type: {}\", stackTypedPackage);\n                     }\n                 }\n             }\n"}}, {"oid": "b1e7abb882db1421059ba14ed3711cf3c271a3df", "url": "https://github.com/hortonworks/cloudbreak/commit/b1e7abb882db1421059ba14ed3711cf3c271a3df", "message": "ENGESC-5953 remove empty stack versions when gathering stack versions", "committedDate": "2020-12-22T13:53:02Z", "type": "commit"}, {"oid": "b1e7abb882db1421059ba14ed3711cf3c271a3df", "url": "https://github.com/hortonworks/cloudbreak/commit/b1e7abb882db1421059ba14ed3711cf3c271a3df", "message": "ENGESC-5953 remove empty stack versions when gathering stack versions", "committedDate": "2020-12-22T13:53:02Z", "type": "forcePushed"}]}