{"pr_number": 7338, "pr_title": "CB-5547 added notification for user on whether repair can start or not", "pr_createdAt": "2020-02-20T13:53:41Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7338", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAyNjI0Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7338#discussion_r382026247", "bodyText": "Can you extend the unit test as well?", "author": "foldik", "createdAt": "2020-02-20T14:18:03Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairService.java", "diffHunk": "@@ -362,12 +364,14 @@ private void triggerRepairOrThrowBadRequest(Long stackId, Result<Map<HostGroupNa\n             boolean removeOnly,\n             Set<String> recoveryMessageArgument) {\n         if (repairValidationResult.isError()) {\n+            eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_COULD_NOT_START, repairValidationResult.getError().getValidationErrors());", "originalCommit": "8a178818250ed595b9150c4ec6966fd84716fcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEzMzk2Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7338#discussion_r382133967", "bodyText": "On hold because Unit test are broken.", "author": "lnardai", "createdAt": "2020-02-20T17:02:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAyNjI0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1ODYwNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7338#discussion_r383858607", "bodyText": "Added unit tests.", "author": "lnardai", "createdAt": "2020-02-25T12:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjAyNjI0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "2974fb5d594acab28e97e4e9957cdb1726bd8837", "chunk": "diff --git a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairService.java b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairService.java\nindex aded71d7d8..29d98f58b8 100644\n--- a/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairService.java\n+++ b/core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairService.java\n\n@@ -371,7 +371,7 @@ public class ClusterRepairService {\n                 flowManager.triggerClusterRepairFlow(stackId, toStringMap(repairValidationResult.getSuccess()), removeOnly);\n                 eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_REQUESTED, recoveryMessageArgument);\n             } else {\n-                eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_NO_NODES_TO_RECOVER);\n+                eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_NO_NODES_TO_RECOVER, recoveryMessageArgument);\n                 throw new BadRequestException(String.format(\"Could not trigger cluster repair  for stack %s, because node list is incorrect\", stackId));\n             }\n         }\n"}}, {"oid": "2974fb5d594acab28e97e4e9957cdb1726bd8837", "url": "https://github.com/hortonworks/cloudbreak/commit/2974fb5d594acab28e97e4e9957cdb1726bd8837", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-24T13:25:00Z", "type": "forcePushed"}, {"oid": "af890073d88c889871b6852a3e00d70f512225cb", "url": "https://github.com/hortonworks/cloudbreak/commit/af890073d88c889871b6852a3e00d70f512225cb", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-24T15:58:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2NjU1Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/7338#discussion_r383866557", "bodyText": "Do we need this in the future?", "author": "foldik", "createdAt": "2020-02-25T13:07:45Z", "path": "core/src/test/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairServiceTest.java", "diffHunk": "@@ -237,6 +241,7 @@ public void testCannotRepairGatewayWithoutExternalDatabase() throws CloudbreakIm\n         boolean result = underTest.canRepairAll(stack);\n \n         assertFalse(result);\n+        //eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_COULD_NOT_START, repairValidationResult.getError().getValidationErrors());", "originalCommit": "af890073d88c889871b6852a3e00d70f512225cb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5691f38be9b9ecd76e477d9b9754c3641c9e6600", "chunk": "diff --git a/core/src/test/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairServiceTest.java b/core/src/test/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairServiceTest.java\nindex 78a6687c7a..1a992131ea 100644\n--- a/core/src/test/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairServiceTest.java\n+++ b/core/src/test/java/com/sequenceiq/cloudbreak/service/cluster/ClusterRepairServiceTest.java\n\n@@ -241,7 +241,6 @@ public class ClusterRepairServiceTest {\n         boolean result = underTest.canRepairAll(stack);\n \n         assertFalse(result);\n-        //eventService.fireCloudbreakEvent(stackId, RECOVERY, CLUSTER_MANUALRECOVERY_COULD_NOT_START, repairValidationResult.getError().getValidationErrors());\n         verifyZeroInteractions(stackUpdater, flowManager, resourceService);\n     }\n \n"}}, {"oid": "5691f38be9b9ecd76e477d9b9754c3641c9e6600", "url": "https://github.com/hortonworks/cloudbreak/commit/5691f38be9b9ecd76e477d9b9754c3641c9e6600", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-25T14:41:25Z", "type": "forcePushed"}, {"oid": "e1ec482d2f3229582b548ed8e282af7b4abf7ad5", "url": "https://github.com/hortonworks/cloudbreak/commit/e1ec482d2f3229582b548ed8e282af7b4abf7ad5", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-26T10:53:26Z", "type": "forcePushed"}, {"oid": "1e3b500a49b836cdf00fd1554b371b04a8786aa1", "url": "https://github.com/hortonworks/cloudbreak/commit/1e3b500a49b836cdf00fd1554b371b04a8786aa1", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-26T13:07:21Z", "type": "commit"}, {"oid": "1e3b500a49b836cdf00fd1554b371b04a8786aa1", "url": "https://github.com/hortonworks/cloudbreak/commit/1e3b500a49b836cdf00fd1554b371b04a8786aa1", "message": "CB-5547 added notification for user on whether repair can start or not", "committedDate": "2020-02-26T13:07:21Z", "type": "forcePushed"}]}