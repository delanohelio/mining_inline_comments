{"pr_number": 8236, "pr_title": "CB-7105 Add resource based Auth for Redbeams api", "pr_createdAt": "2020-06-08T12:54:37Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8236", "timeline": [{"oid": "8198a4633cbfd858557a6d52c9e96550d42e8378", "url": "https://github.com/hortonworks/cloudbreak/commit/8198a4633cbfd858557a6d52c9e96550d42e8378", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-08T13:06:10Z", "type": "forcePushed"}, {"oid": "163dde1f1716c7d9e34f7fb673861b635b518151", "url": "https://github.com/hortonworks/cloudbreak/commit/163dde1f1716c7d9e34f7fb673861b635b518151", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-08T13:11:38Z", "type": "forcePushed"}, {"oid": "0b04a76387b63fd297d65e1068b985f65199ed2b", "url": "https://github.com/hortonworks/cloudbreak/commit/0b04a76387b63fd297d65e1068b985f65199ed2b", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-10T09:49:11Z", "type": "forcePushed"}, {"oid": "f727e818d1cf82262b0ba377eec7617ad9d1a461", "url": "https://github.com/hortonworks/cloudbreak/commit/f727e818d1cf82262b0ba377eec7617ad9d1a461", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-10T10:14:43Z", "type": "forcePushed"}, {"oid": "36c49527333e43e3a98bbf5da2baabfaf1a9e631", "url": "https://github.com/hortonworks/cloudbreak/commit/36c49527333e43e3a98bbf5da2baabfaf1a9e631", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-10T10:48:28Z", "type": "forcePushed"}, {"oid": "aa6d77e3ea67616d7ed5454ccea68812d79ae987", "url": "https://github.com/hortonworks/cloudbreak/commit/aa6d77e3ea67616d7ed5454ccea68812d79ae987", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-11T11:19:01Z", "type": "forcePushed"}, {"oid": "5fac5e7c44263549b4085455ddbf44d8e04f347e", "url": "https://github.com/hortonworks/cloudbreak/commit/5fac5e7c44263549b4085455ddbf44d8e04f347e", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-11T11:23:22Z", "type": "forcePushed"}, {"oid": "c43fd351306820c3e51dc19dda505537b7177819", "url": "https://github.com/hortonworks/cloudbreak/commit/c43fd351306820c3e51dc19dda505537b7177819", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-11T11:44:27Z", "type": "forcePushed"}, {"oid": "8244a662829cbb6264b00b82a3d4f7243db7269f", "url": "https://github.com/hortonworks/cloudbreak/commit/8244a662829cbb6264b00b82a3d4f7243db7269f", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-11T11:45:45Z", "type": "forcePushed"}, {"oid": "0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "url": "https://github.com/hortonworks/cloudbreak/commit/0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-11T12:54:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI0OTg0OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8236#discussion_r439249849", "bodyText": "Can you get just the crn from the database?", "author": "foldik", "createdAt": "2020-06-12T07:18:47Z", "path": "redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java", "diffHunk": "@@ -271,4 +280,25 @@ public Long getResourceIdByResourceCrn(String resourceCrn) {\n     public Long getResourceIdByResourceName(String resourceName) {\n         return getByName(resourceName).getId();\n     }\n+\n+    @Override\n+    public AuthorizationResourceType getResourceType() {\n+        return AuthorizationResourceType.DATABASE;\n+    }\n+\n+    @Override\n+    public String getResourceCrnByResourceName(String resourceName) {\n+        return getByName(resourceName).getResourceCrn().toString();", "originalCommit": "0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "chunk": "diff --git a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\nindex 7682bca639..f0b88a20b4 100644\n--- a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\n+++ b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\n\n@@ -288,13 +288,12 @@ public class DatabaseConfigService extends AbstractArchivistService<DatabaseConf\n \n     @Override\n     public String getResourceCrnByResourceName(String resourceName) {\n-        return getByName(resourceName).getResourceCrn().toString();\n+        return repository.findResourceCrnByName(resourceName).orElseThrow(NotFoundException.notFound(\"database\", resourceName));\n     }\n \n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n-        return repository.findByNameIn(resourceNames).stream()\n-                .map(db -> db.getResourceCrn().toString()).collect(Collectors.toList());\n+        return repository.findResourceCrnsByNames(resourceNames);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI0OTk4Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8236#discussion_r439249987", "bodyText": "Can you get just the crns from the database?", "author": "foldik", "createdAt": "2020-06-12T07:19:09Z", "path": "redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java", "diffHunk": "@@ -271,4 +280,25 @@ public Long getResourceIdByResourceCrn(String resourceCrn) {\n     public Long getResourceIdByResourceName(String resourceName) {\n         return getByName(resourceName).getId();\n     }\n+\n+    @Override\n+    public AuthorizationResourceType getResourceType() {\n+        return AuthorizationResourceType.DATABASE;\n+    }\n+\n+    @Override\n+    public String getResourceCrnByResourceName(String resourceName) {\n+        return getByName(resourceName).getResourceCrn().toString();\n+    }\n+\n+    @Override\n+    public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n+        return repository.findByNameIn(resourceNames).stream()", "originalCommit": "0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "chunk": "diff --git a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\nindex 7682bca639..f0b88a20b4 100644\n--- a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\n+++ b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbconfig/DatabaseConfigService.java\n\n@@ -288,13 +288,12 @@ public class DatabaseConfigService extends AbstractArchivistService<DatabaseConf\n \n     @Override\n     public String getResourceCrnByResourceName(String resourceName) {\n-        return getByName(resourceName).getResourceCrn().toString();\n+        return repository.findResourceCrnByName(resourceName).orElseThrow(NotFoundException.notFound(\"database\", resourceName));\n     }\n \n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n-        return repository.findByNameIn(resourceNames).stream()\n-                .map(db -> db.getResourceCrn().toString()).collect(Collectors.toList());\n+        return repository.findResourceCrnsByNames(resourceNames);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI1MDE2Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8236#discussion_r439250167", "bodyText": "Can you get just the crn from the database?", "author": "foldik", "createdAt": "2020-06-12T07:19:33Z", "path": "redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java", "diffHunk": "@@ -320,6 +325,22 @@ boolean validateDatabaseName(String databaseName) {\n \n     @Override\n     public AuthorizationResourceType getResourceType() {\n-        return AuthorizationResourceType.DATALAKE;\n+        return AuthorizationResourceType.DATABASE_SERVER;\n+    }\n+\n+    @Override\n+    public String getResourceCrnByResourceName(String resourceName) {\n+        return repository.findByName(resourceName).get().getResourceCrn().toString();", "originalCommit": "0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "chunk": "diff --git a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\nindex 1c6e32394e..1f39c9f248 100644\n--- a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\n+++ b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\n\n@@ -330,13 +330,12 @@ public class DatabaseServerConfigService extends AbstractArchivistService<Databa\n \n     @Override\n     public String getResourceCrnByResourceName(String resourceName) {\n-        return repository.findByName(resourceName).get().getResourceCrn().toString();\n+        return repository.findResourceCrnByName(resourceName).orElseThrow(NotFoundException.notFound(\"databaseserver\", resourceName));\n     }\n \n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n-        return repository.findByNameIn(resourceNames).stream()\n-                .map(dbServer -> dbServer.getResourceCrn().toString()).collect(Collectors.toList());\n+        return repository.findResourceCrnsByNames(resourceNames);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI1MDIyNw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8236#discussion_r439250227", "bodyText": "Can you get just the crns from the database?", "author": "foldik", "createdAt": "2020-06-12T07:19:44Z", "path": "redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java", "diffHunk": "@@ -320,6 +325,22 @@ boolean validateDatabaseName(String databaseName) {\n \n     @Override\n     public AuthorizationResourceType getResourceType() {\n-        return AuthorizationResourceType.DATALAKE;\n+        return AuthorizationResourceType.DATABASE_SERVER;\n+    }\n+\n+    @Override\n+    public String getResourceCrnByResourceName(String resourceName) {\n+        return repository.findByName(resourceName).get().getResourceCrn().toString();\n+    }\n+\n+    @Override\n+    public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n+        return repository.findByNameIn(resourceNames).stream()", "originalCommit": "0b4cbdd13fd11efd7b7fc0137f27af3fa47c4ba3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI2NjY1MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8236#discussion_r439266650", "bodyText": "I made repository methods for these as suggested", "author": "horadla23", "createdAt": "2020-06-12T07:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI1MDIyNw=="}], "type": "inlineReview", "revised_code": {"commit": "390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "chunk": "diff --git a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\nindex 1c6e32394e..1f39c9f248 100644\n--- a/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\n+++ b/redbeams/src/main/java/com/sequenceiq/redbeams/service/dbserverconfig/DatabaseServerConfigService.java\n\n@@ -330,13 +330,12 @@ public class DatabaseServerConfigService extends AbstractArchivistService<Databa\n \n     @Override\n     public String getResourceCrnByResourceName(String resourceName) {\n-        return repository.findByName(resourceName).get().getResourceCrn().toString();\n+        return repository.findResourceCrnByName(resourceName).orElseThrow(NotFoundException.notFound(\"databaseserver\", resourceName));\n     }\n \n     @Override\n     public List<String> getResourceCrnListByResourceNameList(List<String> resourceNames) {\n-        return repository.findByNameIn(resourceNames).stream()\n-                .map(dbServer -> dbServer.getResourceCrn().toString()).collect(Collectors.toList());\n+        return repository.findResourceCrnsByNames(resourceNames);\n     }\n \n     @Override\n"}}, {"oid": "390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "url": "https://github.com/hortonworks/cloudbreak/commit/390c12aecdd4e6a73f8d2cf23a0c5a245c16ad93", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-12T07:55:38Z", "type": "forcePushed"}, {"oid": "074b5389de948eabe9590e0006bfce0240b6c367", "url": "https://github.com/hortonworks/cloudbreak/commit/074b5389de948eabe9590e0006bfce0240b6c367", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-12T08:42:09Z", "type": "commit"}, {"oid": "074b5389de948eabe9590e0006bfce0240b6c367", "url": "https://github.com/hortonworks/cloudbreak/commit/074b5389de948eabe9590e0006bfce0240b6c367", "message": "CB-7105 Add resource based Auth for Redbeams api", "committedDate": "2020-06-12T08:42:09Z", "type": "forcePushed"}]}