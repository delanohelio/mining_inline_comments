{"pr_number": 3837, "pr_title": "Git3753 at Categories as a sub-object of Term", "pr_createdAt": "2020-10-08T15:50:32Z", "pr_url": "https://github.com/odpi/egeria/pull/3837", "timeline": [{"oid": "f975e4f6570399556a5e83c6c3d7a3d311a117bf", "url": "https://github.com/odpi/egeria/commit/f975e4f6570399556a5e83c6c3d7a3d311a117bf", "message": "git3753 add in basic categories support\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-06T13:07:20Z", "type": "commit"}, {"oid": "5e773f1d0d968d7e6bee3e3e12664efdf9a17357", "url": "https://github.com/odpi/egeria/commit/5e773f1d0d968d7e6bee3e3e12664efdf9a17357", "message": "git3753 fix up so the existing Subject Area OMAS FVT tests succeed\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-06T14:09:57Z", "type": "commit"}, {"oid": "0df869d4a1f01bd71d01213ed43c764faff7b0f5", "url": "https://github.com/odpi/egeria/commit/0df869d4a1f01bd71d01213ed43c764faff7b0f5", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3753", "committedDate": "2020-10-06T21:13:34Z", "type": "commit"}, {"oid": "a659beb533842a4995c2b4d3e5c0d82d90f1cfd4", "url": "https://github.com/odpi/egeria/commit/a659beb533842a4995c2b4d3e5c0d82d90f1cfd4", "message": "git3753 add term categories\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-08T14:30:37Z", "type": "commit"}, {"oid": "0a24f7c516761c8d5984400a1bfca786ddbbc7ff", "url": "https://github.com/odpi/egeria/commit/0a24f7c516761c8d5984400a1bfca786ddbbc7ff", "message": "git3753 remove debug lines\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-08T14:33:33Z", "type": "commit"}, {"oid": "271ec8be2f4e455d1378b7d83b1b9b827ade2929", "url": "https://github.com/odpi/egeria/commit/271ec8be2f4e455d1378b7d83b1b9b827ade2929", "message": "git3753 remove more debug lines\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-08T14:34:53Z", "type": "commit"}, {"oid": "5224e0bc0ea58f81a251bcd88d8aec6eb0d18fd0", "url": "https://github.com/odpi/egeria/commit/5224e0bc0ea58f81a251bcd88d8aec6eb0d18fd0", "message": "git3753 fix bug in test case\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-08T15:07:10Z", "type": "commit"}, {"oid": "fee3c8eb8eff91eb011767b741d7dd0b91d5f81c", "url": "https://github.com/odpi/egeria/commit/fee3c8eb8eff91eb011767b741d7dd0b91d5f81c", "message": "git3753 add SubjectAreaDefinition testing\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-08T15:47:12Z", "type": "commit"}, {"oid": "f64be83909d546abedf69b61d06733515631ac5b", "url": "https://github.com/odpi/egeria/commit/f64be83909d546abedf69b61d06733515631ac5b", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3753", "committedDate": "2020-10-08T15:47:48Z", "type": "commit"}, {"oid": "c707911e06d7b2721627d862c1017c0708a1a09e", "url": "https://github.com/odpi/egeria/commit/c707911e06d7b2721627d862c1017c0708a1a09e", "message": "Merge branch 'master' into git3753", "committedDate": "2020-10-09T09:14:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg5NTQxMQ==", "url": "https://github.com/odpi/egeria/pull/3837#discussion_r502895411", "bodyText": "Could you split all of this big logic on a few methods? Otherwise this method is very big and hard to read", "author": "immmus", "createdAt": "2020-10-11T10:18:38Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java", "diffHunk": "@@ -295,17 +387,60 @@ private void setGlossary(String userId, Term term, String methodName) throws Sub\n                             oMRSAPIHelper.callOMRSDeClassifyEntity(methodName, userId, guid, deClassifyName);\n                         }\n                     }\n+\n+                    List<CategorySummary> suppliedCategories = suppliedTerm.getCategories();\n+                    if (suppliedCategories==null && !isReplace) {\n+                        // in the update case with null categories supplied then do not change anything.\n+                    } else {\n+                        Set<String> deleteCategorizationGuidSet = new HashSet<>();", "originalCommit": "c707911e06d7b2721627d862c1017c0708a1a09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "966dfb280ccba1100f32a339090936f0d5aa77e4", "chunk": "diff --git a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\nindex 3abd940d09..fd86b09300 100644\n--- a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\n+++ b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\n\n@@ -387,38 +388,11 @@ public class SubjectAreaTermHandler extends SubjectAreaHandler {\n                             oMRSAPIHelper.callOMRSDeClassifyEntity(methodName, userId, guid, deClassifyName);\n                         }\n                     }\n-\n                     List<CategorySummary> suppliedCategories = suppliedTerm.getCategories();\n                     if (suppliedCategories==null && !isReplace) {\n                         // in the update case with null categories supplied then do not change anything.\n                     } else {\n-                        Set<String> deleteCategorizationGuidSet = new HashSet<>();\n-                        SubjectAreaOMASAPIResponse<Line> lineResponse = getTermRelationships(userId, guid, new FindRequest());\n-                        List<Line> lines= lineResponse.results();\n-                        /*\n-                         * The supplied categories may not be completely filled out.\n-                         * we will accept a guid (i.e. that of the category) and ignore the rest.\n-                         */\n-                        for (Line line : lines) {\n-                            if (line.getLineType().equals(LineType.TermCategorization)) {\n-                                deleteCategorizationGuidSet.add(line.getGuid());\n-                            }\n-                        }\n-\n-                        // always replace the categories if categories are supplied\n-                        // delete any existing categorizations\n-                        if (deleteCategorizationGuidSet != null && deleteCategorizationGuidSet.size() > 0) {\n-                            for (String categorizationGuidToDelete : deleteCategorizationGuidSet) {\n-                                String typeDefGuid = termCategorizationMapper.getTypeDefGuid();\n-                                oMRSAPIHelper.callOMRSDeleteRelationship(methodName, userId, typeDefGuid, \"TermCategorization\", categorizationGuidToDelete);\n-                            }\n-                        }\n-                        // add any supplied ones\n-                        if (suppliedCategories != null && suppliedCategories.size() > 0) {\n-                            for (CategorySummary categorySummary : suppliedCategories) {\n-                                addCategorizationRelationship(userId, suppliedTerm, methodName, categorySummary.getGuid());\n-                            }\n-                        }\n+                        replaceCategories(userId, guid, suppliedTerm, methodName);\n                     }\n                 }\n                 response = getTermByGuid(userId, guid);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg5NTUyMw==", "url": "https://github.com/odpi/egeria/pull/3837#discussion_r502895523", "bodyText": "Please make these fields to final.", "author": "immmus", "createdAt": "2020-10-11T10:19:43Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java", "diffHunk": "@@ -38,6 +40,9 @@\n  */\n public class SubjectAreaTermHandler extends SubjectAreaHandler {\n     private static final String className = SubjectAreaTermHandler.class.getName();\n+    private TermAnchorMapper termAnchorMapper;", "originalCommit": "c707911e06d7b2721627d862c1017c0708a1a09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "966dfb280ccba1100f32a339090936f0d5aa77e4", "chunk": "diff --git a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\nindex 3abd940d09..fd86b09300 100644\n--- a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\n+++ b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java\n\n@@ -40,9 +40,9 @@ import java.util.stream.Collectors;\n  */\n public class SubjectAreaTermHandler extends SubjectAreaHandler {\n     private static final String className = SubjectAreaTermHandler.class.getName();\n-    private TermAnchorMapper termAnchorMapper;\n-    private TermCategorizationMapper termCategorizationMapper;\n-    private CategoryMapper categoryMapper;\n+    private final TermAnchorMapper termAnchorMapper;\n+    private final TermCategorizationMapper termCategorizationMapper;\n+    private final CategoryMapper categoryMapper;\n \n     /**\n      * Construct the Subject Area Term Handler\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg5NTcxOA==", "url": "https://github.com/odpi/egeria/pull/3837#discussion_r502895718", "bodyText": "Please move this logic to another method.", "author": "immmus", "createdAt": "2020-10-11T10:21:28Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaTermHandler.java", "diffHunk": "@@ -95,17 +104,34 @@ public SubjectAreaTermHandler(OMRSAPIHelper oMRSAPIHelper) {\n                 TermMapper termMapper = mappersFactory.get(TermMapper.class);\n                 EntityDetail termEntityDetail = termMapper.map(suppliedTerm);\n                 GlossarySummary suppliedGlossary = suppliedTerm.getGlossary();\n+                List<CategorySummary> suppliedCategorysummaries = suppliedTerm.getCategories();\n \n                 String glossaryGuid = validateGlossarySummaryDuringCreation(userId, methodName, suppliedGlossary);\n+                validateCategoriesDuringCreation(userId,methodName,suppliedCategorysummaries);\n                 createdTermGuid = oMRSAPIHelper.callOMRSAddEntity(methodName, userId, termEntityDetail);\n                 if (createdTermGuid != null) {\n                     TermAnchor termAnchor = new TermAnchor();\n                     termAnchor.getEnd1().setNodeGuid(glossaryGuid);\n                     termAnchor.getEnd2().setNodeGuid(createdTermGuid);\n-                    TermAnchorMapper termAnchorMapper = mappersFactory.get(TermAnchorMapper.class);\n+\n                     Relationship relationship = termAnchorMapper.map(termAnchor);\n                     oMRSAPIHelper.callOMRSAddRelationship(methodName, userId, relationship);\n                     response = getTermByGuid(userId, createdTermGuid);\n+                    if (response.getRelatedHTTPCode() == 200) {\n+                        if (suppliedCategorysummaries != null && suppliedCategorysummaries.size() >0) {", "originalCommit": "c707911e06d7b2721627d862c1017c0708a1a09e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg5NjUxNQ==", "url": "https://github.com/odpi/egeria/pull/3837#discussion_r502896515", "bodyText": "This method is not used. Please remove it.", "author": "immmus", "createdAt": "2020-10-11T10:29:21Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/utilities/SubjectAreaUtils.java", "diffHunk": "@@ -151,6 +151,19 @@ public static GlossarySummary extractGlossarySummaryFromGlossary(Glossary glossa\n         extractNodeSummary(glossary, line, glossarySummary);\n         return glossarySummary;\n     }\n+    /**\n+     * Extract category Summary\n+     *\n+     * @param category the category that is to be summarised\n+     * @param line     the line to the category, which feeds part of the node summary\n+     * @return Category Summary or null\n+     */\n+    public static CategorySummary extractGlossarySummaryFromGlossary(Category category, Line line) {", "originalCommit": "c707911e06d7b2721627d862c1017c0708a1a09e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyNTM2OQ==", "url": "https://github.com/odpi/egeria/pull/3837#discussion_r503125369", "bodyText": "Removed.", "author": "davidradl", "createdAt": "2020-10-12T08:30:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg5NjUxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "966dfb280ccba1100f32a339090936f0d5aa77e4", "chunk": "diff --git a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/utilities/SubjectAreaUtils.java b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/utilities/SubjectAreaUtils.java\nindex f72dd0da8e..f734c7effa 100644\n--- a/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/utilities/SubjectAreaUtils.java\n+++ b/open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/utilities/SubjectAreaUtils.java\n\n@@ -151,19 +151,6 @@ public class SubjectAreaUtils {\n         extractNodeSummary(glossary, line, glossarySummary);\n         return glossarySummary;\n     }\n-    /**\n-     * Extract category Summary\n-     *\n-     * @param category the category that is to be summarised\n-     * @param line     the line to the category, which feeds part of the node summary\n-     * @return Category Summary or null\n-     */\n-    public static CategorySummary extractGlossarySummaryFromGlossary(Category category, Line line) {\n-        if (category == null) return null;\n-        CategorySummary categorySummary = new CategorySummary();\n-        extractNodeSummary(category, line, categorySummary);\n-        return categorySummary;\n-    }\n \n     /**\n      * Get glossary guid from anchors\n"}}, {"oid": "ebc85e47b07b2e8b1fceb563b4ff6c6ec6aad887", "url": "https://github.com/odpi/egeria/commit/ebc85e47b07b2e8b1fceb563b4ff6c6ec6aad887", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3753", "committedDate": "2020-10-12T08:26:53Z", "type": "commit"}, {"oid": "e42b40607c9805d66f7e0025f5849d398b3c62ca", "url": "https://github.com/odpi/egeria/commit/e42b40607c9805d66f7e0025f5849d398b3c62ca", "message": "Merge branch 'git3753' of https://github.com/davidradl/egeria into git3753", "committedDate": "2020-10-12T08:27:15Z", "type": "commit"}, {"oid": "966dfb280ccba1100f32a339090936f0d5aa77e4", "url": "https://github.com/odpi/egeria/commit/966dfb280ccba1100f32a339090936f0d5aa77e4", "message": "#3753 Amend after review feedback\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-12T09:03:49Z", "type": "commit"}]}