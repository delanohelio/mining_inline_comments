{"pr_number": 3572, "pr_title": "# Changed to java.util.concurrent Collections and removed unnecessary syncs.", "pr_createdAt": "2020-09-05T07:57:30Z", "pr_url": "https://github.com/odpi/egeria/pull/3572", "timeline": [{"oid": "6eb71ab9327642699dcddf1f651569d40cdd4b59", "url": "https://github.com/odpi/egeria/commit/6eb71ab9327642699dcddf1f651569d40cdd4b59", "message": "# Changed to java.util.concurrent Collections and removed unnecessary syncs.\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-09-05T07:50:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2MzA3OA==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490963078", "bodyText": "why change a specific import to a wildcard ?", "author": "wbittles", "createdAt": "2020-09-18T13:50:13Z", "path": "open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java", "diffHunk": "@@ -3,14 +3,14 @@\n package org.odpi.openmetadata.adapters.eventbus.topic.kafka;\r\n \r\n import java.time.Duration;\r\n-import java.util.ArrayDeque;\r\n import java.util.Collection;\r\n import java.util.Collections;\r\n import java.util.HashMap;\r\n import java.util.Map;\r\n import java.util.Properties;\r\n import java.util.Queue;\r\n-import java.util.concurrent.TimeUnit;\r\n+import java.util.concurrent.*;\r", "originalCommit": "6eb71ab9327642699dcddf1f651569d40cdd4b59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3NzgzMw==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490977833", "bodyText": "This idea was made automatically I just did not pay attention. But resole it is easily.", "author": "immmus", "createdAt": "2020-09-18T14:12:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2MzA3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE0Mzc5MA==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r491143790", "bodyText": "Good spot @wbittles - certainly we should not use wildcards.", "author": "planetf1", "createdAt": "2020-09-18T19:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2MzA3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE2MzE4NQ==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r491163185", "bodyText": "Yes, I will remove it . I am just on vocation now:)", "author": "immmus", "createdAt": "2020-09-18T20:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2MzA3OA=="}], "type": "inlineReview", "revised_code": {"commit": "eee91cf8a0d43f88970c9d30b437e5e43a812e35", "chunk": "diff --git a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java\nindex 99767402a7..b507039f2e 100644\n--- a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java\n+++ b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java\n\n@@ -9,7 +9,10 @@ import java.util.HashMap;\n import java.util.Map;\n import java.util.Properties;\n import java.util.Queue;\n-import java.util.concurrent.*;\n+import java.util.concurrent.BlockingDeque;\n+import java.util.concurrent.LinkedBlockingDeque;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.concurrent.TimeUnit;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import org.apache.kafka.clients.consumer.ConsumerRebalanceListener;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2NzQwNw==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490967407", "bodyText": "If the intention of this change is to modernise the code, then should these calls to currentTimeMillis() not be replaced with the more modern time classes, especially as duration is used below", "author": "wbittles", "createdAt": "2020-09-18T13:56:43Z", "path": "open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java", "diffHunk": "@@ -142,7 +141,7 @@ public void run()\n                 \r\n             \t//if we are close to the timeout, force a poll to avoid having the consumer\r\n             \t//be marked as dead because we have not polled often enough\r\n-            \tboolean pollRequired = System.currentTimeMillis() > maxNextPollTimestampToAvoidConsumerTimeout;\r\n+            \tfinal boolean pollRequired = System.currentTimeMillis() > maxNextPollTimestampToAvoidConsumerTimeout;\r", "originalCommit": "6eb71ab9327642699dcddf1f651569d40cdd4b59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3ODIxMA==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490978210", "bodyText": "In this case it has no meaning)", "author": "immmus", "createdAt": "2020-09-18T14:13:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2NzQwNw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2OTg2MA==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490969860", "bodyText": "If it's faster , do we still need this mapToCheck HashMap, it would be far more efficient not to actually make a copy.\nIt would be useful to understand any problem with locking the unprocessedEventQueues", "author": "wbittles", "createdAt": "2020-09-18T14:00:28Z", "path": "open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventConsumer.java", "diffHunk": "@@ -338,20 +334,10 @@ private boolean checkForFullyProcessedMessages() {\n         }\r\n         log.info(\"Checking for fully processed messages whose offsets need to be committed\");\r\n \r\n-        Map<TopicPartition, Queue<KafkaIncomingEvent>> mapToCheck = null;\r\n-        \r\n-        //Make a copy to minimize the amount of time we need to spent\r\n-        //holding a lock on the map.  If we do not synchronize here, a\r\n-        //concurrent modification exception will be thrown if an\r\n-        //attempt is made to update the map while we are iterating though it\r\n-        synchronized(unprocessedEventQueues) {\r\n-            mapToCheck = new HashMap<TopicPartition, Queue<KafkaIncomingEvent>>(unprocessedEventQueues);\r", "originalCommit": "6eb71ab9327642699dcddf1f651569d40cdd4b59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk4NzUxNQ==", "url": "https://github.com/odpi/egeria/pull/3572#discussion_r490987515", "bodyText": "That's exactly that we don't need it, I deleted this code. And we also dont need this lock, in principle, when working atomic collections and therefore I removed it.", "author": "immmus", "createdAt": "2020-09-18T14:26:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk2OTg2MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "eee91cf8a0d43f88970c9d30b437e5e43a812e35", "url": "https://github.com/odpi/egeria/commit/eee91cf8a0d43f88970c9d30b437e5e43a812e35", "message": "# removed import wildcard\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-09-19T18:21:53Z", "type": "commit"}, {"oid": "ef066197cd53a059789cd25ccbdcaa79d52566ab", "url": "https://github.com/odpi/egeria/commit/ef066197cd53a059789cd25ccbdcaa79d52566ab", "message": "# Made variables final\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-09-19T18:26:10Z", "type": "commit"}, {"oid": "d464f433c59fa5f3378d739c2855c8e56f256a1c", "url": "https://github.com/odpi/egeria/commit/d464f433c59fa5f3378d739c2855c8e56f256a1c", "message": "#3572 resolve conflicts\n\nSigned-off-by: Nigel Jones <nigel.l.jones+git@gmail.com>", "committedDate": "2020-12-07T16:41:32Z", "type": "commit"}, {"oid": "cb381db5b11b9ee9355445d919ad2d934ea2d3d8", "url": "https://github.com/odpi/egeria/commit/cb381db5b11b9ee9355445d919ad2d934ea2d3d8", "message": "Merge branch 'master' of https://github.com/odpi/egeria into immmus-kafka_connector_concurrency", "committedDate": "2020-12-07T16:53:41Z", "type": "commit"}, {"oid": "d39bbea225bf4e61b586543f73dd60596cfcffb2", "url": "https://github.com/odpi/egeria/commit/d39bbea225bf4e61b586543f73dd60596cfcffb2", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-08T07:30:06Z", "type": "commit"}, {"oid": "62a961cc7226df2345144109ba5eedeace6312e8", "url": "https://github.com/odpi/egeria/commit/62a961cc7226df2345144109ba5eedeace6312e8", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-11T08:04:37Z", "type": "commit"}, {"oid": "afeaaf3e60174e89008c19b43c0727a736982033", "url": "https://github.com/odpi/egeria/commit/afeaaf3e60174e89008c19b43c0727a736982033", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-11T14:33:49Z", "type": "commit"}, {"oid": "686ab2556a5f1ab2c5e310b89160a6902a54724f", "url": "https://github.com/odpi/egeria/commit/686ab2556a5f1ab2c5e310b89160a6902a54724f", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-14T11:17:40Z", "type": "commit"}, {"oid": "e55091b7cc49d31abbcdb155fb77f236fa5136d9", "url": "https://github.com/odpi/egeria/commit/e55091b7cc49d31abbcdb155fb77f236fa5136d9", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-16T22:13:58Z", "type": "commit"}, {"oid": "ada6773c6573d4ba957b1d36e746348f4c2689a3", "url": "https://github.com/odpi/egeria/commit/ada6773c6573d4ba957b1d36e746348f4c2689a3", "message": "Merge branch 'master' into kafka_connector_concurrency", "committedDate": "2020-12-18T08:52:09Z", "type": "commit"}]}