{"pr_number": 2725, "pr_title": "It infrastructure", "pr_createdAt": "2020-03-10T11:55:23Z", "pr_url": "https://github.com/odpi/egeria/pull/2725", "timeline": [{"oid": "f498a9b1b11673bcc40ffe0400f7dabb0f39f34a", "url": "https://github.com/odpi/egeria/commit/f498a9b1b11673bcc40ffe0400f7dabb0f39f34a", "message": "Changes to kafka producer lifecycle and debug logging\n\nSigned-off-by: William Bittles <wbittles@uk.ibm.com>", "committedDate": "2020-03-10T11:00:42Z", "type": "commit"}, {"oid": "0f058d25bf77acccd4e9c4618c6c4016f8f1a7fe", "url": "https://github.com/odpi/egeria/commit/0f058d25bf77acccd4e9c4618c6c4016f8f1a7fe", "message": "merge conflicts\n\nSigned-off-by: William Bittles <wbittles@uk.ibm.com>", "committedDate": "2020-03-10T11:44:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNjY3MQ==", "url": "https://github.com/odpi/egeria/pull/2725#discussion_r390306671", "bodyText": "Formatting isn't following the convention already present in the code:\nif (producer == null)\n{\n   // ...\n}", "author": "cmgrote", "createdAt": "2020-03-10T13:20:53Z", "path": "open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java", "diffHunk": "@@ -99,6 +100,10 @@ private void publishEvent(String event) throws ConnectorCheckedException\n         boolean                  eventSent = false;\n         long                     eventRetryCount = 0;\n \n+        if( producer == null){", "originalCommit": "0f058d25bf77acccd4e9c4618c6c4016f8f1a7fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTExOTU5NA==", "url": "https://github.com/odpi/egeria/pull/2725#discussion_r391119594", "bodyText": "If I can be super-picky (sorry!) I'd suggest the conditionals should be:\nif (producer == null)\n{\n   // ...\n}\nAt the moment all the if ... statements look more like function calls with the ( coming immediately after if without any space in-between, and instead a space between the ( and the variable used for comparison -- just looks messy...", "author": "cmgrote", "createdAt": "2020-03-11T16:56:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNjY3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "4fa14b90ac59b6a449c65d218c5b124f809018df", "chunk": "diff --git a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\nindex 4dc156e68d..eea018e190 100644\n--- a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\n+++ b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\n\n@@ -100,7 +100,8 @@ public class KafkaOpenMetadataEventProducer implements Runnable\n         boolean                  eventSent = false;\n         long                     eventRetryCount = 0;\n \n-        if( producer == null){\n+        if( producer == null)\n+        {\n             log.debug(\"Creating Producer\");\n             producer = new KafkaProducer<>(producerProperties);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwNzg5Mg==", "url": "https://github.com/odpi/egeria/pull/2725#discussion_r390307892", "bodyText": "I don't think we need to log an error here given that we're throwing an exception in the lines immediately following?", "author": "cmgrote", "createdAt": "2020-03-10T13:22:55Z", "path": "open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java", "diffHunk": "@@ -119,7 +124,11 @@ private void publishEvent(String event) throws ConnectorCheckedException\n                 if( !isExceptionRetryable(error)) {\n                     /* kafka thinks this isn't a retryable problem */\n                     /* so let the caller try */\n-                    log.error(\"Exception in sendEvent \" + error.toString());\n+\n+                    producer.close();\n+                    producer = null;\n+\n+                    log.error(\"Execution Exception closed producer \");", "originalCommit": "0f058d25bf77acccd4e9c4618c6c4016f8f1a7fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4fa14b90ac59b6a449c65d218c5b124f809018df", "chunk": "diff --git a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\nindex 4dc156e68d..eea018e190 100644\n--- a/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\n+++ b/open-metadata-implementation/adapters/open-connectors/event-bus-connectors/open-metadata-topic-connectors/kafka-open-metadata-topic-connector/src/main/java/org/odpi/openmetadata/adapters/eventbus/topic/kafka/KafkaOpenMetadataEventProducer.java\n\n@@ -121,14 +122,14 @@ public class KafkaOpenMetadataEventProducer implements Runnable\n                  */\n                 log.debug(\"Kafka had trouble sending event: \" + event + \"exception message is \" + error.getMessage());\n \n-                if( !isExceptionRetryable(error)) {\n+                if( !isExceptionRetryable(error))\n+                {\n                     /* kafka thinks this isn't a retryable problem */\n                     /* so let the caller try */\n \n                     producer.close();\n                     producer = null;\n \n-                    log.error(\"Execution Exception closed producer \");\n                     KafkaOpenMetadataTopicConnectorErrorCode errorCode = KafkaOpenMetadataTopicConnectorErrorCode.ERROR_SENDING_EVENT;\n                     String errorMessage = errorCode.getErrorMessageId() + errorCode.getFormattedErrorMessage(error.getClass().getName(),\n                             topicName,\n"}}, {"oid": "4fa14b90ac59b6a449c65d218c5b124f809018df", "url": "https://github.com/odpi/egeria/commit/4fa14b90ac59b6a449c65d218c5b124f809018df", "message": "Addressing review comments by cmgrote\n\nSigned-off-by: William Bittles <wbittles@uk.ibm.com>", "committedDate": "2020-03-10T14:27:00Z", "type": "commit"}, {"oid": "c4bcb5ecee79ee4748b72611a21fd2ab2ddc1cf7", "url": "https://github.com/odpi/egeria/commit/c4bcb5ecee79ee4748b72611a21fd2ab2ddc1cf7", "message": "cleaning up if statements\n\nSigned-off-by: William Bittles <wbittles@uk.ibm.com>", "committedDate": "2020-03-11T17:07:39Z", "type": "commit"}, {"oid": "3e041047b417de1059ba08799a10be32eb6f1851", "url": "https://github.com/odpi/egeria/commit/3e041047b417de1059ba08799a10be32eb6f1851", "message": "Merge branch 'master' into it-infrastructure", "committedDate": "2020-03-11T17:52:00Z", "type": "commit"}]}