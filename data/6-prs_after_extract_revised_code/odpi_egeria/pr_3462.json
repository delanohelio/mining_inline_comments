{"pr_number": 3462, "pr_title": "Fix problem with type resolving", "pr_createdAt": "2020-08-06T18:03:52Z", "pr_url": "https://github.com/odpi/egeria/pull/3462", "timeline": [{"oid": "daa1e771ccb9a680de6173119132f42fa2016e1a", "url": "https://github.com/odpi/egeria/commit/daa1e771ccb9a680de6173119132f42fa2016e1a", "message": "# Change type resolving\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-06T17:56:04Z", "type": "commit"}, {"oid": "a98a590d012ce6ddfea68a37038620caec69d81c", "url": "https://github.com/odpi/egeria/commit/a98a590d012ce6ddfea68a37038620caec69d81c", "message": "# Added jackson json annotations and other changes.\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-06T18:01:31Z", "type": "commit"}, {"oid": "d5214286162da0afcfceea715a12049d719bb88b", "url": "https://github.com/odpi/egeria/commit/d5214286162da0afcfceea715a12049d719bb88b", "message": "# Additional changes\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-06T21:07:00Z", "type": "commit"}, {"oid": "03a059b8256025aaae408f169098a0946cc5bf1e", "url": "https://github.com/odpi/egeria/commit/03a059b8256025aaae408f169098a0946cc5bf1e", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-07T08:32:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTYwMw==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r466945603", "bodyText": "I am unsure of the implications of this change - as it effects all Spring clients. Please could you detail in the issue and in the comments the need for this change. Does this work if the client is talking to a back level server -if the client is using a newer way to serialise Jackson. I think this change needs wider review - I will include other", "author": "davidradl", "createdAt": "2020-08-07T10:02:23Z", "path": "open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java", "diffHunk": "@@ -75,7 +75,15 @@ public SpringRESTClientConnector() throws NoSuchAlgorithmException, KeyStoreExce\n         /* Ensure that the REST template always uses UTF-8 */\n         List<HttpMessageConverter<?>> converters = restTemplate.getMessageConverters();\n         converters.removeIf(httpMessageConverter -> httpMessageConverter instanceof StringHttpMessageConverter);\n-        converters.add(0, new StringHttpMessageConverter(StandardCharsets.UTF_8));\n+        converters.removeIf(httpMessageConverter -> httpMessageConverter instanceof MappingJackson2HttpMessageConverter);", "originalCommit": "03a059b8256025aaae408f169098a0946cc5bf1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE2ODc1MA==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467168750", "bodyText": "@immmus Another thought - what is the implications of not have the spring rest client change. Is this required to fix the reported problem? If the Spring client changes are removed from the pr and the problem is still fixed I will merge. If this is the case, you can then submit these changes and justifications separately in another issue.", "author": "davidradl", "createdAt": "2020-08-07T17:17:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTYwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIxMTA0Nw==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467211047", "bodyText": "@immmus Another thought - what is the implications of not have the spring rest client change. Is this required to fix the reported problem? If the Spring client changes are removed from the pr and the problem is still fixed I will merge. If this is the case, you can then submit these changes and justifications separately in another issue.\n\n@davidradl Yes, this is not important change. I can rollback this tomorrow. Comment with confirmation if you want it", "author": "immmus", "createdAt": "2020-08-07T18:46:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTYwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI0MDM5MA==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467240390", "bodyText": "@immmus not entirely.\nIt is very good that you removed never thrown exception.\nBut, the reason why StringHttpMessageConverter is replaced (removed and added) with another instance using UTF-8 encoding instead of default ISO-8859-1 it is explained in the comment of the method.\nShortly, because of using regex as query param. Without it will break the regex.\nThat line needs to stay.\nAlso cannot see the reason why you have removed MappingJackson2HttpMessageConverter instance from the list.", "author": "bogdan-sava", "createdAt": "2020-08-07T19:54:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTYwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI2OTU0MA==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467269540", "bodyText": "@immmus not entirely.\nIt is very good that you removed never thrown exception.\nBut, the reason why StringHttpMessageConverter is replaced (removed and added) with another instance using UTF-8 encoding instead of default ISO-8859-1 it is explained in the comment of the method.\nShortly, because of using regex as query param. Without it will break the regex.\nThat line needs to stay.\nAlso cannot see the reason why you have removed MappingJackson2HttpMessageConverter instance from the list.\n\nI noticed that a comment was left to make sure the Rest Template always uses UTF-8. But since I knew that MappingJackson2HttpMessageConverter, since the default charset is not set, I decided to set it in accordance with this statement. I wrote about it in my comment -> #3462 (comment)\nAs I understood the problem with regex resolved adding this code:\n    DefaultUriBuilderFactory builderFactory = new DefaultUriBuilderFactory(); builderFactory.setEncodingMode(DefaultUriBuilderFactory.EncodingMode.VALUES_ONLY);", "author": "immmus", "createdAt": "2020-08-07T21:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NTYwMw=="}], "type": "inlineReview", "revised_code": {"commit": "2c0728f7777f0c09d918ca0eb581c5e3739275b8", "chunk": "diff --git a/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java b/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\nindex 7a8b7dac17..c73f27c609 100644\n--- a/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\n+++ b/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\n\n@@ -74,16 +73,7 @@ public class SpringRESTClientConnector extends RESTClientConnector\n \n         /* Ensure that the REST template always uses UTF-8 */\n         List<HttpMessageConverter<?>> converters = restTemplate.getMessageConverters();\n-        converters.removeIf(httpMessageConverter -> httpMessageConverter instanceof StringHttpMessageConverter);\n-        converters.removeIf(httpMessageConverter -> httpMessageConverter instanceof MappingJackson2HttpMessageConverter);\n-\n-        MappingJackson2HttpMessageConverter jackson2HttpMessageConverter = new MappingJackson2HttpMessageConverter();\n-        jackson2HttpMessageConverter.setDefaultCharset(StandardCharsets.UTF_8);\n-        StringHttpMessageConverter stringHttpMessageConverter = new StringHttpMessageConverter(StandardCharsets.UTF_8);\n-\n-        converters.add(jackson2HttpMessageConverter);\n-        converters.add(stringHttpMessageConverter);\n-        restTemplate.setMessageConverters(converters);\n+        converters.add(0, new StringHttpMessageConverter(StandardCharsets.UTF_8));\n     }\n \n     /**\n"}}, {"oid": "d949b947e58190512dd086f42b5068944a9d9f5c", "url": "https://github.com/odpi/egeria/commit/d949b947e58190512dd086f42b5068944a9d9f5c", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-07T10:25:30Z", "type": "commit"}, {"oid": "17e2b72b82f0f0648e23d28e6ab11434785ff415", "url": "https://github.com/odpi/egeria/commit/17e2b72b82f0f0648e23d28e6ab11434785ff415", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-07T13:50:51Z", "type": "commit"}, {"oid": "44e6e32a3569dd098e4d5b99afa00814d475c025", "url": "https://github.com/odpi/egeria/commit/44e6e32a3569dd098e4d5b99afa00814d475c025", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-07T16:30:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE0ODc1OA==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467148758", "bodyText": "This looks like just a style change and unnecessary.  Should follow the style of the rest of the module.", "author": "mandy-chessell", "createdAt": "2020-08-07T16:37:18Z", "path": "open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java", "diffHunk": "@@ -119,11 +127,7 @@ public void checkServerTrusted(X509Certificate[] certs, String authType) {\n      * @param sslSession ssl ession\n      * @return boolean result\n      */\n-    private static final HostnameVerifier bypassVerifier = new HostnameVerifier() {\n-        public boolean verify(String hostname, SSLSession sslSession) {\n-            return true;\n-        }\n-    };\n+    private static final HostnameVerifier bypassVerifier = (hostname, sslSession) -> true;", "originalCommit": "a98a590d012ce6ddfea68a37038620caec69d81c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzIwNzI1NA==", "url": "https://github.com/odpi/egeria/pull/3462#discussion_r467207254", "bodyText": "Okay I can rollback this change. Please comment with confirmation if you want it.", "author": "immmus", "createdAt": "2020-08-07T18:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE0ODc1OA=="}], "type": "inlineReview", "revised_code": {"commit": "cf84dac0a02e7290f814e0f177dadf45aaacbdfa", "chunk": "diff --git a/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java b/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\nindex 7a8b7dac17..46b3cd63eb 100644\n--- a/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\n+++ b/open-metadata-implementation/adapters/open-connectors/rest-client-connectors/spring-rest-client-connector/src/main/java/org/odpi/openmetadata/adapters/connectors/restclients/spring/SpringRESTClientConnector.java\n\n@@ -127,7 +117,11 @@ public class SpringRESTClientConnector extends RESTClientConnector\n      * @param sslSession ssl ession\n      * @return boolean result\n      */\n-    private static final HostnameVerifier bypassVerifier = (hostname, sslSession) -> true;\n+    private static final HostnameVerifier bypassVerifier = new HostnameVerifier() {\n+        public boolean verify(String hostname, SSLSession sslSession) {\n+            return true;\n+        }\n+    };\n \n     /**\n      * Initialize the connector.\n"}}, {"oid": "2c0728f7777f0c09d918ca0eb581c5e3739275b8", "url": "https://github.com/odpi/egeria/commit/2c0728f7777f0c09d918ca0eb581c5e3739275b8", "message": "# Rollback SpringRESTClientConnector changes\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-10T13:30:40Z", "type": "commit"}, {"oid": "a4a0c2cd5c0efb21be97bbb82ca7e8449f62c5ee", "url": "https://github.com/odpi/egeria/commit/a4a0c2cd5c0efb21be97bbb82ca7e8449f62c5ee", "message": "Merge remote-tracking branch 'origin/fix_problem_with_type_resolving' into fix_problem_with_type_resolving", "committedDate": "2020-08-10T13:31:03Z", "type": "commit"}, {"oid": "62376a61068b191dcb448579fba57ce02cc67907", "url": "https://github.com/odpi/egeria/commit/62376a61068b191dcb448579fba57ce02cc67907", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-11T14:18:27Z", "type": "commit"}, {"oid": "cf84dac0a02e7290f814e0f177dadf45aaacbdfa", "url": "https://github.com/odpi/egeria/commit/cf84dac0a02e7290f814e0f177dadf45aaacbdfa", "message": "# Rollback changes\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-12T06:19:17Z", "type": "commit"}, {"oid": "0a42d38e2d714c3582393d39eafbd8e6f8a6b190", "url": "https://github.com/odpi/egeria/commit/0a42d38e2d714c3582393d39eafbd8e6f8a6b190", "message": "Merge remote-tracking branch 'origin/fix_problem_with_type_resolving' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T06:19:42Z", "type": "commit"}, {"oid": "a47293d9490742a95e1d298748990b882d71f912", "url": "https://github.com/odpi/egeria/commit/a47293d9490742a95e1d298748990b882d71f912", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T07:58:35Z", "type": "commit"}, {"oid": "d1e05efd630135f9047f85227da1eab7f2e4b77c", "url": "https://github.com/odpi/egeria/commit/d1e05efd630135f9047f85227da1eab7f2e4b77c", "message": "# rollback\n\nSigned-off-by: immmus <fonto.trg@gmail.com>", "committedDate": "2020-08-12T08:01:02Z", "type": "commit"}, {"oid": "0945c30cfaa56dc8bc66a3e5af512a7f9c4f1b19", "url": "https://github.com/odpi/egeria/commit/0945c30cfaa56dc8bc66a3e5af512a7f9c4f1b19", "message": "Merge remote-tracking branch 'origin/fix_problem_with_type_resolving' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T08:01:17Z", "type": "commit"}, {"oid": "c57a007542f72af044daa42567b2e6b2a035cf97", "url": "https://github.com/odpi/egeria/commit/c57a007542f72af044daa42567b2e6b2a035cf97", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T08:03:12Z", "type": "commit"}, {"oid": "d4c2d9814c4e7ecc60e09bd91795a6c3c4e4345d", "url": "https://github.com/odpi/egeria/commit/d4c2d9814c4e7ecc60e09bd91795a6c3c4e4345d", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T09:38:56Z", "type": "commit"}, {"oid": "27363faf2bd222e58f37440116e6f44bf008daac", "url": "https://github.com/odpi/egeria/commit/27363faf2bd222e58f37440116e6f44bf008daac", "message": "Merge branch 'master' into fix_problem_with_type_resolving", "committedDate": "2020-08-12T11:02:33Z", "type": "commit"}]}