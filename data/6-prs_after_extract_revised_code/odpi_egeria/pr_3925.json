{"pr_number": 3925, "pr_title": "#3928 Adding parent and children rest calls to subject area omas.", "pr_createdAt": "2020-10-21T12:46:50Z", "pr_url": "https://github.com/odpi/egeria/pull/3925", "timeline": [{"oid": "253e7a87e9d6b1b7b303f1dda76d1aa572fa157f", "url": "https://github.com/odpi/egeria/commit/253e7a87e9d6b1b7b303f1dda76d1aa572fa157f", "message": "git3524 new paging requests\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-15T10:38:56Z", "type": "commit"}, {"oid": "003b85db421fef540b6e898fd5c84e16cecf915f", "url": "https://github.com/odpi/egeria/commit/003b85db421fef540b6e898fd5c84e16cecf915f", "message": "git3524 fix null pointers with paging\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-15T15:48:32Z", "type": "commit"}, {"oid": "4c68fd670760e6002888ae6cbeafc2baef2240c4", "url": "https://github.com/odpi/egeria/commit/4c68fd670760e6002888ae6cbeafc2baef2240c4", "message": "git3524 fix loop\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-16T09:01:41Z", "type": "commit"}, {"oid": "b36cea9fc80fa15a129a732c89b89ab4568aa598", "url": "https://github.com/odpi/egeria/commit/b36cea9fc80fa15a129a732c89b89ab4568aa598", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3524", "committedDate": "2020-10-16T09:05:49Z", "type": "commit"}, {"oid": "04cefb6cff1b69436d641cc8e9eb6124dddf571e", "url": "https://github.com/odpi/egeria/commit/04cefb6cff1b69436d641cc8e9eb6124dddf571e", "message": "git3524 correct compare of effectivity times in FVT\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-16T10:59:41Z", "type": "commit"}, {"oid": "63f35c8e3187f3c808bde64693978f3c79949374", "url": "https://github.com/odpi/egeria/commit/63f35c8e3187f3c808bde64693978f3c79949374", "message": "git3524 add more FVT tests\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-16T13:12:44Z", "type": "commit"}, {"oid": "6aac0534f308c9efbf3406a4e299a3ae10b43ded", "url": "https://github.com/odpi/egeria/commit/6aac0534f308c9efbf3406a4e299a3ae10b43ded", "message": "git3524 fix up server to completely fillout objects\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-19T10:32:53Z", "type": "commit"}, {"oid": "015b2ac1772cebe122f8cc1d1e254666e5705495", "url": "https://github.com/odpi/egeria/commit/015b2ac1772cebe122f8cc1d1e254666e5705495", "message": "git3524 fix bug in getting term categories\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-19T10:43:32Z", "type": "commit"}, {"oid": "b520aca31bd7a82fdcd8c266e077eca32bf2e5eb", "url": "https://github.com/odpi/egeria/commit/b520aca31bd7a82fdcd8c266e077eca32bf2e5eb", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3524", "committedDate": "2020-10-19T10:43:53Z", "type": "commit"}, {"oid": "c9eac568f91fae3f3daa94ece6e0914db8893aef", "url": "https://github.com/odpi/egeria/commit/c9eac568f91fae3f3daa94ece6e0914db8893aef", "message": "Merge branch 'master' into git3524", "committedDate": "2020-10-19T13:42:30Z", "type": "commit"}, {"oid": "2e60cf5560d9d3114b8860ca5bc558792b2719da", "url": "https://github.com/odpi/egeria/commit/2e60cf5560d9d3114b8860ca5bc558792b2719da", "message": "git3524 parent children glossary author fix\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-21T10:49:44Z", "type": "commit"}, {"oid": "54add0c7141e678f91b66ecb3fe77283743b4400", "url": "https://github.com/odpi/egeria/commit/54add0c7141e678f91b66ecb3fe77283743b4400", "message": "git3524 address review comments\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-21T12:07:18Z", "type": "commit"}, {"oid": "c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "url": "https://github.com/odpi/egeria/commit/c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3524-2", "committedDate": "2020-10-21T12:47:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNTkwNw==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r509305907", "bodyText": "Remove please package org.odpi.openmetadata.commonservices.ffdc.exceptions.", "author": "immmus", "createdAt": "2020-10-21T13:52:58Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaHandler.java", "diffHunk": "@@ -133,25 +141,102 @@ CategorySummary getCategorySummary(String restAPIName,\n                                                    Class<? extends INodeMapper<T>> mapperClass,\n                                                    String methodName) throws SubjectAreaCheckedException,\n                                                                              PropertyServerException,\n-                                                                             UserNotAuthorizedException\n-    {\n+                                                                             UserNotAuthorizedException, org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException {\n         List<EntityDetail> entityDetails = null;\n         List<T> foundEntities = null;\n+\n+        if (findRequest.getPageSize() == null) {\n+            findRequest.setPageSize(invalidParameterHandler.getMaxPagingSize());\n+        }\n+        invalidParameterHandler.validatePaging(findRequest.getStartingFrom(), findRequest.getPageSize(), methodName);\n         if (findRequest.getSearchCriteria() == null) {\n             entityDetails = oMRSAPIHelper.getEntitiesByType(methodName, userId, typeEntityName, findRequest);\n         } else {\n             entityDetails = oMRSAPIHelper.findEntitiesByPropertyValue(methodName, userId, typeEntityName, findRequest);\n         }\n         if (entityDetails != null) {\n-            INodeMapper<T> iNodeMapper = mappersFactory.get(mapperClass);\n-            foundEntities = new ArrayList<>();\n-            for (EntityDetail entityDetail : entityDetails) {\n-                foundEntities.add(iNodeMapper.map(entityDetail));\n-            }\n+            foundEntities = convertOmrsToOmas(entityDetails, mapperClass);\n         }\n         return foundEntities;\n     }\n \n+    /**\n+     * Get the related nodes from end 1 of a given type of relationship\n+     * @param methodName           name of the method being called.\n+     * @param userId               unique identifier for requesting user, under which the request is performed\n+     * @param guid                 guid\n+     * @param relationshipTypeName relationship type name\n+     * @param mapperClass          mapper class used to get the type name of the Node to return\n+     * @param startingFrom         retrieve items starting from this location\n+     * @param pageSize             maximum size of the returned items\n+     * @return response containing the the related Nodes if there are any\n+     */\n+    public <T extends Node> SubjectAreaOMASAPIResponse<T> getRelatedNodesForEnd1(String methodName,\n+                                                                                 String userId,\n+                                                                                 String guid,\n+                                                                                 String relationshipTypeName,\n+                                                                                 Class<? extends INodeMapper<T>> mapperClass,\n+                                                                                 Integer startingFrom,\n+                                                                                 Integer pageSize) {\n+        SubjectAreaOMASAPIResponse<T> response = new SubjectAreaOMASAPIResponse<>();\n+\n+        try {\n+            if (pageSize == null) {\n+               pageSize = maxPageSize;\n+            }\n+            invalidParameterHandler.validatePaging(startingFrom, pageSize, methodName);\n+            final INodeMapper<T> mapper = mappersFactory.get(mapperClass);\n+            List<EntityDetail> entityDetails= oMRSAPIHelper.callGetEntitiesForRelationshipEnd1(\n+                        methodName, userId, guid, mapper.getTypeName(), relationshipTypeName, startingFrom, pageSize);\n+            if (entityDetails != null) {\n+                for (EntityDetail entityDetail : entityDetails) {\n+                    response.addResult(mapper.map(entityDetail));\n+                }\n+            }\n+        } catch (UserNotAuthorizedException | SubjectAreaCheckedException | PropertyServerException | org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException e) {\n+            response.setExceptionInfo(e, className);\n+        }\n+        return response;\n+    }\n+    /**\n+     * Get the related nodes from end 2 of a given type of relationship\n+     * @param methodName           name of the method being called.\n+     * @param userId               unique identifier for requesting user, under which the request is performed\n+     * @param guid                 guid\n+     * @param relationshipTypeName relationship type name\n+     * @param mapperClass          mapper class used to get the type name of the Node to return\n+     * @param startingFrom         retrieve items starting from this location\n+     * @param pageSize             maximum size of the returned items\n+     * @return response containing the the related Nodes if there are any\n+     */\n+    public <T extends Node> SubjectAreaOMASAPIResponse<T> getRelatedNodesForEnd2(String methodName,\n+                                                                                 String userId,\n+                                                                                 String guid,\n+                                                                                 String relationshipTypeName,\n+                                                                                 Class<? extends INodeMapper<T>> mapperClass,\n+                                                                                 Integer startingFrom,\n+                                                                                 Integer pageSize) {\n+        SubjectAreaOMASAPIResponse<T> response = new SubjectAreaOMASAPIResponse<>();\n+\n+        try {\n+            if (pageSize == null) {\n+                pageSize = maxPageSize;\n+            }\n+            invalidParameterHandler.validatePaging(startingFrom, pageSize, methodName);\n+            final INodeMapper<T> mapper = mappersFactory.get(mapperClass);\n+            List<EntityDetail> entityDetails = oMRSAPIHelper.callGetEntitiesForRelationshipEnd2(\n+                   methodName, userId, guid, mapper.getTypeName(), relationshipTypeName, startingFrom, pageSize);\n+            if (entityDetails != null) {\n+                for (EntityDetail entityDetail : entityDetails) {\n+                    response.addResult(mapper.map(entityDetail));\n+                }\n+            }\n+        } catch (UserNotAuthorizedException | SubjectAreaCheckedException | PropertyServerException | org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException e) {", "originalCommit": "c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjE1Ng==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r509306156", "bodyText": "Remove please package org.odpi.openmetadata.commonservices.ffdc.exceptions.", "author": "immmus", "createdAt": "2020-10-21T13:53:09Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaHandler.java", "diffHunk": "@@ -168,10 +253,15 @@ CategorySummary getCategorySummary(String restAPIName,\n     {\n         SubjectAreaOMASAPIResponse<Line> response = new SubjectAreaOMASAPIResponse<>();\n         try {\n+            if (findRequest.getPageSize() == null) {\n+                findRequest.setPageSize(invalidParameterHandler.getMaxPagingSize());\n+            }\n+            invalidParameterHandler.validatePaging(findRequest.getStartingFrom(), findRequest.getPageSize(), methodName);\n             response.addAllResults(getAllLineForEntity(methodName, userId, guid, findRequest));\n-        } catch (UserNotAuthorizedException | SubjectAreaCheckedException | PropertyServerException e) {\n+        } catch (UserNotAuthorizedException | SubjectAreaCheckedException | PropertyServerException | org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException  e) {", "originalCommit": "c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTcyNjUxOQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r509726519", "bodyText": "@immmus I was thinking about this, I think that I need to catch this error around the validatePaging and re throw / change the org.odpi.openmetadata.commonservices.ffdc.exception to a Subject area invalid parameter Exception. Do you agree?", "author": "davidradl", "createdAt": "2020-10-21T21:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjE1Ng=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjMwNA==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r509306304", "bodyText": "Remove please package org.odpi.openmetadata.commonservices.ffdc.exceptions.", "author": "immmus", "createdAt": "2020-10-21T13:53:16Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaHandler.java", "diffHunk": "@@ -193,7 +283,11 @@ CategorySummary getCategorySummary(String restAPIName,\n                                            String entityGuid,\n                                            FindRequest findRequest) throws SubjectAreaCheckedException,\n                                                                            PropertyServerException,\n-                                                                           UserNotAuthorizedException {\n+                                                                           UserNotAuthorizedException, org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException {", "originalCommit": "c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA2OTA1Mw==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510069053", "bodyText": "I have raised issue #3929 to be more consistent with the use of InvalidParameterException(s) and only use the common one", "author": "davidradl", "createdAt": "2020-10-22T10:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjMwNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjQ1OQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r509306459", "bodyText": "Remove please package org.odpi.openmetadata.commonservices.ffdc.exceptions.", "author": "immmus", "createdAt": "2020-10-21T13:53:24Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaProjectHandler.java", "diffHunk": "@@ -155,7 +156,7 @@ public SubjectAreaProjectHandler(OMRSAPIHelper oMRSAPIHelper) {\n             } else {\n                 return response;\n             }\n-        } catch (SubjectAreaCheckedException | PropertyServerException | UserNotAuthorizedException e) {\n+        } catch (SubjectAreaCheckedException | PropertyServerException | UserNotAuthorizedException | org.odpi.openmetadata.commonservices.ffdc.exceptions.InvalidParameterException e) {", "originalCommit": "c713bf6c6aaac145c6f52b93f17eeb511e2fc66c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDAzODQ4Mg==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510038482", "bodyText": "OK will do", "author": "davidradl", "createdAt": "2020-10-22T10:04:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjQ1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA0MzczMw==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510043733", "bodyText": "The problem is that there is already an InvalidParameterExcpetion used by this class which is why I needed to qualify this one with the package. I think the answer is to remove the SubjectArea InvalidParameterException and replace it with the common one and use the InvalidParameterHandler more pervasively int the subject area code. @immmus given this, I suggest we merge this pr as is and then address this issue in an new Git issue", "author": "davidradl", "createdAt": "2020-10-22T10:13:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjQ1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI1OTY5NQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510259695", "bodyText": "Okay I understand you", "author": "immmus", "createdAt": "2020-10-22T15:34:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTMwNjQ1OQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MzIxOQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510263219", "bodyText": "I really don't like how methods like this are written. But, unfortunately, I do not have time to show you how I would have done it ...\nI am very sorry about this ...", "author": "immmus", "createdAt": "2020-10-22T15:39:21Z", "path": "open-metadata-implementation/access-services/subject-area/subject-area-server/src/main/java/org/odpi/openmetadata/accessservices/subjectarea/handlers/SubjectAreaCategoryHandler.java", "diffHunk": "@@ -423,4 +412,95 @@ private void updateAttributes(Category currentCategory, Category newTerm) {\n \n         return response;\n     }\n+\n+    /**\n+     * Get the terms that are categorized by this Category\n+     *\n+     * @param userId       unique identifier for requesting user, under which the request is performed\n+     * @param guid         guid of the category to get terms\n+     * @param termHandler term handler\n+     * @param startingFrom initial position in the stored list.\n+     * @param pageSize     maximum number of definitions to return on this call.\n+     * @return A list of terms is categorized by this Category\n+     * when not successful the following Exception responses can occur\n+     * <ul>\n+     * <li> UserNotAuthorizedException           the requesting user is not authorized to issue this request.</li>\n+     * <li> InvalidParameterException            one of the parameters is null or invalid.</li>\n+     * <li> PropertyServerException              Property server exception. </li>\n+     * </ul>\n+     * */\n+    public SubjectAreaOMASAPIResponse<Term> getCategorizedTerms(String userId, String guid, SubjectAreaTermHandler termHandler, int startingFrom, Integer pageSize) {", "originalCommit": "08642e57cae5cdcd171cd0677edd1404034a7324", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2NDI5OQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510264299", "bodyText": "I have to approve this because I have no free time right now, but for you this is an urgent change.", "author": "immmus", "createdAt": "2020-10-22T15:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MzIxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMwMTMyMQ==", "url": "https://github.com/odpi/egeria/pull/3925#discussion_r510301321", "bodyText": "Thanks for your understanding @immmus. I am interested in how you would prefer the methods to be written.", "author": "davidradl", "createdAt": "2020-10-22T16:32:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI2MzIxOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "acebcf76835b7bba99808a479b53904bd81d6303", "url": "https://github.com/odpi/egeria/commit/acebcf76835b7bba99808a479b53904bd81d6303", "message": "git3524 correct javadoc\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-23T09:07:21Z", "type": "commit"}, {"oid": "acebcf76835b7bba99808a479b53904bd81d6303", "url": "https://github.com/odpi/egeria/commit/acebcf76835b7bba99808a479b53904bd81d6303", "message": "git3524 correct javadoc\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-10-23T09:07:21Z", "type": "forcePushed"}, {"oid": "06a2d6aba3027a064c335c707f243a8cff0ae685", "url": "https://github.com/odpi/egeria/commit/06a2d6aba3027a064c335c707f243a8cff0ae685", "message": "Merge branch 'master' into git3524-2", "committedDate": "2020-10-23T09:28:14Z", "type": "commit"}, {"oid": "d389dcc83c1ad6a1418df21cf3b2f771455482ed", "url": "https://github.com/odpi/egeria/commit/d389dcc83c1ad6a1418df21cf3b2f771455482ed", "message": "Merge branch 'master' into git3524-2", "committedDate": "2020-10-23T13:39:58Z", "type": "commit"}, {"oid": "1edc5d8fc1c90e12e1fbd1ea3708fd38fbecb692", "url": "https://github.com/odpi/egeria/commit/1edc5d8fc1c90e12e1fbd1ea3708fd38fbecb692", "message": "Merge branch 'master' into git3524-2", "committedDate": "2020-10-23T13:52:35Z", "type": "commit"}, {"oid": "2379b42ac07f4cfe4a7e0cba95388066d7fba85a", "url": "https://github.com/odpi/egeria/commit/2379b42ac07f4cfe4a7e0cba95388066d7fba85a", "message": "Merge branch 'master' into git3524-2", "committedDate": "2020-10-23T14:29:55Z", "type": "commit"}]}