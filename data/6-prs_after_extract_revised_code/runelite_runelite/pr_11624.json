{"pr_number": 11624, "pr_title": "ClientUI: Remember sidebar state", "pr_createdAt": "2020-05-16T11:08:37Z", "pr_url": "https://github.com/runelite/runelite/pull/11624", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NjQyNw==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432956427", "bodyText": "Instead you can just not open the sidebar in the first place by removing the toggleSidebar call in init.", "author": "Adam-", "createdAt": "2020-05-31T15:11:19Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -552,6 +553,15 @@ public void show()\n \t\t\trequestFocus();\n \t\t\tgiveClientFocus();\n \t\t\tlog.info(\"Showing frame {}\", frame);\n+\n+\t\t\t// Close sidebar if config is set for it.\n+\t\t\tif (config.rememberSidebarState())\n+\t\t\t{\n+\t\t\t\tif (configManager.getConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED) != null)\n+\t\t\t\t{\n+\t\t\t\t\ttoggleSidebar();", "originalCommit": "d4f40ab501c99e40e45f4cc9a97f2f26bb2db3df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE0MTg4MA==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r442141880", "bodyText": "After doing this I realized that it causes a few other problems which I've also resolved, such as saveClientBoundsConfig() defaulting to 809 width to account for an always open sidebar.", "author": "Xortrox", "createdAt": "2020-06-18T10:56:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NjQyNw=="}], "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex b3204f7b0..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -534,34 +567,13 @@ public class ClientUI\n \t\t\t\tframe.setLocationRelativeTo(frame.getOwner());\n \t\t\t}\n \n-\t\t\t// If the frame is well hidden (e.g. unplugged 2nd screen),\n-\t\t\t// we want to move it back to default position as it can be\n-\t\t\t// hard for the user to reposition it themselves otherwise.\n-\t\t\tRectangle clientBounds = frame.getBounds();\n-\t\t\tRectangle screenBounds = frame.getGraphicsConfiguration().getBounds();\n-\t\t\tif (clientBounds.x + clientBounds.width - CLIENT_WELL_HIDDEN_MARGIN < screenBounds.getX() ||\n-\t\t\t\tclientBounds.x + CLIENT_WELL_HIDDEN_MARGIN > screenBounds.getX() + screenBounds.getWidth() ||\n-\t\t\t\tclientBounds.y + CLIENT_WELL_HIDDEN_MARGIN_TOP < screenBounds.getY() ||\n-\t\t\t\tclientBounds.y + CLIENT_WELL_HIDDEN_MARGIN > screenBounds.getY() + screenBounds.getHeight())\n-\t\t\t{\n-\t\t\t\tframe.setLocationRelativeTo(frame.getOwner());\n-\t\t\t}\n-\n \t\t\t// Show frame\n \t\t\tframe.setVisible(true);\n \t\t\tframe.toFront();\n \t\t\trequestFocus();\n \t\t\tgiveClientFocus();\n \t\t\tlog.info(\"Showing frame {}\", frame);\n-\n-\t\t\t// Close sidebar if config is set for it.\n-\t\t\tif (config.rememberSidebarState())\n-\t\t\t{\n-\t\t\t\tif (configManager.getConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED) != null)\n-\t\t\t\t{\n-\t\t\t\t\ttoggleSidebar();\n-\t\t\t\t}\n-\t\t\t}\n+\t\t\tframe.revalidateMinimumSize();\n \t\t});\n \n \t\t// Show out of date dialog if needed\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NjQ0Ng==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432956446", "bodyText": "It probably isn't necessary to have a config option for this", "author": "Adam-", "createdAt": "2020-05-31T15:11:35Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -552,6 +553,15 @@ public void show()\n \t\t\trequestFocus();\n \t\t\tgiveClientFocus();\n \t\t\tlog.info(\"Showing frame {}\", frame);\n+\n+\t\t\t// Close sidebar if config is set for it.\n+\t\t\tif (config.rememberSidebarState())", "originalCommit": "d4f40ab501c99e40e45f4cc9a97f2f26bb2db3df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NzAzOQ==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432957039", "bodyText": "Sorry for the double push, I only saw the first comment. But this should also be solved now.", "author": "Xortrox", "createdAt": "2020-05-31T15:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1NjQ0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex b3204f7b0..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -534,34 +567,13 @@ public class ClientUI\n \t\t\t\tframe.setLocationRelativeTo(frame.getOwner());\n \t\t\t}\n \n-\t\t\t// If the frame is well hidden (e.g. unplugged 2nd screen),\n-\t\t\t// we want to move it back to default position as it can be\n-\t\t\t// hard for the user to reposition it themselves otherwise.\n-\t\t\tRectangle clientBounds = frame.getBounds();\n-\t\t\tRectangle screenBounds = frame.getGraphicsConfiguration().getBounds();\n-\t\t\tif (clientBounds.x + clientBounds.width - CLIENT_WELL_HIDDEN_MARGIN < screenBounds.getX() ||\n-\t\t\t\tclientBounds.x + CLIENT_WELL_HIDDEN_MARGIN > screenBounds.getX() + screenBounds.getWidth() ||\n-\t\t\t\tclientBounds.y + CLIENT_WELL_HIDDEN_MARGIN_TOP < screenBounds.getY() ||\n-\t\t\t\tclientBounds.y + CLIENT_WELL_HIDDEN_MARGIN > screenBounds.getY() + screenBounds.getHeight())\n-\t\t\t{\n-\t\t\t\tframe.setLocationRelativeTo(frame.getOwner());\n-\t\t\t}\n-\n \t\t\t// Show frame\n \t\t\tframe.setVisible(true);\n \t\t\tframe.toFront();\n \t\t\trequestFocus();\n \t\t\tgiveClientFocus();\n \t\t\tlog.info(\"Showing frame {}\", frame);\n-\n-\t\t\t// Close sidebar if config is set for it.\n-\t\t\tif (config.rememberSidebarState())\n-\t\t\t{\n-\t\t\t\tif (configManager.getConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED) != null)\n-\t\t\t\t{\n-\t\t\t\t\ttoggleSidebar();\n-\t\t\t\t}\n-\t\t\t}\n+\t\t\tframe.revalidateMinimumSize();\n \t\t});\n \n \t\t// Show out of date dialog if needed\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1ODUyNg==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432958526", "bodyText": "this is backwards", "author": "Adam-", "createdAt": "2020-05-31T15:36:05Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -842,6 +851,7 @@ private void toggleSidebar()\n \t\t{\n \t\t\tsidebarNavigationJButton.setIcon(new ImageIcon(sidebarOpenIcon));\n \t\t\tsidebarNavigationJButton.setToolTipText(\"Open SideBar\");\n+\t\t\tconfigManager.unsetConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED);", "originalCommit": "8992581730fd79770711f90edb8aafc53379a9c6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex 76171101f..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -851,7 +882,7 @@ public class ClientUI\n \t\t{\n \t\t\tsidebarNavigationJButton.setIcon(new ImageIcon(sidebarOpenIcon));\n \t\t\tsidebarNavigationJButton.setToolTipText(\"Open SideBar\");\n-\t\t\tconfigManager.unsetConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED);\n+\t\t\tconfigManager.setConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED, true);\n \n \t\t\tcontract();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1ODUzNA==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432958534", "bodyText": "this is just wrong", "author": "Adam-", "createdAt": "2020-05-31T15:36:15Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -485,7 +486,15 @@ public void layoutContainer(Container parent)\n \t\t\t\tnull);\n \n \t\t\ttitleToolbar.addComponent(sidebarNavigationButton, sidebarNavigationJButton);\n-\t\t\ttoggleSidebar();\n+\n+\t\t\t// Close sidebar if config is set for it.\n+\n+\t\t\tif (configManager.getConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED) == null)", "originalCommit": "8992581730fd79770711f90edb8aafc53379a9c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3ODk0NA==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r432978944", "bodyText": "In hindsight seems maybe you meant to remove the config related code entirely, even the remembered state? Anyway seems the travis build failed due to some env variable issue now, which seems to be out of my control.", "author": "Xortrox", "createdAt": "2020-05-31T19:59:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1ODUzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI5NjUzMQ==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r434296531", "bodyText": "Realized the build failed due to another checkstyle issue, I got confused because travis said \"no environment variables set\"", "author": "Xortrox", "createdAt": "2020-06-03T04:08:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1ODUzNA=="}], "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex 76171101f..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -487,13 +490,10 @@ public class ClientUI\n \n \t\t\ttitleToolbar.addComponent(sidebarNavigationButton, sidebarNavigationJButton);\n \n-\t\t\t// Close sidebar if config is set for it.\n-\n+\t\t\t// Open sidebar if the config closed state is unset\n \t\t\tif (configManager.getConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED) == null)\n \t\t\t{\n \t\t\t\ttoggleSidebar();\n-\t\t\t} else {\n-\t\t\t\ttoggleSidebar();\n \t\t\t}\n \t\t});\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQwNDc3Nw==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r440404777", "bodyText": "This is still backwards. When the tooltip text is Close Sidebar it means the sidebar is open, because the option on it is to close it. So sidebar closed shouldn't be true.", "author": "Adam-", "createdAt": "2020-06-15T19:42:01Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -852,6 +859,7 @@ private void toggleSidebar()\n \t\t{\n \t\t\tsidebarNavigationJButton.setIcon(new ImageIcon(sidebarClosedIcon));\n \t\t\tsidebarNavigationJButton.setToolTipText(\"Close SideBar\");\n+\t\t\tconfigManager.setConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED, true);", "originalCommit": "9d3e54e960a395815e2e6c14a9cd9a5b330d3f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex d223e40ca..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -859,7 +893,7 @@ public class ClientUI\n \t\t{\n \t\t\tsidebarNavigationJButton.setIcon(new ImageIcon(sidebarClosedIcon));\n \t\t\tsidebarNavigationJButton.setToolTipText(\"Close SideBar\");\n-\t\t\tconfigManager.setConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED, true);\n+\t\t\tconfigManager.unsetConfiguration(CONFIG_GROUP, CONFIG_CLIENT_SIDEBAR_CLOSED);\n \n \t\t\t// Try to restore last panel\n \t\t\texpand(currentNavButton);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUwNjk1OQ==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r444506959", "bodyText": "This should just be .tooltip(\"Open SideBar\") in the above navbutton builder.", "author": "Adam-", "createdAt": "2020-06-23T21:02:57Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -484,8 +485,15 @@ public void layoutContainer(Container parent)\n \t\t\t\t0,\n \t\t\t\tnull);\n \n+\t\t\tsidebarNavigationJButton.setToolTipText(\"Open SideBar\");", "originalCommit": "04bd82ce3008152a81ff31d62a69e8488add5a44", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex 3e3277a51..d5cd0e5e3 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -485,8 +488,6 @@ public class ClientUI\n \t\t\t\t0,\n \t\t\t\tnull);\n \n-\t\t\tsidebarNavigationJButton.setToolTipText(\"Open SideBar\");\n-\n \t\t\ttitleToolbar.addComponent(sidebarNavigationButton, sidebarNavigationJButton);\n \n \t\t\t// Open sidebar if the config closed state is unset\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkwMzU0NQ==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r444903545", "bodyText": "this was merged incorrectly and now no longer compiles. I assume the removal of the above code was due to that it now remembers sidebar state so it doesn't have to offset the bounds by that anymore right?", "author": "Adam-", "createdAt": "2020-06-24T13:43:52Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -1097,11 +1106,7 @@ private void saveClientBoundsConfig()\n \t\t}\n \t\telse\n \t\t{\n-\t\t\t// Try to expand sidebar\n-\t\t\tif (!sidebarOpen)\n-\t\t\t{\n-\t\t\t\tbounds.width += pluginToolbar.getWidth();\n-\t\t\t}\n+\t\t\tfinal Rectangle bounds = frame.getBounds();", "originalCommit": "d7ed21eb7e72a6fe0d660bfaca7a42ce17f2a008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTIxNA==", "url": "https://github.com/runelite/runelite/pull/11624#discussion_r445025214", "bodyText": "Correct", "author": "Xortrox", "createdAt": "2020-06-24T16:35:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkwMzU0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "8a7b82b3b3b6f598c7d819e5477b472dbec71dcc", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex d5cd0e5e3..448c3179a 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -1106,11 +1106,8 @@ public class ClientUI\n \t\t}\n \t\telse\n \t\t{\n-\t\t\tfinal Rectangle bounds = frame.getBounds();\n-\n \t\t\tif (config.automaticResizeType() == ExpandResizeType.KEEP_GAME_SIZE)\n \t\t\t{\n-\n \t\t\t\t// Try to contract plugin panel\n \t\t\t\tif (pluginPanel != null)\n \t\t\t\t{\n"}}, {"oid": "3d4d3279d2b7d815ed1afc9e90278903794f2661", "url": "https://github.com/runelite/runelite/commit/3d4d3279d2b7d815ed1afc9e90278903794f2661", "message": "clientui: remember sidebar state across restarts\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-06-24T14:41:18Z", "type": "forcePushed"}, {"oid": "8a7b82b3b3b6f598c7d819e5477b472dbec71dcc", "url": "https://github.com/runelite/runelite/commit/8a7b82b3b3b6f598c7d819e5477b472dbec71dcc", "message": "clientui: remember sidebar state across restarts\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-06-24T15:27:18Z", "type": "commit"}, {"oid": "8a7b82b3b3b6f598c7d819e5477b472dbec71dcc", "url": "https://github.com/runelite/runelite/commit/8a7b82b3b3b6f598c7d819e5477b472dbec71dcc", "message": "clientui: remember sidebar state across restarts\n\nCo-authored-by: Adam <Adam@sigterm.info>", "committedDate": "2020-06-24T15:27:18Z", "type": "forcePushed"}]}