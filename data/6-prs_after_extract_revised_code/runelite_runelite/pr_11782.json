{"pr_number": 11782, "pr_title": "Merge UntradeableItemMapping and ItemMapping", "pr_createdAt": "2020-06-01T01:01:38Z", "pr_url": "https://github.com/runelite/runelite/pull/11782", "timeline": [{"oid": "e6b489502df4184677b99f87357af9dd89705d28", "url": "https://github.com/runelite/runelite/commit/e6b489502df4184677b99f87357af9dd89705d28", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-06-01T01:04:32Z", "type": "forcePushed"}, {"oid": "60ebfef759612251f3c142213f5b9ff426806ae8", "url": "https://github.com/runelite/runelite/commit/60ebfef759612251f3c142213f5b9ff426806ae8", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-06-01T05:26:55Z", "type": "forcePushed"}, {"oid": "3fa097d96854dcee0768f7c55cfdfa154c7739ca", "url": "https://github.com/runelite/runelite/commit/3fa097d96854dcee0768f7c55cfdfa154c7739ca", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-06-06T14:48:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUxODQ3MA==", "url": "https://github.com/runelite/runelite/pull/11782#discussion_r444518470", "bodyText": "get() is always non-null.", "author": "Adam-", "createdAt": "2020-06-23T21:27:17Z", "path": "runelite-client/src/main/java/net/runelite/client/game/ItemMapping.java", "diffHunk": "@@ -247,69 +249,102 @@\n \tITEM_CRYSTAL_BOW(CRYSTAL_WEAPON_SEED, CRYSTAL_BOW, CRYSTAL_BOW_24123, CRYSTAL_BOW_INACTIVE),\n \tITEM_CRYSTAL_HALBERD(CRYSTAL_WEAPON_SEED, CRYSTAL_HALBERD, CRYSTAL_HALBERD_24125, CRYSTAL_HALBERD_INACTIVE),\n \tITEM_CRYSTAL_SHIELD(CRYSTAL_WEAPON_SEED, CRYSTAL_SHIELD, CRYSTAL_SHIELD_24127, CRYSTAL_SHIELD_INACTIVE),\n+\tITEM_CRYSTAL_HELMET(CRYSTAL_ARMOUR_SEED, CRYSTAL_HELM, CRYSTAL_HELM_INACTIVE),\n+\tITEM_CRYSTAL_LEGS(CRYSTAL_ARMOUR_SEED, 2L, CRYSTAL_LEGS, CRYSTAL_LEGS_INACTIVE),\n+\tITEM_CRYSTAL_BODY(CRYSTAL_ARMOUR_SEED, 3L, CRYSTAL_BODY, CRYSTAL_BODY_INACTIVE),\n \n \t// Bird nests\n \tITEM_BIRD_NEST(BIRD_NEST_5075, BIRD_NEST, BIRD_NEST_5071, BIRD_NEST_5072, BIRD_NEST_5073, BIRD_NEST_5074, BIRD_NEST_7413, BIRD_NEST_13653, BIRD_NEST_22798, BIRD_NEST_22800, CLUE_NEST_EASY, CLUE_NEST_MEDIUM, CLUE_NEST_HARD, CLUE_NEST_ELITE),\n \n \t// Ancestral robes\n \tITEM_ANCESTRAL_HAT(ANCESTRAL_HAT, TWISTED_ANCESTRAL_HAT),\n \tITEM_ANCESTRAL_ROBE_TOP(ANCESTRAL_ROBE_TOP, TWISTED_ANCESTRAL_ROBE_TOP),\n-\tITEM_ANCESTRAL_ROBE_BOTTOM(ANCESTRAL_ROBE_BOTTOM, TWISTED_ANCESTRAL_ROBE_BOTTOM);\n+\tITEM_ANCESTRAL_ROBE_BOTTOM(ANCESTRAL_ROBE_BOTTOM, TWISTED_ANCESTRAL_ROBE_BOTTOM),\n \n-\tprivate static final Multimap<Integer, Integer> MAPPINGS = HashMultimap.create();\n+\t// Graceful\n+\tITEM_MARK_OF_GRACE(AMYLASE_CRYSTAL, true, 10L, MARK_OF_GRACE),\n+\tITEM_GRACEFUL_HOOD(MARK_OF_GRACE, true, 28L, GRACEFUL_HOOD),\n+\tITEM_GRACEFUL_TOP(MARK_OF_GRACE, true, 44L, GRACEFUL_TOP),\n+\tITEM_GRACEFUL_LEGS(MARK_OF_GRACE, true, 48L, GRACEFUL_LEGS),\n+\tITEM_GRACEFUL_GLOVES(MARK_OF_GRACE, true, 24L, GRACEFUL_GLOVES),\n+\tITEM_GRACEFUL_BOOTS(MARK_OF_GRACE, true, 32L, GRACEFUL_BOOTS),\n+\tITEM_GRACEFUL_CAPE(MARK_OF_GRACE, true, 32L, GRACEFUL_CAPE),\n+\n+\t// 10 golden nuggets = 100 soft clay\n+\tITEM_GOLDEN_NUGGET(SOFT_CLAY, true, 10L, GOLDEN_NUGGET),\n+\tITEM_PROSPECTOR_HELMET(GOLDEN_NUGGET, true, 32L, PROSPECTOR_HELMET),\n+\tITEM_PROSPECTOR_JACKET(GOLDEN_NUGGET, true, 48L, PROSPECTOR_JACKET),\n+\tITEM_PROSPECTOR_LEGS(GOLDEN_NUGGET, true, 40L, PROSPECTOR_LEGS),\n+\tITEM_PROSPECTOR_BOOTS(GOLDEN_NUGGET, true, 24L, PROSPECTOR_BOOTS),\n+\n+\t// Converted to coins\n+\tITEM_TATTERED_PAGE(COINS_995, true, 1000L, TATTERED_MOON_PAGE, TATTERED_SUN_PAGE, TATTERED_TEMPLE_PAGE),\n+\tITEM_LONG_BONE(COINS_995, true, 1000L, LONG_BONE),\n+\tITEM_CURVED_BONE(COINS_995, true, 2000L, CURVED_BONE),\n+\tITEM_PERFECT_SHELL(COINS_995, true, 600L, PERFECT_SHELL),\n+\tITEM_PERFECT_SNAIL_SHELL(COINS_995, true, 600L, PERFECT_SNAIL_SHELL),\n+\tITEM_SNAIL_SHELL(COINS_995, true, 600L, SNAIL_SHELL),\n+\tITEM_TORTOISE_SHELL(COINS_995, true, 250L, TORTOISE_SHELL);\n+\n+\tprivate static final Multimap<Integer, ItemMapping> MAPPINGS = HashMultimap.create();\n \tprivate final int tradeableItem;\n \tprivate final int[] untradableItems;\n+\tprivate final long quantity;\n+\tprivate final boolean untradeable;\n \n \tstatic\n \t{\n \t\tfor (final ItemMapping item : values())\n \t\t{\n \t\t\tfor (int itemId : item.untradableItems)\n \t\t\t{\n-\t\t\t\tMAPPINGS.put(itemId, item.tradeableItem);\n+\t\t\t\tif (item.untradeable)\n+\t\t\t\t{\n+\t\t\t\t\tfor (final Integer variation : ItemVariationMapping.getVariations(itemId))\n+\t\t\t\t\t{\n+\t\t\t\t\t\tMAPPINGS.put(variation, item);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tMAPPINGS.put(itemId, item);\n \t\t\t}\n \t\t}\n \t}\n \n-\tItemMapping(int tradeableItem, int... untradableItems)\n+\tItemMapping(int tradeableItem, boolean untradeable, long quantity, int... untradableItems)\n \t{\n \t\tthis.tradeableItem = tradeableItem;\n \t\tthis.untradableItems = untradableItems;\n+\t\tthis.quantity = quantity;\n+\t\tthis.untradeable = untradeable;\n \t}\n \n-\t/**\n-\t * Get collection of items that are mapped from single item id.\n-\t *\n-\t * @param itemId the item id\n-\t * @return the collection\n-\t */\n-\tpublic static Collection<Integer> map(int itemId)\n+\tItemMapping(int tradeableItem, long quantity, int... untradableItems)\n \t{\n-\t\tfinal Collection<Integer> mapping = MAPPINGS.get(itemId);\n-\n-\t\tif (mapping == null || mapping.isEmpty())\n-\t\t{\n-\t\t\treturn Collections.singleton(itemId);\n-\t\t}\n+\t\tthis(tradeableItem, false, quantity, untradableItems);\n+\t}\n \n-\t\treturn mapping;\n+\tItemMapping(int tradeableItem, int... untradableItems)\n+\t{\n+\t\tthis(tradeableItem, 1L, untradableItems);\n \t}\n \n \t/**\n-\t * Map an item from its untradeable version to its tradeable version\n+\t * Get collection of items that are mapped from single item id.\n \t *\n-\t * @param itemId\n-\t * @return\n+\t * @param itemId the item id\n+\t * @return the collection\n \t */\n-\tpublic static int mapFirst(int itemId)\n+\t@Nullable\n+\tpublic static Collection<ItemMapping> map(int itemId)\n \t{\n-\t\tfinal Collection<Integer> mapping = MAPPINGS.get(itemId);\n+\t\tfinal Collection<ItemMapping> mapping = MAPPINGS.get(itemId);\n \n \t\tif (mapping == null || mapping.isEmpty())", "originalCommit": "3fa097d96854dcee0768f7c55cfdfa154c7739ca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c5313e3ec223c8c543beeb1ce3e6f6bcc3c40e80", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/game/ItemMapping.java b/runelite-client/src/main/java/net/runelite/client/game/ItemMapping.java\nindex b3cbd5da0..e3f89c8e4 100644\n--- a/runelite-client/src/main/java/net/runelite/client/game/ItemMapping.java\n+++ b/runelite-client/src/main/java/net/runelite/client/game/ItemMapping.java\n\n@@ -340,7 +340,7 @@ public enum ItemMapping\n \t{\n \t\tfinal Collection<ItemMapping> mapping = MAPPINGS.get(itemId);\n \n-\t\tif (mapping == null || mapping.isEmpty())\n+\t\tif (mapping.isEmpty())\n \t\t{\n \t\t\treturn null;\n \t\t}\n"}}, {"oid": "c5313e3ec223c8c543beeb1ce3e6f6bcc3c40e80", "url": "https://github.com/runelite/runelite/commit/c5313e3ec223c8c543beeb1ce3e6f6bcc3c40e80", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-06-23T22:40:24Z", "type": "forcePushed"}, {"oid": "909f68b160f24709eb2c628b416a5383503f8496", "url": "https://github.com/runelite/runelite/commit/909f68b160f24709eb2c628b416a5383503f8496", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-09-21T02:42:46Z", "type": "commit"}, {"oid": "909f68b160f24709eb2c628b416a5383503f8496", "url": "https://github.com/runelite/runelite/commit/909f68b160f24709eb2c628b416a5383503f8496", "message": "Merge UntradeableItemMapping and ItemMapping\n\nThis enum never really made sense when we already have ItemMapping and\nits just confusing people.\n\nSigned-off-by: Tomas Slusny <slusnucky@gmail.com>", "committedDate": "2020-09-21T02:42:46Z", "type": "forcePushed"}]}