{"pr_number": 12229, "pr_title": "Fix NPE on resetting configs with null default value", "pr_createdAt": "2020-07-26T05:13:24Z", "pr_url": "https://github.com/runelite/runelite/pull/12229", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDQ3OTc1MQ==", "url": "https://github.com/runelite/runelite/pull/12229#discussion_r460479751", "bodyText": "Revert this change", "author": "raiyni", "createdAt": "2020-07-26T05:14:27Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/cannon/CannonConfig.java", "diffHunk": "@@ -89,10 +89,7 @@ default boolean showDoubleHitSpot()\n \t\tdescription = \"Configures the highlight color of double hit spots\",\n \t\tposition = 5\n \t)\n-\tdefault Color highlightDoubleHitColor()", "originalCommit": "eabfdf8a3950a22f7ff52b19b8d5440379200b4a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/cannon/CannonConfig.java b/runelite-client/src/main/java/net/runelite/client/plugins/cannon/CannonConfig.java\nindex 772976990..05ba93da2 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/cannon/CannonConfig.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/cannon/CannonConfig.java\n\n@@ -89,7 +89,10 @@ public interface CannonConfig extends Config\n \t\tdescription = \"Configures the highlight color of double hit spots\",\n \t\tposition = 5\n \t)\n-\tdefault Color highlightDoubleHitColor() { return Color.RED; }\n+\tdefault Color highlightDoubleHitColor()\n+\t{\n+\t\treturn Color.RED;\n+\t}\n \n \t@ConfigItem(\n \t\tkeyName = \"showCannonSpots\",\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY5ODM1Ng==", "url": "https://github.com/runelite/runelite/pull/12229#discussion_r462698356", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tAssert.assertEquals(conf.nullDefaultKey(), null);\n          \n          \n            \n            \t\tAssert.assertNull(conf.nullDefaultKey());", "author": "Nightfirecat", "createdAt": "2020-07-30T02:32:47Z", "path": "runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java", "diffHunk": "@@ -118,6 +118,21 @@ public void testGetConfigDescriptor() throws IOException\n \n \t\tTestConfig conf = manager.getConfig(TestConfig.class);\n \t\tConfigDescriptor descriptor = manager.getConfigDescriptor(conf);\n-\t\tAssert.assertEquals(1, descriptor.getItems().size());\n+\t\tAssert.assertEquals(2, descriptor.getItems().size());\n+\t}\n+\n+\t@Test\n+\tpublic void testResetNullDefaultConfig()\n+\t{\n+\t\tAccountSession accountSession = new AccountSession(UUID.randomUUID(), Instant.now());\n+\t\taccountSession.setUsername(\"test\");\n+\n+\t\tTestConfig conf = manager.getConfig(TestConfig.class);\n+\t\tConfigDescriptor descriptor = manager.getConfigDescriptor(conf);\n+\t\tconf.nullDefaultKey(\"new value\");\n+\n+\t\tmanager.unsetConfiguration(descriptor.getGroup().value(), \"nullDefaultKey\");\n+\t\tmanager.setDefaultConfiguration(conf, false);\n+\t\tAssert.assertEquals(conf.nullDefaultKey(), null);", "originalCommit": "987782010ced695dec218eb2ab6f648b577a2e5b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "chunk": "diff --git a/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java b/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\nindex 7ec2df963..208e90b69 100644\n--- a/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\n+++ b/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\n\n@@ -124,15 +124,12 @@ public class ConfigManagerTest\n \t@Test\n \tpublic void testResetNullDefaultConfig()\n \t{\n-\t\tAccountSession accountSession = new AccountSession(UUID.randomUUID(), Instant.now());\n-\t\taccountSession.setUsername(\"test\");\n-\n \t\tTestConfig conf = manager.getConfig(TestConfig.class);\n \t\tConfigDescriptor descriptor = manager.getConfigDescriptor(conf);\n \t\tconf.nullDefaultKey(\"new value\");\n \n \t\tmanager.unsetConfiguration(descriptor.getGroup().value(), \"nullDefaultKey\");\n \t\tmanager.setDefaultConfiguration(conf, false);\n-\t\tAssert.assertEquals(conf.nullDefaultKey(), null);\n+\t\tAssert.assertNull(conf.nullDefaultKey());\n \t}\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc3Mzc5Mw==", "url": "https://github.com/runelite/runelite/pull/12229#discussion_r474773793", "bodyText": "What is this?", "author": "Adam-", "createdAt": "2020-08-21T15:33:58Z", "path": "runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java", "diffHunk": "@@ -118,6 +118,21 @@ public void testGetConfigDescriptor() throws IOException\n \n \t\tTestConfig conf = manager.getConfig(TestConfig.class);\n \t\tConfigDescriptor descriptor = manager.getConfigDescriptor(conf);\n-\t\tAssert.assertEquals(1, descriptor.getItems().size());\n+\t\tAssert.assertEquals(2, descriptor.getItems().size());\n+\t}\n+\n+\t@Test\n+\tpublic void testResetNullDefaultConfig()\n+\t{\n+\t\tAccountSession accountSession = new AccountSession(UUID.randomUUID(), Instant.now());\n+\t\taccountSession.setUsername(\"test\");", "originalCommit": "02ee2e618b9cd2d48f82ba0b6c21a7d0430efab8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "chunk": "diff --git a/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java b/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\nindex 51ce71e9d..208e90b69 100644\n--- a/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\n+++ b/runelite-client/src/test/java/net/runelite/client/config/ConfigManagerTest.java\n\n@@ -124,9 +124,6 @@ public class ConfigManagerTest\n \t@Test\n \tpublic void testResetNullDefaultConfig()\n \t{\n-\t\tAccountSession accountSession = new AccountSession(UUID.randomUUID(), Instant.now());\n-\t\taccountSession.setUsername(\"test\");\n-\n \t\tTestConfig conf = manager.getConfig(TestConfig.class);\n \t\tConfigDescriptor descriptor = manager.getConfigDescriptor(conf);\n \t\tconf.nullDefaultKey(\"new value\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc3NjI0MA==", "url": "https://github.com/runelite/runelite/pull/12229#discussion_r474776240", "bodyText": "Shouldn't this just be object == null ? null : object.toString()?", "author": "Adam-", "createdAt": "2020-08-21T15:38:20Z", "path": "runelite-client/src/main/java/net/runelite/client/config/ConfigManager.java", "diffHunk": "@@ -703,7 +703,7 @@ static String objectToString(Object object)\n \t\t{\n \t\t\treturn Long.toString(((Duration) object).toMillis());\n \t\t}\n-\t\treturn object.toString();\n+\t\treturn object == null ? \"\" : object.toString();", "originalCommit": "02ee2e618b9cd2d48f82ba0b6c21a7d0430efab8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/config/ConfigManager.java b/runelite-client/src/main/java/net/runelite/client/config/ConfigManager.java\nindex 9f066f42d..7b789b57e 100644\n--- a/runelite-client/src/main/java/net/runelite/client/config/ConfigManager.java\n+++ b/runelite-client/src/main/java/net/runelite/client/config/ConfigManager.java\n\n@@ -703,7 +704,7 @@ public class ConfigManager\n \t\t{\n \t\t\treturn Long.toString(((Duration) object).toMillis());\n \t\t}\n-\t\treturn object == null ? \"\" : object.toString();\n+\t\treturn object == null ? null : object.toString();\n \t}\n \n \t@Subscribe(priority = 100)\n"}}, {"oid": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "url": "https://github.com/runelite/runelite/commit/5fe7d11d53da27bebc653a806b7fa0898205b8b1", "message": "ConfigManager: Fix NPE when resetting configs with null default", "committedDate": "2020-10-08T21:34:14Z", "type": "commit"}, {"oid": "5fe7d11d53da27bebc653a806b7fa0898205b8b1", "url": "https://github.com/runelite/runelite/commit/5fe7d11d53da27bebc653a806b7fa0898205b8b1", "message": "ConfigManager: Fix NPE when resetting configs with null default", "committedDate": "2020-10-08T21:34:14Z", "type": "forcePushed"}]}