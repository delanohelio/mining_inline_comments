{"pr_number": 11522, "pr_title": "discord: Update activity message while playing PVP or DMM", "pr_createdAt": "2020-05-09T21:34:38Z", "pr_url": "https://github.com/runelite/runelite/pull/11522", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTA3Ng==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422549076", "bodyText": "Deadman is still a PVP world type. Why is this removed?", "author": "Nightfirecat", "createdAt": "2020-05-09T21:36:08Z", "path": "runelite-api/src/main/java/net/runelite/api/WorldType.java", "diffHunk": "@@ -77,10 +78,13 @@\n \t}\n \n \tprivate static final EnumSet<WorldType> PVP_WORLD_TYPES = EnumSet.of(\n-\t\tDEADMAN,", "originalCommit": "4b3ed9ca759f24360f449ce5e5f637f78ec86911", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTUxMw==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422549513", "bodyText": "Well it can be left, but the deadman check comes before the PVP world check. So if they're in a deadman world, PVP_WORLD_TYPES will never be checked.", "author": "rangvaldr", "createdAt": "2020-05-09T21:40:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTA3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTc4NQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422549785", "bodyText": "isPvpWorld is used outside of the discord plugin, so this would cause adverse effects for other plugins.", "author": "Nightfirecat", "createdAt": "2020-05-09T21:43:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTA3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1OTYzNg==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422559636", "bodyText": "Fixed.", "author": "rangvaldr", "createdAt": "2020-05-09T23:30:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTA3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "2959f8dec8192a8fce7c1bba91d7fdf92f0cf586", "chunk": "diff --git a/runelite-api/src/main/java/net/runelite/api/WorldType.java b/runelite-api/src/main/java/net/runelite/api/WorldType.java\nindex 7e702ec17..2bd54cf0e 100644\n--- a/runelite-api/src/main/java/net/runelite/api/WorldType.java\n+++ b/runelite-api/src/main/java/net/runelite/api/WorldType.java\n\n@@ -78,13 +81,10 @@ public enum WorldType\n \t}\n \n \tprivate static final EnumSet<WorldType> PVP_WORLD_TYPES = EnumSet.of(\n+\t\tDEADMAN, // dmmt worlds are also flaged as DEADMAN\n \t\tPVP\n \t);\n \n-\tprivate static final EnumSet<WorldType> DEADMAN_WORLD_TYPES = EnumSet.of(\n-\t\tDEADMAN\n-\t);\n-\n \t/**\n \t * Create enum set of world types from mask.\n \t *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0OTIxNQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422549215", "bodyText": "This can be replaced by Client.getWorldType().contains(WorldType.DEADMAN) since there is only one deadman world type.", "author": "Nightfirecat", "createdAt": "2020-05-09T21:37:33Z", "path": "runelite-api/src/main/java/net/runelite/api/WorldType.java", "diffHunk": "@@ -131,4 +135,16 @@ public static boolean isPvpWorld(final Collection<WorldType> worldTypes)\n \t{\n \t\treturn worldTypes.stream().anyMatch(PVP_WORLD_TYPES::contains);\n \t}\n+\n+\t/**\n+\t * Checks whether a world having a {@link Collection} of {@link WorldType}s is a Deadman world.\n+\t *\n+\t * @param worldTypes A {@link Collection} of {@link WorldType}s describing the given world.\n+\t * @return           True if the given worldtypes of the world are a Deadman world, false otherwise.\n+\t * @see Client#getWorldType()\n+\t */\n+\tpublic static boolean isDeadmanWorld(final Collection<WorldType> worldTypes)", "originalCommit": "4b3ed9ca759f24360f449ce5e5f637f78ec86911", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2959f8dec8192a8fce7c1bba91d7fdf92f0cf586", "chunk": "diff --git a/runelite-api/src/main/java/net/runelite/api/WorldType.java b/runelite-api/src/main/java/net/runelite/api/WorldType.java\nindex 7e702ec17..2bd54cf0e 100644\n--- a/runelite-api/src/main/java/net/runelite/api/WorldType.java\n+++ b/runelite-api/src/main/java/net/runelite/api/WorldType.java\n\n@@ -135,16 +135,4 @@ public enum WorldType\n \t{\n \t\treturn worldTypes.stream().anyMatch(PVP_WORLD_TYPES::contains);\n \t}\n-\n-\t/**\n-\t * Checks whether a world having a {@link Collection} of {@link WorldType}s is a Deadman world.\n-\t *\n-\t * @param worldTypes A {@link Collection} of {@link WorldType}s describing the given world.\n-\t * @return           True if the given worldtypes of the world are a Deadman world, false otherwise.\n-\t * @see Client#getWorldType()\n-\t */\n-\tpublic static boolean isDeadmanWorld(final Collection<WorldType> worldTypes)\n-\t{\n-\t\treturn worldTypes.stream().anyMatch(DEADMAN_WORLD_TYPES::contains);\n-\t}\n }\n"}}, {"oid": "7bc4437aebad53f4cf045af6c834007a20e83d91", "url": "https://github.com/runelite/runelite/commit/7bc4437aebad53f4cf045af6c834007a20e83d91", "message": "discord: Hide location while playing Deadman Mode", "committedDate": "2020-05-09T21:38:52Z", "type": "commit"}, {"oid": "7bc4437aebad53f4cf045af6c834007a20e83d91", "url": "https://github.com/runelite/runelite/commit/7bc4437aebad53f4cf045af6c834007a20e83d91", "message": "discord: Hide location while playing Deadman Mode", "committedDate": "2020-05-09T21:38:52Z", "type": "forcePushed"}, {"oid": "2959f8dec8192a8fce7c1bba91d7fdf92f0cf586", "url": "https://github.com/runelite/runelite/commit/2959f8dec8192a8fce7c1bba91d7fdf92f0cf586", "message": "Implement PR feedback", "committedDate": "2020-05-09T23:29:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422574576", "bodyText": "Why are you implementing this differently than current PVP world check? Just use the same logic and in same method", "author": "deathbeam", "createdAt": "2020-05-10T02:39:45Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java", "diffHunk": "@@ -381,6 +381,12 @@ private void checkForAreaUpdate()\n \t\t\treturn;\n \t\t}\n \n+\t\tif (client.getWorldType().contains(WorldType.DEADMAN))", "originalCommit": "2959f8dec8192a8fce7c1bba91d7fdf92f0cf586", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDcyMA==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422574720", "bodyText": "Actually nvm, that is already contained in PVP check. I don't understand why anything extra needs to be implemented", "author": "deathbeam", "createdAt": "2020-05-10T02:41:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0OTQzNg==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422649436", "bodyText": "Well if you were okay with just hiding the activity completely, similar to PVP, no changes would be necessary. But in #11430 you had mentioned adding the activity line \"Playing Deadman Mode\", which is what's implemented here and does require the additional changes. If you just want to hide the activity, feel free to close the PR.", "author": "rangvaldr", "createdAt": "2020-05-10T13:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDU2NQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422650565", "bodyText": "Imo it is fine to display playing DMM and I would be happy merging that, my only requirement is for it to be implemented for all cases we are skipping atm (e.g all types of PVP worlds)", "author": "deathbeam", "createdAt": "2020-05-10T14:09:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MDk2OQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422650969", "bodyText": "Gotcha.", "author": "rangvaldr", "createdAt": "2020-05-10T14:13:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjE4OQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422652189", "bodyText": "Resolved with 30eab1a.", "author": "rangvaldr", "createdAt": "2020-05-10T14:23:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3NDU3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "30eab1ad2e9d701e2912733beb45e3105115f0f3", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java\nindex 2bb4d7b7a..017f229da 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java\n\n@@ -381,11 +381,18 @@ public class DiscordPlugin extends Plugin\n \t\t\treturn;\n \t\t}\n \n-\t\tif (client.getWorldType().contains(WorldType.DEADMAN))\n+\t\tfinal EnumSet<WorldType> worldType = client.getWorldType();\n+\n+\t\tif (worldType.contains(WorldType.DEADMAN))\n \t\t{\n \t\t\tdiscordState.triggerEvent(DiscordGameEventType.PLAYING_DEADMAN);\n \t\t\treturn;\n \t\t}\n+\t\telse if (WorldType.isPvpWorld(worldType))\n+\t\t{\n+\t\t\tdiscordState.triggerEvent(DiscordGameEventType.PLAYING_PVP);\n+\t\t\treturn;\n+\t\t}\n \n \t\tDiscordGameEventType discordGameEventType = DiscordGameEventType.fromRegion(playerRegionID);\n \n"}}, {"oid": "30eab1ad2e9d701e2912733beb45e3105115f0f3", "url": "https://github.com/runelite/runelite/commit/30eab1ad2e9d701e2912733beb45e3105115f0f3", "message": "Add message for playing in PVP worlds", "committedDate": "2020-05-10T14:21:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjQ5Mw==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422652493", "bodyText": "this should return playing DMM even for tournament DMM worlds imo", "author": "deathbeam", "createdAt": "2020-05-10T14:25:53Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/discord/DiscordPlugin.java", "diffHunk": "@@ -381,6 +381,19 @@ private void checkForAreaUpdate()\n \t\t\treturn;\n \t\t}\n \n+\t\tfinal EnumSet<WorldType> worldType = client.getWorldType();\n+\n+\t\tif (worldType.contains(WorldType.DEADMAN))", "originalCommit": "30eab1ad2e9d701e2912733beb45e3105115f0f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjU1Ng==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422652556", "bodyText": "There was a comment in the code that tournament worlds were also flagged deadman.", "author": "rangvaldr", "createdAt": "2020-05-10T14:26:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjQ5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjU1OQ==", "url": "https://github.com/runelite/runelite/pull/11522#discussion_r422652559", "bodyText": "Nvm, I just read the comment in PVP_WORLD_TYPES, this is fine", "author": "deathbeam", "createdAt": "2020-05-10T14:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY1MjQ5Mw=="}], "type": "inlineReview", "revised_code": null}]}