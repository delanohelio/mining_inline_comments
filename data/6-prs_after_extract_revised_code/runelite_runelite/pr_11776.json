{"pr_number": 11776, "pr_title": "Respect multiple displays when saving/loading client position", "pr_createdAt": "2020-05-31T16:27:49Z", "pr_url": "https://github.com/runelite/runelite/pull/11776", "timeline": [{"oid": "b8be0c30339787a545ef3a6a74195ac388b180b7", "url": "https://github.com/runelite/runelite/commit/b8be0c30339787a545ef3a6a74195ac388b180b7", "message": "respect 2+ displays when saving/loading client pos", "committedDate": "2020-05-31T16:24:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3MDY1Nw==", "url": "https://github.com/runelite/runelite/pull/11776#discussion_r433270657", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\t\tif (scale != 1)\n          \n          \n            \n            \t\t\t\t\t\t\t// When windows screen scaling is on, the position/bounds will be wrong when they are set. The bounds saved in shutdown are the full, non-scaled coordinates. \n          \n          \n            \n            \t\t\t\t\t\t\tif (scale != 1)", "author": "raiyni", "createdAt": "2020-06-01T14:33:50Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -510,7 +512,28 @@ public void show()\n \t\t\t\t\tif (clientBounds != null)\n \t\t\t\t\t{\n \t\t\t\t\t\tframe.setBounds(clientBounds);\n-\t\t\t\t\t\tframe.revalidateMinimumSize();\n+\n+\t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);\n+\t\t\t\t\t\tif (gc != null)\n+\t\t\t\t\t\t{\n+\t\t\t\t\t\t\tdouble scale = gc.getDefaultTransform().getScaleX();\n+\n+\t\t\t\t\t\t\tif (scale != 1)", "originalCommit": "b8be0c30339787a545ef3a6a74195ac388b180b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "09b73482a91a7a89ec120f2fd88a384a7b1aee5c", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex 1528462d1..27078c48b 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -513,11 +513,15 @@ public class ClientUI\n \t\t\t\t\t{\n \t\t\t\t\t\tframe.setBounds(clientBounds);\n \n+\t\t\t\t\t\t// frame.getGraphicsConfiguration().getBounds() returns the bounds for the primary display.\n+\t\t\t\t\t\t// We have to find the correct graphics configuration by using the intersection of the client boundaries.\n \t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);\n \t\t\t\t\t\tif (gc != null)\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\tdouble scale = gc.getDefaultTransform().getScaleX();\n \n+\t\t\t\t\t\t\t// When Windows screen scaling is on, the position/bounds will be wrong when they are set.\n+\t\t\t\t\t\t\t// The bounds saved in shutdown are the full, non-scaled co-ordinates.\n \t\t\t\t\t\t\tif (scale != 1)\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\tclientBounds.setRect(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3MTEyOA==", "url": "https://github.com/runelite/runelite/pull/11776#discussion_r433271128", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);\n          \n          \n            \n            \t\t\t\t\t\t// frame.getGraphicsConfiguration().getBounds() returns the bounds for the main display. So we have to find the correct graphics configuration by using the intersection of the client boundaries.\n          \n          \n            \n            \t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);", "author": "raiyni", "createdAt": "2020-06-01T14:34:36Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java", "diffHunk": "@@ -510,7 +512,28 @@ public void show()\n \t\t\t\t\tif (clientBounds != null)\n \t\t\t\t\t{\n \t\t\t\t\t\tframe.setBounds(clientBounds);\n-\t\t\t\t\t\tframe.revalidateMinimumSize();\n+\n+\t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);", "originalCommit": "b8be0c30339787a545ef3a6a74195ac388b180b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "09b73482a91a7a89ec120f2fd88a384a7b1aee5c", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\nindex 1528462d1..27078c48b 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/ClientUI.java\n\n@@ -513,11 +513,15 @@ public class ClientUI\n \t\t\t\t\t{\n \t\t\t\t\t\tframe.setBounds(clientBounds);\n \n+\t\t\t\t\t\t// frame.getGraphicsConfiguration().getBounds() returns the bounds for the primary display.\n+\t\t\t\t\t\t// We have to find the correct graphics configuration by using the intersection of the client boundaries.\n \t\t\t\t\t\tGraphicsConfiguration gc = getIntersectingDisplay(clientBounds);\n \t\t\t\t\t\tif (gc != null)\n \t\t\t\t\t\t{\n \t\t\t\t\t\t\tdouble scale = gc.getDefaultTransform().getScaleX();\n \n+\t\t\t\t\t\t\t// When Windows screen scaling is on, the position/bounds will be wrong when they are set.\n+\t\t\t\t\t\t\t// The bounds saved in shutdown are the full, non-scaled co-ordinates.\n \t\t\t\t\t\t\tif (scale != 1)\n \t\t\t\t\t\t\t{\n \t\t\t\t\t\t\t\tclientBounds.setRect(\n"}}, {"oid": "09b73482a91a7a89ec120f2fd88a384a7b1aee5c", "url": "https://github.com/runelite/runelite/commit/09b73482a91a7a89ec120f2fd88a384a7b1aee5c", "message": "add comments explaining logic", "committedDate": "2020-06-01T19:06:18Z", "type": "commit"}]}