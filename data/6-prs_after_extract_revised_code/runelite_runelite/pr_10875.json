{"pr_number": 10875, "pr_title": "player-indicators: highlight the 'Walk here' menu entry too", "pr_createdAt": "2020-02-24T23:01:43Z", "pr_url": "https://github.com/runelite/runelite/pull/10875", "timeline": [{"oid": "28f65a6e4e53072987322c65642946beeb390ac1", "url": "https://github.com/runelite/runelite/commit/28f65a6e4e53072987322c65642946beeb390ac1", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-03-01T20:57:36Z", "type": "forcePushed"}, {"oid": "df9bb714654b95343a9e620d8884946762ff9511", "url": "https://github.com/runelite/runelite/commit/df9bb714654b95343a9e620d8884946762ff9511", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-03-18T22:55:36Z", "type": "forcePushed"}, {"oid": "2df2a8f43353378fa32d20963c5de9a544f8a8b3", "url": "https://github.com/runelite/runelite/commit/2df2a8f43353378fa32d20963c5de9a544f8a8b3", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-03-18T23:14:31Z", "type": "forcePushed"}, {"oid": "9fc3247acff524530fe6c90424dd99e960f3a83e", "url": "https://github.com/runelite/runelite/commit/9fc3247acff524530fe6c90424dd99e960f3a83e", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-03-18T23:31:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwMDY4Mg==", "url": "https://github.com/runelite/runelite/pull/10875#discussion_r401200682", "bodyText": "Since this is relatively expensive it would be better to only call setMenuEntries if you know it has changed.", "author": "Adam-", "createdAt": "2020-03-31T20:39:21Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java", "diffHunk": "@@ -94,58 +94,60 @@ protected void shutDown() throws Exception\n \t}\n \n \t@Subscribe\n-\tpublic void onMenuEntryAdded(MenuEntryAdded menuEntryAdded)\n+\tpublic void onClientTick(ClientTick clientTick)\n \t{\n-\t\tint type = menuEntryAdded.getType();\n+\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n \n-\t\tif (type >= 2000)\n+\t\tfor (MenuEntry entry : menuEntries)\n \t\t{\n-\t\t\ttype -= 2000;\n-\t\t}\n-\n-\t\tint identifier = menuEntryAdded.getIdentifier();\n-\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n-\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n-\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n-\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n-\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n-\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n-\t\t\t|| type == RUNELITE.getId())\n-\t\t{\n-\t\t\tPlayer[] players = client.getCachedPlayers();\n-\t\t\tPlayer player = null;\n+\t\t\tint type = entry.getType();\n \n-\t\t\tif (identifier >= 0 && identifier < players.length)\n+\t\t\tif (type >= 2000)\n \t\t\t{\n-\t\t\t\tplayer = players[identifier];\n+\t\t\t\ttype -= 2000;\n \t\t\t}\n \n-\t\t\tif (player == null)\n+\t\t\tint identifier = entry.getIdentifier();\n+\t\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n+\t\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n+\t\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n+\t\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n+\t\t\t\t|| type == RUNELITE.getId())\n \t\t\t{\n-\t\t\t\treturn;\n-\t\t\t}\n+\t\t\t\tPlayer[] players = client.getCachedPlayers();\n+\t\t\t\tPlayer player = null;\n \n-\t\t\tDecorations decorations = getDecorations(player);\n+\t\t\t\tif (identifier >= 0 && identifier < players.length)\n+\t\t\t\t{\n+\t\t\t\t\tplayer = players[identifier];\n+\t\t\t\t}\n \n-\t\t\tif (decorations == null)\n-\t\t\t{\n-\t\t\t\treturn;\n-\t\t\t}\n+\t\t\t\tif (player == null)\n+\t\t\t\t{\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n \n-\t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n-\t\t\tMenuEntry entry = menuEntries[menuEntries.length - 1];\n+\t\t\t\tDecorations decorations = getDecorations(player);\n \n-\t\t\tString oldTarget = entry.getTarget();\n-\t\t\tString newTarget = decorateTarget(oldTarget, decorations);\n+\t\t\t\tif (decorations == null)\n+\t\t\t\t{\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}\n \n-\t\t\tentry.setTarget(newTarget);\n+\t\t\t\tString oldTarget = entry.getTarget();\n+\t\t\t\tString newTarget = decorateTarget(oldTarget, decorations);\n \n-\t\t\tclient.setMenuEntries(menuEntries);\n+\t\t\t\tentry.setTarget(newTarget);\n+\t\t\t}\n \t\t}\n+\n+\t\tclient.setMenuEntries(menuEntries);", "originalCommit": "ea7e205ab9e3e0012be07061842b80747d02e7c6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b85675f6240acee68877a0629fac9329a9937e95", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\nindex 292401fef..973e2dfbf 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\n\n@@ -94,127 +93,93 @@ public class PlayerIndicatorsPlugin extends Plugin\n \t}\n \n \t@Subscribe\n-\tpublic void onClientTick(ClientTick clientTick)\n+\tpublic void onMenuEntryAdded(MenuEntryAdded menuEntryAdded)\n \t{\n-\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n+\t\tint type = menuEntryAdded.getType();\n \n-\t\tfor (MenuEntry entry : menuEntries)\n+\t\tif (type >= 2000)\n \t\t{\n-\t\t\tint type = entry.getType();\n+\t\t\ttype -= 2000;\n+\t\t}\n+\n+\t\tint identifier = menuEntryAdded.getIdentifier();\n+\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n+\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n+\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n+\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n+\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n+\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n+\t\t\t|| type == RUNELITE.getId())\n+\t\t{\n+\t\t\tfinal Player localPlayer = client.getLocalPlayer();\n+\t\t\tPlayer[] players = client.getCachedPlayers();\n+\t\t\tPlayer player = null;\n \n-\t\t\tif (type >= 2000)\n+\t\t\tif (identifier >= 0 && identifier < players.length)\n \t\t\t{\n-\t\t\t\ttype -= 2000;\n+\t\t\t\tplayer = players[identifier];\n \t\t\t}\n \n-\t\t\tint identifier = entry.getIdentifier();\n-\t\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n-\t\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n-\t\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n-\t\t\t\t|| type == RUNELITE.getId())\n+\t\t\tif (player == null)\n \t\t\t{\n-\t\t\t\tPlayer[] players = client.getCachedPlayers();\n-\t\t\t\tPlayer player = null;\n+\t\t\t\treturn;\n+\t\t\t}\n \n-\t\t\t\tif (identifier >= 0 && identifier < players.length)\n-\t\t\t\t{\n-\t\t\t\t\tplayer = players[identifier];\n-\t\t\t\t}\n+\t\t\tint image = -1;\n+\t\t\tColor color = null;\n \n-\t\t\t\tif (player == null)\n-\t\t\t\t{\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\n-\t\t\t\tDecorations decorations = getDecorations(player);\n+\t\t\tif (config.highlightFriends() && player.isFriend())\n+\t\t\t{\n+\t\t\t\tcolor = config.getFriendColor();\n+\t\t\t}\n+\t\t\telse if (config.drawClanMemberNames() && player.isClanMember())\n+\t\t\t{\n+\t\t\t\tcolor = config.getClanMemberColor();\n \n-\t\t\t\tif (decorations == null)\n+\t\t\t\tClanMemberRank rank = clanManager.getRank(player.getName());\n+\t\t\t\tif (rank != UNRANKED)\n \t\t\t\t{\n-\t\t\t\t\tcontinue;\n+\t\t\t\t\timage = clanManager.getIconNumber(rank);\n \t\t\t\t}\n-\n-\t\t\t\tString oldTarget = entry.getTarget();\n-\t\t\t\tString newTarget = decorateTarget(oldTarget, decorations);\n-\n-\t\t\t\tentry.setTarget(newTarget);\n \t\t\t}\n-\t\t}\n-\n-\t\tclient.setMenuEntries(menuEntries);\n-\t}\n-\n-\tprivate Decorations getDecorations(Player player)\n-\t{\n-\t\tint image = -1;\n-\t\tColor color = null;\n-\n-\t\tif (config.highlightFriends() && player.isFriend())\n-\t\t{\n-\t\t\tcolor = config.getFriendColor();\n-\t\t}\n-\t\telse if (config.drawClanMemberNames() && player.isClanMember())\n-\t\t{\n-\t\t\tcolor = config.getClanMemberColor();\n-\n-\t\t\tClanMemberRank rank = clanManager.getRank(player.getName());\n-\t\t\tif (rank != UNRANKED)\n+\t\t\telse if (config.highlightTeamMembers() && player.getTeam() > 0 && localPlayer.getTeam() == player.getTeam())\n \t\t\t{\n-\t\t\t\timage = clanManager.getIconNumber(rank);\n+\t\t\t\tcolor = config.getTeamMemberColor();\n \t\t\t}\n-\t\t}\n-\t\telse if (config.highlightTeamMembers()\n-\t\t\t&& player.getTeam() > 0 && client.getLocalPlayer().getTeam() == player.getTeam())\n-\t\t{\n-\t\t\tcolor = config.getTeamMemberColor();\n-\t\t}\n-\t\telse if (config.highlightNonClanMembers() && !player.isClanMember())\n-\t\t{\n-\t\t\tcolor = config.getNonClanMemberColor();\n-\t\t}\n-\n-\t\tif (image == -1 && color == null)\n-\t\t{\n-\t\t\treturn null;\n-\t\t}\n-\n-\t\treturn new Decorations(image, color);\n-\t}\n-\n-\tprivate String decorateTarget(String oldTarget, Decorations decorations)\n-\t{\n-\t\tString newTarget = oldTarget;\n-\n-\t\tif (decorations.getColor() != null && config.colorPlayerMenu())\n-\t\t{\n-\t\t\t// strip out existing <col...\n-\t\t\tint idx = oldTarget.indexOf('>');\n-\t\t\tif (idx != -1)\n+\t\t\telse if (config.highlightNonClanMembers() && !player.isClanMember())\n \t\t\t{\n-\t\t\t\tnewTarget = oldTarget.substring(idx + 1);\n+\t\t\t\tcolor = config.getNonClanMemberColor();\n \t\t\t}\n \n-\t\t\tnewTarget = ColorUtil.prependColorTag(newTarget, decorations.getColor());\n-\t\t}\n+\t\t\tif (image != -1 || color != null)\n+\t\t\t{\n+\t\t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n+\t\t\t\tMenuEntry lastEntry = menuEntries[menuEntries.length - 1];\n \n-\t\tif (decorations.getImage() != -1 && config.showClanRanks())\n-\t\t{\n-\t\t\tnewTarget = \"<img=\" + decorations.getImage() + \">\" + newTarget;\n-\t\t}\n+\t\t\t\tif (color != null && config.colorPlayerMenu())\n+\t\t\t\t{\n+\t\t\t\t\t// strip out existing <col...\n+\t\t\t\t\tString target = lastEntry.getTarget();\n+\t\t\t\t\tint idx = target.indexOf('>');\n+\t\t\t\t\tif (idx != -1)\n+\t\t\t\t\t{\n+\t\t\t\t\t\ttarget = target.substring(idx + 1);\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tlastEntry.setTarget(ColorUtil.prependColorTag(target, color));\n+\t\t\t\t}\n \n-\t\treturn newTarget;\n-\t}\n+\t\t\t\tif (image != -1 && config.showClanRanks())\n+\t\t\t\t{\n+\t\t\t\t\tlastEntry.setTarget(\"<img=\" + image + \">\" + lastEntry.getTarget());\n+\t\t\t\t}\n \n-\t@Value\n-\tprivate static class Decorations\n-\t{\n-\t\tprivate final int image;\n-\t\tprivate final Color color;\n+\t\t\t\tclient.setMenuEntries(menuEntries);\n+\t\t\t}\n+\t\t}\n \t}\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwMDg2Ng==", "url": "https://github.com/runelite/runelite/pull/10875#discussion_r401200866", "bodyText": "this is the constant MENU_ACTION_DEPRIORITIZE_OFFSET", "author": "Adam-", "createdAt": "2020-03-31T20:39:42Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java", "diffHunk": "@@ -94,58 +94,60 @@ protected void shutDown() throws Exception\n \t}\n \n \t@Subscribe\n-\tpublic void onMenuEntryAdded(MenuEntryAdded menuEntryAdded)\n+\tpublic void onClientTick(ClientTick clientTick)\n \t{\n-\t\tint type = menuEntryAdded.getType();\n+\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n \n-\t\tif (type >= 2000)\n+\t\tfor (MenuEntry entry : menuEntries)\n \t\t{\n-\t\t\ttype -= 2000;\n-\t\t}\n-\n-\t\tint identifier = menuEntryAdded.getIdentifier();\n-\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n-\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n-\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n-\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n-\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n-\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n-\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n-\t\t\t|| type == RUNELITE.getId())\n-\t\t{\n-\t\t\tPlayer[] players = client.getCachedPlayers();\n-\t\t\tPlayer player = null;\n+\t\t\tint type = entry.getType();\n \n-\t\t\tif (identifier >= 0 && identifier < players.length)\n+\t\t\tif (type >= 2000)", "originalCommit": "ea7e205ab9e3e0012be07061842b80747d02e7c6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b85675f6240acee68877a0629fac9329a9937e95", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\nindex 292401fef..973e2dfbf 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/playerindicators/PlayerIndicatorsPlugin.java\n\n@@ -94,127 +93,93 @@ public class PlayerIndicatorsPlugin extends Plugin\n \t}\n \n \t@Subscribe\n-\tpublic void onClientTick(ClientTick clientTick)\n+\tpublic void onMenuEntryAdded(MenuEntryAdded menuEntryAdded)\n \t{\n-\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n+\t\tint type = menuEntryAdded.getType();\n \n-\t\tfor (MenuEntry entry : menuEntries)\n+\t\tif (type >= 2000)\n \t\t{\n-\t\t\tint type = entry.getType();\n+\t\t\ttype -= 2000;\n+\t\t}\n+\n+\t\tint identifier = menuEntryAdded.getIdentifier();\n+\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n+\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n+\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n+\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n+\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n+\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n+\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n+\t\t\t|| type == RUNELITE.getId())\n+\t\t{\n+\t\t\tfinal Player localPlayer = client.getLocalPlayer();\n+\t\t\tPlayer[] players = client.getCachedPlayers();\n+\t\t\tPlayer player = null;\n \n-\t\t\tif (type >= 2000)\n+\t\t\tif (identifier >= 0 && identifier < players.length)\n \t\t\t{\n-\t\t\t\ttype -= 2000;\n+\t\t\t\tplayer = players[identifier];\n \t\t\t}\n \n-\t\t\tint identifier = entry.getIdentifier();\n-\t\t\tif (type == SPELL_CAST_ON_PLAYER.getId()\n-\t\t\t\t|| type == ITEM_USE_ON_PLAYER.getId()\n-\t\t\t\t|| type == PLAYER_FIRST_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SECOND_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_THIRD_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_FOURTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_FIFTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SIXTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_SEVENTH_OPTION.getId()\n-\t\t\t\t|| type == PLAYER_EIGTH_OPTION.getId()\n-\t\t\t\t|| type == RUNELITE.getId())\n+\t\t\tif (player == null)\n \t\t\t{\n-\t\t\t\tPlayer[] players = client.getCachedPlayers();\n-\t\t\t\tPlayer player = null;\n+\t\t\t\treturn;\n+\t\t\t}\n \n-\t\t\t\tif (identifier >= 0 && identifier < players.length)\n-\t\t\t\t{\n-\t\t\t\t\tplayer = players[identifier];\n-\t\t\t\t}\n+\t\t\tint image = -1;\n+\t\t\tColor color = null;\n \n-\t\t\t\tif (player == null)\n-\t\t\t\t{\n-\t\t\t\t\tcontinue;\n-\t\t\t\t}\n-\n-\t\t\t\tDecorations decorations = getDecorations(player);\n+\t\t\tif (config.highlightFriends() && player.isFriend())\n+\t\t\t{\n+\t\t\t\tcolor = config.getFriendColor();\n+\t\t\t}\n+\t\t\telse if (config.drawClanMemberNames() && player.isClanMember())\n+\t\t\t{\n+\t\t\t\tcolor = config.getClanMemberColor();\n \n-\t\t\t\tif (decorations == null)\n+\t\t\t\tClanMemberRank rank = clanManager.getRank(player.getName());\n+\t\t\t\tif (rank != UNRANKED)\n \t\t\t\t{\n-\t\t\t\t\tcontinue;\n+\t\t\t\t\timage = clanManager.getIconNumber(rank);\n \t\t\t\t}\n-\n-\t\t\t\tString oldTarget = entry.getTarget();\n-\t\t\t\tString newTarget = decorateTarget(oldTarget, decorations);\n-\n-\t\t\t\tentry.setTarget(newTarget);\n \t\t\t}\n-\t\t}\n-\n-\t\tclient.setMenuEntries(menuEntries);\n-\t}\n-\n-\tprivate Decorations getDecorations(Player player)\n-\t{\n-\t\tint image = -1;\n-\t\tColor color = null;\n-\n-\t\tif (config.highlightFriends() && player.isFriend())\n-\t\t{\n-\t\t\tcolor = config.getFriendColor();\n-\t\t}\n-\t\telse if (config.drawClanMemberNames() && player.isClanMember())\n-\t\t{\n-\t\t\tcolor = config.getClanMemberColor();\n-\n-\t\t\tClanMemberRank rank = clanManager.getRank(player.getName());\n-\t\t\tif (rank != UNRANKED)\n+\t\t\telse if (config.highlightTeamMembers() && player.getTeam() > 0 && localPlayer.getTeam() == player.getTeam())\n \t\t\t{\n-\t\t\t\timage = clanManager.getIconNumber(rank);\n+\t\t\t\tcolor = config.getTeamMemberColor();\n \t\t\t}\n-\t\t}\n-\t\telse if (config.highlightTeamMembers()\n-\t\t\t&& player.getTeam() > 0 && client.getLocalPlayer().getTeam() == player.getTeam())\n-\t\t{\n-\t\t\tcolor = config.getTeamMemberColor();\n-\t\t}\n-\t\telse if (config.highlightNonClanMembers() && !player.isClanMember())\n-\t\t{\n-\t\t\tcolor = config.getNonClanMemberColor();\n-\t\t}\n-\n-\t\tif (image == -1 && color == null)\n-\t\t{\n-\t\t\treturn null;\n-\t\t}\n-\n-\t\treturn new Decorations(image, color);\n-\t}\n-\n-\tprivate String decorateTarget(String oldTarget, Decorations decorations)\n-\t{\n-\t\tString newTarget = oldTarget;\n-\n-\t\tif (decorations.getColor() != null && config.colorPlayerMenu())\n-\t\t{\n-\t\t\t// strip out existing <col...\n-\t\t\tint idx = oldTarget.indexOf('>');\n-\t\t\tif (idx != -1)\n+\t\t\telse if (config.highlightNonClanMembers() && !player.isClanMember())\n \t\t\t{\n-\t\t\t\tnewTarget = oldTarget.substring(idx + 1);\n+\t\t\t\tcolor = config.getNonClanMemberColor();\n \t\t\t}\n \n-\t\t\tnewTarget = ColorUtil.prependColorTag(newTarget, decorations.getColor());\n-\t\t}\n+\t\t\tif (image != -1 || color != null)\n+\t\t\t{\n+\t\t\t\tMenuEntry[] menuEntries = client.getMenuEntries();\n+\t\t\t\tMenuEntry lastEntry = menuEntries[menuEntries.length - 1];\n \n-\t\tif (decorations.getImage() != -1 && config.showClanRanks())\n-\t\t{\n-\t\t\tnewTarget = \"<img=\" + decorations.getImage() + \">\" + newTarget;\n-\t\t}\n+\t\t\t\tif (color != null && config.colorPlayerMenu())\n+\t\t\t\t{\n+\t\t\t\t\t// strip out existing <col...\n+\t\t\t\t\tString target = lastEntry.getTarget();\n+\t\t\t\t\tint idx = target.indexOf('>');\n+\t\t\t\t\tif (idx != -1)\n+\t\t\t\t\t{\n+\t\t\t\t\t\ttarget = target.substring(idx + 1);\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tlastEntry.setTarget(ColorUtil.prependColorTag(target, color));\n+\t\t\t\t}\n \n-\t\treturn newTarget;\n-\t}\n+\t\t\t\tif (image != -1 && config.showClanRanks())\n+\t\t\t\t{\n+\t\t\t\t\tlastEntry.setTarget(\"<img=\" + image + \">\" + lastEntry.getTarget());\n+\t\t\t\t}\n \n-\t@Value\n-\tprivate static class Decorations\n-\t{\n-\t\tprivate final int image;\n-\t\tprivate final Color color;\n+\t\t\t\tclient.setMenuEntries(menuEntries);\n+\t\t\t}\n+\t\t}\n \t}\n }\n"}}, {"oid": "b85675f6240acee68877a0629fac9329a9937e95", "url": "https://github.com/runelite/runelite/commit/b85675f6240acee68877a0629fac9329a9937e95", "message": "api: remove Follow and Trade menu actions\n\nThey are just the third and fourth player options but deprioritized by having 2000 added to them.", "committedDate": "2020-04-02T17:34:01Z", "type": "commit"}, {"oid": "e7171ee3867c25478b50ce3cda5bcf9d4f090ce9", "url": "https://github.com/runelite/runelite/commit/e7171ee3867c25478b50ce3cda5bcf9d4f090ce9", "message": "player-indicators: break out decorating code into own methods", "committedDate": "2020-04-02T17:34:01Z", "type": "commit"}, {"oid": "d4f2753e0577142400abbfae6265970dd6ed39de", "url": "https://github.com/runelite/runelite/commit/d4f2753e0577142400abbfae6265970dd6ed39de", "message": "player-indicators: move menu logic to ClientTick", "committedDate": "2020-04-02T17:34:36Z", "type": "commit"}, {"oid": "bdb554e9a1bf42cdb18fc1fdb3edb13f7cb2b678", "url": "https://github.com/runelite/runelite/commit/bdb554e9a1bf42cdb18fc1fdb3edb13f7cb2b678", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-04-02T17:34:37Z", "type": "commit"}, {"oid": "bdb554e9a1bf42cdb18fc1fdb3edb13f7cb2b678", "url": "https://github.com/runelite/runelite/commit/bdb554e9a1bf42cdb18fc1fdb3edb13f7cb2b678", "message": "player-indicators: highlight the 'Walk here' menu entry too", "committedDate": "2020-04-02T17:34:37Z", "type": "forcePushed"}]}