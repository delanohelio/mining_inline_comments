{"pr_number": 10955, "pr_title": "scripts: use ScriptPostFired event for scripts that callback at the end of the script", "pr_createdAt": "2020-03-05T16:42:46Z", "pr_url": "https://github.com/runelite/runelite/pull/10955", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQyNTA4Nw==", "url": "https://github.com/runelite/runelite/pull/10955#discussion_r388425087", "bodyText": "Not sure why this was on the clientthread before, both these events are always on the client thread", "author": "Adam-", "createdAt": "2020-03-05T16:52:15Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java", "diffHunk": "@@ -554,12 +556,15 @@ public void onScriptCallbackEvent(ScriptCallbackEvent scriptCallbackEvent)\n \t\t\t\tclientThread.invokeLater(() -> confirmKickPlayer(kickPlayerName));\n \t\t\t\tbreak;\n \t\t\t}\n-\t\t\tcase \"clanChatChannelRebuild\":\n-\t\t\t\tif (config.showIgnores())\n-\t\t\t\t{\n-\t\t\t\t\tclientThread.invoke(() -> colorIgnoredPlayers(config.showIgnoresColor()));\n-\t\t\t\t}\n-\t\t\t\tbreak;\n+\t\t}\n+\t}\n+\n+\t@Subscribe\n+\tpublic void onScriptPostFired(ScriptPostFired event)\n+\t{\n+\t\tif (event.getScriptId() == CLAN_CHAT_CHANNEL_REBUILD && config.showIgnores())\n+\t\t{\n+\t\t\tclientThread.invoke(() -> colorIgnoredPlayers(config.showIgnoresColor()));", "originalCommit": "d005e891f1575ab245b59a05129dc38549227844", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "95e6984456b65e826b02e7cf85b59b2cc05d7b58", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\nindex 93a764dbc..1e51d1b4d 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\n\n@@ -562,9 +561,9 @@ public class ClanChatPlugin extends Plugin\n \t@Subscribe\n \tpublic void onScriptPostFired(ScriptPostFired event)\n \t{\n-\t\tif (event.getScriptId() == CLAN_CHAT_CHANNEL_REBUILD && config.showIgnores())\n+\t\tif (event.getScriptId() == ScriptID.CLAN_CHAT_CHANNEL_BUILD && config.showIgnores())\n \t\t{\n-\t\t\tclientThread.invoke(() -> colorIgnoredPlayers(config.showIgnoresColor()));\n+\t\t\tcolorIgnoredPlayers(config.showIgnoresColor());\n \t\t}\n \t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQyOTY1Mw==", "url": "https://github.com/runelite/runelite/pull/10955#discussion_r388429653", "bodyText": "All of the script ids should just be added to ScriptID", "author": "Adam-", "createdAt": "2020-03-05T16:59:12Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java", "diffHunk": "@@ -97,6 +98,7 @@\n \tprivate static final String RECENT_TITLE = \"Recent CCs\";\n \tprivate static final int JOIN_LEAVE_DURATION = 20;\n \tprivate static final int MESSAGE_DELAY = 10;\n+\tprivate static final int CLAN_CHAT_CHANNEL_REBUILD = 1658;", "originalCommit": "d005e891f1575ab245b59a05129dc38549227844", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "95e6984456b65e826b02e7cf85b59b2cc05d7b58", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\nindex 93a764dbc..1e51d1b4d 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/clanchat/ClanChatPlugin.java\n\n@@ -98,7 +98,6 @@ public class ClanChatPlugin extends Plugin\n \tprivate static final String RECENT_TITLE = \"Recent CCs\";\n \tprivate static final int JOIN_LEAVE_DURATION = 20;\n \tprivate static final int MESSAGE_DELAY = 10;\n-\tprivate static final int CLAN_CHAT_CHANNEL_REBUILD = 1658;\n \n \t@Inject\n \tprivate Client client;\n"}}, {"oid": "95e6984456b65e826b02e7cf85b59b2cc05d7b58", "url": "https://github.com/runelite/runelite/commit/95e6984456b65e826b02e7cf85b59b2cc05d7b58", "message": "scripts: use ScriptPostFired event for scripts that callback at the end of the script\n\nUses the ScriptPostFired event that was added with the script inspector dev tool, removing the scripts that can be done with it.", "committedDate": "2020-03-05T18:13:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxNjg1Mw==", "url": "https://github.com/runelite/runelite/pull/10955#discussion_r388616853", "bodyText": "All of your @ScriptArguments are wrong", "author": "abextm", "createdAt": "2020-03-05T23:01:21Z", "path": "runelite-api/src/main/java/net/runelite/api/ScriptID.java", "diffHunk": "@@ -203,4 +203,28 @@\n \t */\n \t@ScriptArguments(string = 1)\n \tpublic static final int CLAN_SEND_KICK = 215;\n+\n+\t/**\n+\t * Builds the items kept on death widget\n+\t */\n+\t@ScriptArguments()", "originalCommit": "95e6984456b65e826b02e7cf85b59b2cc05d7b58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYyMzkxNw==", "url": "https://github.com/runelite/runelite/pull/10955#discussion_r388623917", "bodyText": "I had thought that Adam meant to leave these empty but he meant to leave them undocumented. I have since updated them and made the script names to be more consistent with other script names used in the class.", "author": "melkypie", "createdAt": "2020-03-05T23:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYxNjg1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "5a8021453964af4997dcdee4b20fd86a1127588d", "chunk": "diff --git a/runelite-api/src/main/java/net/runelite/api/ScriptID.java b/runelite-api/src/main/java/net/runelite/api/ScriptID.java\nindex e577d359f..f65e24012 100644\n--- a/runelite-api/src/main/java/net/runelite/api/ScriptID.java\n+++ b/runelite-api/src/main/java/net/runelite/api/ScriptID.java\n\n@@ -207,24 +207,24 @@ public final class ScriptID\n \t/**\n \t * Builds the items kept on death widget\n \t */\n-\t@ScriptArguments()\n-\tpublic static final int DEATHKEEP_BUILD = 1601;\n+\t@ScriptArguments(integer = 4, string = 2)\n+\tpublic static final int DEATH_KEEP_BUILD = 1601;\n \n \t/**\n \t * Builds the widget that holds all of the players inside a clan chat\n \t */\n-\t@ScriptArguments()\n+\t@ScriptArguments(integer = 15)\n \tpublic static final int CLAN_CHAT_CHANNEL_BUILD = 1658;\n \n \t/**\n \t * Builds the widget for making an offer in Grand Exchange\n \t */\n-\t@ScriptArguments()\n+\t@ScriptArguments(integer = 15)\n \tpublic static final int GE_OFFERS_SETUP_BUILD = 779;\n \n \t/**\n \t * Builds the quest list inside the quest tab that shows each quest's progress\n \t */\n-\t@ScriptArguments()\n-\tpublic static final int QUEST_LIST_PROGRESS_SHOW = 1354;\n+\t@ScriptArguments(integer = 3)\n+\tpublic static final int QUESTLIST_PROGRESS_LIST_SHOW = 1354;\n }\n"}}, {"oid": "5a8021453964af4997dcdee4b20fd86a1127588d", "url": "https://github.com/runelite/runelite/commit/5a8021453964af4997dcdee4b20fd86a1127588d", "message": "scripts: use ScriptPostFired event for scripts that callback at the end of the script\n\nUses the ScriptPostFired event that was added with the script inspector dev tool, removing the scripts that can be done with it.", "committedDate": "2020-03-05T23:17:09Z", "type": "commit"}, {"oid": "5a8021453964af4997dcdee4b20fd86a1127588d", "url": "https://github.com/runelite/runelite/commit/5a8021453964af4997dcdee4b20fd86a1127588d", "message": "scripts: use ScriptPostFired event for scripts that callback at the end of the script\n\nUses the ScriptPostFired event that was added with the script inspector dev tool, removing the scripts that can be done with it.", "committedDate": "2020-03-05T23:17:09Z", "type": "forcePushed"}]}