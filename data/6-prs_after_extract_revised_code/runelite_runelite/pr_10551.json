{"pr_number": 10551, "pr_title": "Show raids loot value at the end of the raid", "pr_createdAt": "2020-01-05T02:56:52Z", "pr_url": "https://github.com/runelite/runelite/pull/10551", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjYyMw==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106623", "bodyText": "Check widget id first, it is cheaper.", "author": "Adam-", "createdAt": "2020-01-05T17:32:23Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java", "diffHunk": "@@ -215,6 +232,53 @@ public void onConfigChanged(ConfigChanged event)\n \t\tclientThread.invokeLater(() -> checkRaidPresence(true));\n \t}\n \n+\t@Subscribe\n+\tpublic void onWidgetLoaded(WidgetLoaded event)\n+\t{\n+\t\tif (!config.showLootValue() ||\n+\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||", "originalCommit": "73fa75f9e94c0c28630016b48bc0eae2cca5b50a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\nindex da7cc9e18..19058febc 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n\n@@ -235,46 +230,37 @@ public class RaidsPlugin extends Plugin\n \t@Subscribe\n \tpublic void onWidgetLoaded(WidgetLoaded event)\n \t{\n-\t\tif (!config.showLootValue() ||\n-\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\tif (event.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\t\t!config.showLootValue() ||\n \t\t\tchestOpened)\n \t\t{\n \t\t\treturn;\n \t\t}\n+\n \t\tchestOpened = true;\n+\n \t\tItemContainer rewardItemContainer = client.getItemContainer(InventoryID.CHAMBERS_OF_XERIC_CHEST);\n \t\tif (rewardItemContainer == null)\n \t\t{\n \t\t\treturn;\n \t\t}\n \n-\t\tfinal Collection<Item> rewardItems = Arrays.stream(rewardItemContainer.getItems())\n-\t\t\t.filter(item -> item.getId() > 0)\n-\t\t\t.map(item -> new Item(item.getId(), item.getQuantity()))\n-\t\t\t.collect(Collectors.toList());\n-\n-\t\tint rewardValue = 0;\n-\n-\t\tfor (Item reweardItem : rewardItems)\n-\t\t{\n-\t\t\tif (UNTRADABLE_ITEMS.contains(reweardItem.getId()))\n-\t\t\t{\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\trewardValue += itemManager.getItemPrice(reweardItem.getId()) * reweardItem.getQuantity();\n-\t\t}\n+\t\tlong totalValue = Arrays.stream(rewardItemContainer.getItems())\n+\t\t\t.filter(item -> item.getId() > -1)\n+\t\t\t.mapToLong(item -> (long) itemManager.getItemPrice(item.getId()) * item.getQuantity())\n+\t\t\t.sum();\n \n \t\tString chatMessage = new ChatMessageBuilder()\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\"You have received \")\n+\t\t\t.append(\"Your loot is worth around \")\n \t\t\t.append(ChatColorType.HIGHLIGHT)\n-\t\t\t.append(QuantityFormatter.quantityToRSDecimalStack(rewardValue, true))\n+\t\t\t.append(QuantityFormatter.formatNumber(totalValue))\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\" worth of rewards\")\n+\t\t\t.append(\" coins.\")\n \t\t\t.build();\n \n \t\tchatMessageManager.queue(QueuedMessage.builder()\n-\t\t\t.type(ChatMessageType.FRIENDSCHATNOTIFICATION)\n+\t\t\t.type(ChatMessageType.ITEM_EXAMINE)\n \t\t\t.runeLiteFormattedMessage(chatMessage)\n \t\t\t.build());\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjY2Nw==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106667", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate boolean chestOpened = false;\n          \n          \n            \n            \tprivate boolean chestOpened;", "author": "Adam-", "createdAt": "2020-01-05T17:33:03Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java", "diffHunk": "@@ -163,6 +177,8 @@\n \t@Getter\n \tprivate boolean inRaidChambers;\n \n+\tprivate boolean chestOpened = false;", "originalCommit": "73fa75f9e94c0c28630016b48bc0eae2cca5b50a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\nindex da7cc9e18..19058febc 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n\n@@ -177,7 +172,7 @@ public class RaidsPlugin extends Plugin\n \t@Getter\n \tprivate boolean inRaidChambers;\n \n-\tprivate boolean chestOpened = false;\n+\tprivate boolean chestOpened;\n \n \tprivate RaidsTimer timer;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0MQ==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106741", "bodyText": "Why is this here?", "author": "Adam-", "createdAt": "2020-01-05T17:34:19Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java", "diffHunk": "@@ -215,6 +232,53 @@ public void onConfigChanged(ConfigChanged event)\n \t\tclientThread.invokeLater(() -> checkRaidPresence(true));\n \t}\n \n+\t@Subscribe\n+\tpublic void onWidgetLoaded(WidgetLoaded event)\n+\t{\n+\t\tif (!config.showLootValue() ||\n+\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\t\tchestOpened)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\t\tchestOpened = true;\n+\t\tItemContainer rewardItemContainer = client.getItemContainer(InventoryID.CHAMBERS_OF_XERIC_CHEST);\n+\t\tif (rewardItemContainer == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Collection<Item> rewardItems = Arrays.stream(rewardItemContainer.getItems())\n+\t\t\t.filter(item -> item.getId() > 0)\n+\t\t\t.map(item -> new Item(item.getId(), item.getQuantity()))\n+\t\t\t.collect(Collectors.toList());\n+\n+\t\tint rewardValue = 0;\n+\n+\t\tfor (Item reweardItem : rewardItems)\n+\t\t{\n+\t\t\tif (UNTRADABLE_ITEMS.contains(reweardItem.getId()))", "originalCommit": "73fa75f9e94c0c28630016b48bc0eae2cca5b50a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjgzMA==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106830", "bodyText": "Guess it is not needed, was thinking about it not checking item price if it is an untradable item but the item prive would be 0 anyways so it is useless, will take it out", "author": "melkypie", "createdAt": "2020-01-05T17:36:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjg2MA==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106860", "bodyText": "The item manager has some logic to apply prices to untradeables, but if you don't want it to there is a ignoreUntradeableMap flag.", "author": "Adam-", "createdAt": "2020-01-05T17:37:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwOTgzOA==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363109838", "bodyText": "Removed the check", "author": "melkypie", "createdAt": "2020-01-05T18:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\nindex da7cc9e18..19058febc 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n\n@@ -235,46 +230,37 @@ public class RaidsPlugin extends Plugin\n \t@Subscribe\n \tpublic void onWidgetLoaded(WidgetLoaded event)\n \t{\n-\t\tif (!config.showLootValue() ||\n-\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\tif (event.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\t\t!config.showLootValue() ||\n \t\t\tchestOpened)\n \t\t{\n \t\t\treturn;\n \t\t}\n+\n \t\tchestOpened = true;\n+\n \t\tItemContainer rewardItemContainer = client.getItemContainer(InventoryID.CHAMBERS_OF_XERIC_CHEST);\n \t\tif (rewardItemContainer == null)\n \t\t{\n \t\t\treturn;\n \t\t}\n \n-\t\tfinal Collection<Item> rewardItems = Arrays.stream(rewardItemContainer.getItems())\n-\t\t\t.filter(item -> item.getId() > 0)\n-\t\t\t.map(item -> new Item(item.getId(), item.getQuantity()))\n-\t\t\t.collect(Collectors.toList());\n-\n-\t\tint rewardValue = 0;\n-\n-\t\tfor (Item reweardItem : rewardItems)\n-\t\t{\n-\t\t\tif (UNTRADABLE_ITEMS.contains(reweardItem.getId()))\n-\t\t\t{\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\trewardValue += itemManager.getItemPrice(reweardItem.getId()) * reweardItem.getQuantity();\n-\t\t}\n+\t\tlong totalValue = Arrays.stream(rewardItemContainer.getItems())\n+\t\t\t.filter(item -> item.getId() > -1)\n+\t\t\t.mapToLong(item -> (long) itemManager.getItemPrice(item.getId()) * item.getQuantity())\n+\t\t\t.sum();\n \n \t\tString chatMessage = new ChatMessageBuilder()\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\"You have received \")\n+\t\t\t.append(\"Your loot is worth around \")\n \t\t\t.append(ChatColorType.HIGHLIGHT)\n-\t\t\t.append(QuantityFormatter.quantityToRSDecimalStack(rewardValue, true))\n+\t\t\t.append(QuantityFormatter.formatNumber(totalValue))\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\" worth of rewards\")\n+\t\t\t.append(\" coins.\")\n \t\t\t.build();\n \n \t\tchatMessageManager.queue(QueuedMessage.builder()\n-\t\t\t.type(ChatMessageType.FRIENDSCHATNOTIFICATION)\n+\t\t\t.type(ChatMessageType.ITEM_EXAMINE)\n \t\t\t.runeLiteFormattedMessage(chatMessage)\n \t\t\t.build());\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0NQ==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363106745", "bodyText": "This should maybe be a long.", "author": "Adam-", "createdAt": "2020-01-05T17:34:36Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java", "diffHunk": "@@ -215,6 +232,53 @@ public void onConfigChanged(ConfigChanged event)\n \t\tclientThread.invokeLater(() -> checkRaidPresence(true));\n \t}\n \n+\t@Subscribe\n+\tpublic void onWidgetLoaded(WidgetLoaded event)\n+\t{\n+\t\tif (!config.showLootValue() ||\n+\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\t\tchestOpened)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\t\tchestOpened = true;\n+\t\tItemContainer rewardItemContainer = client.getItemContainer(InventoryID.CHAMBERS_OF_XERIC_CHEST);\n+\t\tif (rewardItemContainer == null)\n+\t\t{\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tfinal Collection<Item> rewardItems = Arrays.stream(rewardItemContainer.getItems())\n+\t\t\t.filter(item -> item.getId() > 0)\n+\t\t\t.map(item -> new Item(item.getId(), item.getQuantity()))\n+\t\t\t.collect(Collectors.toList());\n+\n+\t\tint rewardValue = 0;", "originalCommit": "73fa75f9e94c0c28630016b48bc0eae2cca5b50a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwOTI4Mw==", "url": "https://github.com/runelite/runelite/pull/10551#discussion_r363109283", "bodyText": "QuantityFormatter.quantitotyToRsDecimalStack requires an int, that is why I left it as int", "author": "melkypie", "createdAt": "2020-01-05T18:28:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzEwNjc0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\nindex da7cc9e18..19058febc 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/raids/RaidsPlugin.java\n\n@@ -235,46 +230,37 @@ public class RaidsPlugin extends Plugin\n \t@Subscribe\n \tpublic void onWidgetLoaded(WidgetLoaded event)\n \t{\n-\t\tif (!config.showLootValue() ||\n-\t\t\tevent.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\tif (event.getGroupId() != WidgetID.CHAMBERS_OF_XERIC_REWARD_GROUP_ID ||\n+\t\t\t!config.showLootValue() ||\n \t\t\tchestOpened)\n \t\t{\n \t\t\treturn;\n \t\t}\n+\n \t\tchestOpened = true;\n+\n \t\tItemContainer rewardItemContainer = client.getItemContainer(InventoryID.CHAMBERS_OF_XERIC_CHEST);\n \t\tif (rewardItemContainer == null)\n \t\t{\n \t\t\treturn;\n \t\t}\n \n-\t\tfinal Collection<Item> rewardItems = Arrays.stream(rewardItemContainer.getItems())\n-\t\t\t.filter(item -> item.getId() > 0)\n-\t\t\t.map(item -> new Item(item.getId(), item.getQuantity()))\n-\t\t\t.collect(Collectors.toList());\n-\n-\t\tint rewardValue = 0;\n-\n-\t\tfor (Item reweardItem : rewardItems)\n-\t\t{\n-\t\t\tif (UNTRADABLE_ITEMS.contains(reweardItem.getId()))\n-\t\t\t{\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\t\t\trewardValue += itemManager.getItemPrice(reweardItem.getId()) * reweardItem.getQuantity();\n-\t\t}\n+\t\tlong totalValue = Arrays.stream(rewardItemContainer.getItems())\n+\t\t\t.filter(item -> item.getId() > -1)\n+\t\t\t.mapToLong(item -> (long) itemManager.getItemPrice(item.getId()) * item.getQuantity())\n+\t\t\t.sum();\n \n \t\tString chatMessage = new ChatMessageBuilder()\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\"You have received \")\n+\t\t\t.append(\"Your loot is worth around \")\n \t\t\t.append(ChatColorType.HIGHLIGHT)\n-\t\t\t.append(QuantityFormatter.quantityToRSDecimalStack(rewardValue, true))\n+\t\t\t.append(QuantityFormatter.formatNumber(totalValue))\n \t\t\t.append(ChatColorType.NORMAL)\n-\t\t\t.append(\" worth of rewards\")\n+\t\t\t.append(\" coins.\")\n \t\t\t.build();\n \n \t\tchatMessageManager.queue(QueuedMessage.builder()\n-\t\t\t.type(ChatMessageType.FRIENDSCHATNOTIFICATION)\n+\t\t\t.type(ChatMessageType.ITEM_EXAMINE)\n \t\t\t.runeLiteFormattedMessage(chatMessage)\n \t\t\t.build());\n \t}\n"}}, {"oid": "e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "url": "https://github.com/runelite/runelite/commit/e6225ac1f8dd7763c3200eaeaed6655ab3f72e31", "message": "raids plugin: add option to show loot value\n\nCo-authored-by: melkypie <melkypie@users.noreply.github.com>", "committedDate": "2020-01-07T16:15:24Z", "type": "forcePushed"}, {"oid": "08ddc76b636f0bb5f8212b558c6894b10ed40f16", "url": "https://github.com/runelite/runelite/commit/08ddc76b636f0bb5f8212b558c6894b10ed40f16", "message": "raids plugin: add option to show loot value\n\nCo-authored-by: melkypie <melkypie@users.noreply.github.com>", "committedDate": "2020-01-07T18:15:42Z", "type": "commit"}, {"oid": "08ddc76b636f0bb5f8212b558c6894b10ed40f16", "url": "https://github.com/runelite/runelite/commit/08ddc76b636f0bb5f8212b558c6894b10ed40f16", "message": "raids plugin: add option to show loot value\n\nCo-authored-by: melkypie <melkypie@users.noreply.github.com>", "committedDate": "2020-01-07T18:15:42Z", "type": "forcePushed"}]}