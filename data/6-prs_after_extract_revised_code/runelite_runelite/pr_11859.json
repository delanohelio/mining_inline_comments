{"pr_number": 11859, "pr_title": "LootTracker support for shade chests; support ground items", "pr_createdAt": "2020-06-09T01:34:06Z", "pr_url": "https://github.com/runelite/runelite/pull/11859", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1NDg4Nw==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437854887", "bodyText": "Remove this extra newline at EOF\n\n  \n    \n      \n        Suggested change", "author": "Nightfirecat", "createdAt": "2020-06-10T04:35:34Z", "path": "runelite-client/src/main/java/net/runelite/client/game/LootManager.java", "diffHunk": "@@ -403,4 +404,26 @@ private WorldPoint getAdjacentSquareLootTile(NPC npc)\n \n \t\treturn new WorldPoint(x, y, worldLocation.getPlane());\n \t}\n+\n+\t/**\n+\t * Get the list of items present at the provided WorldPoint that spawned this tick.\n+\t *\n+\t * @param worldPoint the location in question\n+\t * @return the list of item stacks\n+\t */\n+\tpublic Collection<ItemStack> getItemSpawns(WorldPoint worldPoint)\n+\t{\n+\t\tLocalPoint localPoint = LocalPoint.fromWorld(client, worldPoint);\n+\t\tif (localPoint == null)\n+\t\t{\n+\t\t\treturn Collections.emptyList();\n+\t\t}\n+\n+\t\tfinal int sceneX = localPoint.getSceneX();\n+\t\tfinal int sceneY = localPoint.getSceneY();\n+\t\tfinal int packed = sceneX << 8 | sceneY;\n+\t\tfinal List<ItemStack> itemStacks = itemSpawns.get(packed);\n+\t\treturn Collections.unmodifiableList(itemStacks);\n+\t}\n }\n+", "originalCommit": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0ODA3Mg==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r438348072", "bodyText": "done", "author": "leejt", "createdAt": "2020-06-10T19:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1NDg4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/game/LootManager.java b/runelite-client/src/main/java/net/runelite/client/game/LootManager.java\nindex 55aaa48a4..e44c5d757 100644\n--- a/runelite-client/src/main/java/net/runelite/client/game/LootManager.java\n+++ b/runelite-client/src/main/java/net/runelite/client/game/LootManager.java\n\n@@ -426,4 +426,3 @@ public class LootManager\n \t\treturn Collections.unmodifiableList(itemStacks);\n \t}\n }\n-\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg1NDkyNg==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437854926", "bodyText": "And this one\n\n  \n    \n      \n        Suggested change", "author": "Nightfirecat", "createdAt": "2020-06-10T04:35:44Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -891,3 +942,4 @@ private void lootReceivedChatMessage(final Collection<ItemStack> items, final St\n \t\t\t\t.build());\n \t}\n }\n+", "originalCommit": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\nindex 4db854452..811a165e7 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n\n@@ -942,4 +901,3 @@ public class LootTrackerPlugin extends Plugin\n \t\t\t\t.build());\n \t}\n }\n-\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NTA2Mw==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437865063", "bodyText": "All the clue scroll event cases should have their breaks become returns.", "author": "Nightfirecat", "createdAt": "2020-06-10T05:16:30Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -619,6 +649,13 @@ public void onChatMessage(ChatMessage event)\n \t\t\t\t\tbreak;", "originalCommit": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0ODE1Ng==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r438348156", "bodyText": "done", "author": "leejt", "createdAt": "2020-06-10T19:07:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NTA2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\nindex 4db854452..811a165e7 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n\n@@ -649,13 +623,6 @@ public class LootTrackerPlugin extends Plugin\n \t\t\t\t\tbreak;\n \t\t\t}\n \t\t}\n-\n-\t\tif (SHADE_CHEST_NO_KEY_PATTERN.matcher(message).matches())\n-\t\t{\n-\t\t\t// Player didn't have the key they needed.\n-\t\t\teventType = null;\n-\t\t\tlootRecordType = null;\n-\t\t}\n \t}\n \n \t@Subscribe\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NjczMA==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r437866730", "bodyText": "As written, this would make every chest of different key color recorded in a different loot group, which is kind of weird. I'd expect users to care only about the chest color, not about the key color.", "author": "Nightfirecat", "createdAt": "2020-06-10T05:22:18Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -657,6 +698,13 @@ public void onMenuOptionClicked(MenuOptionClicked event)\n \t\t\tlootRecordType = LootRecordType.EVENT;\n \t\t\ttakeInventorySnapshot();\n \t\t}\n+\n+\t\tif (event.getMenuOption().equals(\"Open\") && SHADE_CHEST_OBJECTS.containsKey(event.getId()))\n+\t\t{\n+\t\t\teventType = SHADE_CHEST_OBJECTS.get(event.getId());", "originalCommit": "5b2e2fbe1f4a8e9300387fd26768db0647f07f45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0MzIzNw==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r438343237", "bodyText": "Splitting by key color is intentional from my perspective \u2013\u00a0our current understanding is that (for example) silver key purple gives a different loot distribution than silver key red.\nIt's an open question whether that's a worthwhile reason to group them separately, but my general inclination has been, let's treat them differently if we think the underlying mechanics are distinct.", "author": "leejt", "createdAt": "2020-06-10T18:58:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NjczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3NzczMw==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r438377733", "bodyText": "I don't know anything about how the rewards are distributed, but the wiki says:\n\nA Silver key black is more likely to yield a better treasure than a Silver key brown, but all silver keys have the exact same set of possible rewards. Purple keys will have the highest chance of receiving a clue scroll.\n\nOne of the wiki and this should be updated, based on which is actually correct.", "author": "makingcomment", "createdAt": "2020-06-10T20:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NjczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODQxMjA1OA==", "url": "https://github.com/runelite/runelite/pull/11859#discussion_r438412058", "bodyText": "This is a pretty unexplored area of content, so nobody really knows what's going on (getting data to update the wiki is part of the point of adding this to the loot tracker, FWIW), but: we believe that they all give the same items, but at different rarities. We want to track what those rarities are on a per-key basis.", "author": "leejt", "createdAt": "2020-06-10T21:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NjczMA=="}], "type": "inlineReview", "revised_code": {"commit": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\nindex 4db854452..811a165e7 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n\n@@ -698,13 +664,6 @@ public class LootTrackerPlugin extends Plugin\n \t\t\tlootRecordType = LootRecordType.EVENT;\n \t\t\ttakeInventorySnapshot();\n \t\t}\n-\n-\t\tif (event.getMenuOption().equals(\"Open\") && SHADE_CHEST_OBJECTS.containsKey(event.getId()))\n-\t\t{\n-\t\t\teventType = SHADE_CHEST_OBJECTS.get(event.getId());\n-\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\ttakeInventorySnapshot();\n-\t\t}\n \t}\n \n \t@Schedule(\n"}}, {"oid": "fba6d7fcf63cd0e29fe5e84f6937918321158285", "url": "https://github.com/runelite/runelite/commit/fba6d7fcf63cd0e29fe5e84f6937918321158285", "message": "LootTracker: track ground items in addition to inventory", "committedDate": "2020-06-15T01:04:37Z", "type": "commit"}, {"oid": "88e3845d97eb2b099ecb5eca87838f8cde396c43", "url": "https://github.com/runelite/runelite/commit/88e3845d97eb2b099ecb5eca87838f8cde396c43", "message": "LootTracker: track shade chest loot", "committedDate": "2020-06-15T01:04:55Z", "type": "commit"}]}