{"pr_number": 11862, "pr_title": "Chest-a-palooza: track grubby, stone, Dorgesh-Kaan and HAM chests in \u2026", "pr_createdAt": "2020-06-09T07:03:31Z", "pr_url": "https://github.com/runelite/runelite/pull/11862", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg2NzE3MA==", "url": "https://github.com/runelite/runelite/pull/11862#discussion_r437867170", "bodyText": "This should be merged with the guard clause above to become:\nif (event.getContainerId() != InventoryID.INVENTORY.getId()\n\t|| eventType == null)\n{\n\treturn;\n}", "author": "Nightfirecat", "createdAt": "2020-06-10T05:23:58Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java", "diffHunk": "@@ -629,10 +650,16 @@ public void onItemContainerChanged(ItemContainerChanged event)\n \t\t\treturn;\n \t\t}\n \n+\t\tif (eventType == null)", "originalCommit": "165120c46622c8bdd74e4b48e7d44ee7cdfd02df", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "aa73751b50a4cb3f1dbde40a439a2e48c5040cea", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\nindex 94f068ae9..0d0462e4a 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/loottracker/LootTrackerPlugin.java\n\n@@ -617,52 +692,62 @@ public class LootTrackerPlugin extends Plugin\n \t\t\t\tcase \"beginner\":\n \t\t\t\t\teventType = \"Clue Scroll (Beginner)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t\tcase \"easy\":\n \t\t\t\t\teventType = \"Clue Scroll (Easy)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t\tcase \"medium\":\n \t\t\t\t\teventType = \"Clue Scroll (Medium)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t\tcase \"hard\":\n \t\t\t\t\teventType = \"Clue Scroll (Hard)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t\tcase \"elite\":\n \t\t\t\t\teventType = \"Clue Scroll (Elite)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t\tcase \"master\":\n \t\t\t\t\teventType = \"Clue Scroll (Master)\";\n \t\t\t\t\tlootRecordType = LootRecordType.EVENT;\n-\t\t\t\t\tbreak;\n+\t\t\t\t\treturn;\n \t\t\t}\n \t\t}\n+\n+\t\tif (SHADE_CHEST_NO_KEY_PATTERN.matcher(message).matches())\n+\t\t{\n+\t\t\t// Player didn't have the key they needed.\n+\t\t\teventType = null;\n+\t\t\tlootRecordType = null;\n+\t\t}\n \t}\n \n \t@Subscribe\n \tpublic void onItemContainerChanged(ItemContainerChanged event)\n \t{\n-\t\tif (event.getContainerId() != InventoryID.INVENTORY.getId())\n-\t\t{\n-\t\t\treturn;\n-\t\t}\n-\n-\t\tif (eventType == null)\n+\t\tif (event.getContainerId() != InventoryID.INVENTORY.getId()\n+\t\t\t|| eventType == null)\n \t\t{\n \t\t\treturn;\n \t\t}\n \n \t\tif (CHEST_EVENT_TYPES.containsValue(eventType)\n+\t\t\t|| SHADE_CHEST_OBJECTS.containsValue(eventType)\n+\t\t\t|| HALLOWED_SEPULCHRE_COFFIN_EVENT.equals(eventType)\n \t\t\t|| HERBIBOAR_EVENT.equals(eventType)\n \t\t\t|| HESPORI_EVENT.equals(eventType)\n \t\t\t|| SEEDPACK_EVENT.equals(eventType)\n+\t\t\t|| CASKET_EVENT.equals(eventType)\n+\t\t\t|| BIRDNEST_EVENT.equals(eventType)\n \t\t\t|| eventType.startsWith(\"H.A.M. chest\")\n \t\t\t|| lootRecordType == LootRecordType.PICKPOCKET)\n \t\t{\n-\t\t\tprocessInventoryLoot(eventType, lootRecordType, event.getItemContainer());\n+\t\t\tWorldPoint playerLocation = client.getLocalPlayer().getWorldLocation();\n+\t\t\tCollection<ItemStack> groundItems = lootManager.getItemSpawns(playerLocation);\n+\n+\t\t\tprocessInventoryLoot(eventType, lootRecordType, event.getItemContainer(), groundItems);\n \t\t\teventType = null;\n \t\t\tlootRecordType = null;\n \t\t}\n"}}, {"oid": "aa73751b50a4cb3f1dbde40a439a2e48c5040cea", "url": "https://github.com/runelite/runelite/commit/aa73751b50a4cb3f1dbde40a439a2e48c5040cea", "message": "loot tracker: track grubby, stone, Dorgesh-Kaan and HAM chests\n\nThe Dorgesh-Kaan tracking could be done better (there are actually 4 distinct drop tables) but it's hard to do this without significantly complicating the code.", "committedDate": "2020-08-07T16:40:02Z", "type": "commit"}]}