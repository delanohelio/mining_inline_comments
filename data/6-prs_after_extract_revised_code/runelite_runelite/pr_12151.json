{"pr_number": 12151, "pr_title": "Fix minimum overlay size resizing", "pr_createdAt": "2020-07-15T04:08:49Z", "pr_url": "https://github.com/runelite/runelite/pull/12151", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyMDk4Ng==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r456120986", "bodyText": "This should just be checked in Overlay class (for example override setPrefferedSize there and check it also there)", "author": "deathbeam", "createdAt": "2020-07-16T22:49:57Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerPlugin.java", "diffHunk": "@@ -216,6 +216,11 @@ public void finishCreation(boolean aborted)\n \t\t{\n \t\t\tfinal ScreenMarkerOverlay screenMarkerOverlay = new ScreenMarkerOverlay(marker);\n \t\t\tscreenMarkerOverlay.setPreferredLocation(overlay.getBounds().getLocation());\n+\n+\t\t\t// Ensure created overlay is of at least minimum width/height\n+\t\t\tfinal Rectangle markerBounds = overlay.getBounds();", "originalCommit": "da9bb49d91357f828e320a645ec45b529891a280", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzkwMTQ5Ng==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r457901496", "bodyText": "I agree this is a better approach. For the time being, I'm having some trouble with some edge cases around the screen marker plugin specifically, so I'm removing these changes from this PR while I adjust it so the resizing logic fix can be considered on its own.", "author": "Nightfirecat", "createdAt": "2020-07-21T07:45:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyMDk4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "17120b9fb9f545f98c41c1bc7598eb842f6b43c9", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerPlugin.java b/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerPlugin.java\nindex 525df8b65..6dc7558df 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerPlugin.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerPlugin.java\n\n@@ -216,11 +216,6 @@ public class ScreenMarkerPlugin extends Plugin\n \t\t{\n \t\t\tfinal ScreenMarkerOverlay screenMarkerOverlay = new ScreenMarkerOverlay(marker);\n \t\t\tscreenMarkerOverlay.setPreferredLocation(overlay.getBounds().getLocation());\n-\n-\t\t\t// Ensure created overlay is of at least minimum width/height\n-\t\t\tfinal Rectangle markerBounds = overlay.getBounds();\n-\t\t\tmarkerBounds.width = Math.max(markerBounds.width, overlay.getMinimumSize().width);\n-\t\t\tmarkerBounds.height = Math.max(markerBounds.height, overlay.getMinimumSize().height);\n \t\t\tscreenMarkerOverlay.setPreferredSize(overlay.getBounds().getSize());\n \n \t\t\tscreenMarkers.add(screenMarkerOverlay);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyMTg1OA==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r456121858", "bodyText": "Why is allowing smaller minimum size useful?", "author": "deathbeam", "createdAt": "2020-07-16T22:52:28Z", "path": "runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerOverlay.java", "diffHunk": "@@ -49,6 +50,7 @@\n \t\tsetLayer(OverlayLayer.ALWAYS_ON_TOP);\n \t\tsetPriority(OverlayPriority.HIGH);\n \t\tsetResizable(true);\n+\t\tsetMinimumSize(new Dimension(OverlayRenderer.OVERLAY_RESIZE_TOLERANCE * 2 + 1, OverlayRenderer.OVERLAY_RESIZE_TOLERANCE * 2 + 1));", "originalCommit": "da9bb49d91357f828e320a645ec45b529891a280", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyNTY3NA==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r456125674", "bodyText": "This particular change is in response to a user finding that resizing a marker they placed over a spell widget, which is notably smaller than 32x32, caused it to grow much larger and they could not resize it back to its original size.", "author": "Nightfirecat", "createdAt": "2020-07-16T23:03:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyMTg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY2MTQ4NA==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r456661484", "bodyText": "I see, makes sense", "author": "deathbeam", "createdAt": "2020-07-17T20:33:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyMTg1OA=="}], "type": "inlineReview", "revised_code": {"commit": "17120b9fb9f545f98c41c1bc7598eb842f6b43c9", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerOverlay.java b/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerOverlay.java\nindex 492a60676..c82ac2aee 100644\n--- a/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerOverlay.java\n+++ b/runelite-client/src/main/java/net/runelite/client/plugins/screenmarkers/ScreenMarkerOverlay.java\n\n@@ -50,7 +49,6 @@ public class ScreenMarkerOverlay extends Overlay\n \t\tsetLayer(OverlayLayer.ALWAYS_ON_TOP);\n \t\tsetPriority(OverlayPriority.HIGH);\n \t\tsetResizable(true);\n-\t\tsetMinimumSize(new Dimension(OverlayRenderer.OVERLAY_RESIZE_TOLERANCE * 2 + 1, OverlayRenderer.OVERLAY_RESIZE_TOLERANCE * 2 + 1));\n \t\tsetResettable(false);\n \t}\n \n"}}, {"oid": "17120b9fb9f545f98c41c1bc7598eb842f6b43c9", "url": "https://github.com/runelite/runelite/commit/17120b9fb9f545f98c41c1bc7598eb842f6b43c9", "message": "OverlayRenderer: Fix overlay resizing logic\n\nPrior to this commit, reducing the size of an overlay not attached to an\nanchor point using the north or west edges and corners such that its\ndimensions would be below the minimum overlay size would push that\noverlay in that direction as it was dragged. This commit updates the\noverlay resize logic to prevent \"pushing\" overlays when trying to reduce\nthe width or height below the overlay's minimum size.", "committedDate": "2020-07-21T07:43:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDIxMDAxOQ==", "url": "https://github.com/runelite/runelite/pull/12151#discussion_r460210019", "bodyText": "Double space", "author": "deathbeam", "createdAt": "2020-07-24T18:07:41Z", "path": "runelite-client/src/main/java/net/runelite/client/ui/overlay/OverlayRenderer.java", "diffHunk": "@@ -460,53 +460,83 @@ public MouseEvent mouseDragged(MouseEvent mouseEvent)\n \n \t\tif (inOverlayResizingMode)\n \t\t{\n-\t\t\tfinal Rectangle r = currentManagedBounds;\n+\t\t\tfinal int left = p.x - currentManagedBounds.x; // Distance (in pixels) from the left edge of the bounds\n+\t\t\tfinal int top = p.y - currentManagedBounds.y;  // Distance (in pixels) from the top edge of the bounds\n+\t\t\tfinal int originalX = currentManagedBounds.x;\n+\t\t\tfinal int originalY = currentManagedBounds.y;\n+\t\t\tint x = originalX;\n+\t\t\tint y = originalY;\n+\t\t\tint width = currentManagedBounds.width;\n+\t\t\tint height = currentManagedBounds.height;\n \n-\t\t\tfinal int dx = p.x - r.x;\n-\t\t\tfinal int dy = p.y - r.y;\n \t\t\tswitch (clientUI.getCurrentCursor().getType())\n \t\t\t{\n \t\t\t\tcase Cursor.N_RESIZE_CURSOR:\n-\t\t\t\t\tint height = r.height - dy;\n-\t\t\t\t\tr.setRect(r.x, r.y + dy, r.width, height);\n+\t\t\t\t\ty += top;\n+\t\t\t\t\theight -=  top;", "originalCommit": "17120b9fb9f545f98c41c1bc7598eb842f6b43c9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b3c7ce535d87728cf98d5901bb46aa288fbcee5d", "chunk": "diff --git a/runelite-client/src/main/java/net/runelite/client/ui/overlay/OverlayRenderer.java b/runelite-client/src/main/java/net/runelite/client/ui/overlay/OverlayRenderer.java\nindex d4bf5e0c3..421b5d1dc 100644\n--- a/runelite-client/src/main/java/net/runelite/client/ui/overlay/OverlayRenderer.java\n+++ b/runelite-client/src/main/java/net/runelite/client/ui/overlay/OverlayRenderer.java\n\n@@ -473,7 +473,7 @@ public class OverlayRenderer extends MouseAdapter implements KeyListener\n \t\t\t{\n \t\t\t\tcase Cursor.N_RESIZE_CURSOR:\n \t\t\t\t\ty += top;\n-\t\t\t\t\theight -=  top;\n+\t\t\t\t\theight -= top;\n \t\t\t\t\tbreak;\n \t\t\t\tcase Cursor.NW_RESIZE_CURSOR:\n \t\t\t\t\tx += left;\n"}}, {"oid": "b3c7ce535d87728cf98d5901bb46aa288fbcee5d", "url": "https://github.com/runelite/runelite/commit/b3c7ce535d87728cf98d5901bb46aa288fbcee5d", "message": "OverlayRenderer: Fix overlay resizing logic\n\nPrior to this commit, reducing the size of an overlay not attached to an\nanchor point using the north or west edges and corners such that its\ndimensions would be below the minimum overlay size would push that\noverlay in that direction as it was dragged. This commit updates the\noverlay resize logic to prevent \"pushing\" overlays when trying to reduce\nthe width or height below the overlay's minimum size.", "committedDate": "2020-07-24T18:09:15Z", "type": "commit"}, {"oid": "b3c7ce535d87728cf98d5901bb46aa288fbcee5d", "url": "https://github.com/runelite/runelite/commit/b3c7ce535d87728cf98d5901bb46aa288fbcee5d", "message": "OverlayRenderer: Fix overlay resizing logic\n\nPrior to this commit, reducing the size of an overlay not attached to an\nanchor point using the north or west edges and corners such that its\ndimensions would be below the minimum overlay size would push that\noverlay in that direction as it was dragged. This commit updates the\noverlay resize logic to prevent \"pushing\" overlays when trying to reduce\nthe width or height below the overlay's minimum size.", "committedDate": "2020-07-24T18:09:15Z", "type": "forcePushed"}]}