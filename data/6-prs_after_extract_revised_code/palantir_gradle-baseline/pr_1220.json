{"pr_number": 1220, "pr_title": "./gradlew test -Drecreate=true", "pr_createdAt": "2020-02-07T14:05:41Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1220", "timeline": [{"oid": "a102c1311231d27ab7235004450d1e45d824fbcd", "url": "https://github.com/palantir/gradle-baseline/commit/a102c1311231d27ab7235004450d1e45d824fbcd", "message": "-Drecreate=true", "committedDate": "2020-02-07T14:03:06Z", "type": "commit"}, {"oid": "ce1c5966c48050e7c41606c312803d893fbaccc6", "url": "https://github.com/palantir/gradle-baseline/commit/ce1c5966c48050e7c41606c312803d893fbaccc6", "message": "Add generated changelog entries", "committedDate": "2020-02-07T14:03:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNTc1Mg==", "url": "https://github.com/palantir/gradle-baseline/pull/1220#discussion_r376415752", "bodyText": "Should be be defensive and disable caching when shouldRecreate=true?", "author": "carterkozak", "createdAt": "2020-02-07T14:24:21Z", "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java", "diffHunk": "@@ -46,6 +46,12 @@ public void apply(Project project) {\n                 // Never cache test tasks, until we work out the correct inputs for ETE / integration tests\n                 task.getOutputs().cacheIf(t -> false);\n             }\n+\n+            // repos that use 'snapshot' style testing should all use one convenient task to refresh the snapshots,\n+            // ./gradlew test -Drecreate=true\n+            String shouldRecreate = System.getProperty(\"recreate\", \"false\");\n+            task.systemProperty(\"recreate\", shouldRecreate);\n+            task.getInputs().property(\"recreate\", shouldRecreate);", "originalCommit": "ce1c5966c48050e7c41606c312803d893fbaccc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNjgwNQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1220#discussion_r376416805", "bodyText": "We may want to require/force boolean values here, possibly Boolean.getBoolean(\"recreate\") and use the string value for the sysprop+input?", "author": "carterkozak", "createdAt": "2020-02-07T14:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjQxNTc1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "32641ab91b9ba41dbaac9882677a119d1de77b50", "chunk": "diff --git a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\nindex 001147d3..c13d58f8 100644\n--- a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\n+++ b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\n\n@@ -51,7 +51,9 @@ public final class BaselineTesting implements Plugin<Project> {\n             // ./gradlew test -Drecreate=true\n             String shouldRecreate = System.getProperty(\"recreate\", \"false\");\n             task.systemProperty(\"recreate\", shouldRecreate);\n-            task.getInputs().property(\"recreate\", shouldRecreate);\n+            if (Boolean.valueOf(shouldRecreate)) {\n+                task.getOutputs().cacheIf(t -> false);\n+            }\n         });\n \n         project.getPlugins().withType(JavaPlugin.class, unusedPlugin -> {\n"}}, {"oid": "32641ab91b9ba41dbaac9882677a119d1de77b50", "url": "https://github.com/palantir/gradle-baseline/commit/32641ab91b9ba41dbaac9882677a119d1de77b50", "message": "always re-run test", "committedDate": "2020-02-07T14:29:19Z", "type": "commit"}, {"oid": "b23f116e153358633732bd239dad1ebf9a709a0a", "url": "https://github.com/palantir/gradle-baseline/commit/b23f116e153358633732bd239dad1ebf9a709a0a", "message": "Merge branch 'dfox/recreate-true' of github.com:palantir/gradle-baseline into dfox/recreate-true", "committedDate": "2020-02-07T14:30:17Z", "type": "commit"}, {"oid": "bc647247df5bb14771ab0cdea182bd6e0997beb0", "url": "https://github.com/palantir/gradle-baseline/commit/bc647247df5bb14771ab0cdea182bd6e0997beb0", "message": "enforce boolean", "committedDate": "2020-02-07T14:30:55Z", "type": "commit"}, {"oid": "bc647247df5bb14771ab0cdea182bd6e0997beb0", "url": "https://github.com/palantir/gradle-baseline/commit/bc647247df5bb14771ab0cdea182bd6e0997beb0", "message": "enforce boolean", "committedDate": "2020-02-07T14:30:55Z", "type": "forcePushed"}]}