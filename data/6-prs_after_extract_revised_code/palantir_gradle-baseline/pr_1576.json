{"pr_number": 1576, "pr_title": "Saner test event logging default for CI", "pr_createdAt": "2020-11-30T13:57:40Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1576", "timeline": [{"oid": "f33b64a5a164593de223252818af7e613b354526", "url": "https://github.com/palantir/gradle-baseline/commit/f33b64a5a164593de223252818af7e613b354526", "message": "Saner test event logging default for CI", "committedDate": "2020-11-30T13:50:25Z", "type": "commit"}, {"oid": "d702a859a0e8a6254a280f372ec24bb22eb05dda", "url": "https://github.com/palantir/gradle-baseline/commit/d702a859a0e8a6254a280f372ec24bb22eb05dda", "message": "Add generated changelog entries", "committedDate": "2020-11-30T13:50:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwMDIwOQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1576#discussion_r532800209", "bodyText": "@CRogers can we try to not apply this to the ./gradlew test tasks which are normally just unit-tests??", "author": "iamdanfox", "createdAt": "2020-11-30T18:13:06Z", "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java", "diffHunk": "@@ -140,8 +142,17 @@ private static void enableJunit5ForTestTask(Test task) {\n         // Computes the desired parallelism based on the number of available processors/cores\n         task.systemProperty(\"junit.jupiter.execution.parallel.config.strategy\", \"dynamic\");\n \n-        // provide some stdout feedback when tests fail\n-        task.testLogging(testLogging -> testLogging.events(\"failed\"));\n+        // provide some stdout feedback when tests fail when running on CI and locally\n+        task.getTestLogging().getEvents().add(TestLogEvent.FAILED);\n+\n+        // Only on CI, print out more detailed test information to avoid hitting the circleci 10 min deadline if\n+        // there are lots of tests. Don't do this locally to avoid spamming massive amount of info for people running\n+        // unit tests through the command line\n+        if (\"true\".equals(System.getenv(\"CI\"))) {\n+            task.getTestLogging()", "originalCommit": "d702a859a0e8a6254a280f372ec24bb22eb05dda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwNjIwOA==", "url": "https://github.com/palantir/gradle-baseline/pull/1576#discussion_r532806208", "bodyText": "Yep, I have a commit to do this actually, I was just distracted by testing it on c-v-s that had the silently not running tests problem :p", "author": "CRogers", "createdAt": "2020-11-30T18:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwMDIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgxNDgwMA==", "url": "https://github.com/palantir/gradle-baseline/pull/1576#discussion_r532814800", "bodyText": "Pushed", "author": "CRogers", "createdAt": "2020-11-30T18:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgwMDIwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "e9924c33b2904c0cd0924341d4ef4030081adedb", "chunk": "diff --git a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\nindex 19dd4108..5cf5470e 100644\n--- a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\n+++ b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineTesting.java\n\n@@ -145,10 +145,11 @@ public final class BaselineTesting implements Plugin<Project> {\n         // provide some stdout feedback when tests fail when running on CI and locally\n         task.getTestLogging().getEvents().add(TestLogEvent.FAILED);\n \n-        // Only on CI, print out more detailed test information to avoid hitting the circleci 10 min deadline if\n-        // there are lots of tests. Don't do this locally to avoid spamming massive amount of info for people running\n-        // unit tests through the command line\n-        if (\"true\".equals(System.getenv(\"CI\"))) {\n+        // Only on CI and for non-unit test tasks, print out more detailed test information to avoid hitting the\n+        // circleci 10 min deadline if there are lots of tests. Don't do this locally to avoid spamming massive\n+        // amount of info for people running tests through the command line. Only for non unit test tasks as unit\n+        // test tasks tend to be fast and avoid this issue.\n+        if (!task.getName().equals(\"test\") && \"true\".equals(System.getenv(\"CI\"))) {\n             task.getTestLogging()\n                     .getEvents()\n                     .addAll(ImmutableSet.of(TestLogEvent.STARTED, TestLogEvent.PASSED, TestLogEvent.SKIPPED));\n"}}, {"oid": "e9924c33b2904c0cd0924341d4ef4030081adedb", "url": "https://github.com/palantir/gradle-baseline/commit/e9924c33b2904c0cd0924341d4ef4030081adedb", "message": "Only when not the test task", "committedDate": "2020-11-30T18:23:58Z", "type": "commit"}, {"oid": "249c449c2a3d7e5833500d974c788f3c18f33351", "url": "https://github.com/palantir/gradle-baseline/commit/249c449c2a3d7e5833500d974c788f3c18f33351", "message": "Merge branch 'callumr/saner-test-logging-defaults' of github.com:palantir/gradle-baseline into callumr/saner-test-logging-defaults", "committedDate": "2020-11-30T18:26:04Z", "type": "commit"}]}