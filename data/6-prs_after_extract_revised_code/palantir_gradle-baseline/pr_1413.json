{"pr_number": 1413, "pr_title": "Disable broken rule on switch expressions", "pr_createdAt": "2020-06-12T18:23:28Z", "pr_url": "https://github.com/palantir/gradle-baseline/pull/1413", "timeline": [{"oid": "2a4ec7af134c6564d08dee10f10f169a40f80578", "url": "https://github.com/palantir/gradle-baseline/commit/2a4ec7af134c6564d08dee10f10f169a40f80578", "message": "demonstrate broken rule", "committedDate": "2020-06-12T18:09:24Z", "type": "commit"}, {"oid": "ba166f58f9272c9289fac2dc130967d715f17737", "url": "https://github.com/palantir/gradle-baseline/commit/ba166f58f9272c9289fac2dc130967d715f17737", "message": "disable broken rule", "committedDate": "2020-06-12T18:15:44Z", "type": "commit"}, {"oid": "96eda39c5b5d9b47c5feeac8ce706a42597e7fb1", "url": "https://github.com/palantir/gradle-baseline/commit/96eda39c5b5d9b47c5feeac8ce706a42597e7fb1", "message": "format", "committedDate": "2020-06-12T18:23:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3ODY3MQ==", "url": "https://github.com/palantir/gradle-baseline/pull/1413#discussion_r439578671", "bodyText": "I've found UnnecessaryParentheses useful in a few places, thoughts on disabling it only on jdk14 with experimental features enabled?", "author": "carterkozak", "createdAt": "2020-06-12T18:26:36Z", "path": "gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineErrorProne.java", "diffHunk": "@@ -210,18 +210,18 @@ private static void configureErrorProneOptions(\n                 .set(String.format(\n                         \"%s%s(build|src%sgenerated.*)%s.*\",\n                         Pattern.quote(projectPath), separator, separator, separator));\n-        errorProneOptions.check(\"CatchSpecificity\", CheckSeverity.OFF);\n-        errorProneOptions.check(\"UnusedVariable\", CheckSeverity.OFF);\n-        errorProneOptions.check(\"EqualsHashCode\", CheckSeverity.ERROR);\n-        errorProneOptions.check(\"EqualsIncompatibleType\", CheckSeverity.ERROR);\n-        errorProneOptions.check(\"StreamResourceLeak\", CheckSeverity.ERROR);\n-        errorProneOptions.check(\"InputStreamSlowMultibyteRead\", CheckSeverity.ERROR);\n-        errorProneOptions.check(\"JavaDurationGetSecondsGetNano\", CheckSeverity.ERROR);\n-        errorProneOptions.check(\"URLEqualsHashCode\", CheckSeverity.ERROR);\n \n+        errorProneOptions.disable(\"UnnecessaryParentheses\", \"CatchSpecificity\", \"UnusedVariable\");", "originalCommit": "96eda39c5b5d9b47c5feeac8ce706a42597e7fb1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI2MDY3MA==", "url": "https://github.com/palantir/gradle-baseline/pull/1413#discussion_r440260670", "bodyText": "Switch expressions aren't an experimental feature in Java 14.", "author": "pkoenig10", "createdAt": "2020-06-15T15:29:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3ODY3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d8e5d072bd55c6331df8b39c03637523b51269a5", "chunk": "diff --git a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineErrorProne.java b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineErrorProne.java\nindex d96e90c0..e8778ca8 100644\n--- a/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineErrorProne.java\n+++ b/gradle-baseline-java/src/main/groovy/com/palantir/baseline/plugins/BaselineErrorProne.java\n\n@@ -211,7 +210,15 @@ public final class BaselineErrorProne implements Plugin<Project> {\n                         \"%s%s(build|src%sgenerated.*)%s.*\",\n                         Pattern.quote(projectPath), separator, separator, separator));\n \n-        errorProneOptions.disable(\"UnnecessaryParentheses\", \"CatchSpecificity\", \"UnusedVariable\");\n+        // UnnecessaryParentheses does not currently work with switch expressions\n+        errorProneOptions.check(\"UnnecessaryParentheses\", project.provider(() -> {\n+            JavaPluginExtension ext = project.getExtensions().getByType(JavaPluginExtension.class);\n+            return ext.getSourceCompatibility().compareTo(JavaVersion.valueOf(\"14\")) < 0\n+                    ? CheckSeverity.DEFAULT\n+                    : CheckSeverity.OFF;\n+        }));\n+\n+        errorProneOptions.disable(\"CatchSpecificity\", \"UnusedVariable\");\n         errorProneOptions.error(\n                 \"EqualsHashCode\",\n                 \"EqualsIncompatibleType\",\n"}}, {"oid": "d8e5d072bd55c6331df8b39c03637523b51269a5", "url": "https://github.com/palantir/gradle-baseline/commit/d8e5d072bd55c6331df8b39c03637523b51269a5", "message": "only disable on Java 14+", "committedDate": "2020-06-15T19:15:18Z", "type": "commit"}, {"oid": "546e66225af3aee94f6e00ed399123ade4d29a3e", "url": "https://github.com/palantir/gradle-baseline/commit/546e66225af3aee94f6e00ed399123ade4d29a3e", "message": "Add generated changelog entries", "committedDate": "2020-06-15T19:15:18Z", "type": "commit"}, {"oid": "b1578407d0a8d1e3c9f3127ba95cf9484f38e043", "url": "https://github.com/palantir/gradle-baseline/commit/b1578407d0a8d1e3c9f3127ba95cf9484f38e043", "message": "fix", "committedDate": "2020-06-30T15:50:17Z", "type": "commit"}]}