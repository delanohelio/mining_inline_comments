{"pr_number": 3852, "pr_title": "unwraps the InvocationTargetException to report the real error", "pr_createdAt": "2020-03-24T23:24:12Z", "pr_url": "https://github.com/bndtools/bnd/pull/3852", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY3NTkyMw==", "url": "https://github.com/bndtools/bnd/pull/3852#discussion_r397675923", "bodyText": "See the methods for this in Exceptions, they provide solid support to get the original cause", "author": "pkriens", "createdAt": "2020-03-25T08:23:35Z", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java", "diffHunk": "@@ -206,8 +207,14 @@ private void parseResource(Archive archive, String parent) throws Exception {\n \t\t\t}\n \t\t\taddInformationCapability(rb, archive.toString(), parent);\n \t\t} catch (Exception e) {\n+\t\t\tThrowable theException = e;", "originalCommit": "5a351494424dfab4b06df79d8c156b81d915ad5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczOTQ5MA==", "url": "https://github.com/bndtools/bnd/pull/3852#discussion_r397739490", "bodyText": "Makes sense. I will use the Exceptions.unrollCause method. I guess we can use this in any case.", "author": "juergen-albert", "createdAt": "2020-03-25T10:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY3NTkyMw=="}], "type": "inlineReview", "revised_code": {"commit": "71e27a9eeb038adb29aa4d084ed071c59541d37d", "chunk": "diff --git a/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java b/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\nindex 1058ba85e..ab1e196a8 100644\n--- a/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\n+++ b/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\n\n@@ -207,12 +207,7 @@ class Traverser {\n \t\t\t}\n \t\t\taddInformationCapability(rb, archive.toString(), parent);\n \t\t} catch (Exception e) {\n-\t\t\tThrowable theException = e;\n-\t\t\t// the InvocationTargetException hides the actual Exception, so we\n-\t\t\t// need so unwrap\n-\t\t\tif (e instanceof InvocationTargetException) {\n-\t\t\t\ttheException = e.getCause();\n-\t\t\t}\n+\t\t\tThrowable theException = Exceptions.unrollCause(e);\n \t\t\taddReserveIdentity(rb, bsn, frameworkVersion);\n \t\t\taddInformationCapability(rb, archive.toString(), parent, theException);\n \t\t}\n"}}, {"oid": "71e27a9eeb038adb29aa4d084ed071c59541d37d", "url": "https://github.com/bndtools/bnd/commit/71e27a9eeb038adb29aa4d084ed071c59541d37d", "message": "unwraps the Exception to report the real error\n\nfixes #3851\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-03-25T10:14:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODcwOQ==", "url": "https://github.com/bndtools/bnd/pull/3852#discussion_r397808709", "bodyText": "This will unroll all the way back to the root cause. If you only want to unroll off any InvocactionTargetExceptions, then you want to do:\nThrowable theException = Exceptions.unrollCause(e, InvocationTargetException.class);\nSee for example:\n\n  \n    \n      bnd/biz.aQute.bndlib/src/aQute/bnd/osgi/Processor.java\n    \n    \n        Lines 419 to 420\n      in\n      a6d93a4\n    \n    \n    \n    \n\n        \n          \n           // unroll InvocationTargetException \n        \n\n        \n          \n           t = Exceptions.unrollCause(t, InvocationTargetException.class);", "author": "bjhargrave", "createdAt": "2020-03-25T12:15:38Z", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java", "diffHunk": "@@ -206,8 +207,9 @@ private void parseResource(Archive archive, String parent) throws Exception {\n \t\t\t}\n \t\t\taddInformationCapability(rb, archive.toString(), parent);\n \t\t} catch (Exception e) {\n+\t\t\tThrowable theException = Exceptions.unrollCause(e);", "originalCommit": "71e27a9eeb038adb29aa4d084ed071c59541d37d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg2OTA1NQ==", "url": "https://github.com/bndtools/bnd/pull/3852#discussion_r397869055", "bodyText": "Maybe one day I will manage to create PR that does not need at least 3 iterations :-)", "author": "juergen-albert", "createdAt": "2020-03-25T13:51:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4NDI1OA==", "url": "https://github.com/bndtools/bnd/pull/3852#discussion_r397984258", "bodyText": "I think there is a rumour that Chuck Norris could once bypass BJ with only 2 iterations ...", "author": "pkriens", "createdAt": "2020-03-25T16:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgwODcwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "33375adece4b84b0b7ca1f9267a66e42992aaf07", "chunk": "diff --git a/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java b/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\nindex ab1e196a8..a07b4fac4 100644\n--- a/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\n+++ b/biz.aQute.repository/src/aQute/bnd/repository/maven/pom/provider/Traverser.java\n\n@@ -207,7 +208,7 @@ class Traverser {\n \t\t\t}\n \t\t\taddInformationCapability(rb, archive.toString(), parent);\n \t\t} catch (Exception e) {\n-\t\t\tThrowable theException = Exceptions.unrollCause(e);\n+\t\t\tThrowable theException = Exceptions.unrollCause(e, InvocationTargetException.class);\n \t\t\taddReserveIdentity(rb, bsn, frameworkVersion);\n \t\t\taddInformationCapability(rb, archive.toString(), parent, theException);\n \t\t}\n"}}, {"oid": "33375adece4b84b0b7ca1f9267a66e42992aaf07", "url": "https://github.com/bndtools/bnd/commit/33375adece4b84b0b7ca1f9267a66e42992aaf07", "message": "unwraps the Exception to report the real error\n\nfixes #3851\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-03-25T13:50:12Z", "type": "commit"}, {"oid": "33375adece4b84b0b7ca1f9267a66e42992aaf07", "url": "https://github.com/bndtools/bnd/commit/33375adece4b84b0b7ca1f9267a66e42992aaf07", "message": "unwraps the Exception to report the real error\n\nfixes #3851\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-03-25T13:50:12Z", "type": "forcePushed"}]}