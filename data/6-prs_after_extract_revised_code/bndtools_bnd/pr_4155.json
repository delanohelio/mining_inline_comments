{"pr_number": 4155, "pr_title": "Implements cancel for resolve job #4154", "pr_createdAt": "2020-06-10T19:29:00Z", "pr_url": "https://github.com/bndtools/bnd/pull/4155", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyMDc3MA==", "url": "https://github.com/bndtools/bnd/pull/4155#discussion_r439620770", "bodyText": "private final", "author": "bjhargrave", "createdAt": "2020-06-12T20:09:49Z", "path": "bndtools.core/src/org/bndtools/core/resolve/CancelOperationCallback.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.bndtools.core.resolve;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.eclipse.core.runtime.IProgressMonitor;\n+import org.osgi.resource.Capability;\n+import org.osgi.resource.Requirement;\n+\n+import biz.aQute.resolve.ResolutionCallback;\n+\n+public class CancelOperationCallback implements ResolutionCallback {\n+\n+\tprivate IProgressMonitor monitor;", "originalCommit": "d3367fea2df604f6e07517b6ef3474f79537b7d9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "chunk": "diff --git a/bndtools.core/src/org/bndtools/core/resolve/CancelOperationCallback.java b/bndtools.core/src/org/bndtools/core/resolve/CancelOperationCallback.java\nindex 9b9f3a764..3241662c2 100644\n--- a/bndtools.core/src/org/bndtools/core/resolve/CancelOperationCallback.java\n+++ b/bndtools.core/src/org/bndtools/core/resolve/CancelOperationCallback.java\n\n@@ -11,7 +11,7 @@ import biz.aQute.resolve.ResolutionCallback;\n \n public class CancelOperationCallback implements ResolutionCallback {\n \n-\tprivate IProgressMonitor monitor;\n+\tprivate final IProgressMonitor monitor;\n \n \tpublic CancelOperationCallback(IProgressMonitor monitor) {\n \t\tthis.monitor = monitor;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyMTU0Mw==", "url": "https://github.com/bndtools/bnd/pull/4155#discussion_r439621543", "bodyText": "I think the last argument need to be null. Otherwise the ResolverLogger is not closed.", "author": "bjhargrave", "createdAt": "2020-06-12T20:11:44Z", "path": "biz.aQute.resolve/src/biz/aQute/resolve/RunResolution.java", "diffHunk": "@@ -73,10 +73,28 @@\n \t */\n \tpublic static RunResolution resolve(Project project, Processor actualProperties,\n \t\tCollection<ResolutionCallback> callbacks) {\n+\t\treturn resolve(project, actualProperties, callbacks, new ResolverLogger());", "originalCommit": "d3367fea2df604f6e07517b6ef3474f79537b7d9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "chunk": "diff --git a/biz.aQute.resolve/src/biz/aQute/resolve/RunResolution.java b/biz.aQute.resolve/src/biz/aQute/resolve/RunResolution.java\nindex 83e551695..08de8cdcd 100644\n--- a/biz.aQute.resolve/src/biz/aQute/resolve/RunResolution.java\n+++ b/biz.aQute.resolve/src/biz/aQute/resolve/RunResolution.java\n\n@@ -73,7 +73,7 @@ public class RunResolution {\n \t */\n \tpublic static RunResolution resolve(Project project, Processor actualProperties,\n \t\tCollection<ResolutionCallback> callbacks) {\n-\t\treturn resolve(project, actualProperties, callbacks, new ResolverLogger());\n+\t\treturn resolve(project, actualProperties, callbacks, null);\n \t}\n \n \t/**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyMTY4Mw==", "url": "https://github.com/bndtools/bnd/pull/4155#discussion_r439621683", "bodyText": "Who closes this ResolverLogger? I have the feeling there are several code paths where it is quite unclear who, if anyone, closes the ResolverLoggers.", "author": "bjhargrave", "createdAt": "2020-06-12T20:12:08Z", "path": "bndtools.core/src/bndtools/editor/BndEditor.java", "diffHunk": "@@ -328,8 +329,9 @@ public IStatus runInUIThread(IProgressMonitor monitor) {\n \t\t\t\t\tsourcePage.commit(false);\n \t\t\t\t}\n \n+\t\t\t\tResolverLogger logger = new ResolverLogger();", "originalCommit": "d3367fea2df604f6e07517b6ef3474f79537b7d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjI5MDA2NA==", "url": "https://github.com/bndtools/bnd/pull/4155#discussion_r442290064", "bodyText": "you are right, the implementation was a bit too messy. I need to keep the logger till the End, so I can instruct it not to delete the logfile if the resolver ran in circles and needed canceling.\nThe logger will will now be created for each resolve operation and will be closed when the wizard is disposed or the when we reresolve after adding optional bundles", "author": "juergen-albert", "createdAt": "2020-06-18T14:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyMTY4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "chunk": "diff --git a/bndtools.core/src/bndtools/editor/BndEditor.java b/bndtools.core/src/bndtools/editor/BndEditor.java\nindex 22ae139c7..c8935b42c 100644\n--- a/bndtools.core/src/bndtools/editor/BndEditor.java\n+++ b/bndtools.core/src/bndtools/editor/BndEditor.java\n\n@@ -329,9 +328,8 @@ public class BndEditor extends ExtendedFormEditor implements IResourceChangeList\n \t\t\t\t\tsourcePage.commit(false);\n \t\t\t\t}\n \n-\t\t\t\tResolverLogger logger = new ResolverLogger();\n \t\t\t\t// Create resolver job and pre-validate\n-\t\t\t\tfinal ResolveJob job = new ResolveJob(model, inputResource, logger);\n+\t\t\t\tfinal ResolveJob job = new ResolveJob(model, inputResource);\n \t\t\t\tIStatus validation = job.validateBeforeRun();\n \t\t\t\tif (!validation.isOK()) {\n \t\t\t\t\tif (onSave)\n"}}, {"oid": "37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "url": "https://github.com/bndtools/bnd/commit/37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "message": "Implements cancel for resolve job #4154\n\n- Adds the ability to keep the resolve log after it is canceled\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-06-18T14:51:25Z", "type": "commit"}, {"oid": "37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "url": "https://github.com/bndtools/bnd/commit/37c6a5b50a55db572f7fbcb5ba376f38bd1950ca", "message": "Implements cancel for resolve job #4154\n\n- Adds the ability to keep the resolve log after it is canceled\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-06-18T14:51:25Z", "type": "forcePushed"}]}