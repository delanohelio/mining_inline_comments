{"pr_number": 3793, "pr_title": "Adds a log warning if no sources available", "pr_createdAt": "2020-02-20T09:00:59Z", "pr_url": "https://github.com/bndtools/bnd/pull/3793", "timeline": [{"oid": "89f8fae035961914613173ec8d5f2ce6df323f12", "url": "https://github.com/bndtools/bnd/commit/89f8fae035961914613173ec8d5f2ce6df323f12", "message": "Adds a log warning if no sources/javadoc/pom is available\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-02-21T09:36:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3MjE5OQ==", "url": "https://github.com/bndtools/bnd/pull/3793#discussion_r386572199", "bodyText": "I think the 2nd arg should just be options.context.getBase(). I don't see why we would want to use a URI here.", "author": "bjhargrave", "createdAt": "2020-03-02T18:34:01Z", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -249,6 +249,12 @@ private Resource getPom(PutOptions options, ReleaseDTO instructions, Jar binary)\n \t\t\t\t\t.orElse(null);\n \t\t\t} else {\n \t\t\t\tpom = createPomFromFile(options.context.getFile(instructions.pom.path));\n+\t\t\t\tif (pom == null) {\n+\t\t\t\t\tlogger.warn(\n+\t\t\t\t\t\t\"A pom path was set in the -maven-release instuction, but no file could be found in {} (base path: {}) \",\n+\t\t\t\t\t\tinstructions.pom.path, options.context.getBaseURI()", "originalCommit": "89f8fae035961914613173ec8d5f2ce6df323f12", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bb2fa88ab187513cb6efe02207dc02275f8dbde7", "chunk": "diff --git a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\nindex b5489e946..5449e8d49 100644\n--- a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n+++ b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n\n@@ -252,8 +252,7 @@ public class MavenBndRepository extends BaseRepository implements RepositoryPlug\n \t\t\t\tif (pom == null) {\n \t\t\t\t\tlogger.warn(\n \t\t\t\t\t\t\"A pom path was set in the -maven-release instuction, but no file could be found in {} (base path: {}) \",\n-\t\t\t\t\t\tinstructions.pom.path, options.context.getBaseURI()\n-\t\t\t\t\t\t\t.toString());\n+\t\t\t\t\t\tinstructions.pom.path, options.context.getBase());\n \t\t\t\t}\n \t\t\t}\n \t\t} else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3MjY2NA==", "url": "https://github.com/bndtools/bnd/pull/3793#discussion_r386572664", "bodyText": "I think the 2nd arg should just be options.context.getBase(). I don't see why we would want to use a URI here. We also should not toString() it in case logging does not happen. Leave the toString() call to the logging code.", "author": "bjhargrave", "createdAt": "2020-03-02T18:34:59Z", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -291,6 +297,12 @@ private boolean isLocal(ReleaseDTO instructions) {\n \n \tprivate Jar getSources(Tool tool, Processor context, String path) throws Exception {\n \t\tJar jar = toJar(context, path);\n+\t\tif (path != null && jar == null) {\n+\t\t\tlogger.warn(\n+\t\t\t\t\"A sources path was set in the -maven-release instuction, but no sources could be found in {} (base path: {}) \",\n+\t\t\t\tpath, context.getBaseURI()", "originalCommit": "89f8fae035961914613173ec8d5f2ce6df323f12", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bb2fa88ab187513cb6efe02207dc02275f8dbde7", "chunk": "diff --git a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\nindex b5489e946..5449e8d49 100644\n--- a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n+++ b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n\n@@ -300,8 +299,7 @@ public class MavenBndRepository extends BaseRepository implements RepositoryPlug\n \t\tif (path != null && jar == null) {\n \t\t\tlogger.warn(\n \t\t\t\t\"A sources path was set in the -maven-release instuction, but no sources could be found in {} (base path: {}) \",\n-\t\t\t\tpath, context.getBaseURI()\n-\t\t\t\t\t.toString());\n+\t\t\t\tpath, context.getBase());\n \t\t}\n \t\tif (jar != null) {\n \t\t\ttool.setSources(jar, \"\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU3Mjg0MQ==", "url": "https://github.com/bndtools/bnd/pull/3793#discussion_r386572841", "bodyText": "I think the 2nd arg should just be options.context.getBase(). I don't see why we would want to use a URI here. We also should not toString() it in case logging does not happen. Leave the toString() call to the logging code.", "author": "bjhargrave", "createdAt": "2020-03-02T18:35:17Z", "path": "biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java", "diffHunk": "@@ -305,6 +317,12 @@ private Jar getSources(Tool tool, Processor context, String path) throws Excepti\n \tprivate Jar getJavadoc(Tool tool, Processor context, String path, Map<String, String> options, boolean exports)\n \t\tthrows Exception {\n \t\tJar jar = toJar(context, path);\n+\t\tif (path != null && jar == null) {\n+\t\t\tlogger.warn(\n+\t\t\t\t\"A javadoc path was set in the -maven-release instuction, but no javadoc could be found in {} (base path: {}) \",\n+\t\t\t\tpath, context.getBaseURI()", "originalCommit": "89f8fae035961914613173ec8d5f2ce6df323f12", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bb2fa88ab187513cb6efe02207dc02275f8dbde7", "chunk": "diff --git a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\nindex b5489e946..5449e8d49 100644\n--- a/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n+++ b/biz.aQute.repository/src/aQute/bnd/repository/maven/provider/MavenBndRepository.java\n\n@@ -320,8 +318,7 @@ public class MavenBndRepository extends BaseRepository implements RepositoryPlug\n \t\tif (path != null && jar == null) {\n \t\t\tlogger.warn(\n \t\t\t\t\"A javadoc path was set in the -maven-release instuction, but no javadoc could be found in {} (base path: {}) \",\n-\t\t\t\tpath, context.getBaseURI()\n-\t\t\t\t\t.toString());\n+\t\t\t\tpath, context.getBase());\n \t\t}\n \t\tif (jar == null) {\n \t\t\tjar = tool.doJavadoc(options, exports);\n"}}, {"oid": "bb2fa88ab187513cb6efe02207dc02275f8dbde7", "url": "https://github.com/bndtools/bnd/commit/bb2fa88ab187513cb6efe02207dc02275f8dbde7", "message": "Adds a log warning if no sources/javadoc/pom is available\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-03-03T09:44:03Z", "type": "commit"}, {"oid": "bb2fa88ab187513cb6efe02207dc02275f8dbde7", "url": "https://github.com/bndtools/bnd/commit/bb2fa88ab187513cb6efe02207dc02275f8dbde7", "message": "Adds a log warning if no sources/javadoc/pom is available\n\nSigned-off-by: Juergen Albert <j.albert@data-in-motion.biz>", "committedDate": "2020-03-03T09:44:03Z", "type": "forcePushed"}]}