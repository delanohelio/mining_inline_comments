{"pr_number": 3792, "pr_title": "Allow ProjectTester to be called on ProjectLauncher.update", "pr_createdAt": "2020-02-20T04:44:23Z", "pr_url": "https://github.com/bndtools/bnd/pull/3792", "timeline": [{"oid": "b2e4e8baccd05a0662eac05ed4c417c07834f773", "url": "https://github.com/bndtools/bnd/commit/b2e4e8baccd05a0662eac05ed4c417c07834f773", "message": "build: Avoid conflict with launchpad tests\n\nI was seeing failures in launchpad test when this project's test task\nran in parallel with launchpad tests.\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-02-20T04:36:43Z", "type": "commit"}, {"oid": "c7988e355558bcfc83cf35afaab5cd5a531d06fa", "url": "https://github.com/bndtools/bnd/commit/c7988e355558bcfc83cf35afaab5cd5a531d06fa", "message": "launcher: Refactor call to updateFromProject into base class\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-02-20T04:36:44Z", "type": "commit"}, {"oid": "4aa9a81d1a82a0fa043f8bfa5ddbe91d372503bc", "url": "https://github.com/bndtools/bnd/commit/4aa9a81d1a82a0fa043f8bfa5ddbe91d372503bc", "message": "tester: Refactor impl prepare logic into a method\n\nThis is to prepare for the logic to be called for launcher updates.\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-02-20T04:36:44Z", "type": "commit"}, {"oid": "67a96fbb58e69411d154c91656a22d029eecda89", "url": "https://github.com/bndtools/bnd/commit/67a96fbb58e69411d154c91656a22d029eecda89", "message": "launcher: Add a way for tester to be called upon update\n\nThis will allow the tester to make launcher changes upon the launcher\nbeing updated.\n\nFixes https://github.com/bndtools/bnd/issues/3530\n\nSigned-off-by: BJ Hargrave <bj@bjhargrave.com>", "committedDate": "2020-02-20T04:37:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk0OTIwMg==", "url": "https://github.com/bndtools/bnd/pull/3792#discussion_r381949202", "bodyText": "Does this need to be made thread-safe? Or are we assuming/mandating that all calls to update()/onUpdate() are made from the same thread?", "author": "kriegfrj", "createdAt": "2020-02-20T11:45:29Z", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectLauncher.java", "diffHunk": "@@ -61,6 +61,7 @@\n \n \tfinal static Logger\t\t\t\t\tlogger\t\t\t\t= LoggerFactory.getLogger(ProjectLauncher.class);\n \tprivate final Project\t\t\t\tproject;\n+\tprivate final List<Runnable>\t\tonUpdate\t\t\t= new ArrayList<>();", "originalCommit": "67a96fbb58e69411d154c91656a22d029eecda89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk1NTYwNw==", "url": "https://github.com/bndtools/bnd/pull/3792#discussion_r381955607", "bodyText": "There are many other things in the launcher which are not fully thread safe. The calls to onUpdate and update don't need to be on the same thread, there just needs to be some memory barriers between them and there are generally plenty of these. I don't see this as a real problem here now.", "author": "bjhargrave", "createdAt": "2020-02-20T11:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTk0OTIwMg=="}], "type": "inlineReview", "revised_code": null}]}