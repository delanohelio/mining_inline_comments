{"pr_number": 4423, "pr_title": "[projecttracker] Missing bnd files", "pr_createdAt": "2020-11-18T10:48:40Z", "pr_url": "https://github.com/bndtools/bnd/pull/4423", "timeline": [{"oid": "c12e241886d4a6f88a22eb329d07a40bb4212acf", "url": "https://github.com/bndtools/bnd/commit/c12e241886d4a6f88a22eb329d07a40bb4212acf", "message": "[projecttracker] Missing bnd files\n\nThe project tracker (suddenly?) needs bnd files\nto be present in the project. However, if you\ncreate this file, the error is not cleared until the project tracker updates again.\n\nThis patch will force an update if the bnd file exist but it is not in the project tracker.\n\nSigned-off-by: Peter Kriens <Peter.Kriens@aqute.biz>", "committedDate": "2020-11-18T10:40:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526059097", "bodyText": "The ProjectTracker was designed to require an external call to refresh() (from the workspace), to force an update. What has changed to need this new behavior? If there is a change needed, perhaps it should be in the the workspace rather than here?", "author": "bjhargrave", "createdAt": "2020-11-18T12:46:22Z", "path": "biz.aQute.bndlib/src/aQute/bnd/build/ProjectTracker.java", "diffHunk": "@@ -57,6 +57,11 @@ synchronized void refresh() {\n \t */\n \tsynchronized Optional<Project> getProject(String name) {\n \t\tupdate();\n+\t\tif (!models.containsKey(name) && workspace.getFile(name + \"/\" + Project.BNDFILE)", "originalCommit": "c12e241886d4a6f88a22eb329d07a40bb4212acf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA4OTcyOQ==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526089729", "bodyText": "Well, we're not having a tracker on the files, do we?\nI'd like to take this patch and then the people that worked in this area can look. It is terribly annoying since I now have to restart eclipse to get rid of the error.", "author": "pkriens", "createdAt": "2020-11-18T13:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA5ODAzOQ==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526098039", "bodyText": "The ProjectTracker has not really changed since 4.3.0, so I am wondering what has changed elsewhere to trigger whatever issue you are seeing.\nThe genesis of the ProjectTracker was to not always go to disk to see what the projects where. Originall, the workspace always went to disc to see the set of project and you replaced that with the ProjectTracker. A change like this is heading back to checking the file system again.\n\nhen the people that worked in this area can look\n\nWhom do you mean here? The people who worked on the ProjectTracker class (you and me)? Or someone else?\n\nhave to restart eclipse to get rid of the error.\n\nSo this is a Bndtool side error? Perhaps your probelm was caused by #4404 which changed how the BndtoolsBuilder looked for projects and did error markers? That maybe where we need a fix?", "author": "bjhargrave", "createdAt": "2020-11-18T13:45:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjEyNjg1Mg==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526126852", "bodyText": "Well, the problem is genuine, the bnd.bnd file did not exist. So the marker, albeit a bit opaque, is good. However, the fix is to cure this when someone adds the file. It is a PT problem that it does not listen to changes on disk.\nThe project tracker gets a free opportunity to check if it needs to refresh, what on earth is against that?", "author": "pkriens", "createdAt": "2020-11-18T14:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE2MjAwNA==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526162004", "bodyText": "It is a PT problem that it does not listen to changes on disk.\n\nThat was the whole point of ProjectTracker. It was not supposed to listen to the disk. It was supposed to be told externally (via a call to refresh) to recheck the disk. If we want ProjectTracker to follow the disk, we should probably do a more thorough job :-)", "author": "bjhargrave", "createdAt": "2020-11-18T15:09:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE2NzMyNw==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526167327", "bodyText": "You mind if I commit this?", "author": "pkriens", "createdAt": "2020-11-18T15:16:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjE4MTc1Mw==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526181753", "bodyText": "It seems the wrong place to fix things and it can double update, but I don't think it will break anything.", "author": "bjhargrave", "createdAt": "2020-11-18T15:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIwNjA3Mg==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526206072", "bodyText": "Why is the wrong place? Your friend calls you if the mail has arrived. You have no mail on your desk so you tell her \"NO!\". Friend pissed because that mail she is expecting is important to her. Now, since friend asked, isn't that an indication that it actually might have arrived?\nYes, a better solution would be to have a dog that barks at the postman arriving but since we don't have a dog, I would look out of the window if the flag is up on the mailbox before saying NO?\nAnyway, I am going to commit this. I'll add some info to the error and move it to abeyance.", "author": "pkriens", "createdAt": "2020-11-18T16:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjIxMzY2Nw==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526213667", "bodyText": "Why are you making this personal? Please remove personal information from this discussion that has zero to do with the technical issue. Adding personal information is not professional.", "author": "bjhargrave", "createdAt": "2020-11-18T16:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI2MDc2Nw==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526260767", "bodyText": "ok, removed personal, but it was a good illustration", "author": "pkriens", "createdAt": "2020-11-18T17:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU2OTc5NA==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526569794", "bodyText": "I think that in the context of Bndtools, the correct program flow is for Bndtools to do the file watching (using a ResourceChangeListener)  and for this listener to call ProjectTracker.refresh() if necessary. That is how Bndtools reacts to most other changes on the file system, so I don't see why this should be any different. You might have to manually refresh the project if you create the bnd.bnd file outside of Eclipse, but other than that it should work. Just my 2c.", "author": "kriegfrj", "createdAt": "2020-11-19T03:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY0MTYwNQ==", "url": "https://github.com/bndtools/bnd/pull/4423#discussion_r526641605", "bodyText": "@kriegfrj that is why I moved it to abyeance. I agree that is the gold standard but I do not have time and this is at least handling an important use case.", "author": "pkriens", "createdAt": "2020-11-19T07:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA1OTA5Nw=="}], "type": "inlineReview", "revised_code": null}]}