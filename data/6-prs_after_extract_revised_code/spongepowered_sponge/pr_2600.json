{"pr_number": 2600, "pr_title": "Ensure default permissions are used with some wrapped subjects", "pr_createdAt": "2020-05-06T18:09:47Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/2600", "timeline": [{"oid": "c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a", "url": "https://github.com/SpongePowered/Sponge/commit/c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a", "message": "Ensure default permissions are used with some wrapped subjects\n\nFixes #2599", "committedDate": "2020-05-06T18:04:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5NDI3MQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2600#discussion_r420994271", "bodyText": "Point of discussion: I feel like maybe I don't need to, or worse, shouldn't check for this. A ProxySource might define its own hasPermission et. al. checks - we just know SpongeProxySource doesn't. Does it make sense to remove this?", "author": "dualspiral", "createdAt": "2020-05-06T18:13:59Z", "path": "src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java", "diffHunk": "@@ -93,4 +96,24 @@ public SubjectData getSubjectData() {\n     public MemorySubjectData getTransientSubjectData() {\n         return this.opLevelData;\n     }\n+\n+    @Override\n+    public boolean hasPermission(Set<Context> contexts, String permission) {\n+        final Tristate value = getPermissionValue(contexts, permission);\n+        if (value == Tristate.UNDEFINED) {\n+            Subject target = this.delegate;\n+            while (target instanceof ProxySource) {\n+                if (target instanceof SpongeProxySource) {\n+                    target = ((SpongeProxySource) target).getSubjectDelegate();\n+                } else {\n+                    target = ((ProxySource) target).getOriginalSource();", "originalCommit": "c88c00dd5d68a338a55c07ee34f4e7098d5cdd2a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ce7400836f1dc030f7f9f84583954ab9df5f1e30", "chunk": "diff --git a/src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java b/src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java\nindex 34672d1a7..535703702 100644\n--- a/src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java\n+++ b/src/main/java/org/spongepowered/common/command/AndPermissionLevelSubject.java\n\n@@ -102,12 +102,8 @@ public boolean hasPermission(Set<Context> contexts, String permission) {\n         final Tristate value = getPermissionValue(contexts, permission);\n         if (value == Tristate.UNDEFINED) {\n             Subject target = this.delegate;\n-            while (target instanceof ProxySource) {\n-                if (target instanceof SpongeProxySource) {\n-                    target = ((SpongeProxySource) target).getSubjectDelegate();\n-                } else {\n-                    target = ((ProxySource) target).getOriginalSource();\n-                }\n+            while (target instanceof SpongeProxySource) {\n+                target = ((SpongeProxySource) target).getSubjectDelegate();\n             }\n             if (target instanceof SubjectBridge) {\n                 return ((SubjectBridge) target).bridge$permDefault(permission).asBoolean();\n"}}, {"oid": "ce7400836f1dc030f7f9f84583954ab9df5f1e30", "url": "https://github.com/SpongePowered/Sponge/commit/ce7400836f1dc030f7f9f84583954ab9df5f1e30", "message": "Yep, gonna go with this...", "committedDate": "2020-05-06T19:14:40Z", "type": "commit"}]}