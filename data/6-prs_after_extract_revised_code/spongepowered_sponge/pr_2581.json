{"pr_number": 2581, "pr_title": "Improve vanish", "pr_createdAt": "2020-04-24T18:35:14Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/2581", "timeline": [{"oid": "eaa857941a03a90c2a7ac9b84152657faa884b70", "url": "https://github.com/SpongePowered/Sponge/commit/eaa857941a03a90c2a7ac9b84152657faa884b70", "message": "Vanish doesn't affect spawning", "committedDate": "2020-04-24T16:29:10Z", "type": "commit"}, {"oid": "06ce9afc206730e09689b9b711fd5f67e8f5f7d2", "url": "https://github.com/SpongePowered/Sponge/commit/06ce9afc206730e09689b9b711fd5f67e8f5f7d2", "message": "Fix uncollideable entities colliding with other entities", "committedDate": "2020-04-24T17:08:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NTIyOQ==", "url": "https://github.com/SpongePowered/Sponge/pull/2581#discussion_r414785229", "bodyText": "Should this depend on VANISH_IGNORES_COLLISION?", "author": "dualspiral", "createdAt": "2020-04-24T18:40:00Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java", "diffHunk": "@@ -361,6 +363,14 @@ public void onDeath(final DamageSource cause) {\n         this.setFlag(0, false);\n     }\n \n+    @Redirect(method = \"onLivingUpdate\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/World;getEntitiesWithinAABBExcludingEntity(Lnet/minecraft/entity/Entity;Lnet/minecraft/util/math/AxisAlignedBB;)Ljava/util/List;\"))\n+    private List<Entity> onSpongeGetEntitiesWithinAABBExcludingEntity(final World world, Entity entityIn, AxisAlignedBB bb) {\n+        if (this.bridge$isUncollideable()) {", "originalCommit": "06ce9afc206730e09689b9b711fd5f67e8f5f7d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4OTQyNA==", "url": "https://github.com/SpongePowered/Sponge/pull/2581#discussion_r414789424", "bodyText": "VANISH_IGNORES_COLLISION is calling bridge$isUncollideable and bridge$setUncollideable\nhttps://github.com/SpongePowered/SpongeCommon/blob/9be33cf2c38e66fe8ac774503ef88f0b33d51faa/src/main/java/org/spongepowered/common/data/processor/multi/entity/InvisibilityDataProcessor.java#L66\nhttps://github.com/SpongePowered/SpongeCommon/blob/9be33cf2c38e66fe8ac774503ef88f0b33d51faa/src/main/java/org/spongepowered/common/data/processor/multi/entity/InvisibilityDataProcessor.java#L84", "author": "ImMorpheus", "createdAt": "2020-04-24T18:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NTIyOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NzEyOA==", "url": "https://github.com/SpongePowered/Sponge/pull/2581#discussion_r414787128", "bodyText": "If a player is targetable becuase VANISH_PREVENTS_TARGETING is false, should spawning also be unaffected?", "author": "dualspiral", "createdAt": "2020-04-24T18:43:06Z", "path": "src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java", "diffHunk": "@@ -391,7 +401,7 @@ private void spongePlaySound(final World world, final EntityPlayer player, final\n \n     @Override\n     public boolean bridge$affectsSpawning() {\n-        return this.affectsSpawning && !this.isSpectator();\n+        return this.affectsSpawning && !this.isSpectator() && !this.bridge$isVanished();", "originalCommit": "06ce9afc206730e09689b9b711fd5f67e8f5f7d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc5MDExMA==", "url": "https://github.com/SpongePowered/Sponge/pull/2581#discussion_r414790110", "bodyText": "good point, I'll change that", "author": "ImMorpheus", "createdAt": "2020-04-24T18:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc4NzEyOA=="}], "type": "inlineReview", "revised_code": {"commit": "fa8dfe67ffad416e805259bebb4871f011601539", "chunk": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java b/src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java\nindex aba71339a..56ec06bc8 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/entity/player/EntityPlayerMixin.java\n\n@@ -401,7 +401,7 @@ private void spongePlaySound(final World world, final EntityPlayer player, final\n \n     @Override\n     public boolean bridge$affectsSpawning() {\n-        return this.affectsSpawning && !this.isSpectator() && !this.bridge$isVanished();\n+        return this.affectsSpawning && !this.isSpectator() && !this.bridge$isUntargetable();\n     }\n \n     @Override\n"}}, {"oid": "fa8dfe67ffad416e805259bebb4871f011601539", "url": "https://github.com/SpongePowered/Sponge/commit/fa8dfe67ffad416e805259bebb4871f011601539", "message": "Only untargetable players don't affect spawning", "committedDate": "2020-04-24T18:51:30Z", "type": "commit"}]}