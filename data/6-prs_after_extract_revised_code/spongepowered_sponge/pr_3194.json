{"pr_number": 3194, "pr_title": "Fix case-sensitivity bug in SpongeUserStorageService#match(String)", "pr_createdAt": "2020-10-30T23:16:43Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/3194", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ0MDY0Nw==", "url": "https://github.com/SpongePowered/Sponge/pull/3194#discussion_r515440647", "bodyText": "You're changing this from immediately breaking out of optional-world to being half optional-style and half not.\nEither do something like name.get().toLowerCase(Locale.ROOT).startsWith(lastKnownName), or continue the Optional chain so it terminates with an orElse(false), removing any use of isPresent or get.", "author": "zml2008", "createdAt": "2020-10-31T01:38:27Z", "path": "src/main/java/org/spongepowered/common/service/user/SpongeUserStorageService.java", "diffHunk": "@@ -113,7 +113,8 @@ public boolean delete(User user) {\n         Collection<GameProfile> allProfiles = UserDiscoverer.getAllProfiles();\n         Collection<GameProfile> matching = Sets.newHashSet();\n         for (GameProfile profile : allProfiles) {\n-            if (profile.getName().isPresent() && profile.getName().get().startsWith(lastKnownName)) {\n+            Optional<String> name = profile.getName().map(n -> n.toLowerCase(Locale.ROOT));\n+            if (name.isPresent() && name.get().startsWith(lastKnownName)) {", "originalCommit": "5503f3b353a9dab257dd16d029b05cf97715370f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ2MDY4MA==", "url": "https://github.com/SpongePowered/Sponge/pull/3194#discussion_r515460680", "bodyText": "Initially I was going to continue with .filter(n -> n.startsWith(lastKnownName)) but variables in the lambda need to be effectively final. I'll just change it to the first option you suggested.", "author": "alexstaeding", "createdAt": "2020-10-31T05:58:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ0MDY0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "8fa48ca4fc8f89f3f0e96adbb83302ecf0d76dfd", "chunk": "diff --git a/src/main/java/org/spongepowered/common/service/user/SpongeUserStorageService.java b/src/main/java/org/spongepowered/common/service/user/SpongeUserStorageService.java\nindex 8582c58a5..ae7f54626 100644\n--- a/src/main/java/org/spongepowered/common/service/user/SpongeUserStorageService.java\n+++ b/src/main/java/org/spongepowered/common/service/user/SpongeUserStorageService.java\n\n@@ -113,8 +113,8 @@ public boolean delete(User user) {\n         Collection<GameProfile> allProfiles = UserDiscoverer.getAllProfiles();\n         Collection<GameProfile> matching = Sets.newHashSet();\n         for (GameProfile profile : allProfiles) {\n-            Optional<String> name = profile.getName().map(n -> n.toLowerCase(Locale.ROOT));\n-            if (name.isPresent() && name.get().startsWith(lastKnownName)) {\n+            Optional<String> name = profile.getName();\n+            if (name.isPresent() && name.get().toLowerCase(Locale.ROOT).startsWith(lastKnownName)) {\n                 matching.add(profile);\n             }\n         }\n"}}, {"oid": "8fa48ca4fc8f89f3f0e96adbb83302ecf0d76dfd", "url": "https://github.com/SpongePowered/Sponge/commit/8fa48ca4fc8f89f3f0e96adbb83302ecf0d76dfd", "message": "Convert GameProfile names to lowercase before comparing with lowercase lastKnownName", "committedDate": "2020-10-31T12:00:40Z", "type": "commit"}, {"oid": "8fa48ca4fc8f89f3f0e96adbb83302ecf0d76dfd", "url": "https://github.com/SpongePowered/Sponge/commit/8fa48ca4fc8f89f3f0e96adbb83302ecf0d76dfd", "message": "Convert GameProfile names to lowercase before comparing with lowercase lastKnownName", "committedDate": "2020-10-31T12:00:40Z", "type": "forcePushed"}]}