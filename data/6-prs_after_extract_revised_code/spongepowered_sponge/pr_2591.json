{"pr_number": 2591, "pr_title": "Fix tileentitysign memory leak", "pr_createdAt": "2020-05-02T14:22:40Z", "pr_url": "https://github.com/SpongePowered/Sponge/pull/2591", "timeline": [{"oid": "8d87b7938287b24b4e75e3fb26eae2098d8e1466", "url": "https://github.com/SpongePowered/Sponge/commit/8d87b7938287b24b4e75e3fb26eae2098d8e1466", "message": "Fix tileentitysign memory leak", "committedDate": "2020-05-02T14:17:33Z", "type": "commit"}, {"oid": "b7c6a21f16809163ca0d67f6296c5ec120d545de", "url": "https://github.com/SpongePowered/Sponge/commit/b7c6a21f16809163ca0d67f6296c5ec120d545de", "message": "Use local variables", "committedDate": "2020-05-02T14:39:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk2NjM0NA==", "url": "https://github.com/SpongePowered/Sponge/pull/2591#discussion_r418966344", "bodyText": "Why not just redirect tileEntitySign.markDirty() and call tileEntitySign.setPlayer(null) there? Better than relying on local capture.", "author": "dualspiral", "createdAt": "2020-05-02T14:39:40Z", "path": "src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java", "diffHunk": "@@ -270,6 +271,13 @@\n         return ZERO_LENGTH_ARRAY; // will bypass the for loop after this method.\n     }\n \n+    @Inject(method = \"processUpdateSign\", locals = LocalCapture.CAPTURE_FAILHARD,\n+            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/WorldServer;notifyBlockUpdate(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/block/state/IBlockState;I)V\"))\n+    private void impl$setPlayer(CPacketUpdateSign packetIn, final CallbackInfo ci, WorldServer worldserver,", "originalCommit": "b7c6a21f16809163ca0d67f6296c5ec120d545de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk2NzY5NA==", "url": "https://github.com/SpongePowered/Sponge/pull/2591#discussion_r418967694", "bodyText": "Done", "author": "ImMorpheus", "createdAt": "2020-05-02T14:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk2NjM0NA=="}], "type": "inlineReview", "revised_code": {"commit": "0f7e159cda64a746544adbcd543f31e0da86c63a", "chunk": "diff --git a/src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java b/src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java\nindex 0ce283c0e..542fcdcaf 100644\n--- a/src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java\n+++ b/src/main/java/org/spongepowered/common/mixin/core/network/NetHandlerPlayServerMixin.java\n\n@@ -271,11 +271,9 @@\n         return ZERO_LENGTH_ARRAY; // will bypass the for loop after this method.\n     }\n \n-    @Inject(method = \"processUpdateSign\", locals = LocalCapture.CAPTURE_FAILHARD,\n-            at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/world/WorldServer;notifyBlockUpdate(Lnet/minecraft/util/math/BlockPos;Lnet/minecraft/block/state/IBlockState;Lnet/minecraft/block/state/IBlockState;I)V\"))\n-    private void impl$setPlayer(CPacketUpdateSign packetIn, final CallbackInfo ci, WorldServer worldserver,\n-                                BlockPos blockpos, IBlockState iblockstate, TileEntity tileentitysign) {\n-        ((TileEntitySign) tileentitysign).setPlayer(null);\n+    @Redirect(method = \"processUpdateSign\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/tileentity/TileEntitySign;markDirty()V\"))\n+    private void impl$setPlayer(TileEntitySign tileentitysign) {\n+        tileentitysign.setPlayer(null);\n     }\n \n     /**\n"}}, {"oid": "0f7e159cda64a746544adbcd543f31e0da86c63a", "url": "https://github.com/SpongePowered/Sponge/commit/0f7e159cda64a746544adbcd543f31e0da86c63a", "message": "Switch to redirect", "committedDate": "2020-05-02T14:53:50Z", "type": "commit"}, {"oid": "0effdc985357c1cb6391fbbc379afa12c51e822a", "url": "https://github.com/SpongePowered/Sponge/commit/0effdc985357c1cb6391fbbc379afa12c51e822a", "message": "You didn't see this", "committedDate": "2020-05-02T15:19:43Z", "type": "commit"}]}