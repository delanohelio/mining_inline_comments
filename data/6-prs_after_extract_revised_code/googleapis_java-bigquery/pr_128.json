{"pr_number": 128, "pr_title": "feat: add debug statement to StandardTableDefinition", "pr_createdAt": "2020-01-27T20:36:28Z", "pr_url": "https://github.com/googleapis/java-bigquery/pull/128", "timeline": [{"oid": "32245c7ddc4c9738f06418048e90fb1cabb592aa", "url": "https://github.com/googleapis/java-bigquery/commit/32245c7ddc4c9738f06418048e90fb1cabb592aa", "message": "chore: add debug statement to StandardTableDefinition", "committedDate": "2020-01-27T20:35:59Z", "type": "commit"}, {"oid": "683220e4e45fc89baaa622c9486fe456be956b56", "url": "https://github.com/googleapis/java-bigquery/commit/683220e4e45fc89baaa622c9486fe456be956b56", "message": "update to include cause", "committedDate": "2020-01-27T20:58:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ3OTA5Ng==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371479096", "bodyText": "Is this considered a breaking change? If not, let's be more specific with IllegalArgumentException, NullPointerException.", "author": "tswast", "createdAt": "2020-01-27T20:59:36Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java", "diffHunk": "@@ -263,7 +263,7 @@ Table toPb() {\n   }\n \n   @SuppressWarnings(\"unchecked\")\n-  static StandardTableDefinition fromPb(Table tablePb) {\n+  static StandardTableDefinition fromPb(Table tablePb) throws Throwable {", "originalCommit": "683220e4e45fc89baaa622c9486fe456be956b56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f18fb161bddb3bab26fc19ca90f8e146cbacac3", "chunk": "diff --git a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\nindex 48965ad..efc7e47 100644\n--- a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n+++ b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n\n@@ -263,7 +263,7 @@ public abstract class StandardTableDefinition extends TableDefinition {\n   }\n \n   @SuppressWarnings(\"unchecked\")\n-  static StandardTableDefinition fromPb(Table tablePb) throws Throwable {\n+  static StandardTableDefinition fromPb(Table tablePb) {\n     Builder builder = newBuilder().table(tablePb);\n     if (tablePb.getNumRows() != null) {\n       builder.setNumRows(tablePb.getNumRows().longValue());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ3OTY3Nw==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371479677", "bodyText": "Ditto. I'm concerned that this might be a breaking change. I guess it's okay since it's protected?\nLet's be more specific than \"Throwable\" and use IllegalArgumentException, NullPointerException.", "author": "tswast", "createdAt": "2020-01-27T21:00:40Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/TableDefinition.java", "diffHunk": "@@ -145,7 +146,7 @@ Table toPb() {\n   }\n \n   @SuppressWarnings(\"unchecked\")\n-  static <T extends TableDefinition> T fromPb(Table tablePb) {\n+  static <T extends TableDefinition> T fromPb(Table tablePb) throws IOException, Throwable {", "originalCommit": "683220e4e45fc89baaa622c9486fe456be956b56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f18fb161bddb3bab26fc19ca90f8e146cbacac3", "chunk": "diff --git a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/TableDefinition.java b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/TableDefinition.java\nindex ecc54b1..75d4bf4 100644\n--- a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/TableDefinition.java\n+++ b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/TableDefinition.java\n\n@@ -146,7 +145,7 @@ public abstract class TableDefinition implements Serializable {\n   }\n \n   @SuppressWarnings(\"unchecked\")\n-  static <T extends TableDefinition> T fromPb(Table tablePb) throws IOException, Throwable {\n+  static <T extends TableDefinition> T fromPb(Table tablePb) {\n     switch (Type.valueOf(tablePb.getType()).toString()) {\n       case \"TABLE\":\n         return (T) StandardTableDefinition.fromPb(tablePb);\n"}}, {"oid": "7f18fb161bddb3bab26fc19ca90f8e146cbacac3", "url": "https://github.com/googleapis/java-bigquery/commit/7f18fb161bddb3bab26fc19ca90f8e146cbacac3", "message": "remove changes to method headers", "committedDate": "2020-01-27T21:18:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MjI4Mw==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371492283", "bodyText": "Are we expecting to get errors when constructing the exception?", "author": "tswast", "createdAt": "2020-01-27T21:28:47Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java", "diffHunk": "@@ -272,7 +272,27 @@ static StandardTableDefinition fromPb(Table tablePb) {\n       builder.setStreamingBuffer(StreamingBuffer.fromPb(tablePb.getStreamingBuffer()));\n     }\n     if (tablePb.getTimePartitioning() != null) {\n-      builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      try {\n+        builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      } catch (IllegalArgumentException e) {\n+        throw new IllegalArgumentException(\n+            \"Got unexpected time partitioning \"\n+                + tablePb.getTimePartitioning()\n+                + \" in table \"\n+                + tablePb.getTableReference(),\n+            e);\n+      } catch (NullPointerException e) {\n+        try {\n+          throw new NullPointerException(\n+                  \"Got unexpected time partitioning \"\n+                      + tablePb.getTimePartitioning()\n+                      + \" in table \"\n+                      + tablePb.getTableReference())\n+              .initCause(e);\n+        } catch (Throwable throwable) {\n+          throwable.printStackTrace();", "originalCommit": "7f18fb161bddb3bab26fc19ca90f8e146cbacac3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MjUzOA==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371492538", "bodyText": "Or is this due to the initCause? If so, let's add a comment.", "author": "tswast", "createdAt": "2020-01-27T21:29:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MjI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTUwMzc1MQ==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371503751", "bodyText": "due to initCause - added comment", "author": "stephaniewang526", "createdAt": "2020-01-27T21:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MjI4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1NjUzMg==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371856532", "bodyText": "No - this is for .initiCause", "author": "stephaniewang526", "createdAt": "2020-01-28T15:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5MjI4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "a1441c0f0999d4a048b07b34a3794b042cbc15fa", "chunk": "diff --git a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\nindex efc7e47..f6c4541 100644\n--- a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n+++ b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n\n@@ -289,6 +289,7 @@ public abstract class StandardTableDefinition extends TableDefinition {\n                       + \" in table \"\n                       + tablePb.getTableReference())\n               .initCause(e);\n+          //catching Throwable due to adding initCause\n         } catch (Throwable throwable) {\n           throwable.printStackTrace();\n         }\n"}}, {"oid": "a1441c0f0999d4a048b07b34a3794b042cbc15fa", "url": "https://github.com/googleapis/java-bigquery/commit/a1441c0f0999d4a048b07b34a3794b042cbc15fa", "message": "update base on comment", "committedDate": "2020-01-27T21:53:04Z", "type": "commit"}, {"oid": "c3aeac4b84a5a669b2c6b95fa4ec79abde3c451b", "url": "https://github.com/googleapis/java-bigquery/commit/c3aeac4b84a5a669b2c6b95fa4ec79abde3c451b", "message": "adding testcase", "committedDate": "2020-01-28T16:10:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTkwOTgwNQ==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r371909805", "bodyText": "use try/catch and assert.fail()", "author": "pmakani", "createdAt": "2020-01-28T16:24:01Z", "path": "google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/StandardTableDefinitionTest.java", "diffHunk": "@@ -118,6 +125,12 @@ public void testToAndFromPb() {\n         definition, TableDefinition.<StandardTableDefinition>fromPb(definition.toPb()));\n   }\n \n+  @Test(expected = IllegalArgumentException.class)\n+  public void testInvalidTableDef() {\n+    // not supposed to have this time partitioning type\n+    StandardTableDefinition.fromPb(INVALID_TABLE_DEFINITION.toPb());\n+  }\n+", "originalCommit": "c3aeac4b84a5a669b2c6b95fa4ec79abde3c451b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0215d2c1416fee1cd9ce088f4e7899a6c70b24c0", "chunk": "diff --git a/google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/StandardTableDefinitionTest.java b/google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/StandardTableDefinitionTest.java\nindex d5add6d..d1dd0cc 100644\n--- a/google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/StandardTableDefinitionTest.java\n+++ b/google-cloud-bigquery/src/test/java/com/google/cloud/bigquery/StandardTableDefinitionTest.java\n\n@@ -125,10 +124,60 @@ public class StandardTableDefinitionTest {\n         definition, TableDefinition.<StandardTableDefinition>fromPb(definition.toPb()));\n   }\n \n-  @Test(expected = IllegalArgumentException.class)\n-  public void testInvalidTableDef() {\n-    // not supposed to have this time partitioning type\n-    StandardTableDefinition.fromPb(INVALID_TABLE_DEFINITION.toPb());\n+  @Test\n+  public void testFromPbWithUnexpectedTimePartitioningTypeRaisesInvalidArgumentException() {\n+    Table invalidTable =\n+        new Table()\n+            .setType(\"TABLE\")\n+            .setTableReference(\n+                new TableReference()\n+                    .setProjectId(\"ILLEGAL_ARG_TEST_PROJECT\")\n+                    .setDatasetId(\"ILLEGAL_ARG_TEST_DATASET\")\n+                    .setTableId(\"ILLEGAL_ARG_TEST_TABLE\"))\n+            .setTimePartitioning(\n+                new com.google.api.services.bigquery.model.TimePartitioning().setType(\"GHURRY\"));\n+    try {\n+      StandardTableDefinition.fromPb(invalidTable);\n+    } catch (IllegalArgumentException ie) {\n+      assertThat(\n+          ie.getMessage(),\n+          allOf(\n+              containsString(\"Illegal Argument - Got unexpected time partitioning\"),\n+              containsString(\"GHURRY\"),\n+              containsString(\"ILLEGAL_ARG_TEST_PROJECT\"),\n+              containsString(\"ILLEGAL_ARG_TEST_DATASET\"),\n+              containsString(\"ILLEGAL_ARG_TEST_TABLE\")));\n+      return;\n+    }\n+    fail(\"testFromPb illegal argument exception did not throw!\");\n+  }\n+\n+  @Test\n+  public void testFromPbWithNullTimePartitioningTypeRaisesNullPointerException() {\n+    Table invalidTable =\n+        new Table()\n+            .setType(\"TABLE\")\n+            .setTableReference(\n+                new TableReference()\n+                    .setProjectId(\"NULL_PTR_TEST_PROJECT\")\n+                    .setDatasetId(\"NULL_PTR_TEST_DATASET\")\n+                    .setTableId(\"NULL_PTR_TEST_TABLE\"))\n+            .setTimePartitioning(\n+                new com.google.api.services.bigquery.model.TimePartitioning().setType(null));\n+    try {\n+      StandardTableDefinition.fromPb(invalidTable);\n+    } catch (NullPointerException ne) {\n+      assertThat(\n+          ne.getMessage(),\n+          allOf(\n+              containsString(\"Null pointer - Got unexpected time partitioning\"),\n+              containsString(\"null\"),\n+              containsString(\"NULL_PTR_TEST_PROJECT\"),\n+              containsString(\"NULL_PTR_TEST_DATASET\"),\n+              containsString(\"NULL_PTR_TEST_TABLE\")));\n+      return;\n+    }\n+    fail(\"testFromPb null pointer exception did not throw!\");\n   }\n \n   @Test\n"}}, {"oid": "0215d2c1416fee1cd9ce088f4e7899a6c70b24c0", "url": "https://github.com/googleapis/java-bigquery/commit/0215d2c1416fee1cd9ce088f4e7899a6c70b24c0", "message": "adding testcases", "committedDate": "2020-01-28T21:57:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzI0Mg==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r372087242", "bodyText": "Actually, can we output the whole timePartitioning pretty-printed to a string?", "author": "tswast", "createdAt": "2020-01-28T22:10:37Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java", "diffHunk": "@@ -272,7 +272,31 @@ static StandardTableDefinition fromPb(Table tablePb) {\n       builder.setStreamingBuffer(StreamingBuffer.fromPb(tablePb.getStreamingBuffer()));\n     }\n     if (tablePb.getTimePartitioning() != null) {\n-      builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      try {\n+        builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      } catch (IllegalArgumentException e) {\n+        throw new IllegalArgumentException(\n+            \"Illegal Argument - Got unexpected time partitioning \"\n+                + tablePb.getTimePartitioning().getType()", "originalCommit": "0215d2c1416fee1cd9ce088f4e7899a6c70b24c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzMzOA==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r372087338", "bodyText": "That'll give us a little more context", "author": "tswast", "createdAt": "2020-01-28T22:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA5NDQ4Mw==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r372094483", "bodyText": "changing to using toString()", "author": "stephaniewang526", "createdAt": "2020-01-28T22:28:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzI0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b1f0c8cd01ed59ab8bd5e57ef56cd674319c420b", "chunk": "diff --git a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\nindex 8504fdd..1c46534 100644\n--- a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n+++ b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n\n@@ -277,7 +277,7 @@ public abstract class StandardTableDefinition extends TableDefinition {\n       } catch (IllegalArgumentException e) {\n         throw new IllegalArgumentException(\n             \"Illegal Argument - Got unexpected time partitioning \"\n-                + tablePb.getTimePartitioning().getType()\n+                + tablePb.getTimePartitioning().toString()\n                 + \" in project \"\n                 + tablePb.getTableReference().getProjectId()\n                 + \" in dataset \"\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzU2MA==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r372087560", "bodyText": "Same here. Let's call getTimePartitioning().toPrettyString()", "author": "tswast", "createdAt": "2020-01-28T22:11:21Z", "path": "google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java", "diffHunk": "@@ -272,7 +272,31 @@ static StandardTableDefinition fromPb(Table tablePb) {\n       builder.setStreamingBuffer(StreamingBuffer.fromPb(tablePb.getStreamingBuffer()));\n     }\n     if (tablePb.getTimePartitioning() != null) {\n-      builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      try {\n+        builder.setTimePartitioning(TimePartitioning.fromPb(tablePb.getTimePartitioning()));\n+      } catch (IllegalArgumentException e) {\n+        throw new IllegalArgumentException(\n+            \"Illegal Argument - Got unexpected time partitioning \"\n+                + tablePb.getTimePartitioning().getType()\n+                + \" in project \"\n+                + tablePb.getTableReference().getProjectId()\n+                + \" in dataset \"\n+                + tablePb.getTableReference().getDatasetId()\n+                + \" in table \"\n+                + tablePb.getTableReference().getTableId(),\n+            e);\n+      } catch (NullPointerException e) {\n+        throw new NullPointerException(\n+            \"Null pointer - Got unexpected time partitioning \"\n+                + tablePb.getTimePartitioning().getType()", "originalCommit": "0215d2c1416fee1cd9ce088f4e7899a6c70b24c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA5NDY3Ng==", "url": "https://github.com/googleapis/java-bigquery/pull/128#discussion_r372094676", "bodyText": "changing to using toString() since toPrettyString calls for adding IOException to method signature", "author": "stephaniewang526", "createdAt": "2020-01-28T22:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjA4NzU2MA=="}], "type": "inlineReview", "revised_code": {"commit": "b1f0c8cd01ed59ab8bd5e57ef56cd674319c420b", "chunk": "diff --git a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\nindex 8504fdd..1c46534 100644\n--- a/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n+++ b/google-cloud-bigquery/src/main/java/com/google/cloud/bigquery/StandardTableDefinition.java\n\n@@ -277,7 +277,7 @@ public abstract class StandardTableDefinition extends TableDefinition {\n       } catch (IllegalArgumentException e) {\n         throw new IllegalArgumentException(\n             \"Illegal Argument - Got unexpected time partitioning \"\n-                + tablePb.getTimePartitioning().getType()\n+                + tablePb.getTimePartitioning().toString()\n                 + \" in project \"\n                 + tablePb.getTableReference().getProjectId()\n                 + \" in dataset \"\n"}}, {"oid": "b901f96e6ba047437651725df3b1613a9687d984", "url": "https://github.com/googleapis/java-bigquery/commit/b901f96e6ba047437651725df3b1613a9687d984", "message": "fix test dep build error\n\n[WARNING] Used undeclared dependencies found:\n[WARNING]    org.hamcrest:hamcrest-core:jar:1.3:test", "committedDate": "2020-01-28T22:14:24Z", "type": "commit"}, {"oid": "b1f0c8cd01ed59ab8bd5e57ef56cd674319c420b", "url": "https://github.com/googleapis/java-bigquery/commit/b1f0c8cd01ed59ab8bd5e57ef56cd674319c420b", "message": "update to add more info", "committedDate": "2020-01-28T22:28:59Z", "type": "commit"}]}