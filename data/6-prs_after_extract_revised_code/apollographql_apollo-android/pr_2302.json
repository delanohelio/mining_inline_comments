{"pr_number": 2302, "pr_title": "[Runtime] add ApolloClient.applicationInterceptorFactories()", "pr_createdAt": "2020-05-25T09:38:49Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/2302", "timeline": [{"oid": "517c66ae86fbb9bbed97e2d8d81dd5c2f9c54b0c", "url": "https://github.com/apollographql/apollo-android/commit/517c66ae86fbb9bbed97e2d8d81dd5c2f9c54b0c", "message": "add ApolloClient.applicationInterceptorFactories()\n\ncloses #2285", "committedDate": "2020-05-25T09:38:02Z", "type": "commit"}, {"oid": "171c8045eb8cff6702eaff1a0f6eeb626dc7d0ed", "url": "https://github.com/apollographql/apollo-android/commit/171c8045eb8cff6702eaff1a0f6eeb626dc7d0ed", "message": "fix javadoc", "committedDate": "2020-05-25T09:41:17Z", "type": "commit"}, {"oid": "a19bf0a0aafc9ca82c7e583e08f5df8feb6fdfb2", "url": "https://github.com/apollographql/apollo-android/commit/a19bf0a0aafc9ca82c7e583e08f5df8feb6fdfb2", "message": "fix checkstyle", "committedDate": "2020-05-25T10:06:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMTU3OA==", "url": "https://github.com/apollographql/apollo-android/pull/2302#discussion_r430701578", "bodyText": "I wonder if this check is something we should do earlier in ApolloClient.Builder.build() method.", "author": "tasomaniac", "createdAt": "2020-05-26T20:53:32Z", "path": "apollo-runtime/src/main/java/com/apollographql/apollo/internal/RealApolloCall.java", "diffHunk": "@@ -375,7 +380,18 @@ private ApolloInterceptorChain prepareInterceptorChain(Operation operation) {\n     HttpCachePolicy.Policy httpCachePolicy = operation instanceof Query ? this.httpCachePolicy : null;\n     ResponseFieldMapper responseFieldMapper = responseFieldMapperFactory.create(operation);\n \n-    List<ApolloInterceptor> interceptors = new ArrayList<>(applicationInterceptors);\n+    List<ApolloInterceptor> interceptors = new ArrayList<>();\n+\n+    if (!applicationInterceptorFactories.isEmpty() && !applicationInterceptors.isEmpty()) {\n+      throw new IllegalArgumentException(\"You can either use applicationInterceptors or applicationInterceptorFactories \"", "originalCommit": "a19bf0a0aafc9ca82c7e583e08f5df8feb6fdfb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAxODE2MQ==", "url": "https://github.com/apollographql/apollo-android/pull/2302#discussion_r431018161", "bodyText": "Yep, definitely. I put it in the ApolloClient constructor. I don't think anyone uses that directly but better safe than sorry.", "author": "martinbonnin", "createdAt": "2020-05-27T10:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwMTU3OA=="}], "type": "inlineReview", "revised_code": {"commit": "6fb17bcc14c018f3befec0fb4aa39834ef9bb148", "chunk": "diff --git a/apollo-runtime/src/main/java/com/apollographql/apollo/internal/RealApolloCall.java b/apollo-runtime/src/main/java/com/apollographql/apollo/internal/RealApolloCall.java\nindex b01f1d3c2..4db24ed80 100644\n--- a/apollo-runtime/src/main/java/com/apollographql/apollo/internal/RealApolloCall.java\n+++ b/apollo-runtime/src/main/java/com/apollographql/apollo/internal/RealApolloCall.java\n\n@@ -382,11 +382,6 @@ public final class RealApolloCall<T> implements ApolloQueryCall<T>, ApolloMutati\n \n     List<ApolloInterceptor> interceptors = new ArrayList<>();\n \n-    if (!applicationInterceptorFactories.isEmpty() && !applicationInterceptors.isEmpty()) {\n-      throw new IllegalArgumentException(\"You can either use applicationInterceptors or applicationInterceptorFactories \"\n-          + \"but not both at the same time.\");\n-    }\n-\n     for (ApolloInterceptorFactory factory : applicationInterceptorFactories) {\n       interceptors.add(factory.newInterceptor());\n     }\n"}}, {"oid": "6fb17bcc14c018f3befec0fb4aa39834ef9bb148", "url": "https://github.com/apollographql/apollo-android/commit/6fb17bcc14c018f3befec0fb4aa39834ef9bb148", "message": "move the check earlier in ApolloClient", "committedDate": "2020-05-27T10:27:08Z", "type": "commit"}]}