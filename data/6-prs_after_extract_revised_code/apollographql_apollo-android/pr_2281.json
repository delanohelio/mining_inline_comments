{"pr_number": 2281, "pr_title": "Prevent incorrect caching of partial responses with errors.", "pr_createdAt": "2020-05-18T19:09:53Z", "pr_url": "https://github.com/apollographql/apollo-android/pull/2281", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzk1MA==", "url": "https://github.com/apollographql/apollo-android/pull/2281#discussion_r427713950", "bodyText": "is there a reason this file updated?", "author": "sav007", "createdAt": "2020-05-20T02:57:34Z", "path": "apollo-runtime/src/test/java/com/apollographql/apollo/ApolloExceptionTest.java", "diffHunk": "@@ -31,7 +31,7 @@\n import static com.google.common.truth.Truth.assertThat;\n \n @SuppressWarnings(\"unchecked\") public class ApolloExceptionTest {\n-  private static long TIMEOUT_SECONDS = 2;\n+  private static long timeoutSeconds = 2;", "originalCommit": "3e29b547493c3cfe9322f0279602f21d7d7f9aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3MzUxOQ==", "url": "https://github.com/apollographql/apollo-android/pull/2281#discussion_r428273519", "bodyText": "had to make unrelated changes to make lint checks pass. sounds like they have been updated in CI though so i will revert all the unrelated changes", "author": "podarsmarty", "createdAt": "2020-05-20T19:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzk1MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNTUxMQ==", "url": "https://github.com/apollographql/apollo-android/pull/2281#discussion_r427715511", "bodyText": "I think we can move this to the top of cacheResponse function\n    if (networkResponse.parsedResponse.isPresent() && networkResponse.parsedResponse.get().hasErrors()) {\n      return Collections.emptySet();\n    }\n    final Optional<List<Record>> records = networkResponse.cacheRecords.map(\n    ....", "author": "sav007", "createdAt": "2020-05-20T03:04:10Z", "path": "apollo-runtime/src/main/java/com/apollographql/apollo/internal/interceptor/ApolloCacheInterceptor.java", "diffHunk": "@@ -135,7 +135,7 @@ InterceptorResponse resolveFromCache(InterceptorRequest request) throws ApolloEx\n         }\n     );\n \n-    if (!records.isPresent()) {\n+    if (!records.isPresent() || (networkResponse.parsedResponse.isPresent() && networkResponse.parsedResponse.get().hasErrors())) {", "originalCommit": "3e29b547493c3cfe9322f0279602f21d7d7f9aa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI3Mzg3Nw==", "url": "https://github.com/apollographql/apollo-android/pull/2281#discussion_r428273877", "bodyText": "hmm im down with short circuiting. will update", "author": "podarsmarty", "createdAt": "2020-05-20T20:00:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNTUxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "e4f62c4a2b3bbd61ac132c7742cf5e98a7c86685", "chunk": "diff --git a/apollo-runtime/src/main/java/com/apollographql/apollo/internal/interceptor/ApolloCacheInterceptor.java b/apollo-runtime/src/main/java/com/apollographql/apollo/internal/interceptor/ApolloCacheInterceptor.java\nindex 742889192..efc9200e8 100644\n--- a/apollo-runtime/src/main/java/com/apollographql/apollo/internal/interceptor/ApolloCacheInterceptor.java\n+++ b/apollo-runtime/src/main/java/com/apollographql/apollo/internal/interceptor/ApolloCacheInterceptor.java\n\n@@ -135,7 +138,7 @@ public final class ApolloCacheInterceptor implements ApolloInterceptor {\n         }\n     );\n \n-    if (!records.isPresent() || (networkResponse.parsedResponse.isPresent() && networkResponse.parsedResponse.get().hasErrors())) {\n+    if (!records.isPresent()) {\n       return Collections.emptySet();\n     }\n \n"}}, {"oid": "e4f62c4a2b3bbd61ac132c7742cf5e98a7c86685", "url": "https://github.com/apollographql/apollo-android/commit/e4f62c4a2b3bbd61ac132c7742cf5e98a7c86685", "message": "Prevent incorrect caching of partial responses with errors.", "committedDate": "2020-05-20T21:53:34Z", "type": "commit"}, {"oid": "e4f62c4a2b3bbd61ac132c7742cf5e98a7c86685", "url": "https://github.com/apollographql/apollo-android/commit/e4f62c4a2b3bbd61ac132c7742cf5e98a7c86685", "message": "Prevent incorrect caching of partial responses with errors.", "committedDate": "2020-05-20T21:53:34Z", "type": "forcePushed"}]}