{"pr_number": 185, "pr_title": "feat(griffin): ksum() & nsum() compensated summation functions. Fixed\u2026", "pr_createdAt": "2020-04-19T17:22:21Z", "pr_url": "https://github.com/questdb/questdb/pull/185", "timeline": [{"oid": "f907bb7d9e6ebfe37cef27e9513582a3799020a5", "url": "https://github.com/questdb/questdb/commit/f907bb7d9e6ebfe37cef27e9513582a3799020a5", "message": "feat(griffin): ksum() & nsum() compensated summation functions. Fixed #171", "committedDate": "2020-04-19T17:21:39Z", "type": "commit"}, {"oid": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4", "url": "https://github.com/questdb/questdb/commit/771bada6476ba0d1174ce1570ca5d216d2c2e3b4", "message": "fix(griffin): bugfixing new functions", "committedDate": "2020-04-19T22:37:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1Mzc2NQ==", "url": "https://github.com/questdb/questdb/pull/185#discussion_r411153765", "bodyText": "I've been thinking that avg() should have the option of using ksum and nsum.", "author": "jaugsburger", "createdAt": "2020-04-20T07:27:12Z", "path": "core/src/main/java/io/questdb/griffin/SqlCodeGenerator.java", "diffHunk": "@@ -427,6 +431,20 @@ private RecordCursorFactory createSpliceJoin(\n                     vafList.add(new SumTimestampVectorAggregateFunction(ast.rhs.position, columnIndex));\n                     continue;\n                 }\n+            } else if (isSingleColumnFunction(ast, \"ksum\")) {\n+                final int columnIndex = metadata.getColumnIndex(ast.rhs.token);\n+                final int type = metadata.getColumnType(columnIndex);\n+                if (type == ColumnType.DOUBLE) {\n+                    vafList.add(new KSumDoubleVectorAggregateFunction(ast.rhs.position, columnIndex, workerCount));\n+                    continue;\n+                }\n+            } else if (isSingleColumnFunction(ast, \"nsum\")) {\n+                final int columnIndex = metadata.getColumnIndex(ast.rhs.token);\n+                final int type = metadata.getColumnType(columnIndex);\n+                if (type == ColumnType.DOUBLE) {\n+                    vafList.add(new NSumDoubleVectorAggregateFunction(ast.rhs.position, columnIndex, workerCount));\n+                    continue;\n+                }\n             } else if (isSingleColumnFunction(ast, \"avg\")) {", "originalCommit": "771bada6476ba0d1174ce1570ca5d216d2c2e3b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI3Njg4MA==", "url": "https://github.com/questdb/questdb/pull/185#discussion_r411276880", "bodyText": "Yep, i agree. This PR is quite large as it is. I feel it would make sense to add avg() impls later.", "author": "bluestreak01", "createdAt": "2020-04-20T10:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE1Mzc2NQ=="}], "type": "inlineReview", "revised_code": null}]}