{"pr_number": 362, "pr_title": "fix(cairo) - support millis timestamp in import", "pr_createdAt": "2020-06-04T14:57:18Z", "pr_url": "https://github.com/questdb/questdb/pull/362", "timeline": [{"oid": "12f3d854965058b6c885f1800125131e8a6fc83f", "url": "https://github.com/questdb/questdb/commit/12f3d854965058b6c885f1800125131e8a6fc83f", "message": "fix(cairo) - millis imported as timestamp #296", "committedDate": "2020-06-04T13:28:09Z", "type": "commit"}, {"oid": "8fce9999a42e58b92ccae1b58981173602b2dbb3", "url": "https://github.com/questdb/questdb/commit/8fce9999a42e58b92ccae1b58981173602b2dbb3", "message": "fix(cairo) - millis imported as timestamp #296", "committedDate": "2020-06-04T14:42:38Z", "type": "commit"}, {"oid": "ac8c721e7032c910659ca3b4c5622692f664e34b", "url": "https://github.com/questdb/questdb/commit/ac8c721e7032c910659ca3b4c5622692f664e34b", "message": "fix(cairo) - millis imported as timestamp #296", "committedDate": "2020-06-04T16:43:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQwOTEwOA==", "url": "https://github.com/questdb/questdb/pull/362#discussion_r435409108", "bodyText": "Table can have more than one timestamp and more than one date that is misplaced against target column type. A single instance of dateToTimestampAdapter can be overwritten.\nThere is ObjectPool that can produce multiple adaptors like that when needed.", "author": "bluestreak01", "createdAt": "2020-06-04T16:58:25Z", "path": "core/src/main/java/io/questdb/cutlass/text/CairoTextWriter.java", "diffHunk": "@@ -254,8 +256,12 @@ private TableWriter openWriterAndOverrideImportTypes(\n                         this.types.setQuick(i, BadDateAdapter.INSTANCE);\n                         break;\n                     case ColumnType.TIMESTAMP:\n-                        logTypeError(i);\n-                        this.types.setQuick(i, BadTimestampAdapter.INSTANCE);\n+                        if (detectedType == ColumnType.DATE) {\n+                            this.types.setQuick(i, dateToTimestampAdapter.of((DateAdapter) this.types.getQuick(i)));", "originalCommit": "ac8c721e7032c910659ca3b4c5622692f664e34b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "59caeac6a1f0e0ac57e44382de6c784d37eced2e", "chunk": "diff --git a/core/src/main/java/io/questdb/cutlass/text/CairoTextWriter.java b/core/src/main/java/io/questdb/cutlass/text/CairoTextWriter.java\nindex c59d4c35a..0c0773acb 100644\n--- a/core/src/main/java/io/questdb/cutlass/text/CairoTextWriter.java\n+++ b/core/src/main/java/io/questdb/cutlass/text/CairoTextWriter.java\n\n@@ -257,7 +257,7 @@ public class CairoTextWriter implements Closeable, Mutable {\n                         break;\n                     case ColumnType.TIMESTAMP:\n                         if (detectedType == ColumnType.DATE) {\n-                            this.types.setQuick(i, dateToTimestampAdapter.of((DateAdapter) this.types.getQuick(i)));\n+                            this.types.setQuick(i, dateToTimestampAdapterPool.next().of((DateAdapter) this.types.getQuick(i)));\n                         } else {\n                             logTypeError(i);\n                             this.types.setQuick(i, BadTimestampAdapter.INSTANCE);\n"}}, {"oid": "59caeac6a1f0e0ac57e44382de6c784d37eced2e", "url": "https://github.com/questdb/questdb/commit/59caeac6a1f0e0ac57e44382de6c784d37eced2e", "message": "fix(cairo) - millis imported as timestamp #296", "committedDate": "2020-06-04T17:56:34Z", "type": "commit"}, {"oid": "def1ef2dc3822b36c7268d8ed3215e4e4bf88d4c", "url": "https://github.com/questdb/questdb/commit/def1ef2dc3822b36c7268d8ed3215e4e4bf88d4c", "message": "fix(cairo) - millis imported as timestamp #296", "committedDate": "2020-06-05T08:58:29Z", "type": "commit"}]}