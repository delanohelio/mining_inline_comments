{"pr_number": 4223, "pr_title": "fix-NXP-29331-headless-repository", "pr_createdAt": "2020-07-21T20:19:39Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4223", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwMjY2Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458602667", "bodyText": "Worth updating the Javadoc to state that this method can return null, and probably will in most of the cases.", "author": "troger", "createdAt": "2020-07-22T07:51:09Z", "path": "modules/core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSRepositoryDescriptor.java", "diffHunk": "@@ -51,6 +51,18 @@ public Boolean isDefault() {\n         return isDefault;\n     }\n \n+    @XNode(\"@isHeadless\")\n+    protected Boolean isHeadless;\n+\n+    /**\n+     * Returns true if repository is headless.\n+     *\n+     * @since 11.2\n+     */\n+    public Boolean isHeadless() {\n+        return isHeadless;", "originalCommit": "21ece77de36f3226ba19024fbe8bf445291dacb0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a1014cd2f17eff73d027de52171f6e3f90d926b", "chunk": "diff --git a/modules/core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSRepositoryDescriptor.java b/modules/core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSRepositoryDescriptor.java\nindex 2a6222b9235..23732d24ec3 100644\n--- a/modules/core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSRepositoryDescriptor.java\n+++ b/modules/core/nuxeo-core-storage-dbs/src/main/java/org/nuxeo/ecm/core/storage/dbs/DBSRepositoryDescriptor.java\n\n@@ -51,16 +51,12 @@ public class DBSRepositoryDescriptor implements Cloneable {\n         return isDefault;\n     }\n \n-    @XNode(\"@isHeadless\")\n-    protected Boolean isHeadless;\n-\n-    /**\n-     * Returns true if repository is headless.\n-     *\n-     * @since 11.2\n-     */\n+    @XNode(\"@headless\")\n+    protected Boolean headless;\n+\n+    /** @since 11.2 */\n     public Boolean isHeadless() {\n-        return isHeadless;\n+        return headless;\n     }\n \n     @XNode(\"idType\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwNjYxOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458606619", "bodyText": "Do we need the @XNode here as this descriptor is only kept for backward-compatibility? Nobody will contribute with this attribute.", "author": "troger", "createdAt": "2020-07-22T07:58:02Z", "path": "modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java", "diffHunk": "@@ -45,6 +45,9 @@\n     @XNode(\"@isDefault\")\n     private Boolean isDefault;\n \n+    @XNode(\"@headless\")", "originalCommit": "21ece77de36f3226ba19024fbe8bf445291dacb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODY0MDk2Nw==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458640967", "bodyText": "we don't, no. I didn't have it initially but added for consistency, will gladly remove it", "author": "nelsonsilva", "createdAt": "2020-07-22T08:55:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYwNjYxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "5a1014cd2f17eff73d027de52171f6e3f90d926b", "chunk": "diff --git a/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java b/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\nindex d28bcb53a80..5bfd3d659fc 100644\n--- a/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\n+++ b/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\n\n@@ -45,8 +45,7 @@ public class Repository {\n     @XNode(\"@isDefault\")\n     private Boolean isDefault;\n \n-    @XNode(\"@headless\")\n-    private Boolean isHeadless;\n+    private Boolean headless;\n \n     /**\n      * Factory to used to create the low-level repository.\n"}}, {"oid": "5a1014cd2f17eff73d027de52171f6e3f90d926b", "url": "https://github.com/nuxeo/nuxeo/commit/5a1014cd2f17eff73d027de52171f6e3f90d926b", "message": "NXP-29331: support flagging repositories as headless", "committedDate": "2020-07-22T10:05:47Z", "type": "commit"}, {"oid": "5a1014cd2f17eff73d027de52171f6e3f90d926b", "url": "https://github.com/nuxeo/nuxeo/commit/5a1014cd2f17eff73d027de52171f6e3f90d926b", "message": "NXP-29331: support flagging repositories as headless", "committedDate": "2020-07-22T10:05:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3MDYyMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458770623", "bodyText": "Why not:\n    public Boolean isHeadless() {\n        return headless;\n    }\n\nas for the other descriptors?", "author": "ataillefer", "createdAt": "2020-07-22T12:56:48Z", "path": "modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java", "diffHunk": "@@ -84,6 +88,11 @@ public boolean isDefault() {\n         return Boolean.TRUE.equals(isDefault);\n     }\n \n+    /** @since 11.2 */\n+    public boolean isHeadless() {\n+        return Boolean.TRUE.equals(headless);\n+    }", "originalCommit": "5a1014cd2f17eff73d027de52171f6e3f90d926b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3NjkzMg==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458776932", "bodyText": "Probably because this one should really return true or false as it's the object used everywhere :)\n(such as in nuxeo/nuxeo-web-ui#973)", "author": "troger", "createdAt": "2020-07-22T13:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3MDYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3OTc5Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458779796", "bodyText": "Yes. I need a single point in which to determine the semantics of a null value. Plan is for it to be false in master (repos are not headless by default) but for it to be true when null and not the default repo in 10.10 so that the repository picker is not suddenly shown.", "author": "nelsonsilva", "createdAt": "2020-07-22T13:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3MDYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc4MDYwMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4223#discussion_r458780603", "bodyText": "Also, note we do the same with isDefault()", "author": "nelsonsilva", "createdAt": "2020-07-22T13:13:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc3MDYyMw=="}], "type": "inlineReview", "revised_code": null}]}