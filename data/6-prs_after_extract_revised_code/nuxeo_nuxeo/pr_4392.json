{"pr_number": 4392, "pr_title": "NXP-29700: fix blob extraction for list of complex property", "pr_createdAt": "2020-10-16T16:27:19Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4392", "timeline": [{"oid": "31f056d7beefab646ae14ad89b166ca56a2e8d7a", "url": "https://github.com/nuxeo/nuxeo/commit/31f056d7beefab646ae14ad89b166ca56a2e8d7a", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-16T18:59:16Z", "type": "forcePushed"}, {"oid": "d6e6dc79af016a59552239f8bfd4521d133da421", "url": "https://github.com/nuxeo/nuxeo/commit/d6e6dc79af016a59552239f8bfd4521d133da421", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-19T08:31:05Z", "type": "forcePushed"}, {"oid": "1ec7cc050f923dd6918865b241ce98c707085a27", "url": "https://github.com/nuxeo/nuxeo/commit/1ec7cc050f923dd6918865b241ce98c707085a27", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-19T09:15:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzczMzQ0Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/4392#discussion_r507733443", "bodyText": "split.get(0) and List<String> subPath could be factored out of the if and loop.", "author": "efge", "createdAt": "2020-10-19T13:12:08Z", "path": "modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/utils/BlobsExtractor.java", "diffHunk": "@@ -182,8 +185,14 @@ protected void findBlobsProperties(Property property, List<String> split, List<P\n                 properties.add(property);\n             }\n         } else {\n-            for (Property childProperty : property.getChildren()) {\n-                Property childSubProp = childProperty.get(split.get(0));\n+            if (property.isList()) {\n+                for (Property childProperty : property.getChildren()) {\n+                    Property childSubProp = childProperty.get(split.get(0));\n+                    List<String> subPath = split.subList(1, split.size());\n+                    findBlobsProperties(childSubProp, subPath, properties);\n+                }\n+            } else { // complex type\n+                Property childSubProp = property.get(split.get(0));\n                 List<String> subPath = split.subList(1, split.size());", "originalCommit": "1ec7cc050f923dd6918865b241ce98c707085a27", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "50d4c71183300aa3b2093e89cc6029c0c99926fa", "chunk": "diff --git a/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/utils/BlobsExtractor.java b/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/utils/BlobsExtractor.java\nindex f574a29e418..b3f9342eac9 100644\n--- a/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/utils/BlobsExtractor.java\n+++ b/modules/core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/utils/BlobsExtractor.java\n\n@@ -185,15 +185,15 @@ public class BlobsExtractor {\n                 properties.add(property);\n             }\n         } else {\n+            String name = split.get(0);\n+            List<String> subPath = split.subList(1, split.size());\n             if (property.isList()) {\n                 for (Property childProperty : property.getChildren()) {\n-                    Property childSubProp = childProperty.get(split.get(0));\n-                    List<String> subPath = split.subList(1, split.size());\n+                    Property childSubProp = childProperty.get(name);\n                     findBlobsProperties(childSubProp, subPath, properties);\n                 }\n             } else { // complex type\n-                Property childSubProp = property.get(split.get(0));\n-                List<String> subPath = split.subList(1, split.size());\n+                Property childSubProp = property.get(name);\n                 findBlobsProperties(childSubProp, subPath, properties);\n             }\n         }\n"}}, {"oid": "50d4c71183300aa3b2093e89cc6029c0c99926fa", "url": "https://github.com/nuxeo/nuxeo/commit/50d4c71183300aa3b2093e89cc6029c0c99926fa", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-19T13:31:33Z", "type": "forcePushed"}, {"oid": "0c145f1a0017b8b721f83430c4a73196ac8e6d58", "url": "https://github.com/nuxeo/nuxeo/commit/0c145f1a0017b8b721f83430c4a73196ac8e6d58", "message": "NXP-29700: cleanup/format", "committedDate": "2020-10-22T09:01:05Z", "type": "commit"}, {"oid": "eb0b0c10cdc0bd6791a513adec85edfeefab0fbd", "url": "https://github.com/nuxeo/nuxeo/commit/eb0b0c10cdc0bd6791a513adec85edfeefab0fbd", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-22T09:01:05Z", "type": "commit"}, {"oid": "eb0b0c10cdc0bd6791a513adec85edfeefab0fbd", "url": "https://github.com/nuxeo/nuxeo/commit/eb0b0c10cdc0bd6791a513adec85edfeefab0fbd", "message": "NXP-29700: fix blob extraction for list of complex property", "committedDate": "2020-10-22T09:01:05Z", "type": "forcePushed"}]}