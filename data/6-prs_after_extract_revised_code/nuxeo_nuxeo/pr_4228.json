{"pr_number": 4228, "pr_title": "fix-NXP-29331-headless-repository-10.10", "pr_createdAt": "2020-07-27T13:23:34Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4228", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MjAzOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4228#discussion_r461362038", "bodyText": "Should we understand this as \"if the repository is not the default one and headless is not filled in (null), then it's considered as headless\"?\nIn this case, why is it different from master, see e018af0#diff-e73e25622874c080fe10b7cbcb291ea8R93?\nMight deserve a comment.", "author": "ataillefer", "createdAt": "2020-07-28T07:02:59Z", "path": "nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java", "diffHunk": "@@ -84,6 +93,14 @@ public boolean isDefault() {\n         return Boolean.TRUE.equals(isDefault);\n     }\n \n+    /** @since 11.2 */\n+    public boolean isHeadless() {\n+        if (isDefault()) {\n+            return Boolean.TRUE.equals(headless);\n+        }\n+        return !Boolean.FALSE.equals(headless);", "originalCommit": "878d443e8edaeaa644efd5102696a66de9fb5670", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4NTgwOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4228#discussion_r461485809", "bodyText": "yes, this is different than in master because we want all repos to be headless by default unless it's the default one (if this is not explictly set to be headless).\nthis is so that a repository picker doesn't show up all of sudden after installing a HF.", "author": "nelsonsilva", "createdAt": "2020-07-28T10:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MjAzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUzOTQyMw==", "url": "https://github.com/nuxeo/nuxeo/pull/4228#discussion_r461539423", "bodyText": "OK thanks.\nAgain, I think this explanation would be interesting as a comment in the code.", "author": "ataillefer", "createdAt": "2020-07-28T12:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MjAzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU1NjI1Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4228#discussion_r461556252", "bodyText": "+1 on adding a comment explaining that this is for backward compat", "author": "efge", "createdAt": "2020-07-28T12:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MjAzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTU3MTk2Ng==", "url": "https://github.com/nuxeo/nuxeo/pull/4228#discussion_r461571966", "bodyText": "\ud83d\udc4d added a comment", "author": "nelsonsilva", "createdAt": "2020-07-28T13:18:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTM2MjAzOA=="}], "type": "inlineReview", "revised_code": {"commit": "bcf120dcca6e69887fd927aceac85db791c25f06", "chunk": "diff --git a/nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java b/nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\nindex 07682f3f1f2..f066b6f52c6 100644\n--- a/nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\n+++ b/nuxeo-core/nuxeo-core-api/src/main/java/org/nuxeo/ecm/core/api/repository/Repository.java\n\n@@ -95,6 +95,8 @@ public class Repository {\n \n     /** @since 11.2 */\n     public boolean isHeadless() {\n+        // for compatibility reasons, before 11.2, a repository is headless by default unless it's the default\n+        // repository and not explicitly flagged as headless\n         if (isDefault()) {\n             return Boolean.TRUE.equals(headless);\n         }\n"}}, {"oid": "bcf120dcca6e69887fd927aceac85db791c25f06", "url": "https://github.com/nuxeo/nuxeo/commit/bcf120dcca6e69887fd927aceac85db791c25f06", "message": "NXP-29331: support flagging repositories as headless", "committedDate": "2020-07-28T13:17:11Z", "type": "commit"}, {"oid": "bcf120dcca6e69887fd927aceac85db791c25f06", "url": "https://github.com/nuxeo/nuxeo/commit/bcf120dcca6e69887fd927aceac85db791c25f06", "message": "NXP-29331: support flagging repositories as headless", "committedDate": "2020-07-28T13:17:11Z", "type": "forcePushed"}]}