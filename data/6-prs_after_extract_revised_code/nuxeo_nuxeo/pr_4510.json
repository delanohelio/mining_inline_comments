{"pr_number": 4510, "pr_title": "NXP-29924: avoid storing intermediate chain results", "pr_createdAt": "2020-12-03T14:46:34Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4510", "timeline": [{"oid": "83d17e1ce2ecd99087c570b562c12acd247e880d", "url": "https://github.com/nuxeo/nuxeo/commit/83d17e1ce2ecd99087c570b562c12acd247e880d", "message": "NXP-29924: avoid storing intermediate chain results", "committedDate": "2020-12-03T16:04:15Z", "type": "forcePushed"}, {"oid": "c387333809679df688e4420d788f5b9350f645a9", "url": "https://github.com/nuxeo/nuxeo/commit/c387333809679df688e4420d788f5b9350f645a9", "message": "NXP-29924: avoid storing intermediate chain results", "committedDate": "2020-12-03T16:14:20Z", "type": "commit"}, {"oid": "c387333809679df688e4420d788f5b9350f645a9", "url": "https://github.com/nuxeo/nuxeo/commit/c387333809679df688e4420d788f5b9350f645a9", "message": "NXP-29924: avoid storing intermediate chain results", "committedDate": "2020-12-03T16:14:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyNDQxNw==", "url": "https://github.com/nuxeo/nuxeo/pull/4510#discussion_r535524417", "bodyText": "Is it worth doing output = null after this to avoid keeping a reference to the output in a field?", "author": "efge", "createdAt": "2020-12-03T19:31:52Z", "path": "modules/platform/nuxeo-automation/nuxeo-automation-server/src/main/java/org/nuxeo/ecm/automation/server/jaxrs/adapters/AsyncOperationAdapter.java", "diffHunk": "@@ -148,13 +148,16 @@ public Object doPost(ExecutionRequest xreq) {\n \n         opCtx.setCallback(new OperationCallback() {\n \n+            private Object output;\n+\n             @Override\n             public void onChainEnter(OperationType chain) {\n                 //\n             }\n \n             @Override\n             public void onChainExit() {\n+                setOutput(executionId, (Serializable) output);", "originalCommit": "c387333809679df688e4420d788f5b9350f645a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzNDMzMA==", "url": "https://github.com/nuxeo/nuxeo/pull/4510#discussion_r535534330", "bodyText": "The operation callback is referenced by the context which is referenced by the thread that handles the chain execution so I'd expect it to be ready for GC once execution is done, no?", "author": "nelsonsilva", "createdAt": "2020-12-03T19:43:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyNDQxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUzNTEzOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/4510#discussion_r535535139", "bodyText": "Yes if it doesn't last longer than that then no need for manual \"cleanup\".", "author": "efge", "createdAt": "2020-12-03T19:44:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTUyNDQxNw=="}], "type": "inlineReview", "revised_code": null}]}