{"pr_number": 4558, "pr_title": "NXP-29991: Add configuration flag", "pr_createdAt": "2020-12-24T15:57:24Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4558", "timeline": [{"oid": "71bc233e90d32bd3de9955eccc572e868f650499", "url": "https://github.com/nuxeo/nuxeo/commit/71bc233e90d32bd3de9955eccc572e868f650499", "message": "NXP-29991: Add configuration flag", "committedDate": "2021-01-12T09:04:08Z", "type": "forcePushed"}, {"oid": "14404ee6b143bba5bf261cb49fa467e59fa82064", "url": "https://github.com/nuxeo/nuxeo/commit/14404ee6b143bba5bf261cb49fa467e59fa82064", "message": "NXP-29991: Add configuration flag", "committedDate": "2021-01-12T09:24:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTY1NTM4MA==", "url": "https://github.com/nuxeo/nuxeo/pull/4558#discussion_r555655380", "bodyText": "List<Blob> blobs = result.getBlobs();\nif (Framework.getService(ConfigurationService.class).isBooleanTrue(SANITIZE_ZIP_PREVIEW)) {\n    blobs.replaceAll(this::sanitize);\n}\nreturn blobs;", "author": "efge", "createdAt": "2021-01-12T10:10:50Z", "path": "modules/platform/nuxeo-preview-core/src/main/java/org/nuxeo/ecm/platform/preview/adapter/ZipPreviewer.java", "diffHunk": "@@ -69,7 +72,11 @@\n \n         try {\n             BlobHolder result = conversionService.convert(converterName, new SimpleBlobHolder(blob), null);\n-            return result.getBlobs().stream().map(this::sanitize).collect(Collectors.toList());\n+            if (Framework.getService(ConfigurationService.class).isBooleanTrue(SANITIZE_ZIP_PREVIEW)) {\n+                return result.getBlobs().stream().map(this::sanitize).collect(Collectors.toList());\n+            } else {\n+                return result.getBlobs();\n+            }", "originalCommit": "14404ee6b143bba5bf261cb49fa467e59fa82064", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fba955ef8696927ad0d7a2a7bd6cd52e0423e843", "chunk": "diff --git a/modules/platform/nuxeo-preview-core/src/main/java/org/nuxeo/ecm/platform/preview/adapter/ZipPreviewer.java b/modules/platform/nuxeo-preview-core/src/main/java/org/nuxeo/ecm/platform/preview/adapter/ZipPreviewer.java\nindex ffef021bdd0..90e34a98bcf 100644\n--- a/modules/platform/nuxeo-preview-core/src/main/java/org/nuxeo/ecm/platform/preview/adapter/ZipPreviewer.java\n+++ b/modules/platform/nuxeo-preview-core/src/main/java/org/nuxeo/ecm/platform/preview/adapter/ZipPreviewer.java\n\n@@ -72,11 +72,11 @@ public class ZipPreviewer implements MimeTypePreviewer {\n \n         try {\n             BlobHolder result = conversionService.convert(converterName, new SimpleBlobHolder(blob), null);\n+            List<Blob> blobs = result.getBlobs();\n             if (Framework.getService(ConfigurationService.class).isBooleanTrue(SANITIZE_ZIP_PREVIEW)) {\n-                return result.getBlobs().stream().map(this::sanitize).collect(Collectors.toList());\n-            } else {\n-                return result.getBlobs();\n+                blobs.replaceAll(this::sanitize);\n             }\n+            return blobs;\n         } catch (ConversionException e) {\n             throw new PreviewException(e.getMessage(), e);\n         }\n"}}, {"oid": "fba955ef8696927ad0d7a2a7bd6cd52e0423e843", "url": "https://github.com/nuxeo/nuxeo/commit/fba955ef8696927ad0d7a2a7bd6cd52e0423e843", "message": "NXP-29991: Add configuration flag", "committedDate": "2021-01-12T15:03:28Z", "type": "commit"}, {"oid": "fba955ef8696927ad0d7a2a7bd6cd52e0423e843", "url": "https://github.com/nuxeo/nuxeo/commit/fba955ef8696927ad0d7a2a7bd6cd52e0423e843", "message": "NXP-29991: Add configuration flag", "committedDate": "2021-01-12T15:03:28Z", "type": "forcePushed"}]}