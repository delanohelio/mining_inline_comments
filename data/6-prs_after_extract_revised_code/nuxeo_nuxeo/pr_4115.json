{"pr_number": 4115, "pr_title": "NXP-29154 Improve feedback on explorer actions", "pr_createdAt": "2020-06-04T15:11:48Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/4115", "timeline": [{"oid": "23e64020043bdb9f4f9f887745034222034f0104", "url": "https://github.com/nuxeo/nuxeo/commit/23e64020043bdb9f4f9f887745034222034f0104", "message": "NXP-29154: highlight explorer buttons when active or clicked (for long actions)", "committedDate": "2020-06-04T10:42:30Z", "type": "commit"}, {"oid": "a9806d81eb5e307e1e9213f03a95b1255b0d8635", "url": "https://github.com/nuxeo/nuxeo/commit/a9806d81eb5e307e1e9213f03a95b1255b0d8635", "message": "NXP-29154: add cancel button on save forms", "committedDate": "2020-06-04T10:42:30Z", "type": "commit"}, {"oid": "021a8b9c53b849933b04a51bf2747b1446bb6881", "url": "https://github.com/nuxeo/nuxeo/commit/021a8b9c53b849933b04a51bf2747b1446bb6881", "message": "NXP-29154: better exception management when uploading distributions", "committedDate": "2020-06-04T14:54:30Z", "type": "commit"}, {"oid": "85d7ea9fee20abfb1f8e23b816e41751f344b3e3", "url": "https://github.com/nuxeo/nuxeo/commit/85d7ea9fee20abfb1f8e23b816e41751f344b3e3", "message": "NXP-29154: factor out distribution save logics", "committedDate": "2020-06-04T14:58:08Z", "type": "commit"}, {"oid": "ac472c7c00b953c6fbaa79ab0208e5fe84b9e571", "url": "https://github.com/nuxeo/nuxeo/commit/ac472c7c00b953c6fbaa79ab0208e5fe84b9e571", "message": "NXP-29154: better redirection after save and upload actions", "committedDate": "2020-06-04T15:01:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0NjI2Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/4115#discussion_r435346262", "bodyText": "You can use log4j2 format feature to save some resources.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.debug(\"Path => \" + redirectUrl);\n          \n          \n            \n                    log.debug(\"Path => {}\",  redirectUrl);\n          \n      \n    \n    \n  \n\nOtherwise, we tend to use a colon follow by a space and directly is value, for example The document: {docId} has been removed. I don't know if we want to follow such pattern here?", "author": "kevinleturc", "createdAt": "2020-06-04T15:26:29Z", "path": "modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/java/org/nuxeo/apidoc/browse/Distribution.java", "diffHunk": "@@ -358,21 +335,27 @@ public Object doSaveExtended() throws NamingException, NotSupportedException, Sy\n             tx.begin();\n             startedTx = true;\n         }\n+\n+        FormData formData = getContext().getForm();\n+        String source = formData.getString(\"source\");\n         try {\n-            getSnapshotManager().persistRuntimeSnapshot(getContext().getCoreSession(), distribLabel, otherProperties,\n-                    filter);\n+            getSnapshotManager().persistRuntimeSnapshot(getContext().getCoreSession(), formData.getString(\"name\"),\n+                    readFormData(formData), filter);\n         } catch (NuxeoException e) {\n             log.error(\"Error during storage\", e);\n             if (tx != null) {\n                 tx.rollback();\n             }\n-            return getView(\"savedKO\").arg(\"message\", e.getMessage());\n+            return getView(\"savedKO\").arg(\"message\", e.getMessage()).arg(\"source\", source);\n         }\n         log.info(\"Snapshot saved.\");\n+\n         if (tx != null && startedTx) {\n             tx.commit();\n         }\n-        return getView(\"saved\");\n+        String redirectUrl = getContext().getBaseURL() + getPath();\n+        log.debug(\"Path => \" + redirectUrl);", "originalCommit": "ac472c7c00b953c6fbaa79ab0208e5fe84b9e571", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM3ODAwOA==", "url": "https://github.com/nuxeo/nuxeo/pull/4115#discussion_r435378008", "bodyText": "Indeed this is old logging, I only moved that line when factoring out duplicated code, and did not pay much attention to it, but i do not see the point of computing the redirectUrl just for logging since we're not redirecting to it anyway.\nSo i will just remove it \ud83d\udc4d", "author": "atchertchian", "createdAt": "2020-06-04T16:09:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM0NjI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "93ff29d26960804c02fc7bdf2ba6edaa30b3bc70", "chunk": "diff --git a/modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/java/org/nuxeo/apidoc/browse/Distribution.java b/modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/java/org/nuxeo/apidoc/browse/Distribution.java\nindex de7c1396b6e..1b7022d4303 100644\n--- a/modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/java/org/nuxeo/apidoc/browse/Distribution.java\n+++ b/modules/platform/nuxeo-apidoc-server/nuxeo-apidoc-webengine/src/main/java/org/nuxeo/apidoc/browse/Distribution.java\n\n@@ -328,7 +328,6 @@ public class Distribution extends ModuleRoot {\n             return null;\n         }\n \n-        log.info(\"Start Snapshot...\");\n         boolean startedTx = false;\n         UserTransaction tx = TransactionHelper.lookupUserTransaction();\n         if (tx != null && !TransactionHelper.isTransactionActiveOrMarkedRollback()) {\n"}}, {"oid": "d4c154687d58cef600cec187886239f88d0e6ed2", "url": "https://github.com/nuxeo/nuxeo/commit/d4c154687d58cef600cec187886239f88d0e6ed2", "message": "NXP-29154: add new line at end of files", "committedDate": "2020-06-04T16:11:03Z", "type": "commit"}, {"oid": "93ff29d26960804c02fc7bdf2ba6edaa30b3bc70", "url": "https://github.com/nuxeo/nuxeo/commit/93ff29d26960804c02fc7bdf2ba6edaa30b3bc70", "message": "NXP-29154: remove useless logs", "committedDate": "2020-06-04T16:12:58Z", "type": "commit"}]}