{"pr_number": 3963, "pr_title": "NXP-28939: split the retention based event rule properties", "pr_createdAt": "2020-04-23T10:18:26Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3963", "timeline": [{"oid": "e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "url": "https://github.com/nuxeo/nuxeo/commit/e207e5ab86b28fb06d87600e4bd5f6dae2f05c89", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-23T10:21:20Z", "type": "forcePushed"}, {"oid": "8df0865d9f626a1cfab18464910933d323202ed7", "url": "https://github.com/nuxeo/nuxeo/commit/8df0865d9f626a1cfab18464910933d323202ed7", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-23T14:00:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0OTUwOQ==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r413949509", "bodyText": "small typo: matadataXPath", "author": "nmpcunha", "createdAt": "2020-04-23T16:35:27Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -108,7 +110,7 @@ protected void awaitRetentionExpiration(long millis) throws InterruptedException\n \n     protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy policy,\n             StartingPointPolicy startingPointPolicy, List<String> docTypes, String startingPointEventId,\n-            String startingPointExpression, String matadataXPath, long years, long months, long days,\n+            String startingPointExpressionLanguage, String startingPointEventInput, String matadataXPath, long years, long months, long days,", "originalCommit": "8df0865d9f626a1cfab18464910933d323202ed7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4MjczMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414382730", "bodyText": "thanks, I will do it on master with a separate commit cleanup/format", "author": "RSalem07", "createdAt": "2020-04-24T08:12:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzk0OTUwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "a99dba500600464a79c7819deacf50d33b65af96", "chunk": "diff --git a/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java b/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\nindex eca836b4d4c..0a651ac48e2 100644\n--- a/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\n+++ b/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\n\n@@ -110,7 +110,7 @@ public abstract class RetentionTestCase {\n \n     protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy policy,\n             StartingPointPolicy startingPointPolicy, List<String> docTypes, String startingPointEventId,\n-            String startingPointExpressionLanguage, String startingPointEventInput, String matadataXPath, long years, long months, long days,\n+            String startingPointExpression, String startingPointValue, String matadataXPath, long years, long months, long days,\n             long durationMillis, List<String> beginActions, List<String> endActions) {\n         DocumentModel doc = session.createDocumentModel(\"/RetentionRules\", \"testRule\", \"RetentionRule\");\n         RetentionRule rule = doc.getAdapter(RetentionRule.class);\n"}}, {"oid": "a99dba500600464a79c7819deacf50d33b65af96", "url": "https://github.com/nuxeo/nuxeo/commit/a99dba500600464a79c7819deacf50d33b65af96", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T07:59:15Z", "type": "forcePushed"}, {"oid": "d0046a782bc8e04c39497fb9749eebacc80290cd", "url": "https://github.com/nuxeo/nuxeo/commit/d0046a782bc8e04c39497fb9749eebacc80290cd", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T08:00:43Z", "type": "forcePushed"}, {"oid": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "url": "https://github.com/nuxeo/nuxeo/commit/89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T08:08:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ3NzAxMA==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414477010", "bodyText": "CoreBulkFeature is declared by CoreFeature, you should already have it in the test (no needs to depend on it).", "author": "kevinleturc", "createdAt": "2020-04-24T10:41:29Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -50,7 +51,7 @@\n  * @since 11.1\n  */\n @RunWith(FeaturesRunner.class)\n-@Features({ TransactionalFeature.class, AutomationFeature.class })\n+@Features({ TransactionalFeature.class, AutomationFeature.class, CoreBulkFeature.class })", "originalCommit": "89e111efa1fa273c7ae2284c02c5abbfcbb663eb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3852c471f061cb82447b4496aa144b754bf44890", "chunk": "diff --git a/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java b/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\nindex 32b10fffd73..f72b485f197 100644\n--- a/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\n+++ b/addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java\n\n@@ -51,7 +51,7 @@ import org.nuxeo.runtime.test.runner.TransactionalFeature;\n  * @since 11.1\n  */\n @RunWith(FeaturesRunner.class)\n-@Features({ TransactionalFeature.class, AutomationFeature.class, CoreBulkFeature.class })\n+@Features({ TransactionalFeature.class, AutomationFeature.class })\n @RepositoryConfig(init = DefaultRepositoryInit.class, cleanup = Granularity.METHOD)\n @Deploy(\"org.nuxeo.retention.core:OSGI-INF/retention-core-types.xml\")\n @Deploy(\"org.nuxeo.retention.core:OSGI-INF/retention-adapters.xml\")\n"}}, {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T10:50:01Z", "type": "commit"}, {"oid": "3852c471f061cb82447b4496aa144b754bf44890", "url": "https://github.com/nuxeo/nuxeo/commit/3852c471f061cb82447b4496aa144b754bf44890", "message": "NXP-28939: split the retention based event rule properties", "committedDate": "2020-04-24T10:50:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODYyNg==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608626", "bodyText": "missing space after ,", "author": "efge", "createdAt": "2020-04-24T14:13:43Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/RetentionTestCase.java", "diffHunk": "@@ -131,23 +134,30 @@ protected RetentionRule createRuleWithActions(RetentionRule.ApplicationPolicy po\n     protected RetentionRule createImmediateRuleMillis(RetentionRule.ApplicationPolicy policy, long durationMillis,\n             List<String> beginActions, List<String> endActions) {\n         return createRuleWithActions(policy, RetentionRule.StartingPointPolicy.IMMEDIATE, Arrays.asList(\"File\"), null,\n-                null, null, 0L, 0L, 0L, durationMillis, beginActions, endActions);\n+                null, null,null, 0L, 0L, 0L, durationMillis, beginActions, endActions);", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDYwODg1Mw==", "url": "https://github.com/nuxeo/nuxeo/pull/3963#discussion_r414608853", "bodyText": "missing space after , (and 2 others below)", "author": "efge", "createdAt": "2020-04-24T14:13:57Z", "path": "addons/nuxeo-retention/nuxeo-retention-core/src/test/java/org/nuxeo/retention/test/TestRetentionManager.java", "diffHunk": "@@ -61,19 +68,19 @@ public void testRuleOnlyFile() {\n     @Test\n     public void test1DayManualImmediateRuleRunningRetention() throws InterruptedException {\n         assertStillUnderRetentionAfter(file, createRuleWithActions(RetentionRule.ApplicationPolicy.MANUAL,\n-                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null, 0, 0, 1, 0, null, null), 1000);\n+                RetentionRule.StartingPointPolicy.IMMEDIATE, null, null, null, null,null, 0, 0, 1, 0, null, null), 1000);", "originalCommit": "3852c471f061cb82447b4496aa144b754bf44890", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}