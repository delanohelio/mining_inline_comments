{"pr_number": 3803, "pr_title": "NXP-28599: add option to generate download URLs with redirect already taken into account (10.10)", "pr_createdAt": "2020-02-28T15:44:42Z", "pr_url": "https://github.com/nuxeo/nuxeo/pull/3803", "timeline": [{"oid": "7e9d6869485f7f0ca4e13b5d83ce432afda388e1", "url": "https://github.com/nuxeo/nuxeo/commit/7e9d6869485f7f0ca4e13b5d83ce432afda388e1", "message": "NXP-28599: add option to generate download URLs with redirect already taken into account", "committedDate": "2020-02-29T18:04:35Z", "type": "commit"}, {"oid": "7e9d6869485f7f0ca4e13b5d83ce432afda388e1", "url": "https://github.com/nuxeo/nuxeo/commit/7e9d6869485f7f0ca4e13b5d83ce432afda388e1", "message": "NXP-28599: add option to generate download URLs with redirect already taken into account", "committedDate": "2020-02-29T18:04:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzMDI2Mg==", "url": "https://github.com/nuxeo/nuxeo/pull/3803#discussion_r386330262", "bodyText": "same suggestion as #3802 (comment)", "author": "NourNuxeo", "createdAt": "2020-03-02T11:09:10Z", "path": "nuxeo-core/nuxeo-core-io/src/main/java/org/nuxeo/ecm/core/io/download/DownloadServiceImpl.java", "diffHunk": "@@ -168,6 +172,22 @@ public String storeBlobs(List<Blob> blobs) {\n         return storeKey;\n     }\n \n+    @Override\n+    public String getFullDownloadUrl(DocumentModel doc, String xpath, Blob blob, String baseUrl) {\n+        ConfigurationService configurationService = Framework.getService(ConfigurationService.class);\n+        if (configurationService.isBooleanTrue(DOWNLOAD_URL_FOLLOW_REDIRECT)) {\n+            try {\n+                URI uri = redirectResolver.getURI(blob, UsageHint.DOWNLOAD, null);\n+                if (uri != null) {\n+                    return uri.toString();\n+                }\n+            } catch (IOException e) {\n+                log.error(e, e);", "originalCommit": "7e9d6869485f7f0ca4e13b5d83ce432afda388e1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}