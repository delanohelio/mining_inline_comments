{"pr_number": 2082, "pr_title": "withInstructions should be without path details", "pr_createdAt": "2020-07-12T16:40:18Z", "pr_url": "https://github.com/graphhopper/graphhopper/pull/2082", "timeline": [{"oid": "96cfcc20d2f16b21588820033cb9f8ff7f7ff9cd", "url": "https://github.com/graphhopper/graphhopper/commit/96cfcc20d2f16b21588820033cb9f8ff7f7ff9cd", "message": "measurement: withInstructions should be without path details", "committedDate": "2020-07-12T16:38:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0MjcwMQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453342701", "bodyText": "This indeed looks strange. We are enabling instructions by enabling path details?", "author": "easbar", "createdAt": "2020-07-12T17:30:30Z", "path": "tools/src/main/java/com/graphhopper/tools/Measurement.java", "diffHunk": "@@ -781,10 +784,7 @@ public int doCalc(boolean warmup, int run) {\n                 if (querySettings.alternative)\n                     req.setAlgorithm(ALT_ROUTE);\n \n-                if (querySettings.withInstructions)\n-                    req.setPathDetails(Arrays.asList(Parameters.Details.AVERAGE_SPEED));", "originalCommit": "96cfcc20d2f16b21588820033cb9f8ff7f7ff9cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NjE3Nw==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453356177", "bodyText": "We enabled two things, so we could have also renamed withInstructions into withInstructionsAndPD (?)", "author": "karussell", "createdAt": "2020-07-12T19:49:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0MjcwMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453342781", "bodyText": "Here we enable simplify by adding path details? Do we still have a measurement with instructions and path details?", "author": "easbar", "createdAt": "2020-07-12T17:31:06Z", "path": "tools/src/main/java/com/graphhopper/tools/Measurement.java", "diffHunk": "@@ -781,10 +784,7 @@ public int doCalc(boolean warmup, int run) {\n                 if (querySettings.alternative)\n                     req.setAlgorithm(ALT_ROUTE);\n \n-                if (querySettings.withInstructions)\n-                    req.setPathDetails(Arrays.asList(Parameters.Details.AVERAGE_SPEED));\n-\n-                if (querySettings.simplify) {\n+                if (querySettings.simplifyAndPD) {\n                     req.setPathDetails(Arrays.asList(Parameters.Details.AVERAGE_SPEED, Parameters.Details.EDGE_ID, Parameters.Details.STREET_NAME));", "originalCommit": "96cfcc20d2f16b21588820033cb9f8ff7f7ff9cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NjM0MA==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453356340", "bodyText": "I think \"simplification\" is always done for \"forServer\" (used here in Measurement, see line 182), except if !simplify, then WAY_POINT_MAX_DISTANCE=0", "author": "karussell", "createdAt": "2020-07-12T19:51:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NjU1Ng==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453356556", "bodyText": "Aha :) It seems confusing that setPathDetails has anything to do with instructions?", "author": "easbar", "createdAt": "2020-07-12T19:54:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM1NjkwNw==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453356907", "bodyText": "Do we really need forDesktop/Server/Mobile? It happened to me at least twice that I wanted to disable/enable path simplification and then I found myself calling forServer or forDesktop to achieve this 'indirectly'...", "author": "easbar", "createdAt": "2020-07-12T19:57:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUwNjk0Ng==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453506946", "bodyText": "Aha :) It seems confusing that setPathDetails has anything to do with instructions?\n\nWill introduce a separate pd=true/false variable\n\nDo we really need forDesktop/Server/Mobile? It happened to me at least twice that I wanted to disable/enable path simplification and then I found myself calling forServer or forDesktop to achieve this 'indirectly'...\n\nYou mean exposing setSimplifyResponse and removing forXY?", "author": "karussell", "createdAt": "2020-07-13T09:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUzMjcwMQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453532701", "bodyText": "It happened to me at least twice that I wanted to disable/enable path simplification and then I found myself calling forServer or forDesktop to achieve this 'indirectly'...\n\nHmmh, looking into this ... and \"forServer\" (i.e. with simplification) should be the default. Also you could call hopper.getRouterConfig().setSimplifyResponse to change this.", "author": "karussell", "createdAt": "2020-07-13T09:53:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY5MzY0OQ==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453693649", "bodyText": "You mean exposing setSimplifyResponse and removing forXY?\n\nYes if thats possible? Or was it meant similar to ch.disablingAllowed (make sure users cannot disable path simplification)?\n\nHmmh, looking into this ... and \"forServer\" (i.e. with simplification) should be the default. Also you could call hopper.getRouterConfig().setSimplifyResponse to change this.\n\nAh ok if we can change simplify via the router config thats good (I thought the last time I wanted to do this it was not possible).", "author": "easbar", "createdAt": "2020-07-13T14:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNzkwNg==", "url": "https://github.com/graphhopper/graphhopper/pull/2082#discussion_r453707906", "bodyText": "Yes if thats possible? Or was it meant similar to ch.disablingAllowed (make sure users cannot disable path simplification)?\n\nIt is meant as the default and for desktop it doesn't make much sense as we can transmit the full and original path, but client bandwidth or client power can be limited and it is usually faster to compress the response even if it takes time. E.g. komoot returns a custom format probably unsimplified resulting in ~5MB (just picked a 200km route) where our route returns quickly and only needs <100KB :) (but probably this is more due to our compact path details representation and not so much due to the simplification. maybe interesting improvement @jtheuer ;) )", "author": "karussell", "createdAt": "2020-07-13T14:52:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzM0Mjc4MQ=="}], "type": "inlineReview", "revised_code": null}]}