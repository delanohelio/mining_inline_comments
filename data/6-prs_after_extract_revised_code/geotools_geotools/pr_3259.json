{"pr_number": 3259, "pr_title": "[GEOT-6754] gt-wmts: WMTSCoverageReader#getMap() in some cases throws IllegalA\u2026", "pr_createdAt": "2020-12-14T15:36:48Z", "pr_url": "https://github.com/geotools/geotools/pull/3259", "timeline": [{"oid": "d363f9f044b2f8ad9004edf6a5f11ffea0c7e8a3", "url": "https://github.com/geotools/geotools/commit/d363f9f044b2f8ad9004edf6a5f11ffea0c7e8a3", "message": "[GEOT-6754] WMTSCoverageReader#getMap() in some cases throws IllegalArgumentException", "committedDate": "2020-12-14T15:16:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjUyNTI4OA==", "url": "https://github.com/geotools/geotools/pull/3259#discussion_r542525288", "bodyText": "We really need a comment here explain what this method does and why it does it - otherwise it looks very suspicious.", "author": "ianturton", "createdAt": "2020-12-14T16:32:33Z", "path": "modules/extension/wmts/src/main/java/org/geotools/ows/wmts/map/WMTSCoverageReader.java", "diffHunk": "@@ -326,11 +328,22 @@ GridCoverage2D getMap(ReferencedEnvelope requestedEnvelope, int width, int heigh\n             renderTiles(responses, image.createGraphics(), requestedEnvelope, targetTransform);\n \n             return gcf.create(layer.getTitle(), image, global);\n-        } catch (ServiceException e) {\n+        } catch (ServiceException | FactoryException | TransformException e) {\n             throw new IOException(\"GetMap failed\", e);\n         }\n     }\n \n+    private ReferencedEnvelope toEastNorthAxisOrder(ReferencedEnvelope extent)", "originalCommit": "d363f9f044b2f8ad9004edf6a5f11ffea0c7e8a3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eccfef14fb2e43e784cc0fe357f9d05992d51c7b", "chunk": "diff --git a/modules/extension/wmts/src/main/java/org/geotools/ows/wmts/map/WMTSCoverageReader.java b/modules/extension/wmts/src/main/java/org/geotools/ows/wmts/map/WMTSCoverageReader.java\nindex 5c826cc264..05bf516c7c 100644\n--- a/modules/extension/wmts/src/main/java/org/geotools/ows/wmts/map/WMTSCoverageReader.java\n+++ b/modules/extension/wmts/src/main/java/org/geotools/ows/wmts/map/WMTSCoverageReader.java\n\n@@ -333,15 +336,24 @@ public class WMTSCoverageReader extends AbstractGridCoverage2DReader {\n         }\n     }\n \n-    private ReferencedEnvelope toEastNorthAxisOrder(ReferencedEnvelope extent)\n+    /**\n+     * Checks if a referenced envelope has EAST_NORTH axis order and if not\n+     * creates a copy with EAST_NORTH axis order.\n+     *\n+     * @param envelope The referenced envelope.\n+     * @return The referenced envelope eith EAST_NORTH axis order.\n+     * @throws FactoryException\n+     * @throws TransformException\n+     */\n+    private ReferencedEnvelope toEastNorthAxisOrder(ReferencedEnvelope envelope)\n             throws FactoryException, TransformException {\n-        CoordinateReferenceSystem crsExtent = extent.getCoordinateReferenceSystem();\n+        CoordinateReferenceSystem crsExtent = envelope.getCoordinateReferenceSystem();\n         if (CRS.getAxisOrder(crsExtent) == CRS.AxisOrder.NORTH_EAST) {\n             String srsExtent = CRS.toSRS(crsExtent);\n             crsExtent = CRS.decode(srsExtent, true);\n-            extent = extent.transform(crsExtent, false);\n+            envelope = envelope.transform(crsExtent, false);\n         }\n-        return extent;\n+        return envelope;\n     }\n \n     protected void renderTiles(\n"}}, {"oid": "eccfef14fb2e43e784cc0fe357f9d05992d51c7b", "url": "https://github.com/geotools/geotools/commit/eccfef14fb2e43e784cc0fe357f9d05992d51c7b", "message": "[GEOT-6754] WMTSCoverageReader#getMap() in some cases throws IllegalArgumentException", "committedDate": "2020-12-15T10:11:14Z", "type": "commit"}, {"oid": "8ad540fee516bb5c643366324c51f046eee68949", "url": "https://github.com/geotools/geotools/commit/8ad540fee516bb5c643366324c51f046eee68949", "message": "[GEOT-6754] WMTSCoverageReader#getMap() in some cases throws IllegalArgumentException", "committedDate": "2020-12-15T10:15:28Z", "type": "commit"}]}