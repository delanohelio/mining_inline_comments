{"pr_number": 3169, "pr_title": "[GEOT-6715]: COG Support in GeoTIFF", "pr_createdAt": "2020-10-05T13:21:03Z", "pr_url": "https://github.com/geotools/geotools/pull/3169", "timeline": [{"oid": "e343fbb515cd6d699c450c87004359d0f464101a", "url": "https://github.com/geotools/geotools/commit/e343fbb515cd6d699c450c87004359d0f464101a", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-05T13:24:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwMzQzMA==", "url": "https://github.com/geotools/geotools/pull/3169#discussion_r499603430", "bodyText": "Why duplicate fields, if the readingAccessObject (ugly name btw) already has them and it's a field, best to remove the other 3 no?", "author": "aaime", "createdAt": "2020-10-05T13:35:55Z", "path": "modules/library/coverage/src/main/java/org/geotools/coverage/grid/io/imageio/MaskOverviewProvider.java", "diffHunk": "@@ -787,16 +803,15 @@ public SpiHelper(\n             }\n         }\n \n-        public boolean isMultidim() {\n-            return isMultidim;\n+        public SpiHelper(ReadingAccessObject readObject) throws IOException {\n+            this.readingAccessObject = readObject;", "originalCommit": "e343fbb515cd6d699c450c87004359d0f464101a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE3ODkxMA==", "url": "https://github.com/geotools/geotools/pull/3169#discussion_r500178910", "bodyText": "done. also renamed the base classes\n(see geosolutions-it/imageio-ext#228)", "author": "dromagnoli", "createdAt": "2020-10-06T10:47:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwMzQzMA=="}], "type": "inlineReview", "revised_code": {"commit": "e751f7949ba1938a336c7c45dbb0fa690ec3eb61", "chunk": "diff --git a/modules/library/coverage/src/main/java/org/geotools/coverage/grid/io/imageio/MaskOverviewProvider.java b/modules/library/coverage/src/main/java/org/geotools/coverage/grid/io/imageio/MaskOverviewProvider.java\nindex 578ec2ffbf..f3a7105e8a 100644\n--- a/modules/library/coverage/src/main/java/org/geotools/coverage/grid/io/imageio/MaskOverviewProvider.java\n+++ b/modules/library/coverage/src/main/java/org/geotools/coverage/grid/io/imageio/MaskOverviewProvider.java\n\n@@ -803,31 +787,16 @@ public class MaskOverviewProvider {\n             }\n         }\n \n-        public SpiHelper(ReadingAccessObject readObject) throws IOException {\n-            this.readingAccessObject = readObject;\n-            this.fileURL = new URL(readObject.getSource());\n-            this.suggestedStreamSpi = readObject.getStreamSpi();\n-            this.suggestedSpi = readObject.getReaderSpi();\n+        public SpiHelper(SourceSPIProvider provider) throws IOException {\n+            this.sourceSpiProvider = provider;\n         }\n \n         public boolean isMultidim() {\n             return isMultidim;\n         }\n \n-        public URL getFileURL() {\n-            return fileURL;\n-        }\n-\n-        public ImageReaderSpi getSuggestedSpi() {\n-            return suggestedSpi;\n-        }\n-\n-        public ImageInputStreamSpi getSuggestedStreamSpi() {\n-            return suggestedStreamSpi;\n-        }\n-\n-        public ReadingAccessObject getReadingAccessObject() {\n-            return readingAccessObject;\n+        public SourceSPIProvider getSourceSpiProvider() {\n+            return sourceSpiProvider;\n         }\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwNzU0Mg==", "url": "https://github.com/geotools/geotools/pull/3169#discussion_r499607542", "bodyText": "This is an online test, may not work all the time. Does image mosaic already have a \"online\" test category/profile?", "author": "aaime", "createdAt": "2020-10-05T13:41:59Z", "path": "modules/plugin/geotiff/src/test/java/org/geotools/gce/geotiff/GeoTiffReaderTest.java", "diffHunk": "@@ -1310,6 +1313,32 @@ public void testRescaleWithNodataFloat() throws IOException {\n         }\n     }\n \n+    @Test\n+    public void testCOGRead() throws URISyntaxException, IOException {\n+        String url =", "originalCommit": "e343fbb515cd6d699c450c87004359d0f464101a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDE3OTI5Mw==", "url": "https://github.com/geotools/geotools/pull/3169#discussion_r500179293", "bodyText": "I have moved that test in a self contained XOnlineTest class so that it will be excluded when not using the online profile", "author": "dromagnoli", "createdAt": "2020-10-06T10:48:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYwNzU0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "e751f7949ba1938a336c7c45dbb0fa690ec3eb61", "chunk": "diff --git a/modules/plugin/geotiff/src/test/java/org/geotools/gce/geotiff/GeoTiffReaderTest.java b/modules/plugin/geotiff/src/test/java/org/geotools/gce/geotiff/GeoTiffReaderTest.java\nindex d366fde058..f92276d43d 100644\n--- a/modules/plugin/geotiff/src/test/java/org/geotools/gce/geotiff/GeoTiffReaderTest.java\n+++ b/modules/plugin/geotiff/src/test/java/org/geotools/gce/geotiff/GeoTiffReaderTest.java\n\n@@ -1320,8 +1320,8 @@ public class GeoTiffReaderTest extends org.junit.Assert {\n         CogUri cogUri = new CogUri(url, false);\n         HttpRangeReader rangeReader =\n                 new HttpRangeReader(cogUri.getUri(), CogImageReadParam.DEFAULT_HEADER_LENGTH);\n-        CogReadingAccessObject input =\n-                new CogReadingAccessObject(\n+        CogSourceSPIProvider input =\n+                new CogSourceSPIProvider(\n                         cogUri,\n                         new CogImageReaderSpi(),\n                         new CogImageInputStreamSpi(),\n"}}, {"oid": "e751f7949ba1938a336c7c45dbb0fa690ec3eb61", "url": "https://github.com/geotools/geotools/commit/e751f7949ba1938a336c7c45dbb0fa690ec3eb61", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-06T10:32:42Z", "type": "forcePushed"}, {"oid": "1d651ef1d7a7972618f0902ef0aa14bab0982ac9", "url": "https://github.com/geotools/geotools/commit/1d651ef1d7a7972618f0902ef0aa14bab0982ac9", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-06T10:35:25Z", "type": "forcePushed"}, {"oid": "ecd25b198f2fd5e4b37a48138700adb78207f160", "url": "https://github.com/geotools/geotools/commit/ecd25b198f2fd5e4b37a48138700adb78207f160", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-06T10:40:15Z", "type": "forcePushed"}, {"oid": "629412dc45493c13f21717300238d929601c1b19", "url": "https://github.com/geotools/geotools/commit/629412dc45493c13f21717300238d929601c1b19", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-06T10:41:25Z", "type": "forcePushed"}, {"oid": "7838492d2a59f900a7800f4a6015f9ea668820e9", "url": "https://github.com/geotools/geotools/commit/7838492d2a59f900a7800f4a6015f9ea668820e9", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-07T10:54:18Z", "type": "forcePushed"}, {"oid": "fe4dd534d2f7ae61594a0e898a3ee71bb83cc1e1", "url": "https://github.com/geotools/geotools/commit/fe4dd534d2f7ae61594a0e898a3ee71bb83cc1e1", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-08T15:14:34Z", "type": "forcePushed"}, {"oid": "bad933c44eadc477c1211fd597c45b3df495e86a", "url": "https://github.com/geotools/geotools/commit/bad933c44eadc477c1211fd597c45b3df495e86a", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-20T13:36:52Z", "type": "forcePushed"}, {"oid": "70818041a6da3dc9c2e78d2c85b20e00fc2fb3a6", "url": "https://github.com/geotools/geotools/commit/70818041a6da3dc9c2e78d2c85b20e00fc2fb3a6", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-20T13:59:48Z", "type": "commit"}, {"oid": "70818041a6da3dc9c2e78d2c85b20e00fc2fb3a6", "url": "https://github.com/geotools/geotools/commit/70818041a6da3dc9c2e78d2c85b20e00fc2fb3a6", "message": "[GEOT-6715]: COG Support in GeoTIFF", "committedDate": "2020-10-20T13:59:48Z", "type": "forcePushed"}]}