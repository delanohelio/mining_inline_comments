{"pr_number": 2834, "pr_title": "[GEOT-6520] fix geopkg filter and aggregates", "pr_createdAt": "2020-03-09T20:45:07Z", "pr_url": "https://github.com/geotools/geotools/pull/2834", "timeline": [{"oid": "38390516c511f5b114f2e04cb6b4459a21632ba4", "url": "https://github.com/geotools/geotools/commit/38390516c511f5b114f2e04cb6b4459a21632ba4", "message": "GEOT-6520 - use sql.Date/sql.Timestamp superclass, use utc everywhere (geopkg), add test cases", "committedDate": "2020-03-09T20:34:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk2MTU4OQ==", "url": "https://github.com/geotools/geotools/pull/2834#discussion_r389961589", "bodyText": "That is part of the actual geopackage spec right?", "author": "jodygarnett", "createdAt": "2020-03-09T21:06:15Z", "path": "modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java", "diffHunk": "@@ -496,7 +496,9 @@ public void setValue(\n                 ps.setString(column, ((Time) value).toString());\n                 break;\n             case Types.TIMESTAMP:\n-                ps.setString(column, ((Timestamp) value).toString());\n+                //2020-02-19 23:00:00.0  --> 2020-02-19 23:00:00.0Z\n+                //We need the \"Z\" or sql lite will interpret the value as local time\n+                ps.setString(column, ((Timestamp) value).toString()+\"Z\");", "originalCommit": "38390516c511f5b114f2e04cb6b4459a21632ba4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk2MjIzNw==", "url": "https://github.com/geotools/geotools/pull/2834#discussion_r389962237", "bodyText": "no - this is how the \"datetime()\" function in sql lite works.\nIts a bit of black magic...", "author": "davidblasby", "createdAt": "2020-03-09T21:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk2MTU4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "72bdf400e311ab7acd912c0cb1f3bc284497b6b2", "chunk": "diff --git a/modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java b/modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java\nindex 005aeeee2c..3b25e8181b 100644\n--- a/modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java\n+++ b/modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java\n\n@@ -496,9 +496,9 @@ public class GeoPkgDialect extends PreparedStatementSQLDialect {\n                 ps.setString(column, ((Time) value).toString());\n                 break;\n             case Types.TIMESTAMP:\n-                //2020-02-19 23:00:00.0  --> 2020-02-19 23:00:00.0Z\n-                //We need the \"Z\" or sql lite will interpret the value as local time\n-                ps.setString(column, ((Timestamp) value).toString()+\"Z\");\n+                // 2020-02-19 23:00:00.0  --> 2020-02-19 23:00:00.0Z\n+                // We need the \"Z\" or sql lite will interpret the value as local time\n+                ps.setString(column, ((Timestamp) value).toString() + \"Z\");\n                 break;\n             default:\n                 super.setValue(value, binding, ps, column, cx);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTk2MzY3OA==", "url": "https://github.com/geotools/geotools/pull/2834#discussion_r389963678", "bodyText": "This check looked kind of odd when I first saw it; I guess this dialect knows it is only doing conversions for Date.", "author": "jodygarnett", "createdAt": "2020-03-09T21:10:39Z", "path": "modules/plugin/geopkg/src/main/java/org/geotools/geopkg/GeoPkgDialect.java", "diffHunk": "@@ -642,7 +644,7 @@ protected void addSupportedHints(Set<Hints.Key> hints) {\n             List<Class> resultTypes = maybeResultTypes.get();\n             if (resultTypes.size() == 1) {\n                 Class targetType = resultTypes.get(0);\n-                if (Date.class.isAssignableFrom(targetType)) {\n+                if (java.util.Date.class.isAssignableFrom(targetType)) {", "originalCommit": "38390516c511f5b114f2e04cb6b4459a21632ba4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "72bdf400e311ab7acd912c0cb1f3bc284497b6b2", "url": "https://github.com/geotools/geotools/commit/72bdf400e311ab7acd912c0cb1f3bc284497b6b2", "message": "format changes", "committedDate": "2020-03-09T21:22:41Z", "type": "commit"}]}