{"pr_number": 3123, "pr_title": "Upgrade to JTS 1.17.1 [GEOT-6688]", "pr_createdAt": "2020-08-28T18:16:34Z", "pr_url": "https://github.com/geotools/geotools/pull/3123", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTI4MA==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479581280", "bodyText": "Do we want to raise the access here? Internal feels like it shouldn't be public.", "author": "bradh", "createdAt": "2020-08-29T00:13:43Z", "path": "modules/library/main/src/main/java/org/geotools/geometry/jts/CircularString.java", "diffHunk": "@@ -212,7 +212,11 @@ public String getGeometryType() {\n         return \"CircularString\";\n     }\n \n-    protected Geometry reverseInternal() {\n+    public CircularString reverse() {\n+        return (CircularString) super.reverse();\n+    }\n+\n+    public CircularString reverseInternal() {", "originalCommit": "e03e0972a425b901abff0477e7a011bb501c19e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5MDE4MA==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479590180", "bodyText": "It should not be, mistake made upstream in JTS (sorry)", "author": "jodygarnett", "createdAt": "2020-08-29T01:23:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTI4MA=="}], "type": "inlineReview", "revised_code": {"commit": "f997eae0428dcb0475ddb872d3dcd87946fe285b", "chunk": "diff --git a/modules/library/main/src/main/java/org/geotools/geometry/jts/CircularString.java b/modules/library/main/src/main/java/org/geotools/geometry/jts/CircularString.java\nindex 80d2a14258..5fbf96332b 100644\n--- a/modules/library/main/src/main/java/org/geotools/geometry/jts/CircularString.java\n+++ b/modules/library/main/src/main/java/org/geotools/geometry/jts/CircularString.java\n\n@@ -216,7 +216,7 @@ public class CircularString extends LineString implements SingleCurvedGeometry<L\n         return (CircularString) super.reverse();\n     }\n \n-    public CircularString reverseInternal() {\n+    protected CircularString reverseInternal() {\n         // reverse the control points\n         double[] reversed = new double[controlPoints.length];\n         System.arraycopy(controlPoints, 0, reversed, 0, controlPoints.length);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTM1NA==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479581354", "bodyText": "Do we want to raise the access here? Internal feels like it shouldn't be public.", "author": "bradh", "createdAt": "2020-08-29T00:14:15Z", "path": "modules/library/main/src/main/java/org/geotools/geometry/jts/CompoundCurve.java", "diffHunk": "@@ -187,11 +187,15 @@ public String getGeometryType() {\n         return \"CompoundCurve\";\n     }\n \n-    protected Geometry reverseInternal() {\n+    public CompoundCurve reverse() {\n+        return (CompoundCurve) super.reverse();\n+    }\n+\n+    public CompoundCurve reverseInternal() {", "originalCommit": "e03e0972a425b901abff0477e7a011bb501c19e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU5MDE5Mg==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479590192", "bodyText": "It should not be, mistake made upstream in JTS (sorry)", "author": "jodygarnett", "createdAt": "2020-08-29T01:24:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTM1NA=="}], "type": "inlineReview", "revised_code": {"commit": "f997eae0428dcb0475ddb872d3dcd87946fe285b", "chunk": "diff --git a/modules/library/main/src/main/java/org/geotools/geometry/jts/CompoundCurve.java b/modules/library/main/src/main/java/org/geotools/geometry/jts/CompoundCurve.java\nindex 044224919e..299a936a72 100644\n--- a/modules/library/main/src/main/java/org/geotools/geometry/jts/CompoundCurve.java\n+++ b/modules/library/main/src/main/java/org/geotools/geometry/jts/CompoundCurve.java\n\n@@ -191,6 +191,7 @@ public class CompoundCurve extends LineString implements CompoundCurvedGeometry<\n         return (CompoundCurve) super.reverse();\n     }\n \n+    // should be protected when fixed in LinearRing\n     public CompoundCurve reverseInternal() {\n         // reverse the component, and reverse each component internal elements\n         List<LineString> reversedComponents = new ArrayList<>(components.size());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTU5Nw==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479581597", "bodyText": "This should be fixed or removed.", "author": "bradh", "createdAt": "2020-08-29T00:15:39Z", "path": "modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java", "diffHunk": "@@ -164,7 +164,7 @@ public void testVersion() {\n \n         version = GeoTools.getVersion(Geometry.class);\n         assertNotNull(version);\n-        assertTrue(version.toString().startsWith(\"1.17\"));\n+        //        assertTrue(version.toString().startsWith(\"1.17\"));", "originalCommit": "e03e0972a425b901abff0477e7a011bb501c19e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MzUwMg==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479583502", "bodyText": "I kind of want to keep it, we do need to upgrade each time we change the jts library - but I do want to check the version number of a \"normal jar\" here.", "author": "jodygarnett", "createdAt": "2020-08-29T00:28:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4ODU5OA==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479588598", "bodyText": "you know the case being tested here (extracting version number from jar name) is covered by JAI.class above", "author": "jodygarnett", "createdAt": "2020-08-29T01:09:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MTU5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "f997eae0428dcb0475ddb872d3dcd87946fe285b", "chunk": "diff --git a/modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java b/modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java\nindex 55b2a6b37a..c1922a412a 100644\n--- a/modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java\n+++ b/modules/library/metadata/src/test/java/org/geotools/util/factory/GeoToolsTest.java\n\n@@ -161,10 +161,6 @@ public final class GeoToolsTest {\n         version = GeoTools.getVersion(LogFactory.class);\n         assertNotNull(version);\n         assertEquals(\"1.1.1\", version.toString());\n-\n-        version = GeoTools.getVersion(Geometry.class);\n-        assertNotNull(version);\n-        //        assertTrue(version.toString().startsWith(\"1.17\"));\n     }\n     /** Tests the use of system properties. */\n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MjgxNA==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479582814", "bodyText": "Is there a unit test covering this?", "author": "bradh", "createdAt": "2020-08-29T00:24:10Z", "path": "modules/unsupported/process-feature/src/main/java/org/geotools/process/vector/ClipProcess.java", "diffHunk": "@@ -292,6 +281,19 @@ private Object clipGeometry(Geometry geom, Class target, CoordinateReferenceSyst\n \n             // manage Z preservation\n             if (preserveZ && !geom.equalsExact(clipped)) {\n+                // Check if the clipped geometry has 3 ordinates across entire area.", "originalCommit": "e03e0972a425b901abff0477e7a011bb501c19e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MzczMQ==", "url": "https://github.com/geotools/geotools/pull/3123#discussion_r479583731", "bodyText": "Yes, it was failing hence the reason for the fix.\nWe actually found this fix when upgrading to 1.16 and introduced some code in CoordinateArraySequence to \"fix\" bad arrays. However that slowed down things everywhere rather than this one spot which is the only known example where we end up mixing coordinates.", "author": "jodygarnett", "createdAt": "2020-08-29T00:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU4MjgxNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "f997eae0428dcb0475ddb872d3dcd87946fe285b", "url": "https://github.com/geotools/geotools/commit/f997eae0428dcb0475ddb872d3dcd87946fe285b", "message": "Upgrade to JTS 1.17.1.\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-08-29T01:12:08Z", "type": "commit"}, {"oid": "f997eae0428dcb0475ddb872d3dcd87946fe285b", "url": "https://github.com/geotools/geotools/commit/f997eae0428dcb0475ddb872d3dcd87946fe285b", "message": "Upgrade to JTS 1.17.1.\n\nSigned-off-by: Jody Garnett <jody.garnett@gmail.com>", "committedDate": "2020-08-29T01:12:08Z", "type": "forcePushed"}]}