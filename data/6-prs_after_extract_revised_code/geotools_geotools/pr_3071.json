{"pr_number": 3071, "pr_title": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "pr_createdAt": "2020-07-13T17:55:16Z", "pr_url": "https://github.com/geotools/geotools/pull/3071", "timeline": [{"oid": "0c93d266256bf28bb6344ae0fb242babe3b29bd0", "url": "https://github.com/geotools/geotools/commit/0c93d266256bf28bb6344ae0fb242babe3b29bd0", "message": "fix GEOT-6389", "committedDate": "2020-07-13T17:47:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3NzEwMQ==", "url": "https://github.com/geotools/geotools/pull/3071#discussion_r457177101", "bodyText": "I would go and make sure it's not null, not empty, and not blank, all vendor options are supposed to have some content.\nCommons-lang3 is in the classpath here, using SystemUtils.isNotBlank should do the trick.", "author": "aaime", "createdAt": "2020-07-20T08:34:16Z", "path": "modules/library/xml/src/main/java/org/geotools/xml/styling/SLDParser.java", "diffHunk": "@@ -1253,8 +1253,9 @@ protected OtherText parseOtherText(Node root) {\n     private void parseVendorOption(Map<String, String> options, Node child) {\n         String key = child.getAttributes().getNamedItem(\"name\").getNodeValue();\n         String value = getFirstChildValue(child);\n-\n-        options.put(key, value);\n+        if (value != null) {", "originalCommit": "0c93d266256bf28bb6344ae0fb242babe3b29bd0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0bfce40ad44e7084c2806b380e170d87448de4e2", "chunk": "diff --git a/modules/library/xml/src/main/java/org/geotools/xml/styling/SLDParser.java b/modules/library/xml/src/main/java/org/geotools/xml/styling/SLDParser.java\nindex f226d9b1ac..e3935e1e93 100644\n--- a/modules/library/xml/src/main/java/org/geotools/xml/styling/SLDParser.java\n+++ b/modules/library/xml/src/main/java/org/geotools/xml/styling/SLDParser.java\n\n@@ -1253,7 +1254,7 @@ public class SLDParser {\n     private void parseVendorOption(Map<String, String> options, Node child) {\n         String key = child.getAttributes().getNamedItem(\"name\").getNodeValue();\n         String value = getFirstChildValue(child);\n-        if (value != null) {\n+        if (StringUtils.isNotBlank(value)) {\n             options.put(key, value);\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3ODcyNg==", "url": "https://github.com/geotools/geotools/pull/3071#discussion_r457178726", "bodyText": "Reformats in PRs are not welcomed, please remove all of them.", "author": "aaime", "createdAt": "2020-07-20T08:36:11Z", "path": "modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java", "diffHunk": "@@ -630,7 +655,8 @@ public void testExternalEntitiesDisabled() {\n         // this SLD file references as external entity a file on the local filesystem\n         SLDParser parser = new SLDParser(styleFactory, input(SLD_EXTERNALENTITY));\n \n-        // without a custom EntityResolver, the parser will try to read the entity file on the local\n+        // without a custom EntityResolver, the parser will try to read the entity file", "originalCommit": "0c93d266256bf28bb6344ae0fb242babe3b29bd0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0bfce40ad44e7084c2806b380e170d87448de4e2", "chunk": "diff --git a/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java b/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\nindex ceae7147a7..27a8692e01 100644\n--- a/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\n+++ b/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\n\n@@ -655,8 +655,7 @@ public class SLDParserTest {\n         // this SLD file references as external entity a file on the local filesystem\n         SLDParser parser = new SLDParser(styleFactory, input(SLD_EXTERNALENTITY));\n \n-        // without a custom EntityResolver, the parser will try to read the entity file\n-        // on the local\n+        // without a custom EntityResolver, the parser will try to read the entity file on the local\n         // file system\n         try {\n             parser.readXML();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzE3OTA2MQ==", "url": "https://github.com/geotools/geotools/pull/3071#discussion_r457179061", "bodyText": "Also make sure it's the one you want here (by checking the available keys).", "author": "aaime", "createdAt": "2020-07-20T08:36:38Z", "path": "modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java", "diffHunk": "@@ -756,6 +784,20 @@ public void testContrastEnhancement() throws Exception {\n         assertTrue(\"Params should be empty\", params.isEmpty());\n     }\n \n+    @Test\n+    public void testNullVendorObject() throws Exception {\n+\n+        SLDParser parser = new SLDParser(styleFactory, input(SLD_NULL_VENDOR_OPTION));\n+        Style[] styles = parser.readXML();\n+        List<FeatureTypeStyle> fts = styles[0].featureTypeStyles();\n+        List<Rule> rules = fts.get(0).rules();\n+        List<Symbolizer> symbolizers = rules.get(0).symbolizers();\n+\n+        PointSymbolizer ps = (PointSymbolizer) symbolizers.get(0);\n+\n+        assertEquals(1, ps.getOptions().size());", "originalCommit": "0c93d266256bf28bb6344ae0fb242babe3b29bd0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0bfce40ad44e7084c2806b380e170d87448de4e2", "chunk": "diff --git a/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java b/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\nindex ceae7147a7..27a8692e01 100644\n--- a/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\n+++ b/modules/library/xml/src/test/java/org/geotools/xml/styling/SLDParserTest.java\n\n@@ -787,6 +784,8 @@ public class SLDParserTest {\n     @Test\n     public void testNullVendorObject() throws Exception {\n \n+        final String OK_KEY = \"OkVendor\";\n+\n         SLDParser parser = new SLDParser(styleFactory, input(SLD_NULL_VENDOR_OPTION));\n         Style[] styles = parser.readXML();\n         List<FeatureTypeStyle> fts = styles[0].featureTypeStyles();\n"}}, {"oid": "d4db4697863008be55ac55f8159ed3c98d95b392", "url": "https://github.com/geotools/geotools/commit/d4db4697863008be55ac55f8159ed3c98d95b392", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-20T09:48:28Z", "type": "commit"}, {"oid": "81103dd8da46a35fe7f28ca4278a7171b9bf9be1", "url": "https://github.com/geotools/geotools/commit/81103dd8da46a35fe7f28ca4278a7171b9bf9be1", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-20T09:50:35Z", "type": "commit"}, {"oid": "99ab075dab6085618acba011a236d2072e7ba2b0", "url": "https://github.com/geotools/geotools/commit/99ab075dab6085618acba011a236d2072e7ba2b0", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-20T09:52:18Z", "type": "commit"}, {"oid": "0bfce40ad44e7084c2806b380e170d87448de4e2", "url": "https://github.com/geotools/geotools/commit/0bfce40ad44e7084c2806b380e170d87448de4e2", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-20T09:57:23Z", "type": "commit"}, {"oid": "7ec55acb2cd933bcf7146482d1d4d4f58f2c9ab5", "url": "https://github.com/geotools/geotools/commit/7ec55acb2cd933bcf7146482d1d4d4f58f2c9ab5", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-20T12:02:18Z", "type": "commit"}, {"oid": "e5d758c6368f4df2cb5c72e572d354869978e849", "url": "https://github.com/geotools/geotools/commit/e5d758c6368f4df2cb5c72e572d354869978e849", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-21T10:16:28Z", "type": "commit"}, {"oid": "b9ca4928e6f8da1277f2c7b7c3a64cdd3f062f8d", "url": "https://github.com/geotools/geotools/commit/b9ca4928e6f8da1277f2c7b7c3a64cdd3f062f8d", "message": "Merge branch 'fix_GEOT-6389' of https://github.com/dfiorent/geotools into fix_GEOT-6389", "committedDate": "2020-07-21T10:16:51Z", "type": "commit"}, {"oid": "cf6666c05da3b918833a7aaae18cdff186972c10", "url": "https://github.com/geotools/geotools/commit/cf6666c05da3b918833a7aaae18cdff186972c10", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-21T10:29:40Z", "type": "commit"}, {"oid": "83c957b55d1fe0161b3dcb8279c7f709b0e2e40b", "url": "https://github.com/geotools/geotools/commit/83c957b55d1fe0161b3dcb8279c7f709b0e2e40b", "message": "[GEOT-6389] SLD vendor option graphic-margin can't be empty", "committedDate": "2020-07-21T10:32:45Z", "type": "commit"}]}