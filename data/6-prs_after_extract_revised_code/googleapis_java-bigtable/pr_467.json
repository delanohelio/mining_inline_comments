{"pr_number": 467, "pr_title": "feat: attemp DirectPath by default", "pr_createdAt": "2020-10-14T19:15:31Z", "pr_url": "https://github.com/googleapis/java-bigtable/pull/467", "timeline": [{"oid": "065fd56c33de4dbcd25faf5661a23351992b14be", "url": "https://github.com/googleapis/java-bigtable/commit/065fd56c33de4dbcd25faf5661a23351992b14be", "message": "feat: attemp DirectPath by default", "committedDate": "2020-10-14T19:02:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxMzc4Mg==", "url": "https://github.com/googleapis/java-bigtable/pull/467#discussion_r505613782", "bodyText": "is there anywhere we can keep this logging information to confirm (in tests, for example) that we are connecting using DirectPath?", "author": "kolea2", "createdAt": "2020-10-15T14:59:31Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java", "diffHunk": "@@ -166,12 +163,6 @@\n   private EnhancedBigtableStubSettings(Builder builder) {\n     super(builder);\n \n-    if (DIRECT_PATH_ENDPOINT.equals(builder.getEndpoint())) {\n-      logger.warning(\n-          \"Connecting to Bigtable using DirectPath.\"", "originalCommit": "065fd56c33de4dbcd25faf5661a23351992b14be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxODcwOA==", "url": "https://github.com/googleapis/java-bigtable/pull/467#discussion_r505618708", "bodyText": "For tests we inject hooks into netty to ensure that directpath is used, also the integration tests generate verbose grpc logs which would show directpath usage. For prod usage, we dont really have a good way to introspect it as its a grpc level feature", "author": "igorbernstein2", "createdAt": "2020-10-15T15:05:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxMzc4Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxNTU2Nw==", "url": "https://github.com/googleapis/java-bigtable/pull/467#discussion_r505615567", "bodyText": "Can you add a  comment on why we attemt DirectPath? to give context to future readers.", "author": "mgarolera", "createdAt": "2020-10-15T15:01:40Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java", "diffHunk": "@@ -245,13 +236,7 @@ public boolean isRefreshingChannel() {\n         .setKeepAliveTimeout(\n             Duration.ofSeconds(10)) // wait this long before considering the connection dead\n         .setKeepAliveWithoutCalls(true) // sends ping without active streams\n-        // TODO(weiranf): Set this to true by default once DirectPath goes to public beta\n-        .setAttemptDirectPath(isDirectPathEnabled());\n-  }\n-\n-  // TODO(weiranf): Remove this once DirectPath goes to public beta\n-  private static boolean isDirectPathEnabled() {\n-    return Boolean.getBoolean(\"bigtable.attempt-directpath\");\n+        .setAttemptDirectPath(true);", "originalCommit": "065fd56c33de4dbcd25faf5661a23351992b14be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY5OTQ5NA==", "url": "https://github.com/googleapis/java-bigtable/pull/467#discussion_r505699494", "bodyText": "Added comment. PTAL at the wording, thanks!", "author": "WeiranFang", "createdAt": "2020-10-15T17:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxNTU2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "d9bfde298d61e033166f51318d901d606e09af45", "chunk": "diff --git a/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java b/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java\nindex 9cfcc16d..bd118815 100644\n--- a/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java\n+++ b/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/stub/EnhancedBigtableStubSettings.java\n\n@@ -236,6 +236,8 @@ public class EnhancedBigtableStubSettings extends StubSettings<EnhancedBigtableS\n         .setKeepAliveTimeout(\n             Duration.ofSeconds(10)) // wait this long before considering the connection dead\n         .setKeepAliveWithoutCalls(true) // sends ping without active streams\n+        // Attempts direct access to CBT service over gRPC to improve throughput,\n+        // whether the attempt is allowed is totally controlled by service owner.\n         .setAttemptDirectPath(true);\n   }\n \n"}}, {"oid": "d9bfde298d61e033166f51318d901d606e09af45", "url": "https://github.com/googleapis/java-bigtable/commit/d9bfde298d61e033166f51318d901d606e09af45", "message": "Add comment for DP attempt", "committedDate": "2020-10-15T16:59:26Z", "type": "commit"}]}