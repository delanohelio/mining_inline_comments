{"pr_number": 166, "pr_title": "chore: add filter size check on read row request", "pr_createdAt": "2020-01-23T07:56:11Z", "pr_url": "https://github.com/googleapis/java-bigtable/pull/166", "timeline": [{"oid": "80cabb83570509dba173a3a9a651adb58f58a4b5", "url": "https://github.com/googleapis/java-bigtable/commit/80cabb83570509dba173a3a9a651adb58f58a4b5", "message": "chore: add filter size check on read row request\n\nCurrently, bigtable could only serve read row request with filter size of 20MB only. So adding this check to stop server request.", "committedDate": "2020-01-22T15:46:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1ODc3NQ==", "url": "https://github.com/googleapis/java-bigtable/pull/166#discussion_r370258775", "bodyText": "can we add a test please?", "author": "kolea2", "createdAt": "2020-01-23T17:36:28Z", "path": "google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/Query.java", "diffHunk": "@@ -162,7 +166,11 @@ public Query range(ByteStringRange range) {\n    * filters, please use {@link Filters#interleave()} or {@link Filters#chain()}.\n    */\n   public Query filter(Filters.Filter filter) {\n-    builder.setFilter(filter.toProto());\n+    Preconditions.checkNotNull(filter, \"filter can't be null\");", "originalCommit": "80cabb83570509dba173a3a9a651adb58f58a4b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI3NTA1MA==", "url": "https://github.com/googleapis/java-bigtable/pull/166#discussion_r370275050", "bodyText": "Thanks for the review. Added test case for null check. I haven't added any test case for the filter size. I hope that should be fine.", "author": "rahulKQL", "createdAt": "2020-01-23T18:11:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1ODc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5NTQyMQ==", "url": "https://github.com/googleapis/java-bigtable/pull/166#discussion_r370295421", "bodyText": "Apologies for being unclear, if you could add a test case for filter size as well that would be awesome :)", "author": "kolea2", "createdAt": "2020-01-23T18:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1ODc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5ODkwOA==", "url": "https://github.com/googleapis/java-bigtable/pull/166#discussion_r370298908", "bodyText": "I intentionally didn't add test case for that. Reason being the filter size needs to be more than 20MB, I thought that'd be a little large.\nI would add unit test right away.", "author": "rahulKQL", "createdAt": "2020-01-23T19:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1ODc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwMTcxNA==", "url": "https://github.com/googleapis/java-bigtable/pull/166#discussion_r370301714", "bodyText": "Understood - LGTM. @igorbernstein2 any other thoughts?", "author": "kolea2", "createdAt": "2020-01-23T19:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI1ODc3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "9c4b7d65040cef128537a4cfa360df01605bd2f6", "chunk": "diff --git a/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/Query.java b/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/Query.java\nindex 403afd1d..765fa012 100644\n--- a/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/Query.java\n+++ b/google-cloud-bigtable/src/main/java/com/google/cloud/bigtable/data/v2/models/Query.java\n\n@@ -167,9 +167,11 @@ public final class Query implements Serializable {\n    */\n   public Query filter(Filters.Filter filter) {\n     Preconditions.checkNotNull(filter, \"filter can't be null\");\n+\n     RowFilter rowFilter = filter.toProto();\n     Preconditions.checkArgument(\n         rowFilter.getSerializedSize() < MAX_FILTER_SIZE, \"filter size can't be more than 20MB\");\n+\n     builder.setFilter(rowFilter);\n     return this;\n   }\n"}}, {"oid": "9c4b7d65040cef128537a4cfa360df01605bd2f6", "url": "https://github.com/googleapis/java-bigtable/commit/9c4b7d65040cef128537a4cfa360df01605bd2f6", "message": "adding unit test case", "committedDate": "2020-01-23T18:02:13Z", "type": "commit"}, {"oid": "091fcd894922a325c15a93c04dbb94a33419fcf6", "url": "https://github.com/googleapis/java-bigtable/commit/091fcd894922a325c15a93c04dbb94a33419fcf6", "message": "adding unit test for filter size", "committedDate": "2020-01-23T19:10:10Z", "type": "commit"}]}