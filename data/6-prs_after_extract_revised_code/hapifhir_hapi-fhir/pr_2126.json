{"pr_number": 2126, "pr_title": "add CorsInterceptorTest", "pr_createdAt": "2020-10-11T07:09:05Z", "pr_url": "https://github.com/hapifhir/hapi-fhir/pull/2126", "timeline": [{"oid": "685c5b69149ada71944b5377d84995e651f558b4", "url": "https://github.com/hapifhir/hapi-fhir/commit/685c5b69149ada71944b5377d84995e651f558b4", "message": "add simple CorsInterceptorTest", "committedDate": "2020-10-11T06:35:45Z", "type": "commit"}, {"oid": "dbeeba9e4d2c8a57e0f1f0f5d901fb5963ceb30a", "url": "https://github.com/hapifhir/hapi-fhir/commit/dbeeba9e4d2c8a57e0f1f0f5d901fb5963ceb30a", "message": "add relevant exposedHeaders to custom CorsConfiguration", "committedDate": "2020-10-11T08:31:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxNDYwNA==", "url": "https://github.com/hapifhir/hapi-fhir/pull/2126#discussion_r502914604", "bodyText": "Output should be done with a logger, e.g. ourLog.info(\"Custom CorsConfiguration\");. See other tests in this project for examples.", "author": "jamesagnew", "createdAt": "2020-10-11T13:17:51Z", "path": "hapi-fhir-server/src/test/java/ca/uhn/fhir/rest/server/interceptor/CorsInterceptorTest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package ca.uhn.fhir.rest.server.interceptor;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.junit.jupiter.api.Assertions.assertNull;\n+import static org.junit.jupiter.api.Assertions.assertSame;\n+\n+import java.util.Arrays;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.web.cors.CorsConfiguration;\n+\n+public class CorsInterceptorTest {\n+\n+\t@Test\n+\tpublic void testCustomCorsConfig() {\n+\t\tCorsConfiguration corsConfiguration = new CorsConfiguration();\n+\t\tcorsConfiguration.applyPermitDefaultValues();\n+\t\tcorsConfiguration.setAllowedMethods(Arrays.asList(new String[] { \"*\" }));\n+\t\tcorsConfiguration.setExposedHeaders(Arrays.asList(new String[] {\n+\t\t\t\"Content-Location\",\n+\t\t\t\"Date\",\n+\t\t\t\"ETag\",\n+\t\t\t\"Location\",\n+\t\t\t\"X-Request-Id\",\n+\t\t\t\"X-Correlation-Id\"\n+\t\t}));\n+\t\tCorsInterceptor corsInterceptor = new CorsInterceptor(corsConfiguration);\n+\n+System.err.println(\"Custom CorsConfiguration\");", "originalCommit": "dbeeba9e4d2c8a57e0f1f0f5d901fb5963ceb30a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA2ODIyMQ==", "url": "https://github.com/hapifhir/hapi-fhir/pull/2126#discussion_r503068221", "bodyText": "Ok, done ...\nI revised the code to use SLF4J Logger.info() instead of System.err.println(), and also modified the code to run the test assertions before executing the potentially brittle log output code.\nAdditionally, in pom.xml I added a test-scoped logback-classic dependency, because SLF4J was defaulting to a NOP logger implementation without it (see also http://www.slf4j.org/codes.html#StaticLoggerBinder).", "author": "jschneid-nmdp", "createdAt": "2020-10-12T06:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxNDYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0Nzk5Mw==", "url": "https://github.com/hapifhir/hapi-fhir/pull/2126#discussion_r503547993", "bodyText": "Thanks! Merging now", "author": "jamesagnew", "createdAt": "2020-10-12T21:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkxNDYwNA=="}], "type": "inlineReview", "revised_code": {"commit": "4b4cb1c450e7cbb92acdfe457a4e4767aa9b6689", "chunk": "diff --git a/hapi-fhir-server/src/test/java/ca/uhn/fhir/rest/server/interceptor/CorsInterceptorTest.java b/hapi-fhir-server/src/test/java/ca/uhn/fhir/rest/server/interceptor/CorsInterceptorTest.java\nindex c26a95832a..4204d07ade 100644\n--- a/hapi-fhir-server/src/test/java/ca/uhn/fhir/rest/server/interceptor/CorsInterceptorTest.java\n+++ b/hapi-fhir-server/src/test/java/ca/uhn/fhir/rest/server/interceptor/CorsInterceptorTest.java\n\n@@ -7,11 +7,15 @@ import static org.junit.jupiter.api.Assertions.assertSame;\n \n import java.util.Arrays;\n import org.junit.jupiter.api.Test;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.springframework.http.HttpMethod;\n import org.springframework.web.cors.CorsConfiguration;\n \n public class CorsInterceptorTest {\n \n+\tprivate static final Logger ourLog = LoggerFactory.getLogger(CorsInterceptorTest.class);\n+\n \t@Test\n \tpublic void testCustomCorsConfig() {\n \t\tCorsConfiguration corsConfiguration = new CorsConfiguration();\n"}}, {"oid": "4b4cb1c450e7cbb92acdfe457a4e4767aa9b6689", "url": "https://github.com/hapifhir/hapi-fhir/commit/4b4cb1c450e7cbb92acdfe457a4e4767aa9b6689", "message": "use SLF4J Logger.info() instead of System.err.println(), and run the test assertions first", "committedDate": "2020-10-12T06:24:12Z", "type": "commit"}, {"oid": "d0821127b8124b3110444d19363c855a5c8fcf22", "url": "https://github.com/hapifhir/hapi-fhir/commit/d0821127b8124b3110444d19363c855a5c8fcf22", "message": "Add logback-classic dependency to test scope, to enable SLF4J logging within unit tests.  (SLF4J defaults to NOP binding if no binding found on classpath, see also http://www.slf4j.org/codes.html#StaticLoggerBinder)", "committedDate": "2020-10-12T06:29:00Z", "type": "commit"}]}