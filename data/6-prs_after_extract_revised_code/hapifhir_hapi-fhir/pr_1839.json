{"pr_number": 1839, "pr_title": "resolves #1838", "pr_createdAt": "2020-05-10T19:40:18Z", "pr_url": "https://github.com/hapifhir/hapi-fhir/pull/1839", "timeline": [{"oid": "d280d044fa9b587c06bc8dd43b1d82683b2f2e5c", "url": "https://github.com/hapifhir/hapi-fhir/commit/d280d044fa9b587c06bc8dd43b1d82683b2f2e5c", "message": "Added %today that works like %now but with date precision instead of dateTime precision.", "committedDate": "2020-05-10T19:39:14Z", "type": "commit"}, {"oid": "7aa646ed078965ee7fac7c0a5e737c661bd81914", "url": "https://github.com/hapifhir/hapi-fhir/commit/7aa646ed078965ee7fac7c0a5e737c661bd81914", "message": "typo", "committedDate": "2020-05-10T19:40:59Z", "type": "commit"}, {"oid": "25298cb6cbfba9eb8155cd82882ba176b5340a45", "url": "https://github.com/hapifhir/hapi-fhir/commit/25298cb6cbfba9eb8155cd82882ba176b5340a45", "message": "added a couple more tests", "committedDate": "2020-05-10T19:53:11Z", "type": "commit"}, {"oid": "711afd48bee5c0b0be8f50e13323d801c4ce94c5", "url": "https://github.com/hapifhir/hapi-fhir/commit/711afd48bee5c0b0be8f50e13323d801c4ce94c5", "message": "prevent minute test from running between 23:59 and midnight", "committedDate": "2020-05-10T20:07:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEwMTYzMA==", "url": "https://github.com/hapifhir/hapi-fhir/pull/1839#discussion_r423101630", "bodyText": "I have a small concern/question here, as %today could be wrong if we rely on new Date(). Consider this scenario:\nIt is 2020-05-11T07:51:00-0700 in Vancouver.\nIt is 2020-05-12T00:50:00+1000 in Melbourne.\nA request coming in from a client in Melbourne using %today would expect it to resolve to the ordinal 20200512, but with current implementation, it would resolve to 20200511 if the server is in Vancouver I think. However there is no easy way to know tz on these requests. Perhaps modify the documentation to indicate that %today is for server date? If i'm mistaken and this is already spelled out, thats fine.", "author": "tadgh", "createdAt": "2020-05-11T14:57:21Z", "path": "hapi-fhir-base/src/main/java/ca/uhn/fhir/model/primitive/BaseDateTimeDt.java", "diffHunk": "@@ -638,6 +639,9 @@ public void setValueAsString(String theValue) throws DataFormatException {\n \n \t\tif (NOW_DATE_CONSTANT.equalsIgnoreCase(theValue)) {\n \t\t\tsuper.setValueAsString(ourXmlDateTimeFormat.format(new Date()));\n+\t\t} else if (TODAY_DATE_CONSTANT.equalsIgnoreCase(theValue)) {\n+\t\t\tsuper.setValueAsString(ourXmlDateTimeFormat.format(new Date()));\n+\t\t\tsetPrecision(TemporalPrecisionEnum.DAY);", "originalCommit": "711afd48bee5c0b0be8f50e13323d801c4ce94c5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "c7d76cd0e8f91d600ac7cb10f63cceccfc7c809f", "url": "https://github.com/hapifhir/hapi-fhir/commit/c7d76cd0e8f91d600ac7cb10f63cceccfc7c809f", "message": "Merge remote-tracking branch 'remotes/origin/master' into ks-20200510-today-date-param", "committedDate": "2020-06-04T13:49:14Z", "type": "commit"}]}