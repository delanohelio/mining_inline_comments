{"pr_number": 1994, "pr_title": "Fix mssql errors", "pr_createdAt": "2020-07-23T14:24:41Z", "pr_url": "https://github.com/hapifhir/hapi-fhir/pull/1994", "timeline": [{"oid": "f28531818519ad2f43aa0cb2697485bb96614d87", "url": "https://github.com/hapifhir/hapi-fhir/commit/f28531818519ad2f43aa0cb2697485bb96614d87", "message": "Add mssql to drop FK constraints when column is dropped", "committedDate": "2020-07-22T16:21:50Z", "type": "commit"}, {"oid": "6f1d46dc68de5cae853c8d114adb83f4267f4b46", "url": "https://github.com/hapifhir/hapi-fhir/commit/6f1d46dc68de5cae853c8d114adb83f4267f4b46", "message": "modify add index logic to behave like the other jdbc databases", "committedDate": "2020-07-22T16:21:58Z", "type": "commit"}, {"oid": "92312537a600b1dc431d6f4625a743fb09a84205", "url": "https://github.com/hapifhir/hapi-fhir/commit/92312537a600b1dc431d6f4625a743fb09a84205", "message": "Modify drop index syntax for mssql", "committedDate": "2020-07-22T16:22:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ5MTAwMw==", "url": "https://github.com/hapifhir/hapi-fhir/pull/1994#discussion_r459491003", "bodyText": "The old drop index statement mixed with the new method to create unique indexes removes the fact that we also create a unique constraint on the column too", "author": "michelgleeson", "createdAt": "2020-07-23T14:26:56Z", "path": "hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/DropIndexTask.java", "diffHunk": "@@ -117,7 +117,7 @@ protected void generateHashCode(HashCodeBuilder theBuilder) {\n \t\t\t\tcase DERBY_EMBEDDED:\n \t\t\t\tcase ORACLE_12C:\n \t\t\t\tcase MSSQL_2012:\n-\t\t\t\t\tsql.add(\"alter table \" + theTableName + \" drop constraint \" + theIndexName);\n+\t\t\t\t\tsql.add(\"drop index \" + theIndexName + \" on \" + theTableName);", "originalCommit": "92312537a600b1dc431d6f4625a743fb09a84205", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b67f30a03ba725e0f249e028d8d5b539b8c17d61", "chunk": "diff --git a/hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/DropIndexTask.java b/hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/DropIndexTask.java\nindex 037cd81b33..ae15fa6c8a 100644\n--- a/hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/DropIndexTask.java\n+++ b/hapi-fhir-jpaserver-migrate/src/main/java/ca/uhn/fhir/jpa/migrate/taskdef/DropIndexTask.java\n\n@@ -116,6 +116,8 @@ public class DropIndexTask extends BaseTableTask {\n \t\t\t\t\tbreak;\n \t\t\t\tcase DERBY_EMBEDDED:\n \t\t\t\tcase ORACLE_12C:\n+\t\t\t\t\tsql.add(\"alter table \" + theTableName + \" drop constraint \" + theIndexName);\n+\t\t\t\t\tbreak;\n \t\t\t\tcase MSSQL_2012:\n \t\t\t\t\tsql.add(\"drop index \" + theIndexName + \" on \" + theTableName);\n \t\t\t\t\tbreak;\n"}}, {"oid": "7b435d6052a1b773e4a996ef2c6c924701b3b949", "url": "https://github.com/hapifhir/hapi-fhir/commit/7b435d6052a1b773e4a996ef2c6c924701b3b949", "message": "changelog for mssql changers", "committedDate": "2020-07-23T16:16:11Z", "type": "commit"}, {"oid": "b67f30a03ba725e0f249e028d8d5b539b8c17d61", "url": "https://github.com/hapifhir/hapi-fhir/commit/b67f30a03ba725e0f249e028d8d5b539b8c17d61", "message": "fix oracle and derby default", "committedDate": "2020-07-24T14:03:21Z", "type": "commit"}]}