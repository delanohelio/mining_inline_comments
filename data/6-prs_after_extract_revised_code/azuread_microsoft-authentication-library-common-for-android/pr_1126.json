{"pr_number": 1126, "pr_title": "Add escape sequence test and ensure .trim() lookup rules are applied to in-mem filtering logic", "pr_createdAt": "2020-11-13T19:56:54Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1126", "timeline": [{"oid": "5f96cc420259e5e35c89ccd25165bc20b6cc8c62", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5f96cc420259e5e35c89ccd25165bc20b6cc8c62", "message": "Add escape sequence test", "committedDate": "2020-11-13T19:55:50Z", "type": "commit"}, {"oid": "7b847efc7151ec5fea3355942605c5f6feb6fc7b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/7b847efc7151ec5fea3355942605c5f6feb6fc7b", "message": "Merge branch 'dev' into iambmelt/add-escape-char-test", "committedDate": "2020-11-13T19:57:10Z", "type": "commit"}, {"oid": "fb82eb685a5edac980ac3be2fa02084ab1500b8a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fb82eb685a5edac980ac3be2fa02084ab1500b8a", "message": "Update cache key test", "committedDate": "2020-11-13T20:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjk5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1126#discussion_r523236991", "bodyText": "Is this the only field that has this behavior?", "author": "AdamBJohnsonx", "createdAt": "2020-11-13T21:17:25Z", "path": "common/src/test/java/com/microsoft/identity/common/CacheKeyValueDelegateTest.java", "diffHunk": "@@ -95,6 +95,26 @@ public void accessTokenCreateCacheKeyComplete() {\n         assertEquals(expectedKey, mDelegate.generateCacheKey(accessToken));\n     }\n \n+    @Test\n+    public void accessTokenCreateCacheKeyCompleteWithEscapeSequences() {\n+        final AccessTokenRecord accessToken = new AccessTokenRecord();\n+        accessToken.setHomeAccountId(HOME_ACCOUNT_ID);\n+        accessToken.setEnvironment(\"\\r\\f\\n\\t\" + ENVIRONMENT + \"\\r\\f\\n\\t\");", "originalCommit": "7b847efc7151ec5fea3355942605c5f6feb6fc7b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzI0NDMxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1126#discussion_r523244316", "bodyText": "They all should - can broaden this test to make this clearer.", "author": "iambmelt", "createdAt": "2020-11-13T21:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzIzNjk5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "143ebc6487dc5b05728bd327c4aa7d41e823ba42", "chunk": "diff --git a/common/src/test/java/com/microsoft/identity/common/CacheKeyValueDelegateTest.java b/common/src/test/java/com/microsoft/identity/common/CacheKeyValueDelegateTest.java\nindex fed00d5d3..128eb91b9 100644\n--- a/common/src/test/java/com/microsoft/identity/common/CacheKeyValueDelegateTest.java\n+++ b/common/src/test/java/com/microsoft/identity/common/CacheKeyValueDelegateTest.java\n\n@@ -98,12 +103,12 @@ public class CacheKeyValueDelegateTest {\n     @Test\n     public void accessTokenCreateCacheKeyCompleteWithEscapeSequences() {\n         final AccessTokenRecord accessToken = new AccessTokenRecord();\n-        accessToken.setHomeAccountId(HOME_ACCOUNT_ID);\n-        accessToken.setEnvironment(\"\\r\\f\\n\\t\" + ENVIRONMENT + \"\\r\\f\\n\\t\");\n-        accessToken.setCredentialType(CredentialType.AccessToken.name());\n-        accessToken.setClientId(CLIENT_ID);\n-        accessToken.setRealm(REALM);\n-        accessToken.setTarget(TARGET);\n+        accessToken.setHomeAccountId(wrapInEscapeSequenceChars(HOME_ACCOUNT_ID));\n+        accessToken.setEnvironment(wrapInEscapeSequenceChars(ENVIRONMENT));\n+        accessToken.setCredentialType(wrapInEscapeSequenceChars(CredentialType.AccessToken.name()));\n+        accessToken.setClientId(wrapInEscapeSequenceChars(CLIENT_ID));\n+        accessToken.setRealm(wrapInEscapeSequenceChars(REALM));\n+        accessToken.setTarget(wrapInEscapeSequenceChars(TARGET));\n \n         final String expectedKey = \"\" // just for formatting\n                 + HOME_ACCOUNT_ID + CACHE_VALUE_SEPARATOR\n"}}, {"oid": "0e0df4267398fdb27e74925f267ad38f8a8876d3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0e0df4267398fdb27e74925f267ad38f8a8876d3", "message": "Merge branch 'iambmelt/add-escape-char-test' of https://github.com/AzureAD/microsoft-authentication-library-common-for-android into iambmelt/add-escape-char-test", "committedDate": "2020-11-13T21:33:51Z", "type": "commit"}, {"oid": "143ebc6487dc5b05728bd327c4aa7d41e823ba42", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/143ebc6487dc5b05728bd327c4aa7d41e823ba42", "message": "More complete test", "committedDate": "2020-11-13T21:43:00Z", "type": "commit"}, {"oid": "699fa0ace59f9ef7ba4fc4cecc78c12b4729315d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/699fa0ace59f9ef7ba4fc4cecc78c12b4729315d", "message": "Ensure trim() rules are applied to in-mem filtering", "committedDate": "2020-11-13T21:50:32Z", "type": "commit"}, {"oid": "2450826981e104700d8bb7482b0bc743182b89f4", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2450826981e104700d8bb7482b0bc743182b89f4", "message": "Add additional unit test", "committedDate": "2020-11-13T22:31:09Z", "type": "commit"}, {"oid": "232f58f5de1f92876a7cd3759aec388ba25435a9", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/232f58f5de1f92876a7cd3759aec388ba25435a9", "message": "Code cleanup", "committedDate": "2020-11-14T00:17:40Z", "type": "commit"}]}