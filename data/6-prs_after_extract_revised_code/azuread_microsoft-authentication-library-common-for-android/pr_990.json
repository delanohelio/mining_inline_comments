{"pr_number": 990, "pr_title": "Add additional suberrors which ESTS could return to map to MSAL CPP sub error constants", "pr_createdAt": "2020-08-05T23:17:30Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/990", "timeline": [{"oid": "6faaec05bc5c8ac56ac43d99daa77a19a9444c59", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6faaec05bc5c8ac56ac43d99daa77a19a9444c59", "message": "Add additional suberrors which ESTS could return to map to MSAL CPP sub error constants", "committedDate": "2020-08-05T09:12:51Z", "type": "commit"}, {"oid": "1dd80e23439a39e26f454e023b787a7fbbb9bfb7", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/1dd80e23439a39e26f454e023b787a7fbbb9bfb7", "message": "Made pop internal constructor public", "committedDate": "2020-08-05T22:39:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA1ODY0MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/990#discussion_r466058641", "bodyText": "The javadoc for each of these doesn't seem to follow a pattern.\nSome places it starts with Oauth2 suberror code\nSome places it starts with SubError code\nSome places it starts with Conditional access suberror code\nSome places it starts with OpenId connect suberror code\nSome places it starts with Custom sub error\nAnd this entire class itself has the following javadoc: Represents the oauth2 sub error code.\nWould be good if we can make these consistent somehow.", "author": "shahzaibj", "createdAt": "2020-08-05T23:26:37Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1447,6 +1447,47 @@\n          * Broker should make a request to DRS to get the current device status and act accordingly.\n          */\n         public static final String DEVICE_AUTHENTICATION_FAILED = \"device_authentication_failed\";\n+\n+        /**\n+         * SubError code for cases when client not in the Microsoft first party family group\n+         * redeems auth code or refresh token given to a client in the family\n+         */\n+        public static final String CLIENT_MISMATCH = \"client_mismatch\";\n+\n+        /**\n+         * Conditional access suberror code when a policy enforces token lifetime.\n+         */\n+        public static final String TOKEN_EXPIRED = \"token_expired\";\n+\n+        /**\n+         *  Conditional access suberror code.\n+         *  This indicates a simple action is required by the end user, like MFA.\n+         */\n+        public static final String BASIC_ACTION = \"basic_action\";\n+\n+        /**\n+         * Conditional access suberror code.\n+         * This indicates additional action is required that is in the user control, but is outside of the sign in session.\n+         * For example, enroll in MDM or register install an app that uses Intune app protection.\n+         */\n+        public static final String ADDITIONAL_ACTION = \"additional_action\";\n+\n+        /**\n+         * Conditional access suberror code.\n+         * User will be shown an informational message with no immediate remediation steps.\n+         * For example access was blocked due to location or the device is not domain joined.\n+         */\n+        public static final String MESSAGE_ONLY = \"message_only\";\n+\n+        /**\n+         * OpenId connect suberror code, when user consent is required.\n+         */\n+        public static final String CONSENT_REQUIRED = \"consent_required\";\n+\n+        /**\n+         * Custom sub error that notifies the user that their password has expired.\n+         */\n+        public static final String USER_PASSWORD_EXPIRED = \"user_password_expired\";", "originalCommit": "1dd80e23439a39e26f454e023b787a7fbbb9bfb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2ODM2NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/990#discussion_r466068364", "bodyText": "Thanks Shahzaib, made it more consistent", "author": "kreedula", "createdAt": "2020-08-05T23:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA1ODY0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d561d240f81678107f05bca93c6f70f2b46d6445", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\nindex 28f98232a..464cc3785 100644\n--- a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n+++ b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n\n@@ -1431,60 +1431,78 @@ public final class AuthenticationConstants {\n     public static final class OAuth2SubErrorCode {\n \n         /**\n-         * Oauth2 suberror code for Intune App Protection Policy required.\n+         * Oauth2 suberror code for unauthorized_client.\n+         *\n+         * Suberror code when Intune App Protection Policy is required.\n          */\n         public static final String PROTECTION_POLICY_REQUIRED = \"protection_policy_required\";\n \n         /**\n          * Oauth2 suberror code for invalid_grant.\n-         * Token is expired or invalid for all resources and scopes and shouldn't be retried again as-is.\n+         *\n+         * Suberror code when token is expired or invalid for all resources\n+         * and scopes and shouldn't be retried again as-is.\n          */\n         public static final String BAD_TOKEN = \"bad_token\";\n \n         /**\n          * Oauth2 suberror code for invalid_grant.\n-         * Failed to do device authentication during a token request.\n+         *\n+         * Suberror code when failed to do device authentication during a token request.\n          * Broker should make a request to DRS to get the current device status and act accordingly.\n          */\n         public static final String DEVICE_AUTHENTICATION_FAILED = \"device_authentication_failed\";\n \n         /**\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n          * SubError code for cases when client not in the Microsoft first party family group\n-         * redeems auth code or refresh token given to a client in the family\n+         * redeems auth code or refresh token given to a client in the family.\n          */\n         public static final String CLIENT_MISMATCH = \"client_mismatch\";\n \n         /**\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n          * Conditional access suberror code when a policy enforces token lifetime.\n          */\n         public static final String TOKEN_EXPIRED = \"token_expired\";\n \n         /**\n-         *  Conditional access suberror code.\n-         *  This indicates a simple action is required by the end user, like MFA.\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n+         * Conditional access suberror code which indicates a simple action is required by the end user, like MFA.\n          */\n         public static final String BASIC_ACTION = \"basic_action\";\n \n         /**\n-         * Conditional access suberror code.\n-         * This indicates additional action is required that is in the user control, but is outside of the sign in session.\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n+         * Conditional access suberror code which indicates additional action is\n+         * required that is in the user control, but is outside of the sign in session.\n          * For example, enroll in MDM or register install an app that uses Intune app protection.\n          */\n         public static final String ADDITIONAL_ACTION = \"additional_action\";\n \n         /**\n-         * Conditional access suberror code.\n-         * User will be shown an informational message with no immediate remediation steps.\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n+         * Conditional access suberror code where user will be shown an informational\n+         * message with no immediate remediation steps.\n          * For example access was blocked due to location or the device is not domain joined.\n          */\n         public static final String MESSAGE_ONLY = \"message_only\";\n \n         /**\n-         * OpenId connect suberror code, when user consent is required.\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n+         * OpenId connect suberror code, where user consent is required.\n          */\n         public static final String CONSENT_REQUIRED = \"consent_required\";\n \n         /**\n+         * Oauth2 suberror code for invalid_grant.\n+         *\n          * Custom sub error that notifies the user that their password has expired.\n          */\n         public static final String USER_PASSWORD_EXPIRED = \"user_password_expired\";\n"}}, {"oid": "d561d240f81678107f05bca93c6f70f2b46d6445", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d561d240f81678107f05bca93c6f70f2b46d6445", "message": "Address comments", "committedDate": "2020-08-05T23:47:45Z", "type": "commit"}]}