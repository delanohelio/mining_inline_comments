{"pr_number": 924, "pr_title": "Bring back ipphone check", "pr_createdAt": "2020-06-09T17:34:27Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/924", "timeline": [{"oid": "c970377c5b38ccce81ead4daeeed0da6b99277d5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c970377c5b38ccce81ead4daeeed0da6b99277d5", "message": "Bring back ipphone check", "committedDate": "2020-06-09T17:27:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxMzkxOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/924#discussion_r437613919", "bodyText": "nit: if this became local ipPhonePackage, and ipPhoneSignature, say, this statement would be easier to read.", "author": "AdamBJohnsonx", "createdAt": "2020-06-09T17:53:51Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java", "diffHunk": "@@ -223,7 +223,15 @@ private boolean processWebsiteRequest(@NonNull final WebView view, @NonNull fina\n             final Context applicationContext = getActivity().getApplicationContext();\n \n             // If CP is installed, redirect to CP.\n-            if (!packageHelper.isPackageInstalledAndEnabled(\n+            // TODO: Until we get a signal from eSTS that CP is the MDM app, we cannot assume that.\n+            //       CP is currently working on this.\n+            //       Until that comes, we'll only handle this in ipphone.\n+            if (packageHelper.isPackageInstalledAndEnabled(\n+                    applicationContext,\n+                    AuthenticationConstants.Broker.IPPHONE_APP_PACKAGE_NAME) &&", "originalCommit": "c970377c5b38ccce81ead4daeeed0da6b99277d5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6969f0ad9c5502be1853a0b4f6baf961daf5c489", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java b/common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java\nindex 1e80c2152..9955cce36 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java\n\n@@ -226,19 +229,14 @@ public class AzureActiveDirectoryWebViewClient extends OAuth2WebViewClient {\n             // TODO: Until we get a signal from eSTS that CP is the MDM app, we cannot assume that.\n             //       CP is currently working on this.\n             //       Until that comes, we'll only handle this in ipphone.\n-            if (packageHelper.isPackageInstalledAndEnabled(\n-                    applicationContext,\n-                    AuthenticationConstants.Broker.IPPHONE_APP_PACKAGE_NAME) &&\n-                AuthenticationConstants.Broker.IPPHONE_APP_SIGNATURE.equals(\n-                        packageHelper.getCurrentSignatureForPackage(AuthenticationConstants.Broker.IPPHONE_APP_PACKAGE_NAME)) &&\n-                packageHelper.isPackageInstalledAndEnabled(\n-                    applicationContext,\n-                    AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME)) {\n+            if (packageHelper.isPackageInstalledAndEnabled(applicationContext, IPPHONE_APP_PACKAGE_NAME) &&\n+                IPPHONE_APP_SIGNATURE.equals(packageHelper.getCurrentSignatureForPackage(IPPHONE_APP_PACKAGE_NAME)) &&\n+                packageHelper.isPackageInstalledAndEnabled(applicationContext, COMPANY_PORTAL_APP_PACKAGE_NAME)) {\n                 try {\n                     Logger.verbose(TAG + methodName, \"Sending intent to launch the CompanyPortal.\");\n                     final Intent intent = new Intent();\n                     intent.setComponent(new ComponentName(\n-                            AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME,\n+                            COMPANY_PORTAL_APP_PACKAGE_NAME,\n                             AuthenticationConstants.Broker.COMPANY_PORTAL_APP_LAUNCH_ACTIVITY_NAME));\n                     intent.addFlags(Intent.FLAG_ACTIVITY_NEW_TASK | Intent.FLAG_ACTIVITY_CLEAR_TASK);\n                     getActivity().startActivity(intent);\n"}}, {"oid": "6969f0ad9c5502be1853a0b4f6baf961daf5c489", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6969f0ad9c5502be1853a0b4f6baf961daf5c489", "message": "Address comment", "committedDate": "2020-06-09T17:58:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYyNDc4OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/924#discussion_r437624788", "bodyText": "As I read this, we're changing from \"If company portal IS NOT installed and enabled, try to launch company portal\" to \"If ipphone is installed and enabled and has the correct signature and company portal IS installed, try to launch company portal\"", "author": "AdamBJohnsonx", "createdAt": "2020-06-09T18:12:40Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/ui/webview/AzureActiveDirectoryWebViewClient.java", "diffHunk": "@@ -223,14 +226,17 @@ private boolean processWebsiteRequest(@NonNull final WebView view, @NonNull fina\n             final Context applicationContext = getActivity().getApplicationContext();\n \n             // If CP is installed, redirect to CP.\n-            if (!packageHelper.isPackageInstalledAndEnabled(\n-                    applicationContext,\n-                    AuthenticationConstants.Broker.COMPANY_PORTAL_APP_PACKAGE_NAME)) {\n+            // TODO: Until we get a signal from eSTS that CP is the MDM app, we cannot assume that.\n+            //       CP is currently working on this.\n+            //       Until that comes, we'll only handle this in ipphone.\n+            if (packageHelper.isPackageInstalledAndEnabled(applicationContext, IPPHONE_APP_PACKAGE_NAME) &&\n+                IPPHONE_APP_SIGNATURE.equals(packageHelper.getCurrentSignatureForPackage(IPPHONE_APP_PACKAGE_NAME)) &&\n+                packageHelper.isPackageInstalledAndEnabled(applicationContext, COMPANY_PORTAL_APP_PACKAGE_NAME)) {", "originalCommit": "6969f0ad9c5502be1853a0b4f6baf961daf5c489", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}