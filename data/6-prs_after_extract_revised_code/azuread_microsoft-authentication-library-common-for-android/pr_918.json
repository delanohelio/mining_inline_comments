{"pr_number": 918, "pr_title": "Changes to add/invoke content provider for broker interaction", "pr_createdAt": "2020-05-27T00:29:34Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918", "timeline": [{"oid": "45e69f12bbb640b4bd61a7ed10dcfb5555b4164b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/45e69f12bbb640b4bd61a7ed10dcfb5555b4164b", "message": "Changes to add/invoke content provider for broker interaction", "committedDate": "2020-05-06T21:48:53Z", "type": "commit"}, {"oid": "9f16bb3b2e57f45839ac242c8f719334577560ff", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9f16bb3b2e57f45839ac242c8f719334577560ff", "message": "More changes related to Content provider strategy", "committedDate": "2020-05-11T03:14:26Z", "type": "commit"}, {"oid": "6c6df8a4a469f4fa2488999169523f20f750600a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6c6df8a4a469f4fa2488999169523f20f750600a", "message": "Minor changes", "committedDate": "2020-05-13T21:35:15Z", "type": "commit"}, {"oid": "c5da5c13d403dc9def4de42c7b72180819bed61a", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/c5da5c13d403dc9def4de42c7b72180819bed61a", "message": "Content provider telemetry", "committedDate": "2020-05-19T22:42:22Z", "type": "commit"}, {"oid": "0737d76a5bf65375a89072197bc24dae912afdc2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0737d76a5bf65375a89072197bc24dae912afdc2", "message": "Merge branch 'dev' into kreedula/content-provider", "committedDate": "2020-05-19T22:46:24Z", "type": "commit"}, {"oid": "6611b1777c155912ad967b9a1515e7925e2b4cab", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6611b1777c155912ad967b9a1515e7925e2b4cab", "message": "Minor comments", "committedDate": "2020-05-27T00:28:47Z", "type": "commit"}, {"oid": "148ebfa16446673262c836251fba865d56367da5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/148ebfa16446673262c836251fba865d56367da5", "message": "Merge branch 'dev' into kreedula/content-provider", "committedDate": "2020-05-27T00:29:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3MTQ3OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r431371479", "bodyText": "nit: capitalize letter e", "author": "shahzaibj", "createdAt": "2020-05-27T18:57:18Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1247,6 +1257,50 @@ private AuthenticationConstants() {\n         public static final String REMOVE_ACCOUNT_FROM_SHARED_DEVICE = \"REMOVE_ACCOUNT_FROM_SHARED_DEVICE\";\n     }\n \n+\n+    public static final class BrokerContentProvider{\n+\n+        public static final String CONTENT_SCHEME = \"content://\";\n+\n+        /** Paths for all broker api's **/\n+        public static final String AUTHORITY = \"microsoft.identity.broker\";\n+\n+        public static final String HELLO_PATH = \"/hello\";\n+\n+        public static final String ACQUIRE_TOKEN_INTERACTIVE_PATH = \"/acquireTokenInteractive\";\n+\n+        public static final String ACQUIRE_TOKEN_SILENT_PATH = \"/acquireTokenSilent\";\n+\n+        public static final String GET_ACCOUNTS_PATH = \"/getAccounts\";\n+\n+        public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n+\n+        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICe_PATH = \"/getCurrentAccountSharedDevice\";", "originalCommit": "148ebfa16446673262c836251fba865d56367da5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "420050cd0c16140046dc34f831a66df8f767b4db", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\nindex f05093042..b71135381 100644\n--- a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n+++ b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n\n@@ -1275,7 +1275,7 @@ public final class AuthenticationConstants {\n \n         public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n \n-        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICe_PATH = \"/getCurrentAccountSharedDevice\";\n+        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICE_PATH = \"/getCurrentAccountSharedDevice\";\n \n         public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3MTcwMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r431371703", "bodyText": "nit: capitalize letter e", "author": "shahzaibj", "createdAt": "2020-05-27T18:57:40Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1247,6 +1257,50 @@ private AuthenticationConstants() {\n         public static final String REMOVE_ACCOUNT_FROM_SHARED_DEVICE = \"REMOVE_ACCOUNT_FROM_SHARED_DEVICE\";\n     }\n \n+\n+    public static final class BrokerContentProvider{\n+\n+        public static final String CONTENT_SCHEME = \"content://\";\n+\n+        /** Paths for all broker api's **/\n+        public static final String AUTHORITY = \"microsoft.identity.broker\";\n+\n+        public static final String HELLO_PATH = \"/hello\";\n+\n+        public static final String ACQUIRE_TOKEN_INTERACTIVE_PATH = \"/acquireTokenInteractive\";\n+\n+        public static final String ACQUIRE_TOKEN_SILENT_PATH = \"/acquireTokenSilent\";\n+\n+        public static final String GET_ACCOUNTS_PATH = \"/getAccounts\";\n+\n+        public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n+\n+        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICe_PATH = \"/getCurrentAccountSharedDevice\";\n+\n+        public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n+\n+        public static final String SIGN_OUT_FROM_SHARED_DEVICE_PATH = \"/signOutFromSharedDevice\";\n+\n+\n+        /** Codes for URI **/\n+        public static final int HELLO_URI_CODE = 1;\n+\n+        public static final int ACQUIRE_TOKEN_INTERACTIVE_CODE = 2;\n+\n+        public static final int ACQUIRE_TOKEN_SILENT_CODE = 3;\n+\n+        public static final int GET_ACCOUNTS_CODE = 4;\n+\n+        public static final int REMOVE_ACCOUNTS_CODE = 5;\n+\n+        public static final int GET_CURRENT_ACCOUNT_SHARED_DEVICe_CODE = 6;", "originalCommit": "148ebfa16446673262c836251fba865d56367da5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "420050cd0c16140046dc34f831a66df8f767b4db", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\nindex f05093042..b71135381 100644\n--- a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n+++ b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n\n@@ -1275,7 +1275,7 @@ public final class AuthenticationConstants {\n \n         public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n \n-        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICe_PATH = \"/getCurrentAccountSharedDevice\";\n+        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICE_PATH = \"/getCurrentAccountSharedDevice\";\n \n         public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3Mjk4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r431372986", "bodyText": "can be simplified to TextUtils.isEmpty", "author": "shahzaibj", "createdAt": "2020-05-27T18:59:52Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java", "diffHunk": "@@ -101,8 +101,11 @@ public void disconnect() {\n      * @return Intent\n      */\n     public Intent getIntentForAuthService(final Context context) {\n-        final String currentActiveBrokerPackageName = getCurrentActiveBrokerPackageName(context);\n-        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0) {\n+        final String currentActiveBrokerPackageName = new BrokerValidator(context).\n+                getCurrentActiveBrokerPackageName(context);\n+\n+        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0 ||", "originalCommit": "148ebfa16446673262c836251fba865d56367da5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "420050cd0c16140046dc34f831a66df8f767b4db", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java b/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\nindex b3673f8bc..54ee5078f 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\n\n@@ -104,7 +102,7 @@ public class MicrosoftAuthClient {\n         final String currentActiveBrokerPackageName = new BrokerValidator(context).\n                 getCurrentActiveBrokerPackageName(context);\n \n-        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0 ||\n+        if (TextUtils.isEmpty(currentActiveBrokerPackageName) ||\n                 !isMicrosoftAuthServiceSupported(context.getPackageManager(), currentActiveBrokerPackageName)) {\n             return null;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3Mzc2NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r431373765", "bodyText": "Looks like we weren't doing this check before. Why was it NOT needed before? Or why is it needed now?", "author": "shahzaibj", "createdAt": "2020-05-27T19:01:15Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java", "diffHunk": "@@ -101,8 +101,11 @@ public void disconnect() {\n      * @return Intent\n      */\n     public Intent getIntentForAuthService(final Context context) {\n-        final String currentActiveBrokerPackageName = getCurrentActiveBrokerPackageName(context);\n-        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0) {\n+        final String currentActiveBrokerPackageName = new BrokerValidator(context).\n+                getCurrentActiveBrokerPackageName(context);\n+\n+        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0 ||\n+                !isMicrosoftAuthServiceSupported(context.getPackageManager(), currentActiveBrokerPackageName)) {", "originalCommit": "148ebfa16446673262c836251fba865d56367da5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjAxNjgyNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r432016826", "bodyText": "We always did the check, see here\nJust refactored here to decouple active broker check and this", "author": "kreedula", "createdAt": "2020-05-28T17:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM3Mzc2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "420050cd0c16140046dc34f831a66df8f767b4db", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java b/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\nindex b3673f8bc..54ee5078f 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/broker/MicrosoftAuthClient.java\n\n@@ -104,7 +102,7 @@ public class MicrosoftAuthClient {\n         final String currentActiveBrokerPackageName = new BrokerValidator(context).\n                 getCurrentActiveBrokerPackageName(context);\n \n-        if (currentActiveBrokerPackageName == null || currentActiveBrokerPackageName.length() == 0 ||\n+        if (TextUtils.isEmpty(currentActiveBrokerPackageName) ||\n                 !isMicrosoftAuthServiceSupported(context.getPackageManager(), currentActiveBrokerPackageName)) {\n             return null;\n         }\n"}}, {"oid": "420050cd0c16140046dc34f831a66df8f767b4db", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/420050cd0c16140046dc34f831a66df8f767b4db", "message": "Addressing comments", "committedDate": "2020-05-28T17:53:07Z", "type": "commit"}, {"oid": "5effcbb12d35e20e0beee5111d65f59a1c77c6ec", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/5effcbb12d35e20e0beee5111d65f59a1c77c6ec", "message": "Merge branch 'dev' into kreedula/content-provider", "committedDate": "2020-05-28T17:53:54Z", "type": "commit"}, {"oid": "de788371bcdfc03422587c6b91131705d88b274b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/de788371bcdfc03422587c6b91131705d88b274b", "message": "Parcelable util", "committedDate": "2020-05-29T01:31:29Z", "type": "commit"}, {"oid": "0a468ebdef5b9e49f660929119378a392d5a241b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0a468ebdef5b9e49f660929119378a392d5a241b", "message": "Marshalling changes", "committedDate": "2020-05-29T20:56:53Z", "type": "commit"}, {"oid": "27b0ab93e492e42564cac7e718da27d9e2cfcd88", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/27b0ab93e492e42564cac7e718da27d9e2cfcd88", "message": "Added copyright", "committedDate": "2020-05-29T21:23:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NTE4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434195186", "bodyText": "@Nullable return value would be good to document with an annot / javadoc (where presumably null indicates no active broker)", "author": "iambmelt", "createdAt": "2020-06-02T21:49:50Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java", "diffHunk": "@@ -229,6 +231,25 @@ private X509Certificate getSelfSignedCert(final List<X509Certificate> certs)\n         return selfSignedCert;\n     }\n \n+    /**\n+     * Returns the package that is currently active relative to the Work Account custom account type\n+     * Note: either the company portal or the authenticator\n+     *\n+     * @param context\n+     * @return String\n+     */\n+    public String getCurrentActiveBrokerPackageName(@NonNull final Context context) {", "originalCommit": "27b0ab93e492e42564cac7e718da27d9e2cfcd88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NTM3Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434195373", "bodyText": "Oh, I see this was moved. Still good to have :)", "author": "iambmelt", "createdAt": "2020-06-02T21:50:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NTE4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwNDg0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434204842", "bodyText": "updated", "author": "kreedula", "createdAt": "2020-06-02T22:14:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5NTE4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "8e815afc86905c61befb69273cbb30999ff4759d", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\nindex a010d8f17..00b189e1c 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n\n@@ -235,9 +235,10 @@ public class BrokerValidator {\n      * Returns the package that is currently active relative to the Work Account custom account type\n      * Note: either the company portal or the authenticator\n      *\n-     * @param context\n+     * @param context : current active broker package name, null if no broker is available\n      * @return String\n      */\n+    @Nullable\n     public String getCurrentActiveBrokerPackageName(@NonNull final Context context) {\n         AuthenticatorDescription[] authenticators = AccountManager.get(context).getAuthenticatorTypes();\n         for (AuthenticatorDescription authenticator : authenticators) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODE0Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434198143", "bodyText": "Just calling out that this change alters binary compatibility of common....", "author": "iambmelt", "createdAt": "2020-06-02T21:57:22Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -475,29 +499,44 @@ private Bundle getRequestBundleFromBrokerRequest(@NonNull BrokerRequest brokerRe\n                     sRequestAdapterGsonInstance.toJson(brokerRequest, BrokerRequest.class)\n             );\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters) {\n+    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,", "originalCommit": "27b0ab93e492e42564cac7e718da27d9e2cfcd88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwNDMxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434204313", "bodyText": "Ack. these are only used by MSAL for these the request , so we should be good.", "author": "kreedula", "createdAt": "2020-06-02T22:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODE0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -506,6 +535,13 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request bundle for broker getAccounts request.\n+     *\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Bundle\n+     */\n     public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n                                                  @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODI3MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434198270", "bodyText": "Same here, changes binary compatibility. Just FYI", "author": "iambmelt", "createdAt": "2020-06-02T21:57:41Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -475,29 +499,44 @@ private Bundle getRequestBundleFromBrokerRequest(@NonNull BrokerRequest brokerRe\n                     sRequestAdapterGsonInstance.toJson(brokerRequest, BrokerRequest.class)\n             );\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters) {\n+    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n+                                                 @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n         requestBundle.putString(ACCOUNT_CLIENTID_KEY, parameters.getClientId());\n         requestBundle.putString(ACCOUNT_REDIRECT, parameters.getRedirectUri());\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         //Disable the environment and tenantID. Just return all accounts belong to this clientID.\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters) {\n+    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters,", "originalCommit": "27b0ab93e492e42564cac7e718da27d9e2cfcd88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwNDM3Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434204376", "bodyText": "same as above", "author": "kreedula", "createdAt": "2020-06-02T22:13:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODI3MA=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -506,6 +535,13 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request bundle for broker getAccounts request.\n+     *\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Bundle\n+     */\n     public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n                                                  @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODQ2MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434198461", "bodyText": "Here too", "author": "iambmelt", "createdAt": "2020-06-02T21:58:10Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -475,29 +499,44 @@ private Bundle getRequestBundleFromBrokerRequest(@NonNull BrokerRequest brokerRe\n                     sRequestAdapterGsonInstance.toJson(brokerRequest, BrokerRequest.class)\n             );\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters) {\n+    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n+                                                 @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n         requestBundle.putString(ACCOUNT_CLIENTID_KEY, parameters.getClientId());\n         requestBundle.putString(ACCOUNT_REDIRECT, parameters.getRedirectUri());\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         //Disable the environment and tenantID. Just return all accounts belong to this clientID.\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters) {\n+    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters,\n+                                                   @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n         if (null != parameters.getAccount()) {\n             requestBundle.putString(ACCOUNT_CLIENTID_KEY, parameters.getClientId());\n             requestBundle.putString(ENVIRONMENT, parameters.getAccount().getEnvironment());\n             requestBundle.putString(ACCOUNT_HOME_ACCOUNT_ID, parameters.getAccount().getHomeAccountId());\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n \n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForRemoveAccountFromSharedDevice(@NonNull final RemoveAccountCommandParameters parameters) {\n+    public Bundle getRequestBundleForRemoveAccountFromSharedDevice(@NonNull final RemoveAccountCommandParameters parameters,", "originalCommit": "27b0ab93e492e42564cac7e718da27d9e2cfcd88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwNDQwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434204404", "bodyText": "same as above", "author": "kreedula", "createdAt": "2020-06-02T22:13:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDE5ODQ2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -506,6 +535,13 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request bundle for broker getAccounts request.\n+     *\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Bundle\n+     */\n     public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n                                                  @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n"}}, {"oid": "8e815afc86905c61befb69273cbb30999ff4759d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8e815afc86905c61befb69273cbb30999ff4759d", "message": "Addressing comments", "committedDate": "2020-06-02T22:14:11Z", "type": "commit"}, {"oid": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "message": "Merge branch 'dev' into kreedula/content-provider", "committedDate": "2020-06-02T22:14:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwODE2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434208167", "bodyText": "Nit: Should this be the @return ? Seems like this content on the wrong attribute", "author": "iambmelt", "createdAt": "2020-06-02T22:24:01Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java", "diffHunk": "@@ -229,6 +231,26 @@ private X509Certificate getSelfSignedCert(final List<X509Certificate> certs)\n         return selfSignedCert;\n     }\n \n+    /**\n+     * Returns the package that is currently active relative to the Work Account custom account type\n+     * Note: either the company portal or the authenticator\n+     *\n+     * @param context : current active broker package name, null if no broker is available", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MjA4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434252082", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwODE2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\nindex 00b189e1c..eb1f3f5a8 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n\n@@ -235,19 +235,17 @@ public class BrokerValidator {\n      * Returns the package that is currently active relative to the Work Account custom account type\n      * Note: either the company portal or the authenticator\n      *\n-     * @param context : current active broker package name, null if no broker is available\n-     * @return String\n+     * @return String : current active broker package name, null if no broker is available\n      */\n     @Nullable\n-    public String getCurrentActiveBrokerPackageName(@NonNull final Context context) {\n-        AuthenticatorDescription[] authenticators = AccountManager.get(context).getAuthenticatorTypes();\n+    public String getCurrentActiveBrokerPackageName() {\n+        AuthenticatorDescription[] authenticators = AccountManager.get(mContext).getAuthenticatorTypes();\n         for (AuthenticatorDescription authenticator : authenticators) {\n             if (authenticator.type.equals(AuthenticationConstants.Broker.BROKER_ACCOUNT_TYPE)\n                     && verifySignature(authenticator.packageName)) {\n                 return authenticator.packageName;\n             }\n         }\n-\n         return null;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwOTcxOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434209718", "bodyText": "If this is a constant collection, and it looks like it is, should it have a private constructor?  The other instances of this have documentation describing each constant, should this?  Is there a link to documentation that could be referenced?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:28:14Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1247,6 +1257,50 @@ private AuthenticationConstants() {\n         public static final String REMOVE_ACCOUNT_FROM_SHARED_DEVICE = \"REMOVE_ACCOUNT_FROM_SHARED_DEVICE\";\n     }\n \n+\n+    public static final class BrokerContentProvider{", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MjAyOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434252029", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIwOTcxOA=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\nindex b71135381..fa9d9ad12 100644\n--- a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n+++ b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n\n@@ -1260,43 +1260,102 @@ public final class AuthenticationConstants {\n \n     public static final class BrokerContentProvider{\n \n+        private BrokerContentProvider(){\n+\n+        }\n+\n+        /**\n+         *  URI Scheme constant to invoke content provider.\n+         */\n         public static final String CONTENT_SCHEME = \"content://\";\n \n-        /** Paths for all broker api's **/\n+        /**\n+         * URI Authority constant for content provider.\n+         *\n+         * This is will be pre-fixed by com.azure.authenticator or com.microsoft.windowsintune.companyportal\n+         * depending on which ever is the active broker.\n+         */\n         public static final String AUTHORITY = \"microsoft.identity.broker\";\n \n+        /**\n+         * URI Path constant for Broker hello request using ContentProvider.\n+         */\n         public static final String HELLO_PATH = \"/hello\";\n \n+        /**\n+         * URI Path constant for Broker acquireTokenInteractive request using ContentProvider.\n+         */\n         public static final String ACQUIRE_TOKEN_INTERACTIVE_PATH = \"/acquireTokenInteractive\";\n \n+        /**\n+         * URI Path constant for Broker acquireTokenSilent request using ContentProvider.\n+         */\n         public static final String ACQUIRE_TOKEN_SILENT_PATH = \"/acquireTokenSilent\";\n \n+        /**\n+         * URI Path constant for Broker getAccounts request using ContentProvider.\n+         */\n         public static final String GET_ACCOUNTS_PATH = \"/getAccounts\";\n \n+        /**\n+         * URI Path constant for Broker removeAccounts request using ContentProvider.\n+         */\n         public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n \n+        /**\n+         * URI Path constant for Broker getCurrentAccountSharedDevice request using ContentProvider.\n+         */\n         public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICE_PATH = \"/getCurrentAccountSharedDevice\";\n \n+        /**\n+         * URI Path constant for Broker getDeviceMode request using ContentProvider.\n+         */\n         public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n \n+        /**\n+         * URI Path constant for Broker signOutFromSharedDevice request using ContentProvider.\n+         */\n         public static final String SIGN_OUT_FROM_SHARED_DEVICE_PATH = \"/signOutFromSharedDevice\";\n \n \n-        /** Codes for URI **/\n+        /**\n+         * BrokerContentProvider URI code constant for hello request.\n+         */\n         public static final int HELLO_URI_CODE = 1;\n \n+        /**\n+         * BrokerContentProvider URI code constant for acquireTokenInteractive request.\n+         */\n         public static final int ACQUIRE_TOKEN_INTERACTIVE_CODE = 2;\n \n+        /**\n+         * BrokerContentProvider URI code constant for acquireTokenSilent request.\n+         */\n         public static final int ACQUIRE_TOKEN_SILENT_CODE = 3;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getAccounts request.\n+         */\n         public static final int GET_ACCOUNTS_CODE = 4;\n \n+        /**\n+         * BrokerContentProvider URI code constant for removeAccounts request.\n+         */\n         public static final int REMOVE_ACCOUNTS_CODE = 5;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getCurrentAccountSharedDevice request.\n+         */\n         public static final int GET_CURRENT_ACCOUNT_SHARED_DEVICE_CODE = 6;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getDeviceMode request.\n+         */\n         public static final int GET_DEVICE_MODE_CODE = 7;\n \n+        /**\n+         * BrokerContentProvider URI code constant for signOutFromSharedDevice request.\n+         */\n         public static final int SIGN_OUT_FROM_SHARED_DEVICE_CODE = 8;\n \n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDEzMA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434210130", "bodyText": "Should these integers be in a separate container?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:29:27Z", "path": "common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java", "diffHunk": "@@ -1247,6 +1257,50 @@ private AuthenticationConstants() {\n         public static final String REMOVE_ACCOUNT_FROM_SHARED_DEVICE = \"REMOVE_ACCOUNT_FROM_SHARED_DEVICE\";\n     }\n \n+\n+    public static final class BrokerContentProvider{\n+\n+        public static final String CONTENT_SCHEME = \"content://\";\n+\n+        /** Paths for all broker api's **/\n+        public static final String AUTHORITY = \"microsoft.identity.broker\";\n+\n+        public static final String HELLO_PATH = \"/hello\";\n+\n+        public static final String ACQUIRE_TOKEN_INTERACTIVE_PATH = \"/acquireTokenInteractive\";\n+\n+        public static final String ACQUIRE_TOKEN_SILENT_PATH = \"/acquireTokenSilent\";\n+\n+        public static final String GET_ACCOUNTS_PATH = \"/getAccounts\";\n+\n+        public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n+\n+        public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICE_PATH = \"/getCurrentAccountSharedDevice\";\n+\n+        public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n+\n+        public static final String SIGN_OUT_FROM_SHARED_DEVICE_PATH = \"/signOutFromSharedDevice\";\n+\n+\n+        /** Codes for URI **/\n+        public static final int HELLO_URI_CODE = 1;\n+\n+        public static final int ACQUIRE_TOKEN_INTERACTIVE_CODE = 2;\n+\n+        public static final int ACQUIRE_TOKEN_SILENT_CODE = 3;\n+\n+        public static final int GET_ACCOUNTS_CODE = 4;\n+\n+        public static final int REMOVE_ACCOUNTS_CODE = 5;\n+\n+        public static final int GET_CURRENT_ACCOUNT_SHARED_DEVICE_CODE = 6;\n+\n+        public static final int GET_DEVICE_MODE_CODE = 7;\n+\n+        public static final int SIGN_OUT_FROM_SHARED_DEVICE_CODE = 8;\n+", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTkzMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251931", "bodyText": "These are related to BrokerContentProvider itself , so i'd prefer these to be within this class.", "author": "kreedula", "createdAt": "2020-06-03T00:54:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDEzMA=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\nindex b71135381..fa9d9ad12 100644\n--- a/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n+++ b/common/src/main/java/com/microsoft/identity/common/adal/internal/AuthenticationConstants.java\n\n@@ -1260,43 +1260,102 @@ public final class AuthenticationConstants {\n \n     public static final class BrokerContentProvider{\n \n+        private BrokerContentProvider(){\n+\n+        }\n+\n+        /**\n+         *  URI Scheme constant to invoke content provider.\n+         */\n         public static final String CONTENT_SCHEME = \"content://\";\n \n-        /** Paths for all broker api's **/\n+        /**\n+         * URI Authority constant for content provider.\n+         *\n+         * This is will be pre-fixed by com.azure.authenticator or com.microsoft.windowsintune.companyportal\n+         * depending on which ever is the active broker.\n+         */\n         public static final String AUTHORITY = \"microsoft.identity.broker\";\n \n+        /**\n+         * URI Path constant for Broker hello request using ContentProvider.\n+         */\n         public static final String HELLO_PATH = \"/hello\";\n \n+        /**\n+         * URI Path constant for Broker acquireTokenInteractive request using ContentProvider.\n+         */\n         public static final String ACQUIRE_TOKEN_INTERACTIVE_PATH = \"/acquireTokenInteractive\";\n \n+        /**\n+         * URI Path constant for Broker acquireTokenSilent request using ContentProvider.\n+         */\n         public static final String ACQUIRE_TOKEN_SILENT_PATH = \"/acquireTokenSilent\";\n \n+        /**\n+         * URI Path constant for Broker getAccounts request using ContentProvider.\n+         */\n         public static final String GET_ACCOUNTS_PATH = \"/getAccounts\";\n \n+        /**\n+         * URI Path constant for Broker removeAccounts request using ContentProvider.\n+         */\n         public static final String REMOVE_ACCOUNTS_PATH = \"/removeAccounts\";\n \n+        /**\n+         * URI Path constant for Broker getCurrentAccountSharedDevice request using ContentProvider.\n+         */\n         public static final String GET_CURRENT_ACCOUNT_SHARED_DEVICE_PATH = \"/getCurrentAccountSharedDevice\";\n \n+        /**\n+         * URI Path constant for Broker getDeviceMode request using ContentProvider.\n+         */\n         public static final String GET_DEVICE_MODE_PATH = \"/getDeviceMode\";\n \n+        /**\n+         * URI Path constant for Broker signOutFromSharedDevice request using ContentProvider.\n+         */\n         public static final String SIGN_OUT_FROM_SHARED_DEVICE_PATH = \"/signOutFromSharedDevice\";\n \n \n-        /** Codes for URI **/\n+        /**\n+         * BrokerContentProvider URI code constant for hello request.\n+         */\n         public static final int HELLO_URI_CODE = 1;\n \n+        /**\n+         * BrokerContentProvider URI code constant for acquireTokenInteractive request.\n+         */\n         public static final int ACQUIRE_TOKEN_INTERACTIVE_CODE = 2;\n \n+        /**\n+         * BrokerContentProvider URI code constant for acquireTokenSilent request.\n+         */\n         public static final int ACQUIRE_TOKEN_SILENT_CODE = 3;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getAccounts request.\n+         */\n         public static final int GET_ACCOUNTS_CODE = 4;\n \n+        /**\n+         * BrokerContentProvider URI code constant for removeAccounts request.\n+         */\n         public static final int REMOVE_ACCOUNTS_CODE = 5;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getCurrentAccountSharedDevice request.\n+         */\n         public static final int GET_CURRENT_ACCOUNT_SHARED_DEVICE_CODE = 6;\n \n+        /**\n+         * BrokerContentProvider URI code constant for getDeviceMode request.\n+         */\n         public static final int GET_DEVICE_MODE_CODE = 7;\n \n+        /**\n+         * BrokerContentProvider URI code constant for signOutFromSharedDevice request.\n+         */\n         public static final int SIGN_OUT_FROM_SHARED_DEVICE_CODE = 8;\n \n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDUyMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434210521", "bodyText": "Should there be documentation for this public method?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:30:31Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -415,6 +417,28 @@ public Bundle getRequestBundleForHello(@NonNull final CommandParameters paramete\n         return requestBundle;\n     }\n \n+    public Intent getRequestIntentForAcquireTokenInteractive(@NonNull final Bundle resultBundle,", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTU5OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251599", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDUyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -417,6 +423,15 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request intent for broker acquireTokenInteractive request.\n+     * Only used in case of BrokerContentProvider\n+     *\n+     * @param resultBundle : result Bundle returned by broker.\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Intent\n+     */\n     public Intent getRequestIntentForAcquireTokenInteractive(@NonNull final Bundle resultBundle,\n                                                              @NonNull final InteractiveTokenCommandParameters parameters,\n                                                              @Nullable final String negotiatedBrokerProtocolVersion) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDc4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434210786", "bodyText": "Should we document this public method?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:31:18Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -475,29 +499,44 @@ private Bundle getRequestBundleFromBrokerRequest(@NonNull BrokerRequest brokerRe\n                     sRequestAdapterGsonInstance.toJson(brokerRequest, BrokerRequest.class)\n             );\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters) {\n+    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTU2MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251561", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:53:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDc4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -506,6 +535,13 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request bundle for broker getAccounts request.\n+     *\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Bundle\n+     */\n     public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n                                                  @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDgzOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434210839", "bodyText": "Should we document this public method?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:31:28Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java", "diffHunk": "@@ -475,29 +499,44 @@ private Bundle getRequestBundleFromBrokerRequest(@NonNull BrokerRequest brokerRe\n                     sRequestAdapterGsonInstance.toJson(brokerRequest, BrokerRequest.class)\n             );\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters) {\n+    public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n+                                                 @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n         requestBundle.putString(ACCOUNT_CLIENTID_KEY, parameters.getClientId());\n         requestBundle.putString(ACCOUNT_REDIRECT, parameters.getRedirectUri());\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n         //Disable the environment and tenantID. Just return all accounts belong to this clientID.\n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters) {\n+    public Bundle getRequestBundleForRemoveAccount(@NonNull final RemoveAccountCommandParameters parameters,\n+                                                   @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n         if (null != parameters.getAccount()) {\n             requestBundle.putString(ACCOUNT_CLIENTID_KEY, parameters.getClientId());\n             requestBundle.putString(ENVIRONMENT, parameters.getAccount().getEnvironment());\n             requestBundle.putString(ACCOUNT_HOME_ACCOUNT_ID, parameters.getAccount().getHomeAccountId());\n         }\n+        requestBundle.putString(\n+                AuthenticationConstants.Broker.NEGOTIATED_BP_VERSION_KEY,\n+                negotiatedBrokerProtocolVersion\n+        );\n \n         return requestBundle;\n     }\n \n-    public Bundle getRequestBundleForRemoveAccountFromSharedDevice(@NonNull final RemoveAccountCommandParameters parameters) {\n+    public Bundle getRequestBundleForRemoveAccountFromSharedDevice(@NonNull final RemoveAccountCommandParameters parameters,", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTUyNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251524", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMDgzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\nindex efd4c1e8c..0fb15c2eb 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/request/MsalBrokerRequestAdapter.java\n\n@@ -506,6 +535,13 @@ public class MsalBrokerRequestAdapter implements IBrokerRequestAdapter {\n         return requestBundle;\n     }\n \n+    /**\n+     * Method to construct a request bundle for broker getAccounts request.\n+     *\n+     * @param parameters : input parameters\n+     * @param negotiatedBrokerProtocolVersion :  protocol version returned by broker hello.\n+     * @return : request Bundle\n+     */\n     public Bundle getRequestBundleForGetAccounts(@NonNull final CommandParameters parameters,\n                                                  @Nullable final String negotiatedBrokerProtocolVersion) {\n         final Bundle requestBundle = new Bundle();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTY0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434211648", "bodyText": "@nonnull?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:33:52Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.os.Parcel;\n+import android.os.Parcelable;\n+\n+import androidx.annotation.NonNull;\n+\n+public class ParcelableUtil {\n+\n+    public static byte[] marshall(@NonNull final Parcelable parceable) {\n+        final Parcel parcel = Parcel.obtain();\n+        parceable.writeToParcel(parcel, 0);\n+        final byte[] bytes = parcel.marshall();\n+        parcel.recycle();\n+        return bytes;\n+    }\n+\n+    public static Parcel unmarshall(byte[] bytes) {", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTQ1Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251453", "bodyText": "Addressed", "author": "kreedula", "createdAt": "2020-06-03T00:52:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTY0OA=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\nindex 451080f71..df3bdca04 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n\n@@ -27,16 +27,31 @@ import android.os.Parcelable;\n \n import androidx.annotation.NonNull;\n \n+/**\n+ * Utility class to marshall and unmarshall Parcelable types.\n+ */\n public class ParcelableUtil {\n \n-    public static byte[] marshall(@NonNull final Parcelable parceable) {\n+    /**\n+     * Util method to transform a Parcelable to byte[].\n+     *\n+     * @param parcelable : Parceable type as an input\n+     * @return : byte[]\n+     */\n+    public static byte[] marshall(@NonNull final Parcelable parcelable) {\n         final Parcel parcel = Parcel.obtain();\n-        parceable.writeToParcel(parcel, 0);\n+        parcelable.writeToParcel(parcel, 0);\n         final byte[] bytes = parcel.marshall();\n         parcel.recycle();\n         return bytes;\n     }\n \n+    /**\n+     * Util method to transform a byte[] to Parcel.\n+     *\n+     * @param bytes : input as byte[]\n+     * @return : Parcel\n+     */\n     public static Parcel unmarshall(byte[] bytes) {\n         final Parcel parcel = Parcel.obtain();\n         parcel.unmarshall(bytes, 0, bytes.length);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTcxOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434211719", "bodyText": "@nonnull?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:34:06Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.os.Parcel;\n+import android.os.Parcelable;\n+\n+import androidx.annotation.NonNull;\n+\n+public class ParcelableUtil {\n+\n+    public static byte[] marshall(@NonNull final Parcelable parceable) {\n+        final Parcel parcel = Parcel.obtain();\n+        parceable.writeToParcel(parcel, 0);\n+        final byte[] bytes = parcel.marshall();\n+        parcel.recycle();\n+        return bytes;\n+    }\n+\n+    public static Parcel unmarshall(byte[] bytes) {\n+        final Parcel parcel = Parcel.obtain();\n+        parcel.unmarshall(bytes, 0, bytes.length);\n+        parcel.setDataPosition(0);\n+        return parcel;\n+    }\n+\n+    public static <T> T unmarshall(byte[] bytes, Parcelable.Creator<T> creator) {", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MTAxNw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434251017", "bodyText": "Addressed via 477877f", "author": "kreedula", "createdAt": "2020-06-03T00:50:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTcxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\nindex 451080f71..df3bdca04 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n\n@@ -27,16 +27,31 @@ import android.os.Parcelable;\n \n import androidx.annotation.NonNull;\n \n+/**\n+ * Utility class to marshall and unmarshall Parcelable types.\n+ */\n public class ParcelableUtil {\n \n-    public static byte[] marshall(@NonNull final Parcelable parceable) {\n+    /**\n+     * Util method to transform a Parcelable to byte[].\n+     *\n+     * @param parcelable : Parceable type as an input\n+     * @return : byte[]\n+     */\n+    public static byte[] marshall(@NonNull final Parcelable parcelable) {\n         final Parcel parcel = Parcel.obtain();\n-        parceable.writeToParcel(parcel, 0);\n+        parcelable.writeToParcel(parcel, 0);\n         final byte[] bytes = parcel.marshall();\n         parcel.recycle();\n         return bytes;\n     }\n \n+    /**\n+     * Util method to transform a byte[] to Parcel.\n+     *\n+     * @param bytes : input as byte[]\n+     * @return : Parcel\n+     */\n     public static Parcel unmarshall(byte[] bytes) {\n         final Parcel parcel = Parcel.obtain();\n         parcel.unmarshall(bytes, 0, bytes.length);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTkxMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434211911", "bodyText": "Should we have documentation on this public class?  Should it be final, with a private constructor?  Higher level, is there a reason to prefer static method references over instance methods on a singleton-safe class?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:34:43Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java", "diffHunk": "@@ -0,0 +1,53 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.os.Parcel;\n+import android.os.Parcelable;\n+\n+import androidx.annotation.NonNull;\n+\n+public class ParcelableUtil {", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI1MDg5NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434250895", "bodyText": "Added documentation via 477877f. The intention of this class is have just util methods to transform parcelable , hence static methods to keep it simple. I would say it's a coding preference we have been following for all our Util classes.", "author": "kreedula", "createdAt": "2020-06-03T00:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc0MTg5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434741891", "bodyText": "I'm fine with this, though it will make it more difficult to induce exceptional behavior in the writeToParcel methods for the purposes of testing.  What I would suggest is that, since it's never reasonable to instantiate or inherit from this type of class, declare it to be final and give it a private constructor.", "author": "AdamBJohnsonx", "createdAt": "2020-06-03T17:38:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3NTUxNg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434775516", "bodyText": "yup, I would not expect to induce any behavior to these as these are basic util methods using Platform API's to transform. Declared as final and added a private constructor as suggested", "author": "kreedula", "createdAt": "2020-06-03T18:37:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTkxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc3NzI4MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434777280", "bodyText": "Thanks!   I'm looking into static analysis to enforce this kind of thing so we're not doing it in review.  Looks like we have a checkstyle ruleset in the codebase...", "author": "AdamBJohnsonx", "createdAt": "2020-06-03T18:40:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxMTkxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\nindex 451080f71..df3bdca04 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n\n@@ -27,16 +27,31 @@ import android.os.Parcelable;\n \n import androidx.annotation.NonNull;\n \n+/**\n+ * Utility class to marshall and unmarshall Parcelable types.\n+ */\n public class ParcelableUtil {\n \n-    public static byte[] marshall(@NonNull final Parcelable parceable) {\n+    /**\n+     * Util method to transform a Parcelable to byte[].\n+     *\n+     * @param parcelable : Parceable type as an input\n+     * @return : byte[]\n+     */\n+    public static byte[] marshall(@NonNull final Parcelable parcelable) {\n         final Parcel parcel = Parcel.obtain();\n-        parceable.writeToParcel(parcel, 0);\n+        parcelable.writeToParcel(parcel, 0);\n         final byte[] bytes = parcel.marshall();\n         parcel.recycle();\n         return bytes;\n     }\n \n+    /**\n+     * Util method to transform a byte[] to Parcel.\n+     *\n+     * @param bytes : input as byte[]\n+     * @return : Parcel\n+     */\n     public static Parcel unmarshall(byte[] bytes) {\n         final Parcel parcel = Parcel.obtain();\n         parcel.unmarshall(bytes, 0, bytes.length);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxNTIwMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434215201", "bodyText": "Point of curiosity: what's the relationship between this context and mContext?", "author": "AdamBJohnsonx", "createdAt": "2020-06-02T22:44:20Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java", "diffHunk": "@@ -229,6 +231,26 @@ private X509Certificate getSelfSignedCert(final List<X509Certificate> certs)\n         return selfSignedCert;\n     }\n \n+    /**\n+     * Returns the package that is currently active relative to the Work Account custom account type\n+     * Note: either the company portal or the authenticator\n+     *\n+     * @param context : current active broker package name, null if no broker is available", "originalCommit": "9be93a249e0f8152e0b3779a3383f3a6330ea8cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0OTMyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434249328", "bodyText": "Good catch, didn't realize we already have a member variable for Context, removed context as an arg.", "author": "kreedula", "createdAt": "2020-06-03T00:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDIxNTIwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "477877f2d99d6eb7d752f18d941a682b51665c62", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\nindex 00b189e1c..eb1f3f5a8 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/broker/BrokerValidator.java\n\n@@ -235,19 +235,17 @@ public class BrokerValidator {\n      * Returns the package that is currently active relative to the Work Account custom account type\n      * Note: either the company portal or the authenticator\n      *\n-     * @param context : current active broker package name, null if no broker is available\n-     * @return String\n+     * @return String : current active broker package name, null if no broker is available\n      */\n     @Nullable\n-    public String getCurrentActiveBrokerPackageName(@NonNull final Context context) {\n-        AuthenticatorDescription[] authenticators = AccountManager.get(context).getAuthenticatorTypes();\n+    public String getCurrentActiveBrokerPackageName() {\n+        AuthenticatorDescription[] authenticators = AccountManager.get(mContext).getAuthenticatorTypes();\n         for (AuthenticatorDescription authenticator : authenticators) {\n             if (authenticator.type.equals(AuthenticationConstants.Broker.BROKER_ACCOUNT_TYPE)\n                     && verifySignature(authenticator.packageName)) {\n                 return authenticator.packageName;\n             }\n         }\n-\n         return null;\n     }\n \n"}}, {"oid": "477877f2d99d6eb7d752f18d941a682b51665c62", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/477877f2d99d6eb7d752f18d941a682b51665c62", "message": "Addressing comments", "committedDate": "2020-06-03T00:41:56Z", "type": "commit"}, {"oid": "25d68346fc7c8a6bacd04f1966148ff5d32269a6", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/25d68346fc7c8a6bacd04f1966148ff5d32269a6", "message": "Merge branch 'kreedula/content-provider' of https://github.com/AzureAD/microsoft-authentication-library-common-for-android into kreedula/content-provider", "committedDate": "2020-06-03T00:42:30Z", "type": "commit"}, {"oid": "88388a82c7235d47a9293a69f5b8f30b496a1cc5", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/88388a82c7235d47a9293a69f5b8f30b496a1cc5", "message": "Added NonNull", "committedDate": "2020-06-03T00:52:30Z", "type": "commit"}, {"oid": "48de467c71434097b86f08be2e69dfd3748d425b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/48de467c71434097b86f08be2e69dfd3748d425b", "message": "Addressing comments", "committedDate": "2020-06-03T18:35:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4OTg2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434789860", "bodyText": "You can also do @NoArgsConstructor(access = AccessLevel.PRIVATE) if you prefer the Lombok style.", "author": "AdamBJohnsonx", "createdAt": "2020-06-03T19:04:19Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java", "diffHunk": "@@ -0,0 +1,79 @@\n+// Copyright (c) Microsoft Corporation.\n+// All rights reserved.\n+//\n+// This code is licensed under the MIT License.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a copy\n+// of this software and associated documentation files(the \"Software\"), to deal\n+// in the Software without restriction, including without limitation the rights\n+// to use, copy, modify, merge, publish, distribute, sublicense, and / or sell\n+// copies of the Software, and to permit persons to whom the Software is\n+// furnished to do so, subject to the following conditions :\n+//\n+// The above copyright notice and this permission notice shall be included in\n+// all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+// THE SOFTWARE.\n+package com.microsoft.identity.common.internal.util;\n+\n+import android.os.Parcel;\n+import android.os.Parcelable;\n+\n+import androidx.annotation.NonNull;\n+\n+/**\n+ * Utility class to marshall and unmarshall Parcelable types.\n+ */\n+public final class ParcelableUtil {\n+\n+    private ParcelableUtil(){\n+\n+    }", "originalCommit": "48de467c71434097b86f08be2e69dfd3748d425b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDgwMTU0OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/918#discussion_r434801549", "bodyText": "Good tip, now that we have embraced lombok , better to use it :)", "author": "kreedula", "createdAt": "2020-06-03T19:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDc4OTg2MA=="}], "type": "inlineReview", "revised_code": {"commit": "8a553eea4573add49159e38a5d2cfd2924cb0672", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\nindex 9f98135d6..a750861c5 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/util/ParcelableUtil.java\n\n@@ -26,16 +26,15 @@ import android.os.Parcel;\n import android.os.Parcelable;\n \n import androidx.annotation.NonNull;\n+import lombok.AccessLevel;\n+import lombok.NoArgsConstructor;\n \n /**\n  * Utility class to marshall and unmarshall Parcelable types.\n  */\n+@NoArgsConstructor(access = AccessLevel.PRIVATE)\n public final class ParcelableUtil {\n \n-    private ParcelableUtil(){\n-\n-    }\n-\n     /**\n      * Util method to transform a Parcelable to byte[].\n      *\n"}}, {"oid": "8a553eea4573add49159e38a5d2cfd2924cb0672", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/8a553eea4573add49159e38a5d2cfd2924cb0672", "message": "Added lombok style private constructor", "committedDate": "2020-06-03T19:25:33Z", "type": "commit"}, {"oid": "55e3aea7e14cf6b9adf4ee519fffdeeddca58552", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/55e3aea7e14cf6b9adf4ee519fffdeeddca58552", "message": "Address javadoc comments", "committedDate": "2020-06-03T20:35:21Z", "type": "commit"}, {"oid": "89c45a6e932984652122cf2ae07ead60f86dbe4d", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/89c45a6e932984652122cf2ae07ead60f86dbe4d", "message": "Minor edits", "committedDate": "2020-06-03T20:37:03Z", "type": "commit"}]}