{"pr_number": 925, "pr_title": "Add correlation id to local authentication result", "pr_createdAt": "2020-06-09T18:02:53Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925", "timeline": [{"oid": "ffc97c42562e2e23bbbbc0de37ced8d65ac60a7c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/ffc97c42562e2e23bbbbc0de37ced8d65ac60a7c", "message": "Add correlation id to local authentication result", "committedDate": "2020-06-09T17:58:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxNDIwNA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437714204", "bodyText": "should this become a method?", "author": "AdamBJohnsonx", "createdAt": "2020-06-09T20:53:39Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -341,6 +350,14 @@ public void onReceive(Context context, Intent intent) {\n                     sCommand = null;\n                     localBroadcastManager.unregisterReceiver(resultReceiver);\n \n+                    // set correlation id on Local Authentication Result\n+                    if (commandResult.getResult() != null &&\n+                            commandResult.getResult() instanceof LocalAuthenticationResult) {\n+                        final LocalAuthenticationResult localAuthenticationResult =\n+                                (LocalAuthenticationResult) commandResult.getResult();\n+                        localAuthenticationResult.setCorrelationId(correlationId);\n+                    }\n+", "originalCommit": "ffc97c42562e2e23bbbbc0de37ced8d65ac60a7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc1NTg5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437755891", "bodyText": "@AdamBJohnsonx Addressed here: 21e14b3", "author": "shahzaibj", "createdAt": "2020-06-09T22:24:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxNDIwNA=="}], "type": "inlineReview", "revised_code": {"commit": "21e14b3679de09f10658a2f08142f1ca41182627", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java b/common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java\nindex b048a9b8c..56486e601 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java\n\n@@ -351,12 +346,7 @@ public class CommandDispatcher {\n                     localBroadcastManager.unregisterReceiver(resultReceiver);\n \n                     // set correlation id on Local Authentication Result\n-                    if (commandResult.getResult() != null &&\n-                            commandResult.getResult() instanceof LocalAuthenticationResult) {\n-                        final LocalAuthenticationResult localAuthenticationResult =\n-                                (LocalAuthenticationResult) commandResult.getResult();\n-                        localAuthenticationResult.setCorrelationId(correlationId);\n-                    }\n+                    setCorrelationIdOnResult(commandResult, correlationId);\n \n                     EstsTelemetry.getInstance().flush(command, commandResult);\n                     Telemetry.getInstance().flush(correlationId);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxNDY2MA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437714660", "bodyText": "nit: @OverRide?", "author": "AdamBJohnsonx", "createdAt": "2020-06-09T20:54:14Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/result/LocalAuthenticationResult.java", "diffHunk": "@@ -209,4 +210,14 @@ public AccessTokenRecord getAccessTokenRecord() {\n     public boolean isServicedFromCache() {\n         return mServicedFromCache;\n     }\n+\n+    public void setCorrelationId(@NonNull final String correlationId) {", "originalCommit": "ffc97c42562e2e23bbbbc0de37ced8d65ac60a7c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcyNTM0OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437725348", "bodyText": "The setter is not declared on the interface and instead declared directly here. So override isn't needed", "author": "shahzaibj", "createdAt": "2020-06-09T21:11:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxNDY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzczNDMwNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437734305", "bodyText": "Oops.  You're right.  It says set, not get.  You could @Setter that then if you wanted to.", "author": "AdamBJohnsonx", "createdAt": "2020-06-09T21:31:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzcxNDY2MA=="}], "type": "inlineReview", "revised_code": {"commit": "0b618addbf0bc530c086df5d4cc03693973f470b", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/result/LocalAuthenticationResult.java b/common/src/main/java/com/microsoft/identity/common/internal/result/LocalAuthenticationResult.java\nindex c08c13e5b..3cbf2eac5 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/result/LocalAuthenticationResult.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/result/LocalAuthenticationResult.java\n\n@@ -220,4 +220,4 @@ public class LocalAuthenticationResult implements ILocalAuthenticationResult {\n     public String getCorrelationId() {\n         return mCorrelationId;\n     }\n-}\n\\ No newline at end of file\n+}\n"}}, {"oid": "21e14b3679de09f10658a2f08142f1ca41182627", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/21e14b3679de09f10658a2f08142f1ca41182627", "message": "Add separate method for setting correlation id on local auth result", "committedDate": "2020-06-09T22:23:36Z", "type": "commit"}, {"oid": "0b618addbf0bc530c086df5d4cc03693973f470b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/0b618addbf0bc530c086df5d4cc03693973f470b", "message": "Add new line at end of LocalAuthenticationResult.java", "committedDate": "2020-06-09T22:30:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5ODA5Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437798093", "bodyText": "I think it would be a good idea to comment on why we have the check for localAuthenticationResult.  I'm assuming for the broker scenarios, but adding the comment will help future readers.", "author": "shoatman", "createdAt": "2020-06-10T00:42:59Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/CommandDispatcher.java", "diffHunk": "@@ -495,4 +502,15 @@ public static int getCachedResultCount() {\n         return sCommandResultCache.getSize();\n     }\n \n+    private static void setCorrelationIdOnResult(@NonNull final CommandResult commandResult,\n+                                                 @NonNull final String correlationId) {\n+        // set correlation id on Local Authentication Result\n+        if (commandResult.getResult() != null &&", "originalCommit": "0b618addbf0bc530c086df5d4cc03693973f470b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5ODg0Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437798843", "bodyText": "Sure, I'll add that - the check is there because CommandResult is a generic object and can contain the result of other commands such as GetAccount command or GetDeviceCommand and those results are not instances of LocalAuthenticationResult and don't contain a property for correlation id.", "author": "shahzaibj", "createdAt": "2020-06-10T00:45:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5ODA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzgwMDIyMg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/925#discussion_r437800222", "bodyText": "I think it's the local prefix that confuses me here.  So perhaps the comment isn't required...", "author": "shoatman", "createdAt": "2020-06-10T00:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc5ODA5Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "d3d8cd478a64d9506e0d9fdb1ed3458b67233c23", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/d3d8cd478a64d9506e0d9fdb1ed3458b67233c23", "message": "Merge branch 'dev' into shahzaibj/correlation-id", "committedDate": "2020-06-12T01:21:10Z", "type": "commit"}]}