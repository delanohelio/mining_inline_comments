{"pr_number": 1032, "pr_title": "Perform browser sign out on MSAL side", "pr_createdAt": "2020-09-12T07:00:21Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032", "timeline": [{"oid": "2f11978a974ba7f68ea82e00f9b357c5e171a83b", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/2f11978a974ba7f68ea82e00f9b357c5e171a83b", "message": "Perform browser sign out on MSAL side", "committedDate": "2020-09-12T06:42:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzcyOA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488063728", "bodyText": "Is info really loud enough for this message?  I think it's at least a warning.", "author": "AdamBJohnsonx", "createdAt": "2020-09-14T16:25:43Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java", "diffHunk": "@@ -567,6 +572,39 @@ public void putValueInSuccessEvent(ApiEndEvent event, Boolean result) {\n                 });\n     }\n \n+    /**\n+     * Invoke the logout endpoint on the specified browser.\n+     * If there are more than 1 session in the browser, an account picker will be displayed.\n+     * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     */\n+    private void logOutFromBrowser(@NonNull final Context context,\n+                                   @NonNull final RemoveAccountCommandParameters parameters) {\n+        final String methodName = \":logOutFromBrowser\";\n+\n+        String browserPackageName = null;\n+        try {\n+            final Browser browser = BrowserSelector.select(context, parameters.getBrowserSafeList());\n+            browserPackageName = browser.getPackageName();\n+        } catch (final ClientException e) {\n+            // Best effort. If none is passed to broker, then it will let the OS decide.\n+            Logger.error(TAG, e.getErrorCode(), e);\n+        }\n+\n+        try {\n+            final Intent intent = new Intent(Intent.ACTION_VIEW);\n+            intent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+            intent.setData(Uri.parse(AuthenticationConstants.Browser.LOGOUT_ENDPOINT_V2));\n+            if (browserPackageName != null) {\n+                intent.setPackage(browserPackageName);\n+            }\n+            context.startActivity(intent);\n+\n+        } catch (final ActivityNotFoundException e) {\n+            Logger.info(TAG + methodName,", "originalCommit": "2f11978a974ba7f68ea82e00f9b357c5e171a83b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2NjU4Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488066586", "bodyText": "This means no browser is installed on the device (which is a valid case for some 'work devices')- nothing we can really do here.", "author": "rpdome", "createdAt": "2020-09-14T16:30:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA3OTg3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488079878", "bodyText": "In that case, though, we wouldn't find a package name by examining the installed packages in BrowserSelector, right?  And we'll already log an error in those cases on line 590.  But if we didn't log that error, I think this would be a really strange occurrence.", "author": "AdamBJohnsonx", "createdAt": "2020-09-14T16:50:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA2MzcyOA=="}], "type": "inlineReview", "revised_code": {"commit": "356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java b/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\nindex 6d615a152..bc85b9f2f 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\n\n@@ -576,6 +576,9 @@ public class BrokerMsalController extends BaseController {\n      * Invoke the logout endpoint on the specified browser.\n      * If there are more than 1 session in the browser, an account picker will be displayed.\n      * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     *\n+     * @param context    {@link Context} application context.\n+     * @param parameters {@link RemoveAccountCommandParameters} parameters of the remove command call.\n      */\n     private void logOutFromBrowser(@NonNull final Context context,\n                                    @NonNull final RemoveAccountCommandParameters parameters) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA4NjAzMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/1032#discussion_r488086033", "bodyText": "If you're going to add javadoc, add the method @param -eters.", "author": "AdamBJohnsonx", "createdAt": "2020-09-14T16:58:29Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java", "diffHunk": "@@ -567,6 +572,39 @@ public void putValueInSuccessEvent(ApiEndEvent event, Boolean result) {\n                 });\n     }\n \n+    /**\n+     * Invoke the logout endpoint on the specified browser.\n+     * If there are more than 1 session in the browser, an account picker will be displayed.\n+     * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     */\n+    private void logOutFromBrowser(@NonNull final Context context,", "originalCommit": "2f11978a974ba7f68ea82e00f9b357c5e171a83b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java b/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\nindex 6d615a152..bc85b9f2f 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/controllers/BrokerMsalController.java\n\n@@ -576,6 +576,9 @@ public class BrokerMsalController extends BaseController {\n      * Invoke the logout endpoint on the specified browser.\n      * If there are more than 1 session in the browser, an account picker will be displayed.\n      * (Alternatively, we could pass the optional sessionID as one of the query string parameter, but we're not storing that at the moment).\n+     *\n+     * @param context    {@link Context} application context.\n+     * @param parameters {@link RemoveAccountCommandParameters} parameters of the remove command call.\n      */\n     private void logOutFromBrowser(@NonNull final Context context,\n                                    @NonNull final RemoveAccountCommandParameters parameters) {\n"}}, {"oid": "356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/356baa0f7c310479d5b2a56d7bd2d53cb391ee79", "message": "Address comments", "committedDate": "2020-09-14T17:36:30Z", "type": "commit"}]}