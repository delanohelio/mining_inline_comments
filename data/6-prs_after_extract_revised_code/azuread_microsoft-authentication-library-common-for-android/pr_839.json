{"pr_number": 839, "pr_title": "Fix crash on redirect if no activity available", "pr_createdAt": "2020-03-06T03:53:45Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/839", "timeline": [{"oid": "abfc3eb4b03e89fde3d4a325d422e22a88455e6c", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/abfc3eb4b03e89fde3d4a325d422e22a88455e6c", "message": "Return a null response intent if no activity available", "committedDate": "2020-03-06T03:49:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExMzk3OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/839#discussion_r389113978", "bodyText": "Shahazib - Would you mind adding a comment here about the result of the authorization request will be.  I'm assuming the only this can happen is if the user closes the app or if the OS closes the app due to memory pressure.  I guess I want to know returning null here results in.  I'm assuming no callback at all... since we no longer have something to call back to.", "author": "shoatman", "createdAt": "2020-03-06T19:56:09Z", "path": "common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java", "diffHunk": "@@ -69,8 +69,15 @@\n      * @param context     the package context for the app.\n      * @param responseUri the response URI, which carries the parameters describing the response.\n      */\n+    @Nullable\n     public static Intent createCustomTabResponseIntent(final Context context,\n                                                        final String responseUri) {\n+        if (sCallingActivityClass == null) {\n+            // can't create intent for response if no activity available\n+            Logger.warn(TAG, \"Calling activity class is NULL. Unable to create intent for response.\");", "originalCommit": "abfc3eb4b03e89fde3d4a325d422e22a88455e6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExNjA1OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/839#discussion_r389116058", "bodyText": "Yeah this would happen if the app got closed either by user or OS. This method is called in BrowserTabActivity. See this PR: https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/966/files\nI catch the null, log a warning, show a toast, and finish\nThere won't be any result, no tokens etc. as there is no callback and no interactive request in memory", "author": "shahzaibj", "createdAt": "2020-03-06T20:00:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExMzk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTEyMDE1Mw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/839#discussion_r389120153", "bodyText": "I've added the comment", "author": "shahzaibj", "createdAt": "2020-03-06T20:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExMzk3OA=="}], "type": "inlineReview", "revised_code": {"commit": "aa0df3864ebb2f68bc4182d92ca90ed31d918099", "chunk": "diff --git a/common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java b/common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java\nindex 532878b39..a8c307c53 100644\n--- a/common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java\n+++ b/common/src/main/java/com/microsoft/identity/common/internal/providers/oauth2/BrowserAuthorizationFragment.java\n\n@@ -73,7 +73,12 @@ public class BrowserAuthorizationFragment extends AuthorizationFragment {\n     public static Intent createCustomTabResponseIntent(final Context context,\n                                                        final String responseUri) {\n         if (sCallingActivityClass == null) {\n-            // can't create intent for response if no activity available\n+            // can't create intent for response if no activity available, this can happen if the app\n+            // was closed either by the user or the OS.\n+            // An example would be in the case of using browser without custom tabs, and closing\n+            // the app after the interactive request started in the browser. After closing, the user\n+            // returns to the browser and completes authorization and when the OS redirects here,\n+            // the calling activity class is NULL as the app was closed and memory was wiped.\n             Logger.warn(TAG, \"Calling activity class is NULL. Unable to create intent for response.\");\n             return null;\n         }\n"}}, {"oid": "f5521ba7ad3225f3067a8ad968110200483fde64", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/f5521ba7ad3225f3067a8ad968110200483fde64", "message": "Merge branch 'release/2.0.2-tm' into shahzaibj/fix-crash-redirect-no-activity", "committedDate": "2020-03-06T20:07:18Z", "type": "commit"}, {"oid": "aa0df3864ebb2f68bc4182d92ca90ed31d918099", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/aa0df3864ebb2f68bc4182d92ca90ed31d918099", "message": "Add comment", "committedDate": "2020-03-06T20:09:51Z", "type": "commit"}]}