{"pr_number": 952, "pr_title": "Additional utilities for working with test accounts.", "pr_createdAt": "2020-07-02T00:56:42Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952", "timeline": [{"oid": "450c39b5c8a5eeb4f19afc19272756d164b17d42", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/450c39b5c8a5eeb4f19afc19272756d164b17d42", "message": "Additional utilities for working with test accounts.", "committedDate": "2020-07-02T00:52:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY5Mzk3Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r448693977", "bodyText": "Would probably be better to accept each of these as method parameters instead of hard coding here", "author": "shahzaibj", "createdAt": "2020-07-02T01:10:23Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -175,6 +192,16 @@ public static Credential getCredentials(LabUserQuery query) {\n         return credential;\n     }\n \n+    public static AppInfo getAppInfo() {\n+        LabAuthenticationHelper.getInstance().setupApiClientWithAccessToken();\n+        AppApi api = new AppApi();\n+        try {\n+            return api.getAppByParam(\"cloud\", \"azurecloud\", \"azureadmultipleorgs\", \"yes\", \"yes\").get(0);", "originalCommit": "450c39b5c8a5eeb4f19afc19272756d164b17d42", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fb256e0ffef028452e7d33146a2e0e38f1562f03", "chunk": "diff --git a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\nindex e5900cf6e..130e69e10 100644\n--- a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n+++ b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n\n@@ -193,10 +269,17 @@ public class LabUserHelper {\n     }\n \n     public static AppInfo getAppInfo() {\n+            return getAppInfo(UserType.CLOUD, AzureEnvironment.AZURE_CLOUD, SignInAudience.AZURE_AD_MULTIPLE_ORGS,\n+                    IsAdminConsented.YES, PublicClient.YES);\n+   }\n+\n+    public static AppInfo getAppInfo(UserType userType, AzureEnvironment azureEnvironment, SignInAudience audience,\n+                                     IsAdminConsented isAdminConsented, PublicClient publicClient) {\n         LabAuthenticationHelper.getInstance().setupApiClientWithAccessToken();\n         AppApi api = new AppApi();\n         try {\n-            return api.getAppByParam(\"cloud\", \"azurecloud\", \"azureadmultipleorgs\", \"yes\", \"yes\").get(0);\n+            return api.getAppByParam(userType.getValue(), azureEnvironment.getValue(), audience.getValue(),\n+                    isAdminConsented.getValue(), publicClient.getValue()).get(0);\n         } catch (ApiException e) {\n             throw new RuntimeException(e);\n         }\n"}}, {"oid": "fb256e0ffef028452e7d33146a2e0e38f1562f03", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/fb256e0ffef028452e7d33146a2e0e38f1562f03", "message": "CR Comments", "committedDate": "2020-07-02T18:11:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzI0Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449203242", "bodyText": "Why duplicate all of these as enums? Are the String constants in LabConstants.java not sufficient?", "author": "shahzaibj", "createdAt": "2020-07-02T18:39:58Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -71,6 +71,82 @@\n         return configInfos;\n     }\n \n+    public enum UserType {\n+        CLOUD(LabConstants.UserType.CLOUD),\n+        B2C(LabConstants.UserType.B2C),\n+        FEDERATED(LabConstants.UserType.FEDERATED),\n+        GUEST(LabConstants.UserType.GUEST),\n+        MSA(LabConstants.UserType.MSA),\n+        ON_PREM(LabConstants.UserType.ON_PREM)\n+        ;\n+        String constant;\n+        UserType(String constant) {\n+            this.constant = constant;\n+        }\n+        String getValue() {\n+            return constant;\n+        }\n+\n+    }\n+\n+    public enum SignInAudience {\n+        AZURE_AD_AND_PERSONAL_MICROSOFT_ACCOUNT(LabConstants.SignInAudience.AZURE_AD_AND_PERSONAL_MICROSOFT_ACCOUNT),\n+        AZURE_AD_MULTIPLE_ORGS(LabConstants.SignInAudience.AZURE_AD_MULTIPLE_ORGS),\n+        AZURE_AD_MY_ORG(LabConstants.SignInAudience.AZURE_AD_MY_ORG),\n+        ;\n+        String constant;\n+        SignInAudience(String constant) {\n+            this.constant = constant;\n+        }\n+        String getValue() {\n+            return constant;\n+        }\n+\n+    }\n+\n+    public enum AzureEnvironment {\n+        AZURE_B2C_CLOUD(LabConstants.AzureEnvironment.AZURE_B2C_CLOUD),\n+        AZURE_CHINA_CLOUD(LabConstants.AzureEnvironment.AZURE_CHINA_CLOUD),\n+        AZURE_CLOUD(LabConstants.AzureEnvironment.AZURE_CLOUD),\n+        AZURE_GERMANY_CLOUD(LabConstants.AzureEnvironment.AZURE_GERMANY_CLOUD),\n+        AZURE_PPE(LabConstants.AzureEnvironment.AZURE_PPE),\n+        AZURE_US_GOVERNMENT(LabConstants.AzureEnvironment.AZURE_US_GOVERNMENT)\n+        ;\n+        String constant;\n+        AzureEnvironment(String constant) {\n+            this.constant = constant;\n+        }\n+        String getValue() {\n+            return constant;\n+        }\n+    }\n+\n+    public enum IsAdminConsented {\n+        YES(LabConstants.IsAdminConsented.YES),\n+        NO(LabConstants.IsAdminConsented.NO)\n+        ;\n+        String constant;\n+        IsAdminConsented(String constant) {\n+            this.constant = constant;\n+        }\n+        String getValue() {\n+            return constant;\n+        }\n+    }\n+\n+    public enum PublicClient {\n+        YES(LabConstants.PublicClient.YES),\n+        NO(LabConstants.PublicClient.NO)\n+        ;\n+        String constant;\n+        PublicClient(String constant) {\n+            this.constant = constant;\n+        }\n+        String getValue() {\n+            return constant;\n+        }\n+    }\n+", "originalCommit": "fb256e0ffef028452e7d33146a2e0e38f1562f03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwNzg2OQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449207869", "bodyText": "I'm going to say no, they're not.  Because nothing stops you from putting the wrong string, or nay, any string into the method arguments nothing saves you from transposing the arguments or provides a path from the method to what the potential values are unless you happen to know that there's a class called LabConstants.", "author": "AdamBJohnsonx", "createdAt": "2020-07-02T18:49:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxMjAxOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449212019", "bodyText": "Makes sense", "author": "shahzaibj", "createdAt": "2020-07-02T18:58:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzI0Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzcxMw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449203713", "bodyText": "Do we really need this method? Is the one below not sufficient?", "author": "shahzaibj", "createdAt": "2020-07-02T18:40:57Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -193,10 +269,17 @@ public static Credential getCredentials(LabUserQuery query) {\n     }\n \n     public static AppInfo getAppInfo() {\n+            return getAppInfo(UserType.CLOUD, AzureEnvironment.AZURE_CLOUD, SignInAudience.AZURE_AD_MULTIPLE_ORGS,\n+                    IsAdminConsented.YES, PublicClient.YES);\n+   }", "originalCommit": "fb256e0ffef028452e7d33146a2e0e38f1562f03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxMTM2OA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449211368", "bodyText": "This is just convenience, since these are supposed to be the \"default\" values according to the swagger document.  I could theoretically just send a to Api/App and get these, and that's what I should probably change this to do.", "author": "AdamBJohnsonx", "createdAt": "2020-07-02T18:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxMjI5MQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449212291", "bodyText": "Okay I would suggest renaming the method then to something like getDefaultAppInfo", "author": "shahzaibj", "createdAt": "2020-07-02T18:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxMjc5NA==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449212794", "bodyText": "Yeah, it's interesting the mismatch between what the service does and what the AppApi class allows.", "author": "AdamBJohnsonx", "createdAt": "2020-07-02T19:00:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIwMzcxMw=="}], "type": "inlineReview", "revised_code": {"commit": "404e4dec253ee432b76a3b3503909a11afabe938", "chunk": "diff --git a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\nindex 130e69e10..f963dd3a0 100644\n--- a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n+++ b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n\n@@ -268,7 +268,7 @@ public class LabUserHelper {\n         return credential;\n     }\n \n-    public static AppInfo getAppInfo() {\n+    public static AppInfo getDefaultAppInfo() {\n             return getAppInfo(UserType.CLOUD, AzureEnvironment.AZURE_CLOUD, SignInAudience.AZURE_AD_MULTIPLE_ORGS,\n                     IsAdminConsented.YES, PublicClient.YES);\n    }\n"}}, {"oid": "404e4dec253ee432b76a3b3503909a11afabe938", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/404e4dec253ee432b76a3b3503909a11afabe938", "message": "CR Comments", "committedDate": "2020-07-02T19:12:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI4NjQ4Mg==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449286482", "bodyText": "Synced offline...let's make sure if this Consumer is needed...if not, then let's remove it", "author": "shahzaibj", "createdAt": "2020-07-02T22:06:02Z", "path": "testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java", "diffHunk": "@@ -146,6 +226,19 @@ public static String loadTempUser(final String userType) {\n         return tempUser.getUpn();\n     }\n \n+    public static TempUser loadTempUserForTest(final String userType, Consumer<TempUser> consumer) {", "originalCommit": "404e4dec253ee432b76a3b3503909a11afabe938", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI4NzkxOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/pull/952#discussion_r449287919", "bodyText": "If I'm returning the reference, I don't need it.", "author": "AdamBJohnsonx", "createdAt": "2020-07-02T22:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI4NjQ4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "021aad4cb71138578cd8faf79b7188e252ac69a2", "chunk": "diff --git a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\nindex f963dd3a0..3bf20e320 100644\n--- a/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n+++ b/testutils/src/main/java/com/microsoft/identity/internal/testutils/labutils/LabUserHelper.java\n\n@@ -226,14 +226,12 @@ public class LabUserHelper {\n         return tempUser.getUpn();\n     }\n \n-    public static TempUser loadTempUserForTest(final String userType, Consumer<TempUser> consumer) {\n+    public static TempUser loadTempUserForTest(final String userType) {\n         LabAuthenticationHelper.getInstance().setupApiClientWithAccessToken();\n         CreateTempUserApi createTempUserApi = new CreateTempUserApi();\n \n         try {\n-            TempUser user = createTempUserApi.post(userType);\n-            consumer.accept(user);\n-            return user;\n+            return createTempUserApi.post(userType);\n         } catch (ApiException e) {\n             throw new RuntimeException(\"Error retrieving lab user\", e);\n         }\n"}}, {"oid": "021aad4cb71138578cd8faf79b7188e252ac69a2", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/021aad4cb71138578cd8faf79b7188e252ac69a2", "message": "CR comments.", "committedDate": "2020-07-02T22:09:46Z", "type": "commit"}, {"oid": "6a09836312d1d088b17a2d8210c9509407a84db8", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/6a09836312d1d088b17a2d8210c9509407a84db8", "message": "Go ahead and use the new semantic UserType.", "committedDate": "2020-07-02T22:13:20Z", "type": "commit"}, {"oid": "4be16ea1e1054e0340c04ed40a4458b7e762c4b3", "url": "https://github.com/AzureAD/microsoft-authentication-library-common-for-android/commit/4be16ea1e1054e0340c04ed40a4458b7e762c4b3", "message": "Revert \"Go ahead and use the new semantic UserType.\"\n\nThis reverts commit 6a09836312d1d088b17a2d8210c9509407a84db8.", "committedDate": "2020-07-02T22:15:41Z", "type": "commit"}]}