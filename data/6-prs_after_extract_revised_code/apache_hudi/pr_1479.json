{"pr_number": 1479, "pr_title": "[HUDI-758] Modify Integration test to include incremental queries on MOR tables", "pr_createdAt": "2020-04-02T18:23:31Z", "pr_url": "https://github.com/apache/hudi/pull/1479", "timeline": [{"oid": "1c5655821022f04b01843bdca2f3951a46ef72ef", "url": "https://github.com/apache/hudi/commit/1c5655821022f04b01843bdca2f3951a46ef72ef", "message": "[HUDI-758] Modify Integration test to include incremental queries for MOR tables", "committedDate": "2020-04-02T18:09:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTg3MDUzMw==", "url": "https://github.com/apache/hudi/pull/1479#discussion_r405870533", "bodyText": "minor nit: please consider renaming the variable to expectedOutput instead since its used across all types of tables.", "author": "bhasudha", "createdAt": "2020-04-08T23:24:03Z", "path": "hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java", "diffHunk": "@@ -267,23 +270,37 @@ private void testSparkSQLAfterSecondBatch() throws Exception {\n     assertStdOutContains(stdOutErrPair, \"|GOOG  |2018-08-31 10:29:00|3391  |1230.1899|1230.085|\");\n   }\n \n-  private void testIncrementalHiveQuery() throws Exception {\n+  private void testIncrementalHiveQuery(String minCommitTimeScript, String incrementalCommandsFile,\n+                                        String expectedOutput, int expectedTimes) throws Exception {\n     String minCommitTime =\n-        executeCommandStringInDocker(ADHOC_2_CONTAINER, MIN_COMMIT_TIME_SCRIPT, true).getStdout().toString();\n+        executeCommandStringInDocker(ADHOC_2_CONTAINER, minCommitTimeScript, true).getStdout().toString();\n     Pair<String, String> stdOutErrPair =\n-        executeHiveCommandFile(HIVE_INCREMENTAL_COMMANDS, \"min.commit.time=\" + minCommitTime + \"`\");\n-    assertStdOutContains(stdOutErrPair, \"| GOOG    | 2018-08-31 10:59:00  | 9021    | 1227.1993  | 1227.215  |\");\n+        executeHiveCommandFile(incrementalCommandsFile, \"min.commit.time=\" + minCommitTime + \"`\");\n+    assertStdOutContains(stdOutErrPair, expectedOutput, expectedTimes);\n+  }\n+\n+  private void testIncrementalHiveQueryBeforeCompaction() throws Exception {\n+    String expectedOutputCOW = \"| GOOG    | 2018-08-31 10:59:00  | 9021    | 1227.1993  | 1227.215  |\";", "originalCommit": "1c5655821022f04b01843bdca2f3951a46ef72ef", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0f6f42ce7bee8292ee3f6a40a0e4a1939d4d878", "chunk": "diff --git a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\nindex 2ce25f030..a661d1c0a 100644\n--- a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\n+++ b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\n\n@@ -280,16 +280,16 @@ public class ITTestHoodieDemo extends ITTestBase {\n   }\n \n   private void testIncrementalHiveQueryBeforeCompaction() throws Exception {\n-    String expectedOutputCOW = \"| GOOG    | 2018-08-31 10:59:00  | 9021    | 1227.1993  | 1227.215  |\";\n+    String expectedOutput = \"| GOOG    | 2018-08-31 10:59:00  | 9021    | 1227.1993  | 1227.215  |\";\n \n     // verify that 10:59 is present in COW table because there is no compaction process for COW\n-    testIncrementalHiveQuery(MIN_COMMIT_TIME_COW_SCRIPT, HIVE_INCREMENTAL_COW_COMMANDS, expectedOutputCOW, 1);\n+    testIncrementalHiveQuery(MIN_COMMIT_TIME_COW_SCRIPT, HIVE_INCREMENTAL_COW_COMMANDS, expectedOutput, 1);\n \n     // verify that 10:59 is NOT present in RO table because of pending compaction\n-   testIncrementalHiveQuery(MIN_COMMIT_TIME_MOR_SCRIPT, HIVE_INCREMENTAL_MOR_RO_COMMANDS, expectedOutputCOW, 0);\n+   testIncrementalHiveQuery(MIN_COMMIT_TIME_MOR_SCRIPT, HIVE_INCREMENTAL_MOR_RO_COMMANDS, expectedOutput, 0);\n \n     // verify that 10:59 is present in RT table even with pending compaction\n-    testIncrementalHiveQuery(MIN_COMMIT_TIME_MOR_SCRIPT, HIVE_INCREMENTAL_MOR_RT_COMMANDS, expectedOutputCOW, 1);\n+    testIncrementalHiveQuery(MIN_COMMIT_TIME_MOR_SCRIPT, HIVE_INCREMENTAL_MOR_RT_COMMANDS, expectedOutput, 1);\n   }\n \n   private void testIncrementalHiveQueryAfterCompaction() throws Exception {\n"}}, {"oid": "c0f6f42ce7bee8292ee3f6a40a0e4a1939d4d878", "url": "https://github.com/apache/hudi/commit/c0f6f42ce7bee8292ee3f6a40a0e4a1939d4d878", "message": "rename variable per review comments", "committedDate": "2020-04-08T23:35:15Z", "type": "commit"}]}