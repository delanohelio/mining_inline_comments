{"pr_number": 2044, "pr_title": "[HUDI-1228] Add utility method to query extra metadata", "pr_createdAt": "2020-08-26T20:13:10Z", "pr_url": "https://github.com/apache/hudi/pull/2044", "timeline": [{"oid": "a8550fde6d88f7a0789f962fc42815a6e6dfa0f9", "url": "https://github.com/apache/hudi/commit/a8550fde6d88f7a0789f962fc42815a6e6dfa0f9", "message": "[HUDI-1228] Add utility method to query extra metadata", "committedDate": "2020-08-26T23:42:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxMjg5Nw==", "url": "https://github.com/apache/hudi/pull/2044#discussion_r478612897", "bodyText": "@satishkotha can you describe what this method is used for ? The naming is a little confusing..", "author": "n3nash", "createdAt": "2020-08-27T18:25:23Z", "path": "hudi-common/src/main/java/org/apache/hudi/common/table/timeline/TimelineUtils.java", "diffHunk": "@@ -98,4 +101,31 @@\n \n     }).distinct().filter(s -> !s.isEmpty()).collect(Collectors.toList());\n   }\n+\n+  /**\n+   * Get extra metadata for specified key from latest commit/deltacommit instant.\n+   */\n+  public static Option<String> getExtraMetadataFromLatest(HoodieTableMetaClient metaClient, String extraMetadataKey) {\n+    return metaClient.getCommitsTimeline().filterCompletedInstants().getReverseOrderedInstants().findFirst().map(instant ->\n+        getMetadataValue(metaClient, extraMetadataKey, instant)).orElse(Option.empty());\n+  }\n+\n+  /**\n+   * Get extra metadata for specified key from all active commit/deltacommit instants.\n+   */\n+  public static Map<String, Option<String>> getExtraMetadataTimeline(HoodieTableMetaClient metaClient, String extraMetadataKey) {", "originalCommit": "a8550fde6d88f7a0789f962fc42815a6e6dfa0f9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYyMDU0Ng==", "url": "https://github.com/apache/hudi/pull/2044#discussion_r478620546", "bodyText": "This is primarily for debugging. This helps with seeing how extra metadata value changed over time.  If you have better suggestion for a name, let me know", "author": "satishkotha", "createdAt": "2020-08-27T18:39:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxMjg5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNTc4NQ==", "url": "https://github.com/apache/hudi/pull/2044#discussion_r479425785", "bodyText": "getAllExtraMetadataFromActiveTimeline ?", "author": "n3nash", "createdAt": "2020-08-28T16:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxMjg5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ1Nzk0MA==", "url": "https://github.com/apache/hudi/pull/2044#discussion_r479457940", "bodyText": "@n3nash renamed. Please review", "author": "satishkotha", "createdAt": "2020-08-28T18:03:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxMjg5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "ad0efe04fd0ab21ec68e2ac54e13efb6a13e76d7", "chunk": "diff --git a/hudi-common/src/main/java/org/apache/hudi/common/table/timeline/TimelineUtils.java b/hudi-common/src/main/java/org/apache/hudi/common/table/timeline/TimelineUtils.java\nindex 6790033c4a..95a2ae618c 100644\n--- a/hudi-common/src/main/java/org/apache/hudi/common/table/timeline/TimelineUtils.java\n+++ b/hudi-common/src/main/java/org/apache/hudi/common/table/timeline/TimelineUtils.java\n\n@@ -113,7 +113,7 @@ public class TimelineUtils {\n   /**\n    * Get extra metadata for specified key from all active commit/deltacommit instants.\n    */\n-  public static Map<String, Option<String>> getExtraMetadataTimeline(HoodieTableMetaClient metaClient, String extraMetadataKey) {\n+  public static Map<String, Option<String>> getAllExtraMetadataForKey(HoodieTableMetaClient metaClient, String extraMetadataKey) {\n     return metaClient.getCommitsTimeline().filterCompletedInstants().getReverseOrderedInstants().collect(Collectors.toMap(\n           HoodieInstant::getTimestamp, instant -> getMetadataValue(metaClient, extraMetadataKey, instant)));\n   }\n"}}, {"oid": "ad0efe04fd0ab21ec68e2ac54e13efb6a13e76d7", "url": "https://github.com/apache/hudi/commit/ad0efe04fd0ab21ec68e2ac54e13efb6a13e76d7", "message": "[HUDI-1228] Add utility method to query extra metadata", "committedDate": "2020-08-28T18:02:27Z", "type": "commit"}, {"oid": "ad0efe04fd0ab21ec68e2ac54e13efb6a13e76d7", "url": "https://github.com/apache/hudi/commit/ad0efe04fd0ab21ec68e2ac54e13efb6a13e76d7", "message": "[HUDI-1228] Add utility method to query extra metadata", "committedDate": "2020-08-28T18:02:27Z", "type": "forcePushed"}]}