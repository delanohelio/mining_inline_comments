{"pr_number": 1538, "pr_title": "[HUDI-803]: added more test cases in TestHoodieAvroUtils.class", "pr_createdAt": "2020-04-20T15:54:43Z", "pr_url": "https://github.com/apache/hudi/pull/1538", "timeline": [{"oid": "b13db4d9f6d17c0fa7e8dfcb6f15f4530385ba69", "url": "https://github.com/apache/hudi/commit/b13db4d9f6d17c0fa7e8dfcb6f15f4530385ba69", "message": "[HUDI-803]: added more test cases in TestHoodieAvroUtils.class", "committedDate": "2020-04-20T15:50:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0NjkyNw==", "url": "https://github.com/apache/hudi/pull/1538#discussion_r412646927", "bodyText": "this need not be public right.. just being package protected will allow you to access this in tests?", "author": "vinothchandar", "createdAt": "2020-04-22T03:45:36Z", "path": "hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java", "diffHunk": "@@ -60,7 +61,7 @@\n   private static ThreadLocal<BinaryDecoder> reuseDecoder = ThreadLocal.withInitial(() -> null);\n \n   // All metadata fields are optional strings.\n-  private static final Schema METADATA_FIELD_SCHEMA =\n+  public static final Schema METADATA_FIELD_SCHEMA =", "originalCommit": "b13db4d9f6d17c0fa7e8dfcb6f15f4530385ba69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkyNzM3NQ==", "url": "https://github.com/apache/hudi/pull/1538#discussion_r412927375", "bodyText": "Done.", "author": "pratyakshsharma", "createdAt": "2020-04-22T12:13:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0NjkyNw=="}], "type": "inlineReview", "revised_code": {"commit": "2f1925e8e08efa6ef017faf1d7a5327d65313b60", "chunk": "diff --git a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\nindex 76658d6c2..b8809d5e1 100644\n--- a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n+++ b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n\n@@ -61,7 +61,7 @@ public class HoodieAvroUtils {\n   private static ThreadLocal<BinaryDecoder> reuseDecoder = ThreadLocal.withInitial(() -> null);\n \n   // All metadata fields are optional strings.\n-  public static final Schema METADATA_FIELD_SCHEMA =\n+  protected static final Schema METADATA_FIELD_SCHEMA =\n       Schema.createUnion(Arrays.asList(Schema.create(Schema.Type.NULL), Schema.create(Schema.Type.STRING)));\n \n   private static final Schema RECORD_KEY_SCHEMA = initRecordKeySchema();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0NzE5Ng==", "url": "https://github.com/apache/hudi/pull/1538#discussion_r412647196", "bodyText": "@afilipchik to get your eyes on this as well ..", "author": "vinothchandar", "createdAt": "2020-04-22T03:46:19Z", "path": "hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java", "diffHunk": "@@ -214,7 +215,11 @@ private static GenericRecord rewrite(GenericRecord record, LinkedHashSet<Field>\n     GenericRecord newRecord = new GenericData.Record(newSchema);\n     for (Schema.Field f : fieldsToWrite) {\n       if (record.get(f.name()) == null) {\n-        newRecord.put(f.name(), f.defaultVal());\n+        if (f.defaultVal() instanceof JsonProperties.Null) {", "originalCommit": "b13db4d9f6d17c0fa7e8dfcb6f15f4530385ba69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY4OTAwNg==", "url": "https://github.com/apache/hudi/pull/1538#discussion_r412689006", "bodyText": "This code change is exactly what @afilipchik did in his PR :)\nI have just added some more test cases to be sure nothing breaks around default values.", "author": "pratyakshsharma", "createdAt": "2020-04-22T05:51:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY0NzE5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "8f0c6efaf4d23a632f0c41757cf1aec73cfc9841", "chunk": "diff --git a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\nindex 76658d6c2..196459e61 100644\n--- a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n+++ b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n\n@@ -215,7 +253,7 @@ public class HoodieAvroUtils {\n     GenericRecord newRecord = new GenericData.Record(newSchema);\n     for (Schema.Field f : fieldsToWrite) {\n       if (record.get(f.name()) == null) {\n-        if (f.defaultVal() instanceof JsonProperties.Null) {\n+        if (f.defaultVal() instanceof Null) {\n           newRecord.put(f.name(), null);\n         } else {\n           newRecord.put(f.name(), f.defaultVal());\n"}}, {"oid": "2f1925e8e08efa6ef017faf1d7a5327d65313b60", "url": "https://github.com/apache/hudi/commit/2f1925e8e08efa6ef017faf1d7a5327d65313b60", "message": "[HUDI-803]: code review comments addressed", "committedDate": "2020-04-22T12:16:44Z", "type": "commit"}, {"oid": "8f0c6efaf4d23a632f0c41757cf1aec73cfc9841", "url": "https://github.com/apache/hudi/commit/8f0c6efaf4d23a632f0c41757cf1aec73cfc9841", "message": "[HUDI-803]: added more test cases in TestHoodieAvroUtils.class", "committedDate": "2020-05-14T01:34:39Z", "type": "commit"}, {"oid": "e2e50be4763ebb025ef67268618e42293c859980", "url": "https://github.com/apache/hudi/commit/e2e50be4763ebb025ef67268618e42293c859980", "message": "[HUDI-803]: code review comments addressed", "committedDate": "2020-05-14T01:35:08Z", "type": "commit"}, {"oid": "53eff2b143bc04135344ea09a4049c4fcb68b6f6", "url": "https://github.com/apache/hudi/commit/53eff2b143bc04135344ea09a4049c4fcb68b6f6", "message": "Replaced used of NullNode with JsonProperties.NULL_VALUE in HoodieAvroUtils", "committedDate": "2020-05-14T06:05:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgwNzUzOQ==", "url": "https://github.com/apache/hudi/pull/1538#discussion_r424807539", "bodyText": "just removing private should make this easy for testing... i.e package private as opposed to protected?", "author": "vinothchandar", "createdAt": "2020-05-14T00:37:16Z", "path": "hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java", "diffHunk": "@@ -60,7 +61,7 @@\n   private static ThreadLocal<BinaryDecoder> reuseDecoder = ThreadLocal.withInitial(() -> null);\n \n   // All metadata fields are optional strings.\n-  private static final Schema METADATA_FIELD_SCHEMA =\n+  protected static final Schema METADATA_FIELD_SCHEMA =", "originalCommit": "2f1925e8e08efa6ef017faf1d7a5327d65313b60", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8f0c6efaf4d23a632f0c41757cf1aec73cfc9841", "chunk": "diff --git a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\nindex b8809d5e1..196459e61 100644\n--- a/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n+++ b/hudi-common/src/main/java/org/apache/hudi/avro/HoodieAvroUtils.java\n\n@@ -61,7 +64,7 @@ public class HoodieAvroUtils {\n   private static ThreadLocal<BinaryDecoder> reuseDecoder = ThreadLocal.withInitial(() -> null);\n \n   // All metadata fields are optional strings.\n-  protected static final Schema METADATA_FIELD_SCHEMA =\n+  public static final Schema METADATA_FIELD_SCHEMA =\n       Schema.createUnion(Arrays.asList(Schema.create(Schema.Type.NULL), Schema.create(Schema.Type.STRING)));\n \n   private static final Schema RECORD_KEY_SCHEMA = initRecordKeySchema();\n"}}, {"oid": "53eff2b143bc04135344ea09a4049c4fcb68b6f6", "url": "https://github.com/apache/hudi/commit/53eff2b143bc04135344ea09a4049c4fcb68b6f6", "message": "Replaced used of NullNode with JsonProperties.NULL_VALUE in HoodieAvroUtils", "committedDate": "2020-05-14T06:05:52Z", "type": "forcePushed"}, {"oid": "dc11bfe2c248811b087c276a0330c9455bd81281", "url": "https://github.com/apache/hudi/commit/dc11bfe2c248811b087c276a0330c9455bd81281", "message": "[HUDI-803]: small changes", "committedDate": "2020-05-14T12:45:43Z", "type": "commit"}, {"oid": "8d0a6d183ce4494f606dc4e08871813bed3ca336", "url": "https://github.com/apache/hudi/commit/8d0a6d183ce4494f606dc4e08871813bed3ca336", "message": "[HUDI-803]: small changes in TestHoodieAvroUtils", "committedDate": "2020-05-15T18:31:58Z", "type": "commit"}, {"oid": "00f6ef80b74883ce1395d5e5b5dcc1bc019c6dda", "url": "https://github.com/apache/hudi/commit/00f6ef80b74883ce1395d5e5b5dcc1bc019c6dda", "message": "[HUDI-803]: small changes", "committedDate": "2020-05-16T10:29:28Z", "type": "commit"}, {"oid": "1373deee70c8a9a6901dd0d869c9b154c6aca45d", "url": "https://github.com/apache/hudi/commit/1373deee70c8a9a6901dd0d869c9b154c6aca45d", "message": "Merge branch 'master' of https://github.com/apache/incubator-hudi into hudi-803", "committedDate": "2020-05-20T13:23:34Z", "type": "commit"}]}