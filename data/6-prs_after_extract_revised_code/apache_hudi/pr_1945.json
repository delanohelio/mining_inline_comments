{"pr_number": 1945, "pr_title": "[HUDI-1175] Minor fixes for CI flakiness", "pr_createdAt": "2020-08-10T23:26:54Z", "pr_url": "https://github.com/apache/hudi/pull/1945", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0NTAxNQ==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468245015", "bodyText": "@nsivabalan : I had earlier suggested this to unblock debugging. Can you see why data-node is coming up occasionally ?", "author": "bvaradar", "createdAt": "2020-08-10T23:43:15Z", "path": "hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java", "diffHunk": "@@ -115,6 +116,7 @@ public void testParquetDemo() throws Exception {\n   }\n \n   private void setupDemo() throws Exception {\n+    Thread.sleep(60 * 1000);", "originalCommit": "a10b2f202165a9724f7263e3e5d51b09b9fe336f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0NTY0MA==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468245640", "bodyText": "I didn't see this in the last 30 odd runs. So, gonna be tough to repro.", "author": "nsivabalan", "createdAt": "2020-08-10T23:45:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI0NTAxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "6aa82968c9f00286877d8cf899b4f8ff0ff9db17", "chunk": "diff --git a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\nindex 2b47ceb37..33aff9356 100644\n--- a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\n+++ b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestHoodieDemo.java\n\n@@ -116,7 +116,6 @@ public class ITTestHoodieDemo extends ITTestBase {\n   }\n \n   private void setupDemo() throws Exception {\n-    Thread.sleep(60 * 1000);\n     List<String> cmds = CollectionUtils.createImmutableList(\"hdfs dfsadmin -safemode wait\",\n         \"hdfs dfs -mkdir -p \" + HDFS_DATA_DIR,\n         \"hdfs dfs -copyFromLocal -f \" + INPUT_BATCH_PATH1 + \" \" + HDFS_BATCH_PATH1,\n"}}, {"oid": "6aa82968c9f00286877d8cf899b4f8ff0ff9db17", "url": "https://github.com/apache/hudi/commit/6aa82968c9f00286877d8cf899b4f8ff0ff9db17", "message": "Commenting out testsuite tests from Integration tests until we investigate the CI flakiness", "committedDate": "2020-08-10T23:47:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MTYyMw==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468251623", "bodyText": "can we clean up these s.o.p?", "author": "vinothchandar", "createdAt": "2020-08-11T00:05:14Z", "path": "hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestBase.java", "diffHunk": "@@ -103,22 +103,26 @@ private static String getHiveConsoleCommandFile(String commandFile, String addit\n     if (additionalVar != null) {\n       builder.append(\" --hivevar \" + additionalVar + \" \");\n     }\n-    return builder.append(\" -f \").append(commandFile).toString();\n+    builder.append(\" -f \").append(commandFile);\n+    System.out.println(\"Hive command : \" + builder.toString());", "originalCommit": "6aa82968c9f00286877d8cf899b4f8ff0ff9db17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NTEzMA==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468265130", "bodyText": "this was useful in general while checking the Integ tests log output. If not for this, it wasn't easy to understand where the tests fails if tests hung or terminated half way if not for explicit exception. I prefer to keep this actually.", "author": "nsivabalan", "createdAt": "2020-08-11T00:53:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MTYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjYwNg==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468266606", "bodyText": "no I meant, why not log.info() or something?", "author": "vinothchandar", "createdAt": "2020-08-11T00:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MTYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2NjgyMQ==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468266821", "bodyText": "We should look into why these thing are not being logged now. they showed up for sure before", "author": "vinothchandar", "createdAt": "2020-08-11T01:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MTYyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI2OTA3Nw==", "url": "https://github.com/apache/hudi/pull/1945#discussion_r468269077", "bodyText": "you are right. I do see all commands are already logged. my bad.", "author": "nsivabalan", "createdAt": "2020-08-11T01:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1MTYyMw=="}], "type": "inlineReview", "revised_code": {"commit": "6e7cf8d0811372da2b601f6aa709e9eac68807e9", "chunk": "diff --git a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestBase.java b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestBase.java\nindex c707b4e0f..d0b32eec3 100644\n--- a/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestBase.java\n+++ b/hudi-integ-test/src/test/java/org/apache/hudi/integ/ITTestBase.java\n\n@@ -103,27 +103,21 @@ public abstract class ITTestBase {\n     if (additionalVar != null) {\n       builder.append(\" --hivevar \" + additionalVar + \" \");\n     }\n-    builder.append(\" -f \").append(commandFile);\n-    System.out.println(\"Hive command : \" + builder.toString());\n-    return builder.toString();\n+    return builder.append(\" -f \").append(commandFile).toString();\n   }\n \n   static String getSparkShellCommand(String commandFile) {\n-    StringBuilder builder = new StringBuilder().append(\"spark-shell --jars \").append(HUDI_SPARK_BUNDLE)\n+    return new StringBuilder().append(\"spark-shell --jars \").append(HUDI_SPARK_BUNDLE)\n         .append(\" --master local[2] --driver-class-path \").append(HADOOP_CONF_DIR)\n         .append(\n             \" --conf spark.sql.hive.convertMetastoreParquet=false --deploy-mode client  --driver-memory 1G --executor-memory 1G --num-executors 1 \")\n-        .append(\" --packages org.apache.spark:spark-avro_2.11:2.4.4 \").append(\" -i \").append(commandFile);\n-    System.out.println(\"Spark command : \" + builder.toString());\n-    return builder.toString();\n+        .append(\" --packages org.apache.spark:spark-avro_2.11:2.4.4 \").append(\" -i \").append(commandFile).toString();\n   }\n \n   static String getPrestoConsoleCommand(String commandFile) {\n-    StringBuilder builder = new StringBuilder().append(\"presto --server \" + PRESTO_COORDINATOR_URL)\n+    return new StringBuilder().append(\"presto --server \" + PRESTO_COORDINATOR_URL)\n         .append(\" --catalog hive --schema default\")\n-        .append(\" -f \" + commandFile);\n-    System.out.println(\"Presto command : \" + builder.toString());\n-    return builder.toString();\n+        .append(\" -f \" + commandFile).toString();\n   }\n \n   @BeforeEach\n"}}, {"oid": "6e7cf8d0811372da2b601f6aa709e9eac68807e9", "url": "https://github.com/apache/hudi/commit/6e7cf8d0811372da2b601f6aa709e9eac68807e9", "message": "Commenting out testsuite tests from Integration tests until we investigate the CI flakiness", "committedDate": "2020-08-11T01:06:22Z", "type": "commit"}, {"oid": "6e7cf8d0811372da2b601f6aa709e9eac68807e9", "url": "https://github.com/apache/hudi/commit/6e7cf8d0811372da2b601f6aa709e9eac68807e9", "message": "Commenting out testsuite tests from Integration tests until we investigate the CI flakiness", "committedDate": "2020-08-11T01:06:22Z", "type": "forcePushed"}]}