{"pr_number": 2306, "pr_title": "HUDI-1439 Remove scala dependency from hudi-client-common", "pr_createdAt": "2020-12-08T06:13:51Z", "pr_url": "https://github.com/apache/hudi/pull/2306", "timeline": [{"oid": "6cdb46dfa7708ae410afa3cd97bc204be80af502", "url": "https://github.com/apache/hudi/commit/6cdb46dfa7708ae410afa3cd97bc204be80af502", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-08T07:49:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODIzNTY3OQ==", "url": "https://github.com/apache/hudi/pull/2306#discussion_r538235679", "bodyText": "is there a way to do this lazily? convert to a stream and map to tuple and get the underlying iterator?", "author": "vinothchandar", "createdAt": "2020-12-08T10:48:43Z", "path": "hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/simple/SparkHoodieSimpleIndex.java", "diffHunk": "@@ -147,6 +150,12 @@ public boolean isImplicitWithStorage() {\n     JavaSparkContext jsc = HoodieSparkEngineContext.getSparkContext(context);\n     int fetchParallelism = Math.max(1, Math.max(baseFiles.size(), parallelism));\n     return jsc.parallelize(baseFiles, fetchParallelism)\n-        .flatMapToPair(partitionPathBaseFile -> new HoodieKeyLocationFetchHandle(config, hoodieTable, partitionPathBaseFile).locations());\n+        .flatMapToPair( partitionPathBaseFile -> {\n+          Iterator<ImmutablePair<HoodieKey, HoodieRecordLocation>> iter =", "originalCommit": "6cdb46dfa7708ae410afa3cd97bc204be80af502", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ffdfcc4e6fdf84fd4b8ee4deed625b361a4b1efd", "chunk": "diff --git a/hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/simple/SparkHoodieSimpleIndex.java b/hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/simple/SparkHoodieSimpleIndex.java\nindex d28fe9e3b..78609e467 100644\n--- a/hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/simple/SparkHoodieSimpleIndex.java\n+++ b/hudi-client/hudi-spark-client/src/main/java/org/apache/hudi/index/simple/SparkHoodieSimpleIndex.java\n\n@@ -150,12 +150,9 @@ public class SparkHoodieSimpleIndex<T extends HoodieRecordPayload> extends Spark\n     JavaSparkContext jsc = HoodieSparkEngineContext.getSparkContext(context);\n     int fetchParallelism = Math.max(1, Math.max(baseFiles.size(), parallelism));\n     return jsc.parallelize(baseFiles, fetchParallelism)\n-        .flatMapToPair( partitionPathBaseFile -> {\n-          Iterator<ImmutablePair<HoodieKey, HoodieRecordLocation>> iter =\n-              new HoodieKeyLocationFetchHandle(config, hoodieTable, partitionPathBaseFile).locations();\n-          List<Tuple2<HoodieKey, HoodieRecordLocation>> actualList = new ArrayList<>();\n-          iter.forEachRemaining(x -> actualList.add(new Tuple2<>(x.getLeft(), x.getRight())));\n-          return actualList.iterator();\n-        });\n+        .flatMapToPair(partitionPathBaseFile ->\n+          new HoodieKeyLocationFetchHandle(config, hoodieTable, partitionPathBaseFile).locations()\n+                  .map(x -> Tuple2.apply(x.getLeft(), x.getRtight())).iterator()\n+        );\n   }\n }\n"}}, {"oid": "ffdfcc4e6fdf84fd4b8ee4deed625b361a4b1efd", "url": "https://github.com/apache/hudi/commit/ffdfcc4e6fdf84fd4b8ee4deed625b361a4b1efd", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-08T14:08:10Z", "type": "forcePushed"}, {"oid": "5a33f34edc95df0690107e6bacc179ab1f66050d", "url": "https://github.com/apache/hudi/commit/5a33f34edc95df0690107e6bacc179ab1f66050d", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-08T14:15:49Z", "type": "forcePushed"}, {"oid": "d4edce0066d97ef15769e9e6d2fc2ff9e4dd99ad", "url": "https://github.com/apache/hudi/commit/d4edce0066d97ef15769e9e6d2fc2ff9e4dd99ad", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-08T14:26:07Z", "type": "forcePushed"}, {"oid": "9d9887c21f2b7d06e134c5957175cc5d26a478e0", "url": "https://github.com/apache/hudi/commit/9d9887c21f2b7d06e134c5957175cc5d26a478e0", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-08T14:32:35Z", "type": "forcePushed"}, {"oid": "712ac6d142ffb1cf96c2eda9e56096b12b15e9a8", "url": "https://github.com/apache/hudi/commit/712ac6d142ffb1cf96c2eda9e56096b12b15e9a8", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-09T13:52:30Z", "type": "commit"}, {"oid": "712ac6d142ffb1cf96c2eda9e56096b12b15e9a8", "url": "https://github.com/apache/hudi/commit/712ac6d142ffb1cf96c2eda9e56096b12b15e9a8", "message": "HUDI-1439 Remove scala dependency from hudi-client-common", "committedDate": "2020-12-09T13:52:30Z", "type": "forcePushed"}]}