{"pr_number": 3281, "pr_title": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created", "pr_createdAt": "2020-04-22T22:05:25Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3281", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyNTQzMQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r413725431", "bodyText": "Hi @Josephblt,\nwe already have an ability to use file name as process ID. It because now we are getting file name with filepath from VS Code. My idea is to parse package from the path if possible. For example, if it is a maven project than file path will be like /some/path/ProjectName/src/main/java/folder/folder2/FileName.bpmn.\nSo, if file path contains src/main/java all between it and file name can be a package, just need to replace / or \\ to dots. And if src/main/java pattern is not met, use default value. WDYT?\nThe code about file name is located here: https://github.com/hasys/kie-wb-common/blob/d94848a21f0f2966acc960dc9ddd9f7aa9b398bf/kie-wb-common-stunner/kie-wb-common-stunner-extensions/kie-wb-common-stunner-kogito/kie-wb-common-stunner-kogito-client/src/main/java/org/kie/workbench/common/stunner/kogito/client/service/AbstractKogitoClientDiagramService.java", "author": "hasys", "createdAt": "2020-04-23T11:09:45Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java", "diffHunk": "@@ -146,6 +148,11 @@ private void updateDiagramSet(Node<Definition<BPMNDiagram>, ?> diagramNode, Stri\n         if (diagramSet.getId().getValue().isEmpty()) {\n             diagramSet.getId().setValue(createValidId(name));\n         }\n+\n+        if (diagramSet.getPackageProperty().getValue() == null ||\n+                diagramSet.getPackageProperty().getValue().isEmpty()) {\n+            diagramSet.getPackageProperty().setValue(DEFAULT_PACKAGE);", "originalCommit": "caff6aa0ae8767d2e54564e5e282d2bad3164540", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA3ODA3MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r414078070", "bodyText": "Hey @hasys\nThanks for pointing this out. As already commented with @Josephblt I would keep this improvement in a new ticket, and let's discuss it on next meeting. It's because we were already considering this with @pefernan and @ederign , I mean about supporting maven directory structures on the projects, but it's still not present neither on the fundation side. So as  it's not a decision we're taking across the tooling, I'm not yet feeling confident with doing it.", "author": "romartin", "createdAt": "2020-04-23T19:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyNTQzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0MjkyNg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r414842926", "bodyText": "Hello @LuboTerifaj, @romartin, @pefernan. Here is the JIRA to track your suggestion @LuboTerifaj.\nhttps://issues.redhat.com/browse/KOGITO-2014\nLet's discuss this. Thanks.", "author": "Josephblt", "createdAt": "2020-04-24T20:26:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzcyNTQzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "002f42ed92ee8b83ba238049d49dc3e326e01659", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\nindex 6c0be198c4..c7703650e1 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n\n@@ -141,11 +142,13 @@ public class BPMNClientDiagramService extends AbstractKogitoClientDiagramService\n     private void updateDiagramSet(Node<Definition<BPMNDiagram>, ?> diagramNode, String name) {\n         final BaseDiagramSet diagramSet = diagramNode.getContent().getDefinition().getDiagramSet();\n \n-        if (diagramSet.getName().getValue().isEmpty()) {\n+        if (diagramSet.getPackageProperty().getValue() == null ||\n+                diagramSet.getName().getValue().isEmpty()) {\n             diagramSet.getName().setValue(name);\n         }\n \n-        if (diagramSet.getId().getValue().isEmpty()) {\n+        if (diagramSet.getPackageProperty().getValue() == null ||\n+                diagramSet.getId().getValue().isEmpty()) {\n             diagramSet.getId().setValue(createValidId(name));\n         }\n \n"}}, {"oid": "002f42ed92ee8b83ba238049d49dc3e326e01659", "url": "https://github.com/kiegroup/kie-wb-common/commit/002f42ed92ee8b83ba238049d49dc3e326e01659", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-04-24T18:59:32Z", "type": "forcePushed"}, {"oid": "cff7dab9941691fcbfa097062e616b1e72175466", "url": "https://github.com/kiegroup/kie-wb-common/commit/cff7dab9941691fcbfa097062e616b1e72175466", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-04-27T14:58:50Z", "type": "forcePushed"}, {"oid": "3ecaabc8bcf91bb7ad89ffb841d0a104cc56c021", "url": "https://github.com/kiegroup/kie-wb-common/commit/3ecaabc8bcf91bb7ad89ffb841d0a104cc56c021", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-04-28T08:28:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjkzOTU5MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r416939590", "bodyText": "can it be private? or at least, package protected (no access modifier)?", "author": "romartin", "createdAt": "2020-04-28T21:38:16Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java", "diffHunk": "@@ -55,6 +55,9 @@\n @ApplicationScoped\n public class BPMNClientDiagramService extends AbstractKogitoClientDiagramService {\n \n+    protected static final String DEFAULT_PACKAGE = \"default\";", "originalCommit": "3ecaabc8bcf91bb7ad89ffb841d0a104cc56c021", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "da981f2936bfa88fd4d839b42946acd69572d2eb", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\nindex c7703650e1..f01efec719 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n\n@@ -55,8 +55,8 @@ import static org.kie.workbench.common.stunner.bpmn.util.XmlUtils.createValidId;\n @ApplicationScoped\n public class BPMNClientDiagramService extends AbstractKogitoClientDiagramService {\n \n-    protected static final String DEFAULT_PACKAGE = \"default\";\n-    protected static final String NO_DIAGRAM_MESSAGE = \"No BPMN Diagram can be found.\";\n+    static final String DEFAULT_PACKAGE = \"default\";\n+    static final String NO_DIAGRAM_MESSAGE = \"No BPMN Diagram can be found.\";\n \n     private final DefinitionManager definitionManager;\n     private final BPMNClientMarshalling marshalling;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0MDE2MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r416940161", "bodyText": "can it be private? or at least, package protected (no access modifier)?", "author": "romartin", "createdAt": "2020-04-28T21:39:20Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java", "diffHunk": "@@ -55,6 +55,9 @@\n @ApplicationScoped\n public class BPMNClientDiagramService extends AbstractKogitoClientDiagramService {\n \n+    protected static final String DEFAULT_PACKAGE = \"default\";\n+    protected static final String NO_DIAGRAM_MESSAGE = \"No BPMN Diagram can be found.\";", "originalCommit": "3ecaabc8bcf91bb7ad89ffb841d0a104cc56c021", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "da981f2936bfa88fd4d839b42946acd69572d2eb", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\nindex c7703650e1..f01efec719 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java\n\n@@ -55,8 +55,8 @@ import static org.kie.workbench.common.stunner.bpmn.util.XmlUtils.createValidId;\n @ApplicationScoped\n public class BPMNClientDiagramService extends AbstractKogitoClientDiagramService {\n \n-    protected static final String DEFAULT_PACKAGE = \"default\";\n-    protected static final String NO_DIAGRAM_MESSAGE = \"No BPMN Diagram can be found.\";\n+    static final String DEFAULT_PACKAGE = \"default\";\n+    static final String NO_DIAGRAM_MESSAGE = \"No BPMN Diagram can be found.\";\n \n     private final DefinitionManager definitionManager;\n     private final BPMNClientMarshalling marshalling;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0MDUxNg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r416940516", "bodyText": "any reason for changing the type to a NullPointerException?", "author": "romartin", "createdAt": "2020-04-28T21:40:03Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-marshalling/src/main/java/org/kie/workbench/common/stunner/bpmn/client/marshall/service/BPMNClientDiagramService.java", "diffHunk": "@@ -166,7 +180,7 @@ private Diagram parse(final String fileName, final String raw) {\n         final Graph<DefinitionSet, ?> graph = marshalling.unmarshall(metadata, raw);\n         final Node<Definition<BPMNDiagram>, ?> diagramNode = GraphUtils.getFirstNode((Graph<?, Node>) graph, BPMNDiagramImpl.class);\n         if (null == diagramNode) {\n-            throw new RuntimeException(\"No BPMN Diagram can be found.\");\n+            throw new NullPointerException(NO_DIAGRAM_MESSAGE);", "originalCommit": "3ecaabc8bcf91bb7ad89ffb841d0a104cc56c021", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA0NzQ4NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3281#discussion_r417047485", "bodyText": "Well, this is flagged as code smell by SonarCloud. It complains about throwing generic exceptions. The exception that would be thrown in case we proceed with a null diagramNode is that one. So I decided to go with that.", "author": "Josephblt", "createdAt": "2020-04-29T03:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0MDUxNg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "da981f2936bfa88fd4d839b42946acd69572d2eb", "url": "https://github.com/kiegroup/kie-wb-common/commit/da981f2936bfa88fd4d839b42946acd69572d2eb", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-04-29T03:17:10Z", "type": "forcePushed"}, {"oid": "d4c3e342f5ece0ddf6f2f3f9b5134f10f1b6fa4e", "url": "https://github.com/kiegroup/kie-wb-common/commit/d4c3e342f5ece0ddf6f2f3f9b5134f10f1b6fa4e", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-05-06T01:04:06Z", "type": "commit"}, {"oid": "d4c3e342f5ece0ddf6f2f3f9b5134f10f1b6fa4e", "url": "https://github.com/kiegroup/kie-wb-common/commit/d4c3e342f5ece0ddf6f2f3f9b5134f10f1b6fa4e", "message": "KOGITO-1748 - VsCode editor - Package property is empty when the process is created\n\nPackage property is set to \"default\" on new .bpmn files. Existing files with empty values\nfor this property will also be set to \"default\".", "committedDate": "2020-05-06T01:04:06Z", "type": "forcePushed"}]}