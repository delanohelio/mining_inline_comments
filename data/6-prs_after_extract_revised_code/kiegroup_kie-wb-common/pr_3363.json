{"pr_number": 3363, "pr_title": "KOGITO-2651 : Allow expressions in output assignments", "pr_createdAt": "2020-07-23T22:05:34Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3363", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466067829", "bodyText": "New test doesn't test constant, but expression. So {hello} should be reverted back to hello.", "author": "hasys", "createdAt": "2020-08-05T23:57:08Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImplTest.java", "diffHunk": "@@ -361,9 +361,8 @@ public void testSetExpressionToOutput() {\n     public void testSetConstantToOutput() {\n         AssignmentRow row = new AssignmentRow(null, OUTPUT, null, null, null, null);\n         when(view.getModel()).thenReturn(row);\n-        view.setExpression(\"hello\");\n-\n-        assertNull(view.getModel().getExpression());\n+        view.setExpression(\"{hello}\");\n+        assertEquals(view.getModel().getExpression(), \"{hello}\");", "originalCommit": "f17737822a61277495d75970ae6db9e17aafc0f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyOTU2MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466729560", "bodyText": "I don't see the issue yet @hasys here, what you mean? I understand the view has some model which contains an expression field (String). The expression has to be set using some syntax (eg: {expr}), also the view shows the raw expression (with complet syntax) on the UI field, which makes sense to me also because this way the view is \"agnostic\" to the expression syntax (that's maybe a presentation stuff). So for me looks fine to return the {hello} back from the view.getModel().getExpression()...\nAs an example, think on the view just being an HTML input element - you would write the complete text with syntax as the value, also you'll expect the same value when you obtain it's value.\nWDYT?", "author": "romartin", "createdAt": "2020-08-06T22:58:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcyOTk3NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466729975", "bodyText": "@inodeman what's wrong here is the order of the arguments for the assertEquals, the first one is the expected value, and second one is the actual. So please try to fix those, if any others. Thanks!", "author": "romartin", "createdAt": "2020-08-06T23:00:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgzNDM4MQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466834381", "bodyText": "Hi @romartin, yes it's a bit frustrating. Main idea was to allow put constants to the output value. But test was changed from test Constants to test Expression. So it was possible to set expression before as well, but wasn't possible to set Constants but after the change constants aren't tested any more.", "author": "hasys", "createdAt": "2020-08-07T05:49:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzI5Njg3MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r467296870", "bodyText": "ok so if I understand properly @hasys - the actual test case is ok but it's still missing to test the Constants option, is that correct?\nAlso please @inodeman remember to change the order for the arguments for assertXXX methods.\nThanks guys!", "author": "romartin", "createdAt": "2020-08-07T21:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg1NTM3NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r467855375", "bodyText": "Yes @romartin, you are right. Just sum up: {hello} - is expression and hello - is a constant. Constant already tested in another method and this test method was specifically created to test Expression.\nAny way @inodeman already fixed it so thank you guys!", "author": "hasys", "createdAt": "2020-08-10T12:00:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2NzgyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "b9fe1144c6dfa3457ce2f5187e976110ca63753e", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImplTest.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImplTest.java\nindex ce697f49f7..fe43f14b90 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImplTest.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/test/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImplTest.java\n\n@@ -361,8 +361,8 @@ public class AssignmentListItemWidgetViewImplTest {\n     public void testSetConstantToOutput() {\n         AssignmentRow row = new AssignmentRow(null, OUTPUT, null, null, null, null);\n         when(view.getModel()).thenReturn(row);\n-        view.setExpression(\"{hello}\");\n-        assertEquals(view.getModel().getExpression(), \"{hello}\");\n+        view.setExpression(\"hello\");\n+        assertEquals(view.getModel().getExpression(), \"hello\");\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2ODU1Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466068557", "bodyText": "Method can be removed now since it had only one invocation.", "author": "hasys", "createdAt": "2020-08-05T23:59:32Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java", "diffHunk": "@@ -281,13 +281,7 @@ public String getExpression() {\n \n     @Override\n     public void setExpression(final String expression) {\n-        if (getModel().getVariableType() == OUTPUT && isConstant(expression)) {\n-            notification.fire(new NotificationEvent(StunnerFormsClientFieldsConstants.INSTANCE.Only_expressions_allowed_for_output(),\n-                                                    NotificationEvent.NotificationType.ERROR));\n-            processVarComboBox.textBoxValueChanged(\"\");\n-        } else {\n             getModel().setExpression(expression);\n-        }\n     }\n \n     private static boolean isConstant(String expression) {", "originalCommit": "f17737822a61277495d75970ae6db9e17aafc0f7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9fe1144c6dfa3457ce2f5187e976110ca63753e", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\nindex 183d901fe0..df50c87666 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\n\n@@ -281,11 +280,7 @@ public class AssignmentListItemWidgetViewImpl extends Composite implements Assig\n \n     @Override\n     public void setExpression(final String expression) {\n-            getModel().setExpression(expression);\n-    }\n-\n-    private static boolean isConstant(String expression) {\n-        return !isEmpty(expression) && !EXPRESSION.test(expression);\n+        getModel().setExpression(expression);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA2ODc5Ng==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3363#discussion_r466068796", "bodyText": "Some spaces can be removed here since it is now on method level.", "author": "hasys", "createdAt": "2020-08-06T00:00:18Z", "path": "kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java", "diffHunk": "@@ -281,13 +281,7 @@ public String getExpression() {\n \n     @Override\n     public void setExpression(final String expression) {\n-        if (getModel().getVariableType() == OUTPUT && isConstant(expression)) {\n-            notification.fire(new NotificationEvent(StunnerFormsClientFieldsConstants.INSTANCE.Only_expressions_allowed_for_output(),\n-                                                    NotificationEvent.NotificationType.ERROR));\n-            processVarComboBox.textBoxValueChanged(\"\");\n-        } else {\n             getModel().setExpression(expression);", "originalCommit": "f17737822a61277495d75970ae6db9e17aafc0f7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b9fe1144c6dfa3457ce2f5187e976110ca63753e", "chunk": "diff --git a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\nindex 183d901fe0..df50c87666 100644\n--- a/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\n+++ b/kie-wb-common-stunner/kie-wb-common-stunner-sets/kie-wb-common-stunner-bpmn/kie-wb-common-stunner-bpmn-client/src/main/java/org/kie/workbench/common/stunner/bpmn/client/forms/fields/assignmentsEditor/AssignmentListItemWidgetViewImpl.java\n\n@@ -281,11 +280,7 @@ public class AssignmentListItemWidgetViewImpl extends Composite implements Assig\n \n     @Override\n     public void setExpression(final String expression) {\n-            getModel().setExpression(expression);\n-    }\n-\n-    private static boolean isConstant(String expression) {\n-        return !isEmpty(expression) && !EXPRESSION.test(expression);\n+        getModel().setExpression(expression);\n     }\n \n     @Override\n"}}, {"oid": "b9fe1144c6dfa3457ce2f5187e976110ca63753e", "url": "https://github.com/kiegroup/kie-wb-common/commit/b9fe1144c6dfa3457ce2f5187e976110ca63753e", "message": "KOGITO-2651 : Allow expressions in output assignments", "committedDate": "2020-08-06T18:07:34Z", "type": "forcePushed"}, {"oid": "a140f57860730e0e98e45c7aa09f05ddc3d0e496", "url": "https://github.com/kiegroup/kie-wb-common/commit/a140f57860730e0e98e45c7aa09f05ddc3d0e496", "message": "KOGITO-2651 : Allow expressions in output assignments", "committedDate": "2020-08-10T15:00:58Z", "type": "commit"}, {"oid": "875b74bda84e5ae8f77ec4633e9b09a867e11759", "url": "https://github.com/kiegroup/kie-wb-common/commit/875b74bda84e5ae8f77ec4633e9b09a867e11759", "message": "KOGITO-2651 : Allow expressions in output assignments", "committedDate": "2020-08-10T15:00:59Z", "type": "commit"}, {"oid": "875b74bda84e5ae8f77ec4633e9b09a867e11759", "url": "https://github.com/kiegroup/kie-wb-common/commit/875b74bda84e5ae8f77ec4633e9b09a867e11759", "message": "KOGITO-2651 : Allow expressions in output assignments", "committedDate": "2020-08-10T15:00:59Z", "type": "forcePushed"}]}