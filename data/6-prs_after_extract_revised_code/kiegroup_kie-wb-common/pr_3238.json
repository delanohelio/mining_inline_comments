{"pr_number": 3238, "pr_title": "AF-2432 : Restoring an old asset version doesn't work outside master branch", "pr_createdAt": "2020-03-23T09:19:58Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3238", "timeline": [{"oid": "b2c3db6de08f5153b20c60cf8c320318d496b000", "url": "https://github.com/kiegroup/kie-wb-common/commit/b2c3db6de08f5153b20c60cf8c320318d496b000", "message": "AF-2432 : Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to trackcurrently modifying branch in editor", "committedDate": "2020-03-31T06:03:32Z", "type": "commit"}, {"oid": "b2c3db6de08f5153b20c60cf8c320318d496b000", "url": "https://github.com/kiegroup/kie-wb-common/commit/b2c3db6de08f5153b20c60cf8c320318d496b000", "message": "AF-2432 : Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to trackcurrently modifying branch in editor", "committedDate": "2020-03-31T06:03:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDUzMg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r402454532", "bodyText": "Consider annotating this class with @Dependent.", "author": "caponetto", "createdAt": "2020-04-02T16:40:13Z", "path": "kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.kie.workbench.common.widgets.client.menu;\n+\n+import javax.inject.Inject;\n+\n+import org.guvnor.common.services.project.client.context.WorkspaceProjectContext;\n+import org.uberfire.ext.editor.commons.client.menu.common.CurrentBranch;\n+\n+public class CurrentBranchImpl implements CurrentBranch {", "originalCommit": "b2c3db6de08f5153b20c60cf8c320318d496b000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3ODA3MA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r404078070", "bodyText": "Done.", "author": "akumar074", "createdAt": "2020-04-06T13:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDUzMg=="}], "type": "inlineReview", "revised_code": {"commit": "36673d50dd996a81022a49ea0a43961991d1f327", "chunk": "diff --git a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\nindex 443c92389d..ba207f770f 100644\n--- a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\n+++ b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\n\n@@ -17,16 +17,21 @@\n \n package org.kie.workbench.common.widgets.client.menu;\n \n+import javax.enterprise.context.Dependent;\n import javax.inject.Inject;\n \n import org.guvnor.common.services.project.client.context.WorkspaceProjectContext;\n-import org.uberfire.ext.editor.commons.client.menu.common.CurrentBranch;\n+import org.uberfire.ext.editor.commons.version.CurrentBranch;\n \n+@Dependent\n public class CurrentBranchImpl implements CurrentBranch {\n \n     @Inject\n     private WorkspaceProjectContext projectContext;\n \n+    public CurrentBranchImpl() {\n+    }\n+\n     @Override\n     public String getName() {\n         return projectContext.getActiveWorkspaceProject()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyODEwMw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r402528103", "bodyText": "Please consider the following suggestion:\nThis class can listen to WorkspaceProjectContextChangeEvent.\nThus you can update a variable, say name, every time this event is fired.\nThen you can simply return name in the getName method.\nThis would make this bean always up-to-date every time the project context is changed.", "author": "caponetto", "createdAt": "2020-04-02T18:34:24Z", "path": "kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.kie.workbench.common.widgets.client.menu;\n+\n+import javax.inject.Inject;\n+\n+import org.guvnor.common.services.project.client.context.WorkspaceProjectContext;\n+import org.uberfire.ext.editor.commons.client.menu.common.CurrentBranch;\n+\n+public class CurrentBranchImpl implements CurrentBranch {\n+\n+    @Inject\n+    private WorkspaceProjectContext projectContext;\n+", "originalCommit": "b2c3db6de08f5153b20c60cf8c320318d496b000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MDgyNg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r404080826", "bodyText": "@caponetto As per your suggestion, I tried using the WorkspaceProjectContextChangeEvent in this implementation and I observed that  WorkspaceProjectContextChangeEvent is not always fired when we change the branch in the view.", "author": "akumar074", "createdAt": "2020-04-06T13:15:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyODEwMw=="}], "type": "inlineReview", "revised_code": {"commit": "36673d50dd996a81022a49ea0a43961991d1f327", "chunk": "diff --git a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\nindex 443c92389d..ba207f770f 100644\n--- a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\n+++ b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/CurrentBranchImpl.java\n\n@@ -17,16 +17,21 @@\n \n package org.kie.workbench.common.widgets.client.menu;\n \n+import javax.enterprise.context.Dependent;\n import javax.inject.Inject;\n \n import org.guvnor.common.services.project.client.context.WorkspaceProjectContext;\n-import org.uberfire.ext.editor.commons.client.menu.common.CurrentBranch;\n+import org.uberfire.ext.editor.commons.version.CurrentBranch;\n \n+@Dependent\n public class CurrentBranchImpl implements CurrentBranch {\n \n     @Inject\n     private WorkspaceProjectContext projectContext;\n \n+    public CurrentBranchImpl() {\n+    }\n+\n     @Override\n     public String getName() {\n         return projectContext.getActiveWorkspaceProject()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyODg3Mg==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r402528872", "bodyText": "You need to inject it, don't you? Also, I think it is better to use the interface.", "author": "caponetto", "createdAt": "2020-04-02T18:35:46Z", "path": "kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/FileMenuBuilderImpl.java", "diffHunk": "@@ -45,6 +45,8 @@\n     @Inject\n     private Caller<CopyService> copyService;\n \n+    private CurrentBranchImpl currentBranch;", "originalCommit": "b2c3db6de08f5153b20c60cf8c320318d496b000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MzQ3NA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r404083474", "bodyText": "I have injected the interface of CurrentBranch.", "author": "akumar074", "createdAt": "2020-04-06T13:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyODg3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "36673d50dd996a81022a49ea0a43961991d1f327", "chunk": "diff --git a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/FileMenuBuilderImpl.java b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/FileMenuBuilderImpl.java\nindex 3decdeb132..76ce1e4f68 100644\n--- a/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/FileMenuBuilderImpl.java\n+++ b/kie-wb-common-widgets/kie-wb-common-ui/src/main/java/org/kie/workbench/common/widgets/client/menu/FileMenuBuilderImpl.java\n\n@@ -45,7 +47,9 @@ public class FileMenuBuilderImpl implements FileMenuBuilder {\n     @Inject\n     private Caller<CopyService> copyService;\n \n-    private CurrentBranchImpl currentBranch;\n+    @Inject\n+    @Customizable\n+    private CurrentBranch currentBranch;\n \n     @Override\n     public Menus build() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyOTM2Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r402529367", "bodyText": "As I've commented on the appformer PR, I think you don't need to make changes on this class.", "author": "caponetto", "createdAt": "2020-04-02T18:36:45Z", "path": "kie-wb-common-widgets/kie-wb-metadata-widget/src/main/java/org/kie/workbench/common/widgets/metadata/client/KieEditor.java", "diffHunk": "@@ -118,6 +119,8 @@ public boolean mayClose(final Object object) {\n     protected DefaultEditorDock docks;\n     @Inject\n     protected PerspectiveManager perspectiveManager;\n+    @Inject\n+    private CurrentBranchImpl currentBranch;", "originalCommit": "b2c3db6de08f5153b20c60cf8c320318d496b000", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA4MjI3Mw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3238#discussion_r404082273", "bodyText": "I am removing this as per the changes in appformer PR.", "author": "akumar074", "createdAt": "2020-04-06T13:17:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyOTM2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "36673d50dd996a81022a49ea0a43961991d1f327", "chunk": "diff --git a/kie-wb-common-widgets/kie-wb-metadata-widget/src/main/java/org/kie/workbench/common/widgets/metadata/client/KieEditor.java b/kie-wb-common-widgets/kie-wb-metadata-widget/src/main/java/org/kie/workbench/common/widgets/metadata/client/KieEditor.java\nindex 12dd36e81c..5d83bfbe75 100644\n--- a/kie-wb-common-widgets/kie-wb-metadata-widget/src/main/java/org/kie/workbench/common/widgets/metadata/client/KieEditor.java\n+++ b/kie-wb-common-widgets/kie-wb-metadata-widget/src/main/java/org/kie/workbench/common/widgets/metadata/client/KieEditor.java\n\n@@ -119,8 +118,6 @@ public abstract class KieEditor<T>\n     protected DefaultEditorDock docks;\n     @Inject\n     protected PerspectiveManager perspectiveManager;\n-    @Inject\n-    private CurrentBranchImpl currentBranch;\n     private ViewDRLSourceWidget sourceWidget;\n     private MayCloseHandler mayCloseHandler = DEFAULT_MAY_CLOSE_HANDLER;\n \n"}}, {"oid": "36673d50dd996a81022a49ea0a43961991d1f327", "url": "https://github.com/kiegroup/kie-wb-common/commit/36673d50dd996a81022a49ea0a43961991d1f327", "message": "AF-2432 : Restoring an old asset version doesn't work outside master branch\n\n * Added CurrentBranch class to track currently modifying branch in the editor", "committedDate": "2020-04-06T12:36:55Z", "type": "commit"}]}