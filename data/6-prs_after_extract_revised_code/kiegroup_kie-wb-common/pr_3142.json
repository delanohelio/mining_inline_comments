{"pr_number": 3142, "pr_title": "DROOLS-5011 : Multiselect dropdown for enumerated values", "pr_createdAt": "2020-02-05T20:57:41Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3142", "timeline": [{"oid": "1aed501e20290c7e1701b93648241c138fdb2e06", "url": "https://github.com/kiegroup/kie-wb-common/commit/1aed501e20290c7e1701b93648241c138fdb2e06", "message": "[AF-2422] Fixed path issues on Windows OS.", "committedDate": "2020-02-06T20:24:06Z", "type": "forcePushed"}, {"oid": "dbfc39baf7d19fde73169116ea00a98876a321ee", "url": "https://github.com/kiegroup/kie-wb-common/commit/dbfc39baf7d19fde73169116ea00a98876a321ee", "message": "DROOLS-5011 : Multiselect dropdown for enumerated values", "committedDate": "2020-02-07T08:16:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwODYyMQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3142#discussion_r376308621", "bodyText": "Do I want to be reallllllllly picky here?\nIf we have an enumeration like: [1=\"one\", 2=\"two, deux\", 3=\"three\"] this will break.\nDon't you have a utility class somewhere to handle the correct splits?", "author": "manstis", "createdAt": "2020-02-07T10:04:06Z", "path": "kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/main/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBox.java", "diffHunk": "@@ -80,11 +81,22 @@ public void render(final Cell.Context context,\n                        final SafeHtmlRenderer<String> renderer) {\n         //Render value\n         if (value != null) {\n-            String label = getLabel(convertToString(value));\n+            final String label = makeLabel(convertToString(value));\n+\n             sb.append(renderer.render(label));\n         }\n     }\n \n+    private String makeLabel(final String convert) {\n+        if (listBox.isMultipleSelect()) {", "originalCommit": "dbfc39baf7d19fde73169116ea00a98876a321ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjM0OTQ5Nw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3142#discussion_r376349497", "bodyText": "Sure we can use it here. That bug report will come if we don't :)", "author": "Rikkola", "createdAt": "2020-02-07T11:42:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwODYyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "a8a96191acd22378cc36554ed4673cd40f402a96", "chunk": "diff --git a/kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/main/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBox.java b/kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/main/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBox.java\nindex 925fa63e8b..4768173a62 100644\n--- a/kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/main/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBox.java\n+++ b/kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/main/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBox.java\n\n@@ -89,7 +90,10 @@ public abstract class AbstractProxyPopupDropDownListBox<C> implements ProxyPopup\n \n     private String makeLabel(final String convert) {\n         if (listBox.isMultipleSelect()) {\n-            return Arrays.stream(convert.split(\",\"))\n+            String[] array = ListSplitter.splitPreserveQuotes(\"\\\"\",\n+                                                              true,\n+                                                              convert);\n+            return Arrays.stream(array)\n                     .map(s -> getLabel(s))\n                     .collect(Collectors.joining(\",\"));\n         } else {\n"}}, {"oid": "a8a96191acd22378cc36554ed4673cd40f402a96", "url": "https://github.com/kiegroup/kie-wb-common/commit/a8a96191acd22378cc36554ed4673cd40f402a96", "message": "DROOLS-5011 : Multiselect dropdown for enumerated values", "committedDate": "2020-02-07T16:57:33Z", "type": "commit"}, {"oid": "a8a96191acd22378cc36554ed4673cd40f402a96", "url": "https://github.com/kiegroup/kie-wb-common/commit/a8a96191acd22378cc36554ed4673cd40f402a96", "message": "DROOLS-5011 : Multiselect dropdown for enumerated values", "committedDate": "2020-02-07T16:57:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjU0NzE0NQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3142#discussion_r376547145", "bodyText": "ListSplitter is needed because of the \"\\\"1,2,3\\\"", "author": "Rikkola", "createdAt": "2020-02-07T18:45:19Z", "path": "kie-wb-common-widgets/kie-wb-decorated-grid-widget/src/test/java/org/kie/workbench/common/widgets/decoratedgrid/client/widget/cells/AbstractProxyPopupDropDownListBoxRenderTest.java", "diffHunk": "@@ -0,0 +1,154 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.workbench.common.widgets.decoratedgrid.client.widget.cells;\n+\n+import com.google.gwt.cell.client.Cell;\n+import com.google.gwt.safehtml.shared.SafeHtml;\n+import com.google.gwt.safehtml.shared.SafeHtmlBuilder;\n+import com.google.gwt.text.shared.SafeHtmlRenderer;\n+import com.google.gwtmockito.GwtMock;\n+import com.google.gwtmockito.GwtMockitoTestRunner;\n+import org.gwtbootstrap3.client.ui.ListBox;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.kie.soup.project.datamodel.oracle.DropDownData;\n+import org.kie.workbench.common.widgets.client.datamodel.AsyncPackageDataModelOracle;\n+import org.mockito.Mock;\n+\n+import static org.mockito.Matchers.anyString;\n+import static org.mockito.Mockito.doReturn;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.verify;\n+\n+@RunWith(GwtMockitoTestRunner.class)\n+public class AbstractProxyPopupDropDownListBoxRenderTest {\n+\n+    @GwtMock\n+    private ListBox listBox;\n+\n+    private AbstractProxyPopupDropDownListBox<String> listBoxDropDown;\n+\n+    @Mock\n+    private AbstractProxyPopupDropDownEditCell abstractProxyPopupDropDownEditCell;\n+\n+    @Before\n+    public void setUp() throws Exception {\n+        listBoxDropDown = new AbstractProxyPopupDropDownListBox<String>(abstractProxyPopupDropDownEditCell,\n+                                                                        \"in\") {\n+\n+            @Override\n+            public String convertToString(final String value) {\n+                return value;\n+            }\n+\n+            @Override\n+            public String convertFromString(final String value) {\n+                return value;\n+            }\n+        };\n+\n+        doReturn(mock(AsyncPackageDataModelOracle.class)).when(abstractProxyPopupDropDownEditCell).getDataModelOracle();\n+\n+        addListBoxItem(0, \"Fork\", \"1\");\n+        addListBoxItem(1, \"Spoon\", \"2\");\n+        addListBoxItem(2, \"Knife\", \"3\");\n+        addListBoxItem(3, \"Spork\", \"4\");\n+        addListBoxItem(4, \"Fork, Spoon and Knife\", \"\\\"1,2,3\\\"\");\n+        doReturn(5).when(listBox).getItemCount();\n+        listBoxDropDown.setDropDownData(DropDownData.create(new String[]{\"1=Fork\", \"2=Spoon\", \"3=Knife\", \"4=Spork\", \"\\\"1,2,3\\\"=Fork, Spoon and Knife\"}));", "originalCommit": "a8a96191acd22378cc36554ed4673cd40f402a96", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}