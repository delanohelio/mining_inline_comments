{"pr_number": 3284, "pr_title": "KOGITO-1687: DMN invalid data type names are not reported", "pr_createdAt": "2020-04-24T13:19:24Z", "pr_url": "https://github.com/kiegroup/kie-wb-common/pull/3284", "timeline": [{"oid": "1e72ed38fe87815f61373059858eaace0606e84c", "url": "https://github.com/kiegroup/kie-wb-common/commit/1e72ed38fe87815f61373059858eaace0606e84c", "message": "Adding draft of FEELSyntaxLightValidator", "committedDate": "2020-04-24T01:45:19Z", "type": "commit"}, {"oid": "83ef53fa76dd3b67eee91bea8bd33c0fdc233aca", "url": "https://github.com/kiegroup/kie-wb-common/commit/83ef53fa76dd3b67eee91bea8bd33c0fdc233aca", "message": "Considering other separators for keyword check", "committedDate": "2020-04-24T13:04:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM0OTI0OQ==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3284#discussion_r416349249", "bodyText": "There is one more keyword I am aware of - 'in'. Could we please add it to this list?", "author": "jomarko", "createdAt": "2020-04-28T06:02:00Z", "path": "kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/FEELSyntaxLightValidator.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.kie.workbench.common.dmn.webapp.kogito.common.client.services;\n+\n+import java.util.Arrays;\n+import java.util.function.Function;\n+import java.util.stream.Stream;\n+\n+import static java.util.stream.Stream.of;\n+\n+/**\n+ * <p>It provides a light validation for variable names, respect to the FEEL syntax</p>\n+ * <p>We already have a validation mechanism on back-end side, provided by <strong>FeelParser</strong></p>\n+ * <p>However, as for now, we cannot use back-end services in dmn client, so the aim of this class is to provide a more accurate as possible validation</p>\n+ * <p>Its purpose is to be temporary for the short/middle term</p>\n+ */\n+public class FEELSyntaxLightValidator {\n+\n+    private static final Character[] FORBIDDEN_CHARS = new Character[]{\n+            '!', '@', '#', '$', '$', '%', '&', '^', '(', ')', '\\\"', '\u00b0', '\u00a7', '\u2190', '\u2192', '\u2193', '\u00a2', '\u00b5',\n+            '{', '}', '[', ']', '|', '\\\\', '=', '<', '>', ';', ':', ',', '\u00b6', '\u00ab', '\u00bb', '\u201d', '\u201c'\n+    };\n+\n+    private static final Character[] ALLOWED_SEPARATORS = {'-', '.', '/', '\\'', '*', '+'};\n+\n+    private static final Character[] FORBIDDEN_CHARS_AS_INITIAL = Stream.concat(\n+            of(FORBIDDEN_CHARS),\n+            of(ALLOWED_SEPARATORS)\n+    ).toArray(Character[]::new);\n+\n+    private static final String[] RESERVED_KEYWORDS = new String[]{\n+            \"for\", \"return\", \"if\", \"then\", \"else\", \"some\", \"every\", \"satisfies\", \"instance\", \"of\",\n+            \"function\", \"external\", \"or\", \"and\", \"between\", \"not\", \"null\", \"true\", \"false\"", "originalCommit": "83ef53fa76dd3b67eee91bea8bd33c0fdc233aca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM1MDY0Mw==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3284#discussion_r416350643", "bodyText": "One more tricky point. Business central reports built type names as not allowed for custom types, however they are allowed as graph node names. Is that out of scope of this jira?", "author": "jomarko", "createdAt": "2020-04-28T06:05:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM0OTI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM4MTM1NA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3284#discussion_r416381354", "bodyText": "One more tricky point. Business central reports built type names as not allowed for custom types, however they are allowed as graph node names. Is that out of scope of this jira?\n\n\nIn this implementation, we are covering the case of DMNClientServicesProxyImpl:isValidVariableName that is producing the error message The Data Type name must start with a letter, ?, or _ and cannot start with a language keyword, such as and, true, or every\nIMO, for covering the case about data type, FEELSyntaxLightValidator could be extended with another method, that can be called by DMNClientServicesProxyImpl:? but I would manage it in a separate case.", "author": "vpellegrino", "createdAt": "2020-04-28T07:11:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM0OTI0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM5MDIxOA==", "url": "https://github.com/kiegroup/kie-wb-common/pull/3284#discussion_r416390218", "bodyText": "Ok, please ask on weekly meeting (that is today) what should be our next steps in validation and report jiras afterwards.\nI am approving as you added 'in' keyword. Please have green build before merge or ensure fails are not related. thank you for your work @vpellegrino !", "author": "jomarko", "createdAt": "2020-04-28T07:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM0OTI0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "13d3fbad1ed30533e0603ff34ad0e249aa1c1bdd", "chunk": "diff --git a/kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/FEELSyntaxLightValidator.java b/kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/FEELSyntaxLightValidator.java\nindex ff2f5953f6..b5596d120e 100644\n--- a/kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/FEELSyntaxLightValidator.java\n+++ b/kie-wb-common-dmn/kie-wb-common-dmn-webapp-kogito-common/src/main/java/org/kie/workbench/common/dmn/webapp/kogito/common/client/services/FEELSyntaxLightValidator.java\n\n@@ -44,7 +44,7 @@ public class FEELSyntaxLightValidator {\n \n     private static final String[] RESERVED_KEYWORDS = new String[]{\n             \"for\", \"return\", \"if\", \"then\", \"else\", \"some\", \"every\", \"satisfies\", \"instance\", \"of\",\n-            \"function\", \"external\", \"or\", \"and\", \"between\", \"not\", \"null\", \"true\", \"false\"\n+            \"in\", \"function\", \"external\", \"or\", \"and\", \"between\", \"not\", \"null\", \"true\", \"false\"\n     };\n \n     private static final Function<Character, String> CHAR_TO_STRING_MAPPER = c -> Character.toString(c);\n"}}, {"oid": "13d3fbad1ed30533e0603ff34ad0e249aa1c1bdd", "url": "https://github.com/kiegroup/kie-wb-common/commit/13d3fbad1ed30533e0603ff34ad0e249aa1c1bdd", "message": "Adding \"in\" as reserved keyword", "committedDate": "2020-04-28T07:13:57Z", "type": "commit"}]}