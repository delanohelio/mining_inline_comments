{"pr_number": 1461, "pr_title": "Fix for corrupted CO tag issue", "pr_createdAt": "2020-02-03T19:33:07Z", "pr_url": "https://github.com/broadinstitute/picard/pull/1461", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2ODM4Mw==", "url": "https://github.com/broadinstitute/picard/pull/1461#discussion_r408868383", "bodyText": "The fix looks good to me. It's a shame the API isn't setAttribute(SAMTag, Object).\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        unaligned.setAttribute( SAMTag.CO.name(), optionalComment.map(s -> s + \" | \").orElse(\"\")  + \"Cross-species contamination\");\n          \n          \n            \n                        unaligned.setAttribute(SAMTag.CO.name(), optionalComment.map(s -> s + \" | \").orElse(\"\")  + \"Cross-species contamination\");", "author": "pshapiro4broad", "createdAt": "2020-04-15T14:05:05Z", "path": "src/main/java/picard/sam/AbstractAlignmentMerger.java", "diffHunk": "@@ -694,8 +694,7 @@ private void transferAlignmentInfoToFragment(final SAMRecord unaligned, final SA\n \n             // if there already is a comment, add second comment with a | separator:\n             Optional<String> optionalComment = Optional.ofNullable(unaligned.getStringAttribute(SAMTag.CO.name()));\n-            unaligned.setAttribute(optionalComment.map(s -> s + \" | \").orElse(\"\") +\n-                    SAMTag.CO.name(), \"Cross-species contamination\");\n+            unaligned.setAttribute( SAMTag.CO.name(), optionalComment.map(s -> s + \" | \").orElse(\"\")  + \"Cross-species contamination\");", "originalCommit": "25b72dba46034b578b98c188b05fbc1f2e4b32e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDgzOTAzMA==", "url": "https://github.com/broadinstitute/picard/pull/1461#discussion_r424839030", "bodyText": "There's a pr open to do what you suggested.", "author": "lbergelson", "createdAt": "2020-05-14T02:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2ODM4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "affbf46749fbe458c782ea9201e2fe72bea1a2e2", "chunk": "diff --git a/src/main/java/picard/sam/AbstractAlignmentMerger.java b/src/main/java/picard/sam/AbstractAlignmentMerger.java\nindex e5e12dda7..3abd4e13d 100644\n--- a/src/main/java/picard/sam/AbstractAlignmentMerger.java\n+++ b/src/main/java/picard/sam/AbstractAlignmentMerger.java\n\n@@ -694,7 +708,7 @@ public abstract class AbstractAlignmentMerger {\n \n             // if there already is a comment, add second comment with a | separator:\n             Optional<String> optionalComment = Optional.ofNullable(unaligned.getStringAttribute(SAMTag.CO.name()));\n-            unaligned.setAttribute( SAMTag.CO.name(), optionalComment.map(s -> s + \" | \").orElse(\"\")  + \"Cross-species contamination\");\n+            unaligned.setAttribute(SAMTag.CO.name(), optionalComment.map(s -> s + \" | \").orElse(\"\")  + \"Cross-species contamination\");\n         }\n     }\n \n"}}, {"oid": "0553344ca5116e7da6ee93501912ebf448e4f447", "url": "https://github.com/broadinstitute/picard/commit/0553344ca5116e7da6ee93501912ebf448e4f447", "message": "Fix for duplicate CO tag issue\n\n* Someone on the forum reported an issue with a bam tag that was a long string instead of 2 characters.  This is a fix, but not a test because i'm not sure how to build a bam that triggers isContaminant.", "committedDate": "2020-05-13T21:27:24Z", "type": "commit"}, {"oid": "affbf46749fbe458c782ea9201e2fe72bea1a2e2", "url": "https://github.com/broadinstitute/picard/commit/affbf46749fbe458c782ea9201e2fe72bea1a2e2", "message": "Update src/main/java/picard/sam/AbstractAlignmentMerger.java\n\nCo-authored-by: Phil Shapiro <pshapiro@broadinstitute.org>", "committedDate": "2020-05-13T21:27:24Z", "type": "commit"}, {"oid": "affbf46749fbe458c782ea9201e2fe72bea1a2e2", "url": "https://github.com/broadinstitute/picard/commit/affbf46749fbe458c782ea9201e2fe72bea1a2e2", "message": "Update src/main/java/picard/sam/AbstractAlignmentMerger.java\n\nCo-authored-by: Phil Shapiro <pshapiro@broadinstitute.org>", "committedDate": "2020-05-13T21:27:24Z", "type": "forcePushed"}]}