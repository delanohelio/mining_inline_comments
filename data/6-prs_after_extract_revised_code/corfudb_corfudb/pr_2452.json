{"pr_number": 2452, "pr_title": "Thread Clean Up", "pr_createdAt": "2020-02-28T21:04:11Z", "pr_url": "https://github.com/CorfuDB/CorfuDB/pull/2452", "timeline": [{"oid": "64f84dd10b9b3277c9bad3b3eeee8e0c613d266c", "url": "https://github.com/CorfuDB/CorfuDB/commit/64f84dd10b9b3277c9bad3b3eeee8e0c613d266c", "message": "Netty EventLoopGroup Memory Leak\n\nShutdown netty thread pool after its no longed needed.", "committedDate": "2020-02-28T21:49:04Z", "type": "commit"}, {"oid": "64f84dd10b9b3277c9bad3b3eeee8e0c613d266c", "url": "https://github.com/CorfuDB/CorfuDB/commit/64f84dd10b9b3277c9bad3b3eeee8e0c613d266c", "message": "Netty EventLoopGroup Memory Leak\n\nShutdown netty thread pool after its no longed needed.", "committedDate": "2020-02-28T21:49:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDUxNg==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2452#discussion_r385984516", "bodyText": "Can we remove the manageEventLoop flag, and set the eventLoopGroup field in this contructor only? Then in close() we can simply check if eventLoopGroup is null and close it it not null.", "author": "WenbinZhu", "createdAt": "2020-02-29T00:59:13Z", "path": "runtime/src/main/java/org/corfudb/runtime/clients/NettyClientRouter.java", "diffHunk": "@@ -672,11 +680,11 @@ public NettyClientRouter(String host, Integer port, Boolean tls,\n     public NettyClientRouter(@Nonnull NodeLocator node,\n         @Nonnull CorfuRuntimeParameters parameters) {\n         this(node, parameters.getSocketType()\n-            .getGenerator().generate(Runtime.getRuntime().availableProcessors() * 2,\n+            .getGenerator().generate(parameters.getNettyEventLoopThreads(),\n                 new ThreadFactoryBuilder()\n                     .setDaemon(true)\n                     .setNameFormat(parameters.getNettyEventLoopThreadFormat())\n-                    .build()), parameters);\n+                    .build()), parameters, true);\n     }", "originalCommit": "64f84dd10b9b3277c9bad3b3eeee8e0c613d266c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5MjcyOA==", "url": "https://github.com/CorfuDB/CorfuDB/pull/2452#discussion_r385992728", "bodyText": "Discussed offline. This change is less invasive.", "author": "Maithem", "createdAt": "2020-02-29T02:22:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk4NDUxNg=="}], "type": "inlineReview", "revised_code": null}]}