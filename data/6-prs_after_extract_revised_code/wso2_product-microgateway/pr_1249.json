{"pr_number": 1249, "pr_title": "Fix #988 - Support mutual SSL in API level ", "pr_createdAt": "2020-05-25T08:46:25Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/1249", "timeline": [{"oid": "d0c2720d66e8ddc2982a3f56e9db937065d6029b", "url": "https://github.com/wso2/product-microgateway/commit/d0c2720d66e8ddc2982a3f56e9db937065d6029b", "message": "add functionality to validate Mutual SSL certificate as a Header", "committedDate": "2020-05-21T16:31:31Z", "type": "commit"}, {"oid": "ae2b097dd120b1e91013275d25ba114e5e8afb9b", "url": "https://github.com/wso2/product-microgateway/commit/ae2b097dd120b1e91013275d25ba114e5e8afb9b", "message": "validate the certificate alias per api", "committedDate": "2020-05-22T08:42:21Z", "type": "commit"}, {"oid": "8e59034f0a006d0dd43f9c699995e720f523a2f5", "url": "https://github.com/wso2/product-microgateway/commit/8e59034f0a006d0dd43f9c699995e720f523a2f5", "message": "insert cache for store mutual ssl certificate information\n\nreformat code", "committedDate": "2020-05-25T07:57:23Z", "type": "commit"}, {"oid": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "url": "https://github.com/wso2/product-microgateway/commit/db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "message": "resolve comments", "committedDate": "2020-05-27T10:47:07Z", "type": "commit"}, {"oid": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "url": "https://github.com/wso2/product-microgateway/commit/db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "message": "resolve comments", "committedDate": "2020-05-27T10:47:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTU5OQ==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r432271599", "bodyText": "License header?", "author": "praminda", "createdAt": "2020-05-29T06:00:40Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package org.wso2.micro.gateway.core.mutualssl;", "originalCommit": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69251634f63116c274a2c5445d865fdb9771dbf0", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\nindex 38ceffbef..047a7515a 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\n\n@@ -32,7 +32,7 @@ public class LoadKeyStore {\n     }\n \n     /**\n-     * Used to get the keystore path\n+     * Used to get the keystore path.\n      */\n     public static String getKeyStorePath(String fullPath) {\n         String homePathConst = \"\\\\$\\\\{mgw-runtime.home}\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTY2Ng==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r432271666", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Used to get the keystore path\n          \n          \n            \n                 * Used to get the keystore path.", "author": "praminda", "createdAt": "2020-05-29T06:00:50Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java", "diffHunk": "@@ -0,0 +1,42 @@\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.wso2.micro.gateway.core.Constants;\n+\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.security.NoSuchAlgorithmException;\n+import java.security.cert.CertificateException;\n+\n+/**\n+ * This class is for load the keystore.\n+ */\n+public class LoadKeyStore {\n+    public static KeyStore trustStore;\n+    public static FileInputStream localTrustStoreStream;\n+    private static final Logger log = LoggerFactory.getLogger(\"ballerina\");\n+\n+    public static void loadKeyStore(String trustStorePath, String trustStorePassword) {\n+        try {\n+            localTrustStoreStream = new FileInputStream(getKeyStorePath(trustStorePath));\n+            trustStore = KeyStore.getInstance(KeyStore.getDefaultType());\n+            trustStore.load(localTrustStoreStream, trustStorePassword.toCharArray());\n+\n+        } catch (NoSuchAlgorithmException | IOException | KeyStoreException | CertificateException e) {\n+            String msg = \"Error while loading the trustore\";\n+            log.error(msg, e);\n+        }\n+    }\n+\n+    /**\n+     * Used to get the keystore path", "originalCommit": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69251634f63116c274a2c5445d865fdb9771dbf0", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\nindex 38ceffbef..047a7515a 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/LoadKeyStore.java\n\n@@ -32,7 +32,7 @@ public class LoadKeyStore {\n     }\n \n     /**\n-     * Used to get the keystore path\n+     * Used to get the keystore path.\n      */\n     public static String getKeyStorePath(String fullPath) {\n         String homePathConst = \"\\\\$\\\\{mgw-runtime.home}\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTcxOA==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r432271718", "bodyText": "License header?", "author": "praminda", "createdAt": "2020-05-29T06:01:00Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.wso2.micro.gateway.core.mutualssl;", "originalCommit": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69251634f63116c274a2c5445d865fdb9771dbf0", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\nindex fafba99a7..7a38b200b 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\n\n@@ -17,7 +17,7 @@ import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;\n \n /**\n- * This class is responsible for get the alias from the certificate  in mutual SSL handshake\n+ * This class is responsible for get the alias from the certificate  in mutual SSL handshake,\n  * when the header send by the load balancer.\n  */\n public class MutualsslWithLoadBalancerHeader {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTgxNQ==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r432271815", "bodyText": "Incomplete javadoc", "author": "praminda", "createdAt": "2020-05-29T06:01:25Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import org.apache.commons.codec.binary.Base64;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.URLDecoder;\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.security.cert.CertificateFactory;\n+\n+import javax.security.cert.CertificateEncodingException;\n+import javax.security.cert.CertificateException;\n+import javax.security.cert.X509Certificate;\n+\n+import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n+import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;\n+\n+/**\n+ * This class is responsible for get the alias from the certificate  in mutual SSL handshake\n+ * when the header send by the load balancer.\n+ */\n+public class MutualsslWithLoadBalancerHeader {\n+\n+    public static String getAliasAFromHeaderCert(String base64EncodedCertificate) throws  KeyStoreException,\n+            java.security.cert.CertificateException, CertificateException {\n+        base64EncodedCertificate = URLDecoder.decode(base64EncodedCertificate).\n+                replaceAll(BEGIN_CERTIFICATE_STRING, \"\")\n+                .replaceAll(END_CERTIFICATE_STRING, \"\");\n+        byte[] bytes = Base64.decodeBase64(base64EncodedCertificate);\n+        InputStream inputStream = new ByteArrayInputStream(bytes);\n+        X509Certificate x509Certificate = X509Certificate.getInstance(inputStream);\n+        if (getAliasFromTrustStore(x509Certificate, LoadKeyStore.trustStore) != null) {\n+            return getAliasFromTrustStore(x509Certificate, LoadKeyStore.trustStore);\n+        } else {\n+            return \"\";\n+        }\n+    }\n+\n+    /**\n+     *  Used to get the certificate alias for a certificate exist in the trustore.\n+     *\n+     * @param certificate", "originalCommit": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69251634f63116c274a2c5445d865fdb9771dbf0", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\nindex fafba99a7..7a38b200b 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithLoadBalancerHeader.java\n\n@@ -17,7 +17,7 @@ import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;\n \n /**\n- * This class is responsible for get the alias from the certificate  in mutual SSL handshake\n+ * This class is responsible for get the alias from the certificate  in mutual SSL handshake,\n  * when the header send by the load balancer.\n  */\n public class MutualsslWithLoadBalancerHeader {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3MTg4OA==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r432271888", "bodyText": "License header?", "author": "praminda", "createdAt": "2020-05-29T06:01:33Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.wso2.micro.gateway.core.mutualssl;", "originalCommit": "db09070ea5379e7fdbca059c8c0360ae4a8f8d74", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "443391f76e25ffff200e45b148469b095bda878d", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java\nindex 398deee33..3b1f8fc9e 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java\n\n@@ -1,3 +1,19 @@\n+// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n package org.wso2.micro.gateway.core.mutualssl;\n \n import java.io.ByteArrayInputStream;\n"}}, {"oid": "69251634f63116c274a2c5445d865fdb9771dbf0", "url": "https://github.com/wso2/product-microgateway/commit/69251634f63116c274a2c5445d865fdb9771dbf0", "message": "change if condition", "committedDate": "2020-05-29T16:57:46Z", "type": "commit"}, {"oid": "443391f76e25ffff200e45b148469b095bda878d", "url": "https://github.com/wso2/product-microgateway/commit/443391f76e25ffff200e45b148469b095bda878d", "message": "add license file", "committedDate": "2020-06-01T03:35:04Z", "type": "commit"}, {"oid": "c98509790bfde4580cc093971f908f402b8e9020", "url": "https://github.com/wso2/product-microgateway/commit/c98509790bfde4580cc093971f908f402b8e9020", "message": "resolve comments from claim mapping\n# Conflicts:\n#\tcomponents/micro-gateway-core/src/main/ballerina/src/gateway/api_gateway_cache.bal", "committedDate": "2020-06-03T07:41:28Z", "type": "commit"}, {"oid": "3ab4771e0fa401eea8989320a8ee68bd88c2b5b9", "url": "https://github.com/wso2/product-microgateway/commit/3ab4771e0fa401eea8989320a8ee68bd88c2b5b9", "message": "uncomment test cases", "committedDate": "2020-06-03T09:56:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgzNzA1MA==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r436837050", "bodyText": "Do we need two classes. Can't we use the same MutualsslWithLoadBalancerHeader. It has the same method. We can have a common class name and use it", "author": "Rajith90", "createdAt": "2020-06-08T16:28:34Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java", "diffHunk": "@@ -0,0 +1,42 @@\n+// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import java.io.ByteArrayInputStream;\n+import java.security.KeyStoreException;\n+import java.security.cert.CertificateException;\n+import java.security.cert.CertificateFactory;\n+import java.security.cert.X509Certificate;\n+import java.util.Base64;\n+\n+/**\n+ * This class is for getting the certificate alias for a certificate to validate against per API.\n+ */\n+public class MutualsslWithoutLoadBalancerHeader {", "originalCommit": "3ab4771e0fa401eea8989320a8ee68bd88c2b5b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzIzMTI5Mg==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r437231292", "bodyText": "Added common class", "author": "tharmini", "createdAt": "2020-06-09T08:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjgzNzA1MA=="}], "type": "inlineReview", "revised_code": {"commit": "6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java\ndeleted file mode 100644\nindex 3b1f8fc9e..000000000\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/MutualsslWithoutLoadBalancerHeader.java\n+++ /dev/null\n\n@@ -1,42 +0,0 @@\n-// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n-//\n-// WSO2 Inc. licenses this file to you under the Apache License,\n-// Version 2.0 (the \"License\"); you may not use this file except\n-// in compliance with the License.\n-// You may obtain a copy of the License at\n-//\n-// http://www.apache.org/licenses/LICENSE-2.0\n-//\n-// Unless required by applicable law or agreed to in writing,\n-// software distributed under the License is distributed on an\n-// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n-// KIND, either express or implied.  See the License for the\n-// specific language governing permissions and limitations\n-// under the License.\n-\n-package org.wso2.micro.gateway.core.mutualssl;\n-\n-import java.io.ByteArrayInputStream;\n-import java.security.KeyStoreException;\n-import java.security.cert.CertificateException;\n-import java.security.cert.CertificateFactory;\n-import java.security.cert.X509Certificate;\n-import java.util.Base64;\n-\n-/**\n- * This class is for getting the certificate alias for a certificate to validate against per API.\n- */\n-public class MutualsslWithoutLoadBalancerHeader {\n-    public static String getAlias(String certB64) throws CertificateException, KeyStoreException {\n-        byte[] decoded = Base64.getDecoder().decode(certB64);\n-        X509Certificate cert = (X509Certificate) CertificateFactory.getInstance(\"X.509\")\n-                .generateCertificate(new ByteArrayInputStream(decoded));\n-        String certificateAlias = LoadKeyStore.trustStore.getCertificateAlias(cert);\n-        if (certificateAlias != null) {\n-            return certificateAlias;\n-        } else {\n-            return \"\";\n-        }\n-    }\n-\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI3MDA4Nw==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r437270087", "bodyText": "Lets not use static imports", "author": "Rajith90", "createdAt": "2020-06-09T09:26:08Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import org.apache.commons.codec.binary.Base64;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.URLDecoder;\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.security.cert.CertificateFactory;\n+\n+import javax.security.cert.CertificateEncodingException;\n+import javax.security.cert.CertificateException;\n+import javax.security.cert.X509Certificate;\n+\n+import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n+import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;", "originalCommit": "6f71c30df16196575b651a9b6460a12c8dd70160", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nsimilarity index 77%\nrename from components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\nrename to components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nindex ffeac721b..1c4a9d54b 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\n\n@@ -17,6 +17,7 @@\n package org.wso2.micro.gateway.core.mutualssl;\n \n import org.apache.commons.codec.binary.Base64;\n+import org.wso2.micro.gateway.core.Constants;\n \n import java.io.ByteArrayInputStream;\n import java.io.InputStream;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI3MTI2Mw==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r437271263", "bodyText": "lets rename the method to getAliasFromHeaderCert removing the A", "author": "Rajith90", "createdAt": "2020-06-09T09:27:54Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import org.apache.commons.codec.binary.Base64;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.URLDecoder;\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.security.cert.CertificateFactory;\n+\n+import javax.security.cert.CertificateEncodingException;\n+import javax.security.cert.CertificateException;\n+import javax.security.cert.X509Certificate;\n+\n+import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n+import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;\n+\n+/**\n+ * This class is responsible for get the alias from the certificate  in mutual SSL handshake,\n+ * when the header send by the load balancer.\n+ */\n+public class CheckMutualSSLCertificate {\n+\n+    public static String getAliasAFromHeaderCert(String base64EncodedCertificate) throws  KeyStoreException,", "originalCommit": "6f71c30df16196575b651a9b6460a12c8dd70160", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nsimilarity index 77%\nrename from components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\nrename to components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nindex ffeac721b..1c4a9d54b 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\n\n@@ -17,6 +17,7 @@\n package org.wso2.micro.gateway.core.mutualssl;\n \n import org.apache.commons.codec.binary.Base64;\n+import org.wso2.micro.gateway.core.Constants;\n \n import java.io.ByteArrayInputStream;\n import java.io.InputStream;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI3MjAwNA==", "url": "https://github.com/wso2/product-microgateway/pull/1249#discussion_r437272004", "bodyText": "Lets rename this class as CertificateUtils", "author": "Rajith90", "createdAt": "2020-06-09T09:29:05Z", "path": "components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.wso2.micro.gateway.core.mutualssl;\n+\n+import org.apache.commons.codec.binary.Base64;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.net.URLDecoder;\n+import java.security.KeyStore;\n+import java.security.KeyStoreException;\n+import java.security.cert.CertificateFactory;\n+\n+import javax.security.cert.CertificateEncodingException;\n+import javax.security.cert.CertificateException;\n+import javax.security.cert.X509Certificate;\n+\n+import static org.wso2.micro.gateway.core.Constants.BEGIN_CERTIFICATE_STRING;\n+import static org.wso2.micro.gateway.core.Constants.END_CERTIFICATE_STRING;\n+\n+/**\n+ * This class is responsible for get the alias from the certificate  in mutual SSL handshake,\n+ * when the header send by the load balancer.\n+ */\n+public class CheckMutualSSLCertificate {", "originalCommit": "6f71c30df16196575b651a9b6460a12c8dd70160", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "chunk": "diff --git a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nsimilarity index 77%\nrename from components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\nrename to components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\nindex ffeac721b..1c4a9d54b 100644\n--- a/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CheckMutualSSLCertificate.java\n+++ b/components/micro-gateway-core/src/main/java/org/wso2/micro/gateway/core/mutualssl/CertificateUtils.java\n\n@@ -17,6 +17,7 @@\n package org.wso2.micro.gateway.core.mutualssl;\n \n import org.apache.commons.codec.binary.Base64;\n+import org.wso2.micro.gateway.core.Constants;\n \n import java.io.ByteArrayInputStream;\n import java.io.InputStream;\n"}}, {"oid": "6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "url": "https://github.com/wso2/product-microgateway/commit/6b68f7a0b891c8837ca2c035869e5e12c9db5b7b", "message": "combine two classes into one and resolve comments.", "committedDate": "2020-06-09T09:54:55Z", "type": "forcePushed"}, {"oid": "876e92cb8766631990833a65af02ad811815ff24", "url": "https://github.com/wso2/product-microgateway/commit/876e92cb8766631990833a65af02ad811815ff24", "message": "combine two classes into one and resolve comments.", "committedDate": "2020-06-09T10:21:21Z", "type": "commit"}, {"oid": "876e92cb8766631990833a65af02ad811815ff24", "url": "https://github.com/wso2/product-microgateway/commit/876e92cb8766631990833a65af02ad811815ff24", "message": "combine two classes into one and resolve comments.", "committedDate": "2020-06-09T10:21:21Z", "type": "forcePushed"}]}