{"pr_number": 996, "pr_title": "Provide support for gRPC", "pr_createdAt": "2020-02-17T12:52:48Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/996", "timeline": [{"oid": "d4940f666a29bfd5a97aeb2e301e0e5236d5dca9", "url": "https://github.com/wso2/product-microgateway/commit/d4940f666a29bfd5a97aeb2e301e0e5236d5dca9", "message": "support grpc for microgateway", "committedDate": "2020-02-15T18:42:53Z", "type": "commit"}, {"oid": "89322e2c078cc9cbd3408c80e5818e6bde6baa43", "url": "https://github.com/wso2/product-microgateway/commit/89322e2c078cc9cbd3408c80e5818e6bde6baa43", "message": "download the protoc executable instead of packaging with the toolkit distribution", "committedDate": "2020-02-16T16:01:01Z", "type": "commit"}, {"oid": "27e6559cc26583687130682b0218a1425cc25001", "url": "https://github.com/wso2/product-microgateway/commit/27e6559cc26583687130682b0218a1425cc25001", "message": "change the wso2 options protobuf file", "committedDate": "2020-02-16T17:40:38Z", "type": "commit"}, {"oid": "8e103a84cbdef29260aef34c44198b8a16ceafae", "url": "https://github.com/wso2/product-microgateway/commit/8e103a84cbdef29260aef34c44198b8a16ceafae", "message": "add APIKey scheme, bug fix basicAuth for protobuf, save proto desc file inside target gen directory", "committedDate": "2020-02-17T05:25:30Z", "type": "commit"}, {"oid": "84b31e6ea2bb5eb684e9b9396d811d25e5be1a21", "url": "https://github.com/wso2/product-microgateway/commit/84b31e6ea2bb5eb684e9b9396d811d25e5be1a21", "message": "restructure wso2_options proto file", "committedDate": "2020-02-17T08:32:41Z", "type": "commit"}, {"oid": "29c6fd421940da1a992ce5ac154cc8138b7ee8a3", "url": "https://github.com/wso2/product-microgateway/commit/29c6fd421940da1a992ce5ac154cc8138b7ee8a3", "message": "change default http version to 2.0", "committedDate": "2020-02-17T11:09:20Z", "type": "commit"}, {"oid": "438519450df039ecf96ff015bb4f9a74cff4da0b", "url": "https://github.com/wso2/product-microgateway/commit/438519450df039ecf96ff015bb4f9a74cff4da0b", "message": "Add debug logs", "committedDate": "2020-02-17T12:32:01Z", "type": "commit"}, {"oid": "8c573616fe00f791f4923d096a5aac090d89af87", "url": "https://github.com/wso2/product-microgateway/commit/8c573616fe00f791f4923d096a5aac090d89af87", "message": "relocate the auto generated codes", "committedDate": "2020-02-17T12:40:10Z", "type": "commit"}, {"oid": "3c8301cc771df7ff5164d121d83def8b87fca8fa", "url": "https://github.com/wso2/product-microgateway/commit/3c8301cc771df7ff5164d121d83def8b87fca8fa", "message": "fix startup error message from the tools Main", "committedDate": "2020-02-17T12:52:08Z", "type": "commit"}, {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411", "url": "https://github.com/wso2/product-microgateway/commit/1d1852890f703b22e797e3c6cbf5c2235d3b3411", "message": "resolve merge conflicts", "committedDate": "2020-02-17T14:27:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjQzMg==", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102432", "bodyText": "Add null check for subDirectories", "author": "AmaliMatharaarachchi", "createdAt": "2020-08-22T15:40:03Z", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();\n+        File[] subDirectories = file.listFiles(dirFilter);\n+        for (File dir : subDirectories) {", "originalCommit": "1d1852890f703b22e797e3c6cbf5c2235d3b3411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE3MDkyMw==", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475170923", "bodyText": "This is what the java doc says\nAn array of abstract pathnames denoting the files and\n     *          directories in the directory denoted by this abstract pathname.\n     *          The array will be empty if the directory is empty.  Returns\n     *          {@code null} if this abstract pathname does not denote a\n     *          directory, or if an I/O error occurs.\n\nHence the /grpc_definitions directory is gonna be there all the time, there is no chance of getting subdirectories null.\nWDYT?", "author": "VirajSalaka", "createdAt": "2020-08-23T05:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjQzMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjU5OA==", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102598", "bodyText": "Can use method reference.\nFileFilter dirFilter = File::isDirectory;", "author": "AmaliMatharaarachchi", "createdAt": "2020-08-22T15:42:08Z", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();", "originalCommit": "1d1852890f703b22e797e3c6cbf5c2235d3b3411", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMzUxOA==", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475103518", "bodyText": "Shall we revisit todo items in this PR?", "author": "AmaliMatharaarachchi", "createdAt": "2020-08-22T15:52:45Z", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/utils/CmdUtils.java", "diffHunk": "@@ -1127,6 +1150,29 @@ public static String getProjectSwaggerFilePath(String projectName, String apiId)\n                 CliConstants.API_SWAGGER;\n     }\n \n+    /**\n+     * get the path of the protoc executable.\n+     *\n+     * @return the absolute path of the protoc executable\n+     */\n+    public static String getProtocDirPath() {\n+        return getResourceFolderLocation() + File.separator + CliConstants.RESOURCES_GRPC_DIR;\n+    }\n+\n+    //todo: change the file location", "originalCommit": "1d1852890f703b22e797e3c6cbf5c2235d3b3411", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzOTQ5Mg==", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r489939492", "bodyText": "already fixed via a later added PR.", "author": "VirajSalaka", "createdAt": "2020-09-17T03:44:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMzUxOA=="}], "type": "inlineReview", "revised_code": null}]}