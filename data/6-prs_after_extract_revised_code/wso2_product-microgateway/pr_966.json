{"pr_number": 966, "pr_title": "Create docker base image for microgateway runtime", "pr_createdAt": "2020-02-03T18:45:29Z", "pr_url": "https://github.com/wso2/product-microgateway/pull/966", "timeline": [{"oid": "e1f4a1687903533ecca7c7592af25f8b6c77bcf6", "url": "https://github.com/wso2/product-microgateway/commit/e1f4a1687903533ecca7c7592af25f8b6c77bcf6", "message": "Basic image is created", "committedDate": "2020-01-28T05:38:23Z", "type": "commit"}, {"oid": "8bd358ab80e3d384adf83efd8174179679e2249e", "url": "https://github.com/wso2/product-microgateway/commit/8bd358ab80e3d384adf83efd8174179679e2249e", "message": "apim 2.6 configs and JAVA_OPTS gc variables", "committedDate": "2020-01-29T09:43:42Z", "type": "commit"}, {"oid": "b47d94cf8b9c7e6f960f23a702fb10bcb1779eaa", "url": "https://github.com/wso2/product-microgateway/commit/b47d94cf8b9c7e6f960f23a702fb10bcb1779eaa", "message": "complete docker image and provide CMD from gateway executable", "committedDate": "2020-02-03T18:26:09Z", "type": "commit"}, {"oid": "2296833a8a90ea334fdcd778336a9f1e09572454", "url": "https://github.com/wso2/product-microgateway/commit/2296833a8a90ea334fdcd778336a9f1e09572454", "message": "change gateway executable such that the config file parameter can be overwritten", "committedDate": "2020-02-03T18:27:14Z", "type": "commit"}, {"oid": "086db46dc4825052197c82a17ebeed1ebe3cd31a", "url": "https://github.com/wso2/product-microgateway/commit/086db46dc4825052197c82a17ebeed1ebe3cd31a", "message": "remove unnecessary statements from dockerfile:", "committedDate": "2020-02-03T18:44:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MzQ1Ng==", "url": "https://github.com/wso2/product-microgateway/pull/966#discussion_r376873456", "bodyText": "Shall we move this docker related logic to separate method", "author": "praminda", "createdAt": "2020-02-10T05:26:50Z", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -220,8 +220,7 @@ private void init(String projectName, String configPath, String deploymentConfig\n                 copyFile.setIsBallerinaConf(\"true\");\n                 copyFile.setSource(CmdUtils.getResourceFolderLocation() + File.separator + CliConstants.GW_DIST_CONF\n                         + File.separator + CliConstants.MICRO_GW_CONF_FILE);\n-                copyFile.setTarget(File.separator + CliConstants.WSO2 + File.separator + CliConstants.MGW", "originalCommit": "086db46dc4825052197c82a17ebeed1ebe3cd31a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzIwNjIzOA==", "url": "https://github.com/wso2/product-microgateway/pull/966#discussion_r377206238", "bodyText": "fixed via fe1f68c", "author": "VirajSalaka", "createdAt": "2020-02-10T17:25:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njg3MzQ1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "fe1f68c2c9d1d39e961d2664256249498d69c5aa", "chunk": "diff --git a/components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java b/components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java\nindex 835d04c4f..e04797a24 100644\n--- a/components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java\n+++ b/components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java\n\n@@ -182,49 +178,7 @@ public class BuildCmd implements LauncherCmd {\n             }\n             String deploymentConfigPath = CmdUtils.getDeploymentConfigLocation(projectName);\n             ContainerConfig containerConfig = TOMLConfigParser.parse(deploymentConfigPath, ContainerConfig.class);\n-            if (isDocker) {\n-                PrintStream outStream = System.out;\n-\n-                if (StringUtils.isEmpty(dockerImage)) {\n-                    dockerImage = CmdUtils.promptForTextInput(outStream, \"Enter docker image name: [\"\n-                            + projectName + \":\" + CliConstants.DEFAULT_VERSION + \"]\").trim();\n-                }\n-\n-                if (StringUtils.isEmpty(dockerBaseImage)) {\n-                    dockerBaseImage = CmdUtils.promptForTextInput(outStream,\n-                            \"Enter docker baseImage [\" + CliConstants.DEFAULT_DOCKER_BASE_IMAGE + \"]: \").trim();\n-                }\n-\n-                if (StringUtils.isBlank(dockerImage)) {\n-                    dockerImage = projectName + \":\" + CliConstants.DEFAULT_VERSION;\n-                }\n-\n-                if (StringUtils.isBlank(dockerBaseImage)) {\n-                    dockerBaseImage = CliConstants.DEFAULT_DOCKER_BASE_IMAGE;\n-                }\n-\n-                String[] dockerNameAndTag = dockerImage.split(\":\");\n-                String dockerName = dockerNameAndTag[0];\n-                String dockerTag = dockerNameAndTag[1];\n-\n-                DockerConfig dockerConfig = containerConfig.getDocker().getDockerConfig();\n-                CopyFileConfig dockerCopyFiles = containerConfig.getDocker().getDockerCopyFiles();\n-                dockerConfig.setEnable(true);\n-                dockerConfig.setName(dockerName);\n-                dockerConfig.setTag(dockerTag);\n-                dockerConfig.setBaseImage(dockerBaseImage);\n-\n-                dockerCopyFiles.setEnable(true);\n-\n-                CopyFile copyFile = new CopyFile();\n-                copyFile.setIsBallerinaConf(\"true\");\n-                copyFile.setSource(CmdUtils.getResourceFolderLocation() + File.separator + CliConstants.GW_DIST_CONF\n-                        + File.separator + CliConstants.MICRO_GW_CONF_FILE);\n-                copyFile.setTarget(CliConstants.GW_DIST_CONF + File.separator\n-                        + CliConstants.MICRO_GW_CONF_FILE);\n-                dockerCopyFiles.setFiles(new ArrayList<>(Collections.singletonList(copyFile)));\n-            }\n-\n+            createDockerImageFromCLI(projectName, containerConfig);\n             CmdUtils.setContainerConfig(containerConfig);\n \n             CodeGenerationContext codeGenerationContext = new CodeGenerationContext();\n"}}, {"oid": "fe1f68c2c9d1d39e961d2664256249498d69c5aa", "url": "https://github.com/wso2/product-microgateway/commit/fe1f68c2c9d1d39e961d2664256249498d69c5aa", "message": "fix commented issues", "committedDate": "2020-02-10T17:22:00Z", "type": "commit"}]}