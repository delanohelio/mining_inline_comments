{"pr_number": 4598, "pr_title": "chore(atomix): fix flaky Swim test", "pr_createdAt": "2020-05-26T05:07:20Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4598", "timeline": [{"oid": "aacd9c49b721d817f39fb58094bd9dd1af174462", "url": "https://github.com/camunda-cloud/zeebe/commit/aacd9c49b721d817f39fb58094bd9dd1af174462", "message": "chore(pom): move awaitility dependency", "committedDate": "2020-05-26T05:52:39Z", "type": "forcePushed"}, {"oid": "def10cf16dd4df10cceca0b8fcd30a46457a6fe2", "url": "https://github.com/camunda-cloud/zeebe/commit/def10cf16dd4df10cceca0b8fcd30a46457a6fe2", "message": "chore(pom): move awaitility dependency", "committedDate": "2020-05-26T08:17:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r430446285", "bodyText": "Do you think we could get rid of all these Thread.sleep \ud83d\ude03 ? We're clearly waiting for something to happen here - can we use awaitility again for it, or is this something that's not observable?", "author": "npepinpe", "createdAt": "2020-05-26T14:15:53Z", "path": "atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java", "diffHunk": "@@ -164,7 +211,7 @@ public void testSwimProtocol() throws Exception {\n \n     // Verify that neither node is ever removed from the cluster since node 3 can still ping nodes 1\n     // and 2.\n-    Thread.sleep(5000);\n+    Thread.sleep(500);", "originalCommit": "def10cf16dd4df10cceca0b8fcd30a46457a6fe2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYyNzk1NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r430627955", "bodyText": "I would love to. But this is not possible since there is no really a thing we can verify. I was really close to just drop the sleeps. And also the last part which says \"is never removed\" \ud83d\ude05", "author": "Zelldon", "createdAt": "2020-05-26T18:41:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYyODUwOA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r430628508", "bodyText": "If you agree then I would just drop this part.", "author": "Zelldon", "createdAt": "2020-05-26T18:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDYyODc0Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r430628747", "bodyText": "// Verify that neither node is ever removed from the cluster since node 3 can still ping nodes 1\n    // and 2.\n    Thread.sleep(500);\n    checkMembers(member1, member1, member2, member3);\n    checkMembers(member2, member1, member2, member3);\n    checkMembers(member3, member1, member2, member3);", "author": "Zelldon", "createdAt": "2020-05-26T18:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTAyMDY2MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r431020661", "bodyText": "@npepinpe ping", "author": "Zelldon", "createdAt": "2020-05-27T10:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI1Mjg0OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r431252848", "bodyText": "Ah, so it just waits to make sure that nodes are not removed if nothing happens?", "author": "npepinpe", "createdAt": "2020-05-27T15:55:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI1MzU3Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4598#discussion_r431253577", "bodyText": "Yes", "author": "Zelldon", "createdAt": "2020-05-27T15:56:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NjI4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "19ae0068bfe92a151c0656e9f71ab7d2c701ca7d", "chunk": "diff --git a/atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java b/atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java\nindex 2d0944e5db..e43f9f4ec4 100644\n--- a/atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java\n+++ b/atomix/cluster/src/test/java/io/atomix/cluster/protocol/SwimProtocolTest.java\n\n@@ -209,13 +209,6 @@ public class SwimProtocolTest extends ConcurrentTestCase {\n     // Partition node 1 from node 2.\n     partition(member1, member2);\n \n-    // Verify that neither node is ever removed from the cluster since node 3 can still ping nodes 1\n-    // and 2.\n-    Thread.sleep(500);\n-    checkMembers(member1, member1, member2, member3);\n-    checkMembers(member2, member1, member2, member3);\n-    checkMembers(member3, member1, member2, member3);\n-\n     // Heal the partition.\n     heal(member1, member2);\n \n"}}, {"oid": "d1f8e8ba500a6026a55e1f851be260e07078b17a", "url": "https://github.com/camunda-cloud/zeebe/commit/d1f8e8ba500a6026a55e1f851be260e07078b17a", "message": "chore(atomix): fix flaky Swim test", "committedDate": "2020-05-28T08:15:19Z", "type": "commit"}, {"oid": "ba77423a2886b04c8722dde42d6c0a07164f9f17", "url": "https://github.com/camunda-cloud/zeebe/commit/ba77423a2886b04c8722dde42d6c0a07164f9f17", "message": "chore(pom): move awaitility dependency", "committedDate": "2020-05-28T08:18:08Z", "type": "commit"}, {"oid": "19ae0068bfe92a151c0656e9f71ab7d2c701ca7d", "url": "https://github.com/camunda-cloud/zeebe/commit/19ae0068bfe92a151c0656e9f71ab7d2c701ca7d", "message": "chore(atomix): remove thread sleep", "committedDate": "2020-05-28T08:18:18Z", "type": "commit"}, {"oid": "19ae0068bfe92a151c0656e9f71ab7d2c701ca7d", "url": "https://github.com/camunda-cloud/zeebe/commit/19ae0068bfe92a151c0656e9f71ab7d2c701ca7d", "message": "chore(atomix): remove thread sleep", "committedDate": "2020-05-28T08:18:18Z", "type": "forcePushed"}]}