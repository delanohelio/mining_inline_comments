{"pr_number": 5588, "pr_title": "Allow configuring raft threadcontext", "pr_createdAt": "2020-10-14T10:16:17Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5588", "timeline": [{"oid": "39896faf7f915efe9a9ef146dfafb6e601e94bd8", "url": "https://github.com/camunda-cloud/zeebe/commit/39896faf7f915efe9a9ef146dfafb6e601e94bd8", "message": "chore(aromix): enable raft to use provided thread factory\n- Useful in testing to control the execution", "committedDate": "2020-10-14T09:51:14Z", "type": "commit"}, {"oid": "d6dee098ea74c2c29b90c4afadbaab865c5513af", "url": "https://github.com/camunda-cloud/zeebe/commit/d6dee098ea74c2c29b90c4afadbaab865c5513af", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution", "committedDate": "2020-10-14T10:18:42Z", "type": "forcePushed"}, {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "url": "https://github.com/camunda-cloud/zeebe/commit/f1b2895a44b1769059bf28aeedd47682b9cc24c1", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution", "committedDate": "2020-10-14T11:59:03Z", "type": "commit"}, {"oid": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "url": "https://github.com/camunda-cloud/zeebe/commit/f1b2895a44b1769059bf28aeedd47682b9cc24c1", "message": "chore(atomix): inject Random instance used by raft for electiontimeout\n- Useful in testing to control the execution", "committedDate": "2020-10-14T11:59:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwMzUyMQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506103521", "bodyText": "Why we had this factory here before do you know?", "author": "Zelldon", "createdAt": "2020-10-16T07:00:58Z", "path": "atomix/cluster/src/main/java/io/atomix/raft/partition/RaftPartition.java", "diffHunk": "@@ -47,7 +46,6 @@\n   private final PartitionId partitionId;\n   private final RaftPartitionGroupConfig config;\n   private final File dataDirectory;\n-  private final ThreadContextFactory threadContextFactory;", "originalCommit": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjExMDcwNQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506110705", "bodyText": "It was not used in the current code. Not sure what was its use before our refactoring. It was probably something related to client connections.", "author": "deepthidevaki", "createdAt": "2020-10-16T07:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwMzUyMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI5Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506104297", "bodyText": "Why it was necessary to close the factory before? \ud83e\udd14", "author": "Zelldon", "createdAt": "2020-10-16T07:02:25Z", "path": "atomix/cluster/src/main/java/io/atomix/raft/impl/RaftContext.java", "diffHunk": "@@ -617,12 +609,6 @@ public void close() {\n \n     // close thread contexts\n     threadContext.close();\n-    loadContext.close();\n-\n-    // Only close the thread context factory if indicated.\n-    if (closeOnStop) {\n-      threadContextFactory.close();", "originalCommit": "f1b2895a44b1769059bf28aeedd47682b9cc24c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjExMjg4Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5588#discussion_r506112882", "bodyText": "Depends on who is the owner of the threadFactory. If it was provided from RaftPartitionGroup, then it will be closed there. If it was created by DefaultRaftServer, then it is closed here. Anyway, threadContextFactory was not used. So this would not change anything.", "author": "deepthidevaki", "createdAt": "2020-10-16T07:15:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwNDI5Nw=="}], "type": "inlineReview", "revised_code": null}]}