{"pr_number": 3775, "pr_title": "chore(upgrade-tests): add basic upgradability test", "pr_createdAt": "2020-02-03T13:24:08Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/3775", "timeline": [{"oid": "eb3a50ff8dcfaa9428ed514ee5ddea91e55a4482", "url": "https://github.com/camunda-cloud/zeebe/commit/eb3a50ff8dcfaa9428ed514ee5ddea91e55a4482", "message": "chore(upgrade-tests): add basic upgradability test", "committedDate": "2020-02-06T08:48:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMjQ5OA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375822498", "bodyText": "Good idea \ud83d\udc4d", "author": "npepinpe", "createdAt": "2020-02-06T13:07:40Z", "path": "upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java", "diffHunk": "@@ -0,0 +1,192 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.test;\n+\n+import io.zeebe.client.ZeebeClient;\n+import io.zeebe.client.api.response.ActivateJobsResponse;\n+import io.zeebe.containers.ZeebePort;\n+import io.zeebe.containers.broker.ZeebeBrokerContainer;\n+import io.zeebe.containers.gateway.ZeebeGatewayContainer;\n+import io.zeebe.model.bpmn.Bpmn;\n+import io.zeebe.model.bpmn.BpmnModelInstance;\n+import io.zeebe.test.util.TestUtil;\n+import java.util.concurrent.TimeUnit;\n+import org.junit.BeforeClass;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+import org.junit.rules.TestWatcher;\n+import org.junit.rules.Timeout;\n+import org.junit.runner.Description;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.slf4j.event.Level;\n+import org.testcontainers.containers.Network;\n+\n+public class UpgradeTest {\n+\n+  public static final Logger LOG = LoggerFactory.getLogger(UpgradeTest.class);\n+  private static final String CURRENT_VERSION = \"current-test\";\n+  private static final String PROCESS_ID = \"process\";\n+  private static final String TASK = \"task\";\n+\n+  private static final BpmnModelInstance WORKFLOW =\n+      Bpmn.createExecutableProcess(PROCESS_ID)\n+          .startEvent()\n+          .serviceTask(TASK, t -> t.zeebeTaskType(TASK))\n+          .endEvent()\n+          .done();\n+\n+  private static String lastVersion = \"0.22.1\";\n+  @Rule public Timeout timeout = new Timeout(60, TimeUnit.SECONDS);\n+  @Rule public TemporaryFolder temp = new TemporaryFolder();\n+\n+  private ZeebeBrokerContainer container;\n+  private ZeebeGatewayContainer gateway;\n+  private ZeebeClient client;\n+  private Network network;\n+\n+  @Rule(order = Integer.MIN_VALUE)\n+  public TestWatcher watchman =\n+      new TestWatcher() {\n+        @Override\n+        protected void succeeded(Description description) {\n+          close();\n+        }\n+\n+        @Override\n+        protected void failed(Throwable e, Description description) {\n+          if (container != null) {\n+            LOG.error(container.getLogs());", "originalCommit": "2331a3633cc577e37985163fada8805d22467161", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyNDE5NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/3775#discussion_r375824195", "bodyText": "Maybe we can prefix these? e.g.\n===============================================\nBroker logs\n===============================================\n...\n...\n...\n\n\n===============================================\nGateway logs\n===============================================\n...\n...", "author": "npepinpe", "createdAt": "2020-02-06T13:11:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTgyMjQ5OA=="}], "type": "inlineReview", "revised_code": {"commit": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "chunk": "diff --git a/upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java b/upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java\nindex 61ca84d37..a495a9e35 100644\n--- a/upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java\n+++ b/upgrade-tests/src/test/java/io/zeebe/test/UpgradeTest.java\n\n@@ -9,9 +9,9 @@ package io.zeebe.test;\n \n import io.zeebe.client.ZeebeClient;\n import io.zeebe.client.api.response.ActivateJobsResponse;\n+import io.zeebe.containers.ZeebeBrokerContainer;\n import io.zeebe.containers.ZeebePort;\n-import io.zeebe.containers.broker.ZeebeBrokerContainer;\n-import io.zeebe.containers.gateway.ZeebeGatewayContainer;\n+import io.zeebe.containers.ZeebeStandaloneGatewayContainer;\n import io.zeebe.model.bpmn.Bpmn;\n import io.zeebe.model.bpmn.BpmnModelInstance;\n import io.zeebe.test.util.TestUtil;\n"}}, {"oid": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "url": "https://github.com/camunda-cloud/zeebe/commit/5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "message": "chore(upgrade-tests): add upgradability tests\n\n* upgrade broker with embedded gateway\n* older gateway with newer broker", "committedDate": "2020-02-10T15:17:14Z", "type": "commit"}, {"oid": "5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "url": "https://github.com/camunda-cloud/zeebe/commit/5bbc2db5733fce2c5e020c4cd5b7aa375c0566da", "message": "chore(upgrade-tests): add upgradability tests\n\n* upgrade broker with embedded gateway\n* older gateway with newer broker", "committedDate": "2020-02-10T15:17:14Z", "type": "forcePushed"}]}