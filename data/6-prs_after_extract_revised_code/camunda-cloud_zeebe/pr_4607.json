{"pr_number": 4607, "pr_title": "chore(atomix): initialize event subscriptions after listener is added", "pr_createdAt": "2020-05-27T06:18:11Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4607", "timeline": [{"oid": "0c2110150de553e4315d0ca29b38352bbfe290cb", "url": "https://github.com/camunda-cloud/zeebe/commit/0c2110150de553e4315d0ca29b38352bbfe290cb", "message": "chore(atomix): initialize cluster event subscriptions after listener is added", "committedDate": "2020-05-27T06:12:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MDI5NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#discussion_r431570295", "bodyText": "might make sense to do that in the membershipService#addListener? Because this problem will also arise on other places probably furthermore the membership is in charge to do that I would say.", "author": "Zelldon", "createdAt": "2020-05-28T04:08:37Z", "path": "atomix/cluster/src/main/java/io/atomix/cluster/messaging/impl/DefaultClusterEventService.java", "diffHunk": "@@ -189,6 +190,10 @@ private String topicsAsString(final Set<String> topics) {\n           Executors.newSingleThreadScheduledExecutor(\n               namedThreads(\"atomix-cluster-event-executor-%d\", LOGGER));\n       membershipService.addListener(this);\n+      // Listener doesn't receive notification about the Members added before the listener is added.\n+      membershipService\n+          .getMembers()\n+          .forEach(m -> event(new ClusterMembershipEvent(Type.MEMBER_ADDED, m)));", "originalCommit": "0c2110150de553e4315d0ca29b38352bbfe290cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc1NTk5Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#discussion_r431755992", "bodyText": "That's right. It would prevent similar bugs in future. It is not the first time we encountered this I guess. That said, is it ok if I do it in another PR? We have to verify if it breaks existing listeners.", "author": "deepthidevaki", "createdAt": "2020-05-28T11:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MDI5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTc1Njc5NQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4607#discussion_r431756795", "bodyText": "Yes then please create a follow up issue \ud83d\ude42", "author": "Zelldon", "createdAt": "2020-05-28T11:08:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTU3MDI5NQ=="}], "type": "inlineReview", "revised_code": null}]}