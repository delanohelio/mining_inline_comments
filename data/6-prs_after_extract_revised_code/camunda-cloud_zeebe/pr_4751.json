{"pr_number": 4751, "pr_title": "fix(engine): catch error event on multi-instance activity", "pr_createdAt": "2020-06-16T13:16:13Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4751", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3MDEzMQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/4751#discussion_r441470131", "bodyText": "I understand that the getElementById now needs an elementType, but this should always be CALL_ACTIVITY for this method. I also think that the return type can be specified to ExecutableCallActivity, as other elements should not be provided by this method.", "author": "korthout", "createdAt": "2020-06-17T11:17:15Z", "path": "engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java", "diffHunk": "@@ -255,14 +254,17 @@ public void onElementTerminated(\n     containerProcessor.onChildTerminated(containerScope, containerContext, childContext);\n   }\n \n-  private ExecutableCallActivity getParentWorkflowScope(\n+  private ExecutableFlowElement getParentWorkflowScope(", "originalCommit": "57b08bfdac832599b2b3cc2663eaf053bfab1504", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7e2502a1d011654deb9e705e7bfc887b685fb08f", "chunk": "diff --git a/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java b/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\nindex daa8159bc..7b63ee32e 100644\n--- a/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\n+++ b/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\n\n@@ -254,17 +255,18 @@ public final class BpmnStateTransitionBehavior {\n     containerProcessor.onChildTerminated(containerScope, containerContext, childContext);\n   }\n \n-  private ExecutableFlowElement getParentWorkflowScope(\n+  private ExecutableCallActivity getParentWorkflowScope(\n       final BpmnElementContext callActivityContext, final BpmnElementContext childContext) {\n     final var workflowKey = callActivityContext.getWorkflowKey();\n     final var elementId = callActivityContext.getElementId();\n-    final var elementType = callActivityContext.getBpmnElementType();\n+\n     return stateBehavior\n         .getWorkflow(workflowKey)\n         .map(DeployedWorkflow::getWorkflow)\n         .map(\n             workflow ->\n-                workflow.getElementById(elementId, elementType, ExecutableFlowElement.class))\n+                workflow.getElementById(\n+                    elementId, BpmnElementType.CALL_ACTIVITY, ExecutableCallActivity.class))\n         .orElseThrow(\n             () ->\n                 new BpmnProcessingException(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3MDczNw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4751#discussion_r441470737", "bodyText": "So I would change this to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                final var elementType = callActivityContext.getBpmnElementType();\n          \n          \n            \n                final var elementType = BpmnElementType.CALL_ACTIVITY;", "author": "korthout", "createdAt": "2020-06-17T11:18:35Z", "path": "engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java", "diffHunk": "@@ -255,14 +254,17 @@ public void onElementTerminated(\n     containerProcessor.onChildTerminated(containerScope, containerContext, childContext);\n   }\n \n-  private ExecutableCallActivity getParentWorkflowScope(\n+  private ExecutableFlowElement getParentWorkflowScope(\n       final BpmnElementContext callActivityContext, final BpmnElementContext childContext) {\n     final var workflowKey = callActivityContext.getWorkflowKey();\n     final var elementId = callActivityContext.getElementId();\n+    final var elementType = callActivityContext.getBpmnElementType();", "originalCommit": "57b08bfdac832599b2b3cc2663eaf053bfab1504", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3NzgzMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4751#discussion_r441477830", "bodyText": "\ud83d\udc4d", "author": "saig0", "createdAt": "2020-06-17T11:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQ3MDczNw=="}], "type": "inlineReview", "revised_code": {"commit": "7e2502a1d011654deb9e705e7bfc887b685fb08f", "chunk": "diff --git a/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java b/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\nindex daa8159bc..7b63ee32e 100644\n--- a/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\n+++ b/engine/src/main/java/io/zeebe/engine/nwe/behavior/BpmnStateTransitionBehavior.java\n\n@@ -254,17 +255,18 @@ public final class BpmnStateTransitionBehavior {\n     containerProcessor.onChildTerminated(containerScope, containerContext, childContext);\n   }\n \n-  private ExecutableFlowElement getParentWorkflowScope(\n+  private ExecutableCallActivity getParentWorkflowScope(\n       final BpmnElementContext callActivityContext, final BpmnElementContext childContext) {\n     final var workflowKey = callActivityContext.getWorkflowKey();\n     final var elementId = callActivityContext.getElementId();\n-    final var elementType = callActivityContext.getBpmnElementType();\n+\n     return stateBehavior\n         .getWorkflow(workflowKey)\n         .map(DeployedWorkflow::getWorkflow)\n         .map(\n             workflow ->\n-                workflow.getElementById(elementId, elementType, ExecutableFlowElement.class))\n+                workflow.getElementById(\n+                    elementId, BpmnElementType.CALL_ACTIVITY, ExecutableCallActivity.class))\n         .orElseThrow(\n             () ->\n                 new BpmnProcessingException(\n"}}, {"oid": "7e2502a1d011654deb9e705e7bfc887b685fb08f", "url": "https://github.com/camunda-cloud/zeebe/commit/7e2502a1d011654deb9e705e7bfc887b685fb08f", "message": "chore(engine): apply review suggestion\n\nCo-authored-by: Nico Korthout <korthout@users.noreply.github.com>", "committedDate": "2020-06-17T11:36:42Z", "type": "forcePushed"}, {"oid": "143baa1255e142b0be496db5e7f387cb36d34de2", "url": "https://github.com/camunda-cloud/zeebe/commit/143baa1255e142b0be496db5e7f387cb36d34de2", "message": "fix(engine): catch error event on multi-instance activity\n\n* be aware of multi-instance activities when looking for an error catch event\n* add new helper method to resolve the element based on a given BPMN element type to handle multi-instance activities", "committedDate": "2020-06-18T13:42:27Z", "type": "commit"}, {"oid": "143baa1255e142b0be496db5e7f387cb36d34de2", "url": "https://github.com/camunda-cloud/zeebe/commit/143baa1255e142b0be496db5e7f387cb36d34de2", "message": "fix(engine): catch error event on multi-instance activity\n\n* be aware of multi-instance activities when looking for an error catch event\n* add new helper method to resolve the element based on a given BPMN element type to handle multi-instance activities", "committedDate": "2020-06-18T13:42:27Z", "type": "forcePushed"}]}