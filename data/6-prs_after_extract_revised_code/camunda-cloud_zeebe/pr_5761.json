{"pr_number": 5761, "pr_title": "Reprocessing detection feature flag", "pr_createdAt": "2020-11-04T11:56:37Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5761", "timeline": [{"oid": "3c3d92aa1cdc6b5ef3dddb4e1ef0ca534eb8f1ca", "url": "https://github.com/camunda-cloud/zeebe/commit/3c3d92aa1cdc6b5ef3dddb4e1ef0ca534eb8f1ca", "message": "chore(broker): introduce new experimental flag to turn of reprocessing detection", "committedDate": "2020-11-04T15:02:27Z", "type": "commit"}, {"oid": "f9a4ea0d93468b998864755af15008f9212af2e7", "url": "https://github.com/camunda-cloud/zeebe/commit/f9a4ea0d93468b998864755af15008f9212af2e7", "message": "chore(broker): add test for feature flag", "committedDate": "2020-11-04T15:02:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQ2NjYxMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5761#discussion_r517466610", "bodyText": "Can we add a timeout? Otherwise we could end up with a test that never finishes", "author": "npepinpe", "createdAt": "2020-11-04T16:22:04Z", "path": "engine/src/test/java/io/zeebe/engine/util/EngineRule.java", "diffHunk": "@@ -346,6 +367,19 @@ private void onNewEventCommitted() {\n     }\n   }\n \n+  private final class ReprocessingCompletedListener implements StreamProcessorLifecycleAware {\n+    private final ActorFuture<Void> reprocessingComplete = new CompletableActorFuture<>();\n+\n+    @Override\n+    public void onRecovered(final ReadonlyProcessingContext context) {\n+      reprocessingComplete.complete(null);\n+    }\n+\n+    public void awaitReprocessingComplete() {", "originalCommit": "f9a4ea0d93468b998864755af15008f9212af2e7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d04c729b04d2bd65fe14d9eecb3701224c1d487d", "chunk": "diff --git a/engine/src/test/java/io/zeebe/engine/util/EngineRule.java b/engine/src/test/java/io/zeebe/engine/util/EngineRule.java\nindex 08d66347b8..f0b0542528 100644\n--- a/engine/src/test/java/io/zeebe/engine/util/EngineRule.java\n+++ b/engine/src/test/java/io/zeebe/engine/util/EngineRule.java\n\n@@ -376,7 +378,7 @@ public final class EngineRule extends ExternalResource {\n     }\n \n     public void awaitReprocessingComplete() {\n-      reprocessingComplete.join();\n+      reprocessingComplete.join(REPROCESSING_TIMEOUT_SEC, TimeUnit.SECONDS);\n     }\n   }\n \n"}}, {"oid": "d04c729b04d2bd65fe14d9eecb3701224c1d487d", "url": "https://github.com/camunda-cloud/zeebe/commit/d04c729b04d2bd65fe14d9eecb3701224c1d487d", "message": "test(engine): turn off inconsistency detection test", "committedDate": "2020-11-05T16:02:02Z", "type": "commit"}, {"oid": "ffe9b9c28cb27a7113a9876c88a83fdb941d2e86", "url": "https://github.com/camunda-cloud/zeebe/commit/ffe9b9c28cb27a7113a9876c88a83fdb941d2e86", "message": "chore(broker): add test for feature flag", "committedDate": "2020-11-05T16:02:02Z", "type": "commit"}, {"oid": "ffe9b9c28cb27a7113a9876c88a83fdb941d2e86", "url": "https://github.com/camunda-cloud/zeebe/commit/ffe9b9c28cb27a7113a9876c88a83fdb941d2e86", "message": "chore(broker): add test for feature flag", "committedDate": "2020-11-05T16:02:02Z", "type": "forcePushed"}]}