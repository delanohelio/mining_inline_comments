{"pr_number": 4673, "pr_title": "Include extra tags for failure metrics", "pr_createdAt": "2020-03-25T18:21:21Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4673", "timeline": [{"oid": "84b70a4edf3d0b1df6b0b49e1597ccf761800f50", "url": "https://github.com/palantir/atlasdb/commit/84b70a4edf3d0b1df6b0b49e1597ccf761800f50", "message": "include extra tags for failure metrics", "committedDate": "2020-03-25T18:19:18Z", "type": "commit"}, {"oid": "17fb6567af36c1f6839cc8693e76cdd266516f8d", "url": "https://github.com/palantir/atlasdb/commit/17fb6567af36c1f6839cc8693e76cdd266516f8d", "message": "Add generated changelog entries", "committedDate": "2020-03-24T14:49:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEzNzkwNw==", "url": "https://github.com/palantir/atlasdb/pull/4673#discussion_r398137907", "bodyText": "nit: orElseGet(() -> ... (as CircleCI kindly pointed out).", "author": "Jolyon-S", "createdAt": "2020-03-25T20:10:43Z", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java", "diffHunk": "@@ -169,9 +170,16 @@ public void onFailure(@Nullable InvocationContext context, @Nonnull Throwable ca\n         }\n \n         String failuresMetricName = InstrumentationUtils.getFailuresMetricName(context, serviceName);\n-        taggedMetricRegistry.meter(MetricName.builder().safeName(failuresMetricName).build()).mark();\n-        taggedMetricRegistry.meter(MetricName.builder().safeName(\n-                MetricRegistry.name(failuresMetricName, cause.getClass().getName())).build())\n+        Map<String, String> tags = tagFunction.map(f -> f.apply(context)).orElse(ImmutableMap.of());", "originalCommit": "17fb6567af36c1f6839cc8693e76cdd266516f8d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "18072d3b8870deec50b7dc2f0400a9f28f9ae611", "chunk": "diff --git a/atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java b/atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java\nindex 78b33aac90..d6a9c85bee 100644\n--- a/atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java\n+++ b/atlasdb-client/src/main/java/com/palantir/atlasdb/util/TaggedMetricsInvocationEventHandler.java\n\n@@ -170,7 +170,7 @@ public class TaggedMetricsInvocationEventHandler extends AbstractInvocationEvent\n         }\n \n         String failuresMetricName = InstrumentationUtils.getFailuresMetricName(context, serviceName);\n-        Map<String, String> tags = tagFunction.map(f -> f.apply(context)).orElse(ImmutableMap.of());\n+        Map<String, String> tags = tagFunction.map(f -> f.apply(context)).orElseGet(ImmutableMap::of);\n         taggedMetricRegistry.meter(MetricName.builder()\n                 .safeName(failuresMetricName)\n                 .safeTags(tags)\n"}}, {"oid": "18072d3b8870deec50b7dc2f0400a9f28f9ae611", "url": "https://github.com/palantir/atlasdb/commit/18072d3b8870deec50b7dc2f0400a9f28f9ae611", "message": "Error prone.", "committedDate": "2020-03-26T08:21:26Z", "type": "commit"}]}