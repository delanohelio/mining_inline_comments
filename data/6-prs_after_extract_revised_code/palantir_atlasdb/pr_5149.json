{"pr_number": 5149, "pr_title": "Make EC2 Location supplier memoize on failures", "pr_createdAt": "2020-12-08T11:14:20Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5149", "timeline": [{"oid": "9d8916dd0d5b3dd66df6f53536badefcffc6c93b", "url": "https://github.com/palantir/atlasdb/commit/9d8916dd0d5b3dd66df6f53536badefcffc6c93b", "message": "Make EC2 Location supplier memoize on failures", "committedDate": "2020-12-08T11:12:18Z", "type": "commit"}, {"oid": "e969a0cfb38ae3be13e33bda7d2a56100fd16235", "url": "https://github.com/palantir/atlasdb/commit/e969a0cfb38ae3be13e33bda7d2a56100fd16235", "message": "Add generated changelog entries", "committedDate": "2020-12-08T11:12:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI1OTAyOA==", "url": "https://github.com/palantir/atlasdb/pull/5149#discussion_r538259028", "bodyText": "Does this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertThat(hostLocationSupplier.get())\n          \n          \n            \n                            .hasValue(ec2LocationSupplier.get().get());\n          \n          \n            \n                    assertThat(hostLocationSupplier.get())\n          \n          \n            \n                            .isEqualTo(ec2LocationSupplier.get());", "author": "Jolyon-S", "createdAt": "2020-12-08T11:25:11Z", "path": "atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java", "diffHunk": "@@ -42,7 +43,8 @@ public void shouldReturnEc2Location() {\n         Supplier<Optional<HostLocation>> hostLocationSupplier =\n                 new HostLocationSupplier(ec2SnitchSupplier, ec2LocationSupplier, Optional.empty());\n \n-        assertThat(hostLocationSupplier.get()).hasValue(ec2LocationSupplier.get());\n+        assertThat(hostLocationSupplier.get())\n+                .hasValue(ec2LocationSupplier.get().get());", "originalCommit": "e969a0cfb38ae3be13e33bda7d2a56100fd16235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI2MjE1OQ==", "url": "https://github.com/palantir/atlasdb/pull/5149#discussion_r538262159", "bodyText": "Giving it a shot, but i don't think it will work. The two suppliers are not \"equal\", the values they produce are.", "author": "ashrayjain", "createdAt": "2020-12-08T11:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI1OTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI4ODExOQ==", "url": "https://github.com/palantir/atlasdb/pull/5149#discussion_r538288119", "bodyText": "I was wrong, we are comparing Optionals here, not Suppliers :). It works.", "author": "ashrayjain", "createdAt": "2020-12-08T12:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI1OTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMzMjk5Mg==", "url": "https://github.com/palantir/atlasdb/pull/5149#discussion_r538332992", "bodyText": "yep, that was my thought! Agreed that comparing suppliers would have been wrong though.", "author": "Jolyon-S", "createdAt": "2020-12-08T12:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODI1OTAyOA=="}], "type": "inlineReview", "revised_code": {"commit": "e8fc449278ccc2a915193c808fc723fd70aa207f", "chunk": "diff --git a/atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java b/atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java\nindex 22eea393a3..c72cf9cabc 100644\n--- a/atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java\n+++ b/atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java\n\n@@ -44,7 +44,7 @@ public class HostLocationSupplierTest {\n                 new HostLocationSupplier(ec2SnitchSupplier, ec2LocationSupplier, Optional.empty());\n \n         assertThat(hostLocationSupplier.get())\n-                .hasValue(ec2LocationSupplier.get().get());\n+                .isEqualTo(ec2LocationSupplier.get());\n     }\n \n     @Test\n"}}, {"oid": "e8fc449278ccc2a915193c808fc723fd70aa207f", "url": "https://github.com/palantir/atlasdb/commit/e8fc449278ccc2a915193c808fc723fd70aa207f", "message": "Update atlasdb-cassandra/src/test/java/com/palantir/atlasdb/keyvalue/cassandra/pool/HostLocationSupplierTest.java\n\nCo-authored-by: Jolyon <jshah@palantir.com>", "committedDate": "2020-12-08T11:29:38Z", "type": "commit"}, {"oid": "9c9b21c10687ced39eda116be581f123e1fed2ce", "url": "https://github.com/palantir/atlasdb/commit/9c9b21c10687ced39eda116be581f123e1fed2ce", "message": "Update HostLocationSupplierTest.java", "committedDate": "2020-12-08T11:37:48Z", "type": "commit"}]}