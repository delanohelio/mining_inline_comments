{"pr_number": 4517, "pr_title": "Improve TimeLock Client Recovery From Network Partitions", "pr_createdAt": "2020-01-16T17:58:48Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4517", "timeline": [{"oid": "acd3f7ecbeead29195ba8e5cb29c3b88037e8979", "url": "https://github.com/palantir/atlasdb/commit/acd3f7ecbeead29195ba8e5cb29c3b88037e8979", "message": "Avoid Nested Retries", "committedDate": "2020-01-16T17:53:25Z", "type": "commit"}, {"oid": "64484b6b5df578c48118dbe002d4bff98f04586e", "url": "https://github.com/palantir/atlasdb/commit/64484b6b5df578c48118dbe002d4bff98f04586e", "message": "Math", "committedDate": "2020-01-16T17:58:35Z", "type": "commit"}, {"oid": "5db3cbf99b61493c56f71b73aac3be573aa752ef", "url": "https://github.com/palantir/atlasdb/commit/5db3cbf99b61493c56f71b73aac3be573aa752ef", "message": "Add generated changelog entries", "committedDate": "2020-01-16T17:58:35Z", "type": "commit"}, {"oid": "19279b16b163c353f206c7c24a84208d697a312a", "url": "https://github.com/palantir/atlasdb/commit/19279b16b163c353f206c7c24a84208d697a312a", "message": "Add generated changelog entries", "committedDate": "2020-01-16T17:58:35Z", "type": "commit"}, {"oid": "91f68a71ad63a9f14c4d07e5295979f9fb15f45f", "url": "https://github.com/palantir/atlasdb/commit/91f68a71ad63a9f14c4d07e5295979f9fb15f45f", "message": "Add generated changelog entries", "committedDate": "2020-01-16T17:58:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU2NzA1Nw==", "url": "https://github.com/palantir/atlasdb/pull/4517#discussion_r367567057", "bodyText": "haha nice!", "author": "felixdesouza", "createdAt": "2020-01-16T18:00:35Z", "path": "leader-election-impl/src/main/java/com/palantir/leader/proxy/AwaitingLeadershipProxy.java", "diffHunk": "@@ -195,12 +197,17 @@ protected Object handleInvocation(Object proxy, Method method, Object[] args) th\n \n         Object delegate = delegateRef.get();\n         StillLeadingStatus leading = null;\n+\n+        // Wait for at most 6.3 seconds in case of a momentary network partition\n         for (int i = 0; i < MAX_NO_QUORUM_RETRIES; i++) {\n             // TODO(nziebart): check if leadershipTokenRef has been nulled out between iterations?\n             leading = leaderElectionService.isStillLeading(leadershipToken);\n             if (leading != StillLeadingStatus.NO_QUORUM) {\n                 break;\n             }\n+            if (i != MAX_NO_QUORUM_RETRIES - 1) {\n+                Uninterruptibles.sleepUninterruptibly(700, TimeUnit.MILLISECONDS);", "originalCommit": "64484b6b5df578c48118dbe002d4bff98f04586e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}