{"pr_number": 5099, "pr_title": "[TS] Allow configuration of lower batch size", "pr_createdAt": "2020-11-04T17:04:16Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5099", "timeline": [{"oid": "616e684fea3da814203bef8f4ff9c2c8c431aecd", "url": "https://github.com/palantir/atlasdb/commit/616e684fea3da814203bef8f4ff9c2c8c431aecd", "message": "Wip", "committedDate": "2020-11-04T14:31:55Z", "type": "commit"}, {"oid": "858aba1006383be074865d9d0b9c22dd69c77910", "url": "https://github.com/palantir/atlasdb/commit/858aba1006383be074865d9d0b9c22dd69c77910", "message": "Add config for cells threshold in sweep batch", "committedDate": "2020-11-04T15:16:34Z", "type": "commit"}, {"oid": "e19d79ac92df2a813ba49ccd777cf20e0a35e7f8", "url": "https://github.com/palantir/atlasdb/commit/e19d79ac92df2a813ba49ccd777cf20e0a35e7f8", "message": "Wire into SweepDelay", "committedDate": "2020-11-04T16:23:01Z", "type": "commit"}, {"oid": "3c3dd5797e33863eed007abc10caf78840313313", "url": "https://github.com/palantir/atlasdb/commit/3c3dd5797e33863eed007abc10caf78840313313", "message": "Add generated changelog entries", "committedDate": "2020-11-04T16:23:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIxMDYxNg==", "url": "https://github.com/palantir/atlasdb/pull/5099#discussion_r545210616", "bodyText": "minor nits: config objects typically have just values. I'd suggest we either pass Supplier<RBRC> and use some Suppliers.transform(...) higher up, or rename this ReadBatchingRuntimeContext or something like that", "author": "jeremyk-91", "createdAt": "2020-12-17T16:09:16Z", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java", "diffHunk": "@@ -50,4 +50,16 @@ SweepBatchWithPartitionInfo getNextBatchToSweep(ShardAndStrategy shardStrategy,\n         }\n         return accumulator.toSweepBatch();\n     }\n+\n+    @Immutable\n+    public interface ReadBatchingRuntimeConfig {", "originalCommit": "3c3dd5797e33863eed007abc10caf78840313313", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "abd0c1b8ee132e6f6f4b317013bd3a43ea414de7", "chunk": "diff --git a/atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java b/atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java\nindex 53de5483c0..05ccd74d16 100644\n--- a/atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java\n+++ b/atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/SweepQueueReader.java\n\n@@ -52,8 +54,8 @@ public class SweepQueueReader {\n     }\n \n     @Immutable\n-    public interface ReadBatchingRuntimeConfig {\n-        ReadBatchingRuntimeConfig DEFAULT = ImmutableReadBatchingRuntimeConfig.builder()\n+    public interface ReadBatchingRuntimeContext {\n+        ReadBatchingRuntimeContext DEFAULT = ReadBatchingRuntimeContext.builder()\n                 .maximumPartitions(() -> 1)\n                 .cellsThreshold(() -> SweepQueueUtils.SWEEP_BATCH_SIZE)\n                 .build();\n"}}, {"oid": "abd0c1b8ee132e6f6f4b317013bd3a43ea414de7", "url": "https://github.com/palantir/atlasdb/commit/abd0c1b8ee132e6f6f4b317013bd3a43ea414de7", "message": "Address CR and reduce default sweep batch size as discussed offline", "committedDate": "2021-01-08T17:43:58Z", "type": "commit"}, {"oid": "f4d90a8ee24245cdaaecaea1641fb158b0939d1d", "url": "https://github.com/palantir/atlasdb/commit/f4d90a8ee24245cdaaecaea1641fb158b0939d1d", "message": "Allow setting the config back to 100k", "committedDate": "2021-01-08T17:49:16Z", "type": "commit"}, {"oid": "c8e5efdb137b0887b1625948fd7d57b396b44c6c", "url": "https://github.com/palantir/atlasdb/commit/c8e5efdb137b0887b1625948fd7d57b396b44c6c", "message": "Add generated changelog entries", "committedDate": "2021-01-08T17:49:16Z", "type": "commit"}, {"oid": "049515ddf040e42e4d439459f4b13be4dc37b0de", "url": "https://github.com/palantir/atlasdb/commit/049515ddf040e42e4d439459f4b13be4dc37b0de", "message": "Merge branch 'develop' of github.com:palantir/atlasdb into ts/better", "committedDate": "2021-01-08T18:45:35Z", "type": "commit"}]}