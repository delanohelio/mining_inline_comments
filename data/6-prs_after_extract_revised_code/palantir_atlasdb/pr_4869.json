{"pr_number": 4869, "pr_title": "Namespace in TM", "pr_createdAt": "2020-06-26T13:46:26Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4869", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI2NjIyNg==", "url": "https://github.com/palantir/atlasdb/pull/4869#discussion_r446266226", "bodyText": "remove it for now", "author": "sudiksha27", "createdAt": "2020-06-26T15:50:47Z", "path": "lock-api/src/main/java/com/palantir/lock/client/metrics/TimeLockFeedbackBackgroundTask.java", "diffHunk": "@@ -88,6 +93,7 @@ public void scheduleWithFixedDelay() {\n                         .atlasVersion(versionSupplier.get())\n                         .nodeId(nodeId)\n                         .serviceName(serviceName)\n+                        .namespace(namespace)\n                         .build();", "originalCommit": "f9f72eec3bd9d01e1df30469c2d28ee0ddb14d58", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7ba6aa343b272c50ffe71cde11dbe9c2efb11fb4", "chunk": "diff --git a/lock-api/src/main/java/com/palantir/lock/client/metrics/TimeLockFeedbackBackgroundTask.java b/lock-api/src/main/java/com/palantir/lock/client/metrics/TimeLockFeedbackBackgroundTask.java\nindex 7ca0b4398f..14df216700 100644\n--- a/lock-api/src/main/java/com/palantir/lock/client/metrics/TimeLockFeedbackBackgroundTask.java\n+++ b/lock-api/src/main/java/com/palantir/lock/client/metrics/TimeLockFeedbackBackgroundTask.java\n\n@@ -93,7 +93,6 @@ public final class TimeLockFeedbackBackgroundTask implements AutoCloseable {\n                         .atlasVersion(versionSupplier.get())\n                         .nodeId(nodeId)\n                         .serviceName(serviceName)\n-                        .namespace(namespace)\n                         .build();\n                 timeLockClientFeedbackServices\n                         .current()\n"}}, {"oid": "c352495decc059485dd90a9bbde9767fc0fe93ae", "url": "https://github.com/palantir/atlasdb/commit/c352495decc059485dd90a9bbde9767fc0fe93ae", "message": "Namespace in TM", "committedDate": "2020-06-26T17:11:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEwNzg2Mg==", "url": "https://github.com/palantir/atlasdb/pull/4869#discussion_r447107862", "bodyText": "nit: could we make this Value.Derived, and/or have the service name take a Suppliers.memoize(() -> namespace())? I'm worried we're doing a bunch of unnecessary stream reads every time we look up the namespace.", "author": "jeremyk-91", "createdAt": "2020-06-29T16:42:16Z", "path": "atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java", "diffHunk": "@@ -614,13 +615,17 @@ private MetricsManager setUpMetricsAndGetMetricsManager() {\n     @VisibleForTesting\n     @Value.Derived\n     String serviceName() {\n-        return serviceIdentifierOverride().orElseGet(() -> Stream.of(config().namespace(),\n+        return serviceIdentifierOverride().orElseGet(this::namespace);\n+    }\n+\n+    private String namespace() {", "originalCommit": "656b4f8714e01af06ad518c7ba10b4cb6eb57d41", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e097b8f2f8a8fb38308717d695e6229a3f5e2c83", "chunk": "diff --git a/atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java b/atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java\nindex 79490ebd10..cbc54ababd 100644\n--- a/atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java\n+++ b/atlasdb-config/src/main/java/com/palantir/atlasdb/factory/TransactionManagers.java\n\n@@ -618,6 +618,8 @@ public abstract class TransactionManagers {\n         return serviceIdentifierOverride().orElseGet(this::namespace);\n     }\n \n+    // todo sudiksha should namespace be a property?\n+    @Value.Default\n     private String namespace() {\n         return Stream.of(config().namespace(),\n                 config().timelock().flatMap(TimeLockClientConfig::client),\n"}}, {"oid": "e097b8f2f8a8fb38308717d695e6229a3f5e2c83", "url": "https://github.com/palantir/atlasdb/commit/e097b8f2f8a8fb38308717d695e6229a3f5e2c83", "message": "Namespace in TM", "committedDate": "2020-07-01T20:53:20Z", "type": "commit"}, {"oid": "7ba6aa343b272c50ffe71cde11dbe9c2efb11fb4", "url": "https://github.com/palantir/atlasdb/commit/7ba6aa343b272c50ffe71cde11dbe9c2efb11fb4", "message": "Fix", "committedDate": "2020-07-01T20:53:20Z", "type": "commit"}, {"oid": "ddbca16fe6c312d6e1e92de38b410dcdfa1faa35", "url": "https://github.com/palantir/atlasdb/commit/ddbca16fe6c312d6e1e92de38b410dcdfa1faa35", "message": "Add generated changelog entries", "committedDate": "2020-07-01T20:53:20Z", "type": "commit"}, {"oid": "997af35b83c73c412495cb192097a004fb8b8f4b", "url": "https://github.com/palantir/atlasdb/commit/997af35b83c73c412495cb192097a004fb8b8f4b", "message": "Add generated changelog entries", "committedDate": "2020-07-01T20:53:20Z", "type": "commit"}, {"oid": "86ce861b48e1b7580fd4b2e0befbaf69f6fada34", "url": "https://github.com/palantir/atlasdb/commit/86ce861b48e1b7580fd4b2e0befbaf69f6fada34", "message": "Address comments", "committedDate": "2020-07-01T20:53:20Z", "type": "commit"}, {"oid": "86ce861b48e1b7580fd4b2e0befbaf69f6fada34", "url": "https://github.com/palantir/atlasdb/commit/86ce861b48e1b7580fd4b2e0befbaf69f6fada34", "message": "Address comments", "committedDate": "2020-07-01T20:53:20Z", "type": "forcePushed"}, {"oid": "55beac65cafe79e2d2eb2865ba32e72d39dab18b", "url": "https://github.com/palantir/atlasdb/commit/55beac65cafe79e2d2eb2865ba32e72d39dab18b", "message": "docs", "committedDate": "2020-07-07T14:41:30Z", "type": "commit"}]}