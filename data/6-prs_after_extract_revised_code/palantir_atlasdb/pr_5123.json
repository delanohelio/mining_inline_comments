{"pr_number": 5123, "pr_title": "[PDS-146501] Cast DEFAULT_TARGETED_SWEEP_SHARDS=1 down into the briny deeps", "pr_createdAt": "2020-11-19T20:03:12Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5123", "timeline": [{"oid": "f662b67563083117b60feb0cf97abab0b036bffa", "url": "https://github.com/palantir/atlasdb/commit/f662b67563083117b60feb0cf97abab0b036bffa", "message": "Cast down into the briny deeps", "committedDate": "2020-11-19T20:00:53Z", "type": "commit"}, {"oid": "85e228f7f4e7a39cfffa82aa0bb0b6c80e5da248", "url": "https://github.com/palantir/atlasdb/commit/85e228f7f4e7a39cfffa82aa0bb0b6c80e5da248", "message": "Add generated changelog entries", "committedDate": "2020-11-19T20:00:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY5MDIzNQ==", "url": "https://github.com/palantir/atlasdb/pull/5123#discussion_r527690235", "bodyText": "Can we actually just bump this to 16?", "author": "Jolyon-S", "createdAt": "2020-11-20T13:28:54Z", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/AtlasDbConstants.java", "diffHunk": "@@ -150,7 +150,8 @@ private AtlasDbConstants() {\n \n     public static final boolean DEFAULT_ENABLE_SWEEP_QUEUE_WRITES = true;\n     public static final boolean DEFAULT_ENABLE_TARGETED_SWEEP = true;\n-    public static final int DEFAULT_SWEEP_QUEUE_SHARDS = 1;\n+    public static final int LEGACY_DEFAULT_TARGETED_SWEEP_SHARDS = 1;\n+    public static final int DEFAULT_TARGETED_SWEEP_SHARDS = 8;", "originalCommit": "f662b67563083117b60feb0cf97abab0b036bffa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "df3c843469151ae6ca7ad8b71556c227870560c9", "chunk": "diff --git a/atlasdb-client/src/main/java/com/palantir/atlasdb/AtlasDbConstants.java b/atlasdb-client/src/main/java/com/palantir/atlasdb/AtlasDbConstants.java\nindex 49ebaa975c..b408d506dc 100644\n--- a/atlasdb-client/src/main/java/com/palantir/atlasdb/AtlasDbConstants.java\n+++ b/atlasdb-client/src/main/java/com/palantir/atlasdb/AtlasDbConstants.java\n\n@@ -151,7 +151,7 @@ public final class AtlasDbConstants {\n     public static final boolean DEFAULT_ENABLE_SWEEP_QUEUE_WRITES = true;\n     public static final boolean DEFAULT_ENABLE_TARGETED_SWEEP = true;\n     public static final int LEGACY_DEFAULT_TARGETED_SWEEP_SHARDS = 1;\n-    public static final int DEFAULT_TARGETED_SWEEP_SHARDS = 8;\n+    public static final int DEFAULT_TARGETED_SWEEP_SHARDS = 16;\n     public static final int DEFAULT_TARGETED_SWEEP_THREADS = 1;\n     public static final int MAX_SWEEP_QUEUE_SHARDS = TargetedSweepMetadata.MAX_SHARDS;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTYyNDczNQ==", "url": "https://github.com/palantir/atlasdb/pull/5123#discussion_r531624735", "bodyText": "\ud83d\udc4d  for the defensiveness", "author": "gmaretic", "createdAt": "2020-11-27T14:12:56Z", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/sweep/queue/ShardProgress.java", "diffHunk": "@@ -52,7 +52,9 @@ public ShardProgress(KeyValueService kvs) {\n      * Returns the persisted number of shards for the sweep queue.\n      */\n     public int getNumberOfShards() {\n-        return maybeGet(SHARD_COUNT_SAS).map(Long::intValue).orElse(AtlasDbConstants.DEFAULT_SWEEP_QUEUE_SHARDS);\n+        return maybeGet(SHARD_COUNT_SAS)\n+                .map(Long::intValue)\n+                .orElse(AtlasDbConstants.LEGACY_DEFAULT_TARGETED_SWEEP_SHARDS);", "originalCommit": "f662b67563083117b60feb0cf97abab0b036bffa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "df3c843469151ae6ca7ad8b71556c227870560c9", "url": "https://github.com/palantir/atlasdb/commit/df3c843469151ae6ca7ad8b71556c227870560c9", "message": "16", "committedDate": "2020-11-27T14:30:40Z", "type": "commit"}, {"oid": "7b5d59261405a6faa31d780bd6d9886c8fe160c1", "url": "https://github.com/palantir/atlasdb/commit/7b5d59261405a6faa31d780bd6d9886c8fe160c1", "message": "fix", "committedDate": "2020-11-27T17:45:15Z", "type": "commit"}]}