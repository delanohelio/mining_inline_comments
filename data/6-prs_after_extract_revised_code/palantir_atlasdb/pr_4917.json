{"pr_number": 4917, "pr_title": "[PDS-127121] Log refreshed Cassandra hosts at info level", "pr_createdAt": "2020-07-27T13:40:28Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4917", "timeline": [{"oid": "15cf8466113427cad3bd02fa74614035841ed686", "url": "https://github.com/palantir/atlasdb/commit/15cf8466113427cad3bd02fa74614035841ed686", "message": "set debug logging to info", "committedDate": "2020-07-27T13:36:08Z", "type": "commit"}, {"oid": "866886e1f227b92f8a54c339f96ab0c823dc20f5", "url": "https://github.com/palantir/atlasdb/commit/866886e1f227b92f8a54c339f96ab0c823dc20f5", "message": "Add generated changelog entries", "committedDate": "2020-07-27T13:36:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzUzMw==", "url": "https://github.com/palantir/atlasdb/pull/4917#discussion_r460903533", "bodyText": "nit: How valuable is an empty refresh line? Maybe we can have a refresh that did something at INFO and a refresh that did nothing at DEBUG.", "author": "jeremyk-91", "createdAt": "2020-07-27T13:49:52Z", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java", "diffHunk": "@@ -312,7 +312,7 @@ private void setServersInPoolTo(Set<InetSocketAddress> desiredServers) {\n             cassandra.refreshTokenRangesAndGetServers();\n         }\n \n-        log.debug(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n+        log.info(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",", "originalCommit": "866886e1f227b92f8a54c339f96ab0c823dc20f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNzg0Nw==", "url": "https://github.com/palantir/atlasdb/pull/4917#discussion_r460907847", "bodyText": "I like it.", "author": "Jolyon-S", "createdAt": "2020-07-27T13:55:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwMzUzMw=="}], "type": "inlineReview", "revised_code": {"commit": "dc3ce6597568bc31a4283b2989ba7fab572c5032", "chunk": "diff --git a/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java b/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\nindex 9ec392dbd1..e8b1e521bd 100644\n--- a/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\n+++ b/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\n\n@@ -312,9 +312,17 @@ public class CassandraClientPoolImpl implements CassandraClientPool {\n             cassandra.refreshTokenRangesAndGetServers();\n         }\n \n-        log.info(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n-                SafeArg.of(\"serversToAdd\", CassandraLogHelper.collectionOfHosts(serversToAdd)),\n-                SafeArg.of(\"serversToRemove\", CassandraLogHelper.collectionOfHosts(serversToRemove)));\n+        logRefreshedHosts(serversToAdd, serversToRemove);\n+    }\n+\n+    private void logRefreshedHosts(Set<InetSocketAddress> serversToAdd, Set<InetSocketAddress> serversToRemove) {\n+        if (serversToRemove.isEmpty() && serversToAdd.isEmpty()) {\n+            log.debug(\"No hosts added or removed during Cassandra pool refresh\");\n+        } else {\n+            log.info(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n+                    SafeArg.of(\"serversToAdd\", CassandraLogHelper.collectionOfHosts(serversToAdd)),\n+                    SafeArg.of(\"serversToRemove\", CassandraLogHelper.collectionOfHosts(serversToRemove)));\n+        }\n     }\n \n     private Set<InetSocketAddress> getCachedServers() {\n"}}, {"oid": "dc3ce6597568bc31a4283b2989ba7fab572c5032", "url": "https://github.com/palantir/atlasdb/commit/dc3ce6597568bc31a4283b2989ba7fab572c5032", "message": "factor out log method", "committedDate": "2020-07-27T13:57:51Z", "type": "commit"}, {"oid": "c0017822bb986b0312a20839519b7189dedc7e97", "url": "https://github.com/palantir/atlasdb/commit/c0017822bb986b0312a20839519b7189dedc7e97", "message": "Merge branch 'elevate-to-info' of github.com:palantir/atlasdb into elevate-to-info", "committedDate": "2020-07-27T13:58:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkyNTExNA==", "url": "https://github.com/palantir/atlasdb/pull/4917#discussion_r460925114", "bodyText": "nit: static?", "author": "jeremyk-91", "createdAt": "2020-07-27T14:20:01Z", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java", "diffHunk": "@@ -312,9 +312,17 @@ private void setServersInPoolTo(Set<InetSocketAddress> desiredServers) {\n             cassandra.refreshTokenRangesAndGetServers();\n         }\n \n-        log.debug(\"Cassandra pool refresh added hosts {}, removed hosts {}.\",\n-                SafeArg.of(\"serversToAdd\", CassandraLogHelper.collectionOfHosts(serversToAdd)),\n-                SafeArg.of(\"serversToRemove\", CassandraLogHelper.collectionOfHosts(serversToRemove)));\n+        logRefreshedHosts(serversToAdd, serversToRemove);\n+    }\n+\n+    private void logRefreshedHosts(Set<InetSocketAddress> serversToAdd, Set<InetSocketAddress> serversToRemove) {", "originalCommit": "c0017822bb986b0312a20839519b7189dedc7e97", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d20c26f212c08414236f25b165b11fb6624c761f", "chunk": "diff --git a/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java b/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\nindex e8b1e521bd..f1c580953f 100644\n--- a/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\n+++ b/atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/CassandraClientPoolImpl.java\n\n@@ -315,7 +315,7 @@ public class CassandraClientPoolImpl implements CassandraClientPool {\n         logRefreshedHosts(serversToAdd, serversToRemove);\n     }\n \n-    private void logRefreshedHosts(Set<InetSocketAddress> serversToAdd, Set<InetSocketAddress> serversToRemove) {\n+    private static void logRefreshedHosts(Set<InetSocketAddress> serversToAdd, Set<InetSocketAddress> serversToRemove) {\n         if (serversToRemove.isEmpty() && serversToAdd.isEmpty()) {\n             log.debug(\"No hosts added or removed during Cassandra pool refresh\");\n         } else {\n"}}, {"oid": "d20c26f212c08414236f25b165b11fb6624c761f", "url": "https://github.com/palantir/atlasdb/commit/d20c26f212c08414236f25b165b11fb6624c761f", "message": "make method static", "committedDate": "2020-07-27T14:21:11Z", "type": "commit"}]}