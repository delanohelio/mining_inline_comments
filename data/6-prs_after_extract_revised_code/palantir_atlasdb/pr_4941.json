{"pr_number": 4941, "pr_title": "Much less ram used by disruptors", "pr_createdAt": "2020-08-12T18:54:00Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4941", "timeline": [{"oid": "e32a59b2132fdee0df76efd6fb6460013014d904", "url": "https://github.com/palantir/atlasdb/commit/e32a59b2132fdee0df76efd6fb6460013014d904", "message": "Reattempt", "committedDate": "2020-08-13T07:16:47Z", "type": "commit"}, {"oid": "3084c84a9532139785e526dee25fcb7f1fef1113", "url": "https://github.com/palantir/atlasdb/commit/3084c84a9532139785e526dee25fcb7f1fef1113", "message": "Add generated changelog entries", "committedDate": "2020-08-13T07:16:47Z", "type": "commit"}, {"oid": "e32a59b2132fdee0df76efd6fb6460013014d904", "url": "https://github.com/palantir/atlasdb/commit/e32a59b2132fdee0df76efd6fb6460013014d904", "message": "Reattempt", "committedDate": "2020-08-13T07:16:47Z", "type": "forcePushed"}, {"oid": "10c62bf02f3af4a29fd9cb33e38a2441f20fd52e", "url": "https://github.com/palantir/atlasdb/commit/10c62bf02f3af4a29fd9cb33e38a2441f20fd52e", "message": "Not actually a batch element", "committedDate": "2020-08-13T07:26:16Z", "type": "commit"}, {"oid": "ee252fd795610958f5d6eb8e40cf4eba9321dbbb", "url": "https://github.com/palantir/atlasdb/commit/ee252fd795610958f5d6eb8e40cf4eba9321dbbb", "message": "Args are nullable", "committedDate": "2020-08-13T09:14:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgzMjA3OA==", "url": "https://github.com/palantir/atlasdb/pull/4941#discussion_r469832078", "bodyText": "nit: this has 129 chars - quick refactor please", "author": "jeremyk-91", "createdAt": "2020-08-13T09:47:34Z", "path": "atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java", "diffHunk": "@@ -159,9 +160,9 @@ public boolean setFuture(ListenableFuture<? extends R> future) {\n             EventHandler<BatchElement<T, R>> eventHandler,\n             int bufferSize,\n             String safeLoggablePurpose) {\n-        Disruptor<DefaultBatchElement<T, R>> disruptor =\n-                new Disruptor<>(DefaultBatchElement::new, bufferSize, threadFactory(safeLoggablePurpose));\n-        disruptor.handleEventsWith(eventHandler);\n+        Disruptor<DisruptorBatchElement<T, R>> disruptor =\n+                new Disruptor<>(DisruptorBatchElement::new, bufferSize, threadFactory(safeLoggablePurpose));\n+        disruptor.handleEventsWith((event, sequence, endOfBatch) -> eventHandler.onEvent(event.consume(), sequence, endOfBatch));", "originalCommit": "ee252fd795610958f5d6eb8e40cf4eba9321dbbb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0MTAwNg==", "url": "https://github.com/palantir/atlasdb/pull/4941#discussion_r469841006", "bodyText": "(I'm going to do this, so don't do this one if you see it!)", "author": "jeremyk-91", "createdAt": "2020-08-13T10:03:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTgzMjA3OA=="}], "type": "inlineReview", "revised_code": {"commit": "ae23deba019e3ed15883c7fcfc6e95e0d9407752", "chunk": "diff --git a/atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java b/atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java\nindex cfc1fde7b9..ab25c09e36 100644\n--- a/atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java\n+++ b/atlasdb-autobatch/src/main/java/com/palantir/atlasdb/autobatch/DisruptorAutobatcher.java\n\n@@ -162,7 +162,8 @@ public final class DisruptorAutobatcher<T, R>\n             String safeLoggablePurpose) {\n         Disruptor<DisruptorBatchElement<T, R>> disruptor =\n                 new Disruptor<>(DisruptorBatchElement::new, bufferSize, threadFactory(safeLoggablePurpose));\n-        disruptor.handleEventsWith((event, sequence, endOfBatch) -> eventHandler.onEvent(event.consume(), sequence, endOfBatch));\n+        disruptor.handleEventsWith(\n+                (event, sequence, endOfBatch) -> eventHandler.onEvent(event.consume(), sequence, endOfBatch));\n         disruptor.start();\n         return new DisruptorAutobatcher<>(disruptor, disruptor.getRingBuffer(), safeLoggablePurpose);\n     }\n"}}, {"oid": "ae23deba019e3ed15883c7fcfc6e95e0d9407752", "url": "https://github.com/palantir/atlasdb/commit/ae23deba019e3ed15883c7fcfc6e95e0d9407752", "message": "checkstyle", "committedDate": "2020-08-13T10:14:16Z", "type": "commit"}]}