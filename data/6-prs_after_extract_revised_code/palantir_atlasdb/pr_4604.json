{"pr_number": 4604, "pr_title": "[LW] Expose LW Info in TM", "pr_createdAt": "2020-02-26T11:43:09Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4604", "timeline": [{"oid": "8740ab9b0eb8e8daf4d2d8152231738d07d4248e", "url": "https://github.com/palantir/atlasdb/commit/8740ab9b0eb8e8daf4d2d8152231738d07d4248e", "message": "Be better, one day at a time. Also fix nasty concurrency issue.", "committedDate": "2020-02-20T10:43:02Z", "type": "commit"}, {"oid": "2c3a9d273d2ff4ec589001af51cb408ed67b14fa", "url": "https://github.com/palantir/atlasdb/commit/2c3a9d273d2ff4ec589001af51cb408ed67b14fa", "message": "Rework lock watch updates and registration", "committedDate": "2020-02-21T16:58:50Z", "type": "commit"}, {"oid": "d311fef3558808de8fa7bf90975ff50d3b7115d7", "url": "https://github.com/palantir/atlasdb/commit/d311fef3558808de8fa7bf90975ff50d3b7115d7", "message": "Merge with develop", "committedDate": "2020-02-24T10:46:42Z", "type": "commit"}, {"oid": "121eada2e9528cbedc9c694d7067a0d8eea5421a", "url": "https://github.com/palantir/atlasdb/commit/121eada2e9528cbedc9c694d7067a0d8eea5421a", "message": "Do not filter unlocks for replayer", "committedDate": "2020-02-24T11:34:03Z", "type": "commit"}, {"oid": "413cc995a5ed5ff3de45629bf34f778e663e3be1", "url": "https://github.com/palantir/atlasdb/commit/413cc995a5ed5ff3de45629bf34f778e663e3be1", "message": "Add test for snapshot reflecting events logged during open locks calculation", "committedDate": "2020-02-24T11:44:02Z", "type": "commit"}, {"oid": "b093ba27896ea55a417dd52e8b83f35f3bda01aa", "url": "https://github.com/palantir/atlasdb/commit/b093ba27896ea55a417dd52e8b83f35f3bda01aa", "message": "Expose the interface that we need to get lock watch updates as an atlas client", "committedDate": "2020-02-25T16:15:37Z", "type": "commit"}, {"oid": "958eb971d0dd8fbddc7d5a7bef31b7c31f8931e3", "url": "https://github.com/palantir/atlasdb/commit/958eb971d0dd8fbddc7d5a7bef31b7c31f8931e3", "message": "Some refactoring", "committedDate": "2020-02-26T11:32:22Z", "type": "commit"}, {"oid": "f8a708a8a96a177980061d91573f57128730a9b8", "url": "https://github.com/palantir/atlasdb/commit/f8a708a8a96a177980061d91573f57128730a9b8", "message": "Fix merge conflict with develop", "committedDate": "2020-02-26T11:36:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjI0Mg==", "url": "https://github.com/palantir/atlasdb/pull/4604#discussion_r385692242", "bodyText": "These names are a bit close to the LockWatchStateUpdate ones, and a little confusingly there a Snapshot becomes here a Failure.  Maybe Events rather than Success, and something like Snapshot or State rather than Failure?", "author": "jeremyk-91", "createdAt": "2020-02-28T13:23:32Z", "path": "atlasdb-api/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/TransactionsLockWatchEvents.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.keyvalue.api.watch;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.immutables.value.Value;\n+\n+import com.palantir.lock.watch.LockWatchEvent;\n+import com.palantir.lock.watch.LockWatchStateUpdate;\n+\n+/**\n+ * Represents a condensed view of lock watch events occurring between some known version and a set of start transaction\n+ * calls.\n+ */\n+public interface TransactionsLockWatchEvents {\n+    <T> T accept(Visitor<T> visitor);\n+\n+    interface Visitor<T> {\n+        T visit(Success success);\n+        T visit(Failure failure);\n+    }", "originalCommit": "f8a708a8a96a177980061d91573f57128730a9b8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f5fa1e751750b0dbc4011165d98c5aaed0958cb1", "chunk": "diff --git a/atlasdb-api/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/TransactionsLockWatchEvents.java b/lock-api-objects/src/main/java/com/palantir/lock/watch/TransactionsLockWatchEvents.java\nsimilarity index 74%\nrename from atlasdb-api/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/TransactionsLockWatchEvents.java\nrename to lock-api-objects/src/main/java/com/palantir/lock/watch/TransactionsLockWatchEvents.java\nindex e40ee12e2f..a6637320eb 100644\n--- a/atlasdb-api/src/main/java/com/palantir/atlasdb/keyvalue/api/watch/TransactionsLockWatchEvents.java\n+++ b/lock-api-objects/src/main/java/com/palantir/lock/watch/TransactionsLockWatchEvents.java\n\n@@ -14,16 +14,13 @@\n  * limitations under the License.\n  */\n \n-package com.palantir.atlasdb.keyvalue.api.watch;\n+package com.palantir.lock.watch;\n \n import java.util.List;\n import java.util.Map;\n \n import org.immutables.value.Value;\n \n-import com.palantir.lock.watch.LockWatchEvent;\n-import com.palantir.lock.watch.LockWatchStateUpdate;\n-\n /**\n  * Represents a condensed view of lock watch events occurring between some known version and a set of start transaction\n  * calls.\n"}}, {"oid": "f5fa1e751750b0dbc4011165d98c5aaed0958cb1", "url": "https://github.com/palantir/atlasdb/commit/f5fa1e751750b0dbc4011165d98c5aaed0958cb1", "message": "Address CR and move to a better package", "committedDate": "2020-02-28T13:35:11Z", "type": "commit"}]}