{"pr_number": 4769, "pr_title": "Gradle consistent versions", "pr_createdAt": "2020-05-13T14:30:07Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4769", "timeline": [{"oid": "1b7b01be10fb2ee3029e2ddfdeadc128736747cc", "url": "https://github.com/palantir/atlasdb/commit/1b7b01be10fb2ee3029e2ddfdeadc128736747cc", "message": "Use gcv", "committedDate": "2020-05-13T10:28:06Z", "type": "commit"}, {"oid": "9db27808f6517e805fc3f0a0aee065880bcd76e7", "url": "https://github.com/palantir/atlasdb/commit/9db27808f6517e805fc3f0a0aee065880bcd76e7", "message": "FIx compile", "committedDate": "2020-05-13T13:48:52Z", "type": "commit"}, {"oid": "fd3281c1539083929729d163a62d08590be0bbbb", "url": "https://github.com/palantir/atlasdb/commit/fd3281c1539083929729d163a62d08590be0bbbb", "message": "Fix up", "committedDate": "2020-05-13T13:56:47Z", "type": "commit"}, {"oid": "74caaff2f9ea9ba9bd678091e03e8a53376b458c", "url": "https://github.com/palantir/atlasdb/commit/74caaff2f9ea9ba9bd678091e03e8a53376b458c", "message": "Remove some deps", "committedDate": "2020-05-13T14:29:28Z", "type": "commit"}, {"oid": "c3181e9a8eae7101987247e491ff3bbc4ab8cfcb", "url": "https://github.com/palantir/atlasdb/commit/c3181e9a8eae7101987247e491ff3bbc4ab8cfcb", "message": "don't resolve configurations- bug in gcv", "committedDate": "2020-05-13T15:54:31Z", "type": "commit"}, {"oid": "88adcec30ebc01caaa19d362bcac5c12d0bab87a", "url": "https://github.com/palantir/atlasdb/commit/88adcec30ebc01caaa19d362bcac5c12d0bab87a", "message": "Unused pins", "committedDate": "2020-05-13T16:08:24Z", "type": "commit"}, {"oid": "f8f1fb631eb129fe1c2ba715506204c5475db9ab", "url": "https://github.com/palantir/atlasdb/commit/f8f1fb631eb129fe1c2ba715506204c5475db9ab", "message": "Fix failing tests", "committedDate": "2020-05-13T16:15:30Z", "type": "commit"}, {"oid": "b1dbd68f53125b29c0430fa6ea49daa3d31c651f", "url": "https://github.com/palantir/atlasdb/commit/b1dbd68f53125b29c0430fa6ea49daa3d31c651f", "message": "Some forces", "committedDate": "2020-05-13T16:28:28Z", "type": "commit"}, {"oid": "30256d6724f06185abb904b86ef5e6f442cb9d29", "url": "https://github.com/palantir/atlasdb/commit/30256d6724f06185abb904b86ef5e6f442cb9d29", "message": "Fix", "committedDate": "2020-05-14T07:57:20Z", "type": "commit"}, {"oid": "dd4e9b2cdd863d73af84137da412ec2580bfc96b", "url": "https://github.com/palantir/atlasdb/commit/dd4e9b2cdd863d73af84137da412ec2580bfc96b", "message": "Jvm metrics", "committedDate": "2020-05-14T07:58:32Z", "type": "commit"}, {"oid": "d1395ea132ef92ec237d12ec07996dee06df5250", "url": "https://github.com/palantir/atlasdb/commit/d1395ea132ef92ec237d12ec07996dee06df5250", "message": "Foo", "committedDate": "2020-05-14T08:00:55Z", "type": "commit"}, {"oid": "a2c50c00eb92a8c7aaec601d55dab39ba96bb365", "url": "https://github.com/palantir/atlasdb/commit/a2c50c00eb92a8c7aaec601d55dab39ba96bb365", "message": "Remove tests.props", "committedDate": "2020-05-14T08:01:23Z", "type": "commit"}, {"oid": "f1b0c0722c20f50c9296e65d2f404429f50bb679", "url": "https://github.com/palantir/atlasdb/commit/f1b0c0722c20f50c9296e65d2f404429f50bb679", "message": "Hack for dropwizard metrics", "committedDate": "2020-05-14T20:40:00Z", "type": "commit"}, {"oid": "882e7e5b61a39e73b4f6b9b7a9027b1b04f27658", "url": "https://github.com/palantir/atlasdb/commit/882e7e5b61a39e73b4f6b9b7a9027b1b04f27658", "message": "Fix hamcrest", "committedDate": "2020-05-14T20:43:18Z", "type": "commit"}, {"oid": "9eb32eeca0c5c811a19042b9587e663f32732f8c", "url": "https://github.com/palantir/atlasdb/commit/9eb32eeca0c5c811a19042b9587e663f32732f8c", "message": "Fix compile", "committedDate": "2020-05-14T20:45:15Z", "type": "commit"}, {"oid": "eedcb96bd8fe7ec7533edb7ffbc489d6be1defa6", "url": "https://github.com/palantir/atlasdb/commit/eedcb96bd8fe7ec7533edb7ffbc489d6be1defa6", "message": "Merge branch 'develop' into jbaker/gcv", "committedDate": "2020-05-14T20:58:29Z", "type": "commit"}, {"oid": "71c94da7effeaa2e53d4238915aa65929976a2b6", "url": "https://github.com/palantir/atlasdb/commit/71c94da7effeaa2e53d4238915aa65929976a2b6", "message": "Merge branch 'develop' into jbaker/gcv", "committedDate": "2020-05-18T07:36:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5NjA3NA==", "url": "https://github.com/palantir/atlasdb/pull/4769#discussion_r427396074", "bodyText": "This is used by large internal product's command line interface to an AtlasDB database, so I'm not sure we can remove this?", "author": "jeremyk-91", "createdAt": "2020-05-19T15:31:07Z", "path": "atlasdb-client/src/main/java/com/palantir/atlasdb/table/description/NameMetadataDescription.java", "diffHunk": "@@ -181,55 +174,6 @@ public String renderToJson(byte[] name) {\n         return sb.toString();\n     }\n \n-    public byte[] parseFromJson(String json, boolean allowPrefix) {", "originalCommit": "71c94da7effeaa2e53d4238915aa65929976a2b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzI2NzI4MQ==", "url": "https://github.com/palantir/atlasdb/pull/4769#discussion_r437267281", "bodyText": "This deletion is not needed after #4821", "author": "jeremyk-91", "createdAt": "2020-06-09T09:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzM5NjA3NA=="}], "type": "inlineReview", "revised_code": {"commit": "8e2c947637853437683c95ab37378ce64c1fcbb6", "chunk": "diff --git a/atlasdb-client/src/main/java/com/palantir/atlasdb/table/description/NameMetadataDescription.java b/atlasdb-client/src/main/java/com/palantir/atlasdb/table/description/NameMetadataDescription.java\nindex fbdffe65bf..06ea1717df 100644\n--- a/atlasdb-client/src/main/java/com/palantir/atlasdb/table/description/NameMetadataDescription.java\n+++ b/atlasdb-client/src/main/java/com/palantir/atlasdb/table/description/NameMetadataDescription.java\n\n@@ -174,6 +183,61 @@ public class NameMetadataDescription {\n         return sb.toString();\n     }\n \n+    public byte[] parseFromJson(String json, boolean allowPrefix) {\n+        try {\n+            JsonNode jsonNode = OBJECT_MAPPER.readTree(json);\n+            Preconditions.checkState(jsonNode.isObject(),\n+                    \"Only JSON objects can be deserialized into parsed byte arrays.  Passed json was: %s\",\n+                    json);\n+            ObjectNode objectNode = (ObjectNode) jsonNode;\n+\n+            int numDefinedFields = countNumDefinedFields(objectNode);\n+            byte[][] bytes = new byte[numDefinedFields][];\n+\n+            Preconditions.checkArgument(numDefinedFields > 0,\n+                    \"JSON object needs a field named: %s.  Passed json was: %s\",\n+                    rowParts.get(0).getComponentName(),\n+                    json);\n+            Preconditions.checkArgument(allowPrefix || numDefinedFields == rowParts.size(),\n+                    \"JSON object has %s defined fields, but the number of row components is %s.  Passed json was: %s\",\n+                    numDefinedFields,\n+                    rowParts.size(),\n+                    json);\n+\n+            for (int i = 0; i < numDefinedFields; ++i) {\n+                NameComponentDescription desc = rowParts.get(i);\n+                JsonNode element = objectNode.get(desc.getComponentName());\n+                String textRepresentation = element.isTextual() ? element.textValue() : String.valueOf(element);\n+                bytes[i] = desc.getType().convertFromString(textRepresentation);\n+                if (desc.isReverseOrder()) {\n+                    EncodingUtils.flipAllBitsInPlace(bytes[i]);\n+                }\n+            }\n+\n+            return Bytes.concat(bytes);\n+        } catch (JsonProcessingException e) {\n+            throw Throwables.throwUncheckedException(e);\n+        }\n+    }\n+\n+    private int countNumDefinedFields(ObjectNode objectNode) {\n+        int numFields = 0;\n+        for (; numFields < rowParts.size(); ++numFields) {\n+            if (!objectNode.has(rowParts.get(numFields).getComponentName())) {\n+                break;\n+            }\n+        }\n+\n+        for (int i = numFields + 1; i < rowParts.size(); ++i) {\n+            String componentName = rowParts.get(i).getComponentName();\n+            if (objectNode.has(componentName)) {\n+                throw new IllegalArgumentException(\"JSON object is missing field: \"\n+                        + rowParts.get(i - 1).getComponentName());\n+            }\n+        }\n+        return numFields;\n+    }\n+\n     public TableMetadataPersistence.NameMetadataDescription.Builder persistToProto() {\n         Builder builder = TableMetadataPersistence.NameMetadataDescription.newBuilder();\n         for (NameComponentDescription part : rowParts) {\n"}}, {"oid": "8e2c947637853437683c95ab37378ce64c1fcbb6", "url": "https://github.com/palantir/atlasdb/commit/8e2c947637853437683c95ab37378ce64c1fcbb6", "message": "Merge branch 'develop' into jbaker/gcv", "committedDate": "2020-06-09T10:26:21Z", "type": "commit"}]}