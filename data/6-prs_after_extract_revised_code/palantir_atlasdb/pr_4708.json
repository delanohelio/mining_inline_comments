{"pr_number": 4708, "pr_title": "[PDS-111849] Rolling in the Deep, Part 5: Only One Dedicated Executor", "pr_createdAt": "2020-04-14T17:27:45Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4708", "timeline": [{"oid": "450243107910e0e2d1ab26ed2ba5e8ace7e15bbd", "url": "https://github.com/palantir/atlasdb/commit/450243107910e0e2d1ab26ed2ba5e8ace7e15bbd", "message": "rearchitecture", "committedDate": "2020-04-10T11:11:12Z", "type": "commit"}, {"oid": "a960ce6617a74cef7acea14cbacc05957e0c1174", "url": "https://github.com/palantir/atlasdb/commit/a960ce6617a74cef7acea14cbacc05957e0c1174", "message": "fixes", "committedDate": "2020-04-14T16:04:02Z", "type": "commit"}, {"oid": "2280955dae7f463f3e5d3f2d5f7fba0b18eabb11", "url": "https://github.com/palantir/atlasdb/commit/2280955dae7f463f3e5d3f2d5f7fba0b18eabb11", "message": "Baseline", "committedDate": "2020-04-14T16:29:55Z", "type": "commit"}, {"oid": "dcfdd422e176b33de0abbc720c44391036211f41", "url": "https://github.com/palantir/atlasdb/commit/dcfdd422e176b33de0abbc720c44391036211f41", "message": "timestamp paxos should be restricted too", "committedDate": "2020-04-14T16:40:29Z", "type": "commit"}, {"oid": "55fee2cfdd1a64e6c2202b8aa8005a27d29ded22", "url": "https://github.com/palantir/atlasdb/commit/55fee2cfdd1a64e6c2202b8aa8005a27d29ded22", "message": "Revert \"timestamp paxos should be restricted too\"\n\nThis reverts commit dcfdd422e176b33de0abbc720c44391036211f41.", "committedDate": "2020-04-14T17:22:23Z", "type": "commit"}, {"oid": "23f445aba7f634f24a34a76c0aeb60918031b786", "url": "https://github.com/palantir/atlasdb/commit/23f445aba7f634f24a34a76c0aeb60918031b786", "message": "cs", "committedDate": "2020-04-14T17:23:05Z", "type": "commit"}, {"oid": "e03594278ed345c77f98e1ee4a001deea4312eda", "url": "https://github.com/palantir/atlasdb/commit/e03594278ed345c77f98e1ee4a001deea4312eda", "message": "Add generated changelog entries", "committedDate": "2020-04-14T17:23:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2MzI1Mw==", "url": "https://github.com/palantir/atlasdb/pull/4708#discussion_r408763253", "bodyText": "\u2764\ufe0f", "author": "gmaretic", "createdAt": "2020-04-15T11:12:44Z", "path": "timelock-impl/src/main/java/com/palantir/atlasdb/timelock/paxos/WithDedicatedExecutor.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * (c) Copyright 2020 Palantir Technologies Inc. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.palantir.atlasdb.timelock.paxos;\n+\n+import java.util.Map;\n+import java.util.concurrent.ExecutorService;\n+import java.util.function.Function;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+public interface WithDedicatedExecutor<T> {", "originalCommit": "e03594278ed345c77f98e1ee4a001deea4312eda", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc3NDE4Ng==", "url": "https://github.com/palantir/atlasdb/pull/4708#discussion_r408774186", "bodyText": "we don't need this comment", "author": "gmaretic", "createdAt": "2020-04-15T11:34:09Z", "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java", "diffHunk": "@@ -46,7 +50,23 @@\n     public abstract PaxosResourcesFactory.TimelockPaxosInstallationContext context();\n \n     @Value.Parameter\n-    public abstract TaggedMetricRegistry metrics();\n+    public abstract MetricsManager metrics();\n+\n+    @Value.Derived\n+    Map<String, ExecutorService> dedicatedExecutors() {\n+        Set<String> remoteUris = context().remoteUris();\n+        int executorIndex = 0; // Acceptable for Set, we just want to differentiate the elements", "originalCommit": "e03594278ed345c77f98e1ee4a001deea4312eda", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6754903a812e89b25357fc2eccebdb6e4c03074b", "chunk": "diff --git a/timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java b/timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java\nindex 4bf44ddfe6..372d008d3e 100644\n--- a/timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java\n+++ b/timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java\n\n@@ -55,7 +55,7 @@ public abstract class PaxosRemoteClients {\n     @Value.Derived\n     Map<String, ExecutorService> dedicatedExecutors() {\n         Set<String> remoteUris = context().remoteUris();\n-        int executorIndex = 0; // Acceptable for Set, we just want to differentiate the elements\n+        int executorIndex = 0;\n \n         ImmutableMap.Builder<String, ExecutorService> builder = ImmutableMap.builder();\n         for (String remoteUri : remoteUris) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc3NDQ2NQ==", "url": "https://github.com/palantir/atlasdb/pull/4708#discussion_r408774465", "bodyText": "Nice!", "author": "gmaretic", "createdAt": "2020-04-15T11:34:44Z", "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/PaxosRemoteClients.java", "diffHunk": "@@ -113,7 +138,17 @@\n         return createInstrumentedRemoteProxies(clazz, shouldRetry).values().collect(Collectors.toList());\n     }\n \n-    private <T> KeyedStream<HostAndPort, T> createInstrumentedRemoteProxies(Class<T> clazz, boolean shouldRetry) {\n+    private <T> List<WithDedicatedExecutor<T>> createInstrumentedRemoteProxiesAndAssignDedicatedExecutors(\n+            Class<T> clazz,\n+            boolean shouldRetry) {\n+        return createInstrumentedRemoteProxies(clazz, shouldRetry)", "originalCommit": "e03594278ed345c77f98e1ee4a001deea4312eda", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "6754903a812e89b25357fc2eccebdb6e4c03074b", "url": "https://github.com/palantir/atlasdb/commit/6754903a812e89b25357fc2eccebdb6e4c03074b", "message": "Remove stray comment", "committedDate": "2020-04-15T17:43:01Z", "type": "commit"}, {"oid": "84d4da3fb58ddc6606c59e8e6487cbc96b1e63a6", "url": "https://github.com/palantir/atlasdb/commit/84d4da3fb58ddc6606c59e8e6487cbc96b1e63a6", "message": "Merge branch 'develop' into jkong/rolling-5", "committedDate": "2020-04-16T09:27:01Z", "type": "commit"}, {"oid": "c2fec7790c80a05bfe9a743781e5c3ef2da9926f", "url": "https://github.com/palantir/atlasdb/commit/c2fec7790c80a05bfe9a743781e5c3ef2da9926f", "message": "Merge conflicts", "committedDate": "2020-04-16T09:39:43Z", "type": "commit"}, {"oid": "d7d74bc6ccd8f54af4db95198415c47b6826f037", "url": "https://github.com/palantir/atlasdb/commit/d7d74bc6ccd8f54af4db95198415c47b6826f037", "message": "merge conflict", "committedDate": "2020-04-16T09:42:55Z", "type": "commit"}]}