{"pr_number": 366, "pr_title": "Documentation for simple query", "pr_createdAt": "2020-02-13T01:35:43Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366", "timeline": [{"oid": "52293672c0bd100f3ecfd31ac98d8e40983aa765", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/52293672c0bd100f3ecfd31ac98d8e40983aa765", "message": "Add doc test for simple query", "committedDate": "2020-01-31T01:00:33Z", "type": "commit"}, {"oid": "c6aba9a61010a83131098d952d562210903071a8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/c6aba9a61010a83131098d952d562210903071a8", "message": "Add to index", "committedDate": "2020-01-31T01:05:49Z", "type": "commit"}, {"oid": "a66a46b7451a3b6553684996da4781be0e6c2197", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a66a46b7451a3b6553684996da4781be0e6c2197", "message": "Fix format", "committedDate": "2020-01-31T01:14:13Z", "type": "commit"}, {"oid": "021d0aa7a7feb31c060ac259cf72a06801e69f3c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/021d0aa7a7feb31c060ac259cf72a06801e69f3c", "message": "Add documentation", "committedDate": "2020-02-05T00:26:14Z", "type": "commit"}, {"oid": "ef158120507343f92b85e397e17ead42fafa81cb", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ef158120507343f92b85e397e17ead42fafa81cb", "message": "Add documentation", "committedDate": "2020-02-05T00:45:27Z", "type": "commit"}, {"oid": "4cda2834e46fd12ec9d395bc22f72bc1cbc59803", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4cda2834e46fd12ec9d395bc22f72bc1cbc59803", "message": "Add documentation", "committedDate": "2020-02-05T00:52:44Z", "type": "commit"}, {"oid": "b9ab6c8d1104121b282a5068ad68ef7fda6e0b6c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b9ab6c8d1104121b282a5068ad68ef7fda6e0b6c", "message": "Add documentation", "committedDate": "2020-02-05T00:54:18Z", "type": "commit"}, {"oid": "30476fd9fa4c2aa779efea5133042ec4b28a645c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/30476fd9fa4c2aa779efea5133042ec4b28a645c", "message": "Add documentation", "committedDate": "2020-02-05T01:03:53Z", "type": "commit"}, {"oid": "1275fa1541be3cabdcd30036cf418f6d6aaa5de9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1275fa1541be3cabdcd30036cf418f6d6aaa5de9", "message": "Add documentation", "committedDate": "2020-02-05T01:32:54Z", "type": "commit"}, {"oid": "4345f6f7b87df5baae9446eb647c4d6299376bd1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4345f6f7b87df5baae9446eb647c4d6299376bd1", "message": "Add documentation", "committedDate": "2020-02-05T19:01:22Z", "type": "commit"}, {"oid": "e49ffc489c9277b3d2e4398ffc2510ac2285cc5c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e49ffc489c9277b3d2e4398ffc2510ac2285cc5c", "message": "Add documentation", "committedDate": "2020-02-05T19:14:56Z", "type": "commit"}, {"oid": "85b96d90cb0feb88e43e3da3fd77907c78d78ce9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/85b96d90cb0feb88e43e3da3fd77907c78d78ce9", "message": "Add documentation", "committedDate": "2020-02-05T19:47:06Z", "type": "commit"}, {"oid": "192ee559d0b16e2a53fa0f0ea2ae63544242b8a9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/192ee559d0b16e2a53fa0f0ea2ae63544242b8a9", "message": "Add documentation", "committedDate": "2020-02-05T21:44:04Z", "type": "commit"}, {"oid": "f4778d8df2900490718b2ffd4d3ff8340bc674d7", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f4778d8df2900490718b2ffd4d3ff8340bc674d7", "message": "Add rdd", "committedDate": "2020-02-05T22:34:41Z", "type": "commit"}, {"oid": "78a40fa4767370b18d5e8ae8abe430954f0ce999", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/78a40fa4767370b18d5e8ae8abe430954f0ce999", "message": "Add rdd", "committedDate": "2020-02-05T22:37:49Z", "type": "commit"}, {"oid": "39117dd352cd5a48b43b578871df43b21835a188", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/39117dd352cd5a48b43b578871df43b21835a188", "message": "Add rdd", "committedDate": "2020-02-06T00:01:17Z", "type": "commit"}, {"oid": "223537daa2491eb153fe11210e74e269f603bc45", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/223537daa2491eb153fe11210e74e269f603bc45", "message": "Add rdd", "committedDate": "2020-02-06T00:20:15Z", "type": "commit"}, {"oid": "543df9372da2aa3b9dc326bb3dcc104fc936ff5c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/543df9372da2aa3b9dc326bb3dcc104fc936ff5c", "message": "Fix order by example", "committedDate": "2020-02-12T00:48:01Z", "type": "commit"}, {"oid": "0ecdafdd9bd9bac1852e654147b4735373c529de", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0ecdafdd9bd9bac1852e654147b4735373c529de", "message": "Add more diagrams", "committedDate": "2020-02-12T23:36:13Z", "type": "commit"}, {"oid": "2b534386d29e5efe5808c1be42b4ad8b7493bec8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2b534386d29e5efe5808c1be42b4ad8b7493bec8", "message": "Add more diagrams", "committedDate": "2020-02-13T01:14:37Z", "type": "commit"}, {"oid": "7a957a12431cdfbb71cf00469e97b848330d0956", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7a957a12431cdfbb71cf00469e97b848330d0956", "message": "Skip doctest in gradlew build", "committedDate": "2020-02-13T18:04:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MDg1OA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#discussion_r379070858", "bodyText": "minor, Implement Ordering seems much readable.", "author": "penghuo", "createdAt": "2020-02-13T19:26:43Z", "path": "src/test/java/com/amazon/opendistroforelasticsearch/sql/doctest/core/response/SqlResponseFormat.java", "diffHunk": "@@ -84,4 +73,63 @@ public String format(SqlResponse sqlResponse) {\n      */\n     public abstract String format(SqlResponse sqlResponse);\n \n+    /**\n+     * Note that we put this format() here because it's shared by two format enums.\n+     * @param sqlResponse   original response from plugin\n+     * @param isSorted      true to sort the result or just leave it as is\n+     */\n+    protected String format(SqlResponse sqlResponse, boolean isSorted) {\n+        JSONObject body = new JSONObject(sqlResponse.body());\n+        if (body.isNull(\"schema\")) {\n+            throw new IllegalStateException(\n+                \"Only JDBC response can be formatted to table: \" + sqlResponse.body());\n+        }\n+\n+        Object[] header = parseHeader(body.getJSONArray(\"schema\"));\n+        List<Object[]> rows = parseDataRows(body.getJSONArray(\"datarows\"), isSorted);\n+\n+        DataTable table = new DataTable(header);\n+        for (Object[] row : rows) {\n+            table.addRow(row);\n+        }\n+        return table.toString();\n+    }\n+\n+    private Object[] parseHeader(JSONArray schema) {\n+        Object[] header = new Object[schema.length()];\n+        for (int i = 0; i < header.length; i++) {\n+            JSONObject nameType = schema.getJSONObject(i);\n+            header[i] = nameType.optString(\"alias\", nameType.getString(\"name\"));\n+        }\n+        return header;\n+    }\n+\n+    private List<Object[]> parseDataRows(JSONArray rows, boolean isSorted) {\n+        List<Object[]> rowsToSort = new ArrayList<>();\n+        for (Object row : rows) {\n+            rowsToSort.add(((JSONArray) row).toList().toArray());\n+        }\n+\n+        if (isSorted) {\n+            sort(rowsToSort);\n+        }\n+        return rowsToSort;\n+    }\n+\n+    @SuppressWarnings({\"rawtypes\", \"unchecked\"})", "originalCommit": "7a957a12431cdfbb71cf00469e97b848330d0956", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDMxMjYxMA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/366#discussion_r380312610", "bodyText": "Good suggestion. I tried it out but our case seems different (sorting 2 lists of objects and Ordering only works for object comparison). Will refactor this part if I can find how to covert it to list comparator later. Thanks!", "author": "dai-chen", "createdAt": "2020-02-17T17:56:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA3MDg1OA=="}], "type": "inlineReview", "revised_code": null}]}