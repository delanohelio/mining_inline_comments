{"pr_number": 573, "pr_title": "Support SELECT * and FROM clause in new SQL parser", "pr_createdAt": "2020-07-13T22:41:41Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573", "timeline": [{"oid": "aef681b01ad1ac0f709924b5c3447d9a8afd98ad", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/aef681b01ad1ac0f709924b5c3447d9a8afd98ad", "message": "Support from", "committedDate": "2020-07-07T17:56:24Z", "type": "commit"}, {"oid": "bbb8caa8e674bb7794f6aff338364f117eb8434b", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bbb8caa8e674bb7794f6aff338364f117eb8434b", "message": "Add more UT", "committedDate": "2020-07-07T18:40:57Z", "type": "commit"}, {"oid": "6848f9712bbc8dadaa2d42a006a1d7de6b1cdede", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6848f9712bbc8dadaa2d42a006a1d7de6b1cdede", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-08T21:59:29Z", "type": "commit"}, {"oid": "2d89a3553f4ef4333cda8973119c1846b0136790", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2d89a3553f4ef4333cda8973119c1846b0136790", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-08T22:11:12Z", "type": "commit"}, {"oid": "bde1b51198388911e7f8a07a687f74bd711315ee", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bde1b51198388911e7f8a07a687f74bd711315ee", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-10T20:57:57Z", "type": "commit"}, {"oid": "92fe877d2e5244b29343468ac913a199d6b863e0", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/92fe877d2e5244b29343468ac913a199d6b863e0", "message": "Update doc", "committedDate": "2020-07-13T16:14:12Z", "type": "commit"}, {"oid": "7dc8a0e8806299f635370b7bc6f8f8a214181032", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/7dc8a0e8806299f635370b7bc6f8f8a214181032", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-13T16:17:59Z", "type": "commit"}, {"oid": "683d53bab9fee01afde16f18b1dc279a9869636e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/683d53bab9fee01afde16f18b1dc279a9869636e", "message": "Update doc", "committedDate": "2020-07-13T18:41:44Z", "type": "commit"}, {"oid": "9fffdd0599f163585fae2b6e02f41889cde312f4", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9fffdd0599f163585fae2b6e02f41889cde312f4", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-13T18:49:30Z", "type": "commit"}, {"oid": "ae3d756b89c944a0b2a4a9e16d84ec83bccba812", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ae3d756b89c944a0b2a4a9e16d84ec83bccba812", "message": "Add doctest", "committedDate": "2020-07-13T20:23:40Z", "type": "commit"}, {"oid": "a17651fcbd19b84e785c7b63e393356b24cb23bb", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a17651fcbd19b84e785c7b63e393356b24cb23bb", "message": "Add IT", "committedDate": "2020-07-13T22:17:32Z", "type": "commit"}, {"oid": "af1422f9fa73e5ece00d9932e195b19991786a70", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/af1422f9fa73e5ece00d9932e195b19991786a70", "message": "Change doc and grammar for ANSI SQL", "committedDate": "2020-07-15T00:43:55Z", "type": "commit"}, {"oid": "f32dcb9f4b483ed0b8772d0d9da6c3394454621d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f32dcb9f4b483ed0b8772d0d9da6c3394454621d", "message": "Change doc and grammar", "committedDate": "2020-07-15T18:43:03Z", "type": "commit"}, {"oid": "3f98057f2266a5e0d52580c60d6f30f63e4e6314", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3f98057f2266a5e0d52580c60d6f30f63e4e6314", "message": "Split grammar file", "committedDate": "2020-07-15T18:54:26Z", "type": "commit"}, {"oid": "54d772288d6c94f28358e8a2f727155966953db7", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/54d772288d6c94f28358e8a2f727155966953db7", "message": "Prepare PR", "committedDate": "2020-07-15T22:52:03Z", "type": "commit"}, {"oid": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b6bb2895520c35ad810bbbe6a4f39f6afdd68efa", "message": "Prepare PR", "committedDate": "2020-07-15T23:15:24Z", "type": "commit"}, {"oid": "8b2d2129898464d567d55f84a8a85d1568d34f44", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8b2d2129898464d567d55f84a8a85d1568d34f44", "message": "Run IT with/without new engine", "committedDate": "2020-07-16T17:50:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyODM0OA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#discussion_r456128348", "bodyText": "could you add test with single quota identifier, e.g. SELECT * FROM 'hello+world'", "author": "penghuo", "createdAt": "2020-07-16T23:12:23Z", "path": "sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java", "diffHunk": "@@ -29,13 +28,36 @@\n \n   @Test\n   public void canParseSelectLiterals() {\n-    ParseTree parseTree = parser.parse(\"SELECT 123, 'hello'\");\n-    assertNotNull(parseTree);\n+    assertNotNull(parser.parse(\"SELECT 123, 'hello'\"));\n+  }\n+\n+  @Test\n+  public void canParseIndexNameWithDate() {\n+    assertNotNull(parser.parse(\"SELECT * FROM logs_2020_01\"));\n+    assertNotNull(parser.parse(\"SELECT * FROM logs-2020-01\"));\n+  }\n+\n+  @Test\n+  public void canParseHiddenIndexName() {\n+    assertNotNull(parser.parse(\"SELECT * FROM .kibana\"));\n+  }\n+\n+  @Test\n+  public void canNotParseIndexNameWithSpecialChar() {\n+    assertThrows(SyntaxCheckException.class,\n+        () -> parser.parse(\"SELECT * FROM hello+world\"));\n+  }\n+\n+  @Test\n+  public void canParseIndexNameWithSpecialCharQuoted() {\n+    assertNotNull(parser.parse(\"SELECT * FROM `hello+world`\"));\n+    assertNotNull(parser.parse(\"SELECT * FROM \\\"hello$world\\\"\"));", "originalCommit": "b6bb2895520c35ad810bbbe6a4f39f6afdd68efa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzUzODk0Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/573#discussion_r457538947", "bodyText": "I missed this. Will add test case and change grammar. Thanks!", "author": "dai-chen", "createdAt": "2020-07-20T16:27:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEyODM0OA=="}], "type": "inlineReview", "revised_code": {"commit": "fe867f42f291f818e0313c4b9e034c74bc044ea5", "chunk": "diff --git a/sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java b/sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java\nindex 6a156e66..6d3dee95 100644\n--- a/sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java\n+++ b/sql/src/test/java/com/amazon/opendistroforelasticsearch/sql/sql/antlr/SQLSyntaxParserTest.java\n\n@@ -54,6 +54,18 @@ class SQLSyntaxParserTest {\n     assertNotNull(parser.parse(\"SELECT * FROM \\\"hello$world\\\"\"));\n   }\n \n+  @Test\n+  public void canNotParseIndexNameStartingWithNumber() {\n+    assertThrows(SyntaxCheckException.class,\n+        () -> parser.parse(\"SELECT * FROM 123test\"));\n+  }\n+\n+  @Test\n+  public void canNotParseIndexNameSingleQuoted() {\n+    assertThrows(SyntaxCheckException.class,\n+        () -> parser.parse(\"SELECT * FROM 'test'\"));\n+  }\n+\n   @Test\n   public void canNotParseInvalidSelect() {\n     assertThrows(SyntaxCheckException.class,\n"}}, {"oid": "85c4b051b8751b62f6cda20e5fb021910cb2db55", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/85c4b051b8751b62f6cda20e5fb021910cb2db55", "message": "Address PR comments", "committedDate": "2020-07-20T18:44:45Z", "type": "commit"}, {"oid": "fe867f42f291f818e0313c4b9e034c74bc044ea5", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/fe867f42f291f818e0313c4b9e034c74bc044ea5", "message": "Address PR comments", "committedDate": "2020-07-20T19:07:06Z", "type": "commit"}, {"oid": "e18ee9c91bce002b7139764ddbf12783dc9d7f94", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e18ee9c91bce002b7139764ddbf12783dc9d7f94", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-20T19:23:17Z", "type": "commit"}, {"oid": "6a33e69ce239cd12d6b61fb1611efaf31913a8a2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/6a33e69ce239cd12d6b61fb1611efaf31913a8a2", "message": "Merge branch 'develop' into support-select-all-from", "committedDate": "2020-07-21T17:43:09Z", "type": "commit"}]}