{"pr_number": 694, "pr_title": "Added datetime data type and basic functions for the conversion from string type to date and time types", "pr_createdAt": "2020-08-18T18:54:33Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694", "timeline": [{"oid": "9e4815a0f00aa730cb42224c0bfeff7f25449ea9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/9e4815a0f00aa730cb42224c0bfeff7f25449ea9", "message": "added datetime type, modified date, time, timestamp types, added tests", "committedDate": "2020-08-18T03:36:56Z", "type": "commit"}, {"oid": "cdce3c81dffd3b07cd8fb202db8f306c2063ef72", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/cdce3c81dffd3b07cd8fb202db8f306c2063ef72", "message": "added test", "committedDate": "2020-08-18T18:49:28Z", "type": "commit"}, {"oid": "38f84d05c9a3a725f8c014ada737c4604d72ec5e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/38f84d05c9a3a725f8c014ada737c4604d72ec5e", "message": "Merge remote-tracking branch 'upstream/develop' into dt1", "committedDate": "2020-08-18T20:18:48Z", "type": "commit"}, {"oid": "808e38207e23f5c5f085b94a50f547f32ce51b5d", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/808e38207e23f5c5f085b94a50f547f32ce51b5d", "message": "update", "committedDate": "2020-08-19T01:41:46Z", "type": "commit"}, {"oid": "d4fc48bc5d2dcacb21b56613984e3259f7f80278", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d4fc48bc5d2dcacb21b56613984e3259f7f80278", "message": "update", "committedDate": "2020-08-19T01:51:37Z", "type": "commit"}, {"oid": "71ed2cf5c0e434c6e1058141d52cea6f3be12088", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/71ed2cf5c0e434c6e1058141d52cea6f3be12088", "message": "Added java doc", "committedDate": "2020-08-20T23:03:37Z", "type": "commit"}, {"oid": "72f91bdb3713800bdb2b8e1fc2261e546ed071f0", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/72f91bdb3713800bdb2b8e1fc2261e546ed071f0", "message": "Merge remote-tracking branch 'upstream/develop' into dt1", "committedDate": "2020-08-20T23:09:54Z", "type": "commit"}, {"oid": "832e2e320366cc655eb4b36724de783b0ae604e8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/832e2e320366cc655eb4b36724de783b0ae604e8", "message": "Merge remote-tracking branch 'upstream/develop' into dt1\n\n# Conflicts:\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValue.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java\n#\tcore/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/type/ExprCoreType.java\n#\tcore/src/test/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtilsTest.java", "committedDate": "2020-08-20T23:15:25Z", "type": "commit"}, {"oid": "804d78afaef88efc780ab6925f4a992353623ef1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/804d78afaef88efc780ab6925f4a992353623ef1", "message": "update", "committedDate": "2020-08-21T22:23:05Z", "type": "commit"}, {"oid": "f22e1fc40ecfc13bf628a8a6dc5ed6a0e9bfdc70", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f22e1fc40ecfc13bf628a8a6dc5ed6a0e9bfdc70", "message": "update", "committedDate": "2020-08-22T02:17:36Z", "type": "commit"}, {"oid": "0535ae58f44f3c1d2e38bf87aceed10f2bd911cc", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/0535ae58f44f3c1d2e38bf87aceed10f2bd911cc", "message": "update", "committedDate": "2020-08-24T20:40:18Z", "type": "commit"}, {"oid": "aaf4a1a57308a5afccbc299318816ba3c19ec8ac", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/aaf4a1a57308a5afccbc299318816ba3c19ec8ac", "message": "update", "committedDate": "2020-08-24T20:44:31Z", "type": "commit"}, {"oid": "20315f03227a081c71e178f1379b6ee798348640", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/20315f03227a081c71e178f1379b6ee798348640", "message": "update", "committedDate": "2020-08-25T17:57:45Z", "type": "commit"}, {"oid": "ea7360e195b57c62261bbdb2ad62a5ca8bcadda8", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/ea7360e195b57c62261bbdb2ad62a5ca8bcadda8", "message": "update", "committedDate": "2020-08-25T18:17:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc2NDg4NA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694#discussion_r476764884", "bodyText": "suggest to use exprValue.string() in future to get rid of the static getStringValue method.", "author": "penghuo", "createdAt": "2020-08-25T21:43:11Z", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java", "diffHunk": "@@ -58,4 +135,30 @@ private FunctionResolver dayOfMonth() {\n   private ExprValue exprDayOfMonth(ExprValue date) {\n     return new ExprIntegerValue(getDateValue(date).getMonthValue());\n   }\n+\n+  /**\n+   * Time implementation for ExprValue.\n+   * @param exprValue ExprValue of Time type or String.\n+   * @return ExprValue.\n+   */\n+  private ExprValue exprTime(ExprValue exprValue) {\n+    if (exprValue instanceof ExprStringValue) {\n+      return new ExprTimeValue(getStringValue(exprValue));", "originalCommit": "ea7360e195b57c62261bbdb2ad62a5ca8bcadda8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "23ffebcf409bc10d460892e11fe22f8add0b9e1a", "chunk": "diff --git a/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java b/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java\nindex 849eed4d..0e97d081 100644\n--- a/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java\n+++ b/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/datetime/DateTimeFunction.java\n\n@@ -133,7 +128,7 @@ public class DateTimeFunction {\n    * @return ExprValue.\n    */\n   private ExprValue exprDayOfMonth(ExprValue date) {\n-    return new ExprIntegerValue(getDateValue(date).getMonthValue());\n+    return new ExprIntegerValue(date.dateValue().getMonthValue());\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4MDYzOQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694#discussion_r476780639", "bodyText": "could we get rid of the static method incase we already have the method impl in ExprValue.", "author": "penghuo", "createdAt": "2020-08-25T22:02:18Z", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java", "diffHunk": "@@ -166,12 +173,33 @@ public static Boolean getBooleanValue(ExprValue exprValue) {\n   }\n \n   /**\n-   * Get {@link ZonedDateTime} from ExprValue of Date type.\n+   * Get {@link LocalDate} from ExprValue of Date type.\n    */\n-  public static ZonedDateTime getDateValue(ExprValue exprValue) {\n+  public static LocalDate getDateValue(ExprValue exprValue) {\n     return exprValue.dateValue();\n   }\n \n+  /**\n+   * Get {@link LocalTime} from ExprValue of Time type.\n+   */\n+  public static LocalTime getTimeValue(ExprValue exprValue) {", "originalCommit": "ea7360e195b57c62261bbdb2ad62a5ca8bcadda8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg4MjE2Nw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694#discussion_r476882167", "bodyText": "yes, will remove all similar static methods and use the impl instead", "author": "chloe-zh", "createdAt": "2020-08-25T23:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njc4MDYzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "23ffebcf409bc10d460892e11fe22f8add0b9e1a", "chunk": "diff --git a/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java b/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java\nindex 08718932..3fddbdde 100644\n--- a/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java\n+++ b/core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprValueUtils.java\n\n@@ -171,36 +171,4 @@ public class ExprValueUtils {\n   public static Boolean getBooleanValue(ExprValue exprValue) {\n     return exprValue.booleanValue();\n   }\n-\n-  /**\n-   * Get {@link LocalDate} from ExprValue of Date type.\n-   */\n-  public static LocalDate getDateValue(ExprValue exprValue) {\n-    return exprValue.dateValue();\n-  }\n-\n-  /**\n-   * Get {@link LocalTime} from ExprValue of Time type.\n-   */\n-  public static LocalTime getTimeValue(ExprValue exprValue) {\n-    return exprValue.timeValue();\n-  }\n-\n-  /**\n-   * Get {@link LocalDateTime} from ExprValue of Datetime type.\n-   */\n-  public static LocalDateTime getDatetimeValue(ExprValue exprValue) {\n-    return exprValue.datetimeValue();\n-  }\n-\n-  /**\n-   * Get {@link Instant} from ExprValue of Timestamp type.\n-   */\n-  public static Instant getTimestampValue(ExprValue exprValue) {\n-    return exprValue.timestampValue();\n-  }\n-\n-  public static TemporalAmount getIntervalValue(ExprValue exprValue) {\n-    return exprValue.intervalValue();\n-  }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg1MjY4Mw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694#discussion_r476852683", "bodyText": "Just wonder any reason not use lombok annotation for equal and hashCode?", "author": "dai-chen", "createdAt": "2020-08-25T23:25:18Z", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/data/model/ExprDatetimeValue.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ *   Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *   Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *   You may not use this file except in compliance with the License.\n+ *   A copy of the License is located at\n+ *\n+ *       http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   or in the \"license\" file accompanying this file. This file is distributed\n+ *   on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *   express or implied. See the License for the specific language governing\n+ *   permissions and limitations under the License.\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.data.model;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.type.ExprCoreType;\n+import com.amazon.opendistroforelasticsearch.sql.data.type.ExprType;\n+import com.amazon.opendistroforelasticsearch.sql.exception.SemanticCheckException;\n+import com.google.common.base.Objects;\n+import java.time.Instant;\n+import java.time.LocalDate;\n+import java.time.LocalDateTime;\n+import java.time.LocalTime;\n+import java.time.ZoneId;\n+import java.time.ZonedDateTime;\n+import java.time.format.DateTimeFormatter;\n+import java.time.format.DateTimeParseException;\n+import lombok.RequiredArgsConstructor;\n+\n+@RequiredArgsConstructor\n+public class ExprDatetimeValue extends AbstractExprValue {\n+  private static final DateTimeFormatter formatter = DateTimeFormatter\n+      .ofPattern(\"yyyy-MM-dd HH:mm:ss\");\n+  private final LocalDateTime datetime;\n+\n+  /**\n+   * Constructor with datetime string as input.\n+   */\n+  public ExprDatetimeValue(String datetime) {\n+    try {\n+      this.datetime = LocalDateTime.parse(datetime, formatter);\n+    } catch (DateTimeParseException e) {\n+      throw new SemanticCheckException(String.format(\"datetime:%s in unsupported format, please \"\n+          + \"use yyyy-MM-dd HH:mm:ss\", datetime));\n+    }\n+  }\n+\n+  @Override\n+  public LocalDateTime datetimeValue() {\n+    return datetime;\n+  }\n+\n+  @Override\n+  public LocalDate dateValue() {\n+    return datetime.toLocalDate();\n+  }\n+\n+  @Override\n+  public LocalTime timeValue() {\n+    return datetime.toLocalTime();\n+  }\n+\n+  @Override\n+  public Instant timestampValue() {\n+    return ZonedDateTime.of(datetime, ZoneId.of(\"UTC\")).toInstant();\n+  }\n+\n+  @Override\n+  public int compare(ExprValue other) {\n+    return datetime.compareTo(other.datetimeValue());\n+  }\n+\n+  @Override\n+  public boolean equal(ExprValue other) {\n+    return datetime.equals(other.datetimeValue());\n+  }", "originalCommit": "ea7360e195b57c62261bbdb2ad62a5ca8bcadda8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjkzMzQwNA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/694#discussion_r476933404", "bodyText": "for the equal method, because  it is an implementation of abstract method", "author": "chloe-zh", "createdAt": "2020-08-26T01:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Njg1MjY4Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "23ffebcf409bc10d460892e11fe22f8add0b9e1a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/23ffebcf409bc10d460892e11fe22f8add0b9e1a", "message": "update", "committedDate": "2020-08-26T00:50:51Z", "type": "commit"}, {"oid": "25e3773195be7112c29900152a7630313478834a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/25e3773195be7112c29900152a7630313478834a", "message": "update", "committedDate": "2020-08-26T00:54:23Z", "type": "commit"}]}