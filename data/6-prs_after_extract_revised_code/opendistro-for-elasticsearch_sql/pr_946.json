{"pr_number": 946, "pr_title": "Support aggregate window functions", "pr_createdAt": "2020-12-18T00:45:20Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/946", "timeline": [{"oid": "44c7a51764c921911ac64bc67006592ad52aa8c1", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/44c7a51764c921911ac64bc67006592ad52aa8c1", "message": "Change grammar and AST builder", "committedDate": "2020-12-15T23:32:38Z", "type": "commit"}, {"oid": "4cd76bce98522b45c1dc696479c9ea24d4430213", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4cd76bce98522b45c1dc696479c9ea24d4430213", "message": "Add tostring and getchild for window function AST node", "committedDate": "2020-12-16T00:51:34Z", "type": "commit"}, {"oid": "eefd50d6b27ac3cd6a5c1e6a9f79b835cb7f09ce", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/eefd50d6b27ac3cd6a5c1e6a9f79b835cb7f09ce", "message": "Add aggregate window function class", "committedDate": "2020-12-16T01:05:08Z", "type": "commit"}, {"oid": "95ed0bef8d6ffb1b2d424370f82e0c87bc9a54df", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/95ed0bef8d6ffb1b2d424370f82e0c87bc9a54df", "message": "Add peer window frame and refactor", "committedDate": "2020-12-16T16:49:06Z", "type": "commit"}, {"oid": "b67036fcf6996628ae734d6eb6aacfa3deb620fc", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b67036fcf6996628ae734d6eb6aacfa3deb620fc", "message": "Name window function and optimize it when analysis", "committedDate": "2020-12-16T23:15:15Z", "type": "commit"}, {"oid": "4e7c0ceeeb930f1c0e4b5f54a5cdf6395e0d8c95", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4e7c0ceeeb930f1c0e4b5f54a5cdf6395e0d8c95", "message": "Refactor peer frame by peeking iterator", "committedDate": "2020-12-17T01:56:02Z", "type": "commit"}, {"oid": "b7d6580281e7aabb660a23058f48d5553aae05cd", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/b7d6580281e7aabb660a23058f48d5553aae05cd", "message": "Comparison test", "committedDate": "2020-12-17T02:01:42Z", "type": "commit"}, {"oid": "656779771fa8d0c4356a833bbfabf4fb0f066cd5", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/656779771fa8d0c4356a833bbfabf4fb0f066cd5", "message": "Add doctest", "committedDate": "2020-12-17T22:49:55Z", "type": "commit"}, {"oid": "f937efa11b71a69cb83c86c7e6325416afe7a910", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f937efa11b71a69cb83c86c7e6325416afe7a910", "message": "Add more comparison tests", "committedDate": "2020-12-17T22:50:13Z", "type": "commit"}, {"oid": "4357238e53e003e6867d4dd3ae370c47b634fc93", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4357238e53e003e6867d4dd3ae370c47b634fc93", "message": "Add java doc", "committedDate": "2020-12-17T23:41:54Z", "type": "commit"}, {"oid": "5cae0143da52b0e683819eab7232390d2413bc2f", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/5cae0143da52b0e683819eab7232390d2413bc2f", "message": "Rename and fix broken UT", "committedDate": "2020-12-18T00:01:36Z", "type": "commit"}, {"oid": "99587c629a4edd3935d7322f9908dbb942e378b2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/99587c629a4edd3935d7322f9908dbb942e378b2", "message": "Add more IT", "committedDate": "2020-12-18T00:34:53Z", "type": "commit"}, {"oid": "89ffe710ad7ab3c40e99319745865134258bce76", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/89ffe710ad7ab3c40e99319745865134258bce76", "message": "Add design doc", "committedDate": "2020-12-18T01:27:29Z", "type": "commit"}, {"oid": "8d29ffce074f4fe80a242fd967144f9c432067cc", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/8d29ffce074f4fe80a242fd967144f9c432067cc", "message": "Prepare PR", "committedDate": "2020-12-18T19:43:48Z", "type": "commit"}, {"oid": "464109f5610fe473f19674b1f5edddf691062de2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/464109f5610fe473f19674b1f5edddf691062de2", "message": "Fix no sort key bug", "committedDate": "2020-12-19T01:30:08Z", "type": "commit"}, {"oid": "1ec79c160cf3507a3580a9d628508abb2c5a6c50", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1ec79c160cf3507a3580a9d628508abb2c5a6c50", "message": "Merge branch 'develop' into support-aggregate-window-functions-2", "committedDate": "2021-01-05T18:58:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI2MDYyOQ==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/946#discussion_r552260629", "bodyText": "Could we use PeerRowsWindowFrame in here?", "author": "penghuo", "createdAt": "2021-01-05T23:31:30Z", "path": "core/src/main/java/com/amazon/opendistroforelasticsearch/sql/expression/window/ranking/DenseRankFunction.java", "diffHunk": "@@ -30,7 +30,7 @@ public DenseRankFunction() {\n   }\n \n   @Override\n-  protected int rank(CumulativeWindowFrame frame) {\n+  protected int rank(CurrentRowWindowFrame frame) {", "originalCommit": "1ec79c160cf3507a3580a9d628508abb2c5a6c50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1Mjk2OTk4MA==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/946#discussion_r552969980", "bodyText": "I just dived into the code and it looks doable. Conceptually, RANK and DENSE_RANK share same meaning of \"current row\" and thus can use peer window frame. But I think we'd better use this minimal window frame for now to avoid potential data preload. We can revisit and refactor this later if necessary. Thanks!", "author": "dai-chen", "createdAt": "2021-01-06T21:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjI2MDYyOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "012ea5e6a79c60673db1429d72a18f052c21959e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/012ea5e6a79c60673db1429d72a18f052c21959e", "message": "Merge branch 'develop' into support-aggregate-window-functions-2", "committedDate": "2021-01-07T18:09:58Z", "type": "commit"}, {"oid": "59c758291adc56e9c62be3648e07b918b8741747", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/59c758291adc56e9c62be3648e07b918b8741747", "message": "Change README", "committedDate": "2021-01-07T18:10:49Z", "type": "commit"}]}