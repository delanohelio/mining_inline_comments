{"pr_number": 671, "pr_title": "Lucene query pushdown optimization", "pr_createdAt": "2020-08-07T21:20:50Z", "pr_url": "https://github.com/opendistro-for-elasticsearch/sql/pull/671", "timeline": [{"oid": "4ec92ab9954b1173aece543f119f9e4a6de27d3b", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/4ec92ab9954b1173aece543f119f9e4a6de27d3b", "message": "Add lucene builder interface and term query impl", "committedDate": "2020-08-11T15:52:55Z", "type": "commit"}, {"oid": "f666886b39b82c6990e6010334b62c5ee12db4a2", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/f666886b39b82c6990e6010334b62c5ee12db4a2", "message": "Add lucene query interface and term query impl", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "1a332fa4997ea297bf098315218c49d55eb7924b", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1a332fa4997ea297bf098315218c49d55eb7924b", "message": "Add range query impl", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "e95041264648b8a71f7e1a58a1a1291a682fd3aa", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/e95041264648b8a71f7e1a58a1a1291a682fd3aa", "message": "Add more UT for range query", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "a2dcde417fb70bcc640e64709dbd9c1566dec81e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/a2dcde417fb70bcc640e64709dbd9c1566dec81e", "message": "Add wildcard query impl", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "40e659b8ae745d4cb9ad39cf59cc229688027570", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/40e659b8ae745d4cb9ad39cf59cc229688027570", "message": "Add exists query impl", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "d47881083e517ddc4f990d25ab67fbe1ab7a9acb", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d47881083e517ddc4f990d25ab67fbe1ab7a9acb", "message": "Pass jacoco test", "committedDate": "2020-08-11T15:55:03Z", "type": "commit"}, {"oid": "d47881083e517ddc4f990d25ab67fbe1ab7a9acb", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/d47881083e517ddc4f990d25ab67fbe1ab7a9acb", "message": "Pass jacoco test", "committedDate": "2020-08-11T15:55:03Z", "type": "forcePushed"}, {"oid": "2f347b011ace1a0c6fcb253c8350bf40ad87d513", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/2f347b011ace1a0c6fcb253c8350bf40ad87d513", "message": "Prepare PR", "committedDate": "2020-08-11T16:13:08Z", "type": "commit"}, {"oid": "24b5e1a0b251e6707c5ed4f97ec207148e8bf28e", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/24b5e1a0b251e6707c5ed4f97ec207148e8bf28e", "message": "Only push down filter close to relation", "committedDate": "2020-08-13T14:38:47Z", "type": "commit"}, {"oid": "366f42ccc472a74a09bd0a2fba27413ba6dc4aae", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/366f42ccc472a74a09bd0a2fba27413ba6dc4aae", "message": "Prepare PR", "committedDate": "2020-08-13T18:36:57Z", "type": "commit"}, {"oid": "3a0053e128f21969d16974c80ecd14bb0e35c45a", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/3a0053e128f21969d16974c80ecd14bb0e35c45a", "message": "Merge branch 'develop' into lucene-pushdown-optimization", "committedDate": "2020-08-13T18:46:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxODQzMg==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/671#discussion_r470918432", "bodyText": "could you add doc for this limitation?", "author": "penghuo", "createdAt": "2020-08-15T01:03:19Z", "path": "elasticsearch/src/main/java/com/amazon/opendistroforelasticsearch/sql/elasticsearch/storage/script/filter/lucene/TermQuery.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ *    Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ *    Licensed under the Apache License, Version 2.0 (the \"License\").\n+ *    You may not use this file except in compliance with the License.\n+ *    A copy of the License is located at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *    or in the \"license\" file accompanying this file. This file is distributed\n+ *    on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ *    express or implied. See the License for the specific language governing\n+ *    permissions and limitations under the License.\n+ *\n+ */\n+\n+package com.amazon.opendistroforelasticsearch.sql.elasticsearch.storage.script.filter.lucene;\n+\n+import static com.amazon.opendistroforelasticsearch.sql.elasticsearch.data.type.ElasticsearchDataType.ES_TEXT_KEYWORD;\n+\n+import com.amazon.opendistroforelasticsearch.sql.data.model.ExprValue;\n+import com.amazon.opendistroforelasticsearch.sql.data.type.ExprType;\n+import org.elasticsearch.index.query.QueryBuilder;\n+import org.elasticsearch.index.query.QueryBuilders;\n+\n+/**\n+ * Lucene query that build term query for equality comparison.\n+ */\n+public class TermQuery extends LuceneQuery {\n+\n+  @Override\n+  protected QueryBuilder doBuild(String fieldName, ExprType fieldType, ExprValue literal) {\n+    if (fieldType == ES_TEXT_KEYWORD) { // Assume inner field name is always \"keyword\"", "originalCommit": "3a0053e128f21969d16974c80ecd14bb0e35c45a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY2OTE3Mw==", "url": "https://github.com/opendistro-for-elasticsearch/sql/pull/671#discussion_r471669173", "bodyText": "Good idea! Added a limitation folder with a single doc for now. Copy-pasted the up-to-date content from ODFE doc. Will make it doctest with example in explain API PR. Thanks!\n\nMySQL reference: https://dev.mysql.com/doc/mysql-reslimits-excerpt/8.0/en/\nODFE doc: https://opendistro.github.io/for-elasticsearch-docs/docs/sql/limitation/\nNew limitation doc: https://github.com/dai-chen/sql/blob/lucene-pushdown-optimization/docs/user/limitations/limitations.rst", "author": "dai-chen", "createdAt": "2020-08-17T18:07:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxODQzMg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1f0793b72fef56b704e4aa264b04c0e62265f94f", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/1f0793b72fef56b704e4aa264b04c0e62265f94f", "message": "Merge branch 'develop' into lucene-pushdown-optimization", "committedDate": "2020-08-17T16:09:31Z", "type": "commit"}, {"oid": "38e93680dac15e1ad0c0acc29980b5be9f80e20c", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/38e93680dac15e1ad0c0acc29980b5be9f80e20c", "message": "Add limitation doc", "committedDate": "2020-08-17T17:53:02Z", "type": "commit"}, {"oid": "284433334cb025a5e5b5013838fad3296e0325e9", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/284433334cb025a5e5b5013838fad3296e0325e9", "message": "Add limitation doc", "committedDate": "2020-08-17T18:02:25Z", "type": "commit"}, {"oid": "bdfba87ab5732f561e40c692eb31cd47a82c0943", "url": "https://github.com/opendistro-for-elasticsearch/sql/commit/bdfba87ab5732f561e40c692eb31cd47a82c0943", "message": "Add limitation doc", "committedDate": "2020-08-17T18:03:41Z", "type": "commit"}]}