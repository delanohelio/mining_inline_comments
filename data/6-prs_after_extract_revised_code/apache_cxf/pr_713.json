{"pr_number": 713, "pr_title": "CXF-8359: fixed mask for XML elements containing attributes", "pr_createdAt": "2020-10-25T12:06:34Z", "pr_url": "https://github.com/apache/cxf/pull/713", "timeline": [{"oid": "2f4a36ea8ab2c23b8ccfd9522a948b5aca3fe39c", "url": "https://github.com/apache/cxf/commit/2f4a36ea8ab2c23b8ccfd9522a948b5aca3fe39c", "message": "CXF-8359: fixed mask for XML elements containing attributes", "committedDate": "2020-10-25T12:03:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYxOTcxMw==", "url": "https://github.com/apache/cxf/pull/713#discussion_r511619713", "bodyText": "Why this condition was removed? It is exactly what will be returned on line https://github.com/apache/cxf/pull/713/files#diff-042c9128e111e120c63cbb7404cdc5d2d2e3c4377b40e01c097d4b8e7315191dR80 but with unnecessary use of Optional::ofNullable(message)?", "author": "reta", "createdAt": "2020-10-25T16:37:25Z", "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java", "diffHunk": "@@ -70,15 +71,19 @@ public String maskSensitiveElements(\n             final Message message,\n             final String originalLogString) {\n         if (replacementsXML.isEmpty() && replacementsJSON.isEmpty()\n-                || message == null", "originalCommit": "2f4a36ea8ab2c23b8ccfd9522a948b5aca3fe39c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ5NDQ5Ng==", "url": "https://github.com/apache/cxf/pull/713#discussion_r515494496", "bodyText": "The statement \"contentType = Optional.ofNullable(message).map(m -> (String) m.get(Message.CONTENT_TYPE))\" handles null message out of the box. Null check on top is redundant. The contentType must be checked on null as well", "author": "ashakirin", "createdAt": "2020-10-31T12:53:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYxOTcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTUwNDY4MQ==", "url": "https://github.com/apache/cxf/pull/713#discussion_r515504681", "bodyText": "That is correct, so the question becomes: why do you need Optional at all? With the previous check in place, just:\nfinal String contentType = (String) m.get(Message.CONTENT_TYPE));\nif (contentType  == null) {\n      return originalLogString;\n}\n\nIt looks as straightforward as it gets (no need to create unnecessary instances).", "author": "reta", "createdAt": "2020-10-31T14:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYxOTcxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjM0MDgxMg==", "url": "https://github.com/apache/cxf/pull/713#discussion_r516340812", "bodyText": "Matter of taste, for me Optional alternative is a bit compacter", "author": "ashakirin", "createdAt": "2020-11-02T23:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTYxOTcxMw=="}], "type": "inlineReview", "revised_code": {"commit": "9a53209683921b860e4c13e8418e37534f2ad4ab", "chunk": "diff --git a/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java b/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java\nindex f9cf1a9303..51361a9262 100644\n--- a/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java\n+++ b/rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java\n\n@@ -71,15 +70,14 @@ public class MaskSensitiveHelper {\n             final Message message,\n             final String originalLogString) {\n         if (replacementsXML.isEmpty() && replacementsJSON.isEmpty()\n-                || originalLogString == null) {\n+                || originalLogString == null || message == null) {\n             return originalLogString;\n         }\n-        final Optional<String> contentType = Optional.ofNullable(message)\n-                .map(m -> (String) m.get(Message.CONTENT_TYPE));\n-        if (!contentType.isPresent()) {\n+        final String contentType = (String) message.get(Message.CONTENT_TYPE);\n+        if (contentType == null) {\n             return originalLogString;\n         }\n-        final String lowerCaseContentType = contentType.get().toLowerCase();\n+        final String lowerCaseContentType = contentType.toLowerCase();\n         if (lowerCaseContentType.contains(XML_CONTENT)\n                 || lowerCaseContentType.contains(HTML_CONTENT)) {\n             return applyMasks(originalLogString, replacementsXML);\n"}}, {"oid": "9a53209683921b860e4c13e8418e37534f2ad4ab", "url": "https://github.com/apache/cxf/commit/9a53209683921b860e4c13e8418e37534f2ad4ab", "message": "CXF-8359: updated null checks", "committedDate": "2020-11-03T00:02:02Z", "type": "commit"}]}