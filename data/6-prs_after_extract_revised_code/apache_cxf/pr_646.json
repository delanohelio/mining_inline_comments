{"pr_number": 646, "pr_title": "CXF-8229 OAuth 2.0 Dynamic Client Registration: Client Update Request", "pr_createdAt": "2020-03-02T14:11:15Z", "pr_url": "https://github.com/apache/cxf/pull/646", "timeline": [{"oid": "5a95b98c7bbac3454dc1e57d499c1b384131dc7f", "url": "https://github.com/apache/cxf/commit/5a95b98c7bbac3454dc1e57d499c1b384131dc7f", "message": "CXF-8229 OAuth 2.0 Dynamic Client Registration: Client Update Request", "committedDate": "2020-03-02T14:09:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNDk1MQ==", "url": "https://github.com/apache/cxf/pull/646#discussion_r388334951", "bodyText": "Could you add a test to make sure it's not possible to \"put\" (or delete actually, GET is already covered) without specifying an access token?", "author": "coheigea", "createdAt": "2020-03-05T14:40:07Z", "path": "systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCDynamicRegistrationTest.java", "diffHunk": "@@ -237,17 +212,63 @@ public void testRegisterClientInitialAccessTokenCodeGrantTls() throws Exception\n         assertEquals(200, wc.delete().getStatus());\n     }\n \n+    @org.junit.Test\n+    public void testUpdateClient() throws Exception {", "originalCommit": "5a95b98c7bbac3454dc1e57d499c1b384131dc7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3Mzg2OQ==", "url": "https://github.com/apache/cxf/pull/646#discussion_r388473869", "bodyText": "ok", "author": "amarkevich", "createdAt": "2020-03-05T18:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNDk1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "d9a8ac096f7e5ee9cabec910b697d71e90903257", "chunk": "diff --git a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCDynamicRegistrationTest.java b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCDynamicRegistrationTest.java\nindex db550776fc..ea5393f3ff 100644\n--- a/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCDynamicRegistrationTest.java\n+++ b/systests/rs-security/src/test/java/org/apache/cxf/systest/jaxrs/security/oidc/OIDCDynamicRegistrationTest.java\n\n@@ -221,24 +222,33 @@ public class OIDCDynamicRegistrationTest extends AbstractBusClientServerTestBase\n             .accept(\"application/json\").type(\"application/json\")\n             .authorization(new ClientAccessToken(OAuthConstants.BEARER_AUTHORIZATION_SCHEME, ACCESS_TOKEN));\n \n-        ClientRegistration reg = newClientRegistrationCodeGrant();\n-        ClientRegistrationResponse resp = wc.post(reg, ClientRegistrationResponse.class);\n+        final ClientRegistration reg = newClientRegistrationCodeGrant();\n+        final ClientRegistrationResponse clientRegistrationResponse = wc\n+            .post(reg, ClientRegistrationResponse.class);\n \n-        String regAccessToken = resp.getRegistrationAccessToken();\n+        final String regAccessToken = clientRegistrationResponse.getRegistrationAccessToken();\n         assertNotNull(regAccessToken);\n \n         reg.setScope(OidcUtils.getEmailScope());\n-        ClientRegistration clientRegResp = wc.path(resp.getClientId())\n+        final ClientRegistration updatedClientRegistration = wc.path(clientRegistrationResponse.getClientId())\n             .authorization(new ClientAccessToken(OAuthConstants.BEARER_AUTHORIZATION_SCHEME, regAccessToken))\n             .put(reg, ClientRegistration.class);\n \n-        assertEquals(OidcUtils.getEmailScope(), clientRegResp.getScope());\n+        assertEquals(OidcUtils.getEmailScope(), updatedClientRegistration.getScope());\n         // https://tools.ietf.org/html/rfc7592#section-2.2\n-        assertNull(clientRegResp.getProperty(\"registration_access_token\"));\n-        assertNull(clientRegResp.getProperty(\"registration_client_uri\"));\n-        assertNull(clientRegResp.getProperty(\"client_secret_expires_at\"));\n-        assertNull(clientRegResp.getProperty(\"client_id_issued_at\"));\n+        assertNull(updatedClientRegistration.getProperty(\"registration_access_token\"));\n+        assertNull(updatedClientRegistration.getProperty(\"registration_client_uri\"));\n+        assertNull(updatedClientRegistration.getProperty(\"client_secret_expires_at\"));\n+        assertNull(updatedClientRegistration.getProperty(\"client_id_issued_at\"));\n+\n+        wc.authorization(null);\n+\n+        assertEquals(Status.UNAUTHORIZED.getStatusCode(),\n+            wc.put(reg).getStatus());\n+        assertEquals(Status.UNAUTHORIZED.getStatusCode(),\n+            wc.delete().getStatus());\n \n+        wc.authorization(new ClientAccessToken(OAuthConstants.BEARER_AUTHORIZATION_SCHEME, regAccessToken));\n         assertEquals(200, wc.delete().getStatus());\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNTE1OA==", "url": "https://github.com/apache/cxf/pull/646#discussion_r388335158", "bodyText": "What's the reason behind this change?", "author": "coheigea", "createdAt": "2020-03-05T14:40:27Z", "path": "rt/rs/security/oauth-parent/oauth2/src/main/java/org/apache/cxf/rs/security/oauth2/utils/OAuthUtils.java", "diffHunk": "@@ -429,6 +429,6 @@ public static SignatureAlgorithm getClientSecretSignatureAlgorithm(Properties si\n     }\n \n     public static String convertListOfScopesToString(List<String> registeredScopes) {\n-        return String.join(\", \", registeredScopes);\n+        return String.join(\" \", registeredScopes);", "originalCommit": "5a95b98c7bbac3454dc1e57d499c1b384131dc7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3NjI2MA==", "url": "https://github.com/apache/cxf/pull/646#discussion_r388476260", "bodyText": "https://tools.ietf.org/html/rfc7591#section-4.1.2\n\no  Client Metadata Name: \"scope\"\no  Client Metadata Description: Space-separated list of OAuth 2.0\nscope values", "author": "amarkevich", "createdAt": "2020-03-05T18:21:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODMzNTE1OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6951a24dafb171e2d71aa71c6e626cd7cc93904a", "url": "https://github.com/apache/cxf/commit/6951a24dafb171e2d71aa71c6e626cd7cc93904a", "message": "Merge remote-tracking branch 'origin/master' into CXF-8229", "committedDate": "2020-03-05T19:10:57Z", "type": "commit"}, {"oid": "d9a8ac096f7e5ee9cabec910b697d71e90903257", "url": "https://github.com/apache/cxf/commit/d9a8ac096f7e5ee9cabec910b697d71e90903257", "message": "add negative test cases", "committedDate": "2020-03-05T19:30:16Z", "type": "commit"}]}