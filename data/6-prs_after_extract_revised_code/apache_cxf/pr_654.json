{"pr_number": 654, "pr_title": "CXF-8242: Stop blocking executor thread on microprofile rest asynchronous call", "pr_createdAt": "2020-03-22T00:35:07Z", "pr_url": "https://github.com/apache/cxf/pull/654", "timeline": [{"oid": "02ab15ffa6dbc72f73c1632ad0600be769ae4942", "url": "https://github.com/apache/cxf/commit/02ab15ffa6dbc72f73c1632ad0600be769ae4942", "message": "CXF-8242: Stop blocking executor thread on microprofile rest asynchronous call", "committedDate": "2020-03-26T01:25:05Z", "type": "forcePushed"}, {"oid": "83aed8cf371d94c5add039405ab1d385f1f4bcd3", "url": "https://github.com/apache/cxf/commit/83aed8cf371d94c5add039405ab1d385f1f4bcd3", "message": "CXF-8242: Stop blocking executor thread on microprofile rest asynchronous call", "committedDate": "2020-03-26T03:05:41Z", "type": "forcePushed"}, {"oid": "2f8bde23d871977d26eb28a14bec75a62045e827", "url": "https://github.com/apache/cxf/commit/2f8bde23d871977d26eb28a14bec75a62045e827", "message": "CXF-8242: Stop blocking executor thread on microprofile rest asynchronous call", "committedDate": "2020-03-28T14:35:07Z", "type": "commit"}, {"oid": "2f8bde23d871977d26eb28a14bec75a62045e827", "url": "https://github.com/apache/cxf/commit/2f8bde23d871977d26eb28a14bec75a62045e827", "message": "CXF-8242: Stop blocking executor thread on microprofile rest asynchronous call", "committedDate": "2020-03-28T14:35:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzMxNg==", "url": "https://github.com/apache/cxf/pull/654#discussion_r399693316", "bodyText": "Is it possible for the tests to inherit from the ClientCallbackTest?  There might be subtle differences that I'm missing, but it might be nice to consolidate a lot of this test code in the base test class and then have the other tests (Jaxws, Jaxrs, MP, etc.) just offer their own sub-class instance of the callback.", "author": "andymc12", "createdAt": "2020-03-28T18:23:31Z", "path": "rt/frontend/jaxws/src/test/java/org/apache/cxf/jaxws/JaxwsClientCallbackTest.java", "diffHunk": "@@ -0,0 +1,162 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.jaxws;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.concurrent.CyclicBarrier;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.ScheduledExecutorService;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import javax.xml.ws.AsyncHandler;\n+import javax.xml.ws.Response;\n+\n+import org.apache.cxf.message.MessageImpl;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static org.hamcrest.CoreMatchers.equalTo;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.Assert.assertThrows;\n+\n+public class JaxwsClientCallbackTest {\n+    private Map<String, Object> ctx;\n+    private JaxwsClientCallback<String> callback;\n+    private AsyncHandler<String> handler;\n+    private ScheduledExecutorService executor;\n+    \n+    @Before\n+    public void setUp() {\n+        executor = Executors.newSingleThreadScheduledExecutor();\n+        handler = new AsyncHandler<String>() {\n+            @Override\n+            public void handleResponse(Response<String> res) {\n+            }\n+        };\n+        \n+        callback = new JaxwsClientCallback<String>(handler, null);\n+        ctx = new HashMap<String, Object>();\n+    }\n+    \n+    @After\n+    public void tearDown() throws Exception {\n+        executor.shutdown();\n+        executor.awaitTermination(5, TimeUnit.SECONDS);\n+    }\n+    \n+    @Test\n+    public void testHandleResponseCallback() throws Exception {", "originalCommit": "2f8bde23d871977d26eb28a14bec75a62045e827", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5ODA2OQ==", "url": "https://github.com/apache/cxf/pull/654#discussion_r399698069", "bodyText": "Thanks @andymc12, makes perfect sense, I will consolidate them in order to reduce the duplication of test code.", "author": "reta", "createdAt": "2020-03-28T19:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcwMTY2MA==", "url": "https://github.com/apache/cxf/pull/654#discussion_r399701660", "bodyText": "Hm ... turned out to be more complicated than I thought. This is a test code and each callback is in different module (cfx-core, cxf-rt-client, cxf-mp-client, cxf-jaxws-frontend). I could move all of them the systests but the tests really belong to the its module (where callbacks live).", "author": "reta", "createdAt": "2020-03-28T19:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcxNzEyNw==", "url": "https://github.com/apache/cxf/pull/654#discussion_r399717127", "bodyText": "No worries. I wondered if that would be an issue.  And I agree with you that the right place for these tests is in the module with the runtime code that they test.  Thanks for putting this together!", "author": "andymc12", "createdAt": "2020-03-28T22:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcyNTI5Mg==", "url": "https://github.com/apache/cxf/pull/654#discussion_r399725292", "bodyText": "\ud83d\udc4d", "author": "reta", "createdAt": "2020-03-29T00:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzMxNg=="}], "type": "inlineReview", "revised_code": null}]}