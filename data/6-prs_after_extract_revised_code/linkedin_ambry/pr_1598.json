{"pr_number": 1598, "pr_title": "Log more about router operation time out error", "pr_createdAt": "2020-08-04T21:38:42Z", "pr_url": "https://github.com/linkedin/ambry/pull/1598", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466045749", "bodyText": "deleteRequest should be able to get blob id, this may be worthwhile to log.\nSame for replica id.", "author": "jsjtzyy", "createdAt": "2020-08-05T22:47:52Z", "path": "ambry-router/src/main/java/com/github/ambry/router/DeleteOperation.java", "diffHunk": "@@ -176,7 +176,9 @@ void handleResponse(ResponseInfo responseInfo, DeleteResponse deleteResponse) {\n     if (responseInfo.getError() != null) {\n       logger.trace(\"DeleteRequest with response correlationId {} timed out for replica {} \",\n           deleteRequest.getCorrelationId(), replica.getDataNodeId());\n-      onErrorResponse(replica, new RouterException(\"Operation timed out\", RouterErrorCode.OperationTimedOut));\n+      onErrorResponse(replica, new RouterException(\n+          \"Operation timed out because of \" + responseInfo.getError() + \" at DataNode \" + responseInfo.getDataNode(),\n+          RouterErrorCode.OperationTimedOut));", "originalCommit": "0edfb14d1dc82c5992684a5b256193e7948fe2a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MTE0Nw==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466071147", "bodyText": "you mean log out the blob id and replica id?", "author": "justinlin-linkedin", "createdAt": "2020-08-06T00:08:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3MTQwOQ==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466071409", "bodyText": "yes", "author": "jsjtzyy", "createdAt": "2020-08-06T00:09:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3NDIxNQ==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466074215", "bodyText": "replica id is the same ad datanode here so I just log out blob id.", "author": "justinlin-linkedin", "createdAt": "2020-08-06T00:20:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3NzA4NQ==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466077085", "bodyText": "actually replicaId contains datanode info but datanode has no info about replica", "author": "jsjtzyy", "createdAt": "2020-08-06T00:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3ODQzNA==", "url": "https://github.com/linkedin/ambry/pull/1598#discussion_r466078434", "bodyText": "I mean we only want to know which host failed, datanode can provide that info.", "author": "justinlin-linkedin", "createdAt": "2020-08-06T00:35:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA0NTc0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f5a311df761bac80f47fdadb3870456090579bcd", "chunk": "diff --git a/ambry-router/src/main/java/com/github/ambry/router/DeleteOperation.java b/ambry-router/src/main/java/com/github/ambry/router/DeleteOperation.java\nindex 4609143d8..a0bfd1ada 100644\n--- a/ambry-router/src/main/java/com/github/ambry/router/DeleteOperation.java\n+++ b/ambry-router/src/main/java/com/github/ambry/router/DeleteOperation.java\n\n@@ -177,8 +177,8 @@ class DeleteOperation {\n       logger.trace(\"DeleteRequest with response correlationId {} timed out for replica {} \",\n           deleteRequest.getCorrelationId(), replica.getDataNodeId());\n       onErrorResponse(replica, new RouterException(\n-          \"Operation timed out because of \" + responseInfo.getError() + \" at DataNode \" + responseInfo.getDataNode(),\n-          RouterErrorCode.OperationTimedOut));\n+          \"Operation to delete \" + blobId + \" timed out because of \" + responseInfo.getError() + \" at DataNode \"\n+              + responseInfo.getDataNode(), RouterErrorCode.OperationTimedOut));\n     } else {\n       if (deleteResponse == null) {\n         logger.trace(\n"}}, {"oid": "7bbfc911f634fe5c1c15af9952eeffee11c13c2f", "url": "https://github.com/linkedin/ambry/commit/7bbfc911f634fe5c1c15af9952eeffee11c13c2f", "message": "Log more about router operation time out error", "committedDate": "2020-08-06T00:07:57Z", "type": "commit"}, {"oid": "f5a311df761bac80f47fdadb3870456090579bcd", "url": "https://github.com/linkedin/ambry/commit/f5a311df761bac80f47fdadb3870456090579bcd", "message": "Comments", "committedDate": "2020-08-06T00:19:21Z", "type": "commit"}, {"oid": "f5a311df761bac80f47fdadb3870456090579bcd", "url": "https://github.com/linkedin/ambry/commit/f5a311df761bac80f47fdadb3870456090579bcd", "message": "Comments", "committedDate": "2020-08-06T00:19:21Z", "type": "forcePushed"}]}