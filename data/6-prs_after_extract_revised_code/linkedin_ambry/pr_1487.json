{"pr_number": 1487, "pr_title": "Return http status conflict when blob is undeleted or not deleted in undelete operation", "pr_createdAt": "2020-04-24T23:30:59Z", "pr_url": "https://github.com/linkedin/ambry/pull/1487", "timeline": [{"oid": "92fe8668cc18d8191dbb9010ecec80ceb9bd77a1", "url": "https://github.com/linkedin/ambry/commit/92fe8668cc18d8191dbb9010ecec80ceb9bd77a1", "message": "Return http status conflict when blob is undeleted or not deleted in undelete operation", "committedDate": "2020-04-24T23:29:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NTcyNA==", "url": "https://github.com/linkedin/ambry/pull/1487#discussion_r415985724", "bodyText": "Why is LifeVersionConflict counted as an InternalServerError? does this error code mean that the operation has to be retried after replication converges?", "author": "cgtz", "createdAt": "2020-04-27T16:58:24Z", "path": "ambry-api/src/main/java/com/github/ambry/rest/RestServiceErrorCode.java", "diffHunk": "@@ -199,8 +204,12 @@ public static RestServiceErrorCode getRestServiceErrorCode(RouterErrorCode route\n         return ServiceUnavailable;\n       case InsufficientCapacity:\n         return InsufficientCapacity;\n+      case BlobUndeleted:\n+      case BlobNotDeleted:\n+        return Conflict;\n       case UnexpectedInternalError:\n       case ChannelClosed:\n+      case LifeVersionConflict:", "originalCommit": "92fe8668cc18d8191dbb9010ecec80ceb9bd77a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIzNTUwOA==", "url": "https://github.com/linkedin/ambry/pull/1487#discussion_r416235508", "bodyText": "First of all it's not a client error for sure. If we see this, then something is wrong with delete and undelete operations. Maybe we have some delete operations performed between undeletes. I would not recommend a retry if we see this, we should try to figure out what happened first.", "author": "justinlin-linkedin", "createdAt": "2020-04-28T00:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NTcyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY2OTkzOQ==", "url": "https://github.com/linkedin/ambry/pull/1487#discussion_r421669939", "bodyText": "Thanks for the explanation. I thought that it would equate to a conflict http status at first", "author": "cgtz", "createdAt": "2020-05-07T17:25:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NTcyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NTE0NA==", "url": "https://github.com/linkedin/ambry/pull/1487#discussion_r421675144", "bodyText": "Add some comments to explain why it's InternalServerError ?", "author": "zzmao", "createdAt": "2020-05-07T17:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NTcyNA=="}], "type": "inlineReview", "revised_code": null}]}