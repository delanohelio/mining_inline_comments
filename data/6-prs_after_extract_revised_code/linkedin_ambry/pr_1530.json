{"pr_number": 1530, "pr_title": "Fix a test failure where delete request arrives after undelete", "pr_createdAt": "2020-05-21T20:48:02Z", "pr_url": "https://github.com/linkedin/ambry/pull/1530", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0NTE5OA==", "url": "https://github.com/linkedin/ambry/pull/1530#discussion_r429045198", "bodyText": "not needed?", "author": "zzmao", "createdAt": "2020-05-22T05:10:21Z", "path": "ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java", "diffHunk": "@@ -141,6 +142,7 @@ void checkOperationChains(List<OperationChain> opChains) throws Exception {\n         partitionCount.put(partitionId, count + 1);\n       }\n     }\n+    /*", "originalCommit": "0397ca77ae14999cd477ea8127319ecfed7f9c3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3MzI2MA==", "url": "https://github.com/linkedin/ambry/pull/1530#discussion_r429373260", "bodyText": "I don't think this part of test is necessary. This test that newly created blobs are not created mostly in one partition. It tests the randomness of partition assignment. There is always a change that all the blobs are created in one partition if we don't somehow force it out.", "author": "justinlin-linkedin", "createdAt": "2020-05-22T17:35:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA0NTE5OA=="}], "type": "inlineReview", "revised_code": {"commit": "9c3595197c995bc55a125d5bdf31bbfe840a04ff", "chunk": "diff --git a/ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java b/ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java\nindex 08ef0a62b..4a5632c0c 100644\n--- a/ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java\n+++ b/ambry-server/src/integration-test/java/com/github/ambry/server/RouterServerTestFramework.java\n\n@@ -142,17 +142,6 @@ class RouterServerTestFramework {\n         partitionCount.put(partitionId, count + 1);\n       }\n     }\n-    /*\n-    double numPartitions = clusterMap.getWritablePartitionIds(null).size();\n-    if (opChains.size() > numPartitions) {\n-      double blobBalanceThreshold = BALANCE_FACTOR * Math.ceil(blobsPut / numPartitions);\n-      for (Map.Entry<PartitionId, Integer> entry : partitionCount.entrySet()) {\n-        Assert.assertTrue(\"Number of blobs is \" + entry.getValue() + \" on partition: \" + entry.getKey()\n-                + \", which is greater than the threshold of \" + blobBalanceThreshold,\n-            entry.getValue() <= blobBalanceThreshold);\n-      }\n-    }\n-     */\n   }\n \n   /**\n"}}, {"oid": "9c3595197c995bc55a125d5bdf31bbfe840a04ff", "url": "https://github.com/linkedin/ambry/commit/9c3595197c995bc55a125d5bdf31bbfe840a04ff", "message": "Remove comments", "committedDate": "2020-05-22T19:55:39Z", "type": "forcePushed"}, {"oid": "c8cff50f32801c33b560fe160252263c9bb88e6d", "url": "https://github.com/linkedin/ambry/commit/c8cff50f32801c33b560fe160252263c9bb88e6d", "message": "Remove comments", "committedDate": "2020-05-25T20:24:45Z", "type": "forcePushed"}, {"oid": "efe79e8b52ae713a32097813ce5012e59ba56888", "url": "https://github.com/linkedin/ambry/commit/efe79e8b52ae713a32097813ce5012e59ba56888", "message": "Fix a test failure where delete request arrives after undelete", "committedDate": "2020-05-26T22:53:09Z", "type": "commit"}, {"oid": "ab5f7337a60be98b84b178467d8d36f0bf811151", "url": "https://github.com/linkedin/ambry/commit/ab5f7337a60be98b84b178467d8d36f0bf811151", "message": "Remove comments", "committedDate": "2020-05-26T22:53:09Z", "type": "commit"}, {"oid": "1ff32a9211812f6b1b0dd05836270162dae40c78", "url": "https://github.com/linkedin/ambry/commit/1ff32a9211812f6b1b0dd05836270162dae40c78", "message": "Change the delete parallelism to 2", "committedDate": "2020-05-27T17:27:53Z", "type": "commit"}, {"oid": "1ff32a9211812f6b1b0dd05836270162dae40c78", "url": "https://github.com/linkedin/ambry/commit/1ff32a9211812f6b1b0dd05836270162dae40c78", "message": "Change the delete parallelism to 2", "committedDate": "2020-05-27T17:27:53Z", "type": "forcePushed"}, {"oid": "9eaa5dc2afa6db6f8021037a5efe47a079b999a9", "url": "https://github.com/linkedin/ambry/commit/9eaa5dc2afa6db6f8021037a5efe47a079b999a9", "message": "Comments", "committedDate": "2020-05-27T17:52:35Z", "type": "commit"}]}