{"pr_number": 1726, "pr_title": "Periodically try to upgrade to more optimal mysql endpoint", "pr_createdAt": "2020-12-10T19:27:21Z", "pr_url": "https://github.com/linkedin/ambry/pull/1726", "timeline": [{"oid": "d796fcd0710041b64b0f15777346c4a3bdd43744", "url": "https://github.com/linkedin/ambry/commit/d796fcd0710041b64b0f15777346c4a3bdd43744", "message": "Periodically try to upgrade to more optimal mysql endpoint\nCleanup error message on contraint violation", "committedDate": "2020-12-10T19:24:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY0NTkwNQ==", "url": "https://github.com/linkedin/ambry/pull/1726#discussion_r540645905", "bodyText": "LGTM, but can we make this configurable? and if it's 0 or -1, maybe don't retry it.", "author": "justinlin-linkedin", "createdAt": "2020-12-11T02:35:16Z", "path": "ambry-commons/src/main/java/com/github/ambry/mysql/MySqlDataAccessor.java", "diffHunk": "@@ -50,6 +51,10 @@\n   private DbEndpoint connectedEndpoint;\n   private List<DbEndpoint> sortedDbEndpoints;\n   private EndpointComparator endpointComparator;\n+  // Time of most recent attempt to connect to optimal endpoint\n+  private long lastConnectionAttemptTime = 0;\n+  // TODO: make config property\n+  private long connectionRetryWaitTime = TimeUnit.SECONDS.toMillis(30);", "originalCommit": "d796fcd0710041b64b0f15777346c4a3bdd43744", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY0Nzk2Mg==", "url": "https://github.com/linkedin/ambry/pull/1726#discussion_r540647962", "bodyText": "Yes, I will add that in a separate PR after Arun's transaction changes are merged (want to minimize conflicts since a few classes need to change to pass in the config).", "author": "lightningrob", "createdAt": "2020-12-11T02:41:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY0NTkwNQ=="}], "type": "inlineReview", "revised_code": null}]}