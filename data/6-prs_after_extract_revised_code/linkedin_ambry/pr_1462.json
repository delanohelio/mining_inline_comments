{"pr_number": 1462, "pr_title": "Support Disable/Enable/Reset partition in Helix bootstrap tool", "pr_createdAt": "2020-04-08T16:24:04Z", "pr_url": "https://github.com/linkedin/ambry/pull/1462", "timeline": [{"oid": "2001d31d3770cddc204bce3b56aae4d153b28ded", "url": "https://github.com/linkedin/ambry/commit/2001d31d3770cddc204bce3b56aae4d153b28ded", "message": "Support disabling partition in Helix bootstrap tool\n\n1. support disabling partition when decommissioning a replica. (This is\nsupposed to be done before removing it from IdealState)\n2. introduced HelixAdminOperation in bootstrap tool to simplify some\ncode logic.", "committedDate": "2020-04-08T16:21:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxOTk3MA==", "url": "https://github.com/linkedin/ambry/pull/1462#discussion_r406619970", "bodyText": "Indent for the entire info function from line 729 to 735.", "author": "xuhao417347761", "createdAt": "2020-04-10T06:19:41Z", "path": "ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java", "diffHunk": "@@ -707,22 +722,45 @@ private void addUpdateResources(String dcName, Map<String, Set<String>> partitio\n                 .add(partitionName);\n           }\n         } else if (!instanceSetInStatic.equals(instanceSetInHelix)) {\n-          // @formatter:off\n+          // we change the IdealState only when the operation is meant to bootstrap cluster or indeed update IdealState\n+          if (EnumSet.of(HelixAdminOperation.UpdateIdealState, HelixAdminOperation.BootstrapCluster)\n+              .contains(helixAdminOperation)) {\n+            // @formatter:off\n           info(", "originalCommit": "2001d31d3770cddc204bce3b56aae4d153b28ded", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "624cbcf7a6f25501d62efe75014276dd6ee37c43", "chunk": "diff --git a/ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java b/ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java\nindex d32e3bf0a..e2b122a32 100644\n--- a/ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java\n+++ b/ambry-clustermap/src/main/java/com/github/ambry/clustermap/HelixBootstrapUpgradeUtil.java\n\n@@ -726,13 +726,13 @@ public class HelixBootstrapUpgradeUtil {\n           if (EnumSet.of(HelixAdminOperation.UpdateIdealState, HelixAdminOperation.BootstrapCluster)\n               .contains(helixAdminOperation)) {\n             // @formatter:off\n-          info(\n-              \"[{}] Different instance sets for partition {} under resource {}. \"\n-                  + \"Updating Helix using static. \"\n-                  + \"Previous instance set: [{}], new instance set: [{}]\",\n-              dcName.toUpperCase(), partitionName, resourceName,\n-              String.join(\",\", instanceSetInHelix), String.join(\",\", instanceSetInStatic));\n-          // @formatter:on\n+            info(\n+                \"[{}] Different instance sets for partition {} under resource {}. \"\n+                    + \"Updating Helix using static. \"\n+                    + \"Previous instance set: [{}], new instance set: [{}]\",\n+                dcName.toUpperCase(), partitionName, resourceName,\n+                String.join(\",\", instanceSetInHelix), String.join(\",\", instanceSetInStatic));\n+            // @formatter:on\n             ArrayList<String> newInstances = new ArrayList<>(instanceSetInStatic);\n             Collections.shuffle(newInstances);\n             resourceIs.setPreferenceList(partitionName, newInstances);\n"}}, {"oid": "624cbcf7a6f25501d62efe75014276dd6ee37c43", "url": "https://github.com/linkedin/ambry/commit/624cbcf7a6f25501d62efe75014276dd6ee37c43", "message": "indentation and change comment", "committedDate": "2020-04-11T04:38:13Z", "type": "commit"}, {"oid": "375da499b4a9411d71e1d8e705b5ed583c7d3877", "url": "https://github.com/linkedin/ambry/commit/375da499b4a9411d71e1d8e705b5ed583c7d3877", "message": "added Enable/Reset partition features", "committedDate": "2020-04-15T03:41:51Z", "type": "commit"}, {"oid": "91855d8148258b57368ec4fd94b28d53b000219c", "url": "https://github.com/linkedin/ambry/commit/91855d8148258b57368ec4fd94b28d53b000219c", "message": "format files", "committedDate": "2020-04-15T03:54:19Z", "type": "commit"}, {"oid": "ed3a0bd461ee757c13bdb8b22311d6b61ee5450c", "url": "https://github.com/linkedin/ambry/commit/ed3a0bd461ee757c13bdb8b22311d6b61ee5450c", "message": "support deleting admin configs", "committedDate": "2020-04-15T18:05:48Z", "type": "commit"}, {"oid": "2a6e58d7f58ab01cca6e8ef0c4ee22883ab8546a", "url": "https://github.com/linkedin/ambry/commit/2a6e58d7f58ab01cca6e8ef0c4ee22883ab8546a", "message": "fix argument validation failure", "committedDate": "2020-04-15T21:33:54Z", "type": "commit"}]}