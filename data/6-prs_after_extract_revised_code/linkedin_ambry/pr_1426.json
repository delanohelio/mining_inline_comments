{"pr_number": 1426, "pr_title": "Fix the null pointer exception in hard deleter", "pr_createdAt": "2020-03-15T21:28:56Z", "pr_url": "https://github.com/linkedin/ambry/pull/1426", "timeline": [{"oid": "b3932d86d7887d155098a775d370958913255072", "url": "https://github.com/linkedin/ambry/commit/b3932d86d7887d155098a775d370958913255072", "message": "WIP", "committedDate": "2020-03-15T19:14:31Z", "type": "commit"}, {"oid": "4674faa99cc3801a1f33826a9f98906f1aad3d89", "url": "https://github.com/linkedin/ambry/commit/4674faa99cc3801a1f33826a9f98906f1aad3d89", "message": "Fix the null pointer exception for hard deleter", "committedDate": "2020-03-15T21:27:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4MTU4NA==", "url": "https://github.com/linkedin/ambry/pull/1426#discussion_r392781584", "bodyText": "nit : this.e = e == null ? e :  new RuntimeException(e);", "author": "jsjtzyy", "createdAt": "2020-03-16T04:51:02Z", "path": "ambry-store/src/test/java/com.github.ambry.store/HardDeleterTest.java", "diffHunk": "@@ -581,7 +612,11 @@ public long getSlice(String jobType, String jobId, long usedSinceLastCall) {\n     }\n \n     public void setException(Exception e) {\n-      this.e = new RuntimeException(e);\n+      if (e == null) {", "originalCommit": "4674faa99cc3801a1f33826a9f98906f1aad3d89", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "38e5f8535f8215161c969b1b353bc78ec9b4e8a7", "chunk": "diff --git a/ambry-store/src/test/java/com.github.ambry.store/HardDeleterTest.java b/ambry-store/src/test/java/com.github.ambry.store/HardDeleterTest.java\nindex e1c4dc023..175f793fd 100644\n--- a/ambry-store/src/test/java/com.github.ambry.store/HardDeleterTest.java\n+++ b/ambry-store/src/test/java/com.github.ambry.store/HardDeleterTest.java\n\n@@ -612,11 +612,7 @@ public class HardDeleterTest {\n     }\n \n     public void setException(Exception e) {\n-      if (e == null) {\n-        this.e = null;\n-      } else {\n-        this.e = new RuntimeException(e);\n-      }\n+      this.e = e == null ? null : new RuntimeException(e);\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4NTAyOA==", "url": "https://github.com/linkedin/ambry/pull/1426#discussion_r392785028", "bodyText": "Could you briefly explain why this would fix NPE in pruneTill()? You can add the explanation to the commit message of this PR.", "author": "jsjtzyy", "createdAt": "2020-03-16T05:08:56Z", "path": "ambry-store/src/main/java/com.github.ambry.store/HardDeleter.java", "diffHunk": "@@ -217,6 +221,7 @@ void performRecovery() throws StoreException {\n         readOptionsList.add(item.blobReadOptions);\n         messageStoreRecoveryInfoList.add(item.messagesStoreRecoveryInfo);\n       }\n+      hardDeleteRecoveryRange.clear();", "originalCommit": "4674faa99cc3801a1f33826a9f98906f1aad3d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4NzI1NA==", "url": "https://github.com/linkedin/ambry/pull/1426#discussion_r392787254", "bodyText": "updated.", "author": "justinlin-linkedin", "createdAt": "2020-03-16T05:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4NTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc5MDkwMw==", "url": "https://github.com/linkedin/ambry/pull/1426#discussion_r392790903", "bodyText": "Got it. I wonder why readCleanupTokenAndPopulateRecoveryRange didn't pass in startToken when creating recoverRange previously? Looks like it's viable to do so. Nvm, will approve this PR.", "author": "jsjtzyy", "createdAt": "2020-03-16T05:37:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjc4NTAyOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "38e5f8535f8215161c969b1b353bc78ec9b4e8a7", "url": "https://github.com/linkedin/ambry/commit/38e5f8535f8215161c969b1b353bc78ec9b4e8a7", "message": "Comments", "committedDate": "2020-03-16T05:13:54Z", "type": "commit"}]}