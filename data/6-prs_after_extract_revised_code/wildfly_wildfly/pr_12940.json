{"pr_number": 12940, "pr_title": "[WFLY-12952] Register default readiness probe for deployment", "pr_createdAt": "2020-01-27T14:30:35Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12940", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ1MjY0Ng==", "url": "https://github.com/wildfly/wildfly/pull/12940#discussion_r371452646", "bodyText": "In the context of other MP specs I've seen a particular pattern of config property keys used for impl-specific config properties (something like mp..extension. -- @pferraro knows).  Is there such a thing for health? If not is it wise to act is if there was?", "author": "bstansberry", "createdAt": "2020-01-27T19:59:55Z", "path": "microprofile/health-smallrye/src/main/java/org/wildfly/extension/microprofile/health/deployment/CDIExtension.java", "diffHunk": "@@ -96,12 +101,21 @@ private void afterDeploymentValidation(@Observes final AfterDeploymentValidation\n         addHealthChecks(HealthLiteral.INSTANCE, reporter::addHealthCheck, healthChecks);\n         addHealthChecks(LivenessLiteral.INSTANCE, reporter::addLivenessCheck, livenessChecks);\n         addHealthChecks(ReadinessLiteral.INSTANCE, reporter::addReadinessCheck, readinessChecks);\n+        if (readinessChecks.isEmpty()) {\n+            Config config = ConfigProvider.getConfig(module.getClassLoader());\n+            boolean disableDefaultprocedure = config.getOptionalValue(\"mp.health.disable-default-procedures\", Boolean.class).orElse(false);", "originalCommit": "05cddc209455512ea8f95c9cc4ef51e88fdfefb7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY2NDA0MQ==", "url": "https://github.com/wildfly/wildfly/pull/12940#discussion_r371664041", "bodyText": "I'm not sure to understand your comment.\nThis property mp.health.disable-default-procedures is defined by the spec itself", "author": "jmesnil", "createdAt": "2020-01-28T08:35:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ1MjY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MjM2Mg==", "url": "https://github.com/wildfly/wildfly/pull/12940#discussion_r375582362", "bodyText": "OK; thanks.", "author": "bstansberry", "createdAt": "2020-02-06T00:23:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ1MjY0Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "801e9116b343dbf0b32a778624a89f6a17b42742", "url": "https://github.com/wildfly/wildfly/commit/801e9116b343dbf0b32a778624a89f6a17b42742", "message": "[WFLY-12952] Register default readiness probe for deployment\n\nWhen a deployment does not provide any MicroProfile readiness probe,\nadd a default one (which returns UP as long as the deployment is deployed).\n\nThis allow to configure the overall server readiness to be DOWN when\nthe server is started and becomes UP as soon as a deployment is\ndeployed.\n\nThis default probe is disabled when the MicroProfile Health TCK is run.\n\nJIRA: https://issues.redhat.com/browse/WFLY-12952", "committedDate": "2020-01-30T15:32:43Z", "type": "commit"}, {"oid": "801e9116b343dbf0b32a778624a89f6a17b42742", "url": "https://github.com/wildfly/wildfly/commit/801e9116b343dbf0b32a778624a89f6a17b42742", "message": "[WFLY-12952] Register default readiness probe for deployment\n\nWhen a deployment does not provide any MicroProfile readiness probe,\nadd a default one (which returns UP as long as the deployment is deployed).\n\nThis allow to configure the overall server readiness to be DOWN when\nthe server is started and becomes UP as soon as a deployment is\ndeployed.\n\nThis default probe is disabled when the MicroProfile Health TCK is run.\n\nJIRA: https://issues.redhat.com/browse/WFLY-12952", "committedDate": "2020-01-30T15:32:43Z", "type": "forcePushed"}]}