{"pr_number": 12887, "pr_title": "[WFLY-12190] EJB: EJB over HTTP discovery configuration", "pr_createdAt": "2020-01-08T00:35:18Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12887", "timeline": [{"oid": "780f982d57099d97d09dc6343e3774265bbb96ae", "url": "https://github.com/wildfly/wildfly/commit/780f982d57099d97d09dc6343e3774265bbb96ae", "message": "[WFLY-12190] EJB: EJB over HTTP discovery configuration", "committedDate": "2020-01-13T18:40:05Z", "type": "forcePushed"}, {"oid": "462428132475446ea51978e9f43d283779f94756", "url": "https://github.com/wildfly/wildfly/commit/462428132475446ea51978e9f43d283779f94756", "message": "make tests work", "committedDate": "2020-03-12T10:40:10Z", "type": "forcePushed"}, {"oid": "a45fab76aec16a102cbf94d510e47055af98f47c", "url": "https://github.com/wildfly/wildfly/commit/a45fab76aec16a102cbf94d510e47055af98f47c", "message": "[WFLY-12190] Integration test", "committedDate": "2020-05-05T12:05:39Z", "type": "forcePushed"}, {"oid": "a79e3f942801a2db2c5d2d65b1d9ed22d0ccd7e7", "url": "https://github.com/wildfly/wildfly/commit/a79e3f942801a2db2c5d2d65b1d9ed22d0ccd7e7", "message": "[WFLY-12190] Community docs", "committedDate": "2020-05-07T09:50:55Z", "type": "forcePushed"}, {"oid": "9af08db5cea9503dc121a681cbdb55bce1b0e0f0", "url": "https://github.com/wildfly/wildfly/commit/9af08db5cea9503dc121a681cbdb55bce1b0e0f0", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-07-11T09:34:25Z", "type": "forcePushed"}, {"oid": "d57f27dfff56b4eea7f026ab82e35086c0ccbd9b", "url": "https://github.com/wildfly/wildfly/commit/d57f27dfff56b4eea7f026ab82e35086c0ccbd9b", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-07-12T16:18:12Z", "type": "forcePushed"}, {"oid": "dfeb23fe2b2e90a60e33472e05dfffebf099090e", "url": "https://github.com/wildfly/wildfly/commit/dfeb23fe2b2e90a60e33472e05dfffebf099090e", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-07-12T20:27:49Z", "type": "forcePushed"}, {"oid": "9b65bdbc8c98b692894d12c5e37e4d42ed058eed", "url": "https://github.com/wildfly/wildfly/commit/9b65bdbc8c98b692894d12c5e37e4d42ed058eed", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-07-21T06:37:41Z", "type": "forcePushed"}, {"oid": "0e609e1037596d706336db44cca47d42bfeaee83", "url": "https://github.com/wildfly/wildfly/commit/0e609e1037596d706336db44cca47d42bfeaee83", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-08-10T09:38:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTI2OQ==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r483951269", "bodyText": "This field should be final.  The ones above and below as well.", "author": "bstansberry", "createdAt": "2020-09-05T13:29:17Z", "path": "ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java", "diffHunk": "@@ -46,6 +48,7 @@\n     private int defaultCompression;\n \n     private Map<String, RemotingReceiverConfiguration> remotingReceiverConfigurations = new HashMap<String, RemotingReceiverConfiguration>();\n+    private List<HttpConnectionConfiguration> httpConnectionConfigurations = new ArrayList<>();", "originalCommit": "0e609e1037596d706336db44cca47d42bfeaee83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTM3OQ==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r483951379", "bodyText": "Also, there is no code that modifies this list, so something is missing somewhere.", "author": "bstansberry", "createdAt": "2020-09-05T13:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5NDQ5NA==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r484894494", "bodyText": "This was a bug. I have added the code that allows to configure http connections from jboss-ejb-client.xml file and added a test for that EjbOverHttpDescriptorTestCase", "author": "tadamski", "createdAt": "2020-09-08T12:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTI2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "358667856096be93cc3c67b077e682b41c49acf6", "chunk": "diff --git a/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java b/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\nindex 727de8e7bc..5d64eb3ba4 100644\n--- a/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\n+++ b/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\n\n@@ -47,9 +47,9 @@ public class EJBClientDescriptorMetaData {\n     private String profile;\n     private int defaultCompression;\n \n-    private Map<String, RemotingReceiverConfiguration> remotingReceiverConfigurations = new HashMap<String, RemotingReceiverConfiguration>();\n-    private List<HttpConnectionConfiguration> httpConnectionConfigurations = new ArrayList<>();\n-    private Set<ClusterConfig> clusterConfigs = new HashSet<ClusterConfig>();\n+    private final Map<String, RemotingReceiverConfiguration> remotingReceiverConfigurations = new HashMap<String, RemotingReceiverConfiguration>();\n+    private final List<HttpConnectionConfiguration> httpConnectionConfigurations = new ArrayList<>();\n+    private final Set<ClusterConfig> clusterConfigs = new HashSet<ClusterConfig>();\n \n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTQ0OA==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r483951448", "bodyText": "This should be final and presumably static.", "author": "bstansberry", "createdAt": "2020-09-05T13:31:18Z", "path": "ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java", "diffHunk": "@@ -346,4 +353,16 @@ public int hashCode() {\n             return outboundConnectionRef != null ? outboundConnectionRef.hashCode() : 0;\n         }\n     }\n+\n+    public class HttpConnectionConfiguration {", "originalCommit": "0e609e1037596d706336db44cca47d42bfeaee83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5NjU0NQ==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r484896545", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-09-08T13:01:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk1MTQ0OA=="}], "type": "inlineReview", "revised_code": {"commit": "d9af4180ef652b3389b4c5660c7a7b90b4b7af92", "chunk": "diff --git a/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java b/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\nindex 727de8e7bc..f8aee61fa9 100644\n--- a/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\n+++ b/ee/src/main/java/org/jboss/as/ee/metadata/EJBClientDescriptorMetaData.java\n\n@@ -354,7 +369,7 @@ public class EJBClientDescriptorMetaData {\n         }\n     }\n \n-    public class HttpConnectionConfiguration {\n+    public final static class HttpConnectionConfiguration {\n         private final String uri;\n \n         HttpConnectionConfiguration(final String uri) {\n"}}, {"oid": "358667856096be93cc3c67b077e682b41c49acf6", "url": "https://github.com/wildfly/wildfly/commit/358667856096be93cc3c67b077e682b41c49acf6", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-09-08T12:24:11Z", "type": "forcePushed"}, {"oid": "d9af4180ef652b3389b4c5660c7a7b90b4b7af92", "url": "https://github.com/wildfly/wildfly/commit/d9af4180ef652b3389b4c5660c7a7b90b4b7af92", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-09-08T13:00:44Z", "type": "forcePushed"}, {"oid": "a758a3157eb7b86eafd8e5d73dd37b17e03a3a75", "url": "https://github.com/wildfly/wildfly/commit/a758a3157eb7b86eafd8e5d73dd37b17e03a3a75", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-09-09T09:10:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NjQzMA==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r486176430", "bodyText": "Missing header", "author": "darranl", "createdAt": "2020-09-10T08:55:20Z", "path": "testsuite/integration/multinode/src/test/java/org/jboss/as/test/multinode/ejb/http/EjbOverHttpWrongCredentialsTestCase.java", "diffHunk": "@@ -0,0 +1,85 @@\n+package org.jboss.as.test.multinode.ejb.http;", "originalCommit": "a758a3157eb7b86eafd8e5d73dd37b17e03a3a75", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjIzMTM2NQ==", "url": "https://github.com/wildfly/wildfly/pull/12887#discussion_r486231365", "bodyText": "fixed", "author": "tadamski", "createdAt": "2020-09-10T10:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NjQzMA=="}], "type": "inlineReview", "revised_code": {"commit": "9012c2aa25b5412faf5966a5d869f667af23cd94", "chunk": "diff --git a/testsuite/integration/multinode/src/test/java/org/jboss/as/test/multinode/ejb/http/EjbOverHttpWrongCredentialsTestCase.java b/testsuite/integration/multinode/src/test/java/org/jboss/as/test/multinode/ejb/http/EjbOverHttpWrongCredentialsTestCase.java\ndeleted file mode 100644\nindex 1669558202..0000000000\n--- a/testsuite/integration/multinode/src/test/java/org/jboss/as/test/multinode/ejb/http/EjbOverHttpWrongCredentialsTestCase.java\n+++ /dev/null\n\n@@ -1,85 +0,0 @@\n-package org.jboss.as.test.multinode.ejb.http;\n-\n-import static org.jboss.as.test.shared.integration.ejb.security.PermissionUtils.createFilePermission;\n-import static org.jboss.as.test.shared.integration.ejb.security.PermissionUtils.createPermissionsXmlAsset;\n-\n-import java.net.SocketPermission;\n-import java.util.Arrays;\n-import javax.naming.InitialContext;\n-import org.jboss.arquillian.container.test.api.Deployment;\n-import org.jboss.arquillian.container.test.api.OperateOnDeployment;\n-import org.jboss.arquillian.container.test.api.TargetsContainer;\n-import org.jboss.arquillian.junit.Arquillian;\n-import org.jboss.arquillian.test.api.ArquillianResource;\n-import org.jboss.as.arquillian.api.ServerSetup;\n-import org.jboss.as.test.shared.TestSuiteEnvironment;\n-import org.jboss.shrinkwrap.api.Archive;\n-import org.jboss.shrinkwrap.api.ShrinkWrap;\n-import org.jboss.shrinkwrap.api.spec.JavaArchive;\n-import org.junit.Assert;\n-import org.junit.Test;\n-import org.junit.runner.RunWith;\n-\n-/**\n- * EJB over HTTP remote call should fail with incorrect wildfly-config.xml credentials\n- *\n- * @author <a href=\"mailto:szhantem@redhat.com\">Sultan Zhantemirov</a>\n- */\n-@RunWith(Arquillian.class)\n-@ServerSetup(EjbOverHttpTestCase.EjbOverHttpTestCaseServerSetup.class)\n-public class EjbOverHttpWrongCredentialsTestCase {\n-\n-    public static final String ARCHIVE_NAME_SERVER = \"ejboverhttp-test-server\";\n-    public static final String ARCHIVE_NAME_CLIENT_WRONG_CREDENTIALS = \"ejboverhttp-test-client-wrong-credentials\";\n-    private static final int serverPort = 8180;\n-\n-    @Deployment(name = \"server\")\n-    @TargetsContainer(\"multinode-server\")\n-    public static Archive<?> deployment0() {\n-        JavaArchive jar = createJar(ARCHIVE_NAME_SERVER);\n-        return jar;\n-    }\n-\n-    @Deployment(name = \"client-wrong-credentials\")\n-    @TargetsContainer(\"multinode-client\")\n-    public static Archive<?> deployment1() {\n-        JavaArchive jar = createClientJar();\n-        return jar;\n-    }\n-\n-    private static JavaArchive createJar(String archiveName) {\n-        JavaArchive jar = ShrinkWrap.create(JavaArchive.class, archiveName + \".jar\");\n-        jar.addClasses(StatelessBean.class, StatelessLocal.class, StatelessRemote.class);\n-        return jar;\n-    }\n-\n-    private static JavaArchive createClientJar() {\n-        JavaArchive jar = createJar(EjbOverHttpWrongCredentialsTestCase.ARCHIVE_NAME_CLIENT_WRONG_CREDENTIALS);\n-        jar.addClasses(EjbOverHttpTestCase.class);\n-        jar.addAsManifestResource(\"META-INF/jboss-ejb-client-profile.xml\", \"jboss-ejb-client.xml\")\n-                .addAsManifestResource(\"ejb-http-wildfly-config-wrong.xml\", \"wildfly-config.xml\")\n-                .addAsManifestResource(createPermissionsXmlAsset(createFilePermission(\"read,write\",\n-                        \"jbossas.multinode.client\", Arrays.asList(\"standalone\", \"data\", \"ejb-xa-recovery\")),\n-                        createFilePermission(\"read,write\",\n-                                \"jbossas.multinode.client\", Arrays.asList(\"standalone\", \"data\", \"ejb-xa-recovery\", \"-\")),\n-                        new SocketPermission(TestSuiteEnvironment.formatPossibleIpv6Address(System.getProperty(\"node0\")) + \":\" + serverPort,\n-                                \"connect,resolve\")),\n-                        \"permissions.xml\");\n-        return jar;\n-    }\n-\n-    @Test\n-    @OperateOnDeployment(\"client-wrong-credentials\")\n-    public void testBasicInvocationWithWrongCredentials(@ArquillianResource InitialContext ctx) throws Exception {\n-        StatelessRemote bean = (StatelessRemote) ctx.lookup(\"java:module/\" + StatelessBean.class.getSimpleName() + \"!\"\n-                + StatelessRemote.class.getName());\n-        Assert.assertNotNull(bean);\n-\n-        try {\n-            int methodCount = bean.remoteCall();\n-            Assert.assertEquals(EjbOverHttpTestCase.NO_EJB_RETURN_CODE, methodCount);\n-        } catch (javax.naming.AuthenticationException e) {\n-            // expected\n-        }\n-    }\n-}\n"}}, {"oid": "9012c2aa25b5412faf5966a5d869f667af23cd94", "url": "https://github.com/wildfly/wildfly/commit/9012c2aa25b5412faf5966a5d869f667af23cd94", "message": "[WFLY-13492] Upgrade Wildfly HTTP Client to 1.1.2.Final", "committedDate": "2020-09-10T10:00:07Z", "type": "commit"}, {"oid": "425c73d9ac3a3691bd0af2ced829eb714a097b93", "url": "https://github.com/wildfly/wildfly/commit/425c73d9ac3a3691bd0af2ced829eb714a097b93", "message": "[WFLY-12190] EJB over HTTP discovery: configuration", "committedDate": "2020-09-10T10:00:07Z", "type": "commit"}, {"oid": "986eb9c22cb0c10658bfdd9c35a00f781c068e65", "url": "https://github.com/wildfly/wildfly/commit/986eb9c22cb0c10658bfdd9c35a00f781c068e65", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpTestCase, EjbOverHttpDescriptorTestCase", "committedDate": "2020-09-10T10:00:07Z", "type": "commit"}, {"oid": "7e91f236884ea8ef0cee2070d3646f3af9becae5", "url": "https://github.com/wildfly/wildfly/commit/7e91f236884ea8ef0cee2070d3646f3af9becae5", "message": "[WFLY-12190] EJB over HTTP discovery: community docs", "committedDate": "2020-09-10T10:00:07Z", "type": "commit"}, {"oid": "8ea2b20b29f1d7794724796b3f0ba00c781295db", "url": "https://github.com/wildfly/wildfly/commit/8ea2b20b29f1d7794724796b3f0ba00c781295db", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-09-10T10:00:07Z", "type": "commit"}, {"oid": "8ea2b20b29f1d7794724796b3f0ba00c781295db", "url": "https://github.com/wildfly/wildfly/commit/8ea2b20b29f1d7794724796b3f0ba00c781295db", "message": "[WFLY-12190] EJB over HTTP discovery: EjbOverHttpWrongCredentialsTestCase", "committedDate": "2020-09-10T10:00:07Z", "type": "forcePushed"}]}