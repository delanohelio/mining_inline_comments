{"pr_number": 5126, "pr_title": "feat: Implement cluster health check endpoints", "pr_createdAt": "2020-04-21T13:34:12Z", "pr_url": "https://github.com/confluentinc/ksql/pull/5126", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjczNDU1Mw==", "url": "https://github.com/confluentinc/ksql/pull/5126#discussion_r412734553", "bodyText": "Can we add a comment explaining the importance of handling these before the server state handler (and auth handler)? It's great that you've added tests for this but I think a comment would be nice for anyone who happens to be glancing at the code.", "author": "vcrfxia", "createdAt": "2020-04-22T07:22:02Z", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/api/server/ServerVerticle.java", "diffHunk": "@@ -116,6 +118,9 @@ int actualPort() {\n   private Router setupRouter() {\n     final Router router = Router.router(vertx);\n \n+    router.route(HttpMethod.GET, \"/chc/ready\").handler(ServerVerticle::chcHandler);", "originalCommit": "e32845783927de711f3514dabf7499ef59f4f0e2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg2MjUxNA==", "url": "https://github.com/confluentinc/ksql/pull/5126#discussion_r412862514", "bodyText": "Are we confident that users don't rely on this functionality?\n\n\nI did a search in all confluentinc repos and /chc seems to be the only user of this. In terms of community users this was never a documented feature, afaik.", "author": "purplefox", "createdAt": "2020-04-22T10:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjczNDU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIxMzUxMQ==", "url": "https://github.com/confluentinc/ksql/pull/5126#discussion_r413213511", "bodyText": "OK. Let's prepare a blurb for the changelog/release notes with a summary of implications from the migration from Jetty to Vert.x, including that some Jetty-specific plugins/features may not be supported in full? There's almost certainly a more artful way to word this but I think it'd be good to call out.\nThe auto-generated changelog will pick it up if the commit message (the one that actually gets merged to GitHub) includes BREAKING CHANGE: <text here>. Or we can manually insert it into the changelog/release notes come release time.", "author": "vcrfxia", "createdAt": "2020-04-22T18:20:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjczNDU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzIzMzgxMg==", "url": "https://github.com/confluentinc/ksql/pull/5126#discussion_r413233812", "bodyText": "Hmm, AIUI the fact that we were previously using Jetty was an implementation detail, and we've never had any documented features reliant on it.", "author": "purplefox", "createdAt": "2020-04-22T18:50:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjczNDU1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6c2fd7527514396062bfe08011ec4b7700abad59", "chunk": "diff --git a/ksqldb-rest-app/src/main/java/io/confluent/ksql/api/server/ServerVerticle.java b/ksqldb-rest-app/src/main/java/io/confluent/ksql/api/server/ServerVerticle.java\nindex 2fcba6f541..6f160e6aca 100644\n--- a/ksqldb-rest-app/src/main/java/io/confluent/ksql/api/server/ServerVerticle.java\n+++ b/ksqldb-rest-app/src/main/java/io/confluent/ksql/api/server/ServerVerticle.java\n\n@@ -118,9 +116,6 @@ public class ServerVerticle extends AbstractVerticle {\n   private Router setupRouter() {\n     final Router router = Router.router(vertx);\n \n-    router.route(HttpMethod.GET, \"/chc/ready\").handler(ServerVerticle::chcHandler);\n-    router.route(HttpMethod.GET, \"/chc/live\").handler(ServerVerticle::chcHandler);\n-\n     PortedEndpoints.setupFailureHandler(router);\n \n     KsqlCorsHandler.setupCorsHandler(server, router);\n"}}, {"oid": "164e3d8c2e8e86798ebd85df8001817054e1a0b5", "url": "https://github.com/confluentinc/ksql/commit/164e3d8c2e8e86798ebd85df8001817054e1a0b5", "message": "Implement /chc endpoints", "committedDate": "2020-04-22T07:42:37Z", "type": "forcePushed"}, {"oid": "6c2fd7527514396062bfe08011ec4b7700abad59", "url": "https://github.com/confluentinc/ksql/commit/6c2fd7527514396062bfe08011ec4b7700abad59", "message": "migrate websocket", "committedDate": "2020-04-22T09:17:35Z", "type": "commit"}, {"oid": "36d9dd86746e9133debeb5b5bc3e2815e8f93136", "url": "https://github.com/confluentinc/ksql/commit/36d9dd86746e9133debeb5b5bc3e2815e8f93136", "message": "Enable compression on websockets + make sure message is truncated or chrome barfs", "committedDate": "2020-04-22T10:22:06Z", "type": "commit"}, {"oid": "dbff613afb26eb21dd527ab55095048f89c49c4c", "url": "https://github.com/confluentinc/ksql/commit/dbff613afb26eb21dd527ab55095048f89c49c4c", "message": "Added note on /chc", "committedDate": "2020-04-22T10:30:10Z", "type": "forcePushed"}, {"oid": "b7b927f4d9306a8f97459d812630d5e0c9159bf8", "url": "https://github.com/confluentinc/ksql/commit/b7b927f4d9306a8f97459d812630d5e0c9159bf8", "message": "findbugs", "committedDate": "2020-04-22T11:52:52Z", "type": "commit"}, {"oid": "c20eba60ea83d4eda9322d10fbfb29528d29dd7d", "url": "https://github.com/confluentinc/ksql/commit/c20eba60ea83d4eda9322d10fbfb29528d29dd7d", "message": "Implement /chc endpoints", "committedDate": "2020-04-22T11:53:39Z", "type": "commit"}, {"oid": "d76297c92b0c2838a410cb720fdc6d431514d45b", "url": "https://github.com/confluentinc/ksql/commit/d76297c92b0c2838a410cb720fdc6d431514d45b", "message": "Added note on /chc", "committedDate": "2020-04-22T11:53:39Z", "type": "commit"}, {"oid": "d76297c92b0c2838a410cb720fdc6d431514d45b", "url": "https://github.com/confluentinc/ksql/commit/d76297c92b0c2838a410cb720fdc6d431514d45b", "message": "Added note on /chc", "committedDate": "2020-04-22T11:53:39Z", "type": "forcePushed"}]}