{"pr_number": 6545, "pr_title": "feat: add constraint to deny drop sources referenced by other CREATE_AS sources", "pr_createdAt": "2020-10-29T19:51:49Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6545", "timeline": [{"oid": "2d54ab3a0dab0f1959f8bcf765fac7b564c33cd8", "url": "https://github.com/confluentinc/ksql/commit/2d54ab3a0dab0f1959f8bcf765fac7b564c33cd8", "message": "feat: add constraint to no drop sources referenced by other CREATE_AS sources", "committedDate": "2020-10-29T14:53:34Z", "type": "commit"}, {"oid": "66be896727054b0e22c0e98c0dcadb8acbc95fc5", "url": "https://github.com/confluentinc/ksql/commit/66be896727054b0e22c0e98c0dcadb8acbc95fc5", "message": "feat: return DROP source constraints from DESCRIBE EXTENDED", "committedDate": "2020-10-29T16:34:37Z", "type": "commit"}, {"oid": "a3d67f2f7829b5cc8926c5d8cdc94db58385daa0", "url": "https://github.com/confluentinc/ksql/commit/a3d67f2f7829b5cc8926c5d8cdc94db58385daa0", "message": "chore: drop sources in order for Rest QTT cleanup methods", "committedDate": "2020-10-29T19:19:08Z", "type": "commit"}, {"oid": "1fc508f810b63c847ef21b4a9dc3146b8e00a040", "url": "https://github.com/confluentinc/ksql/commit/1fc508f810b63c847ef21b4a9dc3146b8e00a040", "message": "chore: fix tests", "committedDate": "2020-10-29T19:34:15Z", "type": "commit"}, {"oid": "1ca7780d3246ecc966d135b993bf46414f86dfe9", "url": "https://github.com/confluentinc/ksql/commit/1ca7780d3246ecc966d135b993bf46414f86dfe9", "message": "chore: add sourceConstraints() to API client", "committedDate": "2020-10-29T20:40:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r516986240", "bodyText": "what happens if we get old response with new CLI and vice versa?", "author": "agavra", "createdAt": "2020-11-03T22:13:25Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/SourceDescription.java", "diffHunk": "@@ -68,7 +69,9 @@ public SourceDescription(\n       @JsonProperty(\"partitions\") final int partitions,\n       @JsonProperty(\"replication\") final int replication,\n       @JsonProperty(\"statement\") final String statement,\n-      @JsonProperty(\"queryOffsetSummaries\") final List<QueryOffsetSummary> queryOffsetSummaries) {\n+      @JsonProperty(\"queryOffsetSummaries\") final List<QueryOffsetSummary> queryOffsetSummaries,\n+      @JsonProperty(\"sourceConstraints\") final List<String> sourceConstraints", "originalCommit": "66be896727054b0e22c0e98c0dcadb8acbc95fc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY1NDY2Mw==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r517654663", "bodyText": "From an old CLI to the new Server works.\nFrom the new CLI to the old Server doesn't work. But, is this a valid support? And, how do others maintain compatibility with an old Server? I was looking at the code for other properties and I don't see how this is supported. Any idea?", "author": "spena", "createdAt": "2020-11-04T21:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY2NTM5MQ==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r517665391", "bodyText": "From an old CLI to the new Server works.\n\nThis one is more important. The other is a nice-to-have. It's not expected to work, but it would be nice if it behaved nicely (either ignoring it or telling you there's an issue). You don't need to implement that for this pr", "author": "agavra", "createdAt": "2020-11-04T22:21:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk4NjI0MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk5MTI3Mw==", "url": "https://github.com/confluentinc/ksql/pull/6545#discussion_r516991273", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returns a list of sources that have a DROP constraint reference on this source. This DROP\n          \n          \n            \n               * constraint does not allow to delete this source after all referenced sources are deleted.\n          \n          \n            \n               * Returns a list of sources that have a DROP constraint reference on this source. This source\n          \n          \n            \n               * cannot be dropped until all sources returned by this method are deleted.", "author": "agavra", "createdAt": "2020-11-03T22:24:58Z", "path": "ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java", "diffHunk": "@@ -85,4 +85,11 @@\n    */\n   String sqlStatement();\n \n+  /**\n+   * Returns a list of sources that have a DROP constraint reference on this source. This DROP\n+   * constraint does not allow to delete this source after all referenced sources are deleted.", "originalCommit": "1ca7780d3246ecc966d135b993bf46414f86dfe9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "22290faba89a2a6ea23ae25065974d864cde7925", "chunk": "diff --git a/ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java b/ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java\nindex 096f1b6d91..5edbbf1d40 100644\n--- a/ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java\n+++ b/ksqldb-api-client/src/main/java/io/confluent/ksql/api/client/SourceDescription.java\n\n@@ -86,8 +86,8 @@ public interface SourceDescription {\n   String sqlStatement();\n \n   /**\n-   * Returns a list of sources that have a DROP constraint reference on this source. This DROP\n-   * constraint does not allow to delete this source after all referenced sources are deleted.\n+   * Returns a list of sources that have a DROP constraint reference on this source. This source\n+   * cannot be dropped until all sources returned by this method are deleted.\n    *\n    * @return a list of sources\n    */\n"}}, {"oid": "22290faba89a2a6ea23ae25065974d864cde7925", "url": "https://github.com/confluentinc/ksql/commit/22290faba89a2a6ea23ae25065974d864cde7925", "message": "Update comment in SourceDescription\n\nCo-authored-by: Almog Gavra <almog@confluent.io>", "committedDate": "2020-11-04T20:27:16Z", "type": "commit"}, {"oid": "4db49e0dbe63ff579591532e7449458f3c175cf8", "url": "https://github.com/confluentinc/ksql/commit/4db49e0dbe63ff579591532e7449458f3c175cf8", "message": "chore: add recover test to verify DROP will work from an upgrade", "committedDate": "2020-11-04T21:36:40Z", "type": "commit"}]}