{"pr_number": 4575, "pr_title": "feat: log groupby errors to processing logger", "pr_createdAt": "2020-02-15T19:26:00Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4575", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2MTI4Mg==", "url": "https://github.com/confluentinc/ksql/pull/4575#discussion_r380861282", "bodyText": "Do we want to remove the LOG.error line below now that we have this?  Seems unnecessary to log the error twice.\nOther uses of the processing logger don't double log.", "author": "big-andy-coates", "createdAt": "2020-02-18T18:40:46Z", "path": "ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java", "diffHunk": "@@ -82,16 +93,36 @@ private static LogicalSchema buildSchema(\n   private static Object processColumn(\n       final int index,\n       final ExpressionMetadata exp,\n-      final GenericRow row\n+      final GenericRow row,\n+      final ProcessingLogger logger\n   ) {\n     try {\n       final Object result = exp.evaluate(row);\n       if (result == null) {\n+        logger.error(\n+            EngineProcessingLogMessageFactory.recordProcessingError(\n+               String.format(\n+                   \"Group-by column with index %d resolved to null.\"\n+                       + \" The source row will be excluded from the table.\",\n+                   index),\n+                row\n+            )\n+        );", "originalCommit": "05cd4803a9b906c9530172cd5350834f1dba285c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b61eae0d33ce47c8e3250c2194742275ca2655df", "chunk": "diff --git a/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java b/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\nindex 180fdcd811..57c7a0d44e 100644\n--- a/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\n+++ b/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\n\n@@ -108,8 +108,6 @@ final class GroupByParamsFactory {\n                 row\n             )\n         );\n-        LOG.error(\"Group-by column with index {} resolved to null. \"\n-            + \"The source row will be excluded from the table.\", index);\n       }\n       return result;\n     } catch (final Exception e) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg2MTcxNA==", "url": "https://github.com/confluentinc/ksql/pull/4575#discussion_r380861714", "bodyText": "Same again - remove the LOG.error below.  - and you can remove the LOG field too.", "author": "big-andy-coates", "createdAt": "2020-02-18T18:41:36Z", "path": "ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java", "diffHunk": "@@ -82,16 +93,36 @@ private static LogicalSchema buildSchema(\n   private static Object processColumn(\n       final int index,\n       final ExpressionMetadata exp,\n-      final GenericRow row\n+      final GenericRow row,\n+      final ProcessingLogger logger\n   ) {\n     try {\n       final Object result = exp.evaluate(row);\n       if (result == null) {\n+        logger.error(\n+            EngineProcessingLogMessageFactory.recordProcessingError(\n+               String.format(\n+                   \"Group-by column with index %d resolved to null.\"\n+                       + \" The source row will be excluded from the table.\",\n+                   index),\n+                row\n+            )\n+        );\n         LOG.error(\"Group-by column with index {} resolved to null. \"\n             + \"The source row will be excluded from the table.\", index);\n       }\n       return result;\n     } catch (final Exception e) {\n+      logger.error(\n+          EngineProcessingLogMessageFactory.recordProcessingError(\n+              String.format(\n+                  \"Error calculating group-by column with index %d. \"\n+                      + \"The source row will be excluded from the table: %s\",\n+                  index, e.getMessage()),\n+              e,\n+              row\n+          )\n+      );", "originalCommit": "05cd4803a9b906c9530172cd5350834f1dba285c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b61eae0d33ce47c8e3250c2194742275ca2655df", "chunk": "diff --git a/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java b/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\nindex 180fdcd811..57c7a0d44e 100644\n--- a/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\n+++ b/ksql-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java\n\n@@ -108,8 +108,6 @@ final class GroupByParamsFactory {\n                 row\n             )\n         );\n-        LOG.error(\"Group-by column with index {} resolved to null. \"\n-            + \"The source row will be excluded from the table.\", index);\n       }\n       return result;\n     } catch (final Exception e) {\n"}}, {"oid": "c1b0b20390804f952db17c7f7259e484d82384e7", "url": "https://github.com/confluentinc/ksql/commit/c1b0b20390804f952db17c7f7259e484d82384e7", "message": "feat: log groupby errors to processing logger", "committedDate": "2020-02-19T06:58:34Z", "type": "commit"}, {"oid": "b61eae0d33ce47c8e3250c2194742275ca2655df", "url": "https://github.com/confluentinc/ksql/commit/b61eae0d33ce47c8e3250c2194742275ca2655df", "message": "review feedback", "committedDate": "2020-02-19T06:58:34Z", "type": "commit"}, {"oid": "df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "url": "https://github.com/confluentinc/ksql/commit/df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "message": "fix tests", "committedDate": "2020-02-19T07:04:55Z", "type": "commit"}, {"oid": "df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "url": "https://github.com/confluentinc/ksql/commit/df3b95e81ff03bc92e3b8cf9167ef37d3f911fe6", "message": "fix tests", "committedDate": "2020-02-19T07:04:55Z", "type": "forcePushed"}]}