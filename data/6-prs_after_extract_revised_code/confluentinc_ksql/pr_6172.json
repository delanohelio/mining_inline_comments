{"pr_number": 6172, "pr_title": "fix: missing topic classifier now uses MissingSourceTopicException", "pr_createdAt": "2020-09-09T23:44:56Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6172", "timeline": [{"oid": "0cce1e5666de585a7c1d23837c13cf8383c16c06", "url": "https://github.com/confluentinc/ksql/commit/0cce1e5666de585a7c1d23837c13cf8383c16c06", "message": "fix: missing topic classifier now uses MissingSourceTopicException", "committedDate": "2020-09-09T23:11:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4NTcwMg==", "url": "https://github.com/confluentinc/ksql/pull/6172#discussion_r485985702", "bodyText": "I assume the new exception is thrown for both a missing source topic and sink topic, replicating this behavior.  Is that right?", "author": "AlanConfluent", "createdAt": "2020-09-10T00:01:07Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java", "diffHunk": "@@ -326,20 +317,6 @@ private KsqlQueryBuilder queryBuilder(final QueryId queryId) {\n     return Optional.ofNullable(combined);\n   }\n \n-  private static Set<String> extractTopics(final Topology topology) {\n-    final Set<String> usedTopics = new HashSet<>();\n-    for (final Subtopology subtopology : topology.describe().subtopologies()) {\n-      for (final Node node : subtopology.nodes()) {\n-        if (node instanceof Source) {", "originalCommit": "0cce1e5666de585a7c1d23837c13cf8383c16c06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk5NTgyNA==", "url": "https://github.com/confluentinc/ksql/pull/6172#discussion_r485995824", "bodyText": "Thanks for pointing this out, I thought about this and just assumed it did but now that I checked it... It seems like it does not actually capture missing sink topics :( cc @ableegoldman\nI created a stream A and then B that was just SELECT * FROM A. Then I deleted topic B and waited:\n[2020-09-09 17:34:24,536] ERROR Unhandled exception caught in streams thread _confluent-ksql-default_query_CSAS_B\n_0-3ebb4954-2cfb-40b0-b703-ae2828d3aa0a-StreamThread-2. (io.confluent.ksql.util.QueryMetadata:158)\norg.apache.kafka.streams.errors.StreamsException: Error encountered sending record to topic B for task 0_0 due to\n:\norg.apache.kafka.common.errors.TimeoutException: Topic B not present in metadata after 60000 ms.\n\nThis PR is probably still an improvement over what was there beforehand, which seemed to just not work (at least in the confluent cloud environment with multiple brokers). I'm going to test to see what happens if a repartition topic is deleted.", "author": "agavra", "createdAt": "2020-09-10T00:37:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4NTcwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAwMTEyNQ==", "url": "https://github.com/confluentinc/ksql/pull/6172#discussion_r486001125", "bodyText": "It's only for missing source topics specifically. It doesn't apply to repartition topics either; that's trickier, how do we tell the difference between a deleted repartition topic and a repartition topic that we just need to create? There's followup work planned for all that, but this change was just a quick and easy fix for the user input topic case so we could make some progress", "author": "ableegoldman", "createdAt": "2020-09-10T00:57:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4NTcwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAwNzI5Nw==", "url": "https://github.com/confluentinc/ksql/pull/6172#discussion_r486007297", "bodyText": "Thanks @ableegoldman - I'll go ahead and merge this and we can improve it as we go on.", "author": "agavra", "createdAt": "2020-09-10T01:21:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk4NTcwMg=="}], "type": "inlineReview", "revised_code": null}]}