{"pr_number": 6267, "pr_title": "feat: new CLI parameter to execute a command and quit (without CLI interaction)", "pr_createdAt": "2020-09-21T18:06:02Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6267", "timeline": [{"oid": "5428888f28b1bf9ffd7d71e40acb5790c15a754b", "url": "https://github.com/confluentinc/ksql/commit/5428888f28b1bf9ffd7d71e40acb5790c15a754b", "message": "feat: new CLI parameter to execute a command and quit (without CLI interaction)", "committedDate": "2020-09-21T17:49:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTAwMg==", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492491002", "bodyText": "nit: the user may not understand \"command\" - maybe \"run one or more ksql statements and quit.\"?", "author": "rodesai", "createdAt": "2020-09-22T06:05:07Z", "path": "ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java", "diffHunk": "@@ -111,6 +113,12 @@\n           + \"defaults to TABULAR)\")\n   private String outputFormat = OutputFormat.TABULAR.name();\n \n+  @SuppressWarnings(\"unused\") // Accessed via reflection\n+  @Option(\n+      name = {EXECUTE_OPTION, EXECUTE_SHORT_OPTION},\n+      description = \"Execute a command and quit.\")", "originalCommit": "5428888f28b1bf9ffd7d71e40acb5790c15a754b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgyMjQ1Mg==", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492822452", "bodyText": "Done.", "author": "spena", "createdAt": "2020-09-22T15:18:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTAwMg=="}], "type": "inlineReview", "revised_code": {"commit": "63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "chunk": "diff --git a/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java b/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java\nindex d4c021a923..f16d2a15c9 100644\n--- a/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java\n+++ b/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Options.java\n\n@@ -116,7 +116,7 @@ public class Options {\n   @SuppressWarnings(\"unused\") // Accessed via reflection\n   @Option(\n       name = {EXECUTE_OPTION, EXECUTE_SHORT_OPTION},\n-      description = \"Execute a command and quit.\")\n+      description = \"Execute one or more SQL statements and quit.\")\n   private String execute = null;\n \n   public static Options parse(final String...args) throws IOException {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTQ3Ng==", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492491476", "bodyText": "why the empty log message?", "author": "rodesai", "createdAt": "2020-09-22T06:06:35Z", "path": "ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java", "diffHunk": "@@ -179,13 +182,31 @@ public void makeKsqlRequest(final String statements) {\n     throw new KsqlRestClientException(\"Failed to execute request \" + ksql);\n   }\n \n+  public void runCommand(final String command) {\n+    RemoteServerSpecificCommand.validateClient(terminal.writer(), restClient);\n+    try {\n+      // Handles the RUN SCRIPT command if found\n+      if (!terminal.maybeHandleCliSpecificCommands(command)) {\n+        handleLine(command);\n+      }\n+    } catch (final EndOfFileException exception) {\n+      // Ignore - only used by runInteractively() to exit the CLI\n+    } catch (final Exception exception) {\n+      LOGGER.error(\"\", exception);", "originalCommit": "5428888f28b1bf9ffd7d71e40acb5790c15a754b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjgyMjUyNg==", "url": "https://github.com/confluentinc/ksql/pull/6267#discussion_r492822526", "bodyText": "Done.", "author": "spena", "createdAt": "2020-09-22T15:18:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ5MTQ3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "chunk": "diff --git a/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java b/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java\nindex 00da389790..89cff4d8db 100644\n--- a/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java\n+++ b/ksqldb-cli/src/main/java/io/confluent/ksql/cli/Cli.java\n\n@@ -192,7 +192,9 @@ public class Cli implements KsqlRequestExecutor, Closeable {\n     } catch (final EndOfFileException exception) {\n       // Ignore - only used by runInteractively() to exit the CLI\n     } catch (final Exception exception) {\n-      LOGGER.error(\"\", exception);\n+      LOGGER.error(\"An error occurred while running a command. Error = \"\n+          + exception.getMessage(), exception);\n+\n       terminal.printError(ErrorMessageUtil.buildErrorMessage(exception),\n           exception.toString());\n     }\n"}}, {"oid": "63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "url": "https://github.com/confluentinc/ksql/commit/63d7b953b2f2f07a0e9e4ba9c1156c4a6db7df9c", "message": "fix: address PR feedback", "committedDate": "2020-09-22T15:18:00Z", "type": "commit"}]}