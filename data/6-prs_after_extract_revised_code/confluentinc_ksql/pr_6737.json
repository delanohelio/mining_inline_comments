{"pr_number": 6737, "pr_title": "chore: remove usage of SRClient#getAllSubjects", "pr_createdAt": "2020-12-08T18:26:48Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6737", "timeline": [{"oid": "b3330700269f015caea0da22c7d78efb5d553a7d", "url": "https://github.com/confluentinc/ksql/commit/b3330700269f015caea0da22c7d78efb5d553a7d", "message": "chore: remove usage of SRClient#getAllSubjects", "committedDate": "2020-12-08T18:26:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwMTY3Mg==", "url": "https://github.com/confluentinc/ksql/pull/6737#discussion_r538701672", "bodyText": "Any reason we can't just call getLatestSchema(...).isPresent()?", "author": "vcrfxia", "createdAt": "2020-12-08T18:32:20Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/schema/registry/SchemaRegistryUtil.java", "diffHunk": "@@ -89,6 +93,21 @@ public static void deleteSubjectWithRetries(\n     }\n   }\n \n+  public static boolean subjectExists(\n+      final SchemaRegistryClient srClient,\n+      final String subject\n+  ) {\n+    try {", "originalCommit": "b3330700269f015caea0da22c7d78efb5d553a7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwNTI5NQ==", "url": "https://github.com/confluentinc/ksql/pull/6737#discussion_r538705295", "bodyText": "that's a good idea, I have to do some refactoring to make it work but i'll just do that.", "author": "agavra", "createdAt": "2020-12-08T18:35:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwMTY3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "fe512143474d043b1bf4334d8385af46db302703", "chunk": "diff --git a/ksqldb-engine/src/main/java/io/confluent/ksql/schema/registry/SchemaRegistryUtil.java b/ksqldb-engine/src/main/java/io/confluent/ksql/schema/registry/SchemaRegistryUtil.java\nindex 007b9ca5ed..14c796de55 100644\n--- a/ksqldb-engine/src/main/java/io/confluent/ksql/schema/registry/SchemaRegistryUtil.java\n+++ b/ksqldb-engine/src/main/java/io/confluent/ksql/schema/registry/SchemaRegistryUtil.java\n\n@@ -82,29 +82,28 @@ public final class SchemaRegistryUtil {\n       final boolean getKeySchema\n   ) {\n     final String subject = KsqlConstants.getSRSubject(topic, getKeySchema);\n-    try {\n-      final SchemaMetadata schemaMetadata = srClient.getLatestSchemaMetadata(subject);\n-      return Optional.ofNullable(schemaMetadata);\n-    } catch (final Exception e) {\n-      if (isSubjectNotFoundErrorCode(e)) {\n-        return Optional.empty();\n-      }\n-      throw new KsqlException(\"Could not get latest schema for subject \" + topic, e);\n-    }\n+    return getLatestSchema(srClient, subject);\n   }\n \n   public static boolean subjectExists(\n       final SchemaRegistryClient srClient,\n       final String subject\n+  ) {\n+    return getLatestSchema(srClient, subject).isPresent();\n+  }\n+\n+  private static Optional<SchemaMetadata> getLatestSchema(\n+      final SchemaRegistryClient srClient,\n+      final String subject\n   ) {\n     try {\n-      srClient.getLatestSchemaMetadata(subject);\n-      return true;\n-    } catch (RestClientException | IOException e) {\n+      final SchemaMetadata schemaMetadata = srClient.getLatestSchemaMetadata(subject);\n+      return Optional.ofNullable(schemaMetadata);\n+    } catch (final Exception e) {\n       if (isSubjectNotFoundErrorCode(e)) {\n-        return false;\n+        return Optional.empty();\n       }\n-      throw new KsqlException(\"Could not check if subject exists: \\\"\" + subject + '\"', e);\n+      throw new KsqlException(\"Could not get latest schema for subject \" + subject, e);\n     }\n   }\n \n"}}, {"oid": "fe512143474d043b1bf4334d8385af46db302703", "url": "https://github.com/confluentinc/ksql/commit/fe512143474d043b1bf4334d8385af46db302703", "message": "chore: minor refactor", "committedDate": "2020-12-08T18:47:14Z", "type": "commit"}, {"oid": "fe512143474d043b1bf4334d8385af46db302703", "url": "https://github.com/confluentinc/ksql/commit/fe512143474d043b1bf4334d8385af46db302703", "message": "chore: minor refactor", "committedDate": "2020-12-08T18:47:14Z", "type": "forcePushed"}, {"oid": "875b691db40c7e8d317f6e54f63162c38368d47d", "url": "https://github.com/confluentinc/ksql/commit/875b691db40c7e8d317f6e54f63162c38368d47d", "message": "chore: checkstyle", "committedDate": "2020-12-08T19:58:32Z", "type": "commit"}]}