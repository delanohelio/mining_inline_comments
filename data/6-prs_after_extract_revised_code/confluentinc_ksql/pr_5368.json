{"pr_number": 5368, "pr_title": "refactor: Cleanup and refactoring of new server API", "pr_createdAt": "2020-05-14T17:17:10Z", "pr_url": "https://github.com/confluentinc/ksql/pull/5368", "timeline": [{"oid": "e76cb82dd3dacf2c594c2e9f2085b94d4220b6a9", "url": "https://github.com/confluentinc/ksql/commit/e76cb82dd3dacf2c594c2e9f2085b94d4220b6a9", "message": "Moved things around", "committedDate": "2020-05-15T12:44:37Z", "type": "forcePushed"}, {"oid": "104b46fc664448a1a45097f2b391dc88068d5393", "url": "https://github.com/confluentinc/ksql/commit/104b46fc664448a1a45097f2b391dc88068d5393", "message": "fixed test", "committedDate": "2020-05-15T19:14:30Z", "type": "forcePushed"}, {"oid": "7686d3f3f8a1c036a54a6b8ef913f7fb91c3ed5e", "url": "https://github.com/confluentinc/ksql/commit/7686d3f3f8a1c036a54a6b8ef913f7fb91c3ed5e", "message": "Unify rest errors", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "b05bf6606de9ba8712d7afea28e1d41b044bf1d5", "url": "https://github.com/confluentinc/ksql/commit/b05bf6606de9ba8712d7afea28e1d41b044bf1d5", "message": "new API refactoring", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "5bb61ff8fbfd85cae58fea90082d47a6561f7fd7", "url": "https://github.com/confluentinc/ksql/commit/5bb61ff8fbfd85cae58fea90082d47a6561f7fd7", "message": "findbugs", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "e38b691bdaf6689c9e924deaeca30f6d4acf7bce", "url": "https://github.com/confluentinc/ksql/commit/e38b691bdaf6689c9e924deaeca30f6d4acf7bce", "message": "add jsonignoreproperties", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "3510c52095ee87d8788396e4253913954c15fa23", "url": "https://github.com/confluentinc/ksql/commit/3510c52095ee87d8788396e4253913954c15fa23", "message": "Unify POJO serialization", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "baadbdd385c70d97fba75bf87c01060df353b896", "url": "https://github.com/confluentinc/ksql/commit/baadbdd385c70d97fba75bf87c01060df353b896", "message": "fix test", "committedDate": "2020-05-17T07:27:33Z", "type": "commit"}, {"oid": "ac1965bab8c86290d7bb8e50d29f6e16217eb9a9", "url": "https://github.com/confluentinc/ksql/commit/ac1965bab8c86290d7bb8e50d29f6e16217eb9a9", "message": "Moved things around", "committedDate": "2020-05-17T07:27:34Z", "type": "commit"}, {"oid": "f15bd28bb00384044b8dced2eb3b2a61ff8467bd", "url": "https://github.com/confluentinc/ksql/commit/f15bd28bb00384044b8dced2eb3b2a61ff8467bd", "message": "Moved things around", "committedDate": "2020-05-17T07:27:34Z", "type": "commit"}, {"oid": "171b0d8a239cead0bab12cca952e8d7362b9358d", "url": "https://github.com/confluentinc/ksql/commit/171b0d8a239cead0bab12cca952e8d7362b9358d", "message": "fixed test", "committedDate": "2020-05-17T07:27:34Z", "type": "commit"}, {"oid": "8890549921f8740c13c21734c2335c7e9e86160b", "url": "https://github.com/confluentinc/ksql/commit/8890549921f8740c13c21734c2335c7e9e86160b", "message": "fixed test", "committedDate": "2020-05-17T07:30:59Z", "type": "commit"}, {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "url": "https://github.com/confluentinc/ksql/commit/b698eaed0d4eed6c228a0e58cff594e29718ac5b", "message": "fixed test", "committedDate": "2020-05-17T07:43:02Z", "type": "commit"}, {"oid": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "url": "https://github.com/confluentinc/ksql/commit/b698eaed0d4eed6c228a0e58cff594e29718ac5b", "message": "fixed test", "committedDate": "2020-05-17T07:43:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjkyMQ==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426306921", "bodyText": "Why do we need to add this? I thought the point in setting .disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES) in ApiJsonMapper was precisely so that we wouldn't have to individually set @JsonIgnoreProperties(ignoreUnknown = true) on each of the request and response types.", "author": "vcrfxia", "createdAt": "2020-05-17T21:29:09Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/CloseQueryArgs.java", "diffHunk": "@@ -13,17 +13,18 @@\n  * specific language governing permissions and limitations under the License.\n  */\n \n-package io.confluent.ksql.api.server.protocol;\n+package io.confluent.ksql.rest.entity;\n \n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import com.google.errorprone.annotations.Immutable;\n-import io.confluent.ksql.api.server.PushQueryId;\n import java.util.Objects;\n \n /**\n  * Represents the arguments to a close query request\n  */\n @Immutable\n+@JsonIgnoreProperties(ignoreUnknown = true)", "originalCommit": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ0NDMyNA==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426444324", "bodyText": "This an old test in rest-model which tests that all the classes there have this.", "author": "purplefox", "createdAt": "2020-05-18T08:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjkyMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjk1Mw==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426306953", "bodyText": "This looks like it was meant to be removed.", "author": "vcrfxia", "createdAt": "2020-05-17T21:29:43Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java", "diffHunk": "@@ -63,6 +69,23 @@\n   public static final int ERROR_CODE_SERVER_ERROR =\n       toErrorCode(INTERNAL_SERVER_ERROR.code());\n \n+  /*", "originalCommit": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ0Njg3Mg==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426446872", "bodyText": "ack", "author": "purplefox", "createdAt": "2020-05-18T08:17:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNjk1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "fbc516ee9c423189485d3ccdc325d10c0fcf5750", "chunk": "diff --git a/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java b/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java\nindex abc7628586..6d9c5862c8 100644\n--- a/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java\n+++ b/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java\n\n@@ -68,24 +68,7 @@ public final class Errors {\n \n   public static final int ERROR_CODE_SERVER_ERROR =\n       toErrorCode(INTERNAL_SERVER_ERROR.code());\n-\n-  /*\n-    public static final int ERROR_CODE_MISSING_PARAM = 1;\n-  public static final int ERROR_CODE_UNKNOWN_QUERY_ID = 3;\n-  public static final int ERROR_CODE_MALFORMED_REQUEST = 4;\n-  public static final int ERROR_CODE_INVALID_QUERY = 5;\n-  public static final int ERROR_CODE_MISSING_KEY_FIELD = 6;\n-  public static final int ERROR_CODE_CANNOT_COERCE_FIELD = 7;\n-  public static final int ERROR_MAX_PUSH_QUERIES_EXCEEDED = 8;\n-  public static final int ERROR_FAILED_AUTHENTICATION = 9;\n-  public static final int ERROR_FAILED_AUTHORIZATION = 10;\n-  public static final int ERROR_HTTP2_ONLY = 11;\n-  public static final int ERROR_CODE_INTERNAL_ONLY = 12;\n-\n-  public static final int ERROR_CODE_INTERNAL_ERROR = 100;\n-\n-   */\n-\n+  \n   private final ErrorMessages errorMessages;\n \n   public static int toStatusCode(final int errorCode) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNzEwMw==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426307103", "bodyText": "This PR is a breaking change since some of the error codes for the new API endpoints have changed. Can we mark it as a breaking change in the PR and commit description? Do we need to make updates to any of the examples that use the new API endpoints (e.g., the Javascript ride-sharing app)?", "author": "vcrfxia", "createdAt": "2020-05-17T21:31:08Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/Errors.java", "diffHunk": "@@ -40,13 +40,19 @@\n   public static final int ERROR_CODE_BAD_STATEMENT = toErrorCode(BAD_REQUEST.code()) + 1;\n   private static final int ERROR_CODE_QUERY_ENDPOINT = toErrorCode(BAD_REQUEST.code()) + 2;\n \n+  public static final int ERROR_CODE_MAX_PUSH_QUERIES_EXCEEDED =", "originalCommit": "b698eaed0d4eed6c228a0e58cff594e29718ac5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ0NTIxMQ==", "url": "https://github.com/confluentinc/ksql/pull/5368#discussion_r426445211", "bodyText": "We haven't released the new API yet, so I think it is ok :)", "author": "purplefox", "createdAt": "2020-05-18T08:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwNzEwMw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "fbc516ee9c423189485d3ccdc325d10c0fcf5750", "url": "https://github.com/confluentinc/ksql/commit/fbc516ee9c423189485d3ccdc325d10c0fcf5750", "message": "Removed some commented out code", "committedDate": "2020-05-18T08:16:06Z", "type": "commit"}]}