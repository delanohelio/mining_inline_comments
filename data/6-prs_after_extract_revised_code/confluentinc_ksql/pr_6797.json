{"pr_number": 6797, "pr_title": "feat: bound the size of the shared buffer cache used by queries", "pr_createdAt": "2020-12-17T17:21:19Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6797", "timeline": [{"oid": "3bd321a1ee875644411da5b4f28bc8777cedd878", "url": "https://github.com/confluentinc/ksql/commit/3bd321a1ee875644411da5b4f28bc8777cedd878", "message": "bound the size of the shared buffer cache used by queries\n\nbound the total size of the shared buffer cache used by queries. The\nbound is controlled by 2 configs, one for controlling the limit for\npersistent queries, the other for transient queries. Today, this limit\nis implemented by accounting the full limit for each query against the\ntotal bound. In the future we may implement by using a shared cache.", "committedDate": "2020-12-17T17:19:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI2ODk0Nw==", "url": "https://github.com/confluentinc/ksql/pull/6797#discussion_r545268947", "bodyText": "I think based on some of the other query configs we have already, these two configs name  would be more suitable\nksql.query.transient.max.bytes.buffering.total\nksql.query.persistent.max.bytes.buffering.total", "author": "stevenpyzhang", "createdAt": "2020-12-17T17:28:56Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java", "diffHunk": "@@ -359,6 +359,17 @@\n   private static final String KSQL_PROPERTIES_OVERRIDES_DENYLIST_DOC = \"Comma-separated list of \"\n       + \"properties that KSQL users cannot override.\";\n \n+  public static final String KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING =\n+      \"ksql.cache.max.bytes.buffering.total\";", "originalCommit": "3bd321a1ee875644411da5b4f28bc8777cedd878", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e5742803e5dbe22bb6eb4f4618077106a622d3c", "chunk": "diff --git a/ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java b/ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java\nindex 270d7bffe3..5851afccd5 100644\n--- a/ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java\n+++ b/ksqldb-common/src/main/java/io/confluent/ksql/util/KsqlConfig.java\n\n@@ -360,12 +360,12 @@ public class KsqlConfig extends AbstractConfig {\n       + \"properties that KSQL users cannot override.\";\n \n   public static final String KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING =\n-      \"ksql.cache.max.bytes.buffering.total\";\n+      \"ksql.query.persistent.max.bytes.buffering.total\";\n   public static final long KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING_DEFAULT = -1;\n   public static final String KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING_DOC = \"Limit on the total bytes \"\n       + \"used by Kafka Streams cache across all persistent queries\";\n   public static final String KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING_TRANSIENT =\n-      \"ksql.transient.cache.max.bytes.buffering.total\";\n+      \"ksql.query.transient.max.bytes.buffering.total\";\n   public static final long KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING_TRANSIENT_DEFAULT = -1;\n   public static final String KSQL_TOTAL_CACHE_MAX_BYTES_BUFFERING_TRANSIENT_DOC = \"Limit on the \"\n       + \"total bytes used by Kafka Streams cache across all transient queries\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI3MTEyNQ==", "url": "https://github.com/confluentinc/ksql/pull/6797#discussion_r545271125", "bodyText": "nit: remove", "author": "stevenpyzhang", "createdAt": "2020-12-17T17:32:03Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java", "diffHunk": "@@ -57,6 +57,7 @@\n import io.confluent.ksql.util.TransientQueryMetadata;\n import io.confluent.ksql.util.TransientQueryMetadata.ResultType;\n import java.util.Arrays;\n+import java.util.Collection;", "originalCommit": "3bd321a1ee875644411da5b4f28bc8777cedd878", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e7bd4c1e3c83dc764b1c7b256c9eced88389d4a3", "chunk": "diff --git a/ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java b/ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java\nindex 24d7d78bf4..f371b6d43d 100644\n--- a/ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java\n+++ b/ksqldb-engine/src/main/java/io/confluent/ksql/query/QueryExecutor.java\n\n@@ -57,7 +57,6 @@ import io.confluent.ksql.util.QueryMetadata;\n import io.confluent.ksql.util.TransientQueryMetadata;\n import io.confluent.ksql.util.TransientQueryMetadata.ResultType;\n import java.util.Arrays;\n-import java.util.Collection;\n import java.util.HashMap;\n import java.util.LinkedList;\n import java.util.List;\n"}}, {"oid": "e7bd4c1e3c83dc764b1c7b256c9eced88389d4a3", "url": "https://github.com/confluentinc/ksql/commit/e7bd4c1e3c83dc764b1c7b256c9eced88389d4a3", "message": "checkstyle", "committedDate": "2020-12-18T03:32:38Z", "type": "commit"}, {"oid": "6e5742803e5dbe22bb6eb4f4618077106a622d3c", "url": "https://github.com/confluentinc/ksql/commit/6e5742803e5dbe22bb6eb4f4618077106a622d3c", "message": "rename", "committedDate": "2020-12-18T03:35:43Z", "type": "commit"}]}