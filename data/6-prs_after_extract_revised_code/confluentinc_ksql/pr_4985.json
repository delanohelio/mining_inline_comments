{"pr_number": 4985, "pr_title": "fix: Don't set chunked transfer encoding for HTTP2 proxy", "pr_createdAt": "2020-04-03T10:00:57Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4985", "timeline": [{"oid": "b78c56c95fcf4a590684d47f73084121dd4ce260", "url": "https://github.com/confluentinc/ksql/commit/b78c56c95fcf4a590684d47f73084121dd4ce260", "message": "Do not set trailers for http2", "committedDate": "2020-04-08T09:55:44Z", "type": "forcePushed"}, {"oid": "75898f1383f982ea081447ab53ac88b7ab9810f9", "url": "https://github.com/confluentinc/ksql/commit/75898f1383f982ea081447ab53ac88b7ab9810f9", "message": "Remove unused method that was signalling deprecation warning", "committedDate": "2020-04-08T13:32:18Z", "type": "forcePushed"}, {"oid": "010eb11585e7ad4e7efea2fd71e18d2883d65d89", "url": "https://github.com/confluentinc/ksql/commit/010eb11585e7ad4e7efea2fd71e18d2883d65d89", "message": "do not set transfer encoding chunked for http2 proxied responses", "committedDate": "2020-04-08T13:56:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk4NjgyMg==", "url": "https://github.com/confluentinc/ksql/pull/4985#discussion_r406986822", "bodyText": "These debug messages don't look like they're meant to be in this PR.", "author": "vcrfxia", "createdAt": "2020-04-10T23:52:55Z", "path": "ksqldb-execution/src/main/java/io/confluent/ksql/services/DisabledKsqlClient.java", "diffHunk": "@@ -34,7 +34,10 @@ public static DisabledKsqlClient instance() {\n     return new DisabledKsqlClient();\n   }\n \n+  private final Exception createStack;\n+\n   private DisabledKsqlClient() {\n+    this.createStack = new Exception();", "originalCommit": "010eb11585e7ad4e7efea2fd71e18d2883d65d89", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "734d63a2f438b636243559103100045a504f9f0d", "chunk": "diff --git a/ksqldb-execution/src/main/java/io/confluent/ksql/services/DisabledKsqlClient.java b/ksqldb-execution/src/main/java/io/confluent/ksql/services/DisabledKsqlClient.java\nindex d6b13c40de..a14fd37995 100644\n--- a/ksqldb-execution/src/main/java/io/confluent/ksql/services/DisabledKsqlClient.java\n+++ b/ksqldb-execution/src/main/java/io/confluent/ksql/services/DisabledKsqlClient.java\n\n@@ -34,10 +34,7 @@ public final class DisabledKsqlClient implements SimpleKsqlClient {\n     return new DisabledKsqlClient();\n   }\n \n-  private final Exception createStack;\n-\n   private DisabledKsqlClient() {\n-    this.createStack = new Exception();\n   }\n \n   @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5NTIwMQ==", "url": "https://github.com/confluentinc/ksql/pull/4985#discussion_r406995201", "bodyText": "What changed in this PR that this now needs to be specified?", "author": "vcrfxia", "createdAt": "2020-04-11T00:47:57Z", "path": "ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/ShowQueriesMultiNodeFunctionalTest.java", "diffHunk": "@@ -59,11 +57,13 @@\n       .builder(TEST_HARNESS::kafkaBootstrapServers)\n       .withProperty(KsqlRestConfig.LISTENERS_CONFIG, \"http://localhost:8088\")\n       .withProperty(KsqlRestConfig.ADVERTISED_LISTENER_CONFIG, \"http://localhost:8088\")\n+      .withEnabledKsqlClient()", "originalCommit": "010eb11585e7ad4e7efea2fd71e18d2883d65d89", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzAzMzQwOA==", "url": "https://github.com/confluentinc/ksql/pull/4985#discussion_r407033408", "bodyText": "This is because after rebasing with master the branch started failing tests. I looked into this and it seems there was a change recently where a DisabledKsqlClient is now used by default in tests, so any tests that do node-node communication are going to fail (i.e. this one). I don't really know why this test didn't fail in master too. Perhaps @AlanConfluent  or @stevenpyzhang has an insight? But explicitly requesting a non disabled KsqlClient seemed to fix things.", "author": "purplefox", "createdAt": "2020-04-11T08:03:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjk5NTIwMQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "734d63a2f438b636243559103100045a504f9f0d", "url": "https://github.com/confluentinc/ksql/commit/734d63a2f438b636243559103100045a504f9f0d", "message": "do not set transfer encoding chunked for http2 proxied responses", "committedDate": "2020-04-15T07:49:02Z", "type": "commit"}, {"oid": "d21211bcddabf21619485d1d62749e4a318395db", "url": "https://github.com/confluentinc/ksql/commit/d21211bcddabf21619485d1d62749e4a318395db", "message": "Make sure proxy handler is created on the server verticle context and make sure we also proxy connection close", "committedDate": "2020-04-15T07:49:02Z", "type": "commit"}, {"oid": "bee202e417f0680857c30119e1bddbfcb6fe7ff8", "url": "https://github.com/confluentinc/ksql/commit/bee202e417f0680857c30119e1bddbfcb6fe7ff8", "message": "removed debug", "committedDate": "2020-04-15T07:50:05Z", "type": "commit"}, {"oid": "d0e5faac6b0613d7b06c85524cd023def4014e3f", "url": "https://github.com/confluentinc/ksql/commit/d0e5faac6b0613d7b06c85524cd023def4014e3f", "message": "Do not proxy close frame", "committedDate": "2020-04-15T07:50:10Z", "type": "commit"}, {"oid": "ed43e07cc94418194fdb1831cc8cd356bca3ccc9", "url": "https://github.com/confluentinc/ksql/commit/ed43e07cc94418194fdb1831cc8cd356bca3ccc9", "message": "checkstyle", "committedDate": "2020-04-15T07:50:10Z", "type": "commit"}, {"oid": "ed43e07cc94418194fdb1831cc8cd356bca3ccc9", "url": "https://github.com/confluentinc/ksql/commit/ed43e07cc94418194fdb1831cc8cd356bca3ccc9", "message": "checkstyle", "committedDate": "2020-04-15T07:50:10Z", "type": "forcePushed"}]}