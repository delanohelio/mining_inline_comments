{"pr_number": 6353, "pr_title": "feat: Add an endpoint for returning the query limit configuration", "pr_createdAt": "2020-10-02T21:37:55Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6353", "timeline": [{"oid": "95e4a3b43d9eca2b18fc7995ddc3d3a3a06852e5", "url": "https://github.com/confluentinc/ksql/commit/95e4a3b43d9eca2b18fc7995ddc3d3a3a06852e5", "message": "feat: Add an endpoint for returning the query limit configuration", "committedDate": "2020-10-02T18:29:55Z", "type": "commit"}, {"oid": "9da2fcc9f3d7d3c02e01603e93de2a69227571eb", "url": "https://github.com/confluentinc/ksql/commit/9da2fcc9f3d7d3c02e01603e93de2a69227571eb", "message": "fix merge conflict", "committedDate": "2020-10-02T18:34:54Z", "type": "commit"}, {"oid": "8b5a92a44c3569f6c2435d2b0b3aa41e7174ba56", "url": "https://github.com/confluentinc/ksql/commit/8b5a92a44c3569f6c2435d2b0b3aa41e7174ba56", "message": "fix compile error", "committedDate": "2020-10-05T21:48:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYwNzE3NA==", "url": "https://github.com/confluentinc/ksql/pull/6353#discussion_r500607174", "bodyText": "Even if this is immutable, it's good practice to use the interface Map here when declaring the variable.", "author": "spena", "createdAt": "2020-10-06T21:29:32Z", "path": "ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/ConfigResponse.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.entity;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.annotation.JsonSubTypes;\n+import com.google.common.collect.ImmutableMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+@JsonSubTypes({})\n+public class ConfigResponse {\n+  private final ImmutableMap<String, Object> configs;", "originalCommit": "8b5a92a44c3569f6c2435d2b0b3aa41e7174ba56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "851222a2390cc25a2e9825872addcaf9dd37e8b3", "chunk": "diff --git a/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/ConfigResponse.java b/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/ConfigResponse.java\nindex be5d49f858..8ca40b6166 100644\n--- a/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/ConfigResponse.java\n+++ b/ksqldb-rest-model/src/main/java/io/confluent/ksql/rest/entity/ConfigResponse.java\n\n@@ -21,18 +21,17 @@ import com.fasterxml.jackson.annotation.JsonCreator;\n import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n import com.fasterxml.jackson.annotation.JsonProperty;\n import com.fasterxml.jackson.annotation.JsonSubTypes;\n-import com.google.common.collect.ImmutableMap;\n import java.util.Map;\n import java.util.Objects;\n \n @JsonIgnoreProperties(ignoreUnknown = true)\n @JsonSubTypes({})\n public class ConfigResponse {\n-  private final ImmutableMap<String, Object> configs;\n+  private final Map<String, Object> configs;\n \n   @JsonCreator\n   public ConfigResponse(@JsonProperty(\"configs\") final Map<String, Object> configs) {\n-    this.configs = ImmutableMap.copyOf(requireNonNull(configs, \"configs\"));\n+    this.configs = requireNonNull(configs, \"configs\");\n   }\n \n   public Map<String, Object> getConfigs() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYxNzg5OQ==", "url": "https://github.com/confluentinc/ksql/pull/6353#discussion_r500617899", "bodyText": "Perhaps use visibleConfigs instead. Just to provide more meaning to what these configs are.", "author": "spena", "createdAt": "2020-10-06T21:53:50Z", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.resources;\n+\n+import io.confluent.ksql.rest.EndpointResponse;\n+import io.confluent.ksql.rest.entity.ConfigResponse;\n+import io.confluent.ksql.util.KsqlConfig;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ConfigResource {\n+  private final Map<String, Object> allowedConfigs = new HashMap<>();", "originalCommit": "8b5a92a44c3569f6c2435d2b0b3aa41e7174ba56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "851222a2390cc25a2e9825872addcaf9dd37e8b3", "chunk": "diff --git a/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java b/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\nindex d511d36671..4f0362b449 100644\n--- a/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\n+++ b/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\n\n@@ -23,14 +23,14 @@ import java.util.List;\n import java.util.Map;\n \n public class ConfigResource {\n-  private final Map<String, Object> allowedConfigs = new HashMap<>();\n+  private final Map<String, Object> visibleConfigs = new HashMap<>();\n \n   public ConfigResource(final KsqlConfig ksqlConfig) {\n-    setAllowedConfigs(ksqlConfig);\n+    setVisibleConfigs(ksqlConfig);\n   }\n \n-  private void setAllowedConfigs(final KsqlConfig ksqlConfig) {\n-    allowedConfigs.put(\n+  private void setVisibleConfigs(final KsqlConfig ksqlConfig) {\n+    visibleConfigs.put(\n         KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG,\n         ksqlConfig.getInt(KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG)\n     );\n"}}, {"oid": "851222a2390cc25a2e9825872addcaf9dd37e8b3", "url": "https://github.com/confluentinc/ksql/commit/851222a2390cc25a2e9825872addcaf9dd37e8b3", "message": "Address review comments", "committedDate": "2020-10-08T17:37:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY3OTAxNQ==", "url": "https://github.com/confluentinc/ksql/pull/6353#discussion_r502679015", "bodyText": "nit: generally good practice to avoid a double lookup. Obviously not so important here as it's not a perf critical area, but figured I'd drop the comment so it's top of mind next time :)\nObject value = visibleConfigs.get(config);\nif (value != null) {\n  configs.put(config, value)\n}", "author": "agavra", "createdAt": "2020-10-09T21:28:03Z", "path": "ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.rest.server.resources;\n+\n+import io.confluent.ksql.rest.EndpointResponse;\n+import io.confluent.ksql.rest.entity.ConfigResponse;\n+import io.confluent.ksql.util.KsqlConfig;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+public class ConfigResource {\n+  private final Map<String, Object> visibleConfigs = new HashMap<>();\n+\n+  public ConfigResource(final KsqlConfig ksqlConfig) {\n+    setVisibleConfigs(ksqlConfig);\n+  }\n+\n+  private void setVisibleConfigs(final KsqlConfig ksqlConfig) {\n+    visibleConfigs.put(\n+        KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG,\n+        ksqlConfig.getInt(KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG)\n+    );\n+  }\n+\n+  public EndpointResponse getConfigs(final List<String> requestedConfigs) {\n+    final Map<String, Object> configs = new HashMap<>();\n+    for (String config : requestedConfigs) {\n+      if (visibleConfigs.containsKey(config)) {\n+        configs.put(config, visibleConfigs.get(config));", "originalCommit": "851222a2390cc25a2e9825872addcaf9dd37e8b3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "db4461e452b039077cca5da89181fd636c305495", "chunk": "diff --git a/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java b/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\nindex 4f0362b449..7ff3ef897f 100644\n--- a/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\n+++ b/ksqldb-rest-app/src/main/java/io/confluent/ksql/rest/server/resources/ConfigResource.java\n\n@@ -39,8 +39,9 @@ public class ConfigResource {\n   public EndpointResponse getConfigs(final List<String> requestedConfigs) {\n     final Map<String, Object> configs = new HashMap<>();\n     for (String config : requestedConfigs) {\n-      if (visibleConfigs.containsKey(config)) {\n-        configs.put(config, visibleConfigs.get(config));\n+      final Object value = visibleConfigs.get(config);\n+      if (value != null) {\n+        configs.put(config, value);\n       }\n     }\n     return EndpointResponse.ok(new ConfigResponse(configs));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY3OTI0OA==", "url": "https://github.com/confluentinc/ksql/pull/6353#discussion_r502679248", "bodyText": "we should add tests to make sure that we don't accidentally leak any config that isn't in the allowed list of configs", "author": "agavra", "createdAt": "2020-10-09T21:28:45Z", "path": "ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java", "diffHunk": "@@ -289,6 +291,28 @@ public void shouldExecuteServerMetadataIdRequest() {\n     assertThat(response, is(notNullValue()));\n   }\n \n+  @Test\n+  public void shouldExecuteAllConfigsRequest() {", "originalCommit": "851222a2390cc25a2e9825872addcaf9dd37e8b3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "db4461e452b039077cca5da89181fd636c305495", "chunk": "diff --git a/ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java b/ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java\nindex 3f4ddc702c..c7f156878c 100644\n--- a/ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java\n+++ b/ksqldb-rest-app/src/test/java/io/confluent/ksql/rest/integration/RestApiTest.java\n\n@@ -305,7 +305,7 @@ public class RestApiTest {\n     // When:\n     final ConfigResponse response = RestIntegrationTestUtil.makeConfigRequest(\n         REST_APP,\n-        Arrays.asList(new String[] {\"foo\", KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG})\n+        Arrays.asList(new String[] {\"foo\", KsqlConfig.CONNECT_URL_PROPERTY, KsqlConfig.KSQL_ACTIVE_PERSISTENT_QUERY_LIMIT_CONFIG})\n     );\n \n     // Then:\n"}}, {"oid": "db4461e452b039077cca5da89181fd636c305495", "url": "https://github.com/confluentinc/ksql/commit/db4461e452b039077cca5da89181fd636c305495", "message": "Address review comments and update docs", "committedDate": "2020-10-09T23:24:17Z", "type": "commit"}]}