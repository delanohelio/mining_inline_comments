{"pr_number": 4952, "pr_title": "Support aliases in PARTITION BY and GROUP BY", "pr_createdAt": "2020-04-01T12:26:14Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4952", "timeline": [{"oid": "c6ac0317a8b497186865609926f40ae0b5661259", "url": "https://github.com/confluentinc/ksql/commit/c6ac0317a8b497186865609926f40ae0b5661259", "message": "chore: add PartitionBy type ready for aliasing", "committedDate": "2020-03-31T16:06:07Z", "type": "commit"}, {"oid": "d0c55d8475f846707c4cb94e535fb898e23cf915", "url": "https://github.com/confluentinc/ksql/commit/d0c55d8475f846707c4cb94e535fb898e23cf915", "message": "chore: wire up aliasing", "committedDate": "2020-04-01T12:14:16Z", "type": "commit"}, {"oid": "3abb2ab148d2b1a99bf563e6db04f4ea50dd9f09", "url": "https://github.com/confluentinc/ksql/commit/3abb2ab148d2b1a99bf563e6db04f4ea50dd9f09", "message": "chore: merge from master\n\nConflicting files\nksqldb-engine/src/main/java/io/confluent/ksql/analyzer/Analyzer.java\nksqldb-engine/src/main/java/io/confluent/ksql/structured/SchemaKStream.java\nksqldb-engine/src/test/java/io/confluent/ksql/structured/SchemaKStreamTest.java", "committedDate": "2020-04-07T10:07:09Z", "type": "commit"}, {"oid": "3d8872db4236ba72efc50c1ba348ba54466452f9", "url": "https://github.com/confluentinc/ksql/commit/3d8872db4236ba72efc50c1ba348ba54466452f9", "message": "chore: fix merge issue", "committedDate": "2020-04-07T10:29:15Z", "type": "commit"}, {"oid": "ebaa005b99ea2aa0387803b1c4530421eea3ec0e", "url": "https://github.com/confluentinc/ksql/commit/ebaa005b99ea2aa0387803b1c4530421eea3ec0e", "message": "chore: merge from master\n\nConflicting files\nksqldb-engine/src/main/java/io/confluent/ksql/engine/rewrite/AstSanitizer.java\nksqldb-engine/src/main/java/io/confluent/ksql/planner/LogicalPlanner.java\nksqldb-streams/src/main/java/io/confluent/ksql/execution/streams/GroupByParamsFactory.java", "committedDate": "2020-04-07T16:24:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwNDMyNw==", "url": "https://github.com/confluentinc/ksql/pull/4952#discussion_r405004327", "bodyText": "just wondering, why not just go through with it?", "author": "agavra", "createdAt": "2020-04-07T17:57:18Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/engine/rewrite/AstSanitizer.java", "diffHunk": "@@ -159,6 +163,56 @@ public static Statement sanitize(final Statement node, final MetaStore metaStore\n       );\n     }\n \n+    @Override\n+    protected Optional<AstNode> visitGroupBy(\n+        final GroupBy node,\n+        final StatementRewriter.Context<Void> context\n+    ) {\n+      final List<Expression> groupingExpressions = node.getGroupingExpressions();\n+\n+      if (node.getAlias().isPresent()\n+          && groupingExpressions.size() == 1\n+          && groupingExpressions.get(0) instanceof ColumnReferenceExp) {\n+\n+        final ColumnName groupByColName = ((ColumnReferenceExp) groupingExpressions.get(0))\n+            .getColumnName();\n+\n+        if (node.getAlias().get().equals(groupByColName)) {\n+          // Alias is a no-op - remove it:", "originalCommit": "d0c55d8475f846707c4cb94e535fb898e23cf915", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}