{"pr_number": 5194, "pr_title": "chore: add AS_VALUE Udf", "pr_createdAt": "2020-04-27T11:18:05Z", "pr_url": "https://github.com/confluentinc/ksql/pull/5194", "timeline": [{"oid": "a3c4f30afded7be385f198d663b33c0c7fb10189", "url": "https://github.com/confluentinc/ksql/commit/a3c4f30afded7be385f198d663b33c0c7fb10189", "message": "chore: add AS_VALUE Udf\n\nPart of [klip-24](https://github.com/confluentinc/ksql/pull/5115).\n\nA Udf that indicates that a key column in a projection should be copied into a value column, for example:\n\n```sql\n-- Given:\nCREATE STREAM INPUT (ID INT KEY, V0 INT, V1 INT) WITH (kafka_topic='input', value_format='JSON');\n\n-- When:\nCREATE STREAM OUTPUT AS SELECT ID, AS_VALUE(ID) AS ID_COPY, V1 FROM INPUT;\n\n-- Then:\n-- resulting schema: ID INT KEY, ID_COPY INT, V1 INT\n```\n\nNote, the UDF doesn't actually _do_ anything as yet. It requires the request of klip-24 to enable its true purpose.", "committedDate": "2020-04-27T11:17:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkyMjEyMA==", "url": "https://github.com/confluentinc/ksql/pull/5194#discussion_r415922120", "bodyText": "I think generics would work here:\npublic <T> T asValue(@UdfParameter final T val)", "author": "agavra", "createdAt": "2020-04-27T15:40:02Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/AsValue.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.function.udf;\n+\n+@SuppressWarnings(\"MethodMayBeStatic\")\n+@UdfDescription(name = \"AS_VALUE\", description = AsValue.DESCRIPTION)\n+public class AsValue {\n+\n+  static final String DESCRIPTION = \"Used exclusively in the projection of a query to allow a key\"\n+      + \"column to be copied into the value schema. Has no affect if used anywhere else.\";\n+\n+  @Udf\n+  public Boolean asValue(@UdfParameter final Boolean val) {\n+    return val;\n+  }", "originalCommit": "a3c4f30afded7be385f198d663b33c0c7fb10189", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAzMjA2OQ==", "url": "https://github.com/confluentinc/ksql/pull/5194#discussion_r416032069", "bodyText": "I'll give it a go.", "author": "big-andy-coates", "createdAt": "2020-04-27T18:02:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkyMjEyMA=="}], "type": "inlineReview", "revised_code": {"commit": "fb0fe7cac1f06e1403485de0ab2b8b9e8c8e0c18", "chunk": "diff --git a/ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/AsValue.java b/ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/AsValue.java\nindex dc3fd9dcb1..849081f6b6 100644\n--- a/ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/AsValue.java\n+++ b/ksqldb-engine/src/main/java/io/confluent/ksql/function/udf/AsValue.java\n\n@@ -23,27 +23,7 @@ public class AsValue {\n       + \"column to be copied into the value schema. Has no affect if used anywhere else.\";\n \n   @Udf\n-  public Boolean asValue(@UdfParameter final Boolean val) {\n-    return val;\n-  }\n-\n-  @Udf\n-  public Integer asValue(@UdfParameter final Integer val) {\n-    return val;\n-  }\n-\n-  @Udf\n-  public Long asValue(@UdfParameter final Long val) {\n-    return val;\n-  }\n-\n-  @Udf\n-  public Double asValue(@UdfParameter final Double val) {\n-    return val;\n-  }\n-\n-  @Udf\n-  public String asValue(@UdfParameter final String val) {\n+  public <T> T asValue(@UdfParameter final T val) {\n     return val;\n   }\n }\n"}}, {"oid": "fb0fe7cac1f06e1403485de0ab2b8b9e8c8e0c18", "url": "https://github.com/confluentinc/ksql/commit/fb0fe7cac1f06e1403485de0ab2b8b9e8c8e0c18", "message": "chore: simplify", "committedDate": "2020-04-27T21:21:37Z", "type": "commit"}, {"oid": "d118610349b122fc8648dbd2415790ec4ec75b4e", "url": "https://github.com/confluentinc/ksql/commit/d118610349b122fc8648dbd2415790ec4ec75b4e", "message": "chore: simplify", "committedDate": "2020-04-27T21:22:19Z", "type": "commit"}]}