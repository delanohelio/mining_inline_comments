{"pr_number": 1920, "pr_title": "[CALCITE-3894] The Union operation between DATE with TIMESTAMP return\u2026", "pr_createdAt": "2020-04-16T04:40:23Z", "pr_url": "https://github.com/apache/calcite/pull/1920", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMxOTM5Ng==", "url": "https://github.com/apache/calcite/pull/1920#discussion_r409319396", "bodyText": "between DATE with TIMESTAMP -> between DATE and TIMESTAMP ?", "author": "chunweilei", "createdAt": "2020-04-16T06:48:18Z", "path": "core/src/test/java/org/apache/calcite/test/JdbcTest.java", "diffHunk": "@@ -7401,6 +7401,20 @@ private void checkGetTimestamp(Connection con) throws SQLException {\n         .runs();\n   }\n \n+  /**\n+   * Test case for\n+   * <a href=\"https://issues.apache.org/jira/browse/CALCITE-3894\">[CALCITE-3894]\n+   * The Union operation between DATE with TIMESTAMP returns a wrong result</a>.\n+   */\n+  @Test public void testUnionDateTime() {\n+    CalciteAssert.AssertThat assertThat = CalciteAssert.that();\n+    String query = \"select * from (\\n\"", "originalCommit": "a047f60053b695789d0ba74152aef1073c332c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM1NzE5Mg==", "url": "https://github.com/apache/calcite/pull/1920#discussion_r409357192", "bodyText": "Yep, thanks.", "author": "danny0405", "createdAt": "2020-04-16T07:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTMxOTM5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "bd8b96888cf625a0c0ceeb826021f86e49ae9f57", "chunk": "diff --git a/core/src/test/java/org/apache/calcite/test/JdbcTest.java b/core/src/test/java/org/apache/calcite/test/JdbcTest.java\nindex 5e36781a2..4a4927f86 100644\n--- a/core/src/test/java/org/apache/calcite/test/JdbcTest.java\n+++ b/core/src/test/java/org/apache/calcite/test/JdbcTest.java\n\n@@ -7404,7 +7404,7 @@ private void checkGetTimestamp(Connection con) throws SQLException {\n   /**\n    * Test case for\n    * <a href=\"https://issues.apache.org/jira/browse/CALCITE-3894\">[CALCITE-3894]\n-   * The Union operation between DATE with TIMESTAMP returns a wrong result</a>.\n+   * SET operation between DATE and TIMESTAMP returns a wrong result</a>.\n    */\n   @Test public void testUnionDateTime() {\n     CalciteAssert.AssertThat assertThat = CalciteAssert.that();\n"}}, {"oid": "bd8b96888cf625a0c0ceeb826021f86e49ae9f57", "url": "https://github.com/apache/calcite/commit/bd8b96888cf625a0c0ceeb826021f86e49ae9f57", "message": "[CALCITE-3894] SET operation between DATE and TIMESTAMP returns a wrong result\n\nThe RelDataTypeFactory#leastRestrictive finds the common type for IN,\nCASE and SET operations. For common type with DATE and TIMESTAMP, it\nreturns DATE. The root cause is that rules in SqlTypeAssignmentRule\ndecide that DATE is assignable from TIMESTAMP, which is actually wrong.\nAlthough in Java, this assignment makes sense but that\ndoes not mean it's true in SQL, because DATE and TIMESTAMP have\ndifferent time unit.\n\nFix the rules in SqlTypeAssignmentRule and let the implicit type\ncoercion rule get involved.", "committedDate": "2020-04-16T08:08:53Z", "type": "commit"}, {"oid": "bd8b96888cf625a0c0ceeb826021f86e49ae9f57", "url": "https://github.com/apache/calcite/commit/bd8b96888cf625a0c0ceeb826021f86e49ae9f57", "message": "[CALCITE-3894] SET operation between DATE and TIMESTAMP returns a wrong result\n\nThe RelDataTypeFactory#leastRestrictive finds the common type for IN,\nCASE and SET operations. For common type with DATE and TIMESTAMP, it\nreturns DATE. The root cause is that rules in SqlTypeAssignmentRule\ndecide that DATE is assignable from TIMESTAMP, which is actually wrong.\nAlthough in Java, this assignment makes sense but that\ndoes not mean it's true in SQL, because DATE and TIMESTAMP have\ndifferent time unit.\n\nFix the rules in SqlTypeAssignmentRule and let the implicit type\ncoercion rule get involved.", "committedDate": "2020-04-16T08:08:53Z", "type": "forcePushed"}]}