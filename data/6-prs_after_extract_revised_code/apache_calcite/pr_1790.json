{"pr_number": 1790, "pr_title": "[CALCITE-3769] Deprecate TableScanRule", "pr_createdAt": "2020-02-07T09:10:29Z", "pr_url": "https://github.com/apache/calcite/pull/1790", "timeline": [{"oid": "b83a244312c9862938cb9c9cacc93428d2e6e786", "url": "https://github.com/apache/calcite/commit/b83a244312c9862938cb9c9cacc93428d2e6e786", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScan\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-07T09:41:34Z", "type": "forcePushed"}, {"oid": "86c5040807bfe061ccb0db8af67bd3bd72fd92ec", "url": "https://github.com/apache/calcite/commit/86c5040807bfe061ccb0db8af67bd3bd72fd92ec", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScan\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-07T10:15:16Z", "type": "forcePushed"}, {"oid": "b2cbc4a94f74bb80166b30d8864914e8f47f0082", "url": "https://github.com/apache/calcite/commit/b2cbc4a94f74bb80166b30d8864914e8f47f0082", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScanRule\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-09T02:51:54Z", "type": "forcePushed"}, {"oid": "de20b8280aebfde0f9afda7f2c8d7ee5418e44c5", "url": "https://github.com/apache/calcite/commit/de20b8280aebfde0f9afda7f2c8d7ee5418e44c5", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScanRule\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-10T04:30:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA4MDEzNw==", "url": "https://github.com/apache/calcite/pull/1790#discussion_r378080137", "bodyText": "This looks odd.\nCan you clarify why is this replacement needed?", "author": "vlsi", "createdAt": "2020-02-12T07:35:48Z", "path": "core/src/main/java/org/apache/calcite/tools/RelRunners.java", "diffHunk": "@@ -29,6 +35,19 @@ private RelRunners() {}\n \n   /** Runs a relational expression by creating a JDBC connection. */\n   public static PreparedStatement run(RelNode rel) {\n+    final RelShuttle shuttle = new RelHomogeneousShuttle() {\n+      @Override public RelNode visit(TableScan scan) {\n+        final RelOptTable table = scan.getTable();\n+        if (scan instanceof LogicalTableScan\n+            && Bindables.BindableTableScan.canHandle(table)) {\n+          // Always replace the LogicalTableScan with BindableTableScan\n+          // because it's implementation does not require a \"schema\" as context.\n+          return Bindables.BindableTableScan.create(scan.getCluster(), table);", "originalCommit": "de20b8280aebfde0f9afda7f2c8d7ee5418e44c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE3MjU0Nw==", "url": "https://github.com/apache/calcite/pull/1790#discussion_r378172547", "bodyText": "Because the Enumerables implementation needs a \"schema\" to look up for the table. but the RelRunners does not actually have a schema, the Bindables actually can implement that.", "author": "danny0405", "createdAt": "2020-02-12T10:45:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA4MDEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODE5NzI2Mw==", "url": "https://github.com/apache/calcite/pull/1790#discussion_r378197263", "bodyText": "Can the clients of Relrunners do the appropriate conversion instead?\norg.apache.calcite.tools.RelRunners#run API says nothing on what changes would it make to the input rel node.\nIt might be very unexpected for those who see just the call to RelRunners.run(root)).", "author": "vlsi", "createdAt": "2020-02-12T11:36:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA4MDEzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI0NTE2NA==", "url": "https://github.com/apache/calcite/pull/1790#discussion_r378245164", "bodyText": "The logic is the same compared to the old one. The RelRunners always run a logical plan.", "author": "danny0405", "createdAt": "2020-02-12T13:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA4MDEzNw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5d461de903dbc98ff99895204c96b0da6ed0552f", "url": "https://github.com/apache/calcite/commit/5d461de903dbc98ff99895204c96b0da6ed0552f", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScanRule\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-13T07:32:59Z", "type": "commit"}, {"oid": "5d461de903dbc98ff99895204c96b0da6ed0552f", "url": "https://github.com/apache/calcite/commit/5d461de903dbc98ff99895204c96b0da6ed0552f", "message": "[CALCITE-3769] Deprecate TableScanRule\n\n* Deprecate TableScanRule and always invoke RelOptTable#toRel for\nRelBuilder#scan\n* RelOptTableImpl#toRel does not translate to EnumerableTableScan\nanymore, the EnumerableTableScan conversion logic has been moved to\nEnumerableTableScanRule\n* Remove the BindableTableScanRule from the default prepare ruleset, we\nonly add it where we really need that\n* Fix the plan change", "committedDate": "2020-02-13T07:32:59Z", "type": "forcePushed"}]}