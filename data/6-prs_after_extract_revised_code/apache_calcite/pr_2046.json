{"pr_number": 2046, "pr_title": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "pr_createdAt": "2020-06-26T21:09:15Z", "pr_url": "https://github.com/apache/calcite/pull/2046", "timeline": [{"oid": "9005eb01e6c07e6edee3fec5c6ef4743de89e640", "url": "https://github.com/apache/calcite/commit/9005eb01e6c07e6edee3fec5c6ef4743de89e640", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-06-26T21:57:36Z", "type": "forcePushed"}, {"oid": "1104ac72a5f9c165a6a7673646d02e4475860fa3", "url": "https://github.com/apache/calcite/commit/1104ac72a5f9c165a6a7673646d02e4475860fa3", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-06-26T22:59:15Z", "type": "forcePushed"}, {"oid": "198bb8009a7fd77f3c675f1e21fe9a5cd61a08a6", "url": "https://github.com/apache/calcite/commit/198bb8009a7fd77f3c675f1e21fe9a5cd61a08a6", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-07-01T20:45:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MTAyNA==", "url": "https://github.com/apache/calcite/pull/2046#discussion_r449251024", "bodyText": "This test probably belongs more to SqlValidatorTest which has support to test for error (and validate error messages).`", "author": "laurentgo", "createdAt": "2020-07-02T20:29:30Z", "path": "core/src/test/java/org/apache/calcite/test/SqlToRelConverterTest.java", "diffHunk": "@@ -875,6 +877,20 @@ public final Sql sql(String sql) {\n     sql(sql).ok();\n   }\n \n+  /** Test case for\n+   * <a href=\"https://issues.apache.org/jira/browse/CALCITE-4092\">[CALCITE-4092]\n+   * NPE using WITH clause without a corresponding SELECT FROM</a>. */\n+  @Test void testWithNotSelected() {\n+    final String sql = \"with emp2 as (select max(empno) as empno from emp where empno > 10)\\n\"\n+        + \"select * from emp where empno < emp2.empno\";\n+    try {\n+      sql(sql).ok();", "originalCommit": "198bb8009a7fd77f3c675f1e21fe9a5cd61a08a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2NzgzNQ==", "url": "https://github.com/apache/calcite/pull/2046#discussion_r449267835", "bodyText": "You're right. I moved the test to SqlValidatorTest and made some adjustments accordingly.", "author": "James-Jeyun-Kim", "createdAt": "2020-07-02T21:11:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MTAyNA=="}], "type": "inlineReview", "revised_code": {"commit": "5f3a50f96bdd3a5d28162673b3361ffda8acbff3", "chunk": "diff --git a/core/src/test/java/org/apache/calcite/test/SqlToRelConverterTest.java b/core/src/test/java/org/apache/calcite/test/SqlToRelConverterTest.java\nindex 62c35a92a..26d8e4fbe 100644\n--- a/core/src/test/java/org/apache/calcite/test/SqlToRelConverterTest.java\n+++ b/core/src/test/java/org/apache/calcite/test/SqlToRelConverterTest.java\n\n@@ -877,20 +877,6 @@ public final Sql sql(String sql) {\n     sql(sql).ok();\n   }\n \n-  /** Test case for\n-   * <a href=\"https://issues.apache.org/jira/browse/CALCITE-4092\">[CALCITE-4092]\n-   * NPE using WITH clause without a corresponding SELECT FROM</a>. */\n-  @Test void testWithNotSelected() {\n-    final String sql = \"with emp2 as (select max(empno) as empno from emp where empno > 10)\\n\"\n-        + \"select * from emp where empno < emp2.empno\";\n-    try {\n-      sql(sql).ok();\n-    } catch  (Throwable ex) {\n-      assert ex instanceof CalciteContextException\n-          && ex.getCause() instanceof SqlValidatorException;\n-    }\n-  }\n-\n   /** Test case for\n    * <a href=\"https://issues.apache.org/jira/browse/CALCITE-309\">[CALCITE-309]\n    * WITH ... ORDER BY query gives AssertionError</a>. */\n"}}, {"oid": "5f3a50f96bdd3a5d28162673b3361ffda8acbff3", "url": "https://github.com/apache/calcite/commit/5f3a50f96bdd3a5d28162673b3361ffda8acbff3", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-07-02T21:07:58Z", "type": "forcePushed"}, {"oid": "e092e7f7eb4b3705fdee81d1311e25d50b73652c", "url": "https://github.com/apache/calcite/commit/e092e7f7eb4b3705fdee81d1311e25d50b73652c", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-07-02T21:17:04Z", "type": "forcePushed"}, {"oid": "13be558dc7873206dea54c214c461f8d879eccb2", "url": "https://github.com/apache/calcite/commit/13be558dc7873206dea54c214c461f8d879eccb2", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-07-02T21:41:22Z", "type": "commit"}, {"oid": "13be558dc7873206dea54c214c461f8d879eccb2", "url": "https://github.com/apache/calcite/commit/13be558dc7873206dea54c214c461f8d879eccb2", "message": "[CALCITE-4092] NPE using WITH clause without a corresponding SELECT FROM (James Kim)", "committedDate": "2020-07-02T21:41:22Z", "type": "forcePushed"}]}