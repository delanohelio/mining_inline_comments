{"pr_number": 1182, "pr_title": "exception if --privacy-marker-transaction-signing-key-file not specified in non-zero-gas network", "pr_createdAt": "2020-07-01T01:16:08Z", "pr_url": "https://github.com/hyperledger/besu/pull/1182", "timeline": [{"oid": "2cf400ac857ce3e21efc5c81327b7aad0b9243f4", "url": "https://github.com/hyperledger/besu/commit/2cf400ac857ce3e21efc5c81327b7aad0b9243f4", "message": "exception if min-gas-price > 0 and pmt key file not specified\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-06-30T23:14:39Z", "type": "commit"}, {"oid": "72975f9229f6913d4386e92b5c7b2d3188a5cecc", "url": "https://github.com/hyperledger/besu/commit/72975f9229f6913d4386e92b5c7b2d3188a5cecc", "message": "use compareTo\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-07-01T01:09:03Z", "type": "commit"}, {"oid": "b8ab243651764c412e25e3aa97acdb0a422620bc", "url": "https://github.com/hyperledger/besu/commit/b8ab243651764c412e25e3aa97acdb0a422620bc", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into 505", "committedDate": "2020-07-01T01:09:11Z", "type": "commit"}, {"oid": "65d78a54aa6f23f7d2b165a3b57053cecf458a1c", "url": "https://github.com/hyperledger/besu/commit/65d78a54aa6f23f7d2b165a3b57053cecf458a1c", "message": "reverted change to API\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-07-01T02:09:08Z", "type": "commit"}, {"oid": "f52e2b0e8dc1553aa59e3627c5d0782ce5f65ee0", "url": "https://github.com/hyperledger/besu/commit/f52e2b0e8dc1553aa59e3627c5d0782ce5f65ee0", "message": "Merge branch 'master' into 505", "committedDate": "2020-07-01T19:48:23Z", "type": "commit"}, {"oid": "b8d26f24a70319663960f21d240027c9d66f88ac", "url": "https://github.com/hyperledger/besu/commit/b8d26f24a70319663960f21d240027c9d66f88ac", "message": "Merge branch 'master' into 505", "committedDate": "2020-07-02T02:26:47Z", "type": "commit"}, {"oid": "f5a710ef3ba54510b8d3f02710a3f12203e21b77", "url": "https://github.com/hyperledger/besu/commit/f5a710ef3ba54510b8d3f02710a3f12203e21b77", "message": "Merge branch 'master' into 505", "committedDate": "2020-07-02T02:50:38Z", "type": "commit"}, {"oid": "b599cf9c5901ecf2090b938a446a30f997081eb3", "url": "https://github.com/hyperledger/besu/commit/b599cf9c5901ecf2090b938a446a30f997081eb3", "message": "Merge branch 'master' into 505", "committedDate": "2020-07-02T06:28:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NjEwMQ==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448776101", "bodyText": "\"set, each\" ?", "author": "mark-terry", "createdAt": "2020-07-02T06:30:06Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -909,7 +909,7 @@ void setBannedNodeIds(final List<String> values) {\n   @Option(\n       names = {\"--target-gas-limit\"},\n       description =\n-          \"Sets target gas limit per block. If set each blocks gas limit will approach this setting over time if the current gas limit is different.\")\n+          \"Sets target gas limit per block. If set each block's gas limit will approach this setting over time if the current gas limit is different.\")", "originalCommit": "b599cf9c5901ecf2090b938a446a30f997081eb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3OTgzOA==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448779838", "bodyText": "this sort of thing appears in the help both ways. If we're going to make it consistent that would be a bigger change than this PR.", "author": "macfarla", "createdAt": "2020-07-02T06:39:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NjEwMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NzM2OA==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448777368", "bodyText": "\"Private transactions cannot be signed by random (non-funded) accounts in paid gas networks\"\nWould you expect a user to connect that not specifying a key file will mean a random account is used? I'm not sure whether we can expect the user to have enough context to understand the last sentence.", "author": "mark-terry", "createdAt": "2020-07-02T06:33:22Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1882,6 +1882,16 @@ private PrivacyParameters privacyParameters() {\n         throw new ParameterException(\n             commandLine, \"Please specify Enclave public key file path to enable privacy\");\n       }\n+\n+      if (Wei.ZERO.compareTo(minTransactionGasPrice) < 0) {\n+        // if gas is required, cannot use random keys to sign private tx\n+        // ie --privacy-marker-transaction-signing-key-file must be set\n+        if (privacyMarkerTransactionSigningKeyPath == null) {\n+          throw new ParameterException(\n+              commandLine,\n+              \"Not a free gas network. --privacy-marker-transaction-signing-key-file must be specified and must be a funded account. Private transactions cannot be signed by random (non-funded) accounts in paid gas networks\");", "originalCommit": "b599cf9c5901ecf2090b938a446a30f997081eb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc4MDM0Mg==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448780342", "bodyText": "I got that from reading the docs. I think if you're using privacy you should read the docs. Also I asked @MadelineMurray to preapprove this error message", "author": "macfarla", "createdAt": "2020-07-02T06:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3NzM2OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3Nzk2Mw==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448777963", "bodyText": "Does it make sense to rely on a default non-zero gas price, or would it be clearer to have an explicit non-zero gas price?", "author": "mark-terry", "createdAt": "2020-07-02T06:35:02Z", "path": "besu/src/test/java/org/hyperledger/besu/cli/BesuCommandTest.java", "diffHunk": "@@ -3073,6 +3089,15 @@ public void onchainPrivacyAndMultiTenancyCannotBeUsedTogether() {\n         .startsWith(\"Privacy multi-tenancy and onchain privacy groups cannot be used together\");\n   }\n \n+  @Test\n+  public void privacyMarkerTransactionSigningKeyFileRequiredIfMinGasPriceNonZero() {\n+    parseCommand(\"--privacy-enabled\", \"--privacy-public-key-file\", ENCLAVE_PUBLIC_KEY_PATH);", "originalCommit": "b599cf9c5901ecf2090b938a446a30f997081eb3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3ODkxNA==", "url": "https://github.com/hyperledger/besu/pull/1182#discussion_r448778914", "bodyText": "changing this is outside the scope of this PR", "author": "macfarla", "createdAt": "2020-07-02T06:37:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODc3Nzk2Mw=="}], "type": "inlineReview", "revised_code": null}]}