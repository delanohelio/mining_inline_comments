{"pr_number": 349, "pr_title": "[BESU-184] Update PicoCLI to version 4.1.4", "pr_createdAt": "2020-01-31T02:06:19Z", "pr_url": "https://github.com/hyperledger/besu/pull/349", "timeline": [{"oid": "1eca7efae5702e8f650db5c27892e6a33058ca34", "url": "https://github.com/hyperledger/besu/commit/1eca7efae5702e8f650db5c27892e6a33058ca34", "message": "[BESU-184] Update picocli to 4.1.4.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-01-27T21:10:40Z", "type": "commit"}, {"oid": "8b09eb00604b034e54fece0f25b59b8a633a3142", "url": "https://github.com/hyperledger/besu/commit/8b09eb00604b034e54fece0f25b59b8a633a3142", "message": "[BESU-184] update picoCli to v.4.1.4\n\nOrdering of usage information is not 100% backwards compatible between 3.9.6 and 4.0.0\n\nOptions utilising Collectors now go through the default factory methods changed in v.4.0.0\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-01-31T02:01:54Z", "type": "commit"}, {"oid": "d0d8cc0894c250d8e868650a543f6dba8752c8a5", "url": "https://github.com/hyperledger/besu/commit/d0d8cc0894c250d8e868650a543f6dba8752c8a5", "message": "Merge remote-tracking branch 'origin/master' into BESU-184", "committedDate": "2020-01-31T02:02:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI5MjY2MA==", "url": "https://github.com/hyperledger/besu/pull/349#discussion_r373292660", "bodyText": "what is the actual difference here?", "author": "macfarla", "createdAt": "2020-01-31T02:36:01Z", "path": "besu/src/test/java/org/hyperledger/besu/cli/PublicKeySubCommandTest.java", "diffHunk": "@@ -52,10 +52,10 @@\n           + System.lineSeparator()\n           + \"This command outputs the node public key. Default output is standard output.\"\n           + System.lineSeparator()\n-          + \"      --to=<FILE>   File to write public key to instead of standard output\"\n-          + System.lineSeparator()\n           + \"  -h, --help        Show this help message and exit.\"\n           + System.lineSeparator()\n+          + \"      --to=<FILE>   File to write public key to instead of standard output\"\n+          + System.lineSeparator()", "originalCommit": "d0d8cc0894c250d8e868650a543f6dba8752c8a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI5MzQ2MQ==", "url": "https://github.com/hyperledger/besu/pull/349#discussion_r373293461", "bodyText": "basically the --to goes below help now because of ordering of the new picoCli", "author": "rolfyone", "createdAt": "2020-01-31T02:40:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI5MjY2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI5NTg0OA==", "url": "https://github.com/hyperledger/besu/pull/349#discussion_r373295848", "bodyText": "fair enough", "author": "macfarla", "createdAt": "2020-01-31T02:51:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI5MjY2MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "d4d480f91ed07be463f322bd7f8fe611403453e8", "url": "https://github.com/hyperledger/besu/commit/d4d480f91ed07be463f322bd7f8fe611403453e8", "message": "Merge remote-tracking branch 'upstream/master' into BESU-184", "committedDate": "2020-01-31T02:51:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgyODM4OA==", "url": "https://github.com/hyperledger/besu/pull/349#discussion_r373828388", "bodyText": "final Constructor<T> constructor = cls.getDeclaredConstructor();\n    try {\n      return constructor.newInstance();\n    } catch (Exception e) {\n      constructor.setAccessible(true);\n      return constructor.newInstance();\n    }\n\nis actually adapted from older (3.1.9) version of defaultFactory's create method. In other words, you don't need to create two method, following would do the trick:\n@Override\n  public <T> T create(final Class<T> cls) throws Exception {\n    if (CommandLine.IVersionProvider.class.isAssignableFrom(cls)) {\n      return (T) new VersionProvider(pluginVersionsProvider);\n    }\n\n    return CommandLine.defaultFactory().create(cls);\n  }", "author": "usmansaleem", "createdAt": "2020-02-02T08:27:24Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java", "diffHunk": "@@ -46,4 +45,13 @@ public BesuCommandCustomFactory(final PluginVersionsProvider pluginVersionsProvi\n       return constructor.newInstance();\n     }", "originalCommit": "d4d480f91ed07be463f322bd7f8fe611403453e8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b65e9280819924c8099e7f918b0f280ad5eba732", "chunk": "diff --git a/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java b/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\nindex 00467f4b9..086cbdd75 100644\n--- a/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\n+++ b/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\n\n@@ -32,24 +32,15 @@ public class BesuCommandCustomFactory implements CommandLine.IFactory {\n   }\n \n   @SuppressWarnings(\"unchecked\")\n-  private <T> T doCreate(final Class<T> cls) throws Exception {\n+  @Override\n+  public <T> T create(final Class<T> cls) throws Exception {\n     if (CommandLine.IVersionProvider.class.isAssignableFrom(cls)) {\n       return (T) new VersionProvider(pluginVersionsProvider);\n     }\n \n-    final Constructor<T> constructor = cls.getDeclaredConstructor();\n     try {\n+      final Constructor<T> constructor = cls.getDeclaredConstructor();\n       return constructor.newInstance();\n-    } catch (Exception e) {\n-      constructor.setAccessible(true);\n-      return constructor.newInstance();\n-    }\n-  }\n-\n-  @Override\n-  public <T> T create(final Class<T> cls) throws Exception {\n-    try {\n-      return doCreate(cls);\n     } catch (Exception e) {\n       return CommandLine.defaultFactory().create(cls);\n     }\n"}}, {"oid": "b65e9280819924c8099e7f918b0f280ad5eba732", "url": "https://github.com/hyperledger/besu/commit/b65e9280819924c8099e7f918b0f280ad5eba732", "message": "[BESU-184] changes per review comments.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-02-03T03:24:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzkwOTg4MQ==", "url": "https://github.com/hyperledger/besu/pull/349#discussion_r373909881", "bodyText": "This logic is already been performed in CommandLine.defaultFactory().create(cls) ... whats the point of repeating it here?", "author": "usmansaleem", "createdAt": "2020-02-03T03:28:58Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java", "diffHunk": "@@ -38,12 +38,11 @@ public BesuCommandCustomFactory(final PluginVersionsProvider pluginVersionsProvi\n       return (T) new VersionProvider(pluginVersionsProvider);\n     }\n \n-    final Constructor<T> constructor = cls.getDeclaredConstructor();\n     try {\n+      final Constructor<T> constructor = cls.getDeclaredConstructor();", "originalCommit": "b65e9280819924c8099e7f918b0f280ad5eba732", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f4e3ea2051f4ddb263b949b4b8f963625f44b73", "chunk": "diff --git a/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java b/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\nindex 086cbdd75..6144fc3e2 100644\n--- a/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\n+++ b/besu/src/main/java/org/hyperledger/besu/cli/util/BesuCommandCustomFactory.java\n\n@@ -38,11 +38,6 @@ public class BesuCommandCustomFactory implements CommandLine.IFactory {\n       return (T) new VersionProvider(pluginVersionsProvider);\n     }\n \n-    try {\n-      final Constructor<T> constructor = cls.getDeclaredConstructor();\n-      return constructor.newInstance();\n-    } catch (Exception e) {\n-      return CommandLine.defaultFactory().create(cls);\n-    }\n+    return CommandLine.defaultFactory().create(cls);\n   }\n }\n"}}, {"oid": "7f4e3ea2051f4ddb263b949b4b8f963625f44b73", "url": "https://github.com/hyperledger/besu/commit/7f4e3ea2051f4ddb263b949b4b8f963625f44b73", "message": "[BESU-184] changes per review comments.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-02-03T03:46:50Z", "type": "commit"}, {"oid": "df25af01e4fc3f389dacd3b58abb58fe6750d3f7", "url": "https://github.com/hyperledger/besu/commit/df25af01e4fc3f389dacd3b58abb58fe6750d3f7", "message": "Merge remote-tracking branch 'upstream/master' into BESU-184", "committedDate": "2020-02-03T04:33:04Z", "type": "commit"}, {"oid": "7f8aa5fae2bd17f584a27d1cd70959aea0064641", "url": "https://github.com/hyperledger/besu/commit/7f8aa5fae2bd17f584a27d1cd70959aea0064641", "message": "[BESU-184] changes per review comments.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-02-03T05:08:58Z", "type": "commit"}]}