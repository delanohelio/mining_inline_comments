{"pr_number": 1421, "pr_title": "[ECIP-1099] Implement ECIP 1099: Calibrate Epoch Duration", "pr_createdAt": "2020-10-06T21:13:47Z", "pr_url": "https://github.com/hyperledger/besu/pull/1421", "timeline": [{"oid": "349e7533f458d35e8b457b9f184bd20d085682f9", "url": "https://github.com/hyperledger/besu/commit/349e7533f458d35e8b457b9f184bd20d085682f9", "message": "Add genesis config parameter ecip1099Block\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-09-29T20:44:35Z", "type": "commit"}, {"oid": "f70f8380e6b6bdd548a6ef316fc3779f3fa3bf30", "url": "https://github.com/hyperledger/besu/commit/f70f8380e6b6bdd548a6ef316fc3779f3fa3bf30", "message": "add stub for epoch activation config\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-04T16:52:04Z", "type": "commit"}, {"oid": "9ba86700b1593ef7513b79926210165a8efddb35", "url": "https://github.com/hyperledger/besu/commit/9ba86700b1593ef7513b79926210165a8efddb35", "message": "add stubs for EtcBesuControllerBuilder\n\nthat will handle ECIP 1099 Colibrate Epoch Duration functionality\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-05T14:31:29Z", "type": "commit"}, {"oid": "22973df5f7518cc36df66356c18d5a80e2d56af3", "url": "https://github.com/hyperledger/besu/commit/22973df5f7518cc36df66356c18d5a80e2d56af3", "message": "introduce EtcHashMinerExecutor\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-05T20:43:20Z", "type": "commit"}, {"oid": "cae912285991a08456b34ca800bf4f819b2cf304", "url": "https://github.com/hyperledger/besu/commit/cae912285991a08456b34ca800bf4f819b2cf304", "message": "implement EtcHashMinerExecutor\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-05T22:21:30Z", "type": "commit"}, {"oid": "413019ae63806ba788d670aa238d6a20213e696a", "url": "https://github.com/hyperledger/besu/commit/413019ae63806ba788d670aa238d6a20213e696a", "message": "remove ecip1099 genesis config option\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T19:35:29Z", "type": "commit"}, {"oid": "524bfa8fa6d42a4c9d6dced494fde203d5a57b65", "url": "https://github.com/hyperledger/besu/commit/524bfa8fa6d42a4c9d6dced494fde203d5a57b65", "message": "apply spotless to code\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T19:47:46Z", "type": "commit"}, {"oid": "e58f103172ff1152057a162f8668035409624144", "url": "https://github.com/hyperledger/besu/commit/e58f103172ff1152057a162f8668035409624144", "message": "add test for Etc Hash epoch calculation\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T20:33:50Z", "type": "commit"}, {"oid": "15c7ba42e68dcb3e98bb20ef09cfde1a4d433345", "url": "https://github.com/hyperledger/besu/commit/15c7ba42e68dcb3e98bb20ef09cfde1a4d433345", "message": "cleanup comments, apply spotless\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T20:41:45Z", "type": "commit"}, {"oid": "a8595873ea12c43eecd538c193da40822b1bceab", "url": "https://github.com/hyperledger/besu/commit/a8595873ea12c43eecd538c193da40822b1bceab", "message": "make needed variables final\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T20:58:28Z", "type": "commit"}, {"oid": "1a68a212aea4617daffa84494fae603dd82f2fbb", "url": "https://github.com/hyperledger/besu/commit/1a68a212aea4617daffa84494fae603dd82f2fbb", "message": "update changelog\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-06T21:16:05Z", "type": "commit"}, {"oid": "7a53f9d1c881b0712e680ff7218ba90d6849aca2", "url": "https://github.com/hyperledger/besu/commit/7a53f9d1c881b0712e680ff7218ba90d6849aca2", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-06T21:18:16Z", "type": "commit"}, {"oid": "6235ce29205debd82b5f251b1fb4d08e8f3d9ee8", "url": "https://github.com/hyperledger/besu/commit/6235ce29205debd82b5f251b1fb4d08e8f3d9ee8", "message": "refactor code to add epochCalculator to EthHash\n\nAs suggested in comment removed EtcHash series of classes to keep\nexisting controller.\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-07T23:48:48Z", "type": "commit"}, {"oid": "760f80a9d2d430a5dea7dc0b1f78567da6f3b632", "url": "https://github.com/hyperledger/besu/commit/760f80a9d2d430a5dea7dc0b1f78567da6f3b632", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-08T00:02:19Z", "type": "commit"}, {"oid": "665d591053b5f62f435b582e7651fe762350a63e", "url": "https://github.com/hyperledger/besu/commit/665d591053b5f62f435b582e7651fe762350a63e", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-08T00:06:59Z", "type": "commit"}, {"oid": "a94b15f09d25cceff7721e6761cf15cdccdfa3f4", "url": "https://github.com/hyperledger/besu/commit/a94b15f09d25cceff7721e6761cf15cdccdfa3f4", "message": "use gas limit calculator\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-08T00:41:28Z", "type": "commit"}, {"oid": "77889ccc1d04647887843426ee09b24220073fbe", "url": "https://github.com/hyperledger/besu/commit/77889ccc1d04647887843426ee09b24220073fbe", "message": "fix imports\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-08T00:49:35Z", "type": "commit"}, {"oid": "f43c2df423dfdb5ee03b0ec360556f023db23e6c", "url": "https://github.com/hyperledger/besu/commit/f43c2df423dfdb5ee03b0ec360556f023db23e6c", "message": "run spotless apply\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-08T00:52:37Z", "type": "commit"}, {"oid": "6e2bb676d2ba37985a4800825b11041c042c822c", "url": "https://github.com/hyperledger/besu/commit/6e2bb676d2ba37985a4800825b11041c042c822c", "message": "fix imports\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-08T01:02:06Z", "type": "commit"}, {"oid": "4f86ab55884c6b3628142624fe7a85983a71124d", "url": "https://github.com/hyperledger/besu/commit/4f86ab55884c6b3628142624fe7a85983a71124d", "message": "fix comments\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-08T01:13:21Z", "type": "commit"}, {"oid": "7539202c1d690309d45665b91f4440b452272b27", "url": "https://github.com/hyperledger/besu/commit/7539202c1d690309d45665b91f4440b452272b27", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-08T13:57:42Z", "type": "commit"}, {"oid": "b72ee992557a920c5d61a99a406afa312cdfda76", "url": "https://github.com/hyperledger/besu/commit/b72ee992557a920c5d61a99a406afa312cdfda76", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-08T15:06:01Z", "type": "commit"}, {"oid": "1616d36a6607c1ca400e3485d559bbac720c08f5", "url": "https://github.com/hyperledger/besu/commit/1616d36a6607c1ca400e3485d559bbac720c08f5", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-08T17:30:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4MjMxOQ==", "url": "https://github.com/hyperledger/besu/pull/1421#discussion_r502282319", "bodyText": "How about putting  epochLength (or something like that) in place of a just to make it easier to read", "author": "matkt", "createdAt": "2020-10-09T08:49:12Z", "path": "config/src/main/java/org/hyperledger/besu/config/EthashConfigOptions.java", "diffHunk": "@@ -35,9 +35,14 @@ public OptionalLong getFixedDifficulty() {\n     return JsonUtil.getLong(ethashConfigRoot, \"fixeddifficulty\");\n   }\n \n+  public OptionalLong getEpochLengthActivationBlock() {\n+    return JsonUtil.getLong(ethashConfigRoot, \"epochlengthactivation\");\n+  }\n+\n   Map<String, Object> asMap() {\n     final ImmutableMap.Builder<String, Object> builder = ImmutableMap.builder();\n     getFixedDifficulty().ifPresent(l -> builder.put(\"fixeddifficulty\", l));\n+    getEpochLengthActivationBlock().ifPresent(a -> builder.put(\"epochlengthactivation\", a));", "originalCommit": "1616d36a6607c1ca400e3485d559bbac720c08f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjUwMDg0Ng==", "url": "https://github.com/hyperledger/besu/pull/1421#discussion_r502500846", "bodyText": "I removed getEpochLengthActivationBlock from EthashConfigOptions because I didn't need it (I created the param in  JsonGenesisConfigOptions instead, and forgot to remove it from here).", "author": "edwardmack", "createdAt": "2020-10-09T15:15:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4MjMxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "bde851fcd5715d01834234fbd3956d84f8265fac", "chunk": "diff --git a/config/src/main/java/org/hyperledger/besu/config/EthashConfigOptions.java b/config/src/main/java/org/hyperledger/besu/config/EthashConfigOptions.java\nindex ee7d2c0a4..3f8ad9eec 100644\n--- a/config/src/main/java/org/hyperledger/besu/config/EthashConfigOptions.java\n+++ b/config/src/main/java/org/hyperledger/besu/config/EthashConfigOptions.java\n\n@@ -35,14 +35,9 @@ public class EthashConfigOptions {\n     return JsonUtil.getLong(ethashConfigRoot, \"fixeddifficulty\");\n   }\n \n-  public OptionalLong getEpochLengthActivationBlock() {\n-    return JsonUtil.getLong(ethashConfigRoot, \"epochlengthactivation\");\n-  }\n-\n   Map<String, Object> asMap() {\n     final ImmutableMap.Builder<String, Object> builder = ImmutableMap.builder();\n     getFixedDifficulty().ifPresent(l -> builder.put(\"fixeddifficulty\", l));\n-    getEpochLengthActivationBlock().ifPresent(a -> builder.put(\"epochlengthactivation\", a));\n     return builder.build();\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5MjA4MA==", "url": "https://github.com/hyperledger/besu/pull/1421#discussion_r502292080", "bodyText": "I think we also need to add this ecip here in the code  (in the asMap method) \n  \n    \n      besu/config/src/main/java/org/hyperledger/besu/config/JsonGenesisConfigOptions.java\n    \n    \n         Line 336\n      in\n      1616d36\n    \n    \n    \n    \n\n        \n          \n           getEcip1017EraRounds().ifPresent(l -> builder.put(\"ecip1017EraRounds\", l));", "author": "matkt", "createdAt": "2020-10-09T09:06:11Z", "path": "config/src/main/java/org/hyperledger/besu/config/JsonGenesisConfigOptions.java", "diffHunk": "@@ -274,6 +275,11 @@ public OptionalLong getPhoenixBlockNumber() {\n     return getOptionalLong(\"phoenixblock\");\n   }\n \n+  @Override\n+  public OptionalLong getEcip1099BlockNumber() {\n+    return getOptionalLong(\"ecip1099block\");\n+  }\n+", "originalCommit": "1616d36a6607c1ca400e3485d559bbac720c08f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjUwMDk4OA==", "url": "https://github.com/hyperledger/besu/pull/1421#discussion_r502500988", "bodyText": "Added.", "author": "edwardmack", "createdAt": "2020-10-09T15:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI5MjA4MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "104f9a384b30a6317e5c0d0324362d74c1dabb29", "url": "https://github.com/hyperledger/besu/commit/104f9a384b30a6317e5c0d0324362d74c1dabb29", "message": "Merge branch 'master' into ed/ecip_1099", "committedDate": "2020-10-09T14:50:57Z", "type": "commit"}, {"oid": "bde851fcd5715d01834234fbd3956d84f8265fac", "url": "https://github.com/hyperledger/besu/commit/bde851fcd5715d01834234fbd3956d84f8265fac", "message": "add ecip1099Block option to asMap method\n\nSigned-off-by: Edward Mack <ed@edwardmack.com>", "committedDate": "2020-10-09T15:10:11Z", "type": "commit"}]}