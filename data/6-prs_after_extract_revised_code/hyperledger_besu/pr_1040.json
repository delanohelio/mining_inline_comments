{"pr_number": 1040, "pr_title": "Fix flaky test: Permissioning + IBFT stall", "pr_createdAt": "2020-06-04T06:58:21Z", "pr_url": "https://github.com/hyperledger/besu/pull/1040", "timeline": [{"oid": "0ae74205908cdc4e3c258674b1b9cc837c4b4233", "url": "https://github.com/hyperledger/besu/commit/0ae74205908cdc4e3c258674b1b9cc837c4b4233", "message": "added test that fails\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-05-20T04:19:26Z", "type": "commit"}, {"oid": "af2150e4c020e9d4f09a78a016efc2bfc4fdfe54", "url": "https://github.com/hyperledger/besu/commit/af2150e4c020e9d4f09a78a016efc2bfc4fdfe54", "message": "Revert \"added test that fails\"\n\nThis reverts commit 4d6de6df528882db4374b4a87c4a2485ab148e6a.\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-05-20T04:21:56Z", "type": "commit"}, {"oid": "ce6daf14bd07402ae9d70d91718d50c3c2e03d78", "url": "https://github.com/hyperledger/besu/commit/ce6daf14bd07402ae9d70d91718d50c3c2e03d78", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-05-21T20:37:58Z", "type": "commit"}, {"oid": "f2ed6426fc9abe6e66660a4394c62291856e357f", "url": "https://github.com/hyperledger/besu/commit/f2ed6426fc9abe6e66660a4394c62291856e357f", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-05-24T23:15:07Z", "type": "commit"}, {"oid": "6135b8c2afadcd86a348ea1f95ade3800bcf1f21", "url": "https://github.com/hyperledger/besu/commit/6135b8c2afadcd86a348ea1f95ade3800bcf1f21", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-05-27T05:50:41Z", "type": "commit"}, {"oid": "659831b6b163c4892066c208749801e1066d3d04", "url": "https://github.com/hyperledger/besu/commit/659831b6b163c4892066c208749801e1066d3d04", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-05-31T22:31:23Z", "type": "commit"}, {"oid": "121563821c3716d6f1bb805f403a850f9934a513", "url": "https://github.com/hyperledger/besu/commit/121563821c3716d6f1bb805f403a850f9934a513", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-06-01T22:55:40Z", "type": "commit"}, {"oid": "8c8ddfe2542944ddb2c2d907be1cf471dde71e2c", "url": "https://github.com/hyperledger/besu/commit/8c8ddfe2542944ddb2c2d907be1cf471dde71e2c", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-06-03T00:05:48Z", "type": "commit"}, {"oid": "b1b73fd235167d432354bc9436bc38b4a91447d9", "url": "https://github.com/hyperledger/besu/commit/b1b73fd235167d432354bc9436bc38b4a91447d9", "message": "Merge branch 'master' of https://github.com/hyperledger/besu", "committedDate": "2020-06-03T21:55:15Z", "type": "commit"}, {"oid": "46e27fd71dccf6d40c0574aa376ef89e4fd1de62", "url": "https://github.com/hyperledger/besu/commit/46e27fd71dccf6d40c0574aa376ef89e4fd1de62", "message": "check blocks are being produced BEFORE sending any transactions\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-06-04T02:25:52Z", "type": "commit"}, {"oid": "96e3a60abf7df9752c33d935bd580316efd22c88", "url": "https://github.com/hyperledger/besu/commit/96e3a60abf7df9752c33d935bd580316efd22c88", "message": "reduce number of validators, remove unnecessary checks for number of peers (this is already done in cluster.start) and reduce number of blocks we wait for\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-06-04T05:01:59Z", "type": "commit"}, {"oid": "9239252891990e24c0e4a8b2585b6c48605db63c", "url": "https://github.com/hyperledger/besu/commit/9239252891990e24c0e4a8b2585b6c48605db63c", "message": "imports\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-06-04T06:50:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA0NDczOA==", "url": "https://github.com/hyperledger/besu/pull/1040#discussion_r435044738", "bodyText": "Think we should check all nodes have progressed not just the bootnode. So something like permissionedCluster.verify(blockchain.reachesHeight(bootnode, 1, 120))", "author": "jframe", "createdAt": "2020-06-04T07:23:40Z", "path": "acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/permissioning/NodeSmartContractPermissioningIbftStallAcceptanceTest.java", "diffHunk": "@@ -73,12 +67,10 @@ public void restartedIbftClusterShouldNotStall() throws IOException {\n     bootnode.setPermissioningConfiguration(permissioningConfiguration);\n     nodeA.setPermissioningConfiguration(permissioningConfiguration);\n     nodeB.setPermissioningConfiguration(permissioningConfiguration);\n-    nodeC.setPermissioningConfiguration(permissioningConfiguration);\n-    nodeD.setPermissioningConfiguration(permissioningConfiguration);\n \n-    permissionedCluster.start(bootnode, nodeA, nodeB, nodeC, nodeD);\n+    permissionedCluster.start(bootnode, nodeA, nodeB);\n \n     // Verify blockchain is progressing\n-    waitForBlockHeight(bootnode, 15);\n+    bootnode.verify(blockchain.reachesHeight(bootnode, 1, 120));", "originalCommit": "9239252891990e24c0e4a8b2585b6c48605db63c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY2NDQwMQ==", "url": "https://github.com/hyperledger/besu/pull/1040#discussion_r435664401", "bodyText": "done", "author": "macfarla", "createdAt": "2020-06-05T03:01:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA0NDczOA=="}], "type": "inlineReview", "revised_code": {"commit": "78d8c579baddacb3a51e97fb09d2290b0732df82", "chunk": "diff --git a/acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/permissioning/NodeSmartContractPermissioningIbftStallAcceptanceTest.java b/acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/permissioning/NodeSmartContractPermissioningIbftStallAcceptanceTest.java\nindex fb5434d047..8334576369 100644\n--- a/acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/permissioning/NodeSmartContractPermissioningIbftStallAcceptanceTest.java\n+++ b/acceptance-tests/tests/src/test/java/org/hyperledger/besu/tests/acceptance/permissioning/NodeSmartContractPermissioningIbftStallAcceptanceTest.java\n\n@@ -71,6 +71,6 @@ public class NodeSmartContractPermissioningIbftStallAcceptanceTest\n     permissionedCluster.start(bootnode, nodeA, nodeB);\n \n     // Verify blockchain is progressing\n-    bootnode.verify(blockchain.reachesHeight(bootnode, 1, 120));\n+    permissionedCluster.verify(blockchain.reachesHeight(bootnode, 1, 120));\n   }\n }\n"}}, {"oid": "78d8c579baddacb3a51e97fb09d2290b0732df82", "url": "https://github.com/hyperledger/besu/commit/78d8c579baddacb3a51e97fb09d2290b0732df82", "message": "check status of cluster not a single node\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-06-05T01:54:26Z", "type": "commit"}, {"oid": "cb0f17c0b8dc38ceac68ecbd1d47ca3351acdedf", "url": "https://github.com/hyperledger/besu/commit/cb0f17c0b8dc38ceac68ecbd1d47ca3351acdedf", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into perm-ibft-stall-test", "committedDate": "2020-06-05T01:54:45Z", "type": "commit"}]}