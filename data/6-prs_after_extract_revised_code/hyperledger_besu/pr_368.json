{"pr_number": 368, "pr_title": "[BOUNTY-2] Add NAT Docker Support ", "pr_createdAt": "2020-02-05T21:37:28Z", "pr_url": "https://github.com/hyperledger/besu/pull/368", "timeline": [{"oid": "45e2c4ac15ec8e57d6b9f62f992b76af93541094", "url": "https://github.com/hyperledger/besu/commit/45e2c4ac15ec8e57d6b9f62f992b76af93541094", "message": "add docker detection\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-01-21T20:13:12Z", "type": "commit"}, {"oid": "d002b1213c27ccb3169e9d621cc9eccb3693ec44", "url": "https://github.com/hyperledger/besu/commit/d002b1213c27ccb3169e9d621cc9eccb3693ec44", "message": "add port mapping detection\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-02T15:37:29Z", "type": "commit"}, {"oid": "e10e9ca1c3c553ea941c89aac0a8d5ee500f5ca6", "url": "https://github.com/hyperledger/besu/commit/e10e9ca1c3c553ea941c89aac0a8d5ee500f5ca6", "message": "add tests and refactor ip detection\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-05T21:21:30Z", "type": "commit"}, {"oid": "3df06c0b2d8de29b4610a3863d70d95fa0f3d9a8", "url": "https://github.com/hyperledger/besu/commit/3df06c0b2d8de29b4610a3863d70d95fa0f3d9a8", "message": "clean RunnerBuilder\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-05T21:27:00Z", "type": "commit"}, {"oid": "ef679aa86ebdbb07714076c2f2838035cd79b3d6", "url": "https://github.com/hyperledger/besu/commit/ef679aa86ebdbb07714076c2f2838035cd79b3d6", "message": "clean useless modification\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-05T21:31:10Z", "type": "commit"}, {"oid": "aa85458f187e55c34da9c3a587f7bb9edaac97c5", "url": "https://github.com/hyperledger/besu/commit/aa85458f187e55c34da9c3a587f7bb9edaac97c5", "message": "spotless\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-05T22:58:06Z", "type": "commit"}, {"oid": "599de6788f9a0be7fcd0d915d14a0a22aabf5c93", "url": "https://github.com/hyperledger/besu/commit/599de6788f9a0be7fcd0d915d14a0a22aabf5c93", "message": "resolve tests issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-02-06T18:09:25Z", "type": "commit"}, {"oid": "fdcf72c0e8895f9f76e28e5aba39110262878f7e", "url": "https://github.com/hyperledger/besu/commit/fdcf72c0e8895f9f76e28e5aba39110262878f7e", "message": "Merge branch 'master' into feature/bounty-add-nat-docker-support", "committedDate": "2020-02-07T14:09:35Z", "type": "commit"}, {"oid": "803d345deaf09f02db0aa2bf948db6fc3a30ca32", "url": "https://github.com/hyperledger/besu/commit/803d345deaf09f02db0aa2bf948db6fc3a30ca32", "message": "Merge branch 'master' into feature/bounty-add-nat-docker-support", "committedDate": "2020-02-07T14:37:48Z", "type": "commit"}, {"oid": "066361ca048e8d7feb19d431e5dee768b970b185", "url": "https://github.com/hyperledger/besu/commit/066361ca048e8d7feb19d431e5dee768b970b185", "message": "streamline auto detection\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-02-07T18:16:30Z", "type": "commit"}, {"oid": "f89baf487d751588b3720ccd67b2f954573e879b", "url": "https://github.com/hyperledger/besu/commit/f89baf487d751588b3720ccd67b2f954573e879b", "message": "Merge pull request #15 from RatanRSur/feature/bounty-add-nat-docker-support\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>\r\n\r\nstreamline auto detection", "committedDate": "2020-02-07T19:21:31Z", "type": "commit"}, {"oid": "fc958ecb18d41ad61ebd75e4b9f9df70d84fa81c", "url": "https://github.com/hyperledger/besu/commit/fc958ecb18d41ad61ebd75e4b9f9df70d84fa81c", "message": "Merge branch 'master' into feature/bounty-add-nat-docker-support", "committedDate": "2020-02-10T07:50:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE3MzkwNA==", "url": "https://github.com/hyperledger/besu/pull/368#discussion_r377173904", "bodyText": "How does this behave if you don't supply the HOST_IP env var to the docker command?", "author": "RatanRSur", "createdAt": "2020-02-10T16:31:26Z", "path": "nat/src/main/java/org/hyperledger/besu/nat/docker/HostBasedIpDetector.java", "diffHunk": "@@ -13,25 +13,22 @@\n  * SPDX-License-Identifier: Apache-2.0\n  */\n \n-package org.hyperledger.besu.nat.core;\n+package org.hyperledger.besu.nat.docker;\n \n-import org.hyperledger.besu.nat.NatMethod;\n+import java.net.InetAddress;\n+import java.net.UnknownHostException;\n+import java.util.Optional;\n \n-public class AutoDetectionResult {\n+public class HostBasedIpDetector implements IpDetector {\n \n-  private final NatMethod natMethod;\n-  private final boolean isDetectedNatMethod;\n+  private static final String HOSTNAME = \"HOST_IP\";\n \n-  public AutoDetectionResult(final NatMethod natMethod, final boolean isDetectedNatMethod) {\n-    this.natMethod = natMethod;\n-    this.isDetectedNatMethod = isDetectedNatMethod;\n-  }\n-\n-  public NatMethod getNatMethod() {\n-    return natMethod;\n-  }\n-\n-  public boolean isDetectedNatMethod() {\n-    return isDetectedNatMethod;\n+  @Override\n+  public Optional<String> detectExternalIp() {\n+    try {\n+      return Optional.of(InetAddress.getByName(HOSTNAME).getHostAddress());", "originalCommit": "fc958ecb18d41ad61ebd75e4b9f9df70d84fa81c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzI1NzAwOQ==", "url": "https://github.com/hyperledger/besu/pull/368#discussion_r377257009", "bodyText": "if you don't supply the HOST_IP en var the NatManager will try to retrieve the value of the p2p-host CLI parameter given when besu started. If this parameter is not given it will be the default value of p2p-host as described in the code below.\n  private String p2pHost = autoDiscoverDefaultIP().getHostAddress();\n\nTo sum up:\n\nHOST_IP env var\np2p-host CLI parameter given when besu started\ndefault value of p2p-host", "author": "matkt", "createdAt": "2020-02-10T19:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE3MzkwNA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "399ea929d5859c00f58beea73af34f272a7b3380", "url": "https://github.com/hyperledger/besu/commit/399ea929d5859c00f58beea73af34f272a7b3380", "message": "Merge branch 'master' into feature/bounty-add-nat-docker-support", "committedDate": "2020-02-10T19:51:21Z", "type": "commit"}]}