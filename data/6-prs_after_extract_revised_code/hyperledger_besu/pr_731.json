{"pr_number": 731, "pr_title": "[BESU-507] Resolve crashing NAT detectors on GKE", "pr_createdAt": "2020-04-16T16:30:50Z", "pr_url": "https://github.com/hyperledger/besu/pull/731", "timeline": [{"oid": "2fc0324e250aba56b7a963b4dd2edeb53491a50f", "url": "https://github.com/hyperledger/besu/commit/2fc0324e250aba56b7a963b4dd2edeb53491a50f", "message": "Log to trace denied because of host whitelisting (#663)\n\nWhen we deny a connection based on HTTP hostname log to trace the\nrejected value.\n\nSigned-off-by: Danno Ferrin <danno.ferrin@gmail.com>\nCo-authored-by: Usman Saleem <usman@usmans.info>\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-08T08:37:23Z", "type": "commit"}, {"oid": "d521961d5be749f4195aa06c64cf69ddec500976", "url": "https://github.com/hyperledger/besu/commit/d521961d5be749f4195aa06c64cf69ddec500976", "message": "Merge branch 'master' of https://github.com/hyperledger/besu into develop\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-10T07:52:44Z", "type": "commit"}, {"oid": "20e595679c69a376fcf0cfe40fbf6cb84adfdaa0", "url": "https://github.com/hyperledger/besu/commit/20e595679c69a376fcf0cfe40fbf6cb84adfdaa0", "message": "fix crashing NAT detectors on GKE\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-16T16:03:31Z", "type": "commit"}, {"oid": "0a98f4c2fb70fbc902e8b153bf880f3670f9cc91", "url": "https://github.com/hyperledger/besu/commit/0a98f4c2fb70fbc902e8b153bf880f3670f9cc91", "message": "Merge commit '4a8f9996d9d3c59ced73188650efa14c6ff42326' into feature/besu-507-crash-gke-nat-detector\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-16T16:06:01Z", "type": "commit"}, {"oid": "b2d4f2fa5d636e7fc41ba3975e4df6e41c5f1900", "url": "https://github.com/hyperledger/besu/commit/b2d4f2fa5d636e7fc41ba3975e4df6e41c5f1900", "message": "Merge branch 'master' into feature/besu-507-crash-gke-nat-detector", "committedDate": "2020-04-17T08:16:49Z", "type": "commit"}, {"oid": "a53f060dea3b1e29422574a792646d91134d2e78", "url": "https://github.com/hyperledger/besu/commit/a53f060dea3b1e29422574a792646d91134d2e78", "message": "fix review issues\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-17T08:20:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA2NzMzOA==", "url": "https://github.com/hyperledger/besu/pull/731#discussion_r410067338", "bodyText": "I suggest no to use pegasys as default namespace value. Rather use besu. And maybe make it configurable through env variable", "author": "abdelhamidbakhta", "createdAt": "2020-04-17T08:20:21Z", "path": "nat/src/main/java/org/hyperledger/besu/nat/kubernetes/KubernetesNatManager.java", "diffHunk": "@@ -48,8 +45,8 @@\n public class KubernetesNatManager extends AbstractNatManager {\n   protected static final Logger LOG = LogManager.getLogger();\n \n-  private static final String KUBE_CONFIG_PATH_ENV = \"KUBE_CONFIG_PATH\";\n-  private static final String DEFAULT_KUBE_CONFIG_PATH = \"~/.kube/config\";\n+  private static final String DEFAULT_SERVICE_NAMESPACE = \"pegasys\";", "originalCommit": "b2d4f2fa5d636e7fc41ba3975e4df6e41c5f1900", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7fb7ea309cbd36210ae37c64f2195a13a21158d4", "chunk": "diff --git a/nat/src/main/java/org/hyperledger/besu/nat/kubernetes/KubernetesNatManager.java b/nat/src/main/java/org/hyperledger/besu/nat/kubernetes/KubernetesNatManager.java\nindex ab84fbfeee..1f81fcd89a 100644\n--- a/nat/src/main/java/org/hyperledger/besu/nat/kubernetes/KubernetesNatManager.java\n+++ b/nat/src/main/java/org/hyperledger/besu/nat/kubernetes/KubernetesNatManager.java\n\n@@ -45,7 +46,9 @@ import org.apache.logging.log4j.Logger;\n public class KubernetesNatManager extends AbstractNatManager {\n   protected static final Logger LOG = LogManager.getLogger();\n \n-  private static final String DEFAULT_SERVICE_NAMESPACE = \"pegasys\";\n+  private static final String BESU_NAMESPACE_ENV = \"BESU_NAMESPACE\";\n+\n+  private static final String DEFAULT_SERVICE_NAMESPACE = \"besu\";\n \n   private static final String DEFAULT_BESU_POD_NAME_FILTER = \"besu\";\n \n"}}, {"oid": "7fb7ea309cbd36210ae37c64f2195a13a21158d4", "url": "https://github.com/hyperledger/besu/commit/7fb7ea309cbd36210ae37c64f2195a13a21158d4", "message": "Merge commit 'b2d4f2fa5d636e7fc41ba3975e4df6e41c5f1900' into feature/besu-507-crash-gke-nat-detector\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-17T08:21:56Z", "type": "commit"}, {"oid": "696d6d06d41b4097643f9e65285d2a0621a445a7", "url": "https://github.com/hyperledger/besu/commit/696d6d06d41b4097643f9e65285d2a0621a445a7", "message": "fix IP detection for Kubernetes\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-17T12:09:19Z", "type": "commit"}, {"oid": "04f0ca83b6b05553a3d848fe0f5b1f9c21157c31", "url": "https://github.com/hyperledger/besu/commit/04f0ca83b6b05553a3d848fe0f5b1f9c21157c31", "message": "fix pipeline\n\nSigned-off-by: Karim TAAM <karim.t2am@gmail.com>", "committedDate": "2020-04-17T12:32:34Z", "type": "commit"}]}