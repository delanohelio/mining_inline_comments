{"pr_number": 1253, "pr_title": "Hide AtomicReference from Inheritors", "pr_createdAt": "2020-07-23T23:08:34Z", "pr_url": "https://github.com/hyperledger/besu/pull/1253", "timeline": [{"oid": "12dd936a68466d130e234733c825cba0e3a0fe66", "url": "https://github.com/hyperledger/besu/commit/12dd936a68466d130e234733c825cba0e3a0fe66", "message": "hide AtomicReference form inheritors\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-07-23T22:55:10Z", "type": "commit"}, {"oid": "6046c969e58b7d1af3ecea00dd05995f2f719898", "url": "https://github.com/hyperledger/besu/commit/6046c969e58b7d1af3ecea00dd05995f2f719898", "message": "clean up state utilities\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-07-23T23:00:25Z", "type": "commit"}, {"oid": "195c8adef076c82e152cf7f2e46e9a0f3b7bc3c3", "url": "https://github.com/hyperledger/besu/commit/195c8adef076c82e152cf7f2e46e9a0f3b7bc3c3", "message": "spotless\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-07-23T23:02:14Z", "type": "commit"}, {"oid": "4624f056bf7506b9ccbe5d140b4096eab8a6850d", "url": "https://github.com/hyperledger/besu/commit/4624f056bf7506b9ccbe5d140b4096eab8a6850d", "message": "Merge branch 'master' into remove-atomic-reference", "committedDate": "2020-07-23T23:10:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTI1MA==", "url": "https://github.com/hyperledger/besu/pull/1253#discussion_r459971250", "bodyText": "I'm not sure why we should remove isSucceeded but we should keep isFailed. maybe I missed something", "author": "matkt", "createdAt": "2020-07-24T10:23:01Z", "path": "ethereum/eth/src/test/java/org/hyperledger/besu/ethereum/eth/manager/EthSchedulerTest.java", "diffHunk": "@@ -205,7 +205,6 @@ public void timeout_cancelsTaskWhenResultIsCancelled() {\n     result.cancel(false);\n     assertThat(task.isDone()).isTrue();\n     assertThat(task.isFailed()).isTrue();\n-    assertThat(task.isSucceeded()).isFalse();", "originalCommit": "4624f056bf7506b9ccbe5d140b4096eab8a6850d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDA0OTUwNQ==", "url": "https://github.com/hyperledger/besu/pull/1253#discussion_r460049505", "bodyText": "I removed the method entirely and here because this was the only place it was used and if the previous two assertions, isDone and isFailed are true, isSucceeded can never be true.", "author": "RatanRSur", "createdAt": "2020-07-24T13:24:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTI1MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NDQ5Mg==", "url": "https://github.com/hyperledger/besu/pull/1253#discussion_r463264492", "bodyText": "isDone instead of isCancelled?  Can we re-execute something that completed normally?  isDone catches any termination.\nAlso, perhaps move the started before the cancelled/done check?", "author": "shemnon", "createdAt": "2020-07-30T20:52:48Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/task/AbstractEthTask.java", "diffHunk": "@@ -69,44 +71,39 @@ public double stopTimer() {\n \n   @Override\n   public final CompletableFuture<T> run() {\n-    if (result.compareAndSet(null, new CompletableFuture<>())) {\n+    if (!result.isCancelled() && started.compareAndSet(false, true)) {", "originalCommit": "4624f056bf7506b9ccbe5d140b4096eab8a6850d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk0NTg4NQ==", "url": "https://github.com/hyperledger/besu/pull/1253#discussion_r467945885", "bodyText": "You're right, I think it should be isDone.", "author": "RatanRSur", "createdAt": "2020-08-10T14:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NDQ5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "02da3913e979452c00bb02d03a56a503947571a6", "chunk": "diff --git a/ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/task/AbstractEthTask.java b/ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/task/AbstractEthTask.java\nindex 7b673936f..3ee0ecec3 100644\n--- a/ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/task/AbstractEthTask.java\n+++ b/ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/task/AbstractEthTask.java\n\n@@ -71,7 +71,7 @@ public abstract class AbstractEthTask<T> implements EthTask<T> {\n \n   @Override\n   public final CompletableFuture<T> run() {\n-    if (!result.isCancelled() && started.compareAndSet(false, true)) {\n+    if (!result.isDone() && started.compareAndSet(false, true)) {\n       executeTaskTimed();\n       result.whenComplete((r, t) -> cleanup());\n     }\n"}}, {"oid": "02da3913e979452c00bb02d03a56a503947571a6", "url": "https://github.com/hyperledger/besu/commit/02da3913e979452c00bb02d03a56a503947571a6", "message": "isComplete -> isDone\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-08-10T14:33:51Z", "type": "commit"}, {"oid": "55c88c5b96df3baca5f523261a7716475a89d5c7", "url": "https://github.com/hyperledger/besu/commit/55c88c5b96df3baca5f523261a7716475a89d5c7", "message": "Merge remote-tracking branch 'upstream/master' into remove-atomic-reference", "committedDate": "2020-08-10T14:36:40Z", "type": "commit"}]}