{"pr_number": 1145, "pr_title": "[#519] - Enable http/2 support for Json RPC Http API over TLS", "pr_createdAt": "2020-06-25T07:22:05Z", "pr_url": "https://github.com/hyperledger/besu/pull/1145", "timeline": [{"oid": "057dcab39d9cdb5f63a179546e98f04775670660", "url": "https://github.com/hyperledger/besu/commit/057dcab39d9cdb5f63a179546e98f04775670660", "message": "[#519] - Enable http/2 support for Json RPC Http API over TLS'\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-25T07:20:10Z", "type": "commit"}, {"oid": "be40719adf83f556d46d3fb2c09bca83503fdcc8", "url": "https://github.com/hyperledger/besu/commit/be40719adf83f556d46d3fb2c09bca83503fdcc8", "message": "Merge remote-tracking branch 'upstream/master' into tls_http2\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-25T23:56:40Z", "type": "commit"}, {"oid": "d0fb145e695f431c89ab82a72a535f382fc847eb", "url": "https://github.com/hyperledger/besu/commit/d0fb145e695f431c89ab82a72a535f382fc847eb", "message": "Update TLS test to assert that http2 protocol is used\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-26T00:37:56Z", "type": "commit"}, {"oid": "7ff215870056a7e9a781e972374ea55f08e58201", "url": "https://github.com/hyperledger/besu/commit/7ff215870056a7e9a781e972374ea55f08e58201", "message": "Merge remote-tracking branch 'upstream/master' into tls_http2\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-29T01:17:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjczMzY4Mw==", "url": "https://github.com/hyperledger/besu/pull/1145#discussion_r446733683", "bodyText": "Is it possible to have a test for http 1 as well? As all existing tests will be implicitly testing http/2 now that we have http 2 support in our service", "author": "jframe", "createdAt": "2020-06-29T01:58:37Z", "path": "ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpServiceTlsTest.java", "diffHunk": "@@ -185,15 +186,15 @@ public void shutdownServer() {\n   }\n \n   @Test\n-  public void netVersionSuccessfulOnTls() throws Exception {\n+  public void netVersionSuccessfulOnTlsWithHttp2() throws Exception {", "originalCommit": "7ff215870056a7e9a781e972374ea55f08e58201", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MDM2NQ==", "url": "https://github.com/hyperledger/besu/pull/1145#discussion_r446750365", "bodyText": "Added testing against both http1_1 and http2.", "author": "usmansaleem", "createdAt": "2020-06-29T03:18:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjczMzY4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f6c1f339c71143f5be06c90ac38920aab2c2fa29", "chunk": "diff --git a/ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpServiceTlsTest.java b/ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpServiceTlsTest.java\nindex 006110345..08735aefc 100644\n--- a/ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpServiceTlsTest.java\n+++ b/ethereum/api/src/test/java/org/hyperledger/besu/ethereum/api/jsonrpc/JsonRpcHttpServiceTlsTest.java\n\n@@ -185,16 +186,25 @@ public class JsonRpcHttpServiceTlsTest {\n     service.stop().join();\n   }\n \n+  @Test\n+  public void netVersionSuccessfulOnTlsWithHttp1_1() throws Exception {\n+    netVersionSuccessfulOnTls(true);\n+  }\n+\n   @Test\n   public void netVersionSuccessfulOnTlsWithHttp2() throws Exception {\n+    netVersionSuccessfulOnTls(false);\n+  }\n+\n+  public void netVersionSuccessfulOnTls(final boolean useHttp1) throws Exception {\n     final String id = \"123\";\n     final String json =\n         \"{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"id\\\":\" + Json.encode(id) + \",\\\"method\\\":\\\"net_version\\\"}\";\n \n-    final OkHttpClient httpClient = getTlsHttpClient();\n+    final OkHttpClient httpClient = getTlsHttpClient(useHttp1);\n     try (final Response response = httpClient.newCall(buildPostRequest(json)).execute()) {\n       assertThat(response.code()).isEqualTo(200);\n-      assertThat(response.protocol()).isEqualTo(Protocol.HTTP_2);\n+      assertThat(response.protocol()).isEqualTo(useHttp1 ? HTTP_1_1 : HTTP_2);\n       // Check general format of result\n       final ResponseBody body = response.body();\n       assertThat(body).isNotNull();\n"}}, {"oid": "f6c1f339c71143f5be06c90ac38920aab2c2fa29", "url": "https://github.com/hyperledger/besu/commit/f6c1f339c71143f5be06c90ac38920aab2c2fa29", "message": "Use both http1_1 and http2 in unit test\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-29T03:16:59Z", "type": "commit"}, {"oid": "117f619481b9b9971162faf45fbe1c45125271dc", "url": "https://github.com/hyperledger/besu/commit/117f619481b9b9971162faf45fbe1c45125271dc", "message": "Add missing final keyword\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-29T03:22:07Z", "type": "commit"}, {"oid": "b61ee6c88624c13496d9e50b96988da677d766d6", "url": "https://github.com/hyperledger/besu/commit/b61ee6c88624c13496d9e50b96988da677d766d6", "message": "Merge remote-tracking branch 'upstream/master' into tls_http2\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-06-29T22:10:12Z", "type": "commit"}, {"oid": "7dedd17b1bb108cce17c111c364df1f5131efb46", "url": "https://github.com/hyperledger/besu/commit/7dedd17b1bb108cce17c111c364df1f5131efb46", "message": "Merge remote-tracking branch 'upstream/master' into tls_http2\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-07-01T02:28:26Z", "type": "commit"}, {"oid": "c31c820911bacd42460ac27a99f0e99d0eda3d92", "url": "https://github.com/hyperledger/besu/commit/c31c820911bacd42460ac27a99f0e99d0eda3d92", "message": "Merge remote-tracking branch 'upstream/master' into tls_http2\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-07-02T00:18:48Z", "type": "commit"}]}