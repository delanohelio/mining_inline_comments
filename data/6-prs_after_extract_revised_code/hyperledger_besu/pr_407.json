{"pr_number": 407, "pr_title": "[PIE-2303] Automatic log bloom caching - Remove usage of pending file.", "pr_createdAt": "2020-02-17T09:38:28Z", "pr_url": "https://github.com/hyperledger/besu/pull/407", "timeline": [{"oid": "d576fc4ea2e24c13bfc3cb5d81dcaf3580b92283", "url": "https://github.com/hyperledger/besu/commit/d576fc4ea2e24c13bfc3cb5d81dcaf3580b92283", "message": "Don't use pending file.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-02-17T09:37:42Z", "type": "commit"}, {"oid": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea", "url": "https://github.com/hyperledger/besu/commit/6de9fa9d7fa4edaec21776c66d6dca90c7d101ea", "message": "Don't use pending file.\n\nSigned-off-by: Abdelhamid Bakhta <abdelhamid.bakhta@consensys.net>", "committedDate": "2020-02-17T09:43:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE5OTc5Ng==", "url": "https://github.com/hyperledger/besu/pull/407#discussion_r380199796", "bodyText": "Why did ensureChecks get introduced? Performance reasons?", "author": "RatanRSur", "createdAt": "2020-02-17T14:04:28Z", "path": "ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/query/TransactionLogBloomCacher.java", "diffHunk": "@@ -134,15 +126,19 @@ private long fillCacheFile(\n       cachingStatus.currentBlock = blockNum;\n       blockNum++;\n     }\n-    return blockNum - startBlock;\n   }\n \n-  public void cacheLogsBloomForBlockHeader(final BlockHeader blockHeader) {\n+  public void cacheLogsBloomForBlockHeader(\n+      final BlockHeader blockHeader,\n+      final Optional<File> reusedCacheFile,\n+      final boolean ensureChecks) {\n     try {\n       final long blockNumber = blockHeader.getNumber();\n       LOG.debug(\"Caching logs bloom for block {}.\", \"0x\" + Long.toHexString(blockNumber));\n-      ensurePreviousSegmentsArePresent(blockNumber);\n-      final File cacheFile = calculateCacheFileName(blockNumber, cacheDir);\n+      if (ensureChecks) {", "originalCommit": "6de9fa9d7fa4edaec21776c66d6dca90c7d101ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwMDM5Mg==", "url": "https://github.com/hyperledger/besu/pull/407#discussion_r380200392", "bodyText": "Yeah. At some places we don't want to do always this check", "author": "abdelhamidbakhta", "createdAt": "2020-02-17T14:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE5OTc5Ng=="}], "type": "inlineReview", "revised_code": null}]}