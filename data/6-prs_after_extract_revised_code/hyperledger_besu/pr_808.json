{"pr_number": 808, "pr_title": "Remove references and logic of system property besu.docker", "pr_createdAt": "2020-04-29T00:58:04Z", "pr_url": "https://github.com/hyperledger/besu/pull/808", "timeline": [{"oid": "d6b2988fafe9204438e9aaf12f8a393c9f4e95b3", "url": "https://github.com/hyperledger/besu/commit/d6b2988fafe9204438e9aaf12f8a393c9f4e95b3", "message": "remove isDocker references from BesuCommand\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T00:07:44Z", "type": "commit"}, {"oid": "93bb1ca32e6845a3c0a90a7e31aab2dfdadb5c70", "url": "https://github.com/hyperledger/besu/commit/93bb1ca32e6845a3c0a90a7e31aab2dfdadb5c70", "message": "Updating unit tests that used besu.docker system property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T00:56:18Z", "type": "commit"}, {"oid": "65e4a7c1386192bec7ca9905e32bc6c73315c726", "url": "https://github.com/hyperledger/besu/commit/65e4a7c1386192bec7ca9905e32bc6c73315c726", "message": "constructor fix\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T01:01:18Z", "type": "commit"}, {"oid": "e3d82b713ca02012f3999efc16d6ffa7b89bbace", "url": "https://github.com/hyperledger/besu/commit/e3d82b713ca02012f3999efc16d6ffa7b89bbace", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T01:03:19Z", "type": "commit"}, {"oid": "7bf8859bdee88fccf88605bc0ae67711a3ebe956", "url": "https://github.com/hyperledger/besu/commit/7bf8859bdee88fccf88605bc0ae67711a3ebe956", "message": "Updating unit tests that used besu.docker system property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T01:17:51Z", "type": "commit"}, {"oid": "255576afff3daa56365b14aba31eff75497f3fcd", "url": "https://github.com/hyperledger/besu/commit/255576afff3daa56365b14aba31eff75497f3fcd", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T03:57:39Z", "type": "commit"}, {"oid": "99606aa2baa3cc8f64384d7ed5a326a600c8e84e", "url": "https://github.com/hyperledger/besu/commit/99606aa2baa3cc8f64384d7ed5a326a600c8e84e", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T20:10:21Z", "type": "commit"}, {"oid": "4f73c2f6b8a0c54a71dc79ee72c4e28a12a3bd83", "url": "https://github.com/hyperledger/besu/commit/4f73c2f6b8a0c54a71dc79ee72c4e28a12a3bd83", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-04-29T20:32:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMTQwNw==", "url": "https://github.com/hyperledger/besu/pull/808#discussion_r417701407", "bodyText": "Doesn't seem to be much benefit in wrapping this in a function", "author": "jframe", "createdAt": "2020-04-30T01:13:58Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1960,42 +1954,19 @@ private String genesisConfig() {\n   }\n \n   private File genesisFile() {", "originalCommit": "4f73c2f6b8a0c54a71dc79ee72c4e28a12a3bd83", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "967b86a6824f6492aea4fa13ea3a85f5a7ef5281", "chunk": "diff --git a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\nindex d8612574e4..e3ec1129da 100644\n--- a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n+++ b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\n@@ -1946,19 +2034,16 @@ public class BesuCommand implements DefaultCommandValues, Runnable {\n \n   private String genesisConfig() {\n     try {\n-      return Resources.toString(genesisFile().toURI().toURL(), UTF_8);\n+      return Resources.toString(genesisFile.toURI().toURL(), UTF_8);\n     } catch (final IOException e) {\n       throw new ParameterException(\n-          this.commandLine, String.format(\"Unable to load genesis file %s.\", genesisFile()), e);\n+          this.commandLine, String.format(\"Unable to load genesis file %s.\", genesisFile), e);\n     }\n   }\n \n-  private File genesisFile() {\n-    return standaloneCommands.genesisFile;\n-  }\n-\n+  // dataDir() is public because it is accessed by subcommands\n   public Path dataDir() {\n-    return standaloneCommands.dataPath.toAbsolutePath();\n+    return dataPath.toAbsolutePath();\n   }\n \n   private Path pluginsDir() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMTUyMg==", "url": "https://github.com/hyperledger/besu/pull/808#discussion_r417701522", "bodyText": "Same as above, think we can inline this function where it is needed", "author": "jframe", "createdAt": "2020-04-30T01:14:23Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -1960,42 +1954,19 @@ private String genesisConfig() {\n   }\n \n   private File genesisFile() {\n-    if (isFullInstantiation()) {\n-      return standaloneCommands.genesisFile;\n-    } else if (isDocker) {\n-      final File genesisFile = new File(DOCKER_GENESIS_LOCATION);\n-      if (genesisFile.exists()) {\n-        return genesisFile;\n-      } else {\n-        return null;\n-      }\n-    } else {\n-      return null;\n-    }\n+    return standaloneCommands.genesisFile;\n   }\n \n   public Path dataDir() {\n-    if (isFullInstantiation()) {\n-      return standaloneCommands.dataPath.toAbsolutePath();\n-    } else if (isDocker) {\n-      return Paths.get(DOCKER_DATADIR_LOCATION);\n-    } else {\n-      return getDefaultBesuDataPath(this);\n-    }\n+    return standaloneCommands.dataPath.toAbsolutePath();", "originalCommit": "4f73c2f6b8a0c54a71dc79ee72c4e28a12a3bd83", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "967b86a6824f6492aea4fa13ea3a85f5a7ef5281", "chunk": "diff --git a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\nindex d8612574e4..e3ec1129da 100644\n--- a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n+++ b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\n@@ -1946,19 +2034,16 @@ public class BesuCommand implements DefaultCommandValues, Runnable {\n \n   private String genesisConfig() {\n     try {\n-      return Resources.toString(genesisFile().toURI().toURL(), UTF_8);\n+      return Resources.toString(genesisFile.toURI().toURL(), UTF_8);\n     } catch (final IOException e) {\n       throw new ParameterException(\n-          this.commandLine, String.format(\"Unable to load genesis file %s.\", genesisFile()), e);\n+          this.commandLine, String.format(\"Unable to load genesis file %s.\", genesisFile), e);\n     }\n   }\n \n-  private File genesisFile() {\n-    return standaloneCommands.genesisFile;\n-  }\n-\n+  // dataDir() is public because it is accessed by subcommands\n   public Path dataDir() {\n-    return standaloneCommands.dataPath.toAbsolutePath();\n+    return dataPath.toAbsolutePath();\n   }\n \n   private Path pluginsDir() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNDk1Nw==", "url": "https://github.com/hyperledger/besu/pull/808#discussion_r418624957", "bodyText": "Is folding StandaloneCommand back into Besu Command part of this PR or a follow on PR?", "author": "shemnon", "createdAt": "2020-05-01T16:41:22Z", "path": "besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java", "diffHunk": "@@ -991,9 +986,7 @@ void setBesuConfiguration(final BesuConfiguration pluginCommonConfiguration) {\n \n   private BesuCommand handleStandaloneCommand() {\n     standaloneCommands = new StandaloneCommand();", "originalCommit": "4f73c2f6b8a0c54a71dc79ee72c4e28a12a3bd83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE4NTU2Nw==", "url": "https://github.com/hyperledger/besu/pull/808#discussion_r419185567", "bodyText": "I missed that bit, I've added it into same PR.", "author": "usmansaleem", "createdAt": "2020-05-04T01:24:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNDk1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "967b86a6824f6492aea4fa13ea3a85f5a7ef5281", "chunk": "diff --git a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\nindex d8612574e4..e3ec1129da 100644\n--- a/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n+++ b/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java\n\n@@ -984,12 +1077,6 @@ public class BesuCommand implements DefaultCommandValues, Runnable {\n     this.pluginCommonConfiguration = pluginCommonConfiguration;\n   }\n \n-  private BesuCommand handleStandaloneCommand() {\n-    standaloneCommands = new StandaloneCommand();\n-    commandLine.addMixin(\"standaloneCommands\", standaloneCommands);\n-    return this;\n-  }\n-\n   private BesuCommand enableExperimentalEIPs() {\n     // Usage of static command line flags is strictly reserved for experimental EIPs\n     commandLine.addMixin(\"experimentalEIPs\", ExperimentalEIPs.class);\n"}}, {"oid": "1f09b8673c3e050e7fe12251af005d694e0ee52c", "url": "https://github.com/hyperledger/besu/commit/1f09b8673c3e050e7fe12251af005d694e0ee52c", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-05-04T00:47:13Z", "type": "commit"}, {"oid": "967b86a6824f6492aea4fa13ea3a85f5a7ef5281", "url": "https://github.com/hyperledger/besu/commit/967b86a6824f6492aea4fa13ea3a85f5a7ef5281", "message": "Review suggestion - Removing StandaloneCommand and moving options back into BesuCommand\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-05-04T01:17:26Z", "type": "commit"}, {"oid": "84685f23b5251a2733014cc95b6461bc5988c29f", "url": "https://github.com/hyperledger/besu/commit/84685f23b5251a2733014cc95b6461bc5988c29f", "message": "Merge remote-tracking branch 'upstream/master' into docker_system_property\n\nSigned-off-by: Usman Saleem <usman@usmans.info>", "committedDate": "2020-05-04T23:29:30Z", "type": "commit"}]}