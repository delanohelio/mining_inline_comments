{"pr_number": 1021, "pr_title": "Add gauge to time mark duration", "pr_createdAt": "2020-06-02T15:17:17Z", "pr_url": "https://github.com/hyperledger/besu/pull/1021", "timeline": [{"oid": "1f4fb1d55b1d7faa32edc5585dc952bcb7e25e9c", "url": "https://github.com/hyperledger/besu/commit/1f4fb1d55b1d7faa32edc5585dc952bcb7e25e9c", "message": "add gauge\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-06-02T15:15:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1NzQyMQ==", "url": "https://github.com/hyperledger/besu/pull/1021#discussion_r433957421", "bodyText": "Cumulative or per marking run?  Worth adding some verbiage to the help text to make it clear.", "author": "shemnon", "createdAt": "2020-06-02T15:18:40Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java", "diffHunk": "@@ -94,6 +97,13 @@ public MarkSweepPruner(\n             BesuMetricCategory.PRUNER,\n             \"sweep_operations_total\",\n             \"Total number of sweep operations performed\");\n+\n+    markStopwatch = Stopwatch.createUnstarted();\n+    metricsSystem.createLongGauge(\n+        BesuMetricCategory.PRUNER,\n+        \"mark_time_duration\",\n+        \"Total number of seconds spent marking the state trie\",", "originalCommit": "1f4fb1d55b1d7faa32edc5585dc952bcb7e25e9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk4MzY3OA==", "url": "https://github.com/hyperledger/besu/pull/1021#discussion_r433983678", "bodyText": "resolved", "author": "RatanRSur", "createdAt": "2020-06-02T15:51:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1NzQyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "368471e423310d9721aeb6f5eb480ac6c4c60bf4", "chunk": "diff --git a/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java b/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\nindex ab52c7d23..64a794b8f 100644\n--- a/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\n+++ b/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\n\n@@ -102,7 +102,7 @@ public class MarkSweepPruner {\n     metricsSystem.createLongGauge(\n         BesuMetricCategory.PRUNER,\n         \"mark_time_duration\",\n-        \"Total number of seconds spent marking the state trie\",\n+        \"Cumulative number of seconds spent marking the state trie across all pruning cycles\",\n         () -> markStopwatch.elapsed(TimeUnit.SECONDS));\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1ODg0NQ==", "url": "https://github.com/hyperledger/besu/pull/1021#discussion_r433958845", "bodyText": "Is MarkSweepPruner a singleton for the life of the java process?  Counters can handle multiple counters, gauges will throw an exception when the second gauge is created.", "author": "shemnon", "createdAt": "2020-06-02T15:20:37Z", "path": "ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java", "diffHunk": "@@ -94,6 +97,13 @@ public MarkSweepPruner(\n             BesuMetricCategory.PRUNER,\n             \"sweep_operations_total\",\n             \"Total number of sweep operations performed\");\n+\n+    markStopwatch = Stopwatch.createUnstarted();\n+    metricsSystem.createLongGauge(", "originalCommit": "1f4fb1d55b1d7faa32edc5585dc952bcb7e25e9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1OTU2Ng==", "url": "https://github.com/hyperledger/besu/pull/1021#discussion_r433959566", "bodyText": "Yup, it's a singleton", "author": "RatanRSur", "createdAt": "2020-06-02T15:21:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzk1ODg0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "368471e423310d9721aeb6f5eb480ac6c4c60bf4", "chunk": "diff --git a/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java b/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\nindex ab52c7d23..64a794b8f 100644\n--- a/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\n+++ b/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/worldstate/MarkSweepPruner.java\n\n@@ -102,7 +102,7 @@ public class MarkSweepPruner {\n     metricsSystem.createLongGauge(\n         BesuMetricCategory.PRUNER,\n         \"mark_time_duration\",\n-        \"Total number of seconds spent marking the state trie\",\n+        \"Cumulative number of seconds spent marking the state trie across all pruning cycles\",\n         () -> markStopwatch.elapsed(TimeUnit.SECONDS));\n   }\n \n"}}, {"oid": "368471e423310d9721aeb6f5eb480ac6c4c60bf4", "url": "https://github.com/hyperledger/besu/commit/368471e423310d9721aeb6f5eb480ac6c4c60bf4", "message": "clarify\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-06-02T15:22:54Z", "type": "commit"}, {"oid": "28c646c753283a87b0a2d6130d7ad5af0048873d", "url": "https://github.com/hyperledger/besu/commit/28c646c753283a87b0a2d6130d7ad5af0048873d", "message": "Merge branch 'master' into pruner-time-gauge", "committedDate": "2020-06-02T15:53:15Z", "type": "commit"}, {"oid": "b2179f430f9cd476462ffaaccc6423c2999bc477", "url": "https://github.com/hyperledger/besu/commit/b2179f430f9cd476462ffaaccc6423c2999bc477", "message": "Merge branch 'master' into pruner-time-gauge", "committedDate": "2020-06-02T18:52:29Z", "type": "commit"}, {"oid": "0669f2838e8ed389a6245bb018d92490425135a8", "url": "https://github.com/hyperledger/besu/commit/0669f2838e8ed389a6245bb018d92490425135a8", "message": "Merge branch 'master' into pruner-time-gauge", "committedDate": "2020-06-03T16:05:23Z", "type": "commit"}]}