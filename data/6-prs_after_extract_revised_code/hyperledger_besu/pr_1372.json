{"pr_number": 1372, "pr_title": "Don't Fail When Encountering Evicted Pooled Transaction Hash", "pr_createdAt": "2020-09-09T21:38:41Z", "pr_url": "https://github.com/hyperledger/besu/pull/1372", "timeline": [{"oid": "fbf8c575db9aac73a94a9be8ec296dc401f69668", "url": "https://github.com/hyperledger/besu/commit/fbf8c575db9aac73a94a9be8ec296dc401f69668", "message": "ignore evicted hashes\n\nSigned-off-by: Ratan Rai Sur <ratan.r.sur@gmail.com>", "committedDate": "2020-09-09T21:30:51Z", "type": "commit"}, {"oid": "3c4a9a6d3707b025b64e687d574605096a368c7e", "url": "https://github.com/hyperledger/besu/commit/3c4a9a6d3707b025b64e687d574605096a368c7e", "message": "Merge branch 'master' into concurrent-modifiation", "committedDate": "2020-09-09T21:38:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzOTM3NQ==", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485939375", "bodyText": "I'm assuming there is some reason to go from a for loop iteration to a direct iterator.  Is it because the iterator handles the unstable collection better?", "author": "shemnon", "createdAt": "2020-09-09T21:44:41Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/TransactionPool.java", "diffHunk": "@@ -126,12 +128,19 @@ void handleConnect(final EthPeer peer) {\n     for (final Transaction transaction : localTransactions) {\n       peerTransactionTracker.addToPeerSendQueue(peer, transaction);\n     }\n-    peerPendingTransactionTracker.ifPresent(\n+    maybePeerPendingTransactionTracker.ifPresent(\n         peerPendingTransactionTracker -> {\n           if (peerPendingTransactionTracker.isPeerSupported(peer, EthProtocol.ETH65)) {\n-            final Collection<Hash> hashes = getNewPooledHashes();\n-            for (final Hash hash : hashes) {\n-              peerPendingTransactionTracker.addToPeerSendQueue(peer, hash);\n+            Iterator<Hash> hashIterator = getNewPooledHashes().iterator();", "originalCommit": "3c4a9a6d3707b025b64e687d574605096a368c7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MTUyNg==", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485941526", "bodyText": "As far as I know you can't catch the exception and continue over the syntactic sugar iterator.", "author": "RatanRSur", "createdAt": "2020-09-09T21:49:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTkzOTM3NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MDk3Mw==", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485940973", "bodyText": "Why do we need to specialize this type to EveictingQueue?  Isn't iterator available in Queue via the Collection supertype?", "author": "shemnon", "createdAt": "2020-09-09T21:48:12Z", "path": "ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/transactions/PendingTransactions.java", "diffHunk": "@@ -67,7 +66,7 @@\n   private final int maxTransactionRetentionHours;\n   private final Clock clock;\n \n-  private final Queue<Hash> newPooledHashes;\n+  private final EvictingQueue<Hash> newPooledHashes;", "originalCommit": "3c4a9a6d3707b025b64e687d574605096a368c7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0Mjc0Mw==", "url": "https://github.com/hyperledger/besu/pull/1372#discussion_r485942743", "bodyText": "I was just making it more specific since I was here anyways. Return specific, accept general and all that.", "author": "RatanRSur", "createdAt": "2020-09-09T21:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk0MDk3Mw=="}], "type": "inlineReview", "revised_code": null}]}