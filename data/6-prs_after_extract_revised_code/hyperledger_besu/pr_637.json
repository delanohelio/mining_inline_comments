{"pr_number": 637, "pr_title": "Added block add event.", "pr_createdAt": "2020-04-01T17:25:45Z", "pr_url": "https://github.com/hyperledger/besu/pull/637", "timeline": [{"oid": "22ea9f574f77a8ed069e21744e96776b58937f23", "url": "https://github.com/hyperledger/besu/commit/22ea9f574f77a8ed069e21744e96776b58937f23", "message": "Added block add event.\nAdded block reorg event.\nAdded revert reason to both events.\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-04-01T17:23:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg4MzUyNQ==", "url": "https://github.com/hyperledger/besu/pull/637#discussion_r401883525", "bodyText": "Wow... that compiled?  I didn't know that was possible.", "author": "shemnon", "createdAt": "2020-04-01T20:17:23Z", "path": "besu/src/main/java/org/hyperledger/besu/services/BesuEventsImpl.java", "diffHunk": "@@ -66,6 +68,38 @@ public void removeBlockPropagatedListener(final long listenerIdentifier) {\n     blockBroadcaster.unsubscribePropagateNewBlocks(listenerIdentifier);\n   }\n \n+  @Override\n+  public long addBlockAddedListener(final BlockAddedListener listener) {\n+    return blockchain.observeBlockAdded(\n+        (event, chain) ->\n+            listener.onBlockAdded(\n+                blockAddedContext(\n+                    event.getBlock()::getHeader,", "originalCommit": "22ea9f574f77a8ed069e21744e96776b58937f23", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk1MzQ2MQ==", "url": "https://github.com/hyperledger/besu/pull/637#discussion_r401953461", "bodyText": "I think we should add the 4 fields listed in section 4.3.1 of the yellow paper:   cumulativeGasUsed, logs, bloomFilter, and status.  For bloomFilter I think we want to just expose the Bytes object rather than our LogBloomFilter.  If we get covariant type complaints from Java we can just create a new method (BloomFilterBytes) and cast it down., but for the other three we can just expose the existing methods, since we have Log already as a data type.\nAlso, they all the methods need javadoc.  RevertReason is our own field so we should mention it's data beyond what the yellow paper requires, but for the other four just stick with the simple definitions.", "author": "shemnon", "createdAt": "2020-04-01T22:45:06Z", "path": "plugin-api/src/main/java/org/hyperledger/besu/plugin/data/TransactionReceipt.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Copyright ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package org.hyperledger.besu.plugin.data;\n+\n+import java.util.Optional;\n+\n+import org.apache.tuweni.bytes.Bytes;\n+\n+/** A transaction receipt, containing information pertaining a transaction execution. */\n+public interface TransactionReceipt {\n+  Optional<Bytes> getRevertReason();", "originalCommit": "22ea9f574f77a8ed069e21744e96776b58937f23", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "75279a4a471731a29fb3e852e99c9ed01223ba47", "chunk": "diff --git a/plugin-api/src/main/java/org/hyperledger/besu/plugin/data/TransactionReceipt.java b/plugin-api/src/main/java/org/hyperledger/besu/plugin/data/TransactionReceipt.java\nindex 2a5866d83..2931cac33 100644\n--- a/plugin-api/src/main/java/org/hyperledger/besu/plugin/data/TransactionReceipt.java\n+++ b/plugin-api/src/main/java/org/hyperledger/besu/plugin/data/TransactionReceipt.java\n\n@@ -14,11 +14,45 @@\n  */\n package org.hyperledger.besu.plugin.data;\n \n+import java.util.List;\n import java.util.Optional;\n \n import org.apache.tuweni.bytes.Bytes;\n \n /** A transaction receipt, containing information pertaining a transaction execution. */\n public interface TransactionReceipt {\n+  /**\n+   * Returns the total amount of gas consumed in the block after the transaction has been processed.\n+   *\n+   * @return the total amount of gas consumed in the block after the transaction has been processed\n+   */\n+  long getCumulativeGasUsed();\n+\n+  /**\n+   * Returns the logs generated by the transaction.\n+   *\n+   * @return the logs generated by the transaction\n+   */\n+  List<? extends Log> getLogs();\n+\n+  /**\n+   * Returns the Bytes for the logs generated by the transaction\n+   *\n+   * @return the Bytes for the logs generated by the transaction\n+   */\n+  Bytes getBloomFilter();\n+\n+  /**\n+   * Returns the status code for the status-encoded transaction receipt\n+   *\n+   * @return the status code if the transaction receipt is status-encoded; otherwise {@code -1}\n+   */\n+  int getStatus();\n+\n+  /**\n+   * Returns the ABI-encoded revert reason for the failed transaction (if applicable)\n+   *\n+   * @return the ABI-encoded revert reason for the failed transaction (if applicable)\n+   */\n   Optional<Bytes> getRevertReason();\n }\n"}}, {"oid": "0bfe48e62986925484a9d541fbad653ea653145f", "url": "https://github.com/hyperledger/besu/commit/0bfe48e62986925484a9d541fbad653ea653145f", "message": "Merge branch 'master' into PIE-2242_2", "committedDate": "2020-04-02T14:33:55Z", "type": "commit"}, {"oid": "75279a4a471731a29fb3e852e99c9ed01223ba47", "url": "https://github.com/hyperledger/besu/commit/75279a4a471731a29fb3e852e99c9ed01223ba47", "message": "Added more fields to TransactionReceipt. Added missing JavaDoc\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-04-02T14:59:04Z", "type": "commit"}, {"oid": "5234bed3e8e6d8f78db7d2ef364e3d1bb9f22abe", "url": "https://github.com/hyperledger/besu/commit/5234bed3e8e6d8f78db7d2ef364e3d1bb9f22abe", "message": "Merge branch 'PIE-2242_2' of github.com:davemec/besu into PIE-2242_2\n\nSigned-off-by: David Mechler <david.mechler@consensys.net>", "committedDate": "2020-04-02T14:59:14Z", "type": "commit"}, {"oid": "1d3b013e7bdf5e72911016a91fd77deff33e9611", "url": "https://github.com/hyperledger/besu/commit/1d3b013e7bdf5e72911016a91fd77deff33e9611", "message": "Merge branch 'master' into PIE-2242_2", "committedDate": "2020-04-02T16:50:03Z", "type": "commit"}]}