{"pr_number": 3344, "pr_title": "Fixes: #3343 TextUtils.isEmpty creates problems when unit testing with Mockito", "pr_createdAt": "2020-01-24T13:10:39Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3344", "timeline": [{"oid": "0d9209ff9bd0a1b7ec7f4c5cd69a636643869a88", "url": "https://github.com/commons-app/apps-android-commons/commit/0d9209ff9bd0a1b7ec7f4c5cd69a636643869a88", "message": "TextUtils: add more classes to mock", "committedDate": "2020-01-24T17:48:03Z", "type": "forcePushed"}, {"oid": "21dd4bb986d0ac2f940bb052859e371acc22bf1d", "url": "https://github.com/commons-app/apps-android-commons/commit/21dd4bb986d0ac2f940bb052859e371acc22bf1d", "message": "TextUtils: add mock textUtils for tests", "committedDate": "2020-01-24T17:53:42Z", "type": "commit"}, {"oid": "21dd4bb986d0ac2f940bb052859e371acc22bf1d", "url": "https://github.com/commons-app/apps-android-commons/commit/21dd4bb986d0ac2f940bb052859e371acc22bf1d", "message": "TextUtils: add mock textUtils for tests", "committedDate": "2020-01-24T17:53:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r370805790", "bodyText": "@kbhardwaj123 Where is this class getting used?", "author": "maskaravivek", "createdAt": "2020-01-24T19:32:17Z", "path": "app/src/test/java/android/text/TextUtils.java", "diffHunk": "@@ -0,0 +1,61 @@\n+package android.text;\n+\n+\n+import androidx.annotation.Nullable;\n+\n+/**\n+ * This Class Mocks TextUtils for the purpose of testing.\n+ * NOTE: This class would not change the function of the TextUtils used in app\n+ * it onlt mocks it for the unit tests\n+ *\n+ */\n+public class TextUtils {", "originalCommit": "21dd4bb986d0ac2f940bb052859e371acc22bf1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyODAxMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r370828010", "bodyText": "In short, take any piece of code containing TextUtils.isEmpty() it will always return false even if you pass null, you can see that in the screenshot above, this class mocks that and gives perfect result again refer to second screenshot above", "author": "kbhardwaj123", "createdAt": "2020-01-24T20:27:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgyOTQ3Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r370829473", "bodyText": "I discovered this while i was unit testing on CategoryModel in other PR (which is also ready for you to review :) )", "author": "kbhardwaj123", "createdAt": "2020-01-24T20:31:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0MTQ2Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r371141462", "bodyText": "I still don't understand, where is this class used?", "author": "ashishkumar468", "createdAt": "2020-01-27T09:45:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1MDg5OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r371150899", "bodyText": "It goes like this:\nMockito is not capable of mocking TextUtils.isEmpty\n\nit's mentioned here: https://stackoverflow.com/questions/35763289/need-help-to-write-a-unit-test-using-mockito-and-junit4\n\nSo inside a unit test TextUtils.isEmpty(null) returns false which is Wrong!\nSee the first screenshot I posted above,\nThis Class mocks the TextUtils class Correctly, please refer to my second screenshot\nSo This Class will be used by every unit test which tries to test a piece of code which contains TextUtils.isEmpty", "author": "kbhardwaj123", "createdAt": "2020-01-27T10:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1MjUzNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r371152535", "bodyText": "@ashishkumar468 my solution takes inspiration from:\n\nhttps://medium.com/@okmanideep/dont-create-that-stringutils-to-unit-test-your-android-class-8ab32af34e84", "author": "kbhardwaj123", "createdAt": "2020-01-27T10:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE5MjMwNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3344#discussion_r371192307", "bodyText": "The startUpload() inside UploadControllerTest.kt tests uploadController.startUpload at line 119 in UploadController.java, that's one of the instances where this class will be used", "author": "kbhardwaj123", "createdAt": "2020-01-27T11:37:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDgwNTc5MA=="}], "type": "inlineReview", "revised_code": {"commit": "787c8ca6613a406305028d7470ba77ac697fdb6e", "chunk": "diff --git a/app/src/test/java/android/text/TextUtils.java b/app/src/test/java/android/text/TextUtils.java\nindex 4d35b7310..0cb57cdd5 100644\n--- a/app/src/test/java/android/text/TextUtils.java\n+++ b/app/src/test/java/android/text/TextUtils.java\n\n@@ -58,4 +58,25 @@ public class TextUtils {\n         return type == Character.PARAGRAPH_SEPARATOR || type == Character.LINE_SEPARATOR\n                 || codePoint == 10;\n     }\n+\n+    /**\n+     * Returns whether the given CharSequence contains any printable characters.\n+     */\n+    public static boolean isGraphic(CharSequence str) {\n+        final int len = str.length();\n+        for (int cp, i=0; i<len; i+=Character.charCount(cp)) {\n+            cp = Character.codePointAt(str, i);\n+            int gc = Character.getType(cp);\n+            if (gc != Character.CONTROL\n+                    && gc != Character.FORMAT\n+                    && gc != Character.SURROGATE\n+                    && gc != Character.UNASSIGNED\n+                    && gc != Character.LINE_SEPARATOR\n+                    && gc != Character.PARAGRAPH_SEPARATOR\n+                    && gc != Character.SPACE_SEPARATOR) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n }\n\\ No newline at end of file\n"}}, {"oid": "787c8ca6613a406305028d7470ba77ac697fdb6e", "url": "https://github.com/commons-app/apps-android-commons/commit/787c8ca6613a406305028d7470ba77ac697fdb6e", "message": "TextUtils: add more methods to mock for testing", "committedDate": "2020-01-24T20:41:24Z", "type": "commit"}, {"oid": "6630fa33e5270d73a8346238602ab6321476e3c2", "url": "https://github.com/commons-app/apps-android-commons/commit/6630fa33e5270d73a8346238602ab6321476e3c2", "message": "UploadControllerTest: fix the test resulting travis ci to fail", "committedDate": "2020-01-24T20:45:24Z", "type": "commit"}]}