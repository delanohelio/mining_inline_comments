{"pr_number": 3569, "pr_title": "Wiki itemname displaying in toast", "pr_createdAt": "2020-03-23T10:11:43Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3569", "timeline": [{"oid": "fd17de7ccb45380f359a8ce17cd9789ee63a8bcd", "url": "https://github.com/commons-app/apps-android-commons/commit/fd17de7ccb45380f359a8ce17cd9789ee63a8bcd", "message": "Wiki itemname displaying in toast", "committedDate": "2020-03-23T09:58:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQwOTQxOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r396409419", "bodyText": "It would be better if you could pass along this data, setting/retrieving a value in sharedprefences is a bit surprising", "author": "macgills", "createdAt": "2020-03-23T12:20:22Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/UploadModel.java", "diffHunk": "@@ -205,6 +205,7 @@ public void updateUploadItem(int index, UploadItem uploadItem) {\n         UploadItem uploadItem1 = items.get(index);\n         uploadItem1.setDescriptions(uploadItem.descriptions);\n         uploadItem1.setTitle(uploadItem.title);\n+        store.putString(\"Title\", uploadItem.place.getName());", "originalCommit": "fd17de7ccb45380f359a8ce17cd9789ee63a8bcd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQyMTIwMg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r396421202", "bodyText": "@macgills Can you please elaborate:-)\nshowSuccessToast method in WikiEditService class uses sharedpreference to retrieve the value for title. If not set it uses default, that's why i set the value when item is uploaded.", "author": "318anushka", "createdAt": "2020-03-23T12:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQwOTQxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ0MzY2MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r396443661", "bodyText": "Yeah, whoever did that just shouldn't have. We shouldn't use shared preferences to communicate data unless it is actually a preference of the app/user.\nAdd wikiItemName as a parameter to showSuccessToast() and keep adding it up the chain of methods until you have access to it.\nI still have no idea what half these fields are or aren't so I can't comment if place.name() is a wikiItemName", "author": "macgills", "createdAt": "2020-03-23T13:19:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQwOTQxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "93090c1588413cdb2d75389b2b793d062ed9d041", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/upload/UploadModel.java b/app/src/main/java/fr/free/nrw/commons/upload/UploadModel.java\nindex 4caaa6807..69572ce9e 100644\n--- a/app/src/main/java/fr/free/nrw/commons/upload/UploadModel.java\n+++ b/app/src/main/java/fr/free/nrw/commons/upload/UploadModel.java\n\n@@ -205,7 +206,6 @@ public class UploadModel {\n         UploadItem uploadItem1 = items.get(index);\n         uploadItem1.setDescriptions(uploadItem.descriptions);\n         uploadItem1.setTitle(uploadItem.title);\n-        store.putString(\"Title\", uploadItem.place.getName());\n     }\n \n     public void useSimilarPictureCoordinates(ImageCoordinates imageCoordinates, int uploadItemIndex) {\n"}}, {"oid": "93090c1588413cdb2d75389b2b793d062ed9d041", "url": "https://github.com/commons-app/apps-android-commons/commit/93090c1588413cdb2d75389b2b793d062ed9d041", "message": "Wikidata label displaying in toast", "committedDate": "2020-03-23T16:27:22Z", "type": "commit"}, {"oid": "082d321053fac9e77b9022037aba1647cd929332", "url": "https://github.com/commons-app/apps-android-commons/commit/082d321053fac9e77b9022037aba1647cd929332", "message": "Wikidata label displaying in toast", "committedDate": "2020-03-24T08:23:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NzAxOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r396997018", "bodyText": "If you add a field to contribution you have to add it to the parcelable methods as well or you break the contract", "author": "macgills", "createdAt": "2020-03-24T09:06:49Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/Contribution.java", "diffHunk": "@@ -68,6 +68,7 @@ public Contribution createFromParcel(Parcel parcel) {\n     public String decimalCoords;\n     public boolean isMultiple;\n     public String wikiDataEntityId;\n+    public String wikiItemName;", "originalCommit": "082d321053fac9e77b9022037aba1647cd929332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAyMDQ1Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397020457", "bodyText": "I have a doubt. why isn't wikiDataEntityId added to parcelable method", "author": "318anushka", "createdAt": "2020-03-24T09:43:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NzAxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAyNDI3Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397024277", "bodyText": "The Parcelable interface comes with some necessities for a class to implement, you must be able to write the object to a parcel and you must be able to read from a Parcel.\nSee the example\nRelevant lines\n     public void writeToParcel(Parcel out, int flags) {\n         out.writeInt(mData);\n     }\n\n     private MyParcelable(Parcel in) {\n         mData = in.readInt();\n     }", "author": "macgills", "createdAt": "2020-03-24T09:50:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NzAxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAyNTkwNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397025905", "bodyText": "why isn't wikiDataEntityId added to parcelable method\n\nProbably someone messed up because it is difficult to see from a small change that this class is parcelable. You would have to know it off the top of your head", "author": "macgills", "createdAt": "2020-03-24T09:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NzAxOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5OTUxMg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r396999512", "bodyText": "no need to assign this to a variable", "author": "macgills", "createdAt": "2020-03-24T09:11:09Z", "path": "app/src/main/java/fr/free/nrw/commons/wikidata/WikidataEditService.java", "diffHunk": "@@ -119,8 +119,8 @@ private void handleClaimResult(String wikidataEntityId, String revisionId) {\n     /**\n      * Show a success toast when the edit is made successfully\n      */\n-    private void showSuccessToast() {\n-        String title = directKvStore.getString(\"Title\", \"\");\n+    private void showSuccessToast(String wikiItemName) {\n+        String title = wikiItemName;", "originalCommit": "082d321053fac9e77b9022037aba1647cd929332", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzAyMDc1Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397020756", "bodyText": "yes will directly pass it", "author": "318anushka", "createdAt": "2020-03-24T09:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5OTUxMg=="}], "type": "inlineReview", "revised_code": {"commit": "d8076f9aa6d8a50350ec779a1001b45b204d98b5", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/wikidata/WikidataEditService.java b/app/src/main/java/fr/free/nrw/commons/wikidata/WikidataEditService.java\nindex 983bded2e..eb7ff5ae2 100644\n--- a/app/src/main/java/fr/free/nrw/commons/wikidata/WikidataEditService.java\n+++ b/app/src/main/java/fr/free/nrw/commons/wikidata/WikidataEditService.java\n\n@@ -120,9 +120,8 @@ public class WikidataEditService {\n      * Show a success toast when the edit is made successfully\n      */\n     private void showSuccessToast(String wikiItemName) {\n-        String title = wikiItemName;\n         String successStringTemplate = context.getString(R.string.successful_wikidata_edit);\n-        String successMessage = String.format(Locale.getDefault(), successStringTemplate, title);\n+        String successMessage = String.format(Locale.getDefault(), successStringTemplate, wikiItemName);\n         ViewUtil.showLongToast(context, successMessage);\n     }\n \n"}}, {"oid": "d8076f9aa6d8a50350ec779a1001b45b204d98b5", "url": "https://github.com/commons-app/apps-android-commons/commit/d8076f9aa6d8a50350ec779a1001b45b204d98b5", "message": "wikiItemName added to parcelable methods", "committedDate": "2020-03-24T10:28:02Z", "type": "commit"}, {"oid": "09c2344907e402ed6cfffb82a8e6dd7ec0a448f1", "url": "https://github.com/commons-app/apps-android-commons/commit/09c2344907e402ed6cfffb82a8e6dd7ec0a448f1", "message": "Wikidata label displayed in toast", "committedDate": "2020-03-24T11:28:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4OTkyOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397089929", "bodyText": "I don't think you need to null check this, or at least not here.\ncreateClaimWithLogging already null checks the p18 and wikidatEntityId, all fields that are only present when the contribution has an associated place ie was uploaded from Nearby or we detected it was Nearby Place from the associated image data.", "author": "macgills", "createdAt": "2020-03-24T11:43:34Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/UploadService.java", "diffHunk": "@@ -278,10 +278,11 @@ private void uploadContribution(Contribution contribution) {\n                         showFailedNotification(contribution);\n                     } else {\n                         String canonicalFilename = \"File:\" + uploadResult.getFilename();\n+                        String wikiItemName = contribution.getWikiItemName()!=null?contribution.getWikiItemName():\"\";", "originalCommit": "09c2344907e402ed6cfffb82a8e6dd7ec0a448f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA5MDc4Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397090787", "bodyText": "It would be much nicer if we expressed Contribution & ContributionWithAssociatedWikidataItem as types (preferably better named ones too) instead of the current scenario. Far out of scope of this ticket, just me musing", "author": "macgills", "createdAt": "2020-03-24T11:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4OTkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwODAxOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397108019", "bodyText": "Sorry, Test cases \ud83d\ude05\nhave to edit test file to pass values.", "author": "318anushka", "createdAt": "2020-03-24T12:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4OTkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEyNjk5MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397126991", "bodyText": "@macgills  Done :-)", "author": "318anushka", "createdAt": "2020-03-24T12:50:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4OTkyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEyOTI3OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3569#discussion_r397129279", "bodyText": "Good work", "author": "macgills", "createdAt": "2020-03-24T12:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4OTkyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "823e4c1ca2391338460dd235066dde283d6579b9", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/upload/UploadService.java b/app/src/main/java/fr/free/nrw/commons/upload/UploadService.java\nindex c6ca51e83..0b8aed9a8 100644\n--- a/app/src/main/java/fr/free/nrw/commons/upload/UploadService.java\n+++ b/app/src/main/java/fr/free/nrw/commons/upload/UploadService.java\n\n@@ -278,11 +278,10 @@ public class UploadService extends HandlerService<Contribution> {\n                         showFailedNotification(contribution);\n                     } else {\n                         String canonicalFilename = \"File:\" + uploadResult.getFilename();\n-                        String wikiItemName = contribution.getWikiItemName()!=null?contribution.getWikiItemName():\"\";\n                         Timber.d(\"Contribution upload success. Initiating Wikidata edit for\"\n                                 + \" entity id %s if necessary (if P18 is null). P18 value is %s\",\n                                 contribution.getWikiDataEntityId(), contribution.getP18Value());\n-                        wikidataEditService.createClaimWithLogging(contribution.getWikiDataEntityId(), wikiItemName, canonicalFilename, contribution.getP18Value());\n+                        wikidataEditService.createClaimWithLogging(contribution.getWikiDataEntityId(), contribution.getWikiItemName(), canonicalFilename, contribution.getP18Value());\n                         contribution.setFilename(canonicalFilename);\n                         contribution.setImageUrl(uploadResult.getImageinfo().getOriginalUrl());\n                         contribution.setState(Contribution.STATE_COMPLETED);\n"}}, {"oid": "823e4c1ca2391338460dd235066dde283d6579b9", "url": "https://github.com/commons-app/apps-android-commons/commit/823e4c1ca2391338460dd235066dde283d6579b9", "message": "Wikidata label displayed in toast", "committedDate": "2020-03-24T12:38:43Z", "type": "commit"}]}