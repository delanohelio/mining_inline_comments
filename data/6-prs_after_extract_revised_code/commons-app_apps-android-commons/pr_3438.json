{"pr_number": 3438, "pr_title": "Add a dialog to prompt user if location is off in Nearby when Locate me button is pressed.", "pr_createdAt": "2020-02-27T12:45:02Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3438", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r385109753", "bodyText": "Hi @glitch101, instead of making a new instance of NearbyParentFragment, as the NearbyParentFragmentPresenter is already implementing LocationUpdateListener, how about adding a new method in LocationUpdateListener, enableLocationOffDialog(boolean shouldEnable) and as the presenter will be implementing it, it can be routed from there to the fragment", "author": "ashishkumar468", "createdAt": "2020-02-27T12:59:05Z", "path": "app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java", "diffHunk": "@@ -212,6 +213,14 @@ public void onProviderEnabled(String provider) {\n     @Override\n     public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);", "originalCommit": "c4d91a6774c83d8a3e94007dc364aa7ff740c9a8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE1MTI4Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r385151286", "bodyText": "You are right! That would be a cleaner and robust method to toggle the dialog based on location state. I have pushed the changes you recommended. Thanks for the tip @ashishkumar468! Please let me know if I did something wrong. :)", "author": "aryan-earth", "createdAt": "2020-02-27T14:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE3MTIyNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388171224", "bodyText": "The boolean trap", "author": "macgills", "createdAt": "2020-03-05T09:29:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQxMTAzNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388411036", "bodyText": "The boolean trap\n\nThanks, @macgills for introducing me to The boolean trap. I will take care of it in this PR and in the future.", "author": "aryan-earth", "createdAt": "2020-03-05T16:30:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTEwOTc1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java b/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\nindex 8bcbcdf37..a0b86d73f 100644\n--- a/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\n+++ b/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\n\n@@ -214,8 +214,9 @@ public class LocationServiceManager implements LocationListener {\n     public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);\n         if (provider.equals(\"gps\")) {\n-            NearbyParentFragment nearbyParentFragment = new NearbyParentFragment();\n-            nearbyParentFragment.enableLocationOffDialog();\n+            //TODO: Rename this class object to something better\n+            NearbyParentFragment nb = new NearbyParentFragment();\n+            nb.showDialogAgain();\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMDg0NQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r387200845", "bodyText": "This seems to be code used during development. Would it be useful to keep this in production too?", "author": "sivaraam", "createdAt": "2020-03-03T18:10:25Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java", "diffHunk": "@@ -528,6 +528,15 @@ public void onLocationChangedMedium(LatLng latLng) {\n         updateClosestNearbyCardViewInfo();\n     }\n \n+    @Override\n+    public void changeDialogState(boolean enableDialog) {", "originalCommit": "0777cb032da0218585684471d4c55f425b7ab916", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQzMjEzMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388432131", "bodyText": "This seems to be code used during development. Would it be useful to keep this in production too?\n\nCan you please explain more about this comment? Are some classes development specific only? If so, I didn't know that was the case.", "author": "aryan-earth", "createdAt": "2020-03-05T17:03:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMDg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2NTIzMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388465230", "bodyText": "Sorry for not being clear. AFAIK, there's no development specific class. What I actually meant to ask was: Is it worth retaining this log prints which just captures whether or not the dialog is enabled? Would it help us somewhere? If not, it can just be removed, right?\nAnyways, I suppose it doesn't matter anymore as you're planning to remove this state. \ud83d\ude42", "author": "sivaraam", "createdAt": "2020-03-05T18:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMDg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ3MzE2NQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388473165", "bodyText": "What I actually meant to ask was: Is it worth retaining these log prints which just captures whether or not the dialog is enabled? Would it help us somewhere?\n\nPoint noted \ud83e\udd13\n\nAnyways, I suppose it doesn't matter anymore as you're planning to remove this state.\n\nYup", "author": "aryan-earth", "createdAt": "2020-03-05T18:15:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMDg0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java b/app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java\nindex b99d7bd90..25e20cc7a 100644\n--- a/app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/contributions/ContributionsFragment.java\n\n@@ -528,15 +523,6 @@ public class ContributionsFragment\n         updateClosestNearbyCardViewInfo();\n     }\n \n-    @Override\n-    public void changeDialogState(boolean enableDialog) {\n-        if (enableDialog) {\n-            Timber.d(\"Location Off dialog enabled\");\n-        } else {\n-            Timber.d(\"Location Off dialog disabled\");\n-        }\n-    }\n-\n     @Override public void onViewCreated(@NonNull View view,\n         @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r387212026", "bodyText": "There's an unintended consequence of handling the null state of curLatLng this way, I suppose. Consider this, the location is on and is in \"High Accuracy mode\" but the device has not yet been located. In this case tapping on the \"Locate me\" icon shows the the \"Turn on location?\" dialog each time I tap on it. So, it looks like we get null in curLatLng for more cases than you mentioned. This app behaviour is not ideal and should be corrected.\nNote that the app behaviour I describe is accurate, but I'm speculating that I'm observing the behaviour as a consequence of curLatLng being null. I haven't confirmed this. So, there's a possibility that I'm observing the behaviour for different reasons. Anyways, can you look into how to fix this?", "author": "sivaraam", "createdAt": "2020-03-03T18:31:20Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1235,7 +1239,12 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            showLocationNullDialog();", "originalCommit": "0777cb032da0218585684471d4c55f425b7ab916", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA1Mzk1Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388053952", "bodyText": "Hi @sivaraam!  I am actually busy working on a project and would most likely be able to continue the discussion and make the changes in a day or two. I apologize for the delay.", "author": "aryan-earth", "createdAt": "2020-03-05T02:58:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NDg1OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r388494859", "bodyText": "There's an unintended consequence of handling the null state of curLatLng this way, I suppose. Consider this, the location is on and is in \"High Accuracy mode\" but the device has not yet been located. In this case tapping on the \"Locate me\" icon shows the the \"Turn on location?\" dialog each time I tap on it. So, it looks like we get null in curLatLng for more cases than you mentioned. This app behaviour is not ideal and should be corrected.\n\nI agree. I tried to reproduce this behaviour just now and I was able to do it by turning my internet off and location set to High Accuracy.\nIn order to deal with this NULL state, one choice is we don't show the Dialog when location is NULL ie when location is not available since we already get a toast for that. I think this actually makes sense since the Dialog is to prompt the user to enable location in case it's off and not when it's NULL. Any suggestions?", "author": "aryan-earth", "createdAt": "2020-03-05T18:56:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU2NzQ5OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389567499", "bodyText": "There's an unintended consequence of handling the null state of curLatLng this way, I suppose. Consider this, the location is on and is in \"High Accuracy mode\" but the device has not yet been located. In this case tapping on the \"Locate me\" icon shows the the \"Turn on location?\" dialog each time I tap on it. So, it looks like we get null in curLatLng for more cases than you mentioned. This app behaviour is not ideal and should be corrected.\n\nI agree. I tried to reproduce this behaviour just now and I was able to do it by turning my internet off and location set to High Accuracy.\nIn order to deal with this NULL state, one choice is we don't show the Dialog when location is NULL ie when location is not available since we already get a toast for that. I think this actually makes sense since the Dialog is to prompt the user to enable location in case it's off and not when it's NULL. Any suggestions?\n\nWe can check if the internet is enabled or not as a listener is slready set up in the app but I am afraid that this will be a messy way to handle this since the same conditions can occur due to different reasons which we might not be able to foresee now. What is your opinion @sivaraam ?", "author": "aryan-earth", "createdAt": "2020-03-09T10:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU2ODgzOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389568839", "bodyText": "Also, I know that this PR and its issue have been pending for too long now but I just want to make sure that we do this right because otherwise, it could cost us more time afterwards. So, thanks for the patience.", "author": "aryan-earth", "createdAt": "2020-03-09T10:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MzAzMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389593030", "bodyText": "Any suggestions?\n\nI'm sorry. I totally missed this comment. Feel free to ping me when I haven't responded within a reasonable amount of time.\n\none choice is we don't show the Dialog when location is NULL ie when location is not available since we already get a toast for that. I think this actually makes sense since the Dialog is to prompt the user to enable location in case it's off and not when it's NULL\n\nI'm still not sure in what all cases we get NULL here. Is there any case other than \"location in device only mode\" and \"location is in high accuracy mode but device not yet been found precisely\" for which we get NULL?\nIn contrast, if Nearby doesn't work in \"device only mode\" wouldn't it be better to show the dialog when location is set to \"device only mode\". Can you check if there is a reliable way to identify if the location is in \"device only mode\"? I suppose the Play Services API could help us here but we decided not to use it so I think we would have to find another way, if available. Or we might have to re-consider and re-discuss about that decision.\n\nWe can check if the internet is enabled or not as a listener is slready set up in the app but I am afraid that this will be a messy way to handle this ...\n\nYeah, it's messy indeed.\n\n... since the same conditions can occur due to different reasons which we might not be able to foresee now.\n\nExactly. You observed this when you turned off the internet but when I observed this my device's internet was not turned off. It just took some time to get the accurate location of the device in my case (and this happens a lot for me). When I tap on the \"Locate me\" button in the meanwhile I see the pop-up.\n\n... I just want to make sure that we do this right because otherwise, it could cost us more time afterwards.\n\nPerfect! It's always better to do things right than to rush them and regret when it bites us later.\n\nSo, thanks for the patience.\n\nActually, thanks a lot to you for patiently listening to feedback and improvising the PR! It's appreciated. \ud83d\ude42", "author": "sivaraam", "createdAt": "2020-03-09T11:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5NjYwNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389596604", "bodyText": "I'm sorry. I totally missed this comment. Feel free to ping me when I haven't responded within a reasonable amount of time.\n\nI will keep that in mind :)\n\nIs there any case other than \"location in device only mode\" and \"location is in high accuracy mode but device not yet been found precisely\" for which we get NULL?\n\nOther than the internet off case I mentioned above, I don't know. I didn't find any other case but I am sure there are more circumstances that can cause this.", "author": "aryan-earth", "createdAt": "2020-03-09T11:14:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5NzM0OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389597349", "bodyText": "Actually, thanks a lot to you for patiently listening to feedback and improvising the PR! It's appreciated.\n\nI am just trying to learn from you guys as fast as possible! \ud83e\udd13", "author": "aryan-earth", "createdAt": "2020-03-09T11:16:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMjAyNg=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex e4f2e2f22..528bc85e6 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1239,12 +1238,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n-            showLocationNullDialog();\n             return;\n-        } else if (!locationManager.isLocationEnabled() && showDialogAgain) {\n-            // location is not null but it is not enabled. So, user should be prompted\n-            // to enable it.\n-            showLocationOffDialog();\n         }\n         addCurrentLocationMarker(curLatLng);\n         CameraPosition position;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MzQ5Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389593492", "bodyText": "As we don't handle the NULL case separately anymore, this comment would be misleading and can be removed.", "author": "sivaraam", "createdAt": "2020-03-09T11:07:29Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1235,7 +1237,12 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            showEnableLocationDialog();\n             return;\n+        } else if (!locationManager.isLocationEnabled()) {\n+            // location is not null but it is not enabled. So, user should be prompted", "originalCommit": "30650ec770957d9b4f6d93ebaad6efaf835694ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5OTEzNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389599135", "bodyText": "Done!", "author": "aryan-earth", "createdAt": "2020-03-09T11:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTU5MzQ5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 7f87e394c..528bc85e6 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1237,12 +1238,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n-            showEnableLocationDialog();\n             return;\n-        } else if (!locationManager.isLocationEnabled()) {\n-            // location is not null but it is not enabled. So, user should be prompted\n-            // to enable it.\n-            showEnableLocationDialog();\n         }\n         addCurrentLocationMarker(curLatLng);\n         CameraPosition position;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389910167", "bodyText": "Ok. I think I've managed to figure out a way to show the dialog only when appropriate.\nTry this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (curLatLng == null) {\n          \n          \n            \n                        return;\n          \n          \n            \n                    } else if (!locationManager.isLocationEnabled()) {\n          \n          \n            \n                        // Location is not set to High Accuracy.\n          \n          \n            \n                        // Let's prompt the user using a dialog box.\n          \n          \n            \n                        showEnableLocationDialog();\n          \n          \n            \n                    }\n          \n          \n            \n                    if (curLatLng == null) {\n          \n          \n            \n                        if (!locationManager.isLocationEnabled()) {\n          \n          \n            \n                            // Location is not set to High Accuracy.\n          \n          \n            \n                            // Let's prompt the user using a dialog box.\n          \n          \n            \n                            showEnableLocationDialog();\n          \n          \n            \n                        }\n          \n          \n            \n            \n          \n          \n            \n                        return;\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nLet me know if this works fine.", "author": "sivaraam", "createdAt": "2020-03-09T19:24:56Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1236,6 +1238,10 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n             return;\n+        } else if (!locationManager.isLocationEnabled()) {\n+            // Location is not set to High Accuracy.\n+            // Let's prompt the user using a dialog box.\n+            showEnableLocationDialog();\n         }", "originalCommit": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEyMDIxNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390120216", "bodyText": "Ignore my previous comment. I think a more appropriate place to make the change in would be the NearbyParentFragmentPresenter. We shouldn't have any concerns about handling the null case if we make the change there. To be clear, I'm not suggesting to do the change there to avoid the null handling but it really does seem to be appropriate place to do the change. Changing it here has some other unintended consequences.\nI'll let you figure out the appropriate place to change there, though. \ud83d\ude09", "author": "sivaraam", "createdAt": "2020-03-10T06:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIzNzc3NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390237774", "bodyText": "I think a more appropriate place to make the change in would be the NearbyParentFragmentPresenter.\n\nWait a second. Don't we need to check the location state when the Locate Me button is pressed? And since we are using the MVP architecture, the only way to do that is in the  View section and NearbyParentFragment is the view.\nWe can't do this in the presenter if we want to stick to MVP architecture and even if we do it, it will be more complex than doing that in View.\nThese are just my thoughts according to what I know. That being said, like always, I could be wrong.", "author": "aryan-earth", "createdAt": "2020-03-10T11:02:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI1NjQ0NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390256444", "bodyText": "I can't speak to this implementation much but if the View has logic in it then it is not a View. A View tells the Presenter something happened and then it is the Presenter's responsibility to figure out what the view should do, this may entail some updates to the Model", "author": "macgills", "createdAt": "2020-03-10T11:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI1OTY4Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390259683", "bodyText": "But when the user presses Locate Me button, the method ReCenterMap checks screen orientation and also checks if the location is not null. All this is done in NearbyParentFragment and not in its presenter NearbyParentFragmentPresenter. Am  I missing something?", "author": "aryan-earth", "createdAt": "2020-03-10T11:49:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2MTIzNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390261234", "bodyText": "Also, can you tell me which class will be called the View of the Presenter NearbyParentFragmentPresenter? Is it NearbyParentFragment or NearbyParentFragmentContract or any other class? I haven't worked with the MVP architecture before, so I apologize for the trouble.", "author": "aryan-earth", "createdAt": "2020-03-10T11:52:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2Mjc5Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390262793", "bodyText": "A bad design decision, they happen for many reasons and sometimes even good ones. The presenter should only call recenter if the location was not null, it should also probably construct those CameraPosition objects.\nCalling things Views/Presenters/Model doesn't make them actually adhere to the rules.\nNowadays I prefer MVI because of explicit predictable state modelling but that is neither here nor there.", "author": "macgills", "createdAt": "2020-03-10T11:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2Mzk3OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390263978", "bodyText": "And the presenter should not be setting clickListeners, the primary things you do in a view is render and set clickListeners, that should be it. The dumber the view the happier your life", "author": "macgills", "createdAt": "2020-03-10T11:58:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2NjA2Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390266063", "bodyText": "A bad design decision, they happen for many reasons and sometimes even good ones.\n\nI agree. Sometimes, rules have to be broken as no rule/theory/architecture can satisfy all conditions.\n\nThe presenter should only call recenter if the location was not null, it should also probably construct those CameraPosition objects.\n\nMaybe we can open a new issue for it.\n\nNowadays I prefer MVI because of explicit predictable state modelling but that is neither here nor there.\n\nThanks, I will check MVI out. Intents seem great.", "author": "aryan-earth", "createdAt": "2020-03-10T12:03:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2NjMzMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390266333", "bodyText": "The dumber the view the happier your life\n\nI will keep that in mind.", "author": "aryan-earth", "createdAt": "2020-03-10T12:03:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2NjkyMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390266921", "bodyText": "This article isn't bad. I haven't done MVP in years so I don't have immediate access to a great resource.", "author": "macgills", "createdAt": "2020-03-10T12:04:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI2NzUyOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390267529", "bodyText": "This article isn't bad. I haven't done MVP in years so I don't have immediate access to a great resource.\n\nThanks, I will check it out :)", "author": "aryan-earth", "createdAt": "2020-03-10T12:06:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI3MDkyNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390270924", "bodyText": "Sorry, your comments weren't showing up for me .\n\nAlso, can you tell me which class will be called the View of the Presenter NearbyParentFragmentPresenter? Is it NearbyParentFragment or NearbyParentFragmentContract or any other class?\n\n*Contract are typically where people put all the methods that the View/Presenter/Model will call. These contracts are interfaces that should describe easily what a screen does. The concrete instances are the implementations of your M/V/P, I think it is ctrl+alt+b to go to implementations of an interface in AS. Here it is NearbyParentFragment because it implements Contract.View\n\nMaybe we can open a new issue for it.\n\nI wouldn't worry about it for now, sometimes it is better to let sleeping dogs lie. Hopefully at some point it can be addressed but I doubt it is a priority", "author": "macgills", "createdAt": "2020-03-10T12:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE2OTI4Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r391169286", "bodyText": "I wouldn't worry about it for now, sometimes it is better to let sleeping dogs  lie. Hopefully at some point it can be addressed but I doubt it is a priority\n\nGood point but wouldn't be nice if we let people know that there's a dog lying here? \ud83d\ude09\nBy which I mean wouldn't it be nice if we open an issue just to note that there's this issue with the way things are right now and we would have to fix them some time in the future... before the dog wakes up.", "author": "sivaraam", "createdAt": "2020-03-11T18:13:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ3NTA5Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r391475092", "bodyText": "NearbyParentFragment is 1456 lines long, there are other problems that are way more major than  \"This method should adhere more to the architecture\". By all means create the issue, I just have never seen these issues get resolved piecemeal", "author": "macgills", "createdAt": "2020-03-12T08:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDE2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 918714300..528bc85e6 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1238,10 +1239,6 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n             return;\n-        } else if (!locationManager.isLocationEnabled()) {\n-            // Location is not set to High Accuracy.\n-            // Let's prompt the user using a dialog box.\n-            showEnableLocationDialog();\n         }\n         addCurrentLocationMarker(curLatLng);\n         CameraPosition position;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDI4Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r389910286", "bodyText": "These strings should be moved to strings.xml. \"Yes\" and \"No\" should already be there.", "author": "sivaraam", "createdAt": "2020-03-09T19:25:10Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1265,6 +1271,23 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    private void showEnableLocationDialog() {\n+        // This dialog box prompts the user to set the location to High Accuracy\n+        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",\n+                \"Yes\", \"No\",  this::openLocationSettings, null);\n+    }", "originalCommit": "a5dd3f9f2c7a12f3da98d1b6d6eaabcf71007c7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI0ODQ2NQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r390248465", "bodyText": "Done", "author": "aryan-earth", "createdAt": "2020-03-10T11:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTkxMDI4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 918714300..528bc85e6 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1271,23 +1268,6 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n-    private void showEnableLocationDialog() {\n-        // This dialog box prompts the user to set the location to High Accuracy\n-        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",\n-                \"Yes\", \"No\",  this::openLocationSettings, null);\n-    }\n-\n-    private void openLocationSettings() {\n-        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n-        try {\n-            getContext().startActivity(intent);\n-            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_SHORT).show();\n-        } catch (Exception e) {\n-            Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n-            Timber.e(e);\n-        }\n-    }\n-\n     @Override\n     public void hideBottomSheet() {\n         bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE4NjE0MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r391186140", "bodyText": "Kindly move these strings to strings.xml too.", "author": "sivaraam", "createdAt": "2020-03-11T18:42:25Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1265,6 +1277,25 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showGPSOffDialog() {\n+        // This dialog box prompts the user to set the location to High Accuracy\n+        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",", "originalCommit": "831f303bd24d9a99c12fad888d1898a48e4a1f30", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 06fa32db2..528bc85e6 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1277,25 +1268,6 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n-    @Override\n-    public void showGPSOffDialog() {\n-        // This dialog box prompts the user to set the location to High Accuracy\n-        DialogUtil.showAlertDialog(getActivity(), \"Turn on location?\", \"Nearby needs location enabled to work properly\",\n-                getString(R.string.yes), getString(R.string.no),  this::openLocationSettings, null);\n-    }\n-\n-    @Override\n-    public void openLocationSettings() {\n-        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n-        try {\n-            getContext().startActivity(intent);\n-            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_SHORT).show();\n-        } catch (Exception e) {\n-            Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n-            Timber.e(e);\n-        }\n-    }\n-\n     @Override\n     public void hideBottomSheet() {\n         bottomSheetListBehavior.setState(BottomSheetBehavior.STATE_HIDDEN);\n"}}, {"oid": "6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "url": "https://github.com/commons-app/apps-android-commons/commit/6669a0587cdda5f6075930ccc6e3aa8b7a5b371f", "message": "Added a dialog box that pops up when location is disabled and the user presses tbe Re Center button in the Nearby map.", "committedDate": "2020-03-16T13:52:37Z", "type": "commit"}, {"oid": "49242bde36030928bb22f8ebebb03f7289f3817a", "url": "https://github.com/commons-app/apps-android-commons/commit/49242bde36030928bb22f8ebebb03f7289f3817a", "message": "Renamed method showDialogagain() to enableLocationOffDialog() for better code redeability", "committedDate": "2020-03-16T13:52:39Z", "type": "commit"}, {"oid": "d217a648074f6701de47eba219afdec22a908054", "url": "https://github.com/commons-app/apps-android-commons/commit/d217a648074f6701de47eba219afdec22a908054", "message": "Renamed NearbyParentFragment object in LocationServiceManager to something better to read.", "committedDate": "2020-03-16T13:52:41Z", "type": "commit"}, {"oid": "fae9f4c0974d7549822a9be902d29b9b2ad8533a", "url": "https://github.com/commons-app/apps-android-commons/commit/fae9f4c0974d7549822a9be902d29b9b2ad8533a", "message": "Removed a TODO from LocationServiceManager which was related to previous commit", "committedDate": "2020-03-16T13:52:41Z", "type": "commit"}, {"oid": "2e2c2a44492d92cc2c3447e3db594a197f71879a", "url": "https://github.com/commons-app/apps-android-commons/commit/2e2c2a44492d92cc2c3447e3db594a197f71879a", "message": "Made changes as recommended by @ashishkumar468 which allowed for a more cleaner and robust approach for toggeling the dialog", "committedDate": "2020-03-16T13:52:42Z", "type": "commit"}, {"oid": "7e326446b935328672596b3fed512d9513225cfa", "url": "https://github.com/commons-app/apps-android-commons/commit/7e326446b935328672596b3fed512d9513225cfa", "message": "Changed the behaviour of the dialog box and now it will always show up when the user presses Locate Me button while the location is off.", "committedDate": "2020-03-16T13:52:43Z", "type": "commit"}, {"oid": "70dac7e91e151a42f9c9dfaac916fe45eda57d1d", "url": "https://github.com/commons-app/apps-android-commons/commit/70dac7e91e151a42f9c9dfaac916fe45eda57d1d", "message": "[WIP] GPS Off dialog", "committedDate": "2020-03-16T13:52:49Z", "type": "commit"}, {"oid": "86a2cb922d0cdf339efb4fb8f86edfa7ff8d7d0d", "url": "https://github.com/commons-app/apps-android-commons/commit/86a2cb922d0cdf339efb4fb8f86edfa7ff8d7d0d", "message": "[WIP] Some minor changes", "committedDate": "2020-03-16T13:52:50Z", "type": "commit"}, {"oid": "7249ca76f5d131dcc81ee96f130ce4e562090b36", "url": "https://github.com/commons-app/apps-android-commons/commit/7249ca76f5d131dcc81ee96f130ce4e562090b36", "message": "Nearby now checks if network location provider is enabled or not when the user clicks on Locate Me button", "committedDate": "2020-03-16T13:52:52Z", "type": "commit"}, {"oid": "53279a74a77f54f2820e700ea2a4c4308510643b", "url": "https://github.com/commons-app/apps-android-commons/commit/53279a74a77f54f2820e700ea2a4c4308510643b", "message": "Added location off dialog box to nearby", "committedDate": "2020-03-16T14:38:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMDYxNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393100616", "bodyText": "revert this change", "author": "macgills", "createdAt": "2020-03-16T15:15:50Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -213,7 +212,7 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n     @Override\n     public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        isDarkTheme = systemThemeUtils.isDeviceInNightMode();\n+        isDarkTheme = applicationKvStore.getBoolean(\"theme\", false);", "originalCommit": "53279a74a77f54f2820e700ea2a4c4308510643b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 9714909c6..7d08ff806 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -212,7 +215,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     @Override\n     public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        isDarkTheme = applicationKvStore.getBoolean(\"theme\", false);\n+        isDarkTheme = systemThemeUtils.isDeviceInNightMode();\n         cameraMoveListener= () -> presenter.onCameraMove(mapBox.getCameraPosition().target);\n         addCheckBoxCallback();\n         presenter.attachView(this);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMDc3MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393100771", "bodyText": "revert this change", "author": "macgills", "createdAt": "2020-03-16T15:16:04Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -229,8 +228,8 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 UiSettings uiSettings = mapBoxMap.getUiSettings();\n                 uiSettings.setCompassGravity(Gravity.BOTTOM | Gravity.LEFT);\n                 uiSettings.setCompassMargins(12, 0, 0, 24);\n-                uiSettings.setLogoEnabled(true);\n-                uiSettings.setAttributionEnabled(true);\n+                uiSettings.setLogoEnabled(false);", "originalCommit": "53279a74a77f54f2820e700ea2a4c4308510643b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 9714909c6..7d08ff806 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -228,8 +231,8 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n                 UiSettings uiSettings = mapBoxMap.getUiSettings();\n                 uiSettings.setCompassGravity(Gravity.BOTTOM | Gravity.LEFT);\n                 uiSettings.setCompassMargins(12, 0, 0, 24);\n-                uiSettings.setLogoEnabled(false);\n-                uiSettings.setAttributionEnabled(false);\n+                uiSettings.setLogoEnabled(true);\n+                uiSettings.setAttributionEnabled(true);\n                 uiSettings.setRotateGesturesEnabled(false);\n                 NearbyParentFragment.this.isMapBoxReady=true;\n                 performMapReadyActions();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMTQ4Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393101482", "bodyText": "this log is not in keeping with the name of this method, which one is happening here? Slightly or significantly?", "author": "macgills", "createdAt": "2020-03-16T15:17:05Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -911,7 +910,7 @@ public void onLocationChangedSignificantly(fr.free.nrw.commons.location.LatLng l\n \n     @Override\n     public void onLocationChangedSlightly(fr.free.nrw.commons.location.LatLng latLng) {\n-        Timber.d(\"Location slightly changed\");\n+        Timber.d(\"Location significantly changed\");", "originalCommit": "53279a74a77f54f2820e700ea2a4c4308510643b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNzA1Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393107056", "bodyText": "Slightly. I have fixed it. Thanks", "author": "aryan-earth", "createdAt": "2020-03-16T15:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMTQ4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "d969c4091485af3e6ade88421aef7091fb3478f6", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 9714909c6..dcde29879 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -910,7 +910,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n \n     @Override\n     public void onLocationChangedSlightly(fr.free.nrw.commons.location.LatLng latLng) {\n-        Timber.d(\"Location significantly changed\");\n+        Timber.d(\"Location slightly changed\");\n         if (isMapBoxReady && latLng != null &&!isUserBrowsing()) {//If the map has never ever shown the current location, lets do it know\n             handleLocationUpdate(latLng,LOCATION_SLIGHTLY_CHANGED);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMjkwNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393102907", "bodyText": "The user of locationManager needs to know the correct strings to give this method for it to be able to work. A method isNetworkProviderEnabled would be better from an API perspective, or if this method accepted an Enum", "author": "macgills", "createdAt": "2020-03-16T15:19:08Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1238,6 +1237,9 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            if (!locationManager.isProviderEnabled(\"network\")) {", "originalCommit": "53279a74a77f54f2820e700ea2a4c4308510643b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwODQ0OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393108448", "bodyText": "So, instead of isProviderEnabled in LocationServiceManager, I should add a method isNetworkProviderEnabled? Should I also add one for GPS?", "author": "aryan-earth", "createdAt": "2020-03-16T15:26:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMjkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExMzA0Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393113046", "bodyText": "Yes or create an enum\nenum class LocationProvider{\nGPS(\"gps\"), Network(\"network\")\n}\n\nsetProvider(LocationProvider locationProvider){\nreturn locationManager.isProviderEnabled(locationProvider.getProvider());\n\nEnums are generally better for api design as you don't have to add a new method per LocationProvider, just a new case of Enum.\nHere it is probably overkill as there are only the 2 providers if memory serves. Also there are definitely constants for these and you shouldn't be using raw strings", "author": "macgills", "createdAt": "2020-03-16T15:33:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMjkwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExNjgyNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393116827", "bodyText": "Enums seem neat. I will keep those in mind for future implementations but you are also right that it's overkill here for just two providers.", "author": "aryan-earth", "createdAt": "2020-03-16T15:38:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwMjkwNw=="}], "type": "inlineReview", "revised_code": {"commit": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 9714909c6..7d08ff806 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1237,7 +1240,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n-            if (!locationManager.isProviderEnabled(\"network\")) {\n+            if (!locationManager.isNetworkProviderEnabled()) {\n                 showLocationOffDialog();\n             }\n             return;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNDE0MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393104141", "bodyText": "We should never catch Exception, if you need to catch an exception catch the one that is actually thrown.\nYou probably don't need to catch an Exception here, you could resolve the intent", "author": "macgills", "createdAt": "2020-03-16T15:20:53Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1268,6 +1270,27 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showLocationOffDialog() {\n+        // This creates a dialog box that prompts the user to enable location\n+        DialogUtil\n+            .showAlertDialog(getActivity(), getString(R.string.ask_to_turn_location_on), getString(R.string.nearby_needs_location),\n+                getString(R.string.yes), getString(R.string.no),  this::openLocationSettings, null);\n+    }\n+\n+    @Override\n+    public void openLocationSettings() {\n+        // This method opens the location settings of the device along with a followup toast.\n+        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n+        try {\n+            getContext().startActivity(intent);\n+            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n+        } catch (Exception e) {", "originalCommit": "53279a74a77f54f2820e700ea2a4c4308510643b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExMjExMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393112113", "bodyText": "The try/catch clause was added because Android Studio was warning me that startActivity may produce a Null Pointer Exception but you are right. Let's resolve the intent.", "author": "aryan-earth", "createdAt": "2020-03-16T15:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNDE0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzExNDk4OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393114989", "bodyText": "The NPE is because getContext is potentially null, a fragment only has a valid context after onAttach and it is removed from a context in onDetach", "author": "macgills", "createdAt": "2020-03-16T15:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzEwNDE0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 9714909c6..7d08ff806 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1289,6 +1292,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n             Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n             Timber.e(e);\n         }\n+//        PackageManager packageManager = getActivity().getPackageManager();\n     }\n \n     @Override\n"}}, {"oid": "d969c4091485af3e6ade88421aef7091fb3478f6", "url": "https://github.com/commons-app/apps-android-commons/commit/d969c4091485af3e6ade88421aef7091fb3478f6", "message": "Fixed a typo in NearbyParentFragment where significantly was written instead of slightly", "committedDate": "2020-03-16T15:23:39Z", "type": "commit"}, {"oid": "c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "url": "https://github.com/commons-app/apps-android-commons/commit/c3d74d737d85da96352b0eaf9ace7b8ffce031d9", "message": "Some Changes reverted", "committedDate": "2020-03-16T16:25:56Z", "type": "commit"}, {"oid": "55fb9487268efd0c17523d51206f8694f1be5dc4", "url": "https://github.com/commons-app/apps-android-commons/commit/55fb9487268efd0c17523d51206f8694f1be5dc4", "message": "Reverted some changes in Project.xml", "committedDate": "2020-03-16T16:28:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393156842", "bodyText": "These should be constants or enums", "author": "ashishkumar468", "createdAt": "2020-03-16T16:36:25Z", "path": "app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java", "diffHunk": "@@ -214,8 +215,12 @@ public void onProviderDisabled(String provider) {\n         Timber.d(\"Provider %s disabled\", provider);\n     }\n \n-    public boolean isProviderEnabled(String provider) {\n-        return locationManager.isProviderEnabled(provider);\n+    public boolean isNetworkProviderEnabled() {\n+        return locationManager.isProviderEnabled(String.valueOf(R.string.network_provider));", "originalCommit": "55fb9487268efd0c17523d51206f8694f1be5dc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MzI2MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393163260", "bodyText": "I am able to understand what you mean by enums but the constants part is confusing me. I am sorry but can you please explain it to me? Are you referring that I create a String variable in LocationManager with a final attribute like this:\nprivate final String NETWORK_PROVIDER = \"network\";", "author": "aryan-earth", "createdAt": "2020-03-16T16:45:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2Mzk4Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393163983", "bodyText": "eg LocationManager.GPS_PROVIDER", "author": "macgills", "createdAt": "2020-03-16T16:46:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2NDQ5Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393164497", "bodyText": "Enums or StringDefs would be better, constants like the one you mentioned are fine, if you put them in string files, they will be localized and we don't want that right?", "author": "ashishkumar468", "createdAt": "2020-03-16T16:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2NDk3NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393164974", "bodyText": "Oh! Now I got it. Thank you :)", "author": "aryan-earth", "createdAt": "2020-03-16T16:48:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2NTI3OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393165279", "bodyText": "The constants already exist in the framework, so just use those @glitch101", "author": "macgills", "createdAt": "2020-03-16T16:49:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Njg0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "ec4f1dd9bc96528400945f8c17bc98801de3b009", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java b/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\nindex e468e9f3a..601408be9 100644\n--- a/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\n+++ b/app/src/main/java/fr/free/nrw/commons/location/LocationServiceManager.java\n\n@@ -216,11 +216,11 @@ public class LocationServiceManager implements LocationListener {\n     }\n \n     public boolean isNetworkProviderEnabled() {\n-        return locationManager.isProviderEnabled(String.valueOf(R.string.network_provider));\n+        return locationManager.isProviderEnabled(LocationManager.NETWORK_PROVIDER);\n     }\n \n     public boolean isGPSProviderEnabled() {\n-        return locationManager.isProviderEnabled(String.valueOf(R.string.gps_provider));\n+        return locationManager.isProviderEnabled(LocationManager.GPS_PROVIDER);\n     }\n \n     public enum LocationChangeType{\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzMyNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157326", "bodyText": "Is this related with this PR?", "author": "ashishkumar468", "createdAt": "2020-03-16T16:37:07Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -228,8 +231,8 @@ public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceStat\n                 UiSettings uiSettings = mapBoxMap.getUiSettings();\n                 uiSettings.setCompassGravity(Gravity.BOTTOM | Gravity.LEFT);\n                 uiSettings.setCompassMargins(12, 0, 0, 24);\n-                uiSettings.setLogoEnabled(false);\n-                uiSettings.setAttributionEnabled(false);\n+                uiSettings.setLogoEnabled(true);", "originalCommit": "55fb9487268efd0c17523d51206f8694f1be5dc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1OTYzNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393159635", "bodyText": "No. I guess I mixed these up while updating my fork. These have been reverted.", "author": "aryan-earth", "createdAt": "2020-03-16T16:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzMyNg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzYxNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157614", "bodyText": "Un related, revert changes", "author": "ashishkumar468", "createdAt": "2020-03-16T16:37:33Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -823,10 +826,10 @@ public void animateFABs() {\n     }\n \n     private void showFABs() {\n-            NearbyFABUtils.addAnchorToBigFABs(fabPlus, bottomSheetDetails.getId());\n-            fabPlus.show();\n-            NearbyFABUtils.addAnchorToSmallFABs(fabGallery, getView().findViewById(R.id.empty_view).getId());\n-            NearbyFABUtils.addAnchorToSmallFABs(fabCamera, getView().findViewById(R.id.empty_view1).getId());\n+        NearbyFABUtils.addAnchorToBigFABs(fabPlus, bottomSheetDetails.getId());", "originalCommit": "55fb9487268efd0c17523d51206f8694f1be5dc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE2MDM1OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393160358", "bodyText": "These have been reverted too. Thanks \ud83d\ude04", "author": "aryan-earth", "createdAt": "2020-03-16T16:41:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1NzYxNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE1Nzg2OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393157869", "bodyText": "Remove this", "author": "ashishkumar468", "createdAt": "2020-03-16T16:37:57Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1289,6 +1292,7 @@ public void openLocationSettings() {\n             Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n             Timber.e(e);\n         }\n+//        PackageManager packageManager = getActivity().getPackageManager();", "originalCommit": "55fb9487268efd0c17523d51206f8694f1be5dc4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ec4f1dd9bc96528400945f8c17bc98801de3b009", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 7d08ff806..4ca6444be 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1285,14 +1286,14 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     public void openLocationSettings() {\n         // This method opens the location settings of the device along with a followup toast.\n         Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n-        try {\n-            getContext().startActivity(intent);\n+        PackageManager packageManager = getActivity().getPackageManager();\n+\n+        if (intent.resolveActivity(packageManager)!= null) {\n+            startActivity(intent);\n             Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n-        } catch (Exception e) {\n+        } else {\n             Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n-            Timber.e(e);\n         }\n-//        PackageManager packageManager = getActivity().getPackageManager();\n     }\n \n     @Override\n"}}, {"oid": "ec4f1dd9bc96528400945f8c17bc98801de3b009", "url": "https://github.com/commons-app/apps-android-commons/commit/ec4f1dd9bc96528400945f8c17bc98801de3b009", "message": "Made recommended changes", "committedDate": "2020-03-16T16:52:29Z", "type": "commit"}, {"oid": "0b67324df8772169b5c63301e561a83e57a375e1", "url": "https://github.com/commons-app/apps-android-commons/commit/0b67324df8772169b5c63301e561a83e57a375e1", "message": "Removed unused import in LocationServiceManager", "committedDate": "2020-03-16T16:53:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Njc1Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393876756", "bodyText": "Just like I expected this sort of brings us back to the unintended behaviour that I described before. When I have the location mode set to \"GPS only\" and tap on the \"Locate me\" icon before the device is located I see the dialog. I thought we didn't want that.\nIn the following screenshot, note the location icon in the notification area indicating GPS is on.\n\nThe following fixes this issue:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (!locationManager.isNetworkProviderEnabled()) {\n          \n          \n            \n                        if (!(locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())) {", "author": "sivaraam", "createdAt": "2020-03-17T18:13:04Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1238,6 +1241,9 @@ private void setMapMarkerActions(Marker selectedMarker) {\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n+            if (!locationManager.isNetworkProviderEnabled()) {", "originalCommit": "0b67324df8772169b5c63301e561a83e57a375e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg5Nzk3OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393897979", "bodyText": "When I have the location mode set to \"GPS only\" and tap on the \"Locate me\" icon before the device is located I see the dialog. I thought we didn't want that.\n\nNo, we do want that. Nearby cannot locate you without mobile network provider but it can locate you without GPS provider. Before the device is located and it is on GPS only, it can't locate the device because mobile provider is not enabled hence the dialog.\nEdit: You can try and disable the dialog and then you can observe that if your location is at GPS only, Nearby will not be able to determine your location. At least this is the behaviour I observed in my device.", "author": "aryan-earth", "createdAt": "2020-03-17T18:48:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Njc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkxMzIxMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393913211", "bodyText": "No, we do want that.\n\nI bet we don't. I'll explain the reason for why I'm stressing this in the end.\nAnyways, I see some misunderstanding here. Let me try to clarify. Previously, when I mentioned Nearby works fine with \"GPS only\" I meant it works for me in all cases. So, it works for me even if it's the first time. Of course, it takes time depending on where you are. It's quick when you're outdoors. It takes time when you're inside a building as it's hard to find the satellites when you're indoors. As I said before, Nearby only wants the location to be enabled. Nothing more than that. If you observe otherwise, then it's an issue we should look into. Try going outdoors and observe if your device is located by Nearby when the location is in \"GPS only\". Let me know how this goes.\nComing to the reason about why we don't want to show the dialog whenever the network provider is disabled. Some privacy conscious people would prefer always to use \"GPS only\" mode for the Location as there's some controversy about privacy issues associated with what we call the network provider. It's a valid claim. If we show the dialog when the location is in \"GPS only\" mode and the network provider is disabled, then there's a chance those people might misinterpret this. It's best if we just avoid this.", "author": "sivaraam", "createdAt": "2020-03-17T19:17:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Njc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyMzczMg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r393923732", "bodyText": "Try going outdoors and observe if your device is located by Nearby when the location is in \"GPS only\". Let me know how this goes.\n\nYou are right! I tested Nearby with GPS only from my roof and it worked! I should have tested it outdoors :(\nEdit: I have committed your changes.", "author": "aryan-earth", "createdAt": "2020-03-17T19:38:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg3Njc1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "90bcdc8ecd7ce48913f04760c8a13d999a4cd1e1", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 4ca6444be..04ec4b7c5 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1241,7 +1241,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n     @Override\n     public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         if (curLatLng == null) {\n-            if (!locationManager.isNetworkProviderEnabled()) {\n+            if (!(locationManager.isNetworkProviderEnabled() || locationManager.isGPSProviderEnabled())) {\n                 showLocationOffDialog();\n             }\n             return;\n"}}, {"oid": "90bcdc8ecd7ce48913f04760c8a13d999a4cd1e1", "url": "https://github.com/commons-app/apps-android-commons/commit/90bcdc8ecd7ce48913f04760c8a13d999a4cd1e1", "message": "Update app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\nCo-Authored-By: Kaartic Sivaraam <kaartic.sivaraam+github@gmail.com>", "committedDate": "2020-03-17T19:41:00Z", "type": "commit"}, {"oid": "7282c63b59f912af8e53c474fad1132d12062405", "url": "https://github.com/commons-app/apps-android-commons/commit/7282c63b59f912af8e53c474fad1132d12062405", "message": "Updated strings", "committedDate": "2020-03-17T19:55:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMDE0MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r394130140", "bodyText": "Looks like you've forgot to update this after updating the strings file.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n          \n          \n            \n                        Toast.makeText(getContext(), R.string.recommend_high_accuracy_mode, Toast.LENGTH_LONG).show();", "author": "sivaraam", "createdAt": "2020-03-18T06:32:51Z", "path": "app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java", "diffHunk": "@@ -1268,6 +1274,28 @@ public void recenterMap(fr.free.nrw.commons.location.LatLng curLatLng) {\n         mapBox.animateCamera(CameraUpdateFactory.newCameraPosition(position), 1000);\n     }\n \n+    @Override\n+    public void showLocationOffDialog() {\n+        // This creates a dialog box that prompts the user to enable location\n+        DialogUtil\n+            .showAlertDialog(getActivity(), getString(R.string.ask_to_turn_location_on), getString(R.string.nearby_needs_location),\n+                getString(R.string.yes), getString(R.string.no),  this::openLocationSettings, null);\n+    }\n+\n+    @Override\n+    public void openLocationSettings() {\n+        // This method opens the location settings of the device along with a followup toast.\n+        Intent intent = new Intent(Settings.ACTION_LOCATION_SOURCE_SETTINGS);\n+        PackageManager packageManager = getActivity().getPackageManager();\n+\n+        if (intent.resolveActivity(packageManager)!= null) {\n+            startActivity(intent);\n+            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();", "originalCommit": "7282c63b59f912af8e53c474fad1132d12062405", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwOTE4MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r394209181", "bodyText": "Looks like you've forgot to update this after updating the strings file.\n\nAh! I am sorry. I was just too excited last night to get this PR merged since it's practically my first PR to any open source project.", "author": "aryan-earth", "createdAt": "2020-03-18T09:29:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMDE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIzNTI5MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r394235290", "bodyText": "It's totally understandable. I still distinctly remember how it felt when I had my first ever open source patch accepted. It was like flying the air \u2708\ufe0f. Ironically the patch was a change to the antigravity python module \ud83d\ude04\nAnyways, congratulation on your first PR! \ud83c\udf89  Well done.", "author": "sivaraam", "createdAt": "2020-03-18T10:12:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMDE0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDI3NjY2NQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3438#discussion_r394276665", "bodyText": "Ironically the patch was a change to the antigravity python module smile\n\nXKCD, wow. A man of culture \ud83d\udc4f", "author": "aryan-earth", "createdAt": "2020-03-18T11:26:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDEzMDE0MA=="}], "type": "inlineReview", "revised_code": {"commit": "ac643c38bfd0ffe3c928c9a5611a349bf2c49997", "chunk": "diff --git a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\nindex 04ec4b7c5..bd8418dda 100644\n--- a/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n+++ b/app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\n@@ -1290,7 +1290,7 @@ public class NearbyParentFragment extends CommonsDaggerSupportFragment\n \n         if (intent.resolveActivity(packageManager)!= null) {\n             startActivity(intent);\n-            Toast.makeText(getContext(), R.string.set_location_mode_high_accuracy, Toast.LENGTH_LONG).show();\n+            Toast.makeText(getContext(), R.string.recommend_high_accuracy_mode, Toast.LENGTH_LONG).show();\n         } else {\n             Toast.makeText(getContext(), R.string.cannot_open_location_settings, Toast.LENGTH_LONG).show();\n         }\n"}}, {"oid": "ac643c38bfd0ffe3c928c9a5611a349bf2c49997", "url": "https://github.com/commons-app/apps-android-commons/commit/ac643c38bfd0ffe3c928c9a5611a349bf2c49997", "message": "Update app/src/main/java/fr/free/nrw/commons/nearby/fragments/NearbyParentFragment.java\n\nCo-Authored-By: Kaartic Sivaraam <kaartic.sivaraam+github@gmail.com>", "committedDate": "2020-03-18T09:29:52Z", "type": "commit"}]}