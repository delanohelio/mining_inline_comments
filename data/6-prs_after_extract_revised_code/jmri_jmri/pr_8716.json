{"pr_number": 8716, "pr_title": "fix: Allow Property Change notifications to be muted", "pr_createdAt": "2020-06-19T22:55:03Z", "pr_url": "https://github.com/JMRI/JMRI/pull/8716", "timeline": [{"oid": "725f955f06054aa81c9750967f964747fbd847cb", "url": "https://github.com/JMRI/JMRI/commit/725f955f06054aa81c9750967f964747fbd847cb", "message": "Merge remote-tracking branch 'upstream/master' into propertychangesupport", "committedDate": "2020-05-17T15:00:59Z", "type": "commit"}, {"oid": "f165d052a5505431eeecdf42cce3e9e1d2ad4e8b", "url": "https://github.com/JMRI/JMRI/commit/f165d052a5505431eeecdf42cce3e9e1d2ad4e8b", "message": "feat: allow property change notifications to be muted", "committedDate": "2020-06-19T21:13:34Z", "type": "commit"}, {"oid": "26619f80e43b1c1f1940175acad99957962cb9af", "url": "https://github.com/JMRI/JMRI/commit/26619f80e43b1c1f1940175acad99957962cb9af", "message": "Merge remote-tracking branch 'upstream/master' into mutablepropertychangesinmanagers", "committedDate": "2020-06-19T21:14:03Z", "type": "commit"}, {"oid": "ec65caec8abaaa62352e7a4574ad3a20c29d7f25", "url": "https://github.com/JMRI/JMRI/commit/ec65caec8abaaa62352e7a4574ad3a20c29d7f25", "message": "fix: use documented method name", "committedDate": "2020-06-19T22:32:06Z", "type": "commit"}, {"oid": "dd84dc78b2cc6433f336c7d388c611d998100078", "url": "https://github.com/JMRI/JMRI/commit/dd84dc78b2cc6433f336c7d388c611d998100078", "message": "fix: be more efficient", "committedDate": "2020-06-19T22:32:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r443315921", "bodyText": "I think it would be good to send the event on muted -> false regardless of which propertyName is provided.  Otherwise somebody is going to track code other property some day and get a confusing surprise.\n\n\nIs the behavior specified if setPropertyChangeMuted(.. , false) is called twice?", "author": "bobjacobsen", "createdAt": "2020-06-22T04:51:56Z", "path": "java/src/jmri/managers/AbstractProxyManager.java", "diffHunk": "@@ -613,6 +615,18 @@ protected void recomputeNamedBeanSet() {\n         return Collections.unmodifiableSortedSet(namedBeanSet);\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    @OverridingMethodsMustInvokeSuper\n+    public void setPropertyChangesMuted(String propertyName, boolean muted) {", "originalCommit": "dd84dc78b2cc6433f336c7d388c611d998100078", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzQ0NDMzNA==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r443444334", "bodyText": "I think it would be good to send the event on muted -> false regardless of which propertyName is provided.  Otherwise somebody is going to track code other property some day and get a confusing surprise.\n\n\nI'll have to think about how to do that. A naive approach would be to just always fire a PropertyChangeEvent with null property values whenever setting muted to false. A more sophisticated approach would involve retaining the old value and sending the current value for any property that is muted while it is muted, and then firing the event with the old value and the current value when unmuted a muted property.\n\n\nIs the behavior specified if setPropertyChangeMuted(.. , false) is called twice?\n\n\nI have not specified any behavior if setPropertyChangeMuted(..., false) is called twice. Do you prefer that I define setPropertyChangeMuted(...) be idempotent if the parameter equals the current state of muted?", "author": "rhwood", "createdAt": "2020-06-22T09:51:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYwMTMwMg==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r443601302", "bodyText": "re: any property name - that's probably more effort than needed for the concern. How about throwing an IllegalArgumentException so somebody coding it releases it's missing?  Or logging at Error so it fails CI? (Assuming the tests trip it)\nre behavior: I think it would be helpful to add a line or two in the Manager Javadoc, something like \"resetting to false will fire a property event that represents state after any muted events, but is not necessarily exactly those events; don't expect it to be an exact queue. Setting to false twice may or may not fire the same events.\"", "author": "bobjacobsen", "createdAt": "2020-06-22T14:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzYwMjAyMQ==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r443602021", "bodyText": "(Sorry, pushed comment too soon). What I'd like to avoid is \"Oh, if I just set that false, I can fire events through the system; cool!\"", "author": "bobjacobsen", "createdAt": "2020-06-22T14:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDA4ODc2Mg==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r444088762", "bodyText": "What I'd like to avoid is \"Oh, if I just set that false, I can fire events through the system; cool!\"\n\nI'm beginning to think that if that is a desired side effect, I need to track the state of the property to prevent\nm.setPropertyChangeMuted(\"foo\", true);\nm.setPropertyChangeMuted(\"foo\", false);\n\nfrom being such a trigger.", "author": "rhwood", "createdAt": "2020-06-23T09:27:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE5NjQ3NQ==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r444196475", "bodyText": "@bobjacobsen\n\nWhat I'd like to avoid is \"Oh, if I just set that false, I can fire events through the system; cool!\"\n\nI'm reading the thread, but I don't really understand all the comments. Can you explain what you mean with this?", "author": "danielb987", "createdAt": "2020-06-23T12:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI3MjIxNg==", "url": "https://github.com/JMRI/JMRI/pull/8716#discussion_r444272216", "bodyText": "I'm beginning to think that if that is a desired side effect, I need to track the state of the property\n\nOr, as it's doing now, check for a particular property name that's allowed to be muted, and throw an exception if there's an attempt to mute any other one.\n\nCan you explain what you mean with this?\n\nPeople tend to grab and ad-hoc solution at hand in JMRI, particularly new people. There have been multiple cases where, faced with \"well, I updated stuff, but it's not updating on the screen\", instead of fixing the underlying problem the (new) programmer looks around for something that has the side-effect of firing semi-random events until the screen eventually does update.  (I just took a case of that out of LayoutEditor; it was a pain to fix right) So I prefer to keep event-firing things focused on just what they need to do. But it's not an absolute rule, just a preference for avoiding code smells.  If it's hard to implement in the code, a Javadoc comment is an OK 2nd choice.", "author": "bobjacobsen", "createdAt": "2020-06-23T14:33:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMxNTkyMQ=="}], "type": "inlineReview", "revised_code": null}]}