{"pr_number": 7968, "pr_title": "Linting", "pr_createdAt": "2020-01-18T13:01:13Z", "pr_url": "https://github.com/JMRI/JMRI/pull/7968", "timeline": [{"oid": "9fcb0725f65acc92f7c7688d61de56750c2e8818", "url": "https://github.com/JMRI/JMRI/commit/9fcb0725f65acc92f7c7688d61de56750c2e8818", "message": "linting", "committedDate": "2020-01-17T05:11:50Z", "type": "commit"}, {"oid": "bb47d066a44204ceea6f6facafa944461d11ba02", "url": "https://github.com/JMRI/JMRI/commit/bb47d066a44204ceea6f6facafa944461d11ba02", "message": "Fix compile error", "committedDate": "2020-01-17T05:38:49Z", "type": "commit"}, {"oid": "6aed2f979411896d07a9ef9424e8aa8f34280b3e", "url": "https://github.com/JMRI/JMRI/commit/6aed2f979411896d07a9ef9424e8aa8f34280b3e", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-18T02:43:03Z", "type": "commit"}, {"oid": "ed1b59b7c63a3c225cedae5a7178247ada031481", "url": "https://github.com/JMRI/JMRI/commit/ed1b59b7c63a3c225cedae5a7178247ada031481", "message": "linting", "committedDate": "2020-01-18T03:54:51Z", "type": "commit"}, {"oid": "004bb46055c203d3ed940285ed810f400b1d880d", "url": "https://github.com/JMRI/JMRI/commit/004bb46055c203d3ed940285ed810f400b1d880d", "message": "more linting", "committedDate": "2020-01-18T06:39:41Z", "type": "commit"}, {"oid": "d9ba29f2e6467ff893078ce69fbecf3c1079b24a", "url": "https://github.com/JMRI/JMRI/commit/d9ba29f2e6467ff893078ce69fbecf3c1079b24a", "message": "Remove unused variable", "committedDate": "2020-01-18T12:58:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyNzQxMw==", "url": "https://github.com/JMRI/JMRI/pull/7968#discussion_r368227413", "bodyText": "It seems this means that if there are multiple Engineers, they all share the same synchronization lock, and is that really what\u2019s wanted?", "author": "rhwood", "createdAt": "2020-01-18T13:38:37Z", "path": "java/src/jmri/jmrit/logix/Engineer.java", "diffHunk": "@@ -40,16 +42,17 @@\n     private boolean _waitForClear = false;  // waits for signals/occupancy/allocation to clear\n     private boolean _waitForSync = false;  // waits for train to catch up to commands\n     private boolean _waitForSensor = false; // wait for sensor event\n-    private boolean _runOnET = false;   // Execute commands on ET only - do not synch\n+    private boolean _runOnET = false;   // Execute commands on ET only - do not synchn\n     private boolean _setRunOnET = false; // Need to delay _runOnET from the block that set it\n     private int _syncIdx;           // block order index of current command\n     protected DccThrottle _throttle;\n     private final Warrant _warrant;\n     private final List<ThrottleSetting> _commands;\n     private Sensor _waitSensor;\n     private int _sensorWaitState;\n-    private ThrottleRamp _ramp;\n     final ReentrantLock _lock = new ReentrantLock(true);    // Ramp needs to block script speeds\n+    private static Object _lockObject = new Object(); // used for synchronizing threads for _ramp", "originalCommit": "d9ba29f2e6467ff893078ce69fbecf3c1079b24a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMTg5NQ==", "url": "https://github.com/JMRI/JMRI/pull/7968#discussion_r368231895", "bodyText": "I am actually not sure.\nPreviously, the synchronization was using a thread instance, which shouldn\u2019t be done.\nAt least one of those references was in a static method, hence turning this into a static....\nBut some of the tests are failing on Travis , so this probably needs to be rethought, as it isn\u2019t right.", "author": "pabender", "createdAt": "2020-01-18T15:16:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyNzQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI0MDMxNw==", "url": "https://github.com/JMRI/JMRI/pull/7968#discussion_r368240317", "bodyText": "This should be fixed now.  The static reference was on an intern class, soI have it a lock object of its own.", "author": "pabender", "createdAt": "2020-01-18T18:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyNzQxMw=="}], "type": "inlineReview", "revised_code": {"commit": "ecd00a1adeb7f2957319a0c24127031f88f1f0cc", "chunk": "diff --git a/java/src/jmri/jmrit/logix/Engineer.java b/java/src/jmri/jmrit/logix/Engineer.java\nindex 6ea9bf68f5..46bae4b92e 100644\n--- a/java/src/jmri/jmrit/logix/Engineer.java\n+++ b/java/src/jmri/jmrit/logix/Engineer.java\n\n@@ -51,7 +51,7 @@ public class Engineer extends Thread implements java.beans.PropertyChangeListene\n     private Sensor _waitSensor;\n     private int _sensorWaitState;\n     final ReentrantLock _lock = new ReentrantLock(true);    // Ramp needs to block script speeds\n-    private static Object _lockObject = new Object(); // used for synchronizing threads for _ramp\n+    private Object _lockObject = new Object(); // used for synchronizing threads for _ramp\n     private ThrottleRamp _ramp;\n     private boolean _atHalt = false;\n     private boolean _atClear = false;\n"}}, {"oid": "ecd00a1adeb7f2957319a0c24127031f88f1f0cc", "url": "https://github.com/JMRI/JMRI/commit/ecd00a1adeb7f2957319a0c24127031f88f1f0cc", "message": "Remove static on lock", "committedDate": "2020-01-18T15:20:02Z", "type": "commit"}, {"oid": "a9ec4f3c0185aa1afeb452ad912406c88cdd6b29", "url": "https://github.com/JMRI/JMRI/commit/a9ec4f3c0185aa1afeb452ad912406c88cdd6b29", "message": "Separate lock for termination thread.", "committedDate": "2020-01-18T15:33:40Z", "type": "commit"}, {"oid": "c7b769908aed147b6d1839f3930a8fed4b97955d", "url": "https://github.com/JMRI/JMRI/commit/c7b769908aed147b6d1839f3930a8fed4b97955d", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-18T18:11:38Z", "type": "commit"}, {"oid": "136b2cde3959b4ce1642a9c4b0c7b80617c6039e", "url": "https://github.com/JMRI/JMRI/commit/136b2cde3959b4ce1642a9c4b0c7b80617c6039e", "message": "work to fix tests", "committedDate": "2020-01-18T20:43:23Z", "type": "commit"}, {"oid": "10203dd716cc5ef4639b181d0041f550ee0bea10", "url": "https://github.com/JMRI/JMRI/commit/10203dd716cc5ef4639b181d0041f550ee0bea10", "message": "remove findbugs sync warning suppression", "committedDate": "2020-01-18T22:33:54Z", "type": "commit"}, {"oid": "82c2bbae52980bb97c362c1cb74d882c3b5da0a8", "url": "https://github.com/JMRI/JMRI/commit/82c2bbae52980bb97c362c1cb74d882c3b5da0a8", "message": "retain ThrottleManager reference at construction time.", "committedDate": "2020-01-18T23:09:40Z", "type": "commit"}, {"oid": "360b6db6d3a1cc05cd9b449fab26a047e943d800", "url": "https://github.com/JMRI/JMRI/commit/360b6db6d3a1cc05cd9b449fab26a047e943d800", "message": "linting", "committedDate": "2020-01-18T23:10:21Z", "type": "commit"}, {"oid": "de0d79d3d44928c59211b6d817fb31348f09c38d", "url": "https://github.com/JMRI/JMRI/commit/de0d79d3d44928c59211b6d817fb31348f09c38d", "message": "restore original synchronization in CheckForTermination", "committedDate": "2020-01-19T02:07:19Z", "type": "commit"}, {"oid": "6dcf3d5bdd527868396719e04495615be1d9fa47", "url": "https://github.com/JMRI/JMRI/commit/6dcf3d5bdd527868396719e04495615be1d9fa47", "message": "synchronize sensor wait on the sensor", "committedDate": "2020-01-19T05:16:24Z", "type": "commit"}, {"oid": "9c85941441d78147996187a1eee9a7d19d7568cf", "url": "https://github.com/JMRI/JMRI/commit/9c85941441d78147996187a1eee9a7d19d7568cf", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-19T20:57:15Z", "type": "commit"}, {"oid": "a6e67163c5ee35645ea1c0a2fd8189b624450d3b", "url": "https://github.com/JMRI/JMRI/commit/a6e67163c5ee35645ea1c0a2fd8189b624450d3b", "message": "more linting", "committedDate": "2020-01-19T20:58:01Z", "type": "commit"}, {"oid": "29d9332f389a1172e0a1e1eaea16336cfcc39b1b", "url": "https://github.com/JMRI/JMRI/commit/29d9332f389a1172e0a1e1eaea16336cfcc39b1b", "message": "more linting, test corrections", "committedDate": "2020-01-21T00:05:33Z", "type": "commit"}, {"oid": "07ae2fed2d9aea036aaf055c6e4258dc2d55a69f", "url": "https://github.com/JMRI/JMRI/commit/07ae2fed2d9aea036aaf055c6e4258dc2d55a69f", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-21T00:06:07Z", "type": "commit"}, {"oid": "89f66dea6b60b429d95692972e7d67d9498bfc8f", "url": "https://github.com/JMRI/JMRI/commit/89f66dea6b60b429d95692972e7d67d9498bfc8f", "message": "linting;remove intermittent flag from tests believed to fixed by this PR", "committedDate": "2020-01-21T05:51:10Z", "type": "commit"}, {"oid": "ab5eea478a4dec650bb3ac78a21c73155435a6d5", "url": "https://github.com/JMRI/JMRI/commit/ab5eea478a4dec650bb3ac78a21c73155435a6d5", "message": "add missing not from refactoring", "committedDate": "2020-01-21T06:09:15Z", "type": "commit"}, {"oid": "aa2e3354e2ed2d29dfdbfddce57bc1a7c910107a", "url": "https://github.com/JMRI/JMRI/commit/aa2e3354e2ed2d29dfdbfddce57bc1a7c910107a", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-21T17:25:41Z", "type": "commit"}, {"oid": "db0a46cd09446e995de045950935ea6ff42c94ac", "url": "https://github.com/JMRI/JMRI/commit/db0a46cd09446e995de045950935ea6ff42c94ac", "message": "Merge branch 'master' of https://github.com/JMRI/JMRI into development", "committedDate": "2020-01-22T01:03:46Z", "type": "commit"}, {"oid": "075d706c76c3caf65eaddb684e9464785b20516b", "url": "https://github.com/JMRI/JMRI/commit/075d706c76c3caf65eaddb684e9464785b20516b", "message": "complete setup of test to prevent NPE", "committedDate": "2020-01-22T03:12:27Z", "type": "commit"}, {"oid": "8c43d001be71ff5568f634406e927eed2ec56522", "url": "https://github.com/JMRI/JMRI/commit/8c43d001be71ff5568f634406e927eed2ec56522", "message": "restore intermittent flags to be safe (some timeouts have occured)", "committedDate": "2020-01-23T04:01:19Z", "type": "commit"}]}