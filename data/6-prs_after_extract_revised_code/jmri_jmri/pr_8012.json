{"pr_number": 8012, "pr_title": "Prevent loop in getValidation() due to -1 combo index", "pr_createdAt": "2020-01-27T05:40:00Z", "pr_url": "https://github.com/JMRI/JMRI/pull/8012", "timeline": [{"oid": "f38ec5b3c4bb749b5a8b53d8fb2188b70a755b9c", "url": "https://github.com/JMRI/JMRI/commit/f38ec5b3c4bb749b5a8b53d8fb2188b70a755b9c", "message": "Prevent loop in getValidation() due to -1 combo index", "committedDate": "2020-01-27T05:38:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE1OTg5MQ==", "url": "https://github.com/JMRI/JMRI/pull/8012#discussion_r371159891", "bodyText": "This is not the correct fix because on line 464 in this method, we set the selected item and therefor selected index. If we stipulate that the selected index can only change if a prior selection has been made, keyboard input will not be able to move the selection in a non-editable combobox, which breaks a design intention (i.e. the intention is that, even in a non-editable combobox, a user should be able to begin typing a name and have the combobox scroll to the closest match; breaking that will be considered a regression).", "author": "rhwood", "createdAt": "2020-01-27T10:24:19Z", "path": "java/src/jmri/swing/NamedBeanComboBox.java", "diffHunk": "@@ -454,7 +454,7 @@ public NamedBeanEditor(ComboBoxEditor editor) {\n                 jc.setInputVerifier(new JInputValidator(jc, true, false) {\n                     @Override\n                     protected Validation getValidation(JComponent component, JInputValidatorPreferences preferences) {\n-                        if (component instanceof JTextComponent) {\n+                        if (component instanceof JTextComponent && getSelectedIndex() != -1) {", "originalCommit": "f38ec5b3c4bb749b5a8b53d8fb2188b70a755b9c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edb0762317f8ba204ee0257dfae285cbb6dd2b78", "chunk": "diff --git a/java/src/jmri/swing/NamedBeanComboBox.java b/java/src/jmri/swing/NamedBeanComboBox.java\nindex 837e2beef1..f13109f2d4 100644\n--- a/java/src/jmri/swing/NamedBeanComboBox.java\n+++ b/java/src/jmri/swing/NamedBeanComboBox.java\n\n@@ -454,7 +454,7 @@ public class NamedBeanComboBox<B extends NamedBean> extends JComboBox<B> {\n                 jc.setInputVerifier(new JInputValidator(jc, true, false) {\n                     @Override\n                     protected Validation getValidation(JComponent component, JInputValidatorPreferences preferences) {\n-                        if (component instanceof JTextComponent && getSelectedIndex() != -1) {\n+                        if (component instanceof JTextComponent) {\n                             JTextComponent jtc = (JTextComponent) component;\n                             String text = jtc.getText();\n                             if (text != null && !text.isEmpty()) {\n"}}, {"oid": "edb0762317f8ba204ee0257dfae285cbb6dd2b78", "url": "https://github.com/JMRI/JMRI/commit/edb0762317f8ba204ee0257dfae285cbb6dd2b78", "message": "Narrow the scope of the no selection, -1, protection", "committedDate": "2020-01-27T18:42:35Z", "type": "commit"}]}