{"pr_number": 133, "pr_title": "[560934] Always display the confirmation dialog even for protected elements", "pr_createdAt": "2020-03-11T16:46:21Z", "pr_url": "https://github.com/eclipse/capella/pull/133", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0NjMzMg==", "url": "https://github.com/eclipse/capella/pull/133#discussion_r391446332", "bodyText": "can you use plugin id instead of sss", "author": "pdulth", "createdAt": "2020-03-12T07:45:02Z", "path": "core/plugins/org.polarsys.capella.core.platform.sirius.ui.actions/src/org/polarsys/capella/core/platform/sirius/ui/commands/CapellaDeleteCommand.java", "diffHunk": "@@ -108,15 +111,23 @@ public void run() {\n   }\n \n   protected boolean confirmDeletion() {\n-    final int dialogResult[] = new int[] { 0 };\n+    Set<?> elementsToDelete = getAllElementsToDelete();\n+    ConfirmDeleteCapellaElementDialog confirmDeletionDialog = new ConfirmDeleteCapellaElementDialog(\n+        new ArrayList<Object>(elementsToDelete), true, getExpandedSelection().toArray()) {\n+          @Override\n+          protected IStatus getStatus() {\n+            if (CapellaDeleteAction.canDelete(elementsToDelete)) {\n+              return Status.OK_STATUS;\n+            }\n+            return new Status(Status.ERROR, \"ss\", \"At least one model element is protected to avoid its deletion.\\nPlease have a look to Preferences > Capella > Delete.\");", "originalCommit": "4935461a5255f487aa94e14a8634a791b16d66d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "78519d067579fee51d371c5f86c3d2ed9ca95e66", "chunk": "diff --git a/core/plugins/org.polarsys.capella.core.platform.sirius.ui.actions/src/org/polarsys/capella/core/platform/sirius/ui/commands/CapellaDeleteCommand.java b/core/plugins/org.polarsys.capella.core.platform.sirius.ui.actions/src/org/polarsys/capella/core/platform/sirius/ui/commands/CapellaDeleteCommand.java\nindex 24c110153..6d0890bb4 100644\n--- a/core/plugins/org.polarsys.capella.core.platform.sirius.ui.actions/src/org/polarsys/capella/core/platform/sirius/ui/commands/CapellaDeleteCommand.java\n+++ b/core/plugins/org.polarsys.capella.core.platform.sirius.ui.actions/src/org/polarsys/capella/core/platform/sirius/ui/commands/CapellaDeleteCommand.java\n\n@@ -119,7 +122,14 @@ public class CapellaDeleteCommand extends BasicCapellaDeleteCommand {\n             if (CapellaDeleteAction.canDelete(elementsToDelete)) {\n               return Status.OK_STATUS;\n             }\n-            return new Status(Status.ERROR, \"ss\", \"At least one model element is protected to avoid its deletion.\\nPlease have a look to Preferences > Capella > Delete.\");\n+            return new Status(Status.ERROR, CapellaActionsActivator.PLUGIN_ID,\n+                Messages.CapellaDeleteCommand_ProtectedElementsError);\n+          }\n+\n+          @Override\n+          public Set<Object> getProtectedElements() {\n+            return elementsToDelete.stream().filter(Element.class::isInstance).map(Element.class::cast)\n+            .filter(CapellaDeleteAction::isElementProtected).collect(Collectors.toSet());\n           }\n     };\n     PlatformUI.getWorkbench().getDisplay().syncExec(new Runnable() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0NjY1Mg==", "url": "https://github.com/eclipse/capella/pull/133#discussion_r391446652", "bodyText": "does this override is useful?", "author": "pdulth", "createdAt": "2020-03-12T07:45:49Z", "path": "core/plugins/org.polarsys.capella.core.ui.toolkit/src/org/polarsys/capella/core/ui/toolkit/dialogs/ImpactAnalysisDialog.java", "diffHunk": "@@ -312,23 +317,34 @@ protected Object filterComputedParent(Object parent__p, Object element_p) {\n       }\n \t\treturn input;\n \t}\n-  \n \n-  /**\n-   * @see org.polarsys.capella.common.ui.toolkit.dialogs.AbstractMessageDialogWithViewer#getInitialInputData()\n-   */\n   @Override\n-  protected TreeData getInitialInputData() {\n-    return new TreeData(_referencingElements, null);\n+  protected void doCreateDialogArea(Composite dialogAreaComposite) {\n+    Composite containingComposite = new Composite(dialogAreaComposite, SWT.NONE);\n+    GridLayout layout = new GridLayout(1, true);\n+    containingComposite.setLayout(layout);\n+    containingComposite.setLayoutData(new GridData(GridData.FILL_BOTH));\n+    // Create the viewer area.\n+    createViewerArea(containingComposite);\n+  }\n+\n+  protected void createViewerArea(Composite parent) {\n+    // Create the viewer.\n+    _viewer = createViewer(parent);\n+    // Set Input data.\n+    _viewer.setInput(getInitialInputData());\n+  }\n+\n+  @Override\n+  protected Object getResult() {", "originalCommit": "4935461a5255f487aa94e14a8634a791b16d66d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "47a01fc62da67a427c818e3cdd19486f937df09f", "chunk": "diff --git a/core/plugins/org.polarsys.capella.core.ui.toolkit/src/org/polarsys/capella/core/ui/toolkit/dialogs/ImpactAnalysisDialog.java b/core/plugins/org.polarsys.capella.core.ui.toolkit/src/org/polarsys/capella/core/ui/toolkit/dialogs/ImpactAnalysisDialog.java\nindex 9db22c07b..9284b576d 100644\n--- a/core/plugins/org.polarsys.capella.core.ui.toolkit/src/org/polarsys/capella/core/ui/toolkit/dialogs/ImpactAnalysisDialog.java\n+++ b/core/plugins/org.polarsys.capella.core.ui.toolkit/src/org/polarsys/capella/core/ui/toolkit/dialogs/ImpactAnalysisDialog.java\n\n@@ -276,47 +269,48 @@ public class ImpactAnalysisDialog extends AbstractViewerDialog {\n     viewer.setSorter(new ImpactAnalysisSorter());\n     return viewer;\n   }\n-  \n+\n   /**\n-   *   \n+   * \n    * @param isCheckedShowResourceButton\n    * @param referencingElements\n    * @return\n    */\n-\tprotected TreeData getTreeViewerItems(boolean isCheckedShowResourceButton, List<Object> referencingElements) {\n-\t\tTreeData input;\n-\t\tif (isCheckedShowResourceButton) {\n-        // Change the viewer's input to take into account resource as parent.\n-        input = new TreeData(referencingElements, null) {\n-          /**\n-           * @see org.polarsys.capella.common.ui.toolkit.viewers.data.TreeData#filterComputedParent(java.lang.Object, java.lang.Object)\n-           */\n-          @Override\n-          protected Object filterComputedParent(Object parent__p, Object element_p) {\n-            // Check if computed parent and its child (i.e specified element) have the same resource.\n-            if (!(parent__p instanceof EObject) || !(element_p instanceof EObject)) {\n-              return parent__p;\n-            }\n-            Object parent = parent__p;\n-            // Get the resource that hosts the parent object.\n-            Resource parentResource = ((EObject) parent__p).eResource();\n-            // Get the resource that hosts the child object.\n-            Resource childResource = ((EObject) element_p).eResource();\n-            // Check if both resources are equals.\n-            if (!parentResource.equals(childResource)) {\n-              // The child object is not hosts by the parent resource.\n-              // Since we want to display resources in the tree viewer, the parent for this child is its resource.\n-              parent = childResource;\n-            }\n-            return parent;\n+  protected TreeData getTreeViewerItems(boolean isCheckedShowResourceButton, List<Object> referencingElements) {\n+    TreeData input;\n+    if (isCheckedShowResourceButton) {\n+      // Change the viewer's input to take into account resource as parent.\n+      input = new TreeData(referencingElements, null) {\n+        /**\n+         * @see org.polarsys.capella.common.ui.toolkit.viewers.data.TreeData#filterComputedParent(java.lang.Object,\n+         *      java.lang.Object)\n+         */\n+        @Override\n+        protected Object filterComputedParent(Object parent__p, Object element_p) {\n+          // Check if computed parent and its child (i.e specified element) have the same resource.\n+          if (!(parent__p instanceof EObject) || !(element_p instanceof EObject)) {\n+            return parent__p;\n           }\n-        };\n-      } else {\n-        // Change the viewer's input to classic data input.\n-        input = new TreeData(referencingElements, null);\n-      }\n-\t\treturn input;\n-\t}\n+          Object parent = parent__p;\n+          // Get the resource that hosts the parent object.\n+          Resource parentResource = ((EObject) parent__p).eResource();\n+          // Get the resource that hosts the child object.\n+          Resource childResource = ((EObject) element_p).eResource();\n+          // Check if both resources are equals.\n+          if (!parentResource.equals(childResource)) {\n+            // The child object is not hosts by the parent resource.\n+            // Since we want to display resources in the tree viewer, the parent for this child is its resource.\n+            parent = childResource;\n+          }\n+          return parent;\n+        }\n+      };\n+    } else {\n+      // Change the viewer's input to classic data input.\n+      input = new TreeData(referencingElements, null);\n+    }\n+    return input;\n+  }\n \n   @Override\n   protected void doCreateDialogArea(Composite dialogAreaComposite) {\n"}}, {"oid": "78519d067579fee51d371c5f86c3d2ed9ca95e66", "url": "https://github.com/eclipse/capella/commit/78519d067579fee51d371c5f86c3d2ed9ca95e66", "message": "[560934] Deleting model element in Capability Realization Blank does\nopen \"Delete\" dialog window\n\nBug: 560934\nChange-Id: Ie634abb3566a456e54c71531905316d8fb9e4e69\nSigned-off-by: Jeremy Aubry <jaubry@obeo.fr>", "committedDate": "2020-03-13T14:37:04Z", "type": "forcePushed"}, {"oid": "20118c1a9dab711f4da3ba30e4b733c5b32bf726", "url": "https://github.com/eclipse/capella/commit/20118c1a9dab711f4da3ba30e4b733c5b32bf726", "message": "[560934] Always display the confirmation dialog even for protected\nelements\n\n- A decorator has been added on protected elements\n\nBug: 560934\nChange-Id: Ie634abb3566a456e54c71531905316d8fb9e4e69\nSigned-off-by: Jeremy Aubry <jaubry@obeo.fr>", "committedDate": "2020-03-17T14:06:01Z", "type": "commit"}, {"oid": "47a01fc62da67a427c818e3cdd19486f937df09f", "url": "https://github.com/eclipse/capella/commit/47a01fc62da67a427c818e3cdd19486f937df09f", "message": "[560934] Improve protected elements deletion\n\n- Error message weren't logged\n- Dialog doesn't had default height\n- Command name wasn't 'Delete' in undo, but 'Confirmation Deletion'.\n\nChange-Id: Ife46fa58e7795b1d1366a645622e468937917cdc\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-17T14:06:13Z", "type": "commit"}, {"oid": "47a01fc62da67a427c818e3cdd19486f937df09f", "url": "https://github.com/eclipse/capella/commit/47a01fc62da67a427c818e3cdd19486f937df09f", "message": "[560934] Improve protected elements deletion\n\n- Error message weren't logged\n- Dialog doesn't had default height\n- Command name wasn't 'Delete' in undo, but 'Confirmation Deletion'.\n\nChange-Id: Ife46fa58e7795b1d1366a645622e468937917cdc\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-17T14:06:13Z", "type": "forcePushed"}, {"oid": "79df0034a68e2717e0f553dfbbae2bf595c198e2", "url": "https://github.com/eclipse/capella/commit/79df0034a68e2717e0f553dfbbae2bf595c198e2", "message": "[560934] Fix scenario deletion issue and improve decoration\n\n- It was not possible to delete Scenario anymore, as Sequence Message\nwere protected. This is no longer the case\n- The lock decorator is now available in 'Preferences > General >\nAppearance > Label and Decorators' and can be enabled in Project\nExplorer\n- Updated documentation\n\nChange-Id: I13c4718d107617d5003634f51519afd38e1e5d26\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-19T16:06:02Z", "type": "forcePushed"}, {"oid": "f3f89f0b65b11e64a86837a88a8e755c2a933093", "url": "https://github.com/eclipse/capella/commit/f3f89f0b65b11e64a86837a88a8e755c2a933093", "message": "[560934] Fix scenario deletion issue and improve decoration\n\n- It was not possible to delete Scenario anymore, as Sequence Message\nwere protected. This is no longer the case\n- The lock decorator is now available in 'Preferences > General >\nAppearance > Label and Decorators' and can be enabled in Project\nExplorer\n- Updated documentation\n\nChange-Id: I13c4718d107617d5003634f51519afd38e1e5d26\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-19T16:07:58Z", "type": "forcePushed"}, {"oid": "ecf832664701626c532b44b15809f7dfa7488bc8", "url": "https://github.com/eclipse/capella/commit/ecf832664701626c532b44b15809f7dfa7488bc8", "message": "[560934] Fix scenario deletion issue and improve decoration\n\n- It was not possible to delete Scenario anymore, as Sequence Message\nwere protected. Sequence Message can be deleted since\n001d11f4cb7a93c2988ef873604d3acc8c6d9ddc\n- The lock decorator is now available in 'Preferences > General >\nAppearance > Label and Decorators' and can be enabled in Project\nExplorer\n- Updated documentation\n\nChange-Id: I13c4718d107617d5003634f51519afd38e1e5d26\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-20T08:27:38Z", "type": "commit"}, {"oid": "ecf832664701626c532b44b15809f7dfa7488bc8", "url": "https://github.com/eclipse/capella/commit/ecf832664701626c532b44b15809f7dfa7488bc8", "message": "[560934] Fix scenario deletion issue and improve decoration\n\n- It was not possible to delete Scenario anymore, as Sequence Message\nwere protected. Sequence Message can be deleted since\n001d11f4cb7a93c2988ef873604d3acc8c6d9ddc\n- The lock decorator is now available in 'Preferences > General >\nAppearance > Label and Decorators' and can be enabled in Project\nExplorer\n- Updated documentation\n\nChange-Id: I13c4718d107617d5003634f51519afd38e1e5d26\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-03-20T08:27:38Z", "type": "forcePushed"}]}