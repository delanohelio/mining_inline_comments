{"pr_number": 238, "pr_title": "Title Block Doc in Capella Help, Copy-Paste fix", "pr_createdAt": "2020-05-28T07:05:30Z", "pr_url": "https://github.com/eclipse/capella/pull/238", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MDM1MQ==", "url": "https://github.com/eclipse/capella/pull/238#discussion_r433280351", "bodyText": "This code should be added directly in org.polarsys.capella.core.platform.sirius.clipboard.actions.AbstractCopyPasteAction.getCopyPasteSelection().\nSince both CapellaDiagramCopyAction and CapellaDiagramPasteAction inherit from that class, this avoids duplication. Furthermore this will solve the bug in org.polarsys.capella.core.platform.sirius.clipboard.actions.CapellaDiagramCopyAction.isEnabled()) which wrongfully reports that a copy paste is possible only to be executed on 0 elements afterwards.", "author": "sandupostaru", "createdAt": "2020-06-01T14:50:07Z", "path": "core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramCopyAction.java", "diffHunk": "@@ -49,8 +49,12 @@ public void run(IAction action_p) {\n     } else {\r\n       // Copying graphical and semantic elements\r\n       List<? extends EObject> toCopy = getCopyPasteSelection();\r\n-      CapellaDiagramCopyCommand cmd = new CapellaDiagramCopyCommand(toCopy);\r\n-      MiscUtil.transactionallyExecute(toCopy, cmd);\r\n+      toCopy.removeIf(element -> (TitleBlockHelper.isTitleBlockAnnotation(LayerUtil.getSiriusElement((View)element).getTarget())));\r", "originalCommit": "46004df22cde6518689e2c6d7baa05750ccd5037", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2b9c56b55fe51323e23401f847dfb55787153116", "chunk": "diff --git a/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramCopyAction.java b/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramCopyAction.java\nindex 0577e63a9..09d498696 100644\n--- a/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramCopyAction.java\n+++ b/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramCopyAction.java\n\n@@ -49,12 +49,8 @@ public class CapellaDiagramCopyAction extends AbstractCopyPasteAction {\n     } else {\n       // Copying graphical and semantic elements\n       List<? extends EObject> toCopy = getCopyPasteSelection();\n-      toCopy.removeIf(element -> (TitleBlockHelper.isTitleBlockAnnotation(LayerUtil.getSiriusElement((View)element).getTarget())));\n-      \n-      if (toCopy.size() > 0) {\n-        CapellaDiagramCopyCommand cmd = new CapellaDiagramCopyCommand(toCopy);\n-        MiscUtil.transactionallyExecute(toCopy, cmd);\n-      }\n+      CapellaDiagramCopyCommand cmd = new CapellaDiagramCopyCommand(toCopy);\n+      MiscUtil.transactionallyExecute(toCopy, cmd);\n     }\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4MDYyMQ==", "url": "https://github.com/eclipse/capella/pull/238#discussion_r433280621", "bodyText": "See my above remark.", "author": "sandupostaru", "createdAt": "2020-06-01T14:50:29Z", "path": "core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramPasteAction.java", "diffHunk": "@@ -108,34 +109,37 @@ void doRun(IProgressMonitor monitor) {\n       monitor.beginTask(Messages.CapellaDiagramPasteAction_ProgressMessage, 2);\n       // Selection not empty because action enabled\n       final List<? extends View> gmfSelection = getCopyPasteSelection();\n+      gmfSelection.removeIf(element -> (TitleBlockHelper.isTitleBlockAnnotation(LayerUtil.getSiriusElement((View)element).getTarget())));", "originalCommit": "46004df22cde6518689e2c6d7baa05750ccd5037", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2b9c56b55fe51323e23401f847dfb55787153116", "chunk": "diff --git a/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramPasteAction.java b/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramPasteAction.java\nindex 41f83ed82..46d024e3e 100644\n--- a/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramPasteAction.java\n+++ b/core/plugins/org.polarsys.capella.core.platform.sirius.clipboard/src/org/polarsys/capella/core/platform/sirius/clipboard/actions/CapellaDiagramPasteAction.java\n\n@@ -109,37 +108,34 @@ public class CapellaDiagramPasteAction extends AbstractCopyPasteAction {\n       monitor.beginTask(Messages.CapellaDiagramPasteAction_ProgressMessage, 2);\n       // Selection not empty because action enabled\n       final List<? extends View> gmfSelection = getCopyPasteSelection();\n-      gmfSelection.removeIf(element -> (TitleBlockHelper.isTitleBlockAnnotation(LayerUtil.getSiriusElement((View)element).getTarget())));\n       // Sirius + Capella layer\n       monitor.worked(1);\n-      if (gmfSelection.size() > 0) {\n-        final CapellaDiagramPasteCommand siriusCmd = new CapellaDiagramPasteCommand(gmfSelection, true);\n-        boolean success = MiscUtil.transactionallyExecute(gmfSelection, siriusCmd);\n-        monitor.worked(1);\n-  \n-        if (success) {\n-  \n-          // Set format (layout and/or style) to pasted elements and move them under the mouse cursor\n-          // Keep mouse location\n-          final Point relativeLocation = getRelativeLocation();\n-          // GraphicalAdjustmentCommand is executed asynchronously to come after the SiriusCanonicalLayoutCommand\n-          Display.getDefault().asyncExec(() -> {\n-            View target = siriusCmd.getGmfTarget();\n-            EObject siriusTarget = LayerUtil.getSiriusElement(target);\n-            GraphicalAdjustmentCommand gmfCmd;\n-            if (SiriusUtil.layoutIsConstrained(siriusTarget) && mustRefresh()) {\n-              // Just refresh the diagram\n-              gmfCmd = new GraphicalAdjustmentCommand(target);\n-            } else {\n-              // Duplicate layout\n-              gmfCmd = new GraphicalAdjustmentCommand((List) siriusCmd.getResults(),\n-                  siriusCmd.getPastedSiriusElementsOrigins(), target, relativeLocation, mustRefresh(), mustPasteLayout(),\n-                  mustPasteStyle());\n-            }\n-            MiscUtil.transactionallyExecute(gmfSelection, gmfCmd);\n-          });\n-  \n-        }\n+      final CapellaDiagramPasteCommand siriusCmd = new CapellaDiagramPasteCommand(gmfSelection, true);\n+      boolean success = MiscUtil.transactionallyExecute(gmfSelection, siriusCmd);\n+      monitor.worked(1);\n+\n+      if (success) {\n+\n+        // Set format (layout and/or style) to pasted elements and move them under the mouse cursor\n+        // Keep mouse location\n+        final Point relativeLocation = getRelativeLocation();\n+        // GraphicalAdjustmentCommand is executed asynchronously to come after the SiriusCanonicalLayoutCommand\n+        Display.getDefault().asyncExec(() -> {\n+          View target = siriusCmd.getGmfTarget();\n+          EObject siriusTarget = LayerUtil.getSiriusElement(target);\n+          GraphicalAdjustmentCommand gmfCmd;\n+          if (SiriusUtil.layoutIsConstrained(siriusTarget) && mustRefresh()) {\n+            // Just refresh the diagram\n+            gmfCmd = new GraphicalAdjustmentCommand(target);\n+          } else {\n+            // Duplicate layout\n+            gmfCmd = new GraphicalAdjustmentCommand((List) siriusCmd.getResults(),\n+                siriusCmd.getPastedSiriusElementsOrigins(), target, relativeLocation, mustRefresh(), mustPasteLayout(),\n+                mustPasteStyle());\n+          }\n+          MiscUtil.transactionallyExecute(gmfSelection, gmfCmd);\n+        });\n+\n       }\n     } finally {\n       monitor.done();\n"}}, {"oid": "2b9c56b55fe51323e23401f847dfb55787153116", "url": "https://github.com/eclipse/capella/commit/2b9c56b55fe51323e23401f847dfb55787153116", "message": "[Doc] Title Blocks - updated doc\n\n\nChange-Id: Ie2f955619b0c42da22e19fabd7aa211147f82446\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>", "committedDate": "2020-06-02T09:07:46Z", "type": "commit"}, {"oid": "7a0cee436bef1706b451c7841d147e18651f2460", "url": "https://github.com/eclipse/capella/commit/7a0cee436bef1706b451c7841d147e18651f2460", "message": "Fix copy/paste when selection includes title blocks.\n\nChange-Id: I0352e9ecb1c322e6032f90444f182d3166ca6b27\nSigned-off-by: claudiasima <claudia.sima@thalesgroup.com>", "committedDate": "2020-06-02T09:09:33Z", "type": "commit"}, {"oid": "5d0501e8012d10454c1e06686ad868cd15d31b0e", "url": "https://github.com/eclipse/capella/commit/5d0501e8012d10454c1e06686ad868cd15d31b0e", "message": "Clean up\n\nChange-Id: Id7a8eea43acc19d26514112f64e708f4ae87ce28\nSigned-off-by: claudiasima <claudia.sima@thalesgroup.com>", "committedDate": "2020-06-02T09:09:40Z", "type": "commit"}, {"oid": "7520742bc533cdbd5ae39576e0c6457eea49de12", "url": "https://github.com/eclipse/capella/commit/7520742bc533cdbd5ae39576e0c6457eea49de12", "message": "Clean up\n\nChange-Id: Ie308faa0e2f7473e5b991fdd96d9d86506ada992\nSigned-off-by: claudiasima <claudia.sima@thalesgroup.com>", "committedDate": "2020-06-02T09:09:47Z", "type": "commit"}, {"oid": "742720797ad5ea34df9d8b8cbafa5dd60673992e", "url": "https://github.com/eclipse/capella/commit/742720797ad5ea34df9d8b8cbafa5dd60673992e", "message": "Update doc for review\n\nChange-Id: Ic794ee697b4920afb16a9c194d811a6cc883c62a\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>", "committedDate": "2020-06-02T09:09:57Z", "type": "commit"}, {"oid": "87445ba68650cba23606f71932e045084a9e77ee", "url": "https://github.com/eclipse/capella/commit/87445ba68650cba23606f71932e045084a9e77ee", "message": "Copy-Paste remove Title Block selected elements\n\n\nChange-Id: I311ac25fc66c0c7705fe5eb51e10ecbf0308be76\nSigned-off-by: Georgiana Ecobici <georgiana-elena.ecobici@thalesgroup.com>", "committedDate": "2020-06-02T09:10:07Z", "type": "commit"}, {"oid": "04a767955ef2132a52e6c00b3332ae60c3c75a07", "url": "https://github.com/eclipse/capella/commit/04a767955ef2132a52e6c00b3332ae60c3c75a07", "message": "Update doc with new screenshots\n\nChange-Id: I98fb86e6923fd06ad5f9ff9aa79cc1011ce8cbd2\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-02T10:07:50Z", "type": "forcePushed"}, {"oid": "320bbf30dfb0f841efbc82aa745310b017f24890", "url": "https://github.com/eclipse/capella/commit/320bbf30dfb0f841efbc82aa745310b017f24890", "message": "Update doc with new screenshots\n\nChange-Id: I98fb86e6923fd06ad5f9ff9aa79cc1011ce8cbd2\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-02T10:30:22Z", "type": "commit"}, {"oid": "320bbf30dfb0f841efbc82aa745310b017f24890", "url": "https://github.com/eclipse/capella/commit/320bbf30dfb0f841efbc82aa745310b017f24890", "message": "Update doc with new screenshots\n\nChange-Id: I98fb86e6923fd06ad5f9ff9aa79cc1011ce8cbd2\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-02T10:30:22Z", "type": "forcePushed"}, {"oid": "09458f02cc2d49c8bc3f0156197cce6c0ffb89ae", "url": "https://github.com/eclipse/capella/commit/09458f02cc2d49c8bc3f0156197cce6c0ffb89ae", "message": "Avoid use of Import-Package\n\nChange-Id: I2c67183e27a6fc09ed6a1790e93e7e33df3b50e5", "committedDate": "2020-06-02T10:32:10Z", "type": "commit"}, {"oid": "be027807c62b928ab5158aa909459ee63362966b", "url": "https://github.com/eclipse/capella/commit/be027807c62b928ab5158aa909459ee63362966b", "message": "Fix extensions of images\n\nUpper extensions doesn't work in online documentation\n\nChange-Id: I3b55388d555cc71408edad9d78785166dab45493\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-02T11:19:44Z", "type": "commit"}, {"oid": "000141060af222ff2635ec6f2f08da30736f631a", "url": "https://github.com/eclipse/capella/commit/000141060af222ff2635ec6f2f08da30736f631a", "message": "Update missing icons\n\nChange-Id: I63e7448a9db9ddb935b9696b66da9df6040f093f\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-02T15:02:53Z", "type": "commit"}]}