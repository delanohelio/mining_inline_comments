{"pr_number": 60, "pr_title": "Changed Response to be async", "pr_createdAt": "2020-02-28T10:46:17Z", "pr_url": "https://github.com/artipie/http/pull/60", "timeline": [{"oid": "c0219e4171b5f0e22e155ed46ed39989d53ea115", "url": "https://github.com/artipie/http/commit/c0219e4171b5f0e22e155ed46ed39989d53ea115", "message": "Changed Response to be async", "committedDate": "2020-02-28T10:44:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3NDE5Mg==", "url": "https://github.com/artipie/http/pull/60#discussion_r385874192", "bodyText": "@olegmoz we can use join() instead of get() to avoid catching exceptions. join will wrap checked exceptions to unchecked.", "author": "Vatavuk", "createdAt": "2020-02-28T19:14:32Z", "path": "src/main/java/com/artipie/http/hm/RsHasBody.java", "diffHunk": "@@ -74,7 +77,11 @@ public void describeTo(final Description description) {\n     @Override\n     public boolean matchesSafely(final Response item) {\n         final AtomicReference<byte[]> out = new AtomicReference<>();\n-        item.send(new RsHasBody.FakeConnection(out));\n+        try {\n+            item.send(new RsHasBody.FakeConnection(out)).toCompletableFuture().get();", "originalCommit": "c0219e4171b5f0e22e155ed46ed39989d53ea115", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNjE4Nw==", "url": "https://github.com/artipie/http/pull/60#discussion_r386236187", "bodyText": "@Vatavuk good point, thank you! However I cannot use 'join()' method, because our target java version is 1.8 and 'join' method is there since 13.", "author": "olegmoz", "createdAt": "2020-03-02T07:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3NDE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM2OTk1Mg==", "url": "https://github.com/artipie/http/pull/60#discussion_r386369952", "bodyText": "@olegmoz it is part of 1.8:\nhttps://docs.oracle.com/javase/8/docs/api/java/util/concurrent/CompletableFuture.html#join--", "author": "Vatavuk", "createdAt": "2020-03-02T12:42:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3NDE5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "c6e553668ae235933193a0344b2e099088f31817", "chunk": "diff --git a/src/main/java/com/artipie/http/hm/RsHasBody.java b/src/main/java/com/artipie/http/hm/RsHasBody.java\nindex 537b7d2..76462b4 100644\n--- a/src/main/java/com/artipie/http/hm/RsHasBody.java\n+++ b/src/main/java/com/artipie/http/hm/RsHasBody.java\n\n@@ -77,11 +76,7 @@ public final class RsHasBody extends TypeSafeMatcher<Response> {\n     @Override\n     public boolean matchesSafely(final Response item) {\n         final AtomicReference<byte[]> out = new AtomicReference<>();\n-        try {\n-            item.send(new RsHasBody.FakeConnection(out)).toCompletableFuture().get();\n-        } catch (final InterruptedException | ExecutionException ex) {\n-            throw new IllegalArgumentException(\"Bad response\", ex);\n-        }\n+        item.send(new RsHasBody.FakeConnection(out)).toCompletableFuture().join();\n         return this.body.matches(out.get());\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3NDU2MA==", "url": "https://github.com/artipie/http/pull/60#discussion_r385874560", "bodyText": "@olegmoz we can use join() instead of get() to avoid catching exceptions.", "author": "Vatavuk", "createdAt": "2020-02-28T19:15:20Z", "path": "src/main/java/com/artipie/http/hm/RsHasStatus.java", "diffHunk": "@@ -70,7 +72,11 @@ public void describeTo(final Description description) {\n     @Override\n     public boolean matchesSafely(final Response item) {\n         final AtomicInteger out = new AtomicInteger();\n-        item.send(new RsHasStatus.FakeConnection(out));\n+        try {\n+            item.send(new FakeConnection(out)).toCompletableFuture().get();", "originalCommit": "c0219e4171b5f0e22e155ed46ed39989d53ea115", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIzNjI2Mg==", "url": "https://github.com/artipie/http/pull/60#discussion_r386236262", "bodyText": "@Vatavuk please see comment above", "author": "olegmoz", "createdAt": "2020-03-02T07:46:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3NDU2MA=="}], "type": "inlineReview", "revised_code": {"commit": "c6e553668ae235933193a0344b2e099088f31817", "chunk": "diff --git a/src/main/java/com/artipie/http/hm/RsHasStatus.java b/src/main/java/com/artipie/http/hm/RsHasStatus.java\nindex bc6beac..9937293 100644\n--- a/src/main/java/com/artipie/http/hm/RsHasStatus.java\n+++ b/src/main/java/com/artipie/http/hm/RsHasStatus.java\n\n@@ -72,11 +71,7 @@ public final class RsHasStatus extends TypeSafeMatcher<Response> {\n     @Override\n     public boolean matchesSafely(final Response item) {\n         final AtomicInteger out = new AtomicInteger();\n-        try {\n-            item.send(new FakeConnection(out)).toCompletableFuture().get();\n-        } catch (final InterruptedException | ExecutionException ex) {\n-            throw new IllegalArgumentException(\"Bad response\", ex);\n-        }\n+        item.send(new FakeConnection(out)).toCompletableFuture().join();\n         return this.status.matches(out.get());\n     }\n \n"}}, {"oid": "c6e553668ae235933193a0344b2e099088f31817", "url": "https://github.com/artipie/http/commit/c6e553668ae235933193a0344b2e099088f31817", "message": "Using CompletableFuture.join() in RsHasBody.matchesSafely() and RsHasStatus.matchesSafely()", "committedDate": "2020-03-02T13:02:10Z", "type": "commit"}, {"oid": "569e709161e5d267b07eb27e8fc91034e59cff8c", "url": "https://github.com/artipie/http/commit/569e709161e5d267b07eb27e8fc91034e59cff8c", "message": "Merge branch 'master' into response-async\n\n# Conflicts:\n#\tsrc/main/java/com/artipie/http/Connection.java\n#\tsrc/main/java/com/artipie/http/Response.java\n#\tsrc/main/java/com/artipie/http/async/RsAsync.java\n#\tsrc/main/java/com/artipie/http/hm/RsHasBody.java\n#\tsrc/main/java/com/artipie/http/hm/RsHasStatus.java\n#\tsrc/main/java/com/artipie/http/rs/RsWithBody.java\n#\tsrc/main/java/com/artipie/http/rs/RsWithStatus.java\n#\tsrc/test/java/com/artipie/http/hm/RsHasBodyTest.java", "committedDate": "2020-03-02T14:47:29Z", "type": "commit"}]}