{"pr_number": 1907, "pr_title": "[SCB-2058] fix SpringMVC provider not support non-file-type RequestPart problem", "pr_createdAt": "2020-08-03T11:31:39Z", "pr_url": "https://github.com/apache/servicecomb-java-chassis/pull/1907", "timeline": [{"oid": "cad862e9fd8c1ee4dad8d7e79f8f6795bc29434b", "url": "https://github.com/apache/servicecomb-java-chassis/commit/cad862e9fd8c1ee4dad8d7e79f8f6795bc29434b", "message": "[SCB-2058] fix SpringMVC provider not support non-file-type RequestPart problem\n\n- add MultipartFilePropertyCreator to enable ModelConverters resolving MultipartFile param\n- make RequestPartAnnotationProcessor recognize non-file-type RequestPart param", "committedDate": "2020-08-03T11:15:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1MjM4OA==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1907#discussion_r464752388", "bodyText": "Seems RequestPartAnnotationProcessor can inherit from AbstractSpringmvcSerializableParameterProcessor", "author": "liubao68", "createdAt": "2020-08-04T01:51:03Z", "path": "swagger/swagger-generator/generator-springmvc/src/main/java/org/apache/servicecomb/swagger/generator/springmvc/processor/annotation/RequestPartAnnotationProcessor.java", "diffHunk": "@@ -56,11 +57,34 @@ public HttpParameterType getHttpParameterType(RequestPart parameterAnnotation) {\n   @Override\n   public void fillParameter(Swagger swagger, Operation operation, FormParameter formParameter, Type type,\n       RequestPart requestPart) {\n-    Property property = new FileProperty();\n-    if (TypeFactory.defaultInstance().constructType(type).isContainerType()) {\n-      property = new ArrayProperty(new FileProperty());\n-    }\n+    Property property = resolveParamProperty(type);", "originalCommit": "cad862e9fd8c1ee4dad8d7e79f8f6795bc29434b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkwMzYyMA==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1907#discussion_r464903620", "bodyText": "Done, please review it.", "author": "yhs0092", "createdAt": "2020-08-04T08:56:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1MjM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkxNTk5OQ==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1907#discussion_r464915999", "bodyText": "actually I mean fillParameter can call super.fillParameter, because jaxrs works fine by doing this.", "author": "liubao68", "createdAt": "2020-08-04T09:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1MjM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMTc5NA==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1907#discussion_r465411794", "bodyText": "Done", "author": "yhs0092", "createdAt": "2020-08-05T01:01:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1MjM4OA=="}], "type": "inlineReview", "revised_code": {"commit": "64de0454a7ef64e662e9267374ff235d9a106a13", "chunk": "diff --git a/swagger/swagger-generator/generator-springmvc/src/main/java/org/apache/servicecomb/swagger/generator/springmvc/processor/annotation/RequestPartAnnotationProcessor.java b/swagger/swagger-generator/generator-springmvc/src/main/java/org/apache/servicecomb/swagger/generator/springmvc/processor/annotation/RequestPartAnnotationProcessor.java\nindex 3041527f6..aade8233c 100644\n--- a/swagger/swagger-generator/generator-springmvc/src/main/java/org/apache/servicecomb/swagger/generator/springmvc/processor/annotation/RequestPartAnnotationProcessor.java\n+++ b/swagger/swagger-generator/generator-springmvc/src/main/java/org/apache/servicecomb/swagger/generator/springmvc/processor/annotation/RequestPartAnnotationProcessor.java\n\n@@ -55,36 +46,12 @@ public class RequestPartAnnotationProcessor implements\n   }\n \n   @Override\n-  public void fillParameter(Swagger swagger, Operation operation, FormParameter formParameter, Type type,\n-      RequestPart requestPart) {\n-    Property property = resolveParamProperty(type);\n-\n-    formParameter.setProperty(property);\n-    formParameter.setRequired(requestPart.required());\n+  protected boolean readRequired(RequestPart requestPart) {\n+    return requestPart.required();\n   }\n \n-  private Property resolveParamProperty(Type type) {\n-    JavaType javaType = TypeFactory.defaultInstance().constructType(type);\n-    if (javaType.isContainerType()) {\n-      return resolvePropertyAsContainerType(javaType);\n-    }\n-    return ModelConverters.getInstance().readAsProperty(type);\n-  }\n-\n-  private Property resolvePropertyAsContainerType(JavaType javaType) {\n-    // At present, only array and collection of Part params are supported,\n-    // but Map type is also a kind of container type.\n-    // Although Map is not supported now, we still consider to take the type of value to generate a property.\n-    // Therefore, here we use lastContainedTypeIndex to get the contained type.\n-    int lastContainedTypeIndex = javaType.containedTypeCount() - 1;\n-    JavaType containedItemType;\n-    if (lastContainedTypeIndex < 0) {\n-      // javaType may be an array\n-      containedItemType = javaType.getContentType();\n-    } else {\n-      containedItemType = javaType.containedType(lastContainedTypeIndex);\n-    }\n-    Property containedItemProperty = ModelConverters.getInstance().readAsProperty(containedItemType);\n-    return new ArrayProperty(containedItemProperty);\n+  @Override\n+  protected String pureReadDefaultValue(RequestPart requestPart) {\n+    return null;\n   }\n }\n"}}, {"oid": "64de0454a7ef64e662e9267374ff235d9a106a13", "url": "https://github.com/apache/servicecomb-java-chassis/commit/64de0454a7ef64e662e9267374ff235d9a106a13", "message": "[SCB-2058] make RequestPartAnnotationProcessor extend AbstractSpringmvcSerializableParameterProcessor", "committedDate": "2020-08-04T09:46:25Z", "type": "commit"}, {"oid": "64de0454a7ef64e662e9267374ff235d9a106a13", "url": "https://github.com/apache/servicecomb-java-chassis/commit/64de0454a7ef64e662e9267374ff235d9a106a13", "message": "[SCB-2058] make RequestPartAnnotationProcessor extend AbstractSpringmvcSerializableParameterProcessor", "committedDate": "2020-08-04T09:46:25Z", "type": "forcePushed"}]}