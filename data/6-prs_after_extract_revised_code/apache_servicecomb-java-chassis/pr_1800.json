{"pr_number": 1800, "pr_title": "[SCB-1961] add rest server codec filter", "pr_createdAt": "2020-05-30T08:36:15Z", "pr_url": "https://github.com/apache/servicecomb-java-chassis/pull/1800", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgyNTUyNQ==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1800#discussion_r432825525", "bodyText": "encodeHeader name is not good. It's do not do any encoding.", "author": "liubao68", "createdAt": "2020-05-30T09:13:19Z", "path": "common/common-rest/src/main/java/org/apache/servicecomb/common/rest/AbstractRestInvocation.java", "diffHunk": "@@ -268,16 +268,8 @@ protected void sendResponseQuietly(Response response) {\n \n   @SuppressWarnings(\"deprecation\")\n   protected void sendResponse(Response response) {\n-    if (response.getHeaders().getHeaderMap() != null) {\n-      for (Entry<String, List<Object>> entry : response.getHeaders().getHeaderMap().entrySet()) {\n-        for (Object value : entry.getValue()) {\n-          if (!entry.getKey().equalsIgnoreCase(HttpHeaders.CONTENT_LENGTH)\n-              && !entry.getKey().equalsIgnoreCase(\"Transfer-Encoding\")) {\n-            responseEx.addHeader(entry.getKey(), String.valueOf(value));\n-          }\n-        }\n-      }\n-    }\n+    RestServerCodecFilter.encodeHeader(response.getHeaders().getHeaderMap(), responseEx);", "originalCommit": "c993403303c36de476bc30112b489e387e335699", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgzMjg4NQ==", "url": "https://github.com/apache/servicecomb-java-chassis/pull/1800#discussion_r432832885", "bodyText": "done", "author": "wujimin", "createdAt": "2020-05-30T11:13:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjgyNTUyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "c3491e35f6e24d90e33db9c7ef22205658ac3351", "chunk": "diff --git a/common/common-rest/src/main/java/org/apache/servicecomb/common/rest/AbstractRestInvocation.java b/common/common-rest/src/main/java/org/apache/servicecomb/common/rest/AbstractRestInvocation.java\nindex 8aabff4df..f0bc2ca85 100644\n--- a/common/common-rest/src/main/java/org/apache/servicecomb/common/rest/AbstractRestInvocation.java\n+++ b/common/common-rest/src/main/java/org/apache/servicecomb/common/rest/AbstractRestInvocation.java\n\n@@ -268,7 +268,7 @@ public abstract class AbstractRestInvocation {\n \n   @SuppressWarnings(\"deprecation\")\n   protected void sendResponse(Response response) {\n-    RestServerCodecFilter.encodeHeader(response.getHeaders().getHeaderMap(), responseEx);\n+    RestServerCodecFilter.copyHeadersToHttpResponse(response.getHeaders().getHeaderMap(), responseEx);\n \n     responseEx.setStatus(response.getStatusCode(), response.getReasonPhrase());\n     responseEx.setAttribute(RestConst.INVOCATION_HANDLER_RESPONSE, response);\n"}}, {"oid": "c3491e35f6e24d90e33db9c7ef22205658ac3351", "url": "https://github.com/apache/servicecomb-java-chassis/commit/c3491e35f6e24d90e33db9c7ef22205658ac3351", "message": "[SCB-1961] add rest server codec filter", "committedDate": "2020-05-30T09:26:28Z", "type": "commit"}, {"oid": "c3491e35f6e24d90e33db9c7ef22205658ac3351", "url": "https://github.com/apache/servicecomb-java-chassis/commit/c3491e35f6e24d90e33db9c7ef22205658ac3351", "message": "[SCB-1961] add rest server codec filter", "committedDate": "2020-05-30T09:26:28Z", "type": "forcePushed"}]}