{"pr_number": 1603, "pr_title": "Add tests for issues #1589 and #1449", "pr_createdAt": "2020-10-20T03:15:45Z", "pr_url": "https://github.com/IBM/FHIR/pull/1603", "timeline": [{"oid": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "url": "https://github.com/IBM/FHIR/commit/ce32f1145019adfdb78828b9fa039b1c458fb09a", "message": "Add tests for issues #1589 and #1449\n\nWe don't make it very easy to add component-level tests for our rest\nlayer.  This pull request works with what we have to test the public\nJAX-RS methods for building the CapabilityStatement resource and the\nsmart-configuration JSON from various configs.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T03:18:51Z", "type": "commit"}, {"oid": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "url": "https://github.com/IBM/FHIR/commit/ce32f1145019adfdb78828b9fa039b1c458fb09a", "message": "Add tests for issues #1589 and #1449\n\nWe don't make it very easy to add component-level tests for our rest\nlayer.  This pull request works with what we have to test the public\nJAX-RS methods for building the CapabilityStatement resource and the\nsmart-configuration JSON from various configs.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T03:18:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1NDcxNQ==", "url": "https://github.com/IBM/FHIR/pull/1603#discussion_r508454715", "bodyText": "Oh interesting... this is a good change.", "author": "prb112", "createdAt": "2020-10-20T12:23:19Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -98,7 +99,9 @@\n     private static final String BASE_CAPABILITY_URL = \"http://hl7.org/fhir/CapabilityStatement/base\";\n     private static final String BASE_2_CAPABILITY_URL = \"http://hl7.org/fhir/CapabilityStatement/base2\";\n     private static final List<String> ALL_INTERACTIONS = Arrays.asList(\"create\", \"read\", \"vread\", \"update\", \"patch\", \"delete\", \"history\", \"search\");\n-    private static final List<ResourceType.ValueSet> ALL_RESOURCE_TYPES = Arrays.asList(ResourceType.ValueSet.values());\n+    private static final List<ResourceType.ValueSet> ALL_RESOURCE_TYPES = ModelSupport.getResourceTypes(false).stream()", "originalCommit": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1Njg2Mg==", "url": "https://github.com/IBM/FHIR/pull/1603#discussion_r508456862", "bodyText": "Suggested change", "author": "prb112", "createdAt": "2020-10-20T12:26:34Z", "path": "fhir-server/src/test/java/com/ibm/fhir/server/resources/WellKnownTest.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package com.ibm.fhir.server.resources;\n+\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertNull;\n+import static org.testng.Assert.assertTrue;\n+\n+import javax.json.JsonObject;\n+import javax.ws.rs.core.Response;\n+\n+import org.testng.annotations.AfterClass;\n+import org.testng.annotations.BeforeClass;\n+import org.testng.annotations.Test;\n+\n+import com.ibm.fhir.config.FHIRConfiguration;\n+import com.ibm.fhir.config.FHIRRequestContext;\n+import com.ibm.fhir.exception.FHIRException;\n+import com.ibm.fhir.server.test.MockHttpServletRequest;\n+import com.ibm.fhir.server.test.MockServletContext;\n+\n+public class WellKnownTest {\n+\n+    @BeforeClass\n+    void setup() {\n+        FHIRConfiguration.setConfigHome(\"target/test-classes\");\n+    }\n+\n+    @AfterClass\n+    void tearDown() throws FHIRException {\n+        FHIRConfiguration.setConfigHome(\"\");\n+        FHIRRequestContext.get().setTenantId(\"default\");\n+    }\n+\n+    @Test\n+    void testSmartCapabilities_smart_enabled() throws Exception {\n+        FHIRRequestContext.get().setTenantId(\"smart-enabled\");\n+        FHIRRequestContext.get().setOriginalRequestUri(\"http://example.com/.well-known/smart-configuration\");\n+        WellKnownChild c = new WellKnownChild();\n+\n+        Response capabilities = c.smartConfig();\n+        JsonObject smartSupport = capabilities.readEntity(JsonObject.class);\n+        assertTrue(!smartSupport.getString(\"authorization_endpoint\").isEmpty());\n+        assertTrue(!smartSupport.getString(\"token_endpoint\").isEmpty());\n+        assertEquals(smartSupport.getJsonArray(\"scopes_supported\").size(), 6, \"Number of SMART scopes\");\n+        assertEquals(smartSupport.getJsonArray(\"capabilities\").size(), 7, \"Number of SMART capabilities\");\n+    }\n+\n+    @Test\n+    void testSmartCapabilities_smart_omitted() throws Exception {\n+        FHIRRequestContext.get().setTenantId(\"omitted\");\n+        FHIRRequestContext.get().setOriginalRequestUri(\"http://example.com/.well-known/smart-configuration\");\n+        WellKnownChild c = new WellKnownChild();\n+\n+        Response capabilities = c.smartConfig();\n+        JsonObject smartSupport = capabilities.readEntity(JsonObject.class);\n+        assertTrue(smartSupport.getString(\"authorization_endpoint\").isEmpty());\n+        assertTrue(smartSupport.getString(\"token_endpoint\").isEmpty());\n+        assertNull(smartSupport.getJsonArray(\"scopes_supported\"));\n+        assertEquals(smartSupport.getJsonArray(\"capabilities\").size(), 0, \"Number of SMART capabilities\");\n+    }\n+\n+    @Test\n+    void testSmartCapabilities_smart_empty() throws Exception {\n+        FHIRRequestContext.get().setTenantId(\"empty\");\n+        FHIRRequestContext.get().setOriginalRequestUri(\"http://example.com/.well-known/smart-configuration\");\n+        WellKnownChild c = new WellKnownChild();\n+\n+        Response capabilities = c.smartConfig();\n+        JsonObject smartSupport = capabilities.readEntity(JsonObject.class);\n+        System.out.println(smartSupport);\n+        assertTrue(smartSupport.getString(\"authorization_endpoint\").isEmpty());\n+        assertTrue(smartSupport.getString(\"token_endpoint\").isEmpty());\n+        assertNull(smartSupport.getJsonArray(\"scopes_supported\"));\n+        assertEquals(smartSupport.getJsonArray(\"capabilities\").size(), 0, \"Number of SMART capabilities\");\n+    }\n+\n+    /**\n+     * This class is required because the WellKnown class uses a few protected fields\n+     * that are normally injected by JAX-RS and so this is the only way to set them.\n+     */\n+    private static class WellKnownChild extends WellKnown {\n+        public WellKnownChild() throws Exception {\n+            super();\n+            this.context = new MockServletContext();\n+        }\n+\n+        @Override\n+        public Response smartConfig() throws ClassNotFoundException {\n+            httpServletRequest = new MockHttpServletRequest();\n+            return super.smartConfig();\n+        }\n+    }\n+}\n+\n+", "originalCommit": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1Njk2Nw==", "url": "https://github.com/IBM/FHIR/pull/1603#discussion_r508456967", "bodyText": "absolutely optional", "author": "prb112", "createdAt": "2020-10-20T12:26:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1Njg2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "069c5607ecd67e3bd943225dbf98af6ff66eed52", "chunk": "diff --git a/fhir-server/src/test/java/com/ibm/fhir/server/resources/WellKnownTest.java b/fhir-server/src/test/java/com/ibm/fhir/server/test/WellKnownTest.java\nsimilarity index 96%\nrename from fhir-server/src/test/java/com/ibm/fhir/server/resources/WellKnownTest.java\nrename to fhir-server/src/test/java/com/ibm/fhir/server/test/WellKnownTest.java\nindex 32ceef6255..37c49b566a 100644\n--- a/fhir-server/src/test/java/com/ibm/fhir/server/resources/WellKnownTest.java\n+++ b/fhir-server/src/test/java/com/ibm/fhir/server/test/WellKnownTest.java\n\n@@ -3,7 +3,7 @@\n  *\n  * SPDX-License-Identifier: Apache-2.0\n  */\n-package com.ibm.fhir.server.resources;\n+package com.ibm.fhir.server.test;\n \n import static org.testng.Assert.assertEquals;\n import static org.testng.Assert.assertNull;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1NzI4Mw==", "url": "https://github.com/IBM/FHIR/pull/1603#discussion_r508457283", "bodyText": "Lots of Todos I suggest removing them since this is a Mock", "author": "prb112", "createdAt": "2020-10-20T12:27:14Z", "path": "fhir-server/src/test/java/com/ibm/fhir/server/test/MockHttpServletRequest.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package com.ibm.fhir.server.test;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import java.security.Principal;\n+import java.util.Collection;\n+import java.util.Enumeration;\n+import java.util.Locale;\n+import java.util.Map;\n+\n+import javax.servlet.AsyncContext;\n+import javax.servlet.DispatcherType;\n+import javax.servlet.RequestDispatcher;\n+import javax.servlet.ServletContext;\n+import javax.servlet.ServletException;\n+import javax.servlet.ServletInputStream;\n+import javax.servlet.ServletRequest;\n+import javax.servlet.ServletResponse;\n+import javax.servlet.http.Cookie;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.servlet.http.HttpSession;\n+import javax.servlet.http.HttpUpgradeHandler;\n+import javax.servlet.http.Part;\n+\n+public class MockHttpServletRequest implements HttpServletRequest {\n+\n+    @Override\n+    public StringBuffer getRequestURL() {\n+        return new StringBuffer(\"http://example.com\");\n+    }\n+\n+    @Override\n+    public Object getAttribute(String name) {\n+        // TODO Auto-generated method stub", "originalCommit": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "069c5607ecd67e3bd943225dbf98af6ff66eed52", "chunk": "diff --git a/fhir-server/src/test/java/com/ibm/fhir/server/test/MockHttpServletRequest.java b/fhir-server/src/test/java/com/ibm/fhir/server/test/MockHttpServletRequest.java\nindex 5567ab5ba6..4931ff44c8 100644\n--- a/fhir-server/src/test/java/com/ibm/fhir/server/test/MockHttpServletRequest.java\n+++ b/fhir-server/src/test/java/com/ibm/fhir/server/test/MockHttpServletRequest.java\n\n@@ -36,412 +36,209 @@ public class MockHttpServletRequest implements HttpServletRequest {\n         return new StringBuffer(\"http://example.com\");\n     }\n \n+    // All below methods are auto-generated stubs\n     @Override\n-    public Object getAttribute(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Object getAttribute(String name) { return null; }\n \n     @Override\n-    public Enumeration<String> getAttributeNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getAttributeNames() { return null; }\n \n     @Override\n-    public String getCharacterEncoding() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getCharacterEncoding() { return null; }\n \n     @Override\n-    public void setCharacterEncoding(String env) throws UnsupportedEncodingException {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setCharacterEncoding(String env) throws UnsupportedEncodingException {}\n \n     @Override\n-    public int getContentLength() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getContentLength() { return 0; }\n \n     @Override\n-    public long getContentLengthLong() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public long getContentLengthLong() { return 0; }\n \n     @Override\n-    public String getContentType() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getContentType() { return null; }\n \n     @Override\n-    public ServletInputStream getInputStream() throws IOException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public ServletInputStream getInputStream() throws IOException { return null; }\n \n     @Override\n-    public String getParameter(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getParameter(String name) { return null; }\n \n     @Override\n-    public Enumeration<String> getParameterNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getParameterNames() { return null; }\n \n     @Override\n-    public String[] getParameterValues(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String[] getParameterValues(String name) { return null; }\n \n     @Override\n-    public Map<String, String[]> getParameterMap() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Map<String, String[]> getParameterMap() { return null; }\n \n     @Override\n-    public String getProtocol() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getProtocol() { return null; }\n \n     @Override\n-    public String getScheme() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getScheme() { return null; }\n \n     @Override\n-    public String getServerName() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getServerName() { return null; }\n \n     @Override\n-    public int getServerPort() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getServerPort() { return 0; }\n \n     @Override\n-    public BufferedReader getReader() throws IOException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public BufferedReader getReader() throws IOException { return null; }\n \n     @Override\n-    public String getRemoteAddr() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRemoteAddr() { return null; }\n \n     @Override\n-    public String getRemoteHost() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRemoteHost() { return null; }\n \n     @Override\n-    public void setAttribute(String name, Object o) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setAttribute(String name, Object o) {}\n \n     @Override\n-    public void removeAttribute(String name) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void removeAttribute(String name) {}\n \n     @Override\n-    public Locale getLocale() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Locale getLocale() { return null; }\n \n     @Override\n-    public Enumeration<Locale> getLocales() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<Locale> getLocales() { return null; }\n \n     @Override\n-    public boolean isSecure() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isSecure() { return false; }\n \n     @Override\n-    public RequestDispatcher getRequestDispatcher(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public RequestDispatcher getRequestDispatcher(String path) { return null; }\n \n     @Override\n-    public String getRealPath(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRealPath(String path) { return null; }\n \n     @Override\n-    public int getRemotePort() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getRemotePort() { return 0; }\n \n     @Override\n-    public String getLocalName() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getLocalName() { return null; }\n \n     @Override\n-    public String getLocalAddr() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getLocalAddr() { return null; }\n \n     @Override\n-    public int getLocalPort() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getLocalPort() { return 0; }\n \n     @Override\n-    public ServletContext getServletContext() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public ServletContext getServletContext() { return null; }\n \n     @Override\n-    public AsyncContext startAsync() throws IllegalStateException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public AsyncContext startAsync() throws IllegalStateException { return null; }\n \n     @Override\n-    public AsyncContext startAsync(ServletRequest servletRequest, ServletResponse servletResponse) throws IllegalStateException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public AsyncContext startAsync(ServletRequest servletRequest, ServletResponse servletResponse) throws IllegalStateException { return null; }\n \n     @Override\n-    public boolean isAsyncStarted() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isAsyncStarted() { return false; }\n \n     @Override\n-    public boolean isAsyncSupported() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isAsyncSupported() { return false; }\n \n     @Override\n-    public AsyncContext getAsyncContext() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public AsyncContext getAsyncContext() { return null; }\n \n     @Override\n-    public DispatcherType getDispatcherType() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public DispatcherType getDispatcherType() { return null; }\n \n     @Override\n-    public String getAuthType() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getAuthType() { return null; }\n \n     @Override\n-    public Cookie[] getCookies() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Cookie[] getCookies() { return null; }\n \n     @Override\n-    public long getDateHeader(String name) {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public long getDateHeader(String name) { return 0; }\n \n     @Override\n-    public String getHeader(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getHeader(String name) { return null; }\n \n     @Override\n-    public Enumeration<String> getHeaders(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getHeaders(String name) { return null; }\n \n     @Override\n-    public Enumeration<String> getHeaderNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getHeaderNames() { return null; }\n \n     @Override\n-    public int getIntHeader(String name) {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getIntHeader(String name) { return 0; }\n \n     @Override\n-    public String getMethod() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getMethod() { return null; }\n \n     @Override\n-    public String getPathInfo() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getPathInfo() { return null; }\n \n     @Override\n-    public String getPathTranslated() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getPathTranslated() { return null; }\n \n     @Override\n-    public String getContextPath() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getContextPath() { return null; }\n \n     @Override\n-    public String getQueryString() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getQueryString() { return null; }\n \n     @Override\n-    public String getRemoteUser() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRemoteUser() { return null; }\n \n     @Override\n-    public boolean isUserInRole(String role) {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isUserInRole(String role) { return false; }\n \n     @Override\n-    public Principal getUserPrincipal() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Principal getUserPrincipal() { return null; }\n \n     @Override\n-    public String getRequestedSessionId() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRequestedSessionId() { return null; }\n \n     @Override\n-    public String getRequestURI() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRequestURI() { return null; }\n \n     @Override\n-    public String getServletPath() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getServletPath() { return null; }\n \n     @Override\n-    public HttpSession getSession(boolean create) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public HttpSession getSession(boolean create) { return null; }\n \n     @Override\n-    public HttpSession getSession() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public HttpSession getSession() { return null; }\n \n     @Override\n-    public String changeSessionId() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String changeSessionId() { return null; }\n \n     @Override\n-    public boolean isRequestedSessionIdValid() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isRequestedSessionIdValid() { return false; }\n \n     @Override\n-    public boolean isRequestedSessionIdFromCookie() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isRequestedSessionIdFromCookie() { return false; }\n \n     @Override\n-    public boolean isRequestedSessionIdFromURL() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isRequestedSessionIdFromURL() { return false; }\n \n     @Override\n-    public boolean isRequestedSessionIdFromUrl() {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean isRequestedSessionIdFromUrl() { return false; }\n \n     @Override\n-    public boolean authenticate(HttpServletResponse response) throws IOException, ServletException {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean authenticate(HttpServletResponse response) throws IOException, ServletException { return false; }\n \n     @Override\n-    public void login(String username, String password) throws ServletException {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void login(String username, String password) throws ServletException {}\n \n     @Override\n-    public void logout() throws ServletException {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void logout() throws ServletException {}\n \n     @Override\n-    public Collection<Part> getParts() throws IOException, ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Collection<Part> getParts() throws IOException, ServletException { return null; }\n \n     @Override\n-    public Part getPart(String name) throws IOException, ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Part getPart(String name) throws IOException, ServletException { return null; }\n \n     @Override\n-    public <T extends HttpUpgradeHandler> T upgrade(Class<T> handlerClass) throws IOException, ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public <T extends HttpUpgradeHandler> T upgrade(Class<T> handlerClass) throws IOException, ServletException { return null; }\n \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQ1NzcxNw==", "url": "https://github.com/IBM/FHIR/pull/1603#discussion_r508457717", "bodyText": "same comment on the stubs, suggest removing them, but optional", "author": "prb112", "createdAt": "2020-10-20T12:27:54Z", "path": "fhir-server/src/test/java/com/ibm/fhir/server/test/MockServletContext.java", "diffHunk": "@@ -0,0 +1,409 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+package com.ibm.fhir.server.test;\n+\n+import java.io.InputStream;\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.util.Enumeration;\n+import java.util.EventListener;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import javax.servlet.Filter;\n+import javax.servlet.FilterRegistration;\n+import javax.servlet.FilterRegistration.Dynamic;\n+import javax.servlet.RequestDispatcher;\n+import javax.servlet.Servlet;\n+import javax.servlet.ServletContext;\n+import javax.servlet.ServletException;\n+import javax.servlet.ServletRegistration;\n+import javax.servlet.SessionCookieConfig;\n+import javax.servlet.SessionTrackingMode;\n+import javax.servlet.descriptor.JspConfigDescriptor;\n+\n+import com.ibm.fhir.persistence.FHIRPersistence;\n+import com.ibm.fhir.persistence.exception.FHIRPersistenceException;\n+import com.ibm.fhir.persistence.helper.FHIRPersistenceHelper;\n+import com.ibm.fhir.persistence.helper.PersistenceHelper;\n+import com.ibm.fhir.server.listener.FHIRServletContextListener;\n+\n+/**\n+ *\n+ */\n+public class MockServletContext implements ServletContext {\n+\n+    @Override\n+    public Object getAttribute(String name) {\n+        if (FHIRServletContextListener.FHIR_SERVER_INIT_COMPLETE.equals(name)) {\n+            return true;\n+        }\n+\n+        if (FHIRPersistenceHelper.class.getName().equals(name)) {\n+            return new PersistenceHelper() {\n+                @Override\n+                public FHIRPersistence getFHIRPersistenceImplementation() throws FHIRPersistenceException {\n+                    return new MockPersistenceImpl();\n+                }\n+                @Override\n+                public FHIRPersistence getFHIRPersistenceImplementation(String factoryPropertyName) throws FHIRPersistenceException {\n+                    return new MockPersistenceImpl();\n+                }\n+            };\n+        }\n+\n+        return null;\n+    }\n+\n+    // All below methods are auto-generated stubs\n+    @Override\n+    public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingModes) {\n+        // TODO Auto-generated method stub\n+", "originalCommit": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "069c5607ecd67e3bd943225dbf98af6ff66eed52", "chunk": "diff --git a/fhir-server/src/test/java/com/ibm/fhir/server/test/MockServletContext.java b/fhir-server/src/test/java/com/ibm/fhir/server/test/MockServletContext.java\nindex cdbcb6fd40..a86abfd61b 100644\n--- a/fhir-server/src/test/java/com/ibm/fhir/server/test/MockServletContext.java\n+++ b/fhir-server/src/test/java/com/ibm/fhir/server/test/MockServletContext.java\n\n@@ -60,350 +60,176 @@ public class MockServletContext implements ServletContext {\n \n     // All below methods are auto-generated stubs\n     @Override\n-    public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingModes) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingModes) {}\n \n     @Override\n-    public void setSessionTimeout(int sessionTimeout) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setSessionTimeout(int sessionTimeout) {}\n \n     @Override\n-    public void setResponseCharacterEncoding(String encoding) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setResponseCharacterEncoding(String encoding) {}\n \n     @Override\n-    public void setRequestCharacterEncoding(String encoding) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setRequestCharacterEncoding(String encoding) {}\n \n     @Override\n-    public boolean setInitParameter(String name, String value) {\n-        // TODO Auto-generated method stub\n-        return false;\n-    }\n+    public boolean setInitParameter(String name, String value) { return true; }\n \n     @Override\n-    public void setAttribute(String name, Object object) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void setAttribute(String name, Object object) {}\n \n     @Override\n-    public void removeAttribute(String name) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void removeAttribute(String name) {}\n \n     @Override\n-    public void log(String message, Throwable throwable) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void log(String message, Throwable throwable) {}\n \n     @Override\n-    public void log(Exception exception, String msg) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void log(Exception exception, String msg) {}\n \n     @Override\n-    public void log(String msg) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void log(String msg) {}\n \n     @Override\n-    public String getVirtualServerName() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getVirtualServerName() { return null; }\n \n     @Override\n-    public int getSessionTimeout() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getSessionTimeout() { return 0; }\n \n     @Override\n-    public SessionCookieConfig getSessionCookieConfig() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public SessionCookieConfig getSessionCookieConfig() { return null; }\n \n     @Override\n-    public Enumeration<Servlet> getServlets() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<Servlet> getServlets() { return null; }\n \n     @Override\n-    public Map<String, ? extends ServletRegistration> getServletRegistrations() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Map<String, ? extends ServletRegistration> getServletRegistrations() { return null; }\n \n     @Override\n-    public ServletRegistration getServletRegistration(String servletName) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public ServletRegistration getServletRegistration(String servletName) { return null; }\n \n     @Override\n-    public Enumeration<String> getServletNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getServletNames() { return null; }\n \n     @Override\n-    public String getServletContextName() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getServletContextName() { return null; }\n \n     @Override\n-    public Servlet getServlet(String name) throws ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Servlet getServlet(String name) throws ServletException { return null; }\n \n     @Override\n-    public String getServerInfo() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getServerInfo() { return null; }\n \n     @Override\n-    public String getResponseCharacterEncoding() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getResponseCharacterEncoding() { return null; }\n \n     @Override\n-    public Set<String> getResourcePaths(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Set<String> getResourcePaths(String path) { return null; }\n \n     @Override\n-    public InputStream getResourceAsStream(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public InputStream getResourceAsStream(String path) { return null; }\n \n     @Override\n-    public URL getResource(String path) throws MalformedURLException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public URL getResource(String path) throws MalformedURLException { return null; }\n \n     @Override\n-    public RequestDispatcher getRequestDispatcher(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public RequestDispatcher getRequestDispatcher(String path) { return null; }\n \n     @Override\n-    public String getRequestCharacterEncoding() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRequestCharacterEncoding() { return null; }\n \n     @Override\n-    public String getRealPath(String path) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getRealPath(String path) { return null; }\n \n     @Override\n-    public RequestDispatcher getNamedDispatcher(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public RequestDispatcher getNamedDispatcher(String name) { return null; }\n \n     @Override\n-    public int getMinorVersion() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getMinorVersion() { return 0; }\n \n     @Override\n-    public String getMimeType(String file) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getMimeType(String file) { return null; }\n \n     @Override\n-    public int getMajorVersion() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getMajorVersion() { return 0; }\n \n     @Override\n-    public JspConfigDescriptor getJspConfigDescriptor() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public JspConfigDescriptor getJspConfigDescriptor() { return null; }\n \n     @Override\n-    public Enumeration<String> getInitParameterNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getInitParameterNames() { return null; }\n \n     @Override\n-    public String getInitParameter(String name) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getInitParameter(String name) { return null; }\n \n     @Override\n-    public Map<String, ? extends FilterRegistration> getFilterRegistrations() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Map<String, ? extends FilterRegistration> getFilterRegistrations() { return null; }\n \n     @Override\n-    public FilterRegistration getFilterRegistration(String filterName) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public FilterRegistration getFilterRegistration(String filterName) { return null; }\n \n     @Override\n-    public Set<SessionTrackingMode> getEffectiveSessionTrackingModes() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Set<SessionTrackingMode> getEffectiveSessionTrackingModes() { return null; }\n \n     @Override\n-    public int getEffectiveMinorVersion() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getEffectiveMinorVersion() { return 0; }\n \n     @Override\n-    public int getEffectiveMajorVersion() {\n-        // TODO Auto-generated method stub\n-        return 0;\n-    }\n+    public int getEffectiveMajorVersion() { return 0; }\n \n     @Override\n-    public Set<SessionTrackingMode> getDefaultSessionTrackingModes() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Set<SessionTrackingMode> getDefaultSessionTrackingModes() { return null; }\n \n     @Override\n-    public String getContextPath() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public String getContextPath() { return null; }\n \n     @Override\n-    public ServletContext getContext(String uripath) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public ServletContext getContext(String uripath) { return null; }\n \n     @Override\n-    public ClassLoader getClassLoader() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public ClassLoader getClassLoader() { return null; }\n \n     @Override\n-    public Enumeration<String> getAttributeNames() {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Enumeration<String> getAttributeNames() { return null; }\n \n     @Override\n-    public void declareRoles(String... roleNames) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void declareRoles(String... roleNames) {}\n \n     @Override\n-    public <T extends Servlet> T createServlet(Class<T> clazz) throws ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public <T extends Servlet> T createServlet(Class<T> clazz) throws ServletException { return null; }\n \n     @Override\n-    public <T extends EventListener> T createListener(Class<T> clazz) throws ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public <T extends EventListener> T createListener(Class<T> clazz) throws ServletException { return null; }\n \n     @Override\n-    public <T extends Filter> T createFilter(Class<T> clazz) throws ServletException {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public <T extends Filter> T createFilter(Class<T> clazz) throws ServletException { return null; }\n \n     @Override\n-    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, Class<? extends Servlet> servletClass) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, Class<? extends Servlet> servletClass) { return null; }\n \n     @Override\n-    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, Servlet servlet) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, Servlet servlet) { return null; }\n \n     @Override\n-    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, String className) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public javax.servlet.ServletRegistration.Dynamic addServlet(String servletName, String className) { return null; }\n \n     @Override\n-    public void addListener(Class<? extends EventListener> listenerClass) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void addListener(Class<? extends EventListener> listenerClass) {}\n \n     @Override\n-    public <T extends EventListener> void addListener(T t) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public <T extends EventListener> void addListener(T t) {}\n \n     @Override\n-    public void addListener(String className) {\n-        // TODO Auto-generated method stub\n-\n-    }\n+    public void addListener(String className) {}\n \n     @Override\n-    public javax.servlet.ServletRegistration.Dynamic addJspFile(String servletName, String jspFile) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public javax.servlet.ServletRegistration.Dynamic addJspFile(String servletName, String jspFile) { return null; }\n \n     @Override\n-    public Dynamic addFilter(String filterName, Class<? extends Filter> filterClass) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Dynamic addFilter(String filterName, Class<? extends Filter> filterClass) { return null; }\n \n     @Override\n-    public Dynamic addFilter(String filterName, Filter filter) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Dynamic addFilter(String filterName, Filter filter) { return null; }\n \n     @Override\n-    public Dynamic addFilter(String filterName, String className) {\n-        // TODO Auto-generated method stub\n-        return null;\n-    }\n+    public Dynamic addFilter(String filterName, String className) { return null; }\n }\n"}}, {"oid": "069c5607ecd67e3bd943225dbf98af6ff66eed52", "url": "https://github.com/IBM/FHIR/commit/069c5607ecd67e3bd943225dbf98af6ff66eed52", "message": "removed TODOs and move tests to com.ibm.fhir.server.test package\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T12:54:49Z", "type": "commit"}]}