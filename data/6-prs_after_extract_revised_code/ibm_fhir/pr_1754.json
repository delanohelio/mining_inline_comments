{"pr_number": 1754, "pr_title": "Add disable operation configuration #1753", "pr_createdAt": "2020-11-30T20:37:16Z", "pr_url": "https://github.com/IBM/FHIR/pull/1754", "timeline": [{"oid": "c757abe505ca0683b56f3e1ff0c2703efc945e9f", "url": "https://github.com/IBM/FHIR/commit/c757abe505ca0683b56f3e1ff0c2703efc945e9f", "message": "Add disable operation configuration #1753\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-11-30T20:35:54Z", "type": "commit"}, {"oid": "4c7325ee17e45751da2c48cabb9456ce9a6e0a60", "url": "https://github.com/IBM/FHIR/commit/4c7325ee17e45751da2c48cabb9456ce9a6e0a60", "message": "Merge branch 'master' into issue-1753", "committedDate": "2020-12-01T13:59:24Z", "type": "commit"}, {"oid": "ca7f6acc2ac368b0c05f7379741eaec750f666e0", "url": "https://github.com/IBM/FHIR/commit/ca7f6acc2ac368b0c05f7379741eaec750f666e0", "message": "Per code review\n\nSwitched to disabled from disallowed\\\nAdded final to the OperationUtil class\nChanged the wording of the exception from \u201cThe access to the operation\nis forbidden\u201d to \u201cAccess to the operation is forbidden\u201d (or something\nwith \u201cdisabled\u201d perhaps.\nChanged declared type from HashSet to Set\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-01T14:37:20Z", "type": "commit"}, {"oid": "63e2aeda49b7d2f4ef03b470902f05de67d113e8", "url": "https://github.com/IBM/FHIR/commit/63e2aeda49b7d2f4ef03b470902f05de67d113e8", "message": "Merge branch 'issue-1753' of github.com:IBM/FHIR into issue-1753", "committedDate": "2020-12-01T14:37:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkzNTc5Ng==", "url": "https://github.com/IBM/FHIR/pull/1754#discussion_r532935796", "bodyText": "Could make this private unless it'll be called elsewhere.", "author": "tbieste", "createdAt": "2020-11-30T22:09:23Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/util/FHIROperationUtil.java", "diffHunk": "@@ -168,4 +195,30 @@ public static boolean hasSingleResourceOutputParameter(Parameters parameters) {\n     public static Resource getSingleResourceOutputParameter(Parameters parameters) throws Exception {\n         return parameters.getParameter().get(0).getResource();\n     }\n-}\n+\n+    /**\n+     * check and verify operation allowed\n+     * @param operationName\n+     * @throws FHIROperationException\n+     */\n+    public static void checkAndVerifyOperationAllowed(String operationName) throws FHIROperationException {\n+        if (DISALLOWED_OPERATIONS.contains(operationName)) {\n+            throw generateForbiddenOperationException(operationName);\n+        }\n+    }\n+\n+    public static FHIROperationException generateForbiddenOperationException(String operationName) {", "originalCommit": "c757abe505ca0683b56f3e1ff0c2703efc945e9f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ3NTQxMQ==", "url": "https://github.com/IBM/FHIR/pull/1754#discussion_r534475411", "bodyText": "I was thinking I'd add code coverage at some point", "author": "prb112", "createdAt": "2020-12-02T20:55:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjkzNTc5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ca7f6acc2ac368b0c05f7379741eaec750f666e0", "chunk": "diff --git a/fhir-server/src/main/java/com/ibm/fhir/server/util/FHIROperationUtil.java b/fhir-server/src/main/java/com/ibm/fhir/server/util/FHIROperationUtil.java\nindex faf4f49fa1..2fd5c0df9e 100644\n--- a/fhir-server/src/main/java/com/ibm/fhir/server/util/FHIROperationUtil.java\n+++ b/fhir-server/src/main/java/com/ibm/fhir/server/util/FHIROperationUtil.java\n\n@@ -202,19 +203,19 @@ public class FHIROperationUtil {\n      * @throws FHIROperationException\n      */\n     public static void checkAndVerifyOperationAllowed(String operationName) throws FHIROperationException {\n-        if (DISALLOWED_OPERATIONS.contains(operationName)) {\n+        if (DISABLED_OPERATIONS.contains(operationName)) {\n             throw generateForbiddenOperationException(operationName);\n         }\n     }\n \n     public static FHIROperationException generateForbiddenOperationException(String operationName) {\n         FHIROperationException operationException =\n-                new FHIROperationException(\"The access to the operation is forbidden\");\n+                new FHIROperationException(\"Access to the operation is forbidden\");\n \n         List<Issue> issues = new ArrayList<>();\n         Issue.Builder builder = Issue.builder();\n         builder.code(IssueType.FORBIDDEN);\n-        builder.diagnostics(string(\"The operation is not allowed '$\" + operationName +\"'\"));\n+        builder.diagnostics(string(\"Access to the operation is forbidden - '$\" + operationName +\"'\"));\n         builder.severity(IssueSeverity.ERROR);\n         issues.add(builder.build());\n \n"}}]}