{"pr_number": 1779, "pr_title": "fix: postgres/db2 refresh of the stored procedure", "pr_createdAt": "2020-12-02T21:08:10Z", "pr_url": "https://github.com/IBM/FHIR/pull/1779", "timeline": [{"oid": "41e95c7381ecb889f30f467e5a6cc7c0c78e5e60", "url": "https://github.com/IBM/FHIR/commit/41e95c7381ecb889f30f467e5a6cc7c0c78e5e60", "message": "fix: postgres/db2 refresh of the stored procedure\n\n- issue updating the stored procedure and function\n- Verify the signature of the postgres procedure/function\n```\nSELECT md5(prosrc),proname FROM pg_proc WHERE proname =\n'add_any_resource';\n```\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-12-02T21:07:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUxMjI3Ng==", "url": "https://github.com/IBM/FHIR/pull/1779#discussion_r534512276", "bodyText": "I was under the impression that the stored procs (or functions for postgres) should be part of the physical data model already and that they should get \"refreshed\" as part of the normal applyModel.\nObviously that wasn't working quite right, but now I'm not sure if it was because my understanding was wrong or if a premature commit (the change below) was the root cause.\nI'm OK with adding this in to cover us (so for sure the issue will be addressed), but it would be good to know whether applyModel above is working properly or not wrt updating procedures.", "author": "lmsurpre", "createdAt": "2020-12-02T22:03:47Z", "path": "fhir-persistence-schema/src/main/java/com/ibm/fhir/schema/app/Main.java", "diffHunk": "@@ -374,6 +374,10 @@ protected void updateSchema() {\n         if (!MULTITENANT_FEATURE_ENABLED.contains(dbType) && newDb ) {\n             populateResourceTypeAndParameterNameTableEntries(null);\n         }\n+\n+        // Let's refresh the procedures and functions.\n+        logger.info(\"Refreshing procedures and functions\");\n+        updateProcedures();", "originalCommit": "41e95c7381ecb889f30f467e5a6cc7c0c78e5e60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU4NjQxMA==", "url": "https://github.com/IBM/FHIR/pull/1779#discussion_r534586410", "bodyText": "yes, that's right they should however it doesn't exactly work on postgres, it does on db2.", "author": "prb112", "createdAt": "2020-12-03T00:58:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDUxMjI3Ng=="}], "type": "inlineReview", "revised_code": null}]}