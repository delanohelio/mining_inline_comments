{"pr_number": 1023, "pr_title": "Issue #1014 - added between function", "pr_createdAt": "2020-05-05T15:45:06Z", "pr_url": "https://github.com/IBM/FHIR/pull/1023", "timeline": [{"oid": "66fdacce0a1d60e84c89227f91266496bc1afedb", "url": "https://github.com/IBM/FHIR/commit/66fdacce0a1d60e84c89227f91266496bc1afedb", "message": "Issue #1014 - added between function\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-05T15:44:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMjQyMQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420212421", "bodyText": "can we remove it?", "author": "lmsurpre", "createdAt": "2020-05-05T15:46:38Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathDateTimeValue.java", "diffHunk": "@@ -60,73 +60,78 @@\n             .parseDefaulting(ChronoField.MINUTE_OF_HOUR, 0)\n             .parseDefaulting(ChronoField.SECOND_OF_MINUTE, 0)\n             .toFormatter();\n-    \n+\n     private final TemporalAccessor dateTime;\n     private final TimePrecision timePrecision;\n     private final Temporal temporal;\n-    \n+\n     protected FHIRPathDateTimeValue(Builder builder) {\n         super(builder);\n         dateTime = builder.dateTime;\n         timePrecision = builder.timePrecision;\n         temporal = getTemporal(dateTime);\n     }\n-    \n+\n     @Override\n     public boolean isDateTimeValue() {\n         return true;\n     }\n-    \n+\n     /**\n      * Indicates whether the date/time value wrapped by this FHIRPathDateTimeValue node is partial\n-     * \n+     *\n      * @return\n      *     true if the date/time value wrapped by this FHIRPathDateTimeValue node is partial, otherwise false\n      */\n     public boolean isPartial() {\n         return !(dateTime instanceof ZonedDateTime);\n     }\n-    \n+\n     @Override\n     public TemporalAccessor temporalAccessor() {\n         return dateTime;\n     }\n-    \n+\n     /**\n      * The date/time value wrapped by this FHIRPathDateTimeValue node\n-     * \n+     *\n      * @return\n      *     the date/time value wrapped by this FHIRPathDateTimeValue node\n      */\n     public TemporalAccessor dateTime() {\n         return dateTime;\n     }\n-    \n+\n     @Override\n     public TimePrecision timePrecision() {\n         return timePrecision;\n     }\n-    \n+\n     @Override\n     public Temporal temporal() {\n         return temporal;\n     }\n-    \n+\n     /**\n      * Static factory method for creating FHIRPathDateTimeValue instances from a {@link String} value\n-     * \n+     *\n      * @param text\n      *     the {@link String} value that is parsed into a {@link TemporalAccessor} date/time\n      * @return\n      *     a new FHIRPathDateTimeValue instance\n      */\n     public static FHIRPathDateTimeValue dateTimeValue(String text) {\n-        return FHIRPathDateTimeValue.builder(DATE_TIME_PARSER_FORMATTER.parseBest(text, ZonedDateTime::from, LocalDateTime::from, LocalDate::from, YearMonth::from, Year::from), getTimePrecision(text)).build();\n+//      return FHIRPathDateTimeValue.builder(PARSER_FORMATTER.parseBest(text, ZonedDateTime::from, LocalDateTime::from, LocalDate::from, YearMonth::from, Year::from), getTimePrecision(text)).build();", "originalCommit": "66fdacce0a1d60e84c89227f91266496bc1afedb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyODgzNw==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420228837", "bodyText": "Removed", "author": "JohnTimm", "createdAt": "2020-05-05T16:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMjQyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathDateTimeValue.java b/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathDateTimeValue.java\nindex da86e54184..6e0956b1a5 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathDateTimeValue.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathDateTimeValue.java\n\n@@ -121,7 +121,6 @@ public class FHIRPathDateTimeValue extends FHIRPathAbstractNode implements FHIRP\n      *     a new FHIRPathDateTimeValue instance\n      */\n     public static FHIRPathDateTimeValue dateTimeValue(String text) {\n-//      return FHIRPathDateTimeValue.builder(PARSER_FORMATTER.parseBest(text, ZonedDateTime::from, LocalDateTime::from, LocalDate::from, YearMonth::from, Year::from), getTimePrecision(text)).build();\n         TemporalAccessor dateTime = text.contains(\"T\") ?\n                 PARSER_FORMATTER.parseBest(text, ZonedDateTime::from, LocalDateTime::from, LocalDate::from, YearMonth::from, Year::from) :\n                 FHIRPathDateValue.PARSER_FORMATTER.parseBest(text, LocalDate::from, YearMonth::from, Year::from);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMjY4OQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420212689", "bodyText": "can we remove it?", "author": "lmsurpre", "createdAt": "2020-05-05T15:47:02Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathTimeValue.java", "diffHunk": "@@ -26,9 +26,9 @@\n /**\n  * A {@link FHIRPathTemporalValue} node that wraps a {@link LocalTime} value\n  */\n-public class FHIRPathTimeValue extends FHIRPathAbstractNode implements FHIRPathTemporalValue {    \n-    private static final DateTimeFormatter TIME_PARSER_FORMATTER = new DateTimeFormatterBuilder()\n-            .appendLiteral(\"T\")\n+public class FHIRPathTimeValue extends FHIRPathAbstractNode implements FHIRPathTemporalValue {\n+    public static final DateTimeFormatter PARSER_FORMATTER = new DateTimeFormatterBuilder()\n+//          .appendLiteral(\"T\")", "originalCommit": "66fdacce0a1d60e84c89227f91266496bc1afedb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyODkwMA==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420228900", "bodyText": "Removed", "author": "JohnTimm", "createdAt": "2020-05-05T16:08:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMjY4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathTimeValue.java b/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathTimeValue.java\nindex 0ef9263a4c..19deacf206 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathTimeValue.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/FHIRPathTimeValue.java\n\n@@ -28,7 +28,6 @@ import com.ibm.fhir.path.visitor.FHIRPathNodeVisitor;\n  */\n public class FHIRPathTimeValue extends FHIRPathAbstractNode implements FHIRPathTemporalValue {\n     public static final DateTimeFormatter PARSER_FORMATTER = new DateTimeFormatterBuilder()\n-//          .appendLiteral(\"T\")\n             .appendPattern(\"HH\")\n             .optionalStart()\n                 .appendPattern(\":mm\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzkzNg==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420213936", "bodyText": "can we remove it?", "author": "lmsurpre", "createdAt": "2020-05-05T15:48:42Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/evaluator/FHIRPathEvaluator.java", "diffHunk": "@@ -1068,19 +1079,20 @@ private IllegalArgumentException unexpectedNumberOfArguments(int arity, String f\n         @Override\n         public Collection<FHIRPathNode> visitDateLiteral(FHIRPathParser.DateLiteralContext ctx) {\n             debug(ctx);\n-            return singleton(FHIRPathDateValue.dateValue(ctx.getText().substring(1)));\n+            return singleton(dateValue(ctx.getText().substring(1)));\n         }\n \n         @Override\n         public Collection<FHIRPathNode> visitDateTimeLiteral(FHIRPathParser.DateTimeLiteralContext ctx) {\n             debug(ctx);\n-            return singleton(FHIRPathDateTimeValue.dateTimeValue(ctx.getText().substring(1)));\n+            return singleton(dateTimeValue(ctx.getText().substring(1)));\n         }\n \n         @Override\n         public Collection<FHIRPathNode> visitTimeLiteral(FHIRPathParser.TimeLiteralContext ctx) {\n             debug(ctx);\n-            return singleton(FHIRPathTimeValue.timeValue(ctx.getText().substring(1)));\n+//          return singleton(timeValue(ctx.getText().substring(1)));", "originalCommit": "66fdacce0a1d60e84c89227f91266496bc1afedb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIyODk3Mg==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420228972", "bodyText": "Removed", "author": "JohnTimm", "createdAt": "2020-05-05T16:08:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzkzNg=="}], "type": "inlineReview", "revised_code": {"commit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/evaluator/FHIRPathEvaluator.java b/fhir-path/src/main/java/com/ibm/fhir/path/evaluator/FHIRPathEvaluator.java\nindex f908a5e6c3..07c3a48157 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/evaluator/FHIRPathEvaluator.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/evaluator/FHIRPathEvaluator.java\n\n@@ -1091,7 +1091,6 @@ public class FHIRPathEvaluator {\n         @Override\n         public Collection<FHIRPathNode> visitTimeLiteral(FHIRPathParser.TimeLiteralContext ctx) {\n             debug(ctx);\n-//          return singleton(timeValue(ctx.getText().substring(1)));\n             return singleton(timeValue(ctx.getText().substring(2)));\n         }\n \n"}}, {"oid": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "url": "https://github.com/IBM/FHIR/commit/f490171b3c2e67e2294fd42ae4fb1977062cb31f", "message": "Issue #1014 - updated per PR feedback\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-05T16:09:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMDgwMw==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420230803", "bodyText": "should it support variations of those string units per the fhirpath spec", "author": "lmsurpre", "createdAt": "2020-05-05T16:11:33Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java", "diffHunk": "@@ -415,6 +588,29 @@ public static TemporalAmount getTemporalAmount(FHIRPathQuantityValue quantityVal\n         }\n     }\n \n+    public static ChronoUnit getChronoUnit(String unit) {\n+        switch (unit) {\n+        case \"years\":\n+            return ChronoUnit.YEARS;\n+        case \"months\":\n+            return ChronoUnit.MONTHS;\n+        case \"weeks\":\n+            return ChronoUnit.WEEKS;\n+        case \"days\":\n+            return ChronoUnit.DAYS;\n+        case \"hours\":\n+            return ChronoUnit.HOURS;\n+        case \"minutes\":\n+            return ChronoUnit.MINUTES;\n+        case \"seconds\":\n+            return ChronoUnit.SECONDS;\n+        case \"milliseconds\":\n+            return ChronoUnit.MILLIS;\n+        default:\n+            throw new IllegalArgumentException(\"Unsupported unit: \" + unit);\n+        }\n+    }", "originalCommit": "66fdacce0a1d60e84c89227f91266496bc1afedb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NTk4MA==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420245980", "bodyText": "I wanted to simplify it and only allow the equivalent of what the underlying java.time library allows", "author": "JohnTimm", "createdAt": "2020-05-05T16:33:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMDgwMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMjcxNg==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420232716", "bodyText": "javadoc?", "author": "lmsurpre", "createdAt": "2020-05-05T16:14:20Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/function/BetweenFunction.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.path.function;\n+\n+\n+import static com.ibm.fhir.path.FHIRPathQuantityValue.quantityValue;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.getChronoUnit;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.getString;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.getTemporalValue;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.hasTemporalValue;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.isStringValue;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.singleton;\n+\n+import java.math.BigDecimal;\n+import java.time.temporal.ChronoUnit;\n+import java.time.temporal.Temporal;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import com.ibm.fhir.path.FHIRPathNode;\n+import com.ibm.fhir.path.evaluator.FHIRPathEvaluator.EvaluationContext;\n+\n+public class BetweenFunction extends FHIRPathAbstractFunction {", "originalCommit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NjA5OQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420246099", "bodyText": "Added Javadoc", "author": "JohnTimm", "createdAt": "2020-05-05T16:33:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzMjcxNg=="}], "type": "inlineReview", "revised_code": {"commit": "20cfebb0e4a044828576ca780948902241774a44", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/function/BetweenFunction.java b/fhir-path/src/main/java/com/ibm/fhir/path/function/BetweenFunction.java\nindex 29ea21c661..d250166f8c 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/function/BetweenFunction.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/function/BetweenFunction.java\n\n@@ -24,6 +24,10 @@ import java.util.List;\n import com.ibm.fhir.path.FHIRPathNode;\n import com.ibm.fhir.path.evaluator.FHIRPathEvaluator.EvaluationContext;\n \n+/**\n+ * An implementation defined FHIRPath function that calculates the time between two date/time values. The behavior of this function is specified by the underlying java.time library function:\n+ * <a href=\"https://docs.oracle.com/javase/8/docs/api/java/time/temporal/ChronoUnit.html#between-java.time.temporal.Temporal-java.time.temporal.Temporal-\">ChronoUnit.between(Temporal, Temporal)</a>\n+ */\n public class BetweenFunction extends FHIRPathAbstractFunction {\n     @Override\n     public String getName() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzAyNg==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420237026", "bodyText": "could use some javadoc to further distinguish it from evaluatesToTrue;  this one would basically just say it returns true iff it convertsToBoolean and has a true value", "author": "lmsurpre", "createdAt": "2020-05-05T16:20:40Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java", "diffHunk": "@@ -270,41 +302,166 @@ public static boolean hasQuantityValue(Collection<FHIRPathNode> nodes) {\n     }\n \n     public static boolean evaluatesToBoolean(Collection<FHIRPathNode> nodes) {\n-        return isTrue(nodes) || isFalse(nodes);\n+        return evaluatesToTrue(nodes) || isFalse(nodes);\n+    }\n+\n+    /**\n+     * Indicates whether the collection of nodes evaluates to a boolean per:\n+     * <a href=\"http://hl7.org/fhirpath/N1/index.html#singleton-evaluation-of-collections\">Singleton Evaluation of Collections</a>\n+     *\n+     * @param nodes\n+     *    the collection of nodes\n+     * @return\n+     *    true if the collection of nodes evaluates to a boolean, false otherwise\n+     */\n+    public static boolean evaluatesToTrue(Collection<FHIRPathNode> nodes) {\n+        if (convertsToBoolean(nodes)) {\n+            return toBoolean(nodes) == true;\n+        }\n+        return isSingleton(nodes);\n     }\n \n     public static boolean isTrue(Collection<FHIRPathNode> nodes) {", "originalCommit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NjI0MQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420246241", "bodyText": "Added Javadoc", "author": "JohnTimm", "createdAt": "2020-05-05T16:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzAyNg=="}], "type": "inlineReview", "revised_code": {"commit": "20cfebb0e4a044828576ca780948902241774a44", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java b/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\nindex 4b3f10eb2d..672784d5a5 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\n\n@@ -306,13 +306,13 @@ public final class FHIRPathUtil {\n     }\n \n     /**\n-     * Indicates whether the collection of nodes evaluates to a boolean per:\n+     * Indicates whether the input collection evaluates to a boolean value per:\n      * <a href=\"http://hl7.org/fhirpath/N1/index.html#singleton-evaluation-of-collections\">Singleton Evaluation of Collections</a>\n      *\n      * @param nodes\n-     *    the collection of nodes\n+     *    the input collection\n      * @return\n-     *    true if the collection of nodes evaluates to a boolean, false otherwise\n+     *    true if the input collection evaluates to a boolean value, false otherwise\n      */\n     public static boolean evaluatesToTrue(Collection<FHIRPathNode> nodes) {\n         if (convertsToBoolean(nodes)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzUzNw==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420237537", "bodyText": "maybe some javadoc here with a link to explain that returns true if the value can be implicitly or explicitly converted to a boolean as of that table in the spec", "author": "lmsurpre", "createdAt": "2020-05-05T16:21:25Z", "path": "fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java", "diffHunk": "@@ -270,41 +302,166 @@ public static boolean hasQuantityValue(Collection<FHIRPathNode> nodes) {\n     }\n \n     public static boolean evaluatesToBoolean(Collection<FHIRPathNode> nodes) {\n-        return isTrue(nodes) || isFalse(nodes);\n+        return evaluatesToTrue(nodes) || isFalse(nodes);\n+    }\n+\n+    /**\n+     * Indicates whether the collection of nodes evaluates to a boolean per:\n+     * <a href=\"http://hl7.org/fhirpath/N1/index.html#singleton-evaluation-of-collections\">Singleton Evaluation of Collections</a>\n+     *\n+     * @param nodes\n+     *    the collection of nodes\n+     * @return\n+     *    true if the collection of nodes evaluates to a boolean, false otherwise\n+     */\n+    public static boolean evaluatesToTrue(Collection<FHIRPathNode> nodes) {\n+        if (convertsToBoolean(nodes)) {\n+            return toBoolean(nodes) == true;\n+        }\n+        return isSingleton(nodes);\n     }\n \n     public static boolean isTrue(Collection<FHIRPathNode> nodes) {\n+        return convertsToBoolean(nodes) && toBoolean(nodes) == true;\n+    }\n+\n+    public static boolean isFalse(Collection<FHIRPathNode> nodes) {\n+        return convertsToBoolean(nodes) && toBoolean(nodes) == false;\n+    }\n+\n+    public static boolean convertsToBoolean(Collection<FHIRPathNode> nodes) {", "originalCommit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NjM1OA==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420246358", "bodyText": "Added Javadoc", "author": "JohnTimm", "createdAt": "2020-05-05T16:34:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIzNzUzNw=="}], "type": "inlineReview", "revised_code": {"commit": "20cfebb0e4a044828576ca780948902241774a44", "chunk": "diff --git a/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java b/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\nindex 4b3f10eb2d..672784d5a5 100644\n--- a/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\n+++ b/fhir-path/src/main/java/com/ibm/fhir/path/util/FHIRPathUtil.java\n\n@@ -306,13 +306,13 @@ public final class FHIRPathUtil {\n     }\n \n     /**\n-     * Indicates whether the collection of nodes evaluates to a boolean per:\n+     * Indicates whether the input collection evaluates to a boolean value per:\n      * <a href=\"http://hl7.org/fhirpath/N1/index.html#singleton-evaluation-of-collections\">Singleton Evaluation of Collections</a>\n      *\n      * @param nodes\n-     *    the collection of nodes\n+     *    the input collection\n      * @return\n-     *    true if the collection of nodes evaluates to a boolean, false otherwise\n+     *    true if the input collection evaluates to a boolean value, false otherwise\n      */\n     public static boolean evaluatesToTrue(Collection<FHIRPathNode> nodes) {\n         if (convertsToBoolean(nodes)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDk3OQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420240979", "bodyText": "could use TestNG expectedExceptions, but this is fine", "author": "lmsurpre", "createdAt": "2020-05-05T16:26:37Z", "path": "fhir-path/src/test/java/com/ibm/fhir/path/test/BetweenFunctionTest.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*\n+ * (C) Copyright IBM Corp. 2020\n+ *\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package com.ibm.fhir.path.test;\n+\n+import static com.ibm.fhir.path.FHIRPathQuantityValue.quantityValue;\n+import static com.ibm.fhir.path.util.FHIRPathUtil.getQuantityValue;\n+import static org.testng.Assert.assertEquals;\n+import static org.testng.Assert.assertTrue;\n+import static org.testng.Assert.fail;\n+\n+import java.math.BigDecimal;\n+import java.time.DateTimeException;\n+import java.util.Collection;\n+\n+import org.testng.annotations.Test;\n+\n+import com.ibm.fhir.model.resource.Patient;\n+import com.ibm.fhir.model.type.Date;\n+import com.ibm.fhir.path.FHIRPathNode;\n+import com.ibm.fhir.path.evaluator.FHIRPathEvaluator;\n+import com.ibm.fhir.path.exception.FHIRPathException;\n+\n+public class BetweenFunctionTest {\n+    @Test\n+    public void testBetweenFunction1() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@1970-01-01, @2020-01-01, 'years')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(50), \"years\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction2() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@1970-01-01, @2020-01-01, 'months')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(600), \"months\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction3() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@1970-01-01, @2020-01-01, 'weeks')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(2608), \"weeks\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction4() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@1970-01-01, @2020-01-01, 'days')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(18262), \"days\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction5() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@T00:00:00.000, @T12:34:56.789, 'hours')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(12), \"hours\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction6() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@T00:00:00.000, @T12:34:56.789, 'minutes')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(754), \"minutes\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction7() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@T00:00:00.000, @T12:34:56.789, 'seconds')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(45296), \"seconds\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction8() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@T00:00:00.000, @T12:34:56.789, 'milliseconds')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(45296789), \"milliseconds\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction9() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@2020-01-01, @1970-01-01, 'years')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(-50), \"years\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction10() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        Collection<FHIRPathNode> result = evaluator.evaluate(\"between(@1970-01-01, @2020-01-01T00:00:00Z, 'years')\");\n+        assertEquals(getQuantityValue(result), quantityValue(new BigDecimal(50), \"years\"));\n+    }\n+\n+    @Test\n+    public void testBetweenFunction11() throws Exception {\n+        FHIRPathEvaluator evaluator = FHIRPathEvaluator.evaluator();\n+        try {\n+            evaluator.evaluate(\"between(@1970-01-01T00:00:00Z, @2020-01-01, 'years')\");\n+            fail();\n+        } catch (Exception e) {\n+            assertTrue(e instanceof FHIRPathException);\n+            assertTrue(e.getCause() instanceof DateTimeException);\n+        }\n+    }", "originalCommit": "f490171b3c2e67e2294fd42ae4fb1977062cb31f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0NjU2OQ==", "url": "https://github.com/IBM/FHIR/pull/1023#discussion_r420246569", "bodyText": "I prefer this approach because I can check exception type and message", "author": "JohnTimm", "createdAt": "2020-05-05T16:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI0MDk3OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "20cfebb0e4a044828576ca780948902241774a44", "url": "https://github.com/IBM/FHIR/commit/20cfebb0e4a044828576ca780948902241774a44", "message": "Issue #1014 - added Javadoc per PR feedback\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-05T16:33:11Z", "type": "commit"}, {"oid": "f5a3ddb75694d295b233efe6cb73bb2cdcf1528b", "url": "https://github.com/IBM/FHIR/commit/f5a3ddb75694d295b233efe6cb73bb2cdcf1528b", "message": "Issue #1014 - refactor of isComparableTo, compareTo and equals methods\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-06T17:34:24Z", "type": "commit"}, {"oid": "ab6d79adf640e759d2f21d7b565c0887110a3683", "url": "https://github.com/IBM/FHIR/commit/ab6d79adf640e759d2f21d7b565c0887110a3683", "message": "Issue #1014 - minor tweak\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-06T17:56:54Z", "type": "commit"}, {"oid": "89557181c43de55122f9f7cc57f9ac6a26b9711f", "url": "https://github.com/IBM/FHIR/commit/89557181c43de55122f9f7cc57f9ac6a26b9711f", "message": "Issue #1014 - reverted changes to test suite\n\nSigned-off-by: John T.E. Timm <johntimm@us.ibm.com>", "committedDate": "2020-05-06T18:21:56Z", "type": "commit"}]}