{"pr_number": 658, "pr_title": "System-Count when no data in system #656", "pr_createdAt": "2020-01-30T14:03:52Z", "pr_url": "https://github.com/IBM/FHIR/pull/658", "timeline": [{"oid": "0305dfb24f682532068919c01824b4b80520d704", "url": "https://github.com/IBM/FHIR/commit/0305dfb24f682532068919c01824b4b80520d704", "message": "System-Count when no data in system #656\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-01-30T14:03:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ==", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r372987785", "bodyText": "If we know we have no data, should it just be SELECT 0 or some such?", "author": "lmsurpre", "createdAt": "2020-01-30T14:42:00Z", "path": "fhir-persistence-jdbc/src/main/java/com/ibm/fhir/persistence/jdbc/util/QuerySegmentAggregator.java", "diffHunk": "@@ -240,6 +240,12 @@ protected SqlQueryData buildSystemLevelQuery(String selectRoot, String subSelect\n \n         // Processes through EACH register parameter extracting the integer value\n         Map<String, Integer> resourceNameMap = resourceDao.readAllResourceTypeNames();\n+        if (resourceNameMap.size() == 0) {\n+            // Special condition where we have no registered resources and therefore no data.\n+            // This is only used in COUNT\n+            queryString.append(\"SELECT LR.LOGICAL_RESOURCE_ID AS CNT FROM LOGICAL_RESOURCES LR\");", "originalCommit": "0305dfb24f682532068919c01824b4b80520d704", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAwMjMxNg==", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r373002316", "bodyText": "since it's a nested SELECT SELECT it ends up being a pain in the butt to do VALUES() since we don't really want to return a value.", "author": "prb112", "createdAt": "2020-01-30T15:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzAxODk0NQ==", "url": "https://github.com/IBM/FHIR/pull/658#discussion_r373018945", "bodyText": "yeah, i almost suggested defining and throwing a checked exception so that we don't even attempt the query, but I guess the above is ok.  marking it approved.", "author": "lmsurpre", "createdAt": "2020-01-30T15:30:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjk4Nzc4NQ=="}], "type": "inlineReview", "revised_code": null}]}