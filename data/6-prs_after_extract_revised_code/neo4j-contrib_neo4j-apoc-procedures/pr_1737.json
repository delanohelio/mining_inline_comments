{"pr_number": 1737, "pr_title": "Eagerly convert TxData iterables to lists", "pr_createdAt": "2020-12-02T19:22:28Z", "pr_url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1737", "timeline": [{"oid": "ade2a28f6299f405e291f45649ab1d245b70565e", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/ade2a28f6299f405e291f45649ab1d245b70565e", "message": "Eagerly convert TxData iterables to lists\n\nThese are ultimately converted to a Collection\nwhen the Cypher query is executed anyway, so no\nreal performance advantage to the old way", "committedDate": "2020-12-02T19:18:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQyNzgyNw==", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1737#discussion_r534427827", "bodyText": "If there is a preferred method for this in one of the included libraries we can remove this method and use that", "author": "ivangreene", "createdAt": "2020-12-02T19:31:14Z", "path": "core/src/main/java/apoc/trigger/TriggerHandler.java", "diffHunk": "@@ -287,6 +288,11 @@ public void afterRollback(TransactionData txData, Void state, GraphDatabaseServi\n         );\n     }\n \n+    private <E> List<E> toList(Iterable<E> iterable) {", "originalCommit": "ade2a28f6299f405e291f45649ab1d245b70565e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "chunk": "diff --git a/core/src/main/java/apoc/trigger/TriggerHandler.java b/core/src/main/java/apoc/trigger/TriggerHandler.java\nindex 4d5ec592..cae09c35 100644\n--- a/core/src/main/java/apoc/trigger/TriggerHandler.java\n+++ b/core/src/main/java/apoc/trigger/TriggerHandler.java\n\n@@ -288,11 +287,6 @@ public class TriggerHandler extends LifecycleAdapter implements TransactionEvent\n         );\n     }\n \n-    private <E> List<E> toList(Iterable<E> iterable) {\n-        return StreamSupport.stream(iterable.spliterator(), false)\n-                .collect(Collectors.toList());\n-    }\n-\n     private boolean hasPhase(Phase phase) {\n         return activeTriggers.values().stream()\n                 .map(data -> (Map<String, Object>) data.get(\"selector\"))\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIxMjY3OQ==", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1737#discussion_r535212679", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"createdNodes\", toList(txData.createdNodes()),\n          \n          \n            \n                            \"createdNodes\", Convert.convertToList(txData.createdNodes()),", "author": "conker84", "createdAt": "2020-12-03T13:09:06Z", "path": "core/src/main/java/apoc/trigger/TriggerHandler.java", "diffHunk": "@@ -273,10 +274,10 @@ public void afterRollback(TransactionData txData, Void state, GraphDatabaseServi\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", txData.createdNodes(),\n-                \"createdRelationships\", txData.createdRelationships(),\n-                \"deletedNodes\", txData.deletedNodes(),\n-                \"deletedRelationships\", txData.deletedRelationships(),\n+                \"createdNodes\", toList(txData.createdNodes()),", "originalCommit": "ade2a28f6299f405e291f45649ab1d245b70565e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "chunk": "diff --git a/core/src/main/java/apoc/trigger/TriggerHandler.java b/core/src/main/java/apoc/trigger/TriggerHandler.java\nindex 4d5ec592..cae09c35 100644\n--- a/core/src/main/java/apoc/trigger/TriggerHandler.java\n+++ b/core/src/main/java/apoc/trigger/TriggerHandler.java\n\n@@ -274,10 +273,10 @@ public class TriggerHandler extends LifecycleAdapter implements TransactionEvent\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", toList(txData.createdNodes()),\n-                \"createdRelationships\", toList(txData.createdRelationships()),\n-                \"deletedNodes\", toList(txData.deletedNodes()),\n-                \"deletedRelationships\", toList(txData.deletedRelationships()),\n+                \"createdNodes\", Convert.convertToList(txData.createdNodes()),\n+                \"createdRelationships\", Convert.convertToList(txData.createdRelationships()),\n+                \"deletedNodes\", Convert.convertToList(txData.deletedNodes()),\n+                \"deletedRelationships\", Convert.convertToList(txData.deletedRelationships()),\n                 \"removedLabels\", aggregateLabels(txData.removedLabels()),\n                 \"removedNodeProperties\", aggregatePropertyKeys(txData.removedNodeProperties(),true,true),\n                 \"removedRelationshipProperties\", aggregatePropertyKeys(txData.removedRelationshipProperties(),false,true),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIxMzA3OA==", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1737#discussion_r535213078", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"deletedNodes\", toList(txData.deletedNodes()),\n          \n          \n            \n                            \"deletedNodes\", Convert.convertToList(txData.deletedNodes()),", "author": "conker84", "createdAt": "2020-12-03T13:09:44Z", "path": "core/src/main/java/apoc/trigger/TriggerHandler.java", "diffHunk": "@@ -273,10 +274,10 @@ public void afterRollback(TransactionData txData, Void state, GraphDatabaseServi\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", txData.createdNodes(),\n-                \"createdRelationships\", txData.createdRelationships(),\n-                \"deletedNodes\", txData.deletedNodes(),\n-                \"deletedRelationships\", txData.deletedRelationships(),\n+                \"createdNodes\", toList(txData.createdNodes()),\n+                \"createdRelationships\", toList(txData.createdRelationships()),\n+                \"deletedNodes\", toList(txData.deletedNodes()),", "originalCommit": "ade2a28f6299f405e291f45649ab1d245b70565e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "chunk": "diff --git a/core/src/main/java/apoc/trigger/TriggerHandler.java b/core/src/main/java/apoc/trigger/TriggerHandler.java\nindex 4d5ec592..cae09c35 100644\n--- a/core/src/main/java/apoc/trigger/TriggerHandler.java\n+++ b/core/src/main/java/apoc/trigger/TriggerHandler.java\n\n@@ -274,10 +273,10 @@ public class TriggerHandler extends LifecycleAdapter implements TransactionEvent\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", toList(txData.createdNodes()),\n-                \"createdRelationships\", toList(txData.createdRelationships()),\n-                \"deletedNodes\", toList(txData.deletedNodes()),\n-                \"deletedRelationships\", toList(txData.deletedRelationships()),\n+                \"createdNodes\", Convert.convertToList(txData.createdNodes()),\n+                \"createdRelationships\", Convert.convertToList(txData.createdRelationships()),\n+                \"deletedNodes\", Convert.convertToList(txData.deletedNodes()),\n+                \"deletedRelationships\", Convert.convertToList(txData.deletedRelationships()),\n                 \"removedLabels\", aggregateLabels(txData.removedLabels()),\n                 \"removedNodeProperties\", aggregatePropertyKeys(txData.removedNodeProperties(),true,true),\n                 \"removedRelationshipProperties\", aggregatePropertyKeys(txData.removedRelationshipProperties(),false,true),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIxMzE3MQ==", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1737#discussion_r535213171", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"deletedRelationships\", toList(txData.deletedRelationships()),\n          \n          \n            \n                            \"deletedRelationships\", Convert.convertToList(txData.deletedRelationships()),", "author": "conker84", "createdAt": "2020-12-03T13:09:53Z", "path": "core/src/main/java/apoc/trigger/TriggerHandler.java", "diffHunk": "@@ -273,10 +274,10 @@ public void afterRollback(TransactionData txData, Void state, GraphDatabaseServi\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", txData.createdNodes(),\n-                \"createdRelationships\", txData.createdRelationships(),\n-                \"deletedNodes\", txData.deletedNodes(),\n-                \"deletedRelationships\", txData.deletedRelationships(),\n+                \"createdNodes\", toList(txData.createdNodes()),\n+                \"createdRelationships\", toList(txData.createdRelationships()),\n+                \"deletedNodes\", toList(txData.deletedNodes()),\n+                \"deletedRelationships\", toList(txData.deletedRelationships()),", "originalCommit": "ade2a28f6299f405e291f45649ab1d245b70565e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "chunk": "diff --git a/core/src/main/java/apoc/trigger/TriggerHandler.java b/core/src/main/java/apoc/trigger/TriggerHandler.java\nindex 4d5ec592..cae09c35 100644\n--- a/core/src/main/java/apoc/trigger/TriggerHandler.java\n+++ b/core/src/main/java/apoc/trigger/TriggerHandler.java\n\n@@ -274,10 +273,10 @@ public class TriggerHandler extends LifecycleAdapter implements TransactionEvent\n         }\n         return map(\"transactionId\", txId,\n                 \"commitTime\", commitTime,\n-                \"createdNodes\", toList(txData.createdNodes()),\n-                \"createdRelationships\", toList(txData.createdRelationships()),\n-                \"deletedNodes\", toList(txData.deletedNodes()),\n-                \"deletedRelationships\", toList(txData.deletedRelationships()),\n+                \"createdNodes\", Convert.convertToList(txData.createdNodes()),\n+                \"createdRelationships\", Convert.convertToList(txData.createdRelationships()),\n+                \"deletedNodes\", Convert.convertToList(txData.deletedNodes()),\n+                \"deletedRelationships\", Convert.convertToList(txData.deletedRelationships()),\n                 \"removedLabels\", aggregateLabels(txData.removedLabels()),\n                 \"removedNodeProperties\", aggregatePropertyKeys(txData.removedNodeProperties(),true,true),\n                 \"removedRelationshipProperties\", aggregatePropertyKeys(txData.removedRelationshipProperties(),false,true),\n"}}, {"oid": "e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/e5160726a1b2cccb347c071b80dc3e10a1c4baa2", "message": "Use Convert.convertToList", "committedDate": "2020-12-03T14:57:25Z", "type": "commit"}]}