{"pr_number": 1577, "pr_title": "Extract Config into Deprecated and Non-Deprecated parts", "pr_createdAt": "2020-06-11T23:22:13Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1577", "timeline": [{"oid": "9759821034e977c4ce75456866db63e8827f6aa3", "url": "https://github.com/DataDog/dd-trace-java/commit/9759821034e977c4ce75456866db63e8827f6aa3", "message": "Extract Config into Deprecated and Non-Deprecated parts\n\nThis way the classes with config keys can stay long term while we move the config class out.", "committedDate": "2020-06-12T00:49:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTI1NTA3Mw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1577#discussion_r439255073", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class AssortedConstants {\n          \n          \n            \n            public class WriterConstants {\n          \n      \n    \n    \n  \n\nI am afraid that in the future this class will be the \"potpourri\" of various constants that we don't know where to put....", "author": "jpbempel", "createdAt": "2020-06-12T07:31:10Z", "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/AssortedConstants.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package datadog.trace.bootstrap.instrumentation.api;\n+\n+public class AssortedConstants {", "originalCommit": "9759821034e977c4ce75456866db63e8827f6aa3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "376e81f87cc56a9f33260582b57164bfd8326a58", "chunk": "diff --git a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/AssortedConstants.java b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\nsimilarity index 85%\nrename from internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/AssortedConstants.java\nrename to internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\nindex a198175ea7..6cba536369 100644\n--- a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/AssortedConstants.java\n+++ b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\n\n@@ -1,6 +1,6 @@\n package datadog.trace.bootstrap.instrumentation.api;\n \n-public class AssortedConstants {\n+public class WriterConstants {\n   public static final String DD_AGENT_WRITER_TYPE = \"DDAgentWriter\";\n   public static final String LOGGING_WRITER_TYPE = \"LoggingWriter\";\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5MjIxOQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1577#discussion_r439492219", "bodyText": "I think we need to talk about formatting, because this isn't related to the change set and I doubt there is a Java code base where member fields assigned to within constructors are not prefixed with this. I would sort of get an argument that it's line noise, except a few lines up from here, a variable which is obviously not reassigned is prefixed with final. When I see final I'm scanning ahead looking for a closure.", "author": "richardstartin", "createdAt": "2020-06-12T15:35:15Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java", "diffHunk": "@@ -104,9 +104,9 @@ private DDAgentWriter(\n     }\n     final StatefulSerializer s = null == serializer ? new MsgPackStatefulSerializer() : serializer;\n     this.monitor = monitor;\n-    this.dispatchingDisruptor =", "originalCommit": "4b0393eb2ffea57986658b65d440f714d8d907aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3MTA3Mg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1577#discussion_r439571072", "bodyText": "Yes, I think now that we have more contributors, it might be worth revisiting.\nI certainly have my opinions, but we should make a collective decision.\nFor me, I really dislike reassigning parameters -- final or not.\nI'm also very much in favor of making most classes & methods final, but not so much local vars.", "author": "dougqh", "createdAt": "2020-06-12T18:10:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ5MjIxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "835636e52f3f530f088af6df53add54ef56ed01c", "chunk": "diff --git a/dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java b/dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java\nindex 70c8194a99..59e6a639d1 100644\n--- a/dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java\n+++ b/dd-trace-core/src/main/java/datadog/trace/common/writer/DDAgentWriter.java\n\n@@ -100,7 +106,7 @@ public class DDAgentWriter implements Writer {\n     if (agentApi != null) {\n       api = agentApi;\n     } else {\n-      api = new DDAgentApi(agentHost, traceAgentPort, unixDomainSocket);\n+      api = new DDAgentApi(agentHost, traceAgentPort, unixDomainSocket, timeoutMillis);\n     }\n     final StatefulSerializer s = null == serializer ? new MsgPackStatefulSerializer() : serializer;\n     this.monitor = monitor;\n"}}, {"oid": "376e81f87cc56a9f33260582b57164bfd8326a58", "url": "https://github.com/DataDog/dd-trace-java/commit/376e81f87cc56a9f33260582b57164bfd8326a58", "message": "More missed references.", "committedDate": "2020-06-12T19:38:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYxMDI4Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/1577#discussion_r439610286", "bodyText": "private constructor?\nI'd also prefer to see constant holders final.  Well, really almost all classes, but especially constant classes.", "author": "dougqh", "createdAt": "2020-06-12T19:41:57Z", "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java", "diffHunk": "@@ -0,0 +1,6 @@\n+package datadog.trace.bootstrap.instrumentation.api;\n+\n+public class WriterConstants {", "originalCommit": "376e81f87cc56a9f33260582b57164bfd8326a58", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93eedf7841ebd889d4230e0154689883c0f84ffc", "chunk": "diff --git a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\nindex 6cba536369..c3476b6951 100644\n--- a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\n+++ b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/WriterConstants.java\n\n@@ -1,6 +1,8 @@\n package datadog.trace.bootstrap.instrumentation.api;\n \n-public class WriterConstants {\n+public final class WriterConstants {\n   public static final String DD_AGENT_WRITER_TYPE = \"DDAgentWriter\";\n   public static final String LOGGING_WRITER_TYPE = \"LoggingWriter\";\n+\n+  private WriterConstants() {}\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYxMTM0OQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1577#discussion_r439611349", "bodyText": "Must admit, I'm not fan of the long list of static import, but I know that's our current norm.", "author": "dougqh", "createdAt": "2020-06-12T19:45:04Z", "path": "dd-trace-api/src/main/java/datadog/trace/api/Config.java", "diffHunk": "@@ -1,5 +1,63 @@\n package datadog.trace.api;\n \n+import static datadog.trace.api.ConfigDefaults.DEFAULT_AGENT_HOST;", "originalCommit": "376e81f87cc56a9f33260582b57164bfd8326a58", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "835636e52f3f530f088af6df53add54ef56ed01c", "chunk": "diff --git a/dd-trace-api/src/main/java/datadog/trace/api/Config.java b/dd-trace-api/src/main/java/datadog/trace/api/Config.java\nindex d99f1912f9..64a4f6fd2e 100644\n--- a/dd-trace-api/src/main/java/datadog/trace/api/Config.java\n+++ b/dd-trace-api/src/main/java/datadog/trace/api/Config.java\n\n@@ -1,6 +1,7 @@\n package datadog.trace.api;\n \n import static datadog.trace.api.ConfigDefaults.DEFAULT_AGENT_HOST;\n+import static datadog.trace.api.ConfigDefaults.DEFAULT_AGENT_TIMEOUT;\n import static datadog.trace.api.ConfigDefaults.DEFAULT_AGENT_UNIX_DOMAIN_SOCKET;\n import static datadog.trace.api.ConfigDefaults.DEFAULT_AGENT_WRITER_TYPE;\n import static datadog.trace.api.ConfigDefaults.DEFAULT_ANALYTICS_SAMPLE_RATE;\n"}}, {"oid": "93eedf7841ebd889d4230e0154689883c0f84ffc", "url": "https://github.com/DataDog/dd-trace-java/commit/93eedf7841ebd889d4230e0154689883c0f84ffc", "message": "Hide constructors for field only classes.", "committedDate": "2020-06-12T20:15:51Z", "type": "forcePushed"}, {"oid": "4f616f06d127bad2c7ba95d56dc5defb5b13b10d", "url": "https://github.com/DataDog/dd-trace-java/commit/4f616f06d127bad2c7ba95d56dc5defb5b13b10d", "message": "Hide constructors for field only classes.", "committedDate": "2020-06-15T15:03:03Z", "type": "forcePushed"}, {"oid": "835636e52f3f530f088af6df53add54ef56ed01c", "url": "https://github.com/DataDog/dd-trace-java/commit/835636e52f3f530f088af6df53add54ef56ed01c", "message": "Extract Config into Deprecated and Non-Deprecated parts\n\nThis way the classes with config keys can stay long term while we move the config class out.", "committedDate": "2020-06-15T17:10:01Z", "type": "commit"}, {"oid": "86eb7bd85889148ffcf106055aad460072d92b15", "url": "https://github.com/DataDog/dd-trace-java/commit/86eb7bd85889148ffcf106055aad460072d92b15", "message": "Review changes and fix build\n\nMissed a few references.", "committedDate": "2020-06-15T17:10:01Z", "type": "commit"}, {"oid": "b8e2af4460db3d413818c56547ec065f45bdfe2a", "url": "https://github.com/DataDog/dd-trace-java/commit/b8e2af4460db3d413818c56547ec065f45bdfe2a", "message": "More missed references.", "committedDate": "2020-06-15T17:10:01Z", "type": "commit"}, {"oid": "677922b937b38545a2ac63228a4d45e29492e206", "url": "https://github.com/DataDog/dd-trace-java/commit/677922b937b38545a2ac63228a4d45e29492e206", "message": "Hide constructors for field only classes.", "committedDate": "2020-06-15T17:10:02Z", "type": "commit"}, {"oid": "677922b937b38545a2ac63228a4d45e29492e206", "url": "https://github.com/DataDog/dd-trace-java/commit/677922b937b38545a2ac63228a4d45e29492e206", "message": "Hide constructors for field only classes.", "committedDate": "2020-06-15T17:10:02Z", "type": "forcePushed"}]}