{"pr_number": 2217, "pr_title": "CiApp: CIProviderInfoTests assertions based on ext files", "pr_createdAt": "2020-12-17T14:12:42Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2217", "timeline": [{"oid": "a8ae4876b69d035769a0cab92e7550d7cce5dbda", "url": "https://github.com/DataDog/dd-trace-java/commit/a8ae4876b69d035769a0cab92e7550d7cce5dbda", "message": "Update ciprovider json spec", "committedDate": "2020-12-17T15:10:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MDMzNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/2217#discussion_r546650336", "bodyText": "Have you considered using a separate builder object to build the map, rather then use superclass fields as temporary storage?", "author": "mcculls", "createdAt": "2020-12-21T11:18:36Z", "path": "internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/ci/AppVeyorInfo.java", "diffHunk": "@@ -45,6 +33,8 @@\n     gitCommit = buildGitCommit(repoProvider);\n     gitTag = buildGitTag(repoProvider);\n     gitBranch = buildGitBranch(repoProvider, gitTag);\n+\n+    updateCiTags();", "originalCommit": "dd807533c309163d7a662a1318cdd98dd3ffea1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzIwMjU5OA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2217#discussion_r553202598", "bodyText": "Changed \ud83d\udc4d", "author": "drodriguezhdez", "createdAt": "2021-01-07T09:19:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjY1MDMzNg=="}], "type": "inlineReview", "revised_code": {"commit": "be1479c94738a795160f5526dc83f4c133938240", "chunk": "diff --git a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/ci/AppVeyorInfo.java b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/ci/AppVeyorInfo.java\nindex 186b3bfce5..6c3a82737c 100644\n--- a/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/ci/AppVeyorInfo.java\n+++ b/internal-api/src/main/java/datadog/trace/bootstrap/instrumentation/api/ci/AppVeyorInfo.java\n\n@@ -21,20 +21,22 @@ class AppVeyorInfo extends CIProviderInfo {\n     final String repoName = System.getenv(APPVEYOR_REPO_NAME);\n     final String url = buildPipelineUrl(repoName, buildId);\n     final String repoProvider = System.getenv(APPVEYOR_REPO_PROVIDER);\n+    final String tag = buildGitTag(repoProvider);\n \n-    ciProviderName = APPVEYOR_PROVIDER_NAME;\n-    ciPipelineId = buildId;\n-    ciPipelineName = repoName;\n-    ciPipelineNumber = System.getenv(APPVEYOR_PIPELINE_NUMBER);\n-    ciPipelineUrl = url;\n-    ciJobUrl = url;\n-    ciWorkspacePath = expandTilde(System.getenv(APPVEYOR_WORKSPACE_PATH));\n-    gitRepositoryUrl = buildGitRepositoryUrl(repoProvider, repoName);\n-    gitCommit = buildGitCommit(repoProvider);\n-    gitTag = buildGitTag(repoProvider);\n-    gitBranch = buildGitBranch(repoProvider, gitTag);\n-\n-    updateCiTags();\n+    this.ciTags =\n+        new CITagsBuilder()\n+            .withCiProviderName(APPVEYOR_PROVIDER_NAME)\n+            .withCiPipelineId(buildId)\n+            .withCiPipelineName(repoName)\n+            .withCiPipelineNumber(System.getenv(APPVEYOR_PIPELINE_NUMBER))\n+            .withCiPipelineUrl(url)\n+            .withCiJorUrl(url)\n+            .withCiWorkspacePath(expandTilde(System.getenv(APPVEYOR_WORKSPACE_PATH)))\n+            .withGitRepositoryUrl(buildGitRepositoryUrl(repoProvider, repoName))\n+            .withGitCommit(buildGitCommit(repoProvider))\n+            .withGitBranch(buildGitBranch(repoProvider, tag))\n+            .withGitTag(tag)\n+            .build();\n   }\n \n   private String buildGitTag(final String repoProvider) {\n"}}, {"oid": "464144be56e4c026a507c490072dbc7a6b0a20d5", "url": "https://github.com/DataDog/dd-trace-java/commit/464144be56e4c026a507c490072dbc7a6b0a20d5", "message": "CIProviderInfoTests based on json file generated by datadog-ci-spec", "committedDate": "2021-01-07T08:20:13Z", "type": "commit"}, {"oid": "7daeb306d3c1caa04ff41a4cb4f5ee23be7c45e6", "url": "https://github.com/DataDog/dd-trace-java/commit/7daeb306d3c1caa04ff41a4cb4f5ee23be7c45e6", "message": "Update ciprovider json spec", "committedDate": "2021-01-07T08:20:13Z", "type": "commit"}, {"oid": "de54f9b428ae874a2347e841455fb7683a58a8f1", "url": "https://github.com/DataDog/dd-trace-java/commit/de54f9b428ae874a2347e841455fb7683a58a8f1", "message": "Fix codenarc", "committedDate": "2021-01-07T08:20:13Z", "type": "commit"}, {"oid": "704cf7cb7e7997b8823b53c03e71df35863ef26a", "url": "https://github.com/DataDog/dd-trace-java/commit/704cf7cb7e7997b8823b53c03e71df35863ef26a", "message": "Fix code coverage", "committedDate": "2021-01-07T08:20:13Z", "type": "commit"}, {"oid": "5f07d0ee3bca48513c6a44613b0369ee1bb3318d", "url": "https://github.com/DataDog/dd-trace-java/commit/5f07d0ee3bca48513c6a44613b0369ee1bb3318d", "message": "Update jenkins.json", "committedDate": "2021-01-07T08:20:13Z", "type": "commit"}, {"oid": "5f07d0ee3bca48513c6a44613b0369ee1bb3318d", "url": "https://github.com/DataDog/dd-trace-java/commit/5f07d0ee3bca48513c6a44613b0369ee1bb3318d", "message": "Update jenkins.json", "committedDate": "2021-01-07T08:20:13Z", "type": "forcePushed"}, {"oid": "be1479c94738a795160f5526dc83f4c133938240", "url": "https://github.com/DataDog/dd-trace-java/commit/be1479c94738a795160f5526dc83f4c133938240", "message": "Use CITagsBuilder", "committedDate": "2021-01-07T09:17:47Z", "type": "commit"}]}