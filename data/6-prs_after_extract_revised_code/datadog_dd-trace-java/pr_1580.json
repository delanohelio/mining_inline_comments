{"pr_number": 1580, "pr_title": "avoid creating new strings prior to jar lookup", "pr_createdAt": "2020-06-12T13:02:01Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1580", "timeline": [{"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "url": "https://github.com/DataDog/dd-trace-java/commit/a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "message": "improve InternalJarURLHandler lookup, avoid creating new strings prior to lookup", "committedDate": "2020-06-12T13:28:20Z", "type": "commit"}, {"oid": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "url": "https://github.com/DataDog/dd-trace-java/commit/a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "message": "improve InternalJarURLHandler lookup, avoid creating new strings prior to lookup", "committedDate": "2020-06-12T13:28:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTQ2OTk0Nw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1580#discussion_r439469947", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        int end = name.endsWith(\"data\") ? name.length() - 4 : name.length();\n          \n          \n            \n                        int end = name.endsWith(\".classdata\") ? name.length() - 4 : name.length();", "author": "randomanderson", "createdAt": "2020-06-12T14:55:39Z", "path": "dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java", "diffHunk": "@@ -33,7 +33,10 @@\n           final JarEntry entry = entries.nextElement();\n \n           if (!entry.isDirectory() && entry.getName().startsWith(filePrefix)) {\n-            filenameToEntry.put(entry.getName().substring(internalJarFileName.length()), entry);\n+            String name = entry.getName();\n+            // remove data suffix\n+            int end = name.endsWith(\"data\") ? name.length() - 4 : name.length();", "originalCommit": "a014468a2a2bb94072dcdc8f3ce9885cd5170b24", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5412d3410c36bbfe34592a8e696d8715a8ba715a", "chunk": "diff --git a/dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java b/dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java\nindex dc541e6113..1809e581dd 100644\n--- a/dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java\n+++ b/dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java\n\n@@ -35,7 +35,7 @@ public class InternalJarURLHandler extends URLStreamHandler {\n           if (!entry.isDirectory() && entry.getName().startsWith(filePrefix)) {\n             String name = entry.getName();\n             // remove data suffix\n-            int end = name.endsWith(\"data\") ? name.length() - 4 : name.length();\n+            int end = name.endsWith(\".classdata\") ? name.length() - 4 : name.length();\n             filenameToEntry.put(name.substring(internalJarFileName.length(), end), entry);\n           }\n         }\n"}}, {"oid": "5412d3410c36bbfe34592a8e696d8715a8ba715a", "url": "https://github.com/DataDog/dd-trace-java/commit/5412d3410c36bbfe34592a8e696d8715a8ba715a", "message": "Update dd-java-agent/agent-bootstrap/src/main/java/datadog/trace/bootstrap/InternalJarURLHandler.java\n\nCo-authored-by: Laplie Anderson <randomanderson@users.noreply.github.com>", "committedDate": "2020-06-12T15:04:52Z", "type": "commit"}]}