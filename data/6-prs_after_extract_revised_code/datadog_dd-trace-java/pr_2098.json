{"pr_number": 2098, "pr_title": "remove analytics sample rate rule", "pr_createdAt": "2020-11-19T21:41:34Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2098", "timeline": [{"oid": "5169cf1d39594bfa8b3a4d4121b3c1590a9f53f6", "url": "https://github.com/DataDog/dd-trace-java/commit/5169cf1d39594bfa8b3a4d4121b3c1590a9f53f6", "message": "remove analytics sample rate rule", "committedDate": "2020-11-19T22:00:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NDYxOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2098#discussion_r527244618", "bodyText": "\ud83d\udc4d  ?", "author": "lpriima", "createdAt": "2020-11-19T22:24:29Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/processor/TraceProcessor.java", "diffHunk": "@@ -17,11 +16,7 @@\n   final Rule[] DEFAULT_RULES =\n       new Rule[] {\n         // Rules are applied in order.\n-        new DBStatementRule(),\n-        new ResourceNameRule(),\n-        new ErrorRule(),\n-        new URLAsResourceNameRule(),\n-        new AnalyticsSampleRateRule(),\n+        new DBStatementRule(), new ResourceNameRule(), new ErrorRule(), new URLAsResourceNameRule()", "originalCommit": "5169cf1d39594bfa8b3a4d4121b3c1590a9f53f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NTQ5MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2098#discussion_r527245490", "bodyText": "spotless...", "author": "richardstartin", "createdAt": "2020-11-19T22:26:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NDYxOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzUwMjE2MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2098#discussion_r527502160", "bodyText": "So the old code tried to convert a String into a Double, but now we just drop it. Is that intended?", "author": "bantonsson", "createdAt": "2020-11-20T08:00:46Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java", "diffHunk": "@@ -673,6 +674,11 @@ public CoreSpanBuilder asChildOf(final AgentSpan agentSpan) {\n     @Override\n     public CoreSpanBuilder withTag(final String tag, final Object value) {\n       switch (tag) {\n+        case DDTags.ANALYTICS_SAMPLE_RATE:\n+          if (value instanceof Number) {", "originalCommit": "5169cf1d39594bfa8b3a4d4121b3c1590a9f53f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6463532e527a8be53763eec9ae9ee49a12c1fd5a", "chunk": "diff --git a/dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java b/dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java\nindex 1dc4398380..6b2eb744d2 100644\n--- a/dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java\n+++ b/dd-trace-core/src/main/java/datadog/trace/core/CoreTracer.java\n\n@@ -675,9 +675,7 @@ public class CoreTracer implements AgentTracer.TracerAPI {\n     public CoreSpanBuilder withTag(final String tag, final Object value) {\n       switch (tag) {\n         case DDTags.ANALYTICS_SAMPLE_RATE:\n-          if (value instanceof Number) {\n-            analyticsSampleRate = (Number) value;\n-          }\n+          analyticsSampleRate = getOrTryParse(value);\n           break;\n         case DDTags.SPAN_TYPE:\n           if (value instanceof CharSequence) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzUwMjc0Nw==", "url": "https://github.com/DataDog/dd-trace-java/pull/2098#discussion_r527502747", "bodyText": "Here as well...", "author": "bantonsson", "createdAt": "2020-11-20T08:01:28Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java", "diffHunk": "@@ -362,6 +363,11 @@ public void setTag(final String tag, final Object value) {\n           this.spanType = (CharSequence) value;\n         }\n         break;\n+      case ANALYTICS_SAMPLE_RATE:\n+        if (value instanceof Number) {", "originalCommit": "5169cf1d39594bfa8b3a4d4121b3c1590a9f53f6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6463532e527a8be53763eec9ae9ee49a12c1fd5a", "chunk": "diff --git a/dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java b/dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java\nindex 3468b30829..8ea993df46 100644\n--- a/dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java\n+++ b/dd-trace-core/src/main/java/datadog/trace/core/DDSpanContext.java\n\n@@ -364,8 +364,9 @@ public class DDSpanContext implements AgentSpan.Context {\n         }\n         break;\n       case ANALYTICS_SAMPLE_RATE:\n-        if (value instanceof Number) {\n-          setMetric(ANALYTICS_SAMPLE_RATE, (Number) value);\n+        Number analyticsSampleRate = getOrTryParse(value);\n+        if (null != analyticsSampleRate) {\n+          setMetric(ANALYTICS_SAMPLE_RATE, analyticsSampleRate);\n         }\n         break;\n       default:\n"}}, {"oid": "6463532e527a8be53763eec9ae9ee49a12c1fd5a", "url": "https://github.com/DataDog/dd-trace-java/commit/6463532e527a8be53763eec9ae9ee49a12c1fd5a", "message": "remove analytics sample rate rule", "committedDate": "2020-11-20T08:56:03Z", "type": "commit"}, {"oid": "6463532e527a8be53763eec9ae9ee49a12c1fd5a", "url": "https://github.com/DataDog/dd-trace-java/commit/6463532e527a8be53763eec9ae9ee49a12c1fd5a", "message": "remove analytics sample rate rule", "committedDate": "2020-11-20T08:56:03Z", "type": "forcePushed"}]}