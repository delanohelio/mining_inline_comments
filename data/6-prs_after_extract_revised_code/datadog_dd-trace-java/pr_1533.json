{"pr_number": 1533, "pr_title": "Cache byte[] for the last 64 tags", "pr_createdAt": "2020-06-04T10:40:17Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1533", "timeline": [{"oid": "92214502f61ff4012fccd13ea7d5558e90a41357", "url": "https://github.com/DataDog/dd-trace-java/commit/92214502f61ff4012fccd13ea7d5558e90a41357", "message": "Cache byte[] for the last 64 tags", "committedDate": "2020-06-04T10:23:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI2MDgwNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435260804", "bodyText": "Oops, I see misunderstood.  This is covering the value.  Nice.", "author": "dougqh", "createdAt": "2020-06-04T13:38:53Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "diffHunk": "@@ -107,7 +126,21 @@ private static void writeUTF8Tag(final String value, final MessagePacker destina\n         destination.packRawStringHeader(interned.length);\n         destination.addPayload(interned);\n       } else {\n-        destination.packString(value);\n+        byte[] bytes = null;", "originalCommit": "92214502f61ff4012fccd13ea7d5558e90a41357", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1MjQyMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435352420", "bodyText": "When would this ever be null?", "author": "tylerbenson", "createdAt": "2020-06-04T15:34:40Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/serialization/MsgpackFormatWriter.java", "diffHunk": "@@ -107,7 +126,21 @@ private static void writeUTF8Tag(final String value, final MessagePacker destina\n         destination.packRawStringHeader(interned.length);\n         destination.addPayload(interned);\n       } else {\n-        destination.packString(value);\n+        byte[] bytes = null;\n+        if (value.length() > 0) {\n+          try {\n+            bytes = tagCache.get(value);\n+\n+          } catch (ExecutionException e) {\n+            // Something went wrong. We will write out the string the normal way.\n+          }\n+        }\n+        if (bytes != null) {", "originalCommit": "92214502f61ff4012fccd13ea7d5558e90a41357", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM2MjAyNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1533#discussion_r435362024", "bodyText": "If the string is \"\" or if the tagCache.get throws an exception.", "author": "bantonsson", "createdAt": "2020-06-04T15:45:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTM1MjQyMA=="}], "type": "inlineReview", "revised_code": null}]}