{"pr_number": 1482, "pr_title": "Add a context event type support for MLT sampler JFR recording", "pr_createdAt": "2020-05-21T06:39:43Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1482", "timeline": [{"oid": "5abea7a117771fe57e45286ffb14e8475adbdf0a", "url": "https://github.com/DataDog/dd-trace-java/commit/5abea7a117771fe57e45286ffb14e8475adbdf0a", "message": "Add a context event type support for MLT sampler JFR recording", "committedDate": "2020-05-21T06:38:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ4NzY1NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1482#discussion_r428487655", "bodyText": "nit/general interest: is there any way to avoid the capture?", "author": "richardstartin", "createdAt": "2020-05-21T07:20:04Z", "path": "dd-java-agent/agent-profiling/profiling-controller/src/main/java/com/datadog/profiling/mlt/SamplerWriter.java", "diffHunk": "@@ -52,6 +71,26 @@ public void writeThreadSample(ThreadInfo threadInfo) {\n                 }));\n   }\n \n+  private Type registerContextEventType() {\n+    return recording.registerEventType(\n+        CONTEXT_EVENT_NAME,\n+        builder -> {\n+          builder.addField(\"traceId\", Types.Builtin.STRING);\n+        });\n+  }\n+\n+  private TypedValue getThread(Thread thread) {\n+    return recording\n+        .getType(Types.JDK.THREAD)\n+        .asValue(\n+            builder -> {", "originalCommit": "5abea7a117771fe57e45286ffb14e8475adbdf0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUzNTU3MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1482#discussion_r428535571", "bodyText": "Eventually, the answer is yes. In the current implementation it is quite cumbersome, actually.\nSince this 'all-in-java' sampling is going to become the common/fallback implementation we will need to take a look at its perf in the next step.", "author": "jbachorik", "createdAt": "2020-05-21T09:07:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ4NzY1NQ=="}], "type": "inlineReview", "revised_code": null}]}