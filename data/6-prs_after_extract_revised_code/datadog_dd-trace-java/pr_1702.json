{"pr_number": 1702, "pr_title": "MLT - Avoid sending only base stacktrace", "pr_createdAt": "2020-07-22T16:15:08Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1702", "timeline": [{"oid": "2fa5106bd44e1b729d69c7fcc81c151b895b9a69", "url": "https://github.com/DataDog/dd-trace-java/commit/2fa5106bd44e1b729d69c7fcc81c151b895b9a69", "message": "Split ScopeStackCollector part into abstract class", "committedDate": "2020-07-22T15:22:46Z", "type": "commit"}, {"oid": "159896df276c7c4750b65536b2f485fcbe48629f", "url": "https://github.com/DataDog/dd-trace-java/commit/159896df276c7c4750b65536b2f485fcbe48629f", "message": "Avoid adding MLT data if only base stacktrace provided\n\nAlso increase span priority to avoid being discarded.", "committedDate": "2020-07-22T15:57:54Z", "type": "commit"}, {"oid": "70d7a468652bc39ed00d8fcadc57819136b152a7", "url": "https://github.com/DataDog/dd-trace-java/commit/70d7a468652bc39ed00d8fcadc57819136b152a7", "message": "Allow stack iteration from both leaf and root.", "committedDate": "2020-07-22T17:12:11Z", "type": "commit"}, {"oid": "81fa0d59d4728b882719f77c62bdffb2afb0ccc7", "url": "https://github.com/DataDog/dd-trace-java/commit/81fa0d59d4728b882719f77c62bdffb2afb0ccc7", "message": "Use sampling priority as a signal to increase chance of MLT activation.\n\nAlso increase heuristic sampling rate limiter.", "committedDate": "2020-07-22T17:12:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwOTMwMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1702#discussion_r459009301", "bodyText": "Why not just span.getSamplingPriority()?", "author": "randomanderson", "createdAt": "2020-07-22T18:48:41Z", "path": "dd-trace-core/src/main/java/datadog/trace/core/scopemanager/TraceProfilingScopeInterceptor.java", "diffHunk": "@@ -111,6 +112,11 @@ private boolean maybeInteresting(final AgentSpan span) {\n         return true;\n       }\n \n+      if (span.context().getSamplingPriority() == PrioritySampling.USER_KEEP) {\n+        // The trace was manually identified as important, so more likely interesting.\n+        return true;\n+      }", "originalCommit": "81fa0d59d4728b882719f77c62bdffb2afb0ccc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAxMjUyMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1702#discussion_r459012521", "bodyText": "I considered that, and I wanted to avoid a null check... but I just realized that wouldn't be needed.  I'll change it back.", "author": "tylerbenson", "createdAt": "2020-07-22T18:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAwOTMwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "c1890750d4b1ee0e933d4a70892146428aede968", "chunk": "diff --git a/dd-trace-core/src/main/java/datadog/trace/core/scopemanager/TraceProfilingScopeInterceptor.java b/dd-trace-core/src/main/java/datadog/trace/core/scopemanager/TraceProfilingScopeInterceptor.java\nindex c17c530a93..1857532e5a 100644\n--- a/dd-trace-core/src/main/java/datadog/trace/core/scopemanager/TraceProfilingScopeInterceptor.java\n+++ b/dd-trace-core/src/main/java/datadog/trace/core/scopemanager/TraceProfilingScopeInterceptor.java\n\n@@ -112,7 +112,7 @@ public abstract class TraceProfilingScopeInterceptor\n         return true;\n       }\n \n-      if (span.context().getSamplingPriority() == PrioritySampling.USER_KEEP) {\n+      if (span.getSamplingPriority() == PrioritySampling.USER_KEEP) {\n         // The trace was manually identified as important, so more likely interesting.\n         return true;\n       }\n"}}, {"oid": "c1890750d4b1ee0e933d4a70892146428aede968", "url": "https://github.com/DataDog/dd-trace-java/commit/c1890750d4b1ee0e933d4a70892146428aede968", "message": "Use sampling priority as a signal to increase chance of MLT activation.\n\nAlso increase heuristic sampling rate limiter.", "committedDate": "2020-07-22T19:01:11Z", "type": "commit"}, {"oid": "c1890750d4b1ee0e933d4a70892146428aede968", "url": "https://github.com/DataDog/dd-trace-java/commit/c1890750d4b1ee0e933d4a70892146428aede968", "message": "Use sampling priority as a signal to increase chance of MLT activation.\n\nAlso increase heuristic sampling rate limiter.", "committedDate": "2020-07-22T19:01:11Z", "type": "forcePushed"}, {"oid": "cfba71a3cf4e7264c43e2ec33121faf0b5e23f36", "url": "https://github.com/DataDog/dd-trace-java/commit/cfba71a3cf4e7264c43e2ec33121faf0b5e23f36", "message": "It actually does need a null check.\n\nAnd reduce code coverage requirement.", "committedDate": "2020-07-22T19:49:13Z", "type": "forcePushed"}, {"oid": "71162a5be5779302d9c757ee1d2f78efd290b879", "url": "https://github.com/DataDog/dd-trace-java/commit/71162a5be5779302d9c757ee1d2f78efd290b879", "message": "It actually does need a null check.\n\nAnd reduce code coverage requirement.", "committedDate": "2020-07-22T21:00:18Z", "type": "commit"}, {"oid": "71162a5be5779302d9c757ee1d2f78efd290b879", "url": "https://github.com/DataDog/dd-trace-java/commit/71162a5be5779302d9c757ee1d2f78efd290b879", "message": "It actually does need a null check.\n\nAnd reduce code coverage requirement.", "committedDate": "2020-07-22T21:00:18Z", "type": "forcePushed"}]}