{"pr_number": 1780, "pr_title": "Disable collection of user principal by default", "pr_createdAt": "2020-08-17T17:34:21Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1780", "timeline": [{"oid": "391e0d7f8a6ef3e493fab46808378a50ccc56ada", "url": "https://github.com/DataDog/dd-trace-java/commit/391e0d7f8a6ef3e493fab46808378a50ccc56ada", "message": "Disable collection of user principal by default\n\nThis can be considered sensitive to some users, so better to require explicit config to enable.", "committedDate": "2020-08-17T17:32:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTY1MjI4MQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1780#discussion_r471652281", "bodyText": "Reorder these?", "author": "richardstartin", "createdAt": "2020-08-17T17:37:05Z", "path": "dd-java-agent/instrumentation/servlet/request-3/src/main/java/datadog/trace/instrumentation/servlet3/Servlet3Advice.java", "diffHunk": "@@ -75,7 +76,9 @@ public static void stopSpan(\n       @Advice.Thrown final Throwable throwable) {\n     // Set user.principal regardless of who created this span.\n     final Object spanAttr = request.getAttribute(DD_SPAN_ATTRIBUTE);\n-    if (spanAttr instanceof AgentSpan && request instanceof HttpServletRequest) {\n+    if (spanAttr instanceof AgentSpan", "originalCommit": "391e0d7f8a6ef3e493fab46808378a50ccc56ada", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e9db9987048cb34ac1983333ac3d2c4745d4d988", "chunk": "diff --git a/dd-java-agent/instrumentation/servlet/request-3/src/main/java/datadog/trace/instrumentation/servlet3/Servlet3Advice.java b/dd-java-agent/instrumentation/servlet/request-3/src/main/java/datadog/trace/instrumentation/servlet3/Servlet3Advice.java\nindex 1193527ed2..9737127b41 100644\n--- a/dd-java-agent/instrumentation/servlet/request-3/src/main/java/datadog/trace/instrumentation/servlet3/Servlet3Advice.java\n+++ b/dd-java-agent/instrumentation/servlet/request-3/src/main/java/datadog/trace/instrumentation/servlet3/Servlet3Advice.java\n\n@@ -76,9 +76,9 @@ public class Servlet3Advice {\n       @Advice.Thrown final Throwable throwable) {\n     // Set user.principal regardless of who created this span.\n     final Object spanAttr = request.getAttribute(DD_SPAN_ATTRIBUTE);\n-    if (spanAttr instanceof AgentSpan\n-        && request instanceof HttpServletRequest\n-        && Config.get().isServletPrincipalEnabled()) {\n+    if (Config.get().isServletPrincipalEnabled()\n+        && spanAttr instanceof AgentSpan\n+        && request instanceof HttpServletRequest) {\n       final Principal principal = ((HttpServletRequest) request).getUserPrincipal();\n       if (principal != null) {\n         ((AgentSpan) spanAttr).setTag(DDTags.USER_NAME, principal.getName());\n"}}, {"oid": "e9db9987048cb34ac1983333ac3d2c4745d4d988", "url": "https://github.com/DataDog/dd-trace-java/commit/e9db9987048cb34ac1983333ac3d2c4745d4d988", "message": "move config first in the list", "committedDate": "2020-08-17T18:06:42Z", "type": "commit"}]}