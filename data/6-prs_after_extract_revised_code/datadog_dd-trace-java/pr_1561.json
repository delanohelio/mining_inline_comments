{"pr_number": 1561, "pr_title": "disable agent if we may append wrong jar to boot classpath", "pr_createdAt": "2020-06-09T04:23:43Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1561", "timeline": [{"oid": "bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "url": "https://github.com/DataDog/dd-trace-java/commit/bfaef76924fd4d00a8a4d6bf3f16a91b36776354", "message": "disable agent if we may append wrong jar to bootcp", "committedDate": "2020-06-09T04:25:34Z", "type": "forcePushed"}, {"oid": "e675036dc1f9f626f43bdaab5f17fee07e2e8767", "url": "https://github.com/DataDog/dd-trace-java/commit/e675036dc1f9f626f43bdaab5f17fee07e2e8767", "message": "disable agent if we may append wrong jar to bootcp", "committedDate": "2020-06-09T04:27:09Z", "type": "forcePushed"}, {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c", "url": "https://github.com/DataDog/dd-trace-java/commit/000f342dbd773a268f979fd1938ca1b026737f9c", "message": "disable agent if we may append wrong jar to bootcp", "committedDate": "2020-06-09T05:33:17Z", "type": "commit"}, {"oid": "000f342dbd773a268f979fd1938ca1b026737f9c", "url": "https://github.com/DataDog/dd-trace-java/commit/000f342dbd773a268f979fd1938ca1b026737f9c", "message": "disable agent if we may append wrong jar to bootcp", "committedDate": "2020-06-09T05:33:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437457926", "bodyText": "Would this be different if the class was subclassed or something?  Maybe make AgentBootstrap final instead?", "author": "tylerbenson", "createdAt": "2020-06-09T14:16:42Z", "path": "dd-java-agent/src/main/java/datadog/trace/bootstrap/AgentBootstrap.java", "diffHunk": "@@ -40,6 +41,7 @@\n  * </ul>\n  */\n public class AgentBootstrap {\n+  private static final Class<?> thisClass = MethodHandles.lookup().lookupClass();", "originalCommit": "000f342dbd773a268f979fd1938ca1b026737f9c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ3MTU2NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437471564", "bodyText": "No. thisClass field will always return AgentBootstrap.class. All static context is not part of inheritance. That's why Scala separates class and object to avoid this confusion.\nBut we can mark this and by default all classes final: it wouldn't hurt.", "author": "lpriima", "createdAt": "2020-06-09T14:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4MjEyNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437482125", "bodyText": "Ah, I missed that it was static.  So why use MethodHandles instead of AgentBootstrap.class?", "author": "tylerbenson", "createdAt": "2020-06-09T14:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUyNDcyMQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437524721", "bodyText": "thisClass field was to avoid copy paste . But it can be\nprivate static final Class<?> thisClass = AgentBootstrap.class;\nI don't have strong opinion about which version would be better", "author": "lpriima", "createdAt": "2020-06-09T15:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0OTE5NA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437549194", "bodyText": "@tylerbenson Which one you prefer ?", "author": "lpriima", "createdAt": "2020-06-09T16:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU2MDIxMw==", "url": "https://github.com/DataDog/dd-trace-java/pull/1561#discussion_r437560213", "bodyText": "Either is fine with me.", "author": "tylerbenson", "createdAt": "2020-06-09T16:24:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ1NzkyNg=="}], "type": "inlineReview", "revised_code": null}]}