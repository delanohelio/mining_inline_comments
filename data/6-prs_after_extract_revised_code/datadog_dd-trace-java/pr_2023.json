{"pr_number": 2023, "pr_title": "Add internal testing option to exit JVM on advice failure", "pr_createdAt": "2020-10-22T14:23:23Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2023", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwOTgyMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510209820", "bodyText": "Should this be a more interesting exit code than just 1?", "author": "tylerbenson", "createdAt": "2020-10-22T14:30:21Z", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/bytebuddy/ExceptionHandlers.java", "diffHunk": "@@ -70,9 +84,13 @@ public Size apply(final MethodVisitor mv, final Implementation.Context context)\n               mv.visitMethodInsn(\n                   Opcodes.INVOKEINTERFACE,\n                   LOGGER_NAME,\n-                  \"debug\",\n+                  logMethod,\n                   \"(Ljava/lang/String;Ljava/lang/Throwable;)V\",\n                   true);\n+              if (exitOnFailure) {\n+                mv.visitInsn(Opcodes.ICONST_1);", "originalCommit": "76a6a847c702a16b2b6a1e4306066d16baa0f3c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIxMTk2MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510211960", "bodyText": "Have you anything special in mind? I picked 1 since it's defined as Catchall for general errors.", "author": "bantonsson", "createdAt": "2020-10-22T14:33:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwOTgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIyMjU1NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510222555", "bodyText": "Yeah, I understand.  I was just thinking if a program exits with code 1, it can be sometimes tricky to identify the cause.  That said, I don't have strong feelings about this either way.", "author": "tylerbenson", "createdAt": "2020-10-22T14:46:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwOTgyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzOTI4OA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510239288", "bodyText": "I'll leave it as 1 for now. It's just a means to forcefully fail someone else's test if we throw inside an advice.", "author": "bantonsson", "createdAt": "2020-10-22T15:07:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwOTgyMA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "6105285fec5f9bcb61c05f6f37fe5be72775e362", "url": "https://github.com/DataDog/dd-trace-java/commit/6105285fec5f9bcb61c05f6f37fe5be72775e362", "message": "Add internal testing option to exit JVM on advice failure", "committedDate": "2020-10-22T15:56:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNjAxMA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510426010", "bodyText": "Where do you intend to enable this config?", "author": "tylerbenson", "createdAt": "2020-10-22T20:07:40Z", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/bytebuddy/ExceptionHandlers.java", "diffHunk": "@@ -33,13 +34,26 @@ public boolean isValid() {\n             public Size apply(final MethodVisitor mv, final Implementation.Context context) {\n               final String name = context.getInstrumentedType().getName();\n               final ClassLoader classLoader = Thread.currentThread().getContextClassLoader();\n+              final boolean exitOnFailure = Config.get().isInternalExitOnFailure();", "originalCommit": "6105285fec5f9bcb61c05f6f37fe5be72775e362", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDY2NDQyOA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2023#discussion_r510664428", "bodyText": "In the test harness of the other project that I'm testing, to make sure that the types of issues that I first missed while running the play tests will fail the test suite.", "author": "bantonsson", "createdAt": "2020-10-23T06:35:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNjAxMA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "04ae9707728f26ce3c7229899c61e3320db970d8", "url": "https://github.com/DataDog/dd-trace-java/commit/04ae9707728f26ce3c7229899c61e3320db970d8", "message": "Add internal testing option to exit JVM on advice failure", "committedDate": "2020-10-23T08:30:13Z", "type": "commit"}, {"oid": "04ae9707728f26ce3c7229899c61e3320db970d8", "url": "https://github.com/DataDog/dd-trace-java/commit/04ae9707728f26ce3c7229899c61e3320db970d8", "message": "Add internal testing option to exit JVM on advice failure", "committedDate": "2020-10-23T08:30:13Z", "type": "forcePushed"}, {"oid": "cebe8c1f37a6c28cfffec55f8931e7d286b58856", "url": "https://github.com/DataDog/dd-trace-java/commit/cebe8c1f37a6c28cfffec55f8931e7d286b58856", "message": "Make it possible to fork a new JVM for individual test classes", "committedDate": "2020-10-23T12:54:27Z", "type": "commit"}, {"oid": "cebe8c1f37a6c28cfffec55f8931e7d286b58856", "url": "https://github.com/DataDog/dd-trace-java/commit/cebe8c1f37a6c28cfffec55f8931e7d286b58856", "message": "Make it possible to fork a new JVM for individual test classes", "committedDate": "2020-10-23T12:54:27Z", "type": "forcePushed"}]}