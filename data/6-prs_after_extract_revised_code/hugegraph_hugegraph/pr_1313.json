{"pr_number": 1313, "pr_title": "Adapt jraft 1.3.5", "pr_createdAt": "2020-12-25T07:57:02Z", "pr_url": "https://github.com/hugegraph/hugegraph/pull/1313", "timeline": [{"oid": "06f6572f5031b6ce87e8f1b298b564a4adeff886", "url": "https://github.com/hugegraph/hugegraph/commit/06f6572f5031b6ce87e8f1b298b564a4adeff886", "message": "Adapt jraft 1.3.5 and disable wal for raft mode\n\nNOTE: In fact, it still cann't fully adapt to the community version of jraft,\n      because it's different from the rocksdb version that hugegraph relies on\n\nChange-Id: I83079e799df4d332e968694c7aea0ff11bbcdb81", "committedDate": "2020-12-25T07:52:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODg3NjQ2NQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1313#discussion_r548876465", "bodyText": "split into separate commit", "author": "javeme", "createdAt": "2020-12-25T14:04:42Z", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java", "diffHunk": "@@ -683,11 +684,17 @@ public synchronized void destroy() {\n         private WriteOptions writeOptions;\n \n         public StdSession(HugeConfig conf) {\n-            boolean bulkload = conf.get(RocksDBOptions.BULKLOAD_MODE);\n+            boolean raftMode = conf.get(CoreOptions.RAFT_MODE);", "originalCommit": "06f6572f5031b6ce87e8f1b298b564a4adeff886", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c17c1041a3a663003b90258a9a582531b6a778ed", "chunk": "diff --git a/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java b/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\nindex f6788d7d..f4c3baaa 100644\n--- a/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\n+++ b/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\n\n@@ -684,17 +684,11 @@ public class RocksDBStdSessions extends RocksDBSessions {\n         private WriteOptions writeOptions;\n \n         public StdSession(HugeConfig conf) {\n-            boolean raftMode = conf.get(CoreOptions.RAFT_MODE);\n+            boolean bulkload = conf.get(RocksDBOptions.BULKLOAD_MODE);\n             this.batch = new WriteBatch();\n             this.writeOptions = new WriteOptions();\n-            /*\n-             * When work under raft mode. if store crashed, the state-machine\n-             * can restore by snapshot + raft log, doesn't need wal and sync\n-             */\n-            if (raftMode) {\n-                this.writeOptions.setDisableWAL(true);\n-                this.writeOptions.setSync(false);\n-            }\n+            this.writeOptions.setDisableWAL(bulkload);\n+            //this.writeOptions.setSync(false);\n         }\n \n         @Override\n"}}, {"oid": "c17c1041a3a663003b90258a9a582531b6a778ed", "url": "https://github.com/hugegraph/hugegraph/commit/c17c1041a3a663003b90258a9a582531b6a778ed", "message": "move rocksdb disableWAL into another pr\n\nChange-Id: I8878b88acb02369dcb8cc2f57871f88d98bc3203", "committedDate": "2020-12-28T06:19:02Z", "type": "commit"}, {"oid": "c17c1041a3a663003b90258a9a582531b6a778ed", "url": "https://github.com/hugegraph/hugegraph/commit/c17c1041a3a663003b90258a9a582531b6a778ed", "message": "move rocksdb disableWAL into another pr\n\nChange-Id: I8878b88acb02369dcb8cc2f57871f88d98bc3203", "committedDate": "2020-12-28T06:19:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTMwOTE1Nw==", "url": "https://github.com/hugegraph/hugegraph/pull/1313#discussion_r549309157", "bodyText": "remove it", "author": "javeme", "createdAt": "2020-12-28T11:11:08Z", "path": "hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java", "diffHunk": "@@ -65,6 +65,7 @@\n import com.baidu.hugegraph.backend.store.BackendEntry.BackendColumn;\n import com.baidu.hugegraph.backend.store.BackendEntry.BackendColumnIterator;\n import com.baidu.hugegraph.backend.store.BackendEntryIterator;\n+import com.baidu.hugegraph.config.CoreOptions;", "originalCommit": "c17c1041a3a663003b90258a9a582531b6a778ed", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "397ddbc371d99595539aa6e6e0f96759ad173476", "chunk": "diff --git a/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java b/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\nindex f4c3baaa..f9201900 100644\n--- a/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\n+++ b/hugegraph-rocksdb/src/main/java/com/baidu/hugegraph/backend/store/rocksdb/RocksDBStdSessions.java\n\n@@ -65,7 +65,6 @@ import com.baidu.hugegraph.backend.serializer.BinarySerializer;\n import com.baidu.hugegraph.backend.store.BackendEntry.BackendColumn;\n import com.baidu.hugegraph.backend.store.BackendEntry.BackendColumnIterator;\n import com.baidu.hugegraph.backend.store.BackendEntryIterator;\n-import com.baidu.hugegraph.config.CoreOptions;\n import com.baidu.hugegraph.config.HugeConfig;\n import com.baidu.hugegraph.util.Bytes;\n import com.baidu.hugegraph.util.E;\n"}}, {"oid": "397ddbc371d99595539aa6e6e0f96759ad173476", "url": "https://github.com/hugegraph/hugegraph/commit/397ddbc371d99595539aa6e6e0f96759ad173476", "message": "remove redudant import\n\nChange-Id: Id459b0087025d75a13a84791b158d1d093fc3f7b", "committedDate": "2020-12-28T11:13:16Z", "type": "commit"}]}