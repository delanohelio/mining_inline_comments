{"pr_number": 1013, "pr_title": "fix not check last step of count api", "pr_createdAt": "2020-06-02T00:51:53Z", "pr_url": "https://github.com/hugegraph/hugegraph/pull/1013", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMzIyMg==", "url": "https://github.com/hugegraph/hugegraph/pull/1013#discussion_r434323222", "bodyText": "this.count", "author": "javeme", "createdAt": "2020-06-03T05:53:22Z", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java", "diffHunk": "@@ -69,7 +69,8 @@ public long count(Id source, List<Step> steps,\n         if (stepNum == 1) {\n             // Just one step, query count and return\n             count.add(this.edgesCount(source, firstStep.direction,\n-                                      firstStep.labels, firstStep.properties));\n+                                      firstStep.labels, firstStep.properties,", "originalCommit": "0688e38fbf0964d63364b74ce145239332cb9c60", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "86fa3145a326bdea334b991acf037c393ba3a94e", "chunk": "diff --git a/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java b/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\nindex f0bde1ef..c96d3122 100644\n--- a/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\n+++ b/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\n\n@@ -61,17 +61,20 @@ public class CountTraverser extends HugeTraverser {\n         this.containsTraversed = containsTraversed;\n         this.dedupSize = dedupSize;\n         if (this.containsTraversed) {\n-            count.increment();\n+            this.count.increment();\n         }\n \n         int stepNum = steps.size();\n         Step firstStep = steps.get(0);\n         if (stepNum == 1) {\n             // Just one step, query count and return\n-            count.add(this.edgesCount(source, firstStep.direction,\n-                                      firstStep.labels, firstStep.properties,\n-                                      firstStep.degree, firstStep.skipDegree));\n-            return count.longValue();\n+            long edgesCount = this.edgesCount(source, firstStep.direction,\n+                                              firstStep.labels,\n+                                              firstStep.properties,\n+                                              firstStep.degree,\n+                                              firstStep.skipDegree);\n+            this.count.add(edgesCount);\n+            return this.count.longValue();\n         }\n \n         // Multiple steps, construct first step to iterator\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMyMzg0Mg==", "url": "https://github.com/hugegraph/hugegraph/pull/1013#discussion_r434323842", "bodyText": "prefer define a var", "author": "javeme", "createdAt": "2020-06-03T05:55:17Z", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java", "diffHunk": "@@ -93,8 +94,9 @@ public long count(Id source, List<Step> steps,\n             }\n             // Count last layer vertices(without dedup size)\n             this.count.add(this.edgesCount(target, lastStep.direction,\n-                                           lastStep.labels,\n-                                           lastStep.properties));\n+                                           lastStep.labels, lastStep.properties,\n+                                           lastStep.degree,\n+                                           lastStep.skipDegree));", "originalCommit": "0688e38fbf0964d63364b74ce145239332cb9c60", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "86fa3145a326bdea334b991acf037c393ba3a94e", "chunk": "diff --git a/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java b/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\nindex f0bde1ef..c96d3122 100644\n--- a/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\n+++ b/hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java\n\n@@ -93,10 +96,12 @@ public class CountTraverser extends HugeTraverser {\n                 continue;\n             }\n             // Count last layer vertices(without dedup size)\n-            this.count.add(this.edgesCount(target, lastStep.direction,\n-                                           lastStep.labels, lastStep.properties,\n-                                           lastStep.degree,\n-                                           lastStep.skipDegree));\n+            long edgesCount = this.edgesCount(target, lastStep.direction,\n+                                              lastStep.labels,\n+                                              lastStep.properties,\n+                                              lastStep.degree,\n+                                              lastStep.skipDegree);\n+            this.count.add(edgesCount);\n         }\n \n         return this.count.longValue();\n"}}, {"oid": "a31ad190842fb49a0a1119e3f42640d4243e0583", "url": "https://github.com/hugegraph/hugegraph/commit/a31ad190842fb49a0a1119e3f42640d4243e0583", "message": "fix not check last step of count api\n\nChange-Id: Idc61cad83e98924cc69fef79e83b0f8d1eb3dd27", "committedDate": "2020-06-05T06:59:53Z", "type": "commit"}, {"oid": "86fa3145a326bdea334b991acf037c393ba3a94e", "url": "https://github.com/hugegraph/hugegraph/commit/86fa3145a326bdea334b991acf037c393ba3a94e", "message": "improve\n\nChange-Id: Iacf4ed12fd8c30e70b0927024a6a32bd52408e61", "committedDate": "2020-06-05T07:03:13Z", "type": "commit"}, {"oid": "86fa3145a326bdea334b991acf037c393ba3a94e", "url": "https://github.com/hugegraph/hugegraph/commit/86fa3145a326bdea334b991acf037c393ba3a94e", "message": "improve\n\nChange-Id: Iacf4ed12fd8c30e70b0927024a6a32bd52408e61", "committedDate": "2020-06-05T07:03:13Z", "type": "forcePushed"}]}