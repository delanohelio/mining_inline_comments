{"pr_number": 1134, "pr_title": "fix delete/read without READ permission throw 'no such id' ", "pr_createdAt": "2020-08-06T17:16:36Z", "pr_url": "https://github.com/hugegraph/hugegraph/pull/1134", "timeline": [{"oid": "f9cfd0ca6acb4ee53087815774a72761ee44afc6", "url": "https://github.com/hugegraph/hugegraph/commit/f9cfd0ca6acb4ee53087815774a72761ee44afc6", "message": "fix delete/read without READ permission throw 'no such id'\n\nthis patch define delete/update requires read permission, an ForbiddenException\nis thrown when there is no read permission instead 'No such vertex with id: xx'.\n\nalso fix rest api depend on gremlin permission, updated to not depend on gremlin.\n\nChange-Id: I0d8cfd3d4b7d8ccaf10721249f8d9f86b53b442e", "committedDate": "2020-08-06T17:11:45Z", "type": "commit"}, {"oid": "502cb7b10b816552b1aa4a63e16a3160c8eedd59", "url": "https://github.com/hugegraph/hugegraph/commit/502cb7b10b816552b1aa4a63e16a3160c8eedd59", "message": "unify exception message\n\nChange-Id: Ia30ff97b073bd2b15599cc4e1cbac5ed7b651063", "committedDate": "2020-08-06T17:11:45Z", "type": "commit"}, {"oid": "2a04c020adcef48847d3b9470f807027ac63300f", "url": "https://github.com/hugegraph/hugegraph/commit/2a04c020adcef48847d3b9470f807027ac63300f", "message": "fix unit test\n\nChange-Id: I1adf25c68bd0eb2157b17fd9466171ec9e237de7", "committedDate": "2020-08-06T17:11:45Z", "type": "commit"}, {"oid": "6a3edcdc2784fd453d305d49dc6a4012f1dcf716", "url": "https://github.com/hugegraph/hugegraph/commit/6a3edcdc2784fd453d305d49dc6a4012f1dcf716", "message": "fix expired time is inaccurate due to call now before tx begin\n\nChange-Id: I08f536b75228c44a1af1c588336df9a1ceea8406", "committedDate": "2020-08-06T17:11:46Z", "type": "commit"}, {"oid": "591e22f6f1dbb3fa0f703efe5c4e210e0549f7cc", "url": "https://github.com/hugegraph/hugegraph/commit/591e22f6f1dbb3fa0f703efe5c4e210e0549f7cc", "message": "refactor edgesOfVertex() to unified entrance with EdgeStep\n\nChange-Id: If55f532fb2c08b664e3ea816832741096fb767c4", "committedDate": "2020-08-06T17:11:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNDc4Mw==", "url": "https://github.com/hugegraph/hugegraph/pull/1134#discussion_r466804783", "bodyText": "olap task may run not in grizzly-http-server thread", "author": "zhoney", "createdAt": "2020-08-07T03:46:55Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/auth/HugeGraphAuthProxy.java", "diffHunk": "@@ -1372,8 +1389,21 @@ public void applyStrategies(Admin<?, ?> traversal) {\n                 script = translator.translate(traversal.getBytecode());\n             }\n \n-            verifyNamePermission(HugePermission.EXECUTE,\n-                                 ResourceType.GREMLIN, script);\n+            /*\n+             * Verify gremlin-execute permission for user gremlin(in gremlin-\n+             * server-exec worker) and gremlin job(in task worker).\n+             * But don't check permission in rest worker, because the following\n+             * places need to call traversal():\n+             *  1.vertices/edges rest api\n+             *  2.oltp rest api (like crosspointpath/neighborrank)\n+             *  3.olap rest api (like centrality/lpa/louvain/subgraph)\n+             */\n+            String caller = Thread.currentThread().getName();", "originalCommit": "591e22f6f1dbb3fa0f703efe5c4e210e0549f7cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgzOTA3NQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1134#discussion_r466839075", "bodyText": "yes olap may run in task worker or olap thread, but currently we can't distinguish gremlin job and olap job", "author": "javeme", "createdAt": "2020-08-07T06:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNDc4Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNTA1Mg==", "url": "https://github.com/hugegraph/hugegraph/pull/1134#discussion_r466805052", "bodyText": "object", "author": "zhoney", "createdAt": "2020-08-07T03:48:07Z", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -467,6 +462,11 @@ public void removeEdge(Edge edge) {\n         this.graphTransaction().removeEdgeProperty((HugeEdgeProperty<V>) p);\n     }\n \n+    @Override\n+    public Vertex vertex(Object objects) {", "originalCommit": "591e22f6f1dbb3fa0f703efe5c4e210e0549f7cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c9872cb3b0e1f9af614f4a155673b65d8237f0b", "chunk": "diff --git a/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java b/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\nindex 1d3cb62a..c5553465 100644\n--- a/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\n+++ b/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\n\n@@ -463,8 +463,8 @@ public class StandardHugeGraph implements HugeGraph {\n     }\n \n     @Override\n-    public Vertex vertex(Object objects) {\n-        return this.graphTransaction().queryVertex(objects);\n+    public Vertex vertex(Object object) {\n+        return this.graphTransaction().queryVertex(object);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNTA5MA==", "url": "https://github.com/hugegraph/hugegraph/pull/1134#discussion_r466805090", "bodyText": "ditto", "author": "zhoney", "createdAt": "2020-08-07T03:48:17Z", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java", "diffHunk": "@@ -490,6 +490,11 @@ public boolean checkAdjacentVertexExist() {\n         return this.graphTransaction().checkAdjacentVertexExist();\n     }\n \n+    @Override\n+    public Edge edge(Object objects) {", "originalCommit": "591e22f6f1dbb3fa0f703efe5c4e210e0549f7cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8c9872cb3b0e1f9af614f4a155673b65d8237f0b", "chunk": "diff --git a/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java b/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\nindex 1d3cb62a..c5553465 100644\n--- a/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\n+++ b/hugegraph-core/src/main/java/com/baidu/hugegraph/StandardHugeGraph.java\n\n@@ -491,8 +491,8 @@ public class StandardHugeGraph implements HugeGraph {\n     }\n \n     @Override\n-    public Edge edge(Object objects) {\n-        return this.graphTransaction().queryEdge(objects);\n+    public Edge edge(Object object) {\n+        return this.graphTransaction().queryEdge(object);\n     }\n \n     @Override\n"}}, {"oid": "8c9872cb3b0e1f9af614f4a155673b65d8237f0b", "url": "https://github.com/hugegraph/hugegraph/commit/8c9872cb3b0e1f9af614f4a155673b65d8237f0b", "message": "fix test sameAs() mock\n\nChange-Id: I303482a631e25834f7e56d2d44248f9097eec778", "committedDate": "2020-08-07T06:00:57Z", "type": "commit"}]}