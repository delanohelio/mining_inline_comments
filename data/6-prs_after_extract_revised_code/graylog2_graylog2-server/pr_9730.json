{"pr_number": 9730, "pr_title": "Server changes for custom user management", "pr_createdAt": "2020-12-09T10:10:20Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9730", "timeline": [{"oid": "8a0e88788cea94bcfeb9131f9e7300eda83ea1c2", "url": "https://github.com/Graylog2/graylog2-server/commit/8a0e88788cea94bcfeb9131f9e7300eda83ea1c2", "message": "Add optional UserService binding", "committedDate": "2020-12-03T14:20:33Z", "type": "commit"}, {"oid": "a98a8c0e72cecb12d95162d65e548229ad9a3680", "url": "https://github.com/Graylog2/graylog2-server/commit/a98a8c0e72cecb12d95162d65e548229ad9a3680", "message": "Add UserManagementService interface", "committedDate": "2020-12-09T10:01:17Z", "type": "commit"}, {"oid": "007936d1b347a8e517751498d9cf4ed2e9759609", "url": "https://github.com/Graylog2/graylog2-server/commit/007936d1b347a8e517751498d9cf4ed2e9759609", "message": "Adjustments to ProvisionerService to support custom auth provider CRUD operations", "committedDate": "2020-12-09T10:02:26Z", "type": "commit"}, {"oid": "34e4485f18c9d7e75d67b707d15e501ef5924634", "url": "https://github.com/Graylog2/graylog2-server/commit/34e4485f18c9d7e75d67b707d15e501ef5924634", "message": "Input validation improvements", "committedDate": "2020-12-09T14:48:32Z", "type": "commit"}, {"oid": "9718abe8e36ad6a79632449632ba2b1f726e0ad9", "url": "https://github.com/Graylog2/graylog2-server/commit/9718abe8e36ad6a79632449632ba2b1f726e0ad9", "message": "Merge branch 'cloud-4.0' of github.com:Graylog2/graylog2-server into cloud-4.0", "committedDate": "2020-12-11T09:13:01Z", "type": "commit"}, {"oid": "c506bb4dda20fbdbfe8f8ac7e993898b960058f5", "url": "https://github.com/Graylog2/graylog2-server/commit/c506bb4dda20fbdbfe8f8ac7e993898b960058f5", "message": "Merge branch 'cloud-4.0' into cloud/issue-555", "committedDate": "2020-12-11T09:13:19Z", "type": "commit"}, {"oid": "94b894ea3992a862d314726511a6f4cfc6b09798", "url": "https://github.com/Graylog2/graylog2-server/commit/94b894ea3992a862d314726511a6f4cfc6b09798", "message": "Implement enable/disable user flow", "committedDate": "2020-12-14T14:51:57Z", "type": "commit"}, {"oid": "4aae0df447adcaf890c5094ebb7facd9edd55439", "url": "https://github.com/Graylog2/graylog2-server/commit/4aae0df447adcaf890c5094ebb7facd9edd55439", "message": "Fix order of tabs in dashboard after install (#9812)\n\n## Motivation\r\nPrior to this change, a dashboard installed by a content pack had a\r\ntabs in a random order. Since we cannot change the order of the tabs\r\nthis is quite inconvinient for the user.\r\n\r\n## Description\r\nThis change will do mutiple steps to fix that:\r\n- Use a LinkedHashMap to ensure the order stays fix during content pack\r\n  creation.\r\n- Instead of using the serach QueryIds we use the views QueryIds which\r\n  we previously fixed in the order.\r\n- When loading a view and selecting the activeQuery we also use the\r\n  view.state queryids instead of the search ones.\r\n\r\nFixes #8264", "committedDate": "2020-12-16T13:33:28Z", "type": "commit"}, {"oid": "c17deab5a3291ffd4d3fdf68479e290f0e6bdfed", "url": "https://github.com/Graylog2/graylog2-server/commit/c17deab5a3291ffd4d3fdf68479e290f0e6bdfed", "message": "Implement Change Password user flow", "committedDate": "2020-12-16T13:51:55Z", "type": "commit"}, {"oid": "8522cc3fd5b95a27b93179841916e81a2180914b", "url": "https://github.com/Graylog2/graylog2-server/commit/8522cc3fd5b95a27b93179841916e81a2180914b", "message": "Show timezone setting to the user (#9814)\n\n* Display the timezone settings to the user\r\n\r\n## Motivation\r\nPrior to this change, the user was not able to change his own timezone\r\nsettings since they were hidden to him.\r\n\r\n## Description\r\nThis change will show the settings to the user so he can edit them.\r\n\r\n* Fix settings section test", "committedDate": "2020-12-17T12:18:57Z", "type": "commit"}, {"oid": "c0ef912674952d88e0918e0bea818b066fcdd6d7", "url": "https://github.com/Graylog2/graylog2-server/commit/c0ef912674952d88e0918e0bea818b066fcdd6d7", "message": "Add common Okta version to parent POM", "committedDate": "2020-12-17T13:30:43Z", "type": "commit"}, {"oid": "8d61719b37a3e48abd58e52220694656b43e19e3", "url": "https://github.com/Graylog2/graylog2-server/commit/8d61719b37a3e48abd58e52220694656b43e19e3", "message": "Add common Okta version to parent POM", "committedDate": "2020-12-17T13:46:53Z", "type": "commit"}, {"oid": "64a8a38830f94d5457e3fa870c2d3b088843230e", "url": "https://github.com/Graylog2/graylog2-server/commit/64a8a38830f94d5457e3fa870c2d3b088843230e", "message": "Merge branch 'cloud-4.0' into cloud/issue-555", "committedDate": "2020-12-17T13:47:03Z", "type": "commit"}, {"oid": "b890dd14aee7c1b75b3e0e13171f7affacc6fca9", "url": "https://github.com/Graylog2/graylog2-server/commit/b890dd14aee7c1b75b3e0e13171f7affacc6fca9", "message": "Cleanup", "committedDate": "2020-12-18T14:54:34Z", "type": "commit"}, {"oid": "4d8295d3ca417309befd8bc7f64a5ad0189f7ef2", "url": "https://github.com/Graylog2/graylog2-server/commit/4d8295d3ca417309befd8bc7f64a5ad0189f7ef2", "message": "Merge branch '4.0' into cloud/issue-555", "committedDate": "2021-01-04T15:40:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY2NzI1OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9730#discussion_r552667259", "bodyText": "I've been wondering about naming this..\nWe currently have different flags for user accounts:\n\nisReadOnly for internal system users that shouldn't be deleted or modified\nisExternal  for users that shouldn't be managed from within graylog  (except for our cloud okta use case)\n\nWould it make sense to add a third flag (e.g. isManaged) or should we simply mark okta users as not external?\nIt's probably not a big deal, just a thought..", "author": "mpfz0r", "createdAt": "2021-01-06T14:34:08Z", "path": "graylog2-server/src/main/java/org/graylog/security/authservice/UserDetails.java", "diffHunk": "@@ -43,6 +43,8 @@\n \n     public abstract String fullName();\n \n+    public abstract boolean isExternal();", "originalCommit": "4d8295d3ca417309befd8bc7f64a5ad0189f7ef2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjgwOTI3Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/9730#discussion_r552809272", "bodyText": "OTOH, from the cloud perspective, Okta is still kind of \"internal\", so maybe we should just leave it like it is :)", "author": "mpfz0r", "createdAt": "2021-01-06T16:59:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY2NzI1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDk0NDUyOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/9730#discussion_r554944529", "bodyText": "Thanks for the feedback @mpfz0r. Here's some of the thinking behind adding this property here, incase that helps the discussion:\nThe current definition for external users (as I understand) is that they exist in another system of record and are not permitted to be edited in Graylog. Okta users do not fall into this category, since they can be edited in Graylog. The intention of adding the isExternal flag to UserDetails is to allow the ProvisionerService to provision users with this flag set to false (the Okta case). The UserDetails object is just a means of sending user data into the ProvisionerService.\nI did not yet have any plan to add any properties to the UserImpl persisted DB object, but happy to look at that further if you think we should identify the Okta users somehow.", "author": "danotorrey", "createdAt": "2021-01-11T10:20:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY2NzI1OQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "3eee5aada4e767a8b55f6d66d1b5702eee954455", "url": "https://github.com/Graylog2/graylog2-server/commit/3eee5aada4e767a8b55f6d66d1b5702eee954455", "message": "Cloud user management integration (#9868)\n\n* Integrate cloud username and password\r\n\r\n - Use cloud username (combine usename and email for okta)\r\n - use validateCloudPasswords for cloud password\r\n\r\n* rename UsernameFormGroup\r\n\r\n* Parse and display okta error message\r\n\r\n* Update edit form for cloud\r\n\r\n* Remove unused import\r\n\r\n* Fix review comments\r\n\r\n* Fix review comments\r\n\r\n- Separate username and password\r\n- move cloudPlugin up\r\n\r\n* Fix review comments\r\n\r\n - separate username and email group\r\n\r\n* Add password edit validations", "committedDate": "2021-01-12T13:54:11Z", "type": "commit"}, {"oid": "88ab01b8cf85c43ae799e735a92748486521a176", "url": "https://github.com/Graylog2/graylog2-server/commit/88ab01b8cf85c43ae799e735a92748486521a176", "message": "Remove unneeded Okta SDK version\n\nThe Cloud Okta User Management feature is no longer using the Okta SDK, so we do not need the Okta SDK version specified here.", "committedDate": "2021-01-26T14:08:10Z", "type": "commit"}, {"oid": "5b5334ca9ec875782c81b2525457483f212bcdc1", "url": "https://github.com/Graylog2/graylog2-server/commit/5b5334ca9ec875782c81b2525457483f212bcdc1", "message": "Merge branch 'cloud-4.0' into cloud/issue-555", "committedDate": "2021-02-01T09:31:37Z", "type": "commit"}]}