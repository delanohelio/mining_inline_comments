{"pr_number": 7306, "pr_title": "Change color chart from Map to List of Value Class ", "pr_createdAt": "2020-01-28T08:41:04Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7306", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY3NjUxMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#discussion_r371676511", "bodyText": "IMO the previous naming (chartColors) was slightly better.", "author": "dennisoelkers", "createdAt": "2020-01-28T09:02:49Z", "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java", "diffHunk": "@@ -22,27 +22,27 @@\n import com.google.auto.value.AutoValue;\n \n import java.util.Collections;\n-import java.util.Map;\n+import java.util.List;\n \n @AutoValue\n @JsonDeserialize(builder = WidgetFormattingSettings.Builder.class)\n public abstract class WidgetFormattingSettings {\n     private static final String FIELD_CHART_COLORS = \"chart_colors\";\n \n     @JsonProperty(FIELD_CHART_COLORS)\n-    public abstract Map<String, ChartColor> chartColors();\n+    public abstract List<ChartColorSetting> chartColorSettings();", "originalCommit": "ba58a5fffa0488c9fd734e1b5fbbeceff343b8d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bf1209e9a256fe3be8c63fd5d34eac6ca171b98a", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java b/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java\nindex 0148a0913c..92f7530253 100644\n--- a/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java\n+++ b/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/WidgetFormattingSettings.java\n\n@@ -30,19 +30,19 @@ public abstract class WidgetFormattingSettings {\n     private static final String FIELD_CHART_COLORS = \"chart_colors\";\n \n     @JsonProperty(FIELD_CHART_COLORS)\n-    public abstract List<ChartColorSetting> chartColorSettings();\n+    public abstract List<ChartColorMapping> chartColors();\n \n     @AutoValue.Builder\n     public static abstract class Builder {\n         @JsonProperty(FIELD_CHART_COLORS)\n-        public abstract Builder chartColorSettings(List<ChartColorSetting> chartColorSettings);\n+        public abstract Builder chartColors(List<ChartColorMapping> chartColors);\n \n         public abstract WidgetFormattingSettings build();\n \n         @JsonCreator\n         static Builder builder() {\n             return new AutoValue_WidgetFormattingSettings.Builder()\n-                    .chartColorSettings(Collections.emptyList());\n+                    .chartColors(Collections.emptyList());\n         }\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY3NjY5Mg==", "url": "https://github.com/Graylog2/graylog2-server/pull/7306#discussion_r371676692", "bodyText": "Maybe ChartColorMapping captures the purpose of this class better?", "author": "dennisoelkers", "createdAt": "2020-01-28T09:03:17Z", "path": "graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package org.graylog.plugins.views.search.views.widgets.aggregation;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import com.google.auto.value.AutoValue;\n+\n+@AutoValue\n+@JsonDeserialize(builder = ChartColorSetting.Builder.class)\n+public abstract class ChartColorSetting {", "originalCommit": "ba58a5fffa0488c9fd734e1b5fbbeceff343b8d6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f1846ae2412022fe66f71683760eff2143a426e4", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java b/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java\nindex 56d53f29ad..bf3138a86c 100644\n--- a/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java\n+++ b/graylog2-server/src/main/java/org/graylog/plugins/views/search/views/widgets/aggregation/ChartColorSetting.java\n\n@@ -1,3 +1,19 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n package org.graylog.plugins.views.search.views.widgets.aggregation;\n \n import com.fasterxml.jackson.annotation.JsonCreator;\n"}}, {"oid": "e89841b86f1ecce5b54011f6c5caf3d502bf3147", "url": "https://github.com/Graylog2/graylog2-server/commit/e89841b86f1ecce5b54011f6c5caf3d502bf3147", "message": "Change data structure in WidgetFormattingSetting\n\nPrior to this change, the data structure to store\nWidgetFormattingSettings did use the \"user input\" for storing a map.\nBut mongodb does not allow to store keys with dot in the map.\n\nThis change will change the data structure from a map to a list\nof objects. That way mongodb does not need to store the keys.", "committedDate": "2020-01-28T10:22:05Z", "type": "commit"}, {"oid": "6543da1b6cf704001461e7cf5dafdd9034044916", "url": "https://github.com/Graylog2/graylog2-server/commit/6543da1b6cf704001461e7cf5dafdd9034044916", "message": "Migrate existing data structures for color charts\n\nPrior to this change, we changed the data structure of color charts\nfrom a generic Map to auto value classes. This change prevents\nexisting installations to run.\n\nThis change will migrate the existing datastructures in the mongodb\nto the new auto value classes.", "committedDate": "2020-01-28T10:22:05Z", "type": "commit"}, {"oid": "f1846ae2412022fe66f71683760eff2143a426e4", "url": "https://github.com/Graylog2/graylog2-server/commit/f1846ae2412022fe66f71683760eff2143a426e4", "message": "Add missing licenses", "committedDate": "2020-01-28T10:22:05Z", "type": "commit"}, {"oid": "bf1209e9a256fe3be8c63fd5d34eac6ca171b98a", "url": "https://github.com/Graylog2/graylog2-server/commit/bf1209e9a256fe3be8c63fd5d34eac6ca171b98a", "message": "Fix annotations from @dennisoelkers", "committedDate": "2020-01-28T10:22:05Z", "type": "commit"}, {"oid": "297a7aa00e5498d25f92c0bb4a38878eb9aca785", "url": "https://github.com/Graylog2/graylog2-server/commit/297a7aa00e5498d25f92c0bb4a38878eb9aca785", "message": "Add more tests", "committedDate": "2020-01-28T10:22:05Z", "type": "commit"}, {"oid": "297a7aa00e5498d25f92c0bb4a38878eb9aca785", "url": "https://github.com/Graylog2/graylog2-server/commit/297a7aa00e5498d25f92c0bb4a38878eb9aca785", "message": "Add more tests", "committedDate": "2020-01-28T10:22:05Z", "type": "forcePushed"}]}