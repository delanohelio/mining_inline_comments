{"pr_number": 8619, "pr_title": "Expose GRNPermissions to frontend", "pr_createdAt": "2020-07-24T14:25:52Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8619", "timeline": [{"oid": "38818ca88d39e5c30ecce78195699733485072cf", "url": "https://github.com/Graylog2/graylog2-server/commit/38818ca88d39e5c30ecce78195699733485072cf", "message": "Expose GRNPermissions to frontend\n\nThe frontend needs to know which entities a user\ncurrently owns. This is expressed with a new Permissions\ntype, that is incompatible with the existing WildcardPermission.\n\nIntroduce a new field `grn_permissions` into the UserSummary object.\n\nThe serialized format of a GRNPermission is\n\n`<permission>|<grn>`\n\ne.g.: `entity:own|grn::::dashboard:5e2afc66cd19517ec2dabaf3`\n\nFixes #8603", "committedDate": "2020-07-24T14:21:04Z", "type": "commit"}, {"oid": "3b590eaabd549820b46e1cb4c5ed6d1924defd6c", "url": "https://github.com/Graylog2/graylog2-server/commit/3b590eaabd549820b46e1cb4c5ed6d1924defd6c", "message": "Merge remote-tracking branch 'origin/feature/permissions' into export-ownership-to-frontend", "committedDate": "2020-07-28T15:31:52Z", "type": "commit"}, {"oid": "a09364a8d67634c149ae5492dadd7869747b4a22", "url": "https://github.com/Graylog2/graylog2-server/commit/a09364a8d67634c149ae5492dadd7869747b4a22", "message": "Use @JsonValue for GRNPermission serialization\n\nDon't use | as a seperator between permission type and target", "committedDate": "2020-07-28T16:11:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNDIyMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8619#discussion_r463034221", "bodyText": "How about creating UserService#getWildcardPermissionsForUser and UserService#getGRNPermissionsForUser to avoid duplication of this code block in RolesResource?", "author": "bernd", "createdAt": "2020-07-30T14:23:55Z", "path": "graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java", "diffHunk": "@@ -609,13 +611,25 @@ private UserSummary toUserResponse(User user,\n             lastActivity = session.getLastAccessTime();\n             clientAddress = session.getHost();\n         }\n+        List<WildcardPermission> wildcardPermissions;\n+        List<GRNPermission> grnPermissions;\n+        if (includePermissions) {\n+            wildcardPermissions = userService.getPermissionsForUser(user).stream()", "originalCommit": "a09364a8d67634c149ae5492dadd7869747b4a22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2OTQ3MQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8619#discussion_r463469471", "bodyText": "good point. will do \ud83d\udc4d", "author": "mpfz0r", "createdAt": "2020-07-31T08:13:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAzNDIyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "b8f38179ff065e3e0c45151b0361e3958c332aee", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java b/graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java\nindex e2f042933f..2a19b291ff 100644\n--- a/graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java\n+++ b/graylog2-server/src/main/java/org/graylog2/rest/resources/users/UsersResource.java\n\n@@ -614,10 +614,8 @@ public class UsersResource extends RestResource {\n         List<WildcardPermission> wildcardPermissions;\n         List<GRNPermission> grnPermissions;\n         if (includePermissions) {\n-            wildcardPermissions = userService.getPermissionsForUser(user).stream()\n-                    .filter(WildcardPermission.class::isInstance).map(WildcardPermission.class::cast).collect(Collectors.toList());\n-            grnPermissions = userService.getPermissionsForUser(user).stream()\n-                    .filter(GRNPermission.class::isInstance).map(GRNPermission.class::cast).collect(Collectors.toList());\n+            wildcardPermissions = userService.getWildcardPermissionsForUser(user);\n+            grnPermissions = userService.getGRNPermissionsForUser(user);\n         } else {\n             wildcardPermissions = ImmutableList.of();\n             grnPermissions = ImmutableList.of();\n"}}, {"oid": "a80f8fcb9eba15a55f18c95add5fac1706a517d8", "url": "https://github.com/Graylog2/graylog2-server/commit/a80f8fcb9eba15a55f18c95add5fac1706a517d8", "message": "Merge remote-tracking branch 'origin/feature/permissions' into export-ownership-to-frontend", "committedDate": "2020-07-31T07:56:14Z", "type": "commit"}, {"oid": "b8f38179ff065e3e0c45151b0361e3958c332aee", "url": "https://github.com/Graylog2/graylog2-server/commit/b8f38179ff065e3e0c45151b0361e3958c332aee", "message": "Reduce some code duplication\n\nIdea from bernd@", "committedDate": "2020-07-31T09:35:00Z", "type": "commit"}, {"oid": "ba545368dc1deb1d950dce91be46349fef4d8381", "url": "https://github.com/Graylog2/graylog2-server/commit/ba545368dc1deb1d950dce91be46349fef4d8381", "message": "Add test to ensure UserSummary REST result doesn't change", "committedDate": "2020-07-31T09:38:17Z", "type": "commit"}]}