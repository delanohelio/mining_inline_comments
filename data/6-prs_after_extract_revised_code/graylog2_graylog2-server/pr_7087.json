{"pr_number": 7087, "pr_title": "Add Listfield option in ConfigurationRequest", "pr_createdAt": "2020-01-06T15:38:32Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/7087", "timeline": [{"oid": "b307029ecb8f9ab0dcd660627e131998efea8d66", "url": "https://github.com/Graylog2/graylog2-server/commit/b307029ecb8f9ab0dcd660627e131998efea8d66", "message": "Add Listfield option in ConfigurationRequest", "committedDate": "2020-01-06T15:32:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM3ODEyNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363378127", "bodyText": "This will break the TextField.LIST_TYPE case, because it now also returns on the break. We need to implement a separate case for ListField.FIELD_TYPE that also sets the list value like the DropdownField.FIELD_TYPE does. (just for lists) This probably needs a listIsSet(String) method implementation in org.graylog2.plugin.configuration.Configuration.", "author": "bernd", "createdAt": "2020-01-06T16:45:17Z", "path": "graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java", "diffHunk": "@@ -150,6 +152,8 @@ public Configuration filter(Configuration config) {\n                     }\n                     break;\n                 case TextField.FIELD_TYPE:\n+                case ListField.FIELD_TYPE:\n+                    break;", "originalCommit": "b307029ecb8f9ab0dcd660627e131998efea8d66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM5MTg0Mw==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363391843", "bodyText": "oh okay. will add method.", "author": "cobaltclaudia", "createdAt": "2020-01-06T17:16:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM3ODEyNw=="}], "type": "inlineReview", "revised_code": {"commit": "5ae7395d548b1a408ea5a610d30d3ac32b4742b2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\nindex 17bdd5b5be..9572bb51cc 100644\n--- a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n+++ b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n\n@@ -152,7 +158,11 @@ public class ConfigurationRequest {\n                     }\n                     break;\n                 case TextField.FIELD_TYPE:\n+                    break;\n                 case ListField.FIELD_TYPE:\n+                    if(config.listIsSet(name)){\n+                        values.put(name,config.getList(name));\n+                    }\n                     break;\n                 case DropdownField.FIELD_TYPE:\n                     if (config.stringIsSet(name)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzM3ODg5Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363378896", "bodyText": "We also need to add a case for ListField.FIELD_TYPE in the check() method in this class.", "author": "bernd", "createdAt": "2020-01-06T16:46:55Z", "path": "graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java", "diffHunk": "@@ -150,6 +152,8 @@ public Configuration filter(Configuration config) {\n                     }\n                     break;\n                 case TextField.FIELD_TYPE:\n+                case ListField.FIELD_TYPE:", "originalCommit": "b307029ecb8f9ab0dcd660627e131998efea8d66", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ae7395d548b1a408ea5a610d30d3ac32b4742b2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\nindex 17bdd5b5be..9572bb51cc 100644\n--- a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n+++ b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n\n@@ -152,7 +158,11 @@ public class ConfigurationRequest {\n                     }\n                     break;\n                 case TextField.FIELD_TYPE:\n+                    break;\n                 case ListField.FIELD_TYPE:\n+                    if(config.listIsSet(name)){\n+                        values.put(name,config.getList(name));\n+                    }\n                     break;\n                 case DropdownField.FIELD_TYPE:\n                     if (config.stringIsSet(name)) {\n"}}, {"oid": "5ae7395d548b1a408ea5a610d30d3ac32b4742b2", "url": "https://github.com/Graylog2/graylog2-server/commit/5ae7395d548b1a408ea5a610d30d3ac32b4742b2", "message": "Add listIsSet and listfield check", "committedDate": "2020-01-06T17:40:59Z", "type": "commit"}, {"oid": "1594a4e870c11fd277167692b53bb36129a4b09f", "url": "https://github.com/Graylog2/graylog2-server/commit/1594a4e870c11fd277167692b53bb36129a4b09f", "message": "Add unit test for ListField", "committedDate": "2020-01-07T02:54:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcyMTc1OQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363721759", "bodyText": "This needs to check if the list for the given key is set. The current code is checking if the map of lists is empty or not. So this needs to be something along the lines of:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return !lists.isEmpty();\n          \n          \n            \n                    return lists.containsKey(key);", "author": "bernd", "createdAt": "2020-01-07T12:17:06Z", "path": "graylog2-server/src/main/java/org/graylog2/plugin/configuration/Configuration.java", "diffHunk": "@@ -138,6 +138,10 @@ public void setBoolean(String key, boolean value) {\n         return firstNonNull(lists.get(key), defaultValue);\n     }\n \n+    public boolean listIsSet(String key) {\n+        return !lists.isEmpty();", "originalCommit": "1594a4e870c11fd277167692b53bb36129a4b09f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1f039e1502c56eb9b9b0926df58538c7856dc9a2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/Configuration.java b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/Configuration.java\nindex 4f912c0ef3..7de5042e83 100644\n--- a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/Configuration.java\n+++ b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/Configuration.java\n\n@@ -139,7 +139,7 @@ public class Configuration implements Serializable {\n     }\n \n     public boolean listIsSet(String key) {\n-        return !lists.isEmpty();\n+        return lists.containsKey(key);\n     }\n \n     @Nullable\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcyMjQ4MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363722480", "bodyText": "This breaks the TextField.FIELD_TYPE. Before this PR, the TextField and DropdownField used the same implementation. (by relying on the fallthrough property of the switch case) This needs to stay the way it was before.", "author": "bernd", "createdAt": "2020-01-07T12:19:20Z", "path": "graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java", "diffHunk": "@@ -113,6 +115,12 @@ public void check(Configuration configuration) throws ConfigurationException {\n                         }\n                         break;\n                     case TextField.FIELD_TYPE:\n+                        break;", "originalCommit": "1594a4e870c11fd277167692b53bb36129a4b09f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1f039e1502c56eb9b9b0926df58538c7856dc9a2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\nindex 9572bb51cc..55c5861e1f 100644\n--- a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n+++ b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n\n@@ -115,12 +115,10 @@ public class ConfigurationRequest {\n                         }\n                         break;\n                     case TextField.FIELD_TYPE:\n-                        break;\n                     case ListField.FIELD_TYPE:\n                         if (!configuration.listIsSet(fieldName)) {\n                             throw new ConfigurationException(\"Mandatory configuration field \\\"\" + fieldName + \"\\\" is missing or has the wrong data type\");\n                         }\n-                        break;\n                     case DropdownField.FIELD_TYPE:\n                         if (!configuration.stringIsSet(fieldName)) {\n                             throw new ConfigurationException(\"Mandatory configuration field \\\"\" + fieldName + \"\\\" is missing or has the wrong data type\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzcyMjYxOQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/7087#discussion_r363722619", "bodyText": "Same as above, the fallthrough for the DropdownField implementation needs to stay for the TextField.", "author": "bernd", "createdAt": "2020-01-07T12:19:50Z", "path": "graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java", "diffHunk": "@@ -150,6 +158,12 @@ public Configuration filter(Configuration config) {\n                     }\n                     break;\n                 case TextField.FIELD_TYPE:\n+                    break;", "originalCommit": "1594a4e870c11fd277167692b53bb36129a4b09f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "12254c9a0bbbad95691e36751be10e9fa0179fdf", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\nindex 9572bb51cc..acd28d8928 100644\n--- a/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n+++ b/graylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java\n\n@@ -160,9 +160,7 @@ public class ConfigurationRequest {\n                 case TextField.FIELD_TYPE:\n                     break;\n                 case ListField.FIELD_TYPE:\n-                    if(config.listIsSet(name)){\n-                        values.put(name,config.getList(name));\n-                    }\n+                    addListField(values,config,name);\n                     break;\n                 case DropdownField.FIELD_TYPE:\n                     if (config.stringIsSet(name)) {\n"}}, {"oid": "12254c9a0bbbad95691e36751be10e9fa0179fdf", "url": "https://github.com/Graylog2/graylog2-server/commit/12254c9a0bbbad95691e36751be10e9fa0179fdf", "message": "Refactored the code to enable unit tests", "committedDate": "2020-01-07T14:37:19Z", "type": "commit"}, {"oid": "1f039e1502c56eb9b9b0926df58538c7856dc9a2", "url": "https://github.com/Graylog2/graylog2-server/commit/1f039e1502c56eb9b9b0926df58538c7856dc9a2", "message": "Update listIsSet and listfield check", "committedDate": "2020-01-07T17:08:29Z", "type": "commit"}, {"oid": "3a8edc3083f4f525f7ec563dc94889e5d78b9c27", "url": "https://github.com/Graylog2/graylog2-server/commit/3a8edc3083f4f525f7ec563dc94889e5d78b9c27", "message": "bumped version no.", "committedDate": "2020-01-07T20:41:18Z", "type": "commit"}, {"oid": "3811fae88816c186af4ddb2c9e6dd31f6dd7ccea", "url": "https://github.com/Graylog2/graylog2-server/commit/3811fae88816c186af4ddb2c9e6dd31f6dd7ccea", "message": "Add Listfield option in ConfigurationRequest", "committedDate": "2020-01-07T21:09:11Z", "type": "commit"}, {"oid": "1f6dedd93d53d2d57c113a9bd6d850695c140421", "url": "https://github.com/Graylog2/graylog2-server/commit/1f6dedd93d53d2d57c113a9bd6d850695c140421", "message": "Add listIsSet and listfield check", "committedDate": "2020-01-07T21:09:11Z", "type": "commit"}, {"oid": "be560e336bb2f69f889774283807e43ca65d07fc", "url": "https://github.com/Graylog2/graylog2-server/commit/be560e336bb2f69f889774283807e43ca65d07fc", "message": "Add unit test for ListField", "committedDate": "2020-01-07T21:09:11Z", "type": "commit"}, {"oid": "be51355bf0001ec7e092cdb348f006320bcb57f9", "url": "https://github.com/Graylog2/graylog2-server/commit/be51355bf0001ec7e092cdb348f006320bcb57f9", "message": "Refactored the code to enable unit tests", "committedDate": "2020-01-07T21:09:11Z", "type": "commit"}, {"oid": "4b58b9c7d6a59dda4c9c3552268e95b5b2f5081d", "url": "https://github.com/Graylog2/graylog2-server/commit/4b58b9c7d6a59dda4c9c3552268e95b5b2f5081d", "message": "Update listIsSet and listfield check", "committedDate": "2020-01-07T21:09:11Z", "type": "commit"}, {"oid": "4b58b9c7d6a59dda4c9c3552268e95b5b2f5081d", "url": "https://github.com/Graylog2/graylog2-server/commit/4b58b9c7d6a59dda4c9c3552268e95b5b2f5081d", "message": "Update listIsSet and listfield check", "committedDate": "2020-01-07T21:09:11Z", "type": "forcePushed"}, {"oid": "2b58428e3b2dbe7bd87472639d344501fce147b4", "url": "https://github.com/Graylog2/graylog2-server/commit/2b58428e3b2dbe7bd87472639d344501fce147b4", "message": "Merge remote-tracking branch 'origin/issue-4653' into issue-4653", "committedDate": "2020-01-07T21:22:50Z", "type": "commit"}, {"oid": "087b9ad71e0fbdb65fcbde4c35074fa27f27981b", "url": "https://github.com/Graylog2/graylog2-server/commit/087b9ad71e0fbdb65fcbde4c35074fa27f27981b", "message": "Merge remote-tracking branch 'origin/issue-4653' into issue-4653", "committedDate": "2020-01-07T21:27:31Z", "type": "commit"}, {"oid": "97513b56e76d85708ce3b00430ba1f94c531c203", "url": "https://github.com/Graylog2/graylog2-server/commit/97513b56e76d85708ce3b00430ba1f94c531c203", "message": "Update order of case statements", "committedDate": "2020-01-08T14:36:55Z", "type": "commit"}, {"oid": "f0328290b20b696d0d7553dc4e7239daa3b41613", "url": "https://github.com/Graylog2/graylog2-server/commit/f0328290b20b696d0d7553dc4e7239daa3b41613", "message": "Fix for failing unit test and input not starting.", "committedDate": "2020-01-08T14:47:20Z", "type": "commit"}, {"oid": "2e0021f716d1bb6e48ca26498db981e534d189c5", "url": "https://github.com/Graylog2/graylog2-server/commit/2e0021f716d1bb6e48ca26498db981e534d189c5", "message": "Merge remote-tracking branch 'origin/issue-4653' into issue-4653\n\n# Conflicts:\n#\tgraylog2-server/src/main/java/org/graylog2/plugin/configuration/ConfigurationRequest.java", "committedDate": "2020-01-08T14:53:06Z", "type": "commit"}, {"oid": "ae60ba97124972cab2e092fb4e4358182dfb9611", "url": "https://github.com/Graylog2/graylog2-server/commit/ae60ba97124972cab2e092fb4e4358182dfb9611", "message": "Annotate with ignore for method addListField", "committedDate": "2020-01-08T14:58:08Z", "type": "commit"}, {"oid": "45e2cf31a58311eb0335dfbec8e53cd9d2cdd534", "url": "https://github.com/Graylog2/graylog2-server/commit/45e2cf31a58311eb0335dfbec8e53cd9d2cdd534", "message": "Revert refactoring", "committedDate": "2020-01-08T16:37:03Z", "type": "commit"}, {"oid": "fdfca94869c30a5897f5f3ef553a60280c3e0abb", "url": "https://github.com/Graylog2/graylog2-server/commit/fdfca94869c30a5897f5f3ef553a60280c3e0abb", "message": "license header fix", "committedDate": "2020-01-08T16:46:07Z", "type": "commit"}, {"oid": "5a1f0449d019cbd6ad5ecb9573aac598eb54aed9", "url": "https://github.com/Graylog2/graylog2-server/commit/5a1f0449d019cbd6ad5ecb9573aac598eb54aed9", "message": "fix license header again", "committedDate": "2020-01-08T16:50:39Z", "type": "commit"}]}