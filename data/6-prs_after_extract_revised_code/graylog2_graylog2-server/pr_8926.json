{"pr_number": 8926, "pr_title": "Add is_cloud flag and disable \"No input running\" warning", "pr_createdAt": "2020-09-07T07:12:32Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/8926", "timeline": [{"oid": "a750f20c0fa5cf0b54f276d1e4b8e6627ba5ba01", "url": "https://github.com/Graylog2/graylog2-server/commit/a750f20c0fa5cf0b54f276d1e4b8e6627ba5ba01", "message": "Add is_cloud flag, and suppress input not running warning", "committedDate": "2020-09-07T07:06:45Z", "type": "commit"}, {"oid": "1b7e35eb380c4690e9a9a31cd202c081f5773e98", "url": "https://github.com/Graylog2/graylog2-server/commit/1b7e35eb380c4690e9a9a31cd202c081f5773e98", "message": "Fix check", "committedDate": "2020-09-07T07:22:34Z", "type": "commit"}, {"oid": "87e3beb73c633745e68e9afd0e1705afa6b1dbd2", "url": "https://github.com/Graylog2/graylog2-server/commit/87e3beb73c633745e68e9afd0e1705afa6b1dbd2", "message": "Remove unneeded log message", "committedDate": "2020-09-07T07:23:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MzExNg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8926#discussion_r484273116", "bodyText": "I think we don't need to log this to info. If we do this in every place we use the flag, we will have a lot of messages at some point. \ud83d\ude09", "author": "bernd", "createdAt": "2020-09-07T08:27:01Z", "path": "graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java", "diffHunk": "@@ -35,18 +36,25 @@\n     private NotificationService notificationService;\n     private final InputRegistry inputRegistry;\n     private final NodeId nodeId;\n+    private boolean isCloud;\n \n     @Inject\n     public ClusterHealthCheckThread(NotificationService notificationService,\n                                     InputRegistry inputRegistry,\n-                                    NodeId nodeId) {\n+                                    NodeId nodeId,\n+                                    @Named(\"is_cloud\") boolean isCloud) {\n         this.notificationService = notificationService;\n         this.inputRegistry = inputRegistry;\n         this.nodeId = nodeId;\n+        this.isCloud = isCloud;\n     }\n \n     @Override\n     public void doRun() {\n+        if (isCloud) {\n+            LOG.info(\"Skipping run of ClusterHealthCheckThread, since contained checks are not applicable for Cloud.\");", "originalCommit": "87e3beb73c633745e68e9afd0e1705afa6b1dbd2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "640ce1146870eb90b6c6c1e8ed5413dcedeea1a2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\nindex 93f5e09c37..f627535ca5 100644\n--- a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n+++ b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n\n@@ -52,7 +52,6 @@ public class ClusterHealthCheckThread extends Periodical {\n     @Override\n     public void doRun() {\n         if (isCloud) {\n-            LOG.info(\"Skipping run of ClusterHealthCheckThread, since contained checks are not applicable for Cloud.\");\n             return;\n         }\n         try {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MzI0MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8926#discussion_r484273240", "bodyText": "Why did you reduce this to 1?", "author": "bernd", "createdAt": "2020-09-07T08:27:14Z", "path": "graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java", "diffHunk": "@@ -103,7 +111,7 @@ public boolean startOnThisNode() {\n     public int getInitialDelaySeconds() {\n         // Wait some time until all inputs have been started otherwise this will trigger a notification on every\n         // startup of the server.\n-        return 120;\n+        return 1;", "originalCommit": "87e3beb73c633745e68e9afd0e1705afa6b1dbd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4MzAyMg==", "url": "https://github.com/Graylog2/graylog2-server/pull/8926#discussion_r484283022", "bodyText": "Ack, accidental commit. Thanks for seeing this.", "author": "danotorrey", "createdAt": "2020-09-07T08:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI3MzI0MA=="}], "type": "inlineReview", "revised_code": {"commit": "640ce1146870eb90b6c6c1e8ed5413dcedeea1a2", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\nindex 93f5e09c37..f627535ca5 100644\n--- a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n+++ b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n\n@@ -111,7 +110,7 @@ public class ClusterHealthCheckThread extends Periodical {\n     public int getInitialDelaySeconds() {\n         // Wait some time until all inputs have been started otherwise this will trigger a notification on every\n         // startup of the server.\n-        return 1;\n+        return 120;\n     }\n \n     @Override\n"}}, {"oid": "640ce1146870eb90b6c6c1e8ed5413dcedeea1a2", "url": "https://github.com/Graylog2/graylog2-server/commit/640ce1146870eb90b6c6c1e8ed5413dcedeea1a2", "message": "Remove unneeded log message and unintended rate change", "committedDate": "2020-09-07T08:42:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4NTY1MA==", "url": "https://github.com/Graylog2/graylog2-server/pull/8926#discussion_r484285650", "bodyText": "I meant moving the log statement to debug. Now there is no explanation why we do this. \ud83d\ude09", "author": "bernd", "createdAt": "2020-09-07T08:48:15Z", "path": "graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java", "diffHunk": "@@ -35,18 +36,24 @@\n     private NotificationService notificationService;\n     private final InputRegistry inputRegistry;\n     private final NodeId nodeId;\n+    private boolean isCloud;\n \n     @Inject\n     public ClusterHealthCheckThread(NotificationService notificationService,\n                                     InputRegistry inputRegistry,\n-                                    NodeId nodeId) {\n+                                    NodeId nodeId,\n+                                    @Named(\"is_cloud\") boolean isCloud) {\n         this.notificationService = notificationService;\n         this.inputRegistry = inputRegistry;\n         this.nodeId = nodeId;\n+        this.isCloud = isCloud;\n     }\n \n     @Override\n     public void doRun() {\n+        if (isCloud) {\n+            return;", "originalCommit": "640ce1146870eb90b6c6c1e8ed5413dcedeea1a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDMwNzYzMQ==", "url": "https://github.com/Graylog2/graylog2-server/pull/8926#discussion_r484307631", "bodyText": "Thanks. This was the original intention, but somehow I left it at info. Makes sense, I see that now.", "author": "danotorrey", "createdAt": "2020-09-07T09:24:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDI4NTY1MA=="}], "type": "inlineReview", "revised_code": {"commit": "cb9726dcbce041df0aa89b615e43e777defb5725", "chunk": "diff --git a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\nindex f627535ca5..c0e156984d 100644\n--- a/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n+++ b/graylog2-server/src/main/java/org/graylog2/periodical/ClusterHealthCheckThread.java\n\n@@ -52,6 +52,7 @@ public class ClusterHealthCheckThread extends Periodical {\n     @Override\n     public void doRun() {\n         if (isCloud) {\n+            LOG.debug(\"Skipping run of ClusterHealthCheckThread, since contained checks are not applicable for Cloud.\");\n             return;\n         }\n         try {\n"}}, {"oid": "cb9726dcbce041df0aa89b615e43e777defb5725", "url": "https://github.com/Graylog2/graylog2-server/commit/cb9726dcbce041df0aa89b615e43e777defb5725", "message": "Change log statement to debug", "committedDate": "2020-09-07T09:23:21Z", "type": "commit"}]}