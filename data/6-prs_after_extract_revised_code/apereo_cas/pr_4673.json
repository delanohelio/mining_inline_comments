{"pr_number": 4673, "pr_title": "Make LDAP PM conditonal on property", "pr_createdAt": "2020-02-04T13:20:02Z", "pr_url": "https://github.com/apereo/cas/pull/4673", "timeline": [{"oid": "a94feb84c35fb81e56689cb121bb6bb8b2ddcfa2", "url": "https://github.com/apereo/cas/commit/a94feb84c35fb81e56689cb121bb6bb8b2ddcfa2", "message": "Make LDAP PM conditonal on property", "committedDate": "2020-02-04T13:17:31Z", "type": "commit"}, {"oid": "7beed0b14c7db6740ef2cb3f44cd6bcd542fc173", "url": "https://github.com/apereo/cas/commit/7beed0b14c7db6740ef2cb3f44cd6bcd542fc173", "message": "Merge branch 'master' into ldappm", "committedDate": "2020-02-04T18:44:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3OTA1MA==", "url": "https://github.com/apereo/cas/pull/4673#discussion_r375079050", "bodyText": "This will not work. The setting is defined as cas.authn.pm.ldap[x].ldapUrl in master.\nTo make things consistent between master and 6.1, I suggest that if an LDAP url is not defined, a new BeanCreationException should be thrown instead, rather than ignoring the configuration silently.", "author": "mmoayyed", "createdAt": "2020-02-05T06:31:12Z", "path": "support/cas-server-support-pm-ldap/src/main/java/org/apereo/cas/config/LdapPasswordManagementConfiguration.java", "diffHunk": "@@ -21,6 +22,7 @@\n  * @since 5.2.0\n  */\n @Configuration(value = \"ldapPasswordManagementConfiguration\", proxyBeanMethods = false)\n+@ConditionalOnProperty(prefix = \"cas.authn.pm.ldap\", name = \"ldapUrl\")", "originalCommit": "7beed0b14c7db6740ef2cb3f44cd6bcd542fc173", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA4NDYwNg==", "url": "https://github.com/apereo/cas/pull/4673#discussion_r375084606", "bodyText": "Leaving aside the issue in master, I wanted to remain consistent with what we already have on many classes like:\n@ConditionalOnProperty(prefix = \"cas.acceptableUsagePolicy\", name = \"enabled\", havingValue = \"true\", matchIfMissing = true)\npublic class CasAcceptableUsagePolicyRestConfiguration {\n\n@ConditionalOnProperty(prefix = \"cas.audit\", name = \"enabled\", havingValue = \"true\", matchIfMissing = true)\npublic class CasCoreAuditConfiguration {\n\n@ConditionalOnProperty(prefix = \"cas.events\", name = \"enabled\", havingValue = \"true\", matchIfMissing = true)\npublic class CasCoreEventsConfiguration {\n\n...\nAnd I think it would be better to have the same behavior everywhere. What do you think?", "author": "leleuj", "createdAt": "2020-02-05T06:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3OTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwMjI3Mw==", "url": "https://github.com/apereo/cas/pull/4673#discussion_r375102273", "bodyText": "Good point. You're right. To handle this then, it think we need a custom condition with a conditional annotation to loop through the collection of ldaps and skip bean creation if none is defined.", "author": "mmoayyed", "createdAt": "2020-02-05T07:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3OTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExNjYzOQ==", "url": "https://github.com/apereo/cas/pull/4673#discussion_r375116639", "bodyText": "OK. I'll re-work on that next Tuesday.", "author": "leleuj", "createdAt": "2020-02-05T08:31:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3OTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYyMzc5NA==", "url": "https://github.com/apereo/cas/pull/4673#discussion_r377623794", "bodyText": "In fact, after a few tests, I found out a very simple solution to check the whole property name.", "author": "leleuj", "createdAt": "2020-02-11T13:11:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA3OTA1MA=="}], "type": "inlineReview", "revised_code": {"commit": "bbefad9e4d38feb942b4867468ddfbae283ed08a", "chunk": "diff --git a/support/cas-server-support-pm-ldap/src/main/java/org/apereo/cas/config/LdapPasswordManagementConfiguration.java b/support/cas-server-support-pm-ldap/src/main/java/org/apereo/cas/config/LdapPasswordManagementConfiguration.java\nindex 75f7adf38d..366588acf6 100644\n--- a/support/cas-server-support-pm-ldap/src/main/java/org/apereo/cas/config/LdapPasswordManagementConfiguration.java\n+++ b/support/cas-server-support-pm-ldap/src/main/java/org/apereo/cas/config/LdapPasswordManagementConfiguration.java\n\n@@ -22,7 +22,7 @@ import org.springframework.context.annotation.Configuration;\n  * @since 5.2.0\n  */\n @Configuration(value = \"ldapPasswordManagementConfiguration\", proxyBeanMethods = false)\n-@ConditionalOnProperty(prefix = \"cas.authn.pm.ldap\", name = \"ldapUrl\")\n+@ConditionalOnProperty(\"cas.authn.pm.ldap[0].ldapUrl\")\n @EnableConfigurationProperties(CasConfigurationProperties.class)\n public class LdapPasswordManagementConfiguration {\n     @Autowired\n"}}, {"oid": "63e0803daaf59303f228ddaa5a6a3d44331a8701", "url": "https://github.com/apereo/cas/commit/63e0803daaf59303f228ddaa5a6a3d44331a8701", "message": "Merge branch 'master' of github.com:apereo/cas into ldappm", "committedDate": "2020-02-11T13:03:56Z", "type": "commit"}, {"oid": "bbefad9e4d38feb942b4867468ddfbae283ed08a", "url": "https://github.com/apereo/cas/commit/bbefad9e4d38feb942b4867468ddfbae283ed08a", "message": "check on the whole property name", "committedDate": "2020-02-11T13:09:46Z", "type": "commit"}, {"oid": "6acdf0fa5ef478a3a21a27ec25b65a4868aa3d75", "url": "https://github.com/apereo/cas/commit/6acdf0fa5ef478a3a21a27ec25b65a4868aa3d75", "message": "Merge branch 'ldappm' of github.com:leleuj/cas into ldappm", "committedDate": "2020-02-11T13:10:16Z", "type": "commit"}]}