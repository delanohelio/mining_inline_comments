{"pr_number": 1188, "pr_title": "Fix #1187: User tasks endpoint returns error for CompletedWithError tasks when fetch_complete_task=true", "pr_createdAt": "2020-05-05T14:50:29Z", "pr_url": "https://github.com/linkedin/cruise-control/pull/1188", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3NzU5OA==", "url": "https://github.com/linkedin/cruise-control/pull/1188#discussion_r421077598", "bodyText": "So checkstyle failed, but the line it is complaining about doesn't exit? How do I run the checkstyle task locally?\n\n@tomncooper This is due to a missing space before { in this line:\n> Task :cruise-control:checkstyleMain\n[ant:checkstyle] [ERROR] /home/circleci/workspace/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java:769:56: '{' is not preceded with whitespace. [WhitespaceAround]", "author": "efeg", "createdAt": "2020-05-06T20:39:25Z", "path": "cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java", "diffHunk": "@@ -763,9 +763,16 @@ private void logOperation() {\n       // Populate original response of completed task if requested so.\n       if (fetchCompletedTask) {\n         try {\n+          // TODO: For CompletedWithError tasks the cached response should contain the original server side error information\n           jsonObjectMap.put(ORIGINAL_RESPONSE, lastFuture().get().cachedResponse());\n         } catch (InterruptedException | ExecutionException e) {\n-          throw new IllegalStateException(\"Error happened in fetching response for task \" + _userTaskId.toString(), e);\n+          if (_state == TaskState.COMPLETED_WITH_ERROR){", "originalCommit": "4122d4106c610c1bb413033762174bd8558eff43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjkyNDI4MA==", "url": "https://github.com/linkedin/cruise-control/pull/1188#discussion_r422924280", "bodyText": "Great, thanks.", "author": "tomncooper", "createdAt": "2020-05-11T09:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA3NzU5OA=="}], "type": "inlineReview", "revised_code": {"commit": "0c48f309a0df58c07f42d487efb238218b4c3f36", "chunk": "diff --git a/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java b/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java\nindex d9126715..93073c72 100644\n--- a/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java\n+++ b/cruise-control/src/main/java/com/linkedin/kafka/cruisecontrol/servlet/UserTaskManager.java\n\n@@ -766,7 +766,7 @@ public class UserTaskManager implements Closeable {\n           // TODO: For CompletedWithError tasks the cached response should contain the original server side error information\n           jsonObjectMap.put(ORIGINAL_RESPONSE, lastFuture().get().cachedResponse());\n         } catch (InterruptedException | ExecutionException e) {\n-          if (_state == TaskState.COMPLETED_WITH_ERROR){\n+          if (_state == TaskState.COMPLETED_WITH_ERROR) {\n             // If the state is completed with error and fetch completed task is true then just return \"CompletedWithError\"\n             // as the \"originalResponse\".\n             jsonObjectMap.put(ORIGINAL_RESPONSE, TaskState.COMPLETED_WITH_ERROR);\n"}}, {"oid": "0c48f309a0df58c07f42d487efb238218b4c3f36", "url": "https://github.com/linkedin/cruise-control/commit/0c48f309a0df58c07f42d487efb238218b4c3f36", "message": "Change user task getJson method to prevent errors for CompletedWithError tasks", "committedDate": "2020-05-11T09:58:44Z", "type": "commit"}, {"oid": "0c48f309a0df58c07f42d487efb238218b4c3f36", "url": "https://github.com/linkedin/cruise-control/commit/0c48f309a0df58c07f42d487efb238218b4c3f36", "message": "Change user task getJson method to prevent errors for CompletedWithError tasks", "committedDate": "2020-05-11T09:58:44Z", "type": "forcePushed"}]}