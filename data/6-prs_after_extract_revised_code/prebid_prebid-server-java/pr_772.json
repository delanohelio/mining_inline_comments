{"pr_number": 772, "pr_title": "Make failed vendor list for TCF1 do not drop the auction", "pr_createdAt": "2020-06-19T16:29:48Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/772", "timeline": [{"oid": "bbb32650e62f39a118c03f5b6dcaecedcf648cc9", "url": "https://github.com/prebid/prebid-server-java/commit/bbb32650e62f39a118c03f5b6dcaecedcf648cc9", "message": "Make failed vendor list for TCF1 do not drop the auction", "committedDate": "2020-06-19T16:28:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NTg2Mg==", "url": "https://github.com/prebid/prebid-server-java/pull/772#discussion_r444145862", "bodyText": "It's strange that saveToFileAndUpdateCache does not show the result of the file saving/\nDoesn't recover method  in the end of pipeline is  safer ?", "author": "DGarbar", "createdAt": "2020-06-23T11:13:58Z", "path": "src/main/java/org/prebid/server/privacy/gdpr/vendorlist/VendorListService.java", "diffHunk": "@@ -182,17 +198,17 @@ private void fetchNewVendorListFor(int version) {\n         final String url = endpointTemplate.replace(VERSION_PLACEHOLDER, String.valueOf(version));\n \n         httpClient.get(url, defaultTimeoutMs)\n-                .compose(response -> processResponse(response, version))\n-                .compose(vendorListResult -> saveToFileAndUpdateCache(vendorListResult, version))\n-                .recover(exception -> failResponse(exception, version));\n+                .map(response -> processResponse(response, version))\n+                .recover(exception -> failResponse(exception, version))\n+                .compose(vendorListResult -> saveToFileAndUpdateCache(vendorListResult, version));", "originalCommit": "bbb32650e62f39a118c03f5b6dcaecedcf648cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE2MzY1MQ==", "url": "https://github.com/prebid/prebid-server-java/pull/772#discussion_r444163651", "bodyText": "Good question. From the logic point of view we don't need to cover filesystem errors (all we need is already implemented in fileSystem.writeFile(...) call) but maybe you're right and i need to make it in clean-code style.", "author": "rpanchyk", "createdAt": "2020-06-23T11:49:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE0NTg2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "060014562bf8cb122822053a28ef672b3a3a66d2", "chunk": "diff --git a/src/main/java/org/prebid/server/privacy/gdpr/vendorlist/VendorListService.java b/src/main/java/org/prebid/server/privacy/gdpr/vendorlist/VendorListService.java\nindex 2f4b4066f..de5777b4a 100644\n--- a/src/main/java/org/prebid/server/privacy/gdpr/vendorlist/VendorListService.java\n+++ b/src/main/java/org/prebid/server/privacy/gdpr/vendorlist/VendorListService.java\n\n@@ -199,8 +199,9 @@ public abstract class VendorListService<T, V> {\n \n         httpClient.get(url, defaultTimeoutMs)\n                 .map(response -> processResponse(response, version))\n-                .recover(exception -> failResponse(exception, version))\n-                .compose(vendorListResult -> saveToFileAndUpdateCache(vendorListResult, version));\n+                .compose(this::saveToFile)\n+                .map(this::updateCache)\n+                .otherwise(exception -> handleError(exception, version));\n     }\n \n     /**\n"}}, {"oid": "060014562bf8cb122822053a28ef672b3a3a66d2", "url": "https://github.com/prebid/prebid-server-java/commit/060014562bf8cb122822053a28ef672b3a3a66d2", "message": "Make failed vendor list for TCF1 do not drop the auction - fix after review", "committedDate": "2020-06-23T12:59:09Z", "type": "commit"}, {"oid": "3c3c630d86121f5aedb5534a9c04579e14a6f939", "url": "https://github.com/prebid/prebid-server-java/commit/3c3c630d86121f5aedb5534a9c04579e14a6f939", "message": "Merge branch 'master' into fix-tcf1-vendorlist-fail\n\n# Conflicts:\n#\tdocs/metrics.md\n#\tsrc/main/java/org/prebid/server/privacy/gdpr/GdprService.java", "committedDate": "2020-06-26T11:49:21Z", "type": "commit"}]}