{"pr_number": 876, "pr_title": "Set bid currency from response", "pr_createdAt": "2020-08-25T21:56:52Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/876", "timeline": [{"oid": "7bd365e0ffa3653e4586b799d45cc6618ec189c0", "url": "https://github.com/prebid/prebid-server-java/commit/7bd365e0ffa3653e4586b799d45cc6618ec189c0", "message": "Get bidcurrency from response", "committedDate": "2020-08-25T21:46:38Z", "type": "commit"}, {"oid": "77807a31b76380f3e4d8c8f62e5248dead1b6475", "url": "https://github.com/prebid/prebid-server-java/commit/77807a31b76380f3e4d8c8f62e5248dead1b6475", "message": "Add currency validation to BidResponseValidator", "committedDate": "2020-09-01T21:42:57Z", "type": "commit"}, {"oid": "1ea6ae7eaaf08e7a4dc01cbf0397668f08bd69da", "url": "https://github.com/prebid/prebid-server-java/commit/1ea6ae7eaaf08e7a4dc01cbf0397668f08bd69da", "message": "Additional changes", "committedDate": "2020-09-01T21:50:14Z", "type": "commit"}, {"oid": "5bac34c31caefa9e376f973ce07c211fb4070a7b", "url": "https://github.com/prebid/prebid-server-java/commit/5bac34c31caefa9e376f973ce07c211fb4070a7b", "message": "Change defining currency in OpenrtbBidder", "committedDate": "2020-09-02T13:19:05Z", "type": "commit"}, {"oid": "27f8d09414a586e5a622364753c276e3b87b5e76", "url": "https://github.com/prebid/prebid-server-java/commit/27f8d09414a586e5a622364753c276e3b87b5e76", "message": "Removing default currency from bidders", "committedDate": "2020-09-02T14:00:01Z", "type": "commit"}, {"oid": "a881321f868e611c81acd786abc7c998af0bb266", "url": "https://github.com/prebid/prebid-server-java/commit/a881321f868e611c81acd786abc7c998af0bb266", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response\n\n# Conflicts:\n#\tsrc/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java", "committedDate": "2020-09-02T14:09:58Z", "type": "commit"}, {"oid": "f3876ad0ce29deb42cce86fbe24401dd3d80b1e7", "url": "https://github.com/prebid/prebid-server-java/commit/f3876ad0ce29deb42cce86fbe24401dd3d80b1e7", "message": "Resolving conflicts", "committedDate": "2020-09-02T14:13:32Z", "type": "commit"}, {"oid": "6a17fd1ba5d885cb333cc496e7cbbb1be49e420c", "url": "https://github.com/prebid/prebid-server-java/commit/6a17fd1ba5d885cb333cc496e7cbbb1be49e420c", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response", "committedDate": "2020-09-10T13:31:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM0ODg1Ng==", "url": "https://github.com/prebid/prebid-server-java/pull/876#discussion_r486348856", "bodyText": "Sorry, but i have a crazy thought about stripToNull action performing.\nIt is kind frail to add this in each bidder, may be for simplicity it is reasonable to leave it as is like: bidResponse.getCur() without any processing. Then, in ExchangeService (before currency conversion service call) we can add this stripToNull action.\nSo, just in one place - before actual using the currency value.\nWhat do you think?", "author": "rpanchyk", "createdAt": "2020-09-10T13:42:48Z", "path": "src/main/java/org/prebid/server/bidder/OpenrtbBidder.java", "diffHunk": "@@ -231,7 +229,7 @@ protected void modifyRequest(BidRequest bidRequest, BidRequest.BidRequestBuilder\n                 .filter(Objects::nonNull)\n                 .flatMap(Collection::stream)\n                 .map(bid -> BidderBid.of(bid, getBidType(bid.getImpid(), bidRequest.getImp()),\n-                        getBidCurrency(bidRequest.getCur(), bidResponse.getCur())))\n+                        StringUtils.stripToNull(bidResponse.getCur())))", "originalCommit": "6a17fd1ba5d885cb333cc496e7cbbb1be49e420c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM3NDEzOQ==", "url": "https://github.com/prebid/prebid-server-java/pull/876#discussion_r486374139", "bodyText": "Yeah, good notice about performance. I agree with you. I'll try to change the logic", "author": "AndriyPavlyuk", "createdAt": "2020-09-10T14:09:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM0ODg1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "0b20bcd1cbfbadb7bf3909684c9bf3c5f28308a5", "chunk": "diff --git a/src/main/java/org/prebid/server/bidder/OpenrtbBidder.java b/src/main/java/org/prebid/server/bidder/OpenrtbBidder.java\nindex 8a2b83136..67a9ee9a2 100644\n--- a/src/main/java/org/prebid/server/bidder/OpenrtbBidder.java\n+++ b/src/main/java/org/prebid/server/bidder/OpenrtbBidder.java\n\n@@ -228,8 +227,7 @@ public abstract class OpenrtbBidder<T> implements Bidder<BidRequest> {\n                 .map(SeatBid::getBid)\n                 .filter(Objects::nonNull)\n                 .flatMap(Collection::stream)\n-                .map(bid -> BidderBid.of(bid, getBidType(bid.getImpid(), bidRequest.getImp()),\n-                        StringUtils.stripToNull(bidResponse.getCur())))\n+                .map(bid -> BidderBid.of(bid, getBidType(bid.getImpid(), bidRequest.getImp()), bidResponse.getCur()))\n                 .collect(Collectors.toList());\n     }\n \n"}}, {"oid": "21011a7edef29b488f5dda5b8727263767a53e20", "url": "https://github.com/prebid/prebid-server-java/commit/21011a7edef29b488f5dda5b8727263767a53e20", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response", "committedDate": "2020-09-11T09:49:15Z", "type": "commit"}, {"oid": "0b20bcd1cbfbadb7bf3909684c9bf3c5f28308a5", "url": "https://github.com/prebid/prebid-server-java/commit/0b20bcd1cbfbadb7bf3909684c9bf3c5f28308a5", "message": "Add stripToNull function just to ExchangeService", "committedDate": "2020-09-11T12:22:31Z", "type": "commit"}, {"oid": "f52cee95e885acb3ae748f5622dc5567407c1f16", "url": "https://github.com/prebid/prebid-server-java/commit/f52cee95e885acb3ae748f5622dc5567407c1f16", "message": "Merge remote-tracking branch 'internal-github/bidders-get-bid-currency-from-response' into bidders-get-bid-currency-from-response", "committedDate": "2020-09-11T12:22:52Z", "type": "commit"}, {"oid": "161c06b4504aa679e6931675a0aa4ecded2f940f", "url": "https://github.com/prebid/prebid-server-java/commit/161c06b4504aa679e6931675a0aa4ecded2f940f", "message": "Fixing unit test in ExchangeServiceTest", "committedDate": "2020-09-11T12:34:12Z", "type": "commit"}, {"oid": "0b6482dfac1abb0b058777b555b774fc33396eac", "url": "https://github.com/prebid/prebid-server-java/commit/0b6482dfac1abb0b058777b555b774fc33396eac", "message": "Fixing test for currency", "committedDate": "2020-09-11T13:17:57Z", "type": "commit"}, {"oid": "ed5b4529fadfcba0fc6aebc4905a1c72c04e48f3", "url": "https://github.com/prebid/prebid-server-java/commit/ed5b4529fadfcba0fc6aebc4905a1c72c04e48f3", "message": "Move method to currency service invoking", "committedDate": "2020-09-11T14:12:49Z", "type": "commit"}, {"oid": "18901b0395c4e80522850a4230c251b6ae34dc9e", "url": "https://github.com/prebid/prebid-server-java/commit/18901b0395c4e80522850a4230c251b6ae34dc9e", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response", "committedDate": "2020-09-14T13:14:34Z", "type": "commit"}, {"oid": "daa266f8aaf11ce88796bceabd8734262df95825", "url": "https://github.com/prebid/prebid-server-java/commit/daa266f8aaf11ce88796bceabd8734262df95825", "message": "Clean code", "committedDate": "2020-09-14T13:38:47Z", "type": "commit"}, {"oid": "a33a14c3eab2a08c4ed60b94ba5f088bb59ba4ff", "url": "https://github.com/prebid/prebid-server-java/commit/a33a14c3eab2a08c4ed60b94ba5f088bb59ba4ff", "message": "Merge branch 'master' into bidders-get-bid-currency-from-response\n\n# Conflicts:\n#\tsrc/main/java/org/prebid/server/auction/ExchangeService.java\n#\tsrc/main/java/org/prebid/server/bidder/gamma/GammaBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/gumgum/GumgumBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/kubient/KubientBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/pubmatic/PubmaticBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/rubicon/RubiconBidder.java\n#\tsrc/main/java/org/prebid/server/bidder/telaria/TelariaBidder.java\n#\tsrc/test/java/org/prebid/server/bidder/ix/IxBidderTest.java", "committedDate": "2020-10-30T12:08:40Z", "type": "commit"}]}