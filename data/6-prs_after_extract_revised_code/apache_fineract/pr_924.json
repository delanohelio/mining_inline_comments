{"pr_number": 924, "pr_title": "FINERACT-609 TopUp", "pr_createdAt": "2020-05-22T10:06:11Z", "pr_url": "https://github.com/apache/fineract/pull/924", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA==", "url": "https://github.com/apache/fineract/pull/924#discussion_r429377378", "bodyText": "This still doesn't seem to take the code review feedback that @vishwasbabu had provided in #574 into account?", "author": "vorburger", "createdAt": "2020-05-22T17:45:41Z", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/accountdetails/service/AccountDetailsReadPlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -171,6 +172,12 @@ public AccountSummaryCollectionData retrieveGroupAccountDetails(final Long group\n         return this.jdbcTemplate.query(sql, rm, new Object[]{groupId , glimAccount});\n     }\n \n+    @Override\n+    public Collection<LoanAccountSummaryData> retrieveGroupActiveLoanAccountSummary(final Long groupId) {\n+        final String loanWhereClause = \" where l.group_id = ? and l.loan_status_id = 300 \";", "originalCommit": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM5NjEwMQ==", "url": "https://github.com/apache/fineract/pull/924#discussion_r429396101", "bodyText": "From\n\n(since you check if client ID is not null in the service method), it might introduce bugs in the future when someone tries to reuse this method. I would suggest returning only loans of type 3.\n\nI removed the conditional statement to check if client ID is null from LoanReadPlatformServiceImpl", "author": "percyashu", "createdAt": "2020-05-22T18:30:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTQwNzI0Mg==", "url": "https://github.com/apache/fineract/pull/924#discussion_r429407242", "bodyText": "@vishwasbabu does this LGTY?", "author": "vorburger", "createdAt": "2020-05-22T18:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk2MDA0NA==", "url": "https://github.com/apache/fineract/pull/924#discussion_r431960044", "bodyText": "I would append a clause to the effect of \"l.client_id is NULL\", this ensures that only group loans are fetched by the query all JLG loans are ignored (loans which are associated with clients and groups and fetched as a part of the retrieveClientActiveLoanAccountSummary method)", "author": "vishwasbabu", "createdAt": "2020-05-28T16:16:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTM3NzM3OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk1NzYyNw==", "url": "https://github.com/apache/fineract/pull/924#discussion_r431957627", "bodyText": "We shouldn't be removing the existing condition which checks for client loans, rather we should be adding an else if for additionally checking for group loans", "author": "vishwasbabu", "createdAt": "2020-05-28T16:13:06Z", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanReadPlatformServiceImpl.java", "diffHunk": "@@ -1428,15 +1428,15 @@ public LoanAccountData retrieveLoanProductDetailsTemplate(final Long productId,\n             }\n         }\n \n-        Collection<LoanAccountSummaryData> clientActiveLoanOptions = null;\n-        if(loanProduct.canUseForTopup() && clientId != null){\n-            clientActiveLoanOptions = this.accountDetailsReadPlatformService.retrieveClientActiveLoanAccountSummary(clientId);", "originalCommit": "1988b9b4eea33aa201a0eb4e2efeba6bdc3a401d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "c1ca960acefd7d97e630915b06c6e772d984bd33", "url": "https://github.com/apache/fineract/commit/c1ca960acefd7d97e630915b06c6e772d984bd33", "message": "FINERACT-609 TopUp", "committedDate": "2020-05-28T18:16:47Z", "type": "commit"}, {"oid": "c1ca960acefd7d97e630915b06c6e772d984bd33", "url": "https://github.com/apache/fineract/commit/c1ca960acefd7d97e630915b06c6e772d984bd33", "message": "FINERACT-609 TopUp", "committedDate": "2020-05-28T18:16:47Z", "type": "forcePushed"}]}