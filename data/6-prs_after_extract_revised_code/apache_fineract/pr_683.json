{"pr_number": 683, "pr_title": "FINERACT-824: NullPointerException is thrown when submitting a loan account application with an existing externalId", "pr_createdAt": "2020-01-10T21:17:12Z", "pr_url": "https://github.com/apache/fineract/pull/683", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYwMjcwMA==", "url": "https://github.com/apache/fineract/pull/683#discussion_r365602700", "bodyText": "@angelboxes I don't know much about this code, but it looks like someone thought that it would be useful to also check the cause... your FINERACT-824 indicates that this can lead to NPEs, so instead of just completely removing the getCause() related check, do you think it may be a good idea to check it like this (for both):\n} else if (realCause.getMessage().contains(\"loan_externalid_UNIQUE\") || (realCause.getCause() != null && realCause.getCause().getMessage().contains(\"loan_externalid_UNIQUE\"))) {\n\nJust a thought, as this would perhaps seem more prudent in case that extra check for the cause was there for a good reason. If you are totally confident that this cause is never set and always null, then this is also OK for me, but I thought it would be worth to clarify?", "author": "vorburger", "createdAt": "2020-01-12T18:48:04Z", "path": "fineract-provider/src/main/java/org/apache/fineract/portfolio/loanaccount/service/LoanApplicationWritePlatformServiceJpaRepositoryImpl.java", "diffHunk": "@@ -1036,12 +1036,11 @@ else if(existingLoanApplication.getGroup() != null){\n      */\n     private void handleDataIntegrityIssues(final JsonCommand command, final Throwable realCause, final Exception dve) {\n     \t\n-        if (realCause.getMessage().contains(\"loan_account_no_UNIQUE\") || realCause.getCause().getMessage().contains(\"loan_account_no_UNIQUE\")) {\n-\n+        if (realCause.getMessage().contains(\"loan_account_no_UNIQUE\")) {\n             final String accountNo = command.stringValueOfParameterNamed(\"accountNo\");\n             throw new PlatformDataIntegrityException(\"error.msg.loan.duplicate.accountNo\", \"Loan with accountNo `\" + accountNo\n                     + \"` already exists\", \"accountNo\", accountNo);\n-        } else if (realCause.getMessage().contains(\"loan_externalid_UNIQUE\") || realCause.getCause().getMessage().contains(\"loan_externalid_UNIQUE\")) {", "originalCommit": "380544da6d20d2bb56197ad475db9a2f8fc6e4cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYyNDY5MQ==", "url": "https://github.com/apache/fineract/pull/683#discussion_r365624691", "bodyText": "Yeah, actually that was my first approach to this issue however I saw that this is not the only place where unique values exceptions are thrown but this is the only place where such validation is done. and thought that it was one of those changes that worked when it was added but a different one made it useless and that maybe it wasn't needed,. Don't worry I will change it as you propose.", "author": "angelboxes", "createdAt": "2020-01-13T00:41:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTYwMjcwMA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5d6cf9c1121b2cdd1019eb628d88e0637aa4d7f5", "url": "https://github.com/apache/fineract/commit/5d6cf9c1121b2cdd1019eb628d88e0637aa4d7f5", "message": "FINERACT-824:\nRemoved the second validation since realCause.getCause() is null if it is equal to realCause", "committedDate": "2020-01-13T17:57:52Z", "type": "commit"}, {"oid": "5d6cf9c1121b2cdd1019eb628d88e0637aa4d7f5", "url": "https://github.com/apache/fineract/commit/5d6cf9c1121b2cdd1019eb628d88e0637aa4d7f5", "message": "FINERACT-824:\nRemoved the second validation since realCause.getCause() is null if it is equal to realCause", "committedDate": "2020-01-13T17:57:52Z", "type": "forcePushed"}]}