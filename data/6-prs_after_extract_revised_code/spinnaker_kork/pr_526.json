{"pr_number": 526, "pr_title": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "pr_createdAt": "2020-02-21T02:05:56Z", "pr_url": "https://github.com/spinnaker/kork/pull/526", "timeline": [{"oid": "4fa9e20f884b5ff6bca215a17c9a24d1eb4476d7", "url": "https://github.com/spinnaker/kork/commit/4fa9e20f884b5ff6bca215a17c9a24d1eb4476d7", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T02:36:58Z", "type": "forcePushed"}, {"oid": "98c9ad592fe4275ba33706f8397edf9a6e7ee269", "url": "https://github.com/spinnaker/kork/commit/98c9ad592fe4275ba33706f8397edf9a6e7ee269", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T02:43:02Z", "type": "forcePushed"}, {"oid": "311e9537518c06e6fea2bd0b27d8bfa2a42afadb", "url": "https://github.com/spinnaker/kork/commit/311e9537518c06e6fea2bd0b27d8bfa2a42afadb", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T02:45:17Z", "type": "forcePushed"}, {"oid": "a29b97ef62523b0c1efe79ca38de30fafaa61b43", "url": "https://github.com/spinnaker/kork/commit/a29b97ef62523b0c1efe79ca38de30fafaa61b43", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:21:06Z", "type": "forcePushed"}, {"oid": "0a671422c9844b7db1e099fdc9ea6b4d010ba47d", "url": "https://github.com/spinnaker/kork/commit/0a671422c9844b7db1e099fdc9ea6b4d010ba47d", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:28:44Z", "type": "forcePushed"}, {"oid": "0811b565afce4a66ade5fb3f1604dcb5caa03774", "url": "https://github.com/spinnaker/kork/commit/0811b565afce4a66ade5fb3f1604dcb5caa03774", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:38:44Z", "type": "forcePushed"}, {"oid": "43013bb019821981f79dc8cf5c3eaee3103daaea", "url": "https://github.com/spinnaker/kork/commit/43013bb019821981f79dc8cf5c3eaee3103daaea", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:41:52Z", "type": "forcePushed"}, {"oid": "2e6dfb6821a99539ffc56cb05530164f91472767", "url": "https://github.com/spinnaker/kork/commit/2e6dfb6821a99539ffc56cb05530164f91472767", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:44:38Z", "type": "forcePushed"}, {"oid": "ab93205d97031eb9091d601c64eabbdea4c41512", "url": "https://github.com/spinnaker/kork/commit/ab93205d97031eb9091d601c64eabbdea4c41512", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:51:15Z", "type": "commit"}, {"oid": "ab93205d97031eb9091d601c64eabbdea4c41512", "url": "https://github.com/spinnaker/kork/commit/ab93205d97031eb9091d601c64eabbdea4c41512", "message": "feat(plugins): Use configured plugin version (falling back to latest if not specified) and check service version requirement constraints", "committedDate": "2020-02-21T06:51:15Z", "type": "forcePushed"}, {"oid": "0fdb537aa4b46976d8e102979d1c81fcd1869e45", "url": "https://github.com/spinnaker/kork/commit/0fdb537aa4b46976d8e102979d1c81fcd1869e45", "message": "fix(plugins): Add PluginNotFoundException", "committedDate": "2020-02-21T18:49:38Z", "type": "commit"}, {"oid": "51dd25a8e91b9aaeb2de41eb1d56ab9914f12aeb", "url": "https://github.com/spinnaker/kork/commit/51dd25a8e91b9aaeb2de41eb1d56ab9914f12aeb", "message": "fix(plugins): Add PluginDownloadException", "committedDate": "2020-02-21T19:00:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Mzc3MA==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r382753770", "bodyText": "I don't understand the purpose of this flag. Can't the logic just be something like this:\nval version = attributes.getValue(\"Implementation-OSS-Version\") ?: attributes.getValue(\"Implementation-Version\")", "author": "robzienert", "createdAt": "2020-02-21T19:05:04Z", "path": "kork-core/src/main/java/com/netflix/spinnaker/kork/version/ManifestVersionResolver.java", "diffHunk": "@@ -35,18 +35,28 @@\n  *\n  * <p>This class iterates through matching JARs, rather than looking directly at itself, to support\n  * the use case where OSS services are being extended via a library pattern.\n+ *\n+ * <p>This class also supports reading the custom attribute `Implementation-OSS-Version`. This\n+ * attribute is useful if JARs are built in a process outside the context of OSS, but you need a\n+ * mechanism to get the underlining OSS version.\n  */\n @Slf4j\n public class ManifestVersionResolver implements VersionResolver {\n \n   private static final String GROUP = \"com.netflix.spinnaker\";\n \n   private final String group;\n+  private boolean ossAttribute = false;", "originalCommit": "51dd25a8e91b9aaeb2de41eb1d56ab9914f12aeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1NjIyMQ==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r382756221", "bodyText": "Actually, my original intention here was to not fallback to Implementation-Version if Implementation-OSS-Version is desired (which I didn't do, got distracted but I will revisit this now).  I don't think we want to fallback if the OSS version is desired since that'll basically throw off all our service version constraint stuff.", "author": "jonsie", "createdAt": "2020-02-21T19:10:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Mzc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjgxOTc1MQ==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r382819751", "bodyText": "This will now not fall through to Implementation-Version if the property use-oss-version-manifest-attribute is set in spinnaker.extensibility.", "author": "jonsie", "createdAt": "2020-02-21T21:43:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Mzc3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2OTczNQ==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r384069735", "bodyText": "nit: How about spinnaker.extensibility.versioning.use-oss-version-manifest-attribute instead? I suspect we'll end up having other config informing Spinnaker how to resolve versions in the future, it'd be nice to have them all under one place.", "author": "robzienert", "createdAt": "2020-02-25T19:14:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjc1Mzc3MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1be4e265364e63e271ca164b02c2d2f9dbe5cce4", "url": "https://github.com/spinnaker/kork/commit/1be4e265364e63e271ca164b02c2d2f9dbe5cce4", "message": "fix(plugins): Ignore case, remove unnecessary run block, change oss version logic in ManifestVersionResolver, better comments", "committedDate": "2020-02-21T20:00:17Z", "type": "commit"}, {"oid": "06a9782238b96ace9d4c1c184ccaeb7af1302dad", "url": "https://github.com/spinnaker/kork/commit/06a9782238b96ace9d4c1c184ccaeb7af1302dad", "message": "fix(plugins): Service version resolution configuration", "committedDate": "2020-02-21T21:30:29Z", "type": "commit"}, {"oid": "52242677a8fef47d491cc4653c1b4828ae6b3f44", "url": "https://github.com/spinnaker/kork/commit/52242677a8fef47d491cc4653c1b4828ae6b3f44", "message": "fix(plugins): Use the Binder API for service resolution boolean instead of ConfigResolver", "committedDate": "2020-02-21T21:41:40Z", "type": "commit"}, {"oid": "03b2dc51217299307d75e9a26470a8efbeb743b9", "url": "https://github.com/spinnaker/kork/commit/03b2dc51217299307d75e9a26470a8efbeb743b9", "message": "fix(plugins): Use the Binder API for service resolution boolean instead of ConfigResolver", "committedDate": "2020-02-21T21:42:19Z", "type": "commit"}, {"oid": "3ed35718bcaf22e826b71b714511a60b007b8a58", "url": "https://github.com/spinnaker/kork/commit/3ed35718bcaf22e826b71b714511a60b007b8a58", "message": "Merge branch 'master' into feat-plugin-versions", "committedDate": "2020-02-25T02:51:19Z", "type": "commit"}, {"oid": "9735a2728e66c63301e99f6133014fd71ea0b091", "url": "https://github.com/spinnaker/kork/commit/9735a2728e66c63301e99f6133014fd71ea0b091", "message": "fix(plugins): Big refactor to support mutliple mechanisms for determing plugin releases and also pre-existing plugins on the filesystem", "committedDate": "2020-02-25T18:21:41Z", "type": "commit"}, {"oid": "c6c3a8fcd729e9ac1c113647b6fe5f00f8be2a6c", "url": "https://github.com/spinnaker/kork/commit/c6c3a8fcd729e9ac1c113647b6fe5f00f8be2a6c", "message": "fix(plugins): Spotless", "committedDate": "2020-02-25T18:28:16Z", "type": "commit"}, {"oid": "2a037be30609e3a0b3cb6c863743db0698a05ca8", "url": "https://github.com/spinnaker/kork/commit/2a037be30609e3a0b3cb6c863743db0698a05ca8", "message": "Merge branch 'master' into feat-plugin-versions", "committedDate": "2020-02-25T19:12:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3MjEwOA==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r384072108", "bodyText": "Worded a little confusingly. Perhaps:\n\nDefines what MANIFEST.MF attribute to use in determining a service version. By default, a service version is determined by reading the \"Implementation-Version\" attribute. If this property is set to true, however, \"Implementation-OSS-Version\" will be used to support use cases where services are being extended and rebuilt. Unless you're re-building services, this should remain its default value.", "author": "robzienert", "createdAt": "2020-02-25T19:19:08Z", "path": "kork-plugins/src/main/java/com/netflix/spinnaker/config/PluginsConfigurationProperties.java", "diffHunk": "@@ -98,4 +98,12 @@ public boolean isEnabled() {\n       return enabled;\n     }\n   }\n+\n+  /**\n+   * If set to true, the service version resolution will use the MANIFEST.MF attribute\n+   * \"Implementation-OSS-Version\". By default, this is false which means the version attribute\n+   * lookup will be \"Implementation-Version\" -- for most OSS users that will still be the OSS\n+   * version.", "originalCommit": "2a037be30609e3a0b3cb6c863743db0698a05ca8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEwMDM5OA==", "url": "https://github.com/spinnaker/kork/pull/526#discussion_r384100398", "bodyText": "Appreciated.", "author": "jonsie", "createdAt": "2020-02-25T20:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA3MjEwOA=="}], "type": "inlineReview", "revised_code": {"commit": "56c3200b169d4509788739d505212f56001da0de", "chunk": "diff --git a/kork-plugins/src/main/java/com/netflix/spinnaker/config/PluginsConfigurationProperties.java b/kork-plugins/src/main/java/com/netflix/spinnaker/config/PluginsConfigurationProperties.java\nindex 7ea6a936..8bca1902 100644\n--- a/kork-plugins/src/main/java/com/netflix/spinnaker/config/PluginsConfigurationProperties.java\n+++ b/kork-plugins/src/main/java/com/netflix/spinnaker/config/PluginsConfigurationProperties.java\n\n@@ -100,10 +100,11 @@ public class PluginsConfigurationProperties {\n   }\n \n   /**\n-   * If set to true, the service version resolution will use the MANIFEST.MF attribute\n-   * \"Implementation-OSS-Version\". By default, this is false which means the version attribute\n-   * lookup will be \"Implementation-Version\" -- for most OSS users that will still be the OSS\n-   * version.\n+   * Defines what MANIFEST.MF attribute to use in determining a service version. By default, a\n+   * service version is determined by reading the \"Implementation-Version\" attribute. If this\n+   * property is set to true, however, \"Implementation-OSS-Version\" will be used to support use\n+   * cases where services are being extended and rebuilt. Unless you're re-building services, this\n+   * should remain its default value.\n    */\n   public boolean useOssVersionManifestAttribute;\n }\n"}}, {"oid": "56c3200b169d4509788739d505212f56001da0de", "url": "https://github.com/spinnaker/kork/commit/56c3200b169d4509788739d505212f56001da0de", "message": "fix(plugins): Add PropertySourcePluginReleaseProviderTest", "committedDate": "2020-02-25T23:26:06Z", "type": "commit"}, {"oid": "60bebe9cd79b5896f4c78bd84f3a37e82e34350c", "url": "https://github.com/spinnaker/kork/commit/60bebe9cd79b5896f4c78bd84f3a37e82e34350c", "message": "fix(plugins): Slight renaming of things", "committedDate": "2020-02-26T00:03:42Z", "type": "commit"}, {"oid": "340f0b0da28656b25f35f7d54e590aeacb946cc3", "url": "https://github.com/spinnaker/kork/commit/340f0b0da28656b25f35f7d54e590aeacb946cc3", "message": "fix(plugins): SpinnakerUpdateManagerTest", "committedDate": "2020-02-26T01:15:34Z", "type": "commit"}, {"oid": "b1dd32e3e631b45cbab52654d4db01385635cfc9", "url": "https://github.com/spinnaker/kork/commit/b1dd32e3e631b45cbab52654d4db01385635cfc9", "message": "Merge branch 'master' into feat-plugin-versions", "committedDate": "2020-02-26T01:20:32Z", "type": "commit"}, {"oid": "35705cfb644e6f151e4c72bd86dc1c3e9723b7df", "url": "https://github.com/spinnaker/kork/commit/35705cfb644e6f151e4c72bd86dc1c3e9723b7df", "message": "fix(plugins): Add another test to SpinnakerUpdateManagerTest", "committedDate": "2020-02-26T01:40:26Z", "type": "commit"}]}