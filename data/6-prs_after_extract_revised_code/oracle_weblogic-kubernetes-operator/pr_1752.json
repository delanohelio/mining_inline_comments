{"pr_number": 1752, "pr_title": "Fix build application utility", "pr_createdAt": "2020-06-19T22:25:36Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1752", "timeline": [{"oid": "c0416089628ee2f824e4627cd1e247bd82ed2a79", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c0416089628ee2f824e4627cd1e247bd82ed2a79", "message": "Fixed the build application utility\n\nThe fix involves\nRemoving the persistent volumes for mounting application source directory\nto the pod , since PV_ROOT is shared only between the Kubernetes nodes and\nJenkins client doesn't have access to the PV_ROOT\n\nInstead of a Kubernetes job the utility will create a WebLogic pod and copies\nthe source application folder to the pod and builds the application.\n\nOnce built the archives directory is copied back to the local file system\nfor use by the test code.", "committedDate": "2020-06-19T21:29:54Z", "type": "commit"}, {"oid": "80674faa27b21f7fafb00055c4efba1af466c493", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/80674faa27b21f7fafb00055c4efba1af466c493", "message": "Fix javadoc and cleanup comments", "committedDate": "2020-06-19T22:20:56Z", "type": "commit"}, {"oid": "c694f0c4d7cb4361927debc852ec9c4cd964cc3b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c694f0c4d7cb4361927debc852ec9c4cd964cc3b", "message": "Handle the javax.net.ssl.SSLProtocolException: Connection or outbound has\nbeen closed exception when copying files from/to pod.", "committedDate": "2020-06-20T01:01:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2NTkwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1752#discussion_r443765905", "bodyText": "Can we just copy the ear/war file to WORK_DIR/your_application_name? /u01 is generally in the pod for our weblogic servers. So, it is a bit confusing.", "author": "bhavaniravichandran", "createdAt": "2020-06-22T19:03:10Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/BuildApplication.java", "diffHunk": "@@ -75,233 +52,176 @@\n \n   private static String image;\n   private static boolean isUseSecret;\n-  private static final String APPLICATIONS_MOUNT_PATH = \"/application\";\n-  private static final String SCRIPTS_MOUNT_PATH = \"/buildScripts\";\n+  private static final String APPLICATIONS_PATH = \"/u01/application\";\n   private static final String BUILD_SCRIPT = \"build_application.sh\";\n   private static final Path BUILD_SCRIPT_SOURCE_PATH = Paths.get(RESOURCE_DIR, \"bash-scripts\", BUILD_SCRIPT);\n \n-  private static final ConditionFactory withStandardRetryPolicy\n-      = with().pollDelay(2, SECONDS)\n-          .and().with().pollInterval(10, SECONDS)\n-          .atMost(5, MINUTES).await();\n-\n   /**\n    * Build application.\n    *\n-   * @param application path of the application source folder\n-   * @param parameters system properties for ant\n-   * @param targets ant targets to call\n-   * @param namespace name of the namespace to use for pvc\n+   * <p>The appSrcPath, your application source directory is zipped up and copied to a WebLogic server pod for building.\n+   * The application is built under /u01/application inside the pod. If your archives are placed under\n+   * /u01/application/build after building, use <b>build</b> as the archiveDistDir param value. This method copies the\n+   * folder /u01/application/<b>archiveDistDir</b> to local file system under\n+   * WORK_DIR/<b>your_application_name</b>/u01/application/<b>archiveDistDir</b>", "originalCommit": "c694f0c4d7cb4361927debc852ec9c4cd964cc3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc3Mjg5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1752#discussion_r443772890", "bodyText": "The Kubernetes java api Copy.copyDirectoryFromPod(...) returns the entire absolute path of the directory inside the pod and hence the /u01/application/...\nI can get rid of the /u01/application and can form a path like WORK_DIR/applicationName/archiveDistDir. Since we cannot put a restriction on what output directories the applications build system will use, the archiveDistDir  will be required parameter.", "author": "sankarpn", "createdAt": "2020-06-22T19:17:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2NTkwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc5MjI2MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1752#discussion_r443792261", "bodyText": "lgtm", "author": "bhavaniravichandran", "createdAt": "2020-06-22T19:58:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc2NTkwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "16a22133c36c1433e845366b44aaa5afdab5a0c2", "chunk": "diff --git a/new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/BuildApplication.java b/new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/BuildApplication.java\nindex 995359ff1d..5e62167cb5 100644\n--- a/new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/BuildApplication.java\n+++ b/new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/BuildApplication.java\n\n@@ -60,10 +60,9 @@ public class BuildApplication {\n    * Build application.\n    *\n    * <p>The appSrcPath, your application source directory is zipped up and copied to a WebLogic server pod for building.\n-   * The application is built under /u01/application inside the pod. If your archives are placed under\n-   * /u01/application/build after building, use <b>build</b> as the archiveDistDir param value. This method copies the\n-   * folder /u01/application/<b>archiveDistDir</b> to local file system under\n-   * WORK_DIR/<b>your_application_name</b>/u01/application/<b>archiveDistDir</b>\n+   * If your archives are placed under &lt application_source &gt /build after building, use <b>build</b> as the\n+   * archiveDistDir param value. This method copies the folder <b>archiveDistDir</b> to local file system and absolute\n+   * path of the <b>archiveDistDir</b> directory is returned by this method.\n    * <p> Example Usage: </p>\n \n    * <pre>{@literal\n"}}, {"oid": "16a22133c36c1433e845366b44aaa5afdab5a0c2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/16a22133c36c1433e845366b44aaa5afdab5a0c2", "message": "Return the entire path instead of a partial path to the build directory", "committedDate": "2020-06-22T19:50:28Z", "type": "commit"}, {"oid": "3f0e4077738a6cde4223a02e8316e8a025349344", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3f0e4077738a6cde4223a02e8316e8a025349344", "message": "Fix the archive location of clusterview.war", "committedDate": "2020-06-22T19:53:24Z", "type": "commit"}]}