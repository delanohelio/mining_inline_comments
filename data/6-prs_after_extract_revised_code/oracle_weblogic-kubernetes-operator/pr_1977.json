{"pr_number": 1977, "pr_title": "add tests for terminating SSL at LB to access console and servers", "pr_createdAt": "2020-10-12T15:56:48Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1977", "timeline": [{"oid": "fbbc485a950c30132b8f5bc32a7e2ac071043115", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fbbc485a950c30132b8f5bc32a7e2ac071043115", "message": "add tests for terminating ssl at LB to access console and servers", "committedDate": "2020-10-09T21:03:44Z", "type": "commit"}, {"oid": "fd34709e44f57fc9f4a056353a332991c2432b32", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fd34709e44f57fc9f4a056353a332991c2432b32", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-15T16:05:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNTM4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1977#discussion_r505705389", "bodyText": "As we discussed, can u pass extra headers in curl command while accessing the console as follows ...\n-H \"WL-Proxy-Client-IP: 120.1.1.0\" -H \"WL-Proxy-SSL: false\"  and make sure that this header does not appear in  adminserver log.\nTo get this header info you need to add the following DebugFlag on server startup args\n-Dweblogic.http.isWLProxyHeadersAccessible=true -Dweblogic.debug.DebugHttp=true -Dweblogic.StdoutDebugEnabled=true", "author": "anpanigr", "createdAt": "2020-10-15T17:09:47Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java", "diffHunk": "@@ -1761,38 +1962,53 @@ private static void deployApplication(String namespace, String domainUid, String\n     assertEquals(\"202\", result.stdout(), \"Deployment didn't return HTTP status code 202\");\n   }\n \n-  private void verifyAdminServerAccess(String domainUid) {\n-    String consoleUrl = new StringBuffer()\n-        .append(\"http://\")\n-        .append(K8S_NODEPORT_HOST)\n+  private void verifyAdminServerAccess(boolean isTLS,\n+                                       int lbNodePort,\n+                                       boolean isHostRouting,\n+                                       String ingressHostName,\n+                                       String pathLocation) {\n+\n+    StringBuffer consoleUrl = new StringBuffer();\n+    if (isTLS) {\n+      consoleUrl.append(\"https://\");\n+    } else {\n+      consoleUrl.append(\"http://\");\n+    }\n+    consoleUrl.append(K8S_NODEPORT_HOST)", "originalCommit": "fd34709e44f57fc9f4a056353a332991c2432b32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTk2NDk1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1977#discussion_r505964954", "bodyText": "fixed", "author": "xiancao", "createdAt": "2020-10-16T01:28:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTcwNTM4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "d8d70b5a6e9d7dc7499ee3a8f12b00348ca2873d", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java\nindex 829bbee7c3..263e325194 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java\n\n@@ -1987,7 +2006,12 @@ public class ItTwoDomainsLoadBalancers {\n       curlCmd = String.format(\"curl -ks --show-error --noproxy '*' -H 'host: %s' %s\",\n           ingressHostName, consoleUrl.toString());\n     } else {\n-      curlCmd = String.format(\"curl -ks --show-error --noproxy '*' %s\", consoleUrl.toString());\n+      if (isTLS) {\n+        curlCmd = String.format(\"curl -ks --show-error --noproxy '*' -H 'WL-Proxy-Client-IP: 1.2.3.4' \"\n+            + \"-H 'WL-Proxy-SSL: false' %s\", consoleUrl.toString());\n+      } else {\n+        curlCmd = String.format(\"curl -ks --show-error --noproxy '*' %s\", consoleUrl.toString());\n+      }\n     }\n \n     boolean consoleAccessible = false;\n"}}, {"oid": "d8d70b5a6e9d7dc7499ee3a8f12b00348ca2873d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d8d70b5a6e9d7dc7499ee3a8f12b00348ca2873d", "message": "address Pani's comments", "committedDate": "2020-10-16T01:25:57Z", "type": "commit"}, {"oid": "9a201c61a3cb44dc817bec595f0af4df36c59d35", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9a201c61a3cb44dc817bec595f0af4df36c59d35", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-16T01:26:16Z", "type": "commit"}, {"oid": "84b155f9ef3d07df15e773c487f27017cbd8b20d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/84b155f9ef3d07df15e773c487f27017cbd8b20d", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-16T19:58:08Z", "type": "commit"}, {"oid": "48d644b6cbdbd23b61a6ec14d3b1bc70081450d7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/48d644b6cbdbd23b61a6ec14d3b1bc70081450d7", "message": "fix traefik annotation", "committedDate": "2020-10-16T21:41:00Z", "type": "commit"}, {"oid": "9265936bebbac5934a3402d4a2ecadc58f097ed4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9265936bebbac5934a3402d4a2ecadc58f097ed4", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-21T16:37:35Z", "type": "commit"}, {"oid": "790cb08ee8a8cbd45a330504481728e996e35232", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/790cb08ee8a8cbd45a330504481728e996e35232", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-21T20:44:04Z", "type": "commit"}, {"oid": "4c3fba947db3609ca578ab27ca573dc8b88baa58", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4c3fba947db3609ca578ab27ca573dc8b88baa58", "message": "add header in traefik ingress rules", "committedDate": "2020-10-22T21:38:07Z", "type": "commit"}, {"oid": "0339ee9a0fd6a479d87e4a517bbc485954627faf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0339ee9a0fd6a479d87e4a517bbc485954627faf", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-22T21:38:16Z", "type": "commit"}, {"oid": "73c76557424411362aece279b544feb45483d920", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/73c76557424411362aece279b544feb45483d920", "message": "cleanup", "committedDate": "2020-10-22T21:41:53Z", "type": "commit"}, {"oid": "e2c7b5cbc945632941b71e6ecba5ced7b5e462f3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e2c7b5cbc945632941b71e6ecba5ced7b5e462f3", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into xc-owls85070", "committedDate": "2020-10-22T22:17:40Z", "type": "commit"}]}