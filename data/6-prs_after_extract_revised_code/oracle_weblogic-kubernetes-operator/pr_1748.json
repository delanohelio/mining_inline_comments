{"pr_number": 1748, "pr_title": "OWLS-80884: Removing a Domain namespace from Operator TargetNamespace should not shutdown the domain", "pr_createdAt": "2020-06-18T20:14:49Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1748", "timeline": [{"oid": "e4a5451ecc7b48c649c67fd0900410ec9dfb2a13", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e4a5451ecc7b48c649c67fd0900410ec9dfb2a13", "message": "Verify all namespaces listed in 'isNameSpaceStopping' map to see if they're running", "committedDate": "2020-06-14T17:30:40Z", "type": "commit"}, {"oid": "52a6abac8c813b557d125c4d5089616e1520c061", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/52a6abac8c813b557d125c4d5089616e1520c061", "message": "modify behavior so that Operator does not shudown domain resource when namespace removed from targetNamespace list", "committedDate": "2020-06-18T17:14:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MzAzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1748#discussion_r442483032", "bodyText": "Should we rename isNamespaceStopping field in Main to something else, such as isNamespaceStoppingMap to avoid having same name?", "author": "alai8", "createdAt": "2020-06-18T20:25:57Z", "path": "operator/src/main/java/oracle/kubernetes/operator/Main.java", "diffHunk": "@@ -228,14 +228,23 @@ private static void completeBegin() {\n     }\n   }\n \n-  private static void stopNamespace(String ns, boolean remove) {\n-    processor.stopNamespace(ns);\n-    AtomicBoolean stopping =\n-        remove ? isNamespaceStopping.remove(ns) : isNamespaceStopping.get(ns);\n+  private static void stopNamespace(String ns, boolean inTargetNamespaceList) {\n+    AtomicBoolean isNamespaceStopping = isNamespaceStopping(ns);\n \n-    if (stopping != null) {\n-      stopping.set(true);\n+    // Remove if namespace not in targetNamespace list\n+    if (!inTargetNamespaceList) {\n+      Main.isNamespaceStopping.remove(ns);", "originalCommit": "52a6abac8c813b557d125c4d5089616e1520c061", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUwOTU1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1748#discussion_r442509556", "bodyText": "The name is really confusing. For example, we pass the keys from that map to the rest server:```\nstartRestServer(principal, isNamespaceStopping.keySet())\n\n\nwhen what we clearly mean is the list of all namespaces currently known. The problem is that it is a map of known namespace names to an atomic boolean which tells us if we are stopping that namespace, and there really isn't a good name for that. What that really suggests is that we ought to rethink the map itself, but that's a bit further off, I think.\n\nFor now, I would suggest dropping the \"is.\" The usual convention is to use the \"is\" prefix for methods returning booleans, but not for the corresponding fields.", "author": "russgold", "createdAt": "2020-06-18T21:21:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MzAzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUyMzgwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1748#discussion_r442523803", "bodyText": "Yes, changed field in Main to isNamespaceStoppingMap.", "author": "lennyphan", "createdAt": "2020-06-18T21:55:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MzAzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU0NDYzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1748#discussion_r442544632", "bodyText": "Dropped the 'is.' from the 'isNamespaceStoppingMap' field in Main and renamed to 'namespaceStoppingMap' as suggested by Russ.", "author": "lennyphan", "createdAt": "2020-06-18T22:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ4MzAzMg=="}], "type": "inlineReview", "revised_code": {"commit": "f9a5b1f1a75223155035c7cc5b5b47fd86369b8f", "chunk": "diff --git a/operator/src/main/java/oracle/kubernetes/operator/Main.java b/operator/src/main/java/oracle/kubernetes/operator/Main.java\nindex 0567129cb9..5c22f4bf19 100644\n--- a/operator/src/main/java/oracle/kubernetes/operator/Main.java\n+++ b/operator/src/main/java/oracle/kubernetes/operator/Main.java\n\n@@ -233,7 +233,7 @@ public class Main {\n \n     // Remove if namespace not in targetNamespace list\n     if (!inTargetNamespaceList) {\n-      Main.isNamespaceStopping.remove(ns);\n+      isNamespaceStoppingMap.remove(ns);\n     }\n \n     // stop all Domains for namespace being stopped (not active)\n"}}, {"oid": "f9a5b1f1a75223155035c7cc5b5b47fd86369b8f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f9a5b1f1a75223155035c7cc5b5b47fd86369b8f", "message": "Rename isNamespaceStopping field in Main to isNamespaceStoppingMap", "committedDate": "2020-06-18T21:54:36Z", "type": "commit"}, {"oid": "c960b1505cb5568973bf960a7f0a75744561ff2c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c960b1505cb5568973bf960a7f0a75744561ff2c", "message": "Resolve conflict with latest develop changes", "committedDate": "2020-06-18T22:06:33Z", "type": "commit"}, {"oid": "ea63263289b2ed68f28c1a87785fe86095c04119", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ea63263289b2ed68f28c1a87785fe86095c04119", "message": "Dropped the 'is.' from the 'isNamespaceStoppingMap' field in Main and rename to 'namespaceStoppingMap'", "committedDate": "2020-06-18T22:53:04Z", "type": "commit"}]}