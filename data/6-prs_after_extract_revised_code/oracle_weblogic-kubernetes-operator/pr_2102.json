{"pr_number": 2102, "pr_title": "Added Operator Upgrade Integration tests for FMW Domain", "pr_createdAt": "2020-12-16T00:21:16Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102", "timeline": [{"oid": "7c7b12efddeae425aaca222cc76c2c78669b5134", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7c7b12efddeae425aaca222cc76c2c78669b5134", "message": "Added Operator Upgrade Integration tests for FMW Domain", "committedDate": "2020-12-16T00:16:05Z", "type": "commit"}, {"oid": "065a19ca634863247ce19fb0d5d0a654d191e253", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/065a19ca634863247ce19fb0d5d0a654d191e253", "message": "Moved helpers to commom util class", "committedDate": "2020-12-17T04:08:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMzY3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545313679", "bodyText": "remove commented code", "author": "anpanigr", "createdAt": "2020-12-17T18:35:43Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java", "diffHunk": "@@ -265,7 +261,14 @@ private void upgradeOperator(String operatorVersion, String externalServiceNameS\n     if (useHelmUpgrade) {\n       // application high availability check only for 3.x releases and later\n       // deploy application and access the application once to make sure the app is accessible\n-      deployAndAccessApplication(domainNamespace, externalServiceNameSuffix);\n+      //deployAndAccessApplication(domainNamespace, externalServiceNameSuffix);", "originalCommit": "065a19ca634863247ce19fb0d5d0a654d191e253", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ4NjU1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545486555", "bodyText": "done", "author": "hzhao-github", "createdAt": "2020-12-18T00:05:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMzY3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "ece0db7faf923c5af25647c1eb73ff8b77d2ed8a", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\nindex 4dd34a96a5..4fdd99bda8 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n\n@@ -259,16 +260,16 @@ public class ItOperatorUpgrade {\n         domainNamespace, operatorVersion, externalServiceNameSuffix);\n \n     if (useHelmUpgrade) {\n-      // application high availability check only for 3.x releases and later\n       // deploy application and access the application once to make sure the app is accessible\n-      //deployAndAccessApplication(domainNamespace, externalServiceNameSuffix);\n-      deployAndAccessApplication(externalServiceNameSuffix,\n-                                 domainNamespace,\n+      deployAndAccessApplication(domainNamespace,\n                                  domainUid,\n                                 \"cluster-1\",\n+                                \"admin-server\",\n                                  adminServerPodName,\n                                  managedServerPodNamePrefix,\n-                                 replicaCount);\n+                                 replicaCount,\n+                                \"7001\",\n+                                \"8001\");\n \n       // start a new thread to collect the availability data of the application while the\n       // main thread performs operator upgrade\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDY5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545314696", "bodyText": "Why are we removing this method ?", "author": "anpanigr", "createdAt": "2020-12-17T18:37:24Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java", "diffHunk": "@@ -176,21 +187,6 @@ public void testOperatorUpgradeFrom3_0_3(@Namespaces(3) List<String> namespaces)\n     upgradeOperator(\"3.0.3\", OLD_DEFAULT_EXTERNAL_SERVICE_NAME_SUFFIX, true);\n   }\n \n-  /**", "originalCommit": "065a19ca634863247ce19fb0d5d0a654d191e253", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMTg3Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545321873", "bodyText": "what are you talking about, it's still there\n@test\n@DisplayName(\"Upgrade Operator from 3.0.3 to latest\")\npublic void testOperatorUpgradeFrom3_0_3(@namespaces(3) List namespaces) {\nthis.namespaces = namespaces;\nupgradeOperator(\"3.0.3\", OLD_DEFAULT_EXTERNAL_SERVICE_NAME_SUFFIX, true);\n}", "author": "hzhao-github", "createdAt": "2020-12-17T18:48:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0NzgxNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545447814", "bodyText": "you are removing testOperatorUpgradeFrom3_0_4, add it back", "author": "vanajamukkara", "createdAt": "2020-12-17T22:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDY5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ5NDAxOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545494018", "bodyText": "done", "author": "hzhao-github", "createdAt": "2020-12-18T00:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDY5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "ece0db7faf923c5af25647c1eb73ff8b77d2ed8a", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\nindex 4dd34a96a5..4fdd99bda8 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n\n@@ -187,6 +173,21 @@ public class ItOperatorUpgrade {\n     upgradeOperator(\"3.0.3\", OLD_DEFAULT_EXTERNAL_SERVICE_NAME_SUFFIX, true);\n   }\n \n+  /**\n+   * Operator upgrade from 3.0.4 to latest.\n+   * Install 3.0.4 Operator from GitHub chart repository and create a domain.\n+   * Deploy an application to the cluster in domain and verify the application can be\n+   * accessed while the operator is upgraded and after the upgrade.\n+   * Upgrade operator with latest Operator image and verify CRD version and image are updated\n+   * and the domain can be managed by scaling the cluster using operator REST api.\n+   */\n+  @Test\n+  @DisplayName(\"Upgrade Operator from 3.0.4 to latest\")\n+  public void testOperatorUpgradeFrom3_0_4(@Namespaces(3) List<String> namespaces) {\n+    this.namespaces = namespaces;\n+    upgradeOperator(\"3.0.4\", OLD_DEFAULT_EXTERNAL_SERVICE_NAME_SUFFIX, true);\n+  }\n+\n   /**\n    * Operator upgrade from 3.1.0 to latest.\n    * Install 3.1.0 Operator from GitHub chart repository and create a domain.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQzOTUzMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545439530", "bodyText": "We do not need upgrade from Release 2.5.0. This test case should be removed.", "author": "anpanigr", "createdAt": "2020-12-17T22:17:20Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java", "diffHunk": "@@ -102,6 +99,19 @@ public static void init() {\n \n   }\n \n+  /**", "originalCommit": "065a19ca634863247ce19fb0d5d0a654d191e253", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0NTMyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545445328", "bodyText": "yes, remove it ..", "author": "vanajamukkara", "createdAt": "2020-12-17T22:29:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQzOTUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ5NTQyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r545495421", "bodyText": "it's removed in develop branch. I just synced with it", "author": "hzhao-github", "createdAt": "2020-12-18T00:32:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQzOTUzMA=="}], "type": "inlineReview", "revised_code": {"commit": "ece0db7faf923c5af25647c1eb73ff8b77d2ed8a", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\nindex 4dd34a96a5..4fdd99bda8 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java\n\n@@ -99,19 +99,6 @@ public class ItOperatorUpgrade {\n \n   }\n \n-  /**\n-   * Operator upgrade from 2.5.0 to latest.\n-   * Install 2.5.0 release Operator from GitHub chart repository and create a domain.\n-   * Delete Operator and install latest Operator and verify CRD version is updated\n-   * and the domain can be managed by scaling the cluster using operator REST api.\n-   */\n-  @Test\n-  @DisplayName(\"Upgrade Operator from 2.5.0 to latest\")\n-  public void testOperatorUpgradeFrom2_5_0(@Namespaces(3) List<String> namespaces) {\n-    this.namespaces = namespaces;\n-    upgradeOperator(\"2.5.0\", OLD_DEFAULT_EXTERNAL_SERVICE_NAME_SUFFIX, false);\n-  }\n-\n   /**\n    * Operator upgrade from 2.6.0 to latest.\n    * Install 2.6.0 Operator from GitHub chart repository and create a domain.\n"}}, {"oid": "ece0db7faf923c5af25647c1eb73ff8b77d2ed8a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ece0db7faf923c5af25647c1eb73ff8b77d2ed8a", "message": "Added more test cases", "committedDate": "2020-12-21T06:14:55Z", "type": "commit"}, {"oid": "fefadfe7a09a0823ebe4bedd0af2ca87875fb0c5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fefadfe7a09a0823ebe4bedd0af2ca87875fb0c5", "message": "fixed the copyright", "committedDate": "2021-01-06T00:58:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjU5NDU0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r552594542", "bodyText": "\"Oracle Corporation\" -> \"Oracle\". Legal changed the required licensing text.", "author": "rjeberhard", "createdAt": "2021-01-06T13:11:38Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOpUpgradeFmwDomainInPV.java", "diffHunk": "@@ -0,0 +1,684 @@\n+// Copyright (c) 2020, 2021, Oracle Corporation and/or its affiliates.", "originalCommit": "fefadfe7a09a0823ebe4bedd0af2ca87875fb0c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAyNjI0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r553026240", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2021-01-07T00:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjU5NDU0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "aed50e48f4ef89220b5dad8de8efd4f87dabf164", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOpUpgradeFmwDomainInPV.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOpUpgradeFmwDomainInPV.java\nindex 7e8ca5a253..255e596b43 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOpUpgradeFmwDomainInPV.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOpUpgradeFmwDomainInPV.java\n\n@@ -1,4 +1,4 @@\n-// Copyright (c) 2020, 2021, Oracle Corporation and/or its affiliates.\n+// Copyright (c) 2020, 2021, Oracle and/or its affiliates.\n // Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n \n package oracle.weblogic.kubernetes;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjU5NTA0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r552595048", "bodyText": "Fix license year: \"2020,\" becomes \"2020, 2021,\"", "author": "rjeberhard", "createdAt": "2021-01-06T13:12:40Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItOperatorUpgrade.java", "diffHunk": "@@ -39,25 +39,22 @@\n import static oracle.weblogic.kubernetes.TestConstants.RESULTS_ROOT;\n import static oracle.weblogic.kubernetes.TestConstants.WDT_BASIC_IMAGE_NAME;\n import static oracle.weblogic.kubernetes.TestConstants.WDT_BASIC_IMAGE_TAG;\n-import static oracle.weblogic.kubernetes.actions.ActionConstants.ITTESTS_DIR;", "originalCommit": "fefadfe7a09a0823ebe4bedd0af2ca87875fb0c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzAyNjE3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2102#discussion_r553026177", "bodyText": "fixed after sync with develop", "author": "hzhao-github", "createdAt": "2021-01-07T00:03:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjU5NTA0OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "aed50e48f4ef89220b5dad8de8efd4f87dabf164", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/aed50e48f4ef89220b5dad8de8efd4f87dabf164", "message": "fixed copyright", "committedDate": "2021-01-07T00:00:42Z", "type": "commit"}]}