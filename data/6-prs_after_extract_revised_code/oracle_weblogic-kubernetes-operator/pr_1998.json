{"pr_number": 1998, "pr_title": "Fix ENV variable setting in JRF domain in PV test class", "pr_createdAt": "2020-10-20T01:54:12Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998", "timeline": [{"oid": "c123e21ed78c971a241d96cf66a3a5d35db8ab74", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c123e21ed78c971a241d96cf66a3a5d35db8ab74", "message": "debug JAVA_HOME issue for fmw image", "committedDate": "2020-10-16T18:25:27Z", "type": "commit"}, {"oid": "b65392692114355ac71f0e030d690a600346ec73", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b65392692114355ac71f0e030d690a600346ec73", "message": "fix hard coded env var", "committedDate": "2020-10-16T23:14:05Z", "type": "commit"}, {"oid": "7410bfeb7d26eaaf19458dae5b686be723184980", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7410bfeb7d26eaaf19458dae5b686be723184980", "message": "debugging", "committedDate": "2020-10-17T00:59:20Z", "type": "commit"}, {"oid": "8ff3c2bf04b4c9f313321053478ecf4fc25eb66d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8ff3c2bf04b4c9f313321053478ecf4fc25eb66d", "message": "debugging", "committedDate": "2020-10-17T03:48:23Z", "type": "commit"}, {"oid": "5b8c1d2824828116847d4285c96d2852fe6f260b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5b8c1d2824828116847d4285c96d2852fe6f260b", "message": "refactor the code", "committedDate": "2020-10-19T18:34:57Z", "type": "commit"}, {"oid": "2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd", "message": "delete the extra space line", "committedDate": "2020-10-19T18:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzNTM1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r508635350", "bodyText": "Can you check if the command is executed successfully or not by asserting the exit code or not null return string from exec command", "author": "anpanigr", "createdAt": "2020-10-20T15:49:24Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java", "diffHunk": "@@ -121,4 +125,26 @@ public static JsonObject createDockerConfigJson(String username, String password\n     configJsonObject.add(\"auths\", registryObject);\n     return configJsonObject;\n   }\n+\n+  /**\n+   * Get environment variable from docker image.\n+   * @param imageName image name\n+   * @param envVarName environment variable name\n+   * @return environment variable in the image\n+   */\n+  public static String getImageEnvVar(String imageName, String envVarName) {\n+    LoggingFacade logger = getLogger();\n+    String cmdToExecute = String.format(\"docker run %s /bin/bash -c 'echo \\\"$%s\\\"'\", imageName, envVarName);\n+    logger.info(\"getImageEnvVar with imageName: {0}, envVarName: {1}\", imageName, envVarName);\n+    ExecResult result = Command.withParams(\n+                              new CommandParams()\n+                                .command(cmdToExecute)\n+                                .saveResults(true)\n+                                .redirect(true)\n+                            ).executeAndReturnResult();", "originalCommit": "2a7fff0c63252a23bac20e24e2c082dbbb2ddbfd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM5MDE1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509390150", "bodyText": "Done", "author": "maggiehe00", "createdAt": "2020-10-21T15:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODYzNTM1MA=="}], "type": "inlineReview", "revised_code": {"commit": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java\nindex 97aee4da8d..bc2d3bb210 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Docker.java\n\n@@ -142,7 +142,10 @@ public class Docker {\n                                 .saveResults(true)\n                                 .redirect(true)\n                             ).executeAndReturnResult();\n-    String envVar  = result.stdout();\n+    String envVar  = null;\n+    if (result != null && result.exitValue() == 0) {\n+      envVar = result.stdout();\n+    }\n     logger.info(\"getImageEnvVar returns result: {0}, envVar: {1} \", result, envVar);\n     return envVar;\n \n"}}, {"oid": "54d3fa2a63a939b63c9b63fae9ae614b7d317b36", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/54d3fa2a63a939b63c9b63fae9ae614b7d317b36", "message": "Merge remote-tracking branch 'origin/develop' into jrfjava", "committedDate": "2020-10-20T19:06:15Z", "type": "commit"}, {"oid": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "message": "address the review comment", "committedDate": "2020-10-20T20:17:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU2OTg4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509569881", "bodyText": "you can assert for null", "author": "vanajamukkara", "createdAt": "2020-10-21T18:44:19Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,16 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");", "originalCommit": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwODAyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509608021", "bodyText": "Done", "author": "maggiehe00", "createdAt": "2020-10-21T19:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU2OTg4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "857f2415386631dfcf07520c34b4273bfa366ef6", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\nindex c7b38fa62d..0c89b2fe12 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n\n@@ -178,8 +178,12 @@ public class ItJrfDomainInPV {\n         \"Failed to create domain properties file\");\n \n     //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");\n     oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n     logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n+        \"envVar from image is null\");\n     java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");\n     logger.info(\"JAVA_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, java_home);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU3MDA0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509570049", "bodyText": "add assert for null", "author": "vanajamukkara", "createdAt": "2020-10-21T18:44:30Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,16 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n+    logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");", "originalCommit": "28ffbc4c9a6a7f2b5b9d3cf5da25f0e0f2546510", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwODA4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509608087", "bodyText": "Done", "author": "maggiehe00", "createdAt": "2020-10-21T19:27:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU3MDA0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "857f2415386631dfcf07520c34b4273bfa366ef6", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\nindex c7b38fa62d..0c89b2fe12 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n\n@@ -178,8 +178,12 @@ public class ItJrfDomainInPV {\n         \"Failed to create domain properties file\");\n \n     //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");\n     oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n     logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n+        \"envVar from image is null\");\n     java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");\n     logger.info(\"JAVA_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, java_home);\n \n"}}, {"oid": "857f2415386631dfcf07520c34b4273bfa366ef6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/857f2415386631dfcf07520c34b4273bfa366ef6", "message": "address the review comment", "committedDate": "2020-10-21T19:25:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYzOTY4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509639682", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"envVar from image is null\");\n          \n          \n            \n                    \"envVar ORACLE_HOME from image is null\");", "author": "vanajamukkara", "createdAt": "2020-10-21T20:03:54Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,20 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");", "originalCommit": "857f2415386631dfcf07520c34b4273bfa366ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY1NDc4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509654783", "bodyText": "Done. Thanks!", "author": "maggiehe00", "createdAt": "2020-10-21T20:15:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYzOTY4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f0be5706269c598f3ec98576840618dbea6e7a8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\nindex 0c89b2fe12..bc8434aefb 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n\n@@ -179,11 +179,11 @@ public class ItJrfDomainInPV {\n \n     //get ENV variable from the image\n     assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n-        \"envVar from image is null\");\n+        \"envVar ORACLE_HOME from image is null\");\n     oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n     logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n     assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n-        \"envVar from image is null\");\n+        \"envVar JAVA_HOME from image is null\");\n     java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");\n     logger.info(\"JAVA_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, java_home);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY0MDI2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509640268", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"envVar from image is null\");\n          \n          \n            \n                    \"envVar JAVA_HOME from image is null\");", "author": "vanajamukkara", "createdAt": "2020-10-21T20:04:22Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java", "diffHunk": "@@ -173,9 +176,20 @@ public void testJrfDomainInPvUsingWlst() {\n     File domainPropertiesFile = assertDoesNotThrow(() ->\n             File.createTempFile(\"domain\", \"properties\"),\n         \"Failed to create domain properties file\");\n+\n+    //get ENV variable from the image\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n+        \"envVar from image is null\");\n+    oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n+    logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n+    assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n+        \"envVar from image is null\");", "originalCommit": "857f2415386631dfcf07520c34b4273bfa366ef6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY1NDQ0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1998#discussion_r509654445", "bodyText": "Done. Thanks!", "author": "maggiehe00", "createdAt": "2020-10-21T20:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY0MDI2OA=="}], "type": "inlineReview", "revised_code": {"commit": "f0be5706269c598f3ec98576840618dbea6e7a8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\nindex 0c89b2fe12..bc8434aefb 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItJrfDomainInPV.java\n\n@@ -179,11 +179,11 @@ public class ItJrfDomainInPV {\n \n     //get ENV variable from the image\n     assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\"),\n-        \"envVar from image is null\");\n+        \"envVar ORACLE_HOME from image is null\");\n     oracle_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"ORACLE_HOME\");\n     logger.info(\"ORACLE_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, oracle_home);\n     assertNotNull(getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\"),\n-        \"envVar from image is null\");\n+        \"envVar JAVA_HOME from image is null\");\n     java_home = getImageEnvVar(FMWINFRA_IMAGE_TO_USE_IN_SPEC, \"JAVA_HOME\");\n     logger.info(\"JAVA_HOME in image {0} is: {1}\", FMWINFRA_IMAGE_TO_USE_IN_SPEC, java_home);\n \n"}}, {"oid": "f0be5706269c598f3ec98576840618dbea6e7a8b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f0be5706269c598f3ec98576840618dbea6e7a8b", "message": "address the review comment", "committedDate": "2020-10-21T20:13:11Z", "type": "commit"}]}