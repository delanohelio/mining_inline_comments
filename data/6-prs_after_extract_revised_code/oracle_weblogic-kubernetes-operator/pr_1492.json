{"pr_number": 1492, "pr_title": "OWLS-79994: When scaling down the cluster with WLDF the number of replicas will go under the MinNumberOfServer", "pr_createdAt": "2020-03-24T20:58:05Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492", "timeline": [{"oid": "66589c5f739e42f6789d3c3116f5c7afc1162c26", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/66589c5f739e42f6789d3c3116f5c7afc1162c26", "message": "Prevent scaled down below configured minimum dynamic server count", "committedDate": "2020-03-21T20:15:01Z", "type": "commit"}, {"oid": "bbb4a7243295b6aef9006192a405c44244e4a5a7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bbb4a7243295b6aef9006192a405c44244e4a5a7", "message": "Add minimum cluster size to cluster status", "committedDate": "2020-03-22T19:44:04Z", "type": "commit"}, {"oid": "744c33cfafec787e17a2dc66fc39b0ed046c1cc9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/744c33cfafec787e17a2dc66fc39b0ed046c1cc9", "message": "Add updated artifacts", "committedDate": "2020-03-22T21:51:19Z", "type": "commit"}, {"oid": "a4fdf94fe48b17e832dc39e3999d3e2ef373cc53", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a4fdf94fe48b17e832dc39e3999d3e2ef373cc53", "message": "Update unit tests for minimum replicas", "committedDate": "2020-03-22T22:59:52Z", "type": "commit"}, {"oid": "22ce1abb25cbb3abefd32fa8735ba2ddd9f3d30e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/22ce1abb25cbb3abefd32fa8735ba2ddd9f3d30e", "message": "Merge latest from develop to get commits from OWLS-78058", "committedDate": "2020-03-24T17:36:00Z", "type": "commit"}, {"oid": "9539a222d4d40a221f7efd405389bc718ead8ecf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9539a222d4d40a221f7efd405389bc718ead8ecf", "message": "Fix copy constructor", "committedDate": "2020-03-24T18:21:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2Njk2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397566964", "bodyText": "i am not getting why this needs to be synchronized", "author": "markxnelson", "createdAt": "2020-03-25T01:59:27Z", "path": "operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java", "diffHunk": "@@ -163,6 +163,14 @@ public synchronized int getMaxClusterSize() {\n     return hasDynamicServers() ? getClusterSize() + getMaxDynamicClusterSize() : getClusterSize();\n   }\n \n+  /**\n+   * Returns the minimum size of the cluster.\n+   * @return  For static clusters, the minimum size can be 0.  Dynamic servers will return the configured value.\n+   */\n+  public synchronized int getMinClusterSize() {", "originalCommit": "9539a222d4d40a221f7efd405389bc718ead8ecf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4MDAzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397880034", "bodyText": "Agreed... Looks unnecessary.  What are we missing, @lennyphan ?", "author": "rjeberhard", "createdAt": "2020-03-25T14:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2Njk2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4Nzc5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397987793", "bodyText": "'synchronized' unnecessary.  My mistake from cut-paste and just overlooked it by accident.\nThanks.", "author": "lennyphan", "createdAt": "2020-03-25T16:20:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2Njk2NA=="}], "type": "inlineReview", "revised_code": {"commit": "9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "chunk": "diff --git a/operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java b/operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java\nindex 4891b17920..762770552f 100644\n--- a/operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java\n+++ b/operator/src/main/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfig.java\n\n@@ -167,7 +167,7 @@ public class WlsClusterConfig {\n    * Returns the minimum size of the cluster.\n    * @return  For static clusters, the minimum size can be 0.  Dynamic servers will return the configured value.\n    */\n-  public synchronized int getMinClusterSize() {\n+  public int getMinClusterSize() {\n     return hasDynamicServers() ? getMinDynamicClusterSize() : 0;\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NzQ4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397567481", "bodyText": "space after comma - weird that checkstyle did not get that", "author": "markxnelson", "createdAt": "2020-03-25T02:01:30Z", "path": "operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java", "diffHunk": "@@ -241,17 +248,16 @@ public void verifyMaxClusterSizeForDynamicCluster() {\n   @Test\n   public void verifyMaxClusterSizeForMixedCluster() {\n     WlsDynamicServersConfig wlsDynamicServersConfig =\n-        createDynamicServersConfig(1, 1, \"ms-\", \"cluster1\");\n+        createDynamicServersConfig(1, 1, 1,\"ms-\", \"cluster1\");\n     WlsClusterConfig wlsClusterConfig = new WlsClusterConfig(\"cluster1\", wlsDynamicServersConfig);\n     wlsClusterConfig.addServerConfig(createWlsServerConfig(\"ms-0\", 8011, null));\n \n     assertThat(wlsClusterConfig.getMaxClusterSize(), equalTo(2));\n   }\n \n-  @Test\n   public void verifyGetUpdateDynamicClusterSizeUrlIncludesClusterName() {\n     WlsDynamicServersConfig wlsDynamicServersConfig =\n-        createDynamicServersConfig(1, 1, \"ms-\", \"cluster1\");\n+        createDynamicServersConfig(1, 1, 1,\"ms-\", \"cluster1\");", "originalCommit": "9539a222d4d40a221f7efd405389bc718ead8ecf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4MTEzMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397881133", "bodyText": "I'll check... I wonder if Checkstyle is somehow not running again for test code.", "author": "rjeberhard", "createdAt": "2020-03-25T14:07:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NzQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk4Njk1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1492#discussion_r397986952", "bodyText": "added space after comma after minClusterSize parameter for all createDynamicServersConfig() methods.", "author": "lennyphan", "createdAt": "2020-03-25T16:19:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NzQ4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "chunk": "diff --git a/operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java b/operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java\nindex 4030ea558f..0b9b14c9e8 100644\n--- a/operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java\n+++ b/operator/src/test/java/oracle/kubernetes/operator/wlsconfig/WlsClusterConfigTest.java\n\n@@ -248,7 +248,7 @@ public class WlsClusterConfigTest {\n   @Test\n   public void verifyMaxClusterSizeForMixedCluster() {\n     WlsDynamicServersConfig wlsDynamicServersConfig =\n-        createDynamicServersConfig(1, 1, 1,\"ms-\", \"cluster1\");\n+        createDynamicServersConfig(1, 1, 1, \"ms-\", \"cluster1\");\n     WlsClusterConfig wlsClusterConfig = new WlsClusterConfig(\"cluster1\", wlsDynamicServersConfig);\n     wlsClusterConfig.addServerConfig(createWlsServerConfig(\"ms-0\", 8011, null));\n \n"}}, {"oid": "9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9ebf3d1fac9e722b58c20480b5840ed8e3cbd045", "message": "Resolved code review comments", "committedDate": "2020-03-25T16:15:51Z", "type": "commit"}]}