{"pr_number": 1605, "pr_title": "Attempt to clean up use of bad exec()", "pr_createdAt": "2020-04-28T11:47:18Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1605", "timeline": [{"oid": "b2043d4bd9e2408e937c4f62ab50e039f4e7b0b9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b2043d4bd9e2408e937c4f62ab50e039f4e7b0b9", "message": "add some debugging", "committedDate": "2020-04-27T18:57:21Z", "type": "commit"}, {"oid": "5edb8db5aca8810aadd48e970c29c052cbee75e3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5edb8db5aca8810aadd48e970c29c052cbee75e3", "message": "fix checkstyle errors", "committedDate": "2020-04-28T00:34:37Z", "type": "commit"}, {"oid": "fe110d259dc580b1a2cda88740d5fb25bef1db83", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fe110d259dc580b1a2cda88740d5fb25bef1db83", "message": "fix logging test", "committedDate": "2020-04-28T11:18:06Z", "type": "commit"}, {"oid": "90da85f34f49af79f89b4382c102cdfba1229082", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90da85f34f49af79f89b4382c102cdfba1229082", "message": "Merge branch 'it-resilience-2' of https://github.com/oracle/weblogic-kubernetes-operator into it-resilience-3", "committedDate": "2020-04-28T11:32:05Z", "type": "commit"}, {"oid": "7d0f5da7c3488da3861f718ef35cb9197864e94e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7d0f5da7c3488da3861f718ef35cb9197864e94e", "message": "Attempt to clean up use of bad exec()\n\nThis commit attempts to resolve a number of test failures that occur due\nto the bad use of the TestUtils.exec() method.  This method throws a\nRuntimeException if the return code of the executed command is non-zero.\nThis method is being used in many places (over 40).  Many of those do\nnot appear to need or want that behavior, and should instead be using\nthe ExecCommand.exec() method which executes a command and then returns\nthe result, without throwing an exception if the command fails.\n\nIn this commit, I have done a visual inspection of each use of\nTestUtils.exec() and changed them to ExecCommand.exec() where it\nappeared to make sense.  This includes every case where the call was\nusing the return value from the method, and those where it appears clear\nfrom the subsequent logic that a failed command was not expected to\nterminate the process.\n\nThere were some calls that I left because I could not be sure of the\nintent, and these will require more study.\n\nIn order to make the code clearer, and make people think twice about\nusing TestUtils.exec(), which has caused so many failures, I renamed\nthat method to TestUtils.execOrAbortProcess().  Hopefully that will make\nit clearer that that method has a dangerous and unexpected side effect.", "committedDate": "2020-04-28T11:41:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU2NTI0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1605#discussion_r416565244", "bodyText": "we looked into this test yesterday, this should be ExecCommand.exec() ?", "author": "vanajamukkara", "createdAt": "2020-04-28T12:18:13Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItElasticLogging.java", "diffHunk": "@@ -514,12 +516,14 @@ private String execSearchQuery(String queryCriteria, String index)\n             .append(\"'\")\n             .toString();\n     LoggerHelper.getLocal().log(Level.INFO, \"Command to search: \" + cmd);\n-    ExecResult result = TestUtils.exec(cmd);\n+    ExecResult result = TestUtils.execOrAbortProcess(cmd);", "originalCommit": "7d0f5da7c3488da3861f718ef35cb9197864e94e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "41a05dcd9a4fcd2cb97f2c9e37c6be58bf6e18df", "chunk": "diff --git a/integration-tests/src/test/java/oracle/kubernetes/operator/ItElasticLogging.java b/integration-tests/src/test/java/oracle/kubernetes/operator/ItElasticLogging.java\nindex c8f4d60c57..11c0cd7a94 100644\n--- a/integration-tests/src/test/java/oracle/kubernetes/operator/ItElasticLogging.java\n+++ b/integration-tests/src/test/java/oracle/kubernetes/operator/ItElasticLogging.java\n\n@@ -516,7 +516,7 @@ public class ItElasticLogging extends BaseTest {\n             .append(\"'\")\n             .toString();\n     LoggerHelper.getLocal().log(Level.INFO, \"Command to search: \" + cmd);\n-    ExecResult result = TestUtils.execOrAbortProcess(cmd);\n+    ExecResult result = ExecCommand.exec(cmd);\n \n     return result.stdout();\n   }\n"}}, {"oid": "41a05dcd9a4fcd2cb97f2c9e37c6be58bf6e18df", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/41a05dcd9a4fcd2cb97f2c9e37c6be58bf6e18df", "message": "Merge remote-tracking branch 'origin/develop' into it-resilience-3", "committedDate": "2020-04-28T14:15:34Z", "type": "commit"}]}