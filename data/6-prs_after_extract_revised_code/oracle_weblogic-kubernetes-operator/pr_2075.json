{"pr_number": 2075, "pr_title": "Updated the ItServerStartPolicy Tests to use new domain LifeCycle script instead of using patch commands", "pr_createdAt": "2020-11-26T02:17:22Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075", "timeline": [{"oid": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "message": "Updated the ItServerStartPolicy Tests to use new domain LifeCycle script instead of using patch commands", "committedDate": "2020-11-26T02:02:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2ODAyNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533468027", "bodyText": "Also verify startServer.sh can not start the admin server.  Invoke the script after shutting down the admin server thru parch command.", "author": "anpanigr", "createdAt": "2020-12-01T14:47:55Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -252,7 +280,8 @@ public void beforeEach() {\n    * Make sure that Only the Administration server is stopped. \n    * Restart the Administration server by patching the resource definition with \n    *  spec/adminServer/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the Administration server is in RUNNING state. \n+   * Make sure that the Administration server is in RUNNING state.\n+   * Verify that the sample script, stopServer.sh can not shutdown admin server", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxMjUyNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533612526", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T17:59:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ2ODAyNw=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -281,7 +284,7 @@ class ItServerStartPolicy {\n    * Restart the Administration server by patching the resource definition with \n    *  spec/adminServer/serverStartPolicy set to IF_NEEDED.\n    * Make sure that the Administration server is in RUNNING state.\n-   * Verify that the sample script, stopServer.sh can not shutdown admin server\n+   * Verify that the sample script, stopServer.sh can not start or shutdown admin server\n    */\n   @Test\n   @DisplayName(\"Restart the Administration server with serverStartPolicy\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3MjE0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533472149", "bodyText": "Can we move this common utility setupSample()  to beforeAll() method of the class.", "author": "anpanigr", "createdAt": "2020-12-01T14:51:56Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -291,15 +320,23 @@ public void testAdminServerRestart() {\n     checkPodReadyAndServiceExists(adminServerPodName, \n             domainUid, domainNamespace);\n     logger.info(\"AdminServer restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcyOTg5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533729893", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T21:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3MjE0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -319,13 +329,9 @@ class ItServerStartPolicy {\n         adminServerPodName, domainNamespace);\n     checkPodReadyAndServiceExists(adminServerPodName, \n             domainUid, domainNamespace);\n-    logger.info(\"AdminServer restart success\");\n-\n-    //copy the samples directory to a temporary location\n-    setupSample();\n \n     // verify that the sample script can not shutdown admin server\n-    String result =  assertDoesNotThrow(() ->\n+    result =  assertDoesNotThrow(() ->\n           executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, \"admin-server\", \"\", false),\n           String.format(\"Failed to run %s\", STOP_SERVER_SCRIPT));\n     assertTrue(result.contains(\"script doesn't support starting or stopping administration server\"),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3OTQ0MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533479441", "bodyText": "Remove the line#460:  logger.info(\"!!! Domain shutdown (NEVER) success !!!\");\nModify the line #492 logger.info(\"!!! Domain restart (IF_NEEDED) success !!!\"); into\nlogger.info(\"startDomain.sh successfully started the domain\");", "author": "anpanigr", "createdAt": "2020-12-01T15:00:54Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -400,8 +443,12 @@ public void testDomainRestart() {\n     String configServerPodName = domainUid + \"-config-cluster-server1\";\n     String standaloneServerPodName = domainUid + \"-standalone-managed\";\n \n-    patchServerStartPolicy(\"/spec/serverStartPolicy\", \"NEVER\");\n-    logger.info(\"Domain is patched to stop entire WebLogic domain\");\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify all WebLogic server instance pods are shut down after stopDomain script execution\n+    logger.info(\"Stop entire WebLogic domain using the script\");\n+    executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null);", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxMjcwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533612701", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T17:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3OTQ0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -443,9 +441,6 @@ class ItServerStartPolicy {\n     String configServerPodName = domainUid + \"-config-cluster-server1\";\n     String standaloneServerPodName = domainUid + \"-standalone-managed\";\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify all WebLogic server instance pods are shut down after stopDomain script execution\n     logger.info(\"Stop entire WebLogic domain using the script\");\n     executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUxMTY1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533511656", "bodyText": "Line # 496 Modify the line \"Add a second managed server\" to \"The domain custom resource has a second configured manged server with serverStartPolicy IF_NEEDED.", "author": "anpanigr", "createdAt": "2020-12-01T15:41:15Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -454,29 +500,39 @@ public void testDomainRestart() {\n    * by patching the resource definition with \n    *  spec/managedServers/1/serverStartPolicy set to ALWAYS.\n    * Make sure that managed server config-cluster-server2 is up and running\n+   * Verify that if server start policy is ALWAYS and the server is selected", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUxNzc0MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533517741", "bodyText": "The purpose of this method testConfigClusterStartServerUsingAlways\nMake sure when the serverStartPolicy is set to ALWAYS, it overrides the replica count. It means Operator always start the server.  On the other hand,  IF_NEEDED serverStartPolicy is constrained by replica count.\nSo in this usecases, we need not use the start/stop server script.", "author": "anpanigr", "createdAt": "2020-12-01T15:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUxMTY1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxMTA5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533611091", "bodyText": "I understand that. That's why I just inserted\nString result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\nassertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n\nto\n// Verify that if server start policy is ALWAYS and the server is selected\n// to start based on the replica count, it means that server is already started or is\n// in the process of starting. In this case, script exits without making any changes.", "author": "hzhao-github", "createdAt": "2020-12-01T17:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUxMTY1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -489,16 +481,15 @@ class ItServerStartPolicy {\n           domainUid, domainNamespace);\n     checkPodReadyAndServiceExists(standaloneServerPodName, \n           domainUid, domainNamespace);\n-    logger.info(\"!!! Domain restart (IF_NEEDED) success !!!\");\n+    logger.info(\"startDomain.sh successfully started the domain\");\n   }\n \n   /**\n-   * Add a second managed server (config-cluster-server2) in a configured \n-   * cluster with serverStartPolicy IF_NEEDED. \n-   * Initially, the server will not come up since the replica count is set to 1.\n+   * The domain custom resource has a second configured manged server with serverStartPolicy IF_NEEDED\n+   * Initially, the server will not come up since the replica count is set to 1\n    * Update the serverStartPolicy for config-cluster-server2 to ALWAYS\n    * by patching the resource definition with \n-   *  spec/managedServers/1/serverStartPolicy set to ALWAYS.\n+   *  spec/managedServers/1/serverStartPolicy set to ALWAYS\n    * Make sure that managed server config-cluster-server2 is up and running\n    * Verify that if server start policy is ALWAYS and the server is selected\n    * to start based on the replica count, it means that server is already started or is\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533536686", "bodyText": "See the comment for testConfigClusterStartServerUsingAlways(), the same is applicable to this method", "author": "anpanigr", "createdAt": "2020-12-01T16:12:28Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -492,15 +548,18 @@ public void testConfigClusterStartServerUsingAlways() {\n    * by patching the resource definition with \n    *  spec/managedServers/2/serverStartPolicy set to ALWAYS.\n    * Make sure that managed server managed-server2 is up and running\n+   * Verify that if server start policy is ALWAYS and the server is selected", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxMTUyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533611521", "bodyText": "same reason as above", "author": "hzhao-github", "createdAt": "2020-12-01T17:57:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzNjY4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2baf9f3c24 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -564,24 +552,19 @@ class ItServerStartPolicy {\n     // Make sure that managed server is not running \n     checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     \n-    patchServerStartPolicy(\"/spec/managedServers/2/serverStartPolicy\", \n-                           \"ALWAYS\");\n+    patchServerStartPolicy(\"/spec/managedServers/2/serverStartPolicy\",\"ALWAYS\");\n     logger.info(\"Domain resource patched to start the second managed server in dynamic cluster\");\n     checkPodReadyAndServiceExists(serverPodName, \n           domainUid, domainNamespace);\n     logger.info(\"Second managed server in dynamic cluster is RUNNING\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is ALWAYS and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n     String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n     assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n \n-    patchServerStartPolicy(\"/spec/managedServers/2/serverStartPolicy\", \n-                           \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/2/serverStartPolicy\",\"IF_NEEDED\");\n     logger.info(\"Domain resource patched to shutdown the second managed server in dynamic cluster\");\n \n     logger.info(\"Wait for managed server ${0} to be shutdown\", serverPodName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0MzAxMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533543010", "bodyText": "Remove the line 696 :  https://bug.****/pls/bug/webbug_print.show?c_rptno=31833260. The BUG has been resolved.", "author": "anpanigr", "createdAt": "2020-12-01T16:20:37Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -624,36 +687,45 @@ public void testDynamicClusterReplicaCountIsMaintained() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to ALWAYS.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is ALWAYS and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MjQwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533752405", "bodyText": "This line has not been deleted in your recent commit", "author": "anpanigr", "createdAt": "2020-12-01T22:05:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0MzAxMA=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -718,9 +700,6 @@ class ItServerStartPolicy {\n             domainUid, domainNamespace);\n     logger.info(\"Configured managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is ALWAYS and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0NDYwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533544604", "bodyText": "Do not use patch method (patchServerStartPolicy)  to stop/start independent managed server.  Use the script to stop/start managed server.\nModify the method name from testStandaloneManagedRestartAlways() to testStandaloneManagedRestart()", "author": "anpanigr", "createdAt": "2020-12-01T16:22:43Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -624,36 +687,45 @@ public void testDynamicClusterReplicaCountIsMaintained() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to ALWAYS.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is ALWAYS and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -718,9 +700,6 @@ class ItServerStartPolicy {\n             domainUid, domainNamespace);\n     logger.info(\"Configured managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is ALWAYS and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0Nzk2MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533547960", "bodyText": "I think, the test testStandaloneManagedRestartAlways() covers this usecase. We can delete this method.", "author": "anpanigr", "createdAt": "2020-12-01T16:27:05Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0ODYzMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533548630", "bodyText": "non-exist --> non-existing", "author": "anpanigr", "createdAt": "2020-12-01T16:28:01Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYxMjIyMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533612222", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T17:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0ODYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MDcwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533750701", "bodyText": "There are few more occurrences of the word \"non-exist server\"  such as line # 773, 779, 788", "author": "anpanigr", "createdAt": "2020-12-01T22:02:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0ODYzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2MTc3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533761776", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T22:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0ODYzMA=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0OTUwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533549500", "bodyText": "Modify the description for DisplayName()", "author": "anpanigr", "createdAt": "2020-12-01T16:29:12Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-exist server\n+   * (b) the sample script can not stop or start a non-exist cluster\n+   * (c) the sample script can not stop or start a non-exist domain.\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyMzA1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533623053", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T18:16:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0OTUwMA=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0OTY2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533549663", "bodyText": "Modify the description for DisplayName()\nModify method name to testStartMSBeyondLimitNeg to testStartMangedServerBeyondMaxClusyterLimit()\nAdd a method for DynamicCluster size limit.", "author": "anpanigr", "createdAt": "2020-12-01T16:29:25Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-exist server\n+   * (b) the sample script can not stop or start a non-exist cluster\n+   * (c) the sample script can not stop or start a non-exist domain.\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testRestartWrongComponentNeg() {\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyMzk5OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533623998", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T18:18:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0OTY2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1MDM5OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533550399", "bodyText": "Add the BUG number to the description", "author": "anpanigr", "createdAt": "2020-12-01T16:30:25Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-exist server\n+   * (b) the sample script can not stop or start a non-exist cluster\n+   * (c) the sample script can not stop or start a non-exist domain.\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testRestartWrongComponentNeg() {\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testStartMSBeyondLimitNeg() {\n+    String serverName = \"config-cluster-server3\";\n+    String regex = \".*\" + serverName + \".*\\\\s*is not part\";\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // verify that the script can not start a server that exceeds the max cluster size\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName, \"\", false),\n+        String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that is beyong the limit\");\n+  }\n+\n+  /**\n+   * Negative test to verify that after the admin server is stopped, the sample script can start or stop a server.", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYyNTE5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533625192", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T18:20:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1MDM5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1MTQ4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533551482", "bodyText": "Change the description\nIn the absence of Administration Server, sample script can start/stop a managed server.", "author": "anpanigr", "createdAt": "2020-12-01T16:31:56Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-exist server\n+   * (b) the sample script can not stop or start a non-exist cluster\n+   * (c) the sample script can not stop or start a non-exist domain.\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testRestartWrongComponentNeg() {\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testStartMSBeyondLimitNeg() {\n+    String serverName = \"config-cluster-server3\";\n+    String regex = \".*\" + serverName + \".*\\\\s*is not part\";\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // verify that the script can not start a server that exceeds the max cluster size\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName, \"\", false),\n+        String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that is beyong the limit\");\n+  }\n+\n+  /**\n+   * Negative test to verify that after the admin server is stopped, the sample script can start or stop a server.", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYzOTQ5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533639490", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T18:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1MTQ4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU5NzY1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533597658", "bodyText": "why is this a negative test? if you can start/stop a manager server without admin server, then it is a positive test.", "author": "vanajamukkara", "createdAt": "2020-12-01T17:36:50Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +735,175 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-exist server\n+   * (b) the sample script can not stop or start a non-exist cluster\n+   * (c) the sample script can not stop or start a non-exist domain.\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testRestartWrongComponentNeg() {\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Restart the configured cluster with serverStartPolicy\")\n+  public void testStartMSBeyondLimitNeg() {\n+    String serverName = \"config-cluster-server3\";\n+    String regex = \".*\" + serverName + \".*\\\\s*is not part\";\n+\n+    //copy the samples directory to a temporary location\n+    setupSample();\n+\n+    // verify that the script can not start a server that exceeds the max cluster size\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName, \"\", false),\n+        String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that is beyong the limit\");\n+  }\n+\n+  /**\n+   * Negative test to verify that after the admin server is stopped, the sample script can start or stop a server.", "originalCommit": "7c3df9ba24c4905a523bafdaf056b26771ce1b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzY4NDcxNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533684717", "bodyText": "yea. you are right, it's not a negative test. fixed", "author": "hzhao-github", "createdAt": "2020-12-01T19:59:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU5NzY1OA=="}], "type": "inlineReview", "revised_code": {"commit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 1be4e0c4fa..2b3c0e5531 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -766,9 +745,6 @@ class ItServerStartPolicy {\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n \n-    //copy the samples directory to a temporary location\n-    setupSample();\n-\n     // Verify that if server start policy is IF_NEEDED and the server is selected\n     // to start based on the replica count, it means that server is already started or is\n     // in the process of starting. In this case, script exits without making any changes.\n"}}, {"oid": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "message": "Changes based on comments", "committedDate": "2020-12-01T21:21:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MzM5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533753390", "bodyText": "Change the name to testRestartNonExistingComponent()", "author": "anpanigr", "createdAt": "2020-12-01T22:07:46Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +714,172 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-existing server\n+   * (b) the sample script can not stop or start a non-existing cluster\n+   * (c) the sample script can not stop or start a non-existing domain.\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not stop or start non-existing components\")\n+  public void testRestartWrongComponent() {", "originalCommit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2ODY3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533768679", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-12-01T22:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MzM5MA=="}], "type": "inlineReview", "revised_code": {"commit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2b3c0e5531..2baf9f3c24 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -719,8 +715,6 @@ class ItServerStartPolicy {\n    * to start based on the replica count, it means that server is already started or is\n    * in the process of starting. In this case, script exits without making any changes.\n    */\n-  // The usecase fails NEVER->IF_NEEDED\n-  // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MzgzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533753837", "bodyText": "typo:  testStartMangedServerBeyondMaxClusyterLimit() --> testStartMangedServerBeyondMaxClusterLimit()", "author": "anpanigr", "createdAt": "2020-12-01T22:08:44Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +714,172 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-existing server\n+   * (b) the sample script can not stop or start a non-existing cluster\n+   * (c) the sample script can not stop or start a non-existing domain.\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not stop or start non-existing components\")\n+  public void testRestartWrongComponent() {\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not start a server that exceeds the max cluster size\")\n+  public void testStartMangedServerBeyondMaxClusyterLimit() {", "originalCommit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2ODYwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533768607", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-12-01T22:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1MzgzNw=="}], "type": "inlineReview", "revised_code": {"commit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2b3c0e5531..2baf9f3c24 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -719,8 +715,6 @@ class ItServerStartPolicy {\n    * to start based on the replica count, it means that server is already started or is\n    * in the process of starting. In this case, script exits without making any changes.\n    */\n-  // The usecase fails NEVER->IF_NEEDED\n-  // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1NTY0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533755643", "bodyText": "testServerRestartMSWithoutAdmin --> testServerRestartManagedServerWithoutAdmin", "author": "anpanigr", "createdAt": "2020-12-01T22:12:10Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +714,172 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-existing server\n+   * (b) the sample script can not stop or start a non-existing cluster\n+   * (c) the sample script can not stop or start a non-existing domain.\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not stop or start non-existing components\")\n+  public void testRestartWrongComponent() {\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**\n+   * Negative test to verify that the sample script can not start a server that exceeds the max cluster size\n+   * e.g. the max cluster size is 2, the sample script can't start server 3\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not start a server that exceeds the max cluster size\")\n+  public void testStartMangedServerBeyondMaxClusyterLimit() {\n+    String configServerName = \"config-cluster-server3\";\n+    String dynServerName = \"managed-server6\";\n+\n+    // verify that the script can not start a server in config cluster that exceeds the max cluster size\n+    String regex = \".*\" + configServerName + \".*\\\\s*is not part\";\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, configServerName, \"\", false),\n+        String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that is beyong the limit\");\n+\n+    // verify that the script can not start a server in dynamic cluster that exceeds the max cluster size\n+    regex = \".*outside the range of allowed servers\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, dynServerName, \"\", false),\n+        String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that is beyong the limit\");\n+  }\n+\n+  /**\n+   * Verify that after the admin server is stopped, the sample script can start or stop a server.\n+   */\n+  @Disabled(\"Due to the bug OWLS-86251\")\n+  @Test\n+  @DisplayName(\"In the absence of Administration Server, sample script can start/stop a managed server\")\n+  public void testServerRestartMSWithoutAdmin() {", "originalCommit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1ODgzMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533758830", "bodyText": "Add a test to start/stop a manged server form a dynamic cluster.", "author": "anpanigr", "createdAt": "2020-12-01T22:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1NTY0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0MzUyNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r534343526", "bodyText": "done", "author": "hzhao-github", "createdAt": "2020-12-02T17:19:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1NTY0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2b3c0e5531..2baf9f3c24 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -719,8 +715,6 @@ class ItServerStartPolicy {\n    * to start based on the replica count, it means that server is already started or is\n    * in the process of starting. In this case, script exits without making any changes.\n    */\n-  // The usecase fails NEVER->IF_NEEDED\n-  // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1NzkyNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533757924", "bodyText": "Describe the configuration details with usecase as follows ...\nCurrently, the domain resource has a configured cluster with two managed servers and a dynamic cluster with MaxClusterSize set to 5.", "author": "anpanigr", "createdAt": "2020-12-01T22:16:33Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -663,36 +714,172 @@ public void testStandaloneManagedRestartAlways() {\n    * Make sure that ONLY the specified managed server is stopped. \n    * Restart the independent managed server by patching the resource definition \n    * with spec/managedServers/0/serverStartPolicy set to IF_NEEDED.\n-   * Make sure that the specified managed server is in RUNNING state.\n+   * Make sure that the specified managed server is in RUNNING state\n+   * Verify that if server start policy is IF_NEEDED and the server is selected\n+   * to start based on the replica count, it means that server is already started or is\n+   * in the process of starting. In this case, script exits without making any changes.\n    */\n-\n   // The usecase fails NEVER->IF_NEEDED\n   // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n-\n-    String configServerPodName = domainUid + \"-standalone-managed\";\n+    String serverName = \"standalone-managed\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n \n     // Make sure that configured managed server is ready \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server is RUNNING\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"NEVER\");\n     logger.info(\"Domain is patched to shutdown standalone managed server\");\n \n-    checkPodDeleted(configServerPodName, domainUid, domainNamespace);\n+    checkPodDeleted(serverPodName, domainUid, domainNamespace);\n     logger.info(\"Standalone managed server shutdown success\");\n \n-    patchServerStartPolicy(\n-        \"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n+    patchServerStartPolicy(\"/spec/managedServers/0/serverStartPolicy\", \"IF_NEEDED\");\n     logger.info(\"Domain is patched to start standalone managed server\");\n \n-    checkPodReadyAndServiceExists(configServerPodName,\n+    checkPodReadyAndServiceExists(serverPodName,\n         domainUid, domainNamespace);\n     logger.info(\"Standalone managed server restart success\");\n+\n+    // Verify that if server start policy is IF_NEEDED and the server is selected\n+    // to start based on the replica count, it means that server is already started or is\n+    // in the process of starting. In this case, script exits without making any changes.\n+    String result = executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, serverName);\n+    assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n+  }\n+\n+  /**\n+   * Negative test to verify:\n+   * (a) the sample script can not stop or start a non-existing server\n+   * (b) the sample script can not stop or start a non-existing cluster\n+   * (c) the sample script can not stop or start a non-existing domain.\n+   */\n+  @Test\n+  @DisplayName(\"Verify that the sample script can not stop or start non-existing components\")\n+  public void testRestartWrongComponent() {\n+    String wrongServerName = \"ms1\";\n+    String regex = \".*\" + wrongServerName + \".*\\\\s*is not part\";\n+\n+    // verify that the script can not stop a non-exist server\n+    String result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a server that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist server\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, wrongServerName, \"\", false),\n+      String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a server that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist cluster\n+    String wrongClusterName = \"cluster-3\";\n+    regex = \".*\" + wrongClusterName + \".*\\\\s*not part of domain\";\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't stop a cluster that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist cluster\n+    result =  assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_CLUSTER_SCRIPT, CLUSTER_LIFECYCLE, wrongClusterName, \"\", false),\n+        String.format(\"Failed to run %s\", STOP_CLUSTER_SCRIPT));\n+    assertTrue(result.contains(\"cluster cluster-3 is not part of domain\"),\n+        \"The script shouldn't start a cluster that doesn't exist\");\n+\n+    // verify that the script can not stop a non-exist domain\n+    String domainName = \"mii-start-policy\" + \"-123\";\n+    regex = \".*\" + domainName + \".*\\\\s*not found\";\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", STOP_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't stop a domain that doesn't exist\");\n+\n+    // verify that the script can not start a non-exist domain\n+    result = assertDoesNotThrow(() ->\n+        executeLifecycleScript(START_DOMAIN_SCRIPT, DOMAIN, null, \"\", false, domainName),\n+        String.format(\"Failed to run %s\", START_DOMAIN_SCRIPT));\n+    assertTrue(verifyExecuteResult(result, regex),\"The script shouldn't start a domain that doesn't exist\");\n+  }\n+\n+  /**", "originalCommit": "edaccac9c8b5ccbbd0c0d3e86702e7e9b658c2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc2OTYzMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533769631", "bodyText": "added", "author": "hzhao-github", "createdAt": "2020-12-01T22:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc1NzkyNA=="}], "type": "inlineReview", "revised_code": {"commit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2b3c0e5531..2baf9f3c24 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -719,8 +715,6 @@ class ItServerStartPolicy {\n    * to start based on the replica count, it means that server is already started or is\n    * in the process of starting. In this case, script exits without making any changes.\n    */\n-  // The usecase fails NEVER->IF_NEEDED\n-  // https://bug.oraclecorp.com/pls/bug/webbug_print.show?c_rptno=31833260\n   @Test\n   @DisplayName(\"Restart the standalone managed server with serverStartPolicy\")\n   public void testStandaloneManagedRestartIfNeeded() {\n"}}, {"oid": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/529a07722a1ef4f294a783ba82ad47813aa4be8b", "message": "Changes based on comments and added a new test", "committedDate": "2020-12-02T01:04:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1MDU2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533850568", "bodyText": "unused variable serverPodName2", "author": "anpanigr", "createdAt": "2020-12-02T02:17:14Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -752,6 +746,27 @@ public void testStandaloneManagedRestartIfNeeded() {\n     assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n   }\n \n+  /**\n+   * Start a dynamic cluster managed server within the max cluster size\n+   * and verify the replica count increased.\n+   */\n+  @Test\n+  @DisplayName(\"Start a dynamic cluster managed server within the max cluster size and verify replica number increased\")\n+  public void testDynamicClusterReplicaCountIncrease() {\n+    String serverName = \"managed-server3\";\n+    String serverPodName = domainUid + \"-\" + serverName;\n+    String serverPodName2 = domainUid + \"-managed-server2\";", "originalCommit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0NDU2Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r534344567", "bodyText": "it's used at the line 761", "author": "hzhao-github", "createdAt": "2020-12-02T17:21:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1MDU2OA=="}], "type": "inlineReview", "revised_code": {"commit": "460a31d18b3330bf6ca270eaa1d7f5e46c9201f9", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2baf9f3c24..939a396844 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -748,13 +768,14 @@ class ItServerStartPolicy {\n \n   /**\n    * Start a dynamic cluster managed server within the max cluster size\n-   * and verify the replica count increased.\n+   * and the managed server name is not next in line to be started by the Operator but one a customer picks .\n    */\n   @Test\n-  @DisplayName(\"Start a dynamic cluster managed server within the max cluster size and verify replica number increased\")\n-  public void testDynamicClusterReplicaCountIncrease() {\n+  @DisplayName(\"Pick a dynamic cluster managed server randomly within the max cluster size and verify it starts\")\n+  public void testStartDynamicClusterServerRandomlyPicked() {\n     String serverName = \"managed-server3\";\n-    String serverPodName = domainUid + \"-\" + serverName;\n+    String serverPodName3 = domainUid + \"-\" + serverName;\n+    String serverPodName1 = domainUid + \"-managed-server1\";\n     String serverPodName2 = domainUid + \"-managed-server2\";\n \n     // Make sure that managed server(2) is not running\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1MTM5Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r533851397", "bodyText": "Here we do not check the repilca count. Here we can check the stdout of the startupScript which indicate that replica count has been increased OR we can create a method to get the updated replica count from the domain resource.", "author": "anpanigr", "createdAt": "2020-12-02T02:20:13Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -752,6 +746,27 @@ public void testStandaloneManagedRestartIfNeeded() {\n     assertTrue(result.contains(\"No changes needed\"), \"startServer.sh shouldn't make changes\");\n   }\n \n+  /**\n+   * Start a dynamic cluster managed server within the max cluster size\n+   * and verify the replica count increased.", "originalCommit": "529a07722a1ef4f294a783ba82ad47813aa4be8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0NzA2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2075#discussion_r534347064", "bodyText": "changed", "author": "hzhao-github", "createdAt": "2020-12-02T17:24:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg1MTM5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "460a31d18b3330bf6ca270eaa1d7f5e46c9201f9", "chunk": "diff --git a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\nindex 2baf9f3c24..939a396844 100644\n--- a/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n+++ b/integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\n@@ -748,13 +768,14 @@ class ItServerStartPolicy {\n \n   /**\n    * Start a dynamic cluster managed server within the max cluster size\n-   * and verify the replica count increased.\n+   * and the managed server name is not next in line to be started by the Operator but one a customer picks .\n    */\n   @Test\n-  @DisplayName(\"Start a dynamic cluster managed server within the max cluster size and verify replica number increased\")\n-  public void testDynamicClusterReplicaCountIncrease() {\n+  @DisplayName(\"Pick a dynamic cluster managed server randomly within the max cluster size and verify it starts\")\n+  public void testStartDynamicClusterServerRandomlyPicked() {\n     String serverName = \"managed-server3\";\n-    String serverPodName = domainUid + \"-\" + serverName;\n+    String serverPodName3 = domainUid + \"-\" + serverName;\n+    String serverPodName1 = domainUid + \"-managed-server1\";\n     String serverPodName2 = domainUid + \"-managed-server2\";\n \n     // Make sure that managed server(2) is not running\n"}}, {"oid": "460a31d18b3330bf6ca270eaa1d7f5e46c9201f9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/460a31d18b3330bf6ca270eaa1d7f5e46c9201f9", "message": "Changes on javadoc", "committedDate": "2020-12-02T19:11:17Z", "type": "commit"}]}