{"pr_number": 1860, "pr_title": "Namespace management enhancements", "pr_createdAt": "2020-08-10T21:16:43Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1860", "timeline": [{"oid": "f8fe33ce89cbae00d9a665894158f6bd95dae95a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f8fe33ce89cbae00d9a665894158f6bd95dae95a", "message": "Work in progress", "committedDate": "2020-07-22T21:13:40Z", "type": "commit"}, {"oid": "7c420f0028763fda0d3cde89a3cf27af7ccf0698", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7c420f0028763fda0d3cde89a3cf27af7ccf0698", "message": "Work in progess", "committedDate": "2020-07-24T21:06:33Z", "type": "commit"}, {"oid": "32284984c0bf8b7a4a337f1e1781815c05fe8b9c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/32284984c0bf8b7a4a337f1e1781815c05fe8b9c", "message": "Work in progress", "committedDate": "2020-07-28T14:51:04Z", "type": "commit"}, {"oid": "65e9fe20a03d35c09444e1ab320cdeef98171135", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/65e9fe20a03d35c09444e1ab320cdeef98171135", "message": "List, Dedicated working", "committedDate": "2020-07-29T19:39:55Z", "type": "commit"}, {"oid": "2daa4183fe4eff6a352fb66e3320183f6226b758", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2daa4183fe4eff6a352fb66e3320183f6226b758", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-07-30T13:16:56Z", "type": "commit"}, {"oid": "1b9f269461f5b18009e5b27a60e10bb00ae3741c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1b9f269461f5b18009e5b27a60e10bb00ae3741c", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-07-30T18:19:24Z", "type": "commit"}, {"oid": "a4608c3ea72a4d0aa74f13235837333b35806891", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a4608c3ea72a4d0aa74f13235837333b35806891", "message": "Update chart build", "committedDate": "2020-07-30T18:44:11Z", "type": "commit"}, {"oid": "b0eec347340576687e57b1528e06e9f690a09b54", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b0eec347340576687e57b1528e06e9f690a09b54", "message": "Use enableClusterRoleBinding", "committedDate": "2020-07-30T21:44:29Z", "type": "commit"}, {"oid": "278dd0e54c71adf66ff26a316a5ba52d06362db8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/278dd0e54c71adf66ff26a316a5ba52d06362db8", "message": "Use lookup", "committedDate": "2020-07-31T14:31:18Z", "type": "commit"}, {"oid": "8dd1487a272bd79e475b8ae86c58e93f0ac5491e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8dd1487a272bd79e475b8ae86c58e93f0ac5491e", "message": "Preserve debugging", "committedDate": "2020-07-31T21:44:33Z", "type": "commit"}, {"oid": "efb4f4d89181e34ddecfbac3a74af06c786d6771", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/efb4f4d89181e34ddecfbac3a74af06c786d6771", "message": "Complete label selector", "committedDate": "2020-08-03T12:43:52Z", "type": "commit"}, {"oid": "c138de32d26cee707043a8a1c406d239e0c06418", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c138de32d26cee707043a8a1c406d239e0c06418", "message": "Correct typos", "committedDate": "2020-08-03T14:56:57Z", "type": "commit"}, {"oid": "33bf34a29063a3898ceeb3a13ef418f0eb8efa0d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/33bf34a29063a3898ceeb3a13ef418f0eb8efa0d", "message": "Debugging", "committedDate": "2020-08-03T22:02:25Z", "type": "commit"}, {"oid": "c1305b4fd254ebc07dd039d37a60a008dfa6ad49", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c1305b4fd254ebc07dd039d37a60a008dfa6ad49", "message": "More working", "committedDate": "2020-08-03T22:23:36Z", "type": "commit"}, {"oid": "14f234c38b604a861efb4f11469c25a0b3fc331e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/14f234c38b604a861efb4f11469c25a0b3fc331e", "message": "Debugging more complicated label selectors", "committedDate": "2020-08-04T12:37:09Z", "type": "commit"}, {"oid": "6c3095bfe30f36e2cb61fe2aa9be8e46747e817b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6c3095bfe30f36e2cb61fe2aa9be8e46747e817b", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-04T15:21:31Z", "type": "commit"}, {"oid": "8ef9874b30af6612eab80776e3465f436f7f7f5f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8ef9874b30af6612eab80776e3465f436f7f7f5f", "message": "Update chart build", "committedDate": "2020-08-04T15:34:24Z", "type": "commit"}, {"oid": "02ed9ca3f9318ef5f1d9c7978235568f5e117418", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/02ed9ca3f9318ef5f1d9c7978235568f5e117418", "message": "Update chart build", "committedDate": "2020-08-04T16:19:08Z", "type": "commit"}, {"oid": "3727e53d1dd765fd6b2f9717f770066e2240311e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3727e53d1dd765fd6b2f9717f770066e2240311e", "message": "Begin updating samples", "committedDate": "2020-08-04T21:29:12Z", "type": "commit"}, {"oid": "df3b56135ee0aab22866e3912bb98b35cc2e8de0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/df3b56135ee0aab22866e3912bb98b35cc2e8de0", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-04T21:44:33Z", "type": "commit"}, {"oid": "e95e172a78a4b192b39ccd1b3c963adabbf8916a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e95e172a78a4b192b39ccd1b3c963adabbf8916a", "message": "Documentation work", "committedDate": "2020-08-05T22:50:02Z", "type": "commit"}, {"oid": "02e9567dc34ef8b470bba32e78cde1315b50451d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/02e9567dc34ef8b470bba32e78cde1315b50451d", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-05T22:50:18Z", "type": "commit"}, {"oid": "09b66b883b41542bb663aee7f0742ff0c81b1f27", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/09b66b883b41542bb663aee7f0742ff0c81b1f27", "message": "Update charts", "committedDate": "2020-08-05T22:54:27Z", "type": "commit"}, {"oid": "5b6ecf2eade8115edf6162ed2633b1288f3c22a3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5b6ecf2eade8115edf6162ed2633b1288f3c22a3", "message": "Complete doc. updates", "committedDate": "2020-08-10T12:31:57Z", "type": "commit"}, {"oid": "441620cab0c19ef8e1b767f09c840e537191a50a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/441620cab0c19ef8e1b767f09c840e537191a50a", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-10T12:50:09Z", "type": "commit"}, {"oid": "7df031c48af7b98fa3f30854d4ec37d46b2c7cbc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7df031c48af7b98fa3f30854d4ec37d46b2c7cbc", "message": "Additional unit tests", "committedDate": "2020-08-10T21:12:51Z", "type": "commit"}, {"oid": "f61097c0a5db04c78ab042367fcf7b205cf450cd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f61097c0a5db04c78ab042367fcf7b205cf450cd", "message": "Add additional mementos", "committedDate": "2020-08-10T21:48:39Z", "type": "commit"}, {"oid": "4377dcef55a4685aecf16b03b8abc79156886db5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4377dcef55a4685aecf16b03b8abc79156886db5", "message": "Test code to diagnose build failure on Jenkins", "committedDate": "2020-08-10T22:08:45Z", "type": "commit"}, {"oid": "6855ca49fc420e5a964211c95a9b077599b53a93", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6855ca49fc420e5a964211c95a9b077599b53a93", "message": "More debug code", "committedDate": "2020-08-10T22:13:05Z", "type": "commit"}, {"oid": "c22e97ebe5718e9c4d29428c512f6f74573bc280", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c22e97ebe5718e9c4d29428c512f6f74573bc280", "message": "More debug code", "committedDate": "2020-08-10T22:23:44Z", "type": "commit"}, {"oid": "af7d21f8775aa6d8ff9019c2e20c02e6fc332af3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/af7d21f8775aa6d8ff9019c2e20c02e6fc332af3", "message": "Hopefully fixed unit tests", "committedDate": "2020-08-11T12:55:19Z", "type": "commit"}, {"oid": "04908fc2a439e5c67232e8f843a4a159cb5f938c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/04908fc2a439e5c67232e8f843a4a159cb5f938c", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-11T15:47:12Z", "type": "commit"}, {"oid": "fca48c3d90752f4520194341d42404028a3c2cf4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fca48c3d90752f4520194341d42404028a3c2cf4", "message": "Merge remote-tracking branch 'origin/develop' into owls-82046", "committedDate": "2020-08-12T13:34:46Z", "type": "commit"}, {"oid": "0c469785f7f75306654352385546d9bb8bd6e4d5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0c469785f7f75306654352385546d9bb8bd6e4d5", "message": "Review comment", "committedDate": "2020-08-12T14:16:37Z", "type": "commit"}, {"oid": "6c35497f86913daf926c19b15b9406849670a0ab", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6c35497f86913daf926c19b15b9406849670a0ab", "message": "Review comments", "committedDate": "2020-08-12T15:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM3MTIwMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1860#discussion_r469371202", "bodyText": "can the regexp be invalid, and Pattern.compile(regexp) may throw PatternSyntaxException? Perhaps it has been validated elsewhere that I missed.", "author": "alai8", "createdAt": "2020-08-12T16:02:02Z", "path": "operator/src/main/java/oracle/kubernetes/operator/Main.java", "diffHunk": "@@ -929,31 +1025,57 @@ public NextAction onSuccess(Packet packet, CallResponse<V1NamespaceList> callRes\n       String intialResourceVersion = getInitialResourceVersion(result);\n       List<String> nsList = getExistingNamespaces(result);\n       \n-      Set<String> namespacesToStart = new TreeSet<>(targetNamespaces);\n-      for (String ns : targetNamespaces) {\n-        if (!nsList.contains(ns)) {\n-          try (LoggingContext stack = LoggingContext.setThreadContext().namespace(ns)) {\n-            LOGGER.warning(MessageKeys.NAMESPACE_IS_MISSING, ns);\n+      Set<String> namespacesToStart;\n+      if (selectionStrategy.isRequireList()) {\n+        namespacesToStart = new TreeSet<>(nsList);\n+        String regexp = selectionStrategy.getRegExp();\n+        if (regexp != null) {\n+          namespacesToStart = namespacesToStart.stream().filter(\n+                  Pattern.compile(regexp).asPredicate()).collect(Collectors.toSet());", "originalCommit": "6c35497f86913daf926c19b15b9406849670a0ab", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2677f1ffffc89f0ebd46958fc18d3bca581543ad", "chunk": "diff --git a/operator/src/main/java/oracle/kubernetes/operator/Main.java b/operator/src/main/java/oracle/kubernetes/operator/Main.java\nindex 3f02668e95..3d1f757bfc 100644\n--- a/operator/src/main/java/oracle/kubernetes/operator/Main.java\n+++ b/operator/src/main/java/oracle/kubernetes/operator/Main.java\n\n@@ -1030,8 +1038,12 @@ public class Main {\n         namespacesToStart = new TreeSet<>(nsList);\n         String regexp = selectionStrategy.getRegExp();\n         if (regexp != null) {\n-          namespacesToStart = namespacesToStart.stream().filter(\n-                  Pattern.compile(regexp).asPredicate()).collect(Collectors.toSet());\n+          try {\n+            namespacesToStart = namespacesToStart.stream().filter(\n+                    Pattern.compile(regexp).asPredicate()).collect(Collectors.toSet());\n+          } catch (PatternSyntaxException pse) {\n+            LOGGER.severe(MessageKeys.EXCEPTION, pse);\n+          }\n         }\n       } else {\n         namespacesToStart = new TreeSet<>(configuredDomainNamespaces);\n"}}, {"oid": "2677f1ffffc89f0ebd46958fc18d3bca581543ad", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2677f1ffffc89f0ebd46958fc18d3bca581543ad", "message": "Review comments", "committedDate": "2020-08-12T21:54:07Z", "type": "commit"}]}