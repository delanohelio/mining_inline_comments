{"pr_number": 7456, "pr_title": "Add support for referencing forge's resources and specifying existing mods to data generators", "pr_createdAt": "2020-11-02T18:01:10Z", "pr_url": "https://github.com/MinecraftForge/MinecraftForge/pull/7456", "timeline": [{"oid": "33889fda6f6d562425d878b1ab51b2509876be16", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/33889fda6f6d562425d878b1ab51b2509876be16", "message": "Only automatically add forge to existing resources if forge is not one of the mods data is currently being generated for", "committedDate": "2020-11-02T18:52:49Z", "type": "forcePushed"}, {"oid": "81841ea6b41e42db51cc4e91f701108ad4ea80a7", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/81841ea6b41e42db51cc4e91f701108ad4ea80a7", "message": "Add --existing-mod as an argument for data generators that takes a modid and auto add forge so that mods can reference forge resources", "committedDate": "2020-11-02T20:04:27Z", "type": "commit"}, {"oid": "7e02c992aa6ba570ee0003e665a937542b5c1202", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7e02c992aa6ba570ee0003e665a937542b5c1202", "message": "Only automatically add forge to existing resources if forge is not one of the mods data is currently being generated for", "committedDate": "2020-11-02T20:04:27Z", "type": "commit"}, {"oid": "7e02c992aa6ba570ee0003e665a937542b5c1202", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7e02c992aa6ba570ee0003e665a937542b5c1202", "message": "Only automatically add forge to existing resources if forge is not one of the mods data is currently being generated for", "committedDate": "2020-11-02T20:04:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY5NzI3NQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7456#discussion_r521697275", "bodyText": "Middle of the argument list..\nThis is a Forge class yes, but why?", "author": "TheCurle", "createdAt": "2020-11-11T23:21:13Z", "path": "src/main/java/net/minecraftforge/fml/DatagenModLoader.java", "diffHunk": "@@ -39,14 +40,19 @@ public static boolean isRunningDataGen() {\n         return runningDataGen;\n     }\n \n-    public static void begin(final Set<String> mods, final Path path, final java.util.Collection<Path> inputs, Collection<Path> existingPacks, final boolean serverGenerators, final boolean clientGenerators, final boolean devToolGenerators, final boolean reportsGenerator, final boolean structureValidator, final boolean flat) {\n+    @Deprecated //TODO: Remove in 1.17\n+    public static void begin(final Set<String> mods, final Path path, final Collection<Path> inputs, Collection<Path> existingPacks, final boolean serverGenerators, final boolean clientGenerators, final boolean devToolGenerators, final boolean reportsGenerator, final boolean structureValidator, final boolean flat) {\n+        begin(mods, path, inputs, existingPacks, Collections.emptySet(), serverGenerators, clientGenerators, devToolGenerators, reportsGenerator, structureValidator, flat);\n+    }\n+\n+    public static void begin(final Set<String> mods, final Path path, final Collection<Path> inputs, Collection<Path> existingPacks, Set<String> existingMods, final boolean serverGenerators, final boolean clientGenerators, final boolean devToolGenerators, final boolean reportsGenerator, final boolean structureValidator, final boolean flat) {", "originalCommit": "7e02c992aa6ba570ee0003e665a937542b5c1202", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY5OTY3MQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/7456#discussion_r521699671", "bodyText": "Because argument wise it makes more sense going next to existing packs than at the end after a ton of random boolean values, and once we hit 1.17 and the deprecated old one can be removed without worrying that someone is calling it for some reason from somewhere else, it really won't matter as it won't be the \"middle\" it will just be the \"normal\" place for it.", "author": "pupnewfster", "createdAt": "2020-11-11T23:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY5NzI3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "6a616911483c9440c9d50ef90e9e8c32334aa866", "chunk": "diff --git a/src/main/java/net/minecraftforge/fml/DatagenModLoader.java b/src/main/java/net/minecraftforge/fml/DatagenModLoader.java\nindex 15cf4e2bd..348e88607 100644\n--- a/src/main/java/net/minecraftforge/fml/DatagenModLoader.java\n+++ b/src/main/java/net/minecraftforge/fml/DatagenModLoader.java\n\n@@ -52,7 +52,11 @@ public class DatagenModLoader {\n         Bootstrap.register();\n         dataGeneratorConfig = new GatherDataEvent.DataGeneratorConfig(mods, path, inputs, serverGenerators, clientGenerators, devToolGenerators, reportsGenerator, structureValidator, flat);\n         ModLoader.get().gatherAndInitializeMods(ModWorkManager.syncExecutor(), ModWorkManager.parallelExecutor(), ()->{});\n-        existingFileHelper = new ExistingFileHelper(existingPacks, existingMods, structureValidator, !mods.contains(\"forge\"));\n+        if (!mods.contains(\"forge\")) {\n+            //If we aren't generating data for forge, automatically add forge as an existing so mods can access forge's data\n+            existingMods.add(\"forge\");\n+        }\n+        existingFileHelper = new ExistingFileHelper(existingPacks, existingMods, structureValidator);\n         ModLoader.get().runEventGenerator(mc->new GatherDataEvent(mc, dataGeneratorConfig.makeGenerator(p->dataGeneratorConfig.isFlat() ? p : p.resolve(mc.getModId()), dataGeneratorConfig.getMods().contains(mc.getModId())), dataGeneratorConfig, existingFileHelper));\n         dataGeneratorConfig.runAll();\n     }\n"}}, {"oid": "6a616911483c9440c9d50ef90e9e8c32334aa866", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/6a616911483c9440c9d50ef90e9e8c32334aa866", "message": "Cleanup", "committedDate": "2020-11-23T03:40:46Z", "type": "commit"}]}