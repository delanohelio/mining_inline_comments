{"pr_number": 1810, "pr_title": "enable init taskToDomain in TaskRunnerConfigurer", "pr_createdAt": "2020-07-28T18:23:59Z", "pr_url": "https://github.com/Netflix/conductor/pull/1810", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg==", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461793542", "bodyText": "When the intention is to cast the returned Object to String why not just return a String ?", "author": "pctreddy", "createdAt": "2020-07-28T18:41:25Z", "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -244,4 +249,11 @@ private void handleException(Throwable t, TaskResult result, Worker worker, Task\n \n         updateWithRetry(updateRetryCount, task, result, worker);\n     }\n+\n+    private Object getDomainForTask(String taskType) {", "originalCommit": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgwNDIzNw==", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461804237", "bodyText": "Having the taskDomains set to an empty collection during construction either in this class or in the builder as a default value:\npublic static class Builder {\n        private String workerNamePrefix = \"workflow-worker-\";\n        private int sleepWhenRetry = 500;\n        private int updateRetryCount = 3;\n        private int threadCount = -1;\n        private Iterable<Worker> workers;\n        private EurekaClient eurekaClient;\n        private TaskClient taskClient;\n        private Map<String/*taskType*/, String/*domain*/> taskToDomain = new HashMap<>();\n\nwill eliminate the need for this method and check for nulls and empty.", "author": "pctreddy", "createdAt": "2020-07-28T19:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg4MjE0MQ==", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461882141", "bodyText": "Thats a great idea.", "author": "apanicker-nflx", "createdAt": "2020-07-28T21:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MzU0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "chunk": "diff --git a/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java b/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\nindex 34786796..70113997 100644\n--- a/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\n+++ b/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\n\n@@ -249,11 +248,4 @@ class TaskPollExecutor {\n \n         updateWithRetry(updateRetryCount, task, result, worker);\n     }\n-\n-    private Object getDomainForTask(String taskType) {\n-        if (taskToDomain != null && !taskToDomain.isEmpty()) {\n-            return taskToDomain.get(taskType);\n-        }\n-        return null;\n-    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgwMDQyNw==", "url": "https://github.com/Netflix/conductor/pull/1810#discussion_r461800427", "bodyText": "if the method getDomainForTask is changed to return a String instead of a Object, the use of optional can be simplified:\nString taskType = Optional.ofNullable(PropertyFactory.getString(taskType, DOMAIN, null))\n                    .orElseGet(() -> Optional.ofNullable(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null))\n                            .orElse(getDomainForTask(taskType));", "author": "pctreddy", "createdAt": "2020-07-28T18:53:44Z", "path": "client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java", "diffHunk": "@@ -94,7 +97,9 @@ void pollAndExecute(Worker worker) {\n \n             String taskType = worker.getTaskDefName();\n             String domain = Optional.ofNullable(PropertyFactory.getString(taskType, DOMAIN, null))\n-                .orElse(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null));\n+                .orElseGet(() -> Optional.ofNullable(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null))\n+                    .orElseGet(() -> Optional.ofNullable(getDomainForTask(taskType)).map(Object::toString)\n+                        .orElse(null)));\n ", "originalCommit": "28c0fac6b5baaa73afec82c6de3b58a245afbf6e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "chunk": "diff --git a/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java b/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\nindex 34786796..70113997 100644\n--- a/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\n+++ b/client/src/main/java/com/netflix/conductor/client/automator/TaskPollExecutor.java\n\n@@ -98,8 +98,7 @@ class TaskPollExecutor {\n             String taskType = worker.getTaskDefName();\n             String domain = Optional.ofNullable(PropertyFactory.getString(taskType, DOMAIN, null))\n                 .orElseGet(() -> Optional.ofNullable(PropertyFactory.getString(ALL_WORKERS, DOMAIN, null))\n-                    .orElseGet(() -> Optional.ofNullable(getDomainForTask(taskType)).map(Object::toString)\n-                        .orElse(null)));\n+                    .orElse(taskToDomain.get(taskType)));\n \n             LOGGER.debug(\"Polling task of type: {} in domain: '{}'\", taskType, domain);\n             task = MetricsContainer.getPollTimer(taskType)\n"}}, {"oid": "5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "url": "https://github.com/Netflix/conductor/commit/5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "message": "enable init taskToDomain in TaskRunnerConfigurer", "committedDate": "2020-07-28T21:11:02Z", "type": "commit"}, {"oid": "5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "url": "https://github.com/Netflix/conductor/commit/5bd807e5ae4271bf54f68fb89ee24b969d2fb373", "message": "enable init taskToDomain in TaskRunnerConfigurer", "committedDate": "2020-07-28T21:11:02Z", "type": "forcePushed"}]}