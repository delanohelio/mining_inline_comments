{"pr_number": 1945, "pr_title": "Fix for bug 1928, TERMINATE workflowOutput is being override by workflowOutput parameters set from workflowDefinition", "pr_createdAt": "2020-10-31T11:15:55Z", "pr_url": "https://github.com/Netflix/conductor/pull/1945", "timeline": [{"oid": "84ba9e9b21049d2f61cc0457e410c642087639f5", "url": "https://github.com/Netflix/conductor/commit/84ba9e9b21049d2f61cc0457e410c642087639f5", "message": "Fix for bug 1928, TERMINATE workflowOutput is being override by workflowOutput parameters set from workflowDefinition", "committedDate": "2020-10-31T11:03:40Z", "type": "commit"}, {"oid": "d3547cc39819a9654a6bcc83b0ea4db4e0e00a24", "url": "https://github.com/Netflix/conductor/commit/d3547cc39819a9654a6bcc83b0ea4db4e0e00a24", "message": "Fix for bug 1928, Fix Build Failure.", "committedDate": "2020-10-31T12:24:25Z", "type": "commit"}, {"oid": "a622f0fdcae9d4925b04151c867681c5755f5726", "url": "https://github.com/Netflix/conductor/commit/a622f0fdcae9d4925b04151c867681c5755f5726", "message": "Fix for bug 1928, Fix Integration Build Failure.", "committedDate": "2020-10-31T12:50:19Z", "type": "commit"}, {"oid": "09658432b1a872d9b9f2f3d9004facfab7aae88e", "url": "https://github.com/Netflix/conductor/commit/09658432b1a872d9b9f2f3d9004facfab7aae88e", "message": "adding unit test coverage", "committedDate": "2020-11-02T05:48:30Z", "type": "commit"}, {"oid": "11f5c2cef08504084f261295a5a46d81c783604d", "url": "https://github.com/Netflix/conductor/commit/11f5c2cef08504084f261295a5a46d81c783604d", "message": "adding unit test coverage", "committedDate": "2020-11-02T05:59:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIxMTAzNQ==", "url": "https://github.com/Netflix/conductor/pull/1945#discussion_r520211035", "bodyText": "Changing the workflow definition within the workflow does not seem to be the best way to achieve this. This makes the behavior seem like a side-effect rather than intentional.", "author": "apanicker-nflx", "createdAt": "2020-11-10T00:38:52Z", "path": "core/src/main/java/com/netflix/conductor/core/execution/tasks/Terminate.java", "diffHunk": "@@ -81,6 +81,9 @@ public static Boolean validateInputStatus(String status) {\n     private void setWorkflowOutput(Map<String, Object> taskOutput, Workflow workflow) {\n         if(!taskOutput.isEmpty()) {\n             workflow.setOutput(taskOutput);\n+\t\t\tif (workflow.getWorkflowDefinition() != null && (workflow.getWorkflowDefinition().getOutputParameters() != null && !workflow.getWorkflowDefinition().getOutputParameters().isEmpty())) {", "originalCommit": "11f5c2cef08504084f261295a5a46d81c783604d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM2NTE3OA==", "url": "https://github.com/Netflix/conductor/pull/1945#discussion_r520365178", "bodyText": "Agreed, but when called updateWorkflowOutput() in deciderService, Checking the workflowDefintion's outputParameters rather than workflow output which has changed in Terminate.java.", "author": "vamsibandarupalli", "createdAt": "2020-11-10T08:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIxMTAzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUwMzk4NQ==", "url": "https://github.com/Netflix/conductor/pull/1945#discussion_r521503985", "bodyText": "Removed the code change which modifies workflow definition and added check in DeciderService which seems the better way to fix the bug.", "author": "vamsibandarupalli", "createdAt": "2020-11-11T17:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDIxMTAzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "58dc2f7d44383cbb4fe6828d7303b796aaa8ed5b", "chunk": "diff --git a/core/src/main/java/com/netflix/conductor/core/execution/tasks/Terminate.java b/core/src/main/java/com/netflix/conductor/core/execution/tasks/Terminate.java\nindex 5ecb7d50..6f41031c 100644\n--- a/core/src/main/java/com/netflix/conductor/core/execution/tasks/Terminate.java\n+++ b/core/src/main/java/com/netflix/conductor/core/execution/tasks/Terminate.java\n\n@@ -81,9 +81,6 @@ public class Terminate extends WorkflowSystemTask {\n     private void setWorkflowOutput(Map<String, Object> taskOutput, Workflow workflow) {\n         if(!taskOutput.isEmpty()) {\n             workflow.setOutput(taskOutput);\n-\t\t\tif (workflow.getWorkflowDefinition() != null && (workflow.getWorkflowDefinition().getOutputParameters() != null && !workflow.getWorkflowDefinition().getOutputParameters().isEmpty())) {\n-                workflow.getWorkflowDefinition().setOutputParameters(taskOutput);\n-            }\n         }\n     }\n \n"}}, {"oid": "126a7f80ea0f16b90f5da360110aaa7d7545ad64", "url": "https://github.com/Netflix/conductor/commit/126a7f80ea0f16b90f5da360110aaa7d7545ad64", "message": "Fix for bug 1928, Adding Integration coverage for bug", "committedDate": "2020-11-11T12:02:31Z", "type": "commit"}, {"oid": "2ec6ecd6e49615017c7804d29907ad6b824b22ae", "url": "https://github.com/Netflix/conductor/commit/2ec6ecd6e49615017c7804d29907ad6b824b22ae", "message": "Merge branch 'dev' of https://github.com/Netflix/conductor into dev", "committedDate": "2020-11-11T12:50:34Z", "type": "commit"}, {"oid": "c336592ec7d701ff72abec1a28e130d98af5ae5f", "url": "https://github.com/Netflix/conductor/commit/c336592ec7d701ff72abec1a28e130d98af5ae5f", "message": "removing integration test cases", "committedDate": "2020-11-11T13:33:14Z", "type": "commit"}, {"oid": "d091714d6d4c35b52013a766f182726b024872c4", "url": "https://github.com/Netflix/conductor/commit/d091714d6d4c35b52013a766f182726b024872c4", "message": "adding outputParameters to terminate_task_completed_workflow_integration_test.json file", "committedDate": "2020-11-11T14:03:04Z", "type": "commit"}, {"oid": "56c0ac82783674751d5f3314d3638132f971c568", "url": "https://github.com/Netflix/conductor/commit/56c0ac82783674751d5f3314d3638132f971c568", "message": "Integration test to test output after executing terminate task", "committedDate": "2020-11-11T14:46:58Z", "type": "commit"}, {"oid": "04c01e12636bf1c8b1960762b8c9c1a2f9bf1658", "url": "https://github.com/Netflix/conductor/commit/04c01e12636bf1c8b1960762b8c9c1a2f9bf1658", "message": "Integration test to test output after executing terminate task", "committedDate": "2020-11-11T15:25:56Z", "type": "commit"}, {"oid": "58dc2f7d44383cbb4fe6828d7303b796aaa8ed5b", "url": "https://github.com/Netflix/conductor/commit/58dc2f7d44383cbb4fe6828d7303b796aaa8ed5b", "message": "Fixing Intergartion test and fixing bug in DeciderService rather than chaging workflowDefintion", "committedDate": "2020-11-11T16:17:05Z", "type": "commit"}, {"oid": "40638db051879158d72b3f17768d91f127ee9681", "url": "https://github.com/Netflix/conductor/commit/40638db051879158d72b3f17768d91f127ee9681", "message": "Fixing Build Failue", "committedDate": "2020-11-11T16:34:07Z", "type": "commit"}, {"oid": "02fb7f63898c5c5dcff40ab8e8b65bc3c2183edd", "url": "https://github.com/Netflix/conductor/commit/02fb7f63898c5c5dcff40ab8e8b65bc3c2183edd", "message": "Removing unused import", "committedDate": "2020-11-11T16:59:19Z", "type": "commit"}, {"oid": "48b56e0ec3479208e08951835322a12dacc0c5c4", "url": "https://github.com/Netflix/conductor/commit/48b56e0ec3479208e08951835322a12dacc0c5c4", "message": "Fix build", "committedDate": "2020-11-11T17:12:02Z", "type": "commit"}, {"oid": "3990ac2ff6c3e894f72273b809e87f7b7439a28a", "url": "https://github.com/Netflix/conductor/commit/3990ac2ff6c3e894f72273b809e87f7b7439a28a", "message": "Fixing Build Failue", "committedDate": "2020-11-11T17:23:51Z", "type": "commit"}, {"oid": "aa26561da1eecec3370af90cf9063fe6ba3a6dfe", "url": "https://github.com/Netflix/conductor/commit/aa26561da1eecec3370af90cf9063fe6ba3a6dfe", "message": "Add unit test coverage when definition has outputParameters definied", "committedDate": "2020-11-12T07:36:07Z", "type": "commit"}]}