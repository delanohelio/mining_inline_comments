{"pr_number": 1900, "pr_title": "Mark parent workflow as TERMINATED instead of FAILED, when\u2026", "pr_createdAt": "2020-10-01T00:03:02Z", "pr_url": "https://github.com/Netflix/conductor/pull/1900", "timeline": [{"oid": "89ee5710bd486001943e3d1bf2b6b72c6514a4c8", "url": "https://github.com/Netflix/conductor/commit/89ee5710bd486001943e3d1bf2b6b72c6514a4c8", "message": "Updates to mark parent workflow as TERMINATED instead of FAILED, when a subworkflow is terminated. Other cleanup.", "committedDate": "2020-10-01T00:03:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NzczMQ==", "url": "https://github.com/Netflix/conductor/pull/1900#discussion_r497877731", "bodyText": "do you also want to set the failure reason on the task here?", "author": "apanicker-nflx", "createdAt": "2020-10-01T00:29:43Z", "path": "core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java", "diffHunk": "@@ -185,9 +185,11 @@ private void updateTaskStatus(WorkflowStatus status, Task task) {\n \t\t\t\ttask.setStatus(Status.COMPLETED);\n \t\t\t\tbreak;\n \t\t\tcase FAILED:\n-\t\t\tcase TERMINATED:\n \t\t\t\ttask.setStatus(Status.FAILED);\n \t\t\t\tbreak;\n+\t\t\tcase TERMINATED:\n+\t\t\t\ttask.setStatus(Status.CANCELED);", "originalCommit": "89ee5710bd486001943e3d1bf2b6b72c6514a4c8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0896f69d151d00f04fc3113807207a30a089cfa1", "chunk": "diff --git a/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java b/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\nindex 57b1fcb0..a5834836 100644\n--- a/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\n+++ b/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\n\n@@ -186,9 +185,11 @@ public class SubWorkflow extends WorkflowSystemTask {\n \t\t\t\tbreak;\n \t\t\tcase FAILED:\n \t\t\t\ttask.setStatus(Status.FAILED);\n+\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n \t\t\t\tbreak;\n \t\t\tcase TERMINATED:\n \t\t\t\ttask.setStatus(Status.CANCELED);\n+\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n \t\t\t\tbreak;\n \t\t\tcase TIMED_OUT:\n \t\t\t\ttask.setStatus(Status.TIMED_OUT);\n"}}, {"oid": "0896f69d151d00f04fc3113807207a30a089cfa1", "url": "https://github.com/Netflix/conductor/commit/0896f69d151d00f04fc3113807207a30a089cfa1", "message": "Updates to mark parent workflow as TERMINATED instead of FAILED, when a subworkflow is terminated. Other cleanup.", "committedDate": "2020-10-11T14:31:39Z", "type": "commit"}, {"oid": "0896f69d151d00f04fc3113807207a30a089cfa1", "url": "https://github.com/Netflix/conductor/commit/0896f69d151d00f04fc3113807207a30a089cfa1", "message": "Updates to mark parent workflow as TERMINATED instead of FAILED, when a subworkflow is terminated. Other cleanup.", "committedDate": "2020-10-11T14:31:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NzI3NA==", "url": "https://github.com/Netflix/conductor/pull/1900#discussion_r503657274", "bodyText": "This seems redundant to lines 188 and 192 above.", "author": "apanicker-nflx", "createdAt": "2020-10-13T04:16:25Z", "path": "core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java", "diffHunk": "@@ -185,14 +184,22 @@ private void updateTaskStatus(WorkflowStatus status, Task task) {\n \t\t\t\ttask.setStatus(Status.COMPLETED);\n \t\t\t\tbreak;\n \t\t\tcase FAILED:\n-\t\t\tcase TERMINATED:\n \t\t\t\ttask.setStatus(Status.FAILED);\n+\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n+\t\t\t\tbreak;\n+\t\t\tcase TERMINATED:\n+\t\t\t\ttask.setStatus(Status.CANCELED);\n+\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n \t\t\t\tbreak;\n \t\t\tcase TIMED_OUT:\n \t\t\t\ttask.setStatus(Status.TIMED_OUT);\n \t\t\t\tbreak;\n \t\t\tdefault:\n \t\t\t\tthrow new ApplicationException(ApplicationException.Code.INTERNAL_ERROR, \"Subworkflow status does not conform to relevant task status.\");\n \t\t}\n+\n+\t\tif (status.isTerminal() && !status.isSuccessful()) {\n+\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());", "originalCommit": "0896f69d151d00f04fc3113807207a30a089cfa1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE4MDMyNw==", "url": "https://github.com/Netflix/conductor/pull/1900#discussion_r504180327", "bodyText": "You're right, thanks for pointing. Cleaned up.", "author": "kishorebanala", "createdAt": "2020-10-13T18:45:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NzI3NA=="}], "type": "inlineReview", "revised_code": {"commit": "03d617aa6e300899a6fa280657701d14be9e9406", "chunk": "diff --git a/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java b/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\nindex a5834836..9d053051 100644\n--- a/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\n+++ b/core/src/main/java/com/netflix/conductor/core/execution/tasks/SubWorkflow.java\n\n@@ -185,11 +185,9 @@ public class SubWorkflow extends WorkflowSystemTask {\n \t\t\t\tbreak;\n \t\t\tcase FAILED:\n \t\t\t\ttask.setStatus(Status.FAILED);\n-\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n \t\t\t\tbreak;\n \t\t\tcase TERMINATED:\n \t\t\t\ttask.setStatus(Status.CANCELED);\n-\t\t\t\ttask.setReasonForIncompletion(subworkflow.getReasonForIncompletion());\n \t\t\t\tbreak;\n \t\t\tcase TIMED_OUT:\n \t\t\t\ttask.setStatus(Status.TIMED_OUT);\n"}}, {"oid": "03d617aa6e300899a6fa280657701d14be9e9406", "url": "https://github.com/Netflix/conductor/commit/03d617aa6e300899a6fa280657701d14be9e9406", "message": "Clean up.", "committedDate": "2020-10-13T18:45:07Z", "type": "commit"}]}