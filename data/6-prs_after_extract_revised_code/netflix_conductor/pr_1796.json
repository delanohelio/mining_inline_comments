{"pr_number": 1796, "pr_title": "Configure listener queues based on the URI settings or config properties", "pr_createdAt": "2020-07-20T13:08:33Z", "pr_url": "https://github.com/Netflix/conductor/pull/1796", "timeline": [{"oid": "3de3859036a90df309d9c22fa13f2b0fdd252b67", "url": "https://github.com/Netflix/conductor/commit/3de3859036a90df309d9c22fa13f2b0fdd252b67", "message": "Creating listener queue for receiving messages based on settings", "committedDate": "2020-07-16T12:01:12Z", "type": "commit"}, {"oid": "59e5191c77b4c76cf74d40316302525c09388129", "url": "https://github.com/Netflix/conductor/commit/59e5191c77b4c76cf74d40316302525c09388129", "message": "Adding Junit", "committedDate": "2020-07-19T14:19:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA4NjAxNg==", "url": "https://github.com/Netflix/conductor/pull/1796#discussion_r458086016", "bodyText": "Can you put the example url here as to how it is set,\nAlso mention that this config gets applied to both exchange and queue and we will need a separate key if they need to be separated out", "author": "ritu-p", "createdAt": "2020-07-21T13:14:55Z", "path": "contribs/src/main/java/com/netflix/conductor/contribs/queue/amqp/AMQPObservableQueue.java", "diffHunk": "@@ -536,7 +536,8 @@ protected void receiveMessages() {\n \t\t\tif (useExchange) {\n \t\t\t\t// Consume messages from an exchange\n \t\t\t\tgetOrCreateExchange();\n-\t\t\t\t// Create queue if not present based on the settings\n+\t\t\t\t// Create queue if not present based on the settings provided in the queue URI or configuration properties\n+\t\t\t\t// Default settings if not provided in the queue URI or properties: isDurable: true, autoDelete: false, isExclusive: false", "originalCommit": "59e5191c77b4c76cf74d40316302525c09388129", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODczMzAzNQ==", "url": "https://github.com/Netflix/conductor/pull/1796#discussion_r458733035", "bodyText": "Thank you @ritu-p . I have updated the comment.\nCan you please check?", "author": "msdhivya", "createdAt": "2020-07-22T11:47:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA4NjAxNg=="}], "type": "inlineReview", "revised_code": {"commit": "b5cb4d44970b0b8bbf5acf164ee7427e7b08aea0", "chunk": "diff --git a/contribs/src/main/java/com/netflix/conductor/contribs/queue/amqp/AMQPObservableQueue.java b/contribs/src/main/java/com/netflix/conductor/contribs/queue/amqp/AMQPObservableQueue.java\nindex 79089c25..7a24348c 100644\n--- a/contribs/src/main/java/com/netflix/conductor/contribs/queue/amqp/AMQPObservableQueue.java\n+++ b/contribs/src/main/java/com/netflix/conductor/contribs/queue/amqp/AMQPObservableQueue.java\n\n@@ -536,8 +536,13 @@ public class AMQPObservableQueue implements ObservableQueue {\n \t\t\tif (useExchange) {\n \t\t\t\t// Consume messages from an exchange\n \t\t\t\tgetOrCreateExchange();\n-\t\t\t\t// Create queue if not present based on the settings provided in the queue URI or configuration properties\n-\t\t\t\t// Default settings if not provided in the queue URI or properties: isDurable: true, autoDelete: false, isExclusive: false\n+\t\t\t\t/**\n+\t\t\t\t * Create queue if not present based on the settings provided in the queue URI or configuration properties.\n+\t\t\t\t * Sample URI format: amqp-exchange:myExchange?exchangeType=topic&routingKey=myRoutingKey&exclusive=false&autoDelete=false&durable=true\n+\t\t\t\t * Default settings if not provided in the queue URI or properties: isDurable: true, autoDelete: false, isExclusive: false\n+\t\t\t\t * The same settings are currently used during creation of exchange as well as queue.\n+\t\t\t\t * TODO: This can be enhanced further to get the settings separately for exchange and queue from the URI\n+\t\t\t\t*/\n \t\t\t\tfinal AMQP.Queue.DeclareOk declareOk = getOrCreateQueue(\n \t\t\t\t\t\tString.format(\"bound_to_%s\", settings.getQueueOrExchangeName()), settings.isDurable(), settings.isExclusive(), settings.autoDelete(),\n \t\t\t\t\t\tMaps.newHashMap());\n"}}, {"oid": "b5cb4d44970b0b8bbf5acf164ee7427e7b08aea0", "url": "https://github.com/Netflix/conductor/commit/b5cb4d44970b0b8bbf5acf164ee7427e7b08aea0", "message": "Added more comments and junit", "committedDate": "2020-07-22T11:03:34Z", "type": "commit"}]}