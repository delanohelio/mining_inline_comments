{"pr_number": 7426, "pr_title": "okhttp: cleanup channel in channel builder tests", "pr_createdAt": "2020-09-15T22:49:26Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7426", "timeline": [{"oid": "ce72e013eeccb5b8987ce79b2344eea95db627b0", "url": "https://github.com/grpc/grpc-java/commit/ce72e013eeccb5b8987ce79b2344eea95db627b0", "message": "okhttp: add channel shutdown to channel builder tests", "committedDate": "2020-09-15T22:48:13Z", "type": "commit"}, {"oid": "03c3aadc4162b81cde7b7d00431b3a32d7beb7d2", "url": "https://github.com/grpc/grpc-java/commit/03c3aadc4162b81cde7b7d00431b3a32d7beb7d2", "message": "fixup! Use GrpcCleanupRule instead", "committedDate": "2020-09-15T23:00:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTQ5MDEwMA==", "url": "https://github.com/grpc/grpc-java/pull/7426#discussion_r489490100", "bodyText": "This is designed so it can be inlined:\nManagedChannel channel = grpcCleanupRule.register(builder.build());\n// or\nassertEquals(\"original:1234\", grpcCleanupRule.register(builder.build()).authority());", "author": "ejona86", "createdAt": "2020-09-16T14:38:50Z", "path": "okhttp/src/test/java/io/grpc/okhttp/OkHttpChannelBuilderTest.java", "diffHunk": "@@ -46,11 +48,14 @@\n public class OkHttpChannelBuilderTest {\n \n   @Rule public final ExpectedException thrown = ExpectedException.none();\n+  @Rule public final GrpcCleanupRule grpcCleanupRule = new GrpcCleanupRule();\n \n   @Test\n   public void authorityIsReadable() {\n     OkHttpChannelBuilder builder = OkHttpChannelBuilder.forAddress(\"original\", 1234);\n-    assertEquals(\"original:1234\", builder.build().authority());\n+    ManagedChannel channel = builder.build();\n+    grpcCleanupRule.register(channel);", "originalCommit": "03c3aadc4162b81cde7b7d00431b3a32d7beb7d2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cc97fb6b2927dae30cec40aedfe8cb82f173f7da", "chunk": "diff --git a/okhttp/src/test/java/io/grpc/okhttp/OkHttpChannelBuilderTest.java b/okhttp/src/test/java/io/grpc/okhttp/OkHttpChannelBuilderTest.java\nindex bf68e62ef..1316463f7 100644\n--- a/okhttp/src/test/java/io/grpc/okhttp/OkHttpChannelBuilderTest.java\n+++ b/okhttp/src/test/java/io/grpc/okhttp/OkHttpChannelBuilderTest.java\n\n@@ -53,8 +53,7 @@ public class OkHttpChannelBuilderTest {\n   @Test\n   public void authorityIsReadable() {\n     OkHttpChannelBuilder builder = OkHttpChannelBuilder.forAddress(\"original\", 1234);\n-    ManagedChannel channel = builder.build();\n-    grpcCleanupRule.register(channel);\n+    ManagedChannel channel = grpcCleanupRule.register(builder.build());\n     assertEquals(\"original:1234\", channel.authority());\n   }\n \n"}}, {"oid": "cc97fb6b2927dae30cec40aedfe8cb82f173f7da", "url": "https://github.com/grpc/grpc-java/commit/cc97fb6b2927dae30cec40aedfe8cb82f173f7da", "message": "fixup! Use GrpcCleanupRule instead", "committedDate": "2020-09-16T15:01:58Z", "type": "commit"}]}