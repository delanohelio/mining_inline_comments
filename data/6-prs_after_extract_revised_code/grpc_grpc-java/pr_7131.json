{"pr_number": 7131, "pr_title": "xds: replace Envoy's DownstreamTlsContext with internally defined DownstreamTlsContext", "pr_createdAt": "2020-06-16T06:43:20Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7131", "timeline": [{"oid": "ec3dd8d0aa3dc8e9258aee095cb48e8546c286d5", "url": "https://github.com/grpc/grpc-java/commit/ec3dd8d0aa3dc8e9258aee095cb48e8546c286d5", "message": "xds: replace Envoy's DownstreamTlsContext with internally defined DownstreamTlsContext", "committedDate": "2020-06-16T06:41:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441008819", "bodyText": "DownstreamTlsContext.getCommonTlsContext() is not marked @Nullable. what happens if getCommonTlsContext is a default instance?", "author": "creamsoup", "createdAt": "2020-06-16T17:07:05Z", "path": "xds/src/main/java/io/grpc/xds/internal/sds/ServerSslContextProviderFactory.java", "diffHunk": "@@ -35,8 +34,8 @@\n   public SslContextProvider createSslContextProvider(\n       DownstreamTlsContext downstreamTlsContext) {\n     checkNotNull(downstreamTlsContext, \"downstreamTlsContext\");\n-    checkArgument(\n-        downstreamTlsContext.hasCommonTlsContext(),\n+    checkNotNull(\n+        downstreamTlsContext.getCommonTlsContext(),", "originalCommit": "ec3dd8d0aa3dc8e9258aee095cb48e8546c286d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE5MjYxMQ==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441192611", "bodyText": "This is an unlikely scenario or an error in the control plane (for sending faulty Listener data to us). So a Listener has filter-chains and a filter-chain with a \"tls\" named transport-socket has the DownstreamTlsContext payload. For the scenario you describe to occur, the \"tls\" named transport-socket should have a default-instance DownstreamTlsContext and/or that DownstreamTlsContext should have a default-instance CommonTlsContext. If the transport-socket is not going to be TLS why create the \"tls\" named transport socket?\nIn any case let me look at the code and do a quick check to ensure default-instances are handled properly.", "author": "sanjaypujare", "createdAt": "2020-06-16T23:13:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTIxMjgwNg==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441212806", "bodyText": "Okay, so I ran some tests and default-instances do result into exceptions (in SdsProtocolNegotiators.ServerSdsHandler). What I am planning to do is to handle these properly in SdsProtocolNegotiators.ServerSdsHandler (as well as SdsProtocolNegotiators.ClientSdsHandler) but that will be a separate PR (it can be opened in parallel so you can see it).", "author": "sanjaypujare", "createdAt": "2020-06-17T00:24:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTI4NDE3Mw==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441284173", "bodyText": "My other changes depend on changes in this PR, so I will make them once this is done. Works?", "author": "sanjaypujare", "createdAt": "2020-06-17T05:11:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY3Mzk4NA==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441673984", "bodyText": "sure.", "author": "creamsoup", "createdAt": "2020-06-17T16:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTgwMjMxMw==", "url": "https://github.com/grpc/grpc-java/pull/7131#discussion_r441802313", "bodyText": "So once this PR is merged I am planning to address the exception I mentioned above just to clarify.", "author": "sanjaypujare", "createdAt": "2020-06-17T20:05:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAwODgxOQ=="}], "type": "inlineReview", "revised_code": null}]}