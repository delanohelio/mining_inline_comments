{"pr_number": 7167, "pr_title": "okhttp: not using MigratingThreadDeframer", "pr_createdAt": "2020-06-29T21:33:24Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7167", "timeline": [{"oid": "926630dd1d868e90c09566afb6d9d3841ca09b31", "url": "https://github.com/grpc/grpc-java/commit/926630dd1d868e90c09566afb6d9d3841ca09b31", "message": "okhttp: not using MigratingThreadDeframer", "committedDate": "2020-06-29T21:39:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MDI2MQ==", "url": "https://github.com/grpc/grpc-java/pull/7167#discussion_r447270261", "bodyText": "You probably need the colon after the TODO. It doesn't matter, but I assume there is some linter somewhere that will complain about that, because somehow that makes us more productive.", "author": "ejona86", "createdAt": "2020-06-29T21:40:46Z", "path": "okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java", "diffHunk": "@@ -101,6 +101,11 @@\n             transport,\n             initialWindowSize,\n             method.getFullMethodName());\n+\n+    // TODO(ejona86) Fix a potential data race using MigratingThreadDeframer in OkHttp.", "originalCommit": "926630dd1d868e90c09566afb6d9d3841ca09b31", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "80cbec4fa776cdfd121a9e50bbf9b3507b8437e0", "chunk": "diff --git a/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java b/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\nindex 47a75fd16..d4f6ec281 100644\n--- a/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\n+++ b/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\n\n@@ -102,9 +102,8 @@ class OkHttpClientStream extends AbstractClientStream {\n             initialWindowSize,\n             method.getFullMethodName());\n \n-    // TODO(ejona86) Fix a potential data race using MigratingThreadDeframer in OkHttp.\n-    // OkHttp is lock based and it doesn't get benefit from using MigratingThreadDeframer,\n-    // disabling it to avoid race.\n+    // TODO(#7168): fix a potential data race using MigratingThreadDeframer in OkHttp.\n+    // disabling MigratingThreadDeframer in OkHttp due to the race\n     optimizeForDirectExecutor();\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MDQyMQ==", "url": "https://github.com/grpc/grpc-java/pull/7167#discussion_r447270421", "bodyText": "It did actually see a benefit. So let's just say we're disabling it for the race.", "author": "ejona86", "createdAt": "2020-06-29T21:41:08Z", "path": "okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java", "diffHunk": "@@ -101,6 +101,11 @@\n             transport,\n             initialWindowSize,\n             method.getFullMethodName());\n+\n+    // TODO(ejona86) Fix a potential data race using MigratingThreadDeframer in OkHttp.\n+    // OkHttp is lock based and it doesn't get benefit from using MigratingThreadDeframer,", "originalCommit": "926630dd1d868e90c09566afb6d9d3841ca09b31", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "80cbec4fa776cdfd121a9e50bbf9b3507b8437e0", "chunk": "diff --git a/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java b/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\nindex 47a75fd16..d4f6ec281 100644\n--- a/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\n+++ b/okhttp/src/main/java/io/grpc/okhttp/OkHttpClientStream.java\n\n@@ -102,9 +102,8 @@ class OkHttpClientStream extends AbstractClientStream {\n             initialWindowSize,\n             method.getFullMethodName());\n \n-    // TODO(ejona86) Fix a potential data race using MigratingThreadDeframer in OkHttp.\n-    // OkHttp is lock based and it doesn't get benefit from using MigratingThreadDeframer,\n-    // disabling it to avoid race.\n+    // TODO(#7168): fix a potential data race using MigratingThreadDeframer in OkHttp.\n+    // disabling MigratingThreadDeframer in OkHttp due to the race\n     optimizeForDirectExecutor();\n   }\n \n"}}, {"oid": "80cbec4fa776cdfd121a9e50bbf9b3507b8437e0", "url": "https://github.com/grpc/grpc-java/commit/80cbec4fa776cdfd121a9e50bbf9b3507b8437e0", "message": "fix comments/todo", "committedDate": "2020-06-29T21:57:45Z", "type": "commit"}]}