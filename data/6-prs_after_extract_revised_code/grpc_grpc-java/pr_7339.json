{"pr_number": 7339, "pr_title": "core: add accessor for bare method name in MethodDescriptor", "pr_createdAt": "2020-08-19T13:18:06Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7339", "timeline": [{"oid": "c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "url": "https://github.com/grpc/grpc-java/commit/c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "message": "core: add getMethodName to MethodDescriptor", "committedDate": "2020-08-19T15:50:30Z", "type": "commit"}, {"oid": "c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "url": "https://github.com/grpc/grpc-java/commit/c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "message": "core: add getMethodName to MethodDescriptor", "committedDate": "2020-08-19T15:50:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5OTgwNQ==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r475799805", "bodyText": "I don't think we should pre-compute this.", "author": "ejona86", "createdAt": "2020-08-24T18:06:08Z", "path": "api/src/main/java/io/grpc/MethodDescriptor.java", "diffHunk": "@@ -225,6 +226,7 @@ private MethodDescriptor(\n     this.type = Preconditions.checkNotNull(type, \"type\");\n     this.fullMethodName = Preconditions.checkNotNull(fullMethodName, \"fullMethodName\");\n     this.serviceName = extractFullServiceName(fullMethodName);\n+    this.methodName = extractMethodName(fullMethodName);", "originalCommit": "c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgyODAwNA==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r475828004", "bodyText": "Does this really matter? This should be a fairly cheap operation.", "author": "voidzcy", "createdAt": "2020-08-24T18:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5OTgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgzMDIzMw==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r475830233", "bodyText": "If it's so cheap we shouldn't mind doing it every time. Really, I don't think we want the startup initialization overhead and memory usage for something that may never be used (consider Android for example).", "author": "ejona86", "createdAt": "2020-08-24T19:00:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5OTgwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExODc0MQ==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r477118741", "bodyText": "My concern is that then every caller will need to cache it, but alas. Done.", "author": "pkern", "createdAt": "2020-08-26T08:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTc5OTgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "chunk": "diff --git a/api/src/main/java/io/grpc/MethodDescriptor.java b/api/src/main/java/io/grpc/MethodDescriptor.java\nindex a1712bbf9..500755de8 100644\n--- a/api/src/main/java/io/grpc/MethodDescriptor.java\n+++ b/api/src/main/java/io/grpc/MethodDescriptor.java\n\n@@ -226,7 +225,6 @@ public final class MethodDescriptor<ReqT, RespT> {\n     this.type = Preconditions.checkNotNull(type, \"type\");\n     this.fullMethodName = Preconditions.checkNotNull(fullMethodName, \"fullMethodName\");\n     this.serviceName = extractFullServiceName(fullMethodName);\n-    this.methodName = extractMethodName(fullMethodName);\n     this.requestMarshaller = Preconditions.checkNotNull(requestMarshaller, \"requestMarshaller\");\n     this.responseMarshaller = Preconditions.checkNotNull(responseMarshaller, \"responseMarshaller\");\n     this.schemaDescriptor = schemaDescriptor;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgwMDA0NA==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r475800044", "bodyText": "We should add something to the name to make users think whether they want the full name or this one. \"simple\" or \"bare\" or similar. Ditto for extract method.\nI'm not sure if we have any such term today, as method name is normally fully qualified. Maybe another language has such a thing?", "author": "ejona86", "createdAt": "2020-08-24T18:06:36Z", "path": "api/src/main/java/io/grpc/MethodDescriptor.java", "diffHunk": "@@ -262,6 +264,17 @@ public String getServiceName() {\n     return serviceName;\n   }\n \n+  /**\n+   * A convenience method for {@code extractMethodName(getFullMethodName())}.\n+   *\n+   * @since 1.32.0\n+   */\n+  @Nullable\n+  @ExperimentalApi(\"https://github.com/grpc/grpc-java/issues/5635\")\n+  public String getMethodName() {", "originalCommit": "c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExODc4Ng==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r477118786", "bodyText": "I am not aware of another language having solved this properly. The naming confusion is very real. Generally the full(y qualified) method name gets its own name (also here: getFullMethodName()) and the other one is just MethodName. But from the options I picked Bare for now. Let me know what you think.", "author": "pkern", "createdAt": "2020-08-26T08:16:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgwMDA0NA=="}], "type": "inlineReview", "revised_code": {"commit": "8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "chunk": "diff --git a/api/src/main/java/io/grpc/MethodDescriptor.java b/api/src/main/java/io/grpc/MethodDescriptor.java\nindex a1712bbf9..500755de8 100644\n--- a/api/src/main/java/io/grpc/MethodDescriptor.java\n+++ b/api/src/main/java/io/grpc/MethodDescriptor.java\n\n@@ -271,8 +269,8 @@ public final class MethodDescriptor<ReqT, RespT> {\n    */\n   @Nullable\n   @ExperimentalApi(\"https://github.com/grpc/grpc-java/issues/5635\")\n-  public String getMethodName() {\n-    return methodName;\n+  public String getBareMethodName() {\n+    return extractBareMethodName(fullMethodName);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgwMDk5Nw==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r475800997", "bodyText": "ExperimentalApi", "author": "ejona86", "createdAt": "2020-08-24T18:08:29Z", "path": "api/src/main/java/io/grpc/MethodDescriptor.java", "diffHunk": "@@ -398,6 +411,21 @@ public static String extractFullServiceName(String fullMethodName) {\n     return fullMethodName.substring(0, index);\n   }\n \n+  /**\n+   * Extract the method name out of a fully qualified method name. May return {@code null}\n+   * if the input is malformed, but you cannot rely on it for the validity of the input.\n+   *\n+   * @since 1.32.0\n+   */\n+  @Nullable\n+  public static String extractMethodName(String fullMethodName) {", "originalCommit": "c1c2ac119dd2ea6da2277783588af7b6a6bc24e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExODgyNw==", "url": "https://github.com/grpc/grpc-java/pull/7339#discussion_r477118827", "bodyText": "Done.", "author": "pkern", "createdAt": "2020-08-26T08:16:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgwMDk5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "chunk": "diff --git a/api/src/main/java/io/grpc/MethodDescriptor.java b/api/src/main/java/io/grpc/MethodDescriptor.java\nindex a1712bbf9..500755de8 100644\n--- a/api/src/main/java/io/grpc/MethodDescriptor.java\n+++ b/api/src/main/java/io/grpc/MethodDescriptor.java\n\n@@ -418,7 +416,8 @@ public final class MethodDescriptor<ReqT, RespT> {\n    * @since 1.32.0\n    */\n   @Nullable\n-  public static String extractMethodName(String fullMethodName) {\n+  @ExperimentalApi(\"https://github.com/grpc/grpc-java/issues/5635\")\n+  public static String extractBareMethodName(String fullMethodName) {\n     int index = checkNotNull(fullMethodName, \"fullMethodName\").lastIndexOf('/');\n     if (index == -1) {\n       return null;\n"}}, {"oid": "8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "url": "https://github.com/grpc/grpc-java/commit/8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "message": "Address code review comments", "committedDate": "2020-08-26T08:17:21Z", "type": "commit"}, {"oid": "8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "url": "https://github.com/grpc/grpc-java/commit/8de2605b4000ec7aff8bfaa0a354f5f9c54b06e1", "message": "Address code review comments", "committedDate": "2020-08-26T08:17:21Z", "type": "forcePushed"}, {"oid": "4cd3e038974e9817259c28c7bdaac811958e5512", "url": "https://github.com/grpc/grpc-java/commit/4cd3e038974e9817259c28c7bdaac811958e5512", "message": "Fix Javadoc typo.", "committedDate": "2020-09-03T20:46:55Z", "type": "commit"}]}