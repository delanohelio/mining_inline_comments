{"pr_number": 7113, "pr_title": "xds: propagate the original error causing XdsClient stream closure to the Channel", "pr_createdAt": "2020-06-10T18:27:21Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7113", "timeline": [{"oid": "7a8d207705b86aec39403e03576817556a09ce6b", "url": "https://github.com/grpc/grpc-java/commit/7a8d207705b86aec39403e03576817556a09ce6b", "message": "Propagate original error causing XdsClient stream closure to the Channel", "committedDate": "2020-06-10T18:26:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438345042", "bodyText": "This will use the oob chanel status code for the client channel though.", "author": "dapengzhang0", "createdAt": "2020-06-10T19:01:53Z", "path": "xds/src/main/java/io/grpc/xds/XdsNameResolver.java", "diffHunk": "@@ -224,7 +224,7 @@ public void onError(Status error) {\n       logger.log(\n           XdsLogLevel.WARNING,\n           \"Received error from xDS client {0}: {1}\", xdsClient, error.getDescription());\n-      listener.onError(Status.UNAVAILABLE.withDescription(error.getDescription()));\n+      listener.onError(error);", "originalCommit": "7a8d207705b86aec39403e03576817556a09ce6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NzMxMw==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438347313", "bodyText": "Yeah, I am a bit hesitating. But do we have to make all name resolution error UNAVAILABLE? Seems reasonable from high level, but maybe not a strong reason to. So I chose to preserve the original error to simplify the logic.", "author": "voidzcy", "createdAt": "2020-06-10T19:06:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM1MjY3OQ==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438352679", "bodyText": "Directly using the original status may not be a good idea. Ideally we should map the original status to the correct one as documented in https://github.com/grpc/grpc/blob/master/doc/statuscodes.md  if we think UNAVAILABLE is not correct in all cases.", "author": "sanjaypujare", "createdAt": "2020-06-10T19:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM1NjgxNw==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438356817", "bodyText": "The original status code is the status code that xDS stream encounters. It is gRPC status code, the mapping you are talking about is irrelevant here. If no strong reason/opinion/requirement for the name resolution status code, keeping the original is good enough.", "author": "voidzcy", "createdAt": "2020-06-10T19:24:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM3Nzc5MQ==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438377791", "bodyText": "...keeping the original is good enough.\n\nHave you considered this case: the user (gRPC developer) creates a client channel (they don't even know xDS will be involved because \"xds:///..\" is a runtime URI passed to the channel). Now your xDS stream/channel fails with something like \"invalid call credentials\" or \"invalid channel credentials\" are you going to report that as the error for the client channel? Will the user think this applies to their own client-to-server calls? If this is not an issue (because the error description is descriptive enough) then it's okay.", "author": "sanjaypujare", "createdAt": "2020-06-10T20:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM4NjQ2MA==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438386460", "bodyText": "We should assume users using xDS should at least have the knowledge of the high level xDS workflow. That is, they should at least know there is TD involved. Otherwise, users do not know what they are doing. The error surfaced to the Channel is\nFailed to resolve name. status= // whatever the status from the RPC contacting TD\n\nI don't see any problem with such an error propagation.", "author": "voidzcy", "createdAt": "2020-06-10T20:22:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5MDgyNg==", "url": "https://github.com/grpc/grpc-java/pull/7113#discussion_r438390826", "bodyText": "I disagree that we should expect users to know the nitty gritty of the xDS flow.\nIn any case the initial Failed to resolve name... would tell the user something and they would know (hopefully) this is not an issue with their own call creds or something.", "author": "sanjaypujare", "createdAt": "2020-06-10T20:31:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM0NTA0Mg=="}], "type": "inlineReview", "revised_code": null}]}