{"pr_number": 7181, "pr_title": "xds: convert and rename ReferenceCountingSslContextProviderMap to generic ReferenceCountingMap", "pr_createdAt": "2020-07-04T21:16:48Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7181", "timeline": [{"oid": "8ccbe098dbab2a54017456f176b1aa130a53950b", "url": "https://github.com/grpc/grpc-java/commit/8ccbe098dbab2a54017456f176b1aa130a53950b", "message": "xds: convert and rename ReferenceCountingSslContextProviderMap to generic ReferenceCountingMap", "committedDate": "2020-07-04T21:14:31Z", "type": "commit"}, {"oid": "3818943aa9a9f1e0816562b235d3f12f84bf8116", "url": "https://github.com/grpc/grpc-java/commit/3818943aa9a9f1e0816562b235d3f12f84bf8116", "message": "add override", "committedDate": "2020-07-04T21:23:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2Mjc4OA==", "url": "https://github.com/grpc/grpc-java/pull/7181#discussion_r450362788", "bodyText": "Can this class be final?", "author": "dapengzhang0", "createdAt": "2020-07-06T17:06:47Z", "path": "xds/src/main/java/io/grpc/xds/internal/sds/ReferenceCountingMap.java", "diffHunk": "@@ -101,19 +101,19 @@ private synchronized SslContextProvider releaseInternal(K key, SslContextProvide\n     return null;\n   }\n \n-  /** A factory to create an SslContextProvider from the given key. */\n-  public interface SslContextProviderFactory<K> {\n-    SslContextProvider createSslContextProvider(K key);\n+  /** A factory to create a value from the given key. */\n+  public interface ValueFactory<K, V extends Closeable> {\n+    V create(K key);\n   }\n \n-  private static class Instance {\n-    final SslContextProvider sslContextProvider;\n+  private static class Instance<V extends Closeable> {", "originalCommit": "3818943aa9a9f1e0816562b235d3f12f84bf8116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU1MTExMg==", "url": "https://github.com/grpc/grpc-java/pull/7181#discussion_r450551112", "bodyText": "Done", "author": "sanjaypujare", "createdAt": "2020-07-07T00:46:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM2Mjc4OA=="}], "type": "inlineReview", "revised_code": {"commit": "f08250ee68e1d2197dffbfcc16c4007c841fdac1", "chunk": "diff --git a/xds/src/main/java/io/grpc/xds/internal/sds/ReferenceCountingMap.java b/xds/src/main/java/io/grpc/xds/internal/sds/ReferenceCountingMap.java\nindex 2b4b8d2c2..45dee9cc5 100644\n--- a/xds/src/main/java/io/grpc/xds/internal/sds/ReferenceCountingMap.java\n+++ b/xds/src/main/java/io/grpc/xds/internal/sds/ReferenceCountingMap.java\n\n@@ -106,7 +106,7 @@ final class ReferenceCountingMap<K, V extends Closeable> {\n     V create(K key);\n   }\n \n-  private static class Instance<V extends Closeable> {\n+  private static final class Instance<V extends Closeable> {\n     final V value;\n     private int refCount;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxODYxOQ==", "url": "https://github.com/grpc/grpc-java/pull/7181#discussion_r450518619", "bodyText": "Can this be abstract method?", "author": "dapengzhang0", "createdAt": "2020-07-06T22:50:00Z", "path": "xds/src/main/java/io/grpc/xds/internal/sds/SslContextProvider.java", "diffHunk": "@@ -93,7 +93,8 @@ public UpstreamTlsContext getUpstreamTlsContext() {\n   }\n \n   /** Closes this provider and releases any resources. */\n-  void close() {}\n+  @Override\n+  public void close() {}", "originalCommit": "3818943aa9a9f1e0816562b235d3f12f84bf8116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU1MTY1OQ==", "url": "https://github.com/grpc/grpc-java/pull/7181#discussion_r450551659", "bodyText": "I left it as a default implementation so the subclasses don't need to define it for a \"no-op\" close(). But making abstract and forcing subclasses to define it (since closing to release resources is so important) is okay as well so I made the change", "author": "sanjaypujare", "createdAt": "2020-07-07T00:48:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUxODYxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "f08250ee68e1d2197dffbfcc16c4007c841fdac1", "chunk": "diff --git a/xds/src/main/java/io/grpc/xds/internal/sds/SslContextProvider.java b/xds/src/main/java/io/grpc/xds/internal/sds/SslContextProvider.java\nindex 89edbf1b1..a35dd43e3 100644\n--- a/xds/src/main/java/io/grpc/xds/internal/sds/SslContextProvider.java\n+++ b/xds/src/main/java/io/grpc/xds/internal/sds/SslContextProvider.java\n\n@@ -94,7 +94,7 @@ public abstract class SslContextProvider implements Closeable {\n \n   /** Closes this provider and releases any resources. */\n   @Override\n-  public void close() {}\n+  public abstract void close();\n \n   /**\n    * Registers a callback on the given executor. The callback will run when SslContext becomes\n"}}, {"oid": "f08250ee68e1d2197dffbfcc16c4007c841fdac1", "url": "https://github.com/grpc/grpc-java/commit/f08250ee68e1d2197dffbfcc16c4007c841fdac1", "message": "address review comments", "committedDate": "2020-07-07T00:33:56Z", "type": "commit"}]}