{"pr_number": 1299, "pr_title": "Fix InMemoryMetricsRepository can't keep  the last five minutes metrics data problem", "pr_createdAt": "2020-02-23T06:33:19Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1299", "timeline": [{"oid": "11dba5e01a3c76583ae9fabeb93567a9a7c1817c", "url": "https://github.com/alibaba/Sentinel/commit/11dba5e01a3c76583ae9fabeb93567a9a7c1817c", "message": "com.alibaba.csp.sentinel.node.StatisticNode#curThreadNum\nusing the LongAdder rather than AtomicInteger to Provides better performance", "committedDate": "2019-05-09T06:54:31Z", "type": "commit"}, {"oid": "362f326974e310308b135438e96b4d2052679447", "url": "https://github.com/alibaba/Sentinel/commit/362f326974e310308b135438e96b4d2052679447", "message": "reformat the code according to Alibaba Java Coding Guideline", "committedDate": "2019-05-11T13:39:54Z", "type": "commit"}, {"oid": "50d2a5ab8a02b05b9f427eab64812118b8b11eb2", "url": "https://github.com/alibaba/Sentinel/commit/50d2a5ab8a02b05b9f427eab64812118b8b11eb2", "message": "reformat the code according to Alibaba Java Coding Guideline", "committedDate": "2019-05-11T14:01:55Z", "type": "commit"}, {"oid": "509ecf290d6f8ebfb7c14ba0342b03bbd5dcc026", "url": "https://github.com/alibaba/Sentinel/commit/509ecf290d6f8ebfb7c14ba0342b03bbd5dcc026", "message": "Merge pull request #1 from alibaba/master\n\nmerge master", "committedDate": "2019-05-25T04:27:44Z", "type": "commit"}, {"oid": "01bda6bfb30b0d27f28ac78a7b37e4eacb575971", "url": "https://github.com/alibaba/Sentinel/commit/01bda6bfb30b0d27f28ac78a7b37e4eacb575971", "message": "Remove the one redundant space....", "committedDate": "2019-05-28T08:28:10Z", "type": "commit"}, {"oid": "ce717e954f0f860101ed185803aad85bf6f9ca3e", "url": "https://github.com/alibaba/Sentinel/commit/ce717e954f0f860101ed185803aad85bf6f9ca3e", "message": "fix issue 62 : Support customized log directory and configuration properties directory", "committedDate": "2019-05-31T11:27:32Z", "type": "commit"}, {"oid": "b8e66b8a8679eda21ec199e3847ba2c68e2a9c61", "url": "https://github.com/alibaba/Sentinel/commit/b8e66b8a8679eda21ec199e3847ba2c68e2a9c61", "message": "use System.getProperty to get the property", "committedDate": "2019-05-31T11:40:30Z", "type": "commit"}, {"oid": "5c6600d374eea984a11b29806486e7c4759f3268", "url": "https://github.com/alibaba/Sentinel/commit/5c6600d374eea984a11b29806486e7c4759f3268", "message": "Merge pull request #2 from alibaba/master\n\nmerge online", "committedDate": "2019-06-14T02:21:59Z", "type": "commit"}, {"oid": "99991547fde3c4fefe152fef396fe955212b6456", "url": "https://github.com/alibaba/Sentinel/commit/99991547fde3c4fefe152fef396fe955212b6456", "message": "merge master latest code", "committedDate": "2019-06-14T02:32:26Z", "type": "commit"}, {"oid": "8f9339b5b3a0544fd36bf1a942fecf8f1f007999", "url": "https://github.com/alibaba/Sentinel/commit/8f9339b5b3a0544fd36bf1a942fecf8f1f007999", "message": "using SentinelConfigLocator to load sentinel-core config, LogConfigLocator to load log config", "committedDate": "2019-06-19T09:45:06Z", "type": "commit"}, {"oid": "2f485b4a8509616dba83fe003241ff0bbd3a859b", "url": "https://github.com/alibaba/Sentinel/commit/2f485b4a8509616dba83fe003241ff0bbd3a859b", "message": "Merge pull request #3 from alibaba/master\n\nmerge onlie", "committedDate": "2019-06-19T09:46:16Z", "type": "commit"}, {"oid": "c6dd24dcc26c57ee09c50fb7d520b38a23a2fa95", "url": "https://github.com/alibaba/Sentinel/commit/c6dd24dcc26c57ee09c50fb7d520b38a23a2fa95", "message": "merge remote master", "committedDate": "2019-06-19T10:28:28Z", "type": "commit"}, {"oid": "810d40ad98a62efb69e783840bd3e8ae761c9e3c", "url": "https://github.com/alibaba/Sentinel/commit/810d40ad98a62efb69e783840bd3e8ae761c9e3c", "message": "fix typo", "committedDate": "2019-06-19T10:34:24Z", "type": "commit"}, {"oid": "3f98b626a0293b3159a5f23a5fb069194507af15", "url": "https://github.com/alibaba/Sentinel/commit/3f98b626a0293b3159a5f23a5fb069194507af15", "message": "add null judge", "committedDate": "2019-06-19T10:44:33Z", "type": "commit"}, {"oid": "23244e9f88d915f856b0d59080124e2db4b1c5cd", "url": "https://github.com/alibaba/Sentinel/commit/23244e9f88d915f856b0d59080124e2db4b1c5cd", "message": "Reorganize the code", "committedDate": "2019-06-20T10:26:06Z", "type": "commit"}, {"oid": "bd8a481d84654a5773bc346dc72ddc7ae7587024", "url": "https://github.com/alibaba/Sentinel/commit/bd8a481d84654a5773bc346dc72ddc7ae7587024", "message": "Reorganize the code", "committedDate": "2019-06-20T11:27:02Z", "type": "commit"}, {"oid": "e6bbf7998617d482e6b6be7574ffa8b2a0a22569", "url": "https://github.com/alibaba/Sentinel/commit/e6bbf7998617d482e6b6be7574ffa8b2a0a22569", "message": "add config test cases", "committedDate": "2019-06-25T09:02:10Z", "type": "commit"}, {"oid": "c91b963039edcf2358d11d781e378783e8ced774", "url": "https://github.com/alibaba/Sentinel/commit/c91b963039edcf2358d11d781e378783e8ced774", "message": "ConfigUtil.loadPropertiesFromFile when file not exist return null", "committedDate": "2019-06-25T11:02:57Z", "type": "commit"}, {"oid": "d401c2fe0f1fb7c860d2674712dde11dbcd264b0", "url": "https://github.com/alibaba/Sentinel/commit/d401c2fe0f1fb7c860d2674712dde11dbcd264b0", "message": "rename classname and method name", "committedDate": "2019-06-27T11:38:39Z", "type": "commit"}, {"oid": "85173a546873127564fcb6b233c481d1ae6bd6ea", "url": "https://github.com/alibaba/Sentinel/commit/85173a546873127564fcb6b233c481d1ae6bd6ea", "message": "rename classname and method name", "committedDate": "2019-06-27T11:43:29Z", "type": "commit"}, {"oid": "4510234aa476337a052624be731b5149a7d5dfcd", "url": "https://github.com/alibaba/Sentinel/commit/4510234aa476337a052624be731b5149a7d5dfcd", "message": "using  File.separator  to replace  \"/\"", "committedDate": "2019-06-27T11:57:42Z", "type": "commit"}, {"oid": "c068eddaeba4e968557dd79f1590b0aaa11f3e6b", "url": "https://github.com/alibaba/Sentinel/commit/c068eddaeba4e968557dd79f1590b0aaa11f3e6b", "message": "support retrieve properties from classpath file", "committedDate": "2019-06-27T13:32:13Z", "type": "commit"}, {"oid": "9af06c99318e46af9727f0fe16a440f669b4eb95", "url": "https://github.com/alibaba/Sentinel/commit/9af06c99318e46af9727f0fe16a440f669b4eb95", "message": "support retrieve properties from classpath file", "committedDate": "2019-06-27T13:40:37Z", "type": "commit"}, {"oid": "014cda3489223e54e7bf490ef733edae14bfff2c", "url": "https://github.com/alibaba/Sentinel/commit/014cda3489223e54e7bf490ef733edae14bfff2c", "message": "add feature support : retrieve properties from relative file", "committedDate": "2019-07-01T08:39:24Z", "type": "commit"}, {"oid": "a899dc6b434aac6328bee0f7fb86ea0586065b29", "url": "https://github.com/alibaba/Sentinel/commit/a899dc6b434aac6328bee0f7fb86ea0586065b29", "message": "reformat code", "committedDate": "2019-07-01T09:33:42Z", "type": "commit"}, {"oid": "419d97fb9f1fa0669f56d376b5a155323aef8424", "url": "https://github.com/alibaba/Sentinel/commit/419d97fb9f1fa0669f56d376b5a155323aef8424", "message": "Merge pull request #4 from alibaba/master\n\nmerge online", "committedDate": "2019-07-01T09:42:06Z", "type": "commit"}, {"oid": "80f283e3222c70e66ab582aabf7f47c9f3fc1b94", "url": "https://github.com/alibaba/Sentinel/commit/80f283e3222c70e66ab582aabf7f47c9f3fc1b94", "message": "Merge remote-tracking branch 'remotes/origin/master' into 20190531-fix-issue62", "committedDate": "2019-07-01T09:43:13Z", "type": "commit"}, {"oid": "14a1d5b5599016f1f601a45cf51d5830ea35059f", "url": "https://github.com/alibaba/Sentinel/commit/14a1d5b5599016f1f601a45cf51d5830ea35059f", "message": "Revert \"rename classname and method name\"\n\nThis reverts commit d401c2fe", "committedDate": "2019-07-05T14:49:27Z", "type": "commit"}, {"oid": "ea18020610dfb0099e6f07ea5a630ab90b908ff0", "url": "https://github.com/alibaba/Sentinel/commit/ea18020610dfb0099e6f07ea5a630ab90b908ff0", "message": "add copy right doc", "committedDate": "2019-07-05T14:58:47Z", "type": "commit"}, {"oid": "c562474480fb7fa7d1e941edab3f1a97bb3f0bff", "url": "https://github.com/alibaba/Sentinel/commit/c562474480fb7fa7d1e941edab3f1a97bb3f0bff", "message": "reset commit", "committedDate": "2019-07-06T01:37:20Z", "type": "commit"}, {"oid": "c71759fadfa9275e568a88f118b6eb7dc7981790", "url": "https://github.com/alibaba/Sentinel/commit/c71759fadfa9275e568a88f118b6eb7dc7981790", "message": "remove unused code", "committedDate": "2019-07-06T04:10:50Z", "type": "commit"}, {"oid": "d387b47f131c7c7d724788236d1ed6f9657174c6", "url": "https://github.com/alibaba/Sentinel/commit/d387b47f131c7c7d724788236d1ed6f9657174c6", "message": "merge alibaba master", "committedDate": "2019-07-10T06:56:37Z", "type": "commit"}, {"oid": "56d5df032b574e48ca5de2a635170d2ed8fbe629", "url": "https://github.com/alibaba/Sentinel/commit/56d5df032b574e48ca5de2a635170d2ed8fbe629", "message": "Merge pull request #6 from alibaba/master\n\nmerge online", "committedDate": "2019-07-24T03:01:19Z", "type": "commit"}, {"oid": "22cafd2454881988180a23dfde582f3a1c74ed0c", "url": "https://github.com/alibaba/Sentinel/commit/22cafd2454881988180a23dfde582f3a1c74ed0c", "message": "Merge pull request #7 from alibaba/master\n\nmerge remote master", "committedDate": "2019-08-22T07:28:26Z", "type": "commit"}, {"oid": "7a0c6b7b11b128134845e4daaa50f7267b21a1ea", "url": "https://github.com/alibaba/Sentinel/commit/7a0c6b7b11b128134845e4daaa50f7267b21a1ea", "message": "Merge pull request #8 from alibaba/master\n\nmerge online", "committedDate": "2019-09-10T02:36:30Z", "type": "commit"}, {"oid": "d3adf4fc8c9850f6b572045e1e0f4f76873be9f2", "url": "https://github.com/alibaba/Sentinel/commit/d3adf4fc8c9850f6b572045e1e0f4f76873be9f2", "message": "fix InMemoryMetricsRepository don't display the last five minutes bug (#1031)", "committedDate": "2020-02-23T06:27:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcyNjA4MA==", "url": "https://github.com/alibaba/Sentinel/pull/1299#discussion_r387726080", "bodyText": "Why change the range here\uff1fI think previous 2 * EXPIRE_TIME is better, since it proves that the expireEntry has not exist in repository now.", "author": "cdfive", "createdAt": "2020-03-04T15:06:35Z", "path": "sentinel-dashboard/src/test/java/com/alibaba/csp/sentinel/dashboard/repository/metric/InMemoryMetricsRepositoryTest.java", "diffHunk": "@@ -95,47 +127,41 @@ public void testExpireMetric() {\n         inMemoryMetricsRepository.save(entry);\n \n         List<MetricEntity> list = inMemoryMetricsRepository.queryByAppAndResourceBetween(\n-            DEFAULT_EXPIRE_APP, DEFAULT_RESOURCE, now - 2 * EXPIRE_TIME, now + EXPIRE_TIME);\n+                \"testExpire\", \"testResource\", now - EXPIRE_TIME, now);", "originalCommit": "d3adf4fc8c9850f6b572045e1e0f4f76873be9f2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc0ODY1Mw==", "url": "https://github.com/alibaba/Sentinel/pull/1299#discussion_r387748653", "bodyText": "Why change the range here\uff1fI think previous 2 * EXPIRE_TIME is better, since it proves that the expireEntry has not exist in repository now.\n\nIn this case what want to be proved is  entry which  exceed EXPIRE_TIME will be eliminate not the 2 * EXPIRE_TIME.  2 * EXPIRE_TIME can pass the test case \uff0c but not strictly.", "author": "linlinisme", "createdAt": "2020-03-04T15:38:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcyNjA4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1NjI2MA==", "url": "https://github.com/alibaba/Sentinel/pull/1299#discussion_r387756260", "bodyText": "The last assertion has proved the case, and the new range here is more clearer semantically and strictly. I agree, it's ok.", "author": "cdfive", "createdAt": "2020-03-04T15:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzcyNjA4MA=="}], "type": "inlineReview", "revised_code": null}]}