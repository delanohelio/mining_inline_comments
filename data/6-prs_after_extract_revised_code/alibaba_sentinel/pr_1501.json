{"pr_number": 1501, "pr_title": "add unit test for tuple2", "pr_createdAt": "2020-05-23T12:26:46Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1501", "timeline": [{"oid": "da6fca2e4b36c4223b363ce51089fb498a08eb23", "url": "https://github.com/alibaba/Sentinel/commit/da6fca2e4b36c4223b363ce51089fb498a08eb23", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-23T12:40:16Z", "type": "forcePushed"}, {"oid": "eef3d7ef6e14e62b018ab58a0586be1143def088", "url": "https://github.com/alibaba/Sentinel/commit/eef3d7ef6e14e62b018ab58a0586be1143def088", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-24T06:52:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyMTQ3Mw==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429621473", "bodyText": "Could you please add the license header here?", "author": "sczyh30", "createdAt": "2020-05-24T10:24:47Z", "path": "sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.alibaba.csp.sentinel.util.function;", "originalCommit": "eef3d7ef6e14e62b018ab58a0586be1143def088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYzNTA0NA==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429635044", "bodyText": "done", "author": "yunfeiyanggzq", "createdAt": "2020-05-24T13:09:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyMTQ3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "fccb545926784da82a9b3bf75c17e42e58af6431", "chunk": "diff --git a/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java b/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\nindex c07c4712..ec0deb9b 100644\n--- a/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\n+++ b/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\n\n@@ -1,3 +1,18 @@\n+/*\n+ * Copyright 1999-2019 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n package com.alibaba.csp.sentinel.util.function;\n \n import org.junit.Assert;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyMTU2Mw==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429621563", "bodyText": "Maybe it's better to compare the r1/r2 value directly?", "author": "sczyh30", "createdAt": "2020-05-24T10:25:40Z", "path": "sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.alibaba.csp.sentinel.util.function;\n+\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+public class Tuple2Test {\n+\n+    @Test\n+    public void testSwap() {\n+        Tuple2<Integer, Integer> tupleOld = new Tuple2(1, 2);\n+        Tuple2<Integer, Integer> tupleNew = tupleOld.swap();\n+        Assert.assertEquals(\"Tuple2{r1=2, r2=1}\", tupleNew.toString());", "originalCommit": "eef3d7ef6e14e62b018ab58a0586be1143def088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYzNTA2MA==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429635060", "bodyText": "done", "author": "yunfeiyanggzq", "createdAt": "2020-05-24T13:09:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyMTU2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "fccb545926784da82a9b3bf75c17e42e58af6431", "chunk": "diff --git a/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java b/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\nindex c07c4712..ec0deb9b 100644\n--- a/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\n+++ b/sentinel-core/src/test/java/com/alibaba/csp/sentinel/util/function/Tuple2Test.java\n\n@@ -1,3 +1,18 @@\n+/*\n+ * Copyright 1999-2019 Alibaba Group Holding Ltd.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n package com.alibaba.csp.sentinel.util.function;\n \n import org.junit.Assert;\n"}}, {"oid": "fccb545926784da82a9b3bf75c17e42e58af6431", "url": "https://github.com/alibaba/Sentinel/commit/fccb545926784da82a9b3bf75c17e42e58af6431", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-24T12:34:08Z", "type": "forcePushed"}, {"oid": "9e34099c2af8624e576a442d2d34604d568d1b63", "url": "https://github.com/alibaba/Sentinel/commit/9e34099c2af8624e576a442d2d34604d568d1b63", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-24T12:51:03Z", "type": "forcePushed"}, {"oid": "2b781ef6a6187d4b00b9cb2085809aeb4b144f55", "url": "https://github.com/alibaba/Sentinel/commit/2b781ef6a6187d4b00b9cb2085809aeb4b144f55", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-24T13:07:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcwMjc1NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429702755", "bodyText": "The hashCode method should be provided as well.", "author": "sczyh30", "createdAt": "2020-05-25T01:54:46Z", "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java", "diffHunk": "@@ -31,11 +31,24 @@ public Tuple2(R1 r1, R2 r2) {\n         return new Tuple2<R2, R1>(this.r2, this.r1);\n     }\n \n+    @Override\n+    public boolean equals(Object o) {", "originalCommit": "2b781ef6a6187d4b00b9cb2085809aeb4b144f55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcwNjk2MA==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429706960", "bodyText": "Thanks for your help,done", "author": "yunfeiyanggzq", "createdAt": "2020-05-25T02:21:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcwMjc1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "7c67f43743a1a21ee2076f877c7e3b5f9b141920", "chunk": "diff --git a/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java b/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\nindex fa53ebaa..8cf5d95a 100644\n--- a/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\n+++ b/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\n\n@@ -44,6 +44,13 @@ public class Tuple2<R1, R2> {\n         return this.r1.equals(tuple2.r1) && this.r2.equals(tuple2.r2);\n     }\n \n+    @Override\n+    public int hashCode() {\n+        int result = r1 != null ? r1.hashCode() : 0;\n+        result = 31 * result + (r2 != null ? r2.hashCode() : 0);\n+        return result;\n+    }\n+\n     @Override\n     public String toString() {\n         return \"Tuple2{\" +\n"}}, {"oid": "7c67f43743a1a21ee2076f877c7e3b5f9b141920", "url": "https://github.com/alibaba/Sentinel/commit/7c67f43743a1a21ee2076f877c7e3b5f9b141920", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-25T02:15:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcxNzQwNQ==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429717405", "bodyText": "It might be better to use Objects.equals(a, b) here, as r1 and r2 might be null (refer the template in IDEA).", "author": "sczyh30", "createdAt": "2020-05-25T03:27:55Z", "path": "sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java", "diffHunk": "@@ -31,11 +31,31 @@ public Tuple2(R1 r1, R2 r2) {\n         return new Tuple2<R2, R1>(this.r2, this.r1);\n     }\n \n+    @Override\n+    public boolean equals(Object o) {\n+        if (this == o) {\n+            return true;\n+        }\n+        if (!(o instanceof Tuple2)) {\n+            return false;\n+        }\n+        Tuple2 tuple2 = (Tuple2) o;\n+\n+        return this.r1.equals(tuple2.r1) && this.r2.equals(tuple2.r2);", "originalCommit": "7c67f43743a1a21ee2076f877c7e3b5f9b141920", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcxOTg4OA==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429719888", "bodyText": "done !  you are right,I find some equals() functions  in sentinel  exist the  same problems like my code", "author": "yunfeiyanggzq", "createdAt": "2020-05-25T03:43:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcxNzQwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcyMDEyMA==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429720120", "bodyText": "thank you very much for your help!!", "author": "yunfeiyanggzq", "createdAt": "2020-05-25T03:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcxNzQwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MDE1NQ==", "url": "https://github.com/alibaba/Sentinel/pull/1501#discussion_r429740155", "bodyText": "done! you are right, I find some equals() functions in sentinel exist the same problems like my code\n\nFeel free to submit PRs to fix it :)", "author": "sczyh30", "createdAt": "2020-05-25T05:43:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTcxNzQwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "e3197b864720680a7c1979714c5fc8230bd29457", "chunk": "diff --git a/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java b/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\nindex 8cf5d95a..65b5dfc9 100644\n--- a/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\n+++ b/sentinel-core/src/main/java/com/alibaba/csp/sentinel/util/function/Tuple2.java\n\n@@ -39,9 +41,8 @@ public class Tuple2<R1, R2> {\n         if (!(o instanceof Tuple2)) {\n             return false;\n         }\n-        Tuple2 tuple2 = (Tuple2) o;\n-\n-        return this.r1.equals(tuple2.r1) && this.r2.equals(tuple2.r2);\n+        Tuple2 that = (Tuple2) o;\n+        return Objects.equals(this.r1, that.r1) && Objects.equals(this.r2, that.r2);\n     }\n \n     @Override\n"}}, {"oid": "e3197b864720680a7c1979714c5fc8230bd29457", "url": "https://github.com/alibaba/Sentinel/commit/e3197b864720680a7c1979714c5fc8230bd29457", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-25T03:39:34Z", "type": "commit"}, {"oid": "e3197b864720680a7c1979714c5fc8230bd29457", "url": "https://github.com/alibaba/Sentinel/commit/e3197b864720680a7c1979714c5fc8230bd29457", "message": "add tuples test\n\nSigned-off-by: yunfeiyanggzq <yunfeiyang@buaa.edu.cn>", "committedDate": "2020-05-25T03:39:34Z", "type": "forcePushed"}]}