{"pr_number": 1533, "pr_title": "webmvc-adapter: improve set entry in request to avoid ErrorEntryFreeException", "pr_createdAt": "2020-06-08T15:42:13Z", "pr_url": "https://github.com/alibaba/Sentinel/pull/1533", "timeline": [{"oid": "95f50e3ed21220ec5d74e12bc44066cbd6ecb3e9", "url": "https://github.com/alibaba/Sentinel/commit/95f50e3ed21220ec5d74e12bc44066cbd6ecb3e9", "message": "If attribute key already exists in request, don't create entry to avoid ErrorEntryFreeException", "committedDate": "2020-06-08T15:29:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE3ODU1Ng==", "url": "https://github.com/alibaba/Sentinel/pull/1533#discussion_r464178556", "bodyText": "Could you please add some comments regarding the related issue?", "author": "sczyh30", "createdAt": "2020-08-03T03:39:50Z", "path": "sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java", "diffHunk": "@@ -110,12 +108,13 @@ public void postHandle(HttpServletRequest request, HttpServletResponse response,\n                            ModelAndView modelAndView) throws Exception {\n     }\n \n-    protected void setEntryInRequest(HttpServletRequest request, String name, Entry entry) {\n+    protected void setEntryInRequest(HttpServletRequest request, String name, String resourceName) throws BlockException {", "originalCommit": "95f50e3ed21220ec5d74e12bc44066cbd6ecb3e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE5NzE2MQ==", "url": "https://github.com/alibaba/Sentinel/pull/1533#discussion_r464197161", "bodyText": "I'll arrange it and add comments after work.", "author": "cdfive", "createdAt": "2020-08-03T05:10:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE3ODU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQ5MDY3MQ==", "url": "https://github.com/alibaba/Sentinel/pull/1533#discussion_r464490671", "bodyText": "Comments are added, please check it.", "author": "cdfive", "createdAt": "2020-08-03T15:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDE3ODU1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "9bd0ccf49041950919df663254cb107400c39069", "chunk": "diff --git a/sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java b/sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java\nindex 0be74cba..c4de7847 100644\n--- a/sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java\n+++ b/sentinel-adapter/sentinel-spring-webmvc-adapter/src/main/java/com/alibaba/csp/sentinel/adapter/spring/webmvc/AbstractSentinelInterceptor.java\n\n@@ -108,6 +108,15 @@ public abstract class AbstractSentinelInterceptor implements HandlerInterceptor\n                            ModelAndView modelAndView) throws Exception {\n     }\n \n+    /**\n+     * Note:\n+     * If the attribute key already exists in request, don't create new {@link Entry},\n+     * to guarantee the order of {@link Entry} in pair and avoid {@link com.alibaba.csp.sentinel.ErrorEntryFreeException}.\n+     *\n+     * Refer to:\n+     * https://github.com/alibaba/Sentinel/issues/1531\n+     * https://github.com/alibaba/Sentinel/issues/1482\n+     */\n     protected void setEntryInRequest(HttpServletRequest request, String name, String resourceName) throws BlockException {\n         Object attrVal = request.getAttribute(name);\n         if (attrVal != null) {\n"}}, {"oid": "9bd0ccf49041950919df663254cb107400c39069", "url": "https://github.com/alibaba/Sentinel/commit/9bd0ccf49041950919df663254cb107400c39069", "message": "Add comments and related issues", "committedDate": "2020-08-03T15:28:58Z", "type": "commit"}]}