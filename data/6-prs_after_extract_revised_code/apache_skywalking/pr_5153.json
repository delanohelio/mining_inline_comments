{"pr_number": 5153, "pr_title": "Support Apache ShardingSphere-Elasticjob", "pr_createdAt": "2020-07-22T12:56:54Z", "pr_url": "https://github.com/apache/skywalking/pull/5153", "timeline": [{"oid": "e575c2e7ffc054daa3ed3a906354fb2e32b59b49", "url": "https://github.com/apache/skywalking/commit/e575c2e7ffc054daa3ed3a906354fb2e32b59b49", "message": "tmp commit", "committedDate": "2020-07-22T12:53:24Z", "type": "commit"}, {"oid": "dcd2113f79ff07f65521d67cc997bd47f4e59ed2", "url": "https://github.com/apache/skywalking/commit/dcd2113f79ff07f65521d67cc997bd47f4e59ed2", "message": "fix", "committedDate": "2020-07-22T13:37:09Z", "type": "commit"}, {"oid": "728ebe8ae94fd056524f5da9d9b07f5944cd972b", "url": "https://github.com/apache/skywalking/commit/728ebe8ae94fd056524f5da9d9b07f5944cd972b", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-22T13:44:07Z", "type": "commit"}, {"oid": "b072c9507d724b18fa80bef2d3e2765acf4af6bf", "url": "https://github.com/apache/skywalking/commit/b072c9507d724b18fa80bef2d3e2765acf4af6bf", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-23T01:59:10Z", "type": "commit"}, {"oid": "b398dd28d0aad530ef62cdcacebc8291254e6812", "url": "https://github.com/apache/skywalking/commit/b398dd28d0aad530ef62cdcacebc8291254e6812", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-24T09:59:56Z", "type": "commit"}, {"oid": "28731aee7dc61dfe502cde62e24dc3ce67e89035", "url": "https://github.com/apache/skywalking/commit/28731aee7dc61dfe502cde62e24dc3ce67e89035", "message": "Merge branch 'zhaoyuguang_0001' of https://github.com/zhaoyuguang/incubator-skywalking into zhaoyuguang_0001", "committedDate": "2020-07-24T10:03:28Z", "type": "commit"}, {"oid": "e897d98cc7666ee0b754fe13d53cff187b00451f", "url": "https://github.com/apache/skywalking/commit/e897d98cc7666ee0b754fe13d53cff187b00451f", "message": "fix", "committedDate": "2020-07-25T12:14:50Z", "type": "commit"}, {"oid": "fc0c86dd08b5ef4d7d54803fc8ab459b820e482e", "url": "https://github.com/apache/skywalking/commit/fc0c86dd08b5ef4d7d54803fc8ab459b820e482e", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-25T12:15:38Z", "type": "commit"}, {"oid": "7ab1f73229a0317cdb9c5b6bbd72fcf7d7235600", "url": "https://github.com/apache/skywalking/commit/7ab1f73229a0317cdb9c5b6bbd72fcf7d7235600", "message": "fix", "committedDate": "2020-07-27T05:12:32Z", "type": "commit"}, {"oid": "bd901447b89f79e650f9fb7cdb917667efbf98ee", "url": "https://github.com/apache/skywalking/commit/bd901447b89f79e650f9fb7cdb917667efbf98ee", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-27T05:15:04Z", "type": "commit"}, {"oid": "55b935c051353cc7975660c8c5a70d45897be269", "url": "https://github.com/apache/skywalking/commit/55b935c051353cc7975660c8c5a70d45897be269", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-07-28T05:09:29Z", "type": "commit"}, {"oid": "c7eca2cdd40906307cd50f27f599bf8e12ebfc27", "url": "https://github.com/apache/skywalking/commit/c7eca2cdd40906307cd50f27f599bf8e12ebfc27", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-08-04T06:07:40Z", "type": "commit"}, {"oid": "158e06e5e75e407518c12a77a40c9e2e5d5f8a8a", "url": "https://github.com/apache/skywalking/commit/158e06e5e75e407518c12a77a40c9e2e5d5f8a8a", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-08-04T13:02:34Z", "type": "commit"}, {"oid": "221ea2bb92a302f1f851173dd454e20a8d165d71", "url": "https://github.com/apache/skywalking/commit/221ea2bb92a302f1f851173dd454e20a8d165d71", "message": "update", "committedDate": "2020-08-04T13:05:37Z", "type": "commit"}, {"oid": "c8c0c71005c8505f7e964ba05e1ad289766cba6b", "url": "https://github.com/apache/skywalking/commit/c8c0c71005c8505f7e964ba05e1ad289766cba6b", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-08-08T06:18:50Z", "type": "commit"}, {"oid": "e724a3c2b59e992051a22423fd3bc660c5c8bd10", "url": "https://github.com/apache/skywalking/commit/e724a3c2b59e992051a22423fd3bc660c5c8bd10", "message": "fix", "committedDate": "2020-08-08T07:20:15Z", "type": "commit"}, {"oid": "d5fa69d422b8ec2938784489f6dd8c9a3fffdbb0", "url": "https://github.com/apache/skywalking/commit/d5fa69d422b8ec2938784489f6dd8c9a3fffdbb0", "message": "fix", "committedDate": "2020-08-08T07:24:43Z", "type": "commit"}, {"oid": "a75beda4babb4c7cc5fd78948c3bbc3fa8f7d115", "url": "https://github.com/apache/skywalking/commit/a75beda4babb4c7cc5fd78948c3bbc3fa8f7d115", "message": "fix", "committedDate": "2020-08-08T07:28:17Z", "type": "commit"}, {"oid": "0ec349417d241dff5cc3eefdc3e39d13b96f6485", "url": "https://github.com/apache/skywalking/commit/0ec349417d241dff5cc3eefdc3e39d13b96f6485", "message": "fixed", "committedDate": "2020-08-08T07:46:11Z", "type": "commit"}, {"oid": "8b270db1db4360e3c961ba9000ea8a70f93178fc", "url": "https://github.com/apache/skywalking/commit/8b270db1db4360e3c961ba9000ea8a70f93178fc", "message": "fix", "committedDate": "2020-08-08T08:14:58Z", "type": "commit"}, {"oid": "37c586e6de013297d5bb02b2b4a663ef03917fd2", "url": "https://github.com/apache/skywalking/commit/37c586e6de013297d5bb02b2b4a663ef03917fd2", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-08-08T08:15:27Z", "type": "commit"}, {"oid": "82d1e64a5e820af7a87071d0a3ec475a1a319b3d", "url": "https://github.com/apache/skywalking/commit/82d1e64a5e820af7a87071d0a3ec475a1a319b3d", "message": "fix", "committedDate": "2020-08-08T08:39:39Z", "type": "commit"}, {"oid": "a3329c246d071d1b13735040b16b1dd8385a48ae", "url": "https://github.com/apache/skywalking/commit/a3329c246d071d1b13735040b16b1dd8385a48ae", "message": "Merge branch 'zhaoyuguang_0001' of https://github.com/zhaoyuguang/incubator-skywalking into zhaoyuguang_0001", "committedDate": "2020-08-08T08:39:56Z", "type": "commit"}, {"oid": "58669023a04c0a7c4f8dbaa68da41bc8292a10bc", "url": "https://github.com/apache/skywalking/commit/58669023a04c0a7c4f8dbaa68da41bc8292a10bc", "message": "Merge branch 'master' into zhaoyuguang_0001", "committedDate": "2020-08-10T00:44:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY1MDQ1OQ==", "url": "https://github.com/apache/skywalking/pull/5153#discussion_r467650459", "bodyText": "@zhaoyuguang Tag key should be added as a constant in the plugin.", "author": "wu-sheng", "createdAt": "2020-08-10T00:47:06Z", "path": "apm-sniffer/apm-sdk-plugin/elastic-job-3.x-plugin/src/main/java/org/apache/skywalking/apm/plugin/elasticjob/ElasticJobExecutorInterceptor.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.plugin.elasticjob;\n+\n+import org.apache.shardingsphere.elasticjob.api.listener.ShardingContexts;\n+import org.apache.skywalking.apm.agent.core.context.ContextCarrier;\n+import org.apache.skywalking.apm.agent.core.context.ContextManager;\n+import org.apache.skywalking.apm.agent.core.context.trace.AbstractSpan;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.EnhancedInstance;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.InstanceMethodsAroundInterceptor;\n+import org.apache.skywalking.apm.agent.core.plugin.interceptor.enhance.MethodInterceptResult;\n+import org.apache.skywalking.apm.network.trace.component.ComponentsDefine;\n+\n+import java.lang.reflect.Method;\n+\n+public class ElasticJobExecutorInterceptor implements InstanceMethodsAroundInterceptor {\n+    @Override\n+    public void beforeMethod(EnhancedInstance objInst, Method method, Object[] allArguments, Class<?>[] argumentsTypes,\n+                             MethodInterceptResult result) throws Throwable {\n+        ShardingContexts shardingContexts = (ShardingContexts) allArguments[0];\n+        Integer item = (Integer) allArguments[1];\n+        String operateName = ComponentsDefine.ELASTIC_JOB.getName() + \"/\" + shardingContexts.getJobName();\n+        AbstractSpan span = ContextManager.createEntrySpan(operateName, new ContextCarrier());\n+        span.setComponent(ComponentsDefine.ELASTIC_JOB);\n+        span.tag(\"item\", item == null ? \"\" : String.valueOf(item));\n+        span.tag(\"shardingTotalCount\", Integer.toString(shardingContexts.getShardingTotalCount()));\n+        span.tag(\"taskId\", shardingContexts.getTaskId());\n+        span.tag(\"shardingItemParameters\", shardingContexts.getShardingItemParameters() == null ? \"\" : shardingContexts.getShardingItemParameters().toString());", "originalCommit": "58669023a04c0a7c4f8dbaa68da41bc8292a10bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY1MDU0NQ==", "url": "https://github.com/apache/skywalking/pull/5153#discussion_r467650545", "bodyText": "@tristaZero This is how we get these tags.", "author": "wu-sheng", "createdAt": "2020-08-10T00:47:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY1MDQ1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2NjQ3MQ==", "url": "https://github.com/apache/skywalking/pull/5153#discussion_r467666471", "bodyText": "Hi @wu-sheng It seems these tags come from ShardingContexts, which is a necessary job context for users. I am not familiar with what content skyWalking needs for its plugin, but if it wants to get core job information, I think it is enough. :)", "author": "tristaZero", "createdAt": "2020-08-10T02:46:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY1MDQ1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY2NzIwNA==", "url": "https://github.com/apache/skywalking/pull/5153#discussion_r467667204", "bodyText": "BTW, there are other props from ShardingContexts, like jobName, jobParameter, and so forth. I am not sure whether you @zhaoyuguang  @wu-sheng need them or not. Thanks.", "author": "tristaZero", "createdAt": "2020-08-10T02:51:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY1MDQ1OQ=="}], "type": "inlineReview", "revised_code": null}]}