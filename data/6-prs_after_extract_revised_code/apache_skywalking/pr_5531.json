{"pr_number": 5531, "pr_title": "Meter Analysis Language", "pr_createdAt": "2020-09-21T16:20:13Z", "pr_url": "https://github.com/apache/skywalking/pull/5531", "timeline": [{"oid": "42324480fa68d482c58c1e9546facffeffdde0c0", "url": "https://github.com/apache/skywalking/commit/42324480fa68d482c58c1e9546facffeffdde0c0", "message": "Document MAL\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-09-21T16:11:45Z", "type": "commit"}, {"oid": "0d1936e91cd0d355c17de3a52d234b93d067caea", "url": "https://github.com/apache/skywalking/commit/0d1936e91cd0d355c17de3a52d234b93d067caea", "message": "Merge branch 'master' into meter-mal", "committedDate": "2020-09-22T01:13:33Z", "type": "commit"}, {"oid": "5177620f7f6f3dc409612bac7437d4a885678cc8", "url": "https://github.com/apache/skywalking/commit/5177620f7f6f3dc409612bac7437d4a885678cc8", "message": "Merge branch 'master' into meter-mal", "committedDate": "2020-09-22T14:28:54Z", "type": "commit"}, {"oid": "abdded55fced13268f7cb73c08fa84f25c14b66e", "url": "https://github.com/apache/skywalking/commit/abdded55fced13268f7cb73c08fa84f25c14b66e", "message": "Merge branch 'master' into meter-mal", "committedDate": "2020-09-25T08:04:46Z", "type": "commit"}, {"oid": "7395da6a72d4e24620321f6890e5de589b7da6f1", "url": "https://github.com/apache/skywalking/commit/7395da6a72d4e24620321f6890e5de589b7da6f1", "message": "Add more features\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-09-25T08:07:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MTE0NQ==", "url": "https://github.com/apache/skywalking/pull/5531#discussion_r494881145", "bodyText": "Remember to add comments for these classes in the meter analyzer packages.", "author": "wu-sheng", "createdAt": "2020-09-25T09:56:53Z", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/DSL.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.meter.analyzer.dsl;\n+\n+import groovy.lang.Binding;\n+import groovy.lang.GroovyShell;\n+import groovy.util.DelegatingScript;\n+import org.codehaus.groovy.control.CompilerConfiguration;\n+\n+public final class DSL {", "originalCommit": "7395da6a72d4e24620321f6890e5de589b7da6f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4NzM1Mg==", "url": "https://github.com/apache/skywalking/pull/5531#discussion_r494887352", "bodyText": "From what I expect, all of the public class and methods would be commented on before this PR is reviewable.", "author": "hanahmily", "createdAt": "2020-09-25T10:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MTE0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "8cae20907328dd1dc958735565cd07d8fd733cc3", "chunk": "diff --git a/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/DSL.java b/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/DSL.java\nindex 24a287f84..9feafaa7f 100644\n--- a/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/DSL.java\n+++ b/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/DSL.java\n\n@@ -23,7 +23,17 @@ import groovy.lang.GroovyShell;\n import groovy.util.DelegatingScript;\n import org.codehaus.groovy.control.CompilerConfiguration;\n \n+/**\n+ * DSL combines methods to parse groovy based DSL expression.\n+ */\n public final class DSL {\n+\n+    /**\n+     * Parse string literal to Expression object, which can be reused.\n+     *\n+     * @param expression string literal represents the DSL expression.\n+     * @return Expression object could be executed.\n+     */\n     public static Expression parse(final String expression) {\n         CompilerConfiguration cc = new CompilerConfiguration();\n         cc.setScriptBaseClass(DelegatingScript.class.getName());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4NDQwNQ==", "url": "https://github.com/apache/skywalking/pull/5531#discussion_r494884405", "bodyText": "There is another abstract Window in the OAP core. Please rename this.", "author": "wu-sheng", "createdAt": "2020-09-25T10:03:11Z", "path": "oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/Window.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.meter.analyzer.dsl.counter;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.Maps;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import java.util.LinkedList;\n+import java.util.Map;\n+import java.util.Queue;\n+import lombok.AccessLevel;\n+import lombok.EqualsAndHashCode;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+/**\n+ * Window stores a series of counter samples in order to calculate the increase\n+ * or instant rate of increase.\n+ */\n+@RequiredArgsConstructor(access = AccessLevel.PRIVATE)\n+@ToString\n+@EqualsAndHashCode\n+public class Window {", "originalCommit": "7395da6a72d4e24620321f6890e5de589b7da6f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4ODY5MQ==", "url": "https://github.com/apache/skywalking/pull/5531#discussion_r494888691", "bodyText": "Do you mean this one under prometheus package, that is going to be removed once OC/Prometheus switch the configuration modal to this one.", "author": "hanahmily", "createdAt": "2020-09-25T10:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4NDQwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkwNTEwOQ==", "url": "https://github.com/apache/skywalking/pull/5531#discussion_r494905109", "bodyText": "No, in the core streaming. Window is for caching metrics and switching.", "author": "wu-sheng", "createdAt": "2020-09-25T10:46:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4NDQwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "8cae20907328dd1dc958735565cd07d8fd733cc3", "chunk": "diff --git a/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/Window.java b/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/CounterWindow.java\nsimilarity index 91%\nrename from oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/Window.java\nrename to oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/CounterWindow.java\nindex 2f7e5eb20..46ac2a56e 100644\n--- a/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/Window.java\n+++ b/oap-server/analyzer/meter-analyzer/src/main/java/org/apache/skywalking/oap/meter/analyzer/dsl/counter/CounterWindow.java\n\n@@ -31,15 +31,16 @@ import lombok.RequiredArgsConstructor;\n import lombok.ToString;\n \n /**\n- * Window stores a series of counter samples in order to calculate the increase\n+ * CounterWindow stores a series of counter samples in order to calculate the increase\n  * or instant rate of increase.\n+ *\n  */\n @RequiredArgsConstructor(access = AccessLevel.PRIVATE)\n @ToString\n @EqualsAndHashCode\n-public class Window {\n+public class CounterWindow {\n \n-    public static final Window INSTANCE = new Window();\n+    public static final CounterWindow INSTANCE = new CounterWindow();\n \n     private final Map<ID, Queue<Tuple2<Long, Double>>> windows = Maps.newHashMap();\n \n"}}, {"oid": "ec6f9d379ac2e77dd5a011d662396e9edb816644", "url": "https://github.com/apache/skywalking/commit/ec6f9d379ac2e77dd5a011d662396e9edb816644", "message": "Merge remote-tracking branch 'origin/master' into meter-mal", "committedDate": "2020-10-05T07:14:01Z", "type": "commit"}, {"oid": "fcc20d2a9800133b66dc02154754dfe94e1e77aa", "url": "https://github.com/apache/skywalking/commit/fcc20d2a9800133b66dc02154754dfe94e1e77aa", "message": "Add histogram relevant functions\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-09T02:52:56Z", "type": "commit"}, {"oid": "a5ff05054ea3a81bf6f914d207d1fef3a4399edf", "url": "https://github.com/apache/skywalking/commit/a5ff05054ea3a81bf6f914d207d1fef3a4399edf", "message": "Implemented avg and latest downsampling funciton\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-10T09:40:43Z", "type": "commit"}, {"oid": "74fb8416e4a9b76d3f757d3e4cf5e72b70034279", "url": "https://github.com/apache/skywalking/commit/74fb8416e4a9b76d3f757d3e4cf5e72b70034279", "message": "Add Anaylzer to kick off streaming process\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-12T14:30:05Z", "type": "commit"}, {"oid": "2d64a55d8f095364cc3e9a5ce18af69c1c715a33", "url": "https://github.com/apache/skywalking/commit/2d64a55d8f095364cc3e9a5ce18af69c1c715a33", "message": "Merge remote-tracking branch 'origin/master' into meter-mal", "committedDate": "2020-10-12T14:31:33Z", "type": "commit"}, {"oid": "a80d0fa1458244bd1976eb840f9ede3ccb5e514c", "url": "https://github.com/apache/skywalking/commit/a80d0fa1458244bd1976eb840f9ede3ccb5e514c", "message": "Integrated all of components for first time\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-13T15:43:51Z", "type": "commit"}, {"oid": "f695bde6737c48b60ea83dfad18c2d51eb0b1d5d", "url": "https://github.com/apache/skywalking/commit/f695bde6737c48b60ea83dfad18c2d51eb0b1d5d", "message": "Update relevant modules depend on meter analyzer\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-15T03:46:15Z", "type": "commit"}, {"oid": "d605d80a82627534f1a114d30604bfb9879ce36e", "url": "https://github.com/apache/skywalking/commit/d605d80a82627534f1a114d30604bfb9879ce36e", "message": "Merge remote-tracking branch 'origin/master' into meter-mal", "committedDate": "2020-10-15T03:47:16Z", "type": "commit"}, {"oid": "b9316faa1262de712685e2bdf861ab6f2466672a", "url": "https://github.com/apache/skywalking/commit/b9316faa1262de712685e2bdf861ab6f2466672a", "message": "Add more features and fix bugs\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-21T00:59:52Z", "type": "commit"}, {"oid": "66be9dfda9ac28677ca3627013dc2553fb42a7b9", "url": "https://github.com/apache/skywalking/commit/66be9dfda9ac28677ca3627013dc2553fb42a7b9", "message": "Merge remote-tracking branch 'origin/master' into meter-mal", "committedDate": "2020-10-21T01:03:49Z", "type": "commit"}, {"oid": "8cae20907328dd1dc958735565cd07d8fd733cc3", "url": "https://github.com/apache/skywalking/commit/8cae20907328dd1dc958735565cd07d8fd733cc3", "message": "Amend javadoc\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-21T03:54:28Z", "type": "commit"}, {"oid": "4d773fdaed7ba8bfebc190c508e1d7c6bd9db955", "url": "https://github.com/apache/skywalking/commit/4d773fdaed7ba8bfebc190c508e1d7c6bd9db955", "message": "Update relevant documents\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-21T04:18:02Z", "type": "commit"}, {"oid": "524c0abbf2c2f6acf4be8d82b1b7b60f8af22901", "url": "https://github.com/apache/skywalking/commit/524c0abbf2c2f6acf4be8d82b1b7b60f8af22901", "message": "Sync UI\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-21T04:22:06Z", "type": "commit"}, {"oid": "f753e3f49c7ed70e18b2e1c69af6cb16dd105b0f", "url": "https://github.com/apache/skywalking/commit/f753e3f49c7ed70e18b2e1c69af6cb16dd105b0f", "message": "Merge branch 'master' into meter-mal", "committedDate": "2020-10-21T04:24:16Z", "type": "commit"}, {"oid": "fc3dca705f05c38e8b04430b9626796d6d5d1ef6", "url": "https://github.com/apache/skywalking/commit/fc3dca705f05c38e8b04430b9626796d6d5d1ef6", "message": "Poslish\n\nSigned-off-by: Gao Hongtao <hanahmily@gmail.com>", "committedDate": "2020-10-21T06:34:37Z", "type": "commit"}, {"oid": "dc842ac98ed9953e36b85aa578833bf1a47d9068", "url": "https://github.com/apache/skywalking/commit/dc842ac98ed9953e36b85aa578833bf1a47d9068", "message": "Merge branch 'meter-mal' of github.com:apache/skywalking into meter-mal", "committedDate": "2020-10-21T06:35:41Z", "type": "commit"}, {"oid": "043763f05be2d0a29118d0a4015a3689146a1335", "url": "https://github.com/apache/skywalking/commit/043763f05be2d0a29118d0a4015a3689146a1335", "message": "Merge branch 'master' into meter-mal", "committedDate": "2020-10-21T06:57:05Z", "type": "commit"}]}