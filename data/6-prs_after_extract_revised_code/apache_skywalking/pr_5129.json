{"pr_number": 5129, "pr_title": "Add jvm_thread metrics", "pr_createdAt": "2020-07-19T15:25:14Z", "pr_url": "https://github.com/apache/skywalking/pull/5129", "timeline": [{"oid": "c6e686a6df8f721a2924815bf2b13eb75e69a252", "url": "https://github.com/apache/skywalking/commit/c6e686a6df8f721a2924815bf2b13eb75e69a252", "message": "ADD: add jvm_thread metrics", "committedDate": "2020-07-19T15:12:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjc3OA==", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456922778", "bodyText": "getThreadMetric -> getThreadMetrics.", "author": "wu-sheng", "createdAt": "2020-07-19T15:35:13Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.apm.agent.core.jvm.thread;\n+\n+import java.lang.management.ManagementFactory;\n+import java.lang.management.ThreadMXBean;\n+import org.apache.skywalking.apm.network.language.agent.v3.Thread;\n+\n+public enum ThreadProvider {\n+    INSTANCE;\n+    private final ThreadMXBean threadMXBean;\n+\n+    ThreadProvider() {\n+        this.threadMXBean = ManagementFactory.getThreadMXBean();\n+    }\n+\n+    public Thread getThreadMetric() {", "originalCommit": "c6e686a6df8f721a2924815bf2b13eb75e69a252", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c1dc3d417b9a9f78bced6393e7542f6d01673d19", "chunk": "diff --git a/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java b/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java\nindex 6ff9275c5..25243f27d 100644\n--- a/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java\n+++ b/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/jvm/thread/ThreadProvider.java\n\n@@ -30,7 +30,7 @@ public enum ThreadProvider {\n         this.threadMXBean = ManagementFactory.getThreadMXBean();\n     }\n \n-    public Thread getThreadMetric() {\n+    public Thread getThreadMetrics() {\n         int threadCount = threadMXBean.getThreadCount();\n         int daemonThreadCount = threadMXBean.getDaemonThreadCount();\n         int peakThreadCount = threadMXBean.getPeakThreadCount();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkyMjg3OA==", "url": "https://github.com/apache/skywalking/pull/5129#discussion_r456922878", "bodyText": "As you added a new source, scope-definitions.md doc should be added.", "author": "wu-sheng", "createdAt": "2020-07-19T15:36:14Z", "path": "oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.core.source;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_CATALOG_NAME;\n+import static org.apache.skywalking.oap.server.core.source.DefaultScopeDefine.SERVICE_INSTANCE_JVM_THREAD;\n+\n+@ScopeDeclaration(id = SERVICE_INSTANCE_JVM_THREAD, name = \"ServiceInstanceJVMThread\", catalog = SERVICE_INSTANCE_CATALOG_NAME)\n+@ScopeDefaultColumn.VirtualColumnDefinition(fieldName = \"entityId\", columnName = \"entity_id\", isID = true, type = String.class)\n+public class ServiceInstanceJVMThread extends Source {", "originalCommit": "c6e686a6df8f721a2924815bf2b13eb75e69a252", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "62d3ac7b1568821ff812ff80fa27c2e387c5b821", "chunk": "diff --git a/oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java b/oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java\nindex 6ee92ad00..42ee6a2e2 100644\n--- a/oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java\n+++ b/oap-server/server-core/src/main/java/org/apache/skywalking/oap/server/core/source/ServiceInstanceJVMThread.java\n\n@@ -54,11 +54,11 @@ public class ServiceInstanceJVMThread extends Source {\n     private String serviceId;\n     @Getter\n     @Setter\n-    private int liveCount;\n+    private long liveCount;\n     @Getter\n     @Setter\n-    private int daemonCount;\n+    private long daemonCount;\n     @Getter\n     @Setter\n-    private int peakCount;\n+    private long peakCount;\n }\n"}}, {"oid": "fb7a38968f7f9b6a38005e45fd9d6c0d7d1b34d2", "url": "https://github.com/apache/skywalking/commit/fb7a38968f7f9b6a38005e45fd9d6c0d7d1b34d2", "message": "Merge branch 'master' into jvm_thread", "committedDate": "2020-07-19T15:43:00Z", "type": "commit"}, {"oid": "56bbdc9e631e59c4d85d777ad75a317511d55b6d", "url": "https://github.com/apache/skywalking/commit/56bbdc9e631e59c4d85d777ad75a317511d55b6d", "message": "Merge branch 'master' of https://github.com/apache/skywalking into jvm_thread", "committedDate": "2020-07-19T15:45:59Z", "type": "commit"}, {"oid": "c1dc3d417b9a9f78bced6393e7542f6d01673d19", "url": "https://github.com/apache/skywalking/commit/c1dc3d417b9a9f78bced6393e7542f6d01673d19", "message": "MOD: modify java-agent.oal and add scope-definitions.md", "committedDate": "2020-07-19T15:47:13Z", "type": "commit"}, {"oid": "54708da629e7386f1a4e61fc5685f9067f5a6f5c", "url": "https://github.com/apache/skywalking/commit/54708da629e7386f1a4e61fc5685f9067f5a6f5c", "message": "Merge remote-tracking branch 'origin/jvm_thread' into jvm_thread", "committedDate": "2020-07-19T15:47:42Z", "type": "commit"}, {"oid": "62d3ac7b1568821ff812ff80fa27c2e387c5b821", "url": "https://github.com/apache/skywalking/commit/62d3ac7b1568821ff812ff80fa27c2e387c5b821", "message": "MOD: modify type and oal function", "committedDate": "2020-07-19T16:07:30Z", "type": "commit"}, {"oid": "f7fde1b66fbcd4b31e8a57ad09db646bec9a0aa1", "url": "https://github.com/apache/skywalking/commit/f7fde1b66fbcd4b31e8a57ad09db646bec9a0aa1", "message": "MOD: oal_test.oal", "committedDate": "2020-07-19T16:08:34Z", "type": "commit"}, {"oid": "647cb08b1cc897de9d424a14181b936feaa9ab4c", "url": "https://github.com/apache/skywalking/commit/647cb08b1cc897de9d424a14181b936feaa9ab4c", "message": "MOD: OALLexer.g4, OALParser.g4", "committedDate": "2020-07-20T04:29:59Z", "type": "commit"}, {"oid": "186cb9c8f11204fb197008419016d914042be899", "url": "https://github.com/apache/skywalking/commit/186cb9c8f11204fb197008419016d914042be899", "message": "Merge branch 'master' into jvm_thread", "committedDate": "2020-07-20T09:38:02Z", "type": "commit"}, {"oid": "485a93261b010ba0e61331932c6d3061e056476a", "url": "https://github.com/apache/skywalking/commit/485a93261b010ba0e61331932c6d3061e056476a", "message": "ADD: Add e2e", "committedDate": "2020-07-20T14:04:20Z", "type": "commit"}, {"oid": "195e9b7f4e0dd6d0a43a4f054be45c8cd9cfdfc3", "url": "https://github.com/apache/skywalking/commit/195e9b7f4e0dd6d0a43a4f054be45c8cd9cfdfc3", "message": "Merge remote-tracking branch 'origin/jvm_thread' into jvm_thread", "committedDate": "2020-07-20T14:04:35Z", "type": "commit"}, {"oid": "d642c3976e89314f9c293cae5e68bc4c8865f15f", "url": "https://github.com/apache/skywalking/commit/d642c3976e89314f9c293cae5e68bc4c8865f15f", "message": "Merge branch 'master' into jvm_thread", "committedDate": "2020-07-21T08:34:35Z", "type": "commit"}, {"oid": "1a7ce270924da05f6e7851f185b12659e4ed3c67", "url": "https://github.com/apache/skywalking/commit/1a7ce270924da05f6e7851f185b12659e4ed3c67", "message": "Merge branch 'master' into jvm_thread", "committedDate": "2020-07-21T13:17:18Z", "type": "commit"}, {"oid": "004d35ff1821c010cb9d2eda3686c12d8363683c", "url": "https://github.com/apache/skywalking/commit/004d35ff1821c010cb9d2eda3686c12d8363683c", "message": "Merge branch 'master' into jvm_thread", "committedDate": "2020-07-21T15:33:11Z", "type": "commit"}, {"oid": "1889aab815896aa26f13c1719858591ebd69f932", "url": "https://github.com/apache/skywalking/commit/1889aab815896aa26f13c1719858591ebd69f932", "message": "MOD: modify chartType", "committedDate": "2020-07-21T15:33:46Z", "type": "commit"}, {"oid": "da640a79f5b7a5ac8afac5623411f74a7bfbbb21", "url": "https://github.com/apache/skywalking/commit/da640a79f5b7a5ac8afac5623411f74a7bfbbb21", "message": "Merge branch 'jvm_thread' of https://github.com/stalary/skywalking into jvm_thread", "committedDate": "2020-07-21T15:35:57Z", "type": "commit"}]}