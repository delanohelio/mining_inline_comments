{"pr_number": 5800, "pr_title": "ALS analyzer based on Envoy metadata exchange", "pr_createdAt": "2020-11-05T16:07:12Z", "pr_url": "https://github.com/apache/skywalking/pull/5800", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODIxMDM5Mw==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518210393", "bodyText": "NULL_DEREFERENCE:  object kv last assigned on line 53 could be null and is dereferenced at line 54.", "author": "sonatype-lift", "createdAt": "2020-11-05T17:02:41Z", "path": "oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package org.apache.skywalking.oap.server.receiver.envoy.als.mx;\n+\n+import com.google.protobuf.Any;\n+import com.google.protobuf.ByteString;\n+import com.google.protobuf.BytesValue;\n+import com.google.protobuf.Struct;\n+import java.nio.ByteBuffer;\n+import java.util.Optional;\n+import lombok.RequiredArgsConstructor;\n+import lombok.extern.slf4j.Slf4j;\n+import org.apache.skywalking.oap.server.receiver.envoy.als.ServiceMetaInfo;\n+import Wasm.Common.FlatNode;\n+import Wasm.Common.KeyVal;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+/**\n+ * Adapter to {@link ServiceMetaInfo} from various of other datastructures.\n+ */\n+@Slf4j\n+@RequiredArgsConstructor\n+public class ServiceMetaInfoAdapter extends ServiceMetaInfo {\n+\n+    /**\n+     * Try to adapt a {@link ByteString} to {@link ServiceMetaInfo} instance.\n+     *\n+     * @param bv the {@link ByteString byte string} to adapt from.\n+     * @throws Exception if the {@link ByteString byte string} can not be adapted to a {@link ServiceMetaInfo}.\n+     */\n+    public ServiceMetaInfoAdapter(final ByteString bv) throws Exception {\n+        final ByteBuffer buffer = ByteBuffer.wrap(BytesValue.parseFrom(bv).getValue().toByteArray());\n+        final FlatNode flatNode = FlatNode.getRootAsFlatNode(buffer);\n+        if (log.isDebugEnabled()) {\n+            for (int i = 0; i < flatNode.labelsLength(); i++) {\n+                KeyVal kv = flatNode.labels(i);\n+                log.debug(\"wasm label: {} : {}\", kv.key(), kv.value());", "originalCommit": "b1a49bf8b77497ca01ef79bd8491f62a3e79fb56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "77e0d38e81717df16dacb17557ee355886cb2728", "chunk": "diff --git a/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java b/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java\nindex fae1138da6..c8ca1acd77 100644\n--- a/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java\n+++ b/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/ServiceMetaInfoAdapter.java\n\n@@ -30,6 +30,7 @@ import org.apache.skywalking.oap.server.receiver.envoy.als.ServiceMetaInfo;\n import Wasm.Common.FlatNode;\n import Wasm.Common.KeyVal;\n \n+import static java.util.Objects.nonNull;\n import static java.util.Objects.requireNonNull;\n \n /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDg5Ng==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518444896", "bodyText": "Why we are adding package-info for now?", "author": "wu-sheng", "createdAt": "2020-11-06T00:05:00Z", "path": "oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/package-info.java", "diffHunk": "@@ -0,0 +1,24 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+/**\n+ * {@link org.apache.skywalking.oap.server.receiver.envoy.als.ALSHTTPAnalysis} implementation\n+ * based on the Envoy metadata exchange.\n+ */\n+\n+package org.apache.skywalking.oap.server.receiver.envoy.als.mx;", "originalCommit": "f67f8432209a6be4fcd1310d81299c53567caa60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzNTYwNA==", "url": "https://github.com/apache/skywalking/pull/5800#discussion_r518635604", "bodyText": "Thought it was a good practice, but finally realize that we don't emphasize too much about the JavaDoc, this makes not much sense, deleted", "author": "kezhenxu94", "createdAt": "2020-11-06T09:45:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0NDg5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "77e0d38e81717df16dacb17557ee355886cb2728", "chunk": "diff --git a/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/package-info.java b/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/package-info.java\ndeleted file mode 100644\nindex 9564f0ec56..0000000000\n--- a/oap-server/server-receiver-plugin/envoy-metrics-receiver-plugin/src/main/java/org/apache/skywalking/oap/server/receiver/envoy/als/mx/package-info.java\n+++ /dev/null\n\n@@ -1,24 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- *\n- */\n-\n-/**\n- * {@link org.apache.skywalking.oap.server.receiver.envoy.als.ALSHTTPAnalysis} implementation\n- * based on the Envoy metadata exchange.\n- */\n-\n-package org.apache.skywalking.oap.server.receiver.envoy.als.mx;\n"}}, {"oid": "77e0d38e81717df16dacb17557ee355886cb2728", "url": "https://github.com/apache/skywalking/commit/77e0d38e81717df16dacb17557ee355886cb2728", "message": "ALS analyzer based on Envoy metadata exchange", "committedDate": "2020-11-06T14:38:18Z", "type": "commit"}, {"oid": "77e0d38e81717df16dacb17557ee355886cb2728", "url": "https://github.com/apache/skywalking/commit/77e0d38e81717df16dacb17557ee355886cb2728", "message": "ALS analyzer based on Envoy metadata exchange", "committedDate": "2020-11-06T14:38:18Z", "type": "forcePushed"}, {"oid": "c7445e05f8f5cd7eeabde7fde612b2086e1031f6", "url": "https://github.com/apache/skywalking/commit/c7445e05f8f5cd7eeabde7fde612b2086e1031f6", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T09:25:45Z", "type": "commit"}, {"oid": "24cadacafe02c9fb06b73e5f24c6e1e2a15f0d18", "url": "https://github.com/apache/skywalking/commit/24cadacafe02c9fb06b73e5f24c6e1e2a15f0d18", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T12:35:20Z", "type": "commit"}, {"oid": "17a0f3c4001f415806d92878ded4bb4819962781", "url": "https://github.com/apache/skywalking/commit/17a0f3c4001f415806d92878ded4bb4819962781", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-07T13:41:00Z", "type": "commit"}, {"oid": "6644cd4d65898880b9ff13b22876b95a94383ef9", "url": "https://github.com/apache/skywalking/commit/6644cd4d65898880b9ff13b22876b95a94383ef9", "message": "Merge branch 'master' into feature/als-mx", "committedDate": "2020-11-08T01:42:10Z", "type": "commit"}, {"oid": "4444a6f3364cd9352922e7902bfb38fe20255230", "url": "https://github.com/apache/skywalking/commit/4444a6f3364cd9352922e7902bfb38fe20255230", "message": "Add module manager to analyzer initialization for use", "committedDate": "2020-11-08T09:51:18Z", "type": "commit"}, {"oid": "80eba738642ca748a2008416be51eb548def4879", "url": "https://github.com/apache/skywalking/commit/80eba738642ca748a2008416be51eb548def4879", "message": "Address the review comment to add original file location", "committedDate": "2020-11-08T15:11:19Z", "type": "commit"}]}