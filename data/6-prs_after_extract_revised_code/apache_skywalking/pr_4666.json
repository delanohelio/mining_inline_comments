{"pr_number": 4666, "pr_title": "Support v3 extension header", "pr_createdAt": "2020-04-18T14:06:28Z", "pr_url": "https://github.com/apache/skywalking/pull/4666", "timeline": [{"oid": "1870842beb139059cafc604e3569ea8f39860d8a", "url": "https://github.com/apache/skywalking/commit/1870842beb139059cafc604e3569ea8f39860d8a", "message": "support v3 extend header", "committedDate": "2020-04-18T13:58:57Z", "type": "commit"}, {"oid": "17c9488b1f660579a632370caa01031224b9ebdf", "url": "https://github.com/apache/skywalking/commit/17c9488b1f660579a632370caa01031224b9ebdf", "message": "fix UT", "committedDate": "2020-04-18T14:24:41Z", "type": "commit"}, {"oid": "6bd3b079964ef75715e455037890b584e37879db", "url": "https://github.com/apache/skywalking/commit/6bd3b079964ef75715e455037890b584e37879db", "message": "fix plugin test", "committedDate": "2020-04-18T15:54:38Z", "type": "commit"}, {"oid": "87b128233afa3cf22ffa9fd26210ad4a70c5e193", "url": "https://github.com/apache/skywalking/commit/87b128233afa3cf22ffa9fd26210ad4a70c5e193", "message": "fix missing extension header handle when cross thread continue", "committedDate": "2020-04-18T16:49:57Z", "type": "commit"}, {"oid": "08063147fb88bf11a6afbac719e6bf0cb5b2f7d8", "url": "https://github.com/apache/skywalking/commit/08063147fb88bf11a6afbac719e6bf0cb5b2f7d8", "message": "add ExtentionContext UT", "committedDate": "2020-04-18T17:03:53Z", "type": "commit"}, {"oid": "9538cf1ab60a2a56239a5486853cb7efbff8a4c1", "url": "https://github.com/apache/skywalking/commit/9538cf1ab60a2a56239a5486853cb7efbff8a4c1", "message": "Merge branch 'master' into v3-extension", "committedDate": "2020-04-19T10:34:52Z", "type": "commit"}, {"oid": "776998b8ef40b5168c84b7dcf1562a781a363ec1", "url": "https://github.com/apache/skywalking/commit/776998b8ef40b5168c84b7dcf1562a781a363ec1", "message": "Merge branch 'master' into v3-extension", "committedDate": "2020-04-19T12:17:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5OTU0Nw==", "url": "https://github.com/apache/skywalking/pull/4666#discussion_r411799547", "bodyText": "#capture should propogate the ExtensionContext, rather than creating a new one.", "author": "wu-sheng", "createdAt": "2020-04-21T01:20:49Z", "path": "apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/IgnoredTracerContext.java", "diffHunk": "@@ -53,7 +53,7 @@ public void extract(ContextCarrier carrier) {\n \n     @Override\n     public ContextSnapshot capture() {\n-        return new ContextSnapshot(null, -1, null, null, correlationContext);\n+        return new ContextSnapshot(null, -1, null, null, correlationContext, new ExtensionContext());", "originalCommit": "776998b8ef40b5168c84b7dcf1562a781a363ec1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5OTY3Nw==", "url": "https://github.com/apache/skywalking/pull/4666#discussion_r411799677", "bodyText": "I can see it is inside the tracing context.", "author": "wu-sheng", "createdAt": "2020-04-21T01:21:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5OTU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMTM5MA==", "url": "https://github.com/apache/skywalking/pull/4666#discussion_r411811390", "bodyText": "I create a new field to save the extension context in the ignored context.", "author": "mrproliu", "createdAt": "2020-04-21T01:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTc5OTU0Nw=="}], "type": "inlineReview", "revised_code": {"commit": "3bf3f197215100964e9b75d2af2e0fc163dea773", "chunk": "diff --git a/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/IgnoredTracerContext.java b/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/IgnoredTracerContext.java\nindex 8bfcd230e3..3e0568fc6e 100644\n--- a/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/IgnoredTracerContext.java\n+++ b/apm-sniffer/apm-agent-core/src/main/java/org/apache/skywalking/apm/agent/core/context/IgnoredTracerContext.java\n\n@@ -53,7 +55,7 @@ public class IgnoredTracerContext implements AbstractTracerContext {\n \n     @Override\n     public ContextSnapshot capture() {\n-        return new ContextSnapshot(null, -1, null, null, correlationContext, new ExtensionContext());\n+        return new ContextSnapshot(null, -1, null, null, correlationContext, extensionContext);\n     }\n \n     @Override\n"}}, {"oid": "3bf3f197215100964e9b75d2af2e0fc163dea773", "url": "https://github.com/apache/skywalking/commit/3bf3f197215100964e9b75d2af2e0fc163dea773", "message": "create new field to save the extension context, can propagate it when capture the ignored context", "committedDate": "2020-04-21T01:55:09Z", "type": "commit"}, {"oid": "1115d95f1afe407f58e92bf198de98820f2b4d47", "url": "https://github.com/apache/skywalking/commit/1115d95f1afe407f58e92bf198de98820f2b4d47", "message": "Merge branch 'master' into v3-extension", "committedDate": "2020-04-21T07:28:57Z", "type": "commit"}, {"oid": "ad5312158d502a80255384ee4e01009c0c3817fd", "url": "https://github.com/apache/skywalking/commit/ad5312158d502a80255384ee4e01009c0c3817fd", "message": "Merge branch 'master' into v3-extension", "committedDate": "2020-04-21T07:46:18Z", "type": "commit"}]}