{"pr_number": 3193, "pr_title": "Implement Brigadier Mojang API", "pr_createdAt": "2020-04-19T22:22:14Z", "pr_url": "https://github.com/PaperMC/Paper/pull/3193", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAxMTA1MQ==", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r411011051", "bodyText": "Wasn't this supposed to be called AsyncPlayerSendCommandsEvent?", "author": "JavierKasunic", "createdAt": "2020-04-19T23:01:42Z", "path": "Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommands.java", "diffHunk": "@@ -0,0 +1,54 @@\n+package com.destroystokyo.paper.event.brigadier;\n+\n+import com.mojang.brigadier.tree.RootCommandNode;\n+import org.bukkit.Bukkit;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.HandlerList;\n+import org.bukkit.event.player.PlayerEvent;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Fired any time a Brigadier RootCommandNode is generated for a player to inform the client of commands.\n+ * You may manipulate this CommandNode to change what the client sees.\n+ *\n+ * This event may fire on login, world change, and permission rebuilds, by plugin request, and potentially future means.\n+ *\n+ * WARNING: This event will potentially (and most likely) fire twice! Once for Async, and once again for Sync.\n+ * It is important that you check event.isAsync() and event.hasFiredAsync() to ensure you only act once.\n+ * If for some reason we are unable to send this asynchronously in the future, only the sync method will fire.\n+ *\n+ * Your logic should look like this:\n+ * if (event.isAsync() || (!event.isAsync() && !event.hasFiredAsync())) { do stuff }\n+ *\n+ * If your logic is not safe to run asynchronously, only react to the synchronous version.\n+ */\n+public class AsyncPlayerSendCommands extends PlayerEvent {", "originalCommit": "96f24f8716ee709a891c4e7ab22a4126dc9e9387", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAxMTQzNQ==", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r411011435", "bodyText": "good catch", "author": "aikar", "createdAt": "2020-04-19T23:04:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTAxMTA1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "76f1a9c9d2129cfd707f2de41616d3248358c1e5", "chunk": "diff --git a/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommands.java b/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\nsimilarity index 60%\nrename from Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommands.java\nrename to Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\nindex 9fc63c0d9..a275a85ad 100644\n--- a/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommands.java\n+++ b/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\n\n@@ -1,5 +1,6 @@\n package com.destroystokyo.paper.event.brigadier;\n \n+import com.destroystokyo.paper.brigadier.BukkitBrigadierCommandSource;\n import com.mojang.brigadier.tree.RootCommandNode;\n import org.bukkit.Bukkit;\n import org.bukkit.entity.Player;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMwNjcwNQ==", "url": "https://github.com/PaperMC/Paper/pull/3193#discussion_r412306705", "bodyText": "I know this is pseudo code, but for easy copy and pasting, this and the reference in line 20 should prolly say isAsynchronous since thats the proper name of the method.\nIntelliJ also reminded me, that this can be simplified to event.isAsynchronous() || !event.hasFiredAsync()", "author": "MiniDigger", "createdAt": "2020-04-21T16:28:59Z", "path": "Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.destroystokyo.paper.event.brigadier;\n+\n+import com.mojang.brigadier.tree.RootCommandNode;\n+import org.bukkit.Bukkit;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.HandlerList;\n+import org.bukkit.event.player.PlayerEvent;\n+import org.jetbrains.annotations.NotNull;\n+\n+/**\n+ * Fired any time a Brigadier RootCommandNode is generated for a player to inform the client of commands.\n+ * You may manipulate this CommandNode to change what the client sees.\n+ *\n+ * This event may fire on login, world change, and permission rebuilds, by plugin request, and potentially future means.\n+ *\n+ * This event will fire before {@link org.bukkit.event.player.PlayerCommandSendEvent}, so no filtering has been done by\n+ * other plugins yet.\n+ *\n+ * WARNING: This event will potentially (and most likely) fire twice! Once for Async, and once again for Sync.\n+ * It is important that you check event.isAsync() and event.hasFiredAsync() to ensure you only act once.\n+ * If for some reason we are unable to send this asynchronously in the future, only the sync method will fire.\n+ *\n+ * Your logic should look like this:\n+ * if (event.isAsync() || (!event.isAsync() && !event.hasFiredAsync())) { do stuff }", "originalCommit": "7ed04a5e6c619935fac534f0f7a2a0bb9fe59a69", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "76f1a9c9d2129cfd707f2de41616d3248358c1e5", "chunk": "diff --git a/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java b/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\nindex d840f39fc..a275a85ad 100644\n--- a/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\n+++ b/Paper-MojangAPI/src/main/java/com/destroystokyo/paper/event/brigadier/AsyncPlayerSendCommandsEvent.java\n\n@@ -1,5 +1,6 @@\n package com.destroystokyo.paper.event.brigadier;\n \n+import com.destroystokyo.paper.brigadier.BukkitBrigadierCommandSource;\n import com.mojang.brigadier.tree.RootCommandNode;\n import org.bukkit.Bukkit;\n import org.bukkit.entity.Player;\n"}}, {"oid": "76f1a9c9d2129cfd707f2de41616d3248358c1e5", "url": "https://github.com/PaperMC/Paper/commit/76f1a9c9d2129cfd707f2de41616d3248358c1e5", "message": "Rebase master, More updates, fix generics on Send Event", "committedDate": "2020-04-23T08:16:24Z", "type": "forcePushed"}, {"oid": "fdf41b742d5e78e7e97659a829f43803c61efb8f", "url": "https://github.com/PaperMC/Paper/commit/fdf41b742d5e78e7e97659a829f43803c61efb8f", "message": "Implement Brigadier Mojang API\n\nThis is the start of a new module for Paper to add support for API's\nthat interface Mojang API's directly.\n\nThis allows us to version properly by MC version incase Mojang makes any major breaking changes.\n\nIt also lets us separate Mojang API's from Paper-API so our downstream friends at Glowstone\nwill not have to worry about Mojang code.\n\nAdds AsyncPlayerSendCommandsEvent\n  - Allows modifying on a per command basis what command data they see.\n\nAdds CommandRegisteredEvent\n  - Allows manipulating the CommandNode to add more children/metadata for the client", "committedDate": "2020-04-27T05:42:12Z", "type": "commit"}, {"oid": "fdf41b742d5e78e7e97659a829f43803c61efb8f", "url": "https://github.com/PaperMC/Paper/commit/fdf41b742d5e78e7e97659a829f43803c61efb8f", "message": "Implement Brigadier Mojang API\n\nThis is the start of a new module for Paper to add support for API's\nthat interface Mojang API's directly.\n\nThis allows us to version properly by MC version incase Mojang makes any major breaking changes.\n\nIt also lets us separate Mojang API's from Paper-API so our downstream friends at Glowstone\nwill not have to worry about Mojang code.\n\nAdds AsyncPlayerSendCommandsEvent\n  - Allows modifying on a per command basis what command data they see.\n\nAdds CommandRegisteredEvent\n  - Allows manipulating the CommandNode to add more children/metadata for the client", "committedDate": "2020-04-27T05:42:12Z", "type": "forcePushed"}]}