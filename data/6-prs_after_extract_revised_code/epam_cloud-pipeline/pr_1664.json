{"pr_number": 1664, "pr_title": "Issue #1653: Added labels filter to the filterNodes method", "pr_createdAt": "2020-12-18T11:18:16Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1664", "timeline": [{"oid": "d5de0c172cb9e7d0339ba2949385233fb5961145", "url": "https://github.com/epam/cloud-pipeline/commit/d5de0c172cb9e7d0339ba2949385233fb5961145", "message": "Issue #1653: Added labels filter to the filterNodes method\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>", "committedDate": "2020-12-18T11:17:29Z", "type": "commit"}, {"oid": "1fbd29c0d962c26dd708bfbac5fac64be9307509", "url": "https://github.com/epam/cloud-pipeline/commit/1fbd29c0d962c26dd708bfbac5fac64be9307509", "message": "Issue #1653: test added\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>", "committedDate": "2020-12-21T10:21:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM5OTQ3OA==", "url": "https://github.com/epam/cloud-pipeline/pull/1664#discussion_r547399478", "bodyText": "I'd suggest to reuse labelsMap (line 145) as it used for filtering by labels - just what we need here.", "author": "mzueva", "createdAt": "2020-12-22T17:17:00Z", "path": "api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java", "diffHunk": "@@ -153,8 +153,14 @@ public void init() {\n                         address.getAddress().equalsIgnoreCase(filterNodesVO.getAddress());\n                 addressFilter = node ->\n                         node.getAddresses() != null && node.getAddresses()\n-                                .stream()\n-                                .filter(addressEqualsPredicate).count() > 0;\n+                                .stream().anyMatch(addressEqualsPredicate);\n+            }\n+            Predicate<NodeInstance> labelsFilter = node -> true;", "originalCommit": "1fbd29c0d962c26dd708bfbac5fac64be9307509", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8748064c1b1721419abcf2f87d7f664010f0c745", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java b/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\nindex c52167b8e..7f376fb10 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\n\n@@ -146,6 +146,9 @@ public class NodesManager {\n             if (StringUtils.isNotBlank(filterNodesVO.getRunId())) {\n                 labelsMap.put(KubernetesConstants.RUN_ID_LABEL, filterNodesVO.getRunId());\n             }\n+            if (MapUtils.isNotEmpty(filterNodesVO.getLabels())) {\n+                labelsMap.putAll(filterNodesVO.getLabels());\n+            }\n             Predicate<NodeInstance> addressFilter = node -> true;\n             if (StringUtils.isNotBlank(filterNodesVO.getAddress())) {\n                 Predicate<NodeInstanceAddress> addressEqualsPredicate =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM5OTc0OQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1664#discussion_r547399749", "bodyText": "You can use MapUtils.isNotEmpty fro such check", "author": "mzueva", "createdAt": "2020-12-22T17:17:31Z", "path": "api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java", "diffHunk": "@@ -153,8 +153,14 @@ public void init() {\n                         address.getAddress().equalsIgnoreCase(filterNodesVO.getAddress());\n                 addressFilter = node ->\n                         node.getAddresses() != null && node.getAddresses()\n-                                .stream()\n-                                .filter(addressEqualsPredicate).count() > 0;\n+                                .stream().anyMatch(addressEqualsPredicate);\n+            }\n+            Predicate<NodeInstance> labelsFilter = node -> true;\n+            if (filterNodesVO.getLabels() != null && !filterNodesVO.getLabels().isEmpty()) {", "originalCommit": "1fbd29c0d962c26dd708bfbac5fac64be9307509", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8748064c1b1721419abcf2f87d7f664010f0c745", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java b/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\nindex c52167b8e..7f376fb10 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/cluster/NodesManager.java\n\n@@ -146,6 +146,9 @@ public class NodesManager {\n             if (StringUtils.isNotBlank(filterNodesVO.getRunId())) {\n                 labelsMap.put(KubernetesConstants.RUN_ID_LABEL, filterNodesVO.getRunId());\n             }\n+            if (MapUtils.isNotEmpty(filterNodesVO.getLabels())) {\n+                labelsMap.putAll(filterNodesVO.getLabels());\n+            }\n             Predicate<NodeInstance> addressFilter = node -> true;\n             if (StringUtils.isNotBlank(filterNodesVO.getAddress())) {\n                 Predicate<NodeInstanceAddress> addressEqualsPredicate =\n"}}, {"oid": "8748064c1b1721419abcf2f87d7f664010f0c745", "url": "https://github.com/epam/cloud-pipeline/commit/8748064c1b1721419abcf2f87d7f664010f0c745", "message": "Issue #1653: changed filtering principle in the filterNodes method\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>", "committedDate": "2020-12-24T07:30:34Z", "type": "commit"}]}