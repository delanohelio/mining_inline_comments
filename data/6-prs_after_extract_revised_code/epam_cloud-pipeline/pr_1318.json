{"pr_number": 1318, "pr_title": "Issue #1258 Users and regions listing for billing manager", "pr_createdAt": "2020-08-24T18:10:21Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1318", "timeline": [{"oid": "7a64bd8dce1fa6952193e6077ea3fa651faf8cd1", "url": "https://github.com/epam/cloud-pipeline/commit/7a64bd8dce1fa6952193e6077ea3fa651faf8cd1", "message": "Issue #1258 Create endpoint to load all cloud regions for billing purposes", "committedDate": "2020-08-24T17:14:52Z", "type": "commit"}, {"oid": "7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "url": "https://github.com/epam/cloud-pipeline/commit/7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "message": "Issue #1258 Create endpoint to load all users for billing purposes", "committedDate": "2020-08-24T18:12:37Z", "type": "commit"}, {"oid": "7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "url": "https://github.com/epam/cloud-pipeline/commit/7ac572d494cd3d5ea3c891f47f6039e97192f4a3", "message": "Issue #1258 Create endpoint to load all users for billing purposes", "committedDate": "2020-08-24T18:12:37Z", "type": "forcePushed"}, {"oid": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "url": "https://github.com/epam/cloud-pipeline/commit/3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "message": "Issue #1258 Use an object with the corresponding to `AbstractCloudRegion` type/name fields to hide sensitive information instead of object modifications via reflection, revert reflection changes", "committedDate": "2020-08-25T09:21:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjA5Mw==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496093", "bodyText": "Let's rename endpoint /billing -> /info", "author": "mzueva", "createdAt": "2020-08-25T14:32:15Z", "path": "api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java", "diffHunk": "@@ -75,6 +76,19 @@\n         return Result.success(cloudRegionApiService.loadAll());\n     }\n \n+    @GetMapping(\"/billing\")", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjQ0NQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566445", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjA5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "9aa78108fef09a727487ab9601feb2ba782fe9c8", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java b/api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java\nindex bc0d34d5a..fbc81196b 100644\n--- a/api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java\n+++ b/api/src/main/java/com/epam/pipeline/controller/region/CloudRegionController.java\n\n@@ -76,17 +76,17 @@ public class CloudRegionController extends AbstractRestController {\n         return Result.success(cloudRegionApiService.loadAll());\n     }\n \n-    @GetMapping(\"/billing\")\n+    @GetMapping(\"/info\")\n     @ApiOperation(\n-        value = \"Lists all regions for billing.\",\n-        notes = \"Lists all regions for billing. Some fields, which are not used for billing purposes are \"\n-                + \"restored to default values.\",\n+        value = \"Lists all regions' brief information.\",\n+        notes = \"Lists all regions, but instead of providing detailed description only the general information \"\n+                + \"is returned.\",\n         produces = MediaType.APPLICATION_JSON_VALUE)\n     @ApiResponses(\n         value = {@ApiResponse(code = HTTP_STATUS_OK, message = API_STATUS_DESCRIPTION)\n         })\n-    public Result<List<RegionForBilling>> loadAllForBilling() {\n-        return Result.success(cloudRegionApiService.loadAllForBilling());\n+    public Result<List<CloudRegionInfo>> loadAllRegionsInfo() {\n+        return Result.success(cloudRegionApiService.loadAllRegionsInfo());\n     }\n \n     @GetMapping(REGION_ID_URL)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjM1OQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496359", "bodyText": "Let's rename /users/billing -> /users/info", "author": "mzueva", "createdAt": "2020-08-25T14:32:37Z", "path": "api/src/main/java/com/epam/pipeline/controller/user/UserController.java", "diffHunk": "@@ -218,6 +218,20 @@ public Result deleteUser(@PathVariable Long id) {\n         return Result.success(userApiService.loadUsers());\n     }\n \n+    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjQ3OA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566478", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjM1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "820ab5cff3ffdebbf4610ff8411c940b120c30a6", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/controller/user/UserController.java b/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\nindex c680fe8d6..b62e61ab6 100644\n--- a/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\n+++ b/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\n\n@@ -218,18 +219,18 @@ public class UserController extends AbstractRestController {\n         return Result.success(userApiService.loadUsers());\n     }\n \n-    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)\n+    @GetMapping(value = \"/users/info\")\n     @ResponseBody\n     @ApiOperation(\n-            value = \"Loads all registered users for billing purposes.\",\n-            notes = \"Loads all registered users. Some fields, which are not used for billing purposes are \"\n-                    + \"restored to default values.\",\n+            value = \"Loads all users' brief information.\",\n+            notes = \"Loads all registered users, but instead of providing detailed description only the general \"\n+                    + \"information is returned.\",\n             produces = MediaType.APPLICATION_JSON_VALUE)\n     @ApiResponses(\n             value = {@ApiResponse(code = HTTP_STATUS_OK, message = API_STATUS_DESCRIPTION)\n             })\n-    public Result<List<PipelineUser>> loadUsersForBilling() {\n-        return Result.success(userApiService.loadUsersForBilling());\n+    public Result<List<UserInfo>> loadUsersInfo() {\n+        return Result.success(userApiService.loadUsersInfo());\n     }\n \n     @RequestMapping(value = \"/user/controls\", method = RequestMethod.GET)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjY2OQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476496669", "bodyText": "@RequestMapping -> @GetMapping", "author": "mzueva", "createdAt": "2020-08-25T14:33:01Z", "path": "api/src/main/java/com/epam/pipeline/controller/user/UserController.java", "diffHunk": "@@ -218,6 +218,20 @@ public Result deleteUser(@PathVariable Long id) {\n         return Result.success(userApiService.loadUsers());\n     }\n \n+    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjUyOQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566529", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5NjY2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "820ab5cff3ffdebbf4610ff8411c940b120c30a6", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/controller/user/UserController.java b/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\nindex c680fe8d6..b62e61ab6 100644\n--- a/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\n+++ b/api/src/main/java/com/epam/pipeline/controller/user/UserController.java\n\n@@ -218,18 +219,18 @@ public class UserController extends AbstractRestController {\n         return Result.success(userApiService.loadUsers());\n     }\n \n-    @RequestMapping(value = \"/users/billing\", method = RequestMethod.GET)\n+    @GetMapping(value = \"/users/info\")\n     @ResponseBody\n     @ApiOperation(\n-            value = \"Loads all registered users for billing purposes.\",\n-            notes = \"Loads all registered users. Some fields, which are not used for billing purposes are \"\n-                    + \"restored to default values.\",\n+            value = \"Loads all users' brief information.\",\n+            notes = \"Loads all registered users, but instead of providing detailed description only the general \"\n+                    + \"information is returned.\",\n             produces = MediaType.APPLICATION_JSON_VALUE)\n     @ApiResponses(\n             value = {@ApiResponse(code = HTTP_STATUS_OK, message = API_STATUS_DESCRIPTION)\n             })\n-    public Result<List<PipelineUser>> loadUsersForBilling() {\n-        return Result.success(userApiService.loadUsersForBilling());\n+    public Result<List<UserInfo>> loadUsersInfo() {\n+        return Result.success(userApiService.loadUsersInfo());\n     }\n \n     @RequestMapping(value = \"/user/controls\", method = RequestMethod.GET)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5Nzk5NA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476497994", "bodyText": "Let's rename RegionForBilling -> CloudRegionInfo", "author": "mzueva", "createdAt": "2020-08-25T14:34:42Z", "path": "api/src/main/java/com/epam/pipeline/entity/billing/RegionForBilling.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.entity.billing;\n+\n+import com.epam.pipeline.entity.region.CloudProvider;\n+import lombok.Builder;\n+import lombok.Value;\n+\n+@Value\n+@Builder\n+public class RegionForBilling {", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjU5MA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566590", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5Nzk5NA=="}], "type": "inlineReview", "revised_code": {"commit": "9aa78108fef09a727487ab9601feb2ba782fe9c8", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/entity/billing/RegionForBilling.java b/api/src/main/java/com/epam/pipeline/entity/info/CloudRegionInfo.java\nsimilarity index 92%\nrename from api/src/main/java/com/epam/pipeline/entity/billing/RegionForBilling.java\nrename to api/src/main/java/com/epam/pipeline/entity/info/CloudRegionInfo.java\nindex 13feed706..26bea0da7 100644\n--- a/api/src/main/java/com/epam/pipeline/entity/billing/RegionForBilling.java\n+++ b/api/src/main/java/com/epam/pipeline/entity/info/CloudRegionInfo.java\n\n@@ -14,7 +14,7 @@\n  * limitations under the License.\n  */\n \n-package com.epam.pipeline.entity.billing;\n+package com.epam.pipeline.entity.info;\n \n import com.epam.pipeline.entity.region.CloudProvider;\n import lombok.Builder;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODIxMQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476498211", "bodyText": "access for ROLE_USER", "author": "mzueva", "createdAt": "2020-08-25T14:34:57Z", "path": "api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java", "diffHunk": "@@ -39,6 +40,11 @@\n         return cloudRegionManager.loadAll();\n     }\n \n+    @PreAuthorize(AclExpressions.FULL_BILLING_ACCESS)", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjYzOA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566638", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODIxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "9aa78108fef09a727487ab9601feb2ba782fe9c8", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java b/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\nindex f11161f23..be6914091 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\n\n@@ -40,9 +40,8 @@ public class CloudRegionApiService {\n         return cloudRegionManager.loadAll();\n     }\n \n-    @PreAuthorize(AclExpressions.FULL_BILLING_ACCESS)\n-    public List<RegionForBilling> loadAllForBilling() {\n-        return cloudRegionManager.loadAllForBilling();\n+    public List<CloudRegionInfo> loadAllRegionsInfo() {\n+        return cloudRegionManager.loadAllRegionsInfo();\n     }\n \n     @PostAuthorize(\"hasRole('ADMIN') OR hasPermission(returnObject, 'READ')\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODU2NA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476498564", "bodyText": "access for ROLE_USER", "author": "mzueva", "createdAt": "2020-08-25T14:35:26Z", "path": "api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java", "diffHunk": "@@ -110,6 +111,11 @@ public PipelineUser updateUserRoles(Long id, List<Long> roles) {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n+    @PreAuthorize(FULL_BILLING_ACCESS)", "originalCommit": "3620c553b9fd92225b6c9c50cf6e0a7ae1481793", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU2NjY4MA==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r476566680", "bodyText": "Done", "author": "Wedds", "createdAt": "2020-08-25T16:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ5ODU2NA=="}], "type": "inlineReview", "revised_code": {"commit": "820ab5cff3ffdebbf4610ff8411c940b120c30a6", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java b/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\nindex 787b2b44c..66ceae34d 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\n\n@@ -111,9 +111,8 @@ public class UserApiService {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n-    @PreAuthorize(FULL_BILLING_ACCESS)\n-    public List<PipelineUser> loadUsersForBilling() {\n-        return new ArrayList<>(userManager.loadAllUsersForBilling());\n+    public List<UserInfo> loadUsersInfo() {\n+        return userManager.loadUsersInfo();\n     }\n \n     public PipelineUser getCurrentUser() {\n"}}, {"oid": "9aa78108fef09a727487ab9601feb2ba782fe9c8", "url": "https://github.com/epam/cloud-pipeline/commit/9aa78108fef09a727487ab9601feb2ba782fe9c8", "message": "Issue #1258 Generalize CloudRegion-related method", "committedDate": "2020-08-25T15:02:06Z", "type": "commit"}, {"oid": "820ab5cff3ffdebbf4610ff8411c940b120c30a6", "url": "https://github.com/epam/cloud-pipeline/commit/820ab5cff3ffdebbf4610ff8411c940b120c30a6", "message": "Issue #1258 Generalize User-related method", "committedDate": "2020-08-25T15:10:21Z", "type": "commit"}, {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b", "url": "https://github.com/epam/cloud-pipeline/commit/497e6e1de472a0b8f9509585cd7f781df07d955b", "message": "Issue #1258 Info objects refactoring", "committedDate": "2020-08-25T16:12:38Z", "type": "commit"}, {"oid": "497e6e1de472a0b8f9509585cd7f781df07d955b", "url": "https://github.com/epam/cloud-pipeline/commit/497e6e1de472a0b8f9509585cd7f781df07d955b", "message": "Issue #1258 Info objects refactoring", "committedDate": "2020-08-25T16:12:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0OTU1MQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r477149551", "bodyText": "We still need @PreAuthorize annotation here hasRole('ADMIN') OR hasRole('ROLE_USER')", "author": "mzueva", "createdAt": "2020-08-26T09:05:29Z", "path": "api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java", "diffHunk": "@@ -39,6 +40,10 @@\n         return cloudRegionManager.loadAll();\n     }\n \n+    public List<CloudRegionInfo> loadAllRegionsInfo() {", "originalCommit": "497e6e1de472a0b8f9509585cd7f781df07d955b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java b/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\nindex be6914091..fb456e076 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/region/CloudRegionApiService.java\n\n@@ -40,6 +42,7 @@ public class CloudRegionApiService {\n         return cloudRegionManager.loadAll();\n     }\n \n+    @PreAuthorize(ADMIN_OR_GENERAL_USER)\n     public List<CloudRegionInfo> loadAllRegionsInfo() {\n         return cloudRegionManager.loadAllRegionsInfo();\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE0OTczMg==", "url": "https://github.com/epam/cloud-pipeline/pull/1318#discussion_r477149732", "bodyText": "We still need @PreAuthorize annotation here hasRole('ADMIN') OR hasRole('ROLE_USER')", "author": "mzueva", "createdAt": "2020-08-26T09:05:49Z", "path": "api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java", "diffHunk": "@@ -110,6 +111,10 @@ public PipelineUser updateUserRoles(Long id, List<Long> roles) {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n+    public List<UserInfo> loadUsersInfo() {", "originalCommit": "497e6e1de472a0b8f9509585cd7f781df07d955b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java b/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\nindex 66ceae34d..1b56e02de 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/user/UserApiService.java\n\n@@ -111,6 +112,7 @@ public class UserApiService {\n         return new ArrayList<>(userManager.loadAllUsers());\n     }\n \n+    @PreAuthorize(ADMIN_OR_GENERAL_USER)\n     public List<UserInfo> loadUsersInfo() {\n         return userManager.loadUsersInfo();\n     }\n"}}, {"oid": "d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "url": "https://github.com/epam/cloud-pipeline/commit/d49ab71a8d1f926b8a5ebcd69c19bb1f8b74eccb", "message": "Issue #1258 Perform authorization on region and user info methods", "committedDate": "2020-08-26T09:34:48Z", "type": "commit"}]}