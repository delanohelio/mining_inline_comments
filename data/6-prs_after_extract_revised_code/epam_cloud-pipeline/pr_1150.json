{"pr_number": 1150, "pr_title": "Support tool symlinks", "pr_createdAt": "2020-06-04T11:59:46Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1150", "timeline": [{"oid": "90d21a09f621f294083618c02190e9a4b9af0e1a", "url": "https://github.com/epam/cloud-pipeline/commit/90d21a09f621f294083618c02190e9a4b9af0e1a", "message": "Add support for tool symlinks on database level", "committedDate": "2020-06-04T11:07:02Z", "type": "commit"}, {"oid": "81b7e88e0a0859f610022f58ee725b600a8b50a7", "url": "https://github.com/epam/cloud-pipeline/commit/81b7e88e0a0859f610022f58ee725b600a8b50a7", "message": "Add support for symlinks owner update", "committedDate": "2020-06-04T11:07:03Z", "type": "commit"}, {"oid": "3a20cd5295976661a61bf56b820e576df1377307", "url": "https://github.com/epam/cloud-pipeline/commit/3a20cd5295976661a61bf56b820e576df1377307", "message": "Add support for symlink icon loading", "committedDate": "2020-06-04T11:07:03Z", "type": "commit"}, {"oid": "d9dbd45d76717cea8d3e92a3ed1109ba56adc0e9", "url": "https://github.com/epam/cloud-pipeline/commit/d9dbd45d76717cea8d3e92a3ed1109ba56adc0e9", "message": "Add basic support for symlinks creation and loading", "committedDate": "2020-06-04T11:07:04Z", "type": "commit"}, {"oid": "f8a96006c2bde506d05da0c0818e485475469724", "url": "https://github.com/epam/cloud-pipeline/commit/f8a96006c2bde506d05da0c0818e485475469724", "message": "Adapt remaining tool manager methods for symlinks", "committedDate": "2020-06-04T11:07:04Z", "type": "commit"}, {"oid": "0088d44803793efba7ea3936ad327eeae9383a21", "url": "https://github.com/epam/cloud-pipeline/commit/0088d44803793efba7ea3936ad327eeae9383a21", "message": "Adapt most tool related methods for symlinks", "committedDate": "2020-06-04T11:07:05Z", "type": "commit"}, {"oid": "48e3a010d29312435c1b9028e9e9a420226b0a69", "url": "https://github.com/epam/cloud-pipeline/commit/48e3a010d29312435c1b9028e9e9a420226b0a69", "message": "Add support for tool symlinks contextual preferences loading", "committedDate": "2020-06-04T11:07:05Z", "type": "commit"}, {"oid": "7fa7d300d0e8657dd869e7f1770311eaae989057", "url": "https://github.com/epam/cloud-pipeline/commit/7fa7d300d0e8657dd869e7f1770311eaae989057", "message": "Add support for tool symlinks to docker registry sql queries", "committedDate": "2020-06-04T11:07:06Z", "type": "commit"}, {"oid": "f227bccdedd1b5e9f483d956c3b3404511ae96e5", "url": "https://github.com/epam/cloud-pipeline/commit/f227bccdedd1b5e9f483d956c3b3404511ae96e5", "message": "Repair tool icon query for tools which have symlinks", "committedDate": "2020-06-04T11:07:06Z", "type": "commit"}, {"oid": "25abcd51da2a1b337469cf95b8047958adacfea0", "url": "https://github.com/epam/cloud-pipeline/commit/25abcd51da2a1b337469cf95b8047958adacfea0", "message": "Adapt tool version sql queries for symlinks", "committedDate": "2020-06-04T11:07:07Z", "type": "commit"}, {"oid": "c5487470539b91d984e1af76241c70681250168f", "url": "https://github.com/epam/cloud-pipeline/commit/c5487470539b91d984e1af76241c70681250168f", "message": "Reject all tool symlink version modifications", "committedDate": "2020-06-04T11:07:07Z", "type": "commit"}, {"oid": "6652f8d87a1a24055fed0f68c28c4f2d7257ed70", "url": "https://github.com/epam/cloud-pipeline/commit/6652f8d87a1a24055fed0f68c28c4f2d7257ed70", "message": "Resolve checkstyle and pmd issues", "committedDate": "2020-06-04T11:09:02Z", "type": "commit"}, {"oid": "59c0b958bfddec5e0f042a6bbe637aad24e8de9f", "url": "https://github.com/epam/cloud-pipeline/commit/59c0b958bfddec5e0f042a6bbe637aad24e8de9f", "message": "Resolve additional checkstyle and pmd issues", "committedDate": "2020-06-04T15:24:29Z", "type": "commit"}, {"oid": "cc98c1eae036eb1329307ebed3e8a79c509f0edd", "url": "https://github.com/epam/cloud-pipeline/commit/cc98c1eae036eb1329307ebed3e8a79c509f0edd", "message": "Add actual docker image pipeline run field", "committedDate": "2020-06-04T16:00:05Z", "type": "commit"}, {"oid": "aad0639e1f298638db986003b0cacdd6584b6857", "url": "https://github.com/epam/cloud-pipeline/commit/aad0639e1f298638db986003b0cacdd6584b6857", "message": "Adapt tool image history loading for symlinks", "committedDate": "2020-06-05T10:55:01Z", "type": "commit"}, {"oid": "fdcaa12ab05be9977cd9d876babe0632965567d0", "url": "https://github.com/epam/cloud-pipeline/commit/fdcaa12ab05be9977cd9d876babe0632965567d0", "message": "Move the migration to the recent date", "committedDate": "2020-06-05T10:55:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg0NjUzOQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1150#discussion_r435846539", "bodyText": "I think all operations read & write shall be forbidden (since user won't be able to pull a symlink anyway)", "author": "mzueva", "createdAt": "2020-06-05T10:57:44Z", "path": "api/src/main/java/com/epam/pipeline/manager/docker/DockerRegistryManager.java", "diffHunk": "@@ -591,6 +591,12 @@ private Tool buildTool(DockerRegistry dockerRegistry, ToolGroup toolGroup, Strin\n                 }\n             }\n \n+            if (isSymlinkWriting(entity, permissions)) {", "originalCommit": "cc98c1eae036eb1329307ebed3e8a79c509f0edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg5NTQxNw==", "url": "https://github.com/epam/cloud-pipeline/pull/1150#discussion_r435895417", "bodyText": "Seems reasonable, done.", "author": "tcibinan", "createdAt": "2020-06-05T12:43:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg0NjUzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "ebfa325951ba047e77150a1db35ef4ebda76c322", "chunk": "diff --git a/api/src/main/java/com/epam/pipeline/manager/docker/DockerRegistryManager.java b/api/src/main/java/com/epam/pipeline/manager/docker/DockerRegistryManager.java\nindex 3a41dd450..c548e1337 100644\n--- a/api/src/main/java/com/epam/pipeline/manager/docker/DockerRegistryManager.java\n+++ b/api/src/main/java/com/epam/pipeline/manager/docker/DockerRegistryManager.java\n\n@@ -591,7 +591,7 @@ public class DockerRegistryManager implements SecuredEntityManager {\n                 }\n             }\n \n-            if (isSymlinkWriting(entity, permissions)) {\n+            if (isSymlink(entity)) {\n                 throw new DockerAuthorizationException(registry.getPath(), messageHelper\n                         .getMessage(MessageConstants.ERROR_REGISTRY_IMAGE_ACTION_IS_NOT_ALLOWED, scope,\n                                 claim.getImageName(), userName, registry.getPath()));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg2ODUyNg==", "url": "https://github.com/epam/cloud-pipeline/pull/1150#discussion_r435868526", "bodyText": "Issues can be attached to symlinks", "author": "mzueva", "createdAt": "2020-06-05T11:48:48Z", "path": "api/src/main/java/com/epam/pipeline/manager/issue/IssueManager.java", "diffHunk": "@@ -97,6 +103,7 @@ public Issue createIssue(IssueVO issueVO) {\n         EntityVO entityVO = issueVO.getEntity();\n         validateEntityParameters(entityVO);\n         AbstractSecuredEntity entity = ensureEntityExists(entityVO);\n+        validateEntityCanBeModified(entityVO);", "originalCommit": "cc98c1eae036eb1329307ebed3e8a79c509f0edd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg5NTg2Nw==", "url": "https://github.com/epam/cloud-pipeline/pull/1150#discussion_r435895867", "bodyText": "As discussed with @sidoruka issues creation shall be forbidden for symlinks.", "author": "tcibinan", "createdAt": "2020-06-05T12:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg2ODUyNg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ebfa325951ba047e77150a1db35ef4ebda76c322", "url": "https://github.com/epam/cloud-pipeline/commit/ebfa325951ba047e77150a1db35ef4ebda76c322", "message": "Reject both pull and push requests for symlinks", "committedDate": "2020-06-05T12:39:41Z", "type": "commit"}]}