{"pr_number": 412, "pr_title": "Skip step fix", "pr_createdAt": "2020-04-23T06:20:02Z", "pr_url": "https://github.com/opensrp/opensrp-client-native-form/pull/412", "timeline": [{"oid": "515ce6855ec213714ec5511d2c0afbc56b9810b4", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/515ce6855ec213714ec5511d2c0afbc56b9810b4", "message": "add fix for skip step", "committedDate": "2020-04-23T06:19:19Z", "type": "commit"}, {"oid": "f5f68d662623cd45b2be50859b3628ae8da5d5d9", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f5f68d662623cd45b2be50859b3628ae8da5d5d9", "message": "remove tempViews list", "committedDate": "2020-04-23T06:22:41Z", "type": "commit"}, {"oid": "bac81091c64a69681bb196368062967aaa652a9b", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/bac81091c64a69681bb196368062967aaa652a9b", "message": "remove tempViews list", "committedDate": "2020-04-23T06:23:50Z", "type": "commit"}, {"oid": "78eaba1dcc3b55e52a9096583d52941e4c3f9bf7", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/78eaba1dcc3b55e52a9096583d52941e4c3f9bf7", "message": "added comments", "committedDate": "2020-04-23T06:29:55Z", "type": "commit"}, {"oid": "e69c17dffdfd8abee1fdb20fb49a58125bb2ebb4", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e69c17dffdfd8abee1fdb20fb49a58125bb2ebb4", "message": "recursive deterministic check", "committedDate": "2020-04-23T15:29:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwOTM2OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r419309369", "bodyText": "The assumption here is that only the current step will need to be validated at any given time.\nI think when clicking save/submit maybe the whole form may need validation in some forms validation is skipped when jumping steps", "author": "githengi", "createdAt": "2020-05-04T09:21:26Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java", "diffHunk": "@@ -228,67 +232,70 @@ public void validateAndWriteValues() {\n         for (View childView : formFragment.getJsonApi().getFormDataViews()) {\n             ValidationStatus validationStatus = validateView(childView);\n             String key = (String) childView.getTag(R.id.key);\n-            String openMrsEntityParent = (String) childView.getTag(R.id.openmrs_entity_parent);\n-            String openMrsEntity = (String) childView.getTag(R.id.openmrs_entity);\n-            String openMrsEntityId = (String) childView.getTag(R.id.openmrs_entity_id);\n-            Boolean popup = (Boolean) childView.getTag(R.id.extraPopup);\n-            String fieldKey = mStepName + \"#\" + getStepTitle() + \":\" + key;\n-\n-            if (childView instanceof MaterialEditText) {\n-                MaterialEditText editText = (MaterialEditText) childView;\n-\n-                String rawValue = (String) editText.getTag(R.id.raw_value);\n-                if (rawValue == null) {\n-                    rawValue = editText.getText().toString();\n-                }\n+            String address = (String) childView.getTag(R.id.address);\n+            if (mStepName.equals(address.split(\":\")[0])) {", "originalCommit": "e69c17dffdfd8abee1fdb20fb49a58125bb2ebb4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7462e6f99e583b419e58dac410cfad2d26cd468f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java\nindex 43617d62..328d6b00 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/presenters/JsonFormFragmentPresenter.java\n\n@@ -232,69 +252,65 @@ public class JsonFormFragmentPresenter extends\n         for (View childView : formFragment.getJsonApi().getFormDataViews()) {\n             ValidationStatus validationStatus = validateView(childView);\n             String key = (String) childView.getTag(R.id.key);\n-            String address = (String) childView.getTag(R.id.address);\n-            if (mStepName.equals(address.split(\":\")[0])) {\n-                String openMrsEntityParent = (String) childView.getTag(R.id.openmrs_entity_parent);\n-                String openMrsEntity = (String) childView.getTag(R.id.openmrs_entity);\n-                String openMrsEntityId = (String) childView.getTag(R.id.openmrs_entity_id);\n-                Boolean popup = (Boolean) childView.getTag(R.id.extraPopup);\n-                String fieldKey = mStepName + \"#\" + getStepTitle() + \":\" + key;\n-\n-                if (childView instanceof MaterialEditText) {\n-                    MaterialEditText editText = (MaterialEditText) childView;\n-\n-                    String rawValue = (String) editText.getTag(R.id.raw_value);\n-                    if (rawValue == null) {\n-                        rawValue = editText.getText().toString();\n-                    }\n+            String openMrsEntityParent = (String) childView.getTag(R.id.openmrs_entity_parent);\n+            String openMrsEntity = (String) childView.getTag(R.id.openmrs_entity);\n+            String openMrsEntityId = (String) childView.getTag(R.id.openmrs_entity_id);\n+            Boolean popup = (Boolean) childView.getTag(R.id.extraPopup);\n+            String fieldKey = mStepName + \"#\" + getStepTitle() + \":\" + key;\n+\n+            if (childView instanceof MaterialEditText) {\n+                MaterialEditText editText = (MaterialEditText) childView;\n+\n+                String rawValue = (String) editText.getTag(R.id.raw_value);\n+                if (rawValue == null) {\n+                    rawValue = editText.getText().toString();\n+                }\n \n-                    handleWrongFormatInputs(validationStatus, fieldKey, rawValue);\n+                handleWrongFormatInputs(validationStatus, fieldKey, rawValue);\n \n-                    String type = (String) childView.getTag(R.id.type);\n-                    rawValue = JsonFormConstants.DATE_PICKER.equals(type) || JsonFormConstants.TIME_PICKER.equals(type) ? childView.getTag(R.id.locale_independent_value).toString() : rawValue;\n-                    Log.d(\"Writing values ..\", key + \" \" + rawValue);\n+                String type = (String) childView.getTag(R.id.type);\n+                rawValue = JsonFormConstants.DATE_PICKER.equals(type) || JsonFormConstants.TIME_PICKER.equals(type) ? childView.getTag(R.id.locale_independent_value).toString() : rawValue;\n+                Log.d(\"Writing values ..\", key + \" \" + rawValue);\n \n-                    getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n-                } else if (childView instanceof NativeEditText) {\n-                    NativeEditText editText = (NativeEditText) childView;\n+                getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n+            } else if (childView instanceof NativeEditText) {\n+                NativeEditText editText = (NativeEditText) childView;\n \n-                    String rawValue = (String) editText.getTag(R.id.raw_value);\n-                    if (rawValue == null) {\n-                        rawValue = editText.getText().toString();\n-                    }\n+                String rawValue = (String) editText.getTag(R.id.raw_value);\n+                if (rawValue == null) {\n+                    rawValue = editText.getText().toString();\n+                }\n \n-                    handleWrongFormatInputs(validationStatus, fieldKey, rawValue);\n+                handleWrongFormatInputs(validationStatus, fieldKey, rawValue);\n \n-                    getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n-                } else if (childView instanceof ImageView) {\n-                    Object path = childView.getTag(R.id.imagePath);\n-                    if (path instanceof String) {\n-                        getView().writeValue(mStepName, key, (String) path, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n-                    }\n-                } else if (childView instanceof CheckBox) {\n-                    String parentKey = (String) childView.getTag(R.id.key);\n-                    String childKey = (String) childView.getTag(R.id.childKey);\n-                    getView().writeValue(mStepName, parentKey, JsonFormConstants.OPTIONS_FIELD_NAME, childKey, String.valueOf(((CheckBox) childView).isChecked()), openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n-                } else if (childView instanceof RadioButton) {\n-                    String parentKey = (String) childView.getTag(R.id.key);\n-                    String childKey = (String) childView.getTag(R.id.childKey);\n-                    if (((RadioButton) childView).isChecked()) {\n-                        getView().writeValue(mStepName, parentKey, childKey, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n-                    }\n-                } else if (childView instanceof Button) {\n-                    Button button = (Button) childView;\n-                    String rawValue = (String) button.getTag(R.id.raw_value);\n-                    getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n+                getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n+            } else if (childView instanceof ImageView) {\n+                Object path = childView.getTag(R.id.imagePath);\n+                if (path instanceof String) {\n+                    getView().writeValue(mStepName, key, (String) path, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n                 }\n-\n-                if (!validationStatus.isValid()) {\n-                    invalidFields.put(fieldKey, validationStatus);\n-                } else {\n-                    if (invalidFields.size() > 0) {\n-                        invalidFields.remove(fieldKey);\n-                    }\n+            } else if (childView instanceof CheckBox) {\n+                String parentKey = (String) childView.getTag(R.id.key);\n+                String childKey = (String) childView.getTag(R.id.childKey);\n+                getView().writeValue(mStepName, parentKey, JsonFormConstants.OPTIONS_FIELD_NAME, childKey, String.valueOf(((CheckBox) childView).isChecked()), openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n+            } else if (childView instanceof RadioButton) {\n+                String parentKey = (String) childView.getTag(R.id.key);\n+                String childKey = (String) childView.getTag(R.id.childKey);\n+                if (((RadioButton) childView).isChecked()) {\n+                    getView().writeValue(mStepName, parentKey, childKey, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n                 }\n+            } else if (childView instanceof Button) {\n+                Button button = (Button) childView;\n+                String rawValue = (String) button.getTag(R.id.raw_value);\n+                getView().writeValue(mStepName, key, rawValue, openMrsEntityParent, openMrsEntity, openMrsEntityId, popup);\n+            }\n \n+            if (!validationStatus.isValid()) {\n+                invalidFields.put(fieldKey, validationStatus);\n+            } else {\n+                if (invalidFields.size() > 0) {\n+                    invalidFields.remove(fieldKey);\n+                }\n             }\n         }\n         formFragment.onFieldsInvalid.passInvalidFields(invalidFields);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwOTgyNw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r419309827", "bodyText": "Why is this set to true?", "author": "githengi", "createdAt": "2020-05-04T09:22:23Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -149,14 +158,15 @@ private Form getForm() {\n     @Override\n     public void onResume() {\n         super.onResume();\n+        processSkipSteps();\n         setJsonFormFragment(this);\n-\n     }\n \n     public void processSkipSteps() {\n         if (!getJsonApi().isPreviousPressed()) {\n-            skipStepsOnNextPressed();\n+            //skipStepsOnNextPressed();//will be handled by previous step\n         } else {\n+            setShouldSkipStep(true);", "originalCommit": "e69c17dffdfd8abee1fdb20fb49a58125bb2ebb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzA2NjE4Mg==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r427066182", "bodyText": "removed it", "author": "bennsimon", "createdAt": "2020-05-19T06:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMwOTgyNw=="}], "type": "inlineReview", "revised_code": {"commit": "c9f9add751bd02d2fe4694a111f85518ea1be9ac", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 6707dbd0..5be1a42a 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -166,7 +166,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n         if (!getJsonApi().isPreviousPressed()) {\n             //skipStepsOnNextPressed();//will be handled by previous step\n         } else {\n-            setShouldSkipStep(true);\n+//            setShouldSkipStep(true);\n             skipStepOnPreviousPressed();\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTMxMDU3MA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r419310570", "bodyText": "Then this should be refactored if this is not being used", "author": "githengi", "createdAt": "2020-05-04T09:23:53Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -149,14 +158,15 @@ private Form getForm() {\n     @Override\n     public void onResume() {\n         super.onResume();\n+        processSkipSteps();\n         setJsonFormFragment(this);\n-\n     }\n \n     public void processSkipSteps() {\n         if (!getJsonApi().isPreviousPressed()) {\n-            skipStepsOnNextPressed();\n+            //skipStepsOnNextPressed();//will be handled by previous step", "originalCommit": "e69c17dffdfd8abee1fdb20fb49a58125bb2ebb4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c9f9add751bd02d2fe4694a111f85518ea1be9ac", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 6707dbd0..5be1a42a 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -166,7 +166,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n         if (!getJsonApi().isPreviousPressed()) {\n             //skipStepsOnNextPressed();//will be handled by previous step\n         } else {\n-            setShouldSkipStep(true);\n+//            setShouldSkipStep(true);\n             skipStepOnPreviousPressed();\n         }\n     }\n"}}, {"oid": "c9f9add751bd02d2fe4694a111f85518ea1be9ac", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c9f9add751bd02d2fe4694a111f85518ea1be9ac", "message": "update skipping step", "committedDate": "2020-05-15T11:43:30Z", "type": "commit"}, {"oid": "5ae325287e1d003417ac47cd48bd383dfabfda16", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5ae325287e1d003417ac47cd48bd383dfabfda16", "message": "Merge branch 'optimize-native-forms' of github.com:OpenSRP/opensrp-client-native-form into skip-step-fix", "committedDate": "2020-05-15T16:06:03Z", "type": "commit"}, {"oid": "af969b7ce6ea7697bc2e575e0d73d19faed28d1d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/af969b7ce6ea7697bc2e575e0d73d19faed28d1d", "message": "update skipping step fix", "committedDate": "2020-05-18T09:41:34Z", "type": "commit"}, {"oid": "7462e6f99e583b419e58dac410cfad2d26cd468f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7462e6f99e583b419e58dac410cfad2d26cd468f", "message": "remove unneded code", "committedDate": "2020-05-18T09:57:14Z", "type": "commit"}, {"oid": "9652df4748cca4ff137739e4e01c719573b69f2d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9652df4748cca4ff137739e4e01c719573b69f2d", "message": "code cleanup", "committedDate": "2020-05-18T10:04:42Z", "type": "commit"}, {"oid": "0efbfe93c33b59447def32c5db09c88761c953b7", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/0efbfe93c33b59447def32c5db09c88761c953b7", "message": "code cleanup", "committedDate": "2020-05-18T10:06:51Z", "type": "commit"}, {"oid": "e246e88861f2a954bc40491ff906f01ea1de1b52", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e246e88861f2a954bc40491ff906f01ea1de1b52", "message": "temporary fix for loop on back press'", "committedDate": "2020-05-18T11:00:29Z", "type": "commit"}, {"oid": "138d2312c33412353dc2c88f89aca37c49d7fb10", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/138d2312c33412353dc2c88f89aca37c49d7fb10", "message": "add function to mark skipped steps", "committedDate": "2020-05-19T06:44:11Z", "type": "commit"}, {"oid": "5cd8697d3956897fc9d4004d374d63edd5c33980", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5cd8697d3956897fc9d4004d374d63edd5c33980", "message": "use AppExecutors mainthread in place of runOnUiThread", "committedDate": "2020-05-19T09:51:39Z", "type": "commit"}, {"oid": "5ea0a00afe0c7de9e516668ba8ddd9c5df984667", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5ea0a00afe0c7de9e516668ba8ddd9c5df984667", "message": "test fields that need to be laaded in the mainthread", "committedDate": "2020-05-20T06:51:14Z", "type": "commit"}, {"oid": "da4ea4c779220cd7847df02334cff6f097cdd20d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/da4ea4c779220cd7847df02334cff6f097cdd20d", "message": "Merge branch 'skip-step-fix' of github.com:OpenSRP/opensrp-client-native-form into skip-step-fix", "committedDate": "2020-05-20T06:52:12Z", "type": "commit"}, {"oid": "fe96c8a0210d2467dae6c94e09c512b71d65eb58", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/fe96c8a0210d2467dae6c94e09c512b71d65eb58", "message": "update ui logic for other ruleso", "committedDate": "2020-05-20T09:59:18Z", "type": "commit"}, {"oid": "84763d07e7a9a02984a6ebcd533325740602aee6", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/84763d07e7a9a02984a6ebcd533325740602aee6", "message": "revert due to probable class casting error", "committedDate": "2020-05-21T06:37:28Z", "type": "commit"}, {"oid": "560bebe9277d585aa18439026f4b13689c7e2097", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/560bebe9277d585aa18439026f4b13689c7e2097", "message": "fix setError to run on ui thread", "committedDate": "2020-05-21T06:45:10Z", "type": "commit"}, {"oid": "b41e00ea9f3b31fc722fa3e4ccfd2e3c2b3bbd8b", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b41e00ea9f3b31fc722fa3e4ccfd2e3c2b3bbd8b", "message": "code cleanup", "committedDate": "2020-05-21T07:12:47Z", "type": "commit"}, {"oid": "d2add240e5e569a79b7b9a57b99856587b28f740", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/d2add240e5e569a79b7b9a57b99856587b28f740", "message": "code clean up", "committedDate": "2020-05-21T08:16:31Z", "type": "commit"}, {"oid": "69d2874be50fce28aba1e66f5befef7587364401", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/69d2874be50fce28aba1e66f5befef7587364401", "message": "add map to hold steps, skiplogic presence", "committedDate": "2020-05-21T09:09:20Z", "type": "commit"}, {"oid": "2edd13a35a8ee831890a8f6ee0d5fe98d3755942", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/2edd13a35a8ee831890a8f6ee0d5fe98d3755942", "message": "add check skiplogic on previous clicks", "committedDate": "2020-05-21T09:35:24Z", "type": "commit"}, {"oid": "80c120bea1a58798b45aadc7d5818508e3d89fe8", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/80c120bea1a58798b45aadc7d5818508e3d89fe8", "message": "remove misleading comment", "committedDate": "2020-05-21T09:38:06Z", "type": "commit"}, {"oid": "287c6501fcabc8a8d5514448da71217f17961570", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/287c6501fcabc8a8d5514448da71217f17961570", "message": "update comments", "committedDate": "2020-05-21T09:40:46Z", "type": "commit"}, {"oid": "4491c6e8546713a644f4376eec67b1c71e5d3acd", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/4491c6e8546713a644f4376eec67b1c71e5d3acd", "message": "replace return with continue for media logic", "committedDate": "2020-05-21T09:44:27Z", "type": "commit"}, {"oid": "24d0d36f6270ea96670071476e30317ea81c4e00", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/24d0d36f6270ea96670071476e30317ea81c4e00", "message": "move the next step method call", "committedDate": "2020-05-22T14:53:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyMDM3MA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r430420370", "bodyText": "Combine this if condition with the upper if", "author": "githengi", "createdAt": "2020-05-26T13:41:04Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -1079,7 +1093,17 @@ protected void addRelevance(View view, boolean popup) {\n                     }\n \n                 }\n-                toggleViewVisibility(view, comparison, isPopup);\n+                //update ui\n+                if (isForNextStep) {\n+                    if (((address.length == 2 && address[0].equals(nextStep())) || (address.length == 3 && address[2].contains(nextStep())))) {\n+                        if (comparison) {", "originalCommit": "24d0d36f6270ea96670071476e30317ea81c4e00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a9e5544e3b6422f90566a6f1582a7fe4bea8ca1f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\nindex ec5a40c8..34c9aba0 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n\n@@ -1093,13 +1093,13 @@ public class JsonFormActivity extends JsonFormBaseActivity implements JsonApi {\n                     }\n \n                 }\n-                //update ui\n-                if (isForNextStep) {\n-                    if (((address.length == 2 && address[0].equals(nextStep())) || (address.length == 3 && address[2].contains(nextStep())))) {\n-                        if (comparison) {\n-                            setNextStepRelevant(true);\n-                        }\n+\n+                if (isForNextStep && ((address.length == 2 && address[0].equals(nextStep())) || (address.length == 3 && address[2].contains(nextStep())))) {\n+\n+                    if (comparison) {\n+                        setNextStepRelevant(true);\n                     }\n+\n                     preComputedRelevanceMap.put(view, comparison + \":\" + popup);\n                 } else {\n                     toggleViewVisibility(view, comparison, isPopup);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNDY2Ng==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r430424666", "bodyText": "Run the specific code that needs to be run in the UI thread in the factories and not here. This is a pattern that should be adopted", "author": "githengi", "createdAt": "2020-05-26T13:47:04Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interactors/JsonFormInteractor.java", "diffHunk": "@@ -180,15 +180,35 @@ public void fetchFields(List<View> viewsFromJson, String stepName, JsonFormFragm\n         }\n     }\n \n-    private void fetchViews(List<View> viewsFromJson, String stepName, JsonFormFragment formFragment,\n-                            String type, JSONObject jsonObject, CommonListener listener, Boolean popup) {\n+    private void fetchViews(final List<View> viewsFromJson, final String stepName, final JsonFormFragment formFragment,\n+                            final String type, final JSONObject jsonObject, final CommonListener listener, final Boolean popup) {\n \n         try {\n-            List<View> views = map\n-                    .get(type)\n-                    .getViewsFromJson(stepName, formFragment.getActivity(), formFragment, jsonObject, listener, popup);\n-            if (views.size() > 0) {\n-                viewsFromJson.addAll(views);\n+            if (type.equals(\"tree\") || type.equals(\"edit_text\")) { ///some fields need to be loaded on the main thread TO-DO re-write", "originalCommit": "24d0d36f6270ea96670071476e30317ea81c4e00", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a9e5544e3b6422f90566a6f1582a7fe4bea8ca1f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interactors/JsonFormInteractor.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interactors/JsonFormInteractor.java\nindex 3fdee829..a924dfce 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interactors/JsonFormInteractor.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interactors/JsonFormInteractor.java\n\n@@ -180,41 +182,19 @@ public class JsonFormInteractor {\n         }\n     }\n \n-    private void fetchViews(final List<View> viewsFromJson, final String stepName, final JsonFormFragment formFragment,\n-                            final String type, final JSONObject jsonObject, final CommonListener listener, final Boolean popup) {\n+    private void fetchViews(List<View> viewsFromJson, String stepName, JsonFormFragment formFragment,\n+                            String type, JSONObject jsonObject, CommonListener listener, Boolean popup) {\n \n         try {\n-            if (type.equals(\"tree\") || type.equals(\"edit_text\")) { ///some fields need to be loaded on the main thread TO-DO re-write\n-                formFragment.getJsonApi().getAppExecutors().mainThread().execute(new Runnable() {\n-                    @Override\n-                    public void run() {\n-                        List<View> views = null;\n-                        try {\n-                            views = map\n-                                    .get(type)\n-                                    .getViewsFromJson(stepName, formFragment.getActivity(), formFragment, jsonObject, listener, popup);\n-                        } catch (Exception e) {\n-                            e.printStackTrace();\n-                        }\n-                        if (views.size() > 0) {\n-                            viewsFromJson.addAll(views);\n-                        }\n-                    }\n-                });\n-\n-            } else {\n-                List<View> views = map\n-                        .get(type)\n-                        .getViewsFromJson(stepName, formFragment.getActivity(), formFragment, jsonObject, listener, popup);\n-                if (views.size() > 0) {\n-                    viewsFromJson.addAll(views);\n-                }\n+            List<View> views = map\n+                    .get(type)\n+                    .getViewsFromJson(stepName, formFragment.getActivity(), formFragment, jsonObject, listener, popup);\n+            if (views.size() > 0) {\n+                viewsFromJson.addAll(views);\n             }\n+\n         } catch (Exception e) {\n-            Log.e(TAG,\n-                    \"Exception occurred in making view : Exception is : \"\n-                            + e.getMessage());\n-            e.printStackTrace();\n+            Timber.e(\"Exception occurred in making view : Exception is : %s \", e.getMessage());\n         }\n \n     }\n"}}, {"oid": "a9e5544e3b6422f90566a6f1582a7fe4bea8ca1f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a9e5544e3b6422f90566a6f1582a7fe4bea8ca1f", "message": "code cleanup", "committedDate": "2020-05-27T13:29:43Z", "type": "commit"}, {"oid": "fa53c2d0a4147c49e5e6278bc31826e4d8fc6506", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/fa53c2d0a4147c49e5e6278bc31826e4d8fc6506", "message": "update fragment pop stack method", "committedDate": "2020-05-29T08:29:25Z", "type": "commit"}, {"oid": "a120e9799ad3fa3e5dc3eb21091b31cc144893fc", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a120e9799ad3fa3e5dc3eb21091b31cc144893fc", "message": "Merge branch 'optimize-native-forms' of github.com:OpenSRP/opensrp-client-native-form into skip-step-fix", "committedDate": "2020-06-04T15:27:30Z", "type": "commit"}, {"oid": "8683fe9b4036577416871659181ec1292a3539f9", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8683fe9b4036577416871659181ec1292a3539f9", "message": "fix conflicts", "committedDate": "2020-06-04T15:28:16Z", "type": "commit"}, {"oid": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/ca418c65263a84ac2b2c8727f67e633faa631eb5", "message": "remove deep copy change", "committedDate": "2020-06-05T14:48:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMzODk1OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436338959", "bodyText": "Method not being used", "author": "githengi", "createdAt": "2020-06-07T08:29:39Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java", "diffHunk": "@@ -289,21 +290,31 @@ public static void updateEndProperties(PropertyManager propertyManager, JSONObje\n         }\n     }\n \n+    public static <T> T deepCopy(T object, Class<T> type) {\n+        try {\n+            Gson gson = new Gson();\n+            return gson.fromJson(gson.toJson(object, type), type);\n+        } catch (Exception e) {\n+            e.printStackTrace();\n+            return null;\n+        }\n+    }", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5MTY0NA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436491644", "bodyText": "removed", "author": "bennsimon", "createdAt": "2020-06-08T07:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjMzODk1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java\nindex a2af6c80..42a5e5fe 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/FormUtils.java\n\n@@ -290,16 +286,6 @@ public class FormUtils {\n         }\n     }\n \n-    public static <T> T deepCopy(T object, Class<T> type) {\n-        try {\n-            Gson gson = new Gson();\n-            return gson.fromJson(gson.toJson(object, type), type);\n-        } catch (Exception e) {\n-            e.printStackTrace();\n-            return null;\n-        }\n-    }\n-\n     public Map<String, View> createRadioButtonAndCheckBoxLabel(String stepName, LinearLayout linearLayout,\n                                                                JSONObject jsonObject, Context context,\n                                                                JSONArray canvasIds, final Boolean readOnly,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDE1OQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436340159", "bodyText": "why not use else for readability", "author": "githengi", "createdAt": "2020-06-07T08:45:29Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -1211,59 +1236,67 @@ private void checkViewConstraints(View curView, boolean popup) {\n                         if (errorMessage != null) break;\n                     }\n                 }\n+                if (isForNextStep) {\n+                    preComputedConstraintMap.put(curView, popup + \":\" + errorMessage);\n+                    return;", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\nindex 94d4169c..662f4af0 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n\n@@ -1236,11 +1236,11 @@ public class JsonFormActivity extends JsonFormBaseActivity implements JsonApi {\n                         if (errorMessage != null) break;\n                     }\n                 }\n-                if (isForNextStep) {\n+                if (!isForNextStep) {\n+                    updateUiByConstraints(curView, popup, errorMessage);\n+                } else {\n                     preComputedConstraintMap.put(curView, popup + \":\" + errorMessage);\n-                    return;\n                 }\n-                updateUiByConstraints(curView, popup, errorMessage);\n             } catch (Exception e) {\n                 Timber.e(e, \"JsonFormActivity --> checkViewConstraints\");\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDI1NQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436340255", "bodyText": "should this be added to an else block", "author": "githengi", "createdAt": "2020-06-07T08:46:39Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -1428,6 +1461,10 @@ protected void refreshMediaLogic(String key, String value, String stepName) {\n                 JSONArray medias = questionGroup.getJSONArray(\"media\");\n                 for (int j = 0; j < medias.length(); j++) {\n                     JSONObject media = medias.getJSONObject(j);\n+                    if (isForNextStep) {\n+                        preComputedMediaLogicMap.put(media, value);\n+                        continue;\n+                    }\n                     mediaDialog(media, value);", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\nindex 94d4169c..662f4af0 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n\n@@ -1461,11 +1461,11 @@ public class JsonFormActivity extends JsonFormBaseActivity implements JsonApi {\n                 JSONArray medias = questionGroup.getJSONArray(\"media\");\n                 for (int j = 0; j < medias.length(); j++) {\n                     JSONObject media = medias.getJSONObject(j);\n-                    if (isForNextStep) {\n+                    if (!isForNextStep) {\n+                        mediaDialog(media, value);\n+                    } else {\n                         preComputedMediaLogicMap.put(media, value);\n-                        continue;\n                     }\n-                    mediaDialog(media, value);\n                 }\n             }\n         } catch (Exception e) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDc0Mw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436340743", "bodyText": "Why is this still being used, if it has been deprecated", "author": "githengi", "createdAt": "2020-06-07T08:53:34Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -268,6 +265,7 @@ public void updateVisibilityOfNextAndSave(boolean next, boolean save) {\n     }\n \n     /**\n+     * @deprecated use {@link #skipStepsOnNextPressed(String)}", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -265,16 +263,15 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n     }\n \n     /**\n-     * @deprecated use {@link #skipStepsOnNextPressed(String)}\n      * Skips blank by relevance steps when next is clicked on the json wizard forms.\n      */\n-    public void skipStepsOnNextPressed() {\n+    public void skipLoadedStepsOnNextPressed() {\n         if (skipBlankSteps()) {\n             JSONObject formStep = getStep(getArguments().getString(JsonFormConstants.STEPNAME));\n             String next = formStep.optString(JsonFormConstants.NEXT, \"\");\n             if (StringUtils.isNotEmpty(next)) {\n                 checkIfStepIsBlank(formStep);\n-                if (shouldSkipStep() && !nextStepHasNoSkipLogic()) {\n+                if (shouldSkipStep()) {\n                     getJsonApi().setNextStep(next);\n                     markStepAsSkipped(formStep);\n                     next();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDc5NQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436340795", "bodyText": "Rename this to Process Previous step since the method functionality has been changed", "author": "githengi", "createdAt": "2020-06-07T08:54:28Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -149,14 +148,12 @@ private Form getForm() {\n     @Override\n     public void onResume() {\n         super.onResume();\n+        processSkipSteps();", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -148,14 +148,12 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n     @Override\n     public void onResume() {\n         super.onResume();\n-        processSkipSteps();\n-        setJsonFormFragment(this);\n-    }\n \n-    public void processSkipSteps() {\n         if (getJsonApi().isPreviousPressed()) {\n             skipStepOnPreviousPressed();\n         }\n+\n+        setJsonFormFragment(this);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MDg0Nw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436340847", "bodyText": "Private methods should not be deprecated since they cannot be used outside the class. Remove method if deprecated", "author": "githengi", "createdAt": "2020-06-07T08:55:13Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -306,9 +337,9 @@ public void skipStepOnPreviousPressed() {\n     }\n \n     /**\n-     * Checks if a given step is blank due to relevance hidding all the widgets\n-     *\n      * @param formStep {@link JSONObject}\n+     * @deprecated use a combination of #isNextStepRelevant and {@link #nextStepHasNoSkipLogic()}", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -337,9 +334,10 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n     }\n \n     /**\n+     * should not be used alone, use with {@link #nextStepHasNoSkipLogic()}\n+     * Checks if a given step is blank due to relevance hiding all the widgets\n+     *\n      * @param formStep {@link JSONObject}\n-     * @deprecated use a combination of #isNextStepRelevant and {@link #nextStepHasNoSkipLogic()}\n-     * Checks if a given step is blank due to relevance hidding all the widgets\n      */\n     private void checkIfStepIsBlank(JSONObject formStep) {\n         try {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MTA3NQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436341075", "bodyText": "The implementation of this method should be calling stepHasNoSkipLogic(@Nullable String step) with getJsonApi().nextStep() as the argument", "author": "githengi", "createdAt": "2020-06-07T08:58:06Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -401,12 +442,32 @@ public void onClick(View view) {\n                     assert getFragmentManager() != null;\n                     presenter.checkAndStopCountdownAlarm();\n                     getJsonApi().setPreviousPressed(true);\n-                    getFragmentManager().popBackStack();\n+                    getJsonApi().getStack().pop();\n+                    getFragmentManager().popBackStack(getJsonApi().getStack().pop(), 0);\n                 }\n             }\n         }\n     }\n \n+    private boolean nextStepHasNoSkipLogic() {", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -450,11 +448,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n     }\n \n     private boolean nextStepHasNoSkipLogic() {\n-        Boolean nextStepHasNoRelevance = getJsonApi().stepSkipLogicPresenceMap().get(getJsonApi().nextStep());\n-        if (nextStepHasNoRelevance != null) {\n-            return nextStepHasNoRelevance;\n-        }\n-        return false;\n+        return stepHasNoSkipLogic(getJsonApi().nextStep());\n     }\n \n     public boolean stepHasNoSkipLogic(@Nullable String step) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MTMyMQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436341321", "bodyText": "what is the reason of changing the default from true", "author": "githengi", "createdAt": "2020-06-07T09:00:54Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -317,7 +348,7 @@ private void checkIfStepIsBlank(JSONObject formStep) {\n                 for (int i = 0; i < fields.length(); i++) {\n                     JSONObject field = fields.getJSONObject(i);\n                     if (field.has(JsonFormConstants.TYPE) && !JsonFormConstants.HIDDEN.equals(field.getString(JsonFormConstants.TYPE))) {\n-                        boolean isVisible = field.optBoolean(JsonFormConstants.IS_VISIBLE, true);\n+                        boolean isVisible = field.optBoolean(JsonFormConstants.IS_VISIBLE, false);", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ5Nzg5MQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436497891", "bodyText": "my mistake, let me revert it", "author": "bennsimon", "createdAt": "2020-06-08T07:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MTMyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -348,7 +346,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n                 for (int i = 0; i < fields.length(); i++) {\n                     JSONObject field = fields.getJSONObject(i);\n                     if (field.has(JsonFormConstants.TYPE) && !JsonFormConstants.HIDDEN.equals(field.getString(JsonFormConstants.TYPE))) {\n-                        boolean isVisible = field.optBoolean(JsonFormConstants.IS_VISIBLE, false);\n+                        boolean isVisible = field.optBoolean(JsonFormConstants.IS_VISIBLE, true);\n                         if (isVisible) {\n                             setShouldSkipStep(false);\n                             break;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MjQwMQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436342401", "bodyText": "why is this check added !stepHasNoSkipLogic(JsonFormConstants.STEP + i)", "author": "githengi", "createdAt": "2020-06-07T09:14:02Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -295,8 +326,8 @@ public void skipStepOnPreviousPressed() {\n                 JSONObject formStep = getJsonApi().getmJSONObject().optJSONObject(JsonFormConstants.STEP + i);\n                 if (formStep != null) {\n                     checkIfStepIsBlank(formStep);\n-                    if (shouldSkipStep()) {\n-                        getFragmentManager().popBackStack();\n+                    if (shouldSkipStep() && !stepHasNoSkipLogic(JsonFormConstants.STEP + i)) {", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ4NDcxNw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436484717", "bodyText": "The method checks if the previous step has fields with no skip logic, if it has then that step will not be skipped and vice versa", "author": "bennsimon", "createdAt": "2020-06-08T06:42:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0MjQwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -326,7 +323,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n                 JSONObject formStep = getJsonApi().getmJSONObject().optJSONObject(JsonFormConstants.STEP + i);\n                 if (formStep != null) {\n                     checkIfStepIsBlank(formStep);\n-                    if (shouldSkipStep() && !stepHasNoSkipLogic(JsonFormConstants.STEP + i)) {\n+                    if (shouldSkipStep()) {\n                         getFragmentManager().popBackStack(getJsonApi().getStack().pop(), 0);\n                     } else {\n                         break;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjM0Mjc5NA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/412#discussion_r436342794", "bodyText": "change to getJsonApi().getStack().size() =< 1 for readability", "author": "githengi", "createdAt": "2020-06-07T09:18:44Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java", "diffHunk": "@@ -241,7 +238,7 @@ public void updateVisibilityOfNextAndSave(boolean next, boolean save) {\n         }\n \n         if (getFragmentManager() != null) {\n-            if (getFragmentManager().getBackStackEntryCount() == 0) {\n+            if (getFragmentManager().getBackStackEntryCount() == 0 || getJsonApi().getStack().size() < 2) {", "originalCommit": "ca418c65263a84ac2b2c8727f67e633faa631eb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\nindex 81528ee6..66d13196 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/fragments/JsonWizardFormFragment.java\n\n@@ -238,7 +236,7 @@ public class JsonWizardFormFragment extends JsonFormFragment {\n         }\n \n         if (getFragmentManager() != null) {\n-            if (getFragmentManager().getBackStackEntryCount() == 0 || getJsonApi().getStack().size() < 2) {\n+            if (getFragmentManager().getBackStackEntryCount() == 0 || getJsonApi().getStack().size() <= 1) {\n                 previousButton.setVisibility(View.INVISIBLE);\n                 previousIcon.setVisibility(View.INVISIBLE);\n             } else {\n"}}, {"oid": "5a5a09f56c3323b887dd92637cfacc07d0823b3f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5a5a09f56c3323b887dd92637cfacc07d0823b3f", "message": "code cleanup", "committedDate": "2020-06-08T07:19:01Z", "type": "commit"}, {"oid": "6fad2c3c730272bfaef3972bc81c34169f649fef", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6fad2c3c730272bfaef3972bc81c34169f649fef", "message": "native radio fix", "committedDate": "2020-06-10T16:59:43Z", "type": "commit"}, {"oid": "c130412f26db0fa674918bb105cf957a15d008d0", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c130412f26db0fa674918bb105cf957a15d008d0", "message": "native radio btn fix, repeating group calculation fix", "committedDate": "2020-06-12T11:01:06Z", "type": "commit"}, {"oid": "a1481fce0fcf75a8f866f91b4870c8e22effd90c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a1481fce0fcf75a8f866f91b4870c8e22effd90c", "message": "add logic to check for stack entries", "committedDate": "2020-06-12T13:01:32Z", "type": "commit"}, {"oid": "9976a566a5cc3a2483da4cacdc4edcddab8ae7ed", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/9976a566a5cc3a2483da4cacdc4edcddab8ae7ed", "message": "code cleanup", "committedDate": "2020-06-12T14:11:32Z", "type": "commit"}, {"oid": "cd710be279f96fdf63f435309d77c298e20cf4ee", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/cd710be279f96fdf63f435309d77c298e20cf4ee", "message": "code cleanup", "committedDate": "2020-06-12T14:35:09Z", "type": "commit"}, {"oid": "63329b7b7d9cd3c3655bc8d8fc503b829d74331f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/63329b7b7d9cd3c3655bc8d8fc503b829d74331f", "message": "code cleanup", "committedDate": "2020-06-12T14:48:51Z", "type": "commit"}, {"oid": "7ceeab26abc980c3e84025e7d3758874a7b1585c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7ceeab26abc980c3e84025e7d3758874a7b1585c", "message": "code cleanup", "committedDate": "2020-06-12T15:02:07Z", "type": "commit"}, {"oid": "00a5c864eda3db8634704eb9f27662087aa34667", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/00a5c864eda3db8634704eb9f27662087aa34667", "message": "code cleanup", "committedDate": "2020-06-12T15:42:25Z", "type": "commit"}, {"oid": "38e86349e527c74ca17f1713100c5a47944a2c57", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/38e86349e527c74ca17f1713100c5a47944a2c57", "message": "make constraints and media logic executed only when isForNextStep false", "committedDate": "2020-06-15T09:59:06Z", "type": "commit"}, {"oid": "93fc418af9f6377caa85196429931f9536552142", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/93fc418af9f6377caa85196429931f9536552142", "message": "inline relevance fix", "committedDate": "2020-06-16T13:22:37Z", "type": "commit"}, {"oid": "30af5d9b142cff68924120ec31662d3c0796695f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/30af5d9b142cff68924120ec31662d3c0796695f", "message": "Popup Relevance fix\n\nexpnasion panel dialog fix", "committedDate": "2020-06-18T10:27:17Z", "type": "commit"}, {"oid": "b5e5cb4a551d471c6416e30a11e736af435fe634", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b5e5cb4a551d471c6416e30a11e736af435fe634", "message": "removed thread.sleep", "committedDate": "2020-06-19T07:31:27Z", "type": "commit"}, {"oid": "0ddffa5c94bc07073d98eb277d7f083568777965", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/0ddffa5c94bc07073d98eb277d7f083568777965", "message": "removed thread.sleep", "committedDate": "2020-06-19T07:31:44Z", "type": "commit"}, {"oid": "c1caa55c93dd9d56a85dc9670cc9743df29b4e15", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c1caa55c93dd9d56a85dc9670cc9743df29b4e15", "message": "add logic to skip first step inside a thread", "committedDate": "2020-06-22T08:01:41Z", "type": "commit"}, {"oid": "8d5a127a7d9a7ba0664cf8fea3d3322c509e93dd", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8d5a127a7d9a7ba0664cf8fea3d3322c509e93dd", "message": "fix validation for nativeEditTextFactory", "committedDate": "2020-06-26T10:22:01Z", "type": "commit"}, {"oid": "722ad85f86cea883031cf186cf6bec62ac248965", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/722ad85f86cea883031cf186cf6bec62ac248965", "message": "update visibility update to be done on ui thread", "committedDate": "2020-07-09T09:31:40Z", "type": "commit"}, {"oid": "8876745760a3c7b43e6b4f68673929b6a5e05816", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/8876745760a3c7b43e6b4f68673929b6a5e05816", "message": "update reference edit check on repeating group", "committedDate": "2020-07-09T09:47:33Z", "type": "commit"}, {"oid": "a2dab72236412127320fb38e77110759bedd643c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a2dab72236412127320fb38e77110759bedd643c", "message": "add buttonFactory click listener to commom listener and catch exception thrown by spannable class when loading large report-forms", "committedDate": "2020-07-13T09:42:44Z", "type": "commit"}, {"oid": "a4676e7a58e4f58c155cf8b423d3ca316ee6098a", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a4676e7a58e4f58c155cf8b423d3ca316ee6098a", "message": "add fix for datePickerFactory if value is set\n\nAdd validation for repeating grp", "committedDate": "2020-07-15T07:05:32Z", "type": "commit"}, {"oid": "ed219d3613f26522281483e7a024c6684d5d6ccb", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/ed219d3613f26522281483e7a024c6684d5d6ccb", "message": "fix repeating grp validation", "committedDate": "2020-07-15T08:11:57Z", "type": "commit"}, {"oid": "3650312a99d0b6c04504cbd0c4954be1c715f21c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/3650312a99d0b6c04504cbd0c4954be1c715f21c", "message": "fix looper error\n\nclean up rules engine factory\n\nUpdate repeating group validation to work when after form traversal (back step)", "committedDate": "2020-07-20T13:17:14Z", "type": "commit"}, {"oid": "e52ad108f73bdb86864d35886188d2d170cdfd00", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/e52ad108f73bdb86864d35886188d2d170cdfd00", "message": "Merge branch 'optimize-native-forms' of github.com:OpenSRP/opensrp-client-native-form into skip-step-fix", "committedDate": "2020-07-23T12:04:57Z", "type": "commit"}, {"oid": "ced5aebf7bff50cd31f88cbc42ff6ba1000bd988", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/ced5aebf7bff50cd31f88cbc42ff6ba1000bd988", "message": "fix codacy issues", "committedDate": "2020-07-23T12:23:40Z", "type": "commit"}, {"oid": "c34f9aa0148644e4fc2794acb0219275e0fa0921", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c34f9aa0148644e4fc2794acb0219275e0fa0921", "message": "fix codacy issue", "committedDate": "2020-07-23T12:38:44Z", "type": "commit"}, {"oid": "717c36ca741b0e3a2d30de1690a2c08e2149fc71", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/717c36ca741b0e3a2d30de1690a2c08e2149fc71", "message": "fix tests", "committedDate": "2020-07-27T08:08:50Z", "type": "commit"}, {"oid": "a7120bc9a4f95a63e979b084ba47bc0fbea5e9b7", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a7120bc9a4f95a63e979b084ba47bc0fbea5e9b7", "message": "remove hidden fields validation\n\nadd refreshExpansionPanel to background thread", "committedDate": "2020-08-04T07:11:00Z", "type": "commit"}, {"oid": "c13009962f6dabf0f9f960cefd24bfab750d9dc5", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c13009962f6dabf0f9f960cefd24bfab750d9dc5", "message": "fix codacy issuess", "committedDate": "2020-08-04T08:34:53Z", "type": "commit"}]}