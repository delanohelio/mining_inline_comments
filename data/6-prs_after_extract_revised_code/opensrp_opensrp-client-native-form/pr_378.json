{"pr_number": 378, "pr_title": "add disabling and hiding feature for views on form load", "pr_createdAt": "2020-03-03T11:55:39Z", "pr_url": "https://github.com/opensrp/opensrp-client-native-form/pull/378", "timeline": [{"oid": "1a1906440e0999eaf250180e4669918f0f088610", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/1a1906440e0999eaf250180e4669918f0f088610", "message": "add disabling and hiding feature for views on form load", "committedDate": "2020-03-03T11:54:41Z", "type": "commit"}, {"oid": "5cf761c47cebbc070164677667658586380b73e4", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/5cf761c47cebbc070164677667658586380b73e4", "message": "code re-arrangment", "committedDate": "2020-03-03T12:22:35Z", "type": "commit"}, {"oid": "875424f0be9ef4d044edd49a0955662b82cd64e8", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/875424f0be9ef4d044edd49a0955662b82cd64e8", "message": "code re-arrangment", "committedDate": "2020-03-03T13:58:12Z", "type": "commit"}, {"oid": "50fe0c2e71863389c18a1db6b2f40ace0e196b48", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/50fe0c2e71863389c18a1db6b2f40ace0e196b48", "message": "code cleanup", "committedDate": "2020-03-03T14:00:39Z", "type": "commit"}, {"oid": "50b494259c9798b78eff45ada2d13a50260cd38c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/50b494259c9798b78eff45ada2d13a50260cd38c", "message": "code cleanup", "committedDate": "2020-03-03T14:01:24Z", "type": "commit"}, {"oid": "79e31be8b12f7cf0efc17e3fa54cafdc9c1cb233", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/79e31be8b12f7cf0efc17e3fa54cafdc9c1cb233", "message": "code cleanup", "committedDate": "2020-03-03T14:30:34Z", "type": "commit"}, {"oid": "f884b037d2ace91ce054144b466b1a5f0a1f201d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/f884b037d2ace91ce054144b466b1a5f0a1f201d", "message": "fix override", "committedDate": "2020-03-04T08:21:19Z", "type": "commit"}, {"oid": "a49d572c591c9fd2f46b8b434b609fdf1e6db2b8", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/a49d572c591c9fd2f46b8b434b609fdf1e6db2b8", "message": "fix condition", "committedDate": "2020-03-05T14:33:55Z", "type": "commit"}, {"oid": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "message": "Merge branch 'master' into add-disable-hide-feature-on-forms", "committedDate": "2020-03-05T14:40:22Z", "type": "commit"}, {"oid": "59f83ec381a9798602df9a2bc5bb020f4151f76f", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/59f83ec381a9798602df9a2bc5bb020f4151f76f", "message": "update snapshot version", "committedDate": "2020-03-06T12:58:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxNjI2OA==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391516268", "bodyText": "Consider using this com.vijay.jsonwizard.utils.FormUtils#getMultiStepFormFields method to get all the form fields.", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:08:04Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -540,7 +540,24 @@ public JSONObject getmJSONObject() {\n \n     @Override\n     public void setmJSONObject(JSONObject mJSONObject) {\n-        this.mJSONObject = mJSONObject;\n+        super.setmJSONObject(mJSONObject);\n+    }\n+\n+    @Override\n+    protected void initiateFormUpdate(JSONObject json) {\n+        if (getForm() != null && ((getForm().getHiddenFields() != null && !getForm().getHiddenFields().isEmpty()) || (getForm().getDisabledFields() != null && !getForm().getDisabledFields().isEmpty()))) {\n+            String strCount = json.optString(JsonFormConstants.COUNT);\n+            if (StringUtils.isNotBlank(strCount)) {\n+                int count = Integer.parseInt(strCount);\n+                for (int i = 1; i <= count; i++) {\n+                    JSONObject ithStepObject = json.optJSONObject(JsonFormConstants.STEP + i);\n+                    JSONArray fieldsJsonObject = ithStepObject.optJSONArray(JsonFormConstants.FIELDS);", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\nindex 354caab1..1780a708 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n\n@@ -546,20 +546,14 @@ public class JsonFormActivity extends JsonFormBaseActivity implements JsonApi {\n     @Override\n     protected void initiateFormUpdate(JSONObject json) {\n         if (getForm() != null && ((getForm().getHiddenFields() != null && !getForm().getHiddenFields().isEmpty()) || (getForm().getDisabledFields() != null && !getForm().getDisabledFields().isEmpty()))) {\n-            String strCount = json.optString(JsonFormConstants.COUNT);\n-            if (StringUtils.isNotBlank(strCount)) {\n-                int count = Integer.parseInt(strCount);\n-                for (int i = 1; i <= count; i++) {\n-                    JSONObject ithStepObject = json.optJSONObject(JsonFormConstants.STEP + i);\n-                    JSONArray fieldsJsonObject = ithStepObject.optJSONArray(JsonFormConstants.FIELDS);\n-                    for (int k = 0; k < fieldsJsonObject.length(); k++) {\n-                        Utils.handleFieldBehaviour(fieldsJsonObject.optJSONObject(k), getForm());\n-                    }\n-                }\n+            JSONArray fieldsJsonObject = FormUtils.getMultiStepFormFields(json);\n+            for (int k = 0; k < fieldsJsonObject.length(); k++) {\n+                Utils.handleFieldBehaviour(fieldsJsonObject.optJSONObject(k), getForm());\n             }\n         }\n     }\n \n+\n     @Override\n     public void updateGenericPopupSecondaryValues(JSONArray jsonArray) {\n         setExtraFieldsWithValues(jsonArray);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxOTIxMw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391519213", "bodyText": "This implementations are not needed since whatever they are returning is already a public static method in the Utils", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:13:42Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java", "diffHunk": "@@ -623,6 +640,21 @@ public boolean skipBlankSteps() {\n         }\n     }\n \n+    @Override\n+    public void makeFieldHidden(JSONObject fieldObject) {\n+        Utils.makeFieldHidden(fieldObject);\n+    }\n+\n+    @Override\n+    public void makeFieldDisabled(JSONObject fieldObject) {\n+        Utils.makeFieldDisabled(fieldObject);\n+    }", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\nindex 354caab1..1780a708 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormActivity.java\n\n@@ -640,16 +634,6 @@ public class JsonFormActivity extends JsonFormBaseActivity implements JsonApi {\n         }\n     }\n \n-    @Override\n-    public void makeFieldHidden(JSONObject fieldObject) {\n-        Utils.makeFieldHidden(fieldObject);\n-    }\n-\n-    @Override\n-    public void makeFieldDisabled(JSONObject fieldObject) {\n-        Utils.makeFieldDisabled(fieldObject);\n-    }\n-\n     @Override\n     public Form form() {\n         return getForm();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyMTY4Mw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391521683", "bodyText": "This initialization can be inline.", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:18:03Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java", "diffHunk": "@@ -84,7 +84,8 @@ protected void onCreate(Bundle savedInstanceState) {\n \n     public void init(String json) {\n         try {\n-            setmJSONObject(new JSONObject(json));\n+            JSONObject formObject = new JSONObject(json);", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\nindex bc89f5bc..4351ce1b 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\n\n@@ -84,9 +84,8 @@ abstract class JsonFormBaseActivity extends MultiLanguageActivity implements OnF\n \n     public void init(String json) {\n         try {\n-            JSONObject formObject = new JSONObject(json);\n-            setmJSONObject(formObject);\n-            if (!mJSONObject.has(\"encounter_type\")) {\n+            setmJSONObject(new JSONObject(json));\n+            if (!mJSONObject.has(JsonFormConstants.ENCOUNTER_TYPE)) {\n                 mJSONObject = new JSONObject();\n                 throw new JSONException(\"Form encounter_type not set\");\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyMjIyMw==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391522223", "bodyText": "move encounter_type to a constants file", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:18:59Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java", "diffHunk": "@@ -84,7 +84,8 @@ protected void onCreate(Bundle savedInstanceState) {\n \n     public void init(String json) {\n         try {\n-            setmJSONObject(new JSONObject(json));\n+            JSONObject formObject = new JSONObject(json);\n+            setmJSONObject(formObject);", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\nindex bc89f5bc..4351ce1b 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/activities/JsonFormBaseActivity.java\n\n@@ -84,9 +84,8 @@ abstract class JsonFormBaseActivity extends MultiLanguageActivity implements OnF\n \n     public void init(String json) {\n         try {\n-            JSONObject formObject = new JSONObject(json);\n-            setmJSONObject(formObject);\n-            if (!mJSONObject.has(\"encounter_type\")) {\n+            setmJSONObject(new JSONObject(json));\n+            if (!mJSONObject.has(JsonFormConstants.ENCOUNTER_TYPE)) {\n                 mJSONObject = new JSONObject();\n                 throw new JSONException(\"Form encounter_type not set\");\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyMjczOQ==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391522739", "bodyText": "Please add java docs for public methods.", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:19:58Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java", "diffHunk": "@@ -285,156 +284,42 @@ public static void resetRadioButtonsSpecifyText(RadioButton button) throws JSONE\n \n     }\n \n-    public List<String> createExpansionPanelChildren(JSONArray jsonArray) throws JSONException {\n-        List<String> stringList = new ArrayList<>();\n-        String label;\n-        for (int i = 0; i < jsonArray.length(); i++) {\n-            if (!jsonArray.isNull(i)) {\n-                JSONObject jsonObject = jsonArray.getJSONObject(i);\n-                if (jsonObject.has(JsonFormConstants.VALUES) && jsonObject.has(JsonFormConstants.LABEL) &&\n-                        !\"\".equals(jsonObject.getString(JsonFormConstants.LABEL))) {\n-                    //Get label and replace any colon in some labels. Not needed at this point\n-                    label = jsonObject.getString(JsonFormConstants.LABEL).replace(\":\", \"\");\n-                    stringList.add(label + \":\" + getStringValue(jsonObject));\n-                }\n-            }\n+    public static void updateSubFormFields(JSONObject subForm, Form form) {\n+        for (int i = 0; i < subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).length(); i++) {\n+            handleFieldBehaviour(subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).optJSONObject(i), form);\n         }\n-\n-        return stringList;\n     }\n \n-    private String getStringValue(JSONObject jsonObject) throws JSONException {\n-        StringBuilder value = new StringBuilder();\n-        if (jsonObject != null) {\n-            JSONArray jsonArray = jsonObject.getJSONArray(JsonFormConstants.VALUES);\n-            for (int i = 0; i < jsonArray.length(); i++) {\n-                String stringValue = jsonArray.getString(i);\n-                value.append(getValueFromSecondaryValues(stringValue));\n-                value.append(\", \");\n-            }\n-        }\n+    public static void handleFieldBehaviour(JSONObject fieldObject, Form form) {\n+        String key = fieldObject.optString(JsonFormConstants.KEY);\n \n-        return value.toString().replaceAll(\", $\", \"\");\n-    }\n-\n-    private String getValueFromSecondaryValues(String itemString) {\n-        String[] strings = itemString.split(\":\");\n-        return strings.length > 1 ? strings[1] : strings[0];\n-    }\n-\n-    protected String getKey(JSONObject object) throws JSONException {\n-        return object.has(RuleConstant.IS_RULE_CHECK) && object.getBoolean(RuleConstant.IS_RULE_CHECK) ?\n-                object.get(RuleConstant.STEP) + \"_\" + object.get(JsonFormConstants.KEY) : JsonFormConstants.VALUE;\n-    }\n-\n-    protected Object getValue(JSONObject object) throws JSONException {\n-        Object value;\n-\n-        if (object.has(JsonFormConstants.VALUE)) {\n-\n-            value = object.opt(JsonFormConstants.VALUE);\n-\n-            if (isNumberWidget(object)) {\n-                value = TextUtils.isEmpty(object.optString(JsonFormConstants.VALUE)) ? 0 :\n-                        processNumberValues(object.optString(JsonFormConstants.VALUE));\n-            } else if (value != null && !TextUtils.isEmpty(object.getString(JsonFormConstants.VALUE)) &&\n-                    canHaveNumber(object)) {\n-                value = processNumberValues(value);\n-            }\n-\n-        } else {\n-            value = isNumberWidget(object) ? 0 : \"\";\n+        if (form != null && form.getHiddenFields() != null && form.getHiddenFields().contains(key)) {\n+            makeFieldHidden(fieldObject);\n         }\n \n-        return value;\n-    }\n-\n-    protected boolean isNumberWidget(JSONObject object) throws JSONException {\n-        return object.has(JsonFormConstants.EDIT_TYPE) &&\n-                object.getString(JsonFormConstants.EDIT_TYPE).equals(JsonFormConstants.EDIT_TEXT_TYPE.NUMBER) ||\n-                object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.NUMBER_SELECTOR);\n-    }\n-\n-    protected Object processNumberValues(Object object) {\n-        Object jsonObject = object;\n-        try {\n-            if (jsonObject.toString().contains(\".\")) {\n-                jsonObject = String.valueOf((float) Math.round(Float.valueOf(jsonObject.toString()) * 100) / 100);\n-            } else {\n-                jsonObject = Integer.valueOf(jsonObject.toString());\n-            }\n-        } catch (NumberFormatException e) {\n-            //Log.e(TAG, \"Error trying to convert \" + object + \" to a number \", e);\n+        if (form != null && form.getDisabledFields() != null && form.getDisabledFields().contains(key)) {\n+            makeFieldDisabled(fieldObject);\n         }\n-        return jsonObject;\n-    }\n \n-    protected boolean canHaveNumber(JSONObject object) throws JSONException {\n-        return isNumberWidget(object) || object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.HIDDEN) ||\n-                object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.SPINNER);\n     }\n \n-    public void setChildKey(View view, String type, ExpansionPanelGenericPopupDialog genericPopupDialog) {\n-        String childKey;\n-        if (type != null && (type.equals(JsonFormConstants.CHECK_BOX) || type.equals(JsonFormConstants.NATIVE_RADIO_BUTTON) || type.equals(JsonFormConstants.EXTENDED_RADIO_BUTTON))) {\n-            childKey = (String) view.getTag(com.vijay.jsonwizard.R.id.childKey);\n-            genericPopupDialog.setChildKey(childKey);\n-        }\n-    }\n-\n-    public void setExpansionPanelDetails(String type, String toolbarHeader, String container, ExpansionPanelGenericPopupDialog genericPopupDialog) {\n-        if (type != null && type.equals(JsonFormConstants.EXPANSION_PANEL)) {\n-            genericPopupDialog.setHeader(toolbarHeader);\n-            genericPopupDialog.setContainer(container);\n+    public static void makeFieldDisabled(JSONObject fieldObject) {", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\nindex e6a27412..aa446e4f 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\n\n@@ -284,42 +283,6 @@ public class Utils {\n \n     }\n \n-    public static void updateSubFormFields(JSONObject subForm, Form form) {\n-        for (int i = 0; i < subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).length(); i++) {\n-            handleFieldBehaviour(subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).optJSONObject(i), form);\n-        }\n-    }\n-\n-    public static void handleFieldBehaviour(JSONObject fieldObject, Form form) {\n-        String key = fieldObject.optString(JsonFormConstants.KEY);\n-\n-        if (form != null && form.getHiddenFields() != null && form.getHiddenFields().contains(key)) {\n-            makeFieldHidden(fieldObject);\n-        }\n-\n-        if (form != null && form.getDisabledFields() != null && form.getDisabledFields().contains(key)) {\n-            makeFieldDisabled(fieldObject);\n-        }\n-\n-    }\n-\n-    public static void makeFieldDisabled(JSONObject fieldObject) {\n-        try {\n-            makeFieldHidden(fieldObject);\n-            fieldObject.put(JsonFormConstants.DISABLED, true);\n-        } catch (JSONException e) {\n-            Timber.e(e);\n-        }\n-    }\n-\n-    public static void makeFieldHidden(JSONObject fieldObject) {\n-        try {\n-            fieldObject.put(JsonFormConstants.TYPE, JsonFormConstants.HIDDEN);\n-        } catch (JSONException e) {\n-            Timber.e(e);\n-        }\n-    }\n-\n     @NonNull\n     private static String cleanToken(String conditionTokenRaw) {\n         String conditionToken = conditionTokenRaw.trim();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyMjkzMg==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391522932", "bodyText": "Please add java docs for public methods.", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:20:19Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java", "diffHunk": "@@ -285,156 +284,42 @@ public static void resetRadioButtonsSpecifyText(RadioButton button) throws JSONE\n \n     }\n \n-    public List<String> createExpansionPanelChildren(JSONArray jsonArray) throws JSONException {\n-        List<String> stringList = new ArrayList<>();\n-        String label;\n-        for (int i = 0; i < jsonArray.length(); i++) {\n-            if (!jsonArray.isNull(i)) {\n-                JSONObject jsonObject = jsonArray.getJSONObject(i);\n-                if (jsonObject.has(JsonFormConstants.VALUES) && jsonObject.has(JsonFormConstants.LABEL) &&\n-                        !\"\".equals(jsonObject.getString(JsonFormConstants.LABEL))) {\n-                    //Get label and replace any colon in some labels. Not needed at this point\n-                    label = jsonObject.getString(JsonFormConstants.LABEL).replace(\":\", \"\");\n-                    stringList.add(label + \":\" + getStringValue(jsonObject));\n-                }\n-            }\n+    public static void updateSubFormFields(JSONObject subForm, Form form) {\n+        for (int i = 0; i < subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).length(); i++) {\n+            handleFieldBehaviour(subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).optJSONObject(i), form);\n         }\n-\n-        return stringList;\n     }\n \n-    private String getStringValue(JSONObject jsonObject) throws JSONException {\n-        StringBuilder value = new StringBuilder();\n-        if (jsonObject != null) {\n-            JSONArray jsonArray = jsonObject.getJSONArray(JsonFormConstants.VALUES);\n-            for (int i = 0; i < jsonArray.length(); i++) {\n-                String stringValue = jsonArray.getString(i);\n-                value.append(getValueFromSecondaryValues(stringValue));\n-                value.append(\", \");\n-            }\n-        }\n+    public static void handleFieldBehaviour(JSONObject fieldObject, Form form) {\n+        String key = fieldObject.optString(JsonFormConstants.KEY);\n \n-        return value.toString().replaceAll(\", $\", \"\");\n-    }\n-\n-    private String getValueFromSecondaryValues(String itemString) {\n-        String[] strings = itemString.split(\":\");\n-        return strings.length > 1 ? strings[1] : strings[0];\n-    }\n-\n-    protected String getKey(JSONObject object) throws JSONException {\n-        return object.has(RuleConstant.IS_RULE_CHECK) && object.getBoolean(RuleConstant.IS_RULE_CHECK) ?\n-                object.get(RuleConstant.STEP) + \"_\" + object.get(JsonFormConstants.KEY) : JsonFormConstants.VALUE;\n-    }\n-\n-    protected Object getValue(JSONObject object) throws JSONException {\n-        Object value;\n-\n-        if (object.has(JsonFormConstants.VALUE)) {\n-\n-            value = object.opt(JsonFormConstants.VALUE);\n-\n-            if (isNumberWidget(object)) {\n-                value = TextUtils.isEmpty(object.optString(JsonFormConstants.VALUE)) ? 0 :\n-                        processNumberValues(object.optString(JsonFormConstants.VALUE));\n-            } else if (value != null && !TextUtils.isEmpty(object.getString(JsonFormConstants.VALUE)) &&\n-                    canHaveNumber(object)) {\n-                value = processNumberValues(value);\n-            }\n-\n-        } else {\n-            value = isNumberWidget(object) ? 0 : \"\";\n+        if (form != null && form.getHiddenFields() != null && form.getHiddenFields().contains(key)) {\n+            makeFieldHidden(fieldObject);\n         }\n \n-        return value;\n-    }\n-\n-    protected boolean isNumberWidget(JSONObject object) throws JSONException {\n-        return object.has(JsonFormConstants.EDIT_TYPE) &&\n-                object.getString(JsonFormConstants.EDIT_TYPE).equals(JsonFormConstants.EDIT_TEXT_TYPE.NUMBER) ||\n-                object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.NUMBER_SELECTOR);\n-    }\n-\n-    protected Object processNumberValues(Object object) {\n-        Object jsonObject = object;\n-        try {\n-            if (jsonObject.toString().contains(\".\")) {\n-                jsonObject = String.valueOf((float) Math.round(Float.valueOf(jsonObject.toString()) * 100) / 100);\n-            } else {\n-                jsonObject = Integer.valueOf(jsonObject.toString());\n-            }\n-        } catch (NumberFormatException e) {\n-            //Log.e(TAG, \"Error trying to convert \" + object + \" to a number \", e);\n+        if (form != null && form.getDisabledFields() != null && form.getDisabledFields().contains(key)) {\n+            makeFieldDisabled(fieldObject);\n         }\n-        return jsonObject;\n-    }\n \n-    protected boolean canHaveNumber(JSONObject object) throws JSONException {\n-        return isNumberWidget(object) || object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.HIDDEN) ||\n-                object.getString(JsonFormConstants.TYPE).equals(JsonFormConstants.SPINNER);\n     }\n \n-    public void setChildKey(View view, String type, ExpansionPanelGenericPopupDialog genericPopupDialog) {\n-        String childKey;\n-        if (type != null && (type.equals(JsonFormConstants.CHECK_BOX) || type.equals(JsonFormConstants.NATIVE_RADIO_BUTTON) || type.equals(JsonFormConstants.EXTENDED_RADIO_BUTTON))) {\n-            childKey = (String) view.getTag(com.vijay.jsonwizard.R.id.childKey);\n-            genericPopupDialog.setChildKey(childKey);\n-        }\n-    }\n-\n-    public void setExpansionPanelDetails(String type, String toolbarHeader, String container, ExpansionPanelGenericPopupDialog genericPopupDialog) {\n-        if (type != null && type.equals(JsonFormConstants.EXPANSION_PANEL)) {\n-            genericPopupDialog.setHeader(toolbarHeader);\n-            genericPopupDialog.setContainer(container);\n+    public static void makeFieldDisabled(JSONObject fieldObject) {\n+        try {\n+            makeFieldHidden(fieldObject);\n+            fieldObject.put(JsonFormConstants.DISABLED, true);\n+        } catch (JSONException e) {\n+            Timber.e(e);\n         }\n     }\n \n-    /**\n-     * Gets the {@link android.support.v4.app.FragmentTransaction} from the {@link Context} and removes any {@link android.support.v4.app.Fragment} with the tag `GenericPopup` from the transaction.\n-     * Then nullifies the stack by calling {@link android.support.v4.app.FragmentTransaction#addToBackStack(String)} with a null value.\n-     *\n-     * @param context {@link Activity} The activity context where this transaction called from\n-     * @return fragmentTransaction {@link android.support.v4.app.FragmentTransaction}\n-     */\n-    @NotNull\n-    public FragmentTransaction getFragmentTransaction(Activity context) {\n-        FragmentTransaction fragmentTransaction = context.getFragmentManager().beginTransaction();\n-        Fragment fragment = context.getFragmentManager().findFragmentByTag(\"GenericPopup\");\n-        if (fragment != null) {\n-            fragmentTransaction.remove(fragment);\n+    public static void makeFieldHidden(JSONObject fieldObject) {", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\nindex e6a27412..aa446e4f 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/utils/Utils.java\n\n@@ -284,42 +283,6 @@ public class Utils {\n \n     }\n \n-    public static void updateSubFormFields(JSONObject subForm, Form form) {\n-        for (int i = 0; i < subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).length(); i++) {\n-            handleFieldBehaviour(subForm.optJSONArray(JsonFormConstants.CONTENT_FORM).optJSONObject(i), form);\n-        }\n-    }\n-\n-    public static void handleFieldBehaviour(JSONObject fieldObject, Form form) {\n-        String key = fieldObject.optString(JsonFormConstants.KEY);\n-\n-        if (form != null && form.getHiddenFields() != null && form.getHiddenFields().contains(key)) {\n-            makeFieldHidden(fieldObject);\n-        }\n-\n-        if (form != null && form.getDisabledFields() != null && form.getDisabledFields().contains(key)) {\n-            makeFieldDisabled(fieldObject);\n-        }\n-\n-    }\n-\n-    public static void makeFieldDisabled(JSONObject fieldObject) {\n-        try {\n-            makeFieldHidden(fieldObject);\n-            fieldObject.put(JsonFormConstants.DISABLED, true);\n-        } catch (JSONException e) {\n-            Timber.e(e);\n-        }\n-    }\n-\n-    public static void makeFieldHidden(JSONObject fieldObject) {\n-        try {\n-            fieldObject.put(JsonFormConstants.TYPE, JsonFormConstants.HIDDEN);\n-        } catch (JSONException e) {\n-            Timber.e(e);\n-        }\n-    }\n-\n     @NonNull\n     private static String cleanToken(String conditionTokenRaw) {\n         String conditionToken = conditionTokenRaw.trim();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUyNTc3Ng==", "url": "https://github.com/opensrp/opensrp-client-native-form/pull/378#discussion_r391525776", "bodyText": "This are not required since their implementations are returning values of public static methods in a utils class", "author": "dubdabasoduba", "createdAt": "2020-03-12T10:25:22Z", "path": "android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interfaces/JsonApi.java", "diffHunk": "@@ -119,4 +120,10 @@ void addOnActivityRequestPermissionResultListener(Integer requestCode,\n     boolean isPreviousPressed();\n \n     void setPreviousPressed(boolean previousPressed);\n+\n+    void makeFieldHidden(JSONObject fieldObject);\n+\n+    void makeFieldDisabled(JSONObject fieldObject);", "originalCommit": "b69b6c458cf2eeb1bcbf0e693c31e179b90d8c65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "chunk": "diff --git a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interfaces/JsonApi.java b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interfaces/JsonApi.java\nindex 743d1519..b9e30c26 100644\n--- a/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interfaces/JsonApi.java\n+++ b/android-json-form-wizard/src/main/java/com/vijay/jsonwizard/interfaces/JsonApi.java\n\n@@ -121,9 +121,5 @@ public interface JsonApi {\n \n     void setPreviousPressed(boolean previousPressed);\n \n-    void makeFieldHidden(JSONObject fieldObject);\n-\n-    void makeFieldDisabled(JSONObject fieldObject);\n-\n     Form form();\n }\n"}}, {"oid": "6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/6e0803890a58eb5e7b11edcbd5f52525bcb710a9", "message": "code cleanup", "committedDate": "2020-03-13T14:11:35Z", "type": "commit"}, {"oid": "c2a2e9098bc68a5cbebec63904c1b16bb05ee8c9", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/c2a2e9098bc68a5cbebec63904c1b16bb05ee8c9", "message": "Merge branch 'add-disable-hide-feature-on-forms' of github.com:OpenSRP/opensrp-client-native-form into add-disable-hide-feature-on-forms", "committedDate": "2020-03-13T14:12:16Z", "type": "commit"}, {"oid": "de7c60cee5c51c06ea5162c1f839afc2eafdd43c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/de7c60cee5c51c06ea5162c1f839afc2eafdd43c", "message": "Merge branch 'master' of github.com:OpenSRP/opensrp-client-native-form into add-disable-hide-feature-on-forms", "committedDate": "2020-03-13T14:39:56Z", "type": "commit"}, {"oid": "965dabbea4d44c3a040061f2816fc211b4ae836c", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/965dabbea4d44c3a040061f2816fc211b4ae836c", "message": "fix conflicts", "committedDate": "2020-03-16T06:32:03Z", "type": "commit"}, {"oid": "73e9f197e56a17b41e7851b2a09c7158f681c249", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/73e9f197e56a17b41e7851b2a09c7158f681c249", "message": "move form config methods to native forms", "committedDate": "2020-03-16T07:11:53Z", "type": "commit"}, {"oid": "2937dd2962f04fddfe5da401747235272bf01a4d", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/2937dd2962f04fddfe5da401747235272bf01a4d", "message": "add test for form config methods", "committedDate": "2020-03-16T07:29:06Z", "type": "commit"}, {"oid": "7b4c34e15da71350dd0de1d68dca3cd629190ed5", "url": "https://github.com/opensrp/opensrp-client-native-form/commit/7b4c34e15da71350dd0de1d68dca3cd629190ed5", "message": "bump snapshot version", "committedDate": "2020-03-17T06:55:24Z", "type": "commit"}]}