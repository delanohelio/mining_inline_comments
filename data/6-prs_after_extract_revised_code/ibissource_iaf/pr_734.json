{"pr_number": 734, "pr_title": "set error before call flushBuffer method", "pr_createdAt": "2020-05-19T14:10:20Z", "pr_url": "https://github.com/ibissource/iaf/pull/734", "timeline": [{"oid": "8ffc45d0eb52209377b93aa706c0d7c802edf2c0", "url": "https://github.com/ibissource/iaf/commit/8ffc45d0eb52209377b93aa706c0d7c802edf2c0", "message": "set error before flushBuffer", "committedDate": "2020-05-19T14:09:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwNDI4Nw==", "url": "https://github.com/ibissource/iaf/pull/734#discussion_r427504287", "bodyText": "I think respose.reset(); should be called instead of flushBuffer, as you want to purge everything and throw the exeption (see log warning on line 501).", "author": "nielsm5", "createdAt": "2020-05-19T18:14:31Z", "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java", "diffHunk": "@@ -500,8 +500,8 @@ else if(segment.startsWith(\"{\") && segment.endsWith(\"}\")) {\n \t\tcatch (Exception e) {\n \t\t\tlog.warn(\"ApiListenerServlet caught exception, will rethrow as ServletException\", e);\n \t\t\ttry {\n-\t\t\t\tresponse.flushBuffer();", "originalCommit": "8ffc45d0eb52209377b93aa706c0d7c802edf2c0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f7bccd547378b4aff3dcb404859ab9ee6687ad5", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java b/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java\nindex 86d009a17..61f01525b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java\n+++ b/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java\n\n@@ -500,8 +500,8 @@ public class ApiListenerServlet extends HttpServletBase {\n \t\tcatch (Exception e) {\n \t\t\tlog.warn(\"ApiListenerServlet caught exception, will rethrow as ServletException\", e);\n \t\t\ttry {\n+\t\t\t\tresponse.reset();\n \t\t\t\tresponse.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, e.getMessage());\n-\t\t\t\tresponse.flushBuffer();\n \t\t\t}\n \t\t\tcatch (IllegalStateException ex) {\n \t\t\t\t//We're only informing the end user(s), no need to catch this error...\n"}}, {"oid": "7f7bccd547378b4aff3dcb404859ab9ee6687ad5", "url": "https://github.com/ibissource/iaf/commit/7f7bccd547378b4aff3dcb404859ab9ee6687ad5", "message": "Reset buffer and throw exception", "committedDate": "2020-05-20T16:23:45Z", "type": "commit"}]}