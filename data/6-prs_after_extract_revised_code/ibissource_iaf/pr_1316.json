{"pr_number": 1316, "pr_title": "Fix #1266 Set Retry flag also when retried from queue + reorder IbisDoc", "pr_createdAt": "2020-12-04T10:55:28Z", "pr_url": "https://github.com/ibissource/iaf/pull/1316", "timeline": [{"oid": "7030d3d7af84296a73bce1c27b6ffcc77f251705", "url": "https://github.com/ibissource/iaf/commit/7030d3d7af84296a73bce1c27b6ffcc77f251705", "message": "Reorder Receiver IbisDoc", "committedDate": "2020-12-04T10:54:58Z", "type": "commit"}, {"oid": "122973d5f8c7e8b666511abffeab83c6c998577a", "url": "https://github.com/ibissource/iaf/commit/122973d5f8c7e8b666511abffeab83c6c998577a", "message": "Add retry flag also in case of redelivery", "committedDate": "2020-12-04T14:05:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc4ODAzMg==", "url": "https://github.com/ibissource/iaf/pull/1316#discussion_r537788032", "bodyText": "Ik weet niet precies waar dit uitgelezen wordt, maar aangezien we het nu meerdere malen aan het gebruiken zijn, kan hier een constante van gemaakt worden?", "author": "nielsm5", "createdAt": "2020-12-07T19:53:20Z", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1391,7 +1394,9 @@ private synchronized ProcessResultCacheItem getCachedProcessResult(String messag\n \t */\n \t@SuppressWarnings(\"unchecked\")\n \tprivate boolean hasProblematicHistory(String messageId, boolean manualRetry, Object rawMessageOrWrapper, Message message, Map<String,Object>threadContext, String correlationId) throws ListenerException {\n-\t\tif (!manualRetry) {\n+\t\tif (manualRetry) {\n+\t\t\tthreadContext.put(\"retry\", \"true\");", "originalCommit": "122973d5f8c7e8b666511abffeab83c6c998577a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9637c7edd626f23d0c3e630dcd725b1f4e1ccb29", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java b/core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java\nindex 25dae834a..18f26d891 100644\n--- a/core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java\n+++ b/core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java\n\n@@ -1395,7 +1396,7 @@ public class Receiver<M> implements IManagable, IReceiverStatistics, IMessageHan\n \t@SuppressWarnings(\"unchecked\")\n \tprivate boolean hasProblematicHistory(String messageId, boolean manualRetry, Object rawMessageOrWrapper, Message message, Map<String,Object>threadContext, String correlationId) throws ListenerException {\n \t\tif (manualRetry) {\n-\t\t\tthreadContext.put(\"retry\", \"true\");\n+\t\t\tthreadContext.put(RETRY_FLAG_SESSION_KEY, \"true\");\n \t\t} else {\n \t\t\tIListener<M> origin = getListener(); // N.B. listener is not used when manualRetry==true\n \t\t\tif (log.isDebugEnabled()) log.debug(getLogPrefix()+\"checking try count for messageId [\"+messageId+\"]\");\n"}}, {"oid": "9637c7edd626f23d0c3e630dcd725b1f4e1ccb29", "url": "https://github.com/ibissource/iaf/commit/9637c7edd626f23d0c3e630dcd725b1f4e1ccb29", "message": "Use a constant for retry flag session key", "committedDate": "2020-12-08T07:32:28Z", "type": "commit"}]}