{"pr_number": 377, "pr_title": "Add ims sender", "pr_createdAt": "2020-01-22T10:34:57Z", "pr_url": "https://github.com/ibissource/iaf/pull/377", "timeline": [{"oid": "27c00f78eaea4c1e18fe6337e81e1f81b26e84d1", "url": "https://github.com/ibissource/iaf/commit/27c00f78eaea4c1e18fe6337e81e1f81b26e84d1", "message": "Change JMS createMessage-method to return Message superinterface instead of TextMessage", "committedDate": "2020-01-22T09:10:17Z", "type": "commit"}, {"oid": "181440cbc8c2aa194c7e0c013d21b3ccbabdd4c2", "url": "https://github.com/ibissource/iaf/commit/181440cbc8c2aa194c7e0c013d21b3ccbabdd4c2", "message": "Move setting the correlationID to separate method for easier overriding of the createMessage method", "committedDate": "2020-01-22T09:20:06Z", "type": "commit"}, {"oid": "4ed733dd6c096fd0a9982cebbaab80c362ae7320", "url": "https://github.com/ibissource/iaf/commit/4ed733dd6c096fd0a9982cebbaab80c362ae7320", "message": "Add IMS sender", "committedDate": "2020-01-22T10:08:34Z", "type": "commit"}, {"oid": "db209b8b49fa1f6d30fa79e5fd9747fa1a09418b", "url": "https://github.com/ibissource/iaf/commit/db209b8b49fa1f6d30fa79e5fd9747fa1a09418b", "message": "Changed types for constants and made them all static and final", "committedDate": "2020-01-22T10:27:38Z", "type": "commit"}, {"oid": "d8a8e8256686e4d33c9552e5899a1a9956d440bc", "url": "https://github.com/ibissource/iaf/commit/d8a8e8256686e4d33c9552e5899a1a9956d440bc", "message": "Copyright notice", "committedDate": "2020-01-22T10:28:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzYwNjYyMA==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r377606620", "bodyText": "Moet je hier niet ook de characterset uit JMS_IBM_Character_Set gebruiken?", "author": "gvanbrakel", "createdAt": "2020-02-11T12:33:59Z", "path": "ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java", "diffHunk": "@@ -0,0 +1,209 @@\n+/*\n+   Copyright 2020 Integration Partners\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.extensions.ibm;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+\n+import javax.jms.BytesMessage;\n+import javax.jms.JMSException;\n+import javax.jms.Message;\n+import javax.jms.Session;\n+import javax.naming.NamingException;\n+import javax.xml.transform.TransformerException;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.xml.sax.SAXException;\n+\n+import nl.nn.adapterframework.configuration.ConfigurationException;\n+import nl.nn.adapterframework.doc.IbisDoc;\n+import nl.nn.adapterframework.soap.SoapWrapper;\n+\n+/**\n+ * JMS sender which will add an IMS header to the message and call the MQ specific logic.\n+ *\n+ * <p>See {@link JMSSender} for configuration</p>\n+ *\n+ * @author Ricardo van Holst\n+ */\n+\n+public class IMSSender extends MQSender {\n+\t// IMS Header length\n+\tprivate static final int IIH_HEADERSIZE = 88;\n+\t\n+\t// IMS Header fields\n+\tprivate static final String\t  IIH_HEADER_STRUCT_ID\t\t= \"IIH \";\t\t// MQIIH_STRUC_ID (4 pos) \n+\tprivate static final int\t  IIH_HEADER_VERSION\t\t= 1;\t\t\t// MQIIH_VERSION_1 (4 pos)\n+\tprivate static final int\t  IIH_HEADER_LENGTH\t\t\t= 84;\t\t\t// MQIIH_LENGTH_1 (4 pos)\n+\tprivate static final int\t  IIH_HEADER_ENCODING\t\t= 0;\t\t\t// MQ reserved (4 pos)\n+\tprivate static final int\t  IIH_HEADER_CODECHARSET\t= 0;\t\t\t// MQ reserved (4 pos)\n+\tprivate static final String   IIH_HEADER_FORMAT\t\t\t= \"MQIMSVS \";\t// MQFMT-IMS-VAR-STRING (8 pos)\n+\tprivate\tstatic final int      IIH_HEADER_FLAGS\t\t\t= 0;\t\t\t// MQIIH-NONE (4 pos)\n+\tprivate static final String   IIH_HEADER_LTERM_OR\t\t= \"        \";\t// (8 pos)\n+\tprivate static final String   IIH_HEADER_MFS_MAPNAME\t= \"MQIMSVS \";\t// (8 pos)\n+\tprivate static final String   IIH_HEADER_REPLY_FORMAT\t= \"MQIMSVS \";\t// (8 pos)\n+\tprivate\tstatic final String   IIH_HEADER_MFS_AUTH\t\t= \"        \";\t// Password (8 pos)\n+\tprivate static final byte[]   IIH_HEADER_TRAN_INSTANCE\t= new byte[16];\t// Only relevant for conversation (16 pos)\n+\tprivate static final String   IIH_HEADER_TRAN_STATE\t\t= \" \";\t\t\t// MQITS_NOT_IN_CONVERSATION (1 pos)\n+\tprivate static final String   IIH_HEADER_COMMIT_MODE\t= \"1\";\t\t\t// MQICM-SEND-THEN-COMMIT (1 pos)\n+\tprivate static final String   IIH_HEADER_SECURITY_SCOPE\t= \"C\";\t\t\t// MQISS-CHECK (1 pos)\n+\tprivate static final String   IIH_HEADER_RESERVED\t\t= \" \";\t\t\t// Reserved (1 pos)\n+\t\n+\t// MQ Fields\n+\tprivate static final String MQC_MQFMT_IMS\t= \"MQIMS   \";\t// (8 pos)\n+\tprivate static final int MQENC_NATIVE = 273;\t\t\t\t// copied from com.ibm.mq.MQC in com.ibm.mq.jar\n+\tprivate static final int CCSID_ISO_8859_1 = 819;\n+\t\n+\tprivate String transactionCode;\n+\t\n+\t/**\n+\t * The transaction code that should be added in the header, must be 8 characters\n+\t */\n+\t@IbisDoc({\"transaction code that should be added to the header, must be 8 characters\", \"\"})\n+\tpublic String getTransactionCode() {\n+\t\treturn transactionCode;\n+\t}\n+\tpublic void setTransactionCode(String transactionCode) {\n+\t\tthis.transactionCode = transactionCode;\n+\t}\n+\n+\t@Override\n+\tpublic void configure() throws ConfigurationException {\n+\t\tif (StringUtils.isEmpty(getTransactionCode())) {\n+\t\t\tthrow new ConfigurationException(\"transactionCode must be specified\");\n+\t\t}\n+\t\tif (StringUtils.length(getTransactionCode()) != 8) {\n+\t\t\tthrow new ConfigurationException(\"transactionCode must be 8 positions, current code [\" + getTransactionCode() + \"] with length [\" + StringUtils.length(getTransactionCode()) + \"]\");\n+\t\t}\n+\t\tsuper.configure();\n+\t}\n+\t\n+\t@Override\n+\tpublic Message createMessage(Session session, String correlationID, String message)\n+\t\t\tthrows NamingException, JMSException {\n+\t\t\n+\t\tBytesMessage bytesMessage = null;\n+\t\tbytesMessage = session.createBytesMessage();\n+\t\t\n+\t\tsetMessageCorrelationID(bytesMessage, correlationID);\n+\t\t\n+\t\tByteArrayOutputStream bos = new ByteArrayOutputStream();\n+\t\t\n+\t\ttry {\n+\t\t\tbos.write(IIH_HEADER_STRUCT_ID.getBytes());\n+\t\t\tbos.write(intToBytes(IIH_HEADER_VERSION));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_LENGTH));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_ENCODING));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_CODECHARSET));\n+\t\t\tbos.write(IIH_HEADER_FORMAT.getBytes());\n+\t\t\tbos.write(intToBytes(IIH_HEADER_FLAGS));\n+\t\t\tbos.write(IIH_HEADER_LTERM_OR.getBytes());\n+\t\t\tbos.write(IIH_HEADER_MFS_MAPNAME.getBytes());\n+\t\t\tbos.write(IIH_HEADER_REPLY_FORMAT.getBytes());\n+\t\t\tbos.write(IIH_HEADER_MFS_AUTH.getBytes());\n+\t\t\tbos.write(IIH_HEADER_TRAN_INSTANCE);\n+\t\t\tbos.write(IIH_HEADER_TRAN_STATE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_COMMIT_MODE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_SECURITY_SCOPE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_RESERVED.getBytes());\n+\t\t\t\n+\t\t\tbyte[] data = message.getBytes();\n+\t\t\t\n+\t\t\tbos.write(shortToBytes(data.length + 13)); //LL, +13 is for LL, ZZ and transaction code bytes\n+\t\t\tbos.write(new byte[2]); //ZZ\n+\t\t\tbos.write((transactionCode + \" \").getBytes());\n+\t\t\t\n+\t\t\tbos.write(data);\n+\t\t\t\n+\t\t\tbos.toByteArray();\n+\t\t} catch (IOException e) {\n+\t\t\t// Should never happen\n+\t\t\tthrow new RuntimeException(e);\n+\t\t}\n+\t\t\n+\t\tbytesMessage.writeBytes(bos.toByteArray());\n+\t\t\n+\t\t// Set Properties\n+\t\tbytesMessage.setIntProperty(\"JMS_IBM_Encoding\", MQENC_NATIVE);\n+\t\tbytesMessage.setIntProperty(\"JMS_IBM_Character_Set\", CCSID_ISO_8859_1);\t\n+\t\tbytesMessage.setStringProperty(\"JMS_IBM_Format\", MQC_MQFMT_IMS);\t\n+\n+\t\treturn bytesMessage;\n+\t}\n+\n+\t@Override\n+\tpublic String getStringFromRawMessage(Object rawMessage, Map<String,Object> context, boolean soap, String soapHeaderSessionKey, SoapWrapper soapWrapper) throws JMSException, SAXException, TransformerException, IOException {\n+\t\tBytesMessage message;\n+\t\ttry {\n+\t\t\tmessage = (BytesMessage)rawMessage;\n+\t\t} catch (ClassCastException e) {\n+\t\t\tlog.error(\"message received by listener on [\"+ getDestinationName()+ \"] was not of type BytesMessage, but [\"+rawMessage.getClass().getName()+\"]\", e);\n+\t\t\treturn null;\n+\t\t}\n+\t\tbyte[] headerBuffer = new byte[IIH_HEADERSIZE];\n+\t\tmessage.readBytes(headerBuffer);\n+\t\t\n+\t\t// Put header fields in the context\n+\t\tByteBuffer byteBuffer = ByteBuffer.wrap(headerBuffer);\n+\t\tcontext.put(\"MQIIH_StrucID\", byteToString(byteBuffer, 4));\n+\t\tcontext.put(\"MQIIH_Version\", byteBuffer.getInt());\n+\t\tcontext.put(\"MQIIH_StrucLength\", byteBuffer.getInt());\n+\t\tcontext.put(\"MQIIH_Encoding\", byteBuffer.getInt());\n+\t\tcontext.put(\"MQIIH_CodedCharSetId\", byteBuffer.getInt());\n+\t\tcontext.put(\"MQIIH_Format\", byteToString(byteBuffer, 8));\n+\t\tcontext.put(\"MQIIH_Flags\", byteBuffer.getInt());\n+\t\tcontext.put(\"MQIIH_LTermOverride\", byteToString(byteBuffer, 8));\n+\t\tcontext.put(\"MQIIH_MFSMapName\", byteToString(byteBuffer, 8));\n+\t\tcontext.put(\"MQIIH_ReplyToFormat\", byteToString(byteBuffer, 8));\n+\t\tcontext.put(\"MQIIH_Authenticator\", byteToString(byteBuffer, 8));\n+\t\tcontext.put(\"MQIIH_TranInstanceId\", byteToString(byteBuffer, 16));\n+\t\tcontext.put(\"MQIIH_TranState\", byteToString(byteBuffer, 1));\n+\t\tcontext.put(\"MQIIH_CommitMode\", byteToString(byteBuffer, 1));\n+\t\tcontext.put(\"MQIIH_SecurityScope\", byteToString(byteBuffer, 1));\n+\t\tcontext.put(\"MQIIH_Reserved\", byteToString(byteBuffer, 1));\n+\t\t\n+\t\tint readBufferLength = (int)message.getBodyLength() - IIH_HEADERSIZE; // Get the length of the message to extract\n+\t\t\n+\t\tbyte[] readBuffer = new byte[readBufferLength];\n+\t\tmessage.readBytes(readBuffer);\n+\t\t\n+\t\tByteArrayOutputStream bos = new ByteArrayOutputStream();\n+\t\tbos.write(readBuffer);\n+\t\t\n+\t\treturn bos.toString(message.getStringProperty(\"JMS_IBM_Character_Set\"));\n+\t}\n+\t\n+\tprivate String byteToString(ByteBuffer byteBuffer, int size) {\n+\t\tbyte[] bytes = new byte[size];\n+\t\tbyteBuffer.get(bytes);\n+\t\t\n+\t\treturn new String(bytes);", "originalCommit": "d8a8e8256686e4d33c9552e5899a1a9956d440bc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7767a892d31c7e334c36e9409e181442e2e8ca50", "chunk": "diff --git a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\nindex 6ca575373..9b1d27624 100644\n--- a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n+++ b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n\n@@ -17,6 +17,7 @@ package nl.nn.adapterframework.extensions.ibm;\n \n import java.io.ByteArrayOutputStream;\n import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n import java.nio.ByteBuffer;\n import java.util.Map;\n \n"}}, {"oid": "7767a892d31c7e334c36e9409e181442e2e8ca50", "url": "https://github.com/ibissource/iaf/commit/7767a892d31c7e334c36e9409e181442e2e8ca50", "message": "Use characterset in byteToString-method", "committedDate": "2020-02-12T12:30:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1MDgwNQ==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r378250805", "bodyText": "Sorry, had het meteen moeten aanwijzen; Hier ook de character set gebruiken.\nEigenlijk altijd/overal wanneer er Strings naar bytes gaan, of andersom, dan moet je daarbij de characterset aangeven.\nHet beste maak je ook een test, waarin je in je message diacrieten (\u00e9\u00e8\u00ef) en het euro teken (\u20ac) gebruikt, Die moeten dan netjes heen en weer gaan.", "author": "gvanbrakel", "createdAt": "2020-02-12T13:31:55Z", "path": "ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java", "diffHunk": "@@ -0,0 +1,210 @@\n+/*\n+   Copyright 2020 Integration Partners\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.extensions.ibm;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.UnsupportedEncodingException;\n+import java.nio.ByteBuffer;\n+import java.util.Map;\n+\n+import javax.jms.BytesMessage;\n+import javax.jms.JMSException;\n+import javax.jms.Message;\n+import javax.jms.Session;\n+import javax.naming.NamingException;\n+import javax.xml.transform.TransformerException;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.xml.sax.SAXException;\n+\n+import nl.nn.adapterframework.configuration.ConfigurationException;\n+import nl.nn.adapterframework.doc.IbisDoc;\n+import nl.nn.adapterframework.soap.SoapWrapper;\n+\n+/**\n+ * JMS sender which will add an IMS header to the message and call the MQ specific logic.\n+ *\n+ * <p>See {@link JMSSender} for configuration</p>\n+ *\n+ * @author Ricardo van Holst\n+ */\n+\n+public class IMSSender extends MQSender {\n+\t// IMS Header length\n+\tprivate static final int IIH_HEADERSIZE = 88;\n+\t\n+\t// IMS Header fields\n+\tprivate static final String\t  IIH_HEADER_STRUCT_ID\t\t= \"IIH \";\t\t// MQIIH_STRUC_ID (4 pos) \n+\tprivate static final int\t  IIH_HEADER_VERSION\t\t= 1;\t\t\t// MQIIH_VERSION_1 (4 pos)\n+\tprivate static final int\t  IIH_HEADER_LENGTH\t\t\t= 84;\t\t\t// MQIIH_LENGTH_1 (4 pos)\n+\tprivate static final int\t  IIH_HEADER_ENCODING\t\t= 0;\t\t\t// MQ reserved (4 pos)\n+\tprivate static final int\t  IIH_HEADER_CODECHARSET\t= 0;\t\t\t// MQ reserved (4 pos)\n+\tprivate static final String   IIH_HEADER_FORMAT\t\t\t= \"MQIMSVS \";\t// MQFMT-IMS-VAR-STRING (8 pos)\n+\tprivate\tstatic final int      IIH_HEADER_FLAGS\t\t\t= 0;\t\t\t// MQIIH-NONE (4 pos)\n+\tprivate static final String   IIH_HEADER_LTERM_OR\t\t= \"        \";\t// (8 pos)\n+\tprivate static final String   IIH_HEADER_MFS_MAPNAME\t= \"MQIMSVS \";\t// (8 pos)\n+\tprivate static final String   IIH_HEADER_REPLY_FORMAT\t= \"MQIMSVS \";\t// (8 pos)\n+\tprivate\tstatic final String   IIH_HEADER_MFS_AUTH\t\t= \"        \";\t// Password (8 pos)\n+\tprivate static final byte[]   IIH_HEADER_TRAN_INSTANCE\t= new byte[16];\t// Only relevant for conversation (16 pos)\n+\tprivate static final String   IIH_HEADER_TRAN_STATE\t\t= \" \";\t\t\t// MQITS_NOT_IN_CONVERSATION (1 pos)\n+\tprivate static final String   IIH_HEADER_COMMIT_MODE\t= \"1\";\t\t\t// MQICM-SEND-THEN-COMMIT (1 pos)\n+\tprivate static final String   IIH_HEADER_SECURITY_SCOPE\t= \"C\";\t\t\t// MQISS-CHECK (1 pos)\n+\tprivate static final String   IIH_HEADER_RESERVED\t\t= \" \";\t\t\t// Reserved (1 pos)\n+\t\n+\t// MQ Fields\n+\tprivate static final String MQC_MQFMT_IMS\t= \"MQIMS   \";\t// (8 pos)\n+\tprivate static final int MQENC_NATIVE = 273;\t\t\t\t// copied from com.ibm.mq.MQC in com.ibm.mq.jar\n+\tprivate static final int CCSID_ISO_8859_1 = 819;\n+\t\n+\tprivate String transactionCode;\n+\t\n+\t/**\n+\t * The transaction code that should be added in the header, must be 8 characters\n+\t */\n+\t@IbisDoc({\"transaction code that should be added to the header, must be 8 characters\", \"\"})\n+\tpublic String getTransactionCode() {\n+\t\treturn transactionCode;\n+\t}\n+\tpublic void setTransactionCode(String transactionCode) {\n+\t\tthis.transactionCode = transactionCode;\n+\t}\n+\n+\t@Override\n+\tpublic void configure() throws ConfigurationException {\n+\t\tif (StringUtils.isEmpty(getTransactionCode())) {\n+\t\t\tthrow new ConfigurationException(\"transactionCode must be specified\");\n+\t\t}\n+\t\tif (StringUtils.length(getTransactionCode()) != 8) {\n+\t\t\tthrow new ConfigurationException(\"transactionCode must be 8 positions, current code [\" + getTransactionCode() + \"] with length [\" + StringUtils.length(getTransactionCode()) + \"]\");\n+\t\t}\n+\t\tsuper.configure();\n+\t}\n+\t\n+\t@Override\n+\tpublic Message createMessage(Session session, String correlationID, String message)\n+\t\t\tthrows NamingException, JMSException {\n+\t\t\n+\t\tBytesMessage bytesMessage = null;\n+\t\tbytesMessage = session.createBytesMessage();\n+\t\t\n+\t\tsetMessageCorrelationID(bytesMessage, correlationID);\n+\t\t\n+\t\tByteArrayOutputStream bos = new ByteArrayOutputStream();\n+\t\t\n+\t\ttry {\n+\t\t\tbos.write(IIH_HEADER_STRUCT_ID.getBytes());\n+\t\t\tbos.write(intToBytes(IIH_HEADER_VERSION));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_LENGTH));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_ENCODING));\n+\t\t\tbos.write(intToBytes(IIH_HEADER_CODECHARSET));\n+\t\t\tbos.write(IIH_HEADER_FORMAT.getBytes());\n+\t\t\tbos.write(intToBytes(IIH_HEADER_FLAGS));\n+\t\t\tbos.write(IIH_HEADER_LTERM_OR.getBytes());\n+\t\t\tbos.write(IIH_HEADER_MFS_MAPNAME.getBytes());\n+\t\t\tbos.write(IIH_HEADER_REPLY_FORMAT.getBytes());\n+\t\t\tbos.write(IIH_HEADER_MFS_AUTH.getBytes());\n+\t\t\tbos.write(IIH_HEADER_TRAN_INSTANCE);\n+\t\t\tbos.write(IIH_HEADER_TRAN_STATE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_COMMIT_MODE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_SECURITY_SCOPE.getBytes());\n+\t\t\tbos.write(IIH_HEADER_RESERVED.getBytes());\n+\t\t\t\n+\t\t\tbyte[] data = message.getBytes();", "originalCommit": "7767a892d31c7e334c36e9409e181442e2e8ca50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MTI4OQ==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r381361289", "bodyText": "\u20ac is geen onderdeel van de ISO_8859_1, dus bij omzetten van de string naar bytes is deze al verloren.", "author": "ricardovh", "createdAt": "2020-02-19T15:49:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1MDgwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "3934e27b6163df313c85e88f1f8437a162c407e5", "chunk": "diff --git a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\nindex 9b1d27624..33290bee5 100644\n--- a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n+++ b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n\n@@ -19,6 +19,8 @@ import java.io.ByteArrayOutputStream;\n import java.io.IOException;\n import java.io.UnsupportedEncodingException;\n import java.nio.ByteBuffer;\n+import java.nio.charset.Charset;\n+import java.nio.charset.StandardCharsets;\n import java.util.Map;\n \n import javax.jms.BytesMessage;\n"}}, {"oid": "3934e27b6163df313c85e88f1f8437a162c407e5", "url": "https://github.com/ibissource/iaf/commit/3934e27b6163df313c85e88f1f8437a162c407e5", "message": "Also use character set when encoding the message", "committedDate": "2020-02-12T14:26:22Z", "type": "commit"}, {"oid": "e9396fa5692ee18200e3668c3975f1fb28b138e8", "url": "https://github.com/ibissource/iaf/commit/e9396fa5692ee18200e3668c3975f1fb28b138e8", "message": "Unittest", "committedDate": "2020-02-19T15:19:16Z", "type": "commit"}, {"oid": "a53af447f78a6996eef1c7c33ec91010c638d1dc", "url": "https://github.com/ibissource/iaf/commit/a53af447f78a6996eef1c7c33ec91010c638d1dc", "message": "Merge branch 'master' of https://github.com/ibissource/iaf into AddIMSSender", "committedDate": "2020-02-19T15:32:16Z", "type": "commit"}, {"oid": "7dbd3e26d70fd12c03f51108fd0bcceafe9d1827", "url": "https://github.com/ibissource/iaf/commit/7dbd3e26d70fd12c03f51108fd0bcceafe9d1827", "message": "Add unittest dependencies", "committedDate": "2020-02-19T15:47:10Z", "type": "commit"}, {"oid": "7e2c1d9636eca0ff6219a91de7a6a4c17ba5bed6", "url": "https://github.com/ibissource/iaf/commit/7e2c1d9636eca0ff6219a91de7a6a4c17ba5bed6", "message": "cosmetic changes", "committedDate": "2020-03-10T14:52:31Z", "type": "commit"}, {"oid": "1fa964f825073df0cadc91d4289882c9d0c82ae6", "url": "https://github.com/ibissource/iaf/commit/1fa964f825073df0cadc91d4289882c9d0c82ae6", "message": "Remove unused imports from tests", "committedDate": "2020-03-13T12:35:10Z", "type": "commit"}, {"oid": "b7dd9b9cb753097e26476713c556218cba8ae878", "url": "https://github.com/ibissource/iaf/commit/b7dd9b9cb753097e26476713c556218cba8ae878", "message": "Moved log.properties for test to correct folder", "committedDate": "2020-03-13T12:49:48Z", "type": "commit"}, {"oid": "db6aba73ecd904cb53e12d3f9d0d48203ed9cf83", "url": "https://github.com/ibissource/iaf/commit/db6aba73ecd904cb53e12d3f9d0d48203ed9cf83", "message": "Merge branch 'master' into AddIMSSender", "committedDate": "2020-03-13T13:19:59Z", "type": "commit"}, {"oid": "329ab116816e1d436177950ec185352fe11f440b", "url": "https://github.com/ibissource/iaf/commit/329ab116816e1d436177950ec185352fe11f440b", "message": "Update test to use SenderTestBase from core and core changes", "committedDate": "2020-03-27T12:20:18Z", "type": "commit"}, {"oid": "82819e00c846e0d3a2a16d6c904bb3013ee21d59", "url": "https://github.com/ibissource/iaf/commit/82819e00c846e0d3a2a16d6c904bb3013ee21d59", "message": "Merge branch 'master' of https://github.com/ibissource/iaf into AddIMSSender\n\n# Conflicts:\n#\tcore/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java", "committedDate": "2020-03-27T14:00:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5MzE4Ng==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r400893186", "bodyText": "Zijn al deze changes puur tabs die omgezet zijn naar spaties?", "author": "nielsm5", "createdAt": "2020-03-31T13:00:26Z", "path": "core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java", "diffHunk": "@@ -81,38 +81,38 @@\n \tprivate boolean jmsTransacted = false;\n \tprivate String subscriberType = \"DURABLE\"; // DURABLE or TRANSIENT\n \n-\tprivate int ackMode = Session.AUTO_ACKNOWLEDGE;\n-\tprivate boolean persistent;\n-\tprivate long messageTimeToLive = 0;\n-\tprivate String destinationName;\n-\tprivate boolean useTopicFunctions = false;\n-\tprivate String authAlias;\n-\tprivate boolean lookupDestination = true;\n-\n-\tprivate String destinationType = \"QUEUE\"; // QUEUE or TOPIC\n-\n-\tprotected MessagingSource messagingSource;\n-\tprivate Destination destination;\n-\n-\tprivate Map<String, ConnectionFactory> proxiedConnectionFactories;\n-\tprivate Map<String, String> proxiedDestinationNames;\n-\n-\t// ---------------------------------------------------------------------\n-\t// Queue fields\n-\t// ---------------------------------------------------------------------\n-\tprivate String queueConnectionFactoryName;\n-\t// ---------------------------------------------------------------------\n-\t// Topic fields\n-\t// ---------------------------------------------------------------------\n-\tprivate String topicConnectionFactoryName;\n-\n-\t// the MessageSelector will provide filter functionality, as specified\n-\t// javax.jms.Message.\n-\tprivate String messageSelector = null;\n-\n-\tprivate boolean correlationIdToHex = false;\n-\tprivate String correlationIdToHexPrefix = \"ID:\";\n-\tprivate int correlationIdMaxLength = -1;\n+    private int ackMode = Session.AUTO_ACKNOWLEDGE;", "originalCommit": "82819e00c846e0d3a2a16d6c904bb3013ee21d59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5Njc4OQ==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r400896789", "bodyText": "Volgens mij is de merge niet helemaal goed gegaan of staat bij jou 'show whitespaces' uit. In de pr lijkt het nu alsof gigantisch veel veranderd is", "author": "nielsm5", "createdAt": "2020-03-31T13:05:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5MzE4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "4432fb41e8a6b41d864bf318e9cd4a0afe9647f5", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java b/core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java\nindex a5536ea01..b27399a55 100644\n--- a/core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java\n+++ b/core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java\n\n@@ -81,38 +81,38 @@ public class JMSFacade extends JNDIBase implements INamedObject, HasPhysicalDest\n \tprivate boolean jmsTransacted = false;\n \tprivate String subscriberType = \"DURABLE\"; // DURABLE or TRANSIENT\n \n-    private int ackMode = Session.AUTO_ACKNOWLEDGE;\n-    private boolean persistent;\n-\tprivate long messageTimeToLive=0;\n-    private String destinationName;\n-    private boolean useTopicFunctions = false;\n-    private String authAlias;\n-    private boolean lookupDestination = true;\n-\n-    private String destinationType=\"QUEUE\"; // QUEUE or TOPIC\n-\n-    protected MessagingSource messagingSource;\n-    private Destination destination;\n-\n-    private Map<String, ConnectionFactory> proxiedConnectionFactories;\n-    private Map<String, String> proxiedDestinationNames;\n-\n-    //---------------------------------------------------------------------\n-    // Queue fields\n-    //---------------------------------------------------------------------\n-    private String queueConnectionFactoryName;\n-    //---------------------------------------------------------------------\n-    // Topic fields\n-    //---------------------------------------------------------------------\n-    private String topicConnectionFactoryName;\n-\n-\t//the MessageSelector will provide filter functionality, as specified\n-\t//javax.jms.Message.\n-    private String messageSelector=null;\n-\n-    private boolean correlationIdToHex=false;\n-    private String correlationIdToHexPrefix=\"ID:\";\n-    private int correlationIdMaxLength=-1;\n+\tprivate int ackMode = Session.AUTO_ACKNOWLEDGE;\n+\tprivate boolean persistent;\n+\tprivate long messageTimeToLive = 0;\n+\tprivate String destinationName;\n+\tprivate boolean useTopicFunctions = false;\n+\tprivate String authAlias;\n+\tprivate boolean lookupDestination = true;\n+\n+\tprivate String destinationType = \"QUEUE\"; // QUEUE or TOPIC\n+\n+\tprotected MessagingSource messagingSource;\n+\tprivate Destination destination;\n+\n+\tprivate Map<String, ConnectionFactory> proxiedConnectionFactories;\n+\tprivate Map<String, String> proxiedDestinationNames;\n+\n+\t// ---------------------------------------------------------------------\n+\t// Queue fields\n+\t// ---------------------------------------------------------------------\n+\tprivate String queueConnectionFactoryName;\n+\t// ---------------------------------------------------------------------\n+\t// Topic fields\n+\t// ---------------------------------------------------------------------\n+\tprivate String topicConnectionFactoryName;\n+\n+\t// the MessageSelector will provide filter functionality, as specified\n+\t// javax.jms.Message.\n+\tprivate String messageSelector = null;\n+\n+\tprivate boolean correlationIdToHex = false;\n+\tprivate String correlationIdToHexPrefix = \"ID:\";\n+\tprivate int correlationIdMaxLength = -1;\n \n \tpublic static int stringToDeliveryMode(String mode) {\n \t\tif (MODE_PERSISTENT.equalsIgnoreCase(mode)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5Mzg4OA==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r400893888", "bodyText": "Copyright 2020 WeAreFrank!", "author": "nielsm5", "createdAt": "2020-03-31T13:01:33Z", "path": "ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+   Copyright 2020 Integration Partners", "originalCommit": "82819e00c846e0d3a2a16d6c904bb3013ee21d59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5Njk4Mw==", "url": "https://github.com/ibissource/iaf/pull/377#discussion_r400896983", "bodyText": "(en natuurlijk ook op andere plekken :) )", "author": "nielsm5", "createdAt": "2020-03-31T13:06:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5Mzg4OA=="}], "type": "inlineReview", "revised_code": {"commit": "86d911c7cc50dd1ea5559d7ece61e034010480d8", "chunk": "diff --git a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\nindex 4ebbf5d54..9dcc64ed1 100644\n--- a/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n+++ b/ibm/src/main/java/nl/nn/adapterframework/extensions/ibm/IMSSender.java\n\n@@ -1,5 +1,5 @@\n /*\n-   Copyright 2020 Integration Partners\n+   Copyright 2020 WeAreFrank!\n \n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n"}}, {"oid": "4432fb41e8a6b41d864bf318e9cd4a0afe9647f5", "url": "https://github.com/ibissource/iaf/commit/4432fb41e8a6b41d864bf318e9cd4a0afe9647f5", "message": "Fix whitespaces", "committedDate": "2020-03-31T14:12:04Z", "type": "commit"}, {"oid": "86d911c7cc50dd1ea5559d7ece61e034010480d8", "url": "https://github.com/ibissource/iaf/commit/86d911c7cc50dd1ea5559d7ece61e034010480d8", "message": "Copyright notice", "committedDate": "2020-03-31T14:14:42Z", "type": "commit"}]}