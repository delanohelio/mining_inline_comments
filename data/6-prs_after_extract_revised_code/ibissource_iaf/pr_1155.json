{"pr_number": 1155, "pr_title": "Do not normalize new lines in attributes during config loading", "pr_createdAt": "2020-10-16T12:46:55Z", "pr_url": "https://github.com/ibissource/iaf/pull/1155", "timeline": [{"oid": "0ba0f87d46af5c3ed601c4a8cb7226d9ee956eda", "url": "https://github.com/ibissource/iaf/commit/0ba0f87d46af5c3ed601c4a8cb7226d9ee956eda", "message": "do not normalize new lines in attributes during config loading", "committedDate": "2020-10-16T12:44:47Z", "type": "commit"}, {"oid": "de0775631dc871cac00c0843c5013d6d7f4c2661", "url": "https://github.com/ibissource/iaf/commit/de0775631dc871cac00c0843c5013d6d7f4c2661", "message": "another wrapper", "committedDate": "2020-10-16T12:55:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjU0MjU4Ng==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r506542586", "bodyText": "I think it would be a good idea not to introduce two new resources, but to add the &#xa; value to 'in.xml', to a element, to an attribute, to the escaped data in <data1> and to the CDATA in <data2> .\nYou'll also have to change quite some other resource files, but it makes the test cover more.", "author": "gvanbrakel", "createdAt": "2020-10-16T15:25:26Z", "path": "core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java", "diffHunk": "@@ -71,4 +71,20 @@ public void testNoLexicalHandling() throws Exception {\n \t\tassertEquals(expected,xmlWriter.toString());\n \t}\n \n+\t@Test\n+\tpublic void testDisableOutputEscaping() throws Exception {", "originalCommit": "de0775631dc871cac00c0843c5013d6d7f4c2661", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9cbac312109bcc70bb58a6a8d76769eccdb2c29a", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java b/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\nindex 15e3578b5..030fba956 100644\n--- a/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\n+++ b/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\n\n@@ -71,20 +75,4 @@ public class XmlWriterTest {\n \t\tassertEquals(expected,xmlWriter.toString());\n \t}\n \n-\t@Test\n-\tpublic void testDisableOutputEscaping() throws Exception {\n-\t\tString input    = TestFileUtils.getTestFile(\"/Xslt/AnyXml/ConfigNewLine.xml\");\n-\t\tString expected = TestFileUtils.getTestFile(\"/Xslt/AnyXml/ParsedXmlNewLine.xml\");\n-\t\tXmlWriter xmlWriter = new XmlWriter();\n-\t\t\n-\t\tInputSource inputSource = new InputSource(new StringReader(input));\n-\t\tXMLReader xmlReader = XmlUtils.getXMLReader(xmlWriter);\n-\t\t// lexical handling is automatically set, when the contentHandler (xmlWriter in this case) implements  the interface LexicalHandler.\n-\t\t// To test the output of the XmlWriter without lexical handling, it must be switched off explicitly in the XmlReader\n-\t\txmlReader.setProperty(\"http://xml.org/sax/properties/lexical-handler\", null);\n-\n-\t\txmlReader.parse(inputSource);\n-\t\tassertEquals(expected,xmlWriter.toString());\n-\t}\n-\n }\n"}}, {"oid": "9cbac312109bcc70bb58a6a8d76769eccdb2c29a", "url": "https://github.com/ibissource/iaf/commit/9cbac312109bcc70bb58a6a8d76769eccdb2c29a", "message": "include new line in xml, xsl test cases", "committedDate": "2020-10-19T12:03:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc0ODU1Mw==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r507748553", "bodyText": "Should the xmlWriter really resolve the new line? I would think not!", "author": "gvanbrakel", "createdAt": "2020-10-19T13:32:22Z", "path": "core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java", "diffHunk": "@@ -20,6 +20,8 @@ public void testBasic() throws Exception {\n \t\tString expected = input;\n \t\tXmlWriter xmlWriter = new XmlWriter();\n \t\tXmlUtils.parseXml(input, xmlWriter);\n+\t\t/* parseXml method will resolve new line*/\n+\t\texpected = expected.replace(\"newline &#10;\", \"newline \\n\").replace(\"&lt;LF&gt;&#xa;&lt;/LF&gt;\", \"&lt;LF&gt;\\n&lt;/LF&gt;\");", "originalCommit": "9cbac312109bcc70bb58a6a8d76769eccdb2c29a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0efd4b209276c134318bed5f529dd96118c49f16", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java b/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\nindex 030fba956..66abae8c0 100644\n--- a/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\n+++ b/core/src/test/java/nl/nn/adapterframework/xml/XmlWriterTest.java\n\n@@ -20,8 +20,6 @@ public class XmlWriterTest {\n \t\tString expected = input;\n \t\tXmlWriter xmlWriter = new XmlWriter();\n \t\tXmlUtils.parseXml(input, xmlWriter);\n-\t\t/* parseXml method will resolve new line*/\n-\t\texpected = expected.replace(\"newline &#10;\", \"newline \\n\").replace(\"&lt;LF&gt;&#xa;&lt;/LF&gt;\", \"&lt;LF&gt;\\n&lt;/LF&gt;\");\n \t\tassertEquals(expected,xmlWriter.toString());\n \t}\n \t\n"}}, {"oid": "0efd4b209276c134318bed5f529dd96118c49f16", "url": "https://github.com/ibissource/iaf/commit/0efd4b209276c134318bed5f529dd96118c49f16", "message": "have the new line only in an attribute", "committedDate": "2020-10-19T14:12:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0NDU4Ng==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r508344586", "bodyText": "2019 - 2020 WeAreFrank!", "author": "nielsm5", "createdAt": "2020-10-20T09:21:17Z", "path": "core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n-   Copyright 2019 Integration Partners\n+   Copyright 2019 Integration Partners, 2020 WeAreFrank!", "originalCommit": "0efd4b209276c134318bed5f529dd96118c49f16", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dd4fae0f00eba25f8306ac20a6eb6021b2e87f92", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java b/core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java\nindex 583435559..242021ef2 100644\n--- a/core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java\n+++ b/core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java\n\n@@ -1,5 +1,5 @@\n /*\n-   Copyright 2019 Integration Partners, 2020 WeAreFrank!\n+   Copyright 2019 - 2020 WeAreFrank!\n \n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0NDcyMw==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r508344723", "bodyText": "\ud83d\udc4d", "author": "nielsm5", "createdAt": "2020-10-20T09:21:30Z", "path": "core/src/main/java/nl/nn/adapterframework/xml/XmlWriter.java", "diffHunk": "@@ -37,22 +37,22 @@\n \n public class XmlWriter extends DefaultHandler implements LexicalHandler {\n \tprotected Logger log = LogUtil.getLogger(this);\n-\t\n-\tprivate final String DISABLE_OUTPUT_ESCAPING=\"javax.xml.transform.disable-output-escaping\";\n-\tprivate final String ENABLE_OUTPUT_ESCAPING=\"javax.xml.transform.enable-output-escaping\";\n-\t\n+\n+\tpublic static final String DISABLE_OUTPUT_ESCAPING=\"javax.xml.transform.disable-output-escaping\";\n+\tpublic static final String ENABLE_OUTPUT_ESCAPING=\"javax.xml.transform.enable-output-escaping\";", "originalCommit": "0efd4b209276c134318bed5f529dd96118c49f16", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0NTM5OQ==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r508345399", "bodyText": "Good comment! (maybe fix mehtod though)", "author": "nielsm5", "createdAt": "2020-10-20T09:22:29Z", "path": "core/src/test/java/nl/nn/adapterframework/xslt/ParallelXsltTest.java", "diffHunk": "@@ -119,6 +119,8 @@ protected void assertResultsAreCorrect(String expected, String actual, IPipeLine\n \n //\t\tsuper.assertResultsAreCorrect(combinedExpected, actual, session);\n \n+\t\t/* Parallel sender uses toXml mehtod which escapes the new line char. In the comparison we need unescaped char.*/", "originalCommit": "0efd4b209276c134318bed5f529dd96118c49f16", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "dd4fae0f00eba25f8306ac20a6eb6021b2e87f92", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/xslt/ParallelXsltTest.java b/core/src/test/java/nl/nn/adapterframework/xslt/ParallelXsltTest.java\nindex 7e71e69f4..6f4caeea4 100644\n--- a/core/src/test/java/nl/nn/adapterframework/xslt/ParallelXsltTest.java\n+++ b/core/src/test/java/nl/nn/adapterframework/xslt/ParallelXsltTest.java\n\n@@ -119,7 +119,7 @@ public class ParallelXsltTest extends XsltErrorTestBase<GenericMessageSendingPip\n \n //\t\tsuper.assertResultsAreCorrect(combinedExpected, actual, session);\n \n-\t\t/* Parallel sender uses toXml mehtod which escapes the new line char. In the comparison we need unescaped char.*/\n+\t\t/* Parallel sender uses toXml method which escapes the new line char. In the comparison we need unescaped char.*/\n \t\tactual = actual.replace(\"&#xA;\", \"&#10;\");\n \t\tif (stripAllWhitespace) {\n \t\t\tsuper.assertResultsAreCorrect(combinedExpected.replaceAll(\"\\\\s\",\"\"), actual.replaceAll(\"\\\\s\",\"\"), session);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM0NTYwOA==", "url": "https://github.com/ibissource/iaf/pull/1155#discussion_r508345608", "bodyText": "A tip I can give you for next time, try to not put too many test cases in 1 junit-test. It will make it more difficult to analyse the problem. In this case you're testing the escape part so it's understandable \ud83d\udc4d", "author": "nielsm5", "createdAt": "2020-10-20T09:22:45Z", "path": "core/src/test/java/nl/nn/adapterframework/xslt/XsltTestBase.java", "diffHunk": "@@ -353,7 +353,7 @@ public void xpathAttrText() throws Exception {\n \t@Test\n \tpublic void xpathNodeXml() throws Exception {\n \t\tString input = TestFileUtils.getTestFile(\"/Xslt/AnyXml/in.xml\");\n-\t\tString expected = \"<g attr=\\\"Euro \u20ac single quote ' double quote escaped &quot; \\\">Euro \u20ac single quote ' double quote \\\"</g>\";\n+\t\tString expected = \"<g attr=\\\"Euro \u20ac single quote ' double quote escaped &quot; newline escaped &#10;\\\">Euro \u20ac single quote ' double quote \\\"</g>\";", "originalCommit": "0efd4b209276c134318bed5f529dd96118c49f16", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "dd4fae0f00eba25f8306ac20a6eb6021b2e87f92", "url": "https://github.com/ibissource/iaf/commit/dd4fae0f00eba25f8306ac20a6eb6021b2e87f92", "message": "fix copyright, comment typo", "committedDate": "2020-10-20T11:25:00Z", "type": "commit"}]}