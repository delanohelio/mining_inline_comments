{"pr_number": 518, "pr_title": "Pipes with Message input", "pr_createdAt": "2020-03-18T06:45:33Z", "pr_url": "https://github.com/ibissource/iaf/pull/518", "timeline": [{"oid": "31be2c2ea1efb5c3f7e1b6a8b25040008eaa12d4", "url": "https://github.com/ibissource/iaf/commit/31be2c2ea1efb5c3f7e1b6a8b25040008eaa12d4", "message": "First commit\n\nAll unit tests pass\n137 of 298 Larva tests of iaf-test fail", "committedDate": "2020-03-17T16:38:05Z", "type": "commit"}, {"oid": "ea12de7f333c57bf1defd352176a55bd0e7639eb", "url": "https://github.com/ibissource/iaf/commit/ea12de7f333c57bf1defd352176a55bd0e7639eb", "message": "Merge branch 'master' into PipesUsingMessages", "committedDate": "2020-03-18T10:29:04Z", "type": "commit"}, {"oid": "58cb79dd203b268815d20baf398e1a7ab74cbe1f", "url": "https://github.com/ibissource/iaf/commit/58cb79dd203b268815d20baf398e1a7ab74cbe1f", "message": "Fix iaf-test tests", "committedDate": "2020-03-20T08:32:11Z", "type": "commit"}, {"oid": "3380ff923d87c2864741c7ba6d13db90a37463fd", "url": "https://github.com/ibissource/iaf/commit/3380ff923d87c2864741c7ba6d13db90a37463fd", "message": "Simplify CorePipeLineProcessor", "committedDate": "2020-03-20T09:51:32Z", "type": "commit"}, {"oid": "a5f87fae6453f65579011108fead3378b20beb95", "url": "https://github.com/ibissource/iaf/commit/a5f87fae6453f65579011108fead3378b20beb95", "message": "Remove ParameterResolutionContext", "committedDate": "2020-03-20T10:19:49Z", "type": "commit"}, {"oid": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "url": "https://github.com/ibissource/iaf/commit/e4cad2f689cb43a7040ff686e0400f98c5aeea56", "message": "Add current year to copyright message", "committedDate": "2020-03-20T11:20:13Z", "type": "commit"}, {"oid": "3a758270a6735072e5e64c380be6f56040276076", "url": "https://github.com/ibissource/iaf/commit/3a758270a6735072e5e64c380be6f56040276076", "message": "one additional little pipe", "committedDate": "2020-03-20T12:38:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU4OTM0Mg==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395589342", "bodyText": "Hier wordt het een string, maar op regel 328 wordt het een source?", "author": "nielsm5", "createdAt": "2020-03-20T11:57:01Z", "path": "core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java", "diffHunk": "@@ -321,7 +321,7 @@ public Object getValue(ParameterValueList alreadyResolvedParameters, Message mes\n \t\t\t\t\t\t}\n \t\t\t\t\t\tsourceString = itemsXml.toXML();\n \t\t\t\t\t} else {\n-\t\t\t\t\t\tsourceString = (String) sourceObject;", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java b/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\nindex f5d28e3cb..008dbefee 100644\n--- a/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\n+++ b/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\n\n@@ -321,7 +321,7 @@ public class Parameter implements INamedObject, IWithParameters {\n \t\t\t\t\t\t}\n \t\t\t\t\t\tsourceString = itemsXml.toXML();\n \t\t\t\t\t} else {\n-\t\t\t\t\t\tsourceString = new Message(sourceObject).asString();\n+\t\t\t\t\t\tsourceString = Message.asString(sourceObject);\n \t\t\t\t\t}\n \t\t\t\t\tif (StringUtils.isNotEmpty(sourceString)) {\n \t\t\t\t\t\tlog.debug(\"Parameter [\"+getName()+\"] using sessionvariable [\"+requestedSessionKey+\"] as source for transformation\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5MDAwNw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395590007", "bodyText": "Dit snap ik niet helemaal", "author": "nielsm5", "createdAt": "2020-03-20T11:58:21Z", "path": "core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java", "diffHunk": "@@ -376,6 +378,9 @@ public Object getValue(ParameterValueList alreadyResolvedParameters, Message mes\n \t\t\t\t}\n \t\t\t}\n \t\t}\n+\t\tif (result !=null && result instanceof Message && ((Message)result).asObject() instanceof String) {", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java b/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\nindex f5d28e3cb..008dbefee 100644\n--- a/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\n+++ b/core/src/main/java/nl/nn/adapterframework/parameters/Parameter.java\n\n@@ -379,7 +379,7 @@ public class Parameter implements INamedObject, IWithParameters {\n \t\t\t}\n \t\t}\n \t\tif (result !=null && result instanceof Message && ((Message)result).asObject() instanceof String) {\n-\t\t\tresult = ((Message)result).asObject();\n+\t\t\tresult = ((Message)result).asObject(); // avoid the IOException thrown by asString()\n \t\t}\n \t\tif (result != null) {\n \t\t\tif (log.isDebugEnabled()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5MDQ4MQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395590481", "bodyText": "maak dit aub abstract", "author": "nielsm5", "createdAt": "2020-03-20T11:59:22Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java", "diffHunk": "@@ -209,23 +210,13 @@ public void configure(PipeLine pipeline) throws ConfigurationException {\n \t}\n \n \n-\t/**\n-\t * This is where the action takes place. Pipes may only throw a PipeRunException,\n-\t * to be handled by the caller of this object.\n-\t * @deprecated use {@link #doPipe(Object,IPipeLineSession)} instead\n-\t */\n-\t@Deprecated\n-\tpublic final PipeRunResult doPipe (Object input) throws PipeRunException {\n-\t\tthrow new PipeRunException(this, \"Pipe should implement method doPipe()\");\n-\t}\n-\n \t/**\n \t * This is where the action takes place. Pipes may only throw a PipeRunException,\n \t * to be handled by the caller of this object.\n \t */\n \t@Override\n-\tpublic PipeRunResult doPipe (Object input, IPipeLineSession session) throws PipeRunException {\n-\t\treturn doPipe(input);\n+\tpublic PipeRunResult doPipe (Message message, IPipeLineSession session) throws PipeRunException {\n+\t\tthrow new PipeRunException(this, \"Pipe should implement method doPipe()\");", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java\nindex e950a46f6..6c00b9f47 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java\n\n@@ -215,9 +215,7 @@ public abstract class AbstractPipe implements IExtendedPipe, HasTransactionAttri\n \t * to be handled by the caller of this object.\n \t */\n \t@Override\n-\tpublic PipeRunResult doPipe (Message message, IPipeLineSession session) throws PipeRunException {\n-\t\tthrow new PipeRunException(this, \"Pipe should implement method doPipe()\");\n-\t}\n+\tpublic abstract PipeRunResult doPipe (Message message, IPipeLineSession session) throws PipeRunException;\n \n \t/**\n \t * looks up a key in the pipeForward hashtable. <br/>\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5NTA0NQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395595045", "bodyText": "Het eerste argument can de format is message, en hier vul je de logprefix in... Snap dat het al zo was, maar wel erg onduidelijk...\nMessage moet geen string worden", "author": "nielsm5", "createdAt": "2020-03-20T12:09:41Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/CompressPipe.java", "diffHunk": "@@ -166,15 +165,13 @@ public PipeRunResult doPipe(Object input, IPipeLineSession session) throws PipeR\n \t\t} catch(Exception e) {\n \t\t\tPipeForward exceptionForward = findForward(EXCEPTIONFORWARD);\n \t\t\tif (exceptionForward!=null) {\n-\t\t\t\tlog.warn(getLogPrefix(session) + \"exception occured, forwarded to [\"+exceptionForward.getPath()+\"]\", e);\n-\t\t\t\tString originalMessage;\n-\t\t\t\tif (input instanceof String) {\n-\t\t\t\t\toriginalMessage = (String)input; \n-\t\t\t\t} else {\n-\t\t\t\t\toriginalMessage = \"Object of type \" + input.getClass().getName(); \n+\t\t\t\ttry {\n+\t\t\t\t\tlog.warn(getLogPrefix(session) + \"exception occured, forwarded to [\"+exceptionForward.getPath()+\"]\", e);\n+\t\t\t\t\tString resultmsg=new ErrorMessageFormatter().format(getLogPrefix(session),e,this,message.asString(),session.getMessageId(),0);", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5NTQ4Mw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395595483", "bodyText": "Deze message is eigenlijk de logprefix? moet die dan niet zo heten binnen deze methode.\nHier graat originalMessage gebruiken ;)\nPS: originalMessage moet al een Message zijn!", "author": "nielsm5", "createdAt": "2020-03-20T12:10:36Z", "path": "core/src/main/java/nl/nn/adapterframework/errormessageformatters/XslErrorMessageFormatter.java", "diffHunk": "@@ -85,10 +85,9 @@ public String format(String message, Throwable t, INamedObject location, String\n \t\t\t\t\t\tlog.error(\"exception while configuring parameters\",e);\n \t\t\t\t\t}\n \n-\t\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext(message, new PipeLineSessionBase());\n \t\t\t\t\tMap<String, Object> parametervalues = null;\n \t\t\t\t\ttry {\n-\t\t\t\t\t\tparametervalues = prc.getValueMap(params);\n+\t\t\t\t\t\tparametervalues = params.getValues(new Message(message), new PipeLineSessionBase()).getValueMap();", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/errormessageformatters/XslErrorMessageFormatter.java b/core/src/main/java/nl/nn/adapterframework/errormessageformatters/XslErrorMessageFormatter.java\nindex c3227b485..a3029c00b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/errormessageformatters/XslErrorMessageFormatter.java\n+++ b/core/src/main/java/nl/nn/adapterframework/errormessageformatters/XslErrorMessageFormatter.java\n\n@@ -87,7 +87,7 @@ public class XslErrorMessageFormatter extends ErrorMessageFormatter {\n \n \t\t\t\t\tMap<String, Object> parametervalues = null;\n \t\t\t\t\ttry {\n-\t\t\t\t\t\tparametervalues = params.getValues(new Message(message), new PipeLineSessionBase()).getValueMap();\n+\t\t\t\t\t\tparametervalues = params.getValues(new Message(errorMessage), new PipeLineSessionBase()).getValueMap();\n \t\t\t\t\t} catch (ParameterException e) {\n \t\t\t\t\t\tlog.error(\"got exception extracting parameters\",e);\n \t\t\t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5Nzk4NQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395597985", "bodyText": "Uiteindelijk moet hier een PipeForward en een Message in kunnen....", "author": "nielsm5", "createdAt": "2020-03-20T12:16:17Z", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeRunResult.java", "diffHunk": "@@ -17,9 +17,11 @@\n \n import org.apache.commons.lang.builder.ToStringBuilder;\n \n+import nl.nn.adapterframework.stream.Message;\n+\n /**\n  * The PipeRunResult is a type to store both the result of the processing of a message\n- * in {@link IPipe#doPipe(Object, IPipeLineSession) doPipe()} as well as the exitState.", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwMDkzOA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395600938", "bodyText": "Dit gebeurd al op veel plekken, wat gebeurd er als je storeResultInSessionkey doet?", "author": "nielsm5", "createdAt": "2020-03-20T12:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTU5Nzk4NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwMTQ5MA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395601490", "bodyText": "Maak deze ook gelijk deprecated", "author": "nielsm5", "createdAt": "2020-03-20T12:24:05Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/FilePipe.java", "diffHunk": "@@ -19,6 +19,7 @@\n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.core.PipeRunException;\n import nl.nn.adapterframework.core.PipeRunResult;\n+import nl.nn.adapterframework.stream.Message;\n import nl.nn.adapterframework.util.FileHandler;\n \n ", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwMjc5MA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395602790", "bodyText": "Deze ook deprecaten? putparaminsession is beter?", "author": "nielsm5", "createdAt": "2020-03-20T12:26:56Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/PutInSession.java", "diffHunk": "@@ -22,6 +22,7 @@\n import nl.nn.adapterframework.core.PipeRunException;\n import nl.nn.adapterframework.core.PipeRunResult;\n import nl.nn.adapterframework.doc.IbisDoc;\n+import nl.nn.adapterframework.stream.Message;\n \n /**\n  * Puts the input in the PipeLineSession, under the key specified by", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNjIxMQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395736211", "bodyText": "mwoah, doen wel allebei net iets anders.", "author": "gvanbrakel", "createdAt": "2020-03-20T16:02:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwMjc5MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwNjQ1OA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395606458", "bodyText": "Deprecate class nu we filesystems hebben?", "author": "nielsm5", "createdAt": "2020-03-20T12:34:19Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/MoveFilePipe.java", "diffHunk": "@@ -16,16 +16,18 @@\n package nl.nn.adapterframework.pipes;\n \n import java.io.File;\n+import java.io.IOException;\n+\n+import org.apache.commons.lang.StringUtils;\n \n import nl.nn.adapterframework.configuration.ConfigurationException;\n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.core.PipeRunException;\n import nl.nn.adapterframework.core.PipeRunResult;\n import nl.nn.adapterframework.doc.IbisDoc;\n+import nl.nn.adapterframework.stream.Message;\n import nl.nn.adapterframework.util.FileUtils;\n \n-import org.apache.commons.lang.StringUtils;\n-\n /**\n  * Pipe for moving files to another directory.\n  *", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/MoveFilePipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/MoveFilePipe.java\nindex 00c7cd633..ad437dcff 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/MoveFilePipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/MoveFilePipe.java\n\n@@ -35,7 +35,10 @@ import nl.nn.adapterframework.util.FileUtils;\n  * @author  John Dekker\n  * @author  Jaco de Groot (***@dynasol.nl)\n  * @author  Gerrit van Brakel\n+ * \n+ * @deprecated Please use LocalFileSystemPipe with action=\"move\"\n  */\n+@Deprecated\n public class MoveFilePipe extends FixedForwardPipe {\n \n \tprivate String directory;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwNzgzNg==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395607836", "bodyText": "Methode hernoemen?", "author": "nielsm5", "createdAt": "2020-03-20T12:37:07Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java", "diffHunk": "@@ -877,29 +869,20 @@ protected PipeRunResult sendMessage(Object input, IPipeLineSession session, Stri\n \t\t\t\t\t\t} else {\n \t\t\t\t\t\t\tduration = Misc.getDurationInMs(startTime);\n \t\t\t\t\t\t}\n-\t\t\t\t\t\tmsgLog.info(\"Sender [\" + sender.getName() + \"] class [\" + sender.getClass().getSimpleName() + \"] correlationID [\" + correlationID + \"] duration [\" + duration + \"] got exit-state [\" + exitState + \"]\");\n+\t\t\t\t\t\tmsgLog.info(\"Sender [\" + sender.getName() + \"] class [\" + sender.getClass().getSimpleName() + \"] duration [\" + duration + \"] got exit-state [\" + exitState + \"]\");\n \t\t\t\t\t}\n \t\t\t\t}\n \t\t\t}\n \t\t}\n \t\treturn sendResult;\n \t}\n \t\n-\tprotected PipeRunResult sendTextMessage(Object input, IPipeLineSession session, String correlationID, ISender sender, Map<String,Object> threadContext, IOutputStreamingSupport next) throws SenderException, TimeOutException, IOException {\n+\tprotected PipeRunResult sendTextMessage(Message message, IPipeLineSession session, ISender sender, Map<String,Object> threadContext, IOutputStreamingSupport next) throws SenderException, TimeOutException, IOException {", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwODAwNg==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395608006", "bodyText": "Of zelfs weggooien?", "author": "nielsm5", "createdAt": "2020-03-20T12:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwNzgzNg=="}], "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\nindex 66d1780d9..3e560092b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\n\n@@ -877,14 +891,6 @@ public class MessageSendingPipe extends StreamingPipe implements HasSender, HasS\n \t\treturn sendResult;\n \t}\n \t\n-\tprotected PipeRunResult sendTextMessage(Message message, IPipeLineSession session, ISender sender, Map<String,Object> threadContext, IOutputStreamingSupport next) throws SenderException, TimeOutException, IOException {\n-\t\tif (sender instanceof IStreamingSender) {\n-\t\t\treturn ((IStreamingSender)sender).sendMessage(message, session, next);\n-\t\t}\n-\t\t// sendResult has a messageID for async senders, the result for sync senders\n-\t\tMessage result = sender.sendMessage(message, session);\n-\t\treturn new PipeRunResult(null,result.asString());\n-\t}\n \n \tpublic int increaseRetryIntervalAndWait(IPipeLineSession session, int retryInterval, String description) throws InterruptedException {\n \t\tlong currentInterval;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwOTI5MA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395609290", "bodyText": "Dit hoeft alleen in de\nif (\"json2xml\".equalsIgnoreCase(actualDirection)) {\nAnders raak je onnodige je stream kwijt", "author": "nielsm5", "createdAt": "2020-03-20T12:40:10Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/JsonPipe.java", "diffHunk": "@@ -60,18 +62,20 @@ public void configure() throws ConfigurationException {\n \t}\n \n \t@Override\n-\tpublic PipeRunResult doPipe(Object input, IPipeLineSession session) throws PipeRunException {\n+\tpublic PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n \n-\t\tif (input == null) {\n+\t\tif (message == null) {\n \t\t\tthrow new PipeRunException(this, getLogPrefix(session) + \"got null input\");\n \t\t}\n-\t\tif (!(input instanceof String)) {\n-\t\t\tthrow new PipeRunException(this, getLogPrefix(session)\n-\t\t\t\t\t+ \"got an invalid type as input, expected String, got \" + input.getClass().getName());\n+\t\tString input;\n+\t\ttry {\n+\t\t\tinput = message.asString();", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/JsonPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/JsonPipe.java\nindex 2cd1e1a14..9c83df9d7 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/JsonPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/JsonPipe.java\n\n@@ -67,19 +65,14 @@ public class JsonPipe extends FixedForwardPipe {\n \t\tif (message == null) {\n \t\t\tthrow new PipeRunException(this, getLogPrefix(session) + \"got null input\");\n \t\t}\n-\t\tString input;\n-\t\ttry {\n-\t\t\tinput = message.asString();\n-\t\t} catch (IOException e) {\n-\t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"cannot open stream\", e);\n-\t\t}\n \n \t\ttry {\n-\t\t\tString stringResult = input;\n+\t\t\tString stringResult=null;\n \t\t\tString actualDirection = getDirection();\n \t\t\tString actualVersion = getVersion();\n \t\t\t\n \t\t\tif (\"json2xml\".equalsIgnoreCase(actualDirection)) {\n+\t\t\t\tstringResult = message.asString();\n \t\t\t\tJSONTokener jsonTokener = new JSONTokener(stringResult);\n \t\t\t\tif (stringResult.startsWith(\"{\")) {\n \t\t\t\t\tJSONObject jsonObject = new JSONObject(jsonTokener);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYxMjg5Ng==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395612896", "bodyText": "onnodige  new Message(message) op regel 316", "author": "nielsm5", "createdAt": "2020-03-20T12:47:41Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/ForEachChildElementPipe.java", "diffHunk": "@@ -297,11 +297,17 @@ public void endElement(String uri, String localName, String qName) throws SAXExc\n \t}\n \n \t@Override\n-\tprotected void iterateOverInput(Object input, IPipeLineSession session, String correlationID, Map<String,Object> threadContext, ItemCallback callback) throws SenderException, TimeOutException {\n+\tprotected void iterateOverInput(Message input, IPipeLineSession session, Map<String,Object> threadContext, ItemCallback callback) throws SenderException, TimeOutException {\n \t\tInputSource src;\n \t\tif (isProcessFile()) {\n \t\t\ttry {\n-\t\t\t\tsrc = new InputSource(new FileInputStream((String)input));\n+\t\t\t\tString filename;\n+\t\t\t\ttry {\n+\t\t\t\t\tfilename = input.asString();\n+\t\t\t\t} catch (IOException e) {\n+\t\t\t\t\tthrow new SenderException(getLogPrefix(session)+\"cannot find filename\", e);\n+\t\t\t\t}\n+\t\t\t\tsrc = new InputSource(new FileInputStream(filename));\n \t\t\t} catch (FileNotFoundException e) {\n \t\t\t\tthrow new SenderException(\"could not find file [\"+input+\"]\",e);\n \t\t\t}", "originalCommit": "e4cad2f689cb43a7040ff686e0400f98c5aeea56", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/ForEachChildElementPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/ForEachChildElementPipe.java\nindex af068704f..1d85c19c0 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/ForEachChildElementPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/ForEachChildElementPipe.java\n\n@@ -313,7 +313,7 @@ public class ForEachChildElementPipe extends IteratingPipe<String> implements IT\n \t\t\t}\n \t\t} else {\n \t\t\ttry {\n-\t\t\t\tsrc = new Message(input).asInputSource();\n+\t\t\t\tsrc = input.asInputSource();\n \t\t\t} catch (IOException e) {\n \t\t\t\tthrow new SenderException(\"could not get InputSource\",e);\n \t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYxNjA3MQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395616071", "bodyText": "Boven de class ook nog Deprecated", "author": "nielsm5", "createdAt": "2020-03-20T12:53:58Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/Stream2StringPipe.java", "diffHunk": "@@ -16,30 +16,27 @@\n package nl.nn.adapterframework.pipes;\n \n import java.io.IOException;\n-import java.io.InputStream;\n \n import nl.nn.adapterframework.core.IPipeLineSession;\n import nl.nn.adapterframework.core.PipeRunException;\n import nl.nn.adapterframework.core.PipeRunResult;\n-import nl.nn.adapterframework.util.Misc;\n+import nl.nn.adapterframework.stream.Message;\n \n /**\n  * Return simply the input message from stream to string.\n  *\n  * @author  Tom van der Heijden\n+ * @deprecated not necessary when using Messages.\n  */\n-\n public class Stream2StringPipe extends FixedForwardPipe {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/Stream2StringPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/Stream2StringPipe.java\nindex 60766f283..85668bda4 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/Stream2StringPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/Stream2StringPipe.java\n\n@@ -28,6 +28,7 @@ import nl.nn.adapterframework.stream.Message;\n  * @author  Tom van der Heijden\n  * @deprecated not necessary when using Messages.\n  */\n+@Deprecated\n public class Stream2StringPipe extends FixedForwardPipe {\n \n \t@Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYxNzkxNA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395617914", "bodyText": "Overbodige Message message = new Message(input);", "author": "nielsm5", "createdAt": "2020-03-20T12:57:28Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/XsltPipe.java", "diffHunk": "@@ -99,7 +98,7 @@ public void stop() {\n \t}\n \t\n \t@Override\n-\tpublic PipeRunResult doPipe(Object input, IPipeLineSession session, IOutputStreamingSupport nextProvider) throws PipeRunException {\n+\tpublic PipeRunResult doPipe(Message input, IPipeLineSession session, IOutputStreamingSupport nextProvider) throws PipeRunException {\n \t\tif (input==null) {\n \t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"got null input\");\n \t\t}", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/XsltPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/XsltPipe.java\nindex 4f0fe74fc..c0754f77f 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/XsltPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/XsltPipe.java\n\n@@ -102,7 +102,6 @@ public class XsltPipe extends StreamingPipe implements IThreadCreator {\n \t\tif (input==null) {\n \t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"got null input\");\n \t\t}\n-\t\tMessage message = new Message(input);\n \t\ttry {\n \t\t\tif (StringUtils.isNotEmpty(getSessionKey())) {\n \t\t\t\tnextProvider=null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYyNTMyOQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395625329", "bodyText": "Daar is die dan eindelijk! Maar wat nu als je een SAXSource wilt hebben?\nKan String nu gedeprecate worden? (standaard staat resolveExternalEntities op false?)", "author": "nielsm5", "createdAt": "2020-03-20T13:11:35Z", "path": "core/src/main/java/nl/nn/adapterframework/util/TransformerPool.java", "diffHunk": "@@ -410,6 +411,10 @@ public String transform(Document d, Map<String,Object> parameters)\tthrows Transf\n \t\treturn transform(new DOMSource(d),parameters);\n \t}\n \n+\tpublic String transform(Message m, Map<String,Object> parameters) throws TransformerException, IOException, SAXException {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNjc4OQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395636789", "bodyText": "Het is meer dan ik liever niet wil dat we op meerdere plekken dingen bij moeten gaan houden.\nAls hij niet gedeprecate wordt, dan op zijn minst hier new Message(input)\nWe moeten van de vele transforms en stringToSourceForSingleUse 'converters' af.", "author": "nielsm5", "createdAt": "2020-03-20T13:31:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYyNTMyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc0OTEyMg==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395749122", "bodyText": "Ga ik nu nog even niet aanpassen. Later wel...", "author": "gvanbrakel", "createdAt": "2020-03-20T16:23:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYyNTMyOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYyNjYzMQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395626631", "bodyText": "Hoe kan hij hier in komen als de input al een Message is?", "author": "nielsm5", "createdAt": "2020-03-20T13:13:49Z", "path": "core/src/main/java/nl/nn/adapterframework/stream/Message.java", "diffHunk": "@@ -29,21 +30,29 @@\n import org.apache.commons.io.input.ReaderInputStream;\n import org.apache.log4j.Logger;\n import org.xml.sax.InputSource;\n+import org.xml.sax.SAXException;\n \n import nl.nn.adapterframework.util.LogUtil;\n import nl.nn.adapterframework.util.StreamUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class Message {\n \tprotected Logger log = LogUtil.getLogger(this);\n \n \tprivate Object request;\n \n \tpublic Message(Message request) {\n-\t\tthis.request = request.asObject();\n+\t\tif (request!=null) {\n+\t\t\tthis.request = request.asObject();\n+\t\t}\n \t}\n \n \tpublic Message(Object request) {\n-\t\tthis.request = request;\n+\t\tif (request instanceof Message) {\n+\t\t\tthis.request = ((Message)request).asObject();", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/stream/Message.java b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\nindex 20586ac25..f2f932632 100644\n--- a/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n+++ b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n\n@@ -25,7 +25,6 @@ import java.io.StringReader;\n import java.net.URL;\n \n import javax.xml.transform.Source;\n-import javax.xml.transform.stream.StreamSource;\n \n import org.apache.commons.io.input.ReaderInputStream;\n import org.apache.log4j.Logger;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYyOTkwNA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395629904", "bodyText": "ik weet dat het dit niet bij de change hoort maar kan dit appconstants geneuzel naar de configure?", "author": "nielsm5", "createdAt": "2020-03-20T13:19:39Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/WsdlGeneratorPipe.java", "diffHunk": "@@ -46,32 +48,31 @@ public void configure() throws ConfigurationException {\n \t}\n \n \t@Override\n-\tpublic PipeRunResult doPipe(Object input, IPipeLineSession session) throws PipeRunException {\n+\tpublic PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n \t\tString result = null;\n \t\tIAdapter adapter;\n-\t\tif (\"input\".equals(getFrom())) {\n-\t\t\tadapter = ((Adapter)getAdapter()).getConfiguration().getIbisManager().getRegisteredAdapter((String)input);\n-\t\t\tif (adapter == null) {\n-\t\t\t\tthrow new PipeRunException(this, \"Could not find adapter: \" + input);\n+\t\ttry {\n+\t\t\tif (\"input\".equals(getFrom())) {\n+\t\t\t\tString adapterName = message.asString();\n+\t\t\t\tadapter = ((Adapter)getAdapter()).getConfiguration().getIbisManager().getRegisteredAdapter(adapterName);\n+\t\t\t\tif (adapter == null) {\n+\t\t\t\t\tthrow new PipeRunException(this, \"Could not find adapter: \" + adapterName);\n+\t\t\t\t}\n+\t\t\t} else {\n+\t\t\t\tadapter = getPipeLine().getAdapter();\n \t\t\t}\n-\t\t} else {\n-\t\t\tadapter = getPipeLine().getAdapter();\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new PipeRunException(this, \"Could not determine adapter name\", e); \n \t\t}\n \t\ttry {\n \t\t\tWsdl wsdl = new Wsdl(((Adapter)adapter).getPipeLine());\n-\t\t\twsdl.setDocumentation(\"Generated at \"\n-\t\t\t\t+ AppConstants.getInstance().getResolvedProperty(\"dtap.stage\")\n-\t\t\t\t+ \"-\"\n-\t\t\t\t+ AppConstants.getInstance().getResolvedProperty(\"dtap.side\")\n-\t\t\t\t+ \" on \" + DateUtils.getIsoTimeStamp() + \".\");\n+\t\t\twsdl.setDocumentation(\"Generated at \" + AppConstants.getInstance().getResolvedProperty(\"dtap.stage\") + \"-\" + AppConstants.getInstance().getResolvedProperty(\"dtap.side\") + \" on \" + DateUtils.getIsoTimeStamp() + \".\");", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/WsdlGeneratorPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/WsdlGeneratorPipe.java\nindex a2617f1b0..2a048c9b7 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/WsdlGeneratorPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/WsdlGeneratorPipe.java\n\n@@ -45,6 +48,8 @@ public class WsdlGeneratorPipe extends FixedForwardPipe {\n \t\tif (!\"parent\".equals(getFrom()) && !\"input\".equals(getFrom())) {\n \t\t\tthrow new ConfigurationException(getLogPrefix(null) + \" from should either be parent or input\");\n \t\t}\n+\t\tdtapStage=AppConstants.getInstance().getResolvedProperty(\"dtap.stage\");\n+\t\tdtapSide=AppConstants.getInstance().getResolvedProperty(\"dtap.side\");\n \t}\n \n \t@Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMTU0Mw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395631543", "bodyText": "is het niet handiger als dit een Message is?", "author": "nielsm5", "createdAt": "2020-03-20T13:22:35Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/XmlValidator.java", "diffHunk": "@@ -265,12 +271,17 @@ protected PipeForward determineForward(String resultEvent, IPipeLineSession sess\n \t}\n \n \t@Deprecated\n-\tprivate String getMessageToValidate(Object input, IPipeLineSession session) throws PipeRunException {\n-\t\tString inputStr = input.toString();\n-\t\tif (XmlUtils.isWellFormed(inputStr, \"Envelope\")) {\n+\tprivate String getMessageToValidate(Message message, IPipeLineSession session) throws PipeRunException {\n+\t\tString input;\n+\t\ttry {\n+\t\t\tinput = message.asString();\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"cannot open stream\", e);\n+\t\t}\n+\t\tif (XmlUtils.isWellFormed(input, \"Envelope\")) {\n \t\t\tString inputRootNs;\n \t\t\ttry {\n-\t\t\t\tinputRootNs = transformerPoolGetRootNamespace.transform(inputStr, null);\n+\t\t\t\tinputRootNs = transformerPoolGetRootNamespace.transform(input, null);", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc1NDU4OQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395754589", "bodyText": "het is handiger als die hele method niet gebruikt wordt, dus als de deprecated attribute soapNamespace niet gebruikt wordt.", "author": "gvanbrakel", "createdAt": "2020-03-20T16:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzMTU0Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNDMxOQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395634319", "bodyText": "isWellFormed zou ook een Source aan moeten kunnen, maar dan moet hij wel gepersists zijn... hoe dan ook, beter om zo min mogelijk dingen heen en weer om te zetten.", "author": "nielsm5", "createdAt": "2020-03-20T13:27:14Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/XmlValidator.java", "diffHunk": "@@ -265,12 +271,17 @@ protected PipeForward determineForward(String resultEvent, IPipeLineSession sess\n \t}\n \n \t@Deprecated\n-\tprivate String getMessageToValidate(Object input, IPipeLineSession session) throws PipeRunException {\n-\t\tString inputStr = input.toString();\n-\t\tif (XmlUtils.isWellFormed(inputStr, \"Envelope\")) {\n+\tprivate String getMessageToValidate(Message message, IPipeLineSession session) throws PipeRunException {\n+\t\tString input;\n+\t\ttry {\n+\t\t\tinput = message.asString();\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"cannot open stream\", e);\n+\t\t}\n+\t\tif (XmlUtils.isWellFormed(input, \"Envelope\")) {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNTA2NA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395635064", "bodyText": "kan dit geen Message als input aan, in de onderliggende methode wordt een saxsource gemaakt", "author": "nielsm5", "createdAt": "2020-03-20T13:28:29Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/XmlWellFormedChecker.java", "diffHunk": "@@ -38,28 +42,35 @@\n  * @author  Peter Leeuwenburgh\n  * @since\t4.4.5\n  */\n-\n public class XmlWellFormedChecker extends FixedForwardPipe {\n \tprivate String root = null;\n \n+\t@Override\n \tpublic void configure() throws ConfigurationException {\n \t\tsuper.configure();\n \t\tregisterEvent(AbstractXmlValidator.XML_VALIDATOR_VALID_MONITOR_EVENT);\n \t\tregisterEvent(AbstractXmlValidator.XML_VALIDATOR_PARSER_ERROR_MONITOR_EVENT);\n \t}\n \n \n-\tpublic PipeRunResult doPipe(Object input, IPipeLineSession session) {\n-\t\tif (XmlUtils.isWellFormed(input.toString(), getRoot())) {\n+\t@Override\n+\tpublic PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n+\t\tString input;\n+\t\ttry {\n+\t\t\tinput = message.asString();\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new PipeRunException(this, getLogPrefix(session)+\"cannot open stream\", e);\n+\t\t}\n+\t\tif (XmlUtils.isWellFormed(input, getRoot())) {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc1ODI0MA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395758240", "bodyText": "Ja, maar niet een gewone Source, maar een SAXSource, was er aan begonnen en ben er na een zucht mee opgehouden.\nAndere keer.", "author": "gvanbrakel", "createdAt": "2020-03-20T16:37:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNTA2NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzODA3MA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395638070", "bodyText": "is message niet slim genoeg dat deze if else logica overbodig is?", "author": "nielsm5", "createdAt": "2020-03-20T13:33:28Z", "path": "core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java", "diffHunk": "@@ -159,15 +170,20 @@ public PipeLineResult processPipeLine(PipeLine pipeLine, String messageId, Strin\n \t\ttry {\n \t\t\twhile (!ready){\n \n-\t\t\t\tpipeRunResult = pipeProcessor.processPipe(pipeLine, pipeToRun, messageId, object, pipeLineSession);\n-\t\t\t\tobject=pipeRunResult.getResult();\n+\t\t\t\tpipeRunResult = pipeProcessor.processPipe(pipeLine, pipeToRun, messageId, message, pipeLineSession);\n+\t\t\t\tObject resultObject=pipeRunResult.getResult();\n+\t\t\t\tif (resultObject instanceof Message) {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\nindex 63c3d81a1..18703554b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n+++ b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n\n@@ -172,11 +172,7 @@ public class CorePipeLineProcessor implements PipeLineProcessor {\n \n \t\t\t\tpipeRunResult = pipeProcessor.processPipe(pipeLine, pipeToRun, messageId, message, pipeLineSession);\n \t\t\t\tObject resultObject=pipeRunResult.getResult();\n-\t\t\t\tif (resultObject instanceof Message) {\n-\t\t\t\t\tmessage = (Message)resultObject;\n-\t\t\t\t} else {\n-\t\t\t\t\tmessage = new Message(resultObject);\n-\t\t\t\t}\n+\t\t\t\tmessage = Message.asMessage(resultObject);\n \n \t\t\t\t// TODO: this should be moved to a StatisticsPipeProcessor\n \t\t\t\tif (!(pipeToRun instanceof AbstractPipe)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzODMxMg==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395638312", "bodyText": "Is message niet slim genoeg dat deze logica overbodig is?", "author": "nielsm5", "createdAt": "2020-03-20T13:33:51Z", "path": "core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java", "diffHunk": "@@ -103,8 +108,7 @@ public PipeLineResult processPipeLine(PipeLine pipeLine, String messageId, Strin\n \t\t\t\t}\n \t\t\t\tObject validatedMessage = validationResult.getResult();\n \t\t\t\tif (validatedMessage!=null) {\n-\t\t\t\t\tobject=validatedMessage;\n-\t\t\t\t\tmessage=validatedMessage.toString();\n+\t\t\t\t\tmessage=(validatedMessage instanceof Message)?(Message)validatedMessage:new Message(validatedMessage);", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\nindex 63c3d81a1..18703554b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n+++ b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n\n@@ -108,7 +108,7 @@ public class CorePipeLineProcessor implements PipeLineProcessor {\n \t\t\t\t}\n \t\t\t\tObject validatedMessage = validationResult.getResult();\n \t\t\t\tif (validatedMessage!=null) {\n-\t\t\t\t\tmessage=(validatedMessage instanceof Message)?(Message)validatedMessage:new Message(validatedMessage);\n+\t\t\t\t\tmessage=Message.asMessage(validatedMessage);\n \t\t\t\t}\n \t\t\t}\n \t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzODk2OA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395638968", "bodyText": "Hier weer?", "author": "nielsm5", "createdAt": "2020-03-20T13:35:02Z", "path": "core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java", "diffHunk": "@@ -228,7 +249,12 @@ public PipeLineResult processPipeLine(PipeLine pipeLine, String messageId, Strin\n \t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tlog.debug(\"validation succeeded\");\n-\t\t\t\t\t\t\t\tobject = validationResult.getResult();\n+\t\t\t\t\t\t\t\tObject validatedObject = validationResult.getResult();\n+\t\t\t\t\t\t\t\tif (validatedObject instanceof Message) {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\nindex 63c3d81a1..18703554b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n+++ b/core/src/main/java/nl/nn/adapterframework/processors/CorePipeLineProcessor.java\n\n@@ -250,11 +242,7 @@ public class CorePipeLineProcessor implements PipeLineProcessor {\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tlog.debug(\"validation succeeded\");\n \t\t\t\t\t\t\t\tObject validatedObject = validationResult.getResult();\n-\t\t\t\t\t\t\t\tif (validatedObject instanceof Message) {\n-\t\t\t\t\t\t\t\t\tmessage = (Message)validatedObject;\n-\t\t\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\t\t\tmessage = new Message(validatedObject);\n-\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\tmessage = Message.asMessage(validatedObject);\n \t\t\t\t\t\t\t\tready=true;\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t} else {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzOTgxMw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395639813", "bodyText": "Waarom een string? alles moet gewoon message blijven", "author": "nielsm5", "createdAt": "2020-03-20T13:36:24Z", "path": "core/src/main/java/nl/nn/adapterframework/soap/SoapWrapperPipe.java", "diffHunk": "@@ -202,47 +202,45 @@ public void stop() {\n \t\t}\n \t}\n \n-    @Override\n-\tpublic PipeRunResult doPipe(Object input, IPipeLineSession session) throws PipeRunException {\n+\t@Override\n+\tpublic PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n \t\tString result;\n \t\ttry {\n \t\t\tif (\"wrap\".equalsIgnoreCase(getDirection())) {\n-\t\t\t\tString payload = input.toString();\n+\t\t\t\tString payload = message.asString();", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2MDU5MQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395760591", "bodyText": "maar hij word in een reeks ifjes doorgegeven.\nMoet uiteindelijk met zoiets als een reeks XmlFilters opgelost worden.", "author": "gvanbrakel", "createdAt": "2020-03-20T16:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzOTgxMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0MTE4OA==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395641188", "bodyText": "Had je niet een getTestFileMessage in je vorige commit?", "author": "nielsm5", "createdAt": "2020-03-20T13:38:38Z", "path": "core/src/test/java/nl/nn/adapterframework/util/FileHandlerTestBase.java", "diffHunk": "@@ -162,7 +163,7 @@ public void testWrite(String directory, String filename, String suffix, boolean\n \t\thandler.setWriteLineSeparator(writeSeparator);\n \t\thandler.configure();\n \n-\t\tString contents=getTestFile(contentFile, charset);\n+\t\tMessage contents=new Message(getTestFile(contentFile, charset));", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/util/FileHandlerTestBase.java b/core/src/test/java/nl/nn/adapterframework/util/FileHandlerTestBase.java\nindex 5c2b6936d..2934cf070 100644\n--- a/core/src/test/java/nl/nn/adapterframework/util/FileHandlerTestBase.java\n+++ b/core/src/test/java/nl/nn/adapterframework/util/FileHandlerTestBase.java\n\n@@ -163,7 +159,7 @@ public abstract class FileHandlerTestBase {\n \t\thandler.setWriteLineSeparator(writeSeparator);\n \t\thandler.configure();\n \n-\t\tMessage contents=new Message(getTestFile(contentFile, charset));\n+\t\tMessage contents=TestFileUtils.getTestFileMessage(BASEDIR+contentFile, charset);\n \t\tString actFilename=(String)handler.handle(contents,session,paramList);\n \t\tif (filename==null) {\n \t\t\tassertNotNull(actFilename);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0MjI0NQ==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395642245", "bodyText": "het is een beetje onzinnen hier pipe ook mee te geven?", "author": "nielsm5", "createdAt": "2020-03-20T13:40:20Z", "path": "core/src/test/java/nl/nn/adapterframework/pipes/XmlIfTest.java", "diffHunk": "@@ -37,7 +37,7 @@ public void nullXPathExpressionTest() throws ConfigurationException, PipeStartEx\n \t\tpipe.configure();\n \t\tpipe.start();\n \n-\t\tPipeRunResult pipeRunResult = pipe.doPipe(\"<test\", session);\n+\t\tPipeRunResult pipeRunResult = doPipe(pipe, \"<test\", session);", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTc2MzQ3Nw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395763477", "bodyText": "behalve als je zelf een pipe wil maken", "author": "gvanbrakel", "createdAt": "2020-03-20T16:46:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0MjI0NQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0MzQ5Ng==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395643496", "bodyText": "Pipe hoef je niet mee te geven...", "author": "nielsm5", "createdAt": "2020-03-20T13:42:21Z", "path": "core/src/test/java/nl/nn/adapterframework/pipes/PipeTestBase.java", "diffHunk": "@@ -72,9 +74,12 @@ protected void configureAdapter() throws ConfigurationException {\n \t * use this method to execute pipe, instead of calling pipe.doPipe directly. This allows for \n \t * integrated testing of streaming.\n \t */\n-\tprotected PipeRunResult doPipe(P pipe, Object input, IPipeLineSession session) throws Exception {\n+\tprotected PipeRunResult doPipe(P pipe, Message input, IPipeLineSession session) throws PipeRunException {", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/pipes/PipeTestBase.java b/core/src/test/java/nl/nn/adapterframework/pipes/PipeTestBase.java\nindex 7ad5ec4fc..3704d0f18 100644\n--- a/core/src/test/java/nl/nn/adapterframework/pipes/PipeTestBase.java\n+++ b/core/src/test/java/nl/nn/adapterframework/pipes/PipeTestBase.java\n\n@@ -79,7 +79,7 @@ public abstract class PipeTestBase<P extends IPipe> {\n \t}\n \t\n \tprotected PipeRunResult doPipe(P pipe, Object input, IPipeLineSession session) throws PipeRunException {\n-\t\treturn doPipe(pipe, new Message(input), session);\n+\t\treturn doPipe(pipe, Message.asMessage(input), session);\n \t}\n \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY0Njg2Ng==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r395646866", "bodyText": "Waarom staat dit uit?", "author": "nielsm5", "createdAt": "2020-03-20T13:47:34Z", "path": "core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java", "diffHunk": "@@ -14,111 +14,107 @@\n import nl.nn.adapterframework.parameters.Parameter;\n import nl.nn.adapterframework.testutil.TestFileUtils;\n \n-public class Json2XmlValidatorTest {\n+public class Json2XmlValidatorTest extends PipeTestBase<Json2XmlValidator> {\n \n-\t@Test\n-\tpublic void testNoNamespaceXml2Json() throws Exception {\n-\t\tJson2XmlValidator validator = new Json2XmlValidator();\n-\t\t\n-\t\tvalidator.setName(\"Response_To_Json\");\n-\t\tvalidator.setOutputFormat(\"json\");\n-\t\tvalidator.setSchema(\"/Validation/NoNamespace/bp.xsd\");\n-//\t\tvalidator.setRoot(\"GetPartiesOnAgreement_Response\");\n-//\t\tvalidator.setTargetNamespace(\"http://nn.nl/XSD/CustomerAdministration/Party/1/GetPartiesOnAgreement/7\");\n-\t\tvalidator.setThrowException(true);\n-\t\tvalidator.registerForward(new PipeForward(\"success\",null));\n-\t\tvalidator.configure();\n-\t\tvalidator.start();\n-\t\t\n-\t\tString input = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response.xml\");\n-\t\tString expected = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");\n-\t\t\n-\t\tPipeLineSessionBase session = new PipeLineSessionBase();\n-\t\ttry {\n-\t\t\tPipeRunResult prr = validator.doPipe(input,session);\n-\t\t\tfail(\"expected to fail\");\n-\t\t} catch (PipeRunException e) {\n-\t\t\tassertThat(e.getMessage(),StringContains.containsString(\"Cannot find the declaration of element 'BusinessPartner'\"));\n-\t\t}\n+\t@Override\n+\tpublic Json2XmlValidator createPipe() {\n+\t\treturn new Json2XmlValidator();\n \t}\n \n \t@Test\n-\tpublic void testNoNamespaceXml() throws Exception {\n-\t\tXmlValidator validator = new XmlValidator();\n-\t\t\n-\t\tvalidator.setName(\"Response_Validator\");\n-\t\tvalidator.setSchema(\"/Validation/NoNamespace/bp.xsd\");\n-//\t\tvalidator.setRoot(\"GetPartiesOnAgreement_Response\");\n-//\t\tvalidator.setTargetNamespace(\"http://nn.nl/XSD/CustomerAdministration/Party/1/GetPartiesOnAgreement/7\");\n-\t\tvalidator.setThrowException(true);\n-\t\tvalidator.registerForward(new PipeForward(\"success\",null));\n-\t\tvalidator.configure();\n-\t\tvalidator.start();\n+\tpublic void testNoNamespaceXml2Json() throws Exception {\n+\t\tpipe.setName(\"Response_To_Json\");\n+\t\tpipe.setOutputFormat(\"json\");\n+\t\tpipe.setSchema(\"/Validation/NoNamespace/bp.xsd\");\n+//\t\tpipe.setRoot(\"GetPartiesOnAgreement_Response\");\n+//\t\tpipe.setTargetNamespace(\"http://nn.nl/XSD/CustomerAdministration/Party/1/GetPartiesOnAgreement/7\");\n+\t\tpipe.setThrowException(true);\n+\t\tpipe.configure();\n+\t\tpipe.start();\n \t\t\n \t\tString input = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response.xml\");\n \t\tString expected = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");\n \t\t\n \t\tPipeLineSessionBase session = new PipeLineSessionBase();\n \t\ttry {\n-\t\t\tPipeRunResult prr = validator.doPipe(input,session);\n+\t\t\tPipeRunResult prr = doPipe(pipe, input,session);\n \t\t\tfail(\"expected to fail\");\n \t\t} catch (PipeRunException e) {\n \t\t\tassertThat(e.getMessage(),StringContains.containsString(\"Cannot find the declaration of element 'BusinessPartner'\"));\n \t\t}\n \t}\n \n+//\t@Test", "originalCommit": "3a758270a6735072e5e64c380be6f56040276076", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "203f09feb02661689efb7ba50b57ab362fad43d8", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java b/core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java\nindex 8d8e32584..c54d5b493 100644\n--- a/core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java\n+++ b/core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java\n\n@@ -12,6 +12,7 @@ import nl.nn.adapterframework.core.PipeLineSessionBase;\n import nl.nn.adapterframework.core.PipeRunException;\n import nl.nn.adapterframework.core.PipeRunResult;\n import nl.nn.adapterframework.parameters.Parameter;\n+import nl.nn.adapterframework.stream.Message;\n import nl.nn.adapterframework.testutil.TestFileUtils;\n \n public class Json2XmlValidatorTest extends PipeTestBase<Json2XmlValidator> {\n"}}, {"oid": "203f09feb02661689efb7ba50b57ab362fad43d8", "url": "https://github.com/ibissource/iaf/commit/203f09feb02661689efb7ba50b57ab362fad43d8", "message": "processed comments", "committedDate": "2020-03-23T17:47:30Z", "type": "commit"}, {"oid": "41e5a4413505736bf26fec9595308d8188832471", "url": "https://github.com/ibissource/iaf/commit/41e5a4413505736bf26fec9595308d8188832471", "message": "Dangling changing", "committedDate": "2020-03-23T17:48:42Z", "type": "commit"}, {"oid": "3931f38dff6290a2703109fed2e616def306c732", "url": "https://github.com/ibissource/iaf/commit/3931f38dff6290a2703109fed2e616def306c732", "message": "RhinoPipe clean up and deprecation", "committedDate": "2020-03-24T07:28:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzExOTgxNw==", "url": "https://github.com/ibissource/iaf/pull/518#discussion_r397119817", "bodyText": "Zou nog mooier zijn als je hier Message.asMessage gebruikt", "author": "nielsm5", "createdAt": "2020-03-24T12:38:22Z", "path": "core/src/main/java/nl/nn/adapterframework/stream/Message.java", "diffHunk": "@@ -234,4 +267,104 @@ public String toString() {\n \t\treturn request.getClass().getSimpleName()+\": \"+request.toString();\n \t}\n \n+\tpublic static Message asMessage(Object object) {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn (Message)object;\n+\t\t}\n+\t\treturn new Message(object);\n+\t}\n+\t\n+\tpublic static Reader asReader(Object object) throws IOException {\n+\t\treturn asReader(object, StreamUtil.DEFAULT_INPUT_STREAM_ENCODING);\n+\t}\n+\tpublic static Reader asReader(Object object, String defaultCharset) throws IOException {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof Reader) {\n+\t\t\treturn (Reader)object;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn ((Message)object).asReader(defaultCharset);\n+\t\t}\n+\t\treturn new Message(object).asReader(defaultCharset);\n+\t}\n+\t\n+\tpublic static InputStream asInputStream(Object object) throws IOException {\n+\t\treturn asInputStream(object, StreamUtil.DEFAULT_INPUT_STREAM_ENCODING);\n+\t}\n+\tpublic static InputStream asInputStream(Object object, String defaultCharset) throws IOException {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof InputStream) {\n+\t\t\treturn (InputStream)object;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn ((Message)object).asInputStream(defaultCharset);\n+\t\t}\n+\t\treturn new Message(object).asInputStream(defaultCharset);\n+\t}\n+\t\n+\tpublic static InputSource asInputSource(Object object) throws IOException {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof InputSource) {\n+\t\t\treturn (InputSource)object;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn ((Message)object).asInputSource();\n+\t\t}\n+\t\treturn new Message(object).asInputSource();\n+\t}\n+\t\n+\tpublic static Source asSource(Object object) throws IOException, SAXException  {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof Source) {\n+\t\t\treturn (Source)object;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn ((Message)object).asSource();\n+\t\t}\n+\t\treturn new Message(object).asSource();\n+\t}\n+\t\n+\tpublic static String asString(Object object) throws IOException {\n+\t\treturn asString(object, StreamUtil.DEFAULT_INPUT_STREAM_ENCODING);\n+\t}\n+\tpublic static String asString(Object object, String defaultCharset) throws IOException {\n+\t\tif (object==null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\tif (object instanceof String) {\n+\t\t\treturn (String)object;\n+\t\t}\n+\t\tif (object instanceof Message) {\n+\t\t\treturn ((Message)object).asString();", "originalCommit": "3931f38dff6290a2703109fed2e616def306c732", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "23d3d6c28f9f1451927b4812556b144e8497d2d1", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/stream/Message.java b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\nindex f2f932632..a5fd64f5e 100644\n--- a/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n+++ b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n\n@@ -278,7 +293,7 @@ public class Message {\n \t}\n \t\n \tpublic static Reader asReader(Object object) throws IOException {\n-\t\treturn asReader(object, StreamUtil.DEFAULT_INPUT_STREAM_ENCODING);\n+\t\treturn asReader(object, null);\n \t}\n \tpublic static Reader asReader(Object object, String defaultCharset) throws IOException {\n \t\tif (object==null) {\n"}}, {"oid": "23d3d6c28f9f1451927b4812556b144e8497d2d1", "url": "https://github.com/ibissource/iaf/commit/23d3d6c28f9f1451927b4812556b144e8497d2d1", "message": "Optimize Message", "committedDate": "2020-03-24T13:13:21Z", "type": "commit"}]}