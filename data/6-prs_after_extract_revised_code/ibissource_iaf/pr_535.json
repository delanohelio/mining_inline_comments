{"pr_number": 535, "pr_title": "Cleanup HttpSenderBase", "pr_createdAt": "2020-03-24T17:50:15Z", "pr_url": "https://github.com/ibissource/iaf/pull/535", "timeline": [{"oid": "6dbc019a9c075d575477a391af4d11348c1aa2fe", "url": "https://github.com/ibissource/iaf/commit/6dbc019a9c075d575477a391af4d11348c1aa2fe", "message": "Add tests for Akamai, cleanup HttpSenderBase", "committedDate": "2020-03-24T17:48:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczODA5NQ==", "url": "https://github.com/ibissource/iaf/pull/535#discussion_r397738095", "bodyText": "Toch wel netjes om van deze \"urlParam\" en constante te maken, en misschien zelfs configureerbaar (als er conflicten zouden kunnen ontstaan)", "author": "gvanbrakel", "createdAt": "2020-03-25T10:09:20Z", "path": "akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java", "diffHunk": "@@ -162,14 +164,14 @@ public Message sendMessage(Message message, IPipeLineSession session) throws Sen\n \t\t} catch (IOException e) {\n \t\t\tthrow new SenderException(getLogPrefix(),e);\n \t\t}\n-\t\tstaticUri = buildUri(path); // TODO: this is not thread safe!\n+\t\tsession.put(\"urlParam\", path);", "originalCommit": "6dbc019a9c075d575477a391af4d11348c1aa2fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc1MTMyNA==", "url": "https://github.com/ibissource/iaf/pull/535#discussion_r397751324", "bodyText": "Het wordt nu als Parameter meegegeven aan de sender, dynamischer kan het niet", "author": "nielsm5", "createdAt": "2020-03-25T10:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczODA5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "c9fedc0b3070b2b75117d4b2767121d6d3e92c5a", "chunk": "diff --git a/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java b/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\nindex 0069a462a..be9eb8372 100644\n--- a/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\n+++ b/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\n\n@@ -164,7 +167,9 @@ public class NetStorageSender extends HttpSenderBase {\n \t\t} catch (IOException e) {\n \t\t\tthrow new SenderException(getLogPrefix(),e);\n \t\t}\n-\t\tsession.put(\"urlParam\", path);\n+\t\t//Store the input in the IPipeLineSession, so it can be resolved as ParameterValue.\n+\t\t//See {@link HttpSenderBase#getURI getURI(..)} how this is resolved\n+\t\tsession.put(URL_PARAM_KEY, path);\n \n \t\t//We don't need to send any message to the HttpSenderBase\n \t\treturn super.sendMessage(new Message(\"\"), session);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczOTEyMA==", "url": "https://github.com/ibissource/iaf/pull/535#discussion_r397739120", "bodyText": "Waarom is dit een parameter? Om hem te kunnen overriden? Ik snap eigenlijk niet wat er gebeurt", "author": "gvanbrakel", "createdAt": "2020-03-25T10:11:07Z", "path": "akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java", "diffHunk": "@@ -96,6 +96,11 @@\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n+\t\tParameter urlParameter = new Parameter();\n+\t\turlParameter.setName(getUrlParam());\n+\t\turlParameter.setSessionKey(\"urlParam\");\n+\t\taddParameter(urlParameter);", "originalCommit": "6dbc019a9c075d575477a391af4d11348c1aa2fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc1MjAwNQ==", "url": "https://github.com/ibissource/iaf/pull/535#discussion_r397752005", "bodyText": "Het kan geen constante zijn, dan is het niet thread safe... vandaar dat het inputbericht altijd 'automatisch' naar de url parameter veranderd wordt.", "author": "nielsm5", "createdAt": "2020-03-25T10:32:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzczOTEyMA=="}], "type": "inlineReview", "revised_code": {"commit": "c9fedc0b3070b2b75117d4b2767121d6d3e92c5a", "chunk": "diff --git a/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java b/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\nindex 0069a462a..be9eb8372 100644\n--- a/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\n+++ b/akamai/src/main/java/nl/nn/adapterframework/extensions/akamai/NetStorageSender.java\n\n@@ -96,9 +97,11 @@ public class NetStorageSender extends HttpSenderBase {\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n+\t\t//The HttpSenderBase dictates that you must use a Parameter with 'getUrlParam()' as name to use a dynamic endpoint.\n+\t\t//In order to not force everyone to use the URL parameter but instead the input of the sender as 'dynamic' path, this exists.\n \t\tParameter urlParameter = new Parameter();\n \t\turlParameter.setName(getUrlParam());\n-\t\turlParameter.setSessionKey(\"urlParam\");\n+\t\turlParameter.setSessionKey(URL_PARAM_KEY);\n \t\taddParameter(urlParameter);\n \n \t\tsuper.configure();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc0MDI5NA==", "url": "https://github.com/ibissource/iaf/pull/535#discussion_r397740294", "bodyText": "Ik doe in voorkomende gevallen: Copyright 2020 WeAreFrank!, dus niet .nl, maar met uitroepteken.", "author": "gvanbrakel", "createdAt": "2020-03-25T10:13:04Z", "path": "akamai/src/test/java/nl/nn/adapterframework/extensions/akamai/NetStorageSenderTest.java", "diffHunk": "@@ -0,0 +1,116 @@\n+/*\n+   Copyright 2020 WeAreFrank.nl", "originalCommit": "6dbc019a9c075d575477a391af4d11348c1aa2fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2fd7d2836eee096baf150dbeeacbc9a5af8a3717", "chunk": "diff --git a/akamai/src/test/java/nl/nn/adapterframework/extensions/akamai/NetStorageSenderTest.java b/akamai/src/test/java/nl/nn/adapterframework/extensions/akamai/NetStorageSenderTest.java\nindex 5ba95e27b..6c7993fdf 100644\n--- a/akamai/src/test/java/nl/nn/adapterframework/extensions/akamai/NetStorageSenderTest.java\n+++ b/akamai/src/test/java/nl/nn/adapterframework/extensions/akamai/NetStorageSenderTest.java\n\n@@ -1,5 +1,5 @@\n /*\n-   Copyright 2020 WeAreFrank.nl\n+   Copyright 2020 WeAreFrank!\n \n    Licensed under the Apache License, Version 2.0 (the \"License\");\n    you may not use this file except in compliance with the License.\n"}}, {"oid": "2fd7d2836eee096baf150dbeeacbc9a5af8a3717", "url": "https://github.com/ibissource/iaf/commit/2fd7d2836eee096baf150dbeeacbc9a5af8a3717", "message": "Change copyright info", "committedDate": "2020-03-25T10:35:51Z", "type": "commit"}, {"oid": "c9fedc0b3070b2b75117d4b2767121d6d3e92c5a", "url": "https://github.com/ibissource/iaf/commit/c9fedc0b3070b2b75117d4b2767121d6d3e92c5a", "message": "Fix javadoc and add comments", "committedDate": "2020-03-25T10:47:00Z", "type": "commit"}]}