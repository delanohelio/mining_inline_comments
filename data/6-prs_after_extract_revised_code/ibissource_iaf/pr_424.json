{"pr_number": 424, "pr_title": "Improve AdapterFramework.xsd and enable it to be found by digester", "pr_createdAt": "2020-02-18T15:19:27Z", "pr_url": "https://github.com/ibissource/iaf/pull/424", "timeline": [{"oid": "712b97d9c9a4c515806d5bc07af807e042734601", "url": "https://github.com/ibissource/iaf/commit/712b97d9c9a4c515806d5bc07af807e042734601", "message": "Improve AdapterFramework.xsd and enable it to be found by digester", "committedDate": "2020-02-18T15:19:00Z", "type": "commit"}, {"oid": "d5955704946e60b9789ed789ce47f839175d7a57", "url": "https://github.com/ibissource/iaf/commit/d5955704946e60b9789ed789ce47f839175d7a57", "message": "Merge branch 'master' into EnableConfigurationSchemaChecking", "committedDate": "2020-04-28T10:08:37Z", "type": "commit"}, {"oid": "c61a17045fa6bd0fe67a05876cf18d26f9c07be4", "url": "https://github.com/ibissource/iaf/commit/c61a17045fa6bd0fe67a05876cf18d26f9c07be4", "message": "Activate configuration validation, rename uglify to canonicalize", "committedDate": "2020-04-28T14:22:14Z", "type": "commit"}, {"oid": "54f0047f8804c377649ae853e7d2f0cba184b114", "url": "https://github.com/ibissource/iaf/commit/54f0047f8804c377649ae853e7d2f0cba184b114", "message": "revert format of monitoring config", "committedDate": "2020-04-28T14:24:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3OTU5Nw==", "url": "https://github.com/ibissource/iaf/pull/424#discussion_r418479597", "bodyText": "Zullen we getTweakedConfiguration ook hernoemen? Hij Tweaked niets?", "author": "nielsm5", "createdAt": "2020-05-01T09:39:18Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java", "diffHunk": "@@ -99,13 +99,11 @@ public static String getActivatedConfiguration(Configuration configuration, Stri\n \t\treturn getTweakedConfiguration(configuration, originalConfig, ACTIVE_XSLT, null);\n \t}\n \n-\tpublic static String getUglifiedConfiguration(Configuration configuration, String originalConfig) throws ConfigurationException {\n-\t\treturn getTweakedConfiguration(configuration, originalConfig, UGLIFY_XSLT, null);\n+\tpublic static String getCanonicalizedConfiguration(Configuration configuration, String originalConfig) throws ConfigurationException {\n+\t\treturn getTweakedConfiguration(configuration, originalConfig, CANONINICALIZE_XSLT, null);", "originalCommit": "54f0047f8804c377649ae853e7d2f0cba184b114", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUxODk0MQ==", "url": "https://github.com/ibissource/iaf/pull/424#discussion_r418518941", "bodyText": "De getStubbedConfiguration, getActivatedConfiguration en getUglifiedConfiguration zijn min of meer voorbeelden van tweaks. De term is ontstaan toen we voor HEC migratie custom tweaks op de configs toe pasten. Het idee was/is om er iets generieks van te maken en ontwikkelaars in staat te stellen 1 of meerdere tweaks op hun configuratie te doen. De getStubbedConfiguration, getActivatedConfiguration en getUglifiedConfiguration zijn dan standaard/ingebouwde tweaks maar een Frank! ontwikkelaar zou zijn eigen tweak ook nog toe kunnen voegen.", "author": "jacodg", "createdAt": "2020-05-01T12:19:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3OTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYzNzQ0NA==", "url": "https://github.com/ibissource/iaf/pull/424#discussion_r418637444", "bodyText": "Mijn idee was ook om bij de show configuration alle verschillende transformaties te laten zien, dus niet alleen Original Configuration en Loaded Configuration maar een tabje voor het restultaat van iedere \"ConfigTweak\".", "author": "jacodg", "createdAt": "2020-05-01T17:09:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3OTU5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "daa5eab776c5786e368177b5d8b728fa037aaeff", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java b/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\nindex 3042cf30d..c129fdc62 100644\n--- a/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\n+++ b/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\n\n@@ -92,36 +92,36 @@ public class ConfigurationUtils {\n \t\t// Parameter disableValidators has been used to test the impact of\n \t\t// validators on memory usage.\n \t\tparameters.put(\"disableValidators\", AppConstants.getInstance(configuration.getClassLoader()).getBoolean(STUB4TESTTOOL_VALIDATORS_DISABLED_KEY, false));\n-\t\treturn getTweakedConfiguration(configuration, originalConfig, STUB4TESTTOOL_XSLT, parameters);\n+\t\treturn transformConfiguration(configuration, originalConfig, STUB4TESTTOOL_XSLT, parameters);\n \t}\n \n \tpublic static String getActivatedConfiguration(Configuration configuration, String originalConfig) throws ConfigurationException {\n-\t\treturn getTweakedConfiguration(configuration, originalConfig, ACTIVE_XSLT, null);\n+\t\treturn transformConfiguration(configuration, originalConfig, ACTIVE_XSLT, null);\n \t}\n \n \tpublic static String getCanonicalizedConfiguration(Configuration configuration, String originalConfig) throws ConfigurationException {\n-\t\treturn getTweakedConfiguration(configuration, originalConfig, CANONINICALIZE_XSLT, null);\n+\t\treturn transformConfiguration(configuration, originalConfig, CANONICALIZE_XSLT, null);\n \t}\n \n-\tpublic static String getTweakedConfiguration(Configuration configuration, String originalConfig, String tweakXslt, Map<String, Object> parameters) throws ConfigurationException {\n-\t\tURL tweak_xsltSource = ClassUtils.getResourceURL(configuration.getClassLoader(), tweakXslt);\n-\t\tif (tweak_xsltSource == null) {\n-\t\t\tthrow new ConfigurationException(\"cannot find resource [\" + tweakXslt + \"]\");\n+\tpublic static String transformConfiguration(Configuration configuration, String originalConfig, String xslt, Map<String, Object> parameters) throws ConfigurationException {\n+\t\tURL xsltSource = ClassUtils.getResourceURL(configuration.getClassLoader(), xslt);\n+\t\tif (xsltSource == null) {\n+\t\t\tthrow new ConfigurationException(\"cannot find resource [\" + xslt + \"]\");\n \t\t}\n \t\ttry {\n-\t\t\tTransformer tweak_transformer = XmlUtils.createTransformer(tweak_xsltSource);\n-\t\t\tXmlUtils.setTransformerParameters(tweak_transformer, parameters);\n+\t\t\tTransformer transformer = XmlUtils.createTransformer(xsltSource);\n+\t\t\tXmlUtils.setTransformerParameters(transformer, parameters);\n \t\t\t// Use namespaceAware=true, otherwise for some reason the\n \t\t\t// transformation isn't working with a SAXSource, in system out it\n \t\t\t// generates:\n \t\t\t// jar:file: ... .jar!/xml/xsl/active.xsl; Line #34; Column #13; java.lang.NullPointerException\n-\t\t\treturn XmlUtils.transformXml(tweak_transformer, originalConfig, true);\n+\t\t\treturn XmlUtils.transformXml(transformer, originalConfig, true);\n \t\t} catch (IOException e) {\n-\t\t\tthrow new ConfigurationException(\"cannot retrieve [\" + tweakXslt + \"]\", e);\n+\t\t\tthrow new ConfigurationException(\"cannot retrieve [\" + xslt + \"]\", e);\n \t\t} catch (SAXException|TransformerConfigurationException e) {\n-\t\t\tthrow new ConfigurationException(\"got error creating transformer from file [\" + tweakXslt + \"]\", e);\n+\t\t\tthrow new ConfigurationException(\"got error creating transformer from file [\" + xslt + \"]\", e);\n \t\t} catch (TransformerException te) {\n-\t\t\tthrow new ConfigurationException(\"got error transforming resource [\" + tweak_xsltSource.toString() + \"] from [\" + tweakXslt + \"]\", te);\n+\t\t\tthrow new ConfigurationException(\"got error transforming resource [\" + xsltSource.toString() + \"] from [\" + xslt + \"]\", te);\n \t\t}\n \t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3OTY1OA==", "url": "https://github.com/ibissource/iaf/pull/424#discussion_r418479658", "bodyText": "NINI ?", "author": "nielsm5", "createdAt": "2020-05-01T09:39:35Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java", "diffHunk": "@@ -72,7 +72,7 @@\n \tprivate static final String STUB4TESTTOOL_VALIDATORS_DISABLED_KEY = \"validators.disabled\";\n \tprivate static final String STUB4TESTTOOL_XSLT = \"/xml/xsl/stub4testtool.xsl\";\n \tprivate static final String ACTIVE_XSLT = \"/xml/xsl/active.xsl\";\n-\tprivate static final String UGLIFY_XSLT = \"/xml/xsl/uglify.xsl\";\n+\tprivate static final String CANONINICALIZE_XSLT = \"/xml/xsl/canonicalize.xsl\";", "originalCommit": "54f0047f8804c377649ae853e7d2f0cba184b114", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "daa5eab776c5786e368177b5d8b728fa037aaeff", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java b/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\nindex 3042cf30d..c129fdc62 100644\n--- a/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\n+++ b/core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationUtils.java\n\n@@ -72,7 +72,7 @@ public class ConfigurationUtils {\n \tprivate static final String STUB4TESTTOOL_VALIDATORS_DISABLED_KEY = \"validators.disabled\";\n \tprivate static final String STUB4TESTTOOL_XSLT = \"/xml/xsl/stub4testtool.xsl\";\n \tprivate static final String ACTIVE_XSLT = \"/xml/xsl/active.xsl\";\n-\tprivate static final String CANONINICALIZE_XSLT = \"/xml/xsl/canonicalize.xsl\";\n+\tprivate static final String CANONICALIZE_XSLT = \"/xml/xsl/canonicalize.xsl\";\n \tprivate static final AppConstants APP_CONSTANTS = AppConstants.getInstance();\n \tprivate static final boolean CONFIG_AUTO_DB_CLASSLOADER = APP_CONSTANTS.getBoolean(\"configurations.autoDatabaseClassLoader\", false);\n \tprivate static final boolean CONFIG_AUTO_FS_CLASSLOADER = APP_CONSTANTS.getBoolean(\"configurations.directory.autoLoad\", false);\n"}}, {"oid": "daa5eab776c5786e368177b5d8b728fa037aaeff", "url": "https://github.com/ibissource/iaf/commit/daa5eab776c5786e368177b5d8b728fa037aaeff", "message": "fix typo, rename getTweakedConfiguaration into transformConfiguration", "committedDate": "2020-05-01T10:19:08Z", "type": "commit"}]}