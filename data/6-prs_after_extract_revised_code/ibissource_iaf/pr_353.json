{"pr_number": 353, "pr_title": "Fix systemId containing basePath when using xml includes", "pr_createdAt": "2020-01-10T15:17:08Z", "pr_url": "https://github.com/ibissource/iaf/pull/353", "timeline": [{"oid": "b58a5fe11070f2fe7b6843e71a96cbab26ab9f73", "url": "https://github.com/ibissource/iaf/commit/b58a5fe11070f2fe7b6843e71a96cbab26ab9f73", "message": "Fix systemId containing basePath when using xml includes", "committedDate": "2020-01-10T15:16:31Z", "type": "commit"}, {"oid": "ad835fdcb5f3d3a1530865d1d6de5783e28d5261", "url": "https://github.com/ibissource/iaf/commit/ad835fdcb5f3d3a1530865d1d6de5783e28d5261", "message": "Strip basepath from resources", "committedDate": "2020-01-13T12:02:15Z", "type": "commit"}, {"oid": "36083b90874577ca37eea5ee8387a2a8fb85a249", "url": "https://github.com/ibissource/iaf/commit/36083b90874577ca37eea5ee8387a2a8fb85a249", "message": "Remove commented code", "committedDate": "2020-01-13T12:09:04Z", "type": "commit"}, {"oid": "e692d9a379408456a9796201d98db6f4c007c1f0", "url": "https://github.com/ibissource/iaf/commit/e692d9a379408456a9796201d98db6f4c007c1f0", "message": "Fix tests", "committedDate": "2020-01-13T14:28:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTMwMzc1NA==", "url": "https://github.com/ibissource/iaf/pull/353#discussion_r365303754", "bodyText": "Waarom werkt het niet zonder deze drie regels? Wie plakt die naam van het basePath er in de first place voor?", "author": "gvanbrakel", "createdAt": "2020-01-10T15:57:32Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/classloaders/BytesClassLoader.java", "diffHunk": "@@ -57,6 +56,18 @@ public URL getLocalResource(String name) {\n \t\treturn null;\n \t}\n \n+\t/**\n+\t * Strip BasePath of the local resource and return a valid, relative to the configuration directory, URL\n+\t */\n+\tprivate URL createURL(String name, byte[] resource) throws MalformedURLException {\n+\t\tString URLname = CLASSPATH_RESOURCE_SCHEME + name;\n+\t\tif(getBasePath() != null && name.startsWith(getBasePath())) {\n+\t\t\tURLname = CLASSPATH_RESOURCE_SCHEME + name.substring(getBasePath().length());\n+\t\t}", "originalCommit": "b58a5fe11070f2fe7b6843e71a96cbab26ab9f73", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ad835fdcb5f3d3a1530865d1d6de5783e28d5261", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/configuration/classloaders/BytesClassLoader.java b/core/src/main/java/nl/nn/adapterframework/configuration/classloaders/BytesClassLoader.java\nindex 5f31c5c13..7e07c088a 100644\n--- a/core/src/main/java/nl/nn/adapterframework/configuration/classloaders/BytesClassLoader.java\n+++ b/core/src/main/java/nl/nn/adapterframework/configuration/classloaders/BytesClassLoader.java\n\n@@ -56,18 +57,6 @@ public abstract class BytesClassLoader extends ClassLoaderBase {\n \t\treturn null;\n \t}\n \n-\t/**\n-\t * Strip BasePath of the local resource and return a valid, relative to the configuration directory, URL\n-\t */\n-\tprivate URL createURL(String name, byte[] resource) throws MalformedURLException {\n-\t\tString URLname = CLASSPATH_RESOURCE_SCHEME + name;\n-\t\tif(getBasePath() != null && name.startsWith(getBasePath())) {\n-\t\t\tURLname = CLASSPATH_RESOURCE_SCHEME + name.substring(getBasePath().length());\n-\t\t}\n-\t\tURLStreamHandler urlStreamHandler = new BytesURLStreamHandler(resource);\n-\t\treturn new URL(null, URLname, urlStreamHandler);\n-\t}\n-\n \t/**\n \t * Tries to load new resources, upon success, clears all resources, calls it's super.reload() and sets the new resources\n \t */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg4NzE3Ng==", "url": "https://github.com/ibissource/iaf/pull/353#discussion_r365887176", "bodyText": "Waarom heeft ClassLoaderBase nog steeds een basePath? Hij heeft het zelf toch niet nodig?", "author": "gvanbrakel", "createdAt": "2020-01-13T16:07:24Z", "path": "core/src/main/java/nl/nn/adapterframework/configuration/classloaders/ClassLoaderBase.java", "diffHunk": "@@ -74,16 +74,17 @@ public void configure(IbisContext ibisContext, String configurationName) throws\n \t\t} else {\n \t\t\tif(basePath == null && !getConfigurationName().equalsIgnoreCase(instanceName)) {\n \t\t\t\tint i = configurationFile.lastIndexOf('/');\n-\t\t\t\tif (i != -1) {\n+\t\t\t\tif (i != -1) { //Configuration file contains a path, derive the BasePath from the path\n \t\t\t\t\tsetBasePath(configurationFile.substring(0, i + 1));", "originalCommit": "e692d9a379408456a9796201d98db6f4c007c1f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjIwNzQ0Ng==", "url": "https://github.com/ibissource/iaf/pull/353#discussion_r366207446", "bodyText": "Legacy, alle classloaders hebben een root die gelijk is aan de configuratie naam. En mocht je via de configurationFile propertie een path+file combinatie opgeven, dan is het 'path' gedeelte de root van de classloader (aka basepath).", "author": "nielsm5", "createdAt": "2020-01-14T08:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg4NzE3Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "06e984663b112fb955230de1c946b80e4c135b1b", "url": "https://github.com/ibissource/iaf/commit/06e984663b112fb955230de1c946b80e4c135b1b", "message": "Make BasePath protected", "committedDate": "2020-01-14T10:33:50Z", "type": "commit"}, {"oid": "b58e77a3ade1763cbccb6cd6c38568035ad05f9d", "url": "https://github.com/ibissource/iaf/commit/b58e77a3ade1763cbccb6cd6c38568035ad05f9d", "message": "Update copyright notice", "committedDate": "2020-01-14T10:36:06Z", "type": "commit"}]}