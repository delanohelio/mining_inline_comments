{"pr_number": 635, "pr_title": "Generate wsdl with extra comment", "pr_createdAt": "2020-04-23T14:32:25Z", "pr_url": "https://github.com/ibissource/iaf/pull/635", "timeline": [{"oid": "114c72753cc0a7c4dd1d8a67c9a5dc552174d749", "url": "https://github.com/ibissource/iaf/commit/114c72753cc0a7c4dd1d8a67c9a5dc552174d749", "message": "Add clarified comment in multipart WSDLs", "committedDate": "2020-04-21T14:30:05Z", "type": "commit"}, {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01", "url": "https://github.com/ibissource/iaf/commit/bec83cc423ffa749b95d17c8ee5d404008a42b01", "message": "Fix Larva scenarios", "committedDate": "2020-04-23T14:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM2ODc2MA==", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r416368760", "bodyText": "Ik wil niet het interface IXmlValidator aanpassen voor deze functionaliteit, waarvan je zegt dat hij alleen op de AM-API gebruikt wordt, en in de toekomst ook niet gebruikt zal worden, omdat er dan MTOM gedaan wordt,", "author": "gvanbrakel", "createdAt": "2020-04-28T06:46:56Z", "path": "core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java", "diffHunk": "@@ -14,4 +14,5 @@\n \tpublic String getSchema();\n \tpublic String getSchemaLocation();\n \tpublic Set<XSD> getXsds() throws ConfigurationException;\n+\tpublic String getInfo();", "originalCommit": "bec83cc423ffa749b95d17c8ee5d404008a42b01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkwNTg1OQ==", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r417905859", "bodyText": "Je schreef:\nIk zou geholpen zijn als bij het genereren van een wsdl vanuit de IBIS-console het comment gedeelte in de wsdl aanpasbaar is (is nu fixed text). Maar daarvoor moet m.i. wel de IXmlValidator aangepast worden. Of heb jij wellicht nog een ander idee hoe dit te fixen?\nLaten we de method dan getDocumentation() noemen, en het in IXmlValidator documenteren in Javadoc:\n\"provide additional generic documentation on the validation or the subsequent processing. This documentation will be included in generated schema's like WSDL or OpenApi\"", "author": "gvanbrakel", "createdAt": "2020-04-30T10:18:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM2ODc2MA=="}], "type": "inlineReview", "revised_code": {"commit": "6256a326a848d858af4d3233455f698f92fc6c24", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java b/core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java\nindex be009e0e4..633c9ece2 100644\n--- a/core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java\n+++ b/core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java\n\n@@ -14,5 +14,11 @@ public interface IXmlValidator extends IPipe {\n \tpublic String getSchema();\n \tpublic String getSchemaLocation();\n \tpublic Set<XSD> getXsds() throws ConfigurationException;\n-\tpublic String getInfo();\n+\n+\t/**\n+\t * Provide additional generic documentation on the validation of the\n+\t * subsequent processing. This documentation will be included in generated\n+\t * schema's like WSDL or OpenApi\n+\t */\n+\tpublic String getDocumentation();\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkxMDkzNQ==", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r417910935", "bodyText": "Dit commentaar moet niet in de GUI er bij geplakt worden, maar onderdeel zijn van het genereren van de WSDL.\nTen eerste omdat dit niet in de GUI moet, en ten tweede omdat het ook in GUI 3.0 moet werken. (Daarom moet het ook niet in de GUI, zeg maar)", "author": "gvanbrakel", "createdAt": "2020-04-30T10:27:39Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java", "diffHunk": "@@ -207,16 +208,21 @@ private void zip(Adapter adapter, IPipeLineSession session)\n \t\t\tNamingException {\n \t\tWsdl wsdl = new Wsdl(adapter.getPipeLine());\n \t\twsdl.setUseIncludes(true);\n-\t\twsdl.setDocumentation(getDocumentation(wsdl, session));\n+\t\twsdl.setDocumentation(getDocumentation(wsdl, adapter, session));\n \t\twsdl.init();\n \t\twsdl.zip(RestListenerUtils.retrieveServletOutputStream(session),\n \t\t\t\tRestListenerUtils.retrieveSOAPRequestURL(session));\n \t}\n \n-\tprivate String getDocumentation(Wsdl wsdl, IPipeLineSession session)\n+\tprivate String getDocumentation(Wsdl wsdl, Adapter adapter, IPipeLineSession session)\n \t\t\tthrows IOException {\n-\t\treturn \"Generated at \" + RestListenerUtils.retrieveRequestURL(session)\n+\t\tString doc = \"Generated at \" + RestListenerUtils.retrieveRequestURL(session)\n \t\t\t\t+ \" as \" + wsdl.getFilename() + getWsdlExtention() + \" on \"\n \t\t\t\t+ DateUtils.getIsoTimeStamp() + \".\";\n+\t\tString info = ((IXmlValidator)adapter.getPipeLine().getInputValidator()).getInfo();\n+\t\tif (info!=null) {\n+\t\t\tdoc = doc + info;\n+\t\t}\n+\t\treturn doc;", "originalCommit": "bec83cc423ffa749b95d17c8ee5d404008a42b01", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6256a326a848d858af4d3233455f698f92fc6c24", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java b/core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java\nindex 078048fff..8a80bb940 100644\n--- a/core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java\n+++ b/core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java\n\n@@ -206,23 +199,10 @@ public class Webservices extends TimeoutGuardPipe {\n \tprivate void zip(Adapter adapter, IPipeLineSession session)\n \t\t\tthrows ConfigurationException, XMLStreamException, IOException,\n \t\t\tNamingException {\n-\t\tWsdl wsdl = new Wsdl(adapter.getPipeLine());\n+\t\tWsdl wsdl = new Wsdl(adapter.getPipeLine(), session);\n \t\twsdl.setUseIncludes(true);\n-\t\twsdl.setDocumentation(getDocumentation(wsdl, adapter, session));\n \t\twsdl.init();\n \t\twsdl.zip(RestListenerUtils.retrieveServletOutputStream(session),\n \t\t\t\tRestListenerUtils.retrieveSOAPRequestURL(session));\n \t}\n-\n-\tprivate String getDocumentation(Wsdl wsdl, Adapter adapter, IPipeLineSession session)\n-\t\t\tthrows IOException {\n-\t\tString doc = \"Generated at \" + RestListenerUtils.retrieveRequestURL(session)\n-\t\t\t\t+ \" as \" + wsdl.getFilename() + getWsdlExtention() + \" on \"\n-\t\t\t\t+ DateUtils.getIsoTimeStamp() + \".\";\n-\t\tString info = ((IXmlValidator)adapter.getPipeLine().getInputValidator()).getInfo();\n-\t\tif (info!=null) {\n-\t\t\tdoc = doc + info;\n-\t\t}\n-\t\treturn doc;\n-\t}\n }\n"}}, {"oid": "6256a326a848d858af4d3233455f698f92fc6c24", "url": "https://github.com/ibissource/iaf/commit/6256a326a848d858af4d3233455f698f92fc6c24", "message": "Move getDocumentation() from Webservices to Wsdl\n\nand renamed IXmlValidator GetInfo() to GetDocumentation()", "committedDate": "2020-05-04T13:27:37Z", "type": "commit"}, {"oid": "674dc3b464cedc8a4b6d1d04eb3136c34670cdcb", "url": "https://github.com/ibissource/iaf/commit/674dc3b464cedc8a4b6d1d04eb3136c34670cdcb", "message": "Merge branch 'master' into GenerateWsdlWithExtraComment", "committedDate": "2020-05-04T17:39:11Z", "type": "commit"}, {"oid": "f76a2c08e184adaade15f61a9eb98212985c33be", "url": "https://github.com/ibissource/iaf/commit/f76a2c08e184adaade15f61a9eb98212985c33be", "message": "Merge remote-tracking branch 'origin/master' into GenerateWsdlWithExtraComment", "committedDate": "2020-05-04T17:56:26Z", "type": "commit"}, {"oid": "733cf580e76dd8cd2963824843527b08db7e0909", "url": "https://github.com/ibissource/iaf/commit/733cf580e76dd8cd2963824843527b08db7e0909", "message": "Fix log4j compilation error", "committedDate": "2020-05-04T18:06:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwMDM1Ng==", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r422000356", "bodyText": "Nog \u00e9\u00e9n keer iets op te merken:\nJe hebt hier het argument IPipeLineSession session geintroduceerd, alleen maar om de requestURL op te halen.\nDeze Wsdl heeft verder helemaal niets met deze sessie.\nIk stel voor dat je in plaats hiervan een argument 'String generationInfo' opneemt, zodat je op regel 321 zoiets kan doen als:\n'documentation = \"Generated\" + (generationInfo!= null ? \" \" + generationInfo: \"\") + \" as \" + ... '\nJe kan daar dan ook dingen in stoppen als 'by testtool' of zo.\nEn ook een constructor zonder dat argument, zodat je niet altijd null hoeft mee te geven als je er niet in geinteresseerd bent.", "author": "gvanbrakel", "createdAt": "2020-05-08T07:52:21Z", "path": "core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java", "diffHunk": "@@ -131,7 +140,7 @@\n \n     private List<String> warnings = new ArrayList<String>();\n \n-    public Wsdl(PipeLine pipeLine) {\n+    public Wsdl(PipeLine pipeLine, IPipeLineSession session) {", "originalCommit": "733cf580e76dd8cd2963824843527b08db7e0909", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "111c69ccd510c6d04452d2fca317f31937fd8e33", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java b/core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java\nindex 9376d952c..ac342e52b 100644\n--- a/core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java\n+++ b/core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java\n\n@@ -140,7 +137,11 @@ public class Wsdl {\n \n     private List<String> warnings = new ArrayList<String>();\n \n-    public Wsdl(PipeLine pipeLine, IPipeLineSession session) {\n+    public Wsdl(PipeLine pipeLine) {\n+    \tthis(pipeLine, null);\n+    }\n+\n+    public Wsdl(PipeLine pipeLine, String generationInfo) {\n         this.pipeLine = pipeLine;\n         this.name = this.pipeLine.getAdapter().getName();\n         if (this.name == null) {\n"}}, {"oid": "111c69ccd510c6d04452d2fca317f31937fd8e33", "url": "https://github.com/ibissource/iaf/commit/111c69ccd510c6d04452d2fca317f31937fd8e33", "message": "Remove IPipeLineSession from Wsdl constructor", "committedDate": "2020-05-08T14:16:35Z", "type": "commit"}]}