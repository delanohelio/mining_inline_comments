{"pr_number": 541, "pr_title": "Message Serializable, and fix for MessageStoreSender", "pr_createdAt": "2020-03-25T14:05:58Z", "pr_url": "https://github.com/ibissource/iaf/pull/541", "timeline": [{"oid": "1af0c824909d9da5c1fc2424cbedcedf13d70e93", "url": "https://github.com/ibissource/iaf/commit/1af0c824909d9da5c1fc2424cbedcedf13d70e93", "message": "Message Serializable, and fix for MessageStoreSender", "committedDate": "2020-03-25T14:04:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjE4Ng==", "url": "https://github.com/ibissource/iaf/pull/541#discussion_r398122186", "bodyText": "Okey, so lets preserve it?", "author": "nielsm5", "createdAt": "2020-03-25T19:42:20Z", "path": "core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java", "diffHunk": "@@ -530,6 +530,7 @@ public PipeRunResult doPipe(Message input, IPipeLineSession session, IOutputStre\n \t\t\t\treturn wrapResult;\n \t\t\t} else {\n \t\t\t\tinput = Message.asMessage(wrapResult.getResult());\n+\t\t\t\t// TODO must preserve input here, if result can be an InputStream", "originalCommit": "1af0c824909d9da5c1fc2424cbedcedf13d70e93", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5cbaefd548a766ebe931621efffbe8d036ade0b0", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java b/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\nindex 3ba1a9c6e..7c58f6b86 100644\n--- a/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\n+++ b/core/src/main/java/nl/nn/adapterframework/pipes/MessageSendingPipe.java\n\n@@ -530,12 +533,15 @@ public class MessageSendingPipe extends StreamingPipe implements HasSender, HasS\n \t\t\t\treturn wrapResult;\n \t\t\t} else {\n \t\t\t\tinput = Message.asMessage(wrapResult.getResult());\n-\t\t\t\t// TODO must preserve input here, if result can be an InputStream\n+\t\t\t\tif (messageLog!=null) {\n+\t\t\t\t\tpreserve(input, session);\n+\t\t\t\t}\n \t\t\t}\n \t\t\tlog.debug(getLogPrefix(session)+\"input after wrapping [\" + input.toString() + \"]\");\n \t\t}\n \n \t\tif (getInputValidator()!=null) {\n+\t\t\tpreserve(input, session);\n \t\t\tlog.debug(getLogPrefix(session)+\"validating input\");\n \t\t\tPipeRunResult validationResult = pipeProcessor.processPipe(getPipeLine(), inputValidator, correlationID, input, session);\n \t\t\tif (validationResult!=null && !validationResult.getPipeForward().getName().equals(SUCCESS_FORWARD)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjQxMw==", "url": "https://github.com/ibissource/iaf/pull/541#discussion_r398122413", "bodyText": "Private method that's never been called?", "author": "nielsm5", "createdAt": "2020-03-25T19:42:45Z", "path": "core/src/main/java/nl/nn/adapterframework/stream/Message.java", "diffHunk": "@@ -364,4 +379,17 @@ public static String asString(Object object, String defaultCharset) throws IOExc\n \t\treturn Message.asMessage(object).asByteArray(defaultCharset);\n \t}\n \t\n+\tprivate void writeObject(ObjectOutputStream stream) throws IOException {", "originalCommit": "1af0c824909d9da5c1fc2424cbedcedf13d70e93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM2NDcwOA==", "url": "https://github.com/ibissource/iaf/pull/541#discussion_r398364708", "bodyText": "Zo werkt dat met Serializable", "author": "gvanbrakel", "createdAt": "2020-03-26T07:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjQxMw=="}], "type": "inlineReview", "revised_code": {"commit": "f352403b99e2411cc84cf1cf0dbb42c02f9af3be", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/stream/Message.java b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\nindex 686956899..fab5b857e 100644\n--- a/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n+++ b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n\n@@ -378,7 +375,10 @@ public class Message implements Serializable {\n \t\t}\n \t\treturn Message.asMessage(object).asByteArray(defaultCharset);\n \t}\n-\t\n+\n+\t/*\n+\t * this method is used by Serializable, to serialize objects to a stream.\n+\t */\n \tprivate void writeObject(ObjectOutputStream stream) throws IOException {\n \t\tif (isBinary()) {\n \t\t\tstream.write(asByteArray());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjk2MA==", "url": "https://github.com/ibissource/iaf/pull/541#discussion_r398122960", "bodyText": "What's the version?", "author": "nielsm5", "createdAt": "2020-03-25T19:43:43Z", "path": "core/src/main/java/nl/nn/adapterframework/stream/Message.java", "diffHunk": "@@ -36,8 +39,11 @@\n import nl.nn.adapterframework.util.StreamUtil;\n import nl.nn.adapterframework.util.XmlUtils;\n \n-public class Message {\n-\tprotected Logger log = LogUtil.getLogger(this);\n+public class Message implements Serializable {\n+\n+\tprivate static final long serialVersionUID = 1L;", "originalCommit": "1af0c824909d9da5c1fc2424cbedcedf13d70e93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM2NDgyOA==", "url": "https://github.com/ibissource/iaf/pull/541#discussion_r398364828", "bodyText": "ok, ok, ...", "author": "gvanbrakel", "createdAt": "2020-03-26T07:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEyMjk2MA=="}], "type": "inlineReview", "revised_code": {"commit": "5cbaefd548a766ebe931621efffbe8d036ade0b0", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/stream/Message.java b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\nindex 686956899..b7f9d4e7e 100644\n--- a/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n+++ b/core/src/main/java/nl/nn/adapterframework/stream/Message.java\n\n@@ -41,7 +41,7 @@ import nl.nn.adapterframework.util.XmlUtils;\n \n public class Message implements Serializable {\n \n-\tprivate static final long serialVersionUID = 1L;\n+\tprivate static final long serialVersionUID = 437863352486501445L;\n \n \tprotected transient Logger log = LogUtil.getLogger(this);\n \n"}}, {"oid": "5cbaefd548a766ebe931621efffbe8d036ade0b0", "url": "https://github.com/ibissource/iaf/commit/5cbaefd548a766ebe931621efffbe8d036ade0b0", "message": "Fix issues", "committedDate": "2020-03-26T07:32:08Z", "type": "commit"}, {"oid": "53adba75e27671b8ab4d6fc88a78b6649e0455db", "url": "https://github.com/ibissource/iaf/commit/53adba75e27671b8ab4d6fc88a78b6649e0455db", "message": "Fix Codacy issue", "committedDate": "2020-03-27T08:23:14Z", "type": "commit"}, {"oid": "f352403b99e2411cc84cf1cf0dbb42c02f9af3be", "url": "https://github.com/ibissource/iaf/commit/f352403b99e2411cc84cf1cf0dbb42c02f9af3be", "message": "Comments for private methods to implement Serializable-behavior", "committedDate": "2020-03-27T10:12:38Z", "type": "commit"}]}