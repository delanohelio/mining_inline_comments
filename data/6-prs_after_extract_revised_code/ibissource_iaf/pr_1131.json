{"pr_number": 1131, "pr_title": "Fix type mismatch between return datatype of getter and argumet datatype of setter", "pr_createdAt": "2020-10-08T09:51:39Z", "pr_url": "https://github.com/ibissource/iaf/pull/1131", "timeline": [{"oid": "3c2e3c0264215f20ac6ae64b5049f57d33ec9f2f", "url": "https://github.com/ibissource/iaf/commit/3c2e3c0264215f20ac6ae64b5049f57d33ec9f2f", "message": "Fix type mismatch between return datatype of getter and argumet datatype of setter", "committedDate": "2020-10-08T09:47:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg0NjA4NA==", "url": "https://github.com/ibissource/iaf/pull/1131#discussion_r501846084", "bodyText": "All you had to do was rename the method, the logic could have stayed where it was.\nThe idea of enums is that once (in the near future?) we can add them to our xsd so people can use autocomplete to fill the attribute values.\nThere isn't really a standard yet, but I think we should use getMethodNameEnum() so in this case getAuthenticationMethodEnum. Since there is no need to have a getter, and we don't want the 'BeansParser' to error when the dataTypes are different, just renaming the method should be enough.\nIf a getter is desirable, the getter-method should call the getMethodNameEnum().name() method, which in turn returns the correct dataType.", "author": "nielsm5", "createdAt": "2020-10-08T16:16:36Z", "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java", "diffHunk": "@@ -221,39 +229,20 @@ public boolean getUpdateEtag() {\n \t//TODO add authenticationType\n \n \t@IbisDoc({\"7\", \"enables security for this listener, must be one of [NONE, COOKIE, HEADER, AUTHROLE]. If you wish to use the application servers authorisation roles [AUTHROLE], you need to enable them globally for all ApiListeners with the `servlet.ApiListenerServlet.securityroles=ibistester,ibiswebservice` property\", \"NONE\"})\n-\tpublic void setAuthenticationMethod(String authenticationMethod) throws ConfigurationException {\n-\t\ttry {\n-\t\t\tthis.authenticationMethod = AuthenticationMethods.valueOf(authenticationMethod);\n-\t\t}\n-\t\tcatch (IllegalArgumentException iae) {\n-\t\t\tthrow new ConfigurationException(\"Unknown authenticationMethod [\"+authenticationMethod+\"]. Must be one of \"+ Arrays.asList(AuthenticationMethods.values()));\n-\t\t}\n+\tpublic void setAuthenticationMethod(String authenticationMethod) {\n+\t\tthis.authenticationMethod = authenticationMethod;\n \t}\n \n-\tpublic AuthenticationMethods getAuthenticationMethod() {\n+\tpublic AuthenticationMethods getAuthenticationMethodType() {\n \t\tif(authenticationMethod == null) {\n-\t\t\tauthenticationMethod = AuthenticationMethods.NONE;\n+\t\t\treturn AuthenticationMethods.NONE;\n \t\t}", "originalCommit": "3c2e3c0264215f20ac6ae64b5049f57d33ec9f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d243f541926b41284547b9068c01d93013ab920", "chunk": "diff --git a/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java b/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java\nindex 15e966492..c215824e9 100644\n--- a/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java\n+++ b/core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java\n\n@@ -229,20 +221,39 @@ public class ApiListener extends PushingListenerAdapter<String> implements HasPh\n \t//TODO add authenticationType\n \n \t@IbisDoc({\"7\", \"enables security for this listener, must be one of [NONE, COOKIE, HEADER, AUTHROLE]. If you wish to use the application servers authorisation roles [AUTHROLE], you need to enable them globally for all ApiListeners with the `servlet.ApiListenerServlet.securityroles=ibistester,ibiswebservice` property\", \"NONE\"})\n-\tpublic void setAuthenticationMethod(String authenticationMethod) {\n-\t\tthis.authenticationMethod = authenticationMethod;\n+\tpublic void setAuthenticationMethod(String authenticationMethod) throws ConfigurationException {\n+\t\ttry {\n+\t\t\tthis.authenticationMethod = AuthenticationMethods.valueOf(authenticationMethod);\n+\t\t}\n+\t\tcatch (IllegalArgumentException iae) {\n+\t\t\tthrow new ConfigurationException(\"Unknown authenticationMethod [\"+authenticationMethod+\"]. Must be one of \"+ Arrays.asList(AuthenticationMethods.values()));\n+\t\t}\n \t}\n \n-\tpublic AuthenticationMethods getAuthenticationMethodType() {\n+\tpublic AuthenticationMethods getAuthenticationMethod() {\n \t\tif(authenticationMethod == null) {\n-\t\t\treturn AuthenticationMethods.NONE;\n+\t\t\tauthenticationMethod = AuthenticationMethods.NONE;\n \t\t}\n-\t\treturn AuthenticationMethods.valueOf(authenticationMethod);\n+\n+\t\treturn this.authenticationMethod;\n \t}\n \n \t@IbisDoc({\"8\", \"only active when AuthenticationMethod=AUTHROLE. comma separated list of authorization roles which are granted for this service, eq. ibistester,ibisobserver\", \"\"})\n \tpublic void setAuthenticationRoles(String authRoles) {\n-\t\tthis.authenticationRoles = authRoles;\n+\t\tList<String> roles = new ArrayList<String>();\n+\t\tif (StringUtils.isNotEmpty(authRoles)) {\n+\t\t\tStringTokenizer st = new StringTokenizer(authRoles, \",;\");\n+\t\t\twhile (st.hasMoreTokens()) {\n+\t\t\t\tString authRole = st.nextToken();\n+\t\t\t\tif(!roles.contains(authRole))\n+\t\t\t\t\troles.add(authRole);\n+\t\t\t}\n+\t\t}\n+\n+\t\tthis.authenticationRoles = roles;\n+\t}\n+\tpublic List<String> getAuthenticationRoles() {\n+\t\treturn authenticationRoles;\n \t}\n \n \t@IbisDoc({\"9\", \"specify the form-part you wish to enter the pipeline\", \"name of the first form-part\"})\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg1Mzc0MQ==", "url": "https://github.com/ibissource/iaf/pull/1131#discussion_r501853741", "bodyText": "I'm confused, shouldn't this test return an exception?", "author": "nielsm5", "createdAt": "2020-10-08T16:28:23Z", "path": "core/src/test/java/nl/nn/adapterframework/http/rest/ApiListenerTest.java", "diffHunk": "@@ -191,19 +196,17 @@ public void acceptsJson() throws ConfigurationException {\n \t\tassertTrue(\"accepts JSON\", listener.accepts(acceptHeader));\n \t}\n \n-\t@Test(expected = ConfigurationException.class)\n+\t@Test", "originalCommit": "3c2e3c0264215f20ac6ae64b5049f57d33ec9f2f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d243f541926b41284547b9068c01d93013ab920", "chunk": "diff --git a/core/src/test/java/nl/nn/adapterframework/http/rest/ApiListenerTest.java b/core/src/test/java/nl/nn/adapterframework/http/rest/ApiListenerTest.java\nindex dc325d001..9da6b9097 100644\n--- a/core/src/test/java/nl/nn/adapterframework/http/rest/ApiListenerTest.java\n+++ b/core/src/test/java/nl/nn/adapterframework/http/rest/ApiListenerTest.java\n\n@@ -196,17 +191,19 @@ public class ApiListenerTest {\n \t\tassertTrue(\"accepts JSON\", listener.accepts(acceptHeader));\n \t}\n \n-\t@Test\n+\t@Test(expected = ConfigurationException.class)\n \tpublic void testFaultyAuthMethod() throws ConfigurationException {\n-\t\tthrown.expectMessage(\"Unknown authenticationMethod\");\n-\n-\t\tlistener.setAuthenticationMethod(\"unknown$df\");\n-\t\tlistener.configure();\n+\t\ttry{\n+\t\t\tlistener.setAuthenticationMethod(\"unknown$df\");\n+\t\t}\n+\t\tfinally {\n+\t\t\tassertEquals(\"No authentication method should be set\", AuthenticationMethods.NONE, listener.getAuthenticationMethod());\n+\t\t}\n \t}\n \n \t@Test\n \tpublic void testAuthRoleMethod() throws ConfigurationException {\n \t\tlistener.setAuthenticationMethod(AuthenticationMethods.AUTHROLE.name());\n-\t\tassertEquals(\"Authentication method [AUTHROLE] should be set\", AuthenticationMethods.AUTHROLE, listener.getAuthenticationMethodType());\n+\t\tassertEquals(\"Authentication method [AUTHROLE] should be set\", AuthenticationMethods.AUTHROLE, listener.getAuthenticationMethod());\n \t}\n }\n"}}, {"oid": "7d243f541926b41284547b9068c01d93013ab920", "url": "https://github.com/ibissource/iaf/commit/7d243f541926b41284547b9068c01d93013ab920", "message": "Revert \"Fix type mismatch between return datatype of getter and argumet datatype of setter\"\n\nThis reverts commit 3c2e3c0264215f20ac6ae64b5049f57d33ec9f2f.", "committedDate": "2020-10-09T07:40:03Z", "type": "commit"}, {"oid": "1a93569fb1a75ee15980e3c0d3e1f068d9b84f84", "url": "https://github.com/ibissource/iaf/commit/1a93569fb1a75ee15980e3c0d3e1f068d9b84f84", "message": "rename getters", "committedDate": "2020-10-09T07:48:15Z", "type": "commit"}]}