{"pr_number": 968, "pr_title": "Improve logging for isClusterSetup", "pr_createdAt": "2020-04-23T21:11:23Z", "pr_url": "https://github.com/apache/helix/pull/968", "timeline": [{"oid": "11f2bc1e42d088fa0ff9006d02feda3541c9ea8c", "url": "https://github.com/apache/helix/commit/11f2bc1e42d088fa0ff9006d02feda3541c9ea8c", "message": "Improve logging for isClusterSetup", "committedDate": "2020-04-23T21:09:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw==", "url": "https://github.com/apache/helix/pull/968#discussion_r414154467", "bodyText": "Will this generate a lot of logs? That is the reason we move this to debug log instead of warning or even info.", "author": "junkaixue", "createdAt": "2020-04-23T22:03:41Z", "path": "helix-core/src/main/java/org/apache/helix/manager/zk/ZKUtil.java", "diffHunk": "@@ -112,13 +112,13 @@ public static boolean isClusterSetup(String clusterName, RealmAwareZkClient zkCl\n     for (int i = 0; i < ret.length; i++) {\n       if (!ret[i]) {\n         isValid = false;\n-        errorMsg.append(\"Invalid cluster setup, missing znode path: \").append(requiredPaths.get(i))\n-            .append(\"\\n\");\n+        errorMsg.append(\"Invalid cluster setup for cluster: \").append(clusterName)\n+            .append(\", missing znode path: \").append(requiredPaths.get(i)).append(\"\\n\");\n       }\n     }\n \n     if (!isValid) {\n-      logger.debug(errorMsg.toString());\n+      logger.warn(errorMsg.toString());", "originalCommit": "11f2bc1e42d088fa0ff9006d02feda3541c9ea8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE2NDA4NQ==", "url": "https://github.com/apache/helix/pull/968#discussion_r414164085", "bodyText": "Generally the pipeline shouldn't call this every time.\nIf this condition is met, that means the cluster is not in the right state anyways, so it's good that we make this a warn log to be able to diagnose the problem appropriately. Clusters that aren't ill-formed won't get this log. In other words, you better get the cluster fixed before worrying if there are too many logs.", "author": "narendly", "createdAt": "2020-04-23T22:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE4MDc5Mw==", "url": "https://github.com/apache/helix/pull/968#discussion_r414180793", "bodyText": "It is better to ask original author to see whether it is a concern or not. @lei-xia", "author": "junkaixue", "createdAt": "2020-04-23T23:03:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE4ODM2OQ==", "url": "https://github.com/apache/helix/pull/968#discussion_r414188369", "bodyText": "@narendly One thing I need to correct. It does not have to be cluster in ill-form. If there is some network or ZK server issue, partial of the path has been read. You will get this error frequently. But it does not means the cluster is not well setup.\nFor your change, I am fine. But I think we should think about to reduce the places of using isClusterSetup.", "author": "junkaixue", "createdAt": "2020-04-23T23:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc0OTg2Mw==", "url": "https://github.com/apache/helix/pull/968#discussion_r414749863", "bodyText": "@dasahcc\nWe still need to record this in order to diagnose whether it was a connectivity issue that caused this. Otherwise, how do you prove that it was a connectivity issue?", "author": "narendly", "createdAt": "2020-04-24T17:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDc1MDg1NA==", "url": "https://github.com/apache/helix/pull/968#discussion_r414750854", "bodyText": "Additionally, what you said doesn't really strengthen your case about logging because connectivity issues are supposed to be transient. Then how does that make logging worse? If anything, this would serve as an important marker that lets you know that there were connectivity issues.", "author": "narendly", "createdAt": "2020-04-24T17:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg5OTE1Mw==", "url": "https://github.com/apache/helix/pull/968#discussion_r414899153", "bodyText": "There was an issue for the HelixAdmin get resource. The cluster just added 1 min ago. And we verify the cluster does create successfully. Using another HelixAdmin to create a resource make it failed. It is network issue.\nIt will not be related to the log warning or debug, but we need to think about the whether we should apply this isClusterSetup check anywhere. And as I said, I am OK with the log itself.", "author": "junkaixue", "createdAt": "2020-04-24T22:32:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkwMTQ3Mg==", "url": "https://github.com/apache/helix/pull/968#discussion_r414901472", "bodyText": "What you're talking about is whether it's appropriate to call isClusterSetup. That's not the focus of this PR - please create a separate issue to track that work if you think is necessary.", "author": "narendly", "createdAt": "2020-04-24T22:39:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE1NDQ2Nw=="}], "type": "inlineReview", "revised_code": null}]}