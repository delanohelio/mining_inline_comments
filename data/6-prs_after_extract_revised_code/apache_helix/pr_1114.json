{"pr_number": 1114, "pr_title": "Fix the queue not going to IN_PROGRESS state", "pr_createdAt": "2020-06-22T22:00:15Z", "pr_url": "https://github.com/apache/helix/pull/1114", "timeline": [{"oid": "c832d81005d9a528ea08263ad832e1b453727ae2", "url": "https://github.com/apache/helix/commit/c832d81005d9a528ea08263ad832e1b453727ae2", "message": "Fix the queue not going to IN_PROGRESS state\n\nThis commit fixed the scenario where the workflow context does not change\nto IN_PROGRESS when it does not contain any job that needs to be run.", "committedDate": "2020-06-22T21:50:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDIwOQ==", "url": "https://github.com/apache/helix/pull/1114#discussion_r444340209", "bodyText": "workflowCtx.getWorkflowState() is not going to be null right? If it could return null, we should do a reverse check.\nAlso, for enums, == would be the standard for comparison vs using equals().", "author": "narendly", "createdAt": "2020-06-23T16:07:26Z", "path": "helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java", "diffHunk": "@@ -174,6 +174,16 @@ public void updateWorkflowStatus(String workflow, WorkflowConfig workflowCfg,\n       }\n       return;\n     }\n+\n+    // Step 6: handle workflow that should go IN_PROGRESS state after is has been resumed\n+    // This block is added to make sure if workflow/queue context state becomes IN_PROGRESS for the\n+    // case where A Queue which has been stopped before is just resumed and queue does not contain\n+    // any job that needs to be run.\n+    if (targetState.equals(TargetState.START)\n+        && workflowCtx.getWorkflowState().equals(TaskState.STOPPED)) {", "originalCommit": "c832d81005d9a528ea08263ad832e1b453727ae2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MjI2Nw==", "url": "https://github.com/apache/helix/pull/1114#discussion_r444342267", "bodyText": "No it can't. If it is null, the method returns NOT_STARTED:\n  public TaskState getWorkflowState() {\n    String state = _record.getSimpleField(WorkflowContextProperties.STATE.name());\n    if (state == null) {\n      return TaskState.NOT_STARTED;\n    }\n\n    return TaskState.valueOf(state);\n  }", "author": "alirezazamani", "createdAt": "2020-06-23T16:10:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDIwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MzE3NA==", "url": "https://github.com/apache/helix/pull/1114#discussion_r444343174", "bodyText": "Thanks for the review. I will change it to ==", "author": "alirezazamani", "createdAt": "2020-06-23T16:11:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0MDIwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "17e9431fd2432f424eac3b9af08bad6b0fabd659", "chunk": "diff --git a/helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java b/helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java\nindex 0000e8b05..89e6d7644 100644\n--- a/helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java\n+++ b/helix-core/src/main/java/org/apache/helix/task/WorkflowDispatcher.java\n\n@@ -175,12 +175,12 @@ public class WorkflowDispatcher extends AbstractTaskDispatcher {\n       return;\n     }\n \n-    // Step 6: handle workflow that should go IN_PROGRESS state after is has been resumed\n-    // This block is added to make sure if workflow/queue context state becomes IN_PROGRESS for the\n-    // case where A Queue which has been stopped before is just resumed and queue does not contain\n-    // any job that needs to be run.\n+    // Step 6: handle workflow that should go to IN_PROGRESS state after is has been resumed\n+    // This block is added to make sure workflow/queue context state becomes IN_PROGRESS for the\n+    // case where a queue which has been stopped before is just resumed and the queue does not\n+    // contain any job that needs to be run.\n     if (targetState.equals(TargetState.START)\n-        && workflowCtx.getWorkflowState().equals(TaskState.STOPPED)) {\n+        && workflowCtx.getWorkflowState() == TaskState.STOPPED) {\n       workflowCtx.setWorkflowState(TaskState.IN_PROGRESS);\n     }\n \n"}}, {"oid": "17e9431fd2432f424eac3b9af08bad6b0fabd659", "url": "https://github.com/apache/helix/commit/17e9431fd2432f424eac3b9af08bad6b0fabd659", "message": "Address comments", "committedDate": "2020-06-25T21:42:05Z", "type": "commit"}]}