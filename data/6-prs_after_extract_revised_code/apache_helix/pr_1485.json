{"pr_number": 1485, "pr_title": "Add offline node purge timeout in cluster config", "pr_createdAt": "2020-10-26T23:32:50Z", "pr_url": "https://github.com/apache/helix/pull/1485", "timeline": [{"oid": "cc9b2209d57966614a31f9e914555441d19e5204", "url": "https://github.com/apache/helix/commit/cc9b2209d57966614a31f9e914555441d19e5204", "message": "Add offline node purge timeout in cluster config", "committedDate": "2020-10-26T23:31:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkxODI3MQ==", "url": "https://github.com/apache/helix/pull/1485#discussion_r512918271", "bodyText": "nit, additional \"I\" at end of this line.", "author": "kaisun2000", "createdAt": "2020-10-27T18:07:32Z", "path": "helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java", "diffHunk": "@@ -937,6 +940,27 @@ public long getOfflineNodeTimeOutForMaintenanceMode() {\n             OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE_NOT_SET);\n   }\n \n+  /**\n+   * Set the default time out window for offline nodes to be purged. If an offline node has been\n+   * offline for more than this specified time period, when users call purge participants API,\n+   * the node will be dropped.\n+   * @param timeOut timeout window in milliseconds.\n+   */\n+  public void setOfflineNodeTimeOutForPurge(long timeOut) {\n+    _record.setLongField(ClusterConfigProperty.OFFLINE_NODE_TIME_OUT_FOR_PURGE.name(),\n+        timeOut);\n+  }\n+\n+  /**\n+   * Get the default time out window for offline nodes to be purged. I", "originalCommit": "cc9b2209d57966614a31f9e914555441d19e5204", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c78c7eb267b319474d1494ba0274524912c740f6", "chunk": "diff --git a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\nindex de7159ec8..ef87542d7 100644\n--- a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n+++ b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n\n@@ -937,7 +940,7 @@ public class ClusterConfig extends HelixProperty {\n   public long getOfflineNodeTimeOutForMaintenanceMode() {\n     return _record\n         .getLongField(ClusterConfigProperty.OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE.name(),\n-            OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE_NOT_SET);\n+            VALUE_NOT_SET);\n   }\n \n   /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkyMDIxMg==", "url": "https://github.com/apache/helix/pull/1485#discussion_r512920212", "bodyText": "This test really is not necessary. All the logic seems tested in testGetOfflineNodeTimeOutForPurge() anyway.", "author": "kaisun2000", "createdAt": "2020-10-27T18:09:58Z", "path": "helix-core/src/test/java/org/apache/helix/model/TestClusterConfig.java", "diffHunk": "@@ -320,6 +320,29 @@ public void testSetOfflineNodeTimeOutForMaintenanceMode() {\n             -1), 10000L);\n   }\n \n+\n+  @Test\n+  public void testGetOfflineNodeTimeOutForPurge() {\n+    ClusterConfig testConfig = new ClusterConfig(\"testId\");\n+    Assert.assertEquals(testConfig.getOfflineNodeTimeOutForPurge(), -1);\n+\n+    testConfig.getRecord()\n+        .setLongField(ClusterConfig.ClusterConfigProperty.OFFLINE_NODE_TIME_OUT_FOR_PURGE\n+                .name(),\n+            10000L);\n+    Assert.assertEquals(testConfig.getOfflineNodeTimeOutForPurge(), 10000L);\n+  }\n+\n+  @Test\n+  public void testSetOfflineNodeTimeOutForPurge() {", "originalCommit": "cc9b2209d57966614a31f9e914555441d19e5204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkzNTE3Mw==", "url": "https://github.com/apache/helix/pull/1485#discussion_r512935173", "bodyText": "Tiny difference in how they set the field. But I agree they're doing the same thing.", "author": "zhangmeng916", "createdAt": "2020-10-27T18:32:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkyMDIxMg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkzMjcxMw==", "url": "https://github.com/apache/helix/pull/1485#discussion_r512932713", "bodyText": "nit, comment to explain the option please", "author": "jiajunwang", "createdAt": "2020-10-27T18:28:24Z", "path": "helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java", "diffHunk": "@@ -128,7 +128,9 @@\n     // offline for more than this specified time period, it's treated as offline for the rest of\n     // the maintenance mode's duration even when it comes online.\n     // The unit is milliseconds.\n-    OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE\n+    OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE,\n+\n+    OFFLINE_NODE_TIME_OUT_FOR_PURGE", "originalCommit": "cc9b2209d57966614a31f9e914555441d19e5204", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c78c7eb267b319474d1494ba0274524912c740f6", "chunk": "diff --git a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\nindex de7159ec8..ef87542d7 100644\n--- a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n+++ b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n\n@@ -130,6 +130,10 @@ public class ClusterConfig extends HelixProperty {\n     // The unit is milliseconds.\n     OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE,\n \n+    // The time out window for offline nodes to be purged; if an offline node has been\n+    // offline for more than this specified time period, and users call purge participant API,\n+    // then the node will be removed.\n+    // The unit is milliseconds.\n     OFFLINE_NODE_TIME_OUT_FOR_PURGE\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkzNDY5OQ==", "url": "https://github.com/apache/helix/pull/1485#discussion_r512934699", "bodyText": "not necessarily to be changed here, but maybe we want to have one single static var VALUE_NOT_SET = -1.", "author": "jiajunwang", "createdAt": "2020-10-27T18:31:29Z", "path": "helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java", "diffHunk": "@@ -158,6 +160,7 @@\n   public final static boolean DEFAULT_GLOBAL_REBALANCE_ASYNC_MODE_ENABLED = true;\n   private static final int GLOBAL_TARGET_TASK_THREAD_POOL_SIZE_NOT_SET = -1;\n   private static final long OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE_NOT_SET = -1;\n+  private static final long OFFLINE_NODE_TIME_OUT_FOR_PURGE_NOT_SET = -1;", "originalCommit": "cc9b2209d57966614a31f9e914555441d19e5204", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c78c7eb267b319474d1494ba0274524912c740f6", "chunk": "diff --git a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\nindex de7159ec8..ef87542d7 100644\n--- a/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n+++ b/helix-core/src/main/java/org/apache/helix/model/ClusterConfig.java\n\n@@ -159,8 +163,7 @@ public class ClusterConfig extends HelixProperty {\n   private final static int MIN_REBALANCE_PREFERENCE = 0;\n   public final static boolean DEFAULT_GLOBAL_REBALANCE_ASYNC_MODE_ENABLED = true;\n   private static final int GLOBAL_TARGET_TASK_THREAD_POOL_SIZE_NOT_SET = -1;\n-  private static final long OFFLINE_NODE_TIME_OUT_FOR_MAINTENANCE_MODE_NOT_SET = -1;\n-  private static final long OFFLINE_NODE_TIME_OUT_FOR_PURGE_NOT_SET = -1;\n+  private static final long VALUE_NOT_SET = -1;\n \n   /**\n    * Instantiate for a specific cluster\n"}}, {"oid": "c78c7eb267b319474d1494ba0274524912c740f6", "url": "https://github.com/apache/helix/commit/c78c7eb267b319474d1494ba0274524912c740f6", "message": "fix comment", "committedDate": "2020-10-27T18:39:18Z", "type": "commit"}]}