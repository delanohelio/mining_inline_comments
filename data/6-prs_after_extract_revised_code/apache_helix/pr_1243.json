{"pr_number": 1243, "pr_title": "Make HelixCustomCodeRunner multi-ZK aware", "pr_createdAt": "2020-08-10T19:13:23Z", "pr_url": "https://github.com/apache/helix/pull/1243", "timeline": [{"oid": "ceb20dc1ca964e3107ff89473a5ddeb613eeea8c", "url": "https://github.com/apache/helix/commit/ceb20dc1ca964e3107ff89473a5ddeb613eeea8c", "message": "Make HelixCustomCodeRunner multi-ZK aware\n\nThis class was an edge case that was neglected as part of ZooScalability API migration. This commit makes HelixCustomCodeRunner realm-aware by adding a constructor that accepts a RealmAwareZkConnectionConfig.", "committedDate": "2020-08-10T19:09:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE4MTQ5MQ==", "url": "https://github.com/apache/helix/pull/1243#discussion_r468181491", "bodyText": "if zkaddress is null and we are initialize it with FederatedZKClient, do we have problem? For example, we cannot get the routing key and cause any problems?", "author": "junkaixue", "createdAt": "2020-08-10T20:57:13Z", "path": "helix-core/src/main/java/org/apache/helix/participant/HelixCustomCodeRunner.java", "diffHunk": "@@ -130,14 +147,23 @@ public void start() throws Exception {\n \n     StateMachineEngine stateMach = _manager.getStateMachineEngine();\n     stateMach.registerStateModelFactory(LEADER_STANDBY, _stateModelFty, _resourceName);\n-    HelixZkClient zkClient = null;\n+    RealmAwareZkClient zkClient = null;\n     try {\n       // manually add ideal state for participant leader using LeaderStandby\n       // model\n-      HelixZkClient.ZkClientConfig clientConfig = new HelixZkClient.ZkClientConfig();\n-      clientConfig.setZkSerializer(new ZNRecordSerializer());\n-      zkClient = SharedZkClientFactory.getInstance()\n-          .buildZkClient(new HelixZkClient.ZkConnectionConfig(_zkAddr), clientConfig);\n+      if (Boolean.getBoolean(SystemPropertyKeys.MULTI_ZK_ENABLED) || _zkAddr == null) {", "originalCommit": "ceb20dc1ca964e3107ff89473a5ddeb613eeea8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE5MTgxMg==", "url": "https://github.com/apache/helix/pull/1243#discussion_r468191812", "bodyText": "The whole point of FederatedZkClient is not using a particular ZkAddress, but rather rely on RealmAwareConnectionConfig to establish a multi-zk connection, so this makes sense. The sharding key information is included in the connection config.", "author": "narendly", "createdAt": "2020-08-10T21:18:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE4MTQ5MQ=="}], "type": "inlineReview", "revised_code": null}]}