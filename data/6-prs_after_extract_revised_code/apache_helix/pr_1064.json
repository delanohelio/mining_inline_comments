{"pr_number": 1064, "pr_title": "Avoid adding JobConfig if queue has reached its capacity limit", "pr_createdAt": "2020-06-05T00:42:07Z", "pr_url": "https://github.com/apache/helix/pull/1064", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY2MDIzOQ==", "url": "https://github.com/apache/helix/pull/1064#discussion_r435660239", "bodyText": "It solved part of the problem. I think it still could cause race condition when there is another thread submitting jobs. We should make this operation as a transaction. It means when we update the Workflow Config with job dag. If it exceeds the capacity, we should remove all the jobconfigs.", "author": "junkaixue", "createdAt": "2020-06-05T02:43:47Z", "path": "helix-core/src/main/java/org/apache/helix/task/TaskDriver.java", "diffHunk": "@@ -403,6 +403,14 @@ public void enqueueJobs(final String queue, final List<String> jobs,\n       }\n     }\n \n+    // Fail the operation if adding new jobs will cause the queue to reach its capacity limit", "originalCommit": "20cde8a0cef9911f9d5c46c604a89f569ee553c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY2MDU2Mg==", "url": "https://github.com/apache/helix/pull/1064#discussion_r435660562", "bodyText": "We can implement the rollback function at line 453 when we are throwing out the exception.", "author": "junkaixue", "createdAt": "2020-06-05T02:45:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY2MDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjA0NzM1Mw==", "url": "https://github.com/apache/helix/pull/1064#discussion_r436047353", "bodyText": "Thanks. I added rollback functionality.", "author": "alirezazamani", "createdAt": "2020-06-05T16:59:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTY2MDIzOQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "5086d2d88e5ee6f23550a7cc4a766af0d2ab46be", "url": "https://github.com/apache/helix/commit/5086d2d88e5ee6f23550a7cc4a766af0d2ab46be", "message": "Fail to add JobConfig if queue will reach its capacity\n\nIn this commit, the necessary check has been added in TaskDriver side\nto fail creation of JobConfig if queue will hit its capacity limit.", "committedDate": "2020-06-05T16:21:18Z", "type": "commit"}, {"oid": "c5633d83a134635480ea950dd91b57d95e877150", "url": "https://github.com/apache/helix/commit/c5633d83a134635480ea950dd91b57d95e877150", "message": "Address comments", "committedDate": "2020-06-05T16:21:18Z", "type": "commit"}, {"oid": "c5633d83a134635480ea950dd91b57d95e877150", "url": "https://github.com/apache/helix/commit/c5633d83a134635480ea950dd91b57d95e877150", "message": "Address comments", "committedDate": "2020-06-05T16:21:18Z", "type": "forcePushed"}]}