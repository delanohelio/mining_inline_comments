{"pr_number": 4122, "pr_title": "PLFM-5517", "pr_createdAt": "2020-07-02T17:39:26Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4122", "timeline": [{"oid": "9139157f88e62fe9fb718f291a78e3b6cd0bd061", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/9139157f88e62fe9fb718f291a78e3b6cd0bd061", "message": "PLFM-5517 add Component field when creating SG Jira issue", "committedDate": "2020-07-02T17:30:42Z", "type": "commit"}, {"oid": "3e6de7775c7b86e12c4c8a1ece3f7aeee9d72874", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3e6de7775c7b86e12c4c8a1ece3f7aeee9d72874", "message": "PLFM-5517 add Component field when creating SG Jira issue", "committedDate": "2020-07-02T17:38:42Z", "type": "commit"}, {"oid": "c15bb5025737734c29eb8dc192cd674a7500cc5e", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/c15bb5025737734c29eb8dc192cd674a7500cc5e", "message": "PLFM-5517", "committedDate": "2020-07-03T01:29:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwOTc3OA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4122#discussion_r450509778", "bodyText": "Instantiate a com.fasterxml.jackson.databind.ObjectMapper for JSON serialization in JiraClientImpl.searializeBasicIssue", "author": "zimingd", "createdAt": "2020-07-06T22:21:46Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java", "diffHunk": "@@ -13,23 +14,35 @@\n \tprivate static final String JIRA_PRINCIPAL_ID_ISSUE_FIELD_NAME = \"Synapse Principal ID\"; // The ID of the Synapse user reporting the issue.\n \tprivate static final String JIRA_USER_DISPLAY_NAME_ISSUE_FIELD_NAME = \"Synapse User Display Name\"; // The display name of the Synapse user reporting the issue.\n \tprivate static final String JIRA_SYNAPSE_ENTITY_ID_FIELD_NAME = \"Synapse Data Object\"; // The ID of the Synapse object which is the subject of the issue.\n+\tprivate static final String JIRA_COMPONENT_FIELD_NAME = \"Components\";\n+\tprivate static final String JIRA_COMPONENT_NAME = \"name\";\n+\tprivate static final String JIRA_COMPONENT_FIELD_VALUE_RESTRICTION_REQUEST = \"Data Restriction Request\";\n \tprivate static final String FLAG_SUMMARY = \"Request for ACT to review data\";\n \tprivate static final String RESTRICT_SUMMARY = \"Request for ACT to add data restriction\";\n \t\n \tpublic static String createFlagIssue(JiraClient jiraClient, String principalId, String displayName, String dataObjectId) {\n-        Map<String,String> params = new HashMap<String,String>();\n+        Map<String,Object> params = new HashMap<String,Object>();\n         params.put(JIRA_PRINCIPAL_ID_ISSUE_FIELD_NAME, principalId);\n         params.put(JIRA_USER_DISPLAY_NAME_ISSUE_FIELD_NAME, displayName);\n         params.put(JIRA_SYNAPSE_ENTITY_ID_FIELD_NAME, dataObjectId);\n         CreatedIssue createdIssue = createIssue(jiraClient, JIRA_FLAG_ISSUE_TYPE_NAME, FLAG_SUMMARY, params);\n \t\treturn createdIssue.getKey();\n \t}\n \t\n+\tpublic static JSONArray componentName(String name) {", "originalCommit": "c15bb5025737734c29eb8dc192cd674a7500cc5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE4MTUzMQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4122#discussion_r451181531", "bodyText": "I started down this road but it turns put that the mapping in JiraClientImpl.searializeBasicIssue is non-trivial.  I would have to define half a dozen new POJOs to get ObjectMapper to do the right thing.  So I don't think the elegance of ObjectMapper is worth the effort.", "author": "brucehoff", "createdAt": "2020-07-07T22:33:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwOTc3OA=="}], "type": "inlineReview", "revised_code": {"commit": "2e1ac7e12e0b893f6573b1199575982cdd0b6c69", "chunk": "diff --git a/services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java b/services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java\nindex 4c6ba46f1a..658bcfb9fb 100644\n--- a/services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java\n+++ b/services/repository-managers/src/main/java/org/sagebionetworks/repo/util/jrjc/JRJCHelper.java\n\n@@ -29,12 +28,10 @@ public class JRJCHelper {\n \t\treturn createdIssue.getKey();\n \t}\n \t\n-\tpublic static JSONArray componentName(String name) {\n-        JSONArray result = new JSONArray();\n-        JSONObject nameObject = new JSONObject();\n-        nameObject.put(JIRA_COMPONENT_NAME, name);\n-        result.add(nameObject);\n-\t\treturn result;\n+\tpublic static List<Map<String,String>> componentName(String name) {\n+\t\tMap<String,String> component = new HashMap<String,String>();\n+\t\tcomponent.put(JIRA_COMPONENT_NAME, name);\n+\t\treturn Collections.singletonList(component);\n \t}\n \t\n \tpublic static String createRestrictIssue(JiraClient jiraClient, String principalId, String displayName, String dataObjectId) {\n"}}, {"oid": "2e1ac7e12e0b893f6573b1199575982cdd0b6c69", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/2e1ac7e12e0b893f6573b1199575982cdd0b6c69", "message": "improvements from CR: Built up BasicIssue using List and Map rather than JSON objects", "committedDate": "2020-07-08T01:51:35Z", "type": "commit"}]}