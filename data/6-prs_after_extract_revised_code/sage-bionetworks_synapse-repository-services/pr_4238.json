{"pr_number": 4238, "pr_title": "Plfm 6458", "pr_createdAt": "2020-12-10T21:47:27Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4238", "timeline": [{"oid": "7b6b5a5dfa3e8a85e63047d6335e95f8a795553e", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/7b6b5a5dfa3e8a85e63047d6335e95f8a795553e", "message": "deleteAccessRequirement", "committedDate": "2020-12-10T20:55:07Z", "type": "commit"}, {"oid": "c98bdac11154a8ef459b0c9b7908bf1d0b670b74", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/c98bdac11154a8ef459b0c9b7908bf1d0b670b74", "message": "Merge branch 'develop' into PLFM-6458", "committedDate": "2020-12-10T20:58:07Z", "type": "commit"}, {"oid": "3a1d6395ba5895053a034e42d0d2da27e4db7319", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3a1d6395ba5895053a034e42d0d2da27e4db7319", "message": " refactor id", "committedDate": "2020-12-10T21:46:23Z", "type": "commit"}, {"oid": "d8f6d49de8cb43bdf275821b5fa65c8f59c21f90", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/d8f6d49de8cb43bdf275821b5fa65c8f59c21f90", "message": " rename", "committedDate": "2020-12-10T21:57:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NDQ5MA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4238#discussion_r540584490", "bodyText": "We do not usually put the newline (\\n) in exception messages.", "author": "marcomarasca", "createdAt": "2020-12-10T23:47:06Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImpl.java", "diffHunk": "@@ -179,7 +180,13 @@ public AccessRequirement mapRow(ResultSet rs, int rowNum)\n \tpublic void delete(String id) {\n \t\tMapSqlParameterSource param = new MapSqlParameterSource();\n \t\tparam.addValue(COL_ACCESS_REQUIREMENT_ID.toLowerCase(), id);\n-\t\tbasicDao.deleteObjectByPrimaryKey(DBOAccessRequirement.class, param);\n+\t\ttry {\n+\t\t\tbasicDao.deleteObjectByPrimaryKey(DBOAccessRequirement.class, param);\n+\t\t} catch (DataIntegrityViolationException e) {\n+\t\t\tthrow new IllegalArgumentException(\"The access requirement with id \" + id +\n+\t\t\t\t\t\" cannot be deleted as it is referenced by another object \\n\"", "originalCommit": "d8f6d49de8cb43bdf275821b5fa65c8f59c21f90", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "18d5b0b3da7ab7ca98c9b687bf309229c59152ce", "chunk": "diff --git a/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImpl.java b/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImpl.java\nindex f80bb56410..a48f88e253 100644\n--- a/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImpl.java\n+++ b/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImpl.java\n\n@@ -184,7 +184,7 @@ public class DBOAccessRequirementDAOImpl implements AccessRequirementDAO {\n \t\t\tbasicDao.deleteObjectByPrimaryKey(DBOAccessRequirement.class, param);\n \t\t} catch (DataIntegrityViolationException e) {\n \t\t\tthrow new IllegalArgumentException(\"The access requirement with id \" + id +\n-\t\t\t\t\t\" cannot be deleted as it is referenced by another object \\n\"\n+\t\t\t\t\t\" cannot be deleted as it is referenced by another object \"\n \t\t\t\t\t, e);\n \t\t}\n \t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU4NTQ0OQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4238#discussion_r540585449", "bodyText": "This seems a wrong message for a not found object?", "author": "marcomarasca", "createdAt": "2020-12-10T23:49:19Z", "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImplTest.java", "diffHunk": "@@ -415,4 +431,40 @@ public void testGetAccessRequirementDiffWithSourceMoreRestricted() {\n \t\tassertEquals(Arrays.asList(accessRequirement.getId().toString()),\n \t\t\t\taccessRequirementDAO.getAccessRequirementDiff(sourceSubjects, destSubjects , RestrictableObjectType.ENTITY));\n \t}\n+\n+\t@Test\n+\tpublic void testDeleteAccessRequirement() {\n+\t\taccessRequirement = newEntityAccessRequirement(individualGroup, node, \"foo\");\n+\t\taccessRequirement = accessRequirementDAO.create(accessRequirement);\n+\t\tString accessRequirementId = String.valueOf(accessRequirement.getId());\n+\t\tString expectedMessage = \"AccessRequirement ID: \" + accessRequirementId;", "originalCommit": "d8f6d49de8cb43bdf275821b5fa65c8f59c21f90", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "18d5b0b3da7ab7ca98c9b687bf309229c59152ce", "chunk": "diff --git a/lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImplTest.java b/lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImplTest.java\nindex 415a39b1c0..d1fc1b2d1c 100644\n--- a/lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImplTest.java\n+++ b/lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOAccessRequirementDAOImplTest.java\n\n@@ -437,7 +437,7 @@ public class DBOAccessRequirementDAOImplTest {\n \t\taccessRequirement = newEntityAccessRequirement(individualGroup, node, \"foo\");\n \t\taccessRequirement = accessRequirementDAO.create(accessRequirement);\n \t\tString accessRequirementId = String.valueOf(accessRequirement.getId());\n-\t\tString expectedMessage = \"AccessRequirement ID: \" + accessRequirementId;\n+\t\tString expectedMessage = \"This AccessRequirement ID: \"+ accessRequirementId + \" cannot be found.\";\n \t\t// Call under test\n \t\taccessRequirementDAO.delete(accessRequirementId);\n \t\tNotFoundException exception = assertThrows(NotFoundException.class, () -> {\n"}}, {"oid": "18d5b0b3da7ab7ca98c9b687bf309229c59152ce", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/18d5b0b3da7ab7ca98c9b687bf309229c59152ce", "message": " PR changes", "committedDate": "2020-12-11T01:05:52Z", "type": "commit"}, {"oid": "0eb3ec9899e0838b73dc030ec46f3d57195fc004", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/0eb3ec9899e0838b73dc030ec46f3d57195fc004", "message": "test", "committedDate": "2020-12-11T01:21:17Z", "type": "commit"}, {"oid": "0b121540a46b67342248e5a2c0511a380f4ccaa3", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/0b121540a46b67342248e5a2c0511a380f4ccaa3", "message": "change error message", "committedDate": "2020-12-11T18:55:59Z", "type": "commit"}]}