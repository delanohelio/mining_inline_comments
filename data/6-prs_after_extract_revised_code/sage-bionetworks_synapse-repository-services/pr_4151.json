{"pr_number": 4151, "pr_title": "PLFM-6378: API to fetch the access approval notifications", "pr_createdAt": "2020-07-30T21:21:43Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4151", "timeline": [{"oid": "f7e37d569ccf80c141be3d7792227ed3352f65a2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/f7e37d569ccf80c141be3d7792227ed3352f65a2", "message": "PLFM-6378: Add method to fetch notifications", "committedDate": "2020-07-30T18:21:52Z", "type": "commit"}, {"oid": "182b364b28255aa6d1c9874654054f077bf2ffb8", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/182b364b28255aa6d1c9874654054f077bf2ffb8", "message": "PLFM-6220: Minor fixes", "committedDate": "2020-07-30T18:29:10Z", "type": "commit"}, {"oid": "058911bf1ec7120457ac2facda1165f31770eb2f", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/058911bf1ec7120457ac2facda1165f31770eb2f", "message": "PLFM-6378: Expose notification list request to the manager", "committedDate": "2020-07-30T20:17:40Z", "type": "commit"}, {"oid": "a9ea08626a654bbf66c78609eff961dd5594c53b", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/a9ea08626a654bbf66c78609eff961dd5594c53b", "message": "PLFM-6378: Expose new API to fetch approval notifications", "committedDate": "2020-07-30T21:20:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI5MDIyNw==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4151#discussion_r463290227", "bodyText": "Marcos says this should be an IN clause.", "author": "jay-hodgson", "createdAt": "2020-07-30T21:47:12Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/dataaccess/DataAccessNotificationDaoImpl.java", "diffHunk": "@@ -44,6 +47,11 @@\n \t\t\t+ \" AND \" + COL_DATA_ACCESS_NOTIFICATION_REQUIREMENT_ID + \" = ?\" \r\n \t\t\t+ \" AND \" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID + \" = ?\";\r\n \t\r\n+\tprivate static final String SQL_SELECT_FOR_RECIPIENTS = \"SELECT * FROM \" + TABLE_DATA_ACCESS_NOTIFICATION\r\n+\t\t\t+ \" WHERE \" + COL_DATA_ACCESS_NOTIFICATION_REQUIREMENT_ID + \" = :\" + COL_DATA_ACCESS_NOTIFICATION_REQUIREMENT_ID \r\n+\t\t\t+ \" AND \" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID + \" = :\" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID\r", "originalCommit": "a9ea08626a654bbf66c78609eff961dd5594c53b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d9f4b0093b410e8e4613c29cdea494cd4f19b8b", "chunk": "diff --git a/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/dataaccess/DataAccessNotificationDaoImpl.java b/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/dataaccess/DataAccessNotificationDaoImpl.java\nindex ff2b7ab913..ea42016fe6 100644\n--- a/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/dataaccess/DataAccessNotificationDaoImpl.java\n+++ b/lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/dataaccess/DataAccessNotificationDaoImpl.java\n\n@@ -49,7 +49,7 @@ public class DataAccessNotificationDaoImpl implements DataAccessNotificationDao\n \t\n \tprivate static final String SQL_SELECT_FOR_RECIPIENTS = \"SELECT * FROM \" + TABLE_DATA_ACCESS_NOTIFICATION\n \t\t\t+ \" WHERE \" + COL_DATA_ACCESS_NOTIFICATION_REQUIREMENT_ID + \" = :\" + COL_DATA_ACCESS_NOTIFICATION_REQUIREMENT_ID \n-\t\t\t+ \" AND \" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID + \" = :\" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID\n+\t\t\t+ \" AND \" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID + \" IN (:\" + COL_DATA_ACCESS_NOTIFICATION_RECIPIENT_ID + \")\"\n \t\t\t+ \" ORDER BY \" + COL_DATA_ACCESS_NOTIFICATION_SENT_ON;\n \t\n \t// We want all the access approvals for submitters (submitter == accessor) whose expiration date is in a \n"}}, {"oid": "7d9f4b0093b410e8e4613c29cdea494cd4f19b8b", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/7d9f4b0093b410e8e4613c29cdea494cd4f19b8b", "message": "PLFM-6378: Use IN rather than =", "committedDate": "2020-07-30T21:48:38Z", "type": "commit"}, {"oid": "30729eb14118e9b80d2d933ee34624a74d09e600", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/30729eb14118e9b80d2d933ee34624a74d09e600", "message": "PLFM-6378: Must be a admin or ACT to send the request", "committedDate": "2020-07-30T22:47:08Z", "type": "commit"}]}