{"pr_number": 7857, "pr_title": "[telegram] allow access restrictions on chat ids", "pr_createdAt": "2020-06-04T19:29:39Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7857", "timeline": [{"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "url": "https://github.com/openhab/openhab-addons/commit/20832d776ecd381af1e938f03ac7b9b1cef21b16", "message": "allow access restrictions on chat ids\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-04T19:14:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyOTcwNw==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r435729707", "bodyText": "Minor suggestion: use chatIdStr.substring(1) to remove the first character", "author": "ZzetT", "createdAt": "2020-06-05T07:10:00Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.replace(\"<\", \"\")));\n+                } else if (chatIdStr.startsWith(\">\")) {\n+                    // outbound only\n+                    receiverChatId.add(Long.valueOf(chatIdStr.replace(\">\", \"\")));", "originalCommit": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "chunk": "diff --git a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\nindex 9481b259b5..4d8a47858d 100644\n--- a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n+++ b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n\n@@ -145,12 +145,12 @@ public class TelegramHandler extends BaseThingHandler {\n \n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                if (chatIdStr.startsWith(\"<\")) {\n+                if (chatIdStr.trim().startsWith(\"<\")) {\n                     // inbound only\n-                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.replace(\"<\", \"\")));\n-                } else if (chatIdStr.startsWith(\">\")) {\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.substring(1)));\n+                } else if (chatIdStr.trim().startsWith(\">\")) {\n                     // outbound only\n-                    receiverChatId.add(Long.valueOf(chatIdStr.replace(\">\", \"\")));\n+                    receiverChatId.add(Long.valueOf(chatIdStr.substring(1)));\n                 } else {\n                     // bi-directional (default)\n                     Long chatId = Long.valueOf(chatIdStr);\n"}}, {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "url": "https://github.com/openhab/openhab-addons/commit/4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "message": "address review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-05T13:30:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0ODA0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r436248042", "bodyText": "If you trim() earlier it is not a good idea to use substring(1) on the not trimmed String. Maybe introduced a local variable for the `trimmedChatId and use it here and in the following lines.", "author": "cweitkamp", "createdAt": "2020-06-06T07:44:15Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.trim().startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.substring(1)));", "originalCommit": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0OTUyMw==", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r436249523", "bodyText": "Good point.Done.", "author": "J-N-K", "createdAt": "2020-06-06T08:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0ODA0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "0e53bb61098a3f7b4a419c893280110f86e8341b", "chunk": "diff --git a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\nindex 4d8a47858d..7104b05b72 100644\n--- a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n+++ b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n\n@@ -144,16 +144,17 @@ public class TelegramHandler extends BaseThingHandler {\n         receiverChatId.clear();\n \n         for (String chatIdStr : config.getChatIds()) {\n+            String trimmedChatId = chatIdStr.trim();\n             try {\n-                if (chatIdStr.trim().startsWith(\"<\")) {\n+                if (trimmedChatId.startsWith(\"<\")) {\n                     // inbound only\n-                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.substring(1)));\n-                } else if (chatIdStr.trim().startsWith(\">\")) {\n+                    authorizedSenderChatId.add(Long.valueOf(trimmedChatId.substring(1)));\n+                } else if (trimmedChatId.startsWith(\">\")) {\n                     // outbound only\n-                    receiverChatId.add(Long.valueOf(chatIdStr.substring(1)));\n+                    receiverChatId.add(Long.valueOf(trimmedChatId.substring(1)));\n                 } else {\n                     // bi-directional (default)\n-                    Long chatId = Long.valueOf(chatIdStr);\n+                    Long chatId = Long.valueOf(trimmedChatId);\n                     authorizedSenderChatId.add(chatId);\n                     receiverChatId.add(chatId);\n                 }\n"}}, {"oid": "0e53bb61098a3f7b4a419c893280110f86e8341b", "url": "https://github.com/openhab/openhab-addons/commit/0e53bb61098a3f7b4a419c893280110f86e8341b", "message": "address more review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-06-06T08:06:14Z", "type": "commit"}]}