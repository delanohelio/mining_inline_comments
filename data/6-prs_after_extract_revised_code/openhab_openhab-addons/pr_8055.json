{"pr_number": 8055, "pr_title": "[deconz] Add dynamic state descriptions and fix property updates", "pr_createdAt": "2020-07-02T20:50:41Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8055", "timeline": [{"oid": "da97a0c2da37d28c2b0f58164a57e38b5e1aba77", "url": "https://github.com/openhab/openhab-addons/commit/da97a0c2da37d28c2b0f58164a57e38b5e1aba77", "message": "add dynamic state descriptions and fix property updates\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-07-02T20:25:29Z", "type": "commit"}, {"oid": "31dfecc902cbc5ba76599cb782611441ee2e374a", "url": "https://github.com/openhab/openhab-addons/commit/31dfecc902cbc5ba76599cb782611441ee2e374a", "message": "fixes and improvements\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-07-05T10:29:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5Mzk4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8055#discussion_r451093985", "bodyText": "Would there ever be a circumstance in which a thing would contain CT_MIN and CT_MAX properties without the thingtype being THING_TYPE_COLOR_TEMPERATURE_LIGHT or THING_TYPE_EXTENDED_COLOR_LIGHT. Would it be possible to do away with the thingtype check here and only check for the presence of the properties instead?", "author": "cpmeister", "createdAt": "2020-07-07T19:29:46Z", "path": "bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/LightThingHandler.java", "diffHunk": "@@ -70,21 +77,51 @@\n \n     private final Logger logger = LoggerFactory.getLogger(LightThingHandler.class);\n \n+    private final StateDescriptionProvider stateDescriptionProvider;\n+\n     private long lastCommandExpireTimestamp = 0;\n+    private boolean needsPropertyUpdate = false;\n \n     /**\n      * The light state. Contains all possible fields for all supported lights\n      */\n     private LightState lightStateCache = new LightState();\n     private LightState lastCommand = new LightState();\n \n-    private final int ct_max;\n-    private final int ct_min;\n+    // set defaults, we can override them later if we receive better values\n+    private int ctMax = ZCL_CT_MAX;\n+    private int ctMin = ZCL_CT_MIN;\n \n-    public LightThingHandler(Thing thing, Gson gson) {\n+    public LightThingHandler(Thing thing, Gson gson, StateDescriptionProvider stateDescriptionProvider) {\n         super(thing, gson);\n-        ct_max = parseIntWithFallback(thing.getProperties().get(PROPERTY_CT_MAX), ZCL_CT_MAX);\n-        ct_min = parseIntWithFallback(thing.getProperties().get(PROPERTY_CT_MIN), ZCL_CT_MIN);\n+\n+        this.stateDescriptionProvider = stateDescriptionProvider;\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        if (thing.getThingTypeUID().equals(THING_TYPE_COLOR_TEMPERATURE_LIGHT)\n+                || thing.getThingTypeUID().equals(THING_TYPE_EXTENDED_COLOR_LIGHT)) {", "originalCommit": "31dfecc902cbc5ba76599cb782611441ee2e374a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE1ODg2OA==", "url": "https://github.com/openhab/openhab-addons/pull/8055#discussion_r451158868", "bodyText": "Unfortunately not. If you add the thing manually (either via PaperUI or .things-file) the properties are not present. We need to add them after we received these values. For unmanaged things this needs to be checked every time the thing is constructed. Since we only expect these\nProperties for the two thing-types, it\u2018s easier to check the thing-type first.\nFor auto-discovered things this is not necessary as the properties are added during discovery.", "author": "J-N-K", "createdAt": "2020-07-07T21:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTA5Mzk4NQ=="}], "type": "inlineReview", "revised_code": null}]}