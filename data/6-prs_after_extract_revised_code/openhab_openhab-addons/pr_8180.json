{"pr_number": 8180, "pr_title": "[telegram] Added support for long polling", "pr_createdAt": "2020-07-23T18:27:48Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8180", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDk5Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r460704992", "bodyText": "It's a good idea to move code blocks to a new separate methods. The only thing that I don't like now is that this method has side effects (adding elements to a list which is a class members). Whereas for the initialize method it is quite clear that it's only called once or if it is called more often, the lists are cleared beforehand. Now, you need a very implicit knowledge on that new method at what point in time this method shall be called and how often.\nThe best way would be to remove the side effect, make it static and to just return the result. However, returning two lists is also a bit ugly (e.g. using the Pair<> class).\nOr maybe we should at least move the authorizedSenderChatId.clear(); receiverChatId.clear(); to that method too so that the result of the method is always the same (no matter when and how often it is called). What is your opinion?", "author": "ZzetT", "createdAt": "2020-07-27T07:45:55Z", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -196,7 +183,34 @@ public void initialize() {\n         updateStatus(ThingStatus.UNKNOWN);\n         delayThingOnlineStatus();\n         TelegramBot localBot = bot = new TelegramBot.Builder(botToken).okHttpClient(botLibClient).build();\n-        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions);\n+        localBot.setUpdatesListener(this::handleUpdates, this::handleExceptions,\n+                getGetUpdatesRequest(config.getLongPollingTime()));\n+    }\n+\n+    private void createReceiverChatIdsAndAuthorizedSenderChatIds(List<String> chatIds) {", "originalCommit": "307feb149b7364d0c3363171ea7ece0d44b8b3e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA2MTU4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/8180#discussion_r461061582", "bodyText": "Of course, you're right. I have to move the clear-Methode into the new method. The the new method is deterministic.", "author": "EvilPingu", "createdAt": "2020-07-27T17:45:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDcwNDk5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "f7d85877b335497d62dee9f2ff42410149b7f680", "chunk": "diff --git a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\nindex 6e664e4465..93e0142a4f 100644\n--- a/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n+++ b/bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java\n\n@@ -188,6 +186,9 @@ public class TelegramHandler extends BaseThingHandler {\n     }\n \n     private void createReceiverChatIdsAndAuthorizedSenderChatIds(List<String> chatIds) {\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : chatIds) {\n             String trimmedChatId = chatIdStr.trim();\n             try {\n"}}, {"oid": "f7d85877b335497d62dee9f2ff42410149b7f680", "url": "https://github.com/openhab/openhab-addons/commit/f7d85877b335497d62dee9f2ff42410149b7f680", "message": "add long polling\n\nSigned-off-by: Christian Kittel <ckittel@gmx.de>", "committedDate": "2020-07-29T17:30:17Z", "type": "commit"}]}