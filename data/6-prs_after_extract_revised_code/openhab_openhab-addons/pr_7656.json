{"pr_number": 7656, "pr_title": "[mqtt.homeassistant] Create trigger channels for stateless sensors", "pr_createdAt": "2020-05-16T15:18:32Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7656", "timeline": [{"oid": "41ad015ad0e61eb6ecb9f66f592b753bd4ff8f5d", "url": "https://github.com/openhab/openhab-addons/commit/41ad015ad0e61eb6ecb9f66f592b753bd4ff8f5d", "message": "Create trigger channels for action and click objects\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>", "committedDate": "2020-05-15T12:45:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NTIzNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r426185235", "bodyText": "Why do you explicitly create the String[]? The asList method has varags paramters", "author": "jochen314", "createdAt": "2020-05-16T19:51:06Z", "path": "bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java", "diffHunk": "@@ -27,6 +30,7 @@\n @NonNullByDefault\n public class ComponentSensor extends AbstractComponent<ComponentSensor.ChannelConfiguration> {\n     public static final String sensorChannelID = \"sensor\"; // Randomly chosen channel \"ID\"\n+    private static final List<String> triggerObjectIDs = Arrays.asList(new String[] { \"click\", \"action\" });", "originalCommit": "41ad015ad0e61eb6ecb9f66f592b753bd4ff8f5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI2OTk5Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r426269996", "bodyText": "Sorry, I wasn't sure about what type of arguments the asList function would accept, so I looked up an example on the Internet. I will change it, thanks \ud83d\udc4d\nEDIT: I will delete this line, so it doesn't matter.", "author": "bodiroga", "createdAt": "2020-05-17T14:49:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NTIzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "0fb15d53ee1ac27b659c816c0c9cceea0323a35e", "chunk": "diff --git a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\nindex c5f8fd05cd..e7f35c1659 100644\n--- a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n+++ b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n\n@@ -30,7 +30,7 @@ import org.openhab.binding.mqtt.generic.values.Value;\n @NonNullByDefault\n public class ComponentSensor extends AbstractComponent<ComponentSensor.ChannelConfiguration> {\n     public static final String sensorChannelID = \"sensor\"; // Randomly chosen channel \"ID\"\n-    private static final List<String> triggerObjectIDs = Arrays.asList(new String[] { \"click\", \"action\" });\n+    private static final List<String> triggerIcons = Arrays.asList(\"mdi:toggle\", \"mdi:gesture\");\n \n     /**\n      * Configuration class for MQTT component\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NTI0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r426185241", "bodyText": "This is the part I am not happy with.\nThe check against 2 explicit values is not future save. I see many people wanting to have different values in the list also to make their device work.", "author": "jochen314", "createdAt": "2020-05-16T19:51:10Z", "path": "bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java", "diffHunk": "@@ -61,8 +65,12 @@ public ComponentSensor(CFactory.ComponentConfiguration componentConfiguration) {\n             value = new TextValue();\n         }\n \n+        String objectId = componentConfiguration.getHaID().objectID;\n+\n+        boolean trigger = triggerObjectIDs.contains(objectId);", "originalCommit": "41ad015ad0e61eb6ecb9f66f592b753bd4ff8f5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI3MDEzMA==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r426270130", "bodyText": "Oh, sorry, I think that I finally understood your concern regarding the 'action' and 'click' objectIDs topic \ud83e\udd26  I was thinking all the time that those were universal HA objects used to send event information, but know I see that they are Zigbee2Mqtt specific. I'm so sorry for the confusion \ud83d\ude07\nOk, would you accept changing the logic to detect if the icon name starts with \"mdi:gesture\" or \"mdi:toogle? That is one of your proposals in #6878 and seems to fit fine with Zigbee2Mqtt, so I would be happy to implement it \ud83d\udc4d", "author": "bodiroga", "createdAt": "2020-05-17T14:50:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NTI0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDU3ODc1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r460578751", "bodyText": "@jochen314 Can you comment on this?", "author": "fwolter", "createdAt": "2020-07-26T22:02:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4NTI0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "0fb15d53ee1ac27b659c816c0c9cceea0323a35e", "chunk": "diff --git a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\nindex c5f8fd05cd..e7f35c1659 100644\n--- a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n+++ b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n\n@@ -65,9 +65,12 @@ public class ComponentSensor extends AbstractComponent<ComponentSensor.ChannelCo\n             value = new TextValue();\n         }\n \n-        String objectId = componentConfiguration.getHaID().objectID;\n+        String icon = channelConfiguration.icon;\n \n-        boolean trigger = triggerObjectIDs.contains(objectId);\n+        boolean trigger = false;\n+        if (!icon.isEmpty()) {\n+            trigger = triggerIcons.stream().anyMatch(triggerIcon -> icon.startsWith(triggerIcon));\n+        }\n \n         buildChannel(sensorChannelID, value, channelConfiguration.name, componentConfiguration.getUpdateListener())//\n                 .stateTopic(channelConfiguration.state_topic, channelConfiguration.value_template)//\n"}}, {"oid": "0fb15d53ee1ac27b659c816c0c9cceea0323a35e", "url": "https://github.com/openhab/openhab-addons/commit/0fb15d53ee1ac27b659c816c0c9cceea0323a35e", "message": "Create trigger channels for stateless sensors\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>", "committedDate": "2020-05-17T15:47:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ1MjE2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r477452161", "bodyText": "How about:\nPattern triggerIcons = Pattern.compile(\"^mdi:(toggle|gesture).*$\");\n\nand then\nboolean trigger = triggerIcons.matcher(icon).matches();", "author": "jochen314", "createdAt": "2020-08-26T17:01:17Z", "path": "bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java", "diffHunk": "@@ -27,6 +30,7 @@\n @NonNullByDefault\n public class ComponentSensor extends AbstractComponent<ComponentSensor.ChannelConfiguration> {\n     public static final String sensorChannelID = \"sensor\"; // Randomly chosen channel \"ID\"\n+    private static final List<String> triggerIcons = Arrays.asList(\"mdi:toggle\", \"mdi:gesture\");", "originalCommit": "0fb15d53ee1ac27b659c816c0c9cceea0323a35e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYzMjU3Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7656#discussion_r478632572", "bodyText": "Thanks @jochen314 for your feedback! Changes done! \ud83d\ude09", "author": "bodiroga", "createdAt": "2020-08-27T19:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ1MjE2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "86e889421fa7dd9c4df76ed37ec5f358aacf5428", "chunk": "diff --git a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\nindex e7f35c1659..f658fc9985 100644\n--- a/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n+++ b/bundles/org.openhab.binding.mqtt.homeassistant/src/main/java/org/openhab/binding/mqtt/homeassistant/internal/ComponentSensor.java\n\n@@ -30,7 +29,7 @@ import org.openhab.binding.mqtt.generic.values.Value;\n @NonNullByDefault\n public class ComponentSensor extends AbstractComponent<ComponentSensor.ChannelConfiguration> {\n     public static final String sensorChannelID = \"sensor\"; // Randomly chosen channel \"ID\"\n-    private static final List<String> triggerIcons = Arrays.asList(\"mdi:toggle\", \"mdi:gesture\");\n+    private static final Pattern triggerIcons = Pattern.compile(\"^mdi:(toggle|gesture).*$\");\n \n     /**\n      * Configuration class for MQTT component\n"}}, {"oid": "86e889421fa7dd9c4df76ed37ec5f358aacf5428", "url": "https://github.com/openhab/openhab-addons/commit/86e889421fa7dd9c4df76ed37ec5f358aacf5428", "message": "Address review comments\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>", "committedDate": "2020-08-27T19:00:43Z", "type": "commit"}]}