{"pr_number": 9194, "pr_title": "[digitalstrom] fixes StringIndexOutOfBoundsException", "pr_createdAt": "2020-12-01T20:35:26Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9194", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0OTUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/9194#discussion_r534349533", "bodyText": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the openHab coding guidelines for expected use of logging in bindings.\nI suggest logging warn instead. Also please try to catch specific exceptions or at the very least RuntimeException. In addition, you should always log the exception or at the very least the exception message to make debugging easier.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (Exception ex) {\n          \n          \n            \n                        logger.error(\"Unable to add devices {}\", device);\n          \n          \n            \n                    } catch (RuntimeException ex) {\n          \n          \n            \n                        logger.warn(\"Unable to add devices {}: {}\", device, ex.getMessage());", "author": "cpmeister", "createdAt": "2020-12-02T17:28:09Z", "path": "bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java", "diffHunk": "@@ -194,20 +198,25 @@ public void onDeviceRemoved(GeneralDeviceInformation device) {\n \n     @Override\n     public void onDeviceAdded(GeneralDeviceInformation device) {\n-        if (device instanceof Device) {\n-            String id = ((Device) device).getHWinfo().substring(0, 2);\n-            if (((Device) device).isSensorDevice()) {\n-                id = ((Device) device).getHWinfo();\n-            }\n-            if (discoveryServices.get(id) != null) {\n-                ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+        try {\n+            if (device instanceof Device) {\n+                String id = ((Device) device).getHWinfo().substring(0, 2);\n+                if (((Device) device).isSensorDevice()) {\n+                    id = ((Device) device).getHWinfo();\n+                }\n+                if (discoveryServices.get(id) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+                }\n             }\n-        }\n-        if (device instanceof Circuit) {\n-            if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n-                ((DeviceDiscoveryService) discoveryServices\n-                        .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString())).onDeviceAdded(device);\n+            if (device instanceof Circuit) {\n+                if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices\n+                            .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()))\n+                                    .onDeviceAdded(device);\n+                }\n             }\n+        } catch (Exception ex) {\n+            logger.error(\"Unable to add devices {}\", device);", "originalCommit": "82b31b205b6686668806e517199aaf4795c4fd54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQwMTA3Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9194#discussion_r534401076", "bodyText": "I guess I wrote this a bit too fast and forgot to forward the exception.\nAgree for le level. No problem for me. I will put the complete stacktrace instead of just the message if it's ok for you ?", "author": "gaetancollaud", "createdAt": "2020-12-02T18:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0OTUzMw=="}], "type": "inlineReview", "revised_code": {"commit": "44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "chunk": "diff --git a/bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java b/bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\nindex 5807010f26..be1d72eb3e 100644\n--- a/bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\n+++ b/bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\n\n@@ -215,8 +215,8 @@ public class DiscoveryServiceManager\n                                     .onDeviceAdded(device);\n                 }\n             }\n-        } catch (Exception ex) {\n-            logger.error(\"Unable to add devices {}\", device);\n+        } catch (RuntimeException ex) {\n+            logger.warn(\"Unable to add devices {}: {}\", device, ex.getMessage());\n         }\n     }\n \n"}}, {"oid": "a001d717078bc469840d5a81b659157e89e493bb", "url": "https://github.com/openhab/openhab-addons/commit/a001d717078bc469840d5a81b659157e89e493bb", "message": "[digitalstrom] catch issues when adding devices\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "url": "https://github.com/openhab/openhab-addons/commit/44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "message": "Update bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "commit"}, {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>", "committedDate": "2020-12-02T18:48:40Z", "type": "forcePushed"}]}