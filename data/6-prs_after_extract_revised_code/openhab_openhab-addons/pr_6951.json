{"pr_number": 6951, "pr_title": "[squeezebox] Add source channel", "pr_createdAt": "2020-02-01T15:06:25Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/6951", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4ODU2NQ==", "url": "https://github.com/openhab/openhab-addons/pull/6951#discussion_r373788565", "bodyText": "Shouldn't you check messageParts.length to avoid an AIOOB exception?", "author": "mhilbush", "createdAt": "2020-02-01T16:31:55Z", "path": "bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java", "diffHunk": "@@ -853,6 +853,10 @@ public void updateListener(SqueezeBoxPlayerEventListener listener) {\n                 mode = messageParts[3].equals(\"0\") ? \"play\" : \"pause\";\n             } else if (action.equals(\"stop\")) {\n                 mode = \"stop\";\n+            } else if (\"play\".equals(action) && \"playlist\".equals(messageParts[1])) {\n+                String playListUrl = messageParts[3];", "originalCommit": "f8d6a7b94024e26b4ce1ee867dad745110d24a9b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a286a56f0f31efd2b97bd8cf98511c0ca46d768", "chunk": "diff --git a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\nindex 0de9baf476..ef71cae9cc 100644\n--- a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n+++ b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n\n@@ -854,8 +854,9 @@ public class SqueezeBoxServerHandler extends BaseBridgeHandler {\n             } else if (action.equals(\"stop\")) {\n                 mode = \"stop\";\n             } else if (\"play\".equals(action) && \"playlist\".equals(messageParts[1])) {\n-                String playListUrl = messageParts[3];\n-                handleSourceChangeMessage(mac, playListUrl);\n+                if (messageParts.length >= 4) {\n+                    handleSourceChangeMessage(mac, messageParts[3]);\n+                }\n                 return;\n             } else {\n                 // Added so that actions (such as delete, index, jump, open) are not treated as \"play\"\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4ODY3NQ==", "url": "https://github.com/openhab/openhab-addons/pull/6951#discussion_r373788675", "bodyText": "Can't you just replace playListUrl with messageParts[3]?", "author": "mhilbush", "createdAt": "2020-02-01T16:34:35Z", "path": "bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java", "diffHunk": "@@ -853,6 +853,10 @@ public void updateListener(SqueezeBoxPlayerEventListener listener) {\n                 mode = messageParts[3].equals(\"0\") ? \"play\" : \"pause\";\n             } else if (action.equals(\"stop\")) {\n                 mode = \"stop\";\n+            } else if (\"play\".equals(action) && \"playlist\".equals(messageParts[1])) {\n+                String playListUrl = messageParts[3];\n+                handleSourceChangeMessage(mac, playListUrl);", "originalCommit": "f8d6a7b94024e26b4ce1ee867dad745110d24a9b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a286a56f0f31efd2b97bd8cf98511c0ca46d768", "chunk": "diff --git a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\nindex 0de9baf476..ef71cae9cc 100644\n--- a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n+++ b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n\n@@ -854,8 +854,9 @@ public class SqueezeBoxServerHandler extends BaseBridgeHandler {\n             } else if (action.equals(\"stop\")) {\n                 mode = \"stop\";\n             } else if (\"play\".equals(action) && \"playlist\".equals(messageParts[1])) {\n-                String playListUrl = messageParts[3];\n-                handleSourceChangeMessage(mac, playListUrl);\n+                if (messageParts.length >= 4) {\n+                    handleSourceChangeMessage(mac, messageParts[3]);\n+                }\n                 return;\n             } else {\n                 // Added so that actions (such as delete, index, jump, open) are not treated as \"play\"\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc4ODgwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/6951#discussion_r373788809", "bodyText": "Can't you just pass source instead of value?", "author": "mhilbush", "createdAt": "2020-02-01T16:36:48Z", "path": "bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java", "diffHunk": "@@ -869,6 +873,20 @@ public void updateListener(SqueezeBoxPlayerEventListener listener) {\n             });\n         }\n \n+        private void handleSourceChangeMessage(String mac, String rawSource) {\n+            String source = URLDecoder.decode(rawSource);\n+\n+            final String value = source;\n+            updatePlayer(new PlayerUpdateEvent() {\n+\n+                @Override\n+                public void updateListener(SqueezeBoxPlayerEventListener listener) {\n+                    listener.sourceChangeEvent(mac, value);", "originalCommit": "f8d6a7b94024e26b4ce1ee867dad745110d24a9b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9a286a56f0f31efd2b97bd8cf98511c0ca46d768", "chunk": "diff --git a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\nindex 0de9baf476..ef71cae9cc 100644\n--- a/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n+++ b/bundles/org.openhab.binding.squeezebox/src/main/java/org/openhab/binding/squeezebox/internal/handler/SqueezeBoxServerHandler.java\n\n@@ -876,12 +877,11 @@ public class SqueezeBoxServerHandler extends BaseBridgeHandler {\n         private void handleSourceChangeMessage(String mac, String rawSource) {\n             String source = URLDecoder.decode(rawSource);\n \n-            final String value = source;\n             updatePlayer(new PlayerUpdateEvent() {\n \n                 @Override\n                 public void updateListener(SqueezeBoxPlayerEventListener listener) {\n-                    listener.sourceChangeEvent(mac, value);\n+                    listener.sourceChangeEvent(mac, source);\n                 }\n \n             });\n"}}, {"oid": "9a286a56f0f31efd2b97bd8cf98511c0ca46d768", "url": "https://github.com/openhab/openhab-addons/commit/9a286a56f0f31efd2b97bd8cf98511c0ca46d768", "message": "[squeezebox] Address review comments\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-02-04T08:56:00Z", "type": "forcePushed"}, {"oid": "89f7041071e5252106fbd8197fcae49df1aa506e", "url": "https://github.com/openhab/openhab-addons/commit/89f7041071e5252106fbd8197fcae49df1aa506e", "message": "[squeezebox] Add source channel\n\nThe source channel shows from where the current playlist entry is played\nfrom. For web radios this will be the URL, i.e.\nhttp://www.myradio.org/radio.mp3.\n\nThis is particularly helpful if one wants to know the current source to\nplay something else and afterwards revert to the source before.\n\nFor announcements via the openHAB \"say\" infrastructure this works out of\nthe box with ONE squeezebox sink. It cannot work if one synchronizes\nmultiple sinks, because the Logitech Media Server will then use the source\nfrom the squeezebox instance where the other instances were synchronized to.\nSo the other instances will play whatever was played in the instance they\nwere synchronized to.\n\nWith the new source channel one is able to restore the last played source\nbefore the announcement using the stream channel in case a stream was played\nbefore.\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-02-04T09:01:26Z", "type": "commit"}, {"oid": "0c5e080845e05d1b7bc62129c81e17f584fe8e94", "url": "https://github.com/openhab/openhab-addons/commit/0c5e080845e05d1b7bc62129c81e17f584fe8e94", "message": "[squeezebox] Address review comments\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-02-04T09:01:37Z", "type": "commit"}, {"oid": "0c5e080845e05d1b7bc62129c81e17f584fe8e94", "url": "https://github.com/openhab/openhab-addons/commit/0c5e080845e05d1b7bc62129c81e17f584fe8e94", "message": "[squeezebox] Address review comments\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-02-04T09:01:37Z", "type": "forcePushed"}]}