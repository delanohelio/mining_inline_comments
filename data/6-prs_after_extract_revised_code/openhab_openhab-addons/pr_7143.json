{"pr_number": 7143, "pr_title": "[goecharger] fixed access config command and parse command response", "pr_createdAt": "2020-03-10T18:59:55Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7143", "timeline": [{"oid": "7098bb95bead9d024ce587d90788f5c0c2e7ff2a", "url": "https://github.com/openhab/openhab-addons/commit/7098bb95bead9d024ce587d90788f5c0c2e7ff2a", "message": "fixed access state and parse command rsponse\n\nSigned-off-by: Samuel Brucksch <sasliga@freenet.de>", "committedDate": "2020-03-10T18:54:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2NTgwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390565804", "bodyText": "You can now save contentResponse.getContentAsString() to a variable and also use it in the log statement above. Since the content string is now used anyways, it also makes sense to unconditionally log it without if (logger.isDebugEnabled()) { since it won't have an additional impact on performance.", "author": "wborn", "createdAt": "2020-03-10T19:40:57Z", "path": "bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java", "diffHunk": "@@ -287,7 +301,9 @@ private void sendData(String key, String value) {\n             if (logger.isDebugEnabled()) {\n                 logger.debug(\"Response: {}\", contentResponse.getContentAsString());\n             }\n-            updateStatus(ThingStatus.ONLINE, ThingStatusDetail.NONE);\n+            GoEStatusResponseDTO result = gson.fromJson(contentResponse.getContentAsString(),", "originalCommit": "7098bb95bead9d024ce587d90788f5c0c2e7ff2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1NTY3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390755677", "bodyText": "fixed it for both get and post", "author": "SamuelBrucksch", "createdAt": "2020-03-11T05:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU2NTgwNA=="}], "type": "inlineReview", "revised_code": {"commit": "c17a298fdbb7017c357108ccbe21bd8131273fbd", "chunk": "diff --git a/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java b/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\nindex 18a3b12bb2..cf66cdfc69 100755\n--- a/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\n+++ b/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\n\n@@ -298,11 +298,9 @@ public class GoEChargerHandler extends BaseThingHandler {\n         try {\n             ContentResponse contentResponse = httpClient.newRequest(urlStr).method(HttpMethod.POST)\n                     .timeout(5, TimeUnit.SECONDS).send();\n-            if (logger.isDebugEnabled()) {\n-                logger.debug(\"Response: {}\", contentResponse.getContentAsString());\n-            }\n-            GoEStatusResponseDTO result = gson.fromJson(contentResponse.getContentAsString(),\n-                    GoEStatusResponseDTO.class);\n+            String response = contentResponse.getContentAsString();\n+            logger.debug(\"POST Response: {}\", response);\n+            GoEStatusResponseDTO result = gson.fromJson(response, GoEStatusResponseDTO.class);\n             updateChannelsAndStatus(result);\n         } catch (InterruptedException | TimeoutException | ExecutionException e) {\n             updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.OFFLINE.COMMUNICATION_ERROR,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3MTcwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390571706", "bodyText": "I would make sure to either log the exception or include the exception message as part of the status details.\nThere is a big difference between a device not responding and the device returning erroneous data. It is beneficial for the user to know which one it is.\nAlso make sure to catch JsonSyntaxException!\nThis also applies to thegetGoEData() below.", "author": "cpmeister", "createdAt": "2020-03-10T19:52:27Z", "path": "bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java", "diffHunk": "@@ -287,7 +301,9 @@ private void sendData(String key, String value) {\n             if (logger.isDebugEnabled()) {\n                 logger.debug(\"Response: {}\", contentResponse.getContentAsString());\n             }\n-            updateStatus(ThingStatus.ONLINE, ThingStatusDetail.NONE);\n+            GoEStatusResponseDTO result = gson.fromJson(contentResponse.getContentAsString(),\n+                    GoEStatusResponseDTO.class);\n+            updateChannelsAndStatus(result);\n         } catch (InterruptedException | TimeoutException | ExecutionException e) {\n             updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.OFFLINE.COMMUNICATION_ERROR,\n                     \"No response received on command\");", "originalCommit": "7098bb95bead9d024ce587d90788f5c0c2e7ff2a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1NDM3OA==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390754378", "bodyText": "So how detailed should the messages of the thing status update be? I guess a complete exception stacktrace is too much, but the message itself should be ok?", "author": "SamuelBrucksch", "createdAt": "2020-03-11T05:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3MTcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDc1NTc5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390755793", "bodyText": "Using just the message is perfectly fine.", "author": "cpmeister", "createdAt": "2020-03-11T05:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3MTcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDgyMDQyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r390820427", "bodyText": "So i guess i can just use\ncatch (Exception e) {\n  updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.OFFLINE.COMMUNICATION_ERROR,\n                    e.getMessage());\n}\n\nThat also includes json exceptions then", "author": "SamuelBrucksch", "createdAt": "2020-03-11T08:51:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3MTcwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTE3MjAyMA==", "url": "https://github.com/openhab/openhab-addons/pull/7143#discussion_r391172020", "bodyText": "Nope. Never catch Exception. But you can catch several exceptions in one catch-clause, e.g.\ntry {\n    ....\n} catch (IOException | JsonException | WhateverException e) {\n    do your exception handling here\n}", "author": "J-N-K", "createdAt": "2020-03-11T18:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDU3MTcwNg=="}], "type": "inlineReview", "revised_code": {"commit": "c17a298fdbb7017c357108ccbe21bd8131273fbd", "chunk": "diff --git a/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java b/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\nindex 18a3b12bb2..cf66cdfc69 100755\n--- a/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\n+++ b/bundles/org.openhab.binding.goecharger/src/main/java/org/openhab/binding/goecharger/internal/handler/GoEChargerHandler.java\n\n@@ -298,11 +298,9 @@ public class GoEChargerHandler extends BaseThingHandler {\n         try {\n             ContentResponse contentResponse = httpClient.newRequest(urlStr).method(HttpMethod.POST)\n                     .timeout(5, TimeUnit.SECONDS).send();\n-            if (logger.isDebugEnabled()) {\n-                logger.debug(\"Response: {}\", contentResponse.getContentAsString());\n-            }\n-            GoEStatusResponseDTO result = gson.fromJson(contentResponse.getContentAsString(),\n-                    GoEStatusResponseDTO.class);\n+            String response = contentResponse.getContentAsString();\n+            logger.debug(\"POST Response: {}\", response);\n+            GoEStatusResponseDTO result = gson.fromJson(response, GoEStatusResponseDTO.class);\n             updateChannelsAndStatus(result);\n         } catch (InterruptedException | TimeoutException | ExecutionException e) {\n             updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.OFFLINE.COMMUNICATION_ERROR,\n"}}, {"oid": "c17a298fdbb7017c357108ccbe21bd8131273fbd", "url": "https://github.com/openhab/openhab-addons/commit/c17a298fdbb7017c357108ccbe21bd8131273fbd", "message": "used variable for response string\n\nSigned-off-by: Samuel Brucksch <sasliga@freenet.de>", "committedDate": "2020-03-11T05:39:43Z", "type": "commit"}, {"oid": "52370aa0994c259a6d83aec2c11d35d3b775c996", "url": "https://github.com/openhab/openhab-addons/commit/52370aa0994c259a6d83aec2c11d35d3b775c996", "message": "improved error messages for offline state\n\nSigned-off-by: Samuel Brucksch <sasliga@freenet.de>", "committedDate": "2020-03-11T19:14:52Z", "type": "commit"}]}