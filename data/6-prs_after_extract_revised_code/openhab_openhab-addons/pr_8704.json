{"pr_number": 8704, "pr_title": "[deconz] retry full state request if initial request failed", "pr_createdAt": "2020-10-09T13:55:14Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8704", "timeline": [{"oid": "118199af423fb3de7e5c971b4cd39e835a80a414", "url": "https://github.com/openhab/openhab-addons/commit/118199af423fb3de7e5c971b4cd39e835a80a414", "message": "retry full state request if initial request failed\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-10-09T13:54:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY3MDI2MA==", "url": "https://github.com/openhab/openhab-addons/pull/8704#discussion_r502670260", "bodyText": "Shouldn't this be cancelled when the Bridge is disposed?", "author": "fwolter", "createdAt": "2020-10-09T21:03:44Z", "path": "bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/DeconzBridgeHandler.java", "diffHunk": "@@ -182,6 +182,7 @@ public void requestFullState() {\n             }\n         }).thenAccept(fullState -> {\n             if (fullState == null) {\n+                scheduler.schedule(this::requestFullState, POLL_FREQUENCY_SEC, TimeUnit.SECONDS);", "originalCommit": "118199af423fb3de7e5c971b4cd39e835a80a414", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c2d87c94828e9828f22a6c78cec029fbf9402eeb", "chunk": "diff --git a/bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/DeconzBridgeHandler.java b/bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/DeconzBridgeHandler.java\nindex 0c0ae6dcdf..b24be497ae 100644\n--- a/bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/DeconzBridgeHandler.java\n+++ b/bundles/org.openhab.binding.deconz/src/main/java/org/openhab/binding/deconz/internal/handler/DeconzBridgeHandler.java\n\n@@ -182,7 +182,10 @@ public class DeconzBridgeHandler extends BaseBridgeHandler implements WebSocketC\n             }\n         }).thenAccept(fullState -> {\n             if (fullState == null) {\n-                scheduler.schedule(this::requestFullState, POLL_FREQUENCY_SEC, TimeUnit.SECONDS);\n+                if (isInitialRequest) {\n+                    scheduledFuture = scheduler.schedule(() -> requestFullState(true), POLL_FREQUENCY_SEC,\n+                            TimeUnit.SECONDS);\n+                }\n                 return;\n             }\n             if (fullState.config.name.isEmpty()) {\n"}}, {"oid": "c2d87c94828e9828f22a6c78cec029fbf9402eeb", "url": "https://github.com/openhab/openhab-addons/commit/c2d87c94828e9828f22a6c78cec029fbf9402eeb", "message": "Improve handling of full requests\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>", "committedDate": "2020-10-10T07:32:39Z", "type": "commit"}]}