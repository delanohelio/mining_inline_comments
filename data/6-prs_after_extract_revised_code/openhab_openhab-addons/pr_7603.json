{"pr_number": 7603, "pr_title": "[knx] Fix disposal of DeviceThingHandler", "pr_createdAt": "2020-05-11T17:20:28Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7603", "timeline": [{"oid": "73f8ad06f05c229b36e90fbb755a7fed9c37d2b4", "url": "https://github.com/openhab/openhab-addons/commit/73f8ad06f05c229b36e90fbb755a7fed9c37d2b4", "message": "[knx] Fix disposal of DeviceThingHandler\n\nOn disposal of the DeviceThingHandler several scheduled futures were not\ncanceled and internal datastructures were not reset.\n\nThis leads to a problem if one changes the thing configuration, for example\nvia editing the .things file. Then `dispose()` and `initialize()` will be\ncalled and the datastructures will still also contain the old values.\n\nThis is nasty in cases where one wants to change the group addresses for\nchannels.\n\nAlso the `address` field from the `AbstractKNXThingHandler` was redefined\nin the `DeviceThingHandler` but never ever set there.\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-05-11T17:19:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MzA0MA==", "url": "https://github.com/openhab/openhab-addons/pull/7603#discussion_r423273040", "bodyText": "super.dispose() should be called last", "author": "cpmeister", "createdAt": "2020-05-11T19:37:36Z", "path": "bundles/org.openhab.binding.knx/src/main/java/org/openhab/binding/knx/internal/handler/DeviceThingHandler.java", "diffHunk": "@@ -97,6 +96,28 @@ private void initializeGroupAddresses() {\n         });\n     }\n \n+    @Override\n+    public void dispose() {\n+        super.dispose();", "originalCommit": "73f8ad06f05c229b36e90fbb755a7fed9c37d2b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ5MDUyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/7603#discussion_r423490525", "bodyText": "Done", "author": "t2000", "createdAt": "2020-05-12T06:29:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MzA0MA=="}], "type": "inlineReview", "revised_code": {"commit": "850620590c2d7438f62dd81dd0cf14247306a59f", "chunk": "diff --git a/bundles/org.openhab.binding.knx/src/main/java/org/openhab/binding/knx/internal/handler/DeviceThingHandler.java b/bundles/org.openhab.binding.knx/src/main/java/org/openhab/binding/knx/internal/handler/DeviceThingHandler.java\nindex 39e980ca20..5f5f92b31b 100644\n--- a/bundles/org.openhab.binding.knx/src/main/java/org/openhab/binding/knx/internal/handler/DeviceThingHandler.java\n+++ b/bundles/org.openhab.binding.knx/src/main/java/org/openhab/binding/knx/internal/handler/DeviceThingHandler.java\n\n@@ -98,9 +98,9 @@ public class DeviceThingHandler extends AbstractKNXThingHandler {\n \n     @Override\n     public void dispose() {\n-        super.dispose();\n         cancelChannelFutures();\n         freeGroupAdresses();\n+        super.dispose();\n     }\n \n     private void cancelChannelFutures() {\n"}}, {"oid": "850620590c2d7438f62dd81dd0cf14247306a59f", "url": "https://github.com/openhab/openhab-addons/commit/850620590c2d7438f62dd81dd0cf14247306a59f", "message": "Call super.dispose last\n\nSigned-off-by: Stefan Triller <github@stefantriller.de>", "committedDate": "2020-05-12T06:27:34Z", "type": "commit"}]}