{"pr_number": 7620, "pr_title": "[jeelink] Use serial transport", "pr_createdAt": "2020-05-12T22:35:33Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7620", "timeline": [{"oid": "f61231fd161f86224b42b8c8b9d875580a127045", "url": "https://github.com/openhab/openhab-addons/commit/f61231fd161f86224b42b8c8b9d875580a127045", "message": "[jeelink] Use serial transport\n\nRelated to #7573\n\nSigned-off-by: Wouter Born <github@maindrain.net>", "committedDate": "2020-05-12T22:34:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NTczMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7620#discussion_r424095731", "bodyText": "Is it possible to move this logic into JeeLinkHandler's initialize method so you can put the thing offline with a config error? You should be able to pass around the SerialPortIdentifier instance instead of the SerialPortManager instance.", "author": "cpmeister", "createdAt": "2020-05-12T23:45:15Z", "path": "bundles/org.openhab.binding.jeelink/src/main/java/org/openhab/binding/jeelink/internal/connection/JeeLinkSerialConnection.java", "diffHunk": "@@ -69,9 +70,12 @@ public synchronized void openConnection() {\n             if (!open) {\n                 logger.debug(\"Opening serial connection to port {} with baud rate {}...\", port, baudRate);\n \n-                CommPortIdentifier portIdentifier;\n+                SerialPortIdentifier portIdentifier = serialPortManager.getIdentifier(port);\n+                if (portIdentifier == null) {\n+                    notifyAbort(\"Port not found: \" + port);\n+                    return;\n+                }", "originalCommit": "f61231fd161f86224b42b8c8b9d875580a127045", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY5NTc3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/7620#discussion_r424695779", "bodyText": "After revisiting the code it looks like it is possible. The static method was only used by the handler so that saves another level of passing stuff around. :-)", "author": "wborn", "createdAt": "2020-05-13T19:58:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDA5NTczMQ=="}], "type": "inlineReview", "revised_code": {"commit": "31876d36e4cc309b4fa5899a291765db600a7799", "chunk": "diff --git a/bundles/org.openhab.binding.jeelink/src/main/java/org/openhab/binding/jeelink/internal/connection/JeeLinkSerialConnection.java b/bundles/org.openhab.binding.jeelink/src/main/java/org/openhab/binding/jeelink/internal/connection/JeeLinkSerialConnection.java\nindex 128e6abed2..98dd585745 100644\n--- a/bundles/org.openhab.binding.jeelink/src/main/java/org/openhab/binding/jeelink/internal/connection/JeeLinkSerialConnection.java\n+++ b/bundles/org.openhab.binding.jeelink/src/main/java/org/openhab/binding/jeelink/internal/connection/JeeLinkSerialConnection.java\n\n@@ -69,14 +68,7 @@ public class JeeLinkSerialConnection extends AbstractJeeLinkConnection {\n         try {\n             if (!open) {\n                 logger.debug(\"Opening serial connection to port {} with baud rate {}...\", port, baudRate);\n-\n-                SerialPortIdentifier portIdentifier = serialPortManager.getIdentifier(port);\n-                if (portIdentifier == null) {\n-                    notifyAbort(\"Port not found: \" + port);\n-                    return;\n-                }\n-\n-                serialPort = portIdentifier.open(\"openhab\", 3000);\n+                serialPort = serialPortIdentifier.open(\"openhab\", 3000);\n                 open = true;\n \n                 serialPort.setSerialPortParams(baudRate, SerialPort.DATABITS_8, SerialPort.STOPBITS_1,\n"}}, {"oid": "31876d36e4cc309b4fa5899a291765db600a7799", "url": "https://github.com/openhab/openhab-addons/commit/31876d36e4cc309b4fa5899a291765db600a7799", "message": "Pass around SerialPortIdentifier instead of SerialPortManager\n\nSigned-off-by: Wouter Born <github@maindrain.net>", "committedDate": "2020-05-13T19:56:05Z", "type": "commit"}]}