{"pr_number": 8222, "pr_title": "[avmfritz] Added ThingActions to handle Boost and Window-Open modes for heating devices / groups", "pr_createdAt": "2020-07-29T12:38:44Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8222", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465345585", "bodyText": "I am actually not certain myself anymore, but shouldn't actions be in exported packages, so that they can be seen by the rule engine? Scanning our repo here, I noticed that we have a few bindings putting actions in exported packages, while others have it in internal packages...", "author": "kaikreuzer", "createdAt": "2020-08-04T21:39:37Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.avmfritz.internal.actions;", "originalCommit": "1ce0f1aa0000a1270952578de164e25812b38876", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk0NjM1Ng==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465946356", "bodyText": "Me neither. But does the rule engine really need to know them? I don't think so because we use a wrapper action to access all available ThingActions by filtering on scope and ThingUID.", "author": "cweitkamp", "createdAt": "2020-08-05T19:14:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5NjczOQ==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465996739", "bodyText": "It is using the wrapper at runtime, but for the DSL and specifically the content completion in the editor, it is imho required:\n\nThe mail action is so far the only one I am using, but that one is in an exported package, so I'd suggest to do the same with the others.", "author": "kaikreuzer", "createdAt": "2020-08-05T20:52:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjYwMDk5Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r466600997", "bodyText": "Good point. I moved them.", "author": "cweitkamp", "createdAt": "2020-08-06T18:19:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcwNjg4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r476706883", "bodyText": "I see that you moved not only the Actions class, but also the AVMFritzHeatingActionsHandler interface - is this necessary to be exposed? If not, I'd say it should stay internal.", "author": "kaikreuzer", "createdAt": "2020-08-25T20:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc0NjgwNA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r479746804", "bodyText": "I moved it back to an internal package.", "author": "cweitkamp", "createdAt": "2020-08-30T09:38:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NTU4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "bc0ec94e2769bbf26bad00aa26fd5709fc6642f9", "chunk": "diff --git a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\nsimilarity index 98%\nrename from bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nrename to bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\nindex 3a8c038540..3f818bac07 100644\n--- a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\n+++ b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\n\n@@ -10,7 +10,7 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0\n  */\n-package org.openhab.binding.avmfritz.internal.actions;\n+package org.openhab.binding.avmfritz.actions;\n \n import java.lang.reflect.Method;\n import java.lang.reflect.Proxy;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0ODI1MA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465348250", "bodyText": "I know, it has not been introduced by you, but is it intentionally getWindowopenactiv and not getWindowopenactive?", "author": "kaikreuzer", "createdAt": "2020-08-04T21:45:37Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/dto/HeatingModel.java", "diffHunk": "@@ -153,14 +155,26 @@ public void setBatterylow(BigDecimal batterylow) {\n         this.batterylow = batterylow;\n     }\n \n-    public BigDecimal getWindowopenactiv() {\n+    public @Nullable BigDecimal getWindowopenactiv() {", "originalCommit": "1ce0f1aa0000a1270952578de164e25812b38876", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk0NDk4NA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465944984", "bodyText": "It has been introduced by me some years ago. I just reused the names of the XML tags for DTOs. And it is written in that way over there too.", "author": "cweitkamp", "createdAt": "2020-08-05T19:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0ODI1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk5MzgyMA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r465993820", "bodyText": "ok :-)", "author": "kaikreuzer", "createdAt": "2020-08-05T20:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0ODI1MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUwNzQ3MA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r477507470", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .of(SUPPORTED_BUTTON_THING_TYPES_UIDS.stream(), SUPPORTED_HEATING_THING_TYPES.stream(),\n          \n          \n            \n                                SUPPORTED_DEVICE_THING_TYPES_UIDS.stream(), SUPPORTED_GROUP_THING_TYPES_UIDS.stream(),\n          \n          \n            \n                                SUPPORTED_BRIDGE_THING_TYPES_UIDS.stream())\n          \n          \n            \n                        .reduce(Stream::concat).orElseGet(Stream::empty).collect(Collectors.toSet()));\n          \n          \n            \n                        .of(SUPPORTED_BUTTON_THING_TYPES_UIDS, SUPPORTED_HEATING_THING_TYPES,\n          \n          \n            \n                                SUPPORTED_DEVICE_THING_TYPES_UIDS, SUPPORTED_GROUP_THING_TYPES_UIDS,\n          \n          \n            \n                                SUPPORTED_BRIDGE_THING_TYPES_UIDS)\n          \n          \n            \n                        .flatMap(Set::stream).orElseGet(Stream::empty).collect(Collectors.toSet()));", "author": "cpmeister", "createdAt": "2020-08-26T18:37:31Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/AVMFritzBindingConstants.java", "diffHunk": "@@ -149,7 +150,8 @@\n             .unmodifiableSet(Stream.of(BRIDGE_THING_TYPE, PL546E_STANDALONE_THING_TYPE).collect(Collectors.toSet()));\n \n     public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.unmodifiableSet(Stream\n-            .of(SUPPORTED_BUTTON_THING_TYPES_UIDS.stream(), SUPPORTED_DEVICE_THING_TYPES_UIDS.stream(),\n-                    SUPPORTED_GROUP_THING_TYPES_UIDS.stream(), SUPPORTED_BRIDGE_THING_TYPES_UIDS.stream())\n+            .of(SUPPORTED_BUTTON_THING_TYPES_UIDS.stream(), SUPPORTED_HEATING_THING_TYPES.stream(),\n+                    SUPPORTED_DEVICE_THING_TYPES_UIDS.stream(), SUPPORTED_GROUP_THING_TYPES_UIDS.stream(),\n+                    SUPPORTED_BRIDGE_THING_TYPES_UIDS.stream())\n             .reduce(Stream::concat).orElseGet(Stream::empty).collect(Collectors.toSet()));", "originalCommit": "42a2361578c9c3077e8c5e8138cab01291e687ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc0Njc5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r479746791", "bodyText": "Thanks for the hint. I changed it. But we do not need orElseGet(...) combined with flatMap(...).", "author": "cweitkamp", "createdAt": "2020-08-30T09:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUwNzQ3MA=="}], "type": "inlineReview", "revised_code": {"commit": "c14fb9327c03d7a820cbc01ad74059bc9f3918f2", "chunk": "diff --git a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/AVMFritzBindingConstants.java b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/AVMFritzBindingConstants.java\nindex 00b0c789f9..fd013cd4c4 100644\n--- a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/AVMFritzBindingConstants.java\n+++ b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/AVMFritzBindingConstants.java\n\n@@ -150,8 +162,7 @@ public class AVMFritzBindingConstants {\n             .unmodifiableSet(Stream.of(BRIDGE_THING_TYPE, PL546E_STANDALONE_THING_TYPE).collect(Collectors.toSet()));\n \n     public static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.unmodifiableSet(Stream\n-            .of(SUPPORTED_BUTTON_THING_TYPES_UIDS.stream(), SUPPORTED_HEATING_THING_TYPES.stream(),\n-                    SUPPORTED_DEVICE_THING_TYPES_UIDS.stream(), SUPPORTED_GROUP_THING_TYPES_UIDS.stream(),\n-                    SUPPORTED_BRIDGE_THING_TYPES_UIDS.stream())\n-            .reduce(Stream::concat).orElseGet(Stream::empty).collect(Collectors.toSet()));\n+            .of(SUPPORTED_BUTTON_THING_TYPES_UIDS, SUPPORTED_HEATING_THING_TYPES, SUPPORTED_DEVICE_THING_TYPES_UIDS,\n+                    SUPPORTED_GROUP_THING_TYPES_UIDS, SUPPORTED_BRIDGE_THING_TYPES_UIDS)\n+            .flatMap(Set::stream).collect(Collectors.toSet()));\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUxMDg2MA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r477510860", "bodyText": "Proxy instances can only be interfaces, not concrete classes. So you need to make an interface that has all of your methods your actions are going to use.\nThis invokeMethodOf method should likewise return an interface instead.", "author": "cpmeister", "createdAt": "2020-08-26T18:43:59Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.avmfritz.actions;\n+\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Proxy;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AVMFritzHeatingActions} defines thing actions for heating devices / groups of the avmfritz binding.\n+ *\n+ * @author Christoph Weitkamp - Initial contribution\n+ */\n+@ThingActionsScope(name = \"avmfritz\")\n+@NonNullByDefault\n+public class AVMFritzHeatingActions implements ThingActions {\n+\n+    private final Logger logger = LoggerFactory.getLogger(AVMFritzHeatingActions.class);\n+\n+    private @Nullable AVMFritzHeatingActionsHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AVMFritzHeatingActionsHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable ThingHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/setBoostModeModeActionLabel\", description = \"@text/setBoostModeActionDescription\")\n+    public void setBoostMode(\n+            @ActionInput(name = \"Duration\", label = \"@text/setBoostModeDurationInputLabel\", description = \"@text/setBoostModeDurationInputDescription\", type = \"java.lang.Long\", required = true) Long duration) {\n+        AVMFritzHeatingActionsHandler actionsHandler = handler;\n+        if (actionsHandler == null) {\n+            logger.warn(\"AVMFritzHeatingActions ThingHandler is null!\");\n+            return;\n+        }\n+        actionsHandler.setBoostMode(duration.longValue());\n+    }\n+\n+    public static void setBoostMode(@Nullable ThingActions actions, Long duration) {\n+        invokeMethodOf(actions).setBoostMode(duration);\n+    }\n+\n+    @RuleAction(label = \"@text/setWindowOpenModeActionLabel\", description = \"@text/setWindowOpenModeActionDescription\")\n+    public void setWindowOpenMode(\n+            @ActionInput(name = \"Duration\", label = \"@text/setWindowOpenModeDurationInputLabel\", description = \"@text/setWindowOpenModeDurationInputDescription\", type = \"java.lang.Long\", required = true) Long duration) {\n+        AVMFritzHeatingActionsHandler actionsHandler = handler;\n+        if (actionsHandler == null) {\n+            logger.warn(\"AVMFritzHeatingActions ThingHandler is null!\");\n+            return;\n+        }\n+        actionsHandler.setWindowOpenMode(duration.longValue());\n+    }\n+\n+    public static void setWindowOpenMode(@Nullable ThingActions actions, Long duration) {\n+        invokeMethodOf(actions).setWindowOpenMode(duration);\n+    }\n+\n+    private static AVMFritzHeatingActions invokeMethodOf(@Nullable ThingActions actions) {\n+        if (actions == null) {\n+            throw new IllegalArgumentException(\"Actions cannot be null\");\n+        }\n+        if (actions.getClass().getName().equals(AVMFritzHeatingActions.class.getName())) {\n+            if (actions instanceof AVMFritzHeatingActions) {\n+                return (AVMFritzHeatingActions) actions;\n+            } else {\n+                return (AVMFritzHeatingActions) Proxy.newProxyInstance(AVMFritzHeatingActions.class.getClassLoader(),\n+                        new Class[] { AVMFritzHeatingActions.class }, (Object proxy, Method method, Object[] args) -> {\n+                            Method m = actions.getClass().getDeclaredMethod(method.getName(),\n+                                    method.getParameterTypes());\n+                            return m.invoke(actions, args);\n+                        });\n+            }\n+        }\n+        throw new IllegalArgumentException(\"Actions is not an instance of AVMFritzHeatingActions\");\n+    }", "originalCommit": "42a2361578c9c3077e8c5e8138cab01291e687ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUzMTkwNw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r477531907", "bodyText": "Isn't that the pattern that was just done on ALL our thing actions in this repo?", "author": "kaikreuzer", "createdAt": "2020-08-26T19:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUxMDg2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzc0MTc4NA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r477741784", "bodyText": "Isn't that the pattern that was just done on ALL our thing actions in this repo?\n\nIt is, but the pattern wasn't done correctly in this particular instance. All of the other ones (or at least the ones that I approved) require an additional interface class to be created.", "author": "cpmeister", "createdAt": "2020-08-27T00:12:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUxMDg2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTc0Njc3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r479746777", "bodyText": "Done.", "author": "cweitkamp", "createdAt": "2020-08-30T09:38:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUxMDg2MA=="}], "type": "inlineReview", "revised_code": {"commit": "f4cd76624c9fbaf010497837d3a477d79a7e10f6", "chunk": "diff --git a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nsimilarity index 98%\nrename from bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\nrename to bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nindex 3f818bac07..3a8c038540 100644\n--- a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\n+++ b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\n\n@@ -10,7 +10,7 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0\n  */\n-package org.openhab.binding.avmfritz.actions;\n+package org.openhab.binding.avmfritz.internal.actions;\n \n import java.lang.reflect.Method;\n import java.lang.reflect.Proxy;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM1ODIxMw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r480358213", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (actions.getClass().getName().equals(AVMFritzHeatingActionsHandler.class.getName())) {\n          \n          \n            \n                    if (actions.getClass().getName().equals(AVMFritzHeatingActions.class.getName())) {\n          \n      \n    \n    \n  \n\nThe class name should be compared against the name of the concrete action class since you would never receive an instance of a non-concrete class as a parameter.", "author": "cpmeister", "createdAt": "2020-08-31T19:42:27Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java", "diffHunk": "@@ -78,22 +79,24 @@ public static void setWindowOpenMode(@Nullable ThingActions actions, Long durati\n         invokeMethodOf(actions).setWindowOpenMode(duration);\n     }\n \n-    private static AVMFritzHeatingActions invokeMethodOf(@Nullable ThingActions actions) {\n+    private static AVMFritzHeatingActionsHandler invokeMethodOf(@Nullable ThingActions actions) {\n         if (actions == null) {\n             throw new IllegalArgumentException(\"Actions cannot be null\");\n         }\n-        if (actions.getClass().getName().equals(AVMFritzHeatingActions.class.getName())) {\n-            if (actions instanceof AVMFritzHeatingActions) {\n-                return (AVMFritzHeatingActions) actions;\n+        if (actions.getClass().getName().equals(AVMFritzHeatingActionsHandler.class.getName())) {", "originalCommit": "1de1c09f64c8305e2266372ccf2e9b9399e5752c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4cd76624c9fbaf010497837d3a477d79a7e10f6", "chunk": "diff --git a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nsimilarity index 83%\nrename from bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\nrename to bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nindex ace12224d9..3a8c038540 100644\n--- a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\n+++ b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\n\n@@ -79,24 +78,22 @@ public class AVMFritzHeatingActions implements ThingActions {\n         invokeMethodOf(actions).setWindowOpenMode(duration);\n     }\n \n-    private static AVMFritzHeatingActionsHandler invokeMethodOf(@Nullable ThingActions actions) {\n+    private static AVMFritzHeatingActions invokeMethodOf(@Nullable ThingActions actions) {\n         if (actions == null) {\n             throw new IllegalArgumentException(\"Actions cannot be null\");\n         }\n-        if (actions.getClass().getName().equals(AVMFritzHeatingActionsHandler.class.getName())) {\n-            if (actions instanceof AVMFritzHeatingActionsHandler) {\n-                return (AVMFritzHeatingActionsHandler) actions;\n+        if (actions.getClass().getName().equals(AVMFritzHeatingActions.class.getName())) {\n+            if (actions instanceof AVMFritzHeatingActions) {\n+                return (AVMFritzHeatingActions) actions;\n             } else {\n-                return (AVMFritzHeatingActionsHandler) Proxy.newProxyInstance(\n-                        AVMFritzHeatingActionsHandler.class.getClassLoader(),\n-                        new Class[] { AVMFritzHeatingActionsHandler.class },\n-                        (Object proxy, Method method, Object[] args) -> {\n+                return (AVMFritzHeatingActions) Proxy.newProxyInstance(AVMFritzHeatingActions.class.getClassLoader(),\n+                        new Class[] { AVMFritzHeatingActions.class }, (Object proxy, Method method, Object[] args) -> {\n                             Method m = actions.getClass().getDeclaredMethod(method.getName(),\n                                     method.getParameterTypes());\n                             return m.invoke(actions, args);\n                         });\n             }\n         }\n-        throw new IllegalArgumentException(\"Actions is not an instance of AVMFritzHeatingActionsHandler\");\n+        throw new IllegalArgumentException(\"Actions is not an instance of AVMFritzHeatingActions\");\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM2NDcxNw==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r480364717", "bodyText": "Although yes AVMFritzHeatingActionsHandler is an interface, I think it is the wrong interface here since it extends ThingHandler. The interface returned by the invokeMethodOf should be an interface implemented by AVMFritzHeatingActions so it would reason that it would be a type of ThingHandlerService not a ThingHandler.\nYou should create a new interface that has only two methods: setBoostMode(Long) and setWindowOpenMode(Long) and have AVMFritzHeatingActions implement that new interface. Likewise it is that new interface which would be returned from invokeMethodOf. So you would need to change your usages of AVMFritzHeatingActionsHandler here use the new interface instead.\nSorry if this has all been confusing but you are almost there. If you need a concrete reference to follow then you can look at the way the Ecobee binding has done it.\nhttps://github.com/openhab/openhab-addons/blob/2.5.x/bundles/org.openhab.binding.ecobee/src/main/java/org/openhab/binding/ecobee/action/EcobeeActions.java#L89", "author": "cpmeister", "createdAt": "2020-08-31T19:55:45Z", "path": "bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java", "diffHunk": "@@ -0,0 +1,102 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.avmfritz.actions;\n+\n+import java.lang.reflect.Method;\n+import java.lang.reflect.Proxy;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.binding.ThingActions;\n+import org.eclipse.smarthome.core.thing.binding.ThingActionsScope;\n+import org.eclipse.smarthome.core.thing.binding.ThingHandler;\n+import org.openhab.binding.avmfritz.internal.actions.AVMFritzHeatingActionsHandler;\n+import org.openhab.core.automation.annotation.ActionInput;\n+import org.openhab.core.automation.annotation.RuleAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * The {@link AVMFritzHeatingActions} defines thing actions for heating devices / groups of the avmfritz binding.\n+ *\n+ * @author Christoph Weitkamp - Initial contribution\n+ */\n+@ThingActionsScope(name = \"avmfritz\")\n+@NonNullByDefault\n+public class AVMFritzHeatingActions implements ThingActions {\n+\n+    private final Logger logger = LoggerFactory.getLogger(AVMFritzHeatingActions.class);\n+\n+    private @Nullable AVMFritzHeatingActionsHandler handler;\n+\n+    @Override\n+    public void setThingHandler(@Nullable ThingHandler handler) {\n+        this.handler = (AVMFritzHeatingActionsHandler) handler;\n+    }\n+\n+    @Override\n+    public @Nullable ThingHandler getThingHandler() {\n+        return handler;\n+    }\n+\n+    @RuleAction(label = \"@text/setBoostModeModeActionLabel\", description = \"@text/setBoostModeActionDescription\")\n+    public void setBoostMode(\n+            @ActionInput(name = \"Duration\", label = \"@text/setBoostModeDurationInputLabel\", description = \"@text/setBoostModeDurationInputDescription\", type = \"java.lang.Long\", required = true) Long duration) {\n+        AVMFritzHeatingActionsHandler actionsHandler = handler;\n+        if (actionsHandler == null) {\n+            logger.warn(\"AVMFritzHeatingActions ThingHandler is null!\");\n+            return;\n+        }\n+        actionsHandler.setBoostMode(duration.longValue());\n+    }\n+\n+    public static void setBoostMode(@Nullable ThingActions actions, Long duration) {\n+        invokeMethodOf(actions).setBoostMode(duration);\n+    }\n+\n+    @RuleAction(label = \"@text/setWindowOpenModeActionLabel\", description = \"@text/setWindowOpenModeActionDescription\")\n+    public void setWindowOpenMode(\n+            @ActionInput(name = \"Duration\", label = \"@text/setWindowOpenModeDurationInputLabel\", description = \"@text/setWindowOpenModeDurationInputDescription\", type = \"java.lang.Long\", required = true) Long duration) {\n+        AVMFritzHeatingActionsHandler actionsHandler = handler;\n+        if (actionsHandler == null) {\n+            logger.warn(\"AVMFritzHeatingActions ThingHandler is null!\");\n+            return;\n+        }\n+        actionsHandler.setWindowOpenMode(duration.longValue());\n+    }\n+\n+    public static void setWindowOpenMode(@Nullable ThingActions actions, Long duration) {\n+        invokeMethodOf(actions).setWindowOpenMode(duration);\n+    }\n+\n+    private static AVMFritzHeatingActionsHandler invokeMethodOf(@Nullable ThingActions actions) {", "originalCommit": "1de1c09f64c8305e2266372ccf2e9b9399e5752c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM1Nzc5NA==", "url": "https://github.com/openhab/openhab-addons/pull/8222#discussion_r481357794", "bodyText": "Thanks for your details explanation. I think I now got the point.", "author": "cweitkamp", "createdAt": "2020-09-01T18:49:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM2NDcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "f4cd76624c9fbaf010497837d3a477d79a7e10f6", "chunk": "diff --git a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nsimilarity index 83%\nrename from bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\nrename to bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\nindex ace12224d9..3a8c038540 100644\n--- a/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/actions/AVMFritzHeatingActions.java\n+++ b/bundles/org.openhab.binding.avmfritz/src/main/java/org/openhab/binding/avmfritz/internal/actions/AVMFritzHeatingActions.java\n\n@@ -10,7 +10,7 @@\n  *\n  * SPDX-License-Identifier: EPL-2.0\n  */\n-package org.openhab.binding.avmfritz.actions;\n+package org.openhab.binding.avmfritz.internal.actions;\n \n import java.lang.reflect.Method;\n import java.lang.reflect.Proxy;\n"}}, {"oid": "f4cd76624c9fbaf010497837d3a477d79a7e10f6", "url": "https://github.com/openhab/openhab-addons/commit/f4cd76624c9fbaf010497837d3a477d79a7e10f6", "message": "Added ThingActions to handle Boost and Window-Open modes\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-01T18:55:20Z", "type": "commit"}, {"oid": "bc0ec94e2769bbf26bad00aa26fd5709fc6642f9", "url": "https://github.com/openhab/openhab-addons/commit/bc0ec94e2769bbf26bad00aa26fd5709fc6642f9", "message": "Expose ThingAction classes / interfaces\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-01T18:55:21Z", "type": "commit"}, {"oid": "c14fb9327c03d7a820cbc01ad74059bc9f3918f2", "url": "https://github.com/openhab/openhab-addons/commit/c14fb9327c03d7a820cbc01ad74059bc9f3918f2", "message": "Incorporated comments from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-01T18:55:21Z", "type": "commit"}, {"oid": "6c820a0e204783d270b219323d6eb6418e9cb63c", "url": "https://github.com/openhab/openhab-addons/commit/6c820a0e204783d270b219323d6eb6418e9cb63c", "message": "Incorporated comments from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-01T18:55:22Z", "type": "commit"}, {"oid": "6c820a0e204783d270b219323d6eb6418e9cb63c", "url": "https://github.com/openhab/openhab-addons/commit/6c820a0e204783d270b219323d6eb6418e9cb63c", "message": "Incorporated comments from review\n\nSigned-off-by: Christoph Weitkamp <github@christophweitkamp.de>", "committedDate": "2020-09-01T18:55:22Z", "type": "forcePushed"}]}