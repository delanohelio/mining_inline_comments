{"pr_number": 8400, "pr_title": "[sensibo] Fix for dynamic channels disappearing when device goes intermittent offline", "pr_createdAt": "2020-09-05T08:11:15Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8400", "timeline": [{"oid": "e42801e7340d22a5e272c27569cdf233fa8c1b60", "url": "https://github.com/openhab/openhab-addons/commit/e42801e7340d22a5e272c27569cdf233fa8c1b60", "message": "Fixed truncation of debug logging when server responding with chunked content. Also removed logging of API key\n\nSigned-off-by: Arne Seime <arne.seime@gmail.com>", "committedDate": "2020-08-29T08:12:21Z", "type": "commit"}, {"oid": "f1be9db5436e9b94d8a6c3b32a6c562a35d12d91", "url": "https://github.com/openhab/openhab-addons/commit/f1be9db5436e9b94d8a6c3b32a6c562a35d12d91", "message": "Update dynamic channels whenever thing is coming online as it appears that dynamic channels are disposed when thing is reported OFFLINE\n\nSigned-off-by: Arne Seime <arne.seime@gmail.com>", "committedDate": "2020-08-30T05:07:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk0MDYzMg==", "url": "https://github.com/openhab/openhab-addons/pull/8400#discussion_r483940632", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private void scambleAndLog(String[] stringsToRemove, String dataToLog) {\n          \n          \n            \n                private void scrambleAndLog(String[] stringsToRemove, String dataToLog) {", "author": "fwolter", "createdAt": "2020-09-05T11:14:46Z", "path": "bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java", "diffHunk": "@@ -91,18 +91,28 @@ private void dump(final Request request) {\n                 }\n             });\n             request.onResponseContent((theResponse, content) -> contentBuffer\n-                    .append(reformatJson(getCharset(theResponse.getHeaders()).decode(content).toString())));\n+                    .append(getCharset(theResponse.getHeaders()).decode(content).toString()));\n             request.onResponseSuccess(theResponse -> {\n                 if (contentBuffer.length() > 0) {\n                     group.append(\"\\n\");\n-                    group.append(contentBuffer);\n+                    group.append(reformatJson(contentBuffer.toString()));\n                 }\n+\n                 String dataToLog = group.toString();\n-                logger.debug(dataToLog);\n+                scambleAndLog(stringsToRemove, dataToLog);\n             });\n         }\n     }\n \n+    private void scambleAndLog(String[] stringsToRemove, String dataToLog) {", "originalCommit": "f1be9db5436e9b94d8a6c3b32a6c562a35d12d91", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6982f2d7c98ee5f0d53a55c003d134ad9d542762", "chunk": "diff --git a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\nindex 4be3128598..e549f05f3b 100644\n--- a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n+++ b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n\n@@ -99,18 +99,16 @@ public final class RequestLogger {\n                 }\n \n                 String dataToLog = group.toString();\n-                scambleAndLog(stringsToRemove, dataToLog);\n+                scrambleAndLog(stringsToRemove, dataToLog);\n             });\n         }\n     }\n \n-    private void scambleAndLog(String[] stringsToRemove, String dataToLog) {\n+    private void scrambleAndLog(String[] stringsToRemove, String dataToLog) {\n         for (String stringToRemove : stringsToRemove) {\n-            if (stringToRemove != null) {\n-                dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n-            }\n+            dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n         }\n-        logger.debug(dataToLog);\n+        logger.debug(\"{}\", dataToLog);\n     }\n \n     private Charset getCharset(final HttpFields headers) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk0MDc5MA==", "url": "https://github.com/openhab/openhab-addons/pull/8400#discussion_r483940790", "bodyText": "Can you fix the compiler warning? E.g. by storing dataToLog into a local variable.", "author": "fwolter", "createdAt": "2020-09-05T11:16:30Z", "path": "bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java", "diffHunk": "@@ -91,18 +91,28 @@ private void dump(final Request request) {\n                 }\n             });\n             request.onResponseContent((theResponse, content) -> contentBuffer\n-                    .append(reformatJson(getCharset(theResponse.getHeaders()).decode(content).toString())));\n+                    .append(getCharset(theResponse.getHeaders()).decode(content).toString()));\n             request.onResponseSuccess(theResponse -> {\n                 if (contentBuffer.length() > 0) {\n                     group.append(\"\\n\");\n-                    group.append(contentBuffer);\n+                    group.append(reformatJson(contentBuffer.toString()));\n                 }\n+\n                 String dataToLog = group.toString();\n-                logger.debug(dataToLog);\n+                scambleAndLog(stringsToRemove, dataToLog);\n             });\n         }\n     }\n \n+    private void scambleAndLog(String[] stringsToRemove, String dataToLog) {\n+        for (String stringToRemove : stringsToRemove) {\n+            if (stringToRemove != null) {\n+                dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");", "originalCommit": "f1be9db5436e9b94d8a6c3b32a6c562a35d12d91", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6982f2d7c98ee5f0d53a55c003d134ad9d542762", "chunk": "diff --git a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\nindex 4be3128598..e549f05f3b 100644\n--- a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n+++ b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n\n@@ -99,18 +99,16 @@ public final class RequestLogger {\n                 }\n \n                 String dataToLog = group.toString();\n-                scambleAndLog(stringsToRemove, dataToLog);\n+                scrambleAndLog(stringsToRemove, dataToLog);\n             });\n         }\n     }\n \n-    private void scambleAndLog(String[] stringsToRemove, String dataToLog) {\n+    private void scrambleAndLog(String[] stringsToRemove, String dataToLog) {\n         for (String stringToRemove : stringsToRemove) {\n-            if (stringToRemove != null) {\n-                dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n-            }\n+            dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n         }\n-        logger.debug(dataToLog);\n+        logger.debug(\"{}\", dataToLog);\n     }\n \n     private Charset getCharset(final HttpFields headers) {\n"}}, {"oid": "6982f2d7c98ee5f0d53a55c003d134ad9d542762", "url": "https://github.com/openhab/openhab-addons/commit/6982f2d7c98ee5f0d53a55c003d134ad9d542762", "message": "Minor\n\nSigned-off-by: Arne Seime <arne.seime@gmail.com>", "committedDate": "2020-09-06T17:46:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDEwOTE5MA==", "url": "https://github.com/openhab/openhab-addons/pull/8400#discussion_r484109190", "bodyText": "The compiler complains about storing a reference to a method argument. To fix this, you can store dataLog to a local variable at the beginning of this method.", "author": "fwolter", "createdAt": "2020-09-06T20:11:01Z", "path": "bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java", "diffHunk": "@@ -99,18 +99,16 @@ private void dump(final Request request, String[] stringsToRemove) {\n                 }\n \n                 String dataToLog = group.toString();\n-                scambleAndLog(stringsToRemove, dataToLog);\n+                scrambleAndLog(stringsToRemove, dataToLog);\n             });\n         }\n     }\n \n-    private void scambleAndLog(String[] stringsToRemove, String dataToLog) {\n+    private void scrambleAndLog(String[] stringsToRemove, String dataToLog) {\n         for (String stringToRemove : stringsToRemove) {\n-            if (stringToRemove != null) {\n-                dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n-            }\n+            dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");", "originalCommit": "6982f2d7c98ee5f0d53a55c003d134ad9d542762", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "13e58223ef2ddddae9e0daab29eb46436a2233aa", "chunk": "diff --git a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\nindex e549f05f3b..81946ecb16 100644\n--- a/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n+++ b/bundles/org.openhab.binding.sensibo/src/main/java/org/openhab/binding/sensibo/internal/client/RequestLogger.java\n\n@@ -105,10 +105,11 @@ public final class RequestLogger {\n     }\n \n     private void scrambleAndLog(String[] stringsToRemove, String dataToLog) {\n+        String modifiedData = dataToLog;\n         for (String stringToRemove : stringsToRemove) {\n-            dataToLog = dataToLog.replace(stringToRemove, \"<HIDDEN>\");\n+            modifiedData = modifiedData.replace(stringToRemove, \"<HIDDEN>\");\n         }\n-        logger.debug(\"{}\", dataToLog);\n+        logger.debug(\"{}\", modifiedData);\n     }\n \n     private Charset getCharset(final HttpFields headers) {\n"}}, {"oid": "13e58223ef2ddddae9e0daab29eb46436a2233aa", "url": "https://github.com/openhab/openhab-addons/commit/13e58223ef2ddddae9e0daab29eb46436a2233aa", "message": "Fix compiler warning\n\nSigned-off-by: Arne Seime <arne.seime@gmail.com>", "committedDate": "2020-09-07T04:40:44Z", "type": "commit"}]}