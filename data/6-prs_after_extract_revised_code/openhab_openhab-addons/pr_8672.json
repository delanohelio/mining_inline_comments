{"pr_number": 8672, "pr_title": "[snmp] Fix memory leak in SNMP", "pr_createdAt": "2020-10-05T11:42:51Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8672", "timeline": [{"oid": "295244dd9b586b73a18d6273324fda7113a18af7", "url": "https://github.com/openhab/openhab-addons/commit/295244dd9b586b73a18d6273324fda7113a18af7", "message": "Fix memory leak in SNMP. When receiving an async request it is placed in a pending request queue. Not canceling it leads to infinty life cycle for those requests, filling up memory.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-05T11:47:00Z", "type": "commit"}, {"oid": "92a47c2478e204e92b3063bcfcf811046a0f250f", "url": "https://github.com/openhab/openhab-addons/commit/92a47c2478e204e92b3063bcfcf811046a0f250f", "message": "Test the canceling of the snmp aync request by its handler.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-05T11:47:00Z", "type": "commit"}, {"oid": "83e7999ac3d517bd5b7e30170bd69ec85d451242", "url": "https://github.com/openhab/openhab-addons/commit/83e7999ac3d517bd5b7e30170bd69ec85d451242", "message": "Import Snmp instead of using FQCNs.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-05T11:47:00Z", "type": "commit"}, {"oid": "54b52338536cc77342a5392a07d9642490c2391e", "url": "https://github.com/openhab/openhab-addons/commit/54b52338536cc77342a5392a07d9642490c2391e", "message": "Hint in event canceling comment where it came from originally.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-05T11:47:01Z", "type": "commit"}, {"oid": "54b52338536cc77342a5392a07d9642490c2391e", "url": "https://github.com/openhab/openhab-addons/commit/54b52338536cc77342a5392a07d9642490c2391e", "message": "Hint in event canceling comment where it came from originally.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-05T11:47:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA2ODgwMw==", "url": "https://github.com/openhab/openhab-addons/pull/8672#discussion_r501068803", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (event.getSource() instanceof org.snmp4j.Snmp) {\n          \n          \n            \n                    if (event.getSource() instanceof Snmp) {", "author": "J-N-K", "createdAt": "2020-10-07T14:41:09Z", "path": "bundles/org.openhab.binding.snmp/src/main/java/org/openhab/binding/snmp/internal/SnmpTargetHandler.java", "diffHunk": "@@ -175,6 +176,15 @@ public void onResponse(@Nullable ResponseEvent event) {\n         if (event == null) {\n             return;\n         }\n+\n+        if (event.getSource() instanceof org.snmp4j.Snmp) {", "originalCommit": "54b52338536cc77342a5392a07d9642490c2391e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQ3NTAwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8672#discussion_r501475005", "bodyText": "Oh, i miss this, sorry for that.", "author": "fab-kis", "createdAt": "2020-10-08T06:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTA2ODgwMw=="}], "type": "inlineReview", "revised_code": {"commit": "a11a8a42b05225866f66ad3ccd71ec61b98b9dd0", "chunk": "diff --git a/bundles/org.openhab.binding.snmp/src/main/java/org/openhab/binding/snmp/internal/SnmpTargetHandler.java b/bundles/org.openhab.binding.snmp/src/main/java/org/openhab/binding/snmp/internal/SnmpTargetHandler.java\nindex 5eaa749e73..4d37c589e3 100644\n--- a/bundles/org.openhab.binding.snmp/src/main/java/org/openhab/binding/snmp/internal/SnmpTargetHandler.java\n+++ b/bundles/org.openhab.binding.snmp/src/main/java/org/openhab/binding/snmp/internal/SnmpTargetHandler.java\n\n@@ -177,7 +177,7 @@ public class SnmpTargetHandler extends BaseThingHandler implements ResponseListe\n             return;\n         }\n \n-        if (event.getSource() instanceof org.snmp4j.Snmp) {\n+        if (event.getSource() instanceof Snmp) {\n             // Always cancel async request when response has been received\n             // otherwise a memory leak is created! Not canceling a request\n             // immediately can be useful when sending a request to a broadcast\n"}}, {"oid": "a11a8a42b05225866f66ad3ccd71ec61b98b9dd0", "url": "https://github.com/openhab/openhab-addons/commit/a11a8a42b05225866f66ad3ccd71ec61b98b9dd0", "message": "Check the type of the event source without the FQCN.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-08T06:23:51Z", "type": "commit"}, {"oid": "a11a8a42b05225866f66ad3ccd71ec61b98b9dd0", "url": "https://github.com/openhab/openhab-addons/commit/a11a8a42b05225866f66ad3ccd71ec61b98b9dd0", "message": "Check the type of the event source without the FQCN.\n\nSigned-off-by: Falk Bauer <falk.bauer@k-is.com>", "committedDate": "2020-10-08T06:23:51Z", "type": "forcePushed"}]}