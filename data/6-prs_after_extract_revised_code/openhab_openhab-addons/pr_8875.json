{"pr_number": 8875, "pr_title": "[senechome] implement more data points (3.0)", "pr_createdAt": "2020-10-26T20:28:07Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8875", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0ODgyNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r513848825", "bodyText": "You specified Number:Dimensionless so you should use a QuantityType here.", "author": "cpmeister", "createdAt": "2020-10-29T01:02:03Z", "path": "bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java", "diffHunk": "@@ -156,6 +160,75 @@ private void refresh() {\n                             getSenecValue(response.energy.batteryFuelCharge).setScale(0, RoundingMode.HALF_UP),\n                             SmartHomeUnits.PERCENT));\n \n+            Channel channelGridCurrentPhase1 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH1);\n+            updateState(channelGridCurrentPhase1.getUID(), new QuantityType<ElectricCurrent>(\n+                    getSenecValue(response.grid.currentGridCurrentPerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.AMPERE));\n+\n+            Channel channelGridCurrentPhase2 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH2);\n+            updateState(channelGridCurrentPhase2.getUID(), new QuantityType<ElectricCurrent>(\n+                    getSenecValue(response.grid.currentGridCurrentPerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.AMPERE));\n+\n+            Channel channelGridCurrentPhase3 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH3);\n+            updateState(channelGridCurrentPhase3.getUID(), new QuantityType<ElectricCurrent>(\n+                    getSenecValue(response.grid.currentGridCurrentPerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.AMPERE));\n+\n+            Channel channelGridPowerPhase1 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH1);\n+            updateState(channelGridPowerPhase1.getUID(),\n+                    new QuantityType<Power>(\n+                            getSenecValue(response.grid.currentGridPowerPerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n+                            SmartHomeUnits.WATT));\n+\n+            Channel channelGridPowerPhase2 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH2);\n+            updateState(channelGridPowerPhase2.getUID(),\n+                    new QuantityType<Power>(\n+                            getSenecValue(response.grid.currentGridPowerPerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n+                            SmartHomeUnits.WATT));\n+\n+            Channel channelGridPowerPhase3 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH3);\n+            updateState(channelGridPowerPhase3.getUID(),\n+                    new QuantityType<Power>(\n+                            getSenecValue(response.grid.currentGridPowerPerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n+                            SmartHomeUnits.WATT));\n+\n+            Channel channelGridVoltagePhase1 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH1);\n+            updateState(channelGridVoltagePhase1.getUID(), new QuantityType<ElectricPotential>(\n+                    getSenecValue(response.grid.currentGridVoltagePerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.VOLT));\n+\n+            Channel channelGridVoltagePhase2 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH2);\n+            updateState(channelGridVoltagePhase2.getUID(), new QuantityType<ElectricPotential>(\n+                    getSenecValue(response.grid.currentGridVoltagePerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.VOLT));\n+\n+            Channel channelGridVoltagePhase3 = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH3);\n+            updateState(channelGridVoltagePhase3.getUID(), new QuantityType<ElectricPotential>(\n+                    getSenecValue(response.grid.currentGridVoltagePerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n+                    SmartHomeUnits.VOLT));\n+\n+            Channel channelGridFrequency = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_FREQUENCY);\n+            updateState(channelGridFrequency.getUID(),\n+                    new QuantityType<Frequency>(\n+                            getSenecValue(response.grid.currentGridFrequency).setScale(2, RoundingMode.HALF_UP),\n+                            SmartHomeUnits.HERTZ));\n+\n+            Channel channelBatteryStateValue = getThing()\n+                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_BATTERY_STATE_VALUE);\n+            updateState(channelBatteryStateValue.getUID(),\n+                    new DecimalType(getSenecValue(response.energy.batteryState).intValue()));", "originalCommit": "c166efbfb22d3b0c082d78f7443fab914c472d29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzk5MDMyOA==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r513990328", "bodyText": "Hello, but this is just a decimal without any Type. In the end it is a value of an enum. I don't find any good SmartHomeUnits Type for that. Do you have a proposal what I could give as second param if I go for QuantityType<Dimensionless>?\nupdateState(channelBatteryStateValue.getUID(),\n    new QuantityType<Dimensionless>(getSenecValue(response.energy.batteryState).intValue()),\n    SmartHomeUnits.????);", "author": "KorbinianP", "createdAt": "2020-10-29T05:40:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0ODgyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUzNzAxMw==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r514537013", "bodyText": "SmartHomeUnits.ONE or Units.ONE", "author": "cpmeister", "createdAt": "2020-10-29T20:10:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0ODgyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDUzNzM3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r514537379", "bodyText": "Although if it is really an enum then you shouldn't specify it as Number:Dimensionless in the xml and instead just specify it as a Number instead.", "author": "cpmeister", "createdAt": "2020-10-29T20:11:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0ODgyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU0NDAxOQ==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r515544019", "bodyText": "Done the change \ud83d\udc4d Both jars in the opener are updated.", "author": "KorbinianP", "createdAt": "2020-10-31T21:52:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg0ODgyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "a3663d24b1881a724cd477d737209526320f3045", "chunk": "diff --git a/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java b/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\nindex 6199203ced..d8fce1a05b 100644\n--- a/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\n+++ b/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\n\n@@ -160,75 +156,6 @@ public class SenecHomeHandler extends BaseThingHandler {\n                             getSenecValue(response.energy.batteryFuelCharge).setScale(0, RoundingMode.HALF_UP),\n                             SmartHomeUnits.PERCENT));\n \n-            Channel channelGridCurrentPhase1 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH1);\n-            updateState(channelGridCurrentPhase1.getUID(), new QuantityType<ElectricCurrent>(\n-                    getSenecValue(response.grid.currentGridCurrentPerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.AMPERE));\n-\n-            Channel channelGridCurrentPhase2 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH2);\n-            updateState(channelGridCurrentPhase2.getUID(), new QuantityType<ElectricCurrent>(\n-                    getSenecValue(response.grid.currentGridCurrentPerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.AMPERE));\n-\n-            Channel channelGridCurrentPhase3 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_CURRENT_PH3);\n-            updateState(channelGridCurrentPhase3.getUID(), new QuantityType<ElectricCurrent>(\n-                    getSenecValue(response.grid.currentGridCurrentPerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.AMPERE));\n-\n-            Channel channelGridPowerPhase1 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH1);\n-            updateState(channelGridPowerPhase1.getUID(),\n-                    new QuantityType<Power>(\n-                            getSenecValue(response.grid.currentGridPowerPerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n-                            SmartHomeUnits.WATT));\n-\n-            Channel channelGridPowerPhase2 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH2);\n-            updateState(channelGridPowerPhase2.getUID(),\n-                    new QuantityType<Power>(\n-                            getSenecValue(response.grid.currentGridPowerPerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n-                            SmartHomeUnits.WATT));\n-\n-            Channel channelGridPowerPhase3 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_POWER_PH3);\n-            updateState(channelGridPowerPhase3.getUID(),\n-                    new QuantityType<Power>(\n-                            getSenecValue(response.grid.currentGridPowerPerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n-                            SmartHomeUnits.WATT));\n-\n-            Channel channelGridVoltagePhase1 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH1);\n-            updateState(channelGridVoltagePhase1.getUID(), new QuantityType<ElectricPotential>(\n-                    getSenecValue(response.grid.currentGridVoltagePerPhase[0]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.VOLT));\n-\n-            Channel channelGridVoltagePhase2 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH2);\n-            updateState(channelGridVoltagePhase2.getUID(), new QuantityType<ElectricPotential>(\n-                    getSenecValue(response.grid.currentGridVoltagePerPhase[1]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.VOLT));\n-\n-            Channel channelGridVoltagePhase3 = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_VOLTAGE_PH3);\n-            updateState(channelGridVoltagePhase3.getUID(), new QuantityType<ElectricPotential>(\n-                    getSenecValue(response.grid.currentGridVoltagePerPhase[2]).setScale(2, RoundingMode.HALF_UP),\n-                    SmartHomeUnits.VOLT));\n-\n-            Channel channelGridFrequency = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_GRID_FREQUENCY);\n-            updateState(channelGridFrequency.getUID(),\n-                    new QuantityType<Frequency>(\n-                            getSenecValue(response.grid.currentGridFrequency).setScale(2, RoundingMode.HALF_UP),\n-                            SmartHomeUnits.HERTZ));\n-\n-            Channel channelBatteryStateValue = getThing()\n-                    .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_BATTERY_STATE_VALUE);\n-            updateState(channelBatteryStateValue.getUID(),\n-                    new DecimalType(getSenecValue(response.energy.batteryState).intValue()));\n-\n             Channel channelBatteryState = getThing().getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_BATTERY_STATE);\n             updateBatteryState(channelBatteryState, getSenecValue(response.energy.batteryState).intValue());\n \n"}}, {"oid": "a3663d24b1881a724cd477d737209526320f3045", "url": "https://github.com/openhab/openhab-addons/commit/a3663d24b1881a724cd477d737209526320f3045", "message": "Add KorbinianP to CODEOWNERS for senechome\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:57Z", "type": "commit"}, {"oid": "640852a11cbcd86ab9443f682b8b86f6859788bd", "url": "https://github.com/openhab/openhab-addons/commit/640852a11cbcd86ab9443f682b8b86f6859788bd", "message": "Implement Current, Voltage and Power for all three Phases\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:57Z", "type": "commit"}, {"oid": "f6b234b5f0ae69253fd283590e79cbb85b0b169c", "url": "https://github.com/openhab/openhab-addons/commit/f6b234b5f0ae69253fd283590e79cbb85b0b169c", "message": "Bugfix last commit, values are inside array\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:58Z", "type": "commit"}, {"oid": "4a6c86bfc98bfe21280cfd7b142a7bac42633137", "url": "https://github.com/openhab/openhab-addons/commit/4a6c86bfc98bfe21280cfd7b142a7bac42633137", "message": "Implement Grid Frequency\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:58Z", "type": "commit"}, {"oid": "d3e92824678209c89400d2397a78e2573370c146", "url": "https://github.com/openhab/openhab-addons/commit/d3e92824678209c89400d2397a78e2573370c146", "message": "Fix name of currentGridVoltagePerPhase\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:58Z", "type": "commit"}, {"oid": "d7be5bac5b3d4263ddcb4188afc1f6f2efc42631", "url": "https://github.com/openhab/openhab-addons/commit/d7be5bac5b3d4263ddcb4188afc1f6f2efc42631", "message": "Extend README.md with new parameters\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:59Z", "type": "commit"}, {"oid": "07352e7adfaec8289833538ea51d9171b456b564", "url": "https://github.com/openhab/openhab-addons/commit/07352e7adfaec8289833538ea51d9171b456b564", "message": "Implement SenecBatteryStateValue for easier comparison of values in rules\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T20:59:59Z", "type": "commit"}, {"oid": "d0f701d5d07298d39bc98754b35040694f9c9b0d", "url": "https://github.com/openhab/openhab-addons/commit/d0f701d5d07298d39bc98754b35040694f9c9b0d", "message": "Implement new statistic data points and battery voltage\n\nbatteryVoltage\nliveBatCharge\nliveBatDischarge\nliveGridExport\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T21:00:00Z", "type": "commit"}, {"oid": "d3fdb5684713e8fe22aa9803c3801358fe9eea96", "url": "https://github.com/openhab/openhab-addons/commit/d3fdb5684713e8fe22aa9803c3801358fe9eea96", "message": "Bugfix item types\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T21:00:00Z", "type": "commit"}, {"oid": "70408038406e3af60cd2bcc4fd678ec7a204eb1b", "url": "https://github.com/openhab/openhab-addons/commit/70408038406e3af60cd2bcc4fd678ec7a204eb1b", "message": "Implement Review findings, change channelBatteryStateValue to QuantityType\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T21:04:55Z", "type": "commit"}, {"oid": "70408038406e3af60cd2bcc4fd678ec7a204eb1b", "url": "https://github.com/openhab/openhab-addons/commit/70408038406e3af60cd2bcc4fd678ec7a204eb1b", "message": "Implement Review findings, change channelBatteryStateValue to QuantityType\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-10-31T21:04:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4NTk5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r515585999", "bodyText": "You switched the item-type to Number so you need to change this back and use DecimalType again.", "author": "cpmeister", "createdAt": "2020-11-01T07:16:07Z", "path": "bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java", "diffHunk": "@@ -228,7 +227,7 @@ private void refresh() {\n             Channel channelBatteryStateValue = getThing()\n                     .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_BATTERY_STATE_VALUE);\n             updateState(channelBatteryStateValue.getUID(),\n-                    new DecimalType(getSenecValue(response.energy.batteryState).intValue()));\n+                    new QuantityType<>(getSenecValue(response.energy.batteryState).intValue(), SmartHomeUnits.ONE));", "originalCommit": "70408038406e3af60cd2bcc4fd678ec7a204eb1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE5Mzk1NQ==", "url": "https://github.com/openhab/openhab-addons/pull/8875#discussion_r516193955", "bodyText": "OK, done that. JARs in the opener are updated again \ud83d\udc4d", "author": "KorbinianP", "createdAt": "2020-11-02T19:05:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTU4NTk5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "ef06d7f5b7c565a632cddc0d441aad0341d62e97", "chunk": "diff --git a/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java b/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\nindex 1608ad755d..393485c82a 100644\n--- a/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\n+++ b/bundles/org.openhab.binding.senechome/src/main/java/org/openhab/binding/senechome/internal/SenecHomeHandler.java\n\n@@ -227,7 +228,7 @@ public class SenecHomeHandler extends BaseThingHandler {\n             Channel channelBatteryStateValue = getThing()\n                     .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_BATTERY_STATE_VALUE);\n             updateState(channelBatteryStateValue.getUID(),\n-                    new QuantityType<>(getSenecValue(response.energy.batteryState).intValue(), SmartHomeUnits.ONE));\n+                    new DecimalType(getSenecValue(response.energy.batteryState).intValue()));\n \n             Channel channelLiveBatCharge = getThing()\n                     .getChannel(SenecHomeBindingConstants.CHANNEL_SENEC_LIVE_BAT_CHARGE);\n"}}, {"oid": "ef06d7f5b7c565a632cddc0d441aad0341d62e97", "url": "https://github.com/openhab/openhab-addons/commit/ef06d7f5b7c565a632cddc0d441aad0341d62e97", "message": "Revert change of channelBatteryStateValue from DecimalType to QuantityType\n\nSigned-off-by: Korbinian Probst <kp.droid.dev@gmail.com>", "committedDate": "2020-11-02T15:04:43Z", "type": "commit"}]}