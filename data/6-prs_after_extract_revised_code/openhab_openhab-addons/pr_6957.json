{"pr_number": 6957, "pr_title": "[hpprinter] Some small updates to the HP binding", "pr_createdAt": "2020-02-02T19:37:11Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/6957", "timeline": [{"oid": "d969100b7962ee3c24e449dc5c72b91aee276399", "url": "https://github.com/openhab/openhab-addons/commit/d969100b7962ee3c24e449dc5c72b91aee276399", "message": "Some small updates to the HP binding\n\n- some string comparisons where using ==\n- there were some issues with the null annotations, things were passed a long as being null while that would be killing for the status\n- improved formatting\n- Made more fields immutable\n- do not recreate the status message map on every request\n- add braces for if statments\n- Use parseInt to convert int instead of using both parsing and unboxing\n- use diamond operators\n- use method references where possible\n- do not put the device OFFLINE while starting to connect\n\nSigned-off-by: Martin van Wingerden <martin@martinvw.nl>", "committedDate": "2020-02-02T19:34:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3MzA4Ng==", "url": "https://github.com/openhab/openhab-addons/pull/6957#discussion_r373873086", "bodyText": "No, I referred to this with that remark", "author": "martinvw", "createdAt": "2020-02-02T20:36:21Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java", "diffHunk": "@@ -218,7 +225,7 @@ public void dynamicallyAddChannels(ThingUID thingUid) {\n      * Opens the connection to the Embedded Web Server\n      */\n     public void open() {\n-        goneOffline();\n+        runOfflineScheduler();", "originalCommit": "d969100b7962ee3c24e449dc5c72b91aee276399", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3MzI4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/6957#discussion_r373873283", "bodyText": "Okay thanks for the clarification.", "author": "Cossey", "createdAt": "2020-02-02T20:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzg3MzA4Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "06fb6ce9d6ab95e97baa3d83f66393ec7df232a4", "url": "https://github.com/openhab/openhab-addons/commit/06fb6ce9d6ab95e97baa3d83f66393ec7df232a4", "message": "HP printer updates\n\nAdded some properties such as serial number and firmware date/version\nRemoved some duplication\nSupport some additional statuses\nShow more detailed OFFLINE status in UI\n\nSigned-off-by: Martin van Wingerden <martin@martinvw.nl>", "committedDate": "2020-02-03T09:21:24Z", "type": "commit"}, {"oid": "669520943c346a1a0114429013059c31cd7037e0", "url": "https://github.com/openhab/openhab-addons/commit/669520943c346a1a0114429013059c31cd7037e0", "message": "HP printer final spotless run\n\nSigned-off-by: Martin van Wingerden <martin@martinvw.nl>", "committedDate": "2020-02-03T14:52:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcwNDI2NA==", "url": "https://github.com/openhab/openhab-addons/pull/6957#discussion_r376704264", "bodyText": "You can use CoreItemFactory.NUMBER to set the item type:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_COLOR_MARKING), \"Number\")\n          \n          \n            \n                                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_COLOR_MARKING), CoreItemFactory.NUMBER)", "author": "cweitkamp", "createdAt": "2020-02-08T11:19:47Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java", "diffHunk": "@@ -110,74 +121,80 @@ public void dynamicallyAddChannels(ThingUID thingUid) {\n             }\n \n             switch (data.getType()) {\n-            case SINGLECOLOR:\n-                if (data.hasCumulativeMarking()) {\n+                case SINGLECOLOR:\n+                    if (data.hasCumulativeMarking()) {\n+                        channels.add(ChannelBuilder\n+                                .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_COLOR_MARKING), \"Number\")", "originalCommit": "669520943c346a1a0114429013059c31cd7037e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0e8400d9d8130bba032545967e9705274b9dfbe", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\nindex eda4e0e7e0..290ab8e242 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n\n@@ -114,33 +115,36 @@ public class HPPrinterBinder {\n             final List<Channel> channels = new ArrayList<>();\n \n             if (data.hasCumulativeMarking()) {\n-                channels.add(\n-                        ChannelBuilder.create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_BLACK_MARKING), \"Number\")\n-                                .withLabel(\"Black Marking Used\").withDescription(\"The amount of Black Marking used\")\n-                                .withType(new ChannelTypeUID(\"hpprinter:cumlMarkingUsed\")).build());\n+                channels.add(ChannelBuilder\n+                        .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_BLACK_MARKING), CoreItemFactory.NUMBER)\n+                        .withLabel(\"Black Marking Used\").withDescription(\"The amount of Black Marking used\")\n+                        .withType(new ChannelTypeUID(\"hpprinter:cumlMarkingUsed\")).build());\n             }\n \n             switch (data.getType()) {\n                 case SINGLECOLOR:\n                     if (data.hasCumulativeMarking()) {\n                         channels.add(ChannelBuilder\n-                                .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_COLOR_MARKING), \"Number\")\n+                                .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_COLOR_MARKING),\n+                                        CoreItemFactory.NUMBER)\n                                 .withLabel(\"Colour Marking Used\").withDescription(\"The amount of Colour Marking used\")\n                                 .withType(new ChannelTypeUID(\"hpprinter:cumlMarkingUsed\")).build());\n                     }\n \n                     channels.add(ChannelBuilder\n-                            .create(new ChannelUID(thingUid, CGROUP_INK, CHANNEL_COLOR_LEVEL), \"Number\")\n+                            .create(new ChannelUID(thingUid, CGROUP_INK, CHANNEL_COLOR_LEVEL), CoreItemFactory.NUMBER)\n                             .withLabel(\"Color Level\").withDescription(\"Shows the amount of Colour Ink/Toner remaining\")\n                             .withType(new ChannelTypeUID(\"hpprinter:inkLevel\")).build());\n \n                     channels.add(ChannelBuilder\n-                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_TOTAL_COLORPAGES), \"Number\")\n+                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_TOTAL_COLORPAGES),\n+                                    CoreItemFactory.NUMBER)\n                             .withLabel(\"Total Colour Pages\").withDescription(\"The amount of colour pages printed\")\n                             .withType(new ChannelTypeUID(\"hpprinter:totals\")).build());\n \n                     channels.add(ChannelBuilder\n-                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_TOTAL_MONOPAGES), \"Number\")\n+                            .create(new ChannelUID(thingUid, CGROUP_USAGE, CHANNEL_TOTAL_MONOPAGES),\n+                                    CoreItemFactory.NUMBER)\n                             .withLabel(\"Total Monochrome Pages\")\n                             .withDescription(\"The amount of monochrome pages printed\")\n                             .withType(new ChannelTypeUID(\"hpprinter:totals\")).build());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcwNDQ2OA==", "url": "https://github.com/openhab/openhab-addons/pull/6957#discussion_r376704468", "bodyText": "You already set the status to ONLINE some lines before.", "author": "cweitkamp", "createdAt": "2020-02-08T11:24:20Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java", "diffHunk": "@@ -350,6 +354,9 @@ private void goneOnline() {\n             offlineScheduler = null;\n         }\n \n+        handler.binderStatus(ThingStatus.ONLINE);", "originalCommit": "669520943c346a1a0114429013059c31cd7037e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0e8400d9d8130bba032545967e9705274b9dfbe", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\nindex eda4e0e7e0..290ab8e242 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n\n@@ -353,8 +359,6 @@ public class HPPrinterBinder {\n             offlineScheduler.cancel(true);\n             offlineScheduler = null;\n         }\n-\n-        handler.binderStatus(ThingStatus.ONLINE);\n         retrieveProperties();\n \n         startBackgroundSchedules();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjcwNDU0OA==", "url": "https://github.com/openhab/openhab-addons/pull/6957#discussion_r376704548", "bodyText": "To avoid duplicate code you can call the close() method here.", "author": "cweitkamp", "createdAt": "2020-02-08T11:26:18Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java", "diffHunk": "@@ -245,53 +262,40 @@ public void goneOffline() {\n             offlineScheduler.cancel(true);\n             offlineScheduler = null;\n         }", "originalCommit": "669520943c346a1a0114429013059c31cd7037e0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e0e8400d9d8130bba032545967e9705274b9dfbe", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\nindex eda4e0e7e0..290ab8e242 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/binder/HPPrinterBinder.java\n\n@@ -256,12 +267,7 @@ public class HPPrinterBinder {\n     public void goneOffline() {\n         handler.binderStatus(ThingStatus.OFFLINE);\n \n-        stopBackgroundSchedules();\n-\n-        if (offlineScheduler != null) {\n-            offlineScheduler.cancel(true);\n-            offlineScheduler = null;\n-        }\n+        close();\n         runOfflineScheduler();\n     }\n \n"}}, {"oid": "e0e8400d9d8130bba032545967e9705274b9dfbe", "url": "https://github.com/openhab/openhab-addons/commit/e0e8400d9d8130bba032545967e9705274b9dfbe", "message": "Review comments\n\nSigned-off-by: Martin van Wingerden <martin@martinvw.nl>", "committedDate": "2020-02-09T07:52:37Z", "type": "commit"}]}