{"pr_number": 7591, "pr_title": "[daikin] Improve handling of illegal commands", "pr_createdAt": "2020-05-10T13:24:16Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7591", "timeline": [{"oid": "b69cda05d7b2e4576fb9658ef66bcb4cb6317ab8", "url": "https://github.com/openhab/openhab-addons/commit/b69cda05d7b2e4576fb9658ef66bcb4cb6317ab8", "message": "[daikin] Improve handling of illegal commands\n\nSigned-off-by: Jimmy Tanagra <jcode@tanagra.id.au>", "committedDate": "2020-05-10T13:18:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDEwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7591#discussion_r423294104", "bodyText": "Instead of catching here, this should be caught around the Enum.valueOf call that is throwing this.", "author": "cpmeister", "createdAt": "2020-05-11T20:18:19Z", "path": "bundles/org.openhab.binding.daikin/src/main/java/org/openhab/binding/daikin/internal/handler/DaikinBaseHandler.java", "diffHunk": "@@ -131,6 +132,8 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             }\n             logger.debug(\"Received command ({}) of wrong type for thing '{}' on channel {}\", command,\n                     thing.getUID().getAsString(), channelUID.getId());\n+        } catch (IllegalArgumentException ex) {\n+            logger.warn(\"Illegal argument for channel {}: {}. {}\", channelUID.getId(), command.toString(), ex.getMessage());", "originalCommit": "b69cda05d7b2e4576fb9658ef66bcb4cb6317ab8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzMyMDc0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7591#discussion_r423320741", "bodyText": "Catching it around Enum.valueOf would duplicate the same code across 5 different instances at the moment, and possible future additions. In my opinion that is not an elegant/clean approach. Yes, catching it here could potentially catch IllegalArgumentException thrown by things other than enum.ValueOf although I can't think of what at the moment, and that's why I included ex.getMessage() in the logging for clarifications.\nIs there any specific reasons that it should be caught around the enum.valueOf, and causing code duplication?", "author": "jimtng", "createdAt": "2020-05-11T21:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDEwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM1ODQ0Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7591#discussion_r423358442", "bodyText": "While I do agree that catching IllegalArgumentException is a elegant/clean approach to solve this problem I still think that it isn't the correct approach. Catching IllegalArgumentException here simply casts too wide of a net and from a code readability/maintainability standpoint it isn't apparent at all what would throw such an exception at this point in the code or if the way it is handled is even correct.\nDon't get me wrong, I do think you've implemented the correct error handling at the moment but there may be a point in the future where that is not the case.\nFor readability/maintainability you should catch the IllegalArgumentException as soon as possible so that it is easy to identify from the code what would throw it and why it would be thrown. Now if it important that a malformed enum exception gets propagated all the way to the top like this, feel free to create your own type of exception to represent this and throw that instead. IllegalArgumentException is too broad to be allowed to be propagated beyond the caller of the method that throws it without the exception itself becoming essentially unhandleable.\nIf you want to reduce possible duplicate code you can make your own version of the valueOf that takes an Enum as an argument and use that instead.", "author": "cpmeister", "createdAt": "2020-05-11T22:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDEwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwNTQ5Ng==", "url": "https://github.com/openhab/openhab-addons/pull/7591#discussion_r423705496", "bodyText": "Point taken. I have moved the exception handling.", "author": "jimtng", "createdAt": "2020-05-12T12:49:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDEwNA=="}], "type": "inlineReview", "revised_code": {"commit": "efcaf74f9edf5b9474a830f7347f7a120907481b", "chunk": "diff --git a/bundles/org.openhab.binding.daikin/src/main/java/org/openhab/binding/daikin/internal/handler/DaikinBaseHandler.java b/bundles/org.openhab.binding.daikin/src/main/java/org/openhab/binding/daikin/internal/handler/DaikinBaseHandler.java\nindex 4415e63d16..c0b901a714 100755\n--- a/bundles/org.openhab.binding.daikin/src/main/java/org/openhab/binding/daikin/internal/handler/DaikinBaseHandler.java\n+++ b/bundles/org.openhab.binding.daikin/src/main/java/org/openhab/binding/daikin/internal/handler/DaikinBaseHandler.java\n\n@@ -132,8 +131,6 @@ public abstract class DaikinBaseHandler extends BaseThingHandler {\n             }\n             logger.debug(\"Received command ({}) of wrong type for thing '{}' on channel {}\", command,\n                     thing.getUID().getAsString(), channelUID.getId());\n-        } catch (IllegalArgumentException ex) {\n-            logger.warn(\"Illegal argument for channel {}: {}. {}\", channelUID.getId(), command.toString(), ex.getMessage());\n         } catch (DaikinCommunicationException ex) {\n             updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, ex.getMessage());\n         }\n"}}, {"oid": "efcaf74f9edf5b9474a830f7347f7a120907481b", "url": "https://github.com/openhab/openhab-addons/commit/efcaf74f9edf5b9474a830f7347f7a120907481b", "message": "[daikin] Move exception handling closer to Enum.valueOf()\n\nSigned-off-by: Jimmy Tanagra <jcode@tanagra.id.au>", "committedDate": "2020-05-12T12:46:18Z", "type": "commit"}]}