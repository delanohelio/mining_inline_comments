{"pr_number": 7569, "pr_title": "[somfytahoma] added channel for setting closure and orientation at once", "pr_createdAt": "2020-05-07T21:05:23Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7569", "timeline": [{"oid": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "url": "https://github.com/openhab/openhab-addons/commit/c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "message": "[somfytahoma] added channel for setting closure and orientation at once\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-05-04T18:47:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTIxMg==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423271212", "bodyText": "Please apply the formatter (e.g. by running mvn spotless:apply in the bindings folder).", "author": "cweitkamp", "createdAt": "2020-05-11T19:34:08Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n+            String param = \"[\" + command.toString() + \"]\";\n+            sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, param);\n+        }else {", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI4NTgwNg==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423285806", "bodyText": "Applied the formatter", "author": "octa22", "createdAt": "2020-05-11T20:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3MTIxMg=="}], "type": "inlineReview", "revised_code": {"commit": "6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "chunk": "diff --git a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\nindex caa4d7e074..aa416785f3 100644\n--- a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n+++ b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n\n@@ -76,36 +76,40 @@ public class SomfyTahomaAdjustableSlatsRollerShutterHandler extends SomfyTahomaB\n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n         super.handleCommand(channelUID, command);\n-        if (!ROCKER.equals(channelUID.getId()) && !CONTROL.equals(channelUID.getId())\n-                && !ORIENTATION.equals(channelUID.getId())) {\n-            return;\n-        }\n \n         if (command instanceof RefreshType) {\n             return;\n-        } else if (ROCKER.equals(channelUID.getId())) {\n-            if (OnOffType.ON.equals(command)) {\n-                sendCommand(COMMAND_SET_ROCKERPOSITION);\n-            }\n-        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n-            String param = \"[\" + command.toString() + \"]\";\n-            sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, param);\n-        }else {\n-            String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n-            if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and rocker is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+        }\n+\n+        switch (channelUID.getId()) {\n+            case ROCKER:\n+                if (OnOffType.ON.equals(command)) {\n                     sendCommand(COMMAND_SET_ROCKERPOSITION);\n                 }\n-            } else {\n-                String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n-                        ? \"[\" + command.toString() + \"]\"\n-                        : \"[]\";\n-                sendCommand(cmd, param);\n-            }\n+                break;\n+            case CLOSURE_AND_ORIENTATION:\n+                sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, \"[\" + command.toString() + \"]\");\n+                break;\n+            case CONTROL:\n+            case ORIENTATION:\n+                String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n+                if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and rocker is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_SET_ROCKERPOSITION);\n+                    }\n+                } else {\n+                    String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n+                            ? \"[\" + command.toString() + \"]\"\n+                            : \"[]\";\n+                    sendCommand(cmd, param);\n+                }\n+                break;\n+            default:\n+                return;\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk1MA==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423274950", "bodyText": "Just for safety: What happens when the user sends \"foobar\" to this channel?", "author": "cweitkamp", "createdAt": "2020-05-11T19:41:32Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n+            String param = \"[\" + command.toString() + \"]\";", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NjI0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423296241", "bodyText": "The Tahoma cloud will return an error, that this command expects two parameters.\nI had been thinking about doing a check for two numbers 0-100 separated by a comma, but decided to leave it on the Tahoma at the end...", "author": "octa22", "createdAt": "2020-05-11T20:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NDk1MA=="}], "type": "inlineReview", "revised_code": {"commit": "6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "chunk": "diff --git a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\nindex caa4d7e074..aa416785f3 100644\n--- a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n+++ b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n\n@@ -76,36 +76,40 @@ public class SomfyTahomaAdjustableSlatsRollerShutterHandler extends SomfyTahomaB\n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n         super.handleCommand(channelUID, command);\n-        if (!ROCKER.equals(channelUID.getId()) && !CONTROL.equals(channelUID.getId())\n-                && !ORIENTATION.equals(channelUID.getId())) {\n-            return;\n-        }\n \n         if (command instanceof RefreshType) {\n             return;\n-        } else if (ROCKER.equals(channelUID.getId())) {\n-            if (OnOffType.ON.equals(command)) {\n-                sendCommand(COMMAND_SET_ROCKERPOSITION);\n-            }\n-        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n-            String param = \"[\" + command.toString() + \"]\";\n-            sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, param);\n-        }else {\n-            String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n-            if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and rocker is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+        }\n+\n+        switch (channelUID.getId()) {\n+            case ROCKER:\n+                if (OnOffType.ON.equals(command)) {\n                     sendCommand(COMMAND_SET_ROCKERPOSITION);\n                 }\n-            } else {\n-                String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n-                        ? \"[\" + command.toString() + \"]\"\n-                        : \"[]\";\n-                sendCommand(cmd, param);\n-            }\n+                break;\n+            case CLOSURE_AND_ORIENTATION:\n+                sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, \"[\" + command.toString() + \"]\");\n+                break;\n+            case CONTROL:\n+            case ORIENTATION:\n+                String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n+                if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and rocker is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_SET_ROCKERPOSITION);\n+                    }\n+                } else {\n+                    String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n+                            ? \"[\" + command.toString() + \"]\"\n+                            : \"[]\";\n+                    sendCommand(cmd, param);\n+                }\n+                break;\n+            default:\n+                return;\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NjUzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423276533", "bodyText": "Add check for !CLOSURE_AND_ORIENTATION.equals(...) earlier (line 79f).\nOtherwise will a different implementation logic be easier to maintain:\n    public void handleCommand(ChannelUID channelUID, Command command) {\n        super.handleCommand(channelUID, command);\t\n        switch(channelUID.getId()) {\n             case ROCKER:\n                 // TODO\n                 break;\n             case CLOSURE_AND_ORIENTATION:\n                 // TODO\n                 break;\n             ...\n             default:\n                 return;\n        }\n    }", "author": "cweitkamp", "createdAt": "2020-05-11T19:44:37Z", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java", "diffHunk": "@@ -87,7 +87,10 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n             if (OnOffType.ON.equals(command)) {\n                 sendCommand(COMMAND_SET_ROCKERPOSITION);\n             }\n-        } else {\n+        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {", "originalCommit": "c521c43ef9bea2df7adc2749b347ca5d4fa1fe57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI5NDAwOQ==", "url": "https://github.com/openhab/openhab-addons/pull/7569#discussion_r423294009", "bodyText": "used the suggested implementation", "author": "octa22", "createdAt": "2020-05-11T20:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzI3NjUzMw=="}], "type": "inlineReview", "revised_code": {"commit": "6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "chunk": "diff --git a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\nindex caa4d7e074..aa416785f3 100644\n--- a/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n+++ b/bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaAdjustableSlatsRollerShutterHandler.java\n\n@@ -76,36 +76,40 @@ public class SomfyTahomaAdjustableSlatsRollerShutterHandler extends SomfyTahomaB\n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n         super.handleCommand(channelUID, command);\n-        if (!ROCKER.equals(channelUID.getId()) && !CONTROL.equals(channelUID.getId())\n-                && !ORIENTATION.equals(channelUID.getId())) {\n-            return;\n-        }\n \n         if (command instanceof RefreshType) {\n             return;\n-        } else if (ROCKER.equals(channelUID.getId())) {\n-            if (OnOffType.ON.equals(command)) {\n-                sendCommand(COMMAND_SET_ROCKERPOSITION);\n-            }\n-        } else if (CLOSURE_AND_ORIENTATION.equals(channelUID.getId())) {\n-            String param = \"[\" + command.toString() + \"]\";\n-            sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, param);\n-        }else {\n-            String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n-            if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n-                String executionId = getCurrentExecutions();\n-                if (executionId != null) {\n-                    // Check if the roller shutter is moving and rocker is sent => STOP it\n-                    cancelExecution(executionId);\n-                } else {\n+        }\n+\n+        switch (channelUID.getId()) {\n+            case ROCKER:\n+                if (OnOffType.ON.equals(command)) {\n                     sendCommand(COMMAND_SET_ROCKERPOSITION);\n                 }\n-            } else {\n-                String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n-                        ? \"[\" + command.toString() + \"]\"\n-                        : \"[]\";\n-                sendCommand(cmd, param);\n-            }\n+                break;\n+            case CLOSURE_AND_ORIENTATION:\n+                sendCommand(COMMAND_SET_CLOSURE_ORIENTATION, \"[\" + command.toString() + \"]\");\n+                break;\n+            case CONTROL:\n+            case ORIENTATION:\n+                String cmd = getTahomaCommand(command.toString(), channelUID.getId());\n+                if (COMMAND_SET_ROCKERPOSITION.equals(cmd)) {\n+                    String executionId = getCurrentExecutions();\n+                    if (executionId != null) {\n+                        // Check if the roller shutter is moving and rocker is sent => STOP it\n+                        cancelExecution(executionId);\n+                    } else {\n+                        sendCommand(COMMAND_SET_ROCKERPOSITION);\n+                    }\n+                } else {\n+                    String param = (COMMAND_SET_CLOSURE.equals(cmd) || COMMAND_SET_ORIENTATION.equals(cmd))\n+                            ? \"[\" + command.toString() + \"]\"\n+                            : \"[]\";\n+                    sendCommand(cmd, param);\n+                }\n+                break;\n+            default:\n+                return;\n         }\n     }\n \n"}}, {"oid": "6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "url": "https://github.com/openhab/openhab-addons/commit/6cb7f9ac99c708942f4b3574ab0a6aaff3e2e9ba", "message": "[somfytahoma] improvements based on the PR review\n\nSigned-off-by: Ondrej Pecta <opecta@gmail.com>", "committedDate": "2020-05-11T20:26:34Z", "type": "commit"}]}