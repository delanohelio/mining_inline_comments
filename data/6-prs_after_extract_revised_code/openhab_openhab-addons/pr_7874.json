{"pr_number": 7874, "pr_title": "[wemo] Do http (not port) ping to determine if wemo port is alive", "pr_createdAt": "2020-06-08T04:35:28Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7874", "timeline": [{"oid": "acdf75150cdb4e9d647b90a19ed1bff63231bb44", "url": "https://github.com/openhab/openhab-addons/commit/acdf75150cdb4e9d647b90a19ed1bff63231bb44", "message": "Poll using http not icmp\nSigned-off-by: Bill Forsyth <bf@cyrenica.com>", "committedDate": "2020-06-08T04:08:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ2OTY0NA==", "url": "https://github.com/openhab/openhab-addons/pull/7874#discussion_r436469644", "bodyText": "Please remove the commented out code", "author": "cpmeister", "createdAt": "2020-06-08T05:52:24Z", "path": "bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java", "diffHunk": "@@ -480,20 +475,32 @@ public String getWemoURL(String actionService) {\n                 }\n             }\n             wemoURL = \"http://\" + host + \":\" + port + \"/upnp/control/\" + actionService + \"1\";\n+            logger.trace(\"WeMo url {}\", wemoURL);\n             return wemoURL;\n         }\n         return wemoURL;\n     }\n \n     public boolean servicePing(String host, int port) throws IOException {\n-        SocketAddress socketAddress = new InetSocketAddress(host, port);\n-        try (Socket socket = new Socket()) {\n-            logger.trace(\"Ping WeMo device at '{}'\", socketAddress);\n-            socket.connect(socketAddress, 250);\n-            return true;\n-        } catch (ConnectException | SocketTimeoutException | NoRouteToHostException ignored) {\n+        // SocketAddress socketAddress = new InetSocketAddress(host, port);\n+        // try (Socket socket = new Socket()) {\n+        // logger.trace(\"Ping WeMo device at '{}'\", socketAddress);\n+        // socket.connect(socketAddress, 250);\n+        // return true;\n+        // } catch (ConnectException | SocketTimeoutException | NoRouteToHostException ignored) {\n+        // return false;\n+        // }", "originalCommit": "acdf75150cdb4e9d647b90a19ed1bff63231bb44", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e4d87efa22c92dd77f55535a08f1906ef539a09d", "chunk": "diff --git a/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java b/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\nindex 74a63f84c3..67f0467486 100644\n--- a/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\n+++ b/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\n\n@@ -482,18 +482,6 @@ public class WemoHandler extends AbstractWemoHandler implements UpnpIOParticipan\n     }\n \n     public boolean servicePing(String host, int port) throws IOException {\n-        // SocketAddress socketAddress = new InetSocketAddress(host, port);\n-        // try (Socket socket = new Socket()) {\n-        // logger.trace(\"Ping WeMo device at '{}'\", socketAddress);\n-        // socket.connect(socketAddress, 250);\n-        // return true;\n-        // } catch (ConnectException | SocketTimeoutException | NoRouteToHostException ignored) {\n-        // return false;\n-        // }\n-\n-        // When the wemo changes its port it may leave the old one open to connect(), but will not answer, so we\n-        // have to actually request and get something back.\n-\n         logger.trace(\"Ping WeMo device at '{}:{}'\", host, port);\n         try {\n             HttpUtil.executeUrl(\"GET\", \"http://\" + host + \":\" + port, 250);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3MDA5Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7874#discussion_r436470093", "bodyText": "So IOException this would never get thrown now right?", "author": "cpmeister", "createdAt": "2020-06-08T05:53:57Z", "path": "bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java", "diffHunk": "@@ -480,20 +475,32 @@ public String getWemoURL(String actionService) {\n                 }\n             }\n             wemoURL = \"http://\" + host + \":\" + port + \"/upnp/control/\" + actionService + \"1\";\n+            logger.trace(\"WeMo url {}\", wemoURL);\n             return wemoURL;\n         }\n         return wemoURL;\n     }\n \n     public boolean servicePing(String host, int port) throws IOException {", "originalCommit": "acdf75150cdb4e9d647b90a19ed1bff63231bb44", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjc4NzA0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7874#discussion_r436787043", "bodyText": "Correct. It's caught and used to set the flag to move on to the next port.", "author": "billfor", "createdAt": "2020-06-08T15:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3MDA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4OTI4NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7874#discussion_r436989285", "bodyText": "You should remove IOException from the throws clause then. Or rather, remove the throws clause entirely.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public boolean servicePing(String host, int port) throws IOException {\n          \n          \n            \n                public boolean servicePing(String host, int port) {", "author": "cpmeister", "createdAt": "2020-06-08T20:43:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3MDA5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAxNjQ1Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7874#discussion_r437016452", "bodyText": "Whoops sorry.", "author": "billfor", "createdAt": "2020-06-08T21:39:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3MDA5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "e4d87efa22c92dd77f55535a08f1906ef539a09d", "chunk": "diff --git a/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java b/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\nindex 74a63f84c3..67f0467486 100644\n--- a/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\n+++ b/bundles/org.openhab.binding.wemo/src/main/java/org/openhab/binding/wemo/internal/handler/WemoHandler.java\n\n@@ -482,18 +482,6 @@ public class WemoHandler extends AbstractWemoHandler implements UpnpIOParticipan\n     }\n \n     public boolean servicePing(String host, int port) throws IOException {\n-        // SocketAddress socketAddress = new InetSocketAddress(host, port);\n-        // try (Socket socket = new Socket()) {\n-        // logger.trace(\"Ping WeMo device at '{}'\", socketAddress);\n-        // socket.connect(socketAddress, 250);\n-        // return true;\n-        // } catch (ConnectException | SocketTimeoutException | NoRouteToHostException ignored) {\n-        // return false;\n-        // }\n-\n-        // When the wemo changes its port it may leave the old one open to connect(), but will not answer, so we\n-        // have to actually request and get something back.\n-\n         logger.trace(\"Ping WeMo device at '{}:{}'\", host, port);\n         try {\n             HttpUtil.executeUrl(\"GET\", \"http://\" + host + \":\" + port, 250);\n"}}, {"oid": "e4d87efa22c92dd77f55535a08f1906ef539a09d", "url": "https://github.com/openhab/openhab-addons/commit/e4d87efa22c92dd77f55535a08f1906ef539a09d", "message": "Poll using http not icmp\n\nSigned-off-by: bill <bf@cyrenica.com>\nSigned-off-by: bill <forbill.mail@gmail.com>", "committedDate": "2020-06-08T15:26:02Z", "type": "forcePushed"}, {"oid": "c2e72227629d5d02f29ee48a91661b919c417dae", "url": "https://github.com/openhab/openhab-addons/commit/c2e72227629d5d02f29ee48a91661b919c417dae", "message": "Poll using http not icmp\n\nSigned-off-by: bill <bf@cyrenica.com>", "committedDate": "2020-06-08T15:28:38Z", "type": "forcePushed"}, {"oid": "8c0f1c87d8486e80e41ddb81787a6e4f0fdfe4a4", "url": "https://github.com/openhab/openhab-addons/commit/8c0f1c87d8486e80e41ddb81787a6e4f0fdfe4a4", "message": "Poll using http not icmp\n\nSigned-off-by: bill <forbill.mail@gmail.com>", "committedDate": "2020-06-08T15:35:47Z", "type": "commit"}, {"oid": "8c0f1c87d8486e80e41ddb81787a6e4f0fdfe4a4", "url": "https://github.com/openhab/openhab-addons/commit/8c0f1c87d8486e80e41ddb81787a6e4f0fdfe4a4", "message": "Poll using http not icmp\n\nSigned-off-by: bill <forbill.mail@gmail.com>", "committedDate": "2020-06-08T15:35:47Z", "type": "forcePushed"}, {"oid": "eb75e119f89b01934cd63a09ef4d45c4fabf911c", "url": "https://github.com/openhab/openhab-addons/commit/eb75e119f89b01934cd63a09ef4d45c4fabf911c", "message": "remove throw\n\nSigned-off-by: bill <forbill.mail@gmail.com>", "committedDate": "2020-06-08T21:37:11Z", "type": "commit"}]}