{"pr_number": 7690, "pr_title": "[yeelight] Added support Ceiling 1 with Night Mode", "pr_createdAt": "2020-05-18T20:45:52Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7690", "timeline": [{"oid": "6ea29de2685e52d45a7095bb56be48982d48b7e9", "url": "https://github.com/openhab/openhab-addons/commit/6ea29de2685e52d45a7095bb56be48982d48b7e9", "message": "Added support Ceiling 1\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-18T20:40:27Z", "type": "commit"}, {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-19T11:37:00Z", "type": "commit"}, {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>", "committedDate": "2020-05-19T11:37:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5Mzg5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427493891", "bodyText": "Some of our build tools don't like EOF without a newline. So add a newline here.", "author": "cpmeister", "createdAt": "2020-05-19T17:57:44Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.lib.device;\n+\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+import org.openhab.binding.yeelight.internal.lib.enums.DeviceType;\n+import org.openhab.binding.yeelight.internal.lib.enums.MethodAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+\n+/**\n+ * The {@link CeilingDeviceWithNightDevice} contains methods for handling the ceiling device with ambient light.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class CeilingDeviceWithNightDevice extends CeilingDevice\n+        implements DeviceWithNightlight {\n+    private final Logger logger = LoggerFactory.getLogger(CeilingDeviceWithNightDevice.class);\n+\n+    public CeilingDeviceWithNightDevice(String id) {\n+        super(id);\n+\n+        mDeviceType = DeviceType.ceiling1;\n+    }\n+\n+    @Override\n+    public void onNotify(String msg) {\n+        logger.debug(\"Got state: {}\", msg);\n+\n+        JsonObject result = new JsonParser().parse(msg).getAsJsonObject();\n+\n+        if (result.has(\"id\")) {\n+            String id = result.get(\"id\").getAsString();\n+            // for cmd transaction.\n+\n+            if (mQueryList.contains(id)) {\n+                JsonArray status = result.get(\"result\").getAsJsonArray();\n+\n+                final int activeMode = status.get(8).getAsInt();\n+                mDeviceStatus.setActiveMode(ActiveMode.values()[activeMode]);\n+            }\n+        }\n+\n+        super.onNotify(msg);\n+    }\n+\n+    @Override\n+    public void toggleNightlightMode(boolean turnOn) {\n+        if (turnOn) {\n+            mConnection.invoke(\n+                    new DeviceMethod(MethodAction.SCENE, new Object[] { \"nightlight\", mDeviceStatus.getBrightness() }));\n+        } else {\n+            mConnection.invoke(MethodFactory.buildCTMethod(mDeviceStatus.getCt(), DeviceMethod.EFFECT_SMOOTH, 500));\n+        }\n+    }\n+}", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "chunk": "diff --git a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java\nindex e1d535cbc6..66b32b85a2 100644\n--- a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java\n+++ b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java\n\n@@ -25,7 +25,7 @@ import com.google.gson.JsonParser;\n /**\n  * The {@link CeilingDeviceWithNightDevice} contains methods for handling the ceiling device with ambient light.\n  *\n- * @author DragonNP - Initial contribution\n+ * @author Nikita Pogudalov - Initial contribution\n  */\n public class CeilingDeviceWithNightDevice extends CeilingDevice\n         implements DeviceWithNightlight {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5NjMwNA==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427496304", "bodyText": "I don't think you need to override this. YeelightCeilingHandler already implements this for you, unless you want to fix the string instead.", "author": "cpmeister", "createdAt": "2020-05-19T18:01:26Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n+\n+    public YeelightCeilingWithNightHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        handleCommandHelper(channelUID, command, \"Handle ceiling ambient light command\");\n+    }", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "chunk": "diff --git a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\nindex b206cd79bf..600b19cc7a 100644\n--- a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\n+++ b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\n\n@@ -24,19 +24,14 @@ import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n  * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n  * sent to one of the channels.\n  *\n- * @author DragonNP - Initial contribution\n+ * @author Nikita Pogudalov - Initial contribution\n  */\n-public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n+public class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {\n \n     public YeelightCeilingWithNightHandler(Thing thing) {\n         super(thing);\n     }\n \n-    @Override\n-    public void handleCommand(ChannelUID channelUID, Command command) {\n-        handleCommandHelper(channelUID, command, \"Handle ceiling ambient light command\");\n-    }\n-\n     @Override\n     protected void updateUI(DeviceStatus status) {\n         super.updateUI(status);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5ODIzMw==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427498233", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n          \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {", "author": "cpmeister", "createdAt": "2020-05-19T18:04:39Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "chunk": "diff --git a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\nindex b206cd79bf..600b19cc7a 100644\n--- a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\n+++ b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java\n\n@@ -24,19 +24,14 @@ import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n  * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n  * sent to one of the channels.\n  *\n- * @author DragonNP - Initial contribution\n+ * @author Nikita Pogudalov - Initial contribution\n  */\n-public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n+public class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {\n \n     public YeelightCeilingWithNightHandler(Thing thing) {\n         super(thing);\n     }\n \n-    @Override\n-    public void handleCommand(ChannelUID channelUID, Command command) {\n-        handleCommandHelper(channelUID, command, \"Handle ceiling ambient light command\");\n-    }\n-\n     @Override\n     protected void updateUI(DeviceStatus status) {\n         super.updateUI(status);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5OTE4Mg==", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427499182", "bodyText": "Also, please use your real name in the authoring tags", "author": "cpmeister", "createdAt": "2020-05-19T18:06:13Z", "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java", "diffHunk": "@@ -29,6 +29,7 @@\n  * The {@link YeelightHandlerFactory} is responsible for returning supported things and handlers for the devices.\n  *\n  * @author Coaster Li - Initial contribution\n+ * @author DragonNP - Added YeelightCeilingWithNightHandler for Ceiling 3", "originalCommit": "103a851fec7cf6b10af2e436bfdc2049655d697c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "chunk": "diff --git a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java\nindex 8966b3b839..4ac0e78fce 100644\n--- a/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java\n+++ b/bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java\n\n@@ -29,7 +29,7 @@ import org.osgi.service.component.annotations.Component;\n  * The {@link YeelightHandlerFactory} is responsible for returning supported things and handlers for the devices.\n  *\n  * @author Coaster Li - Initial contribution\n- * @author DragonNP - Added YeelightCeilingWithNightHandler for Ceiling 3\n+ * @author Nikita Pogudalov - Added YeelightCeilingWithNightHandler for Ceiling 1\n  */\n @Component(service = ThingHandlerFactory.class, configurationPid = \"binding.yeelight\")\n public class YeelightHandlerFactory extends BaseThingHandlerFactory {\n"}}, {"oid": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "url": "https://github.com/openhab/openhab-addons/commit/0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "message": "Fixing bugs\n\nSigned-off-by: Nikita Pogudalov <dragonnp@ya.ru>", "committedDate": "2020-05-19T18:52:35Z", "type": "commit"}]}