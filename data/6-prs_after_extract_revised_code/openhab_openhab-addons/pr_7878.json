{"pr_number": 7878, "pr_title": "[weatherunderground] Consider TimeZoneProvider to get the timezone", "pr_createdAt": "2020-06-08T16:24:52Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7878", "timeline": [{"oid": "8666e7d928a1105a4e29ad6b599ff0df07f56b25", "url": "https://github.com/openhab/openhab-addons/commit/8666e7d928a1105a4e29ad6b599ff0df07f56b25", "message": "[weatherunderground] Consider TimeZoneProvider to get the timezone\n\nAlso fix few warnings about null check\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-08T15:50:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMzU5NA==", "url": "https://github.com/openhab/openhab-addons/pull/7878#discussion_r437003594", "bodyText": "Shouldn't the timeZoneProvider be passed in its entirety to allow users to change the timezone without having to recreate the handler?", "author": "cpmeister", "createdAt": "2020-06-08T21:11:42Z", "path": "bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/WeatherUndergroundHandlerFactory.java", "diffHunk": "@@ -82,7 +86,7 @@ public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n         ThingTypeUID thingTypeUID = thing.getThingTypeUID();\n \n         if (thingTypeUID.equals(THING_TYPE_WEATHER)) {\n-            return new WeatherUndergroundHandler(thing, localeProvider, unitProvider);\n+            return new WeatherUndergroundHandler(thing, localeProvider, unitProvider, timeZoneProvider.getTimeZone());", "originalCommit": "8666e7d928a1105a4e29ad6b599ff0df07f56b25", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA0ODU4Nw==", "url": "https://github.com/openhab/openhab-addons/pull/7878#discussion_r437048587", "bodyText": "At the first reading, I did not understand your point. But now I realize I am not sure how it behaves when a core system setting is updated.\nThe timezone is an openHAB system configuration setting that the user can update, using Paper UI for example. When this setting is updated, the bundle (which one exactly ?) is updated. As we have an OSGi reference to this service in the binding thing handler factory component, what will happen ? Will the handler factory component be restarted with the updated reference ? If true, all thing handlers will be created again and my solution is ok. Passing the TimeZoneProvider object to the thing handler will make no change.\nIn case the setting change will have no impact on the binding handler factory component (no deactivate/activate), your remark will be valid. But in this case, I don't understand how OSGi components are informed of changes in referenced components.", "author": "lolodomo", "createdAt": "2020-06-08T23:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1NTI3NQ==", "url": "https://github.com/openhab/openhab-addons/pull/7878#discussion_r437055275", "bodyText": "This is not clear for me in fact.\nI should test a change of timezone and see the impact on the thing handler factory and thing handlers.", "author": "lolodomo", "createdAt": "2020-06-08T23:27:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE2OTQyNw==", "url": "https://github.com/openhab/openhab-addons/pull/7878#discussion_r437169427", "bodyText": "Ok, tested now. In fact, changing the timezone setting has no direct impact on the thing handler factory or thing handler. Nothing is restarted. So my solution is not good.\nIf I pass the TimeZoneProvider as parameter to the thing handler, it looks like it is correctly updated in the thing handler.", "author": "lolodomo", "createdAt": "2020-06-09T06:37:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMzU5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE3OTAwOA==", "url": "https://github.com/openhab/openhab-addons/pull/7878#discussion_r437179008", "bodyText": "Fixed", "author": "lolodomo", "createdAt": "2020-06-09T07:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAwMzU5NA=="}], "type": "inlineReview", "revised_code": {"commit": "5dc78dbebe24955609dc9ebec7cd6d78e5642472", "chunk": "diff --git a/bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/WeatherUndergroundHandlerFactory.java b/bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/WeatherUndergroundHandlerFactory.java\nindex 3a78dd0452..2a8444d8f8 100644\n--- a/bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/WeatherUndergroundHandlerFactory.java\n+++ b/bundles/org.openhab.binding.weatherunderground/src/main/java/org/openhab/binding/weatherunderground/internal/WeatherUndergroundHandlerFactory.java\n\n@@ -86,7 +86,7 @@ public class WeatherUndergroundHandlerFactory extends BaseThingHandlerFactory {\n         ThingTypeUID thingTypeUID = thing.getThingTypeUID();\n \n         if (thingTypeUID.equals(THING_TYPE_WEATHER)) {\n-            return new WeatherUndergroundHandler(thing, localeProvider, unitProvider, timeZoneProvider.getTimeZone());\n+            return new WeatherUndergroundHandler(thing, localeProvider, unitProvider, timeZoneProvider);\n         }\n \n         if (thingTypeUID.equals(THING_TYPE_BRIDGE)) {\n"}}, {"oid": "5dc78dbebe24955609dc9ebec7cd6d78e5642472", "url": "https://github.com/openhab/openhab-addons/commit/5dc78dbebe24955609dc9ebec7cd6d78e5642472", "message": "TimeZoneProvider passed as parameter to the thing handler\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>", "committedDate": "2020-06-09T06:57:49Z", "type": "commit"}]}