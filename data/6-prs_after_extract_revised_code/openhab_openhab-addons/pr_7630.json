{"pr_number": 7630, "pr_title": "[coolmasternet] Fix set_temp channel bug", "pr_createdAt": "2020-05-14T01:40:24Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7630", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0MzMwMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7630#discussion_r425243301", "bodyText": "Don't you need to make sure to convert the quantity to the correct units before sending the command?", "author": "cpmeister", "createdAt": "2020-05-14T15:50:34Z", "path": "bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/handler/HVACHandler.java", "diffHunk": "@@ -162,8 +161,8 @@ public void handleCommand(final ChannelUID channelUID, final Command command) {\n                             final QuantityType<?> value = new QuantityType<>(temp, controller.getUnit());\n                             updateState(SET_TEMP, value);\n                         }\n-                    } else if (command instanceof DecimalType) {\n-                        final DecimalType temp = (DecimalType) command;\n+                    } else if (command instanceof QuantityType) {\n+                        final QuantityType<?> temp = (QuantityType) command;\n                         controller.sendCommand(String.format(\"temp %s %s\", uid, temp));", "originalCommit": "fbd6f5c0e900cb069927fd5e05e30ba028f49dff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ4NDk3MA==", "url": "https://github.com/openhab/openhab-addons/pull/7630#discussion_r425484970", "bodyText": "Done. I also added 1 decimal place formatting, which makes it consistent with the temp command in the CoolMasterNet Programmer Reference Guide.\nTested fine:\n2020-05-15 09:26:02.433 [TRACE] [masternet.internal.ControllerHandler] - Waiting 25 ms for buffer to sink\n2020-05-15 09:26:02.433 [TRACE] [masternet.internal.ControllerHandler] - Buffer empty following unsolicited > prompt\n2020-05-15 09:26:02.433 [TRACE] [masternet.internal.ControllerHandler] - Sending command 'temp L4.000 23.0'\n2020-05-15 09:26:02.434 [TRACE] [masternet.internal.ControllerHandler] - Read result 'OK'\n......\n2020-05-15 09:26:11.272 [TRACE] [masternet.internal.ControllerHandler] - Waiting 25 ms for buffer to sink\n2020-05-15 09:26:11.298 [TRACE] [masternet.internal.ControllerHandler] - Buffer empty following solicited > prompt\n2020-05-15 09:26:11.298 [TRACE] [masternet.internal.ControllerHandler] - Sending command 'query L4.000 t'\n2020-05-15 09:26:11.299 [TRACE] [masternet.internal.ControllerHandler] - Read result '23'\n2020-05-15 09:26:11.300 [TRACE] [masternet.internal.ControllerHandler] - Read result 'OK'", "author": "benalexau", "createdAt": "2020-05-14T23:29:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI0MzMwMQ=="}], "type": "inlineReview", "revised_code": {"commit": "6afdedfa1e06e1fe5dc6fd6d21e8780aaa8d9872", "chunk": "diff --git a/bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/handler/HVACHandler.java b/bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/handler/HVACHandler.java\nindex 1e50686500..c371c638fa 100644\n--- a/bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/handler/HVACHandler.java\n+++ b/bundles/org.openhab.binding.coolmasternet/src/main/java/org/openhab/binding/coolmasternet/internal/handler/HVACHandler.java\n\n@@ -163,7 +163,9 @@ public class HVACHandler extends BaseThingHandler {\n                         }\n                     } else if (command instanceof QuantityType) {\n                         final QuantityType<?> temp = (QuantityType) command;\n-                        controller.sendCommand(String.format(\"temp %s %s\", uid, temp));\n+                        final QuantityType<?> converted = temp.toUnit(controller.getUnit());\n+                        final String formatted = converted.format(\"%.1f\");\n+                        controller.sendCommand(String.format(\"temp %s %s\", uid, formatted));\n                     }\n                     break;\n                 case MODE:\n"}}, {"oid": "6afdedfa1e06e1fe5dc6fd6d21e8780aaa8d9872", "url": "https://github.com/openhab/openhab-addons/commit/6afdedfa1e06e1fe5dc6fd6d21e8780aaa8d9872", "message": "[coolmasternet] Fix set_temp channel bug\n\nThis commit corrects a regression introduced in #7546 where the\nset_temp channel was changed to a QuantityType.\n\nThis has been tested on a CoolMasterNet deployment using a Setpoint\nelement in the sitemap.\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>", "committedDate": "2020-05-14T23:26:24Z", "type": "commit"}, {"oid": "6afdedfa1e06e1fe5dc6fd6d21e8780aaa8d9872", "url": "https://github.com/openhab/openhab-addons/commit/6afdedfa1e06e1fe5dc6fd6d21e8780aaa8d9872", "message": "[coolmasternet] Fix set_temp channel bug\n\nThis commit corrects a regression introduced in #7546 where the\nset_temp channel was changed to a QuantityType.\n\nThis has been tested on a CoolMasterNet deployment using a Setpoint\nelement in the sitemap.\n\nSigned-off-by: Ben Alex <ben.alex@acegi.com.au>", "committedDate": "2020-05-14T23:26:24Z", "type": "forcePushed"}]}