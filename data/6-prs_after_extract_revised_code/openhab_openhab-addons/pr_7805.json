{"pr_number": 7805, "pr_title": "[hpprinter] Add additional data points and refactoring", "pr_createdAt": "2020-05-27T13:01:25Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7805", "timeline": [{"oid": "6a0b8c2cf4ea4f60bc86322e2db3114ea8a9f454", "url": "https://github.com/openhab/openhab-addons/commit/6a0b8c2cf4ea4f60bc86322e2db3114ea8a9f454", "message": "Remove Binder Event and directly expose handler and move to same package.\nTidy up some code.\nAdd data points for Scanner function.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:54:42Z", "type": "commit"}, {"oid": "6fc9011fac49b2ac51129ffcdec3ae9e7acdedad", "url": "https://github.com/openhab/openhab-addons/commit/6fc9011fac49b2ac51129ffcdec3ae9e7acdedad", "message": "Refactor some items.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:08Z", "type": "commit"}, {"oid": "1095757db9d27967b4182105e76f06dc313343a4", "url": "https://github.com/openhab/openhab-addons/commit/1095757db9d27967b4182105e76f06dc313343a4", "message": "Add scanner and app groups and data points.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:08Z", "type": "commit"}, {"oid": "2d3afa55ad3f45009038397f5b42de8a0123a908", "url": "https://github.com/openhab/openhab-addons/commit/2d3afa55ad3f45009038397f5b42de8a0123a908", "message": "Change HPType to HPProductUsageFeatures.\nAdd additional feature checks.\nAdd additional data points for the Scanner.\nAdditional check for status message in the ProductStatus data.\nOnly run the status checkers on when the relevant channels are linked.\nCheck if the tray is open or empty.\nCode refactoring.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:09Z", "type": "commit"}, {"oid": "fd6fac6e11a434dbe3ecad5f1e1c26e70dac922a", "url": "https://github.com/openhab/openhab-addons/commit/fd6fac6e11a434dbe3ecad5f1e1c26e70dac922a", "message": "Tidy up some warnings.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:09Z", "type": "commit"}, {"oid": "ab09719180188509db6ad5ff30871de0975d4509", "url": "https://github.com/openhab/openhab-addons/commit/ab09719180188509db6ad5ff30871de0975d4509", "message": "Added Pages Remaining Data Points.\nAdjust Channel names and also made more channels advanced.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:10Z", "type": "commit"}, {"oid": "94cbabbf539377c8737971d52054950d0ac4ff56", "url": "https://github.com/openhab/openhab-addons/commit/94cbabbf539377c8737971d52054950d0ac4ff56", "message": "Add pages remaining data points.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:10Z", "type": "commit"}, {"oid": "45955c51909d78eddbf155c766311f9795659cf5", "url": "https://github.com/openhab/openhab-addons/commit/45955c51909d78eddbf155c766311f9795659cf5", "message": "Make all channels dynamic.\nAdd scanner data points.\nAdd copy data points.\nTweaks to some of the channel groups and channel names.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:11Z", "type": "commit"}, {"oid": "044cc56078ccb6a69a7aa2112534523114390898", "url": "https://github.com/openhab/openhab-addons/commit/044cc56078ccb6a69a7aa2112534523114390898", "message": "Update Readme with new channels and add some more information.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:11Z", "type": "commit"}, {"oid": "2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "url": "https://github.com/openhab/openhab-addons/commit/2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "message": "Update \"Miss Pick\" to \"Missed Pick\".\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-27T11:55:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc3NTcxMw==", "url": "https://github.com/openhab/openhab-addons/pull/7805#discussion_r432775713", "bodyText": "Any reason these are package private vs just private? Also please make these final and primitive.", "author": "cpmeister", "createdAt": "2020-05-29T23:03:05Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPFeatures.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.hpprinter.internal.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Element;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+/**\n+ * The {@link HPScannerStatus} is responsible for handling reading of scanner status data.\n+ *\n+ * @author Stewart Cossey - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HPFeatures {\n+    public static final String ENDPOINT = \"/DevMgmt/DiscoveryTree.xml\";\n+\n+    Boolean productStatus;\n+    Boolean productUsage;\n+    Boolean scannerStatus;", "originalCommit": "2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg5MDQ0Mw==", "url": "https://github.com/openhab/openhab-addons/pull/7805#discussion_r432890443", "bodyText": "No they should be class private; ill sort those out as well as the final and primitives for all the relevant classes.", "author": "Cossey", "createdAt": "2020-05-30T21:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc3NTcxMw=="}], "type": "inlineReview", "revised_code": {"commit": "fb3263b91a09a695e91b7aa697faada9c82d86a0", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPFeatures.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPFeatures.java\nindex dcdbac0833..1a7e44ac8e 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPFeatures.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPFeatures.java\n\n@@ -27,16 +27,16 @@ import org.w3c.dom.NodeList;\n public class HPFeatures {\n     public static final String ENDPOINT = \"/DevMgmt/DiscoveryTree.xml\";\n \n-    Boolean productStatus;\n-    Boolean productUsage;\n-    Boolean scannerStatus;\n+    private final boolean productStatus;\n+    private final boolean productUsage;\n+    private final boolean scannerStatus;\n \n     public HPFeatures(Document document) {\n         Element root = (Element) document.getDocumentElement();\n \n-        Boolean localProductStatus = false;\n-        Boolean localProductUsage = false;\n-        Boolean localScannerStatus = false;\n+        boolean localProductStatus = false;\n+        boolean localProductUsage = false;\n+        boolean localScannerStatus = false;\n \n         for (Node n = root.getFirstChild(); n != null; n = n.getNextSibling()) {\n             if (n instanceof Element) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc3NjA1NA==", "url": "https://github.com/openhab/openhab-addons/pull/7805#discussion_r432776054", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (currPrinterSubUnit.getElementsByTagName(\"dd:JamEvents\").getLength() > 0) {\n          \n          \n            \n                            jamEvents = true;\n          \n          \n            \n                        }\n          \n          \n            \n                        jamEvents = currPrinterSubUnit.getElementsByTagName(\"dd:JamEvents\").getLength() > 0;\n          \n      \n    \n    \n  \n\nPlease do similar changes to the code below.", "author": "cpmeister", "createdAt": "2020-05-29T23:04:49Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPProductUsageFeatures.java", "diffHunk": "@@ -0,0 +1,358 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.hpprinter.internal.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Element;\n+import org.w3c.dom.NodeList;\n+\n+/**\n+ * The {@link HPProductUsageFeatures} is responsible for determining what type of printer usage\n+ * data the Web Interface supports including any features.\n+ *\n+ * @author Stewart Cossey - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HPProductUsageFeatures {\n+    public static final String ENDPOINT = \"/DevMgmt/ProductUsageDyn.xml\";\n+\n+    private PrinterType printerType = PrinterType.UNKNOWN;\n+    private boolean jamEvents;\n+    private boolean mispickEvents;\n+    private boolean subscriptionImpressions;\n+    private boolean frontPanelCancel;\n+    private boolean cumuMarking;\n+    private boolean pagesRemaining;\n+\n+    private boolean scanAdf;\n+    private boolean scanFlatbed;\n+    private boolean scanToHost;\n+    private boolean scanToEmail;\n+    private boolean scanToFolder;\n+\n+    private boolean printApplication;\n+    private boolean printApplicationChrome;\n+\n+    private boolean scannerEngine;\n+    private boolean copyApplication;\n+\n+    private boolean cloudPrint;\n+\n+    public enum PrinterType {\n+        UNKNOWN,\n+        MONOCHROME,\n+        SINGLECOLOR,\n+        MULTICOLOR\n+    }\n+\n+    public HPProductUsageFeatures(Document document) {\n+        // Check what Ink/Toner colours are present\n+        NodeList consumableInk = document.getDocumentElement().getElementsByTagName(\"pudyn:Consumable\");\n+\n+        for (int i = 0; i < consumableInk.getLength(); i++) {\n+            Element currInk = (Element) consumableInk.item(i);\n+\n+            String inkName = currInk.getElementsByTagName(\"dd:MarkerColor\").item(0).getTextContent();\n+\n+            String consumeType = currInk.getElementsByTagName(\"dd:ConsumableTypeEnum\").item(0).getTextContent();\n+            if (consumeType.equalsIgnoreCase(\"printhead\")) {\n+                continue;\n+            }\n+\n+            if (currInk.getElementsByTagName(\"dd2:CumulativeMarkingAgentUsed\").getLength() > 0) {\n+                cumuMarking = true;\n+            }\n+\n+            switch (inkName.toLowerCase()) {\n+                case \"cyan\":\n+                case \"magenta\":\n+                case \"yellow\":\n+                    printerType = PrinterType.MULTICOLOR; // Is multicolor if it has this ink\n+                    break;\n+\n+                case \"cyanmagentayellow\":\n+                    printerType = PrinterType.SINGLECOLOR; // Is singlecolor if it has this ink\n+                    break;\n+\n+                case \"black\":\n+                    if (printerType == PrinterType.UNKNOWN) {\n+                        printerType = PrinterType.MONOCHROME; // Is Monochrome\n+                    }\n+                    break;\n+            }\n+        }\n+        \n+        if (((Element) consumableInk.item(0)).getElementsByTagName(\"dd:EstimatedPagesRemaining\").getLength() > 0) {\n+            pagesRemaining = true;\n+        }\n+\n+        NodeList printerSubUnit = document.getDocumentElement().getElementsByTagName(\"pudyn:PrinterSubunit\");\n+        if (printerSubUnit.getLength() > 0) {\n+            Element currPrinterSubUnit = (Element) printerSubUnit.item(0);\n+\n+            if (currPrinterSubUnit.getElementsByTagName(\"dd:JamEvents\").getLength() > 0) {\n+                jamEvents = true;\n+            }", "originalCommit": "2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5ede961ecb7d98d92f271e63860476b57f2fcb93", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPProductUsageFeatures.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPProductUsageFeatures.java\nindex 472a6df432..21d6fb221a 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPProductUsageFeatures.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPProductUsageFeatures.java\n\n@@ -28,26 +28,26 @@ public class HPProductUsageFeatures {\n     public static final String ENDPOINT = \"/DevMgmt/ProductUsageDyn.xml\";\n \n     private PrinterType printerType = PrinterType.UNKNOWN;\n-    private boolean jamEvents;\n-    private boolean mispickEvents;\n-    private boolean subscriptionImpressions;\n-    private boolean frontPanelCancel;\n-    private boolean cumuMarking;\n-    private boolean pagesRemaining;\n+    private boolean jamEvents = false;\n+    private boolean mispickEvents = false;\n+    private boolean subscriptionImpressions = false;\n+    private boolean frontPanelCancel = false;\n+    private boolean cumuMarking = false;\n+    private boolean pagesRemaining = false;\n \n-    private boolean scanAdf;\n-    private boolean scanFlatbed;\n-    private boolean scanToHost;\n-    private boolean scanToEmail;\n-    private boolean scanToFolder;\n+    private boolean scanAdf = false;\n+    private boolean scanFlatbed = false;\n+    private boolean scanToHost = false;\n+    private boolean scanToEmail = false;\n+    private boolean scanToFolder = false;\n \n-    private boolean printApplication;\n-    private boolean printApplicationChrome;\n+    private boolean printApplication = false;\n+    private boolean printApplicationChrome = false;\n \n-    private boolean scannerEngine;\n-    private boolean copyApplication;\n+    private boolean scannerEngine = false;\n+    private boolean copyApplication = false;\n \n-    private boolean cloudPrint;\n+    private boolean cloudPrint = false;\n \n     public enum PrinterType {\n         UNKNOWN,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc3NjU0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7805#discussion_r432776541", "bodyText": "Please make these primitive", "author": "cpmeister", "createdAt": "2020-05-29T23:06:53Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPScannerStatusFeatures.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.hpprinter.internal.api;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Element;\n+import org.w3c.dom.NodeList;\n+\n+/**\n+ * The {@link HPScannerStatusFeatures} is responsible for determining what type of printer scanner\n+ * status features the Web Interface supports.\n+ *\n+ * @author Stewart Cossey - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HPScannerStatusFeatures {\n+    public static final String ENDPOINT = \"/eSCL/ScannerStatus\";\n+\n+    private final Boolean hasStatus;\n+    private final Boolean hasAdf;", "originalCommit": "2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fb3263b91a09a695e91b7aa697faada9c82d86a0", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPScannerStatusFeatures.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPScannerStatusFeatures.java\nindex 329682b1ed..db44798fbb 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPScannerStatusFeatures.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPScannerStatusFeatures.java\n\n@@ -27,12 +27,12 @@ import org.w3c.dom.NodeList;\n public class HPScannerStatusFeatures {\n     public static final String ENDPOINT = \"/eSCL/ScannerStatus\";\n \n-    private final Boolean hasStatus;\n-    private final Boolean hasAdf;\n+    private final boolean hasStatus;\n+    private final boolean hasAdf;\n \n     public HPScannerStatusFeatures(Document document) {\n-        Boolean localHasStatus = false;\n-        Boolean localHasAdf = false;\n+        boolean localHasStatus = false;\n+        boolean localHasAdf = false;\n \n         Element nodes = (Element) document.getDocumentElement();\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5NTg3OA==", "url": "https://github.com/openhab/openhab-addons/pull/7805#discussion_r432795878", "bodyText": "can you make this primitive?", "author": "cpmeister", "createdAt": "2020-05-30T01:09:45Z", "path": "bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPStatus.java", "diffHunk": "@@ -33,18 +33,24 @@\n     private static final Map<String, String> STATUS_MESSAGES = initializeStatus();\n \n     private final String printerStatus;\n+    private final Boolean trayEmptyOrOpen;", "originalCommit": "2344d5b41048ad92665fc824eb4cfaa6e7ff05fa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fb3263b91a09a695e91b7aa697faada9c82d86a0", "chunk": "diff --git a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPStatus.java b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPStatus.java\nindex da9c0d0cca..aa9a59771e 100644\n--- a/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPStatus.java\n+++ b/bundles/org.openhab.binding.hpprinter/src/main/java/org/openhab/binding/hpprinter/internal/api/HPStatus.java\n\n@@ -33,13 +33,13 @@ public class HPStatus {\n     private static final Map<String, String> STATUS_MESSAGES = initializeStatus();\n \n     private final String printerStatus;\n-    private final Boolean trayEmptyOrOpen;\n+    private final boolean trayEmptyOrOpen;\n \n     public HPStatus(Document document) {\n         NodeList nodes = document.getDocumentElement().getElementsByTagName(\"psdyn:Status\");\n \n         String localPrinterStatus = \"Unknown\";\n-        Boolean localTrayEmptyOrOpen = false;\n+        boolean localTrayEmptyOrOpen = false;\n         for (int i = 0; i < nodes.getLength(); i++) {\n             Element element = (Element) nodes.item(i);\n             String statusCategory = element.getElementsByTagName(\"pscat:StatusCategory\").item(0).getTextContent();\n"}}, {"oid": "fb3263b91a09a695e91b7aa697faada9c82d86a0", "url": "https://github.com/openhab/openhab-addons/commit/fb3263b91a09a695e91b7aa697faada9c82d86a0", "message": "Convert Booleans to primitive types.\nChange access modifiers.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-31T02:54:00Z", "type": "commit"}, {"oid": "5ede961ecb7d98d92f271e63860476b57f2fcb93", "url": "https://github.com/openhab/openhab-addons/commit/5ede961ecb7d98d92f271e63860476b57f2fcb93", "message": "Tidy up some code and set default values.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-31T02:55:01Z", "type": "commit"}, {"oid": "5ede961ecb7d98d92f271e63860476b57f2fcb93", "url": "https://github.com/openhab/openhab-addons/commit/5ede961ecb7d98d92f271e63860476b57f2fcb93", "message": "Tidy up some code and set default values.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-31T02:55:01Z", "type": "forcePushed"}, {"oid": "baa45dc0f11b987493e231cc1f83c4545da10596", "url": "https://github.com/openhab/openhab-addons/commit/baa45dc0f11b987493e231cc1f83c4545da10596", "message": "Remove setting false for boolean values.\n\nSigned-off-by: Stewart Cossey <stewart.cossey@gmail.com>", "committedDate": "2020-05-31T03:01:49Z", "type": "commit"}]}