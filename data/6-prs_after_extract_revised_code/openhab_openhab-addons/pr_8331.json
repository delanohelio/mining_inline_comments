{"pr_number": 8331, "pr_title": "[homematic] Checking of full datapoint name is necessary", "pr_createdAt": "2020-08-23T12:43:01Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8331", "timeline": [{"oid": "8c84d3572fcb55ffb53dcab470a8930d826ad781", "url": "https://github.com/openhab/openhab-addons/commit/8c84d3572fcb55ffb53dcab470a8930d826ad781", "message": "Test of address only was not sufficient.\n\nOnly the string value contains the complete name that is necessary for\nthe check.\n\nAdditional fix for #5048\n\n\nSigned-off-by: Martin Herbst <develop@mherbst.de>", "committedDate": "2020-08-23T12:39:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzOTc3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/8331#discussion_r477339777", "bodyText": "Looking at what it actual checks. I think the check should be on the enum. Because the first character of enum is what is printed in the toString and what is check for here.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (dpInfo.toString().contains(\":M_\") && channel.getDevice().getHmInterface() == HmInterface.HMIP) {\n          \n          \n            \n                                if (dpInfo.getParamsetType() == HmParamsetType.MASTER && channel.getDevice().getHmInterface() == HmInterface.HMIP) {", "author": "Hilbrand", "createdAt": "2020-08-26T14:21:06Z", "path": "bundles/org.openhab.binding.homematic/src/main/java/org/openhab/binding/homematic/internal/communicator/parser/GetParamsetParser.java", "diffHunk": "@@ -61,8 +61,7 @@ public Void parse(Object[] message) throws IOException {\n                 boolean isHmSenMdirNextTrans = dpInfo.getName().equals(\"NEXT_TRANSMISSION\")\n                         && (deviceType.startsWith(\"HM-Sen-MDIR-O\") || deviceType.startsWith(\"HM-Sen-MDIR-WM55\"));\n                 if (!isHmSenMdirNextTrans) {\n-                    if (dpInfo.getAddress().contains(\":M_\")\n-                            && channel.getDevice().getHmInterface() == HmInterface.HMIP) {\n+                    if (dpInfo.toString().contains(\":M_\") && channel.getDevice().getHmInterface() == HmInterface.HMIP) {", "originalCommit": "8c84d3572fcb55ffb53dcab470a8930d826ad781", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ3NTAwMA==", "url": "https://github.com/openhab/openhab-addons/pull/8331#discussion_r479475000", "bodyText": "Thanks for the hint. It's definitely better. No idea how I could have missed the enum :-) . Changed it and added another small commit to the same method.", "author": "MHerbst", "createdAt": "2020-08-28T18:41:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzOTc3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "3168687d5a0078288171a85d3d82b9cfdedec61f", "chunk": "diff --git a/bundles/org.openhab.binding.homematic/src/main/java/org/openhab/binding/homematic/internal/communicator/parser/GetParamsetParser.java b/bundles/org.openhab.binding.homematic/src/main/java/org/openhab/binding/homematic/internal/communicator/parser/GetParamsetParser.java\nindex f5aa3a3d20..bf5d5434e5 100644\n--- a/bundles/org.openhab.binding.homematic/src/main/java/org/openhab/binding/homematic/internal/communicator/parser/GetParamsetParser.java\n+++ b/bundles/org.openhab.binding.homematic/src/main/java/org/openhab/binding/homematic/internal/communicator/parser/GetParamsetParser.java\n\n@@ -61,7 +61,8 @@ public class GetParamsetParser extends CommonRpcParser<Object[], Void> {\n                 boolean isHmSenMdirNextTrans = dpInfo.getName().equals(\"NEXT_TRANSMISSION\")\n                         && (deviceType.startsWith(\"HM-Sen-MDIR-O\") || deviceType.startsWith(\"HM-Sen-MDIR-WM55\"));\n                 if (!isHmSenMdirNextTrans) {\n-                    if (dpInfo.toString().contains(\":M_\") && channel.getDevice().getHmInterface() == HmInterface.HMIP) {\n+                    if (dpInfo.getParamsetType() == HmParamsetType.MASTER\n+                            && channel.getDevice().getHmInterface() == HmInterface.HMIP) {\n                         // These data points can't currently be recognized and therefore can't be created\n                         logger.debug(\"Can't set value for channel configuration datapoint '{}'\", dpInfo);\n                     } else {\n"}}, {"oid": "3168687d5a0078288171a85d3d82b9cfdedec61f", "url": "https://github.com/openhab/openhab-addons/commit/3168687d5a0078288171a85d3d82b9cfdedec61f", "message": "Using enum is better than string search\n\n\nSigned-off-by: Martin Herbst <develop@mherbst.de>", "committedDate": "2020-08-28T18:38:01Z", "type": "commit"}, {"oid": "6b03b8bc781d520e2c3e9e041ae209f189a04ba9", "url": "https://github.com/openhab/openhab-addons/commit/6b03b8bc781d520e2c3e9e041ae209f189a04ba9", "message": "Another exception for data point added\n\naccording to:\nhttps://github.com/openhab/openhab-addons/issues/5048#issuecomment-678940460\n\n\nSigned-off-by: Martin Herbst <develop@mherbst.de>", "committedDate": "2020-08-28T18:39:04Z", "type": "commit"}]}