{"pr_number": 9062, "pr_title": "[openweathermap] Add support for One Call API #7308", "pr_createdAt": "2020-11-18T12:37:23Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9062", "timeline": [{"oid": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "url": "https://github.com/openhab/openhab-addons/commit/95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "message": "OH 3.0 version of the Openweathermap Onecall API Binding extension\n\nSigned-off-by: wolfii <wolfgang.klimt@consol.de>", "committedDate": "2020-11-18T12:12:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTEwMg==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528391102", "bodyText": "Do we need this constant?", "author": "cweitkamp", "createdAt": "2020-11-22T19:14:16Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/OpenWeatherMapBindingConstants.java", "diffHunk": "@@ -49,38 +53,66 @@\n     public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_DAILY_FORECAST = new ChannelGroupTypeUID(BINDING_ID,\n             \"dailyForecast\");\n     public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_UVINDEX = new ChannelGroupTypeUID(BINDING_ID, \"uvindex\");\n+    public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_ONECALL_MINUTELY_FORECAST = new ChannelGroupTypeUID(\n+            BINDING_ID, \"oneCallMinutely\");\n+    public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_ONECALL_HOURLY_FORECAST = new ChannelGroupTypeUID(\n+            BINDING_ID, \"oneCallHourly\");\n+    public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_ONECALL_DAILY_FORECAST = new ChannelGroupTypeUID(\n+            BINDING_ID, \"oneCallDaily\");\n+    public static final ChannelGroupTypeUID CHANNEL_GROUP_TYPE_ONECALL_CURRENT = new ChannelGroupTypeUID(BINDING_ID,\n+            \"oneCallCurrent\");\n \n     // List of all channel groups\n     public static final String CHANNEL_GROUP_STATION = \"station\";\n     public static final String CHANNEL_GROUP_CURRENT_WEATHER = \"current\";\n     public static final String CHANNEL_GROUP_FORECAST_TODAY = \"forecastToday\";\n     public static final String CHANNEL_GROUP_FORECAST_TOMORROW = \"forecastTomorrow\";\n     public static final String CHANNEL_GROUP_CURRENT_UVINDEX = \"current\";\n+    public static final String CHANNEL_GROUP_ONECALL_CURRENT = \"current\";\n+    public static final String CHANNEL_GROUP_ONECALL_HISTORY = \"history\";\n+    public static final String CHANNEL_GROUP_ONECALL_TODAY = \"forecastToday\";\n+    public static final String CHANNEL_GROUP_ONECALL_TOMORROW = \"forecastTomorrow\";\n \n     // List of all channels\n     public static final String CHANNEL_STATION_ID = \"id\";\n     public static final String CHANNEL_STATION_NAME = \"name\";\n     public static final String CHANNEL_STATION_LOCATION = \"location\";\n     public static final String CHANNEL_TIME_STAMP = \"time-stamp\";\n+    public static final String CHANNEL_SUNRISE = \"sunrise\";\n+    public static final String CHANNEL_SUNSET = \"sunset\";\n     public static final String CHANNEL_CONDITION = \"condition\";\n     public static final String CHANNEL_CONDITION_ID = \"condition-id\";\n     public static final String CHANNEL_CONDITION_ICON = \"icon\";\n     public static final String CHANNEL_CONDITION_ICON_ID = \"icon-id\";\n     public static final String CHANNEL_TEMPERATURE = \"temperature\";\n     public static final String CHANNEL_APPARENT_TEMPERATURE = \"apparent-temperature\";\n+    public static final String CHANNEL_APPARENT_MORNING = \"apparent-morning\";\n+    public static final String CHANNEL_APPARENT_DAY = \"apparent-day\";\n+    public static final String CHANNEL_APPARENT_EVENING = \"apparent-evening\";\n+    public static final String CHANNEL_APPARENT_NIGHT = \"apparent-night\";\n     public static final String CHANNEL_MIN_TEMPERATURE = \"min-temperature\";\n     public static final String CHANNEL_MAX_TEMPERATURE = \"max-temperature\";\n+    public static final String CHANNEL_MORNING_TEMPERATURE = \"morning-temperature\";\n+    public static final String CHANNEL_DAY_TEMPERATURE = \"day-temperature\";\n+    public static final String CHANNEL_EVENING_TEMPERATURE = \"evening-temperature\";\n+    public static final String CHANNEL_NIGHT_TEMPERATURE = \"night-temperature\";\n+    public static final String CHANNEL_DEW_POINT = \"dew-point\";\n     public static final String CHANNEL_PRESSURE = \"pressure\";\n     public static final String CHANNEL_HUMIDITY = \"humidity\";\n     public static final String CHANNEL_WIND_SPEED = \"wind-speed\";\n     public static final String CHANNEL_WIND_DIRECTION = \"wind-direction\";\n     public static final String CHANNEL_GUST_SPEED = \"gust-speed\";\n     public static final String CHANNEL_CLOUDINESS = \"cloudiness\";\n+    public static final String CHANNEL_PRECIP_PROBABILITY = \"precip-probability\";\n     public static final String CHANNEL_RAIN = \"rain\";\n     public static final String CHANNEL_SNOW = \"snow\";\n     public static final String CHANNEL_VISIBILITY = \"visibility\";\n     public static final String CHANNEL_UVINDEX = \"uvindex\";\n+    public static final String CHANNEL_PRECIPITATION = \"precipitation\";\n \n     // List of all configuration\n     public static final String CONFIG_FORECAST_DAYS = \"forecastDays\";\n+\n+    // relative number of days in history\n+    public static final String CONFIG_HISTORY_DAYS = \"historyDays\";", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzA3OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057079", "bodyText": "Nope :-)\nRemoved", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:20:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTEwMg=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/OpenWeatherMapBindingConstants.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/OpenWeatherMapBindingConstants.java\nindex 32f2e9ea42..4b87d1e3ee 100644\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/OpenWeatherMapBindingConstants.java\n+++ b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/OpenWeatherMapBindingConstants.java\n\n@@ -112,7 +112,4 @@ public class OpenWeatherMapBindingConstants {\n \n     // List of all configuration\n     public static final String CONFIG_FORECAST_DAYS = \"forecastDays\";\n-\n-    // relative number of days in history\n-    public static final String CONFIG_HISTORY_DAYS = \"historyDays\";\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTU3MA==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528391570", "bodyText": "The ByteArrayFileCache is now available in OHC. Please revert this change.", "author": "cweitkamp", "createdAt": "2020-11-22T19:18:11Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/connection/OpenWeatherMapConnection.java", "diffHunk": "@@ -38,8 +39,10 @@\n import org.openhab.binding.openweathermap.internal.dto.OpenWeatherMapJsonHourlyForecastData;\n import org.openhab.binding.openweathermap.internal.dto.OpenWeatherMapJsonUVIndexData;\n import org.openhab.binding.openweathermap.internal.dto.OpenWeatherMapJsonWeatherData;\n+import org.openhab.binding.openweathermap.internal.dto.onecall.OpenWeatherMapOneCallAPIData;\n+import org.openhab.binding.openweathermap.internal.dto.onecallhist.OpenWeatherMapOneCallHistAPIData;\n import org.openhab.binding.openweathermap.internal.handler.OpenWeatherMapAPIHandler;\n-import org.openhab.core.cache.ByteArrayFileCache;\n+import org.openhab.binding.openweathermap.internal.utils.ByteArrayFileCache;", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzIyNA==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057224", "bodyText": "Done. I got ClassNotFoundExceptions for my last update, this is why I added it originally. Looks like my 3.0 snapshot was too old then.", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTU3MA=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/connection/OpenWeatherMapConnection.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/connection/OpenWeatherMapConnection.java\nindex c0dd7f918b..ebb2cb595a 100644\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/connection/OpenWeatherMapConnection.java\n+++ b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/connection/OpenWeatherMapConnection.java\n\n@@ -42,7 +42,7 @@ import org.openhab.binding.openweathermap.internal.dto.OpenWeatherMapJsonWeather\n import org.openhab.binding.openweathermap.internal.dto.onecall.OpenWeatherMapOneCallAPIData;\n import org.openhab.binding.openweathermap.internal.dto.onecallhist.OpenWeatherMapOneCallHistAPIData;\n import org.openhab.binding.openweathermap.internal.handler.OpenWeatherMapAPIHandler;\n-import org.openhab.binding.openweathermap.internal.utils.ByteArrayFileCache;\n+import org.openhab.core.cache.ByteArrayFileCache;\n import org.openhab.core.cache.ExpiringCacheMap;\n import org.openhab.core.io.net.http.HttpUtil;\n import org.openhab.core.library.types.PointType;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTYyMA==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528391620", "bodyText": "Please remove this class. It is not needed anymore because it is available in OHC.", "author": "cweitkamp", "createdAt": "2020-11-22T19:18:53Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/utils/ByteArrayFileCache.java", "diffHunk": "@@ -0,0 +1,238 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openweathermap.internal.utils;", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzI1MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057251", "bodyText": "Done", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:21:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MTYyMA=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/utils/ByteArrayFileCache.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/utils/ByteArrayFileCache.java\ndeleted file mode 100644\nindex e2edd6b615..0000000000\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/utils/ByteArrayFileCache.java\n+++ /dev/null\n\n@@ -1,238 +0,0 @@\n-/**\n- * Copyright (c) 2010-2020 Contributors to the openHAB project\n- *\n- * See the NOTICE file(s) distributed with this work for additional\n- * information.\n- *\n- * This program and the accompanying materials are made available under the\n- * terms of the Eclipse Public License 2.0 which is available at\n- * http://www.eclipse.org/legal/epl-2.0\n- *\n- * SPDX-License-Identifier: EPL-2.0\n- */\n-package org.openhab.binding.openweathermap.internal.utils;\n-\n-import java.io.File;\n-import java.io.IOException;\n-import java.math.BigInteger;\n-import java.nio.charset.StandardCharsets;\n-import java.nio.file.Files;\n-import java.security.MessageDigest;\n-import java.security.NoSuchAlgorithmException;\n-import java.util.Arrays;\n-\n-import org.eclipse.jdt.annotation.NonNullByDefault;\n-import org.eclipse.jdt.annotation.Nullable;\n-import org.openhab.core.OpenHAB;\n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-\n-/**\n- * This is a simple file based cache implementation.\n- *\n- * @author Christoph Weitkamp - Initial contribution\n- */\n-@NonNullByDefault\n-public class ByteArrayFileCache {\n-\n-    private final Logger logger = LoggerFactory.getLogger(ByteArrayFileCache.class);\n-\n-    private static final String CACHE_FOLDER_NAME = \"cache\";\n-    public static final char EXTENSION_SEPARATOR = '.';\n-\n-    protected final File cacheFolder;\n-\n-    public ByteArrayFileCache(String servicePID) {\n-        // TODO track and limit folder size\n-        // TODO support user specific folder\n-        cacheFolder = new File(new File(new File(OpenHAB.getUserDataFolder()), CACHE_FOLDER_NAME), servicePID);\n-        if (!cacheFolder.exists()) {\n-            logger.debug(\"Creating cache folder '{}'\", cacheFolder.getAbsolutePath());\n-            cacheFolder.mkdirs();\n-        }\n-        logger.debug(\"Using cache folder '{}'\", cacheFolder.getAbsolutePath());\n-    }\n-\n-    /**\n-     * Adds a file to the cache. If the cache previously contained a file for the key, the old file is replaced by the\n-     * new content.\n-     *\n-     * @param key the key with which the file is to be associated\n-     * @param content the content for the file to be associated with the specified key\n-     */\n-    public void put(String key, byte[] content) {\n-        writeFile(getUniqueFile(key), content);\n-    }\n-\n-    /**\n-     * Adds a file to the cache.\n-     *\n-     * @param key the key with which the file is to be associated\n-     * @param content the content for the file to be associated with the specified key\n-     */\n-    public void putIfAbsent(String key, byte[] content) {\n-        File fileInCache = getUniqueFile(key);\n-        if (fileInCache.exists()) {\n-            logger.debug(\"File '{}' present in cache\", fileInCache.getName());\n-        } else {\n-            writeFile(fileInCache, content);\n-        }\n-    }\n-\n-    /**\n-     * Adds a file to the cache and returns the content of the file.\n-     *\n-     * @param key the key with which the file is to be associated\n-     * @param content the content for the file to be associated with the specified key\n-     * @return the content of the file associated with the given key\n-     */\n-    public byte[] putIfAbsentAndGet(String key, byte[] content) {\n-        putIfAbsent(key, content);\n-\n-        // return get(key);\n-        return content;\n-    }\n-\n-    /**\n-     * Writes the given content to the given {@link File}.\n-     *\n-     * @param fileInCache the {@link File}\n-     * @param content the content to be written\n-     */\n-    private void writeFile(File fileInCache, byte[] content) {\n-        logger.debug(\"Caching file '{}'\", fileInCache.getName());\n-        try {\n-            Files.write(fileInCache.toPath(), content);\n-        } catch (IOException e) {\n-            logger.warn(\"Could not write file '{}'\u00a0to cache\", fileInCache.getName(), e);\n-        }\n-    }\n-\n-    /**\n-     * Checks if the key is present in the cache.\n-     *\n-     * @param key the key whose presence in the cache is to be tested\n-     * @return true if the cache contains a file for the specified key\n-     */\n-    public boolean containsKey(String key) {\n-        return getUniqueFile(key).exists();\n-    }\n-\n-    /**\n-     * Removes the file associated with the given key from the cache.\n-     *\n-     * @param key the key whose associated file is to be removed\n-     */\n-    public void remove(String key) {\n-        deleteFile(getUniqueFile(key));\n-    }\n-\n-    /**\n-     * Deletes the given {@link File}.\n-     *\n-     * @param fileInCache the {@link File}\n-     */\n-    private void deleteFile(File fileInCache) {\n-        if (fileInCache.exists()) {\n-            logger.debug(\"Deleting file '{}' from cache\", fileInCache.getName());\n-            fileInCache.delete();\n-        } else {\n-            logger.debug(\"File '{}' not found in cache\", fileInCache.getName());\n-        }\n-    }\n-\n-    /**\n-     * Removes all files from the cache.\n-     */\n-    public void clear() {\n-        File[] filesInCache = cacheFolder.listFiles();\n-        if (filesInCache != null && filesInCache.length > 0) {\n-            logger.debug(\"Deleting all files from cache\");\n-            Arrays.stream(filesInCache).forEach(File::delete);\n-        }\n-    }\n-\n-    /**\n-     * Returns the content of the file associated with the given key, if it is present.\n-     *\n-     * @param key the key whose associated file is to be returned\n-     * @return the content of the file associated with the given key\n-     */\n-    public byte[] get(String key) {\n-        return readFile(getUniqueFile(key));\n-    }\n-\n-    /**\n-     * Reads the content from the given {@link File}, if it is present.\n-     *\n-     * @param fileInCache the {@link File}\n-     * @return the content of the file\n-     */\n-    private byte[] readFile(File fileInCache) {\n-        if (fileInCache.exists()) {\n-            logger.debug(\"Reading file '{}' from cache\", fileInCache.getName());\n-            try {\n-                return Files.readAllBytes(fileInCache.toPath());\n-            } catch (IOException e) {\n-                logger.warn(\"Could not read file '{}'\u00a0from cache\", fileInCache.getName(), e);\n-            }\n-        } else {\n-            logger.debug(\"File '{}' not found in cache\", fileInCache.getName());\n-        }\n-        return new byte[0];\n-    }\n-\n-    /**\n-     * Creates a unique {@link File} from the key with which the file is to be associated.\n-     *\n-     * @param key the key with which the file is to be associated\n-     * @return unique file for the file associated with the given key\n-     */\n-    private File getUniqueFile(String key) {\n-        // TODO: store / cache file internally for faster operations\n-        String fileExtension = getFileExtension(key);\n-        return new File(cacheFolder,\n-                getUniqueFileName(key) + (fileExtension == null ? \"\" : EXTENSION_SEPARATOR + fileExtension));\n-    }\n-\n-    /**\n-     * Gets the extension of a file name.\n-     *\n-     * @param fileName the file name to retrieve the extension of\n-     * @return the extension of the file or null if none exists\n-     */\n-    private @Nullable String getFileExtension(String fileName) {\n-        int index = fileName.lastIndexOf(EXTENSION_SEPARATOR);\n-        // exclude file names starting with a dot\n-        if (index > 0) {\n-            return fileName.substring(index + 1);\n-        } else {\n-            return null;\n-        }\n-    }\n-\n-    /**\n-     * Creates a unique file name from the key with which the file is to be associated.\n-     *\n-     * @param key the key with which the file is to be associated\n-     * @return unique file name for the file associated with the given key\n-     */\n-    private String getUniqueFileName(String key) {\n-        try {\n-            byte[] bytesOfFileName = key.getBytes(StandardCharsets.UTF_8);\n-            MessageDigest md = MessageDigest.getInstance(\"MD5\");\n-            byte[] md5Hash = md.digest(bytesOfFileName);\n-            BigInteger bigInt = new BigInteger(1, md5Hash);\n-            StringBuilder fileNameHash = new StringBuilder(bigInt.toString(16));\n-            // Now we need to zero pad it if you actually want the full 32 chars\n-            while (fileNameHash.length() < 32) {\n-                fileNameHash.insert(0, \"0\");\n-            }\n-            return fileNameHash.toString();\n-        } catch (NoSuchAlgorithmException ex) {\n-            // should not happen\n-            logger.error(\"Could not create MD5 hash for key '{}'\", key, ex);\n-            return key.toString();\n-        }\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjA5NQ==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528392095", "bodyText": "What is the difference between this class and the other Weather class? (see https://github.com/openhab/openhab-addons/pull/9062/files#diff-8d98c5ea97753b200daab2546b605d6713a25af0a2c16ef830cc678bc2eb35b2)", "author": "cweitkamp", "createdAt": "2020-11-22T19:23:17Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather_.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openweathermap.internal.dto.onecall;", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzQxOA==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057418", "bodyText": "This was what came out of the generated json mapper, didn't look into it in detail. However, works also when using the Weather class  in all places. Removed it", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:23:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjA5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather_.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather_.java\ndeleted file mode 100644\nindex 40e20165c3..0000000000\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather_.java\n+++ /dev/null\n\n@@ -1,74 +0,0 @@\n-/**\n- * Copyright (c) 2010-2020 Contributors to the openHAB project\n- *\n- * See the NOTICE file(s) distributed with this work for additional\n- * information.\n- *\n- * This program and the accompanying materials are made available under the\n- * terms of the Eclipse Public License 2.0 which is available at\n- * http://www.eclipse.org/legal/epl-2.0\n- *\n- * SPDX-License-Identifier: EPL-2.0\n- */\n-package org.openhab.binding.openweathermap.internal.dto.onecall;\n-\n-import com.google.gson.annotations.Expose;\n-import com.google.gson.annotations.SerializedName;\n-\n-/**\n- * Holds the data from the deserialised JSON response. Created using http://www.jsonschema2pojo.org/.\n- * Settings:\n- * Annotation Style: GSON\n- * Use primitive types\n- * Use double numbers\n- * allow additional properties\n- *\n- * @author Wolfgang Klimt - Initial contribution\n- */\n-public class Weather_ {\n-\n-    @SerializedName(\"id\")\n-    @Expose\n-    private int id;\n-    @SerializedName(\"main\")\n-    @Expose\n-    private String main;\n-    @SerializedName(\"description\")\n-    @Expose\n-    private String description;\n-    @SerializedName(\"icon\")\n-    @Expose\n-    private String icon;\n-\n-    public int getId() {\n-        return id;\n-    }\n-\n-    public void setId(int id) {\n-        this.id = id;\n-    }\n-\n-    public String getMain() {\n-        return main;\n-    }\n-\n-    public void setMain(String main) {\n-        this.main = main;\n-    }\n-\n-    public String getDescription() {\n-        return description;\n-    }\n-\n-    public void setDescription(String description) {\n-        this.description = description;\n-    }\n-\n-    public String getIcon() {\n-        return icon;\n-    }\n-\n-    public void setIcon(String icon) {\n-        this.icon = icon;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjEwMw==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528392103", "bodyText": "What is the difference between this class and the other Weather class? (see https://github.com/openhab/openhab-addons/pull/9062/files#diff-8d98c5ea97753b200daab2546b605d6713a25af0a2c16ef830cc678bc2eb35b2)", "author": "cweitkamp", "createdAt": "2020-11-22T19:23:26Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather__.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openweathermap.internal.dto.onecall;", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzQzNw==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057437", "bodyText": "Also removed", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:23:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjEwMw=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather__.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather__.java\ndeleted file mode 100644\nindex e0a1f0b448..0000000000\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecall/Weather__.java\n+++ /dev/null\n\n@@ -1,74 +0,0 @@\n-/**\n- * Copyright (c) 2010-2020 Contributors to the openHAB project\n- *\n- * See the NOTICE file(s) distributed with this work for additional\n- * information.\n- *\n- * This program and the accompanying materials are made available under the\n- * terms of the Eclipse Public License 2.0 which is available at\n- * http://www.eclipse.org/legal/epl-2.0\n- *\n- * SPDX-License-Identifier: EPL-2.0\n- */\n-package org.openhab.binding.openweathermap.internal.dto.onecall;\n-\n-import com.google.gson.annotations.Expose;\n-import com.google.gson.annotations.SerializedName;\n-\n-/**\n- * Holds the data from the deserialised JSON response. Created using http://www.jsonschema2pojo.org/.\n- * Settings:\n- * Annotation Style: GSON\n- * Use primitive types\n- * Use double numbers\n- * allow additional properties\n- *\n- * @author Wolfgang Klimt - Initial contribution\n- */\n-public class Weather__ {\n-\n-    @SerializedName(\"id\")\n-    @Expose\n-    private int id;\n-    @SerializedName(\"main\")\n-    @Expose\n-    private String main;\n-    @SerializedName(\"description\")\n-    @Expose\n-    private String description;\n-    @SerializedName(\"icon\")\n-    @Expose\n-    private String icon;\n-\n-    public int getId() {\n-        return id;\n-    }\n-\n-    public void setId(int id) {\n-        this.id = id;\n-    }\n-\n-    public String getMain() {\n-        return main;\n-    }\n-\n-    public void setMain(String main) {\n-        this.main = main;\n-    }\n-\n-    public String getDescription() {\n-        return description;\n-    }\n-\n-    public void setDescription(String description) {\n-        this.description = description;\n-    }\n-\n-    public String getIcon() {\n-        return icon;\n-    }\n-\n-    public void setIcon(String icon) {\n-        this.icon = icon;\n-    }\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjE2Ng==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r528392166", "bodyText": "What is the difference between this class and the other Weather class? (see https://github.com/openhab/openhab-addons/pull/9062/files#diff-9a8c2612d60ade9bb74e96978e5aba5d07bd90f08579e2001039c9c212e79cd7)", "author": "cweitkamp", "createdAt": "2020-11-22T19:24:15Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecallhist/Weather_.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openweathermap.internal.dto.onecallhist;", "originalCommit": "95aa3567781e2e5cf3ded3ddf95ad2e6ec34b597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1NzQ2Mg==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532057462", "bodyText": "Also removed", "author": "Wolfgang1966", "createdAt": "2020-11-28T16:24:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODM5MjE2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecallhist/Weather_.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecallhist/Weather_.java\ndeleted file mode 100644\nindex 9293c051c8..0000000000\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/dto/onecallhist/Weather_.java\n+++ /dev/null\n\n@@ -1,74 +0,0 @@\n-/**\n- * Copyright (c) 2010-2020 Contributors to the openHAB project\n- *\n- * See the NOTICE file(s) distributed with this work for additional\n- * information.\n- *\n- * This program and the accompanying materials are made available under the\n- * terms of the Eclipse Public License 2.0 which is available at\n- * http://www.eclipse.org/legal/epl-2.0\n- *\n- * SPDX-License-Identifier: EPL-2.0\n- */\n-package org.openhab.binding.openweathermap.internal.dto.onecallhist;\n-\n-import com.google.gson.annotations.Expose;\n-import com.google.gson.annotations.SerializedName;\n-\n-/**\n- * Holds the data from the deserialised JSON response. Created using http://www.jsonschema2pojo.org/.\n- * Settings:\n- * Annotation Style: GSON\n- * Use primitive types\n- * Use double numbers\n- * allow additional properties\n- *\n- * @author Wolfgang Klimt - Initial contribution\n- */\n-public class Weather_ {\n-\n-    @SerializedName(\"id\")\n-    @Expose\n-    private int id;\n-    @SerializedName(\"main\")\n-    @Expose\n-    private String main;\n-    @SerializedName(\"description\")\n-    @Expose\n-    private String description;\n-    @SerializedName(\"icon\")\n-    @Expose\n-    private String icon;\n-\n-    public int getId() {\n-        return id;\n-    }\n-\n-    public void setId(int id) {\n-        this.id = id;\n-    }\n-\n-    public String getMain() {\n-        return main;\n-    }\n-\n-    public void setMain(String main) {\n-        this.main = main;\n-    }\n-\n-    public String getDescription() {\n-        return description;\n-    }\n-\n-    public void setDescription(String description) {\n-        this.description = description;\n-    }\n-\n-    public String getIcon() {\n-        return icon;\n-    }\n-\n-    public void setIcon(String icon) {\n-        this.icon = icon;\n-    }\n-}\n"}}, {"oid": "1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "url": "https://github.com/openhab/openhab-addons/commit/1a8f265cc7eeaeec5ef5f7448fe56e83215b859e", "message": "Updates requested by cweitkamp\n\nSigned-off-by: wolfii <wolfgang.klimt@consol.de>", "committedDate": "2020-11-28T16:18:29Z", "type": "commit"}, {"oid": "60cdc9065da41e81165a98f6d0155b74b61fa937", "url": "https://github.com/openhab/openhab-addons/commit/60cdc9065da41e81165a98f6d0155b74b61fa937", "message": "Removed author tag\n\nSigned-off-by: wolfii <wolfgang.klimt@consol.de>", "committedDate": "2020-11-28T17:56:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjEwMTk5MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532101991", "bodyText": "Nullable annotations aren't needed on local variables, this can be removed.", "author": "cpmeister", "createdAt": "2020-11-28T20:16:49Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/AbstractOpenWeatherMapHandler.java", "diffHunk": "@@ -205,8 +206,10 @@ protected State getQuantityTypeState(@Nullable Number value, Unit<?> unit) {\n     }\n \n     protected List<Channel> createChannelsForGroup(String channelGroupId, ChannelGroupTypeUID channelGroupTypeUID) {\n-        logger.debug(\"Building channel group '{}' for thing '{}'.\", channelGroupId, getThing().getUID());\n+        logger.debug(\"Building channel group '{}' for thing '{}' and GroupType '{}'.\", channelGroupId,\n+                getThing().getUID(), channelGroupTypeUID);\n         List<Channel> channels = new ArrayList<>();\n+        @Nullable", "originalCommit": "60cdc9065da41e81165a98f6d0155b74b61fa937", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE4MDc4Mw==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532180783", "bodyText": "Removed", "author": "Wolfgang1966", "createdAt": "2020-11-29T09:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjEwMTk5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "906c9a7629669296bb0f7d30af315a07612531fb", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/AbstractOpenWeatherMapHandler.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/AbstractOpenWeatherMapHandler.java\nindex 58b91e6b00..24b2becf02 100644\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/AbstractOpenWeatherMapHandler.java\n+++ b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/AbstractOpenWeatherMapHandler.java\n\n@@ -209,7 +209,6 @@ public abstract class AbstractOpenWeatherMapHandler extends BaseThingHandler {\n         logger.debug(\"Building channel group '{}' for thing '{}' and GroupType '{}'.\", channelGroupId,\n                 getThing().getUID(), channelGroupTypeUID);\n         List<Channel> channels = new ArrayList<>();\n-        @Nullable\n         ThingHandlerCallback callback = getCallback();\n         if (callback != null) {\n             for (ChannelBuilder channelBuilder : callback.createChannelBuilders(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE0OTIyMQ==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532149221", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                for (int i = (forecastDays < 2) ? 2 : forecastDays; i < newForecastDays; ++i) {\n          \n          \n            \n                                for (int i = Math.max(2, forecastDays); i < newForecastDays; i++) {", "author": "cpmeister", "createdAt": "2020-11-29T03:30:48Z", "path": "bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/OpenWeatherMapOneCallHandler.java", "diffHunk": "@@ -0,0 +1,636 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.openweathermap.internal.handler;\n+\n+import static org.openhab.binding.openweathermap.internal.OpenWeatherMapBindingConstants.*;\n+import static org.openhab.core.library.unit.MetricPrefix.*;\n+import static org.openhab.core.library.unit.SIUnits.*;\n+import static org.openhab.core.library.unit.SmartHomeUnits.*;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.binding.openweathermap.internal.config.OpenWeatherMapOneCallConfiguration;\n+import org.openhab.binding.openweathermap.internal.connection.OpenWeatherMapCommunicationException;\n+import org.openhab.binding.openweathermap.internal.connection.OpenWeatherMapConfigurationException;\n+import org.openhab.binding.openweathermap.internal.connection.OpenWeatherMapConnection;\n+import org.openhab.binding.openweathermap.internal.dto.onecall.*;\n+import org.openhab.core.i18n.TimeZoneProvider;\n+import org.openhab.core.library.types.QuantityType;\n+import org.openhab.core.thing.*;\n+import org.openhab.core.thing.binding.builder.ThingBuilder;\n+import org.openhab.core.types.State;\n+import org.openhab.core.types.UnDefType;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.JsonSyntaxException;\n+\n+/**\n+ * The {@link OpenWeatherMapOneCallHandler} is responsible for handling commands, which are sent to one of\n+ * the channels.\n+ *\n+ * @author Wolfgang Klimt - Initial contribution\n+ */\n+@NonNullByDefault\n+public class OpenWeatherMapOneCallHandler extends AbstractOpenWeatherMapHandler {\n+\n+    private final Logger logger = LoggerFactory.getLogger(OpenWeatherMapOneCallHandler.class);\n+\n+    private static final String CHANNEL_GROUP_MINUTELY_FORECAST_PREFIX = \"forecastMinutes\";\n+    private static final String CHANNEL_GROUP_HOURLY_FORECAST_PREFIX = \"forecastHours\";\n+    private static final String CHANNEL_GROUP_DAILY_FORECAST_PREFIX = \"forecastDay\";\n+    private static final Pattern CHANNEL_GROUP_HOURLY_FORECAST_PREFIX_PATTERN = Pattern\n+            .compile(CHANNEL_GROUP_HOURLY_FORECAST_PREFIX + \"([0-9]*)\");\n+    private static final Pattern CHANNEL_GROUP_DAILY_FORECAST_PREFIX_PATTERN = Pattern\n+            .compile(CHANNEL_GROUP_DAILY_FORECAST_PREFIX + \"([0-9]*)\");\n+    private static final Pattern CHANNEL_GROUP_MINUTELY_FORECAST_PREFIX_PATTERN = Pattern\n+            .compile(CHANNEL_GROUP_MINUTELY_FORECAST_PREFIX + \"([0-9]*)\");\n+\n+    private @Nullable OpenWeatherMapOneCallAPIData weatherData;\n+\n+    private int forecastMinutes = 60;\n+    private int forecastHours = 24;\n+    private int forecastDays = 8;\n+\n+    public OpenWeatherMapOneCallHandler(Thing thing, final TimeZoneProvider timeZoneProvider) {\n+        super(thing, timeZoneProvider);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        super.initialize();\n+        logger.debug(\"Initialize OpenWeatherMapOneCallHandler handler '{}'.\", getThing().getUID());\n+        OpenWeatherMapOneCallConfiguration config = getConfigAs(OpenWeatherMapOneCallConfiguration.class);\n+\n+        boolean configValid = true;\n+        int newForecastMinutes = config.forecastMinutes;\n+        if (newForecastMinutes < 0 || newForecastMinutes > 60) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                    \"@text/offline.conf-error-not-supported-onecall-number-of-minutes\");\n+            configValid = false;\n+        }\n+        int newForecastHours = config.forecastHours;\n+        if (newForecastHours < 0 || newForecastHours > 48) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                    \"@text/offline.conf-error-not-supported-onecall-number-of-hours\");\n+            configValid = false;\n+        }\n+        int newForecastDays = config.forecastDays;\n+        if (newForecastDays < 0 || newForecastDays > 8) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR,\n+                    \"@text/offline.conf-error-not-supported-onecall-number-of-days\");\n+            configValid = false;\n+        }\n+\n+        if (configValid) {\n+            logger.debug(\"Rebuilding thing '{}'.\", getThing().getUID());\n+            List<Channel> toBeAddedChannels = new ArrayList<>();\n+            List<Channel> toBeRemovedChannels = new ArrayList<>();\n+            toBeAddedChannels\n+                    .addAll(createChannelsForGroup(CHANNEL_GROUP_ONECALL_CURRENT, CHANNEL_GROUP_TYPE_ONECALL_CURRENT));\n+\n+            if (forecastMinutes != newForecastMinutes) {\n+                logger.debug(\"forecastMinutes changed from {} to {}. Rebuilding minutely forecast channel groups.\",\n+                        forecastMinutes, newForecastMinutes);\n+                if (forecastMinutes > newForecastMinutes) {\n+                    for (int i = newForecastMinutes + 1; i <= forecastMinutes; i++) {\n+                        toBeRemovedChannels.addAll(removeChannelsOfGroup(\n+                                CHANNEL_GROUP_MINUTELY_FORECAST_PREFIX + ((i < 10) ? \"0\" : \"\") + Integer.toString(i)));\n+                    }\n+                } else {\n+                    for (int i = forecastMinutes + 1; i <= newForecastMinutes; i++) {\n+                        toBeAddedChannels.addAll(createChannelsForGroup(\n+                                CHANNEL_GROUP_MINUTELY_FORECAST_PREFIX + ((i < 10) ? \"0\" : \"\") + Integer.toString(i),\n+                                CHANNEL_GROUP_TYPE_ONECALL_MINUTELY_FORECAST));\n+                    }\n+                }\n+                forecastMinutes = newForecastMinutes;\n+            }\n+            if (forecastHours != newForecastHours) {\n+                logger.debug(\"ForecastHours changed from {} to {}. Rebuilding hourly forecast channel groups.\",\n+                        forecastHours, newForecastHours);\n+                if (forecastHours > newForecastHours) {\n+                    for (int i = newForecastHours + 1; i <= forecastHours; i++) {\n+                        toBeRemovedChannels.addAll(removeChannelsOfGroup(\n+                                CHANNEL_GROUP_HOURLY_FORECAST_PREFIX + ((i < 10) ? \"0\" : \"\") + Integer.toString(i)));\n+                    }\n+                } else {\n+                    for (int i = forecastHours + 1; i <= newForecastHours; i++) {\n+                        toBeAddedChannels.addAll(createChannelsForGroup(\n+                                CHANNEL_GROUP_HOURLY_FORECAST_PREFIX + ((i < 10) ? \"0\" : \"\") + Integer.toString(i),\n+                                CHANNEL_GROUP_TYPE_ONECALL_HOURLY_FORECAST));\n+                    }\n+                }\n+                forecastHours = newForecastHours;\n+            }\n+            if (forecastDays != newForecastDays) {\n+                logger.debug(\"ForecastDays changed from {} to {}. Rebuilding daily forecast channel groups.\",\n+                        forecastDays, newForecastDays);\n+                if (forecastDays > newForecastDays) {\n+                    if (newForecastDays < 1) {\n+                        toBeRemovedChannels.addAll(removeChannelsOfGroup(CHANNEL_GROUP_FORECAST_TODAY));\n+                    }\n+                    if (newForecastDays < 2) {\n+                        toBeRemovedChannels.addAll(removeChannelsOfGroup(CHANNEL_GROUP_FORECAST_TOMORROW));\n+                    }\n+                    for (int i = newForecastDays; i < forecastDays; ++i) {\n+                        toBeRemovedChannels.addAll(\n+                                removeChannelsOfGroup(CHANNEL_GROUP_DAILY_FORECAST_PREFIX + Integer.toString(i)));\n+                    }\n+                } else {\n+                    if (forecastDays == 0 && newForecastDays > 0) {\n+                        toBeAddedChannels.addAll(createChannelsForGroup(CHANNEL_GROUP_FORECAST_TODAY,\n+                                CHANNEL_GROUP_TYPE_ONECALL_DAILY_FORECAST));\n+                    }\n+                    if (forecastDays <= 1 && newForecastDays > 1) {\n+                        toBeAddedChannels.addAll(createChannelsForGroup(CHANNEL_GROUP_FORECAST_TOMORROW,\n+                                CHANNEL_GROUP_TYPE_ONECALL_DAILY_FORECAST));\n+                    }\n+                    for (int i = (forecastDays < 2) ? 2 : forecastDays; i < newForecastDays; ++i) {", "originalCommit": "60cdc9065da41e81165a98f6d0155b74b61fa937", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE4MDg3Nw==", "url": "https://github.com/openhab/openhab-addons/pull/9062#discussion_r532180877", "bodyText": "Changed.", "author": "Wolfgang1966", "createdAt": "2020-11-29T09:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjE0OTIyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "906c9a7629669296bb0f7d30af315a07612531fb", "chunk": "diff --git a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/OpenWeatherMapOneCallHandler.java b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/OpenWeatherMapOneCallHandler.java\nindex acda81ae63..e328b20801 100644\n--- a/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/OpenWeatherMapOneCallHandler.java\n+++ b/bundles/org.openhab.binding.openweathermap/src/main/java/org/openhab/binding/openweathermap/internal/handler/OpenWeatherMapOneCallHandler.java\n\n@@ -161,7 +161,7 @@ public class OpenWeatherMapOneCallHandler extends AbstractOpenWeatherMapHandler\n                         toBeAddedChannels.addAll(createChannelsForGroup(CHANNEL_GROUP_FORECAST_TOMORROW,\n                                 CHANNEL_GROUP_TYPE_ONECALL_DAILY_FORECAST));\n                     }\n-                    for (int i = (forecastDays < 2) ? 2 : forecastDays; i < newForecastDays; ++i) {\n+                    for (int i = Math.max(forecastDays, 2); i < newForecastDays; i++) {\n                         toBeAddedChannels.addAll(\n                                 createChannelsForGroup(CHANNEL_GROUP_DAILY_FORECAST_PREFIX + Integer.toString(i),\n                                         CHANNEL_GROUP_TYPE_ONECALL_DAILY_FORECAST));\n"}}, {"oid": "906c9a7629669296bb0f7d30af315a07612531fb", "url": "https://github.com/openhab/openhab-addons/commit/906c9a7629669296bb0f7d30af315a07612531fb", "message": "Review comments from cpmeister\n\nSigned-off-by: wolfii <wolfgang.klimt@consol.de>", "committedDate": "2020-11-29T09:21:48Z", "type": "commit"}]}