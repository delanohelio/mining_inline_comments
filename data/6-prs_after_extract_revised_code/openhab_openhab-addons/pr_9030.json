{"pr_number": 9030, "pr_title": "[caddx] Fix wrongly handled discovery, off by 1 errors", "pr_createdAt": "2020-11-14T20:09:23Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/9030", "timeline": [{"oid": "e93d5fc241d4e7e78bd46f985ee8c537b7765196", "url": "https://github.com/openhab/openhab-addons/commit/e93d5fc241d4e7e78bd46f985ee8c537b7765196", "message": "Corrected caddx discovery bug\n\nSigned-off-by: Georgios Moutsos <georgios.moutsos@gmail.com>", "committedDate": "2020-11-14T16:47:31Z", "type": "commit"}, {"oid": "9713f5ce78307c2d2283ebf0570e12e225007f7e", "url": "https://github.com/openhab/openhab-addons/commit/9713f5ce78307c2d2283ebf0570e12e225007f7e", "message": "Maintenance\n\n- Changed refresh logic for the things\n- Code cleanup\n- Corrected off by one errors\n- Added initial tests for the message parsing\n\nSigned-off-by: Georgios Moutsos <georgios.moutsos@gmail.com>", "committedDate": "2020-11-14T17:42:55Z", "type": "commit"}, {"oid": "9cec98f1511413f4003c4c21d7c592a048c4a06a", "url": "https://github.com/openhab/openhab-addons/commit/9cec98f1511413f4003c4c21d7c592a048c4a06a", "message": "Corrected ParameterizedTest\n\nSigned-off-by: Georgios Moutsos <georgios.moutsos@gmail.com>", "committedDate": "2020-11-14T18:06:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NjY5OQ==", "url": "https://github.com/openhab/openhab-addons/pull/9030#discussion_r525396699", "bodyText": "I think it is a bit more readable if you use System.currentTimeMillis() instead of new Date().getTime()", "author": "cpmeister", "createdAt": "2020-11-17T18:37:41Z", "path": "bundles/org.openhab.binding.caddx/src/main/java/org/openhab/binding/caddx/internal/handler/ThingHandlerZone.java", "diffHunk": "@@ -77,15 +75,17 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n         String data = null;\n \n         if (command instanceof RefreshType) {\n-            if (channelUID.getId().equals(CaddxBindingConstants.ZONE_FAULTED)) {\n+            // Refresh only if 2 seconds have passed from the last refresh\n+            if (new Date().getTime() - lastRefreshTime > 2000) {", "originalCommit": "9cec98f1511413f4003c4c21d7c592a048c4a06a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg1NDU0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/9030#discussion_r525854541", "bodyText": "Changed", "author": "jossuar", "createdAt": "2020-11-18T07:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NjY5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "61e19241c5b8506143272ec1747aff94e6c9934f", "chunk": "diff --git a/bundles/org.openhab.binding.caddx/src/main/java/org/openhab/binding/caddx/internal/handler/ThingHandlerZone.java b/bundles/org.openhab.binding.caddx/src/main/java/org/openhab/binding/caddx/internal/handler/ThingHandlerZone.java\nindex bc3dd161d9..91c6d66ad8 100644\n--- a/bundles/org.openhab.binding.caddx/src/main/java/org/openhab/binding/caddx/internal/handler/ThingHandlerZone.java\n+++ b/bundles/org.openhab.binding.caddx/src/main/java/org/openhab/binding/caddx/internal/handler/ThingHandlerZone.java\n\n@@ -76,14 +74,14 @@ public class ThingHandlerZone extends CaddxBaseThingHandler {\n \n         if (command instanceof RefreshType) {\n             // Refresh only if 2 seconds have passed from the last refresh\n-            if (new Date().getTime() - lastRefreshTime > 2000) {\n+            if (System.currentTimeMillis() - lastRefreshTime > 2000) {\n                 cmd1 = CaddxBindingConstants.ZONE_STATUS_REQUEST;\n                 cmd2 = CaddxBindingConstants.ZONE_NAME_REQUEST;\n                 data = String.format(\"%d\", getZoneNumber() - 1);\n             } else {\n                 return;\n             }\n-            lastRefreshTime = new Date().getTime();\n+            lastRefreshTime = System.currentTimeMillis();\n         } else if (channelUID.getId().equals(CaddxBindingConstants.ZONE_BYPASSED)) {\n             cmd1 = CaddxBindingConstants.ZONE_BYPASSED;\n             cmd2 = CaddxBindingConstants.ZONE_STATUS_REQUEST;\n"}}, {"oid": "61e19241c5b8506143272ec1747aff94e6c9934f", "url": "https://github.com/openhab/openhab-addons/commit/61e19241c5b8506143272ec1747aff94e6c9934f", "message": "Changed new Date().getTime to System.currentTimeMillis()\n\nSigned-off-by: Georgios Moutsos <georgios.moutsos@gmail.com>", "committedDate": "2020-11-18T06:52:14Z", "type": "commit"}]}