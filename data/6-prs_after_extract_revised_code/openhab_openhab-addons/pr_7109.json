{"pr_number": 7109, "pr_title": "[exec] create exec.whitelist file when exec binding or transformation is installed", "pr_createdAt": "2020-03-07T08:36:20Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/7109", "timeline": [{"oid": "8307b607361d2a0ed8d5653e6a80c99d4526d134", "url": "https://github.com/openhab/openhab-addons/commit/8307b607361d2a0ed8d5653e6a80c99d4526d134", "message": "creates exec.whitelist file when exec binding or transformation is installed\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-03-07T08:34:57Z", "type": "commit"}, {"oid": "5f6a8373f539a2417aaccc3fb0c0b9b6fcdb8b65", "url": "https://github.com/openhab/openhab-addons/commit/5f6a8373f539a2417aaccc3fb0c0b9b6fcdb8b65", "message": "fixed identation\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-03-07T08:39:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTIzOTk0MQ==", "url": "https://github.com/openhab/openhab-addons/pull/7109#discussion_r389239941", "bodyText": "Isn't path nullable? Shouldn't you do a null check?", "author": "cpmeister", "createdAt": "2020-03-07T09:01:25Z", "path": "bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/ExecWhitelistWatchService.java", "diffHunk": "@@ -63,11 +63,12 @@ protected boolean watchSubDirectories() {\n     }\n \n     @Override\n-    protected void processWatchEvent(@Nullable WatchEvent<?> event,  WatchEvent.@Nullable Kind<?> kind, @Nullable Path path) {\n+    protected void processWatchEvent(@Nullable WatchEvent<?> event, WatchEvent.@Nullable Kind<?> kind,\n+            @Nullable Path path) {\n         if (path.endsWith(COMMAND_WHITELIST_FILE)) {", "originalCommit": "5f6a8373f539a2417aaccc3fb0c0b9b6fcdb8b65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f020e1cd0e94daec7499cdbd87299d9539fc31f8", "chunk": "diff --git a/bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/ExecWhitelistWatchService.java b/bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/ExecWhitelistWatchService.java\nindex ef26a04175..0ddcc96222 100644\n--- a/bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/ExecWhitelistWatchService.java\n+++ b/bundles/org.openhab.binding.exec/src/main/java/org/openhab/binding/exec/internal/ExecWhitelistWatchService.java\n\n@@ -65,10 +65,10 @@ public class ExecWhitelistWatchService extends AbstractWatchService {\n     @Override\n     protected void processWatchEvent(@Nullable WatchEvent<?> event, WatchEvent.@Nullable Kind<?> kind,\n             @Nullable Path path) {\n-        if (path.endsWith(COMMAND_WHITELIST_FILE)) {\n+        if (path != null && path.endsWith(COMMAND_WHITELIST_FILE)) {\n             commandWhitelist.clear();\n             try {\n-                Files.lines(path).filter(line -> !line.startsWith(\"#\")).forEach(commandWhitelist::add);\n+                Files.lines(path).filter(line -> !line.trim().startsWith(\"#\")).forEach(commandWhitelist::add);\n                 logger.debug(\"Updated command whitelist: {}\", commandWhitelist);\n             } catch (IOException e) {\n                 logger.warn(\"Cannot read whitelist file, exec binding commands won't be processed: {}\", e.getMessage());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTI0MDExMQ==", "url": "https://github.com/openhab/openhab-addons/pull/7109#discussion_r389240111", "bodyText": "I'd trim the line before checking for #", "author": "cpmeister", "createdAt": "2020-03-07T09:04:46Z", "path": "bundles/org.openhab.transform.exec/src/main/java/org/openhab/transform/exec/internal/ExecTransformationWhitelistWatchService.java", "diffHunk": "@@ -63,11 +63,12 @@ protected boolean watchSubDirectories() {\n     }\n \n     @Override\n-    protected void processWatchEvent(@Nullable WatchEvent<?> event,  WatchEvent.@Nullable Kind<?> kind, @Nullable Path path) {\n+    protected void processWatchEvent(@Nullable WatchEvent<?> event, WatchEvent.@Nullable Kind<?> kind,\n+            @Nullable Path path) {\n         if (path.endsWith(COMMAND_WHITELIST_FILE)) {\n             commandWhitelist.clear();\n-            try  {\n-                Files.lines(path).forEach(commandWhitelist::add);\n+            try {\n+                Files.lines(path).filter(line -> !line.startsWith(\"#\")).forEach(commandWhitelist::add);", "originalCommit": "5f6a8373f539a2417aaccc3fb0c0b9b6fcdb8b65", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f020e1cd0e94daec7499cdbd87299d9539fc31f8", "chunk": "diff --git a/bundles/org.openhab.transform.exec/src/main/java/org/openhab/transform/exec/internal/ExecTransformationWhitelistWatchService.java b/bundles/org.openhab.transform.exec/src/main/java/org/openhab/transform/exec/internal/ExecTransformationWhitelistWatchService.java\nindex 7baf81dbaf..a3f82b7473 100644\n--- a/bundles/org.openhab.transform.exec/src/main/java/org/openhab/transform/exec/internal/ExecTransformationWhitelistWatchService.java\n+++ b/bundles/org.openhab.transform.exec/src/main/java/org/openhab/transform/exec/internal/ExecTransformationWhitelistWatchService.java\n\n@@ -65,10 +65,10 @@ public class ExecTransformationWhitelistWatchService extends AbstractWatchServic\n     @Override\n     protected void processWatchEvent(@Nullable WatchEvent<?> event, WatchEvent.@Nullable Kind<?> kind,\n             @Nullable Path path) {\n-        if (path.endsWith(COMMAND_WHITELIST_FILE)) {\n+        if (path != null && path.endsWith(COMMAND_WHITELIST_FILE)) {\n             commandWhitelist.clear();\n             try {\n-                Files.lines(path).filter(line -> !line.startsWith(\"#\")).forEach(commandWhitelist::add);\n+                Files.lines(path).filter(line -> !line.trim().startsWith(\"#\")).forEach(commandWhitelist::add);\n                 logger.debug(\"Updated command whitelist: {}\", commandWhitelist);\n             } catch (IOException e) {\n                 logger.warn(\"Cannot read whitelist file, exec transformations won't be processed: {}\", e.getMessage());\n"}}, {"oid": "f020e1cd0e94daec7499cdbd87299d9539fc31f8", "url": "https://github.com/openhab/openhab-addons/commit/f020e1cd0e94daec7499cdbd87299d9539fc31f8", "message": "addressed review comments\n\nSigned-off-by: Kai Kreuzer <kai@openhab.org>", "committedDate": "2020-03-07T09:52:43Z", "type": "commit"}]}