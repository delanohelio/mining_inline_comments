{"pr_number": 8520, "pr_title": "[velux] fix concurrency bugs, other minor issues, update readme.md (replaces #8493)", "pr_createdAt": "2020-09-21T15:58:53Z", "pr_url": "https://github.com/openhab/openhab-addons/pull/8520", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3MTQzOQ==", "url": "https://github.com/openhab/openhab-addons/pull/8520#discussion_r492271439", "bodyText": "Empty Command (used to send nothing and process an incoming message only).", "author": "gs4711", "createdAt": "2020-09-21T18:44:07Z", "path": "bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/things/VeluxKLFAPI.java", "diffHunk": "@@ -129,7 +129,7 @@ public String toString() {\n         UNDEFTYPE((short) -1, \"Unknown command.\"),\n         // Special item: Shutdown of the connection\n         GW_OPENHAB_CLOSE((short) -2, \"openHAB connection shutdown command.\"),\n-        // Special item: Shutdown of the connection\n+        // Special item: ???", "originalCommit": "45f64f498894425fba1e80c0a890e7bfc1299ad8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3MjQ1OQ==", "url": "https://github.com/openhab/openhab-addons/pull/8520#discussion_r492672459", "bodyText": "Thank you. Suggestion adopted.", "author": "andrewfg", "createdAt": "2020-09-22T11:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3MTQzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "78351338862c9a28cadb8bd2571f889184faf444", "chunk": "diff --git a/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/things/VeluxKLFAPI.java b/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/things/VeluxKLFAPI.java\nindex f43ad357e1..255beae727 100644\n--- a/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/things/VeluxKLFAPI.java\n+++ b/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/things/VeluxKLFAPI.java\n\n@@ -129,7 +129,7 @@ public class VeluxKLFAPI {\n         UNDEFTYPE((short) -1, \"Unknown command.\"),\n         // Special item: Shutdown of the connection\n         GW_OPENHAB_CLOSE((short) -2, \"openHAB connection shutdown command.\"),\n-        // Special item: ???\n+        // Special item: Shutdown of the connection\n         GW_OPENHAB_RECEIVEONLY((short) -3, \"openHAB receive command.\"),\n         // Velux specific commands\n         GW_ERROR_NTF((short) 0x0000, \"Provides information on what triggered the error.\"),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3MTUwNQ==", "url": "https://github.com/openhab/openhab-addons/pull/8520#discussion_r492271505", "bodyText": "would suggest to replace the three questionmarks by a global constant.", "author": "gs4711", "createdAt": "2020-09-21T18:44:16Z", "path": "bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/handler/VeluxBindingHandler.java", "diffHunk": "@@ -82,9 +84,16 @@ public VeluxBindingHandler(Thing thing, final Localization localization) {\n      * @param channelUID for type {@link ChannelUID}.\n      * @return thingTypeUID of type {@link ThingTypeUID}.\n      */\n-    @SuppressWarnings(\"deprecation\")\n     private ThingTypeUID thingTypeUIDOf(ChannelUID channelUID) {\n-        return channelUID.getThingUID().getThingTypeUID();\n+        Channel chan = getThing().getChannel(channelUID);\n+        if (chan != null) {\n+            ChannelTypeUID type = chan.getChannelTypeUID();\n+            if (type != null) {\n+                return new ThingTypeUID(type.getBindingId(), type.getId());\n+            }\n+        }\n+        logger.warn(\"thingTypeUIDOf({}) failed.\", channelUID);\n+        return new ThingTypeUID(VeluxBindingConstants.BINDING_ID, \"???\");", "originalCommit": "45f64f498894425fba1e80c0a890e7bfc1299ad8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjY3MjU2MQ==", "url": "https://github.com/openhab/openhab-addons/pull/8520#discussion_r492672561", "bodyText": "Thank you. Suggestion adopted.", "author": "andrewfg", "createdAt": "2020-09-22T11:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3MTUwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "78351338862c9a28cadb8bd2571f889184faf444", "chunk": "diff --git a/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/handler/VeluxBindingHandler.java b/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/handler/VeluxBindingHandler.java\nindex 08ba8eec8c..29f99de388 100644\n--- a/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/handler/VeluxBindingHandler.java\n+++ b/bundles/org.openhab.binding.velux/src/main/java/org/openhab/binding/velux/internal/handler/VeluxBindingHandler.java\n\n@@ -84,16 +82,9 @@ public class VeluxBindingHandler extends ExtendedBaseThingHandler {\n      * @param channelUID for type {@link ChannelUID}.\n      * @return thingTypeUID of type {@link ThingTypeUID}.\n      */\n+    @SuppressWarnings(\"deprecation\")\n     private ThingTypeUID thingTypeUIDOf(ChannelUID channelUID) {\n-        Channel chan = getThing().getChannel(channelUID);\n-        if (chan != null) {\n-            ChannelTypeUID type = chan.getChannelTypeUID();\n-            if (type != null) {\n-                return new ThingTypeUID(type.getBindingId(), type.getId());\n-            }\n-        }\n-        logger.warn(\"thingTypeUIDOf({}) failed.\", channelUID);\n-        return new ThingTypeUID(VeluxBindingConstants.BINDING_ID, \"???\");\n+        return channelUID.getThingUID().getThingTypeUID();\n     }\n \n     /**\n"}}, {"oid": "78351338862c9a28cadb8bd2571f889184faf444", "url": "https://github.com/openhab/openhab-addons/commit/78351338862c9a28cadb8bd2571f889184faf444", "message": "[velux] #8493 update readme.md\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:04:49Z", "type": "commit"}, {"oid": "47d763d39256f3824025577d36b5eb72b53c7c37", "url": "https://github.com/openhab/openhab-addons/commit/47d763d39256f3824025577d36b5eb72b53c7c37", "message": "[velux] #8493 fix concurrency bugs\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:05:21Z", "type": "commit"}, {"oid": "b6bf13edfb4434b49d78b91a83deb6424af54455", "url": "https://github.com/openhab/openhab-addons/commit/b6bf13edfb4434b49d78b91a83deb6424af54455", "message": "[velux] #8493 unsupported properties\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:01Z", "type": "commit"}, {"oid": "db485b551d0a3d5760c9e7329e238c10fc469bfe", "url": "https://github.com/openhab/openhab-addons/commit/db485b551d0a3d5760c9e7329e238c10fc469bfe", "message": "[velux] #8493 flush buffer before write\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:02Z", "type": "commit"}, {"oid": "daeaab9ff0a72163ec1098b3a579db34a1ddf8ba", "url": "https://github.com/openhab/openhab-addons/commit/daeaab9ff0a72163ec1098b3a579db34a1ddf8ba", "message": "[velux] #8493 corrected log message\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:02Z", "type": "commit"}, {"oid": "97969526db674d46d576a8a49cf60575d58830c8", "url": "https://github.com/openhab/openhab-addons/commit/97969526db674d46d576a8a49cf60575d58830c8", "message": "[velux] spotless cosmetics\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:02Z", "type": "commit"}, {"oid": "17bc8ae5c1e39bdcb850197be59efb0128b7b460", "url": "https://github.com/openhab/openhab-addons/commit/17bc8ae5c1e39bdcb850197be59efb0128b7b460", "message": "[velux] work around removed (previously deprecated) methods\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:31Z", "type": "commit"}, {"oid": "7b171823e178d92e18eb8a07bc964b7873ee663e", "url": "https://github.com/openhab/openhab-addons/commit/7b171823e178d92e18eb8a07bc964b7873ee663e", "message": "[velux] ESH => OH\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:32Z", "type": "commit"}, {"oid": "eaa8e04455a3d7720f77107797038095e9813a8c", "url": "https://github.com/openhab/openhab-addons/commit/eaa8e04455a3d7720f77107797038095e9813a8c", "message": "[velux] timeout documentation\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:32Z", "type": "commit"}, {"oid": "01ce4070592ff4db18bafa5b8b9899e2b8906209", "url": "https://github.com/openhab/openhab-addons/commit/01ce4070592ff4db18bafa5b8b9899e2b8906209", "message": "[velux] adopted @gs4711 suggestions\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:33Z", "type": "commit"}, {"oid": "f9b608c8b4e3c3705e79e35fe2dc195b47233ac2", "url": "https://github.com/openhab/openhab-addons/commit/f9b608c8b4e3c3705e79e35fe2dc195b47233ac2", "message": "[velux] show ip address in communication logs\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:33Z", "type": "commit"}, {"oid": "8e820be13e335d0b775ac583baa131824da71aea", "url": "https://github.com/openhab/openhab-addons/commit/8e820be13e335d0b775ac583baa131824da71aea", "message": "[velux] show ip address in communication logs\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:33Z", "type": "commit"}, {"oid": "844d7ca8e89acac5bb76b36cd32dac1ad80e55ff", "url": "https://github.com/openhab/openhab-addons/commit/844d7ca8e89acac5bb76b36cd32dac1ad80e55ff", "message": "[velux] show ip address in communication logs\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:06:53Z", "type": "commit"}, {"oid": "fc2e830f86df2fd91f8cdaa8a2403dbea1213006", "url": "https://github.com/openhab/openhab-addons/commit/fc2e830f86df2fd91f8cdaa8a2403dbea1213006", "message": "[velux] errors in prior commit\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:13Z", "type": "commit"}, {"oid": "669c542ed9177170a838283ccd1ae9199bef9ebc", "url": "https://github.com/openhab/openhab-addons/commit/669c542ed9177170a838283ccd1ae9199bef9ebc", "message": "[velux] show command code in hex in logger\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:14Z", "type": "commit"}, {"oid": "40079eb4ce4501855a9a1bb2e01bcd39d9d72f34", "url": "https://github.com/openhab/openhab-addons/commit/40079eb4ce4501855a9a1bb2e01bcd39d9d72f34", "message": "[velux] logging\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:14Z", "type": "commit"}, {"oid": "b9b37d51c67271e9a321a24320da11df78a085e8", "url": "https://github.com/openhab/openhab-addons/commit/b9b37d51c67271e9a321a24320da11df78a085e8", "message": "[velux] flush write queue to immediately raise exceptions\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:14Z", "type": "commit"}, {"oid": "d9bcf3dd9f9ed4b72334bff0725affe8466d61b9", "url": "https://github.com/openhab/openhab-addons/commit/d9bcf3dd9f9ed4b72334bff0725affe8466d61b9", "message": "[velux] add velux to build\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:30Z", "type": "commit"}, {"oid": "d9bcf3dd9f9ed4b72334bff0725affe8466d61b9", "url": "https://github.com/openhab/openhab-addons/commit/d9bcf3dd9f9ed4b72334bff0725affe8466d61b9", "message": "[velux] add velux to build\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:07:30Z", "type": "forcePushed"}, {"oid": "5dc5757bf539f187b106d177c935101e60a8ee5c", "url": "https://github.com/openhab/openhab-addons/commit/5dc5757bf539f187b106d177c935101e60a8ee5c", "message": "[velux] add to reactor again\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T14:31:24Z", "type": "commit"}, {"oid": "5f1291f45ffb2e2853ff243bd7c821cead0725c0", "url": "https://github.com/openhab/openhab-addons/commit/5f1291f45ffb2e2853ff243bd7c821cead0725c0", "message": "[velux] fix thingTypeUIDOf() for not yet existing channels\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-25T16:33:52Z", "type": "commit"}, {"oid": "b8433d30098446d904d5bed8414c8351d40badcb", "url": "https://github.com/openhab/openhab-addons/commit/b8433d30098446d904d5bed8414c8351d40badcb", "message": "[velux] improve I/O error handling\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-26T12:50:56Z", "type": "commit"}, {"oid": "2fafbd9b6cbe5cd407d5fdb12178419a88aea360", "url": "https://github.com/openhab/openhab-addons/commit/2fafbd9b6cbe5cd407d5fdb12178419a88aea360", "message": "[velux] image in read me\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-26T17:04:19Z", "type": "commit"}, {"oid": "34ad7316e9b37b6b3ee9eac732f1b19cce945005", "url": "https://github.com/openhab/openhab-addons/commit/34ad7316e9b37b6b3ee9eac732f1b19cce945005", "message": "[velux] close connectivity even if (especially if) it is not ready\n\nSigned-off-by: Andrew Fiddian-Green <software@whitebear.ch>", "committedDate": "2020-09-27T12:57:59Z", "type": "commit"}]}