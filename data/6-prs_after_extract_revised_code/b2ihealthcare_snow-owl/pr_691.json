{"pr_number": 691, "pr_title": "Remove obsolete types/values/settings", "pr_createdAt": "2020-10-11T11:38:46Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/691", "timeline": [{"oid": "4e1d555d7cc5c2a3b9c47713e3737a2a5b4c2109", "url": "https://github.com/b2ihealthcare/snow-owl/commit/4e1d555d7cc5c2a3b9c47713e3737a2a5b4c2109", "message": "[index] remove no longer used `_hash` field from revision documents", "committedDate": "2020-10-11T11:02:00Z", "type": "commit"}, {"oid": "43e667e8a2d2575882b7d9c3156155a844d5fae4", "url": "https://github.com/b2ihealthcare/snow-owl/commit/43e667e8a2d2575882b7d9c3156155a844d5fae4", "message": "[index] rename `getHashedFields()` to `getRevisionFields`", "committedDate": "2020-10-11T11:03:49Z", "type": "commit"}, {"oid": "db2ca0d9ac4a824fd0712aad7218d4580f51bbc0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/db2ca0d9ac4a824fd0712aad7218d4580f51bbc0", "message": "[index] use constants when retrieving ES metadata fields", "committedDate": "2020-10-11T11:25:16Z", "type": "commit"}, {"oid": "423437723a88f56b86317d311dcfb9be6cc74a00", "url": "https://github.com/b2ihealthcare/snow-owl/commit/423437723a88f56b86317d311dcfb9be6cc74a00", "message": "[index] remove WithId interface", "committedDate": "2020-10-11T11:29:51Z", "type": "commit"}, {"oid": "a3406f35fc3668e661d1ac5a42264cfd27fb0132", "url": "https://github.com/b2ihealthcare/snow-owl/commit/a3406f35fc3668e661d1ac5a42264cfd27fb0132", "message": "[index] organize imports", "committedDate": "2020-10-11T11:30:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyODA1OA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/691#discussion_r503128058", "bodyText": "The 0-arg version of fetchSource returns a FetchSourceContext which holds the currently configured values, but does not modify any behavior: https://github.com/elastic/elasticsearch/blob/master/server/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java\nIf you'd like to control source filtering, use the single boolean form, but retrieving the source document is already the default: https://www.elastic.co/guide/en/elasticsearch/client/java-rest/master/java-rest-high-search.html#_source_filtering", "author": "apeteri", "createdAt": "2020-10-12T08:34:21Z", "path": "commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java", "diffHunk": "@@ -233,7 +230,7 @@ public EsDocumentSearcher(EsIndexAdmin admin, ObjectMapper mapper) {\n \tprivate <T> boolean applySourceFiltering(List<String> fields, boolean isDocIdOnly, final DocumentMapping mapping, final SearchSourceBuilder reqSource) {\n \t\t// No specific fields requested? Use _source to retrieve all of them\n \t\tif (fields.isEmpty()) {\n-\t\t\treqSource.fetchSource(null, EXCLUDED_SOURCE_FIELDS);", "originalCommit": "a3406f35fc3668e661d1ac5a42264cfd27fb0132", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19778bee15ee831056788f238dbd9374fd652854", "chunk": "diff --git a/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java b/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\nindex 056328091c..f8b8b1a1c4 100644\n--- a/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\n+++ b/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\n\n@@ -230,7 +230,7 @@ public class EsDocumentSearcher implements Searcher {\n \tprivate <T> boolean applySourceFiltering(List<String> fields, boolean isDocIdOnly, final DocumentMapping mapping, final SearchSourceBuilder reqSource) {\n \t\t// No specific fields requested? Use _source to retrieve all of them\n \t\tif (fields.isEmpty()) {\n-\t\t\treqSource.fetchSource();\n+\t\t\treqSource.fetchSource(true);\n \t\t\treturn true;\n \t\t}\n \t\t\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEyOTEyOA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/691#discussion_r503129128", "bodyText": "The same thing applies to TopHitsAggregationBuilder \u2013 this method is a simple getter.", "author": "apeteri", "createdAt": "2020-10-12T08:35:45Z", "path": "commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java", "diffHunk": "@@ -518,7 +512,7 @@ private void addSort(DocumentMapping mapping, SearchSourceBuilder reqSource, Sor\n \t\t\tif (fetchSource) {\n \t\t\t\ttopHitsAgg\n \t\t\t\t\t.storedFields(STORED_FIELDS_ID_ONLY)\n-\t\t\t\t\t.fetchSource(null, EXCLUDED_SOURCE_FIELDS);", "originalCommit": "a3406f35fc3668e661d1ac5a42264cfd27fb0132", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "19778bee15ee831056788f238dbd9374fd652854", "chunk": "diff --git a/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java b/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\nindex 056328091c..f8b8b1a1c4 100644\n--- a/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\n+++ b/commons/com.b2international.index/src/com/b2international/index/es/EsDocumentSearcher.java\n\n@@ -512,7 +512,7 @@ public class EsDocumentSearcher implements Searcher {\n \t\t\tif (fetchSource) {\n \t\t\t\ttopHitsAgg\n \t\t\t\t\t.storedFields(STORED_FIELDS_ID_ONLY)\n-\t\t\t\t\t.fetchSource();\n+\t\t\t\t\t.fetchSource(true);\n \t\t\t} else {\n \t\t\t\ttopHitsAgg\n \t\t\t\t\t.storedFields(STORED_FIELDS_NONE)\n"}}, {"oid": "19778bee15ee831056788f238dbd9374fd652854", "url": "https://github.com/b2ihealthcare/snow-owl/commit/19778bee15ee831056788f238dbd9374fd652854", "message": "[index] use boolean arg method instead of empty-arg getter\n\nThanks @apeteri.", "committedDate": "2020-10-12T11:40:58Z", "type": "commit"}]}