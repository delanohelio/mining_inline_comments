{"pr_number": 679, "pr_title": "ConceptMapMapping model improvements", "pr_createdAt": "2020-09-24T11:59:04Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/679", "timeline": [{"oid": "44e3b60848d308987374c250775865f0844ce84d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/44e3b60848d308987374c250775865f0844ce84d", "message": "[conceptMap]: store container set uri as snomed concept", "committedDate": "2020-09-22T15:54:20Z", "type": "commit"}, {"oid": "d9148ac131bb5c50dc06ce974af9572a3ade07e5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d9148ac131bb5c50dc06ce974af9572a3ade07e5", "message": "Revert \"[conceptMap]: store container set uri as snomed concept\"\n\nThis reverts commit 44e3b60848d308987374c250775865f0844ce84d.", "committedDate": "2020-09-23T09:53:23Z", "type": "commit"}, {"oid": "72858543f0fc18b8c4e2e2c62792feb969a7b61a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/72858543f0fc18b8c4e2e2c62792feb969a7b61a", "message": "[snomed] move SnomedDisplayTermType to snomed.core", "committedDate": "2020-09-23T10:03:30Z", "type": "commit"}, {"oid": "8a8a604c809fe4e5c96611e1eaa41d3f0546f5f1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8a8a604c809fe4e5c96611e1eaa41d3f0546f5f1", "message": "[conceptMap] add option to set preferred display to show", "committedDate": "2020-09-23T12:12:01Z", "type": "commit"}, {"oid": "2905a5fa76e6afedf8821f75855b794ac2173f28", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2905a5fa76e6afedf8821f75855b794ac2173f28", "message": "[conceptMap] use the configured display term type", "committedDate": "2020-09-23T12:27:02Z", "type": "commit"}, {"oid": "b8152432be3166e251563abac7b5debfdb283113", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b8152432be3166e251563abac7b5debfdb283113", "message": "[conceptMap] use the reference set's map target as term", "committedDate": "2020-09-23T13:04:01Z", "type": "commit"}, {"oid": "629b59462214782ef64bee03092c880cb0a7a792", "url": "https://github.com/b2ihealthcare/snow-owl/commit/629b59462214782ef64bee03092c880cb0a7a792", "message": "[conceptMap] fetch reference set term to display on editor", "committedDate": "2020-09-23T22:20:00Z", "type": "commit"}, {"oid": "c88e70b5ab4d822bbc02445ec34243b69f639433", "url": "https://github.com/b2ihealthcare/snow-owl/commit/c88e70b5ab4d822bbc02445ec34243b69f639433", "message": "[conceptMap] add target/container icon id to model", "committedDate": "2020-09-24T09:25:27Z", "type": "commit"}, {"oid": "b3364c3154fe8d6bc2265e8aeedcbe968f25b56a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b3364c3154fe8d6bc2265e8aeedcbe968f25b56a", "message": "[conceptMap] fetch icon ids by SnomedConceptMapSearchRequestEvaluator", "committedDate": "2020-09-24T09:26:12Z", "type": "commit"}, {"oid": "cd38c8cfcc5c0f8a0a8ca9ceeeeef027734f4f99", "url": "https://github.com/b2ihealthcare/snow-owl/commit/cd38c8cfcc5c0f8a0a8ca9ceeeeef027734f4f99", "message": "[conceptMap] refactor code", "committedDate": "2020-09-24T10:41:28Z", "type": "commit"}, {"oid": "4a515669e39258f1bd089a9bd73f96aa6170afff", "url": "https://github.com/b2ihealthcare/snow-owl/commit/4a515669e39258f1bd089a9bd73f96aa6170afff", "message": "Merge remote-tracking branch 'origin/7.x' into issue/mappings-tab-bug-fixes", "committedDate": "2020-09-24T10:45:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5NzI1MQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/679#discussion_r494797251", "bodyText": "This try-catch should be part of the SnomedDisplayTermType enum, unrecognized preferredDisplay strings should either:\n\nFail with a clear error message\nOr fall back to the FSN as default, PT might not be available and might not be appropriate to use", "author": "cmark", "createdAt": "2020-09-25T07:23:59Z", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/SnomedConceptMapSearchRequestEvaluator.java", "diffHunk": "@@ -61,43 +63,77 @@\n \n \t@Override\n \tpublic ConceptMapMappings evaluate(CodeSystemURI uri, BranchContext context, Options search) {\n-\t\tSnomedReferenceSetMembers referenceSetMembers = fetchRefsetMembers(uri, context, search);\n-\t\treturn toCollectionResource(referenceSetMembers, uri, context, search);\n+\t\tfinal String preferredDisplay = search.get(OptionKey.DISPLAY, String.class);\n+\t\tSnomedDisplayTermType snomedDisplayTermType;\n+\t\ttry {", "originalCommit": "4a515669e39258f1bd089a9bd73f96aa6170afff", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fd57d0b45dc7b6ca814cba7571c28305cd254c81", "chunk": "diff --git a/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/SnomedConceptMapSearchRequestEvaluator.java b/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/SnomedConceptMapSearchRequestEvaluator.java\nindex 76bab1aa90..64b776d3f7 100644\n--- a/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/SnomedConceptMapSearchRequestEvaluator.java\n+++ b/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/SnomedConceptMapSearchRequestEvaluator.java\n\n@@ -64,12 +64,8 @@ public final class SnomedConceptMapSearchRequestEvaluator implements ConceptMapM\n \t@Override\n \tpublic ConceptMapMappings evaluate(CodeSystemURI uri, BranchContext context, Options search) {\n \t\tfinal String preferredDisplay = search.get(OptionKey.DISPLAY, String.class);\n-\t\tSnomedDisplayTermType snomedDisplayTermType;\n-\t\ttry {\n-\t\t\tsnomedDisplayTermType = SnomedDisplayTermType.valueOf(preferredDisplay);\n-\t\t} catch(Exception e) {\n-\t\t\tsnomedDisplayTermType = SnomedDisplayTermType.PT;\n-\t\t}\n+\t\tfinal SnomedDisplayTermType snomedDisplayTermType = SnomedDisplayTermType.getEnum(preferredDisplay);\n+\n \t\tSnomedReferenceSetMembers referenceSetMembers = fetchRefsetMembers(uri, context, search, snomedDisplayTermType);\n \t\treturn toCollectionResource(referenceSetMembers, uri, context, search, snomedDisplayTermType);\n \t}\n"}}, {"oid": "b92f23918cd2cdc6da3db0dd09789006385a4a0b", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b92f23918cd2cdc6da3db0dd09789006385a4a0b", "message": "Merge remote-tracking branch 'origin/7.x' into issue/mappings-tab-bug-fixes", "committedDate": "2020-09-25T07:27:17Z", "type": "commit"}, {"oid": "fd57d0b45dc7b6ca814cba7571c28305cd254c81", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fd57d0b45dc7b6ca814cba7571c28305cd254c81", "message": "[SnomedDisplayTermType] create custom method to get enum's value", "committedDate": "2020-09-25T07:41:43Z", "type": "commit"}, {"oid": "3a5b5683aa9a3642d80d8e6806faeaf5863bdb6a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3a5b5683aa9a3642d80d8e6806faeaf5863bdb6a", "message": "[SnomedDisplayTermType] return ID_ONLY enum when value is not found", "committedDate": "2020-09-25T07:54:47Z", "type": "commit"}, {"oid": "f9cc5e91b3efecb0daebb5dacd3c60b1772d6611", "url": "https://github.com/b2ihealthcare/snow-owl/commit/f9cc5e91b3efecb0daebb5dacd3c60b1772d6611", "message": "Merge remote-tracking branch 'origin/7.x' into issue/mappings-tab-bug-fixes", "committedDate": "2020-09-25T08:58:50Z", "type": "commit"}]}