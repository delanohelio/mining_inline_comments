{"pr_number": 517, "pr_title": "SO-3948: refactor/redesign RF2 import/export endpoints", "pr_createdAt": "2020-03-23T10:46:22Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/517", "timeline": [{"oid": "e6743b874662321306793207b27aa6f8a3abea7e", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e6743b874662321306793207b27aa6f8a3abea7e", "message": "[core] move c.b.s.core.attachments package to snowowl.core", "committedDate": "2020-02-22T10:58:28Z", "type": "commit"}, {"oid": "1496f216b31381f051573cb98d4fb4e56ce0de67", "url": "https://github.com/b2ihealthcare/snow-owl/commit/1496f216b31381f051573cb98d4fb4e56ce0de67", "message": "[core] merge identity module into snowowl.core", "committedDate": "2020-02-22T11:35:42Z", "type": "commit"}, {"oid": "deaf5a1503c13459ae45f8f353c51f0f2f84f5f3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/deaf5a1503c13459ae45f8f353c51f0f2f84f5f3", "message": "[core] migrate references to identity classes", "committedDate": "2020-02-22T11:38:53Z", "type": "commit"}, {"oid": "fcc7abfa3d58760443f7bea223c89c9de66d8f9d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fcc7abfa3d58760443f7bea223c89c9de66d8f9d", "message": "[core] merge identity.file back to snowowl.core\n\nNOOP and FILE authentication will be the default available identity\nproviders supported by the core plug-in.", "committedDate": "2020-02-22T12:16:56Z", "type": "commit"}, {"oid": "327076032a0496c5dab17eb14b90c916b49c2c3c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/327076032a0496c5dab17eb14b90c916b49c2c3c", "message": "[core] migrate identity.ldap plugin\n\nConvert LDAP fragment to plugin and use plug-in infrastructure to\nregister the plugin to the system.", "committedDate": "2020-02-22T12:23:08Z", "type": "commit"}, {"oid": "31cb8d56901101afde9f4428e31497a9206fa812", "url": "https://github.com/b2ihealthcare/snow-owl/commit/31cb8d56901101afde9f4428e31497a9206fa812", "message": "[build] remove identity and identity.file from build", "committedDate": "2020-02-22T12:23:58Z", "type": "commit"}, {"oid": "dbde2693571c2f053b95897727528a7bc94af905", "url": "https://github.com/b2ihealthcare/snow-owl/commit/dbde2693571c2f053b95897727528a7bc94af905", "message": "[build] fix reference to identity and identity.file modules", "committedDate": "2020-02-22T13:59:26Z", "type": "commit"}, {"oid": "c33f1320cac02f7b252344cb8de2608fc5b0a3b0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/c33f1320cac02f7b252344cb8de2608fc5b0a3b0", "message": "SO-3948: add new RF2 export rest API\n\nAlso, remove codeSystemShortName from RF2 export Java API and infer the\nrelative codesystem from the current reference branch.\nSupport locales String in RF2 export Java API.", "committedDate": "2020-03-19T23:19:32Z", "type": "commit"}, {"oid": "e57d5d4b3e9e7df73170dc26aad1c1a18046e608", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e57d5d4b3e9e7df73170dc26aad1c1a18046e608", "message": "SO-3948: remove produces part from export endpoint\n\nSince the export endpoint produces two different media types\n(octet_stream when the request succeeds and the file download starts and\napplication/json if there was a failure during the request execution) it\nis necessary to remove the produces values otherwise Spring will not be\nable to detect the error handler when an exception occurs.\nAlso, remove the Resource type from the ResponseEntity will remove the\nJSON response example from the Swagger UI.", "committedDate": "2020-03-20T08:57:02Z", "type": "commit"}, {"oid": "efe8bdeb31fa226f7cb8798967a55813e70c4b55", "url": "https://github.com/b2ihealthcare/snow-owl/commit/efe8bdeb31fa226f7cb8798967a55813e70c4b55", "message": "SO-3948: add more exception handlers to ControllerExceptionMapper", "committedDate": "2020-03-20T21:11:34Z", "type": "commit"}, {"oid": "3024d71b8f62282134651fc676dead8ad3144814", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3024d71b8f62282134651fc676dead8ad3144814", "message": "SO-3948: add getEffectiveTime(String, String) method to EffectiveTimes", "committedDate": "2020-03-20T21:18:33Z", "type": "commit"}, {"oid": "0c3a312b2707804e878cf974f40c656a3fd764fe", "url": "https://github.com/b2ihealthcare/snow-owl/commit/0c3a312b2707804e878cf974f40c656a3fd764fe", "message": "SO-3948: use String for RF2 export start/end effectiveTimes configs", "committedDate": "2020-03-20T21:31:11Z", "type": "commit"}, {"oid": "3959341caa680f9c9fdc227953277cf6cf6d5f16", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3959341caa680f9c9fdc227953277cf6cf6d5f16", "message": "SO-3948: use new `/:path/export` endpoint in existing RF2 export tests", "committedDate": "2020-03-20T21:31:53Z", "type": "commit"}, {"oid": "e0ababc142ce9cf587e40bf158c3f6833e5b1fd6", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e0ababc142ce9cf587e40bf158c3f6833e5b1fd6", "message": "SO-3948: use BranchContext instead of the `referenceBranch` property...\n\n...and the RevisionIndexRequestBuilder to support new simplified export\nREST API path syntax: `/snomed-ct/v3/SNOMEDCT-UK-CL/export`.", "committedDate": "2020-03-20T21:38:59Z", "type": "commit"}, {"oid": "306c858ffb6a5f47670aea916cb83b73a5669847", "url": "https://github.com/b2ihealthcare/snow-owl/commit/306c858ffb6a5f47670aea916cb83b73a5669847", "message": "SO-3948: update deprecated javadoc message in SnomedExportRestService", "committedDate": "2020-03-21T14:24:57Z", "type": "commit"}, {"oid": "52d4fc4a29b655d9b6a60e48ab292953d45fe4a1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/52d4fc4a29b655d9b6a60e48ab292953d45fe4a1", "message": "SO-3948: update SnomedRf2ImportRequest and Builder\n\nRemove unnecessary codeSystemShortName (will be computed from the\ncurrent branch context).\nSupport snapshot behaviour selection in RevisionIndexRequestBuilder.\nAdd BranchContext alternative to Features.getImportFeatureToggle().\nAdd new commit() method alternatives to TransactionContext.", "committedDate": "2020-03-21T14:26:31Z", "type": "commit"}, {"oid": "438d436c4871c87ff258316cfca84d4700796a3b", "url": "https://github.com/b2ihealthcare/snow-owl/commit/438d436c4871c87ff258316cfca84d4700796a3b", "message": "SO-3948: deprecate SnomedImportRestService and all `/imports` endpoints", "committedDate": "2020-03-21T14:28:39Z", "type": "commit"}, {"oid": "b4277c98bf8b8c53251541f901288ea9f0b8e5c9", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b4277c98bf8b8c53251541f901288ea9f0b8e5c9", "message": "Merge branch 'feature/single-core-module' into...\n\n...feature/SO-3948-remove-import-export-config-objects\n\nConflicts:\n\tcore/com.b2international.snowowl.core/pom.xml\n\tcore/com.b2international.snowowl.identity.file/META-INF/MANIFEST.MF\n\tcore/com.b2international.snowowl.identity.file/pom.xml\n\tcore/com.b2international.snowowl.identity.ldap/META-INF/MANIFEST.MF\n\tcore/com.b2international.snowowl.identity/META-INF/MANIFEST.MF\n\tcore/com.b2international.snowowl.identity/pom.xml\n\tcore/com.b2international.snowowl.identity/src/com/b2international/snowowl/identity/domain/Permission.java\n\tcore/com.b2international.snowowl.identity/src/com/b2international/snowowl/identity/domain/Role.java\n\tsnomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/EvaluateQueryRefSetMemberRequest.java\n\tsnomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/EvaluateQueryRefSetRequest.java\n\tsnomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java\n\tsnomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ImportRequest.java", "committedDate": "2020-03-21T18:02:00Z", "type": "commit"}, {"oid": "3e14421a6fb0657955597ec8d09b665e04eb90c1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3e14421a6fb0657955597ec8d09b665e04eb90c1", "message": "[core] move Concept and Concepts generic model to snowowl.core", "committedDate": "2020-03-21T18:22:30Z", "type": "commit"}, {"oid": "ac1ede841e1a7aa66f913dbe30b1733618605986", "url": "https://github.com/b2ihealthcare/snow-owl/commit/ac1ede841e1a7aa66f913dbe30b1733618605986", "message": "[core] move core.authorization package from datastore to core", "committedDate": "2020-03-21T18:23:53Z", "type": "commit"}, {"oid": "7db3a68f1c1974f903c329dedf7bf649d26522c5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7db3a68f1c1974f903c329dedf7bf649d26522c5", "message": "[core] move core.client package from datastore to core", "committedDate": "2020-03-21T18:24:59Z", "type": "commit"}, {"oid": "30887f1ae04c581288f2930ed17bba35029378f3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/30887f1ae04c581288f2930ed17bba35029378f3", "message": "[core] move core.commit package from datastore to core", "committedDate": "2020-03-21T18:25:36Z", "type": "commit"}, {"oid": "2664960dc4046ac3948d35a30d69c9e4586e08c8", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2664960dc4046ac3948d35a30d69c9e4586e08c8", "message": "[core] move core.repository package from datastore to core", "committedDate": "2020-03-21T18:27:05Z", "type": "commit"}, {"oid": "cdc4ea23b694f67279174a689c628dbfc4299465", "url": "https://github.com/b2ihealthcare/snow-owl/commit/cdc4ea23b694f67279174a689c628dbfc4299465", "message": "[core] move core.request package from datastore to core", "committedDate": "2020-03-21T18:28:15Z", "type": "commit"}, {"oid": "7a018081eb04f74bb8e05ed83c201dcf5eb2cdc3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7a018081eb04f74bb8e05ed83c201dcf5eb2cdc3", "message": "[core] move core.rate package from datastore to core", "committedDate": "2020-03-21T18:28:48Z", "type": "commit"}, {"oid": "b6e9294ddf1f719eaf23c75bfb212d1b4ce54962", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b6e9294ddf1f719eaf23c75bfb212d1b4ce54962", "message": "[core] move core.validation packages from datastore to core", "committedDate": "2020-03-21T18:31:00Z", "type": "commit"}, {"oid": "0510a726c7cab63c5ec1ac380aa3e3c3f520ecfa", "url": "https://github.com/b2ihealthcare/snow-owl/commit/0510a726c7cab63c5ec1ac380aa3e3c3f520ecfa", "message": "[core] move core.merge package from datastore to core", "committedDate": "2020-03-21T18:32:03Z", "type": "commit"}, {"oid": "fc12f11368213e8139f9d02542f703a2c0b3a69e", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fc12f11368213e8139f9d02542f703a2c0b3a69e", "message": "[core] move core.compare package from datastore to core", "committedDate": "2020-03-21T18:32:46Z", "type": "commit"}, {"oid": "e081cce523024ec8fda768ce4cb7490bed7265f5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e081cce523024ec8fda768ce4cb7490bed7265f5", "message": "[core] move core.messaging package from datastore to core", "committedDate": "2020-03-21T18:33:05Z", "type": "commit"}, {"oid": "70f405e94d094ac3dc36fa0d3862ecd5f4d0a142", "url": "https://github.com/b2ihealthcare/snow-owl/commit/70f405e94d094ac3dc36fa0d3862ecd5f4d0a142", "message": "[core] move core.locks and oplock packages from datastore to core", "committedDate": "2020-03-21T18:39:16Z", "type": "commit"}, {"oid": "b802e591449b2525630d4dc6c5c2998fdc95e64b", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b802e591449b2525630d4dc6c5c2998fdc95e64b", "message": "[core] move datastore.config to core.config", "committedDate": "2020-03-21T18:44:57Z", "type": "commit"}, {"oid": "209c676ea438f27399503afb4302e3b084b56e99", "url": "https://github.com/b2ihealthcare/snow-owl/commit/209c676ea438f27399503afb4302e3b084b56e99", "message": "[core] move CodeSystem classes to core.codesystem", "committedDate": "2020-03-21T18:50:13Z", "type": "commit"}, {"oid": "557db30f917c647ae6d71782579a1220b45ffe35", "url": "https://github.com/b2ihealthcare/snow-owl/commit/557db30f917c647ae6d71782579a1220b45ffe35", "message": "[core] move datastore.converter package to core.request", "committedDate": "2020-03-21T18:52:17Z", "type": "commit"}, {"oid": "998d0104de6a7517bd9422fd08b248246bac9c7a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/998d0104de6a7517bd9422fd08b248246bac9c7a", "message": "[core] move datastore.events package content to core.branch...\n\n...and core.repository", "committedDate": "2020-03-21T18:55:06Z", "type": "commit"}, {"oid": "7d657fd05aa3aa268fdfd188b2649bad5b0437d0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7d657fd05aa3aa268fdfd188b2649bad5b0437d0", "message": "[core] move datastore.request.compare package to core.compare", "committedDate": "2020-03-21T18:56:48Z", "type": "commit"}, {"oid": "fc2a83198ebd5fdc18192c832ffdc62f76d737c3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fc2a83198ebd5fdc18192c832ffdc62f76d737c3", "message": "[core] renaming classes in core.branch package", "committedDate": "2020-03-21T19:02:26Z", "type": "commit"}, {"oid": "d4351210d01040ec353bb240776945f3a92cd72c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d4351210d01040ec353bb240776945f3a92cd72c", "message": "[core] moving review related classes to core.review package", "committedDate": "2020-03-21T19:03:10Z", "type": "commit"}, {"oid": "a80d61126374d61ef72038ee104787a3629bda03", "url": "https://github.com/b2ihealthcare/snow-owl/commit/a80d61126374d61ef72038ee104787a3629bda03", "message": "[core] move compare related classes to core.compare package", "committedDate": "2020-03-21T19:04:41Z", "type": "commit"}, {"oid": "6de43e2761e47a76d15b7002ff8f01633526edf4", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6de43e2761e47a76d15b7002ff8f01633526edf4", "message": "[core] move branch request classes to core.branch package...\n\n...and review request classes to core.review package", "committedDate": "2020-03-21T19:08:00Z", "type": "commit"}, {"oid": "a9ac0192e7d82e48cb80a785b931f260a939a054", "url": "https://github.com/b2ihealthcare/snow-owl/commit/a9ac0192e7d82e48cb80a785b931f260a939a054", "message": "[core] move datastore.review classes to core.review package", "committedDate": "2020-03-21T19:09:52Z", "type": "commit"}, {"oid": "8a8078f7ee09e127ec2ef170b781778bfb68f9bf", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8a8078f7ee09e127ec2ef170b781778bfb68f9bf", "message": "[core] move datastore.request classes to core.request package", "committedDate": "2020-03-21T19:15:53Z", "type": "commit"}, {"oid": "7ddb3614f330e0ea536287106d3fcd28f3ea95d2", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7ddb3614f330e0ea536287106d3fcd28f3ea95d2", "message": "[core] move datastore.repository and datastore.system to...\n\n...core.repository and core.system", "committedDate": "2020-03-21T19:18:24Z", "type": "commit"}, {"oid": "dc6dfcf255497cfb6b7446bb207ebb5e46e389e7", "url": "https://github.com/b2ihealthcare/snow-owl/commit/dc6dfcf255497cfb6b7446bb207ebb5e46e389e7", "message": "[core] move datastore.file to core.attachments\n\nAlso, move datastore.index to core.repository", "committedDate": "2020-03-21T19:20:04Z", "type": "commit"}, {"oid": "47303ee20c3272fa87c7bf1bc2b9bfcdab5c0cf0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/47303ee20c3272fa87c7bf1bc2b9bfcdab5c0cf0", "message": "[core] remove unused classes", "committedDate": "2020-03-21T19:21:10Z", "type": "commit"}, {"oid": "5ee02f3f6d1576ca6fa6e8dbe6a27ff17be3b57e", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5ee02f3f6d1576ca6fa6e8dbe6a27ff17be3b57e", "message": "[core] move codesystem and codesystem version related classes to...\n\ncore.codesystem and core.codesystem.version", "committedDate": "2020-03-21T19:23:42Z", "type": "commit"}, {"oid": "7bfb607e3ce150d8effb0fda750b77bf17ca565a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7bfb607e3ce150d8effb0fda750b77bf17ca565a", "message": "[core] move job related classes to core.jobs", "committedDate": "2020-03-21T19:24:59Z", "type": "commit"}, {"oid": "9e5e73f5e7bc811cf2f8e22898b166313efbf862", "url": "https://github.com/b2ihealthcare/snow-owl/commit/9e5e73f5e7bc811cf2f8e22898b166313efbf862", "message": "[core] move OsPropertyTester to snowowl.core", "committedDate": "2020-03-21T19:28:33Z", "type": "commit"}, {"oid": "0c52e574d7e32490a68036c458544364380acd14", "url": "https://github.com/b2ihealthcare/snow-owl/commit/0c52e574d7e32490a68036c458544364380acd14", "message": "[core] organize imports, fix moved class references, export packages", "committedDate": "2020-03-21T19:39:20Z", "type": "commit"}, {"oid": "52ea2328ecaf410d4c88ef3c5301dc68646de3ec", "url": "https://github.com/b2ihealthcare/snow-owl/commit/52ea2328ecaf410d4c88ef3c5301dc68646de3ec", "message": "[core] move content availability info provider to core.repository", "committedDate": "2020-03-21T19:43:44Z", "type": "commit"}, {"oid": "132125084355b527495187621977da1dd3bdb481", "url": "https://github.com/b2ihealthcare/snow-owl/commit/132125084355b527495187621977da1dd3bdb481", "message": "[core] remove snowowl.datastore plugin", "committedDate": "2020-03-21T22:41:24Z", "type": "commit"}, {"oid": "40ac48f34b8b19cb1e80fdb9664235bc6b8272ff", "url": "https://github.com/b2ihealthcare/snow-owl/commit/40ac48f34b8b19cb1e80fdb9664235bc6b8272ff", "message": "[core] use FunctionalInterface for ContentAvailabilityInfoProvider", "committedDate": "2020-03-21T22:41:39Z", "type": "commit"}, {"oid": "bd7bc6de686bd00bd8bc8b1c8fbfc4b6533dec73", "url": "https://github.com/b2ihealthcare/snow-owl/commit/bd7bc6de686bd00bd8bc8b1c8fbfc4b6533dec73", "message": "[core] depend on snowowl.core instead of datastore", "committedDate": "2020-03-21T22:42:00Z", "type": "commit"}, {"oid": "7a2a821531f1882758aea6a84288494dbe9c0a9f", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7a2a821531f1882758aea6a84288494dbe9c0a9f", "message": "[core] merge datastore.server.tests into core.tests", "committedDate": "2020-03-21T22:48:26Z", "type": "commit"}, {"oid": "36f917c1565241288f8e38d581c7cad80fbd5cc7", "url": "https://github.com/b2ihealthcare/snow-owl/commit/36f917c1565241288f8e38d581c7cad80fbd5cc7", "message": "[core] merge scripting.api and scripting.groovy into snowowl.core", "committedDate": "2020-03-21T22:54:54Z", "type": "commit"}, {"oid": "5d4527e07dcf5bcfce664aa32a8e8c9e8160488a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5d4527e07dcf5bcfce664aa32a8e8c9e8160488a", "message": "[core] remove leftover identity project files", "committedDate": "2020-03-21T22:55:41Z", "type": "commit"}, {"oid": "d7d4f5a79f6537d68b8aa59c803a763b67f9beb1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d7d4f5a79f6537d68b8aa59c803a763b67f9beb1", "message": "[core] remove bundles from server.core.feature", "committedDate": "2020-03-21T22:56:14Z", "type": "commit"}, {"oid": "8078bca89b5c1ee94a56f769b7eb04d622ad02ca", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8078bca89b5c1ee94a56f769b7eb04d622ad02ca", "message": "SO-3948: move import config validation into SnomedRf2ImportRequest", "committedDate": "2020-03-21T23:02:09Z", "type": "commit"}, {"oid": "1f553640a5b4774aa24913f1b381192f51c4aa2c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/1f553640a5b4774aa24913f1b381192f51c4aa2c", "message": "SO-3948: remove datastore from core aggregator pom.xml", "committedDate": "2020-03-22T11:01:29Z", "type": "commit"}, {"oid": "fbca7aabf485f25153cf74c8f528197e4970c2b3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fbca7aabf485f25153cf74c8f528197e4970c2b3", "message": "SO-3948: fix snomed.core.feature dependencies\n\nRemove scripting.groovy reference from validation.snomed module", "committedDate": "2020-03-22T11:29:11Z", "type": "commit"}, {"oid": "6e40f445428102d31db1e3d7a025171a1ee2787c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6e40f445428102d31db1e3d7a025171a1ee2787c", "message": "SO-3948: support CodeSystem lookup from a reference branch\n\nUseful in import/export APIs where you need to create versions during\nthe import for the closest CodeSystem compared to the target branch.", "committedDate": "2020-03-22T12:08:08Z", "type": "commit"}, {"oid": "7516599a7f094fc42b0f6d21c8fbdd953e141c32", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7516599a7f094fc42b0f6d21c8fbdd953e141c32", "message": "SO-3948: remove unused XML dependencies from core.rest module", "committedDate": "2020-03-22T12:14:36Z", "type": "commit"}, {"oid": "7b048509565b34456e3a68c72154e62386d5179c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7b048509565b34456e3a68c72154e62386d5179c", "message": "SO-3948: update launch configurations", "committedDate": "2020-03-22T12:14:44Z", "type": "commit"}, {"oid": "fa5b7de7afdaf755f7b7c7237de81dbfd0735e8d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fa5b7de7afdaf755f7b7c7237de81dbfd0735e8d", "message": "SO-3948: use class path scanning for ScriptEngine registry init", "committedDate": "2020-03-22T12:54:56Z", "type": "commit"}, {"oid": "24c7f71de260ed3a924f3a709d19577874e6cc27", "url": "https://github.com/b2ihealthcare/snow-owl/commit/24c7f71de260ed3a924f3a709d19577874e6cc27", "message": "SO-3948: use class path scanning for validation issue detail extension..\n\n...registry init", "committedDate": "2020-03-22T12:55:24Z", "type": "commit"}, {"oid": "8b6a111e494424ef0cec97bd61f27133936580be", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8b6a111e494424ef0cec97bd61f27133936580be", "message": "SO-3948: remove invalid module references from dist project", "committedDate": "2020-03-22T13:57:15Z", "type": "commit"}, {"oid": "5d7b5d4c1d7a47e8d013e4da7f5f4db5d41cf8b5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5d7b5d4c1d7a47e8d013e4da7f5f4db5d41cf8b5", "message": "SO-3948: support runaAsJob in AsyncRequest\n\nThis allows API clients to run any request as a job easily without much\nboilerplate code.\nExample that imports RF2 as a job using the RF2 Import Request API.\n```\n  SnomedRequests.rf2().prepareImport()\n\t\t.setRf2ArchiveId(rf2ArchiveId)\n\t\t.setReleaseType(Rf2ReleaseType.FULL)\n\t\t.setCreateVersions(true)\n\t\t.build(\"SNOMEDCT/HEAD\")\n\t\t.runAsJob(importJobId, \"Importing SNOMED CT RF2 file\")\n\t\t.execute(bus)\n\t\t.getSync(1, TimeUnit.MINUTES);\n```", "committedDate": "2020-03-22T19:52:22Z", "type": "commit"}, {"oid": "d24075c247e0c06063b90469ebbb1a1da2b0ff60", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d24075c247e0c06063b90469ebbb1a1da2b0ff60", "message": "SO-3948: extract SHA-1 ID generation from a unique source value to IDs", "committedDate": "2020-03-22T19:52:59Z", "type": "commit"}, {"oid": "7e48443933f0e437ae48c0a10ec21df974e26b87", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7e48443933f0e437ae48c0a10ec21df974e26b87", "message": "SO-3948: add CodeSystemURI.head() helper method", "committedDate": "2020-03-22T19:53:31Z", "type": "commit"}, {"oid": "d76d4015c7e72ababfbeb5eecf9a71e1e9eaf40a", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d76d4015c7e72ababfbeb5eecf9a71e1e9eaf40a", "message": "SO-3948: add deprecation notice to old RF2 import configuration object", "committedDate": "2020-03-22T19:54:01Z", "type": "commit"}, {"oid": "aea55f5dbdde8cff1f9ed4a950dd30e17ad67713", "url": "https://github.com/b2ihealthcare/snow-owl/commit/aea55f5dbdde8cff1f9ed4a950dd30e17ad67713", "message": "SO-3948: add rf2ArchiveId, type and createVersions to JSON rep...\n\n...of SnomedRf2ImportRequest", "committedDate": "2020-03-22T19:54:48Z", "type": "commit"}, {"oid": "38637f03d14e8fe377fbd346790fd15b1c60fc34", "url": "https://github.com/b2ihealthcare/snow-owl/commit/38637f03d14e8fe377fbd346790fd15b1c60fc34", "message": "SO-3948: add new /:path/import endpoints\n\nUse new endpoint in all current RF2 import test cases.", "committedDate": "2020-03-22T19:59:21Z", "type": "commit"}, {"oid": "661ae848627aee3fd824fbb6c60aa8d279699836", "url": "https://github.com/b2ihealthcare/snow-owl/commit/661ae848627aee3fd824fbb6c60aa8d279699836", "message": "SO-3948: add new exception handlers to ControllerExceptionMapper\n\nUse RestControllerAdvice to remove ResponseBody annotation from return\ntypes.\nAdd MultipartException handler.\nAdd HttpRequestMethodNotSupportedException handler.", "committedDate": "2020-03-23T10:37:10Z", "type": "commit"}, {"oid": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d2f7658ef8c3c1075e8e549940b7819ea21feab4", "message": "SO-3948: fix failed RF2 import API test cases", "committedDate": "2020-03-23T10:37:42Z", "type": "commit"}, {"oid": "b12edb30903e72499feb1eedd5c65c271098a3e4", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b12edb30903e72499feb1eedd5c65c271098a3e4", "message": "SO-3948: export core.scripts package", "committedDate": "2020-03-23T14:40:52Z", "type": "commit"}, {"oid": "67eeb2e1e9241717ba1eed427742f4b752fa62bb", "url": "https://github.com/b2ihealthcare/snow-owl/commit/67eeb2e1e9241717ba1eed427742f4b752fa62bb", "message": "SO-3948: remove unused includePreReleaseContent from exporter fragments", "committedDate": "2020-03-23T14:41:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3MDA1MA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396470050", "bodyText": "This class (ConceptChangesGetRequestBuilder) is the only one in its package that hasn't been renamed to include a Review prefix and match the request class name.\nPlease rename it to ReviewGetConceptChangesRequestBuilder for consistency! \ud83d\ude42", "author": "apeteri", "createdAt": "2020-03-23T13:58:04Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ConceptChangesGetRequestBuilder.java", "diffHunk": "@@ -34,7 +33,7 @@\n \t\n \t@Override\n \tprotected Request<RepositoryContext, ConceptChanges> doBuild() {\n-\t\treturn new ReadConceptChangesRequest(reviewId);\t\n+\t\treturn new ReviewGetConceptChangesRequest(reviewId);\t", "originalCommit": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2MDQ3Nw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396560477", "bodyText": "It was on my TODO list, but forgot to do it, thanks for reminding me. \ud83d\ude05", "author": "cmark", "createdAt": "2020-03-23T15:57:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3MDA1MA=="}], "type": "inlineReview", "revised_code": {"commit": "a46ba4ce625f49528e247bb14d520c5074230d3d", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ConceptChangesGetRequestBuilder.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ReviewGetConceptChangesRequestBuilder.java\nsimilarity index 81%\nrename from core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ConceptChangesGetRequestBuilder.java\nrename to core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ReviewGetConceptChangesRequestBuilder.java\nindex 8b73490db9..d263cb872b 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ConceptChangesGetRequestBuilder.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/branch/review/ReviewGetConceptChangesRequestBuilder.java\n\n@@ -23,11 +23,11 @@ import com.b2international.snowowl.core.request.RepositoryRequestBuilder;\n /**\n  * @since 5.0\n  */\n-public final class ConceptChangesGetRequestBuilder extends BaseRequestBuilder<ConceptChangesGetRequestBuilder, RepositoryContext, ConceptChanges> implements RepositoryRequestBuilder<ConceptChanges> {\n+public final class ReviewGetConceptChangesRequestBuilder extends BaseRequestBuilder<ReviewGetConceptChangesRequestBuilder, RepositoryContext, ConceptChanges> implements RepositoryRequestBuilder<ConceptChanges> {\n \n \tprivate final String reviewId;\n \n-\tConceptChangesGetRequestBuilder(String reviewId) {\n+\tReviewGetConceptChangesRequestBuilder(String reviewId) {\n \t\tthis.reviewId = reviewId;\n \t}\n \t\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ3ODc3Mg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396478772", "bodyText": "Please indicate in the method name that it is going to be shorter than a regular SHA-1 hash.", "author": "apeteri", "createdAt": "2020-03-23T14:10:43Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/id/IDs.java", "diffHunk": "@@ -17,20 +17,35 @@\n \n import org.elasticsearch.common.UUIDs;\n \n+import com.google.common.base.Charsets;\n+import com.google.common.hash.Hashing;\n+\n /**\n- * Class to use to generate decentralized random UUIDs. \n+ * Class to use to generate decentralized random UUIDs.\n  * \n  * @since 7.3\n  */\n public class IDs {\n \n \t/**\n-\t * Generates a time-based UUID (similar to Flake IDs), which is preferred when generating an ID to be indexed into a Lucene index as primary key. \n+\t * Generates a time-based UUID (similar to Flake IDs), which is preferred when generating an ID to be indexed into a Lucene index as primary key.\n+\t * \n \t * @return\n \t * @see UUIDs\n \t */\n \tpublic static final String base64UUID() {\n \t\treturn UUIDs.base64UUID();\n \t}\n-\t\n+\n+\t/**\n+\t * Create an SHA-1 hash digest from the given value and returns the first seven characters. Similar to how Git creates a unique shortened SHA-1\n+\t * commit for Git commits, this can be useful for ID generation in certain scenarios.\n+\t * \n+\t * @param value\n+\t * @return\n+\t */\n+\tpublic static String sha1(String value) {", "originalCommit": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5647979259c519aa67f8ab1def87b3910f23627c", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/id/IDs.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/id/IDs.java\nindex e145c89677..6650dd658a 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/id/IDs.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/id/IDs.java\n\n@@ -38,14 +38,24 @@ public class IDs {\n \t}\n \n \t/**\n-\t * Create an SHA-1 hash digest from the given value and returns the first seven characters. Similar to how Git creates a unique shortened SHA-1\n+\t * Create an SHA-1 hash digest from the given value and returns the first N characters. Similar to how Git creates a unique shortened SHA-1\n \t * commit for Git commits, this can be useful for ID generation in certain scenarios.\n \t * \n \t * @param value\n \t * @return\n \t */\n+\tpublic static String shortSha1(String value, int length) {\n+\t\treturn sha1(value).substring(0, length);\n+\t}\n+\t\n+\t/**\n+\t * Create an SHA-1 hash digest from the given value and returns it.\n+\t * \n+\t * @param value\n+\t * @return\n+\t */\n \tpublic static String sha1(String value) {\n-\t\treturn Hashing.sha1().hashString(value, Charsets.UTF_8).toString().substring(0, 7);\n+\t\treturn Hashing.sha1().hashString(value, Charsets.UTF_8).toString();\n \t}\n \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUyMDQ0NA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396520444", "bodyText": "Can we wait for the results here? What is the currently configured timeout value?", "author": "apeteri", "createdAt": "2020-03-23T15:05:52Z", "path": "snomed/com.b2international.snowowl.snomed.core.rest/src/com/b2international/snowowl/snomed/core/rest/SnomedRf2ExportRestService.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright 2020 B2i Healthcare Pte Ltd, http://b2i.sg\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.b2international.snowowl.snomed.core.rest;\n+\n+import java.io.File;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.io.FileSystemResource;\n+import org.springframework.core.io.Resource;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.PathVariable;\n+import org.springframework.web.bind.annotation.RequestHeader;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.ResponseBody;\n+\n+import com.b2international.snowowl.core.ApplicationContext;\n+import com.b2international.snowowl.core.attachments.AttachmentRegistry;\n+import com.b2international.snowowl.core.attachments.InternalAttachmentRegistry;\n+import com.b2international.snowowl.core.domain.ExportResult;\n+import com.b2international.snowowl.snomed.core.domain.Rf2RefSetExportLayout;\n+import com.b2international.snowowl.snomed.core.rest.domain.SnomedRf2ExportConfiguration;\n+import com.b2international.snowowl.snomed.datastore.config.SnomedCoreConfiguration;\n+import com.b2international.snowowl.snomed.datastore.request.SnomedRequests;\n+\n+import io.swagger.annotations.Api;\n+import io.swagger.annotations.ApiOperation;\n+import io.swagger.annotations.ApiParam;\n+import io.swagger.annotations.ApiResponse;\n+import io.swagger.annotations.ApiResponses;\n+\n+/**\n+ * @since 7.5\n+ */\n+@Api(value = \"Export\", description=\"Export\", tags = \"export\")\n+@Controller\n+@RequestMapping(value=\"/{path:**}/export\")\n+public class SnomedRf2ExportRestService extends AbstractSnomedRestService {\n+\n+\t@Autowired\n+\tprivate AttachmentRegistry attachments;\n+\t\n+\t@ApiOperation(\n+\t\tvalue=\"Export SNOMED CT content to RF2\", \n+\t\tnotes=\"Exports SNOMED CT content from the given branch to RF2.\"\n+\t)\n+\t@ApiResponses({\n+\t\t@ApiResponse(code=200, message=\"OK\")\n+\t})\n+\t@GetMapping\n+\tpublic @ResponseBody ResponseEntity<?> export(\n+\t\t\t@ApiParam(value = \"The branch path\", required = true)\n+\t\t\t@PathVariable(value=\"path\")\n+\t\t\tfinal String branch,\n+\n+\t\t\tfinal SnomedRf2ExportConfiguration params,\n+\t\t\t\n+\t\t\t@ApiParam(value = \"Accepted language tags, in order of preference\")\n+\t\t\t@RequestHeader(value=HttpHeaders.ACCEPT_LANGUAGE, defaultValue=\"en-US;q=0.8,en-GB;q=0.6\", required=false) \n+\t\t\tfinal String acceptLanguage) {\n+\t\t\n+\t\tfinal Rf2RefSetExportLayout globalExportLayout = ApplicationContext.getServiceForClass(SnomedCoreConfiguration.class).getExport().getRefSetExportLayout();\n+\t\t\n+\t\tfinal ExportResult exportedFile = SnomedRequests.rf2().prepareExport()\n+\t\t\t.setReleaseType(params.getType())\n+\t\t\t.setExtensionOnly(params.isExtensionOnly())\n+\t\t\t.setLocales(acceptLanguage)\n+\t\t\t.setIncludePreReleaseContent(params.isIncludeUnpublished())\n+\t\t\t.setModules(params.getModuleIds())\n+\t\t\t.setRefSets(params.getRefSetIds())\n+\t\t\t.setCountryNamespaceElement(params.getNamespaceId())\n+\t\t\t// .setNamespaceFilter(namespaceFilter) is not supported on REST, yet\n+\t\t\t.setTransientEffectiveTime(params.getTransientEffectiveTime())\n+\t\t\t.setStartEffectiveTime(params.getStartEffectiveTime())\n+\t\t\t.setEndEffectiveTime(params.getEndEffectiveTime())\n+\t\t\t.setRefSetExportLayout(params.getRefSetLayout() == null ? globalExportLayout : params.getRefSetLayout())\n+\t\t\t.build(this.repositoryId, branch)\n+\t\t\t.execute(getBus())\n+\t\t\t.getSync();", "originalCommit": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2NTYxNA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396565614", "bodyText": "No timeout value at the moment, we wait indefinitely.\nWe can best guess a proper timeout value based on the selected export configuration, but not sure if that's a good idea. Not sure if we can convert this to an async method either, my guess is that Spring needs the HTTP thread to finish the file download work.", "author": "cmark", "createdAt": "2020-03-23T16:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUyMDQ0NA=="}], "type": "inlineReview", "revised_code": {"commit": "88308ec6ea61f87d22e96850ecc1c5b16fc85750", "chunk": "diff --git a/snomed/com.b2international.snowowl.snomed.core.rest/src/com/b2international/snowowl/snomed/core/rest/SnomedRf2ExportRestService.java b/snomed/com.b2international.snowowl.snomed.core.rest/src/com/b2international/snowowl/snomed/core/rest/SnomedRf2ExportRestService.java\nindex da2ca07629..2d6f491ac3 100644\n--- a/snomed/com.b2international.snowowl.snomed.core.rest/src/com/b2international/snowowl/snomed/core/rest/SnomedRf2ExportRestService.java\n+++ b/snomed/com.b2international.snowowl.snomed.core.rest/src/com/b2international/snowowl/snomed/core/rest/SnomedRf2ExportRestService.java\n\n@@ -36,6 +36,7 @@ import com.b2international.snowowl.core.attachments.AttachmentRegistry;\n import com.b2international.snowowl.core.attachments.InternalAttachmentRegistry;\n import com.b2international.snowowl.core.domain.ExportResult;\n import com.b2international.snowowl.snomed.core.domain.Rf2RefSetExportLayout;\n+import com.b2international.snowowl.snomed.core.domain.Rf2ReleaseType;\n import com.b2international.snowowl.snomed.core.rest.domain.SnomedRf2ExportConfiguration;\n import com.b2international.snowowl.snomed.datastore.config.SnomedCoreConfiguration;\n import com.b2international.snowowl.snomed.datastore.request.SnomedRequests;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNzAxMQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396537011", "bodyText": "Please move parsing to SnomedRf2ExportRequestBuilder#doBuild, if possible, so that we know that all parameters are valid by the time the request starts.", "author": "apeteri", "createdAt": "2020-03-23T15:27:30Z", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java", "diffHunk": "@@ -286,8 +262,8 @@ public ExportResult execute(final RepositoryContext context) {\n \n \t\t\tfinal Set<String> visitedComponentEffectiveTimes = newHashSet();\n \t\t\t\n-\t\t\tfinal long effectiveTimeStart = startEffectiveTime != null ? startEffectiveTime.getTime() : 0;\n-\t\t\tfinal long effectiveTimeEnd =  endEffectiveTime != null ? endEffectiveTime.getTime() : Long.MAX_VALUE;\n+\t\t\tfinal long effectiveTimeStart = startEffectiveTime != null ? EffectiveTimes.getEffectiveTime(startEffectiveTime, DateFormats.SHORT) : 0;", "originalCommit": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU2NzIzNA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396567234", "bodyText": "Good idea! \ud83d\udc4d", "author": "cmark", "createdAt": "2020-03-23T16:05:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNzAxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "6723a3b0f3aca4d538183a7636418ef787563513", "chunk": "diff --git a/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java b/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java\nindex 74bedc1d8a..f046f4eaf8 100644\n--- a/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java\n+++ b/snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/SnomedRf2ExportRequest.java\n\n@@ -262,8 +262,8 @@ final class SnomedRf2ExportRequest extends ResourceRequest<BranchContext, Export\n \n \t\t\tfinal Set<String> visitedComponentEffectiveTimes = newHashSet();\n \t\t\t\n-\t\t\tfinal long effectiveTimeStart = startEffectiveTime != null ? EffectiveTimes.getEffectiveTime(startEffectiveTime, DateFormats.SHORT) : 0;\n-\t\t\tfinal long effectiveTimeEnd =  endEffectiveTime != null ? EffectiveTimes.getEffectiveTime(endEffectiveTime, DateFormats.SHORT) : Long.MAX_VALUE;\n+\t\t\tfinal long effectiveTimeStart = startEffectiveTime != null ? startEffectiveTime : 0;\n+\t\t\tfinal long effectiveTimeEnd =  endEffectiveTime != null ? endEffectiveTime : Long.MAX_VALUE;\n \n \t\t\t// export content from the pre-computed version branches\n \t\t\tfor (String branch : branchesToExport) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU0NzQ3MQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396547471", "bodyText": "Consider wrapping this part in a try-catch block (although not sure if we want to move forward with an import that has desynced from the CIS).", "author": "apeteri", "createdAt": "2020-03-23T15:40:53Z", "path": "snomed/com.b2international.snowowl.snomed.datastore/src/com/b2international/snowowl/snomed/datastore/request/rf2/importer/Rf2TransactionContext.java", "diffHunk": "@@ -111,25 +111,32 @@ public void clearContents() {\n \t\n \t@Override\n \tpublic long commit() {\n-\t\tthrow new UnsupportedOperationException(\"TODO implement me\");\n+\t\tthrow new UnsupportedOperationException(\"Use the single supported commit(String) method\");\n \t}\n \t\n \t@Override\n-\tpublic long commit(String userId, String commitComment, String parentContextDescription) {\n+\tpublic long commit(String commitComment) {\n \t\tfinal Set<String> idsToRegister = ImmutableSet.copyOf(newComponents.keySet().stream().filter(SnomedIdentifiers::isValid).iterator());\n-\t\ttry {\n-\t\t\t// clear local cache before executing commit\n-\t\t\tnewComponents = newHashMap();\n-\t\t\tLOG.info(\"Pushing changes: {}\", commitComment);\n-\t\t\tlong timestamp = getDelegate().commit(userId, commitComment, parentContextDescription);\n-\t\t\t// after successful commit register all commited IDs to CIS\n-\t\t\tfinal ISnomedIdentifierService cis = service(ISnomedIdentifierService.class);\n-\t\t\tif (cis.importSupported()) {\n-\t\t\t\tcis.register(idsToRegister);\n-\t\t\t}\n-\t\t\treturn timestamp;\n-\t\t} finally {\n+\t\t// clear local cache before executing commit\n+\t\tnewComponents = newHashMap();\n+\t\tLOG.info(\"Pushing changes: {}\", commitComment);\n+\t\tlong timestamp = getDelegate().commit(commitComment);\n+\t\t// after successful commit register all commited IDs to CIS\n+\t\tfinal ISnomedIdentifierService cis = service(ISnomedIdentifierService.class);\n+\t\tif (cis.importSupported()) {\n+\t\t\tcis.register(idsToRegister);", "originalCommit": "d2f7658ef8c3c1075e8e549940b7819ea21feab4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU3OTY1NA==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/517#discussion_r396579654", "bodyText": "Well, yeah, that's something that should not happen, otherwise duplicate content will start appearing and that's always a bad sign. The CIS registration logic has been simplified greatly to allow as much ID as possible in, so I think we are safe for now. \ud83d\ude04", "author": "cmark", "createdAt": "2020-03-23T16:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU0NzQ3MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "a46ba4ce625f49528e247bb14d520c5074230d3d", "url": "https://github.com/b2ihealthcare/snow-owl/commit/a46ba4ce625f49528e247bb14d520c5074230d3d", "message": "SO-3948: rename ConceptChangesGetRequestBuilder to...\n\n...ReviewGetConceptChangesRequestBuilder", "committedDate": "2020-03-23T15:58:05Z", "type": "commit"}, {"oid": "6723a3b0f3aca4d538183a7636418ef787563513", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6723a3b0f3aca4d538183a7636418ef787563513", "message": "SO-3948: convert start/end effective times during request build time", "committedDate": "2020-03-23T16:19:05Z", "type": "commit"}, {"oid": "5647979259c519aa67f8ab1def87b3910f23627c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5647979259c519aa67f8ab1def87b3910f23627c", "message": "SO-3948: use dedicated method for short SHA-1 generation\n\nAlso add a full SHA-1 hash method to IDs.", "committedDate": "2020-03-23T17:19:16Z", "type": "commit"}, {"oid": "cd801027dc2d4d091aec0cfcbb4bf460d741a664", "url": "https://github.com/b2ihealthcare/snow-owl/commit/cd801027dc2d4d091aec0cfcbb4bf460d741a664", "message": "SO-3948: convert start/end effective times during request build time...\n\n...(missing bits)", "committedDate": "2020-03-23T17:19:53Z", "type": "commit"}, {"oid": "7cbc082ae7149e17b88486963402d163b377b806", "url": "https://github.com/b2ihealthcare/snow-owl/commit/7cbc082ae7149e17b88486963402d163b377b806", "message": "SO-3948: convert jobId to jobKey\n\nSupplied id is no longer acts as a unique key, but as a basis to\ngenerate the unique SHA-1 key of a remote job.\nThis will ensure that the unique key of the job is URL safe and can be\nreturned safely from REST API endpoints.\nAdd filterByKey/filterByKeys method to SearchJobRequestBuilder.\nSupport 'restart' option in ScheduleJobRequests. With this option the\ncaller can restart (replace in fact) an already\ncompleted/failed/canceled job with the same key easily (will eliminate a\nlot of boilerplate code around clients).", "committedDate": "2020-03-23T20:50:40Z", "type": "commit"}, {"oid": "8c3271f0566994d34df7e356932a44f580ae9df1", "url": "https://github.com/b2ihealthcare/snow-owl/commit/8c3271f0566994d34df7e356932a44f580ae9df1", "message": "SO-3948: migrate classification services to new job keys", "committedDate": "2020-03-23T20:51:11Z", "type": "commit"}, {"oid": "5f483b6b28aefe1e7dc29d348a281c904c5f0ad5", "url": "https://github.com/b2ihealthcare/snow-owl/commit/5f483b6b28aefe1e7dc29d348a281c904c5f0ad5", "message": "SO-3948: migrate SNOMED CT APIs to new job keys", "committedDate": "2020-03-23T20:51:49Z", "type": "commit"}, {"oid": "b1c3e59c8bdb11d52336004fb2c9760a5382a0a7", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b1c3e59c8bdb11d52336004fb2c9760a5382a0a7", "message": "SO-3948: migrate validation APIs to new job keys\n\nAlso, move validation endpoints to `/snomed-ct/v3` where they actually\nbelong.", "committedDate": "2020-03-23T20:52:14Z", "type": "commit"}, {"oid": "e7dbc757cbfb3c7683d8d705b3d256aa167e8b3c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e7dbc757cbfb3c7683d8d705b3d256aa167e8b3c", "message": "SO-3948: fix incorrect job ID used in progress monitor init", "committedDate": "2020-03-24T09:37:00Z", "type": "commit"}, {"oid": "3015106e8c5e57fa2e55c8aa8beaf2baf1e570aa", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3015106e8c5e57fa2e55c8aa8beaf2baf1e570aa", "message": "SO-3948: remove feature toggle support\n\nSuperseded by unique job keys and lock objects.\nAdd `optionalService(Class)` method to ServiceProvider.\nAdd `isJobRunning(String)` method to ServiceProvider.", "committedDate": "2020-03-24T10:25:07Z", "type": "commit"}, {"oid": "6d00f05b5e507bfa37a0117a208a0f19d2795dd2", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6d00f05b5e507bfa37a0117a208a0f19d2795dd2", "message": "SO-3948: support optionalService method in DelegatingContext...\n\n...and not in all current ServiceProvider implementations", "committedDate": "2020-03-24T10:46:36Z", "type": "commit"}, {"oid": "88308ec6ea61f87d22e96850ecc1c5b16fc85750", "url": "https://github.com/b2ihealthcare/snow-owl/commit/88308ec6ea61f87d22e96850ecc1c5b16fc85750", "message": "SO-3948: use Strings instead of enums for release type and refset layout", "committedDate": "2020-03-24T11:00:49Z", "type": "commit"}]}