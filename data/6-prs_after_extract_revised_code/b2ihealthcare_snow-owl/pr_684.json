{"pr_number": 684, "pr_title": "SO-4243: Improve automapping lexical search", "pr_createdAt": "2020-10-05T14:49:52Z", "pr_url": "https://github.com/b2ihealthcare/snow-owl/pull/684", "timeline": [{"oid": "fc3730103990a7be1d767c946ebf3273651c924c", "url": "https://github.com/b2ihealthcare/snow-owl/commit/fc3730103990a7be1d767c946ebf3273651c924c", "message": "SO-4243: add minTermMatch field to SearchResourceRequest", "committedDate": "2020-10-02T15:50:55Z", "type": "commit"}, {"oid": "cd7d4c310506053ffb3e85bac5139d6ad98a4545", "url": "https://github.com/b2ihealthcare/snow-owl/commit/cd7d4c310506053ffb3e85bac5139d6ad98a4545", "message": "SO-4243: add expression to filter on any field value", "committedDate": "2020-10-02T15:52:05Z", "type": "commit"}, {"oid": "6e14222eb6aa76b2d527b48b7bc87b5af2506b66", "url": "https://github.com/b2ihealthcare/snow-owl/commit/6e14222eb6aa76b2d527b48b7bc87b5af2506b66", "message": "SO-4243: set default minTermMatch to 0", "committedDate": "2020-10-05T07:44:02Z", "type": "commit"}, {"oid": "3551b2af537ea48b12b512955a3fc594a4a3f122", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3551b2af537ea48b12b512955a3fc594a4a3f122", "message": "SO-4243: add fuzzy search option", "committedDate": "2020-10-05T08:08:31Z", "type": "commit"}, {"oid": "d9c5c5cb99166e5e2347fa9ab00936f227f8f3a3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/d9c5c5cb99166e5e2347fa9ab00936f227f8f3a3", "message": "SO-4243: add fuzzy expression to RevisionDocument", "committedDate": "2020-10-05T08:32:34Z", "type": "commit"}, {"oid": "61701bb45bd06c217f8b2274ab5445485b223b07", "url": "https://github.com/b2ihealthcare/snow-owl/commit/61701bb45bd06c217f8b2274ab5445485b223b07", "message": "SO-4243: rename fuzzy -> useFuzzy", "committedDate": "2020-10-05T08:32:50Z", "type": "commit"}, {"oid": "dd58880887a0d87aa9ddb709b55adc4405fae81e", "url": "https://github.com/b2ihealthcare/snow-owl/commit/dd58880887a0d87aa9ddb709b55adc4405fae81e", "message": "SO-4243: Add fuzzy option to ConceptSearchRequest", "committedDate": "2020-10-05T09:08:39Z", "type": "commit"}, {"oid": "e23078331b9203ce21023d9193066ac8418a3c20", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e23078331b9203ce21023d9193066ac8418a3c20", "message": "SO-4243: Add default method to process term filters", "committedDate": "2020-10-05T09:30:30Z", "type": "commit"}, {"oid": "e415e9774426929fa3296f917d294e0fdc6cb6d0", "url": "https://github.com/b2ihealthcare/snow-owl/commit/e415e9774426929fa3296f917d294e0fdc6cb6d0", "message": "SO-4243: Add fuzzy search", "committedDate": "2020-10-05T09:30:46Z", "type": "commit"}, {"oid": "b34b4cfc359e9f71ced4dea72ef18071502c87f8", "url": "https://github.com/b2ihealthcare/snow-owl/commit/b34b4cfc359e9f71ced4dea72ef18071502c87f8", "message": "SO-4243: fix getting integer", "committedDate": "2020-10-05T09:33:21Z", "type": "commit"}, {"oid": "2c0238116a6cedeb96a7dbb41f4e3b990990c762", "url": "https://github.com/b2ihealthcare/snow-owl/commit/2c0238116a6cedeb96a7dbb41f4e3b990990c762", "message": "SO-4243: set max_gram to 10", "committedDate": "2020-10-05T13:23:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwNTQxNg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/684#discussion_r502905416", "bodyText": "These are just proxies over the Expressions class static method, they do not add actual value to the RevisionDocument, please remove these and use the Expressions methods directly instead.", "author": "cmark", "createdAt": "2020-10-11T11:52:19Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/repository/RevisionDocument.java", "diffHunk": "@@ -54,6 +56,14 @@ public static Expression idPrefix(String idPrefix) {\n \t\tpublic static Expression idRegex(String idRegex) {\n \t\t\treturn regexp(Fields.ID, idRegex);\n \t\t}\n+\t\t\n+\t\tpublic static Expression anyFieldValuePresent(final String field, final String value, final int minShouldMatch) {", "originalCommit": "2c0238116a6cedeb96a7dbb41f4e3b990990c762", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/repository/RevisionDocument.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/repository/RevisionDocument.java\nindex 2fc5f5327e..53d38a2e75 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/repository/RevisionDocument.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/repository/RevisionDocument.java\n\n@@ -56,14 +54,6 @@ public abstract class RevisionDocument extends Revision implements IComponent<St\n \t\tpublic static Expression idRegex(String idRegex) {\n \t\t\treturn regexp(Fields.ID, idRegex);\n \t\t}\n-\t\t\n-\t\tpublic static Expression anyFieldValuePresent(final String field, final String value, final int minShouldMatch) {\n-\t\t\treturn matchTextAny(field, value, minShouldMatch);\n-\t\t}\n-\n-\t\tpublic static Expression fuzzy(final String field, final String value) {\n-\t\t\treturn matchTextFuzzy(field, value);\n-\t\t}\n \n \t}\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwNTcxNQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/684#discussion_r502905715", "bodyText": "These new fields should be part of the options map instead. The others will be part of the options map later, but for now, please move these new fields inside the option map, you can use a new local OptionKey to access them and provide the same accessors as for the other fields.", "author": "cmark", "createdAt": "2020-10-11T11:55:33Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequest.java", "diffHunk": "@@ -212,10 +212,15 @@ public String toString() {\n \t\n \t@Min(0)\n \tprivate int limit;\n+\t\n+\t@Min(0)\n+\tprivate int minTermMatch;", "originalCommit": "2c0238116a6cedeb96a7dbb41f4e3b990990c762", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequest.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequest.java\nindex b9c2778bd4..282bf1fb43 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequest.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequest.java\n\n@@ -212,15 +222,10 @@ public abstract class SearchResourceRequest<C extends ServiceProvider, B> extend\n \t\n \t@Min(0)\n \tprivate int limit;\n-\t\n-\t@Min(0)\n-\tprivate int minTermMatch;\n \n \t@NotNull\n \tprivate Options options;\n \t\n-\tprivate boolean fuzzy;\n-\t\n \tprotected SearchResourceRequest() {}\n \t\n \t/**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwNTkwMg==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/684#discussion_r502905902", "bodyText": "What does the default value 0 mean? How can I ensure my search does not use this feature? What happens with existing searches that use this generic API?", "author": "cmark", "createdAt": "2020-10-11T11:57:01Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java", "diffHunk": "@@ -42,6 +42,10 @@\n \t\n \tprivate int limit = 50;\n \t\n+\tprivate int minTermMatch = 0;", "originalCommit": "2c0238116a6cedeb96a7dbb41f4e3b990990c762", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzE4MTkzNw==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/684#discussion_r503181937", "bodyText": "Fixed this. To enable the new feature this parameter must be configured.", "author": "kovacstomi", "createdAt": "2020-10-12T09:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkwNTkwMg=="}], "type": "inlineReview", "revised_code": {"commit": "39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\nindex e12499ad54..98526f0272 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\n\n@@ -42,10 +42,6 @@ public abstract class SearchResourceRequestBuilder<B extends SearchResourceReque\n \t\n \tprivate int limit = 50;\n \t\n-\tprivate int minTermMatch = 0;\n-\t\n-\tprivate boolean fuzzy = false;\n-\t\n \tprivate final OptionsBuilder optionsBuilder = OptionsBuilder.newBuilder();\n \t\n \tprotected SearchResourceRequestBuilder() {\n"}}, {"oid": "cb21698394498b51a9bf7367f2b454fac28ff6ad", "url": "https://github.com/b2ihealthcare/snow-owl/commit/cb21698394498b51a9bf7367f2b454fac28ff6ad", "message": "Merge remote-tracking branch 'origin/7.x' into issue/SO-4243-automapping-issue", "committedDate": "2020-10-12T08:36:03Z", "type": "commit"}, {"oid": "39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "url": "https://github.com/b2ihealthcare/snow-owl/commit/39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "message": "SO-4349: fix PR", "committedDate": "2020-10-12T09:54:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU0OTU4OQ==", "url": "https://github.com/b2ihealthcare/snow-owl/pull/684#discussion_r505549589", "bodyText": "Throw a BadRequestException if minTermMatch is less than or equals to 0.", "author": "cmark", "createdAt": "2020-10-15T13:39:07Z", "path": "core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java", "diffHunk": "@@ -151,7 +147,9 @@ public final B one() {\n \t * @return this builder instance\n \t */\n \tpublic final B withMinTermMatch(int minTermMatch) {\n-\t\tthis.minTermMatch = minTermMatch;\n+\t\tif (minTermMatch > 0) {", "originalCommit": "39c1f8d562a6b985427a070d88b5c0f5f327c4d3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "14e6ff1bbcc0fe28e63ac41449bab0a0175667c6", "chunk": "diff --git a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\nindex 98526f0272..9bb37cd83c 100644\n--- a/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\n+++ b/core/com.b2international.snowowl.core/src/com/b2international/snowowl/core/request/SearchResourceRequestBuilder.java\n\n@@ -147,9 +147,10 @@ public abstract class SearchResourceRequestBuilder<B extends SearchResourceReque\n \t * @return this builder instance\n \t */\n \tpublic final B withMinTermMatch(int minTermMatch) {\n-\t\tif (minTermMatch > 0) {\n-\t\t\toptionsBuilder.put(OptionKey.MIN_TERM_MATCH, minTermMatch);\n+\t\tif (minTermMatch <= 0) {\n+\t\t\tthrow new BadRequestException(\"Min number of terms to match should be greater than 0. It was: '%s'.\", minTermMatch);\n \t\t}\n+\t\toptionsBuilder.put(OptionKey.MIN_TERM_MATCH, minTermMatch);\n \t\treturn getSelf();\n \t}\n \t\n"}}, {"oid": "3ee3068c92a837d1d973c99e2d7267e86c137d14", "url": "https://github.com/b2ihealthcare/snow-owl/commit/3ee3068c92a837d1d973c99e2d7267e86c137d14", "message": "[index] store only prefix length of 2->12 from a given word", "committedDate": "2020-10-17T12:26:26Z", "type": "commit"}, {"oid": "14e6ff1bbcc0fe28e63ac41449bab0a0175667c6", "url": "https://github.com/b2ihealthcare/snow-owl/commit/14e6ff1bbcc0fe28e63ac41449bab0a0175667c6", "message": "SO-4243: throw BadRequestException when minTermMatch is less than 1", "committedDate": "2020-10-17T12:29:46Z", "type": "commit"}]}