{"pr_number": 3253, "pr_title": "[STORM-3625] Add topo name validatiion for CLI client before connecting to nimbus", "pr_createdAt": "2020-04-20T14:23:11Z", "pr_url": "https://github.com/apache/storm/pull/3253", "timeline": [{"oid": "acb665b6bb3274d7d27c62e44915a5bd62799e02", "url": "https://github.com/apache/storm/commit/acb665b6bb3274d7d27c62e44915a5bd62799e02", "message": "[STORM-3625] Add topo name validatiion for CLI client before connecting to nimbus", "committedDate": "2020-04-20T14:18:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMzkyOA==", "url": "https://github.com/apache/storm/pull/3253#discussion_r412403928", "bodyText": "This should be treated differently because we have continueOnError option here.", "author": "Ethanlm", "createdAt": "2020-04-21T18:45:15Z", "path": "storm-core/src/jvm/org/apache/storm/command/KillTopology.java", "diffHunk": "@@ -31,6 +32,9 @@ public static void main(String[] args) throws Exception {\n \n         @SuppressWarnings(\"unchecked\")\n         final List<String> names = (List<String>) cl.get(\"TOPO\");\n+        for (String name : names) {", "originalCommit": "acb665b6bb3274d7d27c62e44915a5bd62799e02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA1NzMxMw==", "url": "https://github.com/apache/storm/pull/3253#discussion_r414057313", "bodyText": "Changed the behavior that removing invalid name from the list and throw exception if no valid name is present.\nI think this should has nothing to do with continueOnError  since the topology name is invalid and it makes no sense to proceed.", "author": "RuiLi8080", "createdAt": "2020-04-23T19:15:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQwMzkyOA=="}], "type": "inlineReview", "revised_code": {"commit": "9c4ae44969f472f35f8c365c5f64d7d62b2661d9", "chunk": "diff --git a/storm-core/src/jvm/org/apache/storm/command/KillTopology.java b/storm-core/src/jvm/org/apache/storm/command/KillTopology.java\nindex 1ea56aa02..b081c3db8 100644\n--- a/storm-core/src/jvm/org/apache/storm/command/KillTopology.java\n+++ b/storm-core/src/jvm/org/apache/storm/command/KillTopology.java\n\n@@ -32,8 +33,18 @@ public class KillTopology {\n \n         @SuppressWarnings(\"unchecked\")\n         final List<String> names = (List<String>) cl.get(\"TOPO\");\n-        for (String name : names) {\n-            Utils.validateTopologyName(name);\n+        Iterator<String> iterator = names.iterator();\n+        while (iterator.hasNext()) {\n+            String name = iterator.next();\n+            try {\n+                Utils.validateTopologyName(name);\n+            } catch (IllegalArgumentException e) {\n+                names.remove(name);\n+            }\n+        }\n+\n+        if (names.isEmpty()) {\n+            throw new IllegalArgumentException(\"No valid topology name from your command.\");\n         }\n \n         // Wait this many seconds after deactivating topology before killing\n"}}, {"oid": "9c4ae44969f472f35f8c365c5f64d7d62b2661d9", "url": "https://github.com/apache/storm/commit/9c4ae44969f472f35f8c365c5f64d7d62b2661d9", "message": "address comments", "committedDate": "2020-04-23T18:55:48Z", "type": "forcePushed"}, {"oid": "55023b6a9b74340d76e5ef52fb616b8e3bafdaa3", "url": "https://github.com/apache/storm/commit/55023b6a9b74340d76e5ef52fb616b8e3bafdaa3", "message": "address comments", "committedDate": "2020-04-23T19:02:41Z", "type": "commit"}, {"oid": "55023b6a9b74340d76e5ef52fb616b8e3bafdaa3", "url": "https://github.com/apache/storm/commit/55023b6a9b74340d76e5ef52fb616b8e3bafdaa3", "message": "address comments", "committedDate": "2020-04-23T19:02:41Z", "type": "forcePushed"}, {"oid": "cc9c5f6e433fe8abbe12d51de44a8506d6ef326e", "url": "https://github.com/apache/storm/commit/cc9c5f6e433fe8abbe12d51de44a8506d6ef326e", "message": "address comment", "committedDate": "2020-04-28T03:19:07Z", "type": "commit"}, {"oid": "cc9c5f6e433fe8abbe12d51de44a8506d6ef326e", "url": "https://github.com/apache/storm/commit/cc9c5f6e433fe8abbe12d51de44a8506d6ef326e", "message": "address comment", "committedDate": "2020-04-28T03:19:07Z", "type": "forcePushed"}]}