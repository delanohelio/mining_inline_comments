{"pr_number": 3306, "pr_title": "STORM-3671: Add TopologySummary methods to Nimbus", "pr_createdAt": "2020-07-10T04:40:42Z", "pr_url": "https://github.com/apache/storm/pull/3306", "timeline": [{"oid": "b45ddf14b3759679169162103aef155ccbc42e86", "url": "https://github.com/apache/storm/commit/b45ddf14b3759679169162103aef155ccbc42e86", "message": "MINOR: Avoid fragmented resources on supervisor creation in nimbus (#3271)", "committedDate": "2020-07-10T13:36:05Z", "type": "forcePushed"}, {"oid": "00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "url": "https://github.com/apache/storm/commit/00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "message": "STORM-3671: Add TopologySummary methods to Nimbus", "committedDate": "2020-07-13T17:18:43Z", "type": "commit"}, {"oid": "4a5a3fb8bf289b06614062618cbd619f5a11fd7c", "url": "https://github.com/apache/storm/commit/4a5a3fb8bf289b06614062618cbd619f5a11fd7c", "message": "MINOR: Avoid fragmented resources on supervisor creation in nimbus (#3271)", "committedDate": "2020-07-13T17:19:12Z", "type": "commit"}, {"oid": "a58e447f53327479c29ab881ecd6a8393e4d739d", "url": "https://github.com/apache/storm/commit/a58e447f53327479c29ab881ecd6a8393e4d739d", "message": "STORM-3671: Use getTopologySummary instead of getClusterInfo", "committedDate": "2020-07-13T17:52:33Z", "type": "commit"}, {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "url": "https://github.com/apache/storm/commit/6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "message": "STORM-3671: Add getTopologyInfoByName to Nimbus interface", "committedDate": "2020-07-13T17:52:44Z", "type": "commit"}, {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "url": "https://github.com/apache/storm/commit/6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "message": "STORM-3671: Add getTopologyInfoByName to Nimbus interface", "committedDate": "2020-07-13T17:52:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0OTk5MA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r452949990", "bodyText": "suggest to import java.util.List and then use List directly\nsuggest to change to getTopologySummaries\ncan delete AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-10T16:32:50Z", "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;", "originalCommit": "37929b40d227bdb792f8eb50154c459b1994a80b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\nindex d5dc97029..463cc5a77 100644\n--- a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n+++ b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n\n@@ -137,7 +137,7 @@ public interface ILocalCluster extends AutoCloseable {\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n-    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+    java.util.List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException;\n \n     TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1MDQ4MA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r452950480", "bodyText": "String should be good enough.\ncan delete AuthorizationException, since it extends TException", "author": "Ethanlm", "createdAt": "2020-07-10T16:33:45Z", "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;", "originalCommit": "37929b40d227bdb792f8eb50154c459b1994a80b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\nindex d5dc97029..463cc5a77 100644\n--- a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n+++ b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n\n@@ -137,7 +137,7 @@ public interface ILocalCluster extends AutoCloseable {\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n-    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+    java.util.List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException;\n \n     TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1MDUxNQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r452950515", "bodyText": "String should be good enough.\ncan delete AuthorizationException , since it extends TException", "author": "Ethanlm", "createdAt": "2020-07-10T16:33:49Z", "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryById(java.lang.String id) throws AuthorizationException, TException;", "originalCommit": "37929b40d227bdb792f8eb50154c459b1994a80b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\nindex d5dc97029..463cc5a77 100644\n--- a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n+++ b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n\n@@ -137,7 +137,7 @@ public interface ILocalCluster extends AutoCloseable {\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n-    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+    java.util.List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException;\n \n     TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5NzE3MQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455097171", "bodyText": "I beliefve this is no longer needed, since if getTopologySummaryByName fails, getTopologySummaryByName will throw TException or RuntimeException.\nIf this is not the case, then other places where we invoke getTopologySummaryByName should also deal with the result=null.", "author": "Ethanlm", "createdAt": "2020-07-15T14:30:36Z", "path": "examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java", "diffHunk": "@@ -40,16 +40,11 @@\n public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n-        ClusterSummary summary = client.getClusterInfo();\n-        String id = null;\n-        for (TopologySummary ts : summary.get_topologies()) {\n-            if (name.equals(ts.get_name())) {\n-                id = ts.get_id();\n-            }\n-        }\n-        if (id == null) {\n+        TopologySummary ts = client.getTopologySummaryByName(name);\n+        if (ts == null) {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "chunk": "diff --git a/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java b/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\nindex 3b9575518..9c4a8e592 100644\n--- a/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\n+++ b/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\n\n@@ -41,9 +41,6 @@ public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n         TopologySummary ts = client.getTopologySummaryByName(name);\n-        if (ts == null) {\n-            throw new Exception(\"Could not find a topology named \" + name);\n-        }\n         String id = ts.get_id();\n         TopologyInfo info = client.getTopologyInfo(id);\n         int uptime = info.get_uptime_secs();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5NzYyNA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455097624", "bodyText": "This doesn't look right.", "author": "Ethanlm", "createdAt": "2020-07-15T14:31:06Z", "path": "integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java", "diffHunk": "@@ -108,7 +108,7 @@ public TopologySummary getOneActive() throws TException {\n     }\n \n     public TopologyInfo getInfo(TopologySummary topologySummary) throws TException {\n-        return client.getTopologyInfo(topologySummary.get_id());\n+        return client.getTopologyInfoByName(topologySummary.get_id());", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA3NzgzNQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r456077835", "bodyText": "fixing.", "author": "kishorvpatil", "createdAt": "2020-07-16T21:06:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5NzYyNA=="}], "type": "inlineReview", "revised_code": {"commit": "5f76f6f1cfd1f656499026752f9f88554351c3fd", "chunk": "diff --git a/integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java b/integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java\nindex d8652ecc8..716c37dd0 100644\n--- a/integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java\n+++ b/integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java\n\n@@ -108,7 +108,7 @@ public class StormCluster {\n     }\n \n     public TopologyInfo getInfo(TopologySummary topologySummary) throws TException {\n-        return client.getTopologyInfoByName(topologySummary.get_id());\n+        return client.getTopologyInfo(topologySummary.get_id());\n     }\n \n     public Nimbus.Iface getNimbusClient() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNDU3Nw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455114577", "bodyText": "Will topologyInfo ever be null?", "author": "Ethanlm", "createdAt": "2020-07-15T14:53:05Z", "path": "storm-core/src/jvm/org/apache/storm/command/GetErrors.java", "diffHunk": "@@ -42,15 +42,10 @@ public static void main(String[] args) throws Exception {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                String topologyId = Utils.getTopologyId(name, client);\n-\n-                TopologyInfo topologyInfo = null;\n-                if (topologyId != null) {\n-                    topologyInfo = client.getTopologyInfoWithOpts(topologyId, opts);\n-                }\n+                TopologyInfo topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n \n                 Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyId == null || topologyInfo == null) {\n+                if (topologyInfo == null) {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MjIxNw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467682217", "bodyText": "Will topologyInfo ever be null?\n\nWith the implementation in this PR, getTopologyInfoByNameWithOpts will throw an WrappedNotAliveException (an TException) if the topology is not alive. So the result will never be null. We need a different check here.", "author": "Ethanlm", "createdAt": "2020-08-10T04:25:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNDU3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "e4d595c07ee57aa27ac241ed2643edf05fed4fa4", "chunk": "diff --git a/storm-core/src/jvm/org/apache/storm/command/GetErrors.java b/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\nindex 8905f8227..1cec52d06 100644\n--- a/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\n+++ b/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\n\n@@ -42,16 +43,17 @@ public class GetErrors {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                TopologyInfo topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n-\n-                Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyInfo == null) {\n-                    outputMap.put(\"Failure\", \"No topologies running with name \" + name);\n-                } else {\n+                TopologyInfo topologyInfo;\n+                Map<String, Object> outputMap = null;\n+                outputMap = new HashMap<>();\n+                try {\n+                    topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n                     String topologyName = topologyInfo.get_name();\n                     Map<String, List<ErrorInfo>> topologyErrors = topologyInfo.get_errors();\n                     outputMap.put(\"Topology Name\", topologyName);\n                     outputMap.put(\"Comp-Errors\", getComponentErrors(topologyErrors));\n+                } catch (NotAliveException notAliveException) {\n+                    outputMap.put(\"Failure\", \"No topologies running with name \" + name);\n                 }\n                 System.out.println(JSONValue.toJSONString(outputMap));\n             }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjA3MA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116070", "bodyText": "AuthorizationException can be removed", "author": "Ethanlm", "createdAt": "2020-07-15T14:54:28Z", "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/LocalCluster.java b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\nindex 57a8e4699..55a382375 100644\n--- a/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n+++ b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n\n@@ -584,8 +584,8 @@ public class LocalCluster implements ILocalClusterTrackedTopologyAware, Iface {\n     }\n \n     @Override\n-    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n-        return getNimbus().getTopologySummaryById(id);\n+    public TopologySummary getTopologySummary(String id) throws TException {\n+        return getNimbus().getTopologySummary(id);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjE5NQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116195", "bodyText": "AuthorizationException can be removed", "author": "Ethanlm", "createdAt": "2020-07-15T14:54:34Z", "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/LocalCluster.java b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\nindex 57a8e4699..55a382375 100644\n--- a/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n+++ b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n\n@@ -584,8 +584,8 @@ public class LocalCluster implements ILocalClusterTrackedTopologyAware, Iface {\n     }\n \n     @Override\n-    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n-        return getNimbus().getTopologySummaryById(id);\n+    public TopologySummary getTopologySummary(String id) throws TException {\n+        return getNimbus().getTopologySummary(id);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjI5NA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116294", "bodyText": "AuthorizationException can be removed", "author": "Ethanlm", "createdAt": "2020-07-15T14:54:39Z", "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/LocalCluster.java b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\nindex 57a8e4699..55a382375 100644\n--- a/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n+++ b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n\n@@ -584,8 +584,8 @@ public class LocalCluster implements ILocalClusterTrackedTopologyAware, Iface {\n     }\n \n     @Override\n-    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n-        return getNimbus().getTopologySummaryById(id);\n+    public TopologySummary getTopologySummary(String id) throws TException {\n+        return getNimbus().getTopologySummary(id);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjU4OQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116589", "bodyText": "NotAliveException, AuthorizationException can be removed", "author": "Ethanlm", "createdAt": "2020-07-15T14:54:54Z", "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryById(id);\n+    }\n+\n     @Override\n     public TopologyInfo getTopologyInfo(String id) throws TException {\n         return getNimbus().getTopologyInfo(id);\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws TException {\n+        return getNimbus().getTopologyInfoByName(name);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoWithOpts(String id, GetInfoOptions options) throws NotAliveException, AuthorizationException,", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/LocalCluster.java b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\nindex 57a8e4699..55a382375 100644\n--- a/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n+++ b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n\n@@ -584,8 +584,8 @@ public class LocalCluster implements ILocalClusterTrackedTopologyAware, Iface {\n     }\n \n     @Override\n-    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n-        return getNimbus().getTopologySummaryById(id);\n+    public TopologySummary getTopologySummary(String id) throws TException {\n+        return getNimbus().getTopologySummary(id);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjY3Mg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116672", "bodyText": "NotAliveException, AuthorizationException can be removed", "author": "Ethanlm", "createdAt": "2020-07-15T14:54:58Z", "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryById(id);\n+    }\n+\n     @Override\n     public TopologyInfo getTopologyInfo(String id) throws TException {\n         return getNimbus().getTopologyInfo(id);\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws TException {\n+        return getNimbus().getTopologyInfoByName(name);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoWithOpts(String id, GetInfoOptions options) throws NotAliveException, AuthorizationException,\n+        TException {\n+        return nimbus.getTopologyInfoWithOpts(id, options);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoByNameWithOpts(String name, GetInfoOptions options) throws NotAliveException, AuthorizationException,", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/LocalCluster.java b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\nindex 57a8e4699..55a382375 100644\n--- a/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n+++ b/storm-server/src/main/java/org/apache/storm/LocalCluster.java\n\n@@ -584,8 +584,8 @@ public class LocalCluster implements ILocalClusterTrackedTopologyAware, Iface {\n     }\n \n     @Override\n-    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n-        return getNimbus().getTopologySummaryById(id);\n+    public TopologySummary getTopologySummary(String id) throws TException {\n+        return getNimbus().getTopologySummary(id);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTgzMg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455121832", "bodyText": "I noticed that there is syntax change here. Before the change, getTopologyId returns null when it couldn't get the summary. But with the change, it will throw exceptions when there is no such topology with this name. Is there any impact here?", "author": "Ethanlm", "createdAt": "2020-07-15T15:01:12Z", "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1188,28 +1188,18 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            ClusterSummary summary = client.getClusterInfo();\n-            for (TopologySummary s : summary.get_topologies()) {\n-                if (s.get_name().equals(name)) {\n-                    return s.get_id();\n-                }\n-            }\n+            return client.getTopologySummaryByName(name).get_id();\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n-        return null;", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MDQ4Mg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467680482", "bodyText": "I noticed that there is syntax change here. Before the change, getTopologyId returns null when it couldn't get the summary. But with the change, it will throw exceptions when there is no such topology with this name. Is there any impact here?\n\nThis change has some impact on backward compatibility since the syntax is changed here. The caller of this method might reply on the returned result == null to know if the topology is alive or not.\nFor example:\nhttps://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/command/SetLogLevel.java#L58-L59\nUser code might do this too. Maybe Utils. getTopologyId should return null if the topology is not alive / does not exist.", "author": "Ethanlm", "createdAt": "2020-08-10T04:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTgzMg=="}], "type": "inlineReview", "revised_code": {"commit": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/utils/Utils.java b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\nindex 1000b4528..a09aad6d2 100644\n--- a/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n+++ b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n\n@@ -1196,10 +1196,14 @@ public class Utils {\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            return client.getTopologySummaryByName(name).get_id();\n+            TopologySummary topologySummary = client.getTopologySummaryByName(name);\n+            if (topologySummary != null) {\n+                return topologySummary.get_id();\n+            }\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n+        return null;\n     }\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMzA1Mw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455123053", "bodyText": "Will it ever be null? Looks to me getTopologySummaryByName throws exception if it can't find the topo", "author": "Ethanlm", "createdAt": "2020-07-15T15:02:50Z", "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -151,28 +151,22 @@ public void waitTopologyScheduled(String topoName, ILocalCluster cluster, int re\n \n     public boolean checkTopologyScheduled(String topoName, ILocalCluster cluster) throws TException {\n         if (checkTopologyUp(topoName, cluster)) {\n-            ClusterSummary sum = cluster.getClusterInfo();\n-            for (TopologySummary topoSum : sum.get_topologies()) {\n-                if (topoSum.get_name().equals(topoName)) {\n-                    String status = topoSum.get_status();\n-                    String sched_status = topoSum.get_sched_status();\n-                    if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n-                        return true;\n-                    }\n-                }\n+            TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            String status = topoSum.get_status();\n+            String sched_status = topoSum.get_sched_status();\n+            if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n+                return true;\n             }\n         }\n         return false;\n     }\n \n     public boolean checkTopologyUp(String topoName, ILocalCluster cluster) throws TException {\n         ClusterSummary sum = cluster.getClusterInfo();\n-\n-        for (TopologySummary topoSum : sum.get_topologies()) {\n-            if (topoSum.get_name().equals(topoName)) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            if (topoSum != null) {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NTQ0MQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467685441", "bodyText": "Will it ever be null? Looks to me getTopologySummaryByName throws exception if it can't find the topo\n\nCurrent implementation in the PR will throw exception if the topology can't be find (when calling getTopologySummaryByName). So we need to try-catch block to determine if this topology is up or not, instead of checking topoSum!=null.", "author": "Ethanlm", "createdAt": "2020-08-10T04:43:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMzA1Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDg3OA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455124878", "bodyText": "Why will the returned topologySummary.get_name != topoName?", "author": "Ethanlm", "createdAt": "2020-07-15T15:05:28Z", "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -43,11 +44,10 @@\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        for (TopologySummary topoSum : cluster.getClusterInfo().get_topologies()) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n             if (topoSum.get_name().equals(topoName)) {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NTEzMA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467685130", "bodyText": "Why will the returned topologySummary.get_name != topoName?\n\nI believe this line can be removed", "author": "Ethanlm", "createdAt": "2020-08-10T04:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDg3OA=="}], "type": "inlineReview", "revised_code": {"commit": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "chunk": "diff --git a/storm-server/src/test/java/org/apache/storm/TestRebalance.java b/storm-server/src/test/java/org/apache/storm/TestRebalance.java\nindex c693f4a4d..5c2d2c292 100644\n--- a/storm-server/src/test/java/org/apache/storm/TestRebalance.java\n+++ b/storm-server/src/test/java/org/apache/storm/TestRebalance.java\n\n@@ -45,9 +45,9 @@ public class TestRebalance {\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n         TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n-            if (topoSum.get_name().equals(topoName)) {\n-                return topoSum.get_id();\n-            }\n+        if (topoSum != null) {\n+            return topoSum.get_id();\n+        }\n         return null;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0MzcyMQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455143721", "bodyText": "We need to update docs/ClusterMetrics.md too", "author": "Ethanlm", "createdAt": "2020-07-15T15:32:17Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -502,11 +507,16 @@ public Nimbus(Map<String, Object> conf, INimbus inimbus, IStormClusterState stor\n         this.getTopologyCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopology-calls\");\n         this.getUserTopologyCalls = metricsRegistry.registerMeter(\"nimbus:num-getUserTopology-calls\");\n         this.getClusterInfoCalls = metricsRegistry.registerMeter(\"nimbus:num-getClusterInfo-calls\");\n+        this.getTopologySummariesCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummaries-calls\");", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..05589fd28 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -508,7 +508,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n         this.getUserTopologyCalls = metricsRegistry.registerMeter(\"nimbus:num-getUserTopology-calls\");\n         this.getClusterInfoCalls = metricsRegistry.registerMeter(\"nimbus:num-getClusterInfo-calls\");\n         this.getTopologySummariesCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummaries-calls\");\n-        this.getTopologySummaryByIdCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummaryById-calls\");\n+        this.getTopologySummaryCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummary-calls\");\n         this.getTopologySummaryByNameCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummaryByName-calls\");\n         this.getLeaderCalls = metricsRegistry.registerMeter(\"nimbus:num-getLeader-calls\");\n         this.isTopologyNameAllowedCalls = metricsRegistry.registerMeter(\"nimbus:num-isTopologyNameAllowed-calls\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTE4MQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455159181", "bodyText": "AuthorizationException is not needed", "author": "Ethanlm", "createdAt": "2020-07-15T15:57:08Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -2968,16 +2978,14 @@ private SupervisorSummary makeSupervisorSummary(String supervisorId, SupervisorI\n         return ret;\n     }\n \n-    private ClusterSummary getClusterInfoImpl() throws Exception {\n+    private ClusterSummary getClusterInfoImpl() throws Exception, AuthorizationException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NjI2Mw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467686263", "bodyText": "AuthorizationException is not needed", "author": "Ethanlm", "createdAt": "2020-08-10T04:48:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTE4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..8ba808497 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -2978,7 +2978,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n         return ret;\n     }\n \n-    private ClusterSummary getClusterInfoImpl() throws Exception, AuthorizationException {\n+    private ClusterSummary getClusterInfoImpl() throws Exception {\n         IStormClusterState state = stormClusterState;\n         Map<String, SupervisorInfo> infos = state.allSupervisorInfo();\n         List<SupervisorSummary> summaries = new ArrayList<>(infos.size());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MDcyNQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455160725", "bodyText": "This might should be getTopologyInfoByNameWithOptsImpl?", "author": "Ethanlm", "createdAt": "2020-07-15T15:59:36Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {\n+        try {\n+            getTopologyInfoByNameCalls.mark();\n+            GetInfoOptions options = new GetInfoOptions();\n+            options.set_num_err_choice(NumErrorsChoice.ALL);\n+\n+            return getTopologyInfoByNameImpl(name, options);\n+        } catch (Exception e) {\n+            LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private TopologyInfo getTopologyInfoByNameImpl(String name, GetInfoOptions options) throws", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4083,7 +4083,6 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n             getTopologyInfoByNameCalls.mark();\n             GetInfoOptions options = new GetInfoOptions();\n             options.set_num_err_choice(NumErrorsChoice.ALL);\n-\n             return getTopologyInfoByNameImpl(name, options);\n         } catch (Exception e) {\n             LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTk4Ng==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455161986", "bodyText": "base can be null if this topology doesn't exist. Then there will be NullPointerException in getTopologySummary(id, base) . Is this intended?", "author": "Ethanlm", "createdAt": "2020-07-15T16:01:40Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByIdCalls.mark();\n+            IStormClusterState state = stormClusterState;\n+            StormBase base = state.topologyBases().get(id);", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NzU3MA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467687570", "bodyText": "base can be null if this topology doesn't exist. Then there will be NullPointerException in getTopologySummary(id, base) . Is this intended?\n\nWe need to check base==null here", "author": "Ethanlm", "createdAt": "2020-08-10T04:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTk4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4733,7 +4738,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n     public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n         try {\n             getTopologySummaryByNameCalls.mark();\n-            checkAuthorization(null, null, \"getTopologySummaries\");\n+            checkAuthorization(name, null, \"getTopologySummaryByName\");\n             IStormClusterState state = stormClusterState;\n             String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n             return getTopologySummary(topoId, state.topologyBases().get(topoId));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NDUzNg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455164536", "bodyText": "Why is this getTopology while getTopologySummaryByName uses getTopologySummaries\nShould we have getTopologySummaryByName for getTopologySummaryByName method and getTopologySummaryById for getTopologySummaryById method?", "author": "Ethanlm", "createdAt": "2020-07-15T16:06:08Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByIdCalls.mark();\n+            IStormClusterState state = stormClusterState;\n+            StormBase base = state.topologyBases().get(id);\n+            checkAuthorization(null, null, \"getTopology\");", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4733,7 +4738,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n     public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n         try {\n             getTopologySummaryByNameCalls.mark();\n-            checkAuthorization(null, null, \"getTopologySummaries\");\n+            checkAuthorization(name, null, \"getTopologySummaryByName\");\n             IStormClusterState state = stormClusterState;\n             String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n             return getTopologySummary(topoId, state.topologyBases().get(topoId));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzEzNg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167136", "bodyText": "Looks like we don't need NotAliveException, AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-15T16:10:52Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4083,7 +4083,6 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n             getTopologyInfoByNameCalls.mark();\n             GetInfoOptions options = new GetInfoOptions();\n             options.set_num_err_choice(NumErrorsChoice.ALL);\n-\n             return getTopologyInfoByNameImpl(name, options);\n         } catch (Exception e) {\n             LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzMzNw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167337", "bodyText": "looks like we don't need NotAliveException, AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-15T16:11:11Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {\n+        try {\n+            getTopologyInfoByNameCalls.mark();\n+            GetInfoOptions options = new GetInfoOptions();\n+            options.set_num_err_choice(NumErrorsChoice.ALL);\n+\n+            return getTopologyInfoByNameImpl(name, options);\n+        } catch (Exception e) {\n+            LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private TopologyInfo getTopologyInfoByNameImpl(String name, GetInfoOptions options) throws\n+        NotAliveException, AuthorizationException, TException {\n+        IStormClusterState state = stormClusterState;\n+        String id = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+        return getTopologyInfoWithOpts(id, options);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoByNameWithOpts(String name, GetInfoOptions options) throws\n+        NotAliveException, AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4083,7 +4083,6 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n             getTopologyInfoByNameCalls.mark();\n             GetInfoOptions options = new GetInfoOptions();\n             options.set_num_err_choice(NumErrorsChoice.ALL);\n-\n             return getTopologyInfoByNameImpl(name, options);\n         } catch (Exception e) {\n             LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzU4Ng==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167586", "bodyText": "looks like we don't need AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-15T16:11:38Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4733,7 +4738,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n     public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n         try {\n             getTopologySummaryByNameCalls.mark();\n-            checkAuthorization(null, null, \"getTopologySummaries\");\n+            checkAuthorization(name, null, \"getTopologySummaryByName\");\n             IStormClusterState state = stormClusterState;\n             String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n             return getTopologySummary(topoId, state.topologyBases().get(topoId));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzYxNg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167616", "bodyText": "looks like we don't need AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-15T16:11:42Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4733,7 +4738,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n     public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n         try {\n             getTopologySummaryByNameCalls.mark();\n-            checkAuthorization(null, null, \"getTopologySummaries\");\n+            checkAuthorization(name, null, \"getTopologySummaryByName\");\n             IStormClusterState state = stormClusterState;\n             String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n             return getTopologySummary(topoId, state.topologyBases().get(topoId));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzY1Mw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167653", "bodyText": "looks like we don't need AuthorizationException", "author": "Ethanlm", "createdAt": "2020-07-15T16:11:46Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {", "originalCommit": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b60256a144da2d6f20cff3e36e27a990486a4272", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex ffa272810..da233d921 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4733,7 +4738,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n     public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n         try {\n             getTopologySummaryByNameCalls.mark();\n-            checkAuthorization(null, null, \"getTopologySummaries\");\n+            checkAuthorization(name, null, \"getTopologySummaryByName\");\n             IStormClusterState state = stormClusterState;\n             String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n             return getTopologySummary(topoId, state.topologyBases().get(topoId));\n"}}, {"oid": "b60256a144da2d6f20cff3e36e27a990486a4272", "url": "https://github.com/apache/storm/commit/b60256a144da2d6f20cff3e36e27a990486a4272", "message": "STORM-3671: Modify function arg to Auth check and refactoring", "committedDate": "2020-07-15T19:50:14Z", "type": "commit"}, {"oid": "878feee52ad7f30ae928d0a22dda505c391ab4d9", "url": "https://github.com/apache/storm/commit/878feee52ad7f30ae928d0a22dda505c391ab4d9", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671", "committedDate": "2020-07-15T19:51:50Z", "type": "commit"}, {"oid": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "url": "https://github.com/apache/storm/commit/d3f94e540a9aa9dd1307c8324a83379b89cd5731", "message": "STORM-3671: Update getTopologySummary nimbus interface", "committedDate": "2020-07-16T19:32:00Z", "type": "commit"}, {"oid": "1b9acedd26ac0d2e962dabf3e650c958608fa91b", "url": "https://github.com/apache/storm/commit/1b9acedd26ac0d2e962dabf3e650c958608fa91b", "message": "STORM-3671: Remove AuthorizationException from signature", "committedDate": "2020-07-16T20:40:30Z", "type": "commit"}, {"oid": "5f76f6f1cfd1f656499026752f9f88554351c3fd", "url": "https://github.com/apache/storm/commit/5f76f6f1cfd1f656499026752f9f88554351c3fd", "message": "revert changes", "committedDate": "2020-07-16T21:04:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1OTk1NQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r456659955", "bodyText": "getTopologyInfoByName and getTopologyInfoByNameWithOpts need here?", "author": "bipinprasad", "createdAt": "2020-07-17T20:30:01Z", "path": "storm-client/src/jvm/org/apache/storm/security/auth/authorizer/SimpleACLAuthorizer.java", "diffHunk": "@@ -40,6 +40,11 @@\n         \"fileUpload\",\n         \"getNimbusConf\",\n         \"getClusterInfo\",\n+        \"getLeader\",\n+        \"isTopologyNameAllowed\",\n+        \"getTopologySummaries\",\n+        \"getTopologySummaryByName\",\n+        \"getTopologySummary\",", "originalCommit": "5f76f6f1cfd1f656499026752f9f88554351c3fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzYyMjE1MA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r457622150", "bodyText": "All variations for for getTopologyInfo method are using getTopologyInfo for now. I do not intend to change implementation getTopologyInfoWithOptsImpl at this point to refactor checkAuthorization else where.", "author": "kishorvpatil", "createdAt": "2020-07-20T18:52:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1OTk1NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "7107cb402130025a013bc38ffd97b0bf0dd001f3", "url": "https://github.com/apache/storm/commit/7107cb402130025a013bc38ffd97b0bf0dd001f3", "message": "Addressing review comments", "committedDate": "2020-07-21T19:09:10Z", "type": "commit"}, {"oid": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "url": "https://github.com/apache/storm/commit/58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "message": "Remove unnecessary null check", "committedDate": "2020-07-29T16:30:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4MTYyMQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r462481621", "bodyText": "This comment is a little confusing to me. Does it mean \"to choose number of Errors in TopologyInfo\"?", "author": "Ethanlm", "createdAt": "2020-07-29T17:53:40Z", "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -144,6 +154,35 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     TopologyInfo getTopologyInfo(String id) throws TException;\n \n+    /**\n+     * Get the state of a topology.\n+     *\n+     * @param name the name of the topology (not the id)\n+     * @return the state of a topology\n+     * @throws TException on any error from nimbus\n+     */\n+    TopologyInfo getTopologyInfoByName(String name) throws TException;\n+\n+    /**\n+     * Get the state of a topology.\n+     *\n+     * @param id the id of the topology (not the name)\n+     * @param options This is GetInfoOptions to choose Error(s) in on TopologyInfo.", "originalCommit": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\nindex b4be68b9a..687be64df 100644\n--- a/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n+++ b/storm-client/src/jvm/org/apache/storm/ILocalCluster.java\n\n@@ -167,7 +167,7 @@ public interface ILocalCluster extends AutoCloseable {\n      * Get the state of a topology.\n      *\n      * @param id the id of the topology (not the name)\n-     * @param options This is GetInfoOptions to choose Error(s) in on TopologyInfo.\n+     * @param options This is to choose number of Error(s) in TopologyInfo.\n      * @return the state of a topology\n      * @throws TException on any error from nimbus\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NzY3Nw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r467677677", "bodyText": "Can we use TopologyInfo info = client.getTopologyInfoByName(name); here directly?\ninstead of\nTopologySummary ts = client.getTopologySummaryByName(name);\nString id = ts.get_id();\nTopologyInfo info = client.getTopologyInfo(id);\n\nhere", "author": "Ethanlm", "createdAt": "2020-08-10T03:58:13Z", "path": "examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java", "diffHunk": "@@ -40,16 +40,8 @@\n public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n-        ClusterSummary summary = client.getClusterInfo();\n-        String id = null;\n-        for (TopologySummary ts : summary.get_topologies()) {\n-            if (name.equals(ts.get_name())) {\n-                id = ts.get_id();\n-            }\n-        }\n-        if (id == null) {\n-            throw new Exception(\"Could not find a topology named \" + name);\n-        }\n+        TopologySummary ts = client.getTopologySummaryByName(name);\n+        String id = ts.get_id();", "originalCommit": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "chunk": "diff --git a/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java b/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\nindex 9c4a8e592..a2a5da99a 100644\n--- a/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\n+++ b/examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java\n\n@@ -40,9 +40,7 @@ import org.apache.storm.utils.Utils;\n public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n-        TopologySummary ts = client.getTopologySummaryByName(name);\n-        String id = ts.get_id();\n-        TopologyInfo info = client.getTopologyInfo(id);\n+        TopologyInfo info = client.getTopologyInfoByName(name);\n         int uptime = info.get_uptime_secs();\n         long acked = 0;\n         long failed = 0;\n"}}, {"oid": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "url": "https://github.com/apache/storm/commit/b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "message": "Addressing code review comments", "committedDate": "2020-08-14T14:27:19Z", "type": "commit"}, {"oid": "f575728292ded4b79250b60b1e61d40be47b919d", "url": "https://github.com/apache/storm/commit/f575728292ded4b79250b60b1e61d40be47b919d", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671", "committedDate": "2020-08-31T23:09:23Z", "type": "commit"}, {"oid": "e4d595c07ee57aa27ac241ed2643edf05fed4fa4", "url": "https://github.com/apache/storm/commit/e4d595c07ee57aa27ac241ed2643edf05fed4fa4", "message": "Addressing NotAliveExceptions.", "committedDate": "2020-09-14T21:38:12Z", "type": "commit"}, {"oid": "782604fc76f80984398d5157915b3b296f20fbc8", "url": "https://github.com/apache/storm/commit/782604fc76f80984398d5157915b3b296f20fbc8", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671", "committedDate": "2020-09-14T21:38:26Z", "type": "commit"}, {"oid": "782604fc76f80984398d5157915b3b296f20fbc8", "url": "https://github.com/apache/storm/commit/782604fc76f80984398d5157915b3b296f20fbc8", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671", "committedDate": "2020-09-14T21:38:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NDY1NQ==", "url": "https://github.com/apache/storm/pull/3306#discussion_r488874655", "bodyText": "getLeader was added due to a bug below I guess?", "author": "agresch", "createdAt": "2020-09-15T18:24:36Z", "path": "storm-client/src/jvm/org/apache/storm/security/auth/authorizer/SimpleACLAuthorizer.java", "diffHunk": "@@ -40,6 +40,11 @@\n         \"fileUpload\",\n         \"getNimbusConf\",\n         \"getClusterInfo\",\n+        \"getLeader\",", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3OTQzNA==", "url": "https://github.com/apache/storm/pull/3306#discussion_r488879434", "bodyText": "combine these two lines", "author": "agresch", "createdAt": "2020-09-15T18:33:04Z", "path": "storm-core/src/jvm/org/apache/storm/command/GetErrors.java", "diffHunk": "@@ -42,21 +43,17 @@ public static void main(String[] args) throws Exception {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                String topologyId = Utils.getTopologyId(name, client);\n-\n-                TopologyInfo topologyInfo = null;\n-                if (topologyId != null) {\n-                    topologyInfo = client.getTopologyInfoWithOpts(topologyId, opts);\n-                }\n-\n-                Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyId == null || topologyInfo == null) {\n-                    outputMap.put(\"Failure\", \"No topologies running with name \" + name);\n-                } else {\n+                TopologyInfo topologyInfo;\n+                Map<String, Object> outputMap = null;", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9217205d9b68319331b800064414bed0cb79debe", "chunk": "diff --git a/storm-core/src/jvm/org/apache/storm/command/GetErrors.java b/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\nindex 1cec52d06..c45272f55 100644\n--- a/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\n+++ b/storm-core/src/jvm/org/apache/storm/command/GetErrors.java\n\n@@ -43,11 +43,9 @@ public class GetErrors {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                TopologyInfo topologyInfo;\n-                Map<String, Object> outputMap = null;\n-                outputMap = new HashMap<>();\n+                Map<String, Object> outputMap = new HashMap<>();\n                 try {\n-                    topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n+                    TopologyInfo topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n                     String topologyName = topologyInfo.get_name();\n                     Map<String, List<ErrorInfo>> topologyErrors = topologyInfo.get_errors();\n                     outputMap.put(\"Topology Name\", topologyName);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4NDUwNw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r488884507", "bodyText": "why change this exception?", "author": "agresch", "createdAt": "2020-09-15T18:42:30Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4747,7 +4866,7 @@ public boolean isTopologyNameAllowed(String name) throws AuthorizationException,\n                 for (StormBase base : ownerToBasesEntry.getValue()) {\n                     try {\n                         String topoId = state.getTopoId(base.get_name())\n-                                             .orElseThrow(() -> new WrappedNotAliveException(base.get_name() + \" is not alive\"));", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "38e76f34dab1f2a3250873d4fbc1b1e373dc1c95", "chunk": "diff --git a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\nindex 73e2a821c..8c2c3484f 100644\n--- a/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n+++ b/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java\n\n@@ -4865,8 +4883,7 @@ public class Nimbus implements Iface, Shutdownable, DaemonCommon {\n \n                 for (StormBase base : ownerToBasesEntry.getValue()) {\n                     try {\n-                        String topoId = state.getTopoId(base.get_name())\n-                                             .orElseThrow(() -> new NotAliveException(base.get_name() + \" is not alive\"));\n+                        String topoId = toTopoId(base.get_name());\n                         TopologyResources resources = getResourcesForTopology(topoId, base);\n                         totalResourcesAggregate = totalResourcesAggregate.add(resources);\n                         Assignment ownerAssignment = topoIdToAssignments.get(topoId);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyODg4Ng==", "url": "https://github.com/apache/storm/pull/3306#discussion_r489628886", "bodyText": "We should catch NotAliveException and return null if it happens\nThis is to keep the syntax consistent with original implementation", "author": "Ethanlm", "createdAt": "2020-09-16T18:12:57Z", "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1190,23 +1190,17 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9217205d9b68319331b800064414bed0cb79debe", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/utils/Utils.java b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\nindex 195fdfbf0..50d94e492 100644\n--- a/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n+++ b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n\n@@ -1191,6 +1192,8 @@ public class Utils {\n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n             return client.getClient().getTopologyInfoByName(name);\n+        } catch (NotAliveException notAliveException) {\n+            return null;\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyODkxNg==", "url": "https://github.com/apache/storm/pull/3306#discussion_r489628916", "bodyText": "We should catch NotAliveException and return null if it happens\nThis is to keep the syntax consistent with original implementation", "author": "Ethanlm", "createdAt": "2020-09-16T18:13:02Z", "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1190,23 +1190,17 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            ClusterSummary summary = client.getClusterInfo();\n-            for (TopologySummary s : summary.get_topologies()) {\n-                if (s.get_name().equals(name)) {\n-                    return s.get_id();\n-                }\n+            TopologySummary topologySummary = client.getTopologySummaryByName(name);", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9217205d9b68319331b800064414bed0cb79debe", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/utils/Utils.java b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\nindex 195fdfbf0..50d94e492 100644\n--- a/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n+++ b/storm-client/src/jvm/org/apache/storm/utils/Utils.java\n\n@@ -1191,6 +1192,8 @@ public class Utils {\n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n             return client.getClient().getTopologyInfoByName(name);\n+        } catch (NotAliveException notAliveException) {\n+            return null;\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyOTY4Mw==", "url": "https://github.com/apache/storm/pull/3306#discussion_r489629683", "bodyText": "should we catch NotAliveException and return null if happened?", "author": "Ethanlm", "createdAt": "2020-09-16T18:14:34Z", "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -43,10 +44,9 @@\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        for (TopologySummary topoSum : cluster.getClusterInfo().get_topologies()) {\n-            if (topoSum.get_name().equals(topoName)) {\n-                return topoSum.get_id();\n-            }\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);", "originalCommit": "782604fc76f80984398d5157915b3b296f20fbc8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9217205d9b68319331b800064414bed0cb79debe", "chunk": "diff --git a/storm-server/src/test/java/org/apache/storm/TestRebalance.java b/storm-server/src/test/java/org/apache/storm/TestRebalance.java\nindex 5c2d2c292..7d45305ce 100644\n--- a/storm-server/src/test/java/org/apache/storm/TestRebalance.java\n+++ b/storm-server/src/test/java/org/apache/storm/TestRebalance.java\n\n@@ -44,9 +45,11 @@ public class TestRebalance {\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n-        if (topoSum != null) {\n+        try {\n+            TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n             return topoSum.get_id();\n+        } catch (NotAliveException e) {\n+            LOG.error(\"Failed to getTopologySummaryByName from \" + topoName, e);\n         }\n         return null;\n     }\n"}}, {"oid": "9217205d9b68319331b800064414bed0cb79debe", "url": "https://github.com/apache/storm/commit/9217205d9b68319331b800064414bed0cb79debe", "message": "Switching back to use WrappedNotAliveException", "committedDate": "2020-09-18T14:30:04Z", "type": "commit"}, {"oid": "38e76f34dab1f2a3250873d4fbc1b1e373dc1c95", "url": "https://github.com/apache/storm/commit/38e76f34dab1f2a3250873d4fbc1b1e373dc1c95", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671", "committedDate": "2020-09-18T14:35:41Z", "type": "commit"}]}