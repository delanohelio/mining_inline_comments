{"pr_number": 3291, "pr_title": "STORM-3655: Worker should die if its assignment has changed", "pr_createdAt": "2020-06-23T12:12:16Z", "pr_url": "https://github.com/apache/storm/pull/3291", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyNTU5OA==", "url": "https://github.com/apache/storm/pull/3291#discussion_r447025598", "bodyText": "We can place this as earlier as possible in this refreshConnections method.", "author": "Ethanlm", "createdAt": "2020-06-29T14:43:16Z", "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java", "diffHunk": "@@ -401,6 +418,7 @@ public void refreshConnections() {\n             }\n         }\n \n+        suicideIfLocalAssignmentsChanged(assignment);", "originalCommit": "c29be627f1e4e63021f5ccc27052892dabbfe68b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzE1MzYwNQ==", "url": "https://github.com/apache/storm/pull/3291#discussion_r447153605", "bodyText": "Addressed", "author": "kishorvpatil", "createdAt": "2020-06-29T18:00:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyNTU5OA=="}], "type": "inlineReview", "revised_code": {"commit": "07362f566132ff9392f2d320ed6aa4e78509258d", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java b/storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java\nindex 753f74c91..056baf6f0 100644\n--- a/storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java\n+++ b/storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java\n\n@@ -418,7 +419,6 @@ public class WorkerState {\n             }\n         }\n \n-        suicideIfLocalAssignmentsChanged(assignment);\n         Set<NodeInfo> currentConnections = cachedNodeToPortSocket.get().keySet();\n         Set<NodeInfo> newConnections = Sets.difference(neededConnections, currentConnections);\n         Set<NodeInfo> removeConnections = Sets.difference(currentConnections, neededConnections);\n"}}, {"oid": "07362f566132ff9392f2d320ed6aa4e78509258d", "url": "https://github.com/apache/storm/commit/07362f566132ff9392f2d320ed6aa4e78509258d", "message": "STORM-3655: Worker should die if its assignment has changed", "committedDate": "2020-06-29T18:00:22Z", "type": "commit"}, {"oid": "07362f566132ff9392f2d320ed6aa4e78509258d", "url": "https://github.com/apache/storm/commit/07362f566132ff9392f2d320ed6aa4e78509258d", "message": "STORM-3655: Worker should die if its assignment has changed", "committedDate": "2020-06-29T18:00:22Z", "type": "forcePushed"}]}