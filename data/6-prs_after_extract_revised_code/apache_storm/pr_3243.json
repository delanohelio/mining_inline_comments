{"pr_number": 3243, "pr_title": "[STORM-3616] add optional flag to fail upload-credentials cmd if no creds were uploaded", "pr_createdAt": "2020-04-02T03:48:46Z", "pr_url": "https://github.com/apache/storm/pull/3243", "timeline": [{"oid": "a4da4a716e59debccbdcadc3db5a3c60a14120b4", "url": "https://github.com/apache/storm/commit/a4da4a716e59debccbdcadc3db5a3c60a14120b4", "message": "[STORM-3616] add optional flag to fail upload-credentials cmd if no creds were uploaded", "committedDate": "2020-04-02T03:47:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzY0Ng==", "url": "https://github.com/apache/storm/pull/3243#discussion_r402327646", "bodyText": "missing javadoc @return\nThere is another pushCredentials method in this class needs to be taken care of", "author": "Ethanlm", "createdAt": "2020-04-02T13:49:26Z", "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -126,7 +127,7 @@ public static void pushCredentials(String name, Map<String, Object> topoConf, Ma\n      * @throws NotAliveException        if the topology is not alive\n      * @throws InvalidTopologyException if any other error happens\n      */\n-    public static void pushCredentials(String name, Map<String, Object> topoConf, Map<String, String> credentials, String expectedUser)\n+    public static boolean pushCredentials(String name, Map<String, Object> topoConf, Map<String, String> credentials, String expectedUser)", "originalCommit": "a4da4a716e59debccbdcadc3db5a3c60a14120b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0Mzk1MA==", "url": "https://github.com/apache/storm/pull/3243#discussion_r402343950", "bodyText": "Fixed", "author": "RuiLi8080", "createdAt": "2020-04-02T14:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzY0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "568bb57877a67dd7b34b19a06a53b134648c3c77", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/StormSubmitter.java b/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\nindex 9e657061b..7cb80c753 100644\n--- a/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\n+++ b/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\n\n@@ -123,6 +124,7 @@ public class StormSubmitter {\n      * @param topoConf    the topology-specific configuration, if desired. See {@link Config}.\n      * @param credentials the credentials to push.\n      * @param expectedUser the user you expect the topology to be owned by.\n+     * @return whether the pushed credential collection fullCreds is non-empty. Return false if empty.\n      * @throws AuthorizationException   if you are not authorized ot push credentials.\n      * @throws NotAliveException        if the topology is not alive\n      * @throws InvalidTopologyException if any other error happens\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyOTYyMw==", "url": "https://github.com/apache/storm/pull/3243#discussion_r402329623", "bodyText": "No need for default value here. above boolOpt is already default to false", "author": "Ethanlm", "createdAt": "2020-04-02T13:52:03Z", "path": "storm-core/src/jvm/org/apache/storm/command/UploadCredentials.java", "diffHunk": "@@ -111,7 +112,13 @@ public static void main(String[] args) throws Exception {\n         // use the local setting for the login config rather than the topology's\n         topologyConf.remove(\"java.security.auth.login.config\");\n \n-        StormSubmitter.pushCredentials(topologyName, topologyConf, credentialsMap, (String) cl.get(\"u\"));\n+        boolean throwExceptionForEmptyCreds = (boolean) cl.getOrDefault(\"e\", false);", "originalCommit": "a4da4a716e59debccbdcadc3db5a3c60a14120b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0NDM2NA==", "url": "https://github.com/apache/storm/pull/3243#discussion_r402344364", "bodyText": "Fixed", "author": "RuiLi8080", "createdAt": "2020-04-02T14:11:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyOTYyMw=="}], "type": "inlineReview", "revised_code": {"commit": "568bb57877a67dd7b34b19a06a53b134648c3c77", "chunk": "diff --git a/storm-core/src/jvm/org/apache/storm/command/UploadCredentials.java b/storm-core/src/jvm/org/apache/storm/command/UploadCredentials.java\nindex 345fc751c..c308b599b 100644\n--- a/storm-core/src/jvm/org/apache/storm/command/UploadCredentials.java\n+++ b/storm-core/src/jvm/org/apache/storm/command/UploadCredentials.java\n\n@@ -112,7 +112,7 @@ public class UploadCredentials {\n         // use the local setting for the login config rather than the topology's\n         topologyConf.remove(\"java.security.auth.login.config\");\n \n-        boolean throwExceptionForEmptyCreds = (boolean) cl.getOrDefault(\"e\", false);\n+        boolean throwExceptionForEmptyCreds = (boolean) cl.get(\"e\");\n         boolean hasCreds = StormSubmitter.pushCredentials(topologyName, topologyConf, credentialsMap, (String) cl.get(\"u\"));\n         if (!hasCreds && throwExceptionForEmptyCreds) {\n             String message = \"No credentials were uploaded for \" + topologyName;\n"}}, {"oid": "568bb57877a67dd7b34b19a06a53b134648c3c77", "url": "https://github.com/apache/storm/commit/568bb57877a67dd7b34b19a06a53b134648c3c77", "message": "address comments", "committedDate": "2020-04-02T14:09:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU2Njc2MA==", "url": "https://github.com/apache/storm/pull/3243#discussion_r402566760", "bodyText": "fullCreds doesn't really mean anything and can be deleted; image anyone changed the variable name", "author": "Ethanlm", "createdAt": "2020-04-02T19:42:30Z", "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -106,27 +106,30 @@ public static boolean validateZKDigestPayload(String payload) {\n      * @param name        the name of the topology to push credentials to.\n      * @param topoConf    the topology-specific configuration, if desired. See {@link Config}.\n      * @param credentials the credentials to push.\n+     * @return whether the pushed credential collection fullCreds is non-empty. Return false if empty.", "originalCommit": "568bb57877a67dd7b34b19a06a53b134648c3c77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NzA2MA==", "url": "https://github.com/apache/storm/pull/3243#discussion_r403067060", "bodyText": "Sure. Fixed", "author": "RuiLi8080", "createdAt": "2020-04-03T14:59:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU2Njc2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NzQwNQ==", "url": "https://github.com/apache/storm/pull/3243#discussion_r403067405", "bodyText": "only one Travis build failed. Should be irrelevant.", "author": "RuiLi8080", "createdAt": "2020-04-03T14:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU2Njc2MA=="}], "type": "inlineReview", "revised_code": {"commit": "088e722559437cbd55ae7073c7fb89ac0f8c4ea5", "chunk": "diff --git a/storm-client/src/jvm/org/apache/storm/StormSubmitter.java b/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\nindex 7cb80c753..a31ef00c7 100644\n--- a/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\n+++ b/storm-client/src/jvm/org/apache/storm/StormSubmitter.java\n\n@@ -106,7 +106,7 @@ public class StormSubmitter {\n      * @param name        the name of the topology to push credentials to.\n      * @param topoConf    the topology-specific configuration, if desired. See {@link Config}.\n      * @param credentials the credentials to push.\n-     * @return whether the pushed credential collection fullCreds is non-empty. Return false if empty.\n+     * @return whether the pushed credential collection is non-empty. Return false if empty.\n      * @throws AuthorizationException   if you are not authorized ot push credentials.\n      * @throws NotAliveException        if the topology is not alive\n      * @throws InvalidTopologyException if any other error happens\n"}}, {"oid": "088e722559437cbd55ae7073c7fb89ac0f8c4ea5", "url": "https://github.com/apache/storm/commit/088e722559437cbd55ae7073c7fb89ac0f8c4ea5", "message": "address comments", "committedDate": "2020-04-03T03:54:07Z", "type": "commit"}]}