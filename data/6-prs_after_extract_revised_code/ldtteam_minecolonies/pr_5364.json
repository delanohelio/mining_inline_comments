{"pr_number": 5364, "pr_title": "Add batching to miner resource request when mining", "pr_createdAt": "2020-07-10T14:34:58Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5364", "timeline": [{"oid": "536681e4b69740e3238de24ccb02acf03c8ed63c", "url": "https://github.com/ldtteam/minecolonies/commit/536681e4b69740e3238de24ccb02acf03c8ed63c", "message": "Add batching to miner resource request when mining", "committedDate": "2020-07-10T14:27:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NjA3Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5364#discussion_r452886073", "bodyText": "That looks simpler than what I would've expected even.\nI would make the resourceBatchSize a getter which on default returns 1  (in the abstract building of the structure builders) and in the miner returns 10.\nSuch that here we request requestCount * getResourceBatchSize", "author": "Raycoms", "createdAt": "2020-07-10T14:40:01Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingStructureBuilder.java", "diffHunk": "@@ -669,7 +674,7 @@ public void checkOrRequestBucket(@Nullable final BuilderBucket requiredResources\n                         break;\n                     }\n \n-                    worker.createRequestAsync(new Stack(itemStack.getItemStack(), requestCount, requestCount));\n+                    worker.createRequestAsync(new Stack(itemStack.getItemStack(), Math.max(requestCount, resourceBatchSize), requestCount));", "originalCommit": "536681e4b69740e3238de24ccb02acf03c8ed63c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NzA2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5364#discussion_r452887066", "bodyText": "I like it.", "author": "Mekle001", "createdAt": "2020-07-10T14:41:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NjA3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4ODE4Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5364#discussion_r452888187", "bodyText": "This way instead of requesting 32 planks and 32 fences, we request 30/40 (which is a better ratio considering what we need too)", "author": "Raycoms", "createdAt": "2020-07-10T14:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjg4NjA3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "0706c9b1e680438a35e6a121b4c03a0150f71ca1", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingStructureBuilder.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingStructureBuilder.java\nindex afeb0699c7..93124039d6 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingStructureBuilder.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingStructureBuilder.java\n\n@@ -674,7 +678,7 @@ public abstract class AbstractBuildingStructureBuilder extends AbstractBuildingW\n                         break;\n                     }\n \n-                    worker.createRequestAsync(new Stack(itemStack.getItemStack(), Math.max(requestCount, resourceBatchSize), requestCount));\n+                    worker.createRequestAsync(new Stack(itemStack.getItemStack(), requestCount * getResourceBatchMultiplier(), requestCount));\n                 }\n             }\n         }\n"}}, {"oid": "0706c9b1e680438a35e6a121b4c03a0150f71ca1", "url": "https://github.com/ldtteam/minecolonies/commit/0706c9b1e680438a35e6a121b4c03a0150f71ca1", "message": "Change to getter, with override in miner", "committedDate": "2020-07-10T15:52:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk2MTcwOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5364#discussion_r452961708", "bodyText": "bracket should go down.", "author": "Raycoms", "createdAt": "2020-07-10T16:56:40Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingMiner.java", "diffHunk": "@@ -168,6 +168,15 @@ public int getMaxBuildingLevel()\n         return MAX_BUILDING_LEVEL;\n     }\n \n+    /**\n+     * The Miner wants to get multiple nodes/levels worth of stuff when requesting.\n+     */\n+    @Override\n+    public int getResourceBatchMultiplier() {\n+        //Ask for 10x the resources if possible", "originalCommit": "0706c9b1e680438a35e6a121b4c03a0150f71ca1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bf479b7a21cb4dbd9e93c065c3835e8f88d0f0f8", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingMiner.java b/src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingMiner.java\nindex a9d4be639f..1e522e0785 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingMiner.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/workerbuildings/BuildingMiner.java\n\n@@ -172,7 +172,8 @@ public class BuildingMiner extends AbstractBuildingStructureBuilder\n      * The Miner wants to get multiple nodes/levels worth of stuff when requesting.\n      */\n     @Override\n-    public int getResourceBatchMultiplier() {\n+    public int getResourceBatchMultiplier() \n+    {\n         //Ask for 10x the resources if possible\n         return 10;\n     }\n"}}, {"oid": "8d9ddd457ca443a36dedf98c6c2475b40a326f85", "url": "https://github.com/ldtteam/minecolonies/commit/8d9ddd457ca443a36dedf98c6c2475b40a326f85", "message": "Merge branch 'version/1.15' into MinerBatch", "committedDate": "2020-07-10T16:56:49Z", "type": "commit"}, {"oid": "bf479b7a21cb4dbd9e93c065c3835e8f88d0f0f8", "url": "https://github.com/ldtteam/minecolonies/commit/bf479b7a21cb4dbd9e93c065c3835e8f88d0f0f8", "message": "Oops. Fix formatting", "committedDate": "2020-07-10T16:58:59Z", "type": "commit"}]}