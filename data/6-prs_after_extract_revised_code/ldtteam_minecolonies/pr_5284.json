{"pr_number": 5284, "pr_title": "Fix citizen request fulfilling sometimes messing up nbt", "pr_createdAt": "2020-06-24T17:20:30Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5284", "timeline": [{"oid": "af33ca7cc89c2f91c9091d81e4b2921b71d33a9b", "url": "https://github.com/ldtteam/minecolonies/commit/af33ca7cc89c2f91c9091d81e4b2921b71d33a9b", "message": "Fix citizen request fulfilling sometimes messing up nbt", "committedDate": "2020-06-24T17:18:12Z", "type": "commit"}, {"oid": "631a6877b4ccaa3d4c1dcc5691d478bb638729e1", "url": "https://github.com/ldtteam/minecolonies/commit/631a6877b4ccaa3d4c1dcc5691d478bb638729e1", "message": "bump forge", "committedDate": "2020-06-24T17:26:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4NzQ5Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5284#discussion_r445087497", "bodyText": "Just use ItemStackUtils equal method .", "author": "Raycoms", "createdAt": "2020-06-24T18:24:48Z", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/TransferItemsToCitizenRequestMessage.java", "diffHunk": "@@ -126,7 +126,7 @@ protected void onExecute(final NetworkEvent.Context ctxIn, final boolean isLogic\n             int amountToRemoveFromPlayer = amountToTake - ItemStackUtils.getSize(remainingItemStack);\n             while (amountToRemoveFromPlayer > 0)\n             {\n-                final int slot = InventoryUtils.findFirstSlotInItemHandlerWith(new InvWrapper(player.inventory), stack -> stack.isItemEqual(itemStack));\n+                final int slot = InventoryUtils.findFirstSlotInItemHandlerWith(new InvWrapper(player.inventory), stack -> stack.isItemEqual(itemStack) && ItemStack.areItemStackTagsEqual(stack, itemStack));", "originalCommit": "631a6877b4ccaa3d4c1dcc5691d478bb638729e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4ODE1Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5284#discussion_r445088156", "bodyText": "Its like this in containers, so i just stole it from there, is that wrong?", "author": "ToMe25", "createdAt": "2020-06-24T18:26:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4NzQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4ODc3NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5284#discussion_r445088774", "bodyText": "also there is no ItemStackUtils.equal(), or am i not seeing some third ItemStackUtils?", "author": "ToMe25", "createdAt": "2020-06-24T18:27:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4NzQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA5NjIzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5284#discussion_r445096237", "bodyText": "done.", "author": "ToMe25", "createdAt": "2020-06-24T18:41:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTA4NzQ5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "50f5c831011be12b0093dec612766f8cddc83a98", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/TransferItemsToCitizenRequestMessage.java b/src/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/TransferItemsToCitizenRequestMessage.java\nindex 41a460c70..aff2728a3 100644\n--- a/src/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/TransferItemsToCitizenRequestMessage.java\n+++ b/src/main/java/com/minecolonies/coremod/network/messages/server/colony/citizen/TransferItemsToCitizenRequestMessage.java\n\n@@ -126,7 +126,7 @@ public class TransferItemsToCitizenRequestMessage extends AbstractColonyServerMe\n             int amountToRemoveFromPlayer = amountToTake - ItemStackUtils.getSize(remainingItemStack);\n             while (amountToRemoveFromPlayer > 0)\n             {\n-                final int slot = InventoryUtils.findFirstSlotInItemHandlerWith(new InvWrapper(player.inventory), stack -> stack.isItemEqual(itemStack) && ItemStack.areItemStackTagsEqual(stack, itemStack));\n+                final int slot = InventoryUtils.findFirstSlotInItemHandlerWith(new InvWrapper(player.inventory), stack -> ItemStackUtils.compareItemStacksIgnoreStackSize(stack, itemStack));\n                 final ItemStack itemsTaken = player.inventory.decrStackSize(slot, amountToRemoveFromPlayer);\n                 amountToRemoveFromPlayer -= ItemStackUtils.getSize(itemsTaken);\n             }\n"}}, {"oid": "50f5c831011be12b0093dec612766f8cddc83a98", "url": "https://github.com/ldtteam/minecolonies/commit/50f5c831011be12b0093dec612766f8cddc83a98", "message": "use ItemStackUtils.compareItemStacksIgnoreStackSize to compare the stack\n\nwhat a needlessly long name tho", "committedDate": "2020-06-24T18:40:02Z", "type": "commit"}]}