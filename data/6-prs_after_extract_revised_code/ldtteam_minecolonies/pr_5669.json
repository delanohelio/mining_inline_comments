{"pr_number": 5669, "pr_title": "Add auto-hire from training centers", "pr_createdAt": "2020-08-28T18:27:57Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5669", "timeline": [{"oid": "9e9e41c96d1f9629ab1f45ccdb1721a759925aa9", "url": "https://github.com/ldtteam/minecolonies/commit/9e9e41c96d1f9629ab1f45ccdb1721a759925aa9", "message": "Add auto-hire from training centers", "committedDate": "2020-08-28T18:25:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ5ODY0Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5669#discussion_r479498642", "bodyText": "actually you can do the whole find of job + find best skill logic with one single loop instead, that should be a lot better performance wise, since you only need to find the best skilled one", "author": "someaddons", "createdAt": "2020-08-28T19:36:19Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java", "diffHunk": "@@ -454,7 +470,38 @@ public PlayerEntity getPlayerToFollowOrRally()\n     @Override\n     public void onColonyTick(@NotNull final IColony colony)\n     {\n-        super.onColonyTick(colony);\n+\n+        // If we have no active worker, attempt to grab one from the appropriate trainer\n+        if (hireTrainees && !isFull() && ((getBuildingLevel() > 0 && isBuilt()))\n+              && (this.getHiringMode() == HiringMode.DEFAULT && !this.getColony().isManualHiring() || this.getHiringMode() == HiringMode.AUTO))\n+        {\n+            List<ICitizenData> trainingCitizens = null;\n+            \n+            if(this.getGuardType() == ModGuardTypes.ranger)\n+            {\n+                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobArcherTraining).collect(Collectors.toList());\n+            }\n+            else if (this.getGuardType() == ModGuardTypes.knight)\n+            {\n+                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobCombatTraining).collect(Collectors.toList());\n+            }\n+\n+            if(trainingCitizens != null && !trainingCitizens.isEmpty())\n+            {\n+                Comparator<ICitizenData> skillComparator = Comparator.comparingInt(e -> e.getCitizenSkillHandler().getLevel(job.getPrimarySkill()));", "originalCommit": "9e9e41c96d1f9629ab1f45ccdb1721a759925aa9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTUyMzgxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5669#discussion_r479523817", "bodyText": "Yup. Cleaned up.", "author": "Mekle001", "createdAt": "2020-08-28T20:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ5ODY0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "04a13683a58922ecfaa29716c444d712c861359f", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java\nindex 647089740..32591f0db 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingGuards.java\n\n@@ -475,29 +475,23 @@ public abstract class AbstractBuildingGuards extends AbstractBuildingWorker impl\n         if (hireTrainees && !isFull() && ((getBuildingLevel() > 0 && isBuilt()))\n               && (this.getHiringMode() == HiringMode.DEFAULT && !this.getColony().isManualHiring() || this.getHiringMode() == HiringMode.AUTO))\n         {\n-            List<ICitizenData> trainingCitizens = null;\n-            \n-            if(this.getGuardType() == ModGuardTypes.ranger)\n-            {\n-                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobArcherTraining).collect(Collectors.toList());\n-            }\n-            else if (this.getGuardType() == ModGuardTypes.knight)\n-            {\n-                trainingCitizens = colony.getCitizenManager().getCitizens().stream().filter(x -> x.getJob() instanceof JobCombatTraining).collect(Collectors.toList());\n-            }\n+            ICitizenData trainingCitizen = null;\n+            int maxSkill = 0;\n \n-            if(trainingCitizens != null && !trainingCitizens.isEmpty())\n+            for(ICitizenData trainee:colony.getCitizenManager().getCitizens())\n             {\n-                Comparator<ICitizenData> skillComparator = Comparator.comparingInt(e -> e.getCitizenSkillHandler().getLevel(job.getPrimarySkill()));\n-                skillComparator = skillComparator.reversed();\n-                trainingCitizens.sort(skillComparator);\n-\n-                final ICitizenData traineeCitizen = trainingCitizens.get(0);\n-                if (traineeCitizen != null)\n+                if((this.getGuardType() == ModGuardTypes.ranger && trainee instanceof JobArcherTraining) || (this.getGuardType() == ModGuardTypes.knight && trainee instanceof JobCombatTraining)\n+                    &&  trainee.getCitizenSkillHandler().getLevel(job.getPrimarySkill()) > maxSkill)\n                 {\n-                    assignCitizen(traineeCitizen);\n+                    maxSkill = trainee.getCitizenSkillHandler().getLevel(job.getPrimarySkill());\n+                    trainingCitizen = trainee;\n                 }\n             }\n+\n+            if(trainingCitizen != null )\n+            {\n+                assignCitizen(trainingCitizen);\n+            }\n         }\n \n         super.onColonyTick(colony); \n"}}, {"oid": "3e1d020379b158354e2d97f0025e17be56f2a5a4", "url": "https://github.com/ldtteam/minecolonies/commit/3e1d020379b158354e2d97f0025e17be56f2a5a4", "message": "Add training facilities to max citizens", "committedDate": "2020-08-28T20:36:48Z", "type": "commit"}, {"oid": "04a13683a58922ecfaa29716c444d712c861359f", "url": "https://github.com/ldtteam/minecolonies/commit/04a13683a58922ecfaa29716c444d712c861359f", "message": "Review Feedback", "committedDate": "2020-08-28T20:37:04Z", "type": "commit"}, {"oid": "ad39eeeedf7a7a53e27bcdb79728bf8d04c19928", "url": "https://github.com/ldtteam/minecolonies/commit/ad39eeeedf7a7a53e27bcdb79728bf8d04c19928", "message": "Javadoc", "committedDate": "2020-08-29T17:57:50Z", "type": "commit"}]}