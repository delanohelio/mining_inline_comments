{"pr_number": 6196, "pr_title": "Fixes and pathing improvements", "pr_createdAt": "2020-12-04T12:02:59Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/6196", "timeline": [{"oid": "812f13e62818c7db252abb4a8f5c027dd33baab4", "url": "https://github.com/ldtteam/minecolonies/commit/812f13e62818c7db252abb4a8f5c027dd33baab4", "message": "Pathing and other fixes", "committedDate": "2020-12-04T11:19:14Z", "type": "commit"}, {"oid": "7ee7248ef5a13b3909c00b40beec7add5f011fc2", "url": "https://github.com/ldtteam/minecolonies/commit/7ee7248ef5a13b3909c00b40beec7add5f011fc2", "message": "fix drop not beeing allowed when dropping", "committedDate": "2020-12-04T12:01:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536055965", "bodyText": "I sthis enough to have this here, what happens if combat finishes and they are hungry, or try to retreat with low health?", "author": "Raycoms", "createdAt": "2020-12-04T12:12:33Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/AbstractEntityAIGuard.java", "diffHunk": "@@ -438,6 +440,11 @@ private IAIState checkAndAttackTarget()\n         if (fighttimer > 0)\n         {\n             fighttimer--;\n+            if (fighttimer == 0)", "originalCommit": "7ee7248ef5a13b3909c00b40beec7add5f011fc2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzQxMw==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536057413", "bodyText": "ye because this is the point which also prevents the interruption of the other AI's", "author": "someaddons", "createdAt": "2020-12-04T12:15:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NzgwOA==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536057808", "bodyText": "kk", "author": "Raycoms", "createdAt": "2020-12-04T12:16:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA1NTk2NQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a", "url": "https://github.com/ldtteam/minecolonies/commit/4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a", "message": "Fix raids not spawning at low levels\nFix AI getting stuck when removing tasks\nFix citizen loading the colony to find the team, when not needed to do so", "committedDate": "2020-12-04T15:34:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU1MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536833551", "bodyText": "Are we sure this can not produce an NPE?\nWould a getOrDefault(..., Collections.emptyList()) not be better here just to be sure.", "author": "OrionDevelopment", "createdAt": "2020-12-05T18:07:21Z", "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "diffHunk": "@@ -92,15 +92,11 @@ public void removeTransition(final T transition)\n     {\n         if (transition instanceof IStateMachineEvent)\n         {\n-            final List<T> temp = new ArrayList<>(eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()));\n-            temp.remove(transition);\n-            eventTransitionMap.put(((IStateMachineEvent<?>) transition).getEventType(), temp);\n+            eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()).removeIf(t -> t == transition);", "originalCommit": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg4MDIyNg==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536880226", "bodyText": "ye it would indeed cause and NPE, thought that too when writing it and just left it to crash as sth must be wrong when trying to remove one that isnt added at all", "author": "someaddons", "createdAt": "2020-12-05T19:42:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU1MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjgzMzU3MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/6196#discussion_r536833571", "bodyText": "See other comments in the file.", "author": "OrionDevelopment", "createdAt": "2020-12-05T18:07:33Z", "path": "src/api/java/com/minecolonies/api/entity/ai/statemachine/basestatemachine/BasicStateMachine.java", "diffHunk": "@@ -92,15 +92,11 @@ public void removeTransition(final T transition)\n     {\n         if (transition instanceof IStateMachineEvent)\n         {\n-            final List<T> temp = new ArrayList<>(eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()));\n-            temp.remove(transition);\n-            eventTransitionMap.put(((IStateMachineEvent<?>) transition).getEventType(), temp);\n+            eventTransitionMap.get(((IStateMachineEvent<?>) transition).getEventType()).removeIf(t -> t == transition);\n         }\n         else\n         {\n-            final List<T> temp = new ArrayList<>(transitionMap.get(transition.getState()));\n-            temp.remove(transition);\n-            transitionMap.put(transition.getState(), temp);\n+            transitionMap.get(transition.getState()).removeIf(t -> t == transition);", "originalCommit": "4f72583dfb43e11f3c4b6d039635cf96e8fc1a0a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}