{"pr_number": 4215, "pr_title": "Add Permission Check to Visitor Notification", "pr_createdAt": "2020-01-08T06:39:24Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4215", "timeline": [{"oid": "54e46a36aa03d580748ee4d1c276934fe1d53e87", "url": "https://github.com/ldtteam/minecolonies/commit/54e46a36aa03d580748ee4d1c276934fe1d53e87", "message": "Add permissions check for visiting players to see if the notify message should be sent to local players.\n\nThis is to help with servers where admins want the ability be silently enter areas while invisble and not have players notified.", "committedDate": "2020-01-08T06:29:45Z", "type": "commit"}, {"oid": "73b82fd35be87e9cc8f3bd0d9a354c2d377c8419", "url": "https://github.com/ldtteam/minecolonies/commit/73b82fd35be87e9cc8f3bd0d9a354c2d377c8419", "message": "Cleanup unused imports that were imported while trying to remember how to access forge permission api.", "committedDate": "2020-01-08T06:33:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDExNzM0OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4215#discussion_r364117349", "bodyText": "make this an or if the player is OP", "author": "Asherslab", "createdAt": "2020-01-08T08:46:32Z", "path": "src/main/java/com/minecolonies/coremod/colony/Colony.java", "diffHunk": "@@ -1476,7 +1477,9 @@ public void addVisitingPlayer(final EntityPlayer player)\n         {\n             visitingPlayers.add(player);\n             LanguageHandler.sendPlayerMessage(player, ENTERING_COLONY_MESSAGE, this.getPermissions().getOwnerName());\n-            LanguageHandler.sendPlayersMessage(getImportantMessageEntityPlayers(), ENTERING_COLONY_MESSAGE_NOTIFY, player.getName(), this.getName());\n+            if(!PermissionAPI.hasPermission(player, \"minecolonies.colony.visitor.silent\")) {", "originalCommit": "73b82fd35be87e9cc8f3bd0d9a354c2d377c8419", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTA2MTM4OA==", "url": "https://github.com/ldtteam/minecolonies/pull/4215#discussion_r365061388", "bodyText": "Added the permission by default to operator in MineColonies.java. Seemed cleaner then directly checking for operator status here (only way I know to check it is to grab the operator list and see if UUID is in it).\nThis does have the slight disadvantage though for users of default Forge perm handler in single player that Forge considers everyone operator if they are allowed to run all commands (See DefaultPermissionsHandler.java in Forge).", "author": "cjm721", "createdAt": "2020-01-10T03:39:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDExNzM0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "e7bd009e6fc76660a95c74adb743afa1078d8e7a", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/Colony.java b/src/main/java/com/minecolonies/coremod/colony/Colony.java\nindex 16f9814b31..2a04196328 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/Colony.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/Colony.java\n\n@@ -1477,7 +1477,7 @@ public class Colony implements IColony\n         {\n             visitingPlayers.add(player);\n             LanguageHandler.sendPlayerMessage(player, ENTERING_COLONY_MESSAGE, this.getPermissions().getOwnerName());\n-            if(!PermissionAPI.hasPermission(player, \"minecolonies.colony.visitor.silent\")) {\n+            if(!PermissionAPI.hasPermission(player, COLONY_SILENT_VISITOR_PERMISSION)) {\n                 LanguageHandler.sendPlayersMessage(getImportantMessageEntityPlayers(), ENTERING_COLONY_MESSAGE_NOTIFY, player.getName(), this.getName());\n             }\n         }\n"}}, {"oid": "6c75db8c80fdc5de77cb0a892985ced72efce1fa", "url": "https://github.com/ldtteam/minecolonies/commit/6c75db8c80fdc5de77cb0a892985ced72efce1fa", "message": "Merge branch 'version/1.12' into version/1.12", "committedDate": "2020-01-08T08:46:40Z", "type": "commit"}, {"oid": "e7bd009e6fc76660a95c74adb743afa1078d8e7a", "url": "https://github.com/ldtteam/minecolonies/commit/e7bd009e6fc76660a95c74adb743afa1078d8e7a", "message": "Add permission to Operators by default for silent entry.", "committedDate": "2020-01-10T03:34:32Z", "type": "commit"}, {"oid": "3d7d0d820dcee66b0897ef5b05ad6514d07b60ba", "url": "https://github.com/ldtteam/minecolonies/commit/3d7d0d820dcee66b0897ef5b05ad6514d07b60ba", "message": "Merge branch 'version/1.12' of https://github.com/CJ-MC-Mods/minecolonies into version/1.12", "committedDate": "2020-01-10T03:34:37Z", "type": "commit"}, {"oid": "8bbab7dcbc71e505f5542d025059157592d2a952", "url": "https://github.com/ldtteam/minecolonies/commit/8bbab7dcbc71e505f5542d025059157592d2a952", "message": "Missed a space in style for Colony Class", "committedDate": "2020-01-10T03:42:34Z", "type": "commit"}, {"oid": "9767b88c245f7fa8dbea3aba65f31568f29a43ab", "url": "https://github.com/ldtteam/minecolonies/commit/9767b88c245f7fa8dbea3aba65f31568f29a43ab", "message": "Merge branch 'version/1.12' into version/1.12", "committedDate": "2020-01-10T06:33:34Z", "type": "commit"}, {"oid": "a9fa84409d5f0c75edcef1436a915ded90c354ac", "url": "https://github.com/ldtteam/minecolonies/commit/a9fa84409d5f0c75edcef1436a915ded90c354ac", "message": "Add a config option to enable or disable the silent visiting of colonies by operators.", "committedDate": "2020-01-10T09:03:30Z", "type": "commit"}]}