{"pr_number": 5522, "pr_title": "More fixes", "pr_createdAt": "2020-08-08T08:56:13Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5522", "timeline": [{"oid": "cb17558526229901d3b659d278b354c91a2807f0", "url": "https://github.com/ldtteam/minecolonies/commit/cb17558526229901d3b659d278b354c91a2807f0", "message": "fix #5498", "committedDate": "2020-08-08T08:54:22Z", "type": "commit"}, {"oid": "7125e84cae2a36f6fdfed74ae763cfe9032092ad", "url": "https://github.com/ldtteam/minecolonies/commit/7125e84cae2a36f6fdfed74ae763cfe9032092ad", "message": "fix #5513", "committedDate": "2020-08-08T08:54:38Z", "type": "commit"}, {"oid": "1e44907000d6c771cb6cd7b299baa1a29afd2d29", "url": "https://github.com/ldtteam/minecolonies/commit/1e44907000d6c771cb6cd7b299baa1a29afd2d29", "message": "fix #5515", "committedDate": "2020-08-08T09:32:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQyNTk1Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5522#discussion_r467425953", "bodyText": "save the value, you're re-executing the very same below", "author": "someaddons", "createdAt": "2020-08-08T09:41:38Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIStructureWithWorkOrder.java", "diffHunk": "@@ -178,7 +178,8 @@ private void requestMaterialsState()\n             final AbstractBuildingStructureBuilder buildingWorker = getOwnBuilding();\n             job.getWorkOrder().setRequested(true);\n \n-            if (job.getWorkOrder().getAmountOfRes() == 0)\n+            if (job.getWorkOrder().getAmountOfRes() == 0 || buildingWorker.getNeededResources().values().stream()\n+                                                              .mapToInt(ItemStorage::getAmount).sum() > job.getWorkOrder().getAmountOfRes())", "originalCommit": "1e44907000d6c771cb6cd7b299baa1a29afd2d29", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4859262d20d11ba823756702bcf17d7ecfecb0d4", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIStructureWithWorkOrder.java b/src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIStructureWithWorkOrder.java\nindex 1b349f8a4b..1b82bee438 100755\n--- a/src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIStructureWithWorkOrder.java\n+++ b/src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAIStructureWithWorkOrder.java\n\n@@ -178,11 +178,10 @@ public abstract class AbstractEntityAIStructureWithWorkOrder<J extends AbstractJ\n             final AbstractBuildingStructureBuilder buildingWorker = getOwnBuilding();\n             job.getWorkOrder().setRequested(true);\n \n-            if (job.getWorkOrder().getAmountOfRes() == 0 || buildingWorker.getNeededResources().values().stream()\n-                                                              .mapToInt(ItemStorage::getAmount).sum() > job.getWorkOrder().getAmountOfRes())\n+            int newQuantity = buildingWorker.getNeededResources().values().stream().mapToInt(ItemStorage::getAmount).sum();\n+            if (job.getWorkOrder().getAmountOfRes() == 0 || newQuantity > job.getWorkOrder().getAmountOfRes())\n             {\n-                job.getWorkOrder().setAmountOfRes(buildingWorker.getNeededResources().values().stream()\n-                                                    .mapToInt(ItemStorage::getAmount).sum());\n+                job.getWorkOrder().setAmountOfRes(newQuantity);\n             }\n         }\n     }\n"}}, {"oid": "489886973307c5881c313f9f1ee1ca0bd7404ce6", "url": "https://github.com/ldtteam/minecolonies/commit/489886973307c5881c313f9f1ee1ca0bd7404ce6", "message": "fix", "committedDate": "2020-08-08T09:52:47Z", "type": "commit"}, {"oid": "4859262d20d11ba823756702bcf17d7ecfecb0d4", "url": "https://github.com/ldtteam/minecolonies/commit/4859262d20d11ba823756702bcf17d7ecfecb0d4", "message": "adjust to review", "committedDate": "2020-08-08T09:54:25Z", "type": "commit"}]}