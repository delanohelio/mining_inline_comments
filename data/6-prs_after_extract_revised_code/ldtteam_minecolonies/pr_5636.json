{"pr_number": 5636, "pr_title": "Feature/improvements", "pr_createdAt": "2020-08-22T16:26:19Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5636", "timeline": [{"oid": "ce6464440b39b86aaafab49fb107d27aab1c11cb", "url": "https://github.com/ldtteam/minecolonies/commit/ce6464440b39b86aaafab49fb107d27aab1c11cb", "message": "Some small fixes", "committedDate": "2020-08-22T09:17:29Z", "type": "commit"}, {"oid": "2a252cd3275fa923d7ba44787c78c2e9a6866f6b", "url": "https://github.com/ldtteam/minecolonies/commit/2a252cd3275fa923d7ba44787c78c2e9a6866f6b", "message": "Static super class building  + add rack tracer", "committedDate": "2020-08-22T16:24:37Z", "type": "commit"}, {"oid": "fbf4f8a6670e9ac069f398f142b61dce1e97f2de", "url": "https://github.com/ldtteam/minecolonies/commit/fbf4f8a6670e9ac069f398f142b61dce1e97f2de", "message": "fixes", "committedDate": "2020-08-22T16:28:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODAyMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475108023", "bodyText": "Is this only highlighting a single rack, what about connected racks?", "author": "Mekle001", "createdAt": "2020-08-22T16:43:49Z", "path": "src/main/java/com/minecolonies/coremod/event/HighlightManager.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.minecolonies.coremod.event;\n+\n+import com.ldtteam.structurize.util.RenderUtils;\n+import com.minecolonies.api.util.Tuple;\n+import com.mojang.blaze3d.vertex.IVertexBuilder;\n+import net.minecraft.client.Minecraft;\n+import net.minecraft.client.renderer.IRenderTypeBuffer;\n+import net.minecraft.client.renderer.RenderTypeBuffers;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.api.distmarker.Dist;\n+import net.minecraftforge.api.distmarker.OnlyIn;\n+import net.minecraftforge.client.event.RenderWorldLastEvent;\n+import net.minecraftforge.eventbus.api.EventPriority;\n+import net.minecraftforge.eventbus.api.SubscribeEvent;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Supplier;\n+\n+@OnlyIn(Dist.CLIENT)\n+public class HighlightManager\n+{\n+    /**\n+     * A position to highlight with a unique id.\n+     */\n+    @Nullable\n+    public static final Map<String, Tuple<BlockPos, Long>> HIGHLIGHT_MAP = new HashMap<>();\n+\n+    /**\n+     * Render buffers.\n+     */\n+    public static final  RenderTypeBuffers        renderBuffers            = new RenderTypeBuffers();\n+    private static final IRenderTypeBuffer.Impl   renderBuffer             = renderBuffers.getBufferSource();\n+    private static final Supplier<IVertexBuilder> linesWithoutCullAndDepth = () -> renderBuffer.getBuffer(RenderUtils.LINES_GLINT);\n+\n+    /**\n+     * Used to catch the renderWorldLastEvent in order to draw the debug nodes for pathfinding.\n+     *\n+     * @param event the catched event.\n+     */\n+    @SubscribeEvent(priority = EventPriority.LOW)\n+    public static void renderWorldLastEvent(@NotNull final RenderWorldLastEvent event)\n+    {\n+        if (!HIGHLIGHT_MAP.isEmpty())\n+        {\n+            final long worldTime = Minecraft.getInstance().world.getGameTime();\n+            for (final Map.Entry<String, Tuple<BlockPos, Long>> entry : new ArrayList<>(HIGHLIGHT_MAP.entrySet()))\n+            {\n+                if (entry.getValue().getB() <= worldTime)\n+                {\n+                    HIGHLIGHT_MAP.remove(entry.getKey());\n+                }\n+                else\n+                {\n+                    RenderUtils.renderBox(entry.getValue().getA(), entry.getValue().getA(), 0, 1, 0, 1.0F, 0.002D, event.getMatrixStack(), linesWithoutCullAndDepth.get());", "originalCommit": "fbf4f8a6670e9ac069f398f142b61dce1e97f2de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODU3Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475108572", "bodyText": "We don't know about connected racks in this part of the code. So it's better to just show the half that contains it. If it's a connected rack it will display the half that contains it. So either way the player will click the right one", "author": "Raycoms", "createdAt": "2020-08-22T16:49:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODAyMw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODA5OA==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475108098", "bodyText": "I believe this is a significant increase in crafting speed, not just a visual change. Is that the intent?", "author": "Mekle001", "createdAt": "2020-08-22T16:44:30Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/basic/AbstractEntityAICrafting.java", "diffHunk": "@@ -36,7 +35,7 @@\n     /**\n      * Time the worker delays until the next hit.\n      */\n-    protected static final int HIT_DELAY = 20;\n+    protected static final int HIT_DELAY = 10;", "originalCommit": "fbf4f8a6670e9ac069f398f142b61dce1e97f2de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODQ0MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475108441", "bodyText": "Yes", "author": "Raycoms", "createdAt": "2020-08-22T16:48:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwODA5OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTU3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475115570", "bodyText": "use the one from render world last event, preferably also call the event from there", "author": "Nightenom", "createdAt": "2020-08-22T18:06:06Z", "path": "src/main/java/com/minecolonies/coremod/event/HighlightManager.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.minecolonies.coremod.event;\n+\n+import com.ldtteam.structurize.util.RenderUtils;\n+import com.minecolonies.api.util.Tuple;\n+import com.mojang.blaze3d.vertex.IVertexBuilder;\n+import net.minecraft.client.Minecraft;\n+import net.minecraft.client.renderer.IRenderTypeBuffer;\n+import net.minecraft.client.renderer.RenderTypeBuffers;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraftforge.api.distmarker.Dist;\n+import net.minecraftforge.api.distmarker.OnlyIn;\n+import net.minecraftforge.client.event.RenderWorldLastEvent;\n+import net.minecraftforge.eventbus.api.EventPriority;\n+import net.minecraftforge.eventbus.api.SubscribeEvent;\n+import org.jetbrains.annotations.NotNull;\n+import org.jetbrains.annotations.Nullable;\n+\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.function.Supplier;\n+\n+@OnlyIn(Dist.CLIENT)\n+public class HighlightManager\n+{\n+    /**\n+     * A position to highlight with a unique id.\n+     */\n+    @Nullable\n+    public static final Map<String, Tuple<BlockPos, Long>> HIGHLIGHT_MAP = new HashMap<>();\n+\n+    /**\n+     * Render buffers.\n+     */\n+    public static final  RenderTypeBuffers        renderBuffers            = new RenderTypeBuffers();", "originalCommit": "fbf4f8a6670e9ac069f398f142b61dce1e97f2de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExODY4NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475118685", "bodyText": "I didn't call it from there just for separation on concerns. I think I can't reuse it then either because I can't close it at both places I'd guess?", "author": "Raycoms", "createdAt": "2020-08-22T18:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTU3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEzODgyOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5636#discussion_r475138828", "bodyText": "no need to separate it, RenderTypeBuffers are the reason the entire rendering is reuseable and doesn't need tesselator anymore, side note: we should be using vanilla instance but in current event design it's impossible", "author": "Nightenom", "createdAt": "2020-08-22T21:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTExNTU3MA=="}], "type": "inlineReview", "revised_code": null}]}