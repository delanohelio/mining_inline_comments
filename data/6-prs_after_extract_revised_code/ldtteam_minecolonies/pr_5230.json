{"pr_number": 5230, "pr_title": "Feature/new workers", "pr_createdAt": "2020-06-15T10:08:49Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5230", "timeline": [{"oid": "9359bfb560068565313e7b6351f44d86ffff6a57", "url": "https://github.com/ldtteam/minecolonies/commit/9359bfb560068565313e7b6351f44d86ffff6a57", "message": "Add a new reposition approach", "committedDate": "2020-06-13T11:28:40Z", "type": "commit"}, {"oid": "566e2cbc4fca7876a7d0c4dada64e018b9e27093", "url": "https://github.com/ldtteam/minecolonies/commit/566e2cbc4fca7876a7d0c4dada64e018b9e27093", "message": "Add a fix for weird AI interactions", "committedDate": "2020-06-13T13:54:52Z", "type": "commit"}, {"oid": "888945341e1d15f7c4d789ff7c1d87b88ba5b122", "url": "https://github.com/ldtteam/minecolonies/commit/888945341e1d15f7c4d789ff7c1d87b88ba5b122", "message": "unblock dman", "committedDate": "2020-06-13T14:06:48Z", "type": "commit"}, {"oid": "d3d009d4c90a8266bbf238096adf96ed759859c2", "url": "https://github.com/ldtteam/minecolonies/commit/d3d009d4c90a8266bbf238096adf96ed759859c2", "message": "Initial setup for rabbit hutch and concrete worker", "committedDate": "2020-06-13T15:29:46Z", "type": "commit"}, {"oid": "477bbccba0a8d2d96bbc3e2cafa677933666d360", "url": "https://github.com/ldtteam/minecolonies/commit/477bbccba0a8d2d96bbc3e2cafa677933666d360", "message": "fix #5221", "committedDate": "2020-06-13T18:21:05Z", "type": "commit"}, {"oid": "e6a74f6d0d9925769ab5bf01af70f4851848d7d5", "url": "https://github.com/ldtteam/minecolonies/commit/e6a74f6d0d9925769ab5bf01af70f4851848d7d5", "message": "Further setup", "committedDate": "2020-06-13T18:31:20Z", "type": "commit"}, {"oid": "f3c1a373d7cc6a19385e389f100878575e806afd", "url": "https://github.com/ldtteam/minecolonies/commit/f3c1a373d7cc6a19385e389f100878575e806afd", "message": "add mechanic and fletcher model", "committedDate": "2020-06-13T19:21:41Z", "type": "commit"}, {"oid": "6b31b99c2341d7cd2577932098ca0bd0814c162c", "url": "https://github.com/ldtteam/minecolonies/commit/6b31b99c2341d7cd2577932098ca0bd0814c162c", "message": "Further setup (rabbit AI is finished)\n\nAdd and finish block models too", "committedDate": "2020-06-14T11:21:34Z", "type": "commit"}, {"oid": "012ac6763e0aaf37ea9365adc761995564283197", "url": "https://github.com/ldtteam/minecolonies/commit/012ac6763e0aaf37ea9365adc761995564283197", "message": "Finish models, and first part of concrete mixer AI", "committedDate": "2020-06-14T17:22:51Z", "type": "commit"}, {"oid": "674a9402879fa94877477a35bf1615c40ca71cc7", "url": "https://github.com/ldtteam/minecolonies/commit/674a9402879fa94877477a35bf1615c40ca71cc7", "message": "fix #5228", "committedDate": "2020-06-15T09:07:53Z", "type": "commit"}, {"oid": "bb715ff951b039ff96cce24098a2eee6ffb680f6", "url": "https://github.com/ldtteam/minecolonies/commit/bb715ff951b039ff96cce24098a2eee6ffb680f6", "message": "Fix concrete worker", "committedDate": "2020-06-15T10:07:58Z", "type": "commit"}, {"oid": "6564dc5e3cbb6aaa75dc1d67139bb50eeb5b3fec", "url": "https://github.com/ldtteam/minecolonies/commit/6564dc5e3cbb6aaa75dc1d67139bb50eeb5b3fec", "message": "texture fixes", "committedDate": "2020-06-15T10:19:10Z", "type": "commit"}, {"oid": "94943fe36797abe154291348dd3672a0816f90fe", "url": "https://github.com/ldtteam/minecolonies/commit/94943fe36797abe154291348dd3672a0816f90fe", "message": "Merge remote-tracking branch 'origin/version/1.15' into feature/new-workers", "committedDate": "2020-06-15T12:11:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI2NjY1OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5230#discussion_r440266659", "bodyText": "does it not matte if the stack has a fitting size, or maybe just is 1?", "author": "someaddons", "createdAt": "2020-06-15T15:38:00Z", "path": "src/api/java/com/minecolonies/api/util/InventoryUtils.java", "diffHunk": "@@ -2664,6 +2664,25 @@ public static void reduceStackInItemHandler(final IItemHandler invWrapper, final\n                 return;\n             }\n         }\n+    }\n \n+    /**\n+     * Search for a certain itemStack in the inventory and decrease it by a certain quantity.\n+     * @param invWrapper the inventory item handler.\n+     * @param itemStack the itemStack to decrease.\n+     * @param quantity the quantity.\n+     * @return true if successfully.\n+     */\n+    public static boolean attemptReduceStackInItemHandler(final IItemHandler invWrapper, final ItemStack itemStack, final int quantity)\n+    {\n+        for (int i = 0; i < invWrapper.getSlots(); i++)\n+        {\n+            if(invWrapper.getStackInSlot(i).isItemEqual(itemStack))\n+            {\n+                invWrapper.getStackInSlot(i).shrink(quantity);", "originalCommit": "94943fe36797abe154291348dd3672a0816f90fe", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5cf9ab0f7cb590684604c714b4d4b9cfea0b2c65", "chunk": "diff --git a/src/api/java/com/minecolonies/api/util/InventoryUtils.java b/src/api/java/com/minecolonies/api/util/InventoryUtils.java\nindex 6337a22c0..f8c3c93b9 100644\n--- a/src/api/java/com/minecolonies/api/util/InventoryUtils.java\n+++ b/src/api/java/com/minecolonies/api/util/InventoryUtils.java\n\n@@ -2675,12 +2675,27 @@ public class InventoryUtils\n      */\n     public static boolean attemptReduceStackInItemHandler(final IItemHandler invWrapper, final ItemStack itemStack, final int quantity)\n     {\n+        if (getItemCountInItemHandler(invWrapper, stack -> !stack.isEmpty() && stack.isItemEqual(itemStack)) < quantity)\n+        {\n+            return false;\n+        }\n+\n+        int qty = quantity;\n         for (int i = 0; i < invWrapper.getSlots(); i++)\n         {\n-            if(invWrapper.getStackInSlot(i).isItemEqual(itemStack))\n+            final ItemStack stack = invWrapper.getStackInSlot(i);\n+            if(stack.isItemEqual(itemStack))\n             {\n-                invWrapper.getStackInSlot(i).shrink(quantity);\n-                return true;\n+                if (stack.getCount() >= qty)\n+                {\n+                    stack.shrink(qty);\n+                    return true;\n+                }\n+                else\n+                {\n+                    qty -= stack.getCount();\n+                    invWrapper.extractItem(i, stack.getCount(), false);\n+                }\n             }\n         }\n         return false;\n"}}, {"oid": "5cf9ab0f7cb590684604c714b4d4b9cfea0b2c65", "url": "https://github.com/ldtteam/minecolonies/commit/5cf9ab0f7cb590684604c714b4d4b9cfea0b2c65", "message": "fix", "committedDate": "2020-06-15T17:55:11Z", "type": "commit"}, {"oid": "a7b2b0782f265c0a65ef03ed337a93d572f00ace", "url": "https://github.com/ldtteam/minecolonies/commit/a7b2b0782f265c0a65ef03ed337a93d572f00ace", "message": "change to extract", "committedDate": "2020-06-15T17:59:55Z", "type": "commit"}, {"oid": "e59258459d8e9c56cf7139be0647cb3c56e4a743", "url": "https://github.com/ldtteam/minecolonies/commit/e59258459d8e9c56cf7139be0647cb3c56e4a743", "message": "Merge remote-tracking branch 'origin/version/1.15' into feature/new-workers", "committedDate": "2020-06-21T10:34:08Z", "type": "commit"}]}