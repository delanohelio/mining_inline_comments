{"pr_number": 4850, "pr_title": "Refactors all our network messages", "pr_createdAt": "2020-05-02T17:44:56Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4850", "timeline": [{"oid": "730abbe572cb7190e23d9a04c2142692b6034515", "url": "https://github.com/ldtteam/minecolonies/commit/730abbe572cb7190e23d9a04c2142692b6034515", "message": "network messages refactor", "committedDate": "2020-05-02T17:43:41Z", "type": "commit"}, {"oid": "2c4d6efea64a52dcd02b9d09fee6d9e757a4c7ec", "url": "https://github.com/ldtteam/minecolonies/commit/2c4d6efea64a52dcd02b9d09fee6d9e757a4c7ec", "message": "Merge branch 'version/1.15' into refactor/1.15/networking", "committedDate": "2020-05-02T17:52:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988015", "bodyText": "does this mean the permission doesn't get checked at all in this packet?", "author": "ToMe25", "createdAt": "2020-05-02T17:55:37Z", "path": "src/main/java/com/minecolonies/coremod/network/messages/server/colony/OpenInventoryMessage.java", "diffHunk": "@@ -175,30 +146,17 @@ private void doCitizenInventory(final ServerPlayerEntity player)\n         }\n     }\n \n-    private void doHutInventory(final ServerPlayerEntity player)\n+    private void doHutInventory(final ServerPlayerEntity player, final IColony colony)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n+        @NotNull final TileEntityRack chest = (TileEntityRack) BlockPosUtil.getTileEntity(player.world, tePos);\n \n-            NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colonyId).writeBlockPos(chest.getPos()));\n-        }\n+        NetworkHooks.openGui(player, chest, packetBuffer -> packetBuffer.writeVarInt(colony.getID()).writeBlockPos(chest.getPos()));\n     }\n \n     private void doFieldInventory(final ServerPlayerEntity player)\n     {\n-        if (checkPermissions(IColonyManager.getInstance().getClosestColony(player.getEntityWorld(), tePos), player))\n-        {\n-            @NotNull final ScarecrowTileEntity scarecrowTileEntity = (ScarecrowTileEntity) BlockPosUtil.getTileEntity(CompatibilityUtils.getWorldFromEntity(player), tePos);\n-            NetworkHooks.openGui(player, scarecrowTileEntity);\n-\n-        }\n-    }\n-\n-    private static boolean checkPermissions(final IColony colony, final ServerPlayerEntity player)\n-    {\n-        //Verify player has permission to change this huts settings\n-        return colony.getPermissions().hasPermission(player, Action.MANAGE_HUTS);", "originalCommit": "730abbe572cb7190e23d9a04c2142692b6034515", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODE4Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988182", "bodyText": "look at the base class: AbstractColonyServerMessage", "author": "Asherslab", "createdAt": "2020-05-02T17:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODIzNA==", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988234", "bodyText": "that's a major part of the boiler plate i removed", "author": "Asherslab", "createdAt": "2020-05-02T17:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODQ4Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/4850#discussion_r418988482", "bodyText": "Seems ok then.\nI don't know too much about minecraft/minecolonies networking, so i just looked for changes in logic that seemed important.", "author": "ToMe25", "createdAt": "2020-05-02T17:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4ODAxNQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "c01658f6cc755c1c8fef48d47c857b7d0936b094", "url": "https://github.com/ldtteam/minecolonies/commit/c01658f6cc755c1c8fef48d47c857b7d0936b094", "message": "fix compile error", "committedDate": "2020-05-02T18:02:36Z", "type": "commit"}, {"oid": "67a4b9b2d38ff22f83450f3dd29c99e7e9a62ff5", "url": "https://github.com/ldtteam/minecolonies/commit/67a4b9b2d38ff22f83450f3dd29c99e7e9a62ff5", "message": "javadoc", "committedDate": "2020-05-02T18:15:32Z", "type": "commit"}]}