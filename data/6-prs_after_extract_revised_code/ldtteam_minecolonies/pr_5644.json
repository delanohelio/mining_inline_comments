{"pr_number": 5644, "pr_title": "Enable datapack-based loading of worker specific recipes", "pr_createdAt": "2020-08-23T15:56:16Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5644", "timeline": [{"oid": "2c5577fe2436b7b4c930224f39b9d0f5fe9401b4", "url": "https://github.com/ldtteam/minecolonies/commit/2c5577fe2436b7b4c930224f39b9d0f5fe9401b4", "message": "Add support for custom recipes from data", "committedDate": "2020-08-23T15:48:26Z", "type": "commit"}, {"oid": "186bd1ce141cfd21be850f4611b8876ec65957b4", "url": "https://github.com/ldtteam/minecolonies/commit/186bd1ce141cfd21be850f4611b8876ec65957b4", "message": "Make Crusher Dynamic", "committedDate": "2020-08-23T15:52:15Z", "type": "commit"}, {"oid": "c7b416d542a2a84a53134096c0e8dc2ccc758263", "url": "https://github.com/ldtteam/minecolonies/commit/c7b416d542a2a84a53134096c0e8dc2ccc758263", "message": "Make Dyer Dynamic", "committedDate": "2020-08-23T15:52:54Z", "type": "commit"}, {"oid": "d415d6a9221389e7b261419f8003c4a2a6b008ee", "url": "https://github.com/ldtteam/minecolonies/commit/d415d6a9221389e7b261419f8003c4a2a6b008ee", "message": "Make farmer dynamic", "committedDate": "2020-08-23T15:53:05Z", "type": "commit"}, {"oid": "60bd61888f5c4c1d23acccfe4026d9a2922bf533", "url": "https://github.com/ldtteam/minecolonies/commit/60bd61888f5c4c1d23acccfe4026d9a2922bf533", "message": "Make Fletcher dynamic", "committedDate": "2020-08-23T15:53:17Z", "type": "commit"}, {"oid": "45608823a9ff843aa42018977b9bd8bccea47ab4", "url": "https://github.com/ldtteam/minecolonies/commit/45608823a9ff843aa42018977b9bd8bccea47ab4", "message": "Make Lumberjack Dynamic", "committedDate": "2020-08-23T15:53:36Z", "type": "commit"}, {"oid": "1a73469de1eb9cd30c040f918f39b64235718014", "url": "https://github.com/ldtteam/minecolonies/commit/1a73469de1eb9cd30c040f918f39b64235718014", "message": "Make Stonemason dynamic", "committedDate": "2020-08-23T15:53:50Z", "type": "commit"}, {"oid": "85bb2d5352c9b5b0852b3aeee640b4aa02e2e169", "url": "https://github.com/ldtteam/minecolonies/commit/85bb2d5352c9b5b0852b3aeee640b4aa02e2e169", "message": "clean up excess logging", "committedDate": "2020-08-23T15:58:55Z", "type": "commit"}, {"oid": "42b70b383278867cbdaa29f9fa779a084a4025fd", "url": "https://github.com/ldtteam/minecolonies/commit/42b70b383278867cbdaa29f9fa779a084a4025fd", "message": "More logging cleanup", "committedDate": "2020-08-23T18:03:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTAzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249037", "bodyText": "might need some finals around here (final Set, final CustomRecipe, final IRecipeStorage final IToken)", "author": "Raycoms", "createdAt": "2020-08-23T18:15:16Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -787,7 +789,70 @@ public boolean canEat(final ItemStack stack)\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        // Override if necessary.\n+        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTExOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249118", "bodyText": "Good point.", "author": "Mekle001", "createdAt": "2020-08-23T18:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTAzNw=="}], "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\nindex 5fc69c7b7e..003633271d 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n\n@@ -789,12 +789,12 @@ public abstract class AbstractBuildingWorker extends AbstractBuilding implements\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+        final Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n \n-        for(CustomRecipe newRecipe : staticRecipes)\n+        for(final CustomRecipe newRecipe : staticRecipes)\n         {\n-            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n-            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+            final IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            final IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n \n             if(newRecipe.isValidForColony(colony))\n             {   \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTEyNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249127", "bodyText": "formatting", "author": "Raycoms", "createdAt": "2020-08-23T18:16:21Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -787,7 +789,70 @@ public boolean canEat(final ItemStack stack)\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        // Override if necessary.\n+        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+\n+        for(CustomRecipe newRecipe : staticRecipes)\n+        {\n+            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+\n+            if(newRecipe.isValidForColony(colony))\n+            {   \n+                boolean duplicateFound = false; \n+                for(IToken<?> token : recipes)\n+                {\n+                    if(token == recipeToken)\n+                    {\n+                        duplicateFound = true;\n+                        break;\n+                    }\n+                    final IRecipeStorage storage = IColonyManager.getInstance().getRecipeManager().getRecipes().get(token);\n+\n+                    //Let's verify that this recipe doesn't exist in an improved form\n+                    if(storage != null && storage.getPrimaryOutput().equals(recipeStorage.getPrimaryOutput(), true))\n+                    {\n+                        List<ItemStorage> storageInput = storage.getCleanedInput();\n+                        List<ItemStorage> recipeInput = recipeStorage.getCleanedInput();\n+\n+                        if(storageInput.size() != recipeInput.size())\n+                        {\n+                            continue;\n+                        }\n+                        \n+                        if(storageInput.size() > 1) {\n+                            storageInput.sort(Comparator.comparing(item -> item.toString()));", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\nindex 5fc69c7b7e..003633271d 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n\n@@ -789,12 +789,12 @@ public abstract class AbstractBuildingWorker extends AbstractBuilding implements\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+        final Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n \n-        for(CustomRecipe newRecipe : staticRecipes)\n+        for(final CustomRecipe newRecipe : staticRecipes)\n         {\n-            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n-            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+            final IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            final IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n \n             if(newRecipe.isValidForColony(colony))\n             {   \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTE2Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249163", "bodyText": "maybe better recipeInput1 and recipeInput2", "author": "Raycoms", "createdAt": "2020-08-23T18:16:43Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -787,7 +789,70 @@ public boolean canEat(final ItemStack stack)\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        // Override if necessary.\n+        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+\n+        for(CustomRecipe newRecipe : staticRecipes)\n+        {\n+            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+\n+            if(newRecipe.isValidForColony(colony))\n+            {   \n+                boolean duplicateFound = false; \n+                for(IToken<?> token : recipes)\n+                {\n+                    if(token == recipeToken)\n+                    {\n+                        duplicateFound = true;\n+                        break;\n+                    }\n+                    final IRecipeStorage storage = IColonyManager.getInstance().getRecipeManager().getRecipes().get(token);\n+\n+                    //Let's verify that this recipe doesn't exist in an improved form\n+                    if(storage != null && storage.getPrimaryOutput().equals(recipeStorage.getPrimaryOutput(), true))\n+                    {\n+                        List<ItemStorage> storageInput = storage.getCleanedInput();", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\nindex 5fc69c7b7e..003633271d 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n\n@@ -789,12 +789,12 @@ public abstract class AbstractBuildingWorker extends AbstractBuilding implements\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+        final Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n \n-        for(CustomRecipe newRecipe : staticRecipes)\n+        for(final CustomRecipe newRecipe : staticRecipes)\n         {\n-            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n-            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+            final IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            final IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n \n             if(newRecipe.isValidForColony(colony))\n             {   \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTI1Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249253", "bodyText": "break?", "author": "Raycoms", "createdAt": "2020-08-23T18:18:00Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -787,7 +789,70 @@ public boolean canEat(final ItemStack stack)\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        // Override if necessary.\n+        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+\n+        for(CustomRecipe newRecipe : staticRecipes)\n+        {\n+            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+\n+            if(newRecipe.isValidForColony(colony))\n+            {   \n+                boolean duplicateFound = false; \n+                for(IToken<?> token : recipes)\n+                {\n+                    if(token == recipeToken)\n+                    {\n+                        duplicateFound = true;\n+                        break;\n+                    }\n+                    final IRecipeStorage storage = IColonyManager.getInstance().getRecipeManager().getRecipes().get(token);\n+\n+                    //Let's verify that this recipe doesn't exist in an improved form\n+                    if(storage != null && storage.getPrimaryOutput().equals(recipeStorage.getPrimaryOutput(), true))\n+                    {\n+                        List<ItemStorage> storageInput = storage.getCleanedInput();\n+                        List<ItemStorage> recipeInput = recipeStorage.getCleanedInput();\n+\n+                        if(storageInput.size() != recipeInput.size())\n+                        {\n+                            continue;\n+                        }\n+                        \n+                        if(storageInput.size() > 1) {\n+                            storageInput.sort(Comparator.comparing(item -> item.toString()));\n+                            recipeInput.sort(Comparator.comparing(item -> item.toString()));\n+                        }\n+\n+                        boolean allMatch = true;\n+                        for(int i=0; i<storageInput.size(); i++)\n+                        {\n+                            if(!storageInput.get(i).getItem().equals(recipeInput.get(i).getItem()))\n+                            {\n+                                allMatch = false;\n+                                break;\n+                            }\n+                        }\n+                        if(allMatch)\n+                        {\n+                            duplicateFound = true;", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\nindex 5fc69c7b7e..003633271d 100755\n--- a/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java\n\n@@ -789,12 +789,12 @@ public abstract class AbstractBuildingWorker extends AbstractBuilding implements\n      */\n     public void checkForWorkerSpecificRecipes()\n     {\n-        Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n+        final Set<CustomRecipe> staticRecipes = CustomRecipeManager.getInstance().getRecipes(getJobName());\n \n-        for(CustomRecipe newRecipe : staticRecipes)\n+        for(final CustomRecipe newRecipe : staticRecipes)\n         {\n-            IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n-            IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n+            final IRecipeStorage recipeStorage = newRecipe.getRecipeStorage();\n+            final IToken<?> recipeToken = IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(recipeStorage);\n \n             if(newRecipe.isValidForColony(colony))\n             {   \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTQ3NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249474", "bodyText": "maybe call the property ones RECIPE_TYPE_PROP, so the next one doesn't have such a confusing name =D", "author": "Raycoms", "createdAt": "2020-08-23T18:20:23Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.requestsystem.StandardFactoryController;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.research.effects.IResearchEffect;\n+import com.minecolonies.api.util.constant.TypeConstants;\n+import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistries;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * This class represents a recipe loaded from custom data that is available to a crafter\n+ * but not to a player\n+ */\n+public class CustomRecipe\n+{\n+\n+    /**\n+     * The property name that indicates type for the recipe\n+     */\n+    public static final String RECIPE_TYPE = \"type\";", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\nindex d841afe648..474606db68 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n\n@@ -8,6 +8,7 @@ import com.minecolonies.api.crafting.IRecipeStorage;\n import com.minecolonies.api.research.effects.IResearchEffect;\n import com.minecolonies.api.util.constant.TypeConstants;\n import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+import org.jetbrains.annotations.NotNull;\n \n import net.minecraft.block.Block;\n import net.minecraft.block.Blocks;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTU0Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249543", "bodyText": "formatting", "author": "Raycoms", "createdAt": "2020-08-23T18:20:53Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.requestsystem.StandardFactoryController;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.research.effects.IResearchEffect;\n+import com.minecolonies.api.util.constant.TypeConstants;\n+import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistries;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * This class represents a recipe loaded from custom data that is available to a crafter\n+ * but not to a player\n+ */\n+public class CustomRecipe\n+{\n+\n+    /**\n+     * The property name that indicates type for the recipe\n+     */\n+    public static final String RECIPE_TYPE = \"type\";\n+\n+    /**\n+     * The recipe type \n+     */\n+    public static final String RECIPE_TYPE_RECIPE = \"recipe\";\n+\n+    /**\n+     * The remove type \n+     */\n+    public static final String RECIPE_TYPE_REMOVE = \"remove\";\n+\n+    /**\n+     * The property name that indicates crafter type for the recipe\n+     */\n+    public static final String RECIPE_CRAFTER = \"crafter\";\n+\n+    /**\n+     * The property name for the inputs array\n+     */\n+    public static final String RECIPE_INPUTS = \"inputs\";\n+\n+    /**\n+     * The property name for the result item \n+     */\n+    public static final String RECIPE_RESULT = \"result\";\n+\n+    /**\n+     * The property name for Count, used both in inputs array and for result\n+     */\n+    public static final String COUNT = \"count\";\n+\n+    /**\n+     * The property name for the item id in the inputs array\n+     */\n+    public static final String ITEM = \"item\";\n+\n+    /**\n+     * The property name for the intermediate block ID\n+     */\n+    public static final String RECIPE_INTERMEDIATE = \"intermediate\";\n+\n+    /**\n+     * The property name for the required research id\n+     */\n+    public static final String RECIPE_RESEARCHID = \"research-id\";\n+\n+    /**\n+     * The property name for the research id that invalidates this recipe\n+     */\n+    public static final String RECIPE_EXCLUDED_RESEARCHID = \"not-research-id\";\n+\n+    /**\n+     * The crafter name for this instance, defaults to 'unknown'\n+     */\n+    private String crafter = \"unknown\";\n+\n+    /**\n+     * The recipe id for this instance, used for removal and lookup\n+     */\n+    private String recipeId = \"\";\n+\n+    private ArrayList<ItemStack> inputs = new ArrayList<>();\n+    private ItemStack result = null;\n+    private Block intermediate = Blocks.AIR;\n+\n+    private String researchId = null;\n+    private String excludedResearchId = null;\n+\n+\n+    /**\n+     * This class can only be created by the parse static\n+     */\n+    private CustomRecipe() {", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\nindex d841afe648..474606db68 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n\n@@ -8,6 +8,7 @@ import com.minecolonies.api.crafting.IRecipeStorage;\n import com.minecolonies.api.research.effects.IResearchEffect;\n import com.minecolonies.api.util.constant.TypeConstants;\n import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+import org.jetbrains.annotations.NotNull;\n \n import net.minecraft.block.Block;\n import net.minecraft.block.Blocks;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTY0NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249645", "bodyText": "final (also for input @NotNull final probably)", "author": "Raycoms", "createdAt": "2020-08-23T18:21:54Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.requestsystem.StandardFactoryController;\n+import com.minecolonies.api.crafting.IRecipeStorage;\n+import com.minecolonies.api.research.effects.IResearchEffect;\n+import com.minecolonies.api.util.constant.TypeConstants;\n+import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistries;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * This class represents a recipe loaded from custom data that is available to a crafter\n+ * but not to a player\n+ */\n+public class CustomRecipe\n+{\n+\n+    /**\n+     * The property name that indicates type for the recipe\n+     */\n+    public static final String RECIPE_TYPE = \"type\";\n+\n+    /**\n+     * The recipe type \n+     */\n+    public static final String RECIPE_TYPE_RECIPE = \"recipe\";\n+\n+    /**\n+     * The remove type \n+     */\n+    public static final String RECIPE_TYPE_REMOVE = \"remove\";\n+\n+    /**\n+     * The property name that indicates crafter type for the recipe\n+     */\n+    public static final String RECIPE_CRAFTER = \"crafter\";\n+\n+    /**\n+     * The property name for the inputs array\n+     */\n+    public static final String RECIPE_INPUTS = \"inputs\";\n+\n+    /**\n+     * The property name for the result item \n+     */\n+    public static final String RECIPE_RESULT = \"result\";\n+\n+    /**\n+     * The property name for Count, used both in inputs array and for result\n+     */\n+    public static final String COUNT = \"count\";\n+\n+    /**\n+     * The property name for the item id in the inputs array\n+     */\n+    public static final String ITEM = \"item\";\n+\n+    /**\n+     * The property name for the intermediate block ID\n+     */\n+    public static final String RECIPE_INTERMEDIATE = \"intermediate\";\n+\n+    /**\n+     * The property name for the required research id\n+     */\n+    public static final String RECIPE_RESEARCHID = \"research-id\";\n+\n+    /**\n+     * The property name for the research id that invalidates this recipe\n+     */\n+    public static final String RECIPE_EXCLUDED_RESEARCHID = \"not-research-id\";\n+\n+    /**\n+     * The crafter name for this instance, defaults to 'unknown'\n+     */\n+    private String crafter = \"unknown\";\n+\n+    /**\n+     * The recipe id for this instance, used for removal and lookup\n+     */\n+    private String recipeId = \"\";\n+\n+    private ArrayList<ItemStack> inputs = new ArrayList<>();\n+    private ItemStack result = null;\n+    private Block intermediate = Blocks.AIR;\n+\n+    private String researchId = null;\n+    private String excludedResearchId = null;\n+\n+\n+    /**\n+     * This class can only be created by the parse static\n+     */\n+    private CustomRecipe() {\n+\n+    }\n+    \n+    /**\n+     * Parse a Json object into a Custom recipe\n+     * @param recipeJson the json representing the recipe\n+     * @return new instance of CustomRecipe\n+     */\n+    public static CustomRecipe parse(JsonObject recipeJson)\n+    {\n+        CustomRecipe recipe = new CustomRecipe();", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\nindex d841afe648..474606db68 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipe.java\n\n@@ -8,6 +8,7 @@ import com.minecolonies.api.crafting.IRecipeStorage;\n import com.minecolonies.api.research.effects.IResearchEffect;\n import com.minecolonies.api.util.constant.TypeConstants;\n import com.minecolonies.coremod.research.UnlockAbilityResearchEffect;\n+import org.jetbrains.annotations.NotNull;\n \n import net.minecraft.block.Block;\n import net.minecraft.block.Blocks;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc0MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249740", "bodyText": "jdoc on fields too", "author": "Raycoms", "createdAt": "2020-08-23T18:22:54Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+import com.google.gson.JsonObject;\n+\n+import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n+\n+/**\n+ * Manager class for tracking Custom recipes during load and use\n+ * This class is a singleton\n+ */\n+public class CustomRecipeManager\n+{\n+    private static CustomRecipeManager instance = new CustomRecipeManager();", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\nindex ccd9e9e372..a060d95cc9 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n\n@@ -3,6 +3,8 @@ package com.minecolonies.coremod.colony.crafting;\n import java.util.*;\n import java.util.stream.Collectors;\n import com.google.gson.JsonObject;\n+import com.ldtteam.blockout.Log;\n+import org.jetbrains.annotations.NotNull;\n \n import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc1Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249756", "bodyText": "@NotNull final", "author": "Raycoms", "createdAt": "2020-08-23T18:23:09Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+import com.google.gson.JsonObject;\n+\n+import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n+\n+/**\n+ * Manager class for tracking Custom recipes during load and use\n+ * This class is a singleton\n+ */\n+public class CustomRecipeManager\n+{\n+    private static CustomRecipeManager instance = new CustomRecipeManager();\n+    private HashMap<String, HashMap<String, CustomRecipe>> recipeMap = new HashMap<>();\n+\n+    private CustomRecipeManager()\n+    {\n+    }\n+        \n+    /**\n+     * Get the singleton instance of this class\n+     * @return\n+     */\n+    public static CustomRecipeManager getInstance()\n+    {\n+        return instance;\n+    }\n+\n+    /**\n+     * Add a recipe Json to the manager\n+     * @param recipeJson\n+     * @param namespace\n+     * @param path\n+     */\n+    public void addRecipe(JsonObject recipeJson, String namespace, String path)", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTg0Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249847", "bodyText": "Since I'm not sure what namespace here means, it might need a better explanation in the javadoc", "author": "Raycoms", "createdAt": "2020-08-23T18:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTg5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249899", "bodyText": "If it's like a ResourceLocation, why don't we use a ResourceLocation here?", "author": "Raycoms", "createdAt": "2020-08-23T18:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MTExOA==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475251118", "bodyText": "I'm investigating", "author": "Mekle001", "createdAt": "2020-08-23T18:37:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MzMyNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475253326", "bodyText": "Ok.Switching.", "author": "Mekle001", "createdAt": "2020-08-23T19:01:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTc1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\nindex ccd9e9e372..a060d95cc9 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n\n@@ -3,6 +3,8 @@ package com.minecolonies.coremod.colony.crafting;\n import java.util.*;\n import java.util.stream.Collectors;\n import com.google.gson.JsonObject;\n+import com.ldtteam.blockout.Log;\n+import org.jetbrains.annotations.NotNull;\n \n import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTk0MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475249941", "bodyText": "I think in general we might be able to simplify a lot of this using a resource location =D", "author": "Raycoms", "createdAt": "2020-08-23T18:24:53Z", "path": "src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package com.minecolonies.coremod.colony.crafting;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+import com.google.gson.JsonObject;\n+\n+import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n+\n+/**\n+ * Manager class for tracking Custom recipes during load and use\n+ * This class is a singleton\n+ */\n+public class CustomRecipeManager\n+{\n+    private static CustomRecipeManager instance = new CustomRecipeManager();\n+    private HashMap<String, HashMap<String, CustomRecipe>> recipeMap = new HashMap<>();\n+\n+    private CustomRecipeManager()\n+    {\n+    }\n+        \n+    /**\n+     * Get the singleton instance of this class\n+     * @return\n+     */\n+    public static CustomRecipeManager getInstance()\n+    {\n+        return instance;\n+    }\n+\n+    /**\n+     * Add a recipe Json to the manager\n+     * @param recipeJson\n+     * @param namespace\n+     * @param path\n+     */\n+    public void addRecipe(JsonObject recipeJson, String namespace, String path)\n+    {\n+        CustomRecipe recipe = CustomRecipe.parse(recipeJson);\n+        recipe.setRecipeId(namespace + \":\" + path);\n+\n+        if(!recipeMap.containsKey(recipe.getCrafter()))\n+        {\n+            recipeMap.put(recipe.getCrafter(), new HashMap<>());\n+        }\n+        recipeMap.get(recipe.getCrafter()).put(recipe.getRecipeId(), recipe);\n+    }\n+\n+    /**\n+     * Remove a recipe from the manager\n+     * This allows modpacks to remove 'bad' recipes in addition to adding good ones\n+     * @param recipeJson\n+     * @param namespace\n+     * @param path\n+     */\n+    public void removeRecipe(JsonObject recipeJson, String namespace, String path)\n+    {\n+        final String id = namespace + \":\" + path;\n+        if (recipeJson.has(RECIPE_TYPE) && recipeJson.get(RECIPE_TYPE).getAsString().equals(\"remove\") && recipeJson.has(\"recipe-id-to-remove\"))", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MDM2MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475250360", "bodyText": "Possibly. I thought about that, I'm not entirely convinced.", "author": "Mekle001", "createdAt": "2020-08-23T18:29:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTk0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MzM0Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475253346", "bodyText": "Switching", "author": "Mekle001", "createdAt": "2020-08-23T19:01:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI0OTk0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\nindex ccd9e9e372..a060d95cc9 100644\n--- a/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n+++ b/src/main/java/com/minecolonies/coremod/colony/crafting/CustomRecipeManager.java\n\n@@ -3,6 +3,8 @@ package com.minecolonies.coremod.colony.crafting;\n import java.util.*;\n import java.util.stream.Collectors;\n import com.google.gson.JsonObject;\n+import com.ldtteam.blockout.Log;\n+import org.jetbrains.annotations.NotNull;\n \n import static com.minecolonies.coremod.colony.crafting.CustomRecipe.*;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MDAxNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475250015", "bodyText": "can be straight getResourceManager().add for now I guess", "author": "Raycoms", "createdAt": "2020-08-23T18:25:38Z", "path": "src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java", "diffHunk": "@@ -51,6 +54,14 @@ public static void onPlayerLogin(@NotNull final PlayerEvent.PlayerLoggedInEvent\n         }\n     }\n \n+    @SubscribeEvent\n+    public static void onServerAboutToStart(FMLServerAboutToStartEvent event)\n+    {\n+        IReloadableResourceManager resourceManager = event.getServer().getResourceManager();\n+\n+        resourceManager.addReloadListener(new CrafterRecipeListener());", "originalCommit": "42b70b383278867cbdaa29f9fa779a084a4025fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MDQ2OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5644#discussion_r475250469", "bodyText": "It can, I was setting up for future types.", "author": "Mekle001", "createdAt": "2020-08-23T18:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTI1MDAxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java b/src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java\nindex 1d4abc14bf..780dee603e 100755\n--- a/src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java\n+++ b/src/main/java/com/minecolonies/coremod/event/FMLEventHandler.java\n\n@@ -57,9 +57,7 @@ public class FMLEventHandler\n     @SubscribeEvent\n     public static void onServerAboutToStart(FMLServerAboutToStartEvent event)\n     {\n-        IReloadableResourceManager resourceManager = event.getServer().getResourceManager();\n-\n-        resourceManager.addReloadListener(new CrafterRecipeListener());\n+        event.getServer().getResourceManager().addReloadListener(new CrafterRecipeListener());\n     }\n \n     @SubscribeEvent\n"}}, {"oid": "2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "url": "https://github.com/ldtteam/minecolonies/commit/2ae6a6b3db55838a946fbc4fa6f6811ba1ba8c4d", "message": "Review Feedback", "committedDate": "2020-08-23T18:35:21Z", "type": "commit"}, {"oid": "c78bdc4d011915f74b6e3bacc2796bebdcb2b0cf", "url": "https://github.com/ldtteam/minecolonies/commit/c78bdc4d011915f74b6e3bacc2796bebdcb2b0cf", "message": "Switch to ResourceLocation", "committedDate": "2020-08-23T19:00:57Z", "type": "commit"}, {"oid": "0395bb343ed012615355ea44ee6d2d71dd5dbfe7", "url": "https://github.com/ldtteam/minecolonies/commit/0395bb343ed012615355ea44ee6d2d71dd5dbfe7", "message": "Merge branch 'version/1.15' into customdata/recipes", "committedDate": "2020-08-24T15:47:32Z", "type": "commit"}, {"oid": "b704e1070850437419139530fdd6d9ade60f5517", "url": "https://github.com/ldtteam/minecolonies/commit/b704e1070850437419139530fdd6d9ade60f5517", "message": "Merge branch 'version/1.15' into customdata/recipes", "committedDate": "2020-08-24T16:25:56Z", "type": "commit"}, {"oid": "7f1ef6a25ecd5e7ff62ed816da071fcfdb1ba3b9", "url": "https://github.com/ldtteam/minecolonies/commit/7f1ef6a25ecd5e7ff62ed816da071fcfdb1ba3b9", "message": "fix this", "committedDate": "2020-08-24T19:08:15Z", "type": "commit"}, {"oid": "5b4ead5b9c80d21f537c8ae3142a406795d52a86", "url": "https://github.com/ldtteam/minecolonies/commit/5b4ead5b9c80d21f537c8ae3142a406795d52a86", "message": "Fix Null during walking", "committedDate": "2020-08-24T19:10:03Z", "type": "commit"}]}