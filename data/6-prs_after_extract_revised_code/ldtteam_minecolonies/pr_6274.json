{"pr_number": 6274, "pr_title": "Fix tree restriction search", "pr_createdAt": "2020-12-20T12:29:10Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/6274", "timeline": [{"oid": "0c8c325960c8eee30c7cd2fede8aae3f8cfae089", "url": "https://github.com/ldtteam/minecolonies/commit/0c8c325960c8eee30c7cd2fede8aae3f8cfae089", "message": "Fix tree restriction search", "committedDate": "2020-12-20T12:27:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjM3MTQzOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/6274#discussion_r546371439", "bodyText": "entity can be null", "author": "someaddons", "createdAt": "2020-12-20T12:36:48Z", "path": "src/main/java/com/minecolonies/coremod/entity/pathfinding/pathjobs/AbstractPathJob.java", "diffHunk": "@@ -165,19 +153,30 @@ public AbstractPathJob(final World world, final BlockPos startRestriction, final\n \n         xzRestricted = true;\n \n+        final int localMinX = Math.min(minX, entity.getPosition().getX()) - 10;\n+        final int localMaxX =  Math.max(maxX, entity.getPosition().getX()) + 10;\n+        final int localMinZ =  Math.min(minZ, entity.getPosition().getZ()) - 10;\n+        final int localMaxZ = Math.max(maxZ, entity.getPosition().getZ()) + 10;\n \n-        final int range = (int) Math.sqrt(Math.pow(maxX - minX, 2) + Math.pow(maxZ - minZ, 2)) * 2;\n+        final int range = (int) Math.sqrt(Math.pow(localMaxX - localMinX, 2) + Math.pow(localMaxZ - localMinZ, 2)) * 2;\n \n-        this.world = new ChunkCache(world, new BlockPos(minX, MIN_Y, minZ), new BlockPos(maxX, MAX_Y, maxZ), range);\n+        this.world = new ChunkCache(world, new BlockPos(localMinX, MIN_Y, localMinZ), new BlockPos(localMaxX, MAX_Y, localMaxZ), range);\n \n-        this.start = startRestriction;\n+        this.start = entity.getPosition();", "originalCommit": "0c8c325960c8eee30c7cd2fede8aae3f8cfae089", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "341c1ac400a4ea6a76d6dbe2ef4955520f4cdf5e", "chunk": "diff --git a/src/main/java/com/minecolonies/coremod/entity/pathfinding/pathjobs/AbstractPathJob.java b/src/main/java/com/minecolonies/coremod/entity/pathfinding/pathjobs/AbstractPathJob.java\nindex e7a4d9dcee..cb6da40cc2 100644\n--- a/src/main/java/com/minecolonies/coremod/entity/pathfinding/pathjobs/AbstractPathJob.java\n+++ b/src/main/java/com/minecolonies/coremod/entity/pathfinding/pathjobs/AbstractPathJob.java\n\n@@ -153,16 +153,30 @@ public abstract class AbstractPathJob implements Callable<Path>\n \n         xzRestricted = true;\n \n-        final int localMinX = Math.min(minX, entity.getPosition().getX()) - 10;\n-        final int localMaxX =  Math.max(maxX, entity.getPosition().getX()) + 10;\n-        final int localMinZ =  Math.min(minZ, entity.getPosition().getZ()) - 10;\n-        final int localMaxZ = Math.max(maxZ, entity.getPosition().getZ()) + 10;\n-\n+        final int localMinX;\n+        final int localMaxX;\n+        final int localMinZ;\n+        final int localMaxZ;\n+        if (entity == null)\n+        {\n+            localMinX = minX - 10;\n+            localMaxX = maxX + 10;\n+            localMinZ = minZ - 10;\n+            localMaxZ = maxZ + 10;\n+            this.start = startRestriction;\n+        }\n+        else\n+        {\n+            localMinX = Math.min(minX, entity.getPosition().getX()) - 10;\n+            localMaxX = Math.max(maxX, entity.getPosition().getX()) + 10;\n+            localMinZ = Math.min(minZ, entity.getPosition().getZ()) - 10;\n+            localMaxZ = Math.max(maxZ, entity.getPosition().getZ()) + 10;\n+            this.start = entity.getPosition();\n+        }\n         final int range = (int) Math.sqrt(Math.pow(localMaxX - localMinX, 2) + Math.pow(localMaxZ - localMinZ, 2)) * 2;\n \n         this.world = new ChunkCache(world, new BlockPos(localMinX, MIN_Y, localMinZ), new BlockPos(localMaxX, MAX_Y, localMaxZ), range);\n \n-        this.start = entity.getPosition();\n         this.maxRange = range;\n         this.result = result;\n         this.init(entity);\n"}}, {"oid": "341c1ac400a4ea6a76d6dbe2ef4955520f4cdf5e", "url": "https://github.com/ldtteam/minecolonies/commit/341c1ac400a4ea6a76d6dbe2ef4955520f4cdf5e", "message": "adjust to review", "committedDate": "2020-12-20T12:50:32Z", "type": "commit"}]}