{"pr_number": 5762, "pr_title": "Some fixes", "pr_createdAt": "2020-09-11T12:55:20Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5762", "timeline": [{"oid": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb", "url": "https://github.com/ldtteam/minecolonies/commit/7ed6cbf547f3e7754fb09562b0a3fa4802652deb", "message": "Fix AI initialized too early\nFix respawning missing checks", "committedDate": "2020-09-11T12:53:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMTU4MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487031580", "bodyText": "I'm pretty sure this causes the out of world issues", "author": "Raycoms", "createdAt": "2020-09-11T13:06:26Z", "path": "src/main/java/com/minecolonies/coremod/colony/VisitorData.java", "diffHunk": "@@ -114,10 +115,14 @@ public void updateEntityIfNecessary()\n     {\n         if (getEntity().isPresent())\n         {\n-            return;\n+            final Entity entity = getEntity().get();\n+            if (entity.isAlive() && entity.addedToChunk && WorldUtil.isEntityBlockLoaded(entity.world, entity.getPosition()))\n+            {\n+                return;\n+            }\n         }\n \n-        if (WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n+        if (getLastPosition() != BlockPos.ZERO && WorldUtil.isEntityBlockLoaded(getColony().getWorld(), getLastPosition()))\n         {\n             getColony().getVisitorManager().spawnOrCreateCivilian(this, getColony().getWorld(), getLastPosition(), true);", "originalCommit": "7ed6cbf547f3e7754fb09562b0a3fa4802652deb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMjA5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487032091", "bodyText": "ye might do", "author": "someaddons", "createdAt": "2020-09-11T13:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzAzMTU4MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "e0980ca03f0cd2dd6e34e506926afada04ee8af1", "url": "https://github.com/ldtteam/minecolonies/commit/e0980ca03f0cd2dd6e34e506926afada04ee8af1", "message": "Remove entity respawning at the TH when actually unloaded\nFix can't spawn at messages appearing for unloaded citizens", "committedDate": "2020-09-11T14:07:05Z", "type": "commit"}, {"oid": "80ff3e7095518bd31f3fbe32906141f82f35a748", "url": "https://github.com/ldtteam/minecolonies/commit/80ff3e7095518bd31f3fbe32906141f82f35a748", "message": "improve recall message", "committedDate": "2020-09-11T14:16:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487124539", "bodyText": "Why is this cast here?......", "author": "OrionDevelopment", "createdAt": "2020-09-11T15:32:50Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -227,35 +226,23 @@ public ICitizenData spawnOrCreateCivilian(@Nullable final ICivilianData data, fi\n             spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n         }\n \n-\n-        BlockPos calculatedSpawn = null;\n-\n-        if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n-        {\n-            calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n-        }\n-\n-        if (calculatedSpawn == null)\n+        if (WorldUtil.isEntityBlockLoaded(colony.getWorld(), spawnLocation))\n         {\n-            spawnLocation = colony.getBuildingManager().getTownHall().getPosition();\n-            if (world.getChunkProvider().isChunkLoaded(new ChunkPos(spawnLocation.getX() >> 4, spawnLocation.getZ() >> 4)))\n+            final BlockPos calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+            if (calculatedSpawn != null)\n             {\n-                calculatedSpawn = EntityUtils.getSpawnPoint(world, spawnLocation);\n+                return spawnCitizenOnPosition((ICitizenData) data, world, force, calculatedSpawn);", "originalCommit": "80ff3e7095518bd31f3fbe32906141f82f35a748", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NjAyMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487176023", "bodyText": "this happens to be a citizenmanager internal function which is uses citizen data instead of civilian", "author": "someaddons", "createdAt": "2020-09-11T17:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3NjEyNg==", "url": "https://github.com/ldtteam/minecolonies/pull/5762#discussion_r487176126", "bodyText": "could probably move that to civilian too in the future", "author": "someaddons", "createdAt": "2020-09-11T17:06:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEyNDUzOQ=="}], "type": "inlineReview", "revised_code": null}]}