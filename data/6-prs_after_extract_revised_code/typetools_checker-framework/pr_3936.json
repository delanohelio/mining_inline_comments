{"pr_number": 3936, "pr_title": "Make the visualization of stores deterministic", "pr_createdAt": "2020-11-27T04:42:53Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3936", "timeline": [{"oid": "eb83ade59a3ff72bc9dcd4435b41e07706a37534", "url": "https://github.com/typetools/checker-framework/commit/eb83ade59a3ff72bc9dcd4435b41e07706a37534", "message": "Make the visualization of stores deterministic", "committedDate": "2020-11-26T15:45:51Z", "type": "commit"}, {"oid": "4a063b76c439ad0c2e2366af86477af49d214e57", "url": "https://github.com/typetools/checker-framework/commit/4a063b76c439ad0c2e2366af86477af49d214e57", "message": "Move ToStringComparator", "committedDate": "2020-11-26T16:50:42Z", "type": "commit"}, {"oid": "77b31655323ebd89ae9baf183ded8d066badb275", "url": "https://github.com/typetools/checker-framework/commit/77b31655323ebd89ae9baf183ded8d066badb275", "message": "Use ToStringComparator", "committedDate": "2020-11-27T02:06:29Z", "type": "commit"}, {"oid": "1fb570d3868c627f14a266e11a81c2cd0d6b1f42", "url": "https://github.com/typetools/checker-framework/commit/1fb570d3868c627f14a266e11a81c2cd0d6b1f42", "message": "Add Javadoc", "committedDate": "2020-11-27T03:52:10Z", "type": "commit"}, {"oid": "b1fe49305c13ae61ae0de2d74c083f1b536ec2b0", "url": "https://github.com/typetools/checker-framework/commit/b1fe49305c13ae61ae0de2d74c083f1b536ec2b0", "message": "More sorting", "committedDate": "2020-11-27T03:52:17Z", "type": "commit"}, {"oid": "93cb7250782c089ea5a7e9cdc7b31508629561b0", "url": "https://github.com/typetools/checker-framework/commit/93cb7250782c089ea5a7e9cdc7b31508629561b0", "message": "More concise code", "committedDate": "2020-11-27T04:41:40Z", "type": "commit"}, {"oid": "8691596e2018460e5a76b9567d14ba3a10872add", "url": "https://github.com/typetools/checker-framework/commit/8691596e2018460e5a76b9567d14ba3a10872add", "message": "Merge ../checker-framework-branch-master into deterministic-store-tostring", "committedDate": "2020-11-27T06:13:55Z", "type": "commit"}, {"oid": "3c4327aa3a3dc178752e8340a555893e58fbb4b2", "url": "https://github.com/typetools/checker-framework/commit/3c4327aa3a3dc178752e8340a555893e58fbb4b2", "message": "Merge ../checker-framework-branch-master into deterministic-store-tostring", "committedDate": "2020-11-29T11:26:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2MDk5OQ==", "url": "https://github.com/typetools/checker-framework/pull/3936#discussion_r532760999", "bodyText": "Should this be Comparator<@Nullable Object>?", "author": "smillst", "createdAt": "2020-11-30T17:13:31Z", "path": "javacutil/src/main/java/org/checkerframework/javacutil/ToStringComparator.java", "diffHunk": "@@ -0,0 +1,37 @@\n+// TODO: Put this in plume-util and use it from there.\n+package org.checkerframework.javacutil;\n+\n+import java.util.ArrayList;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Objects;\n+\n+/** A comparator that orders values based on the lexicographic ordering of their toString(). */\n+public class ToStringComparator implements Comparator<Object> {", "originalCommit": "3c4327aa3a3dc178752e8340a555893e58fbb4b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjgyNDA4NA==", "url": "https://github.com/typetools/checker-framework/pull/3936#discussion_r532824084", "bodyText": "It implements both Comparator<Object> and Comparator<@Nullable Object>.  I think I can only name one of those, and the two are incompatible.  Should I create a parameterized ToStringComparator instead?", "author": "mernst", "createdAt": "2020-11-30T18:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2MDk5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg1NDE1Ng==", "url": "https://github.com/typetools/checker-framework/pull/3936#discussion_r532854156", "bodyText": "The type argument of Comparator should be contravariant. That way we could make this Comparator<@Nullable Object> which would be a subtype of Comparator<@NonNull Object> (We don't have the functionality; #1970 is a request to implement it.)\nSo for now, I think it's enough to mention that ToStringComparator, handles null elements in that class Javadoc.\nAs an aside, the Nullness Checker line 34 should have issued a warning on line 34, I'll look into why it didn't.", "author": "smillst", "createdAt": "2020-11-30T19:43:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2MDk5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg2OTU1OQ==", "url": "https://github.com/typetools/checker-framework/pull/3936#discussion_r532869559", "bodyText": "@smillst Let me know if the new comment looks good.", "author": "mernst", "createdAt": "2020-11-30T20:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2MDk5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NjAyNA==", "url": "https://github.com/typetools/checker-framework/pull/3936#discussion_r532886024", "bodyText": "Looks good thanks!", "author": "smillst", "createdAt": "2020-11-30T20:33:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjc2MDk5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "3864bc4318d94c996257ac4f8cc295fc5455c018", "chunk": "diff --git a/javacutil/src/main/java/org/checkerframework/javacutil/ToStringComparator.java b/javacutil/src/main/java/org/checkerframework/javacutil/ToStringComparator.java\nindex e30263b1d..bcedfce57 100644\n--- a/javacutil/src/main/java/org/checkerframework/javacutil/ToStringComparator.java\n+++ b/javacutil/src/main/java/org/checkerframework/javacutil/ToStringComparator.java\n\n@@ -6,7 +6,14 @@ import java.util.Comparator;\n import java.util.List;\n import java.util.Objects;\n \n-/** A comparator that orders values based on the lexicographic ordering of their toString(). */\n+/**\n+ * A comparator that orders values based on the lexicographic ordering of their toString().\n+ *\n+ * <p>It handles null values, sorting them according to their printed representation \"null\".\n+ */\n+// Once https://github.com/typetools/checker-framework/issues/1970 is fixed, Comparator's type\n+// argument should be marked as @Covariant and this should be declared as \"extends\n+// Comparator<@Nullable Object>\".\n public class ToStringComparator implements Comparator<Object> {\n     /** The unique instance (this class is a singleton). */\n     public static ToStringComparator instance = new ToStringComparator();\n"}}, {"oid": "38da0fdfa63d4eb0720cf30a7ce115f237b3a91f", "url": "https://github.com/typetools/checker-framework/commit/38da0fdfa63d4eb0720cf30a7ce115f237b3a91f", "message": "Merge ../checker-framework-branch-master into deterministic-store-tostring", "committedDate": "2020-11-30T19:58:30Z", "type": "commit"}, {"oid": "3864bc4318d94c996257ac4f8cc295fc5455c018", "url": "https://github.com/typetools/checker-framework/commit/3864bc4318d94c996257ac4f8cc295fc5455c018", "message": "Add comment", "committedDate": "2020-11-30T20:01:48Z", "type": "commit"}]}