{"pr_number": 3536, "pr_title": "Add Block.getNodes() method", "pr_createdAt": "2020-07-31T14:19:15Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3536", "timeline": [{"oid": "9bf8af51783752943d0237a514353007b0c88d55", "url": "https://github.com/typetools/checker-framework/commit/9bf8af51783752943d0237a514353007b0c88d55", "message": "Interface should not reference implementation subclasses", "committedDate": "2020-07-30T23:02:59Z", "type": "commit"}, {"oid": "389343646ed356dadf52ba669ca492c2433f4cfb", "url": "https://github.com/typetools/checker-framework/commit/389343646ed356dadf52ba669ca492c2433f4cfb", "message": "Move getSuccessors() into Block", "committedDate": "2020-07-30T23:13:02Z", "type": "commit"}, {"oid": "17fde4bc607c6c02e8ffc893123d685a26a49659", "url": "https://github.com/typetools/checker-framework/commit/17fde4bc607c6c02e8ffc893123d685a26a49659", "message": "Make collections mutable, and don't put null in them", "committedDate": "2020-07-30T23:48:00Z", "type": "commit"}, {"oid": "fa8177587023a466b17d54c07cc95dcd904ce6e5", "url": "https://github.com/typetools/checker-framework/commit/fa8177587023a466b17d54c07cc95dcd904ce6e5", "message": "Merge ../checker-framework-branch-master into block-interface", "committedDate": "2020-07-31T01:07:43Z", "type": "commit"}, {"oid": "259e787771b574459679a02a8c8cc7e1babf7919", "url": "https://github.com/typetools/checker-framework/commit/259e787771b574459679a02a8c8cc7e1babf7919", "message": "Merge ../checker-framework-fork-mernst-branch-block-interface into block-getsuccessors", "committedDate": "2020-07-31T01:07:49Z", "type": "commit"}, {"oid": "b3c75f0e0821b77848b549c6be81cb517b997f09", "url": "https://github.com/typetools/checker-framework/commit/b3c75f0e0821b77848b549c6be81cb517b997f09", "message": "Add Javadoc", "committedDate": "2020-07-31T03:56:01Z", "type": "commit"}, {"oid": "16d3354eb2c596565d3eb3e65ebad068fdf427ef", "url": "https://github.com/typetools/checker-framework/commit/16d3354eb2c596565d3eb3e65ebad068fdf427ef", "message": "Add Block.getNodes() method", "committedDate": "2020-07-31T04:04:34Z", "type": "commit"}, {"oid": "09cc66653f5e6dfdfc743ba77d0a3ea9e2da2666", "url": "https://github.com/typetools/checker-framework/commit/09cc66653f5e6dfdfc743ba77d0a3ea9e2da2666", "message": "Add Javadoc", "committedDate": "2020-07-31T05:27:13Z", "type": "commit"}, {"oid": "8f864e1e2695cc05a985a86c74f50651340fea08", "url": "https://github.com/typetools/checker-framework/commit/8f864e1e2695cc05a985a86c74f50651340fea08", "message": "Merge ../checker-framework-branch-master into block-getsuccessors", "committedDate": "2020-07-31T05:29:00Z", "type": "commit"}, {"oid": "d8cf40ab6693c8d00c0b334f425c10962f2d86e1", "url": "https://github.com/typetools/checker-framework/commit/d8cf40ab6693c8d00c0b334f425c10962f2d86e1", "message": "Merge ../checker-framework-fork-mernst-branch-block-getsuccessors into block-getnodes", "committedDate": "2020-07-31T05:33:25Z", "type": "commit"}, {"oid": "3a3be0a5daad73cf621fe281de6944818867da57", "url": "https://github.com/typetools/checker-framework/commit/3a3be0a5daad73cf621fe281de6944818867da57", "message": "Add Javadoc", "committedDate": "2020-07-31T14:17:33Z", "type": "commit"}, {"oid": "5131537e227f75e3b216c53a3cfcc81dee41c978", "url": "https://github.com/typetools/checker-framework/commit/5131537e227f75e3b216c53a3cfcc81dee41c978", "message": "Merge ../checker-framework-branch-master into block-getsuccessors", "committedDate": "2020-07-31T20:29:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzgyNDQxMw==", "url": "https://github.com/typetools/checker-framework/pull/3536#discussion_r463824413", "bodyText": "As the order of Nodes is important, returning a List is more appropriate.", "author": "wmdietl", "createdAt": "2020-07-31T20:38:33Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java", "diffHunk": "@@ -41,4 +43,18 @@\n      * @return the predecessors of this basic block\n      */\n     Set<Block> getPredecessors();\n+\n+    /**\n+     * Returns all the successors of this basic block.\n+     *\n+     * @return all the successors of this basic block\n+     */\n+    Collection<Block> getSuccessors();\n+\n+    /**\n+     * Returns the nodes contained within this basic block.\n+     *\n+     * @return the nodes contained within this basic block\n+     */\n+    Collection<Node> getNodes();", "originalCommit": "3a3be0a5daad73cf621fe281de6944818867da57", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "735d31e2d2f765b7abfaa39fd0cfb36b4d9dfa71", "chunk": "diff --git a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\nindex 449eece785..6f64d33cf9 100644\n--- a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\n+++ b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\n\n@@ -45,16 +43,9 @@ public interface Block {\n     Set<Block> getPredecessors();\n \n     /**\n-     * Returns all the successors of this basic block.\n+     * Returns the successors of this basic block.\n      *\n-     * @return all the successors of this basic block\n+     * @return the successors of this basic block\n      */\n-    Collection<Block> getSuccessors();\n-\n-    /**\n-     * Returns the nodes contained within this basic block.\n-     *\n-     * @return the nodes contained within this basic block\n-     */\n-    Collection<Node> getNodes();\n+    Set<Block> getSuccessors();\n }\n"}}, {"oid": "735d31e2d2f765b7abfaa39fd0cfb36b4d9dfa71", "url": "https://github.com/typetools/checker-framework/commit/735d31e2d2f765b7abfaa39fd0cfb36b4d9dfa71", "message": "Change List to less efficient Set", "committedDate": "2020-07-31T20:47:35Z", "type": "commit"}, {"oid": "ade597b5e727a9d4b748271f183a7cf8320f868b", "url": "https://github.com/typetools/checker-framework/commit/ade597b5e727a9d4b748271f183a7cf8320f868b", "message": "Merge ../checker-framework-branch-master into block-getsuccessors", "committedDate": "2020-07-31T20:54:51Z", "type": "commit"}, {"oid": "dbfb919363193c76a6589c283da16fd9301a7d20", "url": "https://github.com/typetools/checker-framework/commit/dbfb919363193c76a6589c283da16fd9301a7d20", "message": "Merge ../checker-framework-branch-master into block-getnodes", "committedDate": "2020-07-31T20:56:57Z", "type": "commit"}, {"oid": "735ccb856d9bc60938d876825de734fb60262fc5", "url": "https://github.com/typetools/checker-framework/commit/735ccb856d9bc60938d876825de734fb60262fc5", "message": "Change collection to list", "committedDate": "2020-07-31T20:59:48Z", "type": "commit"}, {"oid": "19e3bb9d21ee20cdb87b131cfce91c5ab1d5e530", "url": "https://github.com/typetools/checker-framework/commit/19e3bb9d21ee20cdb87b131cfce91c5ab1d5e530", "message": "Merge ../checker-framework-fork-mernst-branch-block-getsuccessors into block-getnodes", "committedDate": "2020-07-31T21:02:10Z", "type": "commit"}, {"oid": "20b0334cbfcfd33fe4da1160fcb02b99e61d4c6d", "url": "https://github.com/typetools/checker-framework/commit/20b0334cbfcfd33fe4da1160fcb02b99e61d4c6d", "message": "Merge ../checker-framework-branch-master into block-getsuccessors", "committedDate": "2020-08-01T17:30:02Z", "type": "commit"}, {"oid": "843ef4677dcd14f324410b9aa6f78f960b821579", "url": "https://github.com/typetools/checker-framework/commit/843ef4677dcd14f324410b9aa6f78f960b821579", "message": "Merge ../checker-framework-fork-mernst-branch-block-getsuccessors into block-getnodes", "committedDate": "2020-08-01T17:30:12Z", "type": "commit"}, {"oid": "c3d5086baf3afb4449eceb71bd554bded6e86b61", "url": "https://github.com/typetools/checker-framework/commit/c3d5086baf3afb4449eceb71bd554bded6e86b61", "message": "Merge ../checker-framework-branch-master into block-getsuccessors", "committedDate": "2020-08-03T22:23:34Z", "type": "commit"}, {"oid": "4cbbe6cc1015bccd1af7bdc646f15daeec0997f8", "url": "https://github.com/typetools/checker-framework/commit/4cbbe6cc1015bccd1af7bdc646f15daeec0997f8", "message": "Merge ../checker-framework-fork-mernst-branch-block-getsuccessors into block-getnodes", "committedDate": "2020-08-03T22:23:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3NjcyMw==", "url": "https://github.com/typetools/checker-framework/pull/3536#discussion_r465376723", "bodyText": "Instead of now having two methods, getNodes and getContents, in regular blocks, I would pick one name. I've gotten used to getContents, but getNodes is also fine with me.\nSo if you prefer getNodes, I would deprecate getContents for removal to not have this duplication.", "author": "wmdietl", "createdAt": "2020-08-04T23:00:31Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/RegularBlockImpl.java", "diffHunk": "@@ -39,6 +39,11 @@ public void addNodes(List<? extends Node> ts) {\n         return Collections.unmodifiableList(contents);\n     }\n \n+    @Override\n+    public List<Node> getNodes() {", "originalCommit": "4cbbe6cc1015bccd1af7bdc646f15daeec0997f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxOTE1NA==", "url": "https://github.com/typetools/checker-framework/pull/3536#discussion_r465419154", "bodyText": "Good suggestion.  I did that, and that led me to notice other cleanups that could be performed (eg, a client that implemented getNodes and can now use the new method).  I also added a getLastNode() method since multiple clients implemented it.\nI chose \"getNodes\" because I think it's more descriptive to clients.  (I see why getContents was chosen -- because a private field is named contents.)\nDo you want to review the latest changes, or should I merge this?  Either way is fine with me.", "author": "mernst", "createdAt": "2020-08-05T01:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3NjcyMw=="}], "type": "inlineReview", "revised_code": {"commit": "599c5c5fa2a29dd989a1078c2e71178d1fe5b580", "chunk": "diff --git a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/RegularBlockImpl.java b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/RegularBlockImpl.java\nindex 08071a2093..d70d429c34 100644\n--- a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/RegularBlockImpl.java\n+++ b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/RegularBlockImpl.java\n\n@@ -34,14 +34,15 @@ public class RegularBlockImpl extends SingleSuccessorBlockImpl implements Regula\n         }\n     }\n \n+    @SuppressWarnings(\"deprecation\") // implementation of deprecated method in interface\n     @Override\n     public List<Node> getContents() {\n-        return Collections.unmodifiableList(contents);\n+        return getNodes();\n     }\n \n     @Override\n     public List<Node> getNodes() {\n-        return getContents();\n+        return Collections.unmodifiableList(contents);\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3NzMyOA==", "url": "https://github.com/typetools/checker-framework/pull/3536#discussion_r465377328", "bodyText": "At the moment there is no documentation which blocks return something non-empty or with just a single element. Maybe documenting that would be useful with the individual implementations of this method.", "author": "wmdietl", "createdAt": "2020-08-04T23:02:20Z", "path": "dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java", "diffHunk": "@@ -41,4 +43,18 @@\n      * @return the predecessors of this basic block\n      */\n     Set<Block> getPredecessors();\n+\n+    /**\n+     * Returns the successors of this basic block.\n+     *\n+     * @return the successors of this basic block\n+     */\n+    Set<Block> getSuccessors();\n+\n+    /**\n+     * Returns the nodes contained within this basic block.", "originalCommit": "4cbbe6cc1015bccd1af7bdc646f15daeec0997f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxODk3Mg==", "url": "https://github.com/typetools/checker-framework/pull/3536#discussion_r465418972", "bodyText": "I added that documentation.", "author": "mernst", "createdAt": "2020-08-05T01:28:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM3NzMyOA=="}], "type": "inlineReview", "revised_code": {"commit": "6402e77e92a5af913296e895e72606ad57929921", "chunk": "diff --git a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\nindex 62f34a817e..e395570924 100644\n--- a/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\n+++ b/dataflow/src/main/java/org/checkerframework/dataflow/cfg/block/Block.java\n\n@@ -52,7 +52,7 @@ public interface Block {\n     Set<Block> getSuccessors();\n \n     /**\n-     * Returns the nodes contained within this basic block.\n+     * Returns the nodes contained within this basic block. The list may be empty.\n      *\n      * @return the nodes contained within this basic block\n      */\n"}}, {"oid": "6402e77e92a5af913296e895e72606ad57929921", "url": "https://github.com/typetools/checker-framework/commit/6402e77e92a5af913296e895e72606ad57929921", "message": "Merge ../checker-framework-branch-master into block-getnodes", "committedDate": "2020-08-05T00:04:35Z", "type": "commit"}, {"oid": "599c5c5fa2a29dd989a1078c2e71178d1fe5b580", "url": "https://github.com/typetools/checker-framework/commit/599c5c5fa2a29dd989a1078c2e71178d1fe5b580", "message": "Prefer getNodes to getContents()", "committedDate": "2020-08-05T00:24:33Z", "type": "commit"}, {"oid": "7821c05c5897bf38a11e7dc9e205d9e41836dcf4", "url": "https://github.com/typetools/checker-framework/commit/7821c05c5897bf38a11e7dc9e205d9e41836dcf4", "message": "Method Block.getLastNode", "committedDate": "2020-08-05T00:53:08Z", "type": "commit"}, {"oid": "e32c9362c02b02889c60d5696a4d45e88c67c60d", "url": "https://github.com/typetools/checker-framework/commit/e32c9362c02b02889c60d5696a4d45e88c67c60d", "message": "More documentation for getNodes implementations", "committedDate": "2020-08-05T01:18:29Z", "type": "commit"}, {"oid": "fd12c0e8af0f226361883bfbf1ef19335c8dfd8d", "url": "https://github.com/typetools/checker-framework/commit/fd12c0e8af0f226361883bfbf1ef19335c8dfd8d", "message": "Merge ../checker-framework-branch-master into block-getnodes", "committedDate": "2020-08-05T04:00:09Z", "type": "commit"}]}