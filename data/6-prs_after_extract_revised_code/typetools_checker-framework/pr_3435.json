{"pr_number": 3435, "pr_title": "Fix null-pointer crash in Ainfer=stubs", "pr_createdAt": "2020-07-06T21:45:05Z", "pr_url": "https://github.com/typetools/checker-framework/pull/3435", "timeline": [{"oid": "4ad869d89f9d85615664df50cb19ffb3df8772d1", "url": "https://github.com/typetools/checker-framework/commit/4ad869d89f9d85615664df50cb19ffb3df8772d1", "message": "handle possibly-null ATypeElement_s", "committedDate": "2020-07-06T21:43:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMDIzNQ==", "url": "https://github.com/typetools/checker-framework/pull/3435#discussion_r450520235", "bodyText": "It would be helpful to give an explanation of why the scenelib rep is null here, or at least more information for context. For example, in the linked issue is the inner or outer component null?", "author": "jwaataja", "createdAt": "2020-07-06T22:55:16Z", "path": "framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java", "diffHunk": "@@ -200,9 +200,12 @@ private static String formatArrayType(ATypeElement scenelibRep, ArrayType javacR\n      * @param levels the number of component types the type should have, derived from the javac\n      *     representation\n      * @return a list of the array levels in scenelib's representation, but in the order used by\n-     *     javac. Guaranteed to have exactly {@code levels} entries.\n+     *     javac. Guaranteed to have exactly {@code levels} entries. Entries may be null, if the\n+     *     corresponding parts of {@code scenelibRep} are null. See <a\n+     *     href=\"https://github.com/typetools/checker-framework/issues/3422\">issue 3422</a> for an", "originalCommit": "4ad869d89f9d85615664df50cb19ffb3df8772d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d2e903badedc718f034e8ebfdda97da2198a1c3", "chunk": "diff --git a/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java b/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\nindex 3753aa8830..fbd1b85866 100644\n--- a/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\n+++ b/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\n\n@@ -203,7 +203,8 @@ public final class SceneToStubWriter {\n      *     javac. Guaranteed to have exactly {@code levels} entries. Entries may be null, if the\n      *     corresponding parts of {@code scenelibRep} are null. See <a\n      *     href=\"https://github.com/typetools/checker-framework/issues/3422\">issue 3422</a> for an\n-     *     example of code that causes a null ATypeElement.\n+     *     example of code that causes a null ATypeElement, because the component type is unknown,\n+     *     but the primary type of the array is known.\n      */\n     private static List<@Nullable ATypeElement> getSceneLibRepInJavacOrder(\n             ATypeElement scenelibRep, int levels) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUyMDUxMw==", "url": "https://github.com/typetools/checker-framework/pull/3435#discussion_r450520513", "bodyText": "This nested if-statement can be merged with the surrounding if statement. Might as well change \"\".equals(result) to result.isEmpty() as well.", "author": "jwaataja", "createdAt": "2020-07-06T22:56:15Z", "path": "framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java", "diffHunk": "@@ -241,7 +245,9 @@ private static String formatArrayTypeImpl(\n             result += \" \";\n         }\n         if (\"\".equals(result)) {\n-            result += formatAnnotations(scenelibRep.tlAnnotationsHere);\n+            if (scenelibRep != null) {", "originalCommit": "4ad869d89f9d85615664df50cb19ffb3df8772d1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6d2e903badedc718f034e8ebfdda97da2198a1c3", "chunk": "diff --git a/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java b/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\nindex 3753aa8830..fbd1b85866 100644\n--- a/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\n+++ b/framework/src/main/java/org/checkerframework/common/wholeprograminference/SceneToStubWriter.java\n\n@@ -244,10 +245,8 @@ public final class SceneToStubWriter {\n             result += explicitAnno.toString();\n             result += \" \";\n         }\n-        if (\"\".equals(result)) {\n-            if (scenelibRep != null) {\n-                result += formatAnnotations(scenelibRep.tlAnnotationsHere);\n-            }\n+        if (result.isEmpty() && scenelibRep != null) {\n+            result += formatAnnotations(scenelibRep.tlAnnotationsHere);\n         }\n         result += \"[] \";\n         if (javacComponent.getKind() == TypeKind.ARRAY) {\n"}}, {"oid": "6d2e903badedc718f034e8ebfdda97da2198a1c3", "url": "https://github.com/typetools/checker-framework/commit/6d2e903badedc718f034e8ebfdda97da2198a1c3", "message": "improvements from code review", "committedDate": "2020-07-07T15:54:01Z", "type": "commit"}]}