{"pr_number": 2103, "pr_title": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances", "pr_createdAt": "2020-04-30T04:18:35Z", "pr_url": "https://github.com/JanusGraph/janusgraph/pull/2103", "timeline": [{"oid": "9c1e0d603121958d66f75d3bf5cabc10911e5d82", "url": "https://github.com/JanusGraph/janusgraph/commit/9c1e0d603121958d66f75d3bf5cabc10911e5d82", "message": "Fix ElasticSearch INDEX_NAME_SEPARATOR should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T04:22:53Z", "type": "forcePushed"}, {"oid": "16beccfe4b039dbd99495b16697baa4d44568f2b", "url": "https://github.com/JanusGraph/janusgraph/commit/16beccfe4b039dbd99495b16697baa4d44568f2b", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T04:27:55Z", "type": "forcePushed"}, {"oid": "a7cb915a77081d071365543b5053f23ab9f247d2", "url": "https://github.com/JanusGraph/janusgraph/commit/a7cb915a77081d071365543b5053f23ab9f247d2", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T04:32:21Z", "type": "forcePushed"}, {"oid": "86f9bdd248bdb646dfe3ab9d636e8c684e27c705", "url": "https://github.com/JanusGraph/janusgraph/commit/86f9bdd248bdb646dfe3ab9d636e8c684e27c705", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T08:55:06Z", "type": "forcePushed"}, {"oid": "6a7ed88d140e3e168c1497cf0f74fff48ac4ec93", "url": "https://github.com/JanusGraph/janusgraph/commit/6a7ed88d140e3e168c1497cf0f74fff48ac4ec93", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T09:05:55Z", "type": "forcePushed"}, {"oid": "3f62ddca44f75d79cb84d751efb8609180d729db", "url": "https://github.com/JanusGraph/janusgraph/commit/3f62ddca44f75d79cb84d751efb8609180d729db", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T09:07:57Z", "type": "forcePushed"}, {"oid": "ac5483fdc218b74f8ae5c860c5ac00abc3ea4a70", "url": "https://github.com/JanusGraph/janusgraph/commit/ac5483fdc218b74f8ae5c860c5ac00abc3ea4a70", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T17:09:33Z", "type": "forcePushed"}, {"oid": "0e025eded071ba343de1225333eed139b75fd20d", "url": "https://github.com/JanusGraph/janusgraph/commit/0e025eded071ba343de1225333eed139b75fd20d", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T20:45:55Z", "type": "commit"}, {"oid": "0e025eded071ba343de1225333eed139b75fd20d", "url": "https://github.com/JanusGraph/janusgraph/commit/0e025eded071ba343de1225333eed139b75fd20d", "message": "Fix ElasticSearch INDEX_STORE_NAMES_CACHE should not be shared between instances\n\n- Move INDEX_STORE_NAMES_CACHE from static to instance specific scope.\n- Add possibility to disable INDEX_STORE_NAMES_CACHE cache\n\nFixes #2102\n\nSigned-off-by: Oleksandr Porunov <alexandr.porunov@gmail.com>", "committedDate": "2020-04-30T20:45:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5MDQyNw==", "url": "https://github.com/JanusGraph/janusgraph/pull/2103#discussion_r418490427", "bodyText": "I think we don't need addition option for that\nSimply we may use cache with 10k LRU enties", "author": "mad", "createdAt": "2020-05-01T10:20:13Z", "path": "janusgraph-es/src/main/java/org/janusgraph/diskstorage/es/ElasticSearchIndex.java", "diffHunk": "@@ -243,6 +244,12 @@\n         new ConfigOption<>(ELASTICSEARCH_NS, \"retry_on_conflict\",\n             \"Specify how many times should the operation be retried when a conflict occurs.\", ConfigOption.Type.MASKABLE, 0);\n \n+    public static final ConfigOption<Boolean> ENABLE_INDEX_STORE_NAMES_CACHE =", "originalCommit": "0e025eded071ba343de1225333eed139b75fd20d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyMzU5Mg==", "url": "https://github.com/JanusGraph/janusgraph/pull/2103#discussion_r418623592", "bodyText": "Did you check performance of 10k LRU cache and concurrentHashMap? I checked that it is faster to get a name from map than making contact for 50k and less entities. What if user has more indexes (unlikely but possible)? In such scenario the will be forced to use cache that is slower than string concatenation.", "author": "porunov", "createdAt": "2020-05-01T16:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5MDQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODYyNDQ3NQ==", "url": "https://github.com/JanusGraph/janusgraph/pull/2103#discussion_r418624475", "bodyText": "Also, LRU cache may evict some names which we would like to avoid because it is a permanent cache", "author": "porunov", "createdAt": "2020-05-01T16:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5MDQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcxODM5MA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2103#discussion_r418718390", "bodyText": "Yes you right concurrenthashmap mush faster than cache. But is so rare case when user would be change this option by memory usages cause, i think", "author": "mad", "createdAt": "2020-05-01T20:15:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5MDQyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODcyNzM0OA==", "url": "https://github.com/JanusGraph/janusgraph/pull/2103#discussion_r418727348", "bodyText": "You are right. Most likely nobody will use this option and most likely it will be true for all usecases but I think, it would be good to have this option in case the user has very unusual usecase.\nAlso, this optimization was introduced here #1695 . This optimization is really tiny, so, regular user won't see any difference but still it speedups index store name retrieval for about 3-4 times faster for regular usages and reduces memory consumptions for unnecessary string concatenations.", "author": "porunov", "createdAt": "2020-05-01T20:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5MDQyNw=="}], "type": "inlineReview", "revised_code": null}]}