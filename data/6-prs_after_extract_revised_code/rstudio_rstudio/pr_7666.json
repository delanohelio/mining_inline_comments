{"pr_number": 7666, "pr_title": "Implement R Notebook execution and output in visual mode", "pr_createdAt": "2020-08-26T23:42:21Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7666", "timeline": [{"oid": "ca281ba7710d3e104fa4de71f4cc7423f5b832cc", "url": "https://github.com/rstudio/rstudio/commit/ca281ba7710d3e104fa4de71f4cc7423f5b832cc", "message": "use capsule position to look up existing chunks (WIP)", "committedDate": "2020-08-08T04:35:11Z", "type": "commit"}, {"oid": "6a4496ce6325f59f796455f05f05acdd4e82f2dd", "url": "https://github.com/rstudio/rstudio/commit/6a4496ce6325f59f796455f05f05acdd4e82f2dd", "message": "refactor chunk output for hosting in visual mode", "committedDate": "2020-08-11T03:45:45Z", "type": "commit"}, {"oid": "29b231ed2b8af00ddde5b1e4db5271b74cf8ece2", "url": "https://github.com/rstudio/rstudio/commit/29b231ed2b8af00ddde5b1e4db5271b74cf8ece2", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-11T03:46:33Z", "type": "commit"}, {"oid": "275618d6477d0406defa1637c5788cd8f6f47171", "url": "https://github.com/rstudio/rstudio/commit/275618d6477d0406defa1637c5788cd8f6f47171", "message": "derive width from panmirror widget in visual mode", "committedDate": "2020-08-11T18:29:52Z", "type": "commit"}, {"oid": "05b41d3c42adaaeb55cad27c46f855339e00952d", "url": "https://github.com/rstudio/rstudio/commit/05b41d3c42adaaeb55cad27c46f855339e00952d", "message": "plumbing for reading chunk defs in visual mode", "committedDate": "2020-08-12T20:35:30Z", "type": "commit"}, {"oid": "c6bba63323be15c0df15ba8c7d4298df3e43e7ef", "url": "https://github.com/rstudio/rstudio/commit/c6bba63323be15c0df15ba8c7d4298df3e43e7ef", "message": "move notebook output into ace on deactivate", "committedDate": "2020-08-12T22:12:37Z", "type": "commit"}, {"oid": "71372edae1205652306108cf439273d28fbae103", "url": "https://github.com/rstudio/rstudio/commit/71372edae1205652306108cf439273d28fbae103", "message": "hook up chunk height rendering in visual mode", "committedDate": "2020-08-13T04:52:02Z", "type": "commit"}, {"oid": "37d87eb6068a48f72c2848fcfccb35d3b8b661f7", "url": "https://github.com/rstudio/rstudio/commit/37d87eb6068a48f72c2848fcfccb35d3b8b661f7", "message": "complete chunk roundtrip from code/visual mode", "committedDate": "2020-08-13T22:58:59Z", "type": "commit"}, {"oid": "079824025eb58e58d21c79f6803c8b4454aaacdb", "url": "https://github.com/rstudio/rstudio/commit/079824025eb58e58d21c79f6803c8b4454aaacdb", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-13T23:08:49Z", "type": "commit"}, {"oid": "e4dad9a9d8ae75ef0f2fec61d274b18ee388d3f6", "url": "https://github.com/rstudio/rstudio/commit/e4dad9a9d8ae75ef0f2fec61d274b18ee388d3f6", "message": "size chunk output naturally in visual mode", "committedDate": "2020-08-14T18:07:18Z", "type": "commit"}, {"oid": "b2cb68f03b10490faceb70d72dddef92cb941a39", "url": "https://github.com/rstudio/rstudio/commit/b2cb68f03b10490faceb70d72dddef92cb941a39", "message": "sync scope tree to visual position on ast=>markdown", "committedDate": "2020-08-17T20:34:57Z", "type": "commit"}, {"oid": "c618902219911a4e152f4093848bc50ee1da605e", "url": "https://github.com/rstudio/rstudio/commit/c618902219911a4e152f4093848bc50ee1da605e", "message": "plumbing for pre-execution sync to editor", "committedDate": "2020-08-17T23:57:21Z", "type": "commit"}, {"oid": "f582680cf7d2a22eac4c5d85fa02a5255196ec5e", "url": "https://github.com/rstudio/rstudio/commit/f582680cf7d2a22eac4c5d85fa02a5255196ec5e", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-17T23:59:11Z", "type": "commit"}, {"oid": "f05671222536ac6344126c5a9ec62ecb6a06dcbf", "url": "https://github.com/rstudio/rstudio/commit/f05671222536ac6344126c5a9ec62ecb6a06dcbf", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-19T23:03:29Z", "type": "commit"}, {"oid": "2f3d9a8a6f4578023d9279dc4211bed8656b03c2", "url": "https://github.com/rstudio/rstudio/commit/2f3d9a8a6f4578023d9279dc4211bed8656b03c2", "message": "forward selection to parent and execute there", "committedDate": "2020-08-20T21:02:07Z", "type": "commit"}, {"oid": "6c51cf9b7442ddfc2c911ac8e878e46f86e68fe4", "url": "https://github.com/rstudio/rstudio/commit/6c51cf9b7442ddfc2c911ac8e878e46f86e68fe4", "message": "refactoring for drawing real chunk toolbars in visual mode", "committedDate": "2020-08-20T23:06:08Z", "type": "commit"}, {"oid": "5e42dd29d2d1fb5bb88d727a0defa4fa8ae301b0", "url": "https://github.com/rstudio/rstudio/commit/5e42dd29d2d1fb5bb88d727a0defa4fa8ae301b0", "message": "add classes for visual line exec states", "committedDate": "2020-08-21T23:14:30Z", "type": "commit"}, {"oid": "0700d2a728664259446cfb212f7b464204bfa689", "url": "https://github.com/rstudio/rstudio/commit/0700d2a728664259446cfb212f7b464204bfa689", "message": "refactor for mapping line execution state for visual mode", "committedDate": "2020-08-21T23:51:32Z", "type": "commit"}, {"oid": "589d654be6434726bd25bfd747908358aee30a5f", "url": "https://github.com/rstudio/rstudio/commit/589d654be6434726bd25bfd747908358aee30a5f", "message": "complete execution state line decoration", "committedDate": "2020-08-24T22:30:28Z", "type": "commit"}, {"oid": "29cd26c99077daf8f25e8a92058a794de250d9e4", "url": "https://github.com/rstudio/rstudio/commit/29cd26c99077daf8f25e8a92058a794de250d9e4", "message": "remove static chunk execution toolbar", "committedDate": "2020-08-24T22:43:45Z", "type": "commit"}, {"oid": "0a44d322ae414b42eced40f792412d80b30e7b4d", "url": "https://github.com/rstudio/rstudio/commit/0a44d322ae414b42eced40f792412d80b30e7b4d", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-24T22:45:17Z", "type": "commit"}, {"oid": "d6b74566495a7d9f256bd7d12ae3d2a0462202f1", "url": "https://github.com/rstudio/rstudio/commit/d6b74566495a7d9f256bd7d12ae3d2a0462202f1", "message": "use shared chunk execution toolbar", "committedDate": "2020-08-24T23:24:50Z", "type": "commit"}, {"oid": "5747a7e92f496985870143eccaf3f4c9d392be9e", "url": "https://github.com/rstudio/rstudio/commit/5747a7e92f496985870143eccaf3f4c9d392be9e", "message": "visual improvements; clean up resting exec state", "committedDate": "2020-08-25T16:48:14Z", "type": "commit"}, {"oid": "e685a214ece0fd29704ca7863eb9940b08a9b9a8", "url": "https://github.com/rstudio/rstudio/commit/e685a214ece0fd29704ca7863eb9940b08a9b9a8", "message": "clean up old console-only chunk execution system", "committedDate": "2020-08-25T17:29:48Z", "type": "commit"}, {"oid": "865d98563ccf70bb40db13099abbd201822d254c", "url": "https://github.com/rstudio/rstudio/commit/865d98563ccf70bb40db13099abbd201822d254c", "message": "manage run current/next chunk through IDE commands", "committedDate": "2020-08-25T18:00:49Z", "type": "commit"}, {"oid": "e182ca5bdf28add4fc10f57dc53e668693b7e020", "url": "https://github.com/rstudio/rstudio/commit/e182ca5bdf28add4fc10f57dc53e668693b7e020", "message": "compute plot width against content width in visual mode", "committedDate": "2020-08-25T22:50:48Z", "type": "commit"}, {"oid": "3f6804bd23e0eea4bd6e9fbccec60d5cc59985c2", "url": "https://github.com/rstudio/rstudio/commit/3f6804bd23e0eea4bd6e9fbccec60d5cc59985c2", "message": "ensure editor sync'ed before running chunks from toolbar", "committedDate": "2020-08-25T23:24:24Z", "type": "commit"}, {"oid": "31ce1f51466e4fec5cbb0407da82c101198eb14b", "url": "https://github.com/rstudio/rstudio/commit/31ce1f51466e4fec5cbb0407da82c101198eb14b", "message": "scan scope tree for chunks recursively", "committedDate": "2020-08-25T23:55:55Z", "type": "commit"}, {"oid": "590b957e611898b98cfae51c11d7d970ab907544", "url": "https://github.com/rstudio/rstudio/commit/590b957e611898b98cfae51c11d7d970ab907544", "message": "clear definition when chunks are removed in visual mode", "committedDate": "2020-08-26T17:21:41Z", "type": "commit"}, {"oid": "74b8b19fdc2106106bb05ef8614c9a52a2038f54", "url": "https://github.com/rstudio/rstudio/commit/74b8b19fdc2106106bb05ef8614c9a52a2038f54", "message": "add support for editing chunk options via UI", "committedDate": "2020-08-26T18:05:17Z", "type": "commit"}, {"oid": "ec13e0d0e921701e30c8780ce7b9f9cfd48063cb", "url": "https://github.com/rstudio/rstudio/commit/ec13e0d0e921701e30c8780ce7b9f9cfd48063cb", "message": "show chunk execution state in toolbar", "committedDate": "2020-08-26T18:35:02Z", "type": "commit"}, {"oid": "e8e1ad52dfda97ec5f0116e033e8d4efbd9db01e", "url": "https://github.com/rstudio/rstudio/commit/e8e1ad52dfda97ec5f0116e033e8d4efbd9db01e", "message": "code cleanup; avoid double unwrap of output", "committedDate": "2020-08-26T22:57:56Z", "type": "commit"}, {"oid": "93f7abecc7f2854c25c6e6700485738f4e457d1b", "url": "https://github.com/rstudio/rstudio/commit/93f7abecc7f2854c25c6e6700485738f4e457d1b", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-08-26T23:03:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5MjYwNQ==", "url": "https://github.com/rstudio/rstudio/pull/7666#discussion_r480992605", "bodyText": "Is this intended to capture all valid knitr chunks in a file? If so it may not get indented chunks or chunks inside a blockquote (see knitr regex patterns and/or patterns we use in source capsule detection).", "author": "jjallaire", "createdAt": "2020-09-01T09:16:42Z", "path": "src/gwt/src/org/rstudio/core/client/RegexUtil.java", "diffHunk": "@@ -67,6 +67,9 @@ private static final native String makeWordCharacter()\n    public static final Pattern RE_SWEAVE_CHUNK_END =\n          Pattern.create(\"^\\\\s*@\\\\s*$\", \"\");\n    \n+   public static final Pattern RE_EMBEDDED_R_CHUNK_BEGIN =", "originalCommit": "93f7abecc7f2854c25c6e6700485738f4e457d1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI2MTc2NQ==", "url": "https://github.com/rstudio/rstudio/pull/7666#discussion_r481261765", "bodyText": "It isn't; it is only used inside the embedded Ace instances (EMBEDDED) where we thankfully don't have to worry about that.", "author": "jmcphers", "createdAt": "2020-09-01T16:08:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5MjYwNQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5OTg1Mw==", "url": "https://github.com/rstudio/rstudio/pull/7666#discussion_r480999853", "bodyText": "You may have some pretty funky merge conflicts here as I took part of this function and wrapped it in a handler that does some prompting the first time visual mode is activated and/or when we may plow over column or sentence based line wrapping. Here's the gist of my change: 0c4edf4#diff-06b7d8ba9d7ace26762c2194678a2fd8", "author": "jjallaire", "createdAt": "2020-09-01T09:29:07Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java", "diffHunk": "@@ -292,25 +317,42 @@ public void execute(JsObject obj)\n                {\n                   PanmirrorCode markdown = Js.uncheckedCast(obj);\n                   rv.arrive(() -> {\n-                     if (markdown == null) {\n+                     if (markdown == null)\n+                     {\n                         // note that ready.execute() is never called in the error case\n                         return;\n                      }\n                      \n+                     // we are about to mutate the document, so create a single", "originalCommit": "93f7abecc7f2854c25c6e6700485738f4e457d1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTI4Mzg2OA==", "url": "https://github.com/rstudio/rstudio/pull/7666#discussion_r481283868", "bodyText": "Thanks, will attempt to resolve and get your review when complete!", "author": "jmcphers", "createdAt": "2020-09-01T16:38:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDk5OTg1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "27cf0a4804120cf0c4126997fb70cf0ccadb5379", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java\nindex 80ec7c3bb7..399f458c11 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualMode.java\n\n@@ -316,7 +318,8 @@ public class VisualMode implements VisualModeEditorSync,\n                public void execute(JsObject obj)\n                {\n                   PanmirrorCode markdown = Js.uncheckedCast(obj);\n-                  rv.arrive(() -> {\n+                  rv.arrive(() ->\n+                  {\n                      if (markdown == null)\n                      {\n                         // note that ready.execute() is never called in the error case\n"}}, {"oid": "76956c53409e7b7adeb06fa2bd81f855e4b30700", "url": "https://github.com/rstudio/rstudio/commit/76956c53409e7b7adeb06fa2bd81f855e4b30700", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-09-01T20:57:46Z", "type": "commit"}, {"oid": "22e677b0fbaf706949866fe0f53e8d04fba1c94a", "url": "https://github.com/rstudio/rstudio/commit/22e677b0fbaf706949866fe0f53e8d04fba1c94a", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-09-01T21:22:45Z", "type": "commit"}, {"oid": "27cf0a4804120cf0c4126997fb70cf0ccadb5379", "url": "https://github.com/rstudio/rstudio/commit/27cf0a4804120cf0c4126997fb70cf0ccadb5379", "message": "add another field to track selection-only conversion", "committedDate": "2020-09-01T21:32:22Z", "type": "commit"}, {"oid": "35f9e17b8f34d4f6783efd90a3bc72e0d2c52bc4", "url": "https://github.com/rstudio/rstudio/commit/35f9e17b8f34d4f6783efd90a3bc72e0d2c52bc4", "message": "hide row execution state from screen readers", "committedDate": "2020-09-01T21:52:01Z", "type": "commit"}, {"oid": "6b061ab14e30b36f6387e9c38bad3421f4235587", "url": "https://github.com/rstudio/rstudio/commit/6b061ab14e30b36f6387e9c38bad3421f4235587", "message": "fix some issues with output attach/reattach", "committedDate": "2020-09-02T17:01:11Z", "type": "commit"}, {"oid": "64d5ef2ca0eb5ce607dde4f8445be5b62643cdad", "url": "https://github.com/rstudio/rstudio/commit/64d5ef2ca0eb5ce607dde4f8445be5b62643cdad", "message": "reduce churn in capsule loop", "committedDate": "2020-09-02T22:13:40Z", "type": "commit"}, {"oid": "1327adabcaae698072647ae0c259b76d51e70341", "url": "https://github.com/rstudio/rstudio/commit/1327adabcaae698072647ae0c259b76d51e70341", "message": "avoid creating duplicate visual mode outputs", "committedDate": "2020-09-03T19:35:27Z", "type": "commit"}, {"oid": "56d1bdf9b21c92117d6b4f97d4012c55e01f3bd7", "url": "https://github.com/rstudio/rstudio/commit/56d1bdf9b21c92117d6b4f97d4012c55e01f3bd7", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-09-03T19:37:23Z", "type": "commit"}, {"oid": "103b4d5f9c2911596bbaed3abb24b97134b611f0", "url": "https://github.com/rstudio/rstudio/commit/103b4d5f9c2911596bbaed3abb24b97134b611f0", "message": "ensure chunks are matched correctly during cache replay", "committedDate": "2020-09-04T21:25:01Z", "type": "commit"}, {"oid": "859c36298bc8a615d7d7e33c3015d12d3e6c7578", "url": "https://github.com/rstudio/rstudio/commit/859c36298bc8a615d7d7e33c3015d12d3e6c7578", "message": "ensure autosave is triggered when chunks are executed in committed mode", "committedDate": "2020-09-04T22:52:05Z", "type": "commit"}, {"oid": "6790e179a6d363301beb37087d49d57040a1f3ba", "url": "https://github.com/rstudio/rstudio/commit/6790e179a6d363301beb37087d49d57040a1f3ba", "message": "Merge remote-tracking branch 'origin/master' into feature/visual-mode-notebook-output", "committedDate": "2020-09-04T22:58:16Z", "type": "commit"}]}