{"pr_number": 7146, "pr_title": "reenable legacy spellchecker due to blacklisted dictionaries", "pr_createdAt": "2020-06-16T17:38:39Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7146", "timeline": [{"oid": "1a1a657574d621c09c6b5c7f6c5f1a426798ae59", "url": "https://github.com/rstudio/rstudio/commit/1a1a657574d621c09c6b5c7f6c5f1a426798ae59", "message": "reenable legacy spellchecker due to blacklisted dictionaries", "committedDate": "2020-06-16T17:35:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjgyOQ==", "url": "https://github.com/rstudio/rstudio/pull/7146#discussion_r441046829", "bodyText": "Nit: brace style", "author": "jmcphers", "createdAt": "2020-06-16T18:11:52Z", "path": "src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java", "diffHunk": "@@ -274,6 +275,15 @@ private boolean checkCustomDicts(String word)\n \n    public void checkSpelling(List<String> words, final ServerRequestCallback<SpellCheckerResult> callback)\n    {\n+      // If realtime is turned off call the backend spellchecker because we haven't loaded a\n+      // dictionary on the frontend. Ideally we DO load the frontend dictionary but currently\n+      // Typo.js isn't compatible with some of our dictionaries (see: TypoSpellChecker.realtimeBlacklist)\n+      // so we need to keep the legacy call for now.\n+      if (!userPrefs_.realTimeSpellchecking().getValue()) {", "originalCommit": "1a1a657574d621c09c6b5c7f6c5f1a426798ae59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1OTM4Nw==", "url": "https://github.com/rstudio/rstudio/pull/7146#discussion_r441159387", "bodyText": "You get too used to using your preferred brace style in JavaScript for a while and this happens...", "author": "adamconroy", "createdAt": "2020-06-16T21:43:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjgyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "95d717009e281c7255d6185548438751badfeea6", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java b/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\nindex ceaddf233b..57fd9185aa 100644\n--- a/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\n+++ b/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\n\n@@ -279,7 +279,8 @@ public class TypoSpellChecker\n       // dictionary on the frontend. Ideally we DO load the frontend dictionary but currently\n       // Typo.js isn't compatible with some of our dictionaries (see: TypoSpellChecker.realtimeBlacklist)\n       // so we need to keep the legacy call for now.\n-      if (!userPrefs_.realTimeSpellchecking().getValue()) {\n+      if (!userPrefs_.realTimeSpellchecking().getValue())\n+      {\n          spellingService_.checkSpelling(words, callback);\n          return;\n       }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0Nzc2Nw==", "url": "https://github.com/rstudio/rstudio/pull/7146#discussion_r441047767", "bodyText": "Could you use parens to group this so it's clear that the intent is to group the first two tests? (presuming that's the intent -- this isn't clear to me at first glance)", "author": "jmcphers", "createdAt": "2020-06-16T18:13:35Z", "path": "src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java", "diffHunk": "@@ -372,7 +382,7 @@ private void loadDictionary()\n    {\n       final String language = userPrefs_.spellingDictionaryLanguage().getValue();\n \n-      if (typoLoaded_ && loadedDict_.equals(language))\n+      if (!userPrefs_.realTimeSpellchecking().getValue() || typoLoaded_ && loadedDict_.equals(language))", "originalCommit": "1a1a657574d621c09c6b5c7f6c5f1a426798ae59", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTE1OTE5NQ==", "url": "https://github.com/rstudio/rstudio/pull/7146#discussion_r441159195", "bodyText": "It is not the intent. We want to exit out of this function if either realtime is turned off or the dictionary is loaded AND it's the correct dictionary. I'll put it on another line so it's a bit more clear. This is actually just reverting it to the exact same code from before the prior PR to here.", "author": "adamconroy", "createdAt": "2020-06-16T21:43:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0Nzc2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "95d717009e281c7255d6185548438751badfeea6", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java b/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\nindex ceaddf233b..57fd9185aa 100644\n--- a/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\n+++ b/src/gwt/src/org/rstudio/studio/client/common/spelling/TypoSpellChecker.java\n\n@@ -382,7 +383,8 @@ public class TypoSpellChecker\n    {\n       final String language = userPrefs_.spellingDictionaryLanguage().getValue();\n \n-      if (!userPrefs_.realTimeSpellchecking().getValue() || typoLoaded_ && loadedDict_.equals(language))\n+      if (!userPrefs_.realTimeSpellchecking().getValue() ||\n+           typoLoaded_ && loadedDict_.equals(language))\n          return;\n \n       // See canRealtimeSpellcheckDict comment, temporary stop gap\n"}}, {"oid": "95d717009e281c7255d6185548438751badfeea6", "url": "https://github.com/rstudio/rstudio/commit/95d717009e281c7255d6185548438751badfeea6", "message": "pr feedback", "committedDate": "2020-06-16T21:47:59Z", "type": "commit"}]}