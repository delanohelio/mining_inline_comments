{"pr_number": 6170, "pr_title": "Add stop button within job output display", "pr_createdAt": "2020-02-05T23:17:05Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6170", "timeline": [{"oid": "55e05d3248160247e1be153615a2591e47e14549", "url": "https://github.com/rstudio/rstudio/commit/55e05d3248160247e1be153615a2591e47e14549", "message": "Add stop button to job output display\n- move JobResources from JobItem to new class\n- add stop button to JobProgress displayed with job output\n- add eventBus to JobProgress so it can stop the job", "committedDate": "2020-02-05T22:48:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzY4MQ==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375573681", "bodyText": "Minor style thing: new code can use lambda syntax instead of anonymous class, so:\nstop_.addClickHandler(clickEvent -> eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP));", "author": "gtritchie", "createdAt": "2020-02-05T23:52:43Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +77,39 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(new ClickHandler()", "originalCommit": "55e05d3248160247e1be153615a2591e47e14549", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MDg5OQ==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375580899", "bodyText": "Thanks Gary, made the change \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-02-06T00:18:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzY4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\nindex 4f57266a87..d27641777c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n\n@@ -77,14 +76,8 @@ public class JobProgress extends Composite\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n-      stop_.addClickHandler(new ClickHandler()\n-      {\n-         @Override\n-         public void onClick(ClickEvent event)\n-         {\n-            eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP));\n-         }\n-      });\n+      stop_.addClickHandler(clickEvent ->\n+         eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP)));\n \n       if (job.completed > 0)\n       {\n"}}, {"oid": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "url": "https://github.com/rstudio/rstudio/commit/ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "message": "switch anonymous class for lambda syntax", "committedDate": "2020-02-06T00:17:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTU4Mg==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375581582", "bodyText": "Whether or not a job is stoppable is independent of whether or not it has a progress bar. I think we should make the button visible based on whether or not the job implements the stop action.", "author": "jmcphers", "createdAt": "2020-02-06T00:20:58Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -63,26 +76,33 @@ public void showJob(Job job)\n       name_.setText(job.name);\n       progress_.setLabel(job.name);\n       String status = JobConstants.stateDescription(job.state);\n+      stop_.addClickHandler(clickEvent ->\n+         eventBus_.fireEvent(new JobExecuteActionEvent(job.id, JobConstants.ACTION_STOP)));\n+\n       if (job.completed > 0)\n       {\n          // Job is not running; show its completion status and time\n          progress_.setVisible(false);\n          status += \" \" + StringUtil.friendlyDateTime(new Date(job.completed * 1000));\n          elapsed_.setText(StringUtil.conciseElaspedTime(job.completed - job.started));\n          status_.setVisible(true);\n+         stop_.setVisible(false);\n       }\n       else if (job.max > 0)\n       {\n-         // Job is running and has a progress bar; show it and hide the status indicator\n+         // Job is running and has a progress bar;\n+         // show it with stop button and hide the status indicator\n          progress_.setVisible(true);\n          progress_.setProgress(job.progress, job.max);\n          status_.setVisible(false);\n+         stop_.setVisible(true);", "originalCommit": "ed29edbc6db0aa3aaba3be860f9d8e4384b14e7a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYwNTAwNg==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375605006", "bodyText": "Thanks for pointing this out! I reverted the original comments and updated the stop button logic.", "author": "melissa-barca", "createdAt": "2020-02-06T01:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU4MTU4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\nindex d27641777c..052a4920cc 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n\n@@ -86,29 +87,34 @@ public class JobProgress extends Composite\n          status += \" \" + StringUtil.friendlyDateTime(new Date(job.completed * 1000));\n          elapsed_.setText(StringUtil.conciseElaspedTime(job.completed - job.started));\n          status_.setVisible(true);\n-         stop_.setVisible(false);\n       }\n       else if (job.max > 0)\n       {\n-         // Job is running and has a progress bar;\n-         // show it with stop button and hide the status indicator\n+         // Job is running and has a progress bar; show it and hide the status indicator\n          progress_.setVisible(true);\n          progress_.setProgress(job.progress, job.max);\n          status_.setVisible(false);\n-         stop_.setVisible(true);\n       }\n       else\n       {\n-         // Job is running but does not have progress; show the status field and stop button\n+         // Job is running but does not have progress; show the status field\n          progress_.setVisible(false);\n          status_.setVisible(true);\n-         stop_.setVisible(true);\n          if (!StringUtil.isNullOrEmpty(job.status))\n          {\n             // Still running; show its status\n             status = job.status;\n          }\n       }\n+\n+      // show stop button if job has a \"stop\" action, and is not completed\n+      if (job.completed == 0)\n+         stop_.setVisible(\n+               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n+               job.completed == 0);\n+      else\n+         stop_.setVisible(false);\n+\n       status_.setText(status);\n       jobProgress_ = new LocalJobProgress(job);\n       complete_ = job.completed > 0;\n"}}, {"oid": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "url": "https://github.com/rstudio/rstudio/commit/1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "message": "show stop button when job is not complete and implements the stop action\nremove code showing stop button based on progress bar", "committedDate": "2020-02-06T01:51:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk3NDI2Mg==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375974262", "bodyText": "No need for this test since it's inside an if statement that already guarantees the condition.", "author": "jmcphers", "createdAt": "2020-02-06T17:24:22Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java", "diffHunk": "@@ -89,6 +106,15 @@ else if (job.max > 0)\n             status = job.status;\n          }\n       }\n+\n+      // show stop button if job has a \"stop\" action, and is not completed\n+      if (job.completed == 0)\n+         stop_.setVisible(\n+               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n+               job.completed == 0);", "originalCommit": "1b3eee2dec9fdb8a9cf70c4cf806684cd5e1b9b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk4Nzk4Nw==", "url": "https://github.com/rstudio/rstudio/pull/6170#discussion_r375987987", "bodyText": "Fixed \ud83d\udc4d", "author": "melissa-barca", "createdAt": "2020-02-06T17:50:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTk3NDI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "853075174051af3a8af45af55994f1b7b2216556", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\nindex 052a4920cc..a2f9fc3777 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/jobs/view/JobProgress.java\n\n@@ -109,9 +109,7 @@ public class JobProgress extends Composite\n \n       // show stop button if job has a \"stop\" action, and is not completed\n       if (job.completed == 0)\n-         stop_.setVisible(\n-               JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP) &&\n-               job.completed == 0);\n+         stop_.setVisible(JsArrayUtil.jsArrayStringContains(job.actions, JobConstants.ACTION_STOP));\n       else\n          stop_.setVisible(false);\n \n"}}, {"oid": "853075174051af3a8af45af55994f1b7b2216556", "url": "https://github.com/rstudio/rstudio/commit/853075174051af3a8af45af55994f1b7b2216556", "message": "remove redundant comparison", "committedDate": "2020-02-06T17:46:02Z", "type": "commit"}, {"oid": "7b3c6ea41c43301f5b7c86dc20185719e5780238", "url": "https://github.com/rstudio/rstudio/commit/7b3c6ea41c43301f5b7c86dc20185719e5780238", "message": "Merge branch 'v1.4' of https://github.com/rstudio/rstudio into feature/interrupt-job-output", "committedDate": "2020-02-06T18:12:11Z", "type": "commit"}, {"oid": "ba48907467672f5a33ff4266666401de6c7d6667", "url": "https://github.com/rstudio/rstudio/commit/ba48907467672f5a33ff4266666401de6c7d6667", "message": "Update NEWS-1.4.md stop button added to job output", "committedDate": "2020-02-06T18:15:13Z", "type": "commit"}]}