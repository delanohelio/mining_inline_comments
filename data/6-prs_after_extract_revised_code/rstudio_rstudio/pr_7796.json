{"pr_number": 7796, "pr_title": "Fix issue with zoom column commands", "pr_createdAt": "2020-09-15T17:12:02Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7796", "timeline": [{"oid": "bc59fd36bf5d2130b8f8d6fdf9e29c1c98ef3c2a", "url": "https://github.com/rstudio/rstudio/commit/bc59fd36bf5d2130b8f8d6fdf9e29c1c98ef3c2a", "message": "Hide and show columns when zooming on a specified tab", "committedDate": "2020-09-01T16:05:56Z", "type": "commit"}, {"oid": "1b15d9db9774e6d46921ab7c782003dd1827d7a3", "url": "https://github.com/rstudio/rstudio/commit/1b15d9db9774e6d46921ab7c782003dd1827d7a3", "message": "rename methods", "committedDate": "2020-09-01T17:03:36Z", "type": "commit"}, {"oid": "ca7b2aaf0788792dfb6f68461b180f20dd83d914", "url": "https://github.com/rstudio/rstudio/commit/ca7b2aaf0788792dfb6f68461b180f20dd83d914", "message": "hide additional source columns when zooming on left or right column", "committedDate": "2020-09-01T22:39:17Z", "type": "commit"}, {"oid": "51d328121e50bbd809944e6c60270c2cff8c008d", "url": "https://github.com/rstudio/rstudio/commit/51d328121e50bbd809944e6c60270c2cff8c008d", "message": "fix bug where left column wouldn't resize properly", "committedDate": "2020-09-02T17:28:56Z", "type": "commit"}, {"oid": "1d740759ed30d39e0d2182351c33fa0ea2b785e4", "url": "https://github.com/rstudio/rstudio/commit/1d740759ed30d39e0d2182351c33fa0ea2b785e4", "message": "restore correct widths of source columns", "committedDate": "2020-09-03T22:01:44Z", "type": "commit"}, {"oid": "af48084a94253d331655b9e965096ad9895b0b0e", "url": "https://github.com/rstudio/rstudio/commit/af48084a94253d331655b9e965096ad9895b0b0e", "message": "remove unneeded code", "committedDate": "2020-09-08T17:22:30Z", "type": "commit"}, {"oid": "da1f2b1a53af886edf8f21ccf12bec49870b3440", "url": "https://github.com/rstudio/rstudio/commit/da1f2b1a53af886edf8f21ccf12bec49870b3440", "message": "rename variables", "committedDate": "2020-09-08T17:24:10Z", "type": "commit"}, {"oid": "859c3d719607d8ef2a4eb521d601b6e43f6e96fa", "url": "https://github.com/rstudio/rstudio/commit/859c3d719607d8ef2a4eb521d601b6e43f6e96fa", "message": "code clean up", "committedDate": "2020-09-08T19:42:50Z", "type": "commit"}, {"oid": "7825906bf81e0dc1ce777825df114c9e06bd290a", "url": "https://github.com/rstudio/rstudio/commit/7825906bf81e0dc1ce777825df114c9e06bd290a", "message": "ensure the correct source is made visible on ensureVisible", "committedDate": "2020-09-08T23:35:05Z", "type": "commit"}, {"oid": "23db03ce6cade3242092b1be37eec0d20ef6c3ce", "url": "https://github.com/rstudio/rstudio/commit/23db03ce6cade3242092b1be37eec0d20ef6c3ce", "message": "set a state for source columns", "committedDate": "2020-09-15T14:54:30Z", "type": "commit"}, {"oid": "1d201ec7e373393cdc957225eba696c9ca36d2fb", "url": "https://github.com/rstudio/rstudio/commit/1d201ec7e373393cdc957225eba696c9ca36d2fb", "message": "code clean up and add comments", "committedDate": "2020-09-15T16:54:05Z", "type": "commit"}, {"oid": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "url": "https://github.com/rstudio/rstudio/commit/eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "message": "update command name", "committedDate": "2020-09-15T17:05:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0NzgzMQ==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488947831", "bodyText": "Do we have an issue open on this?", "author": "jmcphers", "createdAt": "2020-09-15T20:17:46Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -577,10 +590,12 @@ public void onLayoutConsoleOnRight()\n       }\n    }\n \n+   // The following commands need to be updated to fit the new layout with additional source \n+   // columns. The mismatched names/actions are temporarily intentional until this is handled.", "originalCommit": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk3MDMxOA==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488970318", "bodyText": "I've created one here: #7801", "author": "melissa-barca", "createdAt": "2020-09-15T21:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0NzgzMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488948568", "bodyText": "Nit: addAll will do this in one line", "author": "jmcphers", "createdAt": "2020-09-15T20:19:14Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java", "diffHunk": "@@ -946,7 +1106,26 @@ private void restoreSavedLayout()\n          window.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n \n       maximizedWindow_.onWindowStateChange(new WindowStateChangeEvent(WindowState.NORMAL, true));\n-      resizeHorizontally(panel_.getWidgetSize(right_), widgetSizePriorToZoom_);\n+      \n+      ArrayList<Double> leftStart = new ArrayList<>();\n+      ArrayList<Double> leftEnd = new ArrayList<>();\n+      if (leftList_.size() > 0)\n+      {\n+         for (int i = 0; i < leftList_.size(); i++)\n+            leftStart.add(0.0);\n+\n+         if (leftWidgetSizePriorToZoom_.size() != leftList_.size())\n+            leftEnd = getValidColumnWidths(leftList_, leftWidgetSizePriorToZoom_, false);\n+         else\n+         {\n+            // Copy leftWidgetSizePriorToZoom_ rather than passing it directly because it may be\n+            // cleared before animation completes\n+            for (Double size : leftWidgetSizePriorToZoom_)\n+               leftEnd.add(size);", "originalCommit": "eed99b8dff3d4cd4265d31202c76b2a0c229b8fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk3MTI3Mw==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r488971273", "bodyText": "Doesn't addAll only do a shallow copy though?", "author": "melissa-barca", "createdAt": "2020-09-15T21:02:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxMDEzMQ==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r489010131", "bodyText": "IntelliJ also recommends replacing with addAll.", "author": "gtritchie", "createdAt": "2020-09-15T22:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxNjI4NQ==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r489016285", "bodyText": "It does do a shallow copy, but this loop also does a shallow copy.", "author": "jmcphers", "createdAt": "2020-09-15T22:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAyOTkwNQ==", "url": "https://github.com/rstudio/rstudio/pull/7796#discussion_r489029905", "bodyText": "You're right, but I think it's ok because this gets passed as a final parameter. I've updated to follow your nit.", "author": "melissa-barca", "createdAt": "2020-09-15T22:28:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0ODU2OA=="}], "type": "inlineReview", "revised_code": {"commit": "6e736e885911d71d98b2c8c7ba398c008c79e0ad", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\nindex 56a0a170df..36bbd15023 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/ui/PaneManager.java\n\n@@ -1117,12 +1117,7 @@ public class PaneManager\n          if (leftWidgetSizePriorToZoom_.size() != leftList_.size())\n             leftEnd = getValidColumnWidths(leftList_, leftWidgetSizePriorToZoom_, false);\n          else\n-         {\n-            // Copy leftWidgetSizePriorToZoom_ rather than passing it directly because it may be\n-            // cleared before animation completes\n-            for (Double size : leftWidgetSizePriorToZoom_)\n-               leftEnd.add(size);\n-         }\n+            leftEnd.addAll(leftWidgetSizePriorToZoom_);\n       }\n \n       resizeHorizontally(panel_.getWidgetSize(right_), widgetSizePriorToZoom_, leftStart, leftEnd);\n"}}, {"oid": "6e736e885911d71d98b2c8c7ba398c008c79e0ad", "url": "https://github.com/rstudio/rstudio/commit/6e736e885911d71d98b2c8c7ba398c008c79e0ad", "message": "simplify code", "committedDate": "2020-09-15T22:27:53Z", "type": "commit"}]}