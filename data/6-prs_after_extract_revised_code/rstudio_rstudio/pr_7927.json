{"pr_number": 7927, "pr_title": "allow 'getSourceEditorContext()', 'replaceRange()' to work within visual mode chunks", "pr_createdAt": "2020-09-30T18:58:05Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7927", "timeline": [{"oid": "a19f9dd497078590cf129b1091962ff551788efc", "url": "https://github.com/rstudio/rstudio/commit/a19f9dd497078590cf129b1091962ff551788efc", "message": "allow 'getSourceEditorContext()', 'replaceRange()' to work within visual mode chunks", "committedDate": "2020-09-30T18:55:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1MTM2NQ==", "url": "https://github.com/rstudio/rstudio/pull/7927#discussion_r497751365", "bodyText": "Nit: copy paste error?", "author": "jmcphers", "createdAt": "2020-09-30T19:32:26Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java", "diffHunk": "@@ -76,6 +76,22 @@ public PanmirrorUIChunks uiChunks()\n       return chunks;\n    }\n    \n+   /**\n+    * Finds the current visual mode chunk editor.\n+    * \n+    * @return A visual mode chunk editor at the given row, or null if one was", "originalCommit": "a19f9dd497078590cf129b1091962ff551788efc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "663868983320da4739d4adfc22c7f7f66d259c68", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\nindex 53b0f7213f..ba0529700c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\n\n@@ -76,22 +78,6 @@ public class VisualModeChunks implements ChunkDefinition.Provider\n       return chunks;\n    }\n    \n-   /**\n-    * Finds the current visual mode chunk editor.\n-    * \n-    * @return A visual mode chunk editor at the given row, or null if one was\n-    *   not found.\n-    */\n-   public VisualModeChunk getCurrentChunk()\n-   {\n-      for (VisualModeChunk chunk : chunks_)\n-         if (chunk.isActive())\n-            return chunk;\n-      \n-      return null;\n-   }\n-   \n-   \n    /**\n     * Finds the visual mode chunk editor corresponding to a given document row.\n     * \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NjcxNw==", "url": "https://github.com/rstudio/rstudio/pull/7927#discussion_r497756717", "bodyText": "An embedded editor is only considered active if it currently has keyboard focus (i.e. it becomes inactive on blur). Is this what you want here? (if you're looking for the last focused instance, these are real AceEditors so that class's static last focused instance method will work)", "author": "jmcphers", "createdAt": "2020-09-30T19:42:22Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java", "diffHunk": "@@ -76,6 +76,22 @@ public PanmirrorUIChunks uiChunks()\n       return chunks;\n    }\n    \n+   /**\n+    * Finds the current visual mode chunk editor.\n+    * \n+    * @return A visual mode chunk editor at the given row, or null if one was\n+    *   not found.\n+    */\n+   public VisualModeChunk getCurrentChunk()\n+   {\n+      for (VisualModeChunk chunk : chunks_)\n+         if (chunk.isActive())", "originalCommit": "a19f9dd497078590cf129b1091962ff551788efc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc3NzY0Ng==", "url": "https://github.com/rstudio/rstudio/pull/7927#discussion_r497777646", "bodyText": "Good catch! We definitely need to handle this case, since (for example) the target editor would lose focus when the user were to (for example) execute a command via the Addins toolbar.", "author": "kevinushey", "createdAt": "2020-09-30T20:22:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc1NjcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "663868983320da4739d4adfc22c7f7f66d259c68", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\nindex 53b0f7213f..ba0529700c 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/editors/text/visualmode/VisualModeChunks.java\n\n@@ -76,22 +78,6 @@ public class VisualModeChunks implements ChunkDefinition.Provider\n       return chunks;\n    }\n    \n-   /**\n-    * Finds the current visual mode chunk editor.\n-    * \n-    * @return A visual mode chunk editor at the given row, or null if one was\n-    *   not found.\n-    */\n-   public VisualModeChunk getCurrentChunk()\n-   {\n-      for (VisualModeChunk chunk : chunks_)\n-         if (chunk.isActive())\n-            return chunk;\n-      \n-      return null;\n-   }\n-   \n-   \n    /**\n     * Finds the visual mode chunk editor corresponding to a given document row.\n     * \n"}}, {"oid": "663868983320da4739d4adfc22c7f7f66d259c68", "url": "https://github.com/rstudio/rstudio/commit/663868983320da4739d4adfc22c7f7f66d259c68", "message": "clear last-active editor when panmirror focused", "committedDate": "2020-09-30T20:21:53Z", "type": "commit"}, {"oid": "c656833deda44eb73b712f126b2bc3a234c28c69", "url": "https://github.com/rstudio/rstudio/commit/c656833deda44eb73b712f126b2bc3a234c28c69", "message": "clean up warnings", "committedDate": "2020-09-30T20:25:23Z", "type": "commit"}, {"oid": "875efedb4dbc5e9359380b2bb8cd9d3c16ba1df1", "url": "https://github.com/rstudio/rstudio/commit/875efedb4dbc5e9359380b2bb8cd9d3c16ba1df1", "message": "null checks", "committedDate": "2020-09-30T20:27:25Z", "type": "commit"}]}