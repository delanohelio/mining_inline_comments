{"pr_number": 8232, "pr_title": "always enable save commands for new source docs", "pr_createdAt": "2020-10-29T21:48:44Z", "pr_url": "https://github.com/rstudio/rstudio/pull/8232", "timeline": [{"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31", "url": "https://github.com/rstudio/rstudio/commit/4c463b79c7a76a200cbb159df6b68f43dc765b31", "message": "manage save commands after opening new doc", "committedDate": "2020-10-29T21:47:32Z", "type": "commit"}, {"oid": "4c463b79c7a76a200cbb159df6b68f43dc765b31", "url": "https://github.com/rstudio/rstudio/commit/4c463b79c7a76a200cbb159df6b68f43dc765b31", "message": "manage save commands after opening new doc", "committedDate": "2020-10-29T21:47:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMTI2Mg==", "url": "https://github.com/rstudio/rstudio/pull/8232#discussion_r514601262", "bodyText": "The active parameter actually represents whether or not this is this column is the current active column. (activeEditor_ is only populated for the active column) You'll see in manageSaveCommands we use getNextActiveEditor() instead of directly accessing the active editor, this is a function that will return the editor that would become active if the column became active.\nWhen you open a new doc it gets set to the active editor so this code works fine except in the very unlikely case where this function gets called after the user has moved on and is working with a different file. Really it doesn't make a difference, but I think we should pass this == manager.getActive() here.", "author": "melissa-barca", "createdAt": "2020-10-29T22:21:51Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java", "diffHunk": "@@ -979,13 +978,14 @@ public void onResponseReceived(SourceDocument newDoc)\n                   // apply (dynamic) doc property defaults\n                   SourceColumn.applyDocPropertyDefaults(newDoc, true, userPrefs_);\n \n-                  EditingTarget target =\n-                     addTab(newDoc, Source.OPEN_INTERACTIVE);\n+                  EditingTarget target = addTab(newDoc, Source.OPEN_INTERACTIVE);\n \n-                  if (contents != null)\n+                  // toggle save commands after the editor has been opened,\n+                  // in case this action has created and focused a new editor\n+                  if (activeEditor_ != null)\n                   {\n                      target.forceSaveCommandActive();\n-                     manageSaveCommands(active);\n+                     manageSaveCommands(true);", "originalCommit": "4c463b79c7a76a200cbb159df6b68f43dc765b31", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyMjkzMQ==", "url": "https://github.com/rstudio/rstudio/pull/8232#discussion_r514622931", "bodyText": "Got it -- thanks for explaining!", "author": "kevinushey", "createdAt": "2020-10-29T23:23:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMTI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "99db6f6839ccf146674d40fdc306c0df097b6ecf", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java\nindex d815631ef7..408a583844 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/source/SourceColumn.java\n\n@@ -982,7 +982,7 @@ public class SourceColumn implements BeforeShowEvent.Handler,\n \n                   // toggle save commands after the editor has been opened,\n                   // in case this action has created and focused a new editor\n-                  if (activeEditor_ != null)\n+                  if (SourceColumn.this == manager_.getActive())\n                   {\n                      target.forceSaveCommandActive();\n                      manageSaveCommands(true);\n"}}, {"oid": "99db6f6839ccf146674d40fdc306c0df097b6ecf", "url": "https://github.com/rstudio/rstudio/commit/99db6f6839ccf146674d40fdc306c0df097b6ecf", "message": "check if source column associated with new doc is active", "committedDate": "2020-10-29T23:21:26Z", "type": "commit"}]}