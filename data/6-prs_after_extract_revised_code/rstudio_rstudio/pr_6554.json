{"pr_number": 6554, "pr_title": "Switch away from Jobs pane after successful package installation", "pr_createdAt": "2020-03-30T19:19:47Z", "pr_url": "https://github.com/rstudio/rstudio/pull/6554", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4NDMzOQ==", "url": "https://github.com/rstudio/rstudio/pull/6554#discussion_r400484339", "bodyText": "Nit: is this white space intentional?", "author": "melissa-barca", "createdAt": "2020-03-30T20:48:37Z", "path": "src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java", "diffHunk": "@@ -984,11 +1000,15 @@ public void onResponseReceived(String jobId)\n                   \n                   if (update.job.state == JobConstants.STATE_SUCCEEDED)\n                   {\n+", "originalCommit": "cf7dbd6953960e22eba47a8af88d9c79389e2c0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4ODU3NQ==", "url": "https://github.com/rstudio/rstudio/pull/6554#discussion_r400488575", "bodyText": "No, thanks!", "author": "jmcphers", "createdAt": "2020-03-30T20:56:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ4NDMzOQ=="}], "type": "inlineReview", "revised_code": {"commit": "3e97a4d91562198af73fc1c7dc5027f314e9c099", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java b/src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java\nindex 0c0a2fe798..d06c5556d3 100644\n--- a/src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java\n+++ b/src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java\n\n@@ -1000,7 +1000,6 @@ public class DependencyManager implements InstallShinyEvent.Handler,\n                   \n                   if (update.job.state == JobConstants.STATE_SUCCEEDED)\n                   {\n-\n                      // If the job succeeded, check to be sure our dependencies\n                      // are now satisfied\n                      ifDependenciesSatisifed(dependencies, \n"}}, {"oid": "3e97a4d91562198af73fc1c7dc5027f314e9c099", "url": "https://github.com/rstudio/rstudio/commit/3e97a4d91562198af73fc1c7dc5027f314e9c099", "message": "switch away from jobs pane after pkg installation", "committedDate": "2020-03-30T20:56:14Z", "type": "commit"}, {"oid": "3e97a4d91562198af73fc1c7dc5027f314e9c099", "url": "https://github.com/rstudio/rstudio/commit/3e97a4d91562198af73fc1c7dc5027f314e9c099", "message": "switch away from jobs pane after pkg installation", "committedDate": "2020-03-30T20:56:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ5MDYyMQ==", "url": "https://github.com/rstudio/rstudio/pull/6554#discussion_r400490621", "bodyText": "IMHO we should only do this if the Jobs tab is open and currently focused; otherwise we might steal focus from a user who's now working in the IDE on other stuff while installation goes on.", "author": "kevinushey", "createdAt": "2020-03-30T21:00:16Z", "path": "src/gwt/src/org/rstudio/studio/client/common/dependencies/DependencyManager.java", "diffHunk": "@@ -966,6 +967,21 @@ private void installDependencies(final String context,\n                                     final boolean silentEmbeddedUpdate,\n                                     final CommandWithArg<Boolean> onComplete)\n    {\n+    \n+      // Command to run when dependency installation is complete\n+      CommandWithArg<Boolean> onCompletion = satisfied ->\n+      {\n+         // Confirmed: dependencies are in place. Switch\n+         // away from the Jobs tab to put the user back in\n+         // context.\n+         if (satisfied)\n+         {\n+            events_.fireEvent(new ConsoleActivateEvent(false));", "originalCommit": "3e97a4d91562198af73fc1c7dc5027f314e9c099", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ5NDAxOQ==", "url": "https://github.com/rstudio/rstudio/pull/6554#discussion_r400494019", "bodyText": "That's a real risk, but unfortunately it's not so easy to detect whether the user has disturbed the state. We don't send focus to the jobs pane when the job starts running. Some refinement would be nice but is out of scope for 1.3.", "author": "jmcphers", "createdAt": "2020-03-30T21:06:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ5MDYyMQ=="}], "type": "inlineReview", "revised_code": null}]}