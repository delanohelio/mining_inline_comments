{"pr_number": 7692, "pr_title": "use 'save::save.image()' if 'save.image()' is masked", "pr_createdAt": "2020-08-31T21:47:29Z", "pr_url": "https://github.com/rstudio/rstudio/pull/7692", "timeline": [{"oid": "250f17f9cbca3e0ebf60abde812893421f34a069", "url": "https://github.com/rstudio/rstudio/commit/250f17f9cbca3e0ebf60abde812893421f34a069", "message": "add helper for detecting masked functions", "committedDate": "2020-08-31T21:13:45Z", "type": "commit"}, {"oid": "d6ceeb9d0e1c33378f4381f178a16fe93e084297", "url": "https://github.com/rstudio/rstudio/commit/d6ceeb9d0e1c33378f4381f178a16fe93e084297", "message": "consolidate commonly-used request handlers into own classes", "committedDate": "2020-08-31T21:23:47Z", "type": "commit"}, {"oid": "1dbef1ecc5e8efe0d3191bda82a8cc7fb0b69041", "url": "https://github.com/rstudio/rstudio/commit/1dbef1ecc5e8efe0d3191bda82a8cc7fb0b69041", "message": "use 'base::save.image' if masked", "committedDate": "2020-08-31T21:42:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNDAxNQ==", "url": "https://github.com/rstudio/rstudio/pull/7692#discussion_r481404015", "bodyText": "It seems like the behavior on error here is that we don't save the workspace at all, which seems wrong. Could we use the previous behavior (save.image) if we can't determine whether or not the function is masked?", "author": "jmcphers", "createdAt": "2020-09-01T20:13:39Z", "path": "src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java", "diffHunk": "@@ -443,10 +439,24 @@ void onSaveWorkspace()\n    {\n       view_.bringToFront();\n \n-      consoleDispatcher_.saveFileAsThenExecuteCommand(\"Save Workspace As\",\n-                                                      \".RData\",\n-                                                      true,\n-                                                      \"save.image\");\n+      server_.isFunctionMasked(\n+            \"save.image\",\n+            \"base\",\n+            new ErrorLoggingServerRequestCallback<Boolean>()\n+            {\n+               public void onResponseReceived(Boolean isMasked)\n+               {\n+                  String code = isMasked\n+                        ? \"base::save.image\"\n+                        : \"save.image\";", "originalCommit": "1dbef1ecc5e8efe0d3191bda82a8cc7fb0b69041", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b2f7dc38a29ac8f015412c9afa3e412453ec2aa3", "chunk": "diff --git a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\nindex c9b8b47536..869a64ef3f 100644\n--- a/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n+++ b/src/gwt/src/org/rstudio/studio/client/workbench/views/environment/EnvironmentPresenter.java\n\n@@ -442,7 +443,7 @@ public class EnvironmentPresenter extends BasePresenter\n       server_.isFunctionMasked(\n             \"save.image\",\n             \"base\",\n-            new ErrorLoggingServerRequestCallback<Boolean>()\n+            new ServerRequestCallback<Boolean>()\n             {\n                public void onResponseReceived(Boolean isMasked)\n                {\n"}}, {"oid": "b2f7dc38a29ac8f015412c9afa3e412453ec2aa3", "url": "https://github.com/rstudio/rstudio/commit/b2f7dc38a29ac8f015412c9afa3e412453ec2aa3", "message": "ensure we invoke 'save.image' even on RPC failure", "committedDate": "2020-09-02T16:16:02Z", "type": "commit"}, {"oid": "b76a7fca85a08c74656a7c712f25b59b38f62e85", "url": "https://github.com/rstudio/rstudio/commit/b76a7fca85a08c74656a7c712f25b59b38f62e85", "message": "preserve comments", "committedDate": "2020-09-02T16:18:52Z", "type": "commit"}]}