{"pr_number": 236, "pr_title": "Fix delete recording bug for renamed recordings", "pr_createdAt": "2020-08-10T20:15:06Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/236", "timeline": [{"oid": "d96b04e8c95676296ecf5e3b11a8b9afb26a48c0", "url": "https://github.com/cryostatio/cryostat/commit/d96b04e8c95676296ecf5e3b11a8b9afb26a48c0", "message": "modify regex to allow for renamed recordings, add corresponding unit test", "committedDate": "2020-08-10T20:12:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE2MzA4OQ==", "url": "https://github.com/cryostatio/cryostat/pull/236#discussion_r468163089", "bodyText": "What happens when this gets to double-digit rename suffixes?", "author": "andrewazores", "createdAt": "2020-08-10T20:20:13Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/commands/Command.java", "diffHunk": "@@ -71,6 +71,6 @@ default boolean validateTargetId(String targetId) {\n     }\n \n     default boolean validateRecordingName(String name) {\n-        return name.matches(\"[\\\\w-_]+(\\\\.jfr)?\");\n+        return name.matches(\"[\\\\w-_]+(\\\\.\\\\d)?(\\\\.jfr)?\");", "originalCommit": "d96b04e8c95676296ecf5e3b11a8b9afb26a48c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE4NTk3Nw==", "url": "https://github.com/cryostatio/cryostat/pull/236#discussion_r468185977", "bodyText": "My bad, for some reason I had remembered wrong and thought it only renamed up to 9, it's fixed now.", "author": "Alexjsenn", "createdAt": "2020-08-10T21:06:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE2MzA4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f4f37284b6b3036269cb9443dd6d6ce19611b58a", "chunk": "diff --git a/src/main/java/com/redhat/rhjmc/containerjfr/commands/Command.java b/src/main/java/com/redhat/rhjmc/containerjfr/commands/Command.java\nindex 54e71e2..2498abc 100644\n--- a/src/main/java/com/redhat/rhjmc/containerjfr/commands/Command.java\n+++ b/src/main/java/com/redhat/rhjmc/containerjfr/commands/Command.java\n\n@@ -71,6 +71,6 @@ public interface Command {\n     }\n \n     default boolean validateRecordingName(String name) {\n-        return name.matches(\"[\\\\w-_]+(\\\\.\\\\d)?(\\\\.jfr)?\");\n+        return name.matches(\"[\\\\w-_]+(\\\\.\\\\d+)?(\\\\.jfr)?\");\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODE2MzQwOQ==", "url": "https://github.com/cryostatio/cryostat/pull/236#discussion_r468163409", "bodyText": "Please make this a @ParameterizedTest and test various different numeric suffixes to be sure they all work.", "author": "andrewazores", "createdAt": "2020-08-10T20:20:52Z", "path": "src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/DeleteSavedRecordingCommandTest.java", "diffHunk": "@@ -107,6 +107,12 @@ void shouldNotValidateIncorrectArgc(int argc) {\n         MatcherAssert.assertThat(e.getMessage(), Matchers.equalTo(errorMessage));\n     }\n \n+    @Test\n+    void shouldValidateRenamedRecording() {", "originalCommit": "d96b04e8c95676296ecf5e3b11a8b9afb26a48c0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f4f37284b6b3036269cb9443dd6d6ce19611b58a", "chunk": "diff --git a/src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/DeleteSavedRecordingCommandTest.java b/src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/DeleteSavedRecordingCommandTest.java\nindex 1cc04d3..84a6751 100644\n--- a/src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/DeleteSavedRecordingCommandTest.java\n+++ b/src/test/java/com/redhat/rhjmc/containerjfr/commands/internal/DeleteSavedRecordingCommandTest.java\n\n@@ -107,9 +107,10 @@ class DeleteSavedRecordingCommandTest implements ValidatesRecordingName {\n         MatcherAssert.assertThat(e.getMessage(), Matchers.equalTo(errorMessage));\n     }\n \n-    @Test\n-    void shouldValidateRenamedRecording() {\n-        String[] argc = {\"12-345-6-78_my-recording_87654321T654321Z.1.jfr\"};\n+    @ParameterizedTest\n+    @ValueSource(ints = {1, 8, 52, 110})\n+    void shouldValidateRenamedRecording(int suffix) {\n+        String[] argc = {String.format(\"12-345-6-78_my-recording_87654321T654321Z.%d.jfr\", suffix)};\n         Assertions.assertDoesNotThrow(() -> command.validate(argc));\n     }\n \n"}}, {"oid": "f4f37284b6b3036269cb9443dd6d6ce19611b58a", "url": "https://github.com/cryostatio/cryostat/commit/f4f37284b6b3036269cb9443dd6d6ce19611b58a", "message": "fix regex for multiple digit renames", "committedDate": "2020-08-10T21:04:27Z", "type": "commit"}]}