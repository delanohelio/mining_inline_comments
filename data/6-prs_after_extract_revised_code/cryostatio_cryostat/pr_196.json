{"pr_number": 196, "pr_title": "Change `upload-url` Command to Assume Datasource URL from Environment Variable", "pr_createdAt": "2020-07-02T15:18:19Z", "pr_url": "https://github.com/cryostatio/cryostat/pull/196", "timeline": [{"oid": "ec423d2dd68c6f23535c7551603623bdcaa82ce2", "url": "https://github.com/cryostatio/cryostat/commit/ec423d2dd68c6f23535c7551603623bdcaa82ce2", "message": "Include datasourceUrl in validate() error message; Include error message in test", "committedDate": "2020-07-02T16:00:11Z", "type": "forcePushed"}, {"oid": "bab5ea6fefd3661e1d3632a30f5429c4c3f5ed1e", "url": "https://github.com/cryostatio/cryostat/commit/bab5ea6fefd3661e1d3632a30f5429c4c3f5ed1e", "message": "Clean up rebase", "committedDate": "2020-07-03T15:17:08Z", "type": "forcePushed"}, {"oid": "994c36486cfb54222e1a26e743a9007bca36b93c", "url": "https://github.com/cryostatio/cryostat/commit/994c36486cfb54222e1a26e743a9007bca36b93c", "message": "Clean up rebase", "committedDate": "2020-07-15T16:28:21Z", "type": "forcePushed"}, {"oid": "9ab63876a3baa9a91cac69aa0b2d9ced96b11c81", "url": "https://github.com/cryostatio/cryostat/commit/9ab63876a3baa9a91cac69aa0b2d9ced96b11c81", "message": "Change `upload-url` command to assume datasource URL from env var", "committedDate": "2020-07-21T19:29:10Z", "type": "commit"}, {"oid": "d500ea24a4def92d197a1792190aabe145a4e1a8", "url": "https://github.com/cryostatio/cryostat/commit/d500ea24a4def92d197a1792190aabe145a4e1a8", "message": "Add/change tests", "committedDate": "2020-07-21T19:32:01Z", "type": "commit"}, {"oid": "a5a355eb6e1074967984b466857191a69fb8adee", "url": "https://github.com/cryostatio/cryostat/commit/a5a355eb6e1074967984b466857191a69fb8adee", "message": "Remove tests already covered by ValidatesRecordingName", "committedDate": "2020-07-21T19:32:02Z", "type": "commit"}, {"oid": "5637bf5b87b534936eb9cf042cb05cdcff3dfabe", "url": "https://github.com/cryostatio/cryostat/commit/5637bf5b87b534936eb9cf042cb05cdcff3dfabe", "message": "Move datasource URL checking to validate() and isAvailable()", "committedDate": "2020-07-21T19:33:52Z", "type": "commit"}, {"oid": "898038753045e2ce4d5957986982c29ec117d2f3", "url": "https://github.com/cryostatio/cryostat/commit/898038753045e2ce4d5957986982c29ec117d2f3", "message": "Use Apache Commons UrlValidator instead of java.net.URL for uploadUrl validation", "committedDate": "2020-07-21T19:33:54Z", "type": "commit"}, {"oid": "9e436c270c5425af1b9d43d3c4428232157b8886", "url": "https://github.com/cryostatio/cryostat/commit/9e436c270c5425af1b9d43d3c4428232157b8886", "message": "Include datasourceUrl in validate() error message; Include error message in test", "committedDate": "2020-07-21T19:36:24Z", "type": "commit"}, {"oid": "357532bd73f26585f83281d31ff3a6b17c3f84ac", "url": "https://github.com/cryostatio/cryostat/commit/357532bd73f26585f83281d31ff3a6b17c3f84ac", "message": "Clean up rebase", "committedDate": "2020-07-21T19:36:26Z", "type": "commit"}, {"oid": "a5a60f89113501b1529d6b67358eadd4e1143521", "url": "https://github.com/cryostatio/cryostat/commit/a5a60f89113501b1529d6b67358eadd4e1143521", "message": "Make changes for validate PR rebase", "committedDate": "2020-07-21T21:56:00Z", "type": "commit"}, {"oid": "a5a60f89113501b1529d6b67358eadd4e1143521", "url": "https://github.com/cryostatio/cryostat/commit/a5a60f89113501b1529d6b67358eadd4e1143521", "message": "Make changes for validate PR rebase", "committedDate": "2020-07-21T21:56:00Z", "type": "forcePushed"}, {"oid": "9d9064a84bca02c91904aa2a14ad0e99a504041a", "url": "https://github.com/cryostatio/cryostat/commit/9d9064a84bca02c91904aa2a14ad0e99a504041a", "message": "Don't expect `/load` in GRAFANA_DATASOURCE_URL", "committedDate": "2020-07-27T20:33:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4ODQ1Mg==", "url": "https://github.com/cryostatio/cryostat/pull/196#discussion_r461188452", "bodyText": "Does this work if the user sets the env var to ex. http://localhost:8080/, with a trailing slash?", "author": "andrewazores", "createdAt": "2020-07-27T21:44:37Z", "path": "src/main/java/com/redhat/rhjmc/containerjfr/commands/internal/UploadRecordingCommand.java", "diffHunk": "@@ -110,7 +110,7 @@ public String getName() {\n     public void execute(String[] args) throws Exception {\n         String targetId = args[0];\n         String recordingName = args[1];\n-        String datasourceUrl = env.getEnv(GRAFANA_DATASOURCE_ENV);\n+        String datasourceUrl = env.getEnv(GRAFANA_DATASOURCE_ENV).concat(\"/load\");", "originalCommit": "9d9064a84bca02c91904aa2a14ad0e99a504041a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE5Nzk3Mg==", "url": "https://github.com/cryostatio/cryostat/pull/196#discussion_r461197972", "bodyText": "Yes, tested just now and it works.", "author": "vic-ma", "createdAt": "2020-07-27T22:06:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4ODQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE5ODg3Ng==", "url": "https://github.com/cryostatio/cryostat/pull/196#discussion_r461198876", "bodyText": "Cool. I thought a double-slash might break things, since it could be interpreted as a null or empty string as the first path segment. If the Vertx webclient and the jfr-datasource both accept this then no worries.", "author": "andrewazores", "createdAt": "2020-07-27T22:09:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4ODQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIwNDY1MA==", "url": "https://github.com/cryostatio/cryostat/pull/196#discussion_r461204650", "bodyText": "Yeah, when I was working on the web client I had a trailing slash at first and I noticed that even though the logs said it was uploading to http://localhost:8080//load which seemed like it'd break for sure, it was working. I guess it's cool that that works; makes stuff like this a lot easier.", "author": "vic-ma", "createdAt": "2020-07-27T22:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4ODQ1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTIwNTY4NA==", "url": "https://github.com/cryostatio/cryostat/pull/196#discussion_r461205684", "bodyText": "It isn't too hard to clean it up anyway. There are cleaner ways using URIBuilder and such, but with just plain JDK (and ContainerJFR) classes:\nnew URL(env.getEnv(GRAFANA_DATASOURCE_ENV)).toURI().resolve(\"/load\").normalize().toString()\nshould do it.", "author": "andrewazores", "createdAt": "2020-07-27T22:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTE4ODQ1Mg=="}], "type": "inlineReview", "revised_code": null}]}