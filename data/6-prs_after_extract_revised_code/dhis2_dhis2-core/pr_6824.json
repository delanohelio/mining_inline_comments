{"pr_number": 6824, "pr_title": "fix: Tracker Identifiers resolution during Tracker import", "pr_createdAt": "2020-12-03T18:38:36Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6824", "timeline": [{"oid": "5e8b8cb4447854f11de84b478bdd2f2405c27719", "url": "https://github.com/dhis2/dhis2-core/commit/5e8b8cb4447854f11de84b478bdd2f2405c27719", "message": "fix: Tracker Identifiers resolution during Tracker import\n\nThis PR simplifies the way the `TrackerPreheat` object keeps track of metadata objects during the Tracker Import.\nRather than keeping track of the `TrackerIdScheme` associated to each class of object, the system now simply uses a `Map` where\nthe key is the class type (e.g. `Program`) and the value is a `Map` of object key and pre-heated object.\n\nAssuming that IdScheme `CODE` is used for `Program`, the data is structred like so:\n\n```\nProgram.class -->  CODE_1 -> Program 1\n                   CODE_2 -> Program 2\n                   CODE_3 -> Program 3\n\n```\n\nBy using this simplified data structred, the pre-heated object can be simply fetched by using the id used in the payload, without having to specify the `TrackerIdScheme`.\n\nAdditionally, this PR fixes a serialization issue with the `TrackerIdentifierParams`, which was not serialized correctly to Json and\n\"broke\" the propagation of IdScheme to the Import Service.\n\nref: DHIS2-9895", "committedDate": "2020-12-03T18:38:13Z", "type": "commit"}, {"oid": "70c38ac13bcc86c330d17ebcd71af9ba50c139f4", "url": "https://github.com/dhis2/dhis2-core/commit/70c38ac13bcc86c330d17ebcd71af9ba50c139f4", "message": "chore: remove unused imports", "committedDate": "2020-12-03T18:40:13Z", "type": "commit"}, {"oid": "a34158669143336d5a9c16e4f09c4c3380131d20", "url": "https://github.com/dhis2/dhis2-core/commit/a34158669143336d5a9c16e4f09c4c3380131d20", "message": "fix: compilation error", "committedDate": "2020-12-03T18:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzM2NTkxMQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6824#discussion_r537365911", "bodyText": "AUTO should just be UID as far as I know.", "author": "stian-sandvold", "createdAt": "2020-12-07T09:46:30Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/preheat/TrackerPreheat.java", "diffHunk": "@@ -687,4 +552,24 @@ public String toString()\n             .toString();\n     }\n \n+    private <T extends IdentifiableObject> Optional<String> resolveKey( TrackerIdentifier identifier, T object )\n+    {\n+        if ( identifier.getIdScheme().equals( TrackerIdScheme.UID ) )\n+        {\n+            return Optional.ofNullable( object.getUid() );\n+        }\n+        else if ( identifier.getIdScheme().equals( TrackerIdScheme.CODE ) )\n+        {\n+            return Optional.ofNullable( object.getCode() );\n+        }\n+        else if ( identifier.getIdScheme().equals( TrackerIdScheme.ATTRIBUTE ) )\n+        {\n+            return Optional.ofNullable( identifier.getIdentifier( object ) );\n+        }\n+        // TODO TrackerIdScheme.AUTO ??", "originalCommit": "a34158669143336d5a9c16e4f09c4c3380131d20", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}