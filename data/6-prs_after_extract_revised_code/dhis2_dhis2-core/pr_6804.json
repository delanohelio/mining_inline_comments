{"pr_number": 6804, "pr_title": "fix: Manage event scheduleAt date [DHIS2-10009]", "pr_createdAt": "2020-12-01T14:43:13Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6804", "timeline": [{"oid": "6efc17737bccebbd054f7844701344f320420d86", "url": "https://github.com/dhis2/dhis2-core/commit/6efc17737bccebbd054f7844701344f320420d86", "message": "fix: Handle event dates", "committedDate": "2020-11-30T08:24:43Z", "type": "commit"}, {"oid": "5184b1a87106d4ce42c75eae5900f759c56ec50b", "url": "https://github.com/dhis2/dhis2-core/commit/5184b1a87106d4ce42c75eae5900f759c56ec50b", "message": "fix: Check eventDueDate for Registration type Program", "committedDate": "2020-11-30T11:30:17Z", "type": "commit"}, {"oid": "d65ed971caf8157859395328ac5cf69364eaed31", "url": "https://github.com/dhis2/dhis2-core/commit/d65ed971caf8157859395328ac5cf69364eaed31", "message": "Merge branch 'master' into DHIS2-10009", "committedDate": "2020-11-30T11:33:24Z", "type": "commit"}, {"oid": "db4312688efdb5fa60a9284253ba9106b29ef7b7", "url": "https://github.com/dhis2/dhis2-core/commit/db4312688efdb5fa60a9284253ba9106b29ef7b7", "message": "test: Event scheduleDate management", "committedDate": "2020-12-01T13:26:58Z", "type": "commit"}, {"oid": "14f979534ea48fef533d0e70683408b632707399", "url": "https://github.com/dhis2/dhis2-core/commit/14f979534ea48fef533d0e70683408b632707399", "message": "chore: fix merge conflicts", "committedDate": "2020-12-01T14:41:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0NzIyOA==", "url": "https://github.com/dhis2/dhis2-core/pull/6804#discussion_r533947228", "bodyText": "Consider using the \"shortcut\" version here addError(reporter, E1050, event)", "author": "luciano-fiandesio", "createdAt": "2020-12-02T07:25:57Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/EventDateValidationHook.java", "diffHunk": "@@ -64,14 +64,21 @@ public void validateEvent( ValidationErrorReporter reporter, Event event )\n     {\n         TrackerImportValidationContext context = reporter.getValidationContext();\n \n-        if ( event.getOccurredAt() == null )\n+        Program program = context.getProgram( event.getProgram() );\n+\n+        if ( event.getOccurredAt() == null && occuredAtDateIsMandatory( event, program ) )\n         {\n             reporter.addError( newReport( TrackerErrorCode.E1031 )\n                 .addArg( event ) );\n             return;\n         }\n \n-        Program program = context.getProgram( event.getProgram() );\n+        if ( event.getScheduledAt() == null && EventStatus.SCHEDULE == event.getStatus() )\n+        {\n+            reporter.addError( newReport( TrackerErrorCode.E1050 )", "originalCommit": "14f979534ea48fef533d0e70683408b632707399", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDAyOTEyNg==", "url": "https://github.com/dhis2/dhis2-core/pull/6804#discussion_r534029126", "bodyText": "Yes, done that.", "author": "abyot", "createdAt": "2020-12-02T09:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0NzIyOA=="}], "type": "inlineReview", "revised_code": {"commit": "f66d1b53ffdb3d718063ae6436ae42fd11428aaa", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/EventDateValidationHook.java b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/EventDateValidationHook.java\nindex 018ca88447..f9a2f058d8 100644\n--- a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/EventDateValidationHook.java\n+++ b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/EventDateValidationHook.java\n\n@@ -68,15 +68,13 @@ public class EventDateValidationHook\n \n         if ( event.getOccurredAt() == null && occuredAtDateIsMandatory( event, program ) )\n         {\n-            reporter.addError( newReport( TrackerErrorCode.E1031 )\n-                .addArg( event ) );\n+            addError( reporter, E1031, event );\n             return;\n         }\n \n         if ( event.getScheduledAt() == null && EventStatus.SCHEDULE == event.getStatus() )\n         {\n-            reporter.addError( newReport( TrackerErrorCode.E1050 )\n-                .addArg( event ) );\n+            addError( reporter, E1050, event );\n             return;\n         }\n \n"}}, {"oid": "f66d1b53ffdb3d718063ae6436ae42fd11428aaa", "url": "https://github.com/dhis2/dhis2-core/commit/f66d1b53ffdb3d718063ae6436ae42fd11428aaa", "message": "chore: Improve readability", "committedDate": "2020-12-02T09:45:23Z", "type": "commit"}]}