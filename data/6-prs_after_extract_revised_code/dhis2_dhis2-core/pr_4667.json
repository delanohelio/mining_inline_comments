{"pr_number": 4667, "pr_title": "fix: (2.33) Backporting Indicator's cyclic ref. check [DHIS2-6901]", "pr_createdAt": "2020-01-06T10:14:53Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/4667", "timeline": [{"oid": "fd639a1db3eded1831bde0186409196ef133d828", "url": "https://github.com/dhis2/dhis2-core/commit/fd639a1db3eded1831bde0186409196ef133d828", "message": "fix: (2.33) Backporting Indicator's cyclic reference checking [DHIS2-6901]", "committedDate": "2020-01-06T10:12:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzI2ODg0Nw==", "url": "https://github.com/dhis2/dhis2-core/pull/4667#discussion_r363268847", "bodyText": "I think you can remove this method as well and also public Builder withResolvedExpressionItems and associated logic", "author": "luciano-fiandesio", "createdAt": "2020-01-06T12:10:34Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/DataQueryParams.java", "diffHunk": "@@ -1707,23 +1707,6 @@ public void addResolvedExpressionItem( DimensionalItemObject item)\n         {\n             resolvedExpressionItems.add(item);\n         }\n-        else\n-        {\n-            checkForIndicatorCyclicReference(item);\n-        }\n-    }\n-\n-    private void checkForIndicatorCyclicReference( final DimensionalItemObject item )\n-    {\n-        final boolean isNestedIndicator = item instanceof Indicator\n-            && (((Indicator) item).getNumerator().contains( NESTED_INDICATOR_PREFIX )\n-                || ((Indicator) item).getDenominator().contains( NESTED_INDICATOR_PREFIX ));\n-        if ( isNestedIndicator )\n-        {\n-            throw new CyclicReferenceException(\n-                String.format( \"Item of type %s with identifier '%s' has a cyclic reference to another item.\",\n-                    item.getDimensionItemType().name(), item.getUid() ) );\n-        }\n     }\n \n     private void addResolvedExpressionItems( List<DimensionalItemObject> dimensionalItemObjectList )", "originalCommit": "fd639a1db3eded1831bde0186409196ef133d828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0cbd938b3e4a3e4fb97c6f4cd210ed92e5043985", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/DataQueryParams.java b/dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/DataQueryParams.java\nindex 00292921a4..f6e36e05a3 100644\n--- a/dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/DataQueryParams.java\n+++ b/dhis-2/dhis-services/dhis-service-analytics/src/main/java/org/hisp/dhis/analytics/DataQueryParams.java\n\n@@ -1701,24 +1686,6 @@ public class DataQueryParams\n         }\n     }\n \n-    public void addResolvedExpressionItem( DimensionalItemObject item)\n-    {\n-        if ( !resolvedExpressionItems.contains(item) )\n-        {\n-            resolvedExpressionItems.add(item);\n-        }\n-    }\n-\n-    private void addResolvedExpressionItems( List<DimensionalItemObject> dimensionalItemObjectList )\n-    {\n-        dimensionalItemObjectList.forEach( this::addResolvedExpressionItem );\n-    }\n-\n-    public void removeResolvedExpressionItem( DimensionalItemObject item )\n-    {\n-        this.resolvedExpressionItems.remove( item );\n-    }\n-\n     // -------------------------------------------------------------------------\n     // Static methods\n     // -------------------------------------------------------------------------\n"}}, {"oid": "0cbd938b3e4a3e4fb97c6f4cd210ed92e5043985", "url": "https://github.com/dhis2/dhis2-core/commit/0cbd938b3e4a3e4fb97c6f4cd210ed92e5043985", "message": "fix: (2.33) Removing unused Indicator's logic [DHIS2-6901]", "committedDate": "2020-01-06T14:25:50Z", "type": "commit"}]}