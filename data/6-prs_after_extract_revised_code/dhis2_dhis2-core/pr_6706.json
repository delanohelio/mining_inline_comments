{"pr_number": 6706, "pr_title": "refactor: New Tracker Error reporting refactor", "pr_createdAt": "2020-11-17T17:49:20Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6706", "timeline": [{"oid": "74bfc3ef3770fc07c45001721357c6c5d2808d40", "url": "https://github.com/dhis2/dhis2-core/commit/74bfc3ef3770fc07c45001721357c6c5d2808d40", "message": "refactor: New Tracker Error reporting refactor\n\nSimplified the validation hook invocation code and the reporting logic.\nIt is now much easier to retrieve information about the \"root\" entities\nthat have failed the validation from the Validation report (`ValidationErrorReporter`).\n\n1) Invalid objects map on `ValidationErrorReporter`\n\nThe `invalidDTOs` is now a Map where the key is the tracker type (Tei, Enrollment, etc.) and the key is a list of invalid UIDs\n\n2) `isInvalid` method on `ValidationErrorReporter`\n\nEasily determine if a validated Tracked object has been \"marked\" invalid\n\n3) Simplified the validation logic within `AbstractTrackerDtoValidationHook` which now looks like:\n\n```\nvalidateTrackedEntities( bundle, rootReporter, context );\nvalidateEnrollments( bundle, rootReporter, context );\nvalidateEvents( bundle, rootReporter, context );\nvalidateRelationships( bundle, rootReporter, context );\n```\n\nOther notable changes:\n\nThe `TrackerBundle` object is cloned prior to the validation stage, since the validation stage may mutate the data in the bundle (e.g. removing failed objects)", "committedDate": "2020-11-18T12:22:25Z", "type": "commit"}, {"oid": "6aec8637203868c45691db081eb3710121fa71bf", "url": "https://github.com/dhis2/dhis2-core/commit/6aec8637203868c45691db081eb3710121fa71bf", "message": "fix Sonar issue", "committedDate": "2020-11-18T12:22:28Z", "type": "commit"}, {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "url": "https://github.com/dhis2/dhis2-core/commit/4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "message": "chore: add header to new classes", "committedDate": "2020-11-18T12:22:28Z", "type": "commit"}, {"oid": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "url": "https://github.com/dhis2/dhis2-core/commit/4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "message": "chore: add header to new classes", "committedDate": "2020-11-18T12:22:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2MjEwNQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6706#discussion_r526662105", "bodyText": "We could maybe call this another way: at least \"mainUid\".\nI personally do not like how the word main is used here because it makes you think that there are other less important uids somewhere.\nMaybe just uid would make the job.", "author": "enricocolasante", "createdAt": "2020-11-19T08:04:32Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/report/ValidationErrorReporter.java", "diffHunk": "@@ -54,42 +65,71 @@\n \n     private final TrackerImportValidationContext validationContext;\n \n-    private final Class<?> mainKlass;\n-\n-    private final AtomicInteger listIndex = new AtomicInteger( 0 );\n-\n+    /*\n+     * The Tracker object uid to which this reporter is associated.\n+     */", "originalCommit": "4b0424f4b253bb6453b0c3880a7bb9b3693e4e57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg1ODc0Nw==", "url": "https://github.com/dhis2/dhis2-core/pull/6706#discussion_r526858747", "bodyText": "Good thinking Enrico,\nmainId indicates there is another lesser id. Alternatively we can do primaryId or just id/uid as you said.\nI will merge despite this though, I think we can clean up that later", "author": "stian-sandvold", "createdAt": "2020-11-19T12:55:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2MjEwNQ=="}], "type": "inlineReview", "revised_code": null}]}