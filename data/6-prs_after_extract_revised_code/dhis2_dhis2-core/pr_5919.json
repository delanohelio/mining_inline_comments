{"pr_number": 5919, "pr_title": "feat: Last value within analytics period agg type", "pr_createdAt": "2020-08-12T16:09:55Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5919", "timeline": [{"oid": "58bcba072291383af12b8c26922608bb783a2810", "url": "https://github.com/dhis2/dhis2-core/commit/58bcba072291383af12b8c26922608bb783a2810", "message": "feat: Last value within analytics period agg type", "committedDate": "2020-08-12T16:07:20Z", "type": "commit"}, {"oid": "52816ec0437c2d852ae8da6006e6964616ddff69", "url": "https://github.com/dhis2/dhis2-core/commit/52816ec0437c2d852ae8da6006e6964616ddff69", "message": "chore: LAS_ANALYTICS_PERIOD -> LAST_IN_PERIOD", "committedDate": "2020-08-21T14:21:13Z", "type": "commit"}, {"oid": "543a5c7dbacaba4247213545a44892a36b94f249", "url": "https://github.com/dhis2/dhis2-core/commit/543a5c7dbacaba4247213545a44892a36b94f249", "message": "test: LAST_IN_PERIOD aggregation type", "committedDate": "2020-08-21T14:22:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0NDM2OA==", "url": "https://github.com/dhis2/dhis2-core/pull/5919#discussion_r474744368", "bodyText": "Code style, spaces.", "author": "larshelge", "createdAt": "2020-08-21T14:45:25Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java", "diffHunk": "@@ -118,6 +118,26 @@ public void verifyQueryGeneratedWhenDataElementHasLastAvgOrgUnitAggregationType(\n         assertExpectedSql(\"desc\");\n     }\n \n+    @Test\n+    public void verifyQueryGeneratedWhenDataElementHasLastInPeriodAggregationType()\n+    {\n+        DataQueryParams params = createParams( AggregationType.LAST_IN_PERIOD );\n+\n+        subject.getAggregatedDataValues( params, AnalyticsTableType.DATA_VALUE, 20000 );\n+\n+        assertExpectedLastSql(\"desc\");", "originalCommit": "543a5c7dbacaba4247213545a44892a36b94f249", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5MzkxOQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5919#discussion_r475393919", "bodyText": "done", "author": "abyot", "createdAt": "2020-08-24T07:28:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0NDM2OA=="}], "type": "inlineReview", "revised_code": {"commit": "52e12812dd433c4b05d52fefee0198f4ba73edb2", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java b/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\nindex daad14f63b..c86964b888 100644\n--- a/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\n+++ b/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\n\n@@ -115,7 +115,7 @@ public class JdbcAnalyticsManagerTest\n \n         subject.getAggregatedDataValues( params, AnalyticsTableType.DATA_VALUE, 20000 );\n \n-        assertExpectedSql(\"desc\");\n+        assertExpectedSql( \"desc\" );\n     }\n \n     @Test\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0NDQxNA==", "url": "https://github.com/dhis2/dhis2-core/pull/5919#discussion_r474744414", "bodyText": "Code style, spaces.", "author": "larshelge", "createdAt": "2020-08-21T14:45:30Z", "path": "dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java", "diffHunk": "@@ -118,6 +118,26 @@ public void verifyQueryGeneratedWhenDataElementHasLastAvgOrgUnitAggregationType(\n         assertExpectedSql(\"desc\");\n     }\n \n+    @Test\n+    public void verifyQueryGeneratedWhenDataElementHasLastInPeriodAggregationType()\n+    {\n+        DataQueryParams params = createParams( AggregationType.LAST_IN_PERIOD );\n+\n+        subject.getAggregatedDataValues( params, AnalyticsTableType.DATA_VALUE, 20000 );\n+\n+        assertExpectedLastSql(\"desc\");\n+    }\n+\n+    @Test\n+    public void verifyQueryGeneratedWhenDataElementHasLastInPeriodAvgOrgUnitAggregationType()\n+    {\n+        DataQueryParams params = createParams( AggregationType.LAST_IN_PERIOD_AVERAGE_ORG_UNIT );\n+\n+        subject.getAggregatedDataValues( params, AnalyticsTableType.DATA_VALUE, 20000 );\n+\n+        assertExpectedLastSql(\"desc\");", "originalCommit": "543a5c7dbacaba4247213545a44892a36b94f249", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTM5Mzk5NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5919#discussion_r475393995", "bodyText": "done", "author": "abyot", "createdAt": "2020-08-24T07:28:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0NDQxNA=="}], "type": "inlineReview", "revised_code": {"commit": "52e12812dd433c4b05d52fefee0198f4ba73edb2", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java b/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\nindex daad14f63b..c86964b888 100644\n--- a/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\n+++ b/dhis-2/dhis-services/dhis-service-analytics/src/test/java/org/hisp/dhis/analytics/data/JdbcAnalyticsManagerTest.java\n\n@@ -115,7 +115,7 @@ public class JdbcAnalyticsManagerTest\n \n         subject.getAggregatedDataValues( params, AnalyticsTableType.DATA_VALUE, 20000 );\n \n-        assertExpectedSql(\"desc\");\n+        assertExpectedSql( \"desc\" );\n     }\n \n     @Test\n"}}, {"oid": "52e12812dd433c4b05d52fefee0198f4ba73edb2", "url": "https://github.com/dhis2/dhis2-core/commit/52e12812dd433c4b05d52fefee0198f4ba73edb2", "message": "chore: Apply code style", "committedDate": "2020-08-24T07:27:18Z", "type": "commit"}]}