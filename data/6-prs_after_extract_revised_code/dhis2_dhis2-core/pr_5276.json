{"pr_number": 5276, "pr_title": "fix: Downcast user to UID when using jsonMapper", "pr_createdAt": "2020-04-02T09:21:17Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5276", "timeline": [{"oid": "2e758399fe84822be35ba02eb471c19237768aa2", "url": "https://github.com/dhis2/dhis2-core/commit/2e758399fe84822be35ba02eb471c19237768aa2", "message": "fix: downcast user to uid when using jsonMapper", "committedDate": "2020-04-02T09:20:56Z", "type": "commit"}, {"oid": "8bc830152604aab22d4527175cb38b4e1d189c1f", "url": "https://github.com/dhis2/dhis2-core/commit/8bc830152604aab22d4527175cb38b4e1d189c1f", "message": "chore: revert autoformatting of BaseIdObject", "committedDate": "2020-04-02T09:25:41Z", "type": "commit"}, {"oid": "cb689565ca511aa4fea26de4367f358661f7e5da", "url": "https://github.com/dhis2/dhis2-core/commit/cb689565ca511aa4fea26de4367f358661f7e5da", "message": "minor fix", "committedDate": "2020-04-02T09:29:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3NzY3NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5276#discussion_r402177675", "bodyText": "Is this test completed? Looks like you are not asserting anything", "author": "luciano-fiandesio", "createdAt": "2020-04-02T09:31:07Z", "path": "dhis-2/dhis-support/dhis-support-commons/src/test/java/org/hisp/dhis/commons/config/jackson/JacksonObjectMapperConfigTest.java", "diffHunk": "@@ -81,6 +82,18 @@ public void testNullDate()\n         assertNull( yearTest.get( \"date\" ) );\n     }\n \n+    @Test // DHIS2-8582\n+    public void testSerializerUserWithUser()\n+        throws JsonProcessingException\n+    {\n+        User user = new User();\n+        user.setAutoFields();\n+        user.setUser( user );\n+        user.setLastUpdatedBy( user );\n+\n+        jsonMapper.writeValueAsString( user );", "originalCommit": "cb689565ca511aa4fea26de4367f358661f7e5da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3ODk3Ng==", "url": "https://github.com/dhis2/dhis2-core/pull/5276#discussion_r402178976", "bodyText": "It would normally throw an exception if the circular ref was still an issue, not really much to assert here", "author": "mortenoh", "createdAt": "2020-04-02T09:33:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3NzY3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE4NDk4MQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5276#discussion_r402184981", "bodyText": "Made some fixes to it, should be ok (also asserts that it can be deserialized)", "author": "mortenoh", "createdAt": "2020-04-02T09:43:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3NzY3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "a838cab46ab57919c63c267d2696e94670a6b5f4", "chunk": "diff --git a/dhis-2/dhis-support/dhis-support-commons/src/test/java/org/hisp/dhis/commons/config/jackson/JacksonObjectMapperConfigTest.java b/dhis-2/dhis-support/dhis-support-commons/src/test/java/org/hisp/dhis/commons/config/jackson/JacksonObjectMapperConfigTest.java\nindex cb7cff4e3d..09180a60c3 100644\n--- a/dhis-2/dhis-support/dhis-support-commons/src/test/java/org/hisp/dhis/commons/config/jackson/JacksonObjectMapperConfigTest.java\n+++ b/dhis-2/dhis-support/dhis-support-commons/src/test/java/org/hisp/dhis/commons/config/jackson/JacksonObjectMapperConfigTest.java\n\n@@ -91,7 +90,10 @@ public class JacksonObjectMapperConfigTest\n         user.setUser( user );\n         user.setLastUpdatedBy( user );\n \n-        jsonMapper.writeValueAsString( user );\n+        String payload = jsonMapper.writeValueAsString( user );\n+        User testUser = jsonMapper.readValue( payload, User.class );\n+\n+        assertEquals( user.getUid(), testUser.getUid() );\n     }\n \n     private String createDateTest( String str )\n"}}, {"oid": "a838cab46ab57919c63c267d2696e94670a6b5f4", "url": "https://github.com/dhis2/dhis2-core/commit/a838cab46ab57919c63c267d2696e94670a6b5f4", "message": "fix: write uid as object instead, allows for deserializing", "committedDate": "2020-04-02T09:42:45Z", "type": "commit"}, {"oid": "adad22ae5c6aaca99f981a2de3deb0aaf298ecc0", "url": "https://github.com/dhis2/dhis2-core/commit/adad22ae5c6aaca99f981a2de3deb0aaf298ecc0", "message": "test: update test to verify user.user and user.lastUpdatedBy props", "committedDate": "2020-04-02T10:31:24Z", "type": "commit"}]}