{"pr_number": 6552, "pr_title": "fix: Exception when importing TEI with relationship [DHIS2-9856]", "pr_createdAt": "2020-11-02T11:53:30Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/6552", "timeline": [{"oid": "a005b687fb71187f8b68f40f26c7f6da44804ecf", "url": "https://github.com/dhis2/dhis2-core/commit/a005b687fb71187f8b68f40f26c7f6da44804ecf", "message": "fix: Exception when importing TEI with relationship", "committedDate": "2020-11-02T11:49:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzMDk4MA==", "url": "https://github.com/dhis2/dhis2-core/pull/6552#discussion_r518630980", "bodyText": "In my refactor, I am actually generating all missing uids. The only thing we need to validate is that isUidInvalid(). This is just a note though, for this PR, keep it like this :)", "author": "stian-sandvold", "createdAt": "2020-11-06T09:37:24Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/PreCheckValidateAndGenerateUidHook.java", "diffHunk": "@@ -120,7 +121,27 @@ public void validateEvent( ValidationErrorReporter reporter, Event event )\n         validateNotesUid( event.getNotes(), reporter );\n     }\n \n-    private void validateNotesUid( List<Note> notes, ValidationErrorReporter reporter )\n+    @Override\n+    public void validateRelationship( ValidationErrorReporter reporter, Relationship relationship )", "originalCommit": "a005b687fb71187f8b68f40f26c7f6da44804ecf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bba2661fdbd6fada1dbe4e19208fa59abdb186a7", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/PreCheckValidateAndGenerateUidHook.java b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/PreCheckValidateAndGenerateUidHook.java\nindex bb6ae3e2ca..3f00c462f8 100644\n--- a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/PreCheckValidateAndGenerateUidHook.java\n+++ b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/validation/hooks/PreCheckValidateAndGenerateUidHook.java\n\n@@ -133,11 +133,11 @@ public class PreCheckValidateAndGenerateUidHook\n \n         if ( uid == null )\n         {\n-            relationship.setUid( CodeGenerator.generateUid() );\n+            relationship.setRelationship( CodeGenerator.generateUid() );\n         }\n         else\n         {\n-            relationship.setUid( uid );\n+            relationship.setRelationship( uid );\n         }\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzMTY5NQ==", "url": "https://github.com/dhis2/dhis2-core/pull/6552#discussion_r518631695", "bodyText": "I am removing the String uid fields from the other models, since we already have fields for uid (trackedEntity, enrollment, event, relationship).\nI would like you to use relationship instead here, since the only change we would potentially do here, is to add a new uid if there is no uid already.", "author": "stian-sandvold", "createdAt": "2020-11-06T09:38:41Z", "path": "dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/domain/Relationship.java", "diffHunk": "@@ -43,6 +43,8 @@\n @AllArgsConstructor\n public class Relationship implements TrackerDto\n {\n+    private String uid;", "originalCommit": "a005b687fb71187f8b68f40f26c7f6da44804ecf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzMTc5Mg==", "url": "https://github.com/dhis2/dhis2-core/pull/6552#discussion_r518631792", "bodyText": "the \"relationship\" field on Relationship I mean :)", "author": "stian-sandvold", "createdAt": "2020-11-06T09:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzMTY5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTcwOTc3MA==", "url": "https://github.com/dhis2/dhis2-core/pull/6552#discussion_r519709770", "bodyText": "resolved", "author": "zubaira", "createdAt": "2020-11-09T10:39:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODYzMTY5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "bba2661fdbd6fada1dbe4e19208fa59abdb186a7", "chunk": "diff --git a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/domain/Relationship.java b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/domain/Relationship.java\nindex f472e88c43..8959388265 100644\n--- a/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/domain/Relationship.java\n+++ b/dhis-2/dhis-services/dhis-service-tracker/src/main/java/org/hisp/dhis/tracker/domain/Relationship.java\n\n@@ -43,8 +43,6 @@ import lombok.NoArgsConstructor;\n @AllArgsConstructor\n public class Relationship implements TrackerDto\n {\n-    private String uid;\n-\n     @JsonProperty\n     private String relationship;\n \n"}}, {"oid": "20a6bbd8e00b29d2f70d119d5b3e1a87e8b79bb9", "url": "https://github.com/dhis2/dhis2-core/commit/20a6bbd8e00b29d2f70d119d5b3e1a87e8b79bb9", "message": "Merge branch 'master' into DHIS2-9856", "committedDate": "2020-11-09T10:32:54Z", "type": "commit"}, {"oid": "bba2661fdbd6fada1dbe4e19208fa59abdb186a7", "url": "https://github.com/dhis2/dhis2-core/commit/bba2661fdbd6fada1dbe4e19208fa59abdb186a7", "message": "remove uid and use relationship field instead", "committedDate": "2020-11-09T10:38:39Z", "type": "commit"}, {"oid": "36957d0decfc95117329057950c62caac2f4a35c", "url": "https://github.com/dhis2/dhis2-core/commit/36957d0decfc95117329057950c62caac2f4a35c", "message": "Merge branch 'master' into DHIS2-9856", "committedDate": "2020-11-11T15:58:08Z", "type": "commit"}]}