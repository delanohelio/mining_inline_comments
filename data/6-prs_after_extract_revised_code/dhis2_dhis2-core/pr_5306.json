{"pr_number": 5306, "pr_title": "fix: Use TrackedEntityAttributeValueService to update values in SMS submissions", "pr_createdAt": "2020-04-04T09:31:09Z", "pr_url": "https://github.com/dhis2/dhis2-core/pull/5306", "timeline": [{"oid": "3d44b3bbf6087fe7366d524426f20c0f7ec6461d", "url": "https://github.com/dhis2/dhis2-core/commit/3d44b3bbf6087fe7366d524426f20c0f7ec6461d", "message": "fix: ensure TEI attribs are updated in SMS", "committedDate": "2020-04-04T07:41:51Z", "type": "commit"}, {"oid": "80fd481273610185839a7d00355d3e0c7339dc66", "url": "https://github.com/dhis2/dhis2-core/commit/80fd481273610185839a7d00355d3e0c7339dc66", "message": "fix: ensure old attrib value is used when updating", "committedDate": "2020-04-04T09:27:34Z", "type": "commit"}, {"oid": "c3bf71342ec990b79a93ff5b1dff5ad9db0ef161", "url": "https://github.com/dhis2/dhis2-core/commit/c3bf71342ec990b79a93ff5b1dff5ad9db0ef161", "message": "fix: ensure all metadata is collected for SMS listeners", "committedDate": "2020-04-04T09:27:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2MTUxMg==", "url": "https://github.com/dhis2/dhis2-core/pull/5306#discussion_r403861512", "bodyText": "@JasperTimm the SDK is not downloading this metadata. Should we do it? Also, I would say that trackedEntityInstances, enrollments, events and relationships are data. In a typical use case the android app would not have all this data because it could be huge", "author": "vgarciabnz", "createdAt": "2020-04-06T06:45:17Z", "path": "dhis-2/dhis-services/dhis-service-core/src/main/java/org/hisp/dhis/sms/listener/CompressionSMSListener.java", "diffHunk": "@@ -245,6 +249,13 @@ private SMSMetadata getMetadata( Date lastSyncDate )\n         meta.trackedEntityAttributes = getTypeUidsBefore( TrackedEntityAttribute.class, lastSyncDate );\n         meta.programs = getTypeUidsBefore( Program.class, lastSyncDate );\n         meta.organisationUnits = getTypeUidsBefore( OrganisationUnit.class, lastSyncDate );\n+        meta.programStages = getTypeUidsBefore( ProgramStage.class, lastSyncDate );", "originalCommit": "c3bf71342ec990b79a93ff5b1dff5ad9db0ef161", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAyMTIzMQ==", "url": "https://github.com/dhis2/dhis2-core/pull/5306#discussion_r404021231", "bodyText": "@vgarciabnz yeah that's a good point, I was going to discuss that with you guys, I sort of came to the same conclusion (that TEIs, enrolments and events are more so data). In that case I'll remove the handling for it from the compression library.\nAlso yes, I think it makes sense for the SDK to download all other metadata. ProgramStages is quite small I imagine.", "author": "JasperTimm", "createdAt": "2020-04-06T11:33:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2MTUxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA2MTUyNg==", "url": "https://github.com/dhis2/dhis2-core/pull/5306#discussion_r404061526", "bodyText": "Yes, i think it makes sense to include programStages, relationshipTypes and dataSets.", "author": "vgarciabnz", "createdAt": "2020-04-06T12:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg2MTUxMg=="}], "type": "inlineReview", "revised_code": null}]}