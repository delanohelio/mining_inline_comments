{"pr_number": 512, "pr_title": "Comply with crypto-policies outside of Tomcat", "pr_createdAt": "2020-04-27T14:52:53Z", "pr_url": "https://github.com/dogtagpki/jss/pull/512", "timeline": [{"oid": "ac08b66fa88ec136670d17947474c1dc6eec50d8", "url": "https://github.com/dogtagpki/jss/commit/ac08b66fa88ec136670d17947474c1dc6eec50d8", "message": "Compliy with crypto-policies outside of Tomcat\n\nWhen constructing a new SSLEngine, Tomcat will take the supported\nciphers and limit the enabled cipher suites to only ones which are\nsupported by this SSLEngine implementation. Because the list of cipher\nsuites we returned were allowed by local crypto policy, out result was\ncompliant. However, other usages of SSLEngine aren't guaranteed to\nbehave the same; make sure we explicitly filter to only supported cipher\nsuites.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-04-27T14:54:26Z", "type": "forcePushed"}, {"oid": "403dca8424f9938ea995237f24e1e54f97d3d111", "url": "https://github.com/dogtagpki/jss/commit/403dca8424f9938ea995237f24e1e54f97d3d111", "message": "Comply with crypto-policies outside of Tomcat\n\nWhen constructing a new SSLEngine, Tomcat will take the supported\nciphers and limit the enabled cipher suites to only ones which are\nsupported by this SSLEngine implementation. Because the list of cipher\nsuites we returned were allowed by local crypto policy, out result was\ncompliant. However, other usages of SSLEngine aren't guaranteed to\nbehave the same; make sure we explicitly filter to only supported cipher\nsuites.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-04-27T16:41:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NjUyOQ==", "url": "https://github.com/dogtagpki/jss/pull/512#discussion_r415986529", "bodyText": "Is it missing a return statement here? Otherwise it's kind of strange that enabled_ciphers is set to null in 417 but then reinitialized in 421.", "author": "edewata", "createdAt": "2020-04-27T16:59:25Z", "path": "org/mozilla/jss/ssl/javax/JSSEngine.java", "diffHunk": "@@ -406,11 +401,24 @@ public void setEnabledCipherSuites(SSLCipher[] suites) throws IllegalArgumentExc\n         }\n \n         if (suites == null || suites.length == 0) {\n+            enabled_ciphers = null;\n             logger.warn(\"JSSEngine.setEnabledCipherSuites(...) given a null list of cipher suites.\");\n             return;\n         }\n \n-        enabled_ciphers = suites.clone();\n+        ArrayList<SSLCipher> supportedCiphers = new ArrayList<SSLCipher>();\n+        for (SSLCipher suite : suites) {\n+            if (suite.isSupported()) {\n+                supportedCiphers.add(suite);\n+            }\n+        }\n+\n+        if (supportedCiphers.size() == 0) {\n+            enabled_ciphers = null;\n+            logger.warn(\"JSSEngine.setEnabledCipherSuites(...) given a list of cipher suites where none were supported or approved.\");", "originalCommit": "403dca8424f9938ea995237f24e1e54f97d3d111", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAwNjM4Ng==", "url": "https://github.com/dogtagpki/jss/pull/512#discussion_r416006386", "bodyText": "Ah you're right. Thanks! :)", "author": "cipherboy", "createdAt": "2020-04-27T17:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk4NjUyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "fd5bc37d6e2f8001737c245a6894fe8ced608343", "chunk": "diff --git a/org/mozilla/jss/ssl/javax/JSSEngine.java b/org/mozilla/jss/ssl/javax/JSSEngine.java\nindex 51abc8f4..0965ff7c 100644\n--- a/org/mozilla/jss/ssl/javax/JSSEngine.java\n+++ b/org/mozilla/jss/ssl/javax/JSSEngine.java\n\n@@ -416,6 +416,7 @@ public abstract class JSSEngine extends javax.net.ssl.SSLEngine {\n         if (supportedCiphers.size() == 0) {\n             enabled_ciphers = null;\n             logger.warn(\"JSSEngine.setEnabledCipherSuites(...) given a list of cipher suites where none were supported or approved.\");\n+            return;\n         }\n \n         enabled_ciphers = supportedCiphers.toArray(new SSLCipher[supportedCiphers.size()]);\n"}}, {"oid": "fd5bc37d6e2f8001737c245a6894fe8ced608343", "url": "https://github.com/dogtagpki/jss/commit/fd5bc37d6e2f8001737c245a6894fe8ced608343", "message": "Comply with crypto-policies outside of Tomcat\n\nWhen constructing a new SSLEngine, Tomcat will take the supported\nciphers and limit the enabled cipher suites to only ones which are\nsupported by this SSLEngine implementation. Because the list of cipher\nsuites we returned were allowed by local crypto policy, out result was\ncompliant. However, other usages of SSLEngine aren't guaranteed to\nbehave the same; make sure we explicitly filter to only supported cipher\nsuites.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-04-27T17:28:57Z", "type": "commit"}, {"oid": "fd5bc37d6e2f8001737c245a6894fe8ced608343", "url": "https://github.com/dogtagpki/jss/commit/fd5bc37d6e2f8001737c245a6894fe8ced608343", "message": "Comply with crypto-policies outside of Tomcat\n\nWhen constructing a new SSLEngine, Tomcat will take the supported\nciphers and limit the enabled cipher suites to only ones which are\nsupported by this SSLEngine implementation. Because the list of cipher\nsuites we returned were allowed by local crypto policy, out result was\ncompliant. However, other usages of SSLEngine aren't guaranteed to\nbehave the same; make sure we explicitly filter to only supported cipher\nsuites.\n\nSigned-off-by: Alexander Scheel <ascheel@redhat.com>", "committedDate": "2020-04-27T17:28:57Z", "type": "forcePushed"}]}