{"pr_number": 222, "pr_title": "Fix font issues - Issue #163", "pr_createdAt": "2020-02-03T02:32:06Z", "pr_url": "https://github.com/constellation-app/constellation/pull/222", "timeline": [{"oid": "e78932ce4e7ee81e739601ea128bbdbd41953c10", "url": "https://github.com/constellation-app/constellation/commit/e78932ce4e7ee81e739601ea128bbdbd41953c10", "message": "Make GlyphManager switchable.", "committedDate": "2019-12-24T09:18:45Z", "type": "commit"}, {"oid": "16cc68b73aca437c570cca48e4a900398a025f5e", "url": "https://github.com/constellation-app/constellation/commit/16cc68b73aca437c570cca48e4a900398a025f5e", "message": "Move FX code to GlyphManagerFX; add Javadoc to GlyphManager.", "committedDate": "2019-12-25T03:54:26Z", "type": "commit"}, {"oid": "5f9b5020424bf60cfd92c874c265996935b4c01a", "url": "https://github.com/constellation-app/constellation/commit/5f9b5020424bf60cfd92c874c265996935b4c01a", "message": "Glyphs: new glyph generator (sort of working).", "committedDate": "2019-12-26T04:56:18Z", "type": "commit"}, {"oid": "9c20740055b1d4c625fe9acf442e74294794fd13", "url": "https://github.com/constellation-app/constellation/commit/9c20740055b1d4c625fe9acf442e74294794fd13", "message": "Glyphs: improve render layout; make background work.", "committedDate": "2019-12-26T23:16:13Z", "type": "commit"}, {"oid": "e9ccf577bc19a31ffa3031a79f5b1a08c4d5d6e3", "url": "https://github.com/constellation-app/constellation/commit/e9ccf577bc19a31ffa3031a79f5b1a08c4d5d6e3", "message": "Glyphs: add default font; tidy up.", "committedDate": "2019-12-29T07:35:20Z", "type": "commit"}, {"oid": "0732fd788b19b15e889f2160e0d93b6db0da3ba8", "url": "https://github.com/constellation-app/constellation/commit/0732fd788b19b15e889f2160e0d93b6db0da3ba8", "message": "Glyphs: fix glyph scaling.", "committedDate": "2019-12-29T08:02:12Z", "type": "commit"}, {"oid": "1a3a3601a33b028c63fbba3c4ee8de4e800591ac", "url": "https://github.com/constellation-app/constellation/commit/1a3a3601a33b028c63fbba3c4ee8de4e800591ac", "message": "Glyphs: allow for .otf font files.", "committedDate": "2019-12-30T03:12:52Z", "type": "commit"}, {"oid": "a9a42e6e9280ba8c3c151e9682f650c26753f2b3", "url": "https://github.com/constellation-app/constellation/commit/a9a42e6e9280ba8c3c151e9682f650c26753f2b3", "message": "Glyphs: clean up; hook up font preferences.", "committedDate": "2019-12-30T07:16:00Z", "type": "commit"}, {"oid": "47efca0a65d7a891c843e4ad02e240a39c81f5e3", "url": "https://github.com/constellation-app/constellation/commit/47efca0a65d7a891c843e4ad02e240a39c81f5e3", "message": "Glyphs: remove extraneous code.", "committedDate": "2019-12-30T07:24:20Z", "type": "commit"}, {"oid": "fd0a230123d32c1dc3dcbdd592681a8196293e94", "url": "https://github.com/constellation-app/constellation/commit/fd0a230123d32c1dc3dcbdd592681a8196293e94", "message": "Glyphs: use the font preferences.", "committedDate": "2019-12-30T07:36:56Z", "type": "commit"}, {"oid": "66e332686348a730ba53d31e2e78cc4c044327c5", "url": "https://github.com/constellation-app/constellation/commit/66e332686348a730ba53d31e2e78cc4c044327c5", "message": "Glyphs: make the Apply button work.", "committedDate": "2019-12-30T10:33:15Z", "type": "commit"}, {"oid": "df5b98ae0795df31c90e6f54c39072ae2680f57b", "url": "https://github.com/constellation-app/constellation/commit/df5b98ae0795df31c90e6f54c39072ae2680f57b", "message": "Glyphs: display labels in the correct position.", "committedDate": "2019-12-31T04:03:45Z", "type": "commit"}, {"oid": "28e2043c0b947bbe0369389d995c97e88a932141", "url": "https://github.com/constellation-app/constellation/commit/28e2043c0b947bbe0369389d995c97e88a932141", "message": "Glyphs: add padding between rectangles in the texture buffer.", "committedDate": "2019-12-31T05:56:10Z", "type": "commit"}, {"oid": "c02b8b8899878ef0846474c9975b94de35f1617a", "url": "https://github.com/constellation-app/constellation/commit/c02b8b8899878ef0846474c9975b94de35f1617a", "message": "Glyphs: cope with text that is too long for the drawing buffer.", "committedDate": "2020-01-01T00:56:46Z", "type": "commit"}, {"oid": "371c4991ac039b2daef299b1f4938e06c3b48c47", "url": "https://github.com/constellation-app/constellation/commit/371c4991ac039b2daef299b1f4938e06c3b48c47", "message": "Glyphs: look for .otf files in Windows directories.", "committedDate": "2020-01-01T02:27:50Z", "type": "commit"}, {"oid": "bf2a354ad66df7223557aeecf4dea6312146d0dd", "url": "https://github.com/constellation-app/constellation/commit/bf2a354ad66df7223557aeecf4dea6312146d0dd", "message": "Glyphs: only use LATIN or COMMON codepoints from the first font.", "committedDate": "2020-01-01T08:22:05Z", "type": "commit"}, {"oid": "6f1cb28951d90421426f9d649301d95642beabd0", "url": "https://github.com/constellation-app/constellation/commit/6f1cb28951d90421426f9d649301d95642beabd0", "message": "Glyphs: allow loading of .ttf files; script selection in options.", "committedDate": "2020-01-05T06:01:00Z", "type": "commit"}, {"oid": "e906d2bccdfa964e8b5cd4a2c2a89aee9cdb170a", "url": "https://github.com/constellation-app/constellation/commit/e906d2bccdfa964e8b5cd4a2c2a89aee9cdb170a", "message": "Glyphs: avoid an exception when a glyph is too tall.", "committedDate": "2020-01-06T04:04:53Z", "type": "commit"}, {"oid": "8a4c08be033113ec618adf08c637089f0a1338c2", "url": "https://github.com/constellation-app/constellation/commit/8a4c08be033113ec618adf08c637089f0a1338c2", "message": "Glyphs: use the correct FontInfo array.", "committedDate": "2020-01-06T04:33:18Z", "type": "commit"}, {"oid": "a08e82ccd3e48df720be0cd9c9048ab70a4f4da8", "url": "https://github.com/constellation-app/constellation/commit/a08e82ccd3e48df720be0cd9c9048ab70a4f4da8", "message": "Glyphs: fix drawing bug; use a better default for fonts.", "committedDate": "2020-01-06T11:04:04Z", "type": "commit"}, {"oid": "4d2a5000b00bd3e726658b7691645dcdd6fe95ef", "url": "https://github.com/constellation-app/constellation/commit/4d2a5000b00bd3e726658b7691645dcdd6fe95ef", "message": "Glyphs: remove obsolete code and comments.", "committedDate": "2020-01-07T07:15:41Z", "type": "commit"}, {"oid": "35efd71056cf60f50779156c70904896262b8650", "url": "https://github.com/constellation-app/constellation/commit/35efd71056cf60f50779156c70904896262b8650", "message": "Glyphs: make the label renderer user-selectable.", "committedDate": "2020-01-09T10:38:15Z", "type": "commit"}, {"oid": "453b38f25f9634d542bf320e78c7d3fbc35a6f20", "url": "https://github.com/constellation-app/constellation/commit/453b38f25f9634d542bf320e78c7d3fbc35a6f20", "message": "Glyphs: don't draw a red border in the texture buffer.", "committedDate": "2020-01-09T12:22:47Z", "type": "commit"}, {"oid": "1a64466ff0eea11f0f848cf86699fee1773a01b7", "url": "https://github.com/constellation-app/constellation/commit/1a64466ff0eea11f0f848cf86699fee1773a01b7", "message": "Glyphs: draw an oversized background to make indicators work.", "committedDate": "2020-01-10T07:12:50Z", "type": "commit"}, {"oid": "7ec15e7a9519804116a1f72707b93a08d52a48cc", "url": "https://github.com/constellation-app/constellation/commit/7ec15e7a9519804116a1f72707b93a08d52a48cc", "message": "Merge pull request #183 from algol60/newfonts\n\n\u2728 Graph renderer to support different language fonts #163", "committedDate": "2020-01-14T05:06:20Z", "type": "commit"}, {"oid": "d975b5e7668060b4b468862c7207e59a9221747d", "url": "https://github.com/constellation-app/constellation/commit/d975b5e7668060b4b468862c7207e59a9221747d", "message": "Glyphs: fix font file finding when there are no font files in the user's fonts directory.", "committedDate": "2020-01-16T07:17:23Z", "type": "commit"}, {"oid": "be680e66ab8506d7e6b8266e53de90de9c0a4855", "url": "https://github.com/constellation-app/constellation/commit/be680e66ab8506d7e6b8266e53de90de9c0a4855", "message": ":bug: \"Open in New Table View\" context menu now works correctly\n:bug: Icon Graph now performs a grid arrangement to prevent all generated nodes being rendered on top of each other", "committedDate": "2020-01-24T08:01:38Z", "type": "commit"}, {"oid": "272d1be4ccebdbaee9de67cae59a70ef2717863b", "url": "https://github.com/constellation-app/constellation/commit/272d1be4ccebdbaee9de67cae59a70ef2717863b", "message": "Merge branch 'new-fonts' of https://github.com/constellation-app/constellation into font-improvements", "committedDate": "2020-01-24T08:08:15Z", "type": "commit"}, {"oid": "7c206a94eda789e99be365e26415e19b4aa41b05", "url": "https://github.com/constellation-app/constellation/commit/7c206a94eda789e99be365e26415e19b4aa41b05", "message": ":art: corrected a rogue comma", "committedDate": "2020-01-24T08:13:13Z", "type": "commit"}, {"oid": "b1f09cb35a232d062c3155b41275697eca484d32", "url": "https://github.com/constellation-app/constellation/commit/b1f09cb35a232d062c3155b41275697eca484d32", "message": "Merge pull request #212 from algol60/newfonts\n\nGlyphs: fix font file finding when there are no font files in the use\u2026", "committedDate": "2020-01-24T10:20:44Z", "type": "commit"}, {"oid": "34ca6f7ca43bd4cd019dd4db2386ca198ebd5c79", "url": "https://github.com/constellation-app/constellation/commit/34ca6f7ca43bd4cd019dd4db2386ca198ebd5c79", "message": ":art: improved formatting", "committedDate": "2020-01-24T10:21:21Z", "type": "commit"}, {"oid": "3abbae83b6e679ed094a5ae2ec74f638a80b8273", "url": "https://github.com/constellation-app/constellation/commit/3abbae83b6e679ed094a5ae2ec74f638a80b8273", "message": "Merge branch 'new-fonts' of https://github.com/constellation-app/constellation into font-improvements", "committedDate": "2020-01-24T10:26:25Z", "type": "commit"}, {"oid": "330982c12c438fbc83d04dc8127342e81ab3efb6", "url": "https://github.com/constellation-app/constellation/commit/330982c12c438fbc83d04dc8127342e81ab3efb6", "message": ":sparkles: added ConstellationLabelFonts interface to allow programmatic\nspecification of label font defaults, and default implementation\nDefaultLabelFonts\n:art: refactored LabelFontsOptionsPanel and\nLabelFontsOptionsPanelController to make use of default label font\nsettings", "committedDate": "2020-01-24T13:29:42Z", "type": "commit"}, {"oid": "758287a7ca94349a87f302b715f52725ea67809e", "url": "https://github.com/constellation-app/constellation/commit/758287a7ca94349a87f302b715f52725ea67809e", "message": ":art: updated changelog.md", "committedDate": "2020-01-24T13:39:57Z", "type": "commit"}, {"oid": "2264c2507b8baf9adc16e1809ef73afa4a1c2281", "url": "https://github.com/constellation-app/constellation/commit/2264c2507b8baf9adc16e1809ef73afa4a1c2281", "message": "--added a comment to highlight a TODO", "committedDate": "2020-01-28T07:03:48Z", "type": "commit"}, {"oid": "ba34a1835c7cdf01193fe6683ed2997a7e907d96", "url": "https://github.com/constellation-app/constellation/commit/ba34a1835c7cdf01193fe6683ed2997a7e907d96", "message": "Merge branch 'master' of https://github.com/constellation-app/constellation into font-improvements", "committedDate": "2020-01-28T07:23:05Z", "type": "commit"}, {"oid": "cb3ab316764a21e578c3ab540feba891ff7675d7", "url": "https://github.com/constellation-app/constellation/commit/cb3ab316764a21e578c3ab540feba891ff7675d7", "message": ":art: minor code formatting change", "committedDate": "2020-01-28T07:52:14Z", "type": "commit"}, {"oid": "9d062048229ccf5f034d469c0cb5758dbaeac263", "url": "https://github.com/constellation-app/constellation/commit/9d062048229ccf5f034d469c0cb5758dbaeac263", "message": ":art: updated label fonts options panel based on feedback\n:art: moved all glyph classes to the glyph folder\n:art: moved ui icons to a ui folder\n:art: moved docs images to resources folders\n:art: updated image references in docs to include alt tags", "committedDate": "2020-01-29T12:02:54Z", "type": "commit"}, {"oid": "b1bc5cf6f975bfed0761663cfc55073f2e9e8632", "url": "https://github.com/constellation-app/constellation/commit/b1bc5cf6f975bfed0761663cfc55073f2e9e8632", "message": ":art: separated icons in the arrangement module", "committedDate": "2020-01-29T12:59:54Z", "type": "commit"}, {"oid": "ec8d828a2da701d85be30f14bbe9b8987e594309", "url": "https://github.com/constellation-app/constellation/commit/ec8d828a2da701d85be30f14bbe9b8987e594309", "message": "Merge pull request #213 from cygnus-x-1/font-improvements\n\nFont improvements", "committedDate": "2020-01-30T05:02:14Z", "type": "commit"}, {"oid": "0408f7682f1c631f7b8483d473b7503a52f09693", "url": "https://github.com/constellation-app/constellation/commit/0408f7682f1c631f7b8483d473b7503a52f09693", "message": "Glyphs: change text ordering when a RTL string ends with a type.", "committedDate": "2020-01-30T06:53:10Z", "type": "commit"}, {"oid": "26b9186355dcd9601b523d51067c3f72a18b20ae", "url": "https://github.com/constellation-app/constellation/commit/26b9186355dcd9601b523d51067c3f72a18b20ae", "message": "Glyphs: don't reset the texture coordinates array when a new texture page is created.", "committedDate": "2020-01-30T07:38:58Z", "type": "commit"}, {"oid": "377190dfe5a0cab1d3d18933b4d956ed8cf9f587", "url": "https://github.com/constellation-app/constellation/commit/377190dfe5a0cab1d3d18933b4d956ed8cf9f587", "message": "Glyphs: add help for the \"label fonts\" options; tidy up obsolete code.", "committedDate": "2020-01-31T09:32:47Z", "type": "commit"}, {"oid": "25ebbc5023d8673f1997acfc19b716527388a098", "url": "https://github.com/constellation-app/constellation/commit/25ebbc5023d8673f1997acfc19b716527388a098", "message": "Glyphs: add validation help.", "committedDate": "2020-02-01T05:12:49Z", "type": "commit"}, {"oid": "dec5d3f0536a6f2a00bce1fff01591164c859749", "url": "https://github.com/constellation-app/constellation/commit/dec5d3f0536a6f2a00bce1fff01591164c859749", "message": "Merge pull request #220 from algol60/new-fonts\n\nNew fonts", "committedDate": "2020-02-03T02:07:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzMzM5OQ==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r374533399", "bodyText": "This should probably be moved to the CoreUtilities gui package.", "author": "cygnus-x-1", "createdAt": "2020-02-04T08:35:35Z", "path": "CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/NumberedTextArea.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright 2010-2019 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.visual.opengl.utilities;\n+\n+import java.awt.Color;\n+import javax.swing.JTextArea;\n+import javax.swing.text.Element;\n+\n+/**\n+ *\n+ * @author algol\n+ */\n+public final class NumberedTextArea extends JTextArea {", "originalCommit": "dec5d3f0536a6f2a00bce1fff01591164c859749", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "03a2f10b83c2565ad2bfabe2ce95fb2683c622f2", "chunk": "diff --git a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/NumberedTextArea.java b/CoreUtilities/src/au/gov/asd/tac/constellation/utilities/gui/JNumberedTextArea.java\nsimilarity index 87%\nrename from CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/NumberedTextArea.java\nrename to CoreUtilities/src/au/gov/asd/tac/constellation/utilities/gui/JNumberedTextArea.java\nindex 694064de9..580829db1 100644\n--- a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/NumberedTextArea.java\n+++ b/CoreUtilities/src/au/gov/asd/tac/constellation/utilities/gui/JNumberedTextArea.java\n\n@@ -13,21 +13,22 @@\n  * See the License for the specific language governing permissions and\n  * limitations under the License.\n  */\n-package au.gov.asd.tac.constellation.visual.opengl.utilities;\n+package au.gov.asd.tac.constellation.utilities.gui;\n \n import java.awt.Color;\n import javax.swing.JTextArea;\n import javax.swing.text.Element;\n \n /**\n- *\n+ * A numbered text area for use with Swing.\n+ * \n  * @author algol\n  */\n-public final class NumberedTextArea extends JTextArea {\n+public final class JNumberedTextArea extends JTextArea {\n \n     private final JTextArea textArea;\n \n-    public NumberedTextArea(final JTextArea textArea) {\n+    public JNumberedTextArea(final JTextArea textArea) {\n         this.textArea = textArea;\n         setBackground(Color.LIGHT_GRAY);\n         setEditable(false);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzMzg4MQ==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r374533881", "bodyText": "Even though the font will fall back to Sans Serif, I think there's value in making it explicit here, in particular so that it shows up in the UI.", "author": "cygnus-x-1", "createdAt": "2020-02-04T08:36:45Z", "path": "CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DefaultLabelFonts.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright 2010-2019 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.visual.opengl.utilities.glyphs;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import org.openide.util.lookup.ServiceProvider;\n+\n+/**\n+ * The default fonts for use as labels in a graph.\n+ *\n+ * @author cygnus_x-1\n+ */\n+@ServiceProvider(service = ConstellationLabelFonts.class, position = Integer.MAX_VALUE)\n+public class DefaultLabelFonts implements ConstellationLabelFonts {\n+\n+    @Override\n+    public List<String> getFontList() {\n+        final List<String> fontList = new ArrayList<>();\n+//        fontList.add(\"SansSerif\");", "originalCommit": "dec5d3f0536a6f2a00bce1fff01591164c859749", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d9d727bc66e0b3b9aed2da13d1dcc87597bc0560", "chunk": "diff --git a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DefaultLabelFonts.java b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DefaultLabelFonts.java\nindex c2fbf46de..94e9365ed 100644\n--- a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DefaultLabelFonts.java\n+++ b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DefaultLabelFonts.java\n\n@@ -31,7 +31,7 @@ public class DefaultLabelFonts implements ConstellationLabelFonts {\n     @Override\n     public List<String> getFontList() {\n         final List<String> fontList = new ArrayList<>();\n-//        fontList.add(\"SansSerif\");\n+        fontList.add(\"SansSerif\");\n         return Collections.unmodifiableList(fontList);\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzNDI0OQ==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r374534249", "bodyText": "Can we get rid of all these commented out print statements?", "author": "cygnus-x-1", "createdAt": "2020-02-04T08:37:32Z", "path": "CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DirectionRun.java", "diffHunk": "@@ -0,0 +1,197 @@\n+/*\n+ * Copyright 2010-2019 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.visual.opengl.utilities.glyphs;\n+\n+import java.awt.Font;\n+import java.awt.font.TextAttribute;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+\n+/**\n+ * A run of text that has a single direction (TextAttribute.RUN_DIRECTION_LTR or\n+ * TextAttribute.RUN_DIRECTION_RTL).\n+ *\n+ * @author algol\n+ */\n+class DirectionRun {\n+\n+    final String run;\n+    final Boolean direction;\n+\n+    /**\n+     * A new DirectionRun instance.\n+     *\n+     * @param run Text that has a single direction.\n+     * @param direction One of TextAttribute.RUN_DIRECTION_LTR or\n+     * TextAttribute.RUN_DIRECTION_RTL.\n+     */\n+    private DirectionRun(final String run, final Boolean direction) {\n+        this.run = run;\n+        this.direction = direction;\n+    }\n+\n+    /**\n+     * The corresponding Font layout direction to this run direction.\n+     *\n+     * @return One of Font.LAYOUT_LEFT_TO_RIGHT or Font.LAYOUT_RIGHT_TO_LEFT.\n+     */\n+    int getFontLayoutDirection() {\n+        return direction.equals(TextAttribute.RUN_DIRECTION_LTR)\n+                ? Font.LAYOUT_LEFT_TO_RIGHT\n+                : Font.LAYOUT_RIGHT_TO_LEFT;\n+    }\n+\n+    /**\n+     * Return the direction of the specified codepoint, one of 'L', 'R', 'U'.\n+     * <p>\n+     * Uses Character.getDirectionality() to get the directionality. Codepoints\n+     * with specific directionality become left 'L' or right 'R', all other\n+     * characters are undefined 'U'.\n+     *\n+     * @param codepoint The Unicode codepoint to get the direction of.\n+     *\n+     * @return One of 'L', 'R', 'U' (left, right, undefined).\n+     */\n+    private static char codepointDirection(final int codepoint) {\n+        final byte d = Character.getDirectionality(codepoint);\n+\n+        switch (d) {\n+            case Character.DIRECTIONALITY_RIGHT_TO_LEFT:\n+            case Character.DIRECTIONALITY_RIGHT_TO_LEFT_ARABIC:\n+            case Character.DIRECTIONALITY_RIGHT_TO_LEFT_EMBEDDING:\n+            case Character.DIRECTIONALITY_RIGHT_TO_LEFT_OVERRIDE:\n+                return 'R';\n+\n+            case Character.DIRECTIONALITY_LEFT_TO_RIGHT:\n+            case Character.DIRECTIONALITY_LEFT_TO_RIGHT_EMBEDDING:\n+            case Character.DIRECTIONALITY_LEFT_TO_RIGHT_OVERRIDE:\n+                return 'L';\n+\n+            default:\n+                return 'U';\n+        }\n+    }\n+\n+    /**\n+     * Find the beginnings and ends of runs of codepoints that have the same\n+     * direction.\n+     * <p>\n+     * If there are any RTL runs, the order of the runs is reversed.\n+     *\n+     * @param text Text to be broken into runs of the same direction.\n+     *\n+     * @return A List<DirectionRun>.\n+     */\n+    static List<DirectionRun> getDirectionRuns(final String text) {\n+        final int length = text.length();\n+\n+        char currDir = ' ';\n+        final ArrayList<DirectionRun> runs = new ArrayList<>();\n+\n+        int start = 0;\n+        for (int offset = 0; offset < length;) {\n+            final int codepoint = text.codePointAt(offset);\n+            final int cc = Character.charCount(codepoint);\n+\n+            final char dir;\n+            final int cptype = Character.getType(codepoint);\n+            /*codepoint==32*/\n+            if ((cptype == Character.SPACE_SEPARATOR || cptype == Character.NON_SPACING_MARK)) {\n+                dir = currDir;\n+            } else {\n+                final char d = codepointDirection(codepoint);\n+                dir = d != 'R' ? 'L' : 'R';\n+            }\n+//            System.out.printf(\"codepoint %d %d %c %c %d %s\\n\", offset, codepoint, currDir, dir, Character.getType(codepoint), Character.UnicodeBlock.of(codepoint));", "originalCommit": "dec5d3f0536a6f2a00bce1fff01591164c859749", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d9d727bc66e0b3b9aed2da13d1dcc87597bc0560", "chunk": "diff --git a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DirectionRun.java b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DirectionRun.java\nindex f92fd6bca..36af82d86 100644\n--- a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DirectionRun.java\n+++ b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/DirectionRun.java\n\n@@ -132,57 +132,12 @@ class DirectionRun {\n         runs.add(new DirectionRun(text.substring(start, length), currDir == 'L' ? TextAttribute.RUN_DIRECTION_LTR : TextAttribute.RUN_DIRECTION_RTL));\n \n         // If there is more than one direction (which implies that at least one\n-        // run is right-to-left), modify the order of the runs.\n+        // run is right-to-left), or if the first direction is RTL, reverse the runs.\n+        // Since what was the final run is now the first run, set the\n+        // first direction.\n         //\n-        if (runs.size() > 1) {\n-            final DirectionRun run = runs.get(runs.size()-1);\n-\n-            // If the last run is LTR and ends with a type \"<...>\", put the type\n-            // in its own run and move that run in front of the other runs.\n-            // This may mean splitting the run if there is\n-            // non-type text present.\n-            //\n-            // (This is a bit weird, because at this level we have no\n-            // knowledge of types, but we're trying to make it look right for\n-            // the users.)\n-            //\n-            if(run.direction.equals(TextAttribute.RUN_DIRECTION_LTR) && run.run.endsWith(\">\")) {\n-                final int lt = run.run.lastIndexOf('<');\n-                if(lt>-1) {\n-                    // Remove the run; it ends with a type, so it doesn't\n-                    // belong at the end.\n-                    //\n-                    runs.remove(runs.size()-1);\n-\n-                    if(lt==0) {\n-                        // The less-than is at the start of the run,\n-                        // therefore the type is already in a run by itself;\n-                        // just insert it at the front.\n-                        runs.add(0, run);\n-                    } else {\n-                        // Split the run into two new runs and put them in their\n-                        // rightful places.\n-                        //\n-                        final DirectionRun runType = new DirectionRun(run.run.substring(lt), run.direction);\n-                        final DirectionRun runOther = new DirectionRun(run.run.substring(0, lt), run.direction);\n-\n-                        // The text before the \"<\" goes back at the end.\n-                        //\n-                        runs.add(runOther);\n-\n-                        // If the first run has the same direction, merge the\n-                        // type run and the first run, else just insert the\n-                        // type run at the front.\n-                        //\n-                        final DirectionRun run0 = runs.get(0);\n-                        if(run0.direction.equals(runType.direction)) {\n-                            runs.set(0, new DirectionRun(runType.run + run0.run, runType.direction));\n-                        } else {\n-                            runs.add(0, runType);\n-                        }\n-                    }\n-                }\n-            }\n+        if (runs.size() > 1 || runs.get(0).direction.equals(TextAttribute.RUN_DIRECTION_RTL)) {\n+            Collections.reverse(runs);\n         }\n \n //        System.out.printf(\"* dir runs %d %s\\n\", runs.size(), runs.get(0).direction);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzNTAxOA==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r374535018", "bodyText": "New classes should at minimum have class-level javadoc describing what they do.", "author": "cygnus-x-1", "createdAt": "2020-02-04T08:39:19Z", "path": "CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManager.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+ * Copyright 2010-2019 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.visual.opengl.utilities.glyphs;\n+\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.nio.ByteBuffer;\n+\n+/**\n+ *", "originalCommit": "dec5d3f0536a6f2a00bce1fff01591164c859749", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "03a2f10b83c2565ad2bfabe2ce95fb2683c622f2", "chunk": "diff --git a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManager.java b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManager.java\nindex 0f32fa4b2..f59e8d659 100644\n--- a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManager.java\n+++ b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManager.java\n\n@@ -20,6 +20,9 @@ import java.io.OutputStream;\n import java.nio.ByteBuffer;\n \n /**\n+ * The GlyphManager manages a series of textures that hold all glyphs for the\n+ * application. It also performs text layout and provides x,y offsets for each\n+ * glyph in a specified string of text.\n  *\n  * @author algol\n  */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzNTMzMA==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r374535330", "bodyText": "Sooo... we can just get rid of this now.... right?", "author": "cygnus-x-1", "createdAt": "2020-02-04T08:40:06Z", "path": "CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManagerFX.java", "diffHunk": "@@ -57,9 +59,9 @@\n  *\n  * @author sirius\n  */\n-public class GlyphManager {\n+public class GlyphManagerFX implements GlyphManager {", "originalCommit": "dec5d3f0536a6f2a00bce1fff01591164c859749", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI3MDAyOQ==", "url": "https://github.com/constellation-app/constellation/pull/222#discussion_r376270029", "bodyText": "After speaking with @algol60 it sounds like we should keep this around for a few months as a fallback.", "author": "cygnus-x-1", "createdAt": "2020-02-07T08:38:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUzNTMzMA=="}], "type": "inlineReview", "revised_code": {"commit": "03a2f10b83c2565ad2bfabe2ce95fb2683c622f2", "chunk": "diff --git a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManagerFX.java b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManagerFX.java\nindex f9a44cfad..067330365 100644\n--- a/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManagerFX.java\n+++ b/CoreOpenGLDisplay/src/au/gov/asd/tac/constellation/visual/opengl/utilities/glyphs/GlyphManagerFX.java\n\n@@ -53,9 +53,7 @@ import javafx.scene.paint.Color;\n import javax.imageio.ImageIO;\n \n /**\n- * The GlyphManager manages a series of textures that hold all glyphs for the\n- * application. It also performs text layout and provides x,y offsets for each\n- * glyph in a specified string of text.\n+ * Convert text into images that can be passed to OpenGL.\n  *\n  * @author sirius\n  */\n"}}, {"oid": "d9d727bc66e0b3b9aed2da13d1dcc87597bc0560", "url": "https://github.com/constellation-app/constellation/commit/d9d727bc66e0b3b9aed2da13d1dcc87597bc0560", "message": "Merge branch 'master' into font-improvements", "committedDate": "2020-02-06T09:14:28Z", "type": "commit"}, {"oid": "ae1996380a9eb510073d6bb1b2d01c5e069c9a08", "url": "https://github.com/constellation-app/constellation/commit/ae1996380a9eb510073d6bb1b2d01c5e069c9a08", "message": "Merge branch 'new-fonts' of https://github.com/constellation-app/constellation into font-improvements", "committedDate": "2020-02-06T09:14:46Z", "type": "commit"}, {"oid": "03a2f10b83c2565ad2bfabe2ce95fb2683c622f2", "url": "https://github.com/constellation-app/constellation/commit/03a2f10b83c2565ad2bfabe2ce95fb2683c622f2", "message": ":art: moved NumberedTextArea to the Core Utilities module\n:art: added back explicit default font\n:art: removed debug print statements\n:art: added basic class-level descriptions\n:art: minor ui changes to LabelFontsOptionsPanel to remove whitespace\nand add help button", "committedDate": "2020-02-06T10:33:04Z", "type": "commit"}, {"oid": "16f1969252e6fd17c30f9629df9520dd396d8075", "url": "https://github.com/constellation-app/constellation/commit/16f1969252e6fd17c30f9629df9520dd396d8075", "message": "Merge pull request #240 from cygnus-x-1/font-improvements\n\nFont improvements", "committedDate": "2020-02-06T12:02:07Z", "type": "commit"}, {"oid": "010f334950af7252b260a176a1ce9b4d208fa936", "url": "https://github.com/constellation-app/constellation/commit/010f334950af7252b260a176a1ce9b4d208fa936", "message": "Merge branch 'master' into new-fonts", "committedDate": "2020-02-06T12:18:39Z", "type": "commit"}, {"oid": "df7b112f675db29318f2a72805852506d51c147e", "url": "https://github.com/constellation-app/constellation/commit/df7b112f675db29318f2a72805852506d51c147e", "message": "Merge branch 'master' of https://github.com/constellation-app/constellation into font-improvements\n\n# Conflicts:\n#\tCHANGELOG.md", "committedDate": "2020-02-07T08:44:27Z", "type": "commit"}, {"oid": "126763cb5c244192e2b9facbb9894f9b6bc89f17", "url": "https://github.com/constellation-app/constellation/commit/126763cb5c244192e2b9facbb9894f9b6bc89f17", "message": "Merge branch 'new-fonts' of https://github.com/constellation-app/constellation into font-improvements", "committedDate": "2020-02-07T08:45:10Z", "type": "commit"}, {"oid": "00def2497925e78eb2df4359cbaac2d4277e37e0", "url": "https://github.com/constellation-app/constellation/commit/00def2497925e78eb2df4359cbaac2d4277e37e0", "message": ":art: removed duplicate help button... not sure how i missed the giant\nexisting one", "committedDate": "2020-02-07T09:21:02Z", "type": "commit"}, {"oid": "ace657bd741a4712a3b4acc408aee28982f32a9f", "url": "https://github.com/constellation-app/constellation/commit/ace657bd741a4712a3b4acc408aee28982f32a9f", "message": "Merge pull request #241 from cygnus-x-1/font-improvements\n\nFont improvements", "committedDate": "2020-02-10T01:27:38Z", "type": "commit"}, {"oid": "dd2f836150bacc3912fb58bdcea3eabd73a1b8df", "url": "https://github.com/constellation-app/constellation/commit/dd2f836150bacc3912fb58bdcea3eabd73a1b8df", "message": ":shirt: Fix SonarQube warnings", "committedDate": "2020-02-10T06:16:05Z", "type": "commit"}]}