{"pr_number": 901, "pr_title": "Refresh quality control state only when necessary", "pr_createdAt": "2020-11-30T05:05:19Z", "pr_url": "https://github.com/constellation-app/constellation/pull/901", "timeline": [{"oid": "e16bbc24226295225fe3e25641c46139189c736e", "url": "https://github.com/constellation-app/constellation/commit/e16bbc24226295225fe3e25641c46139189c736e", "message": "add modification counters\n\nrefresh only once a mod count that matters changes.", "committedDate": "2020-11-30T04:57:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTY3NDMwNg==", "url": "https://github.com/constellation-app/constellation/pull/901#discussion_r535674306", "bodyText": "We will want the quality control state to update with selection changes so it would be good to remove these 2 conditions (and consequently can probably remove thisvxselectedAttributeModificationCounter and thistxselectedAttributeModificationCounter altogether)", "author": "antares1470", "createdAt": "2020-12-03T22:01:34Z", "path": "CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/daemon/QualityControlAutoVetter.java", "diffHunk": "@@ -152,10 +156,25 @@ public void graphChanged(final GraphChangeEvent event) {\n         if (graph != null) {\n             final ReadableGraph readableGraph = graph.getReadableGraph();\n             try {\n+                final int cameraAttribute = VisualConcept.GraphAttribute.CAMERA.get(readableGraph);\n+                final int vxselectedAttribute = VisualConcept.VertexAttribute.SELECTED.get(readableGraph);\n+                final int txselectedAttribute = VisualConcept.VertexAttribute.SELECTED.get(readableGraph);\n+\n                 final long thisGlobalModificationCounter = readableGraph.getGlobalModificationCounter();\n+                final long thisCameraModificationCounter = readableGraph.getValueModificationCounter(cameraAttribute);\n+                final long thisvxselectedAttributeModificationCounter = readableGraph.getValueModificationCounter(vxselectedAttribute);\n+                final long thistxselectedAttributeModificationCounter = readableGraph.getValueModificationCounter(txselectedAttribute);\n+\n                 if (thisGlobalModificationCounter != lastGlobalModificationCounter) {\n-                    updateQualityControlState(graph);\n+                    if (lastCameraModificationCounter == thisCameraModificationCounter\n+                            && lastvxselectedAttributeModificationCounter == thisvxselectedAttributeModificationCounter\n+                            && lasttxselectedAttributeModificationCounter == thistxselectedAttributeModificationCounter) {", "originalCommit": "e16bbc24226295225fe3e25641c46139189c736e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "93cb5976da20a2cd3599ee7c8f7d3b7a7f3e0c0c", "chunk": "diff --git a/CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/daemon/QualityControlAutoVetter.java b/CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/daemon/QualityControlAutoVetter.java\nindex 8128d34ca..2139b15dd 100644\n--- a/CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/daemon/QualityControlAutoVetter.java\n+++ b/CoreQualityControlView/src/au/gov/asd/tac/constellation/views/qualitycontrol/daemon/QualityControlAutoVetter.java\n\n@@ -157,24 +155,16 @@ public final class QualityControlAutoVetter implements GraphManagerListener, Gra\n             final ReadableGraph readableGraph = graph.getReadableGraph();\n             try {\n                 final int cameraAttribute = VisualConcept.GraphAttribute.CAMERA.get(readableGraph);\n-                final int vxselectedAttribute = VisualConcept.VertexAttribute.SELECTED.get(readableGraph);\n-                final int txselectedAttribute = VisualConcept.VertexAttribute.SELECTED.get(readableGraph);\n \n                 final long thisGlobalModificationCounter = readableGraph.getGlobalModificationCounter();\n                 final long thisCameraModificationCounter = readableGraph.getValueModificationCounter(cameraAttribute);\n-                final long thisvxselectedAttributeModificationCounter = readableGraph.getValueModificationCounter(vxselectedAttribute);\n-                final long thistxselectedAttributeModificationCounter = readableGraph.getValueModificationCounter(txselectedAttribute);\n \n                 if (thisGlobalModificationCounter != lastGlobalModificationCounter) {\n-                    if (lastCameraModificationCounter == thisCameraModificationCounter\n-                            && lastvxselectedAttributeModificationCounter == thisvxselectedAttributeModificationCounter\n-                            && lasttxselectedAttributeModificationCounter == thistxselectedAttributeModificationCounter) {\n+                    if (lastCameraModificationCounter == thisCameraModificationCounter) {\n                         updateQualityControlState(graph);\n                     }\n                     lastGlobalModificationCounter = thisGlobalModificationCounter;\n                     lastCameraModificationCounter = thisCameraModificationCounter;\n-                    lastvxselectedAttributeModificationCounter = thisvxselectedAttributeModificationCounter;\n-                    lasttxselectedAttributeModificationCounter = thistxselectedAttributeModificationCounter;\n                 }\n             } finally {\n                 readableGraph.release();\n"}}, {"oid": "93cb5976da20a2cd3599ee7c8f7d3b7a7f3e0c0c", "url": "https://github.com/constellation-app/constellation/commit/93cb5976da20a2cd3599ee7c8f7d3b7a7f3e0c0c", "message": "Remove selected attribute change avoidance", "committedDate": "2020-12-04T01:17:38Z", "type": "commit"}]}