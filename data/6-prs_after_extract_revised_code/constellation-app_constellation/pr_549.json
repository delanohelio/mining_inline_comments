{"pr_number": 549, "pr_title": "Convert Attribute editor to JavaFx pane and use TopComponent framework", "pr_createdAt": "2020-05-25T05:34:41Z", "pr_url": "https://github.com/constellation-app/constellation/pull/549", "timeline": [{"oid": "604ea5bdda96e2b2af3e7d45f76cb796a3d9814b", "url": "https://github.com/constellation-app/constellation/commit/604ea5bdda96e2b2af3e7d45f76cb796a3d9814b", "message": "Remove swing usages", "committedDate": "2020-05-25T05:31:00Z", "type": "commit"}, {"oid": "a252acedcc8e798d141bf21c65d46b96182a1809", "url": "https://github.com/constellation-app/constellation/commit/a252acedcc8e798d141bf21c65d46b96182a1809", "message": "Merge branch 'master' into AttributeEditor-TopComponent", "committedDate": "2020-05-25T05:35:08Z", "type": "commit"}, {"oid": "3978c11a2cf2288e6300c3df5bdce8223ef7ef9a", "url": "https://github.com/constellation-app/constellation/commit/3978c11a2cf2288e6300c3df5bdce8223ef7ef9a", "message": "remove unused import", "committedDate": "2020-05-25T05:56:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxNTA1Ng==", "url": "https://github.com/constellation-app/constellation/pull/549#discussion_r429815056", "bodyText": "Again, this should be handled by the framework.", "author": "cygnus-x-1", "createdAt": "2020-05-25T08:51:42Z", "path": "CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorTopComponent.java", "diffHunk": "@@ -248,7 +248,7 @@ public UndoRedo getUndoRedo() {\n     }\r\n \r\n     @Override\r\n-    public void preferenceChange(PreferenceChangeEvent event) {\r\n+    protected void handlePreferenceChange(final PreferenceChangeEvent event) {\r", "originalCommit": "3978c11a2cf2288e6300c3df5bdce8223ef7ef9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA5MzUyOQ==", "url": "https://github.com/constellation-app/constellation/pull/549#discussion_r430093529", "bodyText": "Neat!", "author": "aldebaran30701", "createdAt": "2020-05-25T23:08:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxNTA1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "2164b339d67fd3e659bb5f489f60fb35188fb6d7", "chunk": "diff --git a/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorTopComponent.java b/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorTopComponent.java\nindex 8f327526d..e2528edc6 100644\n--- a/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorTopComponent.java\n+++ b/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorTopComponent.java\n\n@@ -247,41 +246,9 @@ public final class AttributeEditorTopComponent extends JavaFxTopComponent<Attrib\n         return (graphNode == null) ? null : graphNode.getUndoRedoManager();\n     }\n \n-    @Override\n-    protected void handlePreferenceChange(final PreferenceChangeEvent event) {\n-        if (event.getKey().equals(ApplicationPreferenceKeys.OUTPUT2_FONT_SIZE)) {\n-            attributePanel.setFontSize();\n-        } else {\n-            if (AttributePreferenceKey.ATTRIBUTE_COLOR_PREFS.contains(event.getKey())) {\n-                attributePanel.rebuildColourMenu();\n-            }\n-            queue.add(event);\n-            if (refreshThread == null || !refreshThread.isAlive()) {\n-                refreshThread = new Thread(() -> {\n-                    try {\n-                        ArrayList<Object> devNull = new ArrayList<>();\n-                        while (queue.drainTo(devNull) > 0) {\n-                            Thread.sleep(50);\n-                        }\n-                        if (reader != null) {\n-                            AttributeState state = reader.refreshAttributes(true);\n-                            attributePanel.updateEditorPanel(state);\n-                        }\n-\n-                    } catch (InterruptedException e) {\n-                        Thread.currentThread().interrupt();\n-                    }\n-\n-                });\n-                refreshThread.setName(ATTRIBUTE_EDITOR_PREFERENCE_CHANGED_THREAD_NAME);\n-                refreshThread.start();\n-            }\n-        }\n-    }\n-\n     @Override\n     protected String createStyle() {\n-        return \"resources/Style-Overview-Dark.css\";\n+        return \"resources/Style-AttributeEditor-Dark.css\";\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxNjI2Mg==", "url": "https://github.com/constellation-app/constellation/pull/549#discussion_r429816262", "bodyText": "This should be handled by the framework - it'll automatically apply the default stylesheet, and additionally apply a stylesheet specified by JavaFxTopComponent.createStyle. These styles will cascade down from the top component to its children (at least that's how it's supposed to work.", "author": "cygnus-x-1", "createdAt": "2020-05-25T08:54:07Z", "path": "CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorPanel.java", "diffHunk": "@@ -212,21 +207,13 @@ public AttributeEditorPanel(AttributeEditorTopComponent parent) {\n         }\n \n         scrollPane.setContent(titledPaneHeadingsContainer);\n-        BoxLayout layout = new BoxLayout(this, BoxLayout.Y_AXIS);\n-        setLayout(layout);\n-        add(container);\n         scrollPane.setFitToWidth(true);\n \n-        final int height = this.getPreferredSize().height;\n-\n         Platform.setImplicitExit(false);\n         Platform.runLater(() -> {\n             root = new StackPane();\n-\n-            final Scene scene = new Scene(root, 0, height);\n-            scene.getStylesheets().add(JavafxStyleManager.getMainStyleSheet());\n-            scene.rootProperty().get().setStyle(String.format(\"-fx-font-size:%d;\", FontUtilities.getOutputFontSize()));\n-            scene.getStylesheets().add(AttributeEditorPanel.class.getResource(DARK_THEME).toExternalForm());\n+            root.getStylesheets().add(JavafxStyleManager.getMainStyleSheet());", "originalCommit": "3978c11a2cf2288e6300c3df5bdce8223ef7ef9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA5MzYyMA==", "url": "https://github.com/constellation-app/constellation/pull/549#discussion_r430093620", "bodyText": "It seems to be working fine after putting on the correct style sheet either way. Next commit will have the fixes in it \ud83d\udc4d", "author": "aldebaran30701", "createdAt": "2020-05-25T23:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxNjI2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2164b339d67fd3e659bb5f489f60fb35188fb6d7", "chunk": "diff --git a/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorPanel.java b/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorPanel.java\nindex 8bb7cea14..d9942b022 100644\n--- a/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorPanel.java\n+++ b/CoreAttributeEditorView/src/au/gov/asd/tac/constellation/views/attributeeditor/AttributeEditorPanel.java\n\n@@ -212,8 +211,6 @@ public class AttributeEditorPanel extends BorderPane {\n         Platform.setImplicitExit(false);\n         Platform.runLater(() -> {\n             root = new StackPane();\n-            root.getStylesheets().add(JavafxStyleManager.getMainStyleSheet());\n-            root.getStylesheets().add(AttributeEditorPanel.class.getResource(DARK_THEME).toExternalForm());\n \n             for (int i = 0; i < valueTitledPaneContainers.size(); i++) {\n                 headingTitleProperties[i] = new SimpleStringProperty();\n"}}, {"oid": "2164b339d67fd3e659bb5f489f60fb35188fb6d7", "url": "https://github.com/constellation-app/constellation/commit/2164b339d67fd3e659bb5f489f60fb35188fb6d7", "message": "PR Fixes", "committedDate": "2020-05-25T23:11:31Z", "type": "commit"}]}