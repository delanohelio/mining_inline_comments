{"pr_number": 3754, "pr_title": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "pr_createdAt": "2020-08-18T18:05:55Z", "pr_url": "https://github.com/Catrobat/Catroid/pull/3754", "timeline": [{"oid": "a2a502bd1729352f87335e61ab1fcfe352385cda", "url": "https://github.com/Catrobat/Catroid/commit/a2a502bd1729352f87335e61ab1fcfe352385cda", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-02T12:34:44Z", "type": "forcePushed"}, {"oid": "8a42f418e24ab3ddbc9ea6852b7778b0a9a238b6", "url": "https://github.com/Catrobat/Catroid/commit/8a42f418e24ab3ddbc9ea6852b7778b0a9a238b6", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-02T13:07:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkyNTM4OA==", "url": "https://github.com/Catrobat/Catroid/pull/3754#discussion_r482925388", "bodyText": "Maybe you could make this condition more readable if you outsource it to a function, e.g. isGlobalVariable(UserData<?> item)", "author": "mstoeg", "createdAt": "2020-09-03T12:03:44Z", "path": "catroid/src/main/java/org/catrobat/catroid/content/Scene.java", "diffHunk": "@@ -172,8 +173,14 @@ public void removeClonedSprites() {\n \t}\n \n \tpublic void updateUserDataReferences(String oldName, String newName, UserData<?> item) {\n-\t\tfor (Sprite sprite : spriteList) {\n-\t\t\tsprite.updateUserDataReferences(oldName, newName, item);\n+\t\tProject currentProject = ProjectManager.getInstance().getCurrentProject();\n+\t\tif (currentProject.getUserVariables().contains(item) || currentProject.getUserLists().contains(item)\n+\t\t\t\t|| currentProject.getMultiplayerVariables().contains(item)) {", "originalCommit": "8a42f418e24ab3ddbc9ea6852b7778b0a9a238b6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "77bcdd33b3b6ccb5528e28dc5ad457a2e649ca22", "chunk": "diff --git a/catroid/src/main/java/org/catrobat/catroid/content/Scene.java b/catroid/src/main/java/org/catrobat/catroid/content/Scene.java\nindex 1b7852459..b52a2218d 100644\n--- a/catroid/src/main/java/org/catrobat/catroid/content/Scene.java\n+++ b/catroid/src/main/java/org/catrobat/catroid/content/Scene.java\n\n@@ -173,9 +174,7 @@ public class Scene implements Nameable, Serializable {\n \t}\n \n \tpublic void updateUserDataReferences(String oldName, String newName, UserData<?> item) {\n-\t\tProject currentProject = ProjectManager.getInstance().getCurrentProject();\n-\t\tif (currentProject.getUserVariables().contains(item) || currentProject.getUserLists().contains(item)\n-\t\t\t\t|| currentProject.getMultiplayerVariables().contains(item)) {\n+\t\tif (Utils.isGlobalVariable(item)) {\n \t\t\tfor (Sprite sprite : spriteList) {\n \t\t\t\tsprite.updateUserDataReferences(oldName, newName, item);\n \t\t\t}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkyNjc3Mg==", "url": "https://github.com/Catrobat/Catroid/pull/3754#discussion_r482926772", "bodyText": "Is it really necessary to add the userVariable in each testcase? I would prefer to add it in the setUp() method by simply calling project.addUserList(userList) and project.addUserVariable(userVariable) once. Same applies for all the other Tests.", "author": "mstoeg", "createdAt": "2020-09-03T12:06:19Z", "path": "catroid/src/test/java/org/catrobat/catroid/test/content/bricks/UpdateVariableInFormulaBrickTest.java", "diffHunk": "@@ -114,6 +114,8 @@ public void testRenamingVariable() {\n \t\t\tformulaBrick.setFormulaWithBrickField(k, newFormula);\n \t\t});\n \n+\t\tProjectManager.getInstance().getCurrentProject().addUserVariable(userVariable);", "originalCommit": "8a42f418e24ab3ddbc9ea6852b7778b0a9a238b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA0NjMwMg==", "url": "https://github.com/Catrobat/Catroid/pull/3754#discussion_r483046302", "bodyText": "Definitely should have done it that way, thanks.", "author": "Rawbat", "createdAt": "2020-09-03T15:00:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkyNjc3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "77bcdd33b3b6ccb5528e28dc5ad457a2e649ca22", "chunk": "diff --git a/catroid/src/test/java/org/catrobat/catroid/test/content/bricks/UpdateVariableInFormulaBrickTest.java b/catroid/src/test/java/org/catrobat/catroid/test/content/bricks/UpdateVariableInFormulaBrickTest.java\nindex e0f372baa..0a37ad9b4 100644\n--- a/catroid/src/test/java/org/catrobat/catroid/test/content/bricks/UpdateVariableInFormulaBrickTest.java\n+++ b/catroid/src/test/java/org/catrobat/catroid/test/content/bricks/UpdateVariableInFormulaBrickTest.java\n\n@@ -114,8 +116,6 @@ public class UpdateVariableInFormulaBrickTest {\n \t\t\tformulaBrick.setFormulaWithBrickField(k, newFormula);\n \t\t});\n \n-\t\tProjectManager.getInstance().getCurrentProject().addUserVariable(userVariable);\n-\n \t\tProjectManager.getInstance().getCurrentProject().updateUserDataReferences(VARIABLE_NAME,\n \t\t\t\tNEW_VARIABLE_NAME,\n \t\t\t\tuserVariable);\n"}}, {"oid": "77bcdd33b3b6ccb5528e28dc5ad457a2e649ca22", "url": "https://github.com/Catrobat/Catroid/commit/77bcdd33b3b6ccb5528e28dc5ad457a2e649ca22", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-03T14:45:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA3Nzc3Ng==", "url": "https://github.com/Catrobat/Catroid/pull/3754#discussion_r483077776", "bodyText": "Please just return the condition here: return currentProject.getUserVariables().contains(item) || ...\nAnd I would not place this method in the Utils class but rather in the Project class as an instance method.", "author": "mstoeg", "createdAt": "2020-09-03T15:44:37Z", "path": "catroid/src/main/java/org/catrobat/catroid/utils/Utils.java", "diffHunk": "@@ -498,6 +499,15 @@ public static int getBit(int number, int index) {\n \t\treturn 0;\n \t}\n \n+\tpublic static boolean isGlobalVariable(UserData<?> item) {\n+\t\tProject currentProject = ProjectManager.getInstance().getCurrentProject();\n+\t\tif (currentProject.getUserVariables().contains(item) || currentProject.getUserLists().contains(item)\n+\t\t\t\t|| currentProject.getMultiplayerVariables().contains(item)) {\n+\t\t\treturn true;", "originalCommit": "77bcdd33b3b6ccb5528e28dc5ad457a2e649ca22", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ee6406f44ae10bd67de0d104f76c467ea0475213", "chunk": "diff --git a/catroid/src/main/java/org/catrobat/catroid/utils/Utils.java b/catroid/src/main/java/org/catrobat/catroid/utils/Utils.java\nindex f1520d0eb..7f2563d24 100644\n--- a/catroid/src/main/java/org/catrobat/catroid/utils/Utils.java\n+++ b/catroid/src/main/java/org/catrobat/catroid/utils/Utils.java\n\n@@ -499,15 +499,6 @@ public final class Utils {\n \t\treturn 0;\n \t}\n \n-\tpublic static boolean isGlobalVariable(UserData<?> item) {\n-\t\tProject currentProject = ProjectManager.getInstance().getCurrentProject();\n-\t\tif (currentProject.getUserVariables().contains(item) || currentProject.getUserLists().contains(item)\n-\t\t\t\t|| currentProject.getMultiplayerVariables().contains(item)) {\n-\t\t\treturn true;\n-\t\t}\n-\t\treturn false;\n-\t}\n-\n \tpublic static List<PickableMusicalInstrument> getPickableMusicalInstruments() {\n \t\tList instruments = new ArrayList<PickableMusicalInstrument>();\n \n"}}, {"oid": "ee6406f44ae10bd67de0d104f76c467ea0475213", "url": "https://github.com/Catrobat/Catroid/commit/ee6406f44ae10bd67de0d104f76c467ea0475213", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-03T15:59:27Z", "type": "forcePushed"}, {"oid": "ee75c368723b80ab94e241ebb8f4570b0ad4c2e0", "url": "https://github.com/Catrobat/Catroid/commit/ee75c368723b80ab94e241ebb8f4570b0ad4c2e0", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-03T17:23:41Z", "type": "forcePushed"}, {"oid": "6e1d3dd91412c883353fec71bbc52617691fc29c", "url": "https://github.com/Catrobat/Catroid/commit/6e1d3dd91412c883353fec71bbc52617691fc29c", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-10T16:39:24Z", "type": "commit"}, {"oid": "6e1d3dd91412c883353fec71bbc52617691fc29c", "url": "https://github.com/Catrobat/Catroid/commit/6e1d3dd91412c883353fec71bbc52617691fc29c", "message": "CATROID-522 References to a local UserVariable within a Scene will be changed in all Scenes", "committedDate": "2020-09-10T16:39:24Z", "type": "forcePushed"}]}