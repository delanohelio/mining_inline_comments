{"pr_number": 5413, "pr_title": "optimize integrate framework", "pr_createdAt": "2020-05-03T02:31:38Z", "pr_url": "https://github.com/apache/shardingsphere/pull/5413", "timeline": [{"oid": "91e5b9778d5fa3d09dc3076ebadc051ae1775972", "url": "https://github.com/apache/shardingsphere/commit/91e5b9778d5fa3d09dc3076ebadc051ae1775972", "message": "display raw sql in parametrized test", "committedDate": "2020-05-02T15:19:54Z", "type": "commit"}, {"oid": "6145c661ade4dcb687f7178e715d9ee5f8f7acfd", "url": "https://github.com/apache/shardingsphere/commit/6145c661ade4dcb687f7178e715d9ee5f8f7acfd", "message": "for checkstyle", "committedDate": "2020-05-02T15:21:06Z", "type": "commit"}, {"oid": "395263ba13476b98c218b6557d1addeb42f7b2a3", "url": "https://github.com/apache/shardingsphere/commit/395263ba13476b98c218b6557d1addeb42f7b2a3", "message": "print test context when assertion error occur", "committedDate": "2020-05-03T02:24:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTA2NQ==", "url": "https://github.com/apache/shardingsphere/pull/5413#discussion_r419039065", "bodyText": "final maybe unnecessary", "author": "terrymanu", "createdAt": "2020-05-03T03:07:27Z", "path": "sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/SingleIT.java", "diffHunk": "@@ -39,13 +42,29 @@\n     \n     private final String sql;\n     \n+    private final String originalSQL;\n+    \n     public SingleIT(final String path, final IntegrateTestCaseAssertion assertion, final String ruleType,\n                     final DatabaseType databaseType, final SQLCaseType caseType, final String sql) throws IOException, JAXBException, SQLException, ParseException {\n         super(ruleType, databaseType);\n         this.assertion = assertion;\n         this.caseType = caseType;\n-        this.sql = sql;\n+        this.originalSQL = sql;\n+        this.sql = convert(sql);\n         expectedDataFile = getExpectedDataFile(path, ruleType, databaseType, null != assertion ? assertion.getExpectedDataFile() : null);\n     }\n+    \n+    private String convert(final String sql) throws ParseException {\n+        return caseType == SQLCaseType.Literal ? getLiteralSQL(sql) : sql;\n+    }\n+    \n+    private String getLiteralSQL(final String sql) throws ParseException {\n+        final List<Object> parameters = null != assertion ? assertion.getSQLValues().stream().map(SQLValue::toString).collect(Collectors.toList()) : null;", "originalCommit": "395263ba13476b98c218b6557d1addeb42f7b2a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA0MDA2MA==", "url": "https://github.com/apache/shardingsphere/pull/5413#discussion_r419040060", "bodyText": "have fixed it", "author": "cherrylzhao", "createdAt": "2020-05-03T03:20:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTA2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "821c792573227c27fefe99a6b76f9665c395b7bc", "chunk": "diff --git a/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/SingleIT.java b/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/SingleIT.java\nindex 825c857516..d09aaa7f29 100644\n--- a/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/SingleIT.java\n+++ b/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/SingleIT.java\n\n@@ -59,7 +59,7 @@ public abstract class SingleIT extends BaseIT {\n     }\n     \n     private String getLiteralSQL(final String sql) throws ParseException {\n-        final List<Object> parameters = null != assertion ? assertion.getSQLValues().stream().map(SQLValue::toString).collect(Collectors.toList()) : null;\n+        List<Object> parameters = null != assertion ? assertion.getSQLValues().stream().map(SQLValue::toString).collect(Collectors.toList()) : null;\n         if (null == parameters || parameters.isEmpty()) {\n             return sql;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTE0Ng==", "url": "https://github.com/apache/shardingsphere/pull/5413#discussion_r419039146", "bodyText": "\\n should be LINE_SEPARATOR", "author": "terrymanu", "createdAt": "2020-05-03T03:08:44Z", "path": "sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/util/IntegrateTestParameters.java", "diffHunk": "@@ -168,7 +152,7 @@ private static void printTestPlan(final Map<DatabaseType, Collection<Object[]>>\n             disabledPlan.add(String.format(\"%s(%s)\", entry.getKey().getName(), entry.getValue().size() * factor));\n         }\n         System.out.println(\"[INFO] ======= Test Plan =======\");\n-        String summary = String.format(\"[%s] Total: %s, Active: %s, Disabled: %s\",\n+        String summary = String.format(\"[%s] Total: %s, Active: %s, Disabled: %s \\n\",", "originalCommit": "395263ba13476b98c218b6557d1addeb42f7b2a3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA0MDA2Nw==", "url": "https://github.com/apache/shardingsphere/pull/5413#discussion_r419040067", "bodyText": "have fixed it", "author": "cherrylzhao", "createdAt": "2020-05-03T03:20:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAzOTE0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "821c792573227c27fefe99a6b76f9665c395b7bc", "chunk": "diff --git a/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/util/IntegrateTestParameters.java b/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/util/IntegrateTestParameters.java\nindex 08a541c8d4..1916066f06 100644\n--- a/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/util/IntegrateTestParameters.java\n+++ b/sharding-integration-test/sharding-jdbc-test/src/test/java/org/apache/shardingsphere/dbtest/engine/util/IntegrateTestParameters.java\n\n@@ -152,10 +152,10 @@ public final class IntegrateTestParameters {\n             disabledPlan.add(String.format(\"%s(%s)\", entry.getKey().getName(), entry.getValue().size() * factor));\n         }\n         System.out.println(\"[INFO] ======= Test Plan =======\");\n-        String summary = String.format(\"[%s] Total: %s, Active: %s, Disabled: %s \\n\",\n+        String summary = String.format(\"[%s] Total: %s, Active: %s, Disabled: %s %s\",\n             disabledPlan.isEmpty() ? \"INFO\" : \"WARN\",\n             (availableCases.values().stream().mapToLong(Collection::size).sum() + disabledCases.values().stream().mapToLong(Collection::size).sum()) * factor,\n-            activePlan.isEmpty() ? 0 : Joiner.on(\", \").join(activePlan), disabledPlan.isEmpty() ? 0 : Joiner.on(\", \").join(disabledPlan));\n+            activePlan.isEmpty() ? 0 : Joiner.on(\", \").join(activePlan), disabledPlan.isEmpty() ? 0 : Joiner.on(\", \").join(disabledPlan), System.lineSeparator());\n         System.out.println(summary);\n     }\n     \n"}}, {"oid": "821c792573227c27fefe99a6b76f9665c395b7bc", "url": "https://github.com/apache/shardingsphere/commit/821c792573227c27fefe99a6b76f9665c395b7bc", "message": "for checkstyle", "committedDate": "2020-05-03T03:19:55Z", "type": "commit"}]}