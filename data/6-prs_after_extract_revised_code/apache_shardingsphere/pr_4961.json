{"pr_number": 4961, "pr_title": "fix selectStatement contained tableReferences for other db", "pr_createdAt": "2020-03-26T11:29:58Z", "pr_url": "https://github.com/apache/shardingsphere/pull/4961", "timeline": [{"oid": "774b55a568381ac85bdba90cb63ffffabf5fc951", "url": "https://github.com/apache/shardingsphere/commit/774b55a568381ac85bdba90cb63ffffabf5fc951", "message": "fix selectStatement contained tableReferences for other db", "committedDate": "2020-03-26T11:23:50Z", "type": "commit"}, {"oid": "7c3cd3509f9d6dd252ede548f065b564cfb7a420", "url": "https://github.com/apache/shardingsphere/commit/7c3cd3509f9d6dd252ede548f065b564cfb7a420", "message": "delete system out", "committedDate": "2020-03-26T11:27:01Z", "type": "commit"}, {"oid": "64aee4587dd15073330a7a1da2a245e0c299385a", "url": "https://github.com/apache/shardingsphere/commit/64aee4587dd15073330a7a1da2a245e0c299385a", "message": "restore selectStatement contained tables", "committedDate": "2020-03-27T03:30:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMTg2Mw==", "url": "https://github.com/apache/shardingsphere/pull/4961#discussion_r399021863", "bodyText": "Sorry, tables was just moved below?", "author": "tristaZero", "createdAt": "2020-03-27T03:56:24Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java", "diffHunk": "@@ -41,10 +40,10 @@\n @Setter\n public final class SelectStatement extends DMLStatement {\n     \n-    private final Collection<TableSegment> tables = new LinkedList<>();\n-    \n     private ProjectionsSegment projections;\n     \n+    private final Collection<TableSegment> tables = new LinkedList<>();\n+    ", "originalCommit": "64aee4587dd15073330a7a1da2a245e0c299385a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNTA1Nw==", "url": "https://github.com/apache/shardingsphere/pull/4961#discussion_r399025057", "bodyText": "It has recovered.", "author": "jingshanglu", "createdAt": "2020-03-27T04:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMTg2Mw=="}], "type": "inlineReview", "revised_code": {"commit": "f4c21d283078c9671c8dd644c8ac462c7884f574", "chunk": "diff --git a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java b/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\nindex 5eca0affbd..a754479732 100644\n--- a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\n+++ b/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\n\n@@ -40,10 +40,10 @@ import java.util.Optional;\n @Setter\n public final class SelectStatement extends DMLStatement {\n     \n-    private ProjectionsSegment projections;\n-    \n     private final Collection<TableSegment> tables = new LinkedList<>();\n     \n+    private ProjectionsSegment projections;\n+    \n     private final Collection<TableReferenceSegment> tableReferences = new LinkedList<>();\n     \n     private WhereSegment where;\n"}}, {"oid": "f4c21d283078c9671c8dd644c8ac462c7884f574", "url": "https://github.com/apache/shardingsphere/commit/f4c21d283078c9671c8dd644c8ac462c7884f574", "message": "restore position of tables", "committedDate": "2020-03-27T04:00:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjgwMw==", "url": "https://github.com/apache/shardingsphere/pull/4961#discussion_r399022803", "bodyText": "Why did you remove this function?", "author": "tristaZero", "createdAt": "2020-03-27T04:00:27Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java", "diffHunk": "@@ -118,19 +117,4 @@\n         }\n         return result;\n     }\n-    \n-    /**\n-     * Get subQuery table segments.\n-     *\n-     * @return subQuery table segments\n-     */\n-    public Collection<SubqueryTableSegment> getSubQueryTableSegments() {", "originalCommit": "64aee4587dd15073330a7a1da2a245e0c299385a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNDIyOA==", "url": "https://github.com/apache/shardingsphere/pull/4961#discussion_r399024228", "bodyText": "This func not be used.", "author": "jingshanglu", "createdAt": "2020-03-27T04:07:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjgwMw=="}], "type": "inlineReview", "revised_code": {"commit": "900ca149b16a1603e641371ff781c846fef56238", "chunk": "diff --git a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java b/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\nindex 5eca0affbd..eb73f8aeef 100644\n--- a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\n+++ b/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/statement/dml/SelectStatement.java\n\n@@ -110,10 +107,8 @@ public final class SelectStatement extends DMLStatement {\n      */\n     public Collection<SimpleTableSegment> getSimpleTableSegments() {\n         Collection<SimpleTableSegment> result = new LinkedList<>();\n-        for (TableSegment each : tables) {\n-            if (each instanceof SimpleTableSegment) {\n-                result.add((SimpleTableSegment) each);\n-            }\n+        for (TableReferenceSegment each: tableReferences) {\n+            result.addAll(each.getTables());\n         }\n         return result;\n     }\n"}}, {"oid": "a437951ef29ac8b78ea06c7a2b1cf5c5aedfc33e", "url": "https://github.com/apache/shardingsphere/commit/a437951ef29ac8b78ea06c7a2b1cf5c5aedfc33e", "message": "fix visitor of sql92", "committedDate": "2020-03-27T06:18:31Z", "type": "commit"}, {"oid": "900ca149b16a1603e641371ff781c846fef56238", "url": "https://github.com/apache/shardingsphere/commit/900ca149b16a1603e641371ff781c846fef56238", "message": "delete tables from SelectStatement", "committedDate": "2020-03-30T03:24:50Z", "type": "commit"}, {"oid": "8be941db2810de685e174b3eddce088d3c8f7c4d", "url": "https://github.com/apache/shardingsphere/commit/8be941db2810de685e174b3eddce088d3c8f7c4d", "message": "fix", "committedDate": "2020-03-30T03:53:01Z", "type": "commit"}, {"oid": "32b729b614e5ed1c44862a6c50244b92ccffd0e1", "url": "https://github.com/apache/shardingsphere/commit/32b729b614e5ed1c44862a6c50244b92ccffd0e1", "message": "fix", "committedDate": "2020-03-30T04:35:59Z", "type": "commit"}]}