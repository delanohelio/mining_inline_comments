{"pr_number": 8766, "pr_title": "fix #8696 and adjust 'set' grammar", "pr_createdAt": "2020-12-25T02:46:52Z", "pr_url": "https://github.com/apache/shardingsphere/pull/8766", "timeline": [{"oid": "f0ef79cfffeb486d5bcdb2e2701aed49ee280946", "url": "https://github.com/apache/shardingsphere/commit/f0ef79cfffeb486d5bcdb2e2701aed49ee280946", "message": "fix #8697", "committedDate": "2020-12-21T03:42:52Z", "type": "commit"}, {"oid": "3282e7822e560005434d177d1947da8b2207cd57", "url": "https://github.com/apache/shardingsphere/commit/3282e7822e560005434d177d1947da8b2207cd57", "message": "Merge remote-tracking branch 'upstream/master' into issue-8697", "committedDate": "2020-12-24T01:55:59Z", "type": "commit"}, {"oid": "6cc14c8fe04eaae0b22404955c3a2439754a5173", "url": "https://github.com/apache/shardingsphere/commit/6cc14c8fe04eaae0b22404955c3a2439754a5173", "message": "fix", "committedDate": "2020-12-24T06:17:00Z", "type": "commit"}, {"oid": "34f0ffe4af801b9662adb9ab899e5f1294b1ef3b", "url": "https://github.com/apache/shardingsphere/commit/34f0ffe4af801b9662adb9ab899e5f1294b1ef3b", "message": "fix issue#8697 and adjust 'set' grammar", "committedDate": "2020-12-25T02:16:46Z", "type": "commit"}, {"oid": "f09ca09a5ccc67ff970ed26e354241b7c778dc11", "url": "https://github.com/apache/shardingsphere/commit/f09ca09a5ccc67ff970ed26e354241b7c778dc11", "message": "merge upstream/master", "committedDate": "2020-12-25T02:30:18Z", "type": "commit"}, {"oid": "c191043a322aed47a17f8fee4bfe05fb535a7c32", "url": "https://github.com/apache/shardingsphere/commit/c191043a322aed47a17f8fee4bfe05fb535a7c32", "message": "fix", "committedDate": "2020-12-25T02:37:16Z", "type": "commit"}, {"oid": "2a4667e9452c71a79be782c5bdc57b1a9370e209", "url": "https://github.com/apache/shardingsphere/commit/2a4667e9452c71a79be782c5bdc57b1a9370e209", "message": "Update MySQLFormatSQLVisitor.java", "committedDate": "2020-12-25T02:48:09Z", "type": "commit"}, {"oid": "06ec76db701113478c9893f6ad1431756e71e62d", "url": "https://github.com/apache/shardingsphere/commit/06ec76db701113478c9893f6ad1431756e71e62d", "message": "Update MySQLDALStatementSQLVisitor.java", "committedDate": "2020-12-25T02:49:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgwMDcxNA==", "url": "https://github.com/apache/shardingsphere/pull/8766#discussion_r548800714", "bodyText": "Please do not change original indent", "author": "terrymanu", "createdAt": "2020-12-25T04:51:42Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/statement/impl/MySQLTCLStatementSQLVisitor.java", "diffHunk": "@@ -55,40 +53,30 @@ public MySQLTCLStatementSQLVisitor(final Properties props) {\n     @Override\n     public ASTNode visitSetTransaction(final SetTransactionContext ctx) {\n         MySQLSetTransactionStatement result = new MySQLSetTransactionStatement();\n-        if (null != ctx.scope()) {\n-            ScopeContext scopeContext = ctx.scope();\n-            if (null != scopeContext.GLOBAL()) {\n-                result.setScope(scopeContext.GLOBAL().getText());\n-            } else if (null != scopeContext.SESSION()) {\n-                result.setScope(scopeContext.SESSION().getText());\n-            }\n+        if (null != ctx.optionType()) {\n+            result.setScope(ctx.optionType().getText());\n         }\n-        if (null != ctx.transactionCharacteristic()) {\n-            for (TransactionCharacteristicContext each : ctx.transactionCharacteristic()) {\n-                if (null != each.level()) {\n-                    result.setIsolationLevel(each.level().getText());\n-                }\n-                if (null != each.accessMode()) {\n-                    result.setAccessMode(each.accessMode().getText());\n-                }\n-            }\n+        if (null != ctx.transactionCharacteristics().isolationLevel()) {\n+            result.setIsolationLevel(ctx.transactionCharacteristics().isolationLevel().isolationTypes().getText());\n+        }\n+        if (null != ctx.transactionCharacteristics().transactionAccessMode()) {\n+            result.setAccessMode(ctx.transactionCharacteristics().transactionAccessMode().getText());\n         }\n         return new MySQLSetTransactionStatement();\n     }\n     \n     @Override\n     public ASTNode visitSetAutoCommit(final SetAutoCommitContext ctx) {\n         MySQLSetAutoCommitStatement result = new MySQLSetAutoCommitStatement();\n-        result.setAutoCommit(((AutoCommitSegment) visit(ctx.autoCommitValue())).isAutoCommit());\n+        result.setAutoCommit(generateAutoCommitSegment(ctx.autoCommitValue).isAutoCommit());\n         return result;\n     }\n-    \n-    @Override\n-    public ASTNode visitAutoCommitValue(final AutoCommitValueContext ctx) {\n+\n+    private AutoCommitSegment generateAutoCommitSegment(final Token ctx) {\n         boolean autoCommit = \"1\".equals(ctx.getText()) || \"ON\".equals(ctx.getText());\n-        return new AutoCommitSegment(ctx.getStart().getStartIndex(), ctx.getStop().getStopIndex(), autoCommit);\n+        return new AutoCommitSegment(ctx.getStartIndex(), ctx.getStopIndex(), autoCommit);\n     }\n-    \n+", "originalCommit": "06ec76db701113478c9893f6ad1431756e71e62d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgwODIwNQ==", "url": "https://github.com/apache/shardingsphere/pull/8766#discussion_r548808205", "bodyText": "OK", "author": "jingshanglu", "createdAt": "2020-12-25T05:49:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODgwMDcxNA=="}], "type": "inlineReview", "revised_code": {"commit": "e9ed07c1b9668a2c7f7daa2f3531e23535d14bdd", "chunk": "diff --git a/shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/statement/impl/MySQLTCLStatementSQLVisitor.java b/shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/statement/impl/MySQLTCLStatementSQLVisitor.java\nindex 52723d70a5..549d7ce06d 100644\n--- a/shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/statement/impl/MySQLTCLStatementSQLVisitor.java\n+++ b/shardingsphere-sql-parser/shardingsphere-sql-parser-dialect/shardingsphere-sql-parser-mysql/src/main/java/org/apache/shardingsphere/sql/parser/mysql/visitor/statement/impl/MySQLTCLStatementSQLVisitor.java\n\n@@ -76,7 +76,7 @@ public final class MySQLTCLStatementSQLVisitor extends MySQLStatementSQLVisitor\n         boolean autoCommit = \"1\".equals(ctx.getText()) || \"ON\".equals(ctx.getText());\n         return new AutoCommitSegment(ctx.getStartIndex(), ctx.getStopIndex(), autoCommit);\n     }\n-\n+    \n     @Override\n     public ASTNode visitBeginTransaction(final BeginTransactionContext ctx) {\n         return new MySQLBeginTransactionStatement();\n"}}, {"oid": "e9ed07c1b9668a2c7f7daa2f3531e23535d14bdd", "url": "https://github.com/apache/shardingsphere/commit/e9ed07c1b9668a2c7f7daa2f3531e23535d14bdd", "message": "Update MySQLTCLStatementSQLVisitor.java", "committedDate": "2020-12-25T05:48:01Z", "type": "commit"}]}