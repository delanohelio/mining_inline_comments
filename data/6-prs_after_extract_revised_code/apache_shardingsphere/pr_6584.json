{"pr_number": 6584, "pr_title": "fix sqlException.getCause isNull", "pr_createdAt": "2020-08-03T06:04:21Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6584", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464211450", "bodyText": "When null == sqlException.getSQLState() , null == sqlException.getCause() but cause.getMessage() could run well, right?", "author": "tristaZero", "createdAt": "2020-08-03T06:10:19Z", "path": "shardingsphere-proxy/shardingsphere-proxy-frontend/shardingsphere-proxy-frontend-mysql/src/main/java/org/apache/shardingsphere/proxy/frontend/mysql/MySQLErrPacketFactory.java", "diffHunk": "@@ -47,7 +47,7 @@ public static MySQLErrPacket newInstance(final int sequenceId, final Exception c\n         if (cause instanceof SQLException) {\n             SQLException sqlException = (SQLException) cause;\n             return null != sqlException.getSQLState() ? new MySQLErrPacket(sequenceId, sqlException.getErrorCode(), sqlException.getSQLState(), sqlException.getMessage())\n-                : new MySQLErrPacket(sequenceId, MySQLServerErrorCode.ER_INTERNAL_ERROR, sqlException.getCause().getMessage());\n+                : new MySQLErrPacket(sequenceId, MySQLServerErrorCode.ER_INTERNAL_ERROR, cause.getMessage());", "originalCommit": "671d0bf7d20188fb14f52b42a38c7fbc33bad580", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI0NTM1Ng==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464245356", "bodyText": "already add the test code", "author": "cmonkey", "createdAt": "2020-08-03T07:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI3MTQxNA==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464271414", "bodyText": "Sorry, I did not catch you.\nWhich condition will make sqlException.getCause isNull ?", "author": "tristaZero", "createdAt": "2020-08-03T08:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc3NzIwMA==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464777200", "bodyText": "", "author": "cmonkey", "createdAt": "2020-08-04T03:28:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgyMDMzMg==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464820332", "bodyText": "@cmonkey Sorry?\nOr what's the difference between sqlException.getCause().getMessage() and cause.getMessage()?", "author": "tristaZero", "createdAt": "2020-08-04T06:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgzMzc5Mg==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464833792", "bodyText": "val exception = new SQLException()\nMySQLErrPacketFactory.newInstance(1, exception)\ncause.isInstanceOf[SQLException) is true\ncause.asInstanceOF[SQLException) to  sqlException\nsqlException.SQLState is null\nsqlException.cuase is not null\nsqlException.getCuase is null\nMySQLErrPacketFactory.newInstance throw NPE, write errorPacket failed, Connection is hung", "author": "cmonkey", "createdAt": "2020-08-04T06:45:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk4MjUxNA==", "url": "https://github.com/apache/shardingsphere/pull/6584#discussion_r464982514", "bodyText": "Hi @cmonkey Thanks for your explanation. Make sense to me.\nI will merge this PR after CI passes. Could you give travis-ci a look? I found it failed. Thanks a lot.", "author": "tristaZero", "createdAt": "2020-08-04T11:28:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDIxMTQ1MA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "0aa0d419bb769f9f860b63fa84574dcde5a66dee", "url": "https://github.com/apache/shardingsphere/commit/0aa0d419bb769f9f860b63fa84574dcde5a66dee", "message": "fix sqlException.getCause isNull", "committedDate": "2020-08-03T07:38:07Z", "type": "forcePushed"}, {"oid": "570425002269f46f4e969b4ca3128445834ba0d4", "url": "https://github.com/apache/shardingsphere/commit/570425002269f46f4e969b4ca3128445834ba0d4", "message": "fix sqlException.getCause isNull", "committedDate": "2020-08-04T07:03:15Z", "type": "forcePushed"}, {"oid": "07976529d6b80d86b53238b2c056f85e96b1be40", "url": "https://github.com/apache/shardingsphere/commit/07976529d6b80d86b53238b2c056f85e96b1be40", "message": "fix sqlException.getCause isNull", "committedDate": "2020-08-05T01:40:13Z", "type": "forcePushed"}, {"oid": "6c3d771ffa762b37d2b4e9f2bcadc146a8efbae2", "url": "https://github.com/apache/shardingsphere/commit/6c3d771ffa762b37d2b4e9f2bcadc146a8efbae2", "message": "fix sqlException.getCause isNull", "committedDate": "2020-08-05T07:08:14Z", "type": "commit"}, {"oid": "6c3d771ffa762b37d2b4e9f2bcadc146a8efbae2", "url": "https://github.com/apache/shardingsphere/commit/6c3d771ffa762b37d2b4e9f2bcadc146a8efbae2", "message": "fix sqlException.getCause isNull", "committedDate": "2020-08-05T07:08:14Z", "type": "forcePushed"}]}