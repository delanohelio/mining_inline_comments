{"pr_number": 6350, "pr_title": "support mysql insert select statement parse and add some test cases", "pr_createdAt": "2020-07-14T15:56:54Z", "pr_url": "https://github.com/apache/shardingsphere/pull/6350", "timeline": [{"oid": "7bae81326ba10b5557abd617cc7327293a55bc14", "url": "https://github.com/apache/shardingsphere/commit/7bae81326ba10b5557abd617cc7327293a55bc14", "message": "support mysql insert select statement parse and add some test cases", "committedDate": "2020-07-14T15:40:45Z", "type": "commit"}, {"oid": "1e2fb345d89836c0b994b70df530f1bd67c1268d", "url": "https://github.com/apache/shardingsphere/commit/1e2fb345d89836c0b994b70df530f1bd67c1268d", "message": "add apache license", "committedDate": "2020-07-14T15:44:58Z", "type": "commit"}, {"oid": "9ffa1243e959a501edfc0a0ddbbb648ed87ecccf", "url": "https://github.com/apache/shardingsphere/commit/9ffa1243e959a501edfc0a0ddbbb648ed87ecccf", "message": "modify test cases", "committedDate": "2020-07-14T16:19:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMDAxMQ==", "url": "https://github.com/apache/shardingsphere/pull/6350#discussion_r454810011", "bodyText": "Hi @strongduanmu\nThis PR looks clean and complete with many unit tests. Good job!\nBesides, here are some of my questions, waiting for your feedback.\n\nInsertSelectSegment and SelectSegment looks similar, do you think it is possible to remain either of them?\nThe existing class of SubquerySegment and new SelectSegment are alike somehow. Could you give them a look again?\nAre there any consequent PRs needed to complete this feature later?", "author": "tristaZero", "createdAt": "2020-07-15T05:58:24Z", "path": "shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dml/assignment/InsertSelectSegment.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.shardingsphere.sql.parser.sql.segment.dml.assignment;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import org.apache.shardingsphere.sql.parser.sql.segment.SQLSegment;\n+\n+/**\n+ * Insert select segment.\n+ */\n+@RequiredArgsConstructor\n+@Getter\n+public class InsertSelectSegment implements SQLSegment {", "originalCommit": "9ffa1243e959a501edfc0a0ddbbb648ed87ecccf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg1MTg0MA==", "url": "https://github.com/apache/shardingsphere/pull/6350#discussion_r454851840", "bodyText": "@tristaZero Thank you for your suggestion:\n\nInsertSelectSegment and SelectSegment should be able to be merged into one class. The two classes were originally designed to be consistent with the syntax rules in antlr.\nSelectSegment is created with reference to SubquerySegment. Is it misleading to use SubquerySegment because Select is not a subquery in the Insert Select statement?\nThe pr related to route and rewrite will be submitted later. In addition, subsequent pr will also contain replace select statement.", "author": "strongduanmu", "createdAt": "2020-07-15T07:35:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMDAxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "a784012ca519efa422408c91d90345be82a81031", "chunk": "diff --git a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dml/assignment/InsertSelectSegment.java b/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dml/assignment/InsertSelectSegment.java\ndeleted file mode 100644\nindex e55c48fe35..0000000000\n--- a/shardingsphere-sql-parser/shardingsphere-sql-parser-statement/src/main/java/org/apache/shardingsphere/sql/parser/sql/segment/dml/assignment/InsertSelectSegment.java\n+++ /dev/null\n\n@@ -1,36 +0,0 @@\n-/*\n- * Licensed to the Apache Software Foundation (ASF) under one or more\n- * contributor license agreements.  See the NOTICE file distributed with\n- * this work for additional information regarding copyright ownership.\n- * The ASF licenses this file to You under the Apache License, Version 2.0\n- * (the \"License\"); you may not use this file except in compliance with\n- * the License.  You may obtain a copy of the License at\n- *\n- *     http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software\n- * distributed under the License is distributed on an \"AS IS\" BASIS,\n- * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n- * See the License for the specific language governing permissions and\n- * limitations under the License.\n- */\n-\n-package org.apache.shardingsphere.sql.parser.sql.segment.dml.assignment;\n-\n-import lombok.Getter;\n-import lombok.RequiredArgsConstructor;\n-import org.apache.shardingsphere.sql.parser.sql.segment.SQLSegment;\n-\n-/**\n- * Insert select segment.\n- */\n-@RequiredArgsConstructor\n-@Getter\n-public class InsertSelectSegment implements SQLSegment {\n-    \n-    private final int startIndex;\n-    \n-    private final int stopIndex;\n-    \n-    private final SelectSegment select;\n-}\n"}}, {"oid": "a784012ca519efa422408c91d90345be82a81031", "url": "https://github.com/apache/shardingsphere/commit/a784012ca519efa422408c91d90345be82a81031", "message": "replace InsertSelectSegment and SelectSegment with SubquerySegment", "committedDate": "2020-07-15T12:10:49Z", "type": "commit"}]}