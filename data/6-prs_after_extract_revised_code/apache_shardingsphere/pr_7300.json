{"pr_number": 7300, "pr_title": "#6872, concurrent truncate", "pr_createdAt": "2020-09-07T13:59:30Z", "pr_url": "https://github.com/apache/shardingsphere/pull/7300", "timeline": [{"oid": "6dd0fbce2bf586e3c25846ddd6936c55f6a048c2", "url": "https://github.com/apache/shardingsphere/commit/6dd0fbce2bf586e3c25846ddd6936c55f6a048c2", "message": "#6872, concurrent truncate", "committedDate": "2020-09-07T13:58:24Z", "type": "commit"}, {"oid": "467ef9d321d315ca885870ab9998afb32ecd007d", "url": "https://github.com/apache/shardingsphere/commit/467ef9d321d315ca885870ab9998afb32ecd007d", "message": "#6872, refine", "committedDate": "2020-09-07T14:26:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ3NzA3Mw==", "url": "https://github.com/apache/shardingsphere/pull/7300#discussion_r484477073", "bodyText": "Please use LinkedList or use initial size for ArrayList", "author": "terrymanu", "createdAt": "2020-09-07T14:51:55Z", "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java", "diffHunk": "@@ -126,25 +132,18 @@ private void setParameters(final PreparedStatement preparedStatement, final SQLV\n     /**\n      * Clear data.\n      * \n-     * @throws SQLException SQL exception\n      */\n-    public void clear() throws SQLException {\n+    public void clear() {\n+        List<Callable<Boolean>> clearNodes = new ArrayList<>();", "originalCommit": "467ef9d321d315ca885870ab9998afb32ecd007d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "68831f27eb36cb05fc713186e5ef04f9c0e53c91", "chunk": "diff --git a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\nindex 69250589e1..1963116fea 100644\n--- a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n+++ b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n\n@@ -134,13 +134,13 @@ public final class DataSetEnvironmentManager {\n      * \n      */\n     public void clear() {\n-        List<Callable<Boolean>> clearNodes = new ArrayList<>();\n+        List<Callable<Boolean>> clearDatasources = new ArrayList<>();\n         for (Entry<String, Collection<String>> entry : getDataNodeMap().entrySet()) {\n             CallableClear callableClear = new CallableClear(dataSourceMap.get(entry.getKey()), entry.getValue());\n-            clearNodes.add(callableClear);\n+            clearDatasources.add(callableClear);\n         }\n         try {\n-            shardingSphereExecutorService.getExecutorService().invokeAll(clearNodes);\n+            shardingSphereExecutorService.getExecutorService().invokeAll(clearDatasources);\n             // CHECKSTYLE:OFF\n         } catch (final Exception ex) {\n             // CHECKSTYLE:ON\n"}}, {"oid": "68831f27eb36cb05fc713186e5ef04f9c0e53c91", "url": "https://github.com/apache/shardingsphere/commit/68831f27eb36cb05fc713186e5ef04f9c0e53c91", "message": "#6872, for comments", "committedDate": "2020-09-07T14:59:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4MjUzOQ==", "url": "https://github.com/apache/shardingsphere/pull/7300#discussion_r484482539", "bodyText": "It is better to rename CallableClear to ClearTask", "author": "terrymanu", "createdAt": "2020-09-07T15:03:17Z", "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java", "diffHunk": "@@ -187,4 +186,25 @@ private String generateTableName(final String tableName, final DatabaseType data\n                 throw new UnsupportedOperationException(String.format(\"Cannot support database [%s].\", databaseType));\n         }\n     }\n+    \n+    @RequiredArgsConstructor\n+    private static class CallableClear implements Callable<Boolean> {", "originalCommit": "467ef9d321d315ca885870ab9998afb32ecd007d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0648fa9beed23b911aaec20a6888e454257de2f", "chunk": "diff --git a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\nindex 69250589e1..a5cab8f9f6 100644\n--- a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n+++ b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n\n@@ -188,14 +188,14 @@ public final class DataSetEnvironmentManager {\n     }\n     \n     @RequiredArgsConstructor\n-    private static class CallableClear implements Callable<Boolean> {\n+    private static class CallableClear implements Callable<Void> {\n         \n         private final DataSource dataSource;\n         \n         private final Collection<String> tableNames;\n         \n         @Override\n-        public Boolean call() throws SQLException {\n+        public Void call() throws SQLException {\n             try (Connection connection = dataSource.getConnection()) {\n                 for (String each : tableNames) {\n                     String tableName = generateTableName(each, DatabaseTypes.getDatabaseTypeByURL(connection.getMetaData().getURL()));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4MjgwMQ==", "url": "https://github.com/apache/shardingsphere/pull/7300#discussion_r484482801", "bodyText": "new CallableClear can be inline into clearNodes.add", "author": "terrymanu", "createdAt": "2020-09-07T15:03:54Z", "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java", "diffHunk": "@@ -126,25 +132,18 @@ private void setParameters(final PreparedStatement preparedStatement, final SQLV\n     /**\n      * Clear data.\n      * \n-     * @throws SQLException SQL exception\n      */\n-    public void clear() throws SQLException {\n+    public void clear() {\n+        List<Callable<Boolean>> clearNodes = new ArrayList<>();\n         for (Entry<String, Collection<String>> entry : getDataNodeMap().entrySet()) {\n-            clear(entry.getKey(), entry.getValue());\n+            CallableClear callableClear = new CallableClear(dataSourceMap.get(entry.getKey()), entry.getValue());\n+            clearNodes.add(callableClear);", "originalCommit": "467ef9d321d315ca885870ab9998afb32ecd007d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0648fa9beed23b911aaec20a6888e454257de2f", "chunk": "diff --git a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\nindex 69250589e1..a5cab8f9f6 100644\n--- a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n+++ b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n\n@@ -134,13 +134,13 @@ public final class DataSetEnvironmentManager {\n      * \n      */\n     public void clear() {\n-        List<Callable<Boolean>> clearNodes = new ArrayList<>();\n+        List<Callable<Void>> clearDatasources = new ArrayList<>();\n         for (Entry<String, Collection<String>> entry : getDataNodeMap().entrySet()) {\n             CallableClear callableClear = new CallableClear(dataSourceMap.get(entry.getKey()), entry.getValue());\n-            clearNodes.add(callableClear);\n+            clearDatasources.add(callableClear);\n         }\n         try {\n-            shardingSphereExecutorService.getExecutorService().invokeAll(clearNodes);\n+            shardingSphereExecutorService.getExecutorService().invokeAll(clearDatasources);\n             // CHECKSTYLE:OFF\n         } catch (final Exception ex) {\n             // CHECKSTYLE:ON\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4Mjk4NQ==", "url": "https://github.com/apache/shardingsphere/pull/7300#discussion_r484482985", "bodyText": "It is better to rename clearNodes to clearTasks", "author": "terrymanu", "createdAt": "2020-09-07T15:04:25Z", "path": "shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java", "diffHunk": "@@ -126,25 +132,18 @@ private void setParameters(final PreparedStatement preparedStatement, final SQLV\n     /**\n      * Clear data.\n      * \n-     * @throws SQLException SQL exception\n      */\n-    public void clear() throws SQLException {\n+    public void clear() {\n+        List<Callable<Boolean>> clearNodes = new ArrayList<>();", "originalCommit": "467ef9d321d315ca885870ab9998afb32ecd007d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f0648fa9beed23b911aaec20a6888e454257de2f", "chunk": "diff --git a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\nindex 69250589e1..a5cab8f9f6 100644\n--- a/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n+++ b/shardingsphere-integration-test/shardingsphere-test-suite/src/test/java/org/apache/shardingsphere/dbtest/env/dataset/DataSetEnvironmentManager.java\n\n@@ -134,13 +134,13 @@ public final class DataSetEnvironmentManager {\n      * \n      */\n     public void clear() {\n-        List<Callable<Boolean>> clearNodes = new ArrayList<>();\n+        List<Callable<Void>> clearDatasources = new ArrayList<>();\n         for (Entry<String, Collection<String>> entry : getDataNodeMap().entrySet()) {\n             CallableClear callableClear = new CallableClear(dataSourceMap.get(entry.getKey()), entry.getValue());\n-            clearNodes.add(callableClear);\n+            clearDatasources.add(callableClear);\n         }\n         try {\n-            shardingSphereExecutorService.getExecutorService().invokeAll(clearNodes);\n+            shardingSphereExecutorService.getExecutorService().invokeAll(clearDatasources);\n             // CHECKSTYLE:OFF\n         } catch (final Exception ex) {\n             // CHECKSTYLE:ON\n"}}, {"oid": "f0648fa9beed23b911aaec20a6888e454257de2f", "url": "https://github.com/apache/shardingsphere/commit/f0648fa9beed23b911aaec20a6888e454257de2f", "message": "#6872, for comments", "committedDate": "2020-09-07T15:10:26Z", "type": "commit"}, {"oid": "481c2c7c4f9f99ee7a1bf19d09a0729779e6f8ab", "url": "https://github.com/apache/shardingsphere/commit/481c2c7c4f9f99ee7a1bf19d09a0729779e6f8ab", "message": "#6872, for comments", "committedDate": "2020-09-07T15:13:27Z", "type": "commit"}, {"oid": "1885ba16160687a08cdb677aa0fbd263ae321dbf", "url": "https://github.com/apache/shardingsphere/commit/1885ba16160687a08cdb677aa0fbd263ae321dbf", "message": "#6872, for comments", "committedDate": "2020-09-07T15:16:00Z", "type": "commit"}, {"oid": "64415e494c7ab338771d109602a96da749f096ff", "url": "https://github.com/apache/shardingsphere/commit/64415e494c7ab338771d109602a96da749f096ff", "message": "#6872, for comments", "committedDate": "2020-09-07T15:19:13Z", "type": "commit"}]}