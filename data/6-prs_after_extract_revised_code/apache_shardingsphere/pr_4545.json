{"pr_number": 4545, "pr_title": "Issue2010", "pr_createdAt": "2020-03-01T15:22:43Z", "pr_url": "https://github.com/apache/shardingsphere/pull/4545", "timeline": [{"oid": "5fe8470b4abfe788728eb4dc596c540acea500eb", "url": "https://github.com/apache/shardingsphere/commit/5fe8470b4abfe788728eb4dc596c540acea500eb", "message": "for#2010, support connectionInitSqls config for druid", "committedDate": "2020-02-28T11:35:14Z", "type": "commit"}, {"oid": "23ec332dc3632e324aac4bf5537a01a0fb193df1", "url": "https://github.com/apache/shardingsphere/commit/23ec332dc3632e324aac4bf5537a01a0fb193df1", "message": "Merge remote-tracking branch 'origin/master' into issue2010", "committedDate": "2020-03-01T14:26:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE2NTgwMg==", "url": "https://github.com/apache/shardingsphere/pull/4545#discussion_r386165802", "bodyText": "Here is an integration test.\nI suggestion:\n\nif do this way, it's neccesary to use HikariDataSource instead of BasicDatasource.\ncreat a table in h2 db, and set an insert sql to initSql, then check it work well by a select and compare.\n\nOr another approach:\njust mock a jdbc driver behind HikariDataSource, check hikariDataSource send the initSql to mock jdbc connection/statement.", "author": "kimmking", "createdAt": "2020-03-02T01:39:06Z", "path": "shardingsphere-underlying/shardingsphere-common/src/test/java/org/apache/shardingsphere/underlying/common/config/DataSourceConfigurationTest.java", "diffHunk": "@@ -83,4 +88,25 @@ public void assertAddAlias() {\n         assertThat(actual.getProperties().get(\"jdbcUrl\"), is(actual.getProperties().get(\"url\")));\n         assertThat(actual.getProperties().get(\"username\"), is(actual.getProperties().get(\"user\")));\n     }\n+    \n+    @Test\n+    public void assertGetDataSourceConfigurationWithConnectionInitSqls() throws SQLException {", "originalCommit": "23ec332dc3632e324aac4bf5537a01a0fb193df1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM0MzA3Ng==", "url": "https://github.com/apache/shardingsphere/pull/4545#discussion_r386343076", "bodyText": "connectionInitSqls in HikariDataSource is a String type, but we want to verify a collection type for this issue. also I found that collection type property not existed in in HikariDataSource, it seems that DBCP2 is ok for that", "author": "cherrylzhao", "createdAt": "2020-03-02T11:38:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE2NTgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgyNzg5OQ==", "url": "https://github.com/apache/shardingsphere/pull/4545#discussion_r386827899", "bodyText": "connectionInitSqls in HikariDataSource is a String type, but we want to verify a collection type for this issue. also I found that collection type property not existed in in HikariDataSource, it seems that DBCP2 is ok for that\n\n@kimmking @cherrylzhao In HikariDataSource, the configuratoin is connectionInitSql, and it is a String type, i also veryfied HikariDataSource , it's ok. DBCP2 and Druid support Connection type,  the only difference is the return parameter of getConnectionInitsqls method, DBCP2 return List type, Druid return Connection type, I have done compatibility processing in the pr.", "author": "menghaoranss", "createdAt": "2020-03-03T06:54:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE2NTgwMg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "ea13cacaf3c7ba64564d30a1fad7e6c9f6b67c27", "url": "https://github.com/apache/shardingsphere/commit/ea13cacaf3c7ba64564d30a1fad7e6c9f6b67c27", "message": "Merge branch 'master' into issue2010", "committedDate": "2020-03-05T07:12:36Z", "type": "commit"}, {"oid": "4e69c4695bb93371dda821c1e2578ac8051b5a44", "url": "https://github.com/apache/shardingsphere/commit/4e69c4695bb93371dda821c1e2578ac8051b5a44", "message": "Merge remote-tracking branch 'origin/master' into issue2010", "committedDate": "2020-03-05T07:27:01Z", "type": "commit"}, {"oid": "d2fcdb304dc165b64fc7ddd96e0396c959af3699", "url": "https://github.com/apache/shardingsphere/commit/d2fcdb304dc165b64fc7ddd96e0396c959af3699", "message": "Merge remote-tracking branch 'origin/issue2010' into issue2010", "committedDate": "2020-03-05T07:27:37Z", "type": "commit"}]}