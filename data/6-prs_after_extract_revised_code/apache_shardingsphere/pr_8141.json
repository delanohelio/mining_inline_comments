{"pr_number": 8141, "pr_title": "Use mock to instead of TestShardingRule and TestTableRule in DataNodesTest class", "pr_createdAt": "2020-11-12T01:45:37Z", "pr_url": "https://github.com/apache/shardingsphere/pull/8141", "timeline": [{"oid": "639dbf6d2f22a885f7257838bc703fd9bedebac4", "url": "https://github.com/apache/shardingsphere/commit/639dbf6d2f22a885f7257838bc703fd9bedebac4", "message": "Improve mysql Call Statement definition and Visitor #7791", "committedDate": "2020-11-06T00:57:08Z", "type": "commit"}, {"oid": "c7f401c3b1e8134509acf0f9fd0e3e7f4b06be43", "url": "https://github.com/apache/shardingsphere/commit/c7f401c3b1e8134509acf0f9fd0e3e7f4b06be43", "message": "Improve mysql Call Statement definition and Visitor #7791", "committedDate": "2020-11-06T01:16:22Z", "type": "commit"}, {"oid": "1748ebc730f9d1fbe187433cc30adbcc26588824", "url": "https://github.com/apache/shardingsphere/commit/1748ebc730f9d1fbe187433cc30adbcc26588824", "message": "Improve mysql Call Statement definition and Visitor #7791", "committedDate": "2020-11-06T01:21:32Z", "type": "commit"}, {"oid": "5fa9b9aa3c5e482759bf1bb4d2080a91a46d50d0", "url": "https://github.com/apache/shardingsphere/commit/5fa9b9aa3c5e482759bf1bb4d2080a91a46d50d0", "message": "Improve mysql Call Statement definition and Visitor #7791", "committedDate": "2020-11-06T01:59:00Z", "type": "commit"}, {"oid": "56cb245fdb53bda42336666b3a31ebcf6c066c48", "url": "https://github.com/apache/shardingsphere/commit/56cb245fdb53bda42336666b3a31ebcf6c066c48", "message": "Merge branch 'master' of https://github.com/apache/shardingsphere into 7791", "committedDate": "2020-11-12T00:57:37Z", "type": "commit"}, {"oid": "bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8", "url": "https://github.com/apache/shardingsphere/commit/bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8", "message": "Use mock to instead of TestShardingRule and TestTableRule in DataNodesTest class", "committedDate": "2020-11-12T01:42:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjgxMTYzMg==", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r522811632", "bodyText": "keep four blank.", "author": "kimmking", "createdAt": "2020-11-13T08:57:02Z", "path": "shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java", "diffHunk": "@@ -40,59 +39,60 @@\n import static org.mockito.Mockito.when;\n \n public final class DataNodesTest {\n-    ", "originalCommit": "bd5e1aeadaa834346612c3e4dc2e8ca7ba2340f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef2a176893a8b4d4beab76d611570b95954fdc18", "chunk": "diff --git a/shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java b/shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java\nindex ab8dd8d814..8e3d126d3e 100644\n--- a/shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java\n+++ b/shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java\n\n@@ -32,51 +37,45 @@ import java.util.List;\n import java.util.Map;\n import java.util.stream.Collectors;\n \n-import static org.hamcrest.CoreMatchers.is;\n-import static org.junit.Assert.assertThat;\n-import static org.junit.Assert.assertTrue;\n-import static org.mockito.Mockito.mock;\n-import static org.mockito.Mockito.when;\n-\n public final class DataNodesTest {\n-\n+    \n     private final String logicTableName1 = \"user\";\n-\n+    \n     private final String logicTableName2 = \"dept\";\n-\n+    \n     private final Collection<String> dataSourceNames1 = Arrays.asList(\"primary_db_1\", \"primary_db_2\", \"replica_db_1\", \"replica_db_2\");\n-\n+    \n     private final Collection<String> dataSourceNames2 = Arrays.asList(\"primary_db_3\", \"replica_db_3\");\n-\n+    \n     private final String logicDataSourceName = \"primary_db_1\";\n-\n+    \n     private final Collection<String> replicaDataSourceNames = Arrays.asList(\"route_db_1\", \"route_db_2\");\n-\n+    \n     @Test(expected = NullPointerException.class)\n     public void assertWrongTable() {\n         DataNodes dataNodes = getRoutedRuleDataNodes();\n         dataNodes.getDataNodes(\"wrongTableName\");\n     }\n-\n+    \n     @Test\n     public void assertGetEmpty() {\n         assertThat(getNonRoutedRuleDataNodes().getDataNodes(\"tableName\"), is(Collections.emptyList()));\n     }\n-\n+    \n     @Test\n     public void assertGetDataNodes() {\n         DataNodes dataNodes = getRoutedRuleDataNodes();\n         assertTrue(dataNodes.getDataNodes(logicTableName1).containsAll(getExpectedDataNodes(dataSourceNames1, logicTableName1)));\n         assertTrue(dataNodes.getDataNodes(logicTableName2).containsAll(getExpectedDataNodes(dataSourceNames2, logicTableName2)));\n     }\n-\n+    \n     @Test\n     public void assertGetDataNodeGroups() {\n         DataNodes dataNodes = getRoutedRuleDataNodes();\n         assertThat(dataNodes.getDataNodeGroups(logicTableName1), is(getExpectedDataNodeGroups(dataSourceNames1, logicTableName1)));\n         assertThat(dataNodes.getDataNodeGroups(logicTableName2), is(getExpectedDataNodeGroups(dataSourceNames2, logicTableName2)));\n     }\n-\n+    \n     private DataNodes getRoutedRuleDataNodes() {\n         Map<String, Collection<DataNode>> nodeMap = new HashMap<>();\n         nodeMap.put(logicTableName1, getExpectedDataNodes(dataSourceNames1, logicTableName1));\n"}}, {"oid": "ef2a176893a8b4d4beab76d611570b95954fdc18", "url": "https://github.com/apache/shardingsphere/commit/ef2a176893a8b4d4beab76d611570b95954fdc18", "message": "format-add four blank at empty line", "committedDate": "2020-11-13T09:58:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzI2Ng==", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r523883266", "bodyText": "Hi @wenweibin\nDo you think TestShardingSphereRule is no longer needed? If so, please delete them. Thanks.", "author": "tristaZero", "createdAt": "2020-11-16T03:36:40Z", "path": "shardingsphere-infra/shardingsphere-infra-common/src/test/java/org/apache/shardingsphere/infra/rule/DataNodesTest.java", "diffHunk": "@@ -79,18 +77,19 @@ public void assertGetDataNodeGroups() {\n     }\n     \n     private DataNodes getRoutedRuleDataNodes() {\n-        TestTableRule tableRule1 = new TestTableRule(dataSourceNames1, logicTableName1);\n-        TestTableRule tableRule2 = new TestTableRule(dataSourceNames2, logicTableName2);\n-        List<TestTableRule> tableRules = Arrays.asList(tableRule1, tableRule2);\n-        ShardingSphereRule rule1 = new TestShardingRule(tableRules);\n+        Map<String, Collection<DataNode>> nodeMap = new HashMap<>();\n+        nodeMap.put(logicTableName1, getExpectedDataNodes(dataSourceNames1, logicTableName1));\n+        nodeMap.put(logicTableName2, getExpectedDataNodes(dataSourceNames2, logicTableName2));\n+        DataNodeContainedRule rule1 = mock(DataNodeContainedRule.class);\n+        when(rule1.getAllDataNodes()).thenReturn(nodeMap);\n         Map<String, Collection<String>> dataSourceMapper = Collections.singletonMap(logicDataSourceName, replicaDataSourceNames);\n         DataSourceContainedRule rule2 = mock(DataSourceContainedRule.class);\n         when(rule2.getDataSourceMapper()).thenReturn(dataSourceMapper);\n         return new DataNodes(Arrays.asList(rule1, rule2));\n     }\n     \n     private DataNodes getNonRoutedRuleDataNodes() {\n-        return new DataNodes(Collections.singleton(new TestShardingSphereRule()));", "originalCommit": "ef2a176893a8b4d4beab76d611570b95954fdc18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3NzcwNQ==", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r524277705", "bodyText": "Yes.I will delete them.", "author": "wenweibin", "createdAt": "2020-11-16T13:46:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgyOTUyMA==", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r524829520", "bodyText": "You will remove them in the next PR, won't you?", "author": "tristaZero", "createdAt": "2020-11-17T01:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzI2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAwODI0Nw==", "url": "https://github.com/apache/shardingsphere/pull/8141#discussion_r525008247", "bodyText": "OK.I will finish it in next pr.", "author": "wenweibin", "createdAt": "2020-11-17T09:31:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzg4MzI2Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "999e1c92245d31841c8dd7bc8fac9db4bcaa20e0", "url": "https://github.com/apache/shardingsphere/commit/999e1c92245d31841c8dd7bc8fac9db4bcaa20e0", "message": "Merge branch 'master' of https://github.com/apache/shardingsphere into 8067", "committedDate": "2020-11-18T09:41:42Z", "type": "commit"}, {"oid": "ce49f0baa21146e62c9715bb105b328e4d8259ee", "url": "https://github.com/apache/shardingsphere/commit/ce49f0baa21146e62c9715bb105b328e4d8259ee", "message": "delete unused TestShardingRule.java and TestTableRule.java file", "committedDate": "2020-11-18T09:47:36Z", "type": "commit"}]}