{"pr_number": 1312, "pr_title": "Relax access for class members and add getters/setters", "pr_createdAt": "2020-08-20T00:59:53Z", "pr_url": "https://github.com/apache/tinkerpop/pull/1312", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA0OTUyMw==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r474049523", "bodyText": "We had originally made many of the steps final in the early days of TinkerPop 3.x to prevent extension by providers as they were changing frequently and we wanted to be able to introduce changes without worrying about breaking APIs. I'd imagine that most of the steps have largely stabilized at this point so perhaps that worry is no longer as much of a concern.  However, I still feel like these core step classes are TinkerPop's implementations and I'd not want to see our development blocked for fear of a breaking API change that affects providers (a behavioral change is different as it affects users and we would obviously be sensitive to that).\nPerhaps it would be good to start a DISCUSS thread on this on the dev list to see if there is any concerns with removing final for all steps with the idea that breaking API changes become a possibility for providers on patch releases if they choose to directly extend these core step classes. wdyt?", "author": "spmallette", "createdAt": "2020-08-20T14:59:25Z", "path": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupCountStep.java", "diffHunk": "@@ -41,7 +41,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public final class GroupCountStep<S, E> extends ReducingBarrierStep<S, Map<E, Long>> implements TraversalParent, ByModulating {\n+public class GroupCountStep<S, E> extends ReducingBarrierStep<S, Map<E, Long>> implements TraversalParent, ByModulating {", "originalCommit": "e1a3f71f8b2230c0b7d142e33f5ff57151750892", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3MTIyNw==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483271227", "bodyText": "Let me change the scope of this PR to only change visibility of certain members. We can pick up removing the final keyword after a discussion in email list.", "author": "divijvaidya", "createdAt": "2020-09-03T21:46:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA0OTUyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5Nzk2OQ==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483297969", "bodyText": "Resolving this comment since I removed the file being discussed from the scope of this PR.", "author": "divijvaidya", "createdAt": "2020-09-03T23:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA0OTUyMw=="}], "type": "inlineReview", "revised_code": {"commit": "865e01a1e69685dc10c9e6babbb955f5db6fff08", "chunk": "diff --git a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupCountStep.java b/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupCountStep.java\nindex 7482fda0cf..a0c02fd447 100644\n--- a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupCountStep.java\n+++ b/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/step/map/GroupCountStep.java\n\n@@ -41,7 +41,7 @@ import java.util.function.BinaryOperator;\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class GroupCountStep<S, E> extends ReducingBarrierStep<S, Map<E, Long>> implements TraversalParent, ByModulating {\n+public final class GroupCountStep<S, E> extends ReducingBarrierStep<S, Map<E, Long>> implements TraversalParent, ByModulating {\n \n     private Traversal.Admin<S, E> keyTraversal = null;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1NDYxMw==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r474054613", "bodyText": "what is the intent of this change? i don't know what folks might do with that, but \"unlocking\" a traversal might open up bad/unexpected things for users....", "author": "spmallette", "createdAt": "2020-08-20T15:05:20Z", "path": "gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java", "diffHunk": "@@ -350,6 +351,10 @@ public void setGraph(final Graph graph) {\n         this.graph = graph;\n     }\n \n+    public void setLocked(boolean locked) {", "originalCommit": "e1a3f71f8b2230c0b7d142e33f5ff57151750892", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3NzM4OA==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483277388", "bodyText": "It's a separate conversation. I will soon raise a PR for that. I think that the way in which we apply strategies (first to all steps and then to each children one at a time), could be improved to apply all strategies at the same time to the entire traversal and sub-traversal. I will remove this change from this PR, pending further discussion on a new PR.", "author": "divijvaidya", "createdAt": "2020-09-03T22:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1NDYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI5ODEwNA==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483298104", "bodyText": "Resolving this comment since I removed the file being discussed from the scope of this PR.", "author": "divijvaidya", "createdAt": "2020-09-03T23:04:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1NDYxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMyNzY1NQ==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483327655", "bodyText": "note that strategy application changed/improved on master for 3.5.0 already:\nhttps://tinkerpop.apache.org/docs/3.5.0-SNAPSHOT/upgrade/#_traversalstrategy_application\nlooking forward to hearing what you think we might change but we will need to be careful not to introduce a change that inadvertently changes traversal behavior because we change strategy application order/approach. that's why we saved the above referenced change for 3.5.0.", "author": "spmallette", "createdAt": "2020-09-04T00:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1NDYxMw=="}], "type": "inlineReview", "revised_code": {"commit": "865e01a1e69685dc10c9e6babbb955f5db6fff08", "chunk": "diff --git a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java b/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java\nindex 87a7490c62..87c585af70 100644\n--- a/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java\n+++ b/gremlin-core/src/main/java/org/apache/tinkerpop/gremlin/process/traversal/util/DefaultTraversal.java\n\n@@ -351,10 +348,6 @@ public class DefaultTraversal<S, E> implements Traversal.Admin<S, E> {\n         this.graph = graph;\n     }\n \n-    public void setLocked(boolean locked) {\n-        this.locked = locked;\n-    }\n-\n     @Override\n     public boolean equals(final Object other) {\n         return other != null && other.getClass().equals(this.getClass()) && this.equals(((Traversal.Admin) other));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1OTAwMg==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r474059002", "bodyText": "Could you please talk about the cases where folks would extend TinkerVertex (or TinkerGraph more generally)? We have one very specific one with https://github.com/ShiftLeftSecurity/tinkergraph-gremlin but i'm not sure that's relevant anymore with its successor in https://github.com/ShiftLeftSecurity/overflowdb", "author": "spmallette", "createdAt": "2020-08-20T15:11:46Z", "path": "tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerVertex.java", "diffHunk": "@@ -40,7 +40,7 @@\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public final class TinkerVertex extends TinkerElement implements Vertex {", "originalCommit": "e1a3f71f8b2230c0b7d142e33f5ff57151750892", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzI3NjgwMQ==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r483276801", "bodyText": "It could be extended by vendors to create a custom testing suite OR it could be used by vendors to build a TinkerGraph++ offering. IMO, we should probably relax the final requirement on classes unless it is necessary or has some specific purpose.", "author": "divijvaidya", "createdAt": "2020-09-03T22:00:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1OTAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1NDM3OA==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r502054378", "bodyText": "I just sorta realized this issue is still hanging around here without any added reply. I did start a discussion on this on dev and didn't really get objections but I'd prefer to do this particular TinkerGraph change around a JIRA (with a bit more thought as to the repercussions. If you just back out this one change then the rest of this is good to merge from my perspective. If you agree I will create a JIRA for the TinkerGraph issue. wdyt?", "author": "spmallette", "createdAt": "2020-10-08T22:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1OTAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA1ODUzMg==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r502058532", "bodyText": "Sure. I will move the TinkerGraph out of the scope of this PR as well so that things become simpler.", "author": "divijvaidya", "createdAt": "2020-10-08T22:57:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1OTAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcwMzMxMg==", "url": "https://github.com/apache/tinkerpop/pull/1312#discussion_r508703312", "bodyText": "I have removed changes in TinkerGraph from this PR and this is ready for review.", "author": "divijvaidya", "createdAt": "2020-10-20T17:17:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDA1OTAwMg=="}], "type": "inlineReview", "revised_code": {"commit": "7ecfd04541e2898e220e62406ea4493be50ac4da", "chunk": "diff --git a/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerVertex.java b/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerVertex.java\nindex 60192532d8..be08137776 100644\n--- a/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerVertex.java\n+++ b/tinkergraph-gremlin/src/main/java/org/apache/tinkerpop/gremlin/tinkergraph/structure/TinkerVertex.java\n\n@@ -40,7 +40,7 @@ import java.util.stream.Collectors;\n /**\n  * @author Marko A. Rodriguez (http://markorodriguez.com)\n  */\n-public class TinkerVertex extends TinkerElement implements Vertex {\n+public final class TinkerVertex extends TinkerElement implements Vertex {\n \n     protected Map<String, List<VertexProperty>> properties;\n     protected Map<String, Set<Edge>> outEdges;\n"}}, {"oid": "865e01a1e69685dc10c9e6babbb955f5db6fff08", "url": "https://github.com/apache/tinkerpop/commit/865e01a1e69685dc10c9e6babbb955f5db6fff08", "message": "Make TinkerVertex non-final", "committedDate": "2020-10-19T23:36:06Z", "type": "commit"}, {"oid": "5b9a8124061664ce4aa714ced2e900d1dfcd16cf", "url": "https://github.com/apache/tinkerpop/commit/5b9a8124061664ce4aa714ced2e900d1dfcd16cf", "message": "Make AbstractGremlinTest.verifyUniqueStepIds public", "committedDate": "2020-10-19T23:36:06Z", "type": "commit"}, {"oid": "c5b88a508f8b6602c762648cda32885b80e69e8a", "url": "https://github.com/apache/tinkerpop/commit/c5b88a508f8b6602c762648cda32885b80e69e8a", "message": "add setters/getters for extensibility of steps", "committedDate": "2020-10-19T23:37:21Z", "type": "commit"}, {"oid": "8fdb829bc1acb98576829ff0bc47eca8cbc76988", "url": "https://github.com/apache/tinkerpop/commit/8fdb829bc1acb98576829ff0bc47eca8cbc76988", "message": "Do not remove final from steps", "committedDate": "2020-10-19T23:37:21Z", "type": "commit"}, {"oid": "7ecfd04541e2898e220e62406ea4493be50ac4da", "url": "https://github.com/apache/tinkerpop/commit/7ecfd04541e2898e220e62406ea4493be50ac4da", "message": "Don't make TinkerVertex non final", "committedDate": "2020-10-19T23:38:33Z", "type": "commit"}, {"oid": "7ecfd04541e2898e220e62406ea4493be50ac4da", "url": "https://github.com/apache/tinkerpop/commit/7ecfd04541e2898e220e62406ea4493be50ac4da", "message": "Don't make TinkerVertex non final", "committedDate": "2020-10-19T23:38:33Z", "type": "forcePushed"}]}