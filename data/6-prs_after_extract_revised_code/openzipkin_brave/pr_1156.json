{"pr_number": 1156, "pr_title": "Adds trace IDs to MutableSpan", "pr_createdAt": "2020-04-13T09:28:33Z", "pr_url": "https://github.com/openzipkin/brave/pull/1156", "timeline": [{"oid": "10ca16dca27fd3fdb00c8bc8b5cc5676619d84d9", "url": "https://github.com/openzipkin/brave/commit/10ca16dca27fd3fdb00c8bc8b5cc5676619d84d9", "message": "Adds trace IDs to MutableSpan\n\nThis allows features only possible prior with zipkin model:\n* re-parenting span to the local root (skeletal spans)\n* resetting trace ID to an external one (secondary sampling)\n\nOne simplifying change is that this only tracks empty span allocation\nwhen `Tracing.Builder.trackOrphans()` is set. This is because we no\nlonger have an accidental way of creating them with\n`Tracer.currentSpan()`", "committedDate": "2020-04-13T09:25:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwNjQ5Nw==", "url": "https://github.com/openzipkin/brave/pull/1156#discussion_r407406497", "bodyText": "Missing localRootId", "author": "anuraaga", "createdAt": "2020-04-13T09:53:05Z", "path": "brave/src/main/java/brave/handler/MutableSpan.java", "diffHunk": "@@ -90,6 +91,9 @@ public MutableSpan() {\n   /** @since 5.12 */\n   public MutableSpan(MutableSpan toCopy) {\n     if (toCopy == null) throw new NullPointerException(\"toCopy == null\");\n+    traceId = toCopy.traceId;\n+    parentId = toCopy.parentId;", "originalCommit": "10ca16dca27fd3fdb00c8bc8b5cc5676619d84d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzgwMTk1OA==", "url": "https://github.com/openzipkin/brave/pull/1156#discussion_r407801958", "bodyText": "ooohh I can use the copy constructor in the existing tests! thanks for the keen eye meanwhile!", "author": "codefromthecrypt", "createdAt": "2020-04-14T00:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQwNjQ5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "9cf9e7efe590d335883e433a72d42152662ab11e", "chunk": "diff --git a/brave/src/main/java/brave/handler/MutableSpan.java b/brave/src/main/java/brave/handler/MutableSpan.java\nindex 55886933e..91768a2ea 100644\n--- a/brave/src/main/java/brave/handler/MutableSpan.java\n+++ b/brave/src/main/java/brave/handler/MutableSpan.java\n\n@@ -92,6 +92,7 @@ public final class MutableSpan implements Cloneable {\n   public MutableSpan(MutableSpan toCopy) {\n     if (toCopy == null) throw new NullPointerException(\"toCopy == null\");\n     traceId = toCopy.traceId;\n+    localRootId = toCopy.localRootId;\n     parentId = toCopy.parentId;\n     id = toCopy.id;\n     kind = toCopy.kind;\n"}}, {"oid": "9cf9e7efe590d335883e433a72d42152662ab11e", "url": "https://github.com/openzipkin/brave/commit/9cf9e7efe590d335883e433a72d42152662ab11e", "message": "polish and misc fixies", "committedDate": "2020-04-14T02:11:17Z", "type": "commit"}]}