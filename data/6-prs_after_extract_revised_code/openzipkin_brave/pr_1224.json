{"pr_number": 1224, "pr_title": "Adds MessagingRequest.messageId", "pr_createdAt": "2020-06-01T04:06:01Z", "pr_url": "https://github.com/openzipkin/brave/pull/1224", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MDAyNA==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433040024", "bodyText": "Curious when this could be set - if the MQ is run in-process?", "author": "anuraaga", "createdAt": "2020-06-01T04:50:28Z", "path": "instrumentation/messaging/src/main/java/brave/messaging/MessagingResponse.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2013-2020 The OpenZipkin Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package brave.messaging;\n+\n+import brave.Response;\n+import brave.internal.Nullable;\n+\n+/**\n+ * Abstract response type used for parsing and sampling of messaging clients and servers.\n+ *\n+ * @see ProducerResponse\n+ * @see ConsumerResponse\n+ * @since 5.13\n+ */\n+public abstract class MessagingResponse extends Response {\n+  /**\n+   * The request that initiated this messaging response or {@code null} if unknown.", "originalCommit": "6ecbc114033fdc41a29eeaec4e24ac7e6adbf835", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MjAwMg==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433042002", "bodyText": "probably not the best sentence. So, for example the messageId field is only readable during the response processing of AWS SQS.\nDifferent than RPC I think here it isn't important that the request is what initiated the response, rather it is simply the request data, available here so you can late process data like message Id", "author": "codefromthecrypt", "createdAt": "2020-06-01T05:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MDAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MzEwOA==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433043108", "bodyText": "Ah I think it could be Information about the request that...", "author": "anuraaga", "createdAt": "2020-06-01T05:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MDAyNA=="}], "type": "inlineReview", "revised_code": {"commit": "cf7efe0ce5ee584700535e6dd2d7292d8d6a2a66", "chunk": "diff --git a/instrumentation/messaging/src/main/java/brave/messaging/MessagingResponse.java b/instrumentation/messaging/src/main/java/brave/messaging/MessagingResponse.java\nindex ba1a59fb2..2c69cb03a 100644\n--- a/instrumentation/messaging/src/main/java/brave/messaging/MessagingResponse.java\n+++ b/instrumentation/messaging/src/main/java/brave/messaging/MessagingResponse.java\n\n@@ -25,7 +25,8 @@ import brave.internal.Nullable;\n  */\n public abstract class MessagingResponse extends Response {\n   /**\n-   * The request that initiated this messaging response or {@code null} if unknown.\n+   * Information about the request that initiated this messaging response or {@code null} if\n+   * unknown.\n    *\n    * @since 5.13\n    */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MTU4Ng==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433041586", "bodyText": "ps sometime around july last year we decided to replace message.X with messaging.X I don't recall the rationale but it should have been written down. I think it was to do with how the other properties would sound if prefixed \"message\" also to match the abstraction name.\nThe only reason I mention this is that we should decide if the tag name \"messaging.id\" is ok for the message id or we make \"messaging.message_id\" which is also awkward for the same. I don't have a strong feeling either way, but happy to add to the RATIONALE whatever we choose.", "author": "codefromthecrypt", "createdAt": "2020-06-01T04:58:53Z", "path": "instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java", "diffHunk": "@@ -59,13 +57,26 @@\n   /**\n    * Messaging channel name, e.g. \"hooks\" or \"complaints\". {@code null} if unreadable.\n    *\n-   * <p>Conventionally associated with the key \"messaging.channel_name\"", "originalCommit": "6ecbc114033fdc41a29eeaec4e24ac7e6adbf835", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MzAzMQ==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433043031", "bodyText": "Lean towards messaging.id since when in doubt, shorter seems better", "author": "anuraaga", "createdAt": "2020-06-01T05:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA0MTU4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "cf7efe0ce5ee584700535e6dd2d7292d8d6a2a66", "chunk": "diff --git a/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java b/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\nindex 88c08aa24..157af4209 100644\n--- a/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\n+++ b/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\n\n@@ -57,6 +59,8 @@ public abstract class MessagingRequest extends Request {\n   /**\n    * Messaging channel name, e.g. \"hooks\" or \"complaints\". {@code null} if unreadable.\n    *\n+   * <p>Conventionally associated with the key \"messaging.channel_name\"\n+   *\n    * @see #channelKind()\n    * @since 5.9\n    */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA4ODE4OA==", "url": "https://github.com/openzipkin/brave/pull/1224#discussion_r433088188", "bodyText": "Maby add <li>Kakfa - null</li> here once we're decided on this", "author": "jorgheymans", "createdAt": "2020-06-01T07:43:44Z", "path": "instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java", "diffHunk": "@@ -66,6 +66,23 @@\n    */\n   @Nullable public abstract String channelName();\n \n+  /**\n+   * The possibly system generated value that uniquely identifies this message. Return {@code null} if\n+   * the ID was unreadable or the transport has no canonical message ID format.\n+   *\n+   * <p>Examples:\n+   * <pre><ul>\n+   *   <li>Amazon SQS - \"MessageId\" response field. ex \"5fea7756-0ea4-451a-a703-a558b933e274\"</li>\n+   *   <li>JMS - \"JMSMessageID\" header. Ex \"ID:10.77.42.209-4280-1477454185311-1:1:1391:1:1\"</li>\n+   *   <li>RabbitMQ - AMQP \"message-id\" (max 256 char)</li>", "originalCommit": "740782ef244fdf178f2072d7f6c3b306be06cdd9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6746d0e5e3f12a10daa596cac839cb627173332a", "chunk": "diff --git a/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java b/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\nindex 157af4209..88c08aa24 100644\n--- a/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\n+++ b/instrumentation/messaging/src/main/java/brave/messaging/MessagingRequest.java\n\n@@ -59,8 +57,6 @@ public abstract class MessagingRequest extends Request {\n   /**\n    * Messaging channel name, e.g. \"hooks\" or \"complaints\". {@code null} if unreadable.\n    *\n-   * <p>Conventionally associated with the key \"messaging.channel_name\"\n-   *\n    * @see #channelKind()\n    * @since 5.9\n    */\n"}}, {"oid": "6746d0e5e3f12a10daa596cac839cb627173332a", "url": "https://github.com/openzipkin/brave/commit/6746d0e5e3f12a10daa596cac839cb627173332a", "message": "Adds channelKind channelName and messageId properties\n\nThis adds three properties from #914, currently not discussing tag name\nmapping.\n\n* channelKind - string based enum \"queue\" or \"topic\"\n* channelName - eg \"hooks\" or \"complaints\"\n* messageId - ex value of JMSMessageId", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "cf7efe0ce5ee584700535e6dd2d7292d8d6a2a66", "url": "https://github.com/openzipkin/brave/commit/cf7efe0ce5ee584700535e6dd2d7292d8d6a2a66", "message": "feedback", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "d9ec55c554bf49f0c959f9a402769342ca455ff2", "url": "https://github.com/openzipkin/brave/commit/d9ec55c554bf49f0c959f9a402769342ca455ff2", "message": "complete messaging.id", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "02f04a8624e1fe8016bfab6b387aa9a2373fe2d8", "url": "https://github.com/openzipkin/brave/commit/02f04a8624e1fe8016bfab6b387aa9a2373fe2d8", "message": "big table", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "34fb2ab18d4cc3e6d1f9445daa597e3962c731f0", "url": "https://github.com/openzipkin/brave/commit/34fb2ab18d4cc3e6d1f9445daa597e3962c731f0", "message": "sort", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "aba70a240650a265f0fe80750c3b7aa0ad9f6a4b", "url": "https://github.com/openzipkin/brave/commit/aba70a240650a265f0fe80750c3b7aa0ad9f6a4b", "message": "question", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "09c054c253c14032bdc85cf9a9de21e9786de198", "url": "https://github.com/openzipkin/brave/commit/09c054c253c14032bdc85cf9a9de21e9786de198", "message": "add pubsub", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "5a226d64599782d90d20276401bd29b9a9a69ef1", "url": "https://github.com/openzipkin/brave/commit/5a226d64599782d90d20276401bd29b9a9a69ef1", "message": "add SNS", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "1435ecccd9576cbcecbef7c99db33390724b9d2e", "url": "https://github.com/openzipkin/brave/commit/1435ecccd9576cbcecbef7c99db33390724b9d2e", "message": "kinesis", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "1e4050ab8dc1fda0e5dc39739666383ca5a8bd8e", "url": "https://github.com/openzipkin/brave/commit/1e4050ab8dc1fda0e5dc39739666383ca5a8bd8e", "message": "prefer offset/sequence when no messageId field", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "c31e002d93db0444629ed814a42d69b9d1be5a02", "url": "https://github.com/openzipkin/brave/commit/c31e002d93db0444629ed814a42d69b9d1be5a02", "message": "more elaborate", "committedDate": "2020-06-14T00:41:01Z", "type": "commit"}, {"oid": "98e1511d0f929740674c3bfd2b58fa2dbbc7eb61", "url": "https://github.com/openzipkin/brave/commit/98e1511d0f929740674c3bfd2b58fa2dbbc7eb61", "message": "adds azure", "committedDate": "2020-06-14T01:06:36Z", "type": "forcePushed"}, {"oid": "98e1511d0f929740674c3bfd2b58fa2dbbc7eb61", "url": "https://github.com/openzipkin/brave/commit/98e1511d0f929740674c3bfd2b58fa2dbbc7eb61", "message": "adds azure", "committedDate": "2020-06-14T01:06:36Z", "type": "commit"}, {"oid": "77018ffa9ac2545edb3aad4a371c377707d61910", "url": "https://github.com/openzipkin/brave/commit/77018ffa9ac2545edb3aad4a371c377707d61910", "message": "clarify cloud IDs", "committedDate": "2020-06-15T00:09:30Z", "type": "commit"}, {"oid": "b4764ea9cae23ecb8eee80fe0a3cfffde8e64bca", "url": "https://github.com/openzipkin/brave/commit/b4764ea9cae23ecb8eee80fe0a3cfffde8e64bca", "message": "Update instrumentation/messaging/RATIONALE.md\n\nCo-authored-by: Jorge Esteban Quilcate Otoya <quilcate.jorge@gmail.com>", "committedDate": "2020-06-15T00:09:04Z", "type": "commit"}, {"oid": "40f836fd5b03b4745cc03ef161d4355b33bb465e", "url": "https://github.com/openzipkin/brave/commit/40f836fd5b03b4745cc03ef161d4355b33bb465e", "message": "why", "committedDate": "2020-06-15T05:16:20Z", "type": "commit"}, {"oid": "5c5edbe9fc6b21a21e0f95797e4880d2539c0a5c", "url": "https://github.com/openzipkin/brave/commit/5c5edbe9fc6b21a21e0f95797e4880d2539c0a5c", "message": "Update instrumentation/messaging/RATIONALE.md\n\nCo-authored-by: Jorg Heymans <jorg.heymans@gmail.com>", "committedDate": "2020-06-15T23:52:57Z", "type": "commit"}, {"oid": "be01302cfdda5bac2d394257c3a2a06bb976c19b", "url": "https://github.com/openzipkin/brave/commit/be01302cfdda5bac2d394257c3a2a06bb976c19b", "message": "Update instrumentation/messaging/RATIONALE.md\n\nCo-authored-by: Jorg Heymans <jorg.heymans@gmail.com>", "committedDate": "2020-06-15T23:53:05Z", "type": "commit"}, {"oid": "5a3442d416e4a6ff0776eef1edb44e6498d0d62d", "url": "https://github.com/openzipkin/brave/commit/5a3442d416e4a6ff0776eef1edb44e6498d0d62d", "message": "Update instrumentation/messaging/RATIONALE.md\n\nCo-authored-by: Jorg Heymans <jorg.heymans@gmail.com>", "committedDate": "2020-06-15T23:53:15Z", "type": "commit"}, {"oid": "ba171dbe7f5f33759409a393d4ffbfde5fce5365", "url": "https://github.com/openzipkin/brave/commit/ba171dbe7f5f33759409a393d4ffbfde5fce5365", "message": "Update instrumentation/messaging/RATIONALE.md\n\nCo-authored-by: Jorg Heymans <jorg.heymans@gmail.com>", "committedDate": "2020-06-15T23:53:27Z", "type": "commit"}, {"oid": "782e139f31addf63f07c57bd0d46c53453f3cda6", "url": "https://github.com/openzipkin/brave/commit/782e139f31addf63f07c57bd0d46c53453f3cda6", "message": "progress", "committedDate": "2020-06-16T00:01:56Z", "type": "commit"}, {"oid": "904f2f32e13a91d6f1c19c830e3a61704c468cb8", "url": "https://github.com/openzipkin/brave/commit/904f2f32e13a91d6f1c19c830e3a61704c468cb8", "message": "finish TODO", "committedDate": "2020-06-16T03:54:55Z", "type": "commit"}, {"oid": "0bb57532a0aa25b12636326b5e63c5b111387de4", "url": "https://github.com/openzipkin/brave/commit/0bb57532a0aa25b12636326b5e63c5b111387de4", "message": "bye JMS", "committedDate": "2020-06-16T07:01:10Z", "type": "commit"}]}