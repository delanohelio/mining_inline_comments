{"pr_number": 1188, "pr_title": "Remove getVibrate / getSoundEnabled apis and logics", "pr_createdAt": "2020-10-14T22:41:09Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1188", "timeline": [{"oid": "de074065ba7b6efca1893da86ccf97fe24ffcb9a", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/de074065ba7b6efca1893da86ccf97fe24ffcb9a", "message": "Remove getVibrate / getSoundEnabled apis and logics\n\n* Remove getVibrate and enableVibrate apis\n* Remove getSoundEnabled and enableSound apis\n* Remove logics using them", "committedDate": "2020-10-14T22:44:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NTMxMQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1188#discussion_r505075311", "bodyText": "We just want to remove the OneSignal.getVibrate() call here. As a backwards compatibility for pre-O devices the OneSignal backend will still send \"vib\" depending if the Notification Category has this set.", "author": "jkasten2", "createdAt": "2020-10-14T23:43:15Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -240,28 +240,9 @@ private static void setAlertnessOptions(JSONObject fcmJson, NotificationCompat.B\n          } catch (Throwable t) {\n             notificationDefaults |= Notification.DEFAULT_LIGHTS;\n          } // Can throw if an old android support lib is used or parse error.\n-      }\n-      else\n+      } else {\n          notificationDefaults |= Notification.DEFAULT_LIGHTS;\n-\n-      if (OneSignal.getVibrate() && fcmJson.optInt(\"vib\", 1) == 1) {", "originalCommit": "de074065ba7b6efca1893da86ccf97fe24ffcb9a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f6a250382262ea3417966c795c3f81a74642ac4", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\nindex f2c8066e..6ed11a63 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\n\n@@ -243,6 +243,25 @@ class GenerateNotification {\n       } else {\n          notificationDefaults |= Notification.DEFAULT_LIGHTS;\n       }\n+\n+      if (fcmJson.optInt(\"vib\", 1) == 1) {\n+         if (fcmJson.has(\"vib_pt\")) {\n+            long[] vibrationPattern = OSUtils.parseVibrationPattern(fcmJson);\n+            if (vibrationPattern != null)\n+               notifBuilder.setVibrate(vibrationPattern);\n+         }\n+         else\n+            notificationDefaults |= Notification.DEFAULT_VIBRATE;\n+      }\n+\n+      if (isSoundEnabled(fcmJson)) {\n+         Uri soundUri = OSUtils.getSoundUri(currentContext, fcmJson.optString(\"sound\", null));\n+         if (soundUri != null)\n+            notifBuilder.setSound(soundUri);\n+         else\n+            notificationDefaults |= Notification.DEFAULT_SOUND;\n+      }\n+\n       notifBuilder.setDefaults(notificationDefaults);\n    }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NjAwOA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1188#discussion_r505076008", "bodyText": "Keep this method, just remove the OneSignal.getSoundEnabled(); check. Same reason noted above about the Android Notification Categories", "author": "jkasten2", "createdAt": "2020-10-14T23:44:14Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java", "diffHunk": "@@ -929,13 +910,6 @@ private static int getDrawableId(String name) {\n       return contextResources.getIdentifier(name, \"drawable\", packageName);\n    }\n \n-   private static boolean isSoundEnabled(JSONObject fcmJson) {", "originalCommit": "de074065ba7b6efca1893da86ccf97fe24ffcb9a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7f6a250382262ea3417966c795c3f81a74642ac4", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\nindex f2c8066e..6ed11a63 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/GenerateNotification.java\n\n@@ -910,6 +929,11 @@ class GenerateNotification {\n       return contextResources.getIdentifier(name, \"drawable\", packageName);\n    }\n \n+   private static boolean isSoundEnabled(JSONObject fcmJson) {\n+      String sound = fcmJson.optString(\"sound\", null);\n+      return !\"null\".equals(sound) && !\"nil\".equals(sound);\n+   }\n+\n    // Android 5.0 accent color to use, only works when AndroidManifest.xml is targetSdkVersion >= 21\n    private static BigInteger getAccentColor(JSONObject fcmJson) {\n       try {\n"}}, {"oid": "7f6a250382262ea3417966c795c3f81a74642ac4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/7f6a250382262ea3417966c795c3f81a74642ac4", "message": "Remove getVibrate / getSoundEnabled apis and logics\n\n* Remove getVibrate and enableVibrate apis\n* Remove getSoundEnabled and enableSound apis\n* Remove logics using them", "committedDate": "2020-10-15T16:53:52Z", "type": "forcePushed"}, {"oid": "64a82ff16c86c1f43efa75c39a680d3bc7af3f79", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/64a82ff16c86c1f43efa75c39a680d3bc7af3f79", "message": "Remove getVibrate / getSoundEnabled apis and logics\n\n* Remove getVibrate and enableVibrate apis\n* Remove getSoundEnabled and enableSound apis\n* Remove logics using them", "committedDate": "2020-10-15T16:54:47Z", "type": "commit"}, {"oid": "64a82ff16c86c1f43efa75c39a680d3bc7af3f79", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/64a82ff16c86c1f43efa75c39a680d3bc7af3f79", "message": "Remove getVibrate / getSoundEnabled apis and logics\n\n* Remove getVibrate and enableVibrate apis\n* Remove getSoundEnabled and enableSound apis\n* Remove logics using them", "committedDate": "2020-10-15T16:54:47Z", "type": "forcePushed"}]}