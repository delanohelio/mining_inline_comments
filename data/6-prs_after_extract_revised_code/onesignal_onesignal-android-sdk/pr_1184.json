{"pr_number": 1184, "pr_title": "Fix/implement adm message handler job base", "pr_createdAt": "2020-10-13T18:17:49Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184", "timeline": [{"oid": "567000a15d5a78a1ad519570ac00f6964dfc9e9a", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/567000a15d5a78a1ad519570ac00f6964dfc9e9a", "message": "Updating to ADM 1.1.0", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"oid": "765f77e126e7d0d990f6a43165aa1b2f0dffe088", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/765f77e126e7d0d990f6a43165aa1b2f0dffe088", "message": "adding amazon api_key and updating the signing debug keystore", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"oid": "cf3d57b69695afd086b53186f70c2c77eb4e5b9c", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/cf3d57b69695afd086b53186f70c2c77eb4e5b9c", "message": "Updating dev app AndroidManifest to support Amazon", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"oid": "7de8a1195f9c4838a6c6a79cdbded5804c3b5043", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/7de8a1195f9c4838a6c6a79cdbded5804c3b5043", "message": "creating ADMMessageHandlerJob class", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"oid": "dd85fb43a8dfb732c2486edff57d8721f1e3b983", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/dd85fb43a8dfb732c2486edff57d8721f1e3b983", "message": "implementing ADMMessageHandlerJob and updating receiver", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"oid": "672fe79cc7bacb5189ef835d7e7524022c143e47", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/672fe79cc7bacb5189ef835d7e7524022c143e47", "message": "Updating job id", "committedDate": "2020-10-13T18:14:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyODEwNQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184#discussion_r504228105", "bodyText": "reformat code \ud83d\ude4f", "author": "Jeasmine", "createdAt": "2020-10-13T20:14:45Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java", "diffHunk": "@@ -43,6 +44,18 @@\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n+         boolean ADMLatestAvailable = false;\n+         try{", "originalCommit": "672fe79cc7bacb5189ef835d7e7524022c143e47", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ee3914049a97657a495f1c401a6ca5a421169516", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\nindex 323ac477..e34be010 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n\n@@ -41,11 +41,13 @@ import org.json.JSONObject;\n //             when \"proguard-android-optimize.txt\" is used.\n public class ADMMessageHandler extends ADMMessageHandlerBase {\n \n+   private static final int JOB_ID = 123891;\n+\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n          boolean ADMLatestAvailable = false;\n-         try{\n+         try {\n             Class.forName( \"com.amazon.device.messaging.ADMMessageHandlerJobBase\" );\n             ADMLatestAvailable = true ;\n          }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyODIwNg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184#discussion_r504228206", "bodyText": "can we log this?", "author": "Jeasmine", "createdAt": "2020-10-13T20:14:58Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java", "diffHunk": "@@ -43,6 +44,18 @@\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n+         boolean ADMLatestAvailable = false;\n+         try{\n+            Class.forName( \"com.amazon.device.messaging.ADMMessageHandlerJobBase\" );\n+            ADMLatestAvailable = true ;\n+         }\n+         catch (ClassNotFoundException e)\n+         {\n+            // Handle the exception.", "originalCommit": "672fe79cc7bacb5189ef835d7e7524022c143e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2NjU1Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184#discussion_r504266552", "bodyText": "Don't need to log the catch as it is expected to throw on older FireOS devices everytime.\nLogging ADMLatestAvailable after words as DEBUG would be a good idea though.", "author": "jkasten2", "createdAt": "2020-10-13T21:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIyODIwNg=="}], "type": "inlineReview", "revised_code": {"commit": "ee3914049a97657a495f1c401a6ca5a421169516", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\nindex 323ac477..e34be010 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n\n@@ -41,11 +41,13 @@ import org.json.JSONObject;\n //             when \"proguard-android-optimize.txt\" is used.\n public class ADMMessageHandler extends ADMMessageHandlerBase {\n \n+   private static final int JOB_ID = 123891;\n+\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n          boolean ADMLatestAvailable = false;\n-         try{\n+         try {\n             Class.forName( \"com.amazon.device.messaging.ADMMessageHandlerJobBase\" );\n             ADMLatestAvailable = true ;\n          }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIzMTIxNA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184#discussion_r504231214", "bodyText": "if the number is the job id, can you make it a constant? usually, ids started with a number to identify the job type, for example for intents we use 100x, 200x, or 10x, 20x, for this ADM we could use 3000? just to have a convention regarding all ADM to start with 300.", "author": "Jeasmine", "createdAt": "2020-10-13T20:18:42Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java", "diffHunk": "@@ -43,6 +44,18 @@\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n+         boolean ADMLatestAvailable = false;\n+         try{\n+            Class.forName( \"com.amazon.device.messaging.ADMMessageHandlerJobBase\" );\n+            ADMLatestAvailable = true ;\n+         }\n+         catch (ClassNotFoundException e)\n+         {\n+            // Handle the exception.\n+         }\n+         if (ADMLatestAvailable) {\n+            registerJobServiceClass(ADMMessageHandlerJob.class, 123891);", "originalCommit": "672fe79cc7bacb5189ef835d7e7524022c143e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI2NzMxMg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1184#discussion_r504267312", "bodyText": "I agree on making this a constant.\nWe don't want to use something like 3000 as this is something an app developer might pick for something else. The value 123891 is fine, we want to make sure it is unique.", "author": "jkasten2", "createdAt": "2020-10-13T21:24:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIzMTIxNA=="}], "type": "inlineReview", "revised_code": {"commit": "ee3914049a97657a495f1c401a6ca5a421169516", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\nindex 323ac477..e34be010 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/ADMMessageHandler.java\n\n@@ -41,11 +41,13 @@ import org.json.JSONObject;\n //             when \"proguard-android-optimize.txt\" is used.\n public class ADMMessageHandler extends ADMMessageHandlerBase {\n \n+   private static final int JOB_ID = 123891;\n+\n    public static class Receiver extends ADMMessageReceiver {\n       public Receiver() {\n          super(ADMMessageHandler.class);\n          boolean ADMLatestAvailable = false;\n-         try{\n+         try {\n             Class.forName( \"com.amazon.device.messaging.ADMMessageHandlerJobBase\" );\n             ADMLatestAvailable = true ;\n          }\n"}}, {"oid": "ef9ae8db3c4ba8c986b03a24b79c25f744b324f7", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ef9ae8db3c4ba8c986b03a24b79c25f744b324f7", "message": "remove api key", "committedDate": "2020-10-14T21:03:00Z", "type": "commit"}, {"oid": "bc3b3dc2ce917c36da3885d9bc8e7b202ee098d1", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/bc3b3dc2ce917c36da3885d9bc8e7b202ee098d1", "message": "remove app changes", "committedDate": "2020-10-14T21:04:16Z", "type": "commit"}, {"oid": "ee3914049a97657a495f1c401a6ca5a421169516", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ee3914049a97657a495f1c401a6ca5a421169516", "message": "logging adm latest available and code style changes", "committedDate": "2020-10-14T21:17:08Z", "type": "commit"}, {"oid": "516648a23acaf588354688ece26bb6928d2ed02b", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/516648a23acaf588354688ece26bb6928d2ed02b", "message": "code style changes", "committedDate": "2020-10-14T21:17:21Z", "type": "commit"}, {"oid": "7143c42b5fb5d2b71e56378f119449db8284c964", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/7143c42b5fb5d2b71e56378f119449db8284c964", "message": "adding ADMMessageHandlerJob to proguard rules", "committedDate": "2020-10-14T21:20:47Z", "type": "commit"}]}