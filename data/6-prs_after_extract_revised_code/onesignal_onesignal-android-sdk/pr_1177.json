{"pr_number": 1177, "pr_title": "Match OSSubscriptionState and OSPermissionState with OSDeviceState", "pr_createdAt": "2020-10-05T19:27:15Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyMzI0NA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r499823244", "bodyText": "with the properties names changes, is the\npublic static void disablePush(final boolean disable) method readable?\nThe comments say\n\nYou can call this method with {@code false} to opt users out of receiving all notifications through\n* OneSignal. You can pass {@code true} later to opt users back into notifications.\n* @param disable whether to subscribe the user to notifications or not\n\nshouldn't be true for opt users out of receiving all notifications through and false otherwise?  @jkasten2 Thoughts?", "author": "Jeasmine", "createdAt": "2020-10-05T19:30:11Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -2305,7 +2305,7 @@ public void run() {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setUserSubscriptionSetting(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);", "originalCommit": "864a14c63afe52af9a2e27bfea22225bb1122f95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4MTM4Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r500781386", "bodyText": "ah yes, the comment is backwards and needs to be updated.", "author": "jkasten2", "createdAt": "2020-10-07T07:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgyMzI0NA=="}], "type": "inlineReview", "revised_code": {"commit": "28503b0bd481ce16110a992fa79b0ba1166bf33e", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex 85551b93..4ef74139 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -2305,8 +2305,8 @@ public class OneSignal {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);\n-      OneSignalStateSynchronizer.setSubscription(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(disable);\n+      OneSignalStateSynchronizer.setSubscription(!disable);\n    }\n \n    /**\n"}}, {"oid": "081257ca63f2423e646986af1b4a5a9ac1fdf8e5", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/081257ca63f2423e646986af1b4a5a9ac1fdf8e5", "message": "Match OSSubscriptionState and OSPermissionState with OSDeviceState\n\n* Rename properties, getters and setters to match OSDeviceState", "committedDate": "2020-10-05T20:15:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4MjcxNw==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r500782717", "bodyText": "Remove ! we shouldn't be flipping the logic here. Your changes in OSSubscriptionState.java already account for this.", "author": "jkasten2", "createdAt": "2020-10-07T07:06:05Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -2305,7 +2305,7 @@ public void run() {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setUserSubscriptionSetting(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);", "originalCommit": "081257ca63f2423e646986af1b4a5a9ac1fdf8e5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "28503b0bd481ce16110a992fa79b0ba1166bf33e", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex 85551b93..4ef74139 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -2305,8 +2305,8 @@ public class OneSignal {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);\n-      OneSignalStateSynchronizer.setSubscription(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(disable);\n+      OneSignalStateSynchronizer.setSubscription(!disable);\n    }\n \n    /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc4NDQ4Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r500784486", "bodyText": "Must keep the string \"PREFS_ONESIGNAL_PUSH_DISABLED\" the same otherwise the value won't carry over when the app update from 3.x to 4.x.\nI recommend we keep this the same for now since this is only internally used", "author": "jkasten2", "createdAt": "2020-10-07T07:09:58Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalPrefs.java", "diffHunk": "@@ -74,7 +74,7 @@\n     public static final String PREFS_ONESIGNAL_USERSTATE_DEPENDVALYES_ = \"ONESIGNAL_USERSTATE_DEPENDVALYES_\";\n     public static final String PREFS_ONESIGNAL_USERSTATE_SYNCVALYES_ = \"ONESIGNAL_USERSTATE_SYNCVALYES_\";\n     public static final String PREFS_ONESIGNAL_ACCEPTED_NOTIFICATION_LAST = \"ONESIGNAL_ACCEPTED_NOTIFICATION_LAST\";\n-    public static final String PREFS_ONESIGNAL_SUBSCRIPTION_LAST = \"ONESIGNAL_SUBSCRIPTION_LAST\";\n+    public static final String PREFS_ONESIGNAL_PUSH_DISABLED = \"PREFS_ONESIGNAL_PUSH_DISABLED\";", "originalCommit": "081257ca63f2423e646986af1b4a5a9ac1fdf8e5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "28503b0bd481ce16110a992fa79b0ba1166bf33e", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalPrefs.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalPrefs.java\nindex 57b625de..496b26d6 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalPrefs.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignalPrefs.java\n\n@@ -74,7 +74,7 @@ class OneSignalPrefs {\n     public static final String PREFS_ONESIGNAL_USERSTATE_DEPENDVALYES_ = \"ONESIGNAL_USERSTATE_DEPENDVALYES_\";\n     public static final String PREFS_ONESIGNAL_USERSTATE_SYNCVALYES_ = \"ONESIGNAL_USERSTATE_SYNCVALYES_\";\n     public static final String PREFS_ONESIGNAL_ACCEPTED_NOTIFICATION_LAST = \"ONESIGNAL_ACCEPTED_NOTIFICATION_LAST\";\n-    public static final String PREFS_ONESIGNAL_PUSH_DISABLED = \"PREFS_ONESIGNAL_PUSH_DISABLED\";\n+    public static final String ONESIGNAL_SUBSCRIPTION_LAST = \"ONESIGNAL_SUBSCRIPTION_LAST\";\n     public static final String PREFS_ONESIGNAL_PLAYER_ID_LAST = \"ONESIGNAL_PLAYER_ID_LAST\";\n     public static final String PREFS_ONESIGNAL_PUSH_TOKEN_LAST = \"ONESIGNAL_PUSH_TOKEN_LAST\";\n     public static final String PREFS_ONESIGNAL_PERMISSION_ACCEPTED_LAST = \"ONESIGNAL_PERMISSION_ACCEPTED_LAST\";\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc5MDU5Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r500790592", "bodyText": "This line need to be updated to OneSignalStateSynchronizer.setSubscription(!disable); or we change the name disablePush as well an update the internals to match.", "author": "jkasten2", "createdAt": "2020-10-07T07:21:59Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -2305,7 +2305,7 @@ public void run() {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setUserSubscriptionSetting(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);\n       OneSignalStateSynchronizer.setSubscription(disable);", "originalCommit": "081257ca63f2423e646986af1b4a5a9ac1fdf8e5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTE1NjU2Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1177#discussion_r501156562", "bodyText": "Given that subscription can also change email Synchronizer, seems more readable to keep it as setSubscription", "author": "Jeasmine", "createdAt": "2020-10-07T16:40:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc5MDU5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "28503b0bd481ce16110a992fa79b0ba1166bf33e", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex 85551b93..4ef74139 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -2305,8 +2305,8 @@ public class OneSignal {\n       if (shouldLogUserPrivacyConsentErrorMessageForMethodName(OSTaskController.SET_SUBSCRIPTION))\n          return;\n \n-      getCurrentSubscriptionState(appContext).setPushDisabled(!disable);\n-      OneSignalStateSynchronizer.setSubscription(disable);\n+      getCurrentSubscriptionState(appContext).setPushDisabled(disable);\n+      OneSignalStateSynchronizer.setSubscription(!disable);\n    }\n \n    /**\n"}}, {"oid": "28503b0bd481ce16110a992fa79b0ba1166bf33e", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/28503b0bd481ce16110a992fa79b0ba1166bf33e", "message": "Match OSSubscriptionState and OSPermissionState with OSDeviceState\n\n* Rename properties, getters and setters to match OSDeviceState", "committedDate": "2020-10-07T16:52:23Z", "type": "forcePushed"}, {"oid": "1449210422d1d7e6939360e45323bede91e8c7c7", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1449210422d1d7e6939360e45323bede91e8c7c7", "message": "Match OSSubscriptionState and OSPermissionState with OSDeviceState\n\n* Rename properties, getters and setters to match OSDeviceState", "committedDate": "2020-10-07T16:55:42Z", "type": "commit"}, {"oid": "1449210422d1d7e6939360e45323bede91e8c7c7", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/1449210422d1d7e6939360e45323bede91e8c7c7", "message": "Match OSSubscriptionState and OSPermissionState with OSDeviceState\n\n* Rename properties, getters and setters to match OSDeviceState", "committedDate": "2020-10-07T16:55:42Z", "type": "forcePushed"}]}