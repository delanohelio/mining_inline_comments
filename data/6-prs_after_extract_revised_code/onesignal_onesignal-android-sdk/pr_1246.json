{"pr_number": 1246, "pr_title": "Fix Displaying IAMs past end time", "pr_createdAt": "2020-12-22T01:53:34Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1246", "timeline": [{"oid": "524d30d351832b3b8eb5789fb2a867356a5c5e3b", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/524d30d351832b3b8eb5789fb2a867356a5c5e3b", "message": "Fix showing IAMs past their end time\n\nThis change involves reading in end_time from JSON when creating an IAM\nso that we can decide to not show the IAM (Cached case) if the IAM\nshould be finished. The date comes in iso8601 format.", "committedDate": "2020-12-22T01:51:35Z", "type": "commit"}, {"oid": "f5cb276a557a53779e64394dadf900b6f3136ce0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/f5cb276a557a53779e64394dadf900b6f3136ce0", "message": "unit tests for IAM end_time logic", "committedDate": "2020-12-22T01:52:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ5OTA0OQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1246#discussion_r547499049", "bodyText": "can we put this on a constant?", "author": "Jeasmine", "createdAt": "2020-12-22T20:45:01Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java", "diffHunk": "@@ -76,11 +82,31 @@\n         this.variants = parseVariants(json.getJSONObject(IAM_VARIANTS));\n         this.triggers = parseTriggerJson(json.getJSONArray(IAM_TRIGGERS));\n         this.clickedClickIds = new HashSet<>();\n+        this.endTime = parseEndTimeJson(json);\n \n         if (json.has(IAM_REDISPLAY_STATS))\n             this.redisplayStats = new OSInAppMessageRedisplayStats(json.getJSONObject(IAM_REDISPLAY_STATS));\n     }\n \n+    private Date parseEndTimeJson(JSONObject json) {\n+        String endTimeString;\n+        try {\n+            endTimeString = json.getString(END_TIME);\n+        } catch (JSONException e) {\n+            return null;\n+        }\n+\n+        SimpleDateFormat format = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\", Locale.US);", "originalCommit": "f5cb276a557a53779e64394dadf900b6f3136ce0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMTk2Nw==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1246#discussion_r547501967", "bodyText": "Can we have the same iOS object OneSignal/OneSignal-iOS-SDK#841 (comment) in here?", "author": "Jeasmine", "createdAt": "2020-12-22T20:51:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ5OTA0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU1MzQzNQ==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1246#discussion_r547553435", "bodyText": "created a OneSignalSimpleDateFormatter class with a static method to get the iso8601 format", "author": "emawby", "createdAt": "2020-12-22T23:20:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQ5OTA0OQ=="}], "type": "inlineReview", "revised_code": {"commit": "a37f3128d67b6456d31acd6fd3bf135910783665", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java\nindex cd71874d..7d32b9fd 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OSInAppMessage.java\n\n@@ -96,7 +96,7 @@ class OSInAppMessage {\n             return null;\n         }\n \n-        SimpleDateFormat format = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSS'Z'\", Locale.US);\n+        SimpleDateFormat format = OneSignalSimpleDateFormat.iso8601Format();\n         try {\n             Date date = format.parse(endTimeString);\n             return date;\n"}}, {"oid": "a37f3128d67b6456d31acd6fd3bf135910783665", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a37f3128d67b6456d31acd6fd3bf135910783665", "message": "move the iso8601 SimpleDateFormat to its own class", "committedDate": "2020-12-22T23:18:44Z", "type": "commit"}]}