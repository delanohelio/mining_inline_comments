{"pr_number": 1210, "pr_title": "Add auth hash to external Id", "pr_createdAt": "2020-11-12T19:22:23Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1210", "timeline": [{"oid": "212a5ff1de4e8f9f3bee2c47f49a805f8b307ce6", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/212a5ff1de4e8f9f3bee2c47f49a805f8b307ce6", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-12T19:27:22Z", "type": "forcePushed"}, {"oid": "e949f47fea3fa98a8e9b745ae01b5ffeb27d6637", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/e949f47fea3fa98a8e9b745ae01b5ffeb27d6637", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-16T15:37:41Z", "type": "forcePushed"}, {"oid": "10b3bebac40e4e92ff342d3629999b59a0dcbdaa", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/10b3bebac40e4e92ff342d3629999b59a0dcbdaa", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-16T19:57:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMwNTYxMA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1210#discussion_r525305610", "bodyText": "remoteParams.useEmailAuth should be  remoteParams.useUserIdAuth", "author": "jkasten2", "createdAt": "2020-11-17T16:34:54Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1565,8 +1595,20 @@ public void run() {\n                return;\n             }\n \n+            if (remoteParams != null && remoteParams.useEmailAuth && externalIdAuthHash == null) {", "originalCommit": "10b3bebac40e4e92ff342d3629999b59a0dcbdaa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "aa99221f1935026cfcbc4469ce0941913cd892d4", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex cd6b9592..6157e663 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -1595,7 +1595,7 @@ public class OneSignal {\n                return;\n             }\n \n-            if (remoteParams != null && remoteParams.useEmailAuth && externalIdAuthHash == null) {\n+            if (remoteParams != null && remoteParams.requireUserIdAuth && externalIdAuthHash == null) {\n                String errorMessage = \"External Id authentication (auth token) is set to REQUIRED for this application. Please provide an auth token from your backend server or change the setting in the OneSignal dashboard.\";\n                if (completionCallback != null)\n                   completionCallback.onFailure(new ExternalIdError(ExternalIdErrorType.REQUIRES_EXTERNAL_ID_AUTH, errorMessage));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ3ODU5Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1210#discussion_r525478596", "bodyText": "Can we change the name of internalExternalIdAuthHash? Is the only change we are making is making it all lower case? If that is the case maybe include the lowercase aspect in the name?", "author": "emawby", "createdAt": "2020-11-17T20:11:16Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1565,8 +1595,20 @@ public void run() {\n                return;\n             }\n \n+            if (remoteParams != null && remoteParams.useEmailAuth && externalIdAuthHash == null) {\n+               String errorMessage = \"External Id authentication (auth token) is set to REQUIRED for this application. Please provide an auth token from your backend server or change the setting in the OneSignal dashboard.\";\n+               if (completionCallback != null)\n+                  completionCallback.onFailure(new ExternalIdError(ExternalIdErrorType.REQUIRES_EXTERNAL_ID_AUTH, errorMessage));\n+               Log(LOG_LEVEL.ERROR, errorMessage);\n+               return;\n+            }\n+\n+            String internalExternalIdAuthHash = externalIdAuthHash;", "originalCommit": "10b3bebac40e4e92ff342d3629999b59a0dcbdaa", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "aa99221f1935026cfcbc4469ce0941913cd892d4", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex cd6b9592..6157e663 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -1595,7 +1595,7 @@ public class OneSignal {\n                return;\n             }\n \n-            if (remoteParams != null && remoteParams.useEmailAuth && externalIdAuthHash == null) {\n+            if (remoteParams != null && remoteParams.requireUserIdAuth && externalIdAuthHash == null) {\n                String errorMessage = \"External Id authentication (auth token) is set to REQUIRED for this application. Please provide an auth token from your backend server or change the setting in the OneSignal dashboard.\";\n                if (completionCallback != null)\n                   completionCallback.onFailure(new ExternalIdError(ExternalIdErrorType.REQUIRES_EXTERNAL_ID_AUTH, errorMessage));\n"}}, {"oid": "aa99221f1935026cfcbc4469ce0941913cd892d4", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/aa99221f1935026cfcbc4469ce0941913cd892d4", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-18T16:49:45Z", "type": "forcePushed"}, {"oid": "d1090fda2dce668a563e118e4ffee1d8f1e24b0c", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/d1090fda2dce668a563e118e4ffee1d8f1e24b0c", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-18T16:51:19Z", "type": "forcePushed"}, {"oid": "3d2ef2c1eacbc740fdfc975390a99a0a035f9876", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3d2ef2c1eacbc740fdfc975390a99a0a035f9876", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-19T01:33:35Z", "type": "commit"}, {"oid": "3d2ef2c1eacbc740fdfc975390a99a0a035f9876", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/3d2ef2c1eacbc740fdfc975390a99a0a035f9876", "message": "Add auth hash to external Id\n\n* Add auth to setExternalId\n* Add tests for new functionality", "committedDate": "2020-11-19T01:33:35Z", "type": "forcePushed"}]}