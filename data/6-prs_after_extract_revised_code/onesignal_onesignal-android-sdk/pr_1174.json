{"pr_number": 1174, "pr_title": "Fix foreground check for wrappers", "pr_createdAt": "2020-10-02T21:04:58Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MzI4MA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174#discussion_r499093280", "bodyText": "It seems that Worker would always have a Context so I won't expect a null check is need here.", "author": "jkasten2", "createdAt": "2020-10-03T00:00:42Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OSNotificationRestoreWorkManager.java", "diffHunk": "@@ -61,7 +61,8 @@ public NotificationRestoreWorker(@NonNull Context context, @NonNull WorkerParame\n         public Result doWork() {\n             Context context = getApplicationContext();\n \n-            OneSignal.initWithContext(context);\n+            if (OneSignal.appContext == null)", "originalCommit": "5976e7eb76ecbb18f7052e2b3ba8ec1416407a6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzNDA4Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174#discussion_r499634082", "bodyText": "This is to avoid a new OneSignal.initWithContext(context); while the first initWithContext was called but not finished yet", "author": "Jeasmine", "createdAt": "2020-10-05T14:19:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5MzI4MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5NDA0MA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174#discussion_r499094040", "bodyText": "nit, extra space after instanceof", "author": "jkasten2", "createdAt": "2020-10-03T00:06:45Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -594,6 +599,8 @@ public static void initWithContext(@NonNull Context context) {\n \n       boolean wasAppContextNull = (appContext == null);\n       appContext = context.getApplicationContext();\n+      if (context instanceof  Activity)", "originalCommit": "5976e7eb76ecbb18f7052e2b3ba8ec1416407a6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYzNDIwNg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174#discussion_r499634206", "bodyText": "good catch!", "author": "Jeasmine", "createdAt": "2020-10-05T14:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5NDA0MA=="}], "type": "inlineReview", "revised_code": {"commit": "25bab5f9311308cc71a92db9819bd37fbff7ed53", "chunk": "diff --git a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\nindex a503a86a..3050dfda 100644\n--- a/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n+++ b/OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java\n\n@@ -599,7 +599,7 @@ public class OneSignal {\n \n       boolean wasAppContextNull = (appContext == null);\n       appContext = context.getApplicationContext();\n-      if (context instanceof  Activity)\n+      if (context instanceof Activity)\n          appActivity = new WeakReference<>((Activity) context);\n       setupActivityLifecycleListener(wasAppContextNull);\n       setupPrivacyConsent(appContext);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA5NDc2OA==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1174#discussion_r499094768", "bodyText": "\ud83d\udc4d This covers the scenario we are looking to fix!", "author": "jkasten2", "createdAt": "2020-10-03T00:11:52Z", "path": "OneSignalSDK/unittest/src/test/java/com/test/onesignal/MainOneSignalClassRunner.java", "diffHunk": "@@ -792,10 +792,23 @@ public void testInitWithContext_ActivityResumedBeforeInit() throws Exception {\n       OneSignal.setLogLevel(OneSignal.LOG_LEVEL.VERBOSE, OneSignal.LOG_LEVEL.NONE);\n       ShadowOSUtils.subscribableStatus = 1;\n \n-      OneSignal.initWithContext(blankActivity);\n       blankActivityController.resume();\n+      OneSignal.initWithContext(blankActivity);\n+      OneSignal.setAppId(ONESIGNAL_APP_ID);\n+      threadAndTaskWait();\n \n+      assertTrue(OneSignal_isInForeground());\n+   }\n+\n+   @Test\n+   public void testInitWithContextAppIdSet_ActivityResumedBeforeInit() throws Exception {", "originalCommit": "5976e7eb76ecbb18f7052e2b3ba8ec1416407a6c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "25bab5f9311308cc71a92db9819bd37fbff7ed53", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/25bab5f9311308cc71a92db9819bd37fbff7ed53", "message": "Fix failing tests", "committedDate": "2020-10-05T16:18:21Z", "type": "forcePushed"}, {"oid": "ae75ff5586ec9a5514e013c6c38498d5a210ac2f", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/ae75ff5586ec9a5514e013c6c38498d5a210ac2f", "message": "Fix foreground check for wrappers\n\n* If user init with activity context foreground check should work even if on resume callback is not fire", "committedDate": "2020-10-05T19:34:27Z", "type": "commit"}, {"oid": "26a2a16d5de6e07370209aaf2b27c2335d6e00a0", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/26a2a16d5de6e07370209aaf2b27c2335d6e00a0", "message": "Fix failing tests", "committedDate": "2020-10-05T19:34:28Z", "type": "forcePushed"}, {"oid": "a225ff5ae036991fb3618cc0b52fc46a8fffbb18", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a225ff5ae036991fb3618cc0b52fc46a8fffbb18", "message": "Fix failing tests", "committedDate": "2020-10-05T19:36:25Z", "type": "commit"}, {"oid": "a225ff5ae036991fb3618cc0b52fc46a8fffbb18", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/a225ff5ae036991fb3618cc0b52fc46a8fffbb18", "message": "Fix failing tests", "committedDate": "2020-10-05T19:36:25Z", "type": "forcePushed"}]}