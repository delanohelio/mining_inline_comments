{"pr_number": 1196, "pr_title": "Enable background player updates", "pr_createdAt": "2020-10-23T03:01:05Z", "pr_url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196", "timeline": [{"oid": "040a155100dfa289143eca79e3adf1fae963b986", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/commit/040a155100dfa289143eca79e3adf1fae963b986", "message": "Enable background player updates\n\n* If user send tags under ServiceExtension implementation, player update should happen\n* Add sendTags on background test", "committedDate": "2020-10-23T03:00:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NTA2Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512885062", "bodyText": "The return here was removed was that intentional?", "author": "emawby", "createdAt": "2020-10-27T17:26:08Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -815,25 +816,27 @@ private static void handleAmazonPurchase() {\n    private static void doSessionInit() {\n       // Check session time to determine whether to start a new session or not\n       if (isPastOnSessionTime()) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Starting new session\");\n-         OneSignalStateSynchronizer.setNewSession();\n          if (inForeground) {\n+            logger.debug(\"Starting new session\");\n+\n+            OneSignalStateSynchronizer.setNewSession();\n             outcomeEventsController.cleanOutcomes();\n             sessionManager.restartSessionIfNeeded(getAppEntryState());\n             getInAppMessageController().resetSessionLaunchTime();\n+            setLastSessionTime(time.getCurrentTimeMillis());\n          }\n-      } else if (inForeground) {\n-         OneSignal.onesignalLog(LOG_LEVEL.DEBUG, \"Continue on same session\");\n+      } else {\n+         logger.debug(\"Continue on same session\");\n+\n          sessionManager.attemptSessionUpgrade(getAppEntryState());\n       }\n       getInAppMessageController().initWithCachedInAppMessages();\n \n       // We still want register the user to OneSignal if the SDK was initialized\n       //   in the background for the first time.\n       if (!inForeground && hasUserId())\n-         return;\n+         logger.debug(\"doSessionInit on background with already registered user\");\n ", "originalCommit": "040a155100dfa289143eca79e3adf1fae963b986", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNjIwMg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512906202", "bodyText": "yeah, this was preventing the background update", "author": "Jeasmine", "createdAt": "2020-10-27T17:52:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NTA2Mg=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjU2Mg==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512886562", "bodyText": "I think it would be useful to print the values here so we know why registerUser isn't possible since there are 4 possibilities", "author": "emawby", "createdAt": "2020-10-27T17:27:47Z", "path": "OneSignalSDK/onesignal/src/main/java/com/onesignal/OneSignal.java", "diffHunk": "@@ -1224,16 +1234,18 @@ private static int getTimeZoneOffset() {\n    }\n \n    private static void registerUser() {\n-      Log(LOG_LEVEL.DEBUG,\n+      logger.debug(\n          \"registerUser:\" +\n          \"registerForPushFired:\" + registerForPushFired +\n          \", locationFired: \" + locationFired +\n          \", remoteParams: \" + getRemoteParams() +\n          \", appId: \" + appId\n       );\n \n-      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null)\n+      if (!registerForPushFired || !locationFired || getRemoteParams() == null || appId == null) {\n+         logger.debug(\"registerUser not possible\");", "originalCommit": "040a155100dfa289143eca79e3adf1fae963b986", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjkwNjk5Ng==", "url": "https://github.com/OneSignal/OneSignal-Android-SDK/pull/1196#discussion_r512906996", "bodyText": "we already had the\n\nlogger.debug(\n         \"registerUser:\" +\n         \"registerForPushFired:\" + registerForPushFired +\n         \", locationFired: \" + locationFired +\n         \", remoteParams: \" + getRemoteParams() +\n         \", appId: \" + appId\n      );\n\ndidn't want to repeat the same data", "author": "Jeasmine", "createdAt": "2020-10-27T17:53:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjU2Mg=="}], "type": "inlineReview", "revised_code": null}]}