{"pr_number": 502, "pr_title": "[Bugs] Improve photos support", "pr_createdAt": "2020-06-18T13:31:55Z", "pr_url": "https://github.com/google/ground-android/pull/502", "timeline": [{"oid": "f53ac36a8b8fc6697faacadebc1a343729cec5d8", "url": "https://github.com/google/ground-android/commit/f53ac36a8b8fc6697faacadebc1a343729cec5d8", "message": "Cherry-pick regression fix from #475", "committedDate": "2020-06-18T09:52:26Z", "type": "commit"}, {"oid": "0aaf1063898c600b1ecb4134126123f6f6ae1f59", "url": "https://github.com/google/ground-android/commit/0aaf1063898c600b1ecb4134126123f6f6ae1f59", "message": "Use UUID as filenames for photos & remove sync to remote\n\nNeeded for multi-photo support", "committedDate": "2020-06-18T10:04:15Z", "type": "commit"}, {"oid": "67d7f0853b559e89cae554c3f05d1f5d3bd2b717", "url": "https://github.com/google/ground-android/commit/67d7f0853b559e89cae554c3f05d1f5d3bd2b717", "message": "Enqueue photo upload when uploading observation mutations", "committedDate": "2020-06-18T11:10:12Z", "type": "commit"}, {"oid": "ef6607f1c8201f2d53b285d5ee1fba3ef45eed9e", "url": "https://github.com/google/ground-android/commit/ef6607f1c8201f2d53b285d5ee1fba3ef45eed9e", "message": "Fix bug : Sometimes uploaded media path contains \"n/a\"", "committedDate": "2020-06-18T11:15:07Z", "type": "commit"}, {"oid": "93a4a5f79cf513fe67b5fd5078f91b69c048c2af", "url": "https://github.com/google/ground-android/commit/93a4a5f79cf513fe67b5fd5078f91b69c048c2af", "message": "Improve code readability", "committedDate": "2020-06-18T11:32:30Z", "type": "commit"}, {"oid": "b7fc93428289d0706480850de1e1eef6bad49a4b", "url": "https://github.com/google/ground-android/commit/b7fc93428289d0706480850de1e1eef6bad49a4b", "message": "Fix photo dialog not dismissing after select\n\n-  Use recycler view in photo dialog", "committedDate": "2020-06-18T13:10:03Z", "type": "commit"}, {"oid": "4b6c1d8c7e601a685040a5c7693f705c9c425bfb", "url": "https://github.com/google/ground-android/commit/4b6c1d8c7e601a685040a5c7693f705c9c425bfb", "message": "Fix variable name", "committedDate": "2020-06-18T13:20:48Z", "type": "commit"}, {"oid": "c1acc2311a825e9f538c756d9e2edba9c1e099a6", "url": "https://github.com/google/ground-android/commit/c1acc2311a825e9f538c756d9e2edba9c1e099a6", "message": "Delete local file after uploading to remote storage", "committedDate": "2020-06-18T13:21:37Z", "type": "commit"}, {"oid": "b16958e0ad24b1c07f9cef5d5a7be7e29d783584", "url": "https://github.com/google/ground-android/commit/b16958e0ad24b1c07f9cef5d5a7be7e29d783584", "message": "Merge branch 'master' into multiple_photos_support", "committedDate": "2020-06-18T16:11:55Z", "type": "commit"}, {"oid": "849a385a73ca0e2b158654952c0797c3ebdcb772", "url": "https://github.com/google/ground-android/commit/849a385a73ca0e2b158654952c0797c3ebdcb772", "message": "Merge branch 'master' into multiple_photos_support", "committedDate": "2020-06-18T18:40:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1OTQ4Nw==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442859487", "bodyText": "Typo. Should be ADD_PHOTO_LIST here and throughout.", "author": "dturner", "createdAt": "2020-06-19T14:03:41Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;\n+  public static final int STORAGE = 2;\n+\n+  private static final int[][] ADD_PHOTO_LISt = {\n+    {R.string.action_camera, R.drawable.ic_photo_camera, CAMERA},\n+    {R.string.action_storage, R.drawable.ic_sd_storage, STORAGE}\n+  };\n+\n+  private ItemClickListener listener;\n+\n+  public AddPhotoDialogAdapter(ItemClickListener listener) {\n+    this.listener = listener;\n+  }\n+\n+  @NonNull\n+  @Override\n+  public ViewHolder onCreateViewHolder(@NonNull ViewGroup parent, int viewType) {\n+    AddPhotoListItemBinding binding =\n+        AddPhotoListItemBinding.inflate(LayoutInflater.from(parent.getContext()), parent, false);\n+    return new ViewHolder(binding, listener);\n+  }\n+\n+  @Override\n+  public void onBindViewHolder(@NonNull ViewHolder holder, int position) {\n+    holder.binding.textView.setText(ADD_PHOTO_LISt[position][0]);\n+    holder.binding.imageView.setImageResource(ADD_PHOTO_LISt[position][1]);\n+    holder.type = ADD_PHOTO_LISt[position][2];\n+  }\n+\n+  @Override\n+  public int getItemCount() {\n+    return ADD_PHOTO_LISt.length;", "originalCommit": "b7fc93428289d0706480850de1e1eef6bad49a4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2ODAxNA==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442868014", "bodyText": "Ah, you've already fixed this (I was reviewing on a per-commit basis so didn't spot it until after I'd made the comment).", "author": "dturner", "createdAt": "2020-06-19T14:19:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1OTQ4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "ea11d40eba8d25e81144e257c31797216ce33025", "chunk": "diff --git a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\nindex 8bd49caa..c1e6b750 100644\n--- a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n+++ b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n\n@@ -20,20 +20,26 @@ import android.view.LayoutInflater;\n import android.view.View;\n import android.view.View.OnClickListener;\n import android.view.ViewGroup;\n+import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n+import androidx.annotation.StringRes;\n import androidx.recyclerview.widget.RecyclerView;\n import com.google.android.gnd.R;\n import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+import com.google.common.collect.ImmutableList;\n \n public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n \n-  public static final int CAMERA = 1;\n-  public static final int STORAGE = 2;\n-\n-  private static final int[][] ADD_PHOTO_LISt = {\n-    {R.string.action_camera, R.drawable.ic_photo_camera, CAMERA},\n-    {R.string.action_storage, R.drawable.ic_sd_storage, STORAGE}\n-  };\n+  private static final ImmutableList<PhotoStorageResource> PHOTO_STORAGE_RESOURCES =\n+      ImmutableList.of(\n+          new PhotoStorageResource(\n+              R.string.action_camera,\n+              R.drawable.ic_photo_camera,\n+              PhotoStorageResource.PHOTO_SOURCE_CAMERA),\n+          new PhotoStorageResource(\n+              R.string.action_storage,\n+              R.drawable.ic_sd_storage,\n+              PhotoStorageResource.PHOTO_SOURCE_STORAGE));\n \n   private ItemClickListener listener;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2MTYxNA==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442861614", "bodyText": "It's not immediately clear what these constants are for. Maybe change to PHOTO_SOURCE_CAMERA and PHOTO_SOURCE_STORAGE", "author": "dturner", "createdAt": "2020-06-19T14:07:44Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;", "originalCommit": "b7fc93428289d0706480850de1e1eef6bad49a4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkwOTU3NQ==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442909575", "bodyText": "Done", "author": "shobhitagarwal1612", "createdAt": "2020-06-19T15:35:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2MTYxNA=="}], "type": "inlineReview", "revised_code": {"commit": "ea11d40eba8d25e81144e257c31797216ce33025", "chunk": "diff --git a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\nindex 8bd49caa..c1e6b750 100644\n--- a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n+++ b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n\n@@ -20,20 +20,26 @@ import android.view.LayoutInflater;\n import android.view.View;\n import android.view.View.OnClickListener;\n import android.view.ViewGroup;\n+import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n+import androidx.annotation.StringRes;\n import androidx.recyclerview.widget.RecyclerView;\n import com.google.android.gnd.R;\n import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+import com.google.common.collect.ImmutableList;\n \n public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n \n-  public static final int CAMERA = 1;\n-  public static final int STORAGE = 2;\n-\n-  private static final int[][] ADD_PHOTO_LISt = {\n-    {R.string.action_camera, R.drawable.ic_photo_camera, CAMERA},\n-    {R.string.action_storage, R.drawable.ic_sd_storage, STORAGE}\n-  };\n+  private static final ImmutableList<PhotoStorageResource> PHOTO_STORAGE_RESOURCES =\n+      ImmutableList.of(\n+          new PhotoStorageResource(\n+              R.string.action_camera,\n+              R.drawable.ic_photo_camera,\n+              PhotoStorageResource.PHOTO_SOURCE_CAMERA),\n+          new PhotoStorageResource(\n+              R.string.action_storage,\n+              R.drawable.ic_sd_storage,\n+              PhotoStorageResource.PHOTO_SOURCE_STORAGE));\n \n   private ItemClickListener listener;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2NTgzNA==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442865834", "bodyText": "Maybe change this to PHOTO_SOURCE_RESOURCES.\nYou could also create a separate inner class e.g. class PhotoStorageResource { int actionStringResourceId, int iconResourceId, int sourceType } and instead make this private static final ArrayList<PhotoStringResource> = { ... }; // list of possible photo sources and their associated resources", "author": "dturner", "createdAt": "2020-06-19T14:15:45Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.editobservation;\n+\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.View.OnClickListener;\n+import android.view.ViewGroup;\n+import androidx.annotation.NonNull;\n+import androidx.recyclerview.widget.RecyclerView;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+\n+public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n+\n+  public static final int CAMERA = 1;\n+  public static final int STORAGE = 2;\n+\n+  private static final int[][] ADD_PHOTO_LISt = {", "originalCommit": "b7fc93428289d0706480850de1e1eef6bad49a4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkwOTUwNw==", "url": "https://github.com/google/ground-android/pull/502#discussion_r442909507", "bodyText": "Done", "author": "shobhitagarwal1612", "createdAt": "2020-06-19T15:35:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2NTgzNA=="}], "type": "inlineReview", "revised_code": {"commit": "ea11d40eba8d25e81144e257c31797216ce33025", "chunk": "diff --git a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\nindex 8bd49caa..c1e6b750 100644\n--- a/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n+++ b/gnd/src/main/java/com/google/android/gnd/ui/editobservation/AddPhotoDialogAdapter.java\n\n@@ -20,20 +20,26 @@ import android.view.LayoutInflater;\n import android.view.View;\n import android.view.View.OnClickListener;\n import android.view.ViewGroup;\n+import androidx.annotation.DrawableRes;\n import androidx.annotation.NonNull;\n+import androidx.annotation.StringRes;\n import androidx.recyclerview.widget.RecyclerView;\n import com.google.android.gnd.R;\n import com.google.android.gnd.databinding.AddPhotoListItemBinding;\n+import com.google.common.collect.ImmutableList;\n \n public class AddPhotoDialogAdapter extends RecyclerView.Adapter<AddPhotoDialogAdapter.ViewHolder> {\n \n-  public static final int CAMERA = 1;\n-  public static final int STORAGE = 2;\n-\n-  private static final int[][] ADD_PHOTO_LISt = {\n-    {R.string.action_camera, R.drawable.ic_photo_camera, CAMERA},\n-    {R.string.action_storage, R.drawable.ic_sd_storage, STORAGE}\n-  };\n+  private static final ImmutableList<PhotoStorageResource> PHOTO_STORAGE_RESOURCES =\n+      ImmutableList.of(\n+          new PhotoStorageResource(\n+              R.string.action_camera,\n+              R.drawable.ic_photo_camera,\n+              PhotoStorageResource.PHOTO_SOURCE_CAMERA),\n+          new PhotoStorageResource(\n+              R.string.action_storage,\n+              R.drawable.ic_sd_storage,\n+              PhotoStorageResource.PHOTO_SOURCE_STORAGE));\n \n   private ItemClickListener listener;\n \n"}}, {"oid": "ea11d40eba8d25e81144e257c31797216ce33025", "url": "https://github.com/google/ground-android/commit/ea11d40eba8d25e81144e257c31797216ce33025", "message": "Create inner data class for PhotoStorageResource", "committedDate": "2020-06-19T15:32:39Z", "type": "commit"}]}