{"pr_number": 473, "pr_title": "[Settings] Add basic settings page", "pr_createdAt": "2020-05-21T09:57:18Z", "pr_url": "https://github.com/google/ground-android/pull/473", "timeline": [{"oid": "b600aa2f5d2eb177eb116986fcd92e233cebef4f", "url": "https://github.com/google/ground-android/commit/b600aa2f5d2eb177eb116986fcd92e233cebef4f", "message": "Add androidx.preference library\n\nandroid.preference is deprecated (https://developer.android.com/guide/topics/ui/settings)", "committedDate": "2020-05-20T07:49:22Z", "type": "commit"}, {"oid": "316965cead1da20b7c58f3eafcc6b6c2beffc877", "url": "https://github.com/google/ground-android/commit/316965cead1da20b7c58f3eafcc6b6c2beffc877", "message": "Add vector settings icon", "committedDate": "2020-05-21T08:23:09Z", "type": "commit"}, {"oid": "817a3d364fcf3a1cbaa48b467f553c3edd95e797", "url": "https://github.com/google/ground-android/commit/817a3d364fcf3a1cbaa48b467f553c3edd95e797", "message": "Add settings to nav menu xml", "committedDate": "2020-05-21T08:23:48Z", "type": "commit"}, {"oid": "bbc03a4389f0a10a0b590b5d10ecea7b6135dd54", "url": "https://github.com/google/ground-android/commit/bbc03a4389f0a10a0b590b5d10ecea7b6135dd54", "message": "Add settings fragment with test preferences", "committedDate": "2020-05-21T08:24:29Z", "type": "commit"}, {"oid": "88af3afa3e71f1d15ff3a707e261802d7cbdc53b", "url": "https://github.com/google/ground-android/commit/88af3afa3e71f1d15ff3a707e261802d7cbdc53b", "message": "Add Settings to nav graph", "committedDate": "2020-05-21T08:24:52Z", "type": "commit"}, {"oid": "b384b452b04042bca733714b109b60e02685cd00", "url": "https://github.com/google/ground-android/commit/b384b452b04042bca733714b109b60e02685cd00", "message": "Add click handler in HomeScreenFragment", "committedDate": "2020-05-21T08:25:28Z", "type": "commit"}, {"oid": "a4b47cd8b6a7133d7c8274970059f11b81df77a4", "url": "https://github.com/google/ground-android/commit/a4b47cd8b6a7133d7c8274970059f11b81df77a4", "message": "Add javadoc", "committedDate": "2020-05-21T08:29:47Z", "type": "commit"}, {"oid": "a3bc3098a442fd6172956c8f0211f5e61e6ea44b", "url": "https://github.com/google/ground-android/commit/a3bc3098a442fd6172956c8f0211f5e61e6ea44b", "message": "Add more meaningful preferences", "committedDate": "2020-05-21T08:44:03Z", "type": "commit"}, {"oid": "2ef1a2b9a3d130c885fe7931af911a656298bcf9", "url": "https://github.com/google/ground-android/commit/2ef1a2b9a3d130c885fe7931af911a656298bcf9", "message": "Add class to manage preference keys", "committedDate": "2020-05-21T09:49:21Z", "type": "commit"}, {"oid": "ded70c0fea302f65eb0d3593dea764c3479d5c35", "url": "https://github.com/google/ground-android/commit/ded70c0fea302f65eb0d3593dea764c3479d5c35", "message": "Add preference handlers", "committedDate": "2020-05-21T09:52:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU2MDE0Mg==", "url": "https://github.com/google/ground-android/pull/473#discussion_r428560142", "bodyText": "I tried to get the height of the view from binding. But it always returns 0 for the first time. Anyone knows why?\nThe reason we have to add top margin is to fit the preferences layout under the toolbar. There is no standard practice around how to add a toolbar because official docs recommend using the PreferenceFragment within an Activity. In our case, the activity doesn't have a toolbar. Any guidelines or suggestions are most welcome!", "author": "shobhitagarwal1612", "createdAt": "2020-05-21T10:01:46Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/settings/SettingsFragment.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.settings;\n+\n+import android.content.Intent;\n+import android.net.Uri;\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.FrameLayout.LayoutParams;\n+import android.widget.Toast;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.preference.Preference;\n+import androidx.preference.Preference.OnPreferenceChangeListener;\n+import androidx.preference.Preference.OnPreferenceClickListener;\n+import androidx.preference.PreferenceFragmentCompat;\n+import com.google.android.gnd.MainActivity;\n+import com.google.android.gnd.R;\n+import com.google.android.gnd.databinding.SettingsFragBinding;\n+\n+/**\n+ * Fragment containing app preferences saved as shared preferences.\n+ *\n+ * <p>NOTE: It uses {@link PreferenceFragmentCompat} instead of {@link\n+ * com.google.android.gnd.ui.common.AbstractFragment}, so dagger can't inject into it like it does\n+ * in other fragments.\n+ *\n+ * <p>TODO: Create dagger module and support injection into this fragment.\n+ */\n+public class SettingsFragment extends PreferenceFragmentCompat\n+    implements OnPreferenceChangeListener, OnPreferenceClickListener {\n+\n+  @Override\n+  public View onCreateView(\n+      @NonNull LayoutInflater inflater,\n+      @Nullable ViewGroup container,\n+      @Nullable Bundle savedInstanceState) {\n+    super.onCreateView(inflater, container, savedInstanceState);\n+    SettingsFragBinding binding = SettingsFragBinding.inflate(inflater, container, true);\n+    binding.setLifecycleOwner(this);\n+    ((MainActivity) getActivity()).setActionBar(binding.settingsToolbar, true);\n+    return super.onCreateView(inflater, container, savedInstanceState);\n+  }\n+\n+  @Override\n+  public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n+    super.onViewCreated(view, savedInstanceState);\n+\n+    // TODO: Set dynamically by calculating the actual height of toolbar\n+    int topMargin = 108;\n+\n+    LayoutParams params = (LayoutParams) getListView().getLayoutParams();\n+    params.setMargins(0, topMargin, 0, 0);\n+    getListView().setLayoutParams(params);", "originalCommit": "ded70c0fea302f65eb0d3593dea764c3479d5c35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMxOTEzNw==", "url": "https://github.com/google/ground-android/pull/473#discussion_r429319137", "bodyText": "Removed", "author": "shobhitagarwal1612", "createdAt": "2020-05-22T15:38:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU2MDE0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "28341c418ebe80467f34240df6d32670d6304c95", "chunk": "diff --git a/gnd/src/main/java/com/google/android/gnd/ui/settings/SettingsFragment.java b/gnd/src/main/java/com/google/android/gnd/ui/settings/SettingsFragment.java\nindex 70ebc93d..1dc4258d 100644\n--- a/gnd/src/main/java/com/google/android/gnd/ui/settings/SettingsFragment.java\n+++ b/gnd/src/main/java/com/google/android/gnd/ui/settings/SettingsFragment.java\n\n@@ -91,6 +91,8 @@ public class SettingsFragment extends PreferenceFragmentCompat\n       case Keys.OFFLINE_AREAS:\n         Toast.makeText(getContext(), \"Not yet implemented\", Toast.LENGTH_SHORT).show();\n         break;\n+      default:\n+        break;\n     }\n     return true;\n   }\n"}}, {"oid": "28341c418ebe80467f34240df6d32670d6304c95", "url": "https://github.com/google/ground-android/commit/28341c418ebe80467f34240df6d32670d6304c95", "message": "Add missing default", "committedDate": "2020-05-21T10:05:45Z", "type": "commit"}, {"oid": "778d3a0728730b3a65fbee2817e183bef33cfd4b", "url": "https://github.com/google/ground-android/commit/778d3a0728730b3a65fbee2817e183bef33cfd4b", "message": "Fix lint", "committedDate": "2020-05-21T10:07:06Z", "type": "commit"}, {"oid": "f2fe98f80701107937d5c0eb5c1e013927b8d5e4", "url": "https://github.com/google/ground-android/commit/f2fe98f80701107937d5c0eb5c1e013927b8d5e4", "message": "Make Keys package private", "committedDate": "2020-05-21T10:08:49Z", "type": "commit"}, {"oid": "3366561b56b8813368730784047fade80ea44115", "url": "https://github.com/google/ground-android/commit/3366561b56b8813368730784047fade80ea44115", "message": "Merge branch 'master' into issue-424", "committedDate": "2020-05-21T10:28:16Z", "type": "commit"}, {"oid": "b3da65e3dad03f36d0f6137ea0f1f321f11a3c13", "url": "https://github.com/google/ground-android/commit/b3da65e3dad03f36d0f6137ea0f1f321f11a3c13", "message": "Reformat AndroidManifest.xml", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "e704b8982335070970ab8c96eda3162a66b51b7e", "url": "https://github.com/google/ground-android/commit/e704b8982335070970ab8c96eda3162a66b51b7e", "message": "Remove obvious comments", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "bdcec45481d4107b95e1a9b525ac7f0d915b48a5", "url": "https://github.com/google/ground-android/commit/bdcec45481d4107b95e1a9b525ac7f0d915b48a5", "message": "Remove toolbar inflation from SettingsFragment", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "70025af5a1d605ba27dc61f9b2c0aaa4e00fc5ab", "url": "https://github.com/google/ground-android/commit/70025af5a1d605ba27dc61f9b2c0aaa4e00fc5ab", "message": "Rename xml and add container for adding SettingsFragment", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "4251dc1a62248b568eca50ac2d77da04a5d83c7c", "url": "https://github.com/google/ground-android/commit/4251dc1a62248b568eca50ac2d77da04a5d83c7c", "message": "Add settings activity and load SettingsFragment", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "a3bd471099b7d726518a0bf197c4af16ca1ffad9", "url": "https://github.com/google/ground-android/commit/a3bd471099b7d726518a0bf197c4af16ca1ffad9", "message": "Replace destination to activity in nav_graph", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "f721cb8b2c306999424c6fc7e665f03243d516d6", "url": "https://github.com/google/ground-android/commit/f721cb8b2c306999424c6fc7e665f03243d516d6", "message": "Create a super abstract activity with helper methods", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "6a58b9ff6e9196cebe48f8a4e3591084eacd92f7", "url": "https://github.com/google/ground-android/commit/6a58b9ff6e9196cebe48f8a4e3591084eacd92f7", "message": "Extend AbstractActivity and cleanup", "committedDate": "2020-05-22T15:35:23Z", "type": "commit"}, {"oid": "1c7b3c9aab2ec5ad6bbe3257ce2d6e149afdfe40", "url": "https://github.com/google/ground-android/commit/1c7b3c9aab2ec5ad6bbe3257ce2d6e149afdfe40", "message": "Merge branch 'master' into issue-424", "committedDate": "2020-05-24T17:16:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1NzQzMw==", "url": "https://github.com/google/ground-android/pull/473#discussion_r429657433", "bodyText": "Can these be represented as String resources? Seems unfortunate we need to duplicate these keys in two places.", "author": "gino-m", "createdAt": "2020-05-24T17:22:32Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/settings/Keys.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.android.gnd.ui.settings;\n+\n+/** These keys should match 1:1 in res/xml/preferences.xml. */", "originalCommit": "1c7b3c9aab2ec5ad6bbe3257ce2d6e149afdfe40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY2NTM1OA==", "url": "https://github.com/google/ground-android/pull/473#discussion_r429665358", "bodyText": "Sadly, no. preferences.xml only accepts string constants as inputs, not string resources.", "author": "shobhitagarwal1612", "createdAt": "2020-05-24T19:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY1NzQzMw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "24a0977c04104ced8b6249e2759c02c192cc7d91", "url": "https://github.com/google/ground-android/commit/24a0977c04104ced8b6249e2759c02c192cc7d91", "message": "Add end line", "committedDate": "2020-05-24T19:03:04Z", "type": "commit"}, {"oid": "3215955c52f5ec975704105f0bc662020a99c2ea", "url": "https://github.com/google/ground-android/commit/3215955c52f5ec975704105f0bc662020a99c2ea", "message": "Merge branch 'master' into issue-424", "committedDate": "2020-05-26T20:10:17Z", "type": "commit"}]}