{"pr_number": 4401, "pr_title": "Use swipe to refresh", "pr_createdAt": "2020-09-03T11:56:21Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4401", "timeline": [{"oid": "aabada4957c3be0dfdf2163042d12cb9cda3243f", "url": "https://github.com/AntennaPod/AntennaPod/commit/aabada4957c3be0dfdf2163042d12cb9cda3243f", "message": "add swipe to refresh to subscriptions", "committedDate": "2020-09-03T11:52:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MTk5Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498491992", "bodyText": "I think this would be easier with new Handler().postDelayed(() -> ..., 800)", "author": "ByteHamster", "createdAt": "2020-10-01T20:20:16Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -102,6 +104,20 @@ public View onCreateView(LayoutInflater inflater, ViewGroup container,\n \n         feedsFilteredMsg = root.findViewById(R.id.feeds_filtered_message);\n         feedsFilteredMsg.setOnClickListener((l) -> FeedFilterDialog.showDialog(requireContext()));\n+\n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swiperefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Thread(() -> {\n+                try {\n+                    Thread.sleep(800);\n+                } catch (Exception ignore) {\n+                }\n+                getActivity().runOnUiThread(() -> {\n+                    swipeRefreshLayout.setRefreshing(false);\n+                });", "originalCommit": "aabada4957c3be0dfdf2163042d12cb9cda3243f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "53fcdfabc183f5c3d7c8b01b2bdb8e0ddfb2eb90", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\nindex 8affd503e..f3be3196c 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n\n@@ -108,15 +109,9 @@ public class SubscriptionFragment extends Fragment {\n         SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swiperefresh);\n         swipeRefreshLayout.setOnRefreshListener(() -> {\n             AutoUpdateManager.runImmediate(requireContext());\n-            new Thread(() -> {\n-                try {\n-                    Thread.sleep(800);\n-                } catch (Exception ignore) {\n-                }\n-                getActivity().runOnUiThread(() -> {\n-                    swipeRefreshLayout.setRefreshing(false);\n-                });\n-            }).start();\n+            new Handler().postDelayed(() ->\n+                            getActivity().runOnUiThread(() -> swipeRefreshLayout.setRefreshing(false))\n+                    , 800);\n         });\n         return root;\n     }\n"}}, {"oid": "53fcdfabc183f5c3d7c8b01b2bdb8e0ddfb2eb90", "url": "https://github.com/AntennaPod/AntennaPod/commit/53fcdfabc183f5c3d7c8b01b2bdb8e0ddfb2eb90", "message": "use postDelayed", "committedDate": "2020-10-02T15:00:14Z", "type": "commit"}, {"oid": "70b92a08cfe32a5d1250535ade2e7cc09811bae4", "url": "https://github.com/AntennaPod/AntennaPod/commit/70b92a08cfe32a5d1250535ade2e7cc09811bae4", "message": "add swipeToRefresh to EpisodesListFragment and FeedItemlistFragment", "committedDate": "2020-10-02T15:13:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg4OTExOQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498889119", "bodyText": "I think you don't need getActivity().runOnUiThread. Handlers that are created on the UI thread run their runnable on the UI thread, too.", "author": "ByteHamster", "createdAt": "2020-10-02T15:21:39Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java", "diffHunk": "@@ -214,6 +217,14 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n             ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);\n         }\n \n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Handler().postDelayed(() ->\n+                            getActivity().runOnUiThread(() -> swipeRefreshLayout.setRefreshing(false))", "originalCommit": "70b92a08cfe32a5d1250535ade2e7cc09811bae4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6a8007b388491f931d73a55bea289148536478ad", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\nindex 6fe94f06c..3d5b33522 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n\n@@ -220,9 +220,7 @@ public abstract class EpisodesListFragment extends Fragment {\n         SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n         swipeRefreshLayout.setOnRefreshListener(() -> {\n             AutoUpdateManager.runImmediate(requireContext());\n-            new Handler().postDelayed(() ->\n-                            getActivity().runOnUiThread(() -> swipeRefreshLayout.setRefreshing(false))\n-                    , 1000);\n+            new Handler().postDelayed(() -> swipeRefreshLayout.setRefreshing(false), 1000);\n         });\n \n         progLoading = root.findViewById(R.id.progLoading);\n"}}, {"oid": "6a8007b388491f931d73a55bea289148536478ad", "url": "https://github.com/AntennaPod/AntennaPod/commit/6a8007b388491f931d73a55bea289148536478ad", "message": "update handler.postDelayed", "committedDate": "2020-10-02T15:41:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkyMTI2MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498921260", "bodyText": "1 second feels a bit too much to me. This is sometimes more than what it takes to actually refresh. What about 500ms?", "author": "ByteHamster", "createdAt": "2020-10-02T16:20:39Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java", "diffHunk": "@@ -214,6 +217,12 @@ public View onCreateView(@NonNull LayoutInflater inflater, ViewGroup container,\n             ((SimpleItemAnimator) animator).setSupportsChangeAnimations(false);\n         }\n \n+        SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n+        swipeRefreshLayout.setOnRefreshListener(() -> {\n+            AutoUpdateManager.runImmediate(requireContext());\n+            new Handler().postDelayed(() -> swipeRefreshLayout.setRefreshing(false), 1000);", "originalCommit": "6a8007b388491f931d73a55bea289148536478ad", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\nindex 3d5b33522..d98d9f8d1 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/EpisodesListFragment.java\n\n@@ -220,7 +220,7 @@ public abstract class EpisodesListFragment extends Fragment {\n         SwipeRefreshLayout swipeRefreshLayout = root.findViewById(R.id.swipeRefresh);\n         swipeRefreshLayout.setOnRefreshListener(() -> {\n             AutoUpdateManager.runImmediate(requireContext());\n-            new Handler().postDelayed(() -> swipeRefreshLayout.setRefreshing(false), 1000);\n+            new Handler().postDelayed(() -> swipeRefreshLayout.setRefreshing(false), SubscriptionFragment.SWIPE_TO_REFRESH_DURATION);\n         });\n \n         progLoading = root.findViewById(R.id.progLoading);\n"}}, {"oid": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "url": "https://github.com/AntennaPod/AntennaPod/commit/69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "message": "fix padding", "committedDate": "2020-10-02T18:11:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NjE3MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r498976170", "bodyText": "Is there any class where constants like this one are saved, I did not find an appropriate one.\nFurthermore I changed the duration to 750ms which is the time for one repetition.", "author": "asdoi", "createdAt": "2020-10-02T18:14:42Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -66,6 +69,8 @@\n     private static final String PREFS = \"SubscriptionFragment\";\n     private static final String PREF_NUM_COLUMNS = \"columns\";\n \n+    public static final int SWIPE_TO_REFRESH_DURATION = 750;", "originalCommit": "69d1b4933f5ccc2e19ead25bd3abb088d1d7a995", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0Mjg0Mw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4401#discussion_r499042843", "bodyText": "Good question. I don't think we have a class for such constants. The most Android way would probably be to use the core/res/values/integers.xml file and then load with getResources().getInteger(R.integer.xy)", "author": "ByteHamster", "createdAt": "2020-10-02T20:46:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NjE3MA=="}], "type": "inlineReview", "revised_code": {"commit": "81f33c24a62418f461ceac830500f01a5bcb528e", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\nindex bff1f4d93..b68ebfd5e 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n\n@@ -69,8 +69,6 @@ public class SubscriptionFragment extends Fragment {\n     private static final String PREFS = \"SubscriptionFragment\";\n     private static final String PREF_NUM_COLUMNS = \"columns\";\n \n-    public static final int SWIPE_TO_REFRESH_DURATION = 750;\n-\n     private GridView subscriptionGridLayout;\n     private DBReader.NavDrawerData navDrawerData;\n     private SubscriptionsAdapter subscriptionAdapter;\n"}}, {"oid": "81f33c24a62418f461ceac830500f01a5bcb528e", "url": "https://github.com/AntennaPod/AntennaPod/commit/81f33c24a62418f461ceac830500f01a5bcb528e", "message": "move duration const to integers.xml", "committedDate": "2020-10-02T21:14:05Z", "type": "commit"}, {"oid": "3e180a088fc5596b8ae6416a11be65bb37110f6b", "url": "https://github.com/AntennaPod/AntennaPod/commit/3e180a088fc5596b8ae6416a11be65bb37110f6b", "message": "update padding", "committedDate": "2020-10-03T12:41:36Z", "type": "commit"}]}