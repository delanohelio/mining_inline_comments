{"pr_number": 4522, "pr_title": "Add chip when searching for specific feed", "pr_createdAt": "2020-10-12T15:10:28Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4522", "timeline": [{"oid": "b5f58e3696dbb52c1c8fbb5716dc947818e9830c", "url": "https://github.com/AntennaPod/AntennaPod/commit/b5f58e3696dbb52c1c8fbb5716dc947818e9830c", "message": "add chip when searching for specific feed", "committedDate": "2020-10-12T15:05:21Z", "type": "commit"}, {"oid": "919683a14942c205ea7a162bbf4e4ab17eb60e8f", "url": "https://github.com/AntennaPod/AntennaPod/commit/919683a14942c205ea7a162bbf4e4ab17eb60e8f", "message": "fix search_fragment view to adjust for chip", "committedDate": "2020-10-12T15:07:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NjMyNg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r503746326", "bodyText": "If the feed is null, the menu items should still be setup. Just the feed title can be left out. That prevents possible flickering when menu items are displayed/hidden for some feeds.", "author": "ByteHamster", "createdAt": "2020-10-13T08:02:30Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java", "diffHunk": "@@ -252,7 +252,9 @@ public void onCreateOptionsMenu(@NonNull Menu menu, @NonNull MenuInflater inflat\n         optionsMenu = menu;\n         FeedMenuHandler.onCreateOptionsMenu(inflater, menu);\n         iconTintManager.updateTint();\n-        MenuItemUtils.setupSearchItem(menu, (MainActivity) getActivity(), feedID);\n+        if (feed != null) {\n+            MenuItemUtils.setupSearchItem(menu, (MainActivity) getActivity(), feedID, feed.getTitle());\n+        }", "originalCommit": "919683a14942c205ea7a162bbf4e4ab17eb60e8f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "749524d9905fd52671e8abbfbff606d5ea52c855", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\nindex ea16b76a0..cef5e13e7 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/FeedItemlistFragment.java\n\n@@ -254,6 +254,8 @@ public class FeedItemlistFragment extends Fragment implements AdapterView.OnItem\n         iconTintManager.updateTint();\n         if (feed != null) {\n             MenuItemUtils.setupSearchItem(menu, (MainActivity) getActivity(), feedID, feed.getTitle());\n+        } else {\n+            MenuItemUtils.setupSearchItem(menu, (MainActivity) getActivity(), feedID, \"\");\n         }\n         if (feed == null || feed.getLink() == null) {\n             menu.findItem(R.id.share_link_item).setVisible(false);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NzE0Mg==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r503747142", "bodyText": "Please rename to private String feedTitle (and move a bit down). Static members that store actual data can cause issues when using the class multiple times.", "author": "ByteHamster", "createdAt": "2020-10-13T08:03:54Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java", "diffHunk": "@@ -53,6 +56,7 @@\n     private static final String TAG = \"SearchFragment\";\n     private static final String ARG_QUERY = \"query\";\n     private static final String ARG_FEED = \"feed\";\n+    private static String FEED_TITLE = \"\";", "originalCommit": "919683a14942c205ea7a162bbf4e4ab17eb60e8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyMDQ4Ng==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r504120486", "bodyText": "Understood, the problem would be that I cant reference non static members from the newInstance static method, how should I proceed?", "author": "Xeitor", "createdAt": "2020-10-13T17:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyNzAzMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r504127030", "bodyText": "I was able to do It with this line:\nfragment.feedTitle = feedTitle;\nis this the correct approach?", "author": "Xeitor", "createdAt": "2020-10-13T17:17:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMzExOA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r504133118", "bodyText": "I was able to do It with this line: fragment.feedTitle = feedTitle;\n\nThis is a problem when the Android system recreates the fragment after the app was in background\nHave a look at the comment below. You can add it as an argument (fragment.getArguments().putString(ARG_FEED_NAME, name);).", "author": "ByteHamster", "createdAt": "2020-10-13T17:27:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NzE0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2MDgyMA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r504160820", "bodyText": "Ohhhh, know I understand... I am about to push all the changes now :)", "author": "Xeitor", "createdAt": "2020-10-13T18:13:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0NzE0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "749524d9905fd52671e8abbfbff606d5ea52c855", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\nindex f4d83795b..2061a8ba4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n\n@@ -56,7 +56,7 @@ public class SearchFragment extends Fragment {\n     private static final String TAG = \"SearchFragment\";\n     private static final String ARG_QUERY = \"query\";\n     private static final String ARG_FEED = \"feed\";\n-    private static String FEED_TITLE = \"\";\n+    private static final String ARG_FEED_NAME = \"feedName\";\n \n     private EpisodeItemListAdapter adapter;\n     private FeedSearchResultAdapter adapterFeeds;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc0ODA4NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r503748085", "bodyText": "Please add an argument instead of using a static variable. You can transfer the title just like the ID in the line above.", "author": "ByteHamster", "createdAt": "2020-10-13T08:05:25Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java", "diffHunk": "@@ -73,16 +78,18 @@ public static SearchFragment newInstance(String query) {\n         Bundle args = new Bundle();\n         args.putString(ARG_QUERY, query);\n         args.putLong(ARG_FEED, 0);\n+        args.putString(FEED_TITLE, \"\");\n         fragment.setArguments(args);\n         return fragment;\n     }\n \n     /**\n      * Create a new SearchFragment that searches one specific feed.\n      */\n-    public static SearchFragment newInstance(String query, long feed) {\n+    public static SearchFragment newInstance(String query, long feed, String feedTitle) {\n         SearchFragment fragment = newInstance(query);\n         fragment.getArguments().putLong(ARG_FEED, feed);\n+        FEED_TITLE = feedTitle;", "originalCommit": "919683a14942c205ea7a162bbf4e4ab17eb60e8f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "749524d9905fd52671e8abbfbff606d5ea52c855", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\nindex f4d83795b..2061a8ba4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n\n@@ -78,7 +78,6 @@ public class SearchFragment extends Fragment {\n         Bundle args = new Bundle();\n         args.putString(ARG_QUERY, query);\n         args.putLong(ARG_FEED, 0);\n-        args.putString(FEED_TITLE, \"\");\n         fragment.setArguments(args);\n         return fragment;\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc1MTcwMw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r503751703", "bodyText": "Please move this to the results section of the search method. This makes it possible to add a close button to the chip (which would greatly improve the user experience) with something like:\n        app:closeIconVisible=\"true\"\n\n        chip.setOnCloseIconClickListener(v -> {\n            getArguments().putLong(ARG_FEED, 0);\n            search();\n        });", "author": "ByteHamster", "createdAt": "2020-10-13T08:11:07Z", "path": "app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java", "diffHunk": "@@ -133,6 +140,13 @@ public View onCreateView(@NonNull LayoutInflater inflater, @Nullable ViewGroup c\n         emptyViewHandler.setIcon(R.attr.action_search);\n         emptyViewHandler.setTitle(R.string.search_status_no_results);\n         EventBus.getDefault().register(this);\n+\n+        chip = layout.findViewById(R.id.feed_title_chip);\n+        if ((getArguments().getLong(ARG_FEED) != 0) && !FEED_TITLE.isEmpty()) {\n+            chip.setText(FEED_TITLE);\n+        } else {\n+            chip.setVisibility(View.GONE);\n+        }", "originalCommit": "919683a14942c205ea7a162bbf4e4ab17eb60e8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMzE1NQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4522#discussion_r504133155", "bodyText": "Wow, really liked the feature. Wouldn't have thought about it\nAdding  it too.", "author": "Xeitor", "createdAt": "2020-10-13T17:27:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc1MTcwMw=="}], "type": "inlineReview", "revised_code": {"commit": "749524d9905fd52671e8abbfbff606d5ea52c855", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\nindex f4d83795b..2061a8ba4 100644\n--- a/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n+++ b/app/src/main/java/de/danoeh/antennapod/fragment/SearchFragment.java\n\n@@ -142,11 +141,10 @@ public class SearchFragment extends Fragment {\n         EventBus.getDefault().register(this);\n \n         chip = layout.findViewById(R.id.feed_title_chip);\n-        if ((getArguments().getLong(ARG_FEED) != 0) && !FEED_TITLE.isEmpty()) {\n-            chip.setText(FEED_TITLE);\n-        } else {\n-            chip.setVisibility(View.GONE);\n-        }\n+        chip.setOnCloseIconClickListener(v -> {\n+            getArguments().putLong(ARG_FEED, 0);\n+            search();\n+        });\n         return layout;\n     }\n \n"}}, {"oid": "749524d9905fd52671e8abbfbff606d5ea52c855", "url": "https://github.com/AntennaPod/AntennaPod/commit/749524d9905fd52671e8abbfbff606d5ea52c855", "message": "fix some code styles and add close chip feature", "committedDate": "2020-10-13T18:16:50Z", "type": "commit"}]}