{"pr_number": 4627, "pr_title": "Show \"include in auto downloads\" checkbox on adding podcast", "pr_createdAt": "2020-11-01T14:14:00Z", "pr_url": "https://github.com/AntennaPod/AntennaPod/pull/4627", "timeline": [{"oid": "715b25bb2ea286aca02d008fad7f7c49ce8815a7", "url": "https://github.com/AntennaPod/AntennaPod/commit/715b25bb2ea286aca02d008fad7f7c49ce8815a7", "message": "show \"include in auto downloads\" checkbox on adding podcast", "committedDate": "2020-11-01T14:12:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzNjY3MQ==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4627#discussion_r515636671", "bodyText": "Is this needed? I think the checkbox is only displayed if auto download is enabled, anyway.", "author": "ByteHamster", "createdAt": "2020-11-01T15:38:58Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -114,6 +115,7 @@ protected void onCreate(Bundle savedInstanceState) {\n \n         viewBinding.transparentBackground.setOnClickListener(v -> finish());\n         viewBinding.card.setOnClickListener(null);\n+        viewBinding.autoDownloadCheckBox.setChecked(UserPreferences.isEnableAutodownload());", "originalCommit": "715b25bb2ea286aca02d008fad7f7c49ce8815a7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "213b7a9190e96a40355705b093983c32961735f2", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex 91354bb7e..0559fccde 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n\n@@ -115,7 +115,6 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n \n         viewBinding.transparentBackground.setOnClickListener(v -> finish());\n         viewBinding.card.setOnClickListener(null);\n-        viewBinding.autoDownloadCheckBox.setChecked(UserPreferences.isEnableAutodownload());\n \n         String feedUrl = null;\n         if (getIntent().hasExtra(ARG_FEEDURL)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYzNzA0MA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4627#discussion_r515637040", "bodyText": "Could you please move setting the visibility to one central location? I am having a hard time understanding why it needs to be modified here and in the else branch.", "author": "ByteHamster", "createdAt": "2020-11-01T15:42:20Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -505,13 +507,34 @@ private void handleUpdatedFeedStatus(Feed feed) {\n             if (DownloadRequester.getInstance().isDownloadingFile(feed.getDownload_url())) {\n                 viewBinding.subscribeButton.setEnabled(false);\n                 viewBinding.subscribeButton.setText(R.string.subscribing_label);\n+                if (UserPreferences.isEnableAutodownload()) {\n+                    LinearLayout.LayoutParams layoutParams\n+                            = (LinearLayout.LayoutParams) viewBinding.subscribeButton.getLayoutParams();\n+                    layoutParams.setMargins(16, 16, 16, 0);\n+                    viewBinding.subscribeButton.setLayoutParams(layoutParams);\n+                    viewBinding.autoDownloadCheckBox.setVisibility(View.VISIBLE);\n+                }", "originalCommit": "715b25bb2ea286aca02d008fad7f7c49ce8815a7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "213b7a9190e96a40355705b093983c32961735f2", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex 91354bb7e..0559fccde 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n\n@@ -507,19 +506,12 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n             if (DownloadRequester.getInstance().isDownloadingFile(feed.getDownload_url())) {\n                 viewBinding.subscribeButton.setEnabled(false);\n                 viewBinding.subscribeButton.setText(R.string.subscribing_label);\n-                if (UserPreferences.isEnableAutodownload()) {\n-                    LinearLayout.LayoutParams layoutParams\n-                            = (LinearLayout.LayoutParams) viewBinding.subscribeButton.getLayoutParams();\n-                    layoutParams.setMargins(16, 16, 16, 0);\n-                    viewBinding.subscribeButton.setLayoutParams(layoutParams);\n-                    viewBinding.autoDownloadCheckBox.setVisibility(View.VISIBLE);\n-                }\n             } else if (feedInFeedlist(feed)) {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.open_podcast);\n                 if (didPressSubscribe) {\n                     didPressSubscribe = false;\n-                    if (viewBinding.autoDownloadCheckBox.getVisibility() == View.VISIBLE) {\n+                    if (UserPreferences.isEnableAutodownload()) {\n                         Feed feed1 = DBReader.getFeed(getFeedId(feed));\n                         FeedPreferences feedPreferences = feed1.getPreferences();\n                         feedPreferences.setAutoDownload(viewBinding.autoDownloadCheckBox.isChecked());\n"}}, {"oid": "213b7a9190e96a40355705b093983c32961735f2", "url": "https://github.com/AntennaPod/AntennaPod/commit/213b7a9190e96a40355705b093983c32961735f2", "message": "fixes", "committedDate": "2020-11-01T20:55:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5MjY3NA==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4627#discussion_r516092674", "bodyText": "This still modifies the margins from Java code, which is not really elegant (and does not work correctly, depending on screen resolution). Could you please try to find a way to do this from XML?", "author": "ByteHamster", "createdAt": "2020-11-02T16:26:08Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -509,11 +510,26 @@ private void handleUpdatedFeedStatus(Feed feed) {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.open_podcast);\n                 if (didPressSubscribe) {\n+                    didPressSubscribe = false;\n+                    if (UserPreferences.isEnableAutodownload()) {\n+                        Feed feed1 = DBReader.getFeed(getFeedId(feed));\n+                        FeedPreferences feedPreferences = feed1.getPreferences();\n+                        feedPreferences.setAutoDownload(viewBinding.autoDownloadCheckBox.isChecked());\n+                        feed1.savePreferences();\n+                    }\n                     openFeed();\n                 }\n             } else {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.subscribe_label);\n+                if (UserPreferences.isEnableAutodownload()) {\n+                    LinearLayout.LayoutParams layoutParams\n+                            = (LinearLayout.LayoutParams) viewBinding.subscribeButton.getLayoutParams();\n+                    layoutParams.setMargins(16, 16, 16, 0);", "originalCommit": "213b7a9190e96a40355705b093983c32961735f2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "145647e636114eb6f21cad67b1088aa387035fcb", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex 0559fccde..ffc0bc075 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n\n@@ -523,10 +523,6 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.subscribe_label);\n                 if (UserPreferences.isEnableAutodownload()) {\n-                    LinearLayout.LayoutParams layoutParams\n-                            = (LinearLayout.LayoutParams) viewBinding.subscribeButton.getLayoutParams();\n-                    layoutParams.setMargins(16, 16, 16, 0);\n-                    viewBinding.subscribeButton.setLayoutParams(layoutParams);\n                     viewBinding.autoDownloadCheckBox.setChecked(true);\n                     viewBinding.autoDownloadCheckBox.setVisibility(View.VISIBLE);\n                 }\n"}}, {"oid": "145647e636114eb6f21cad67b1088aa387035fcb", "url": "https://github.com/AntennaPod/AntennaPod/commit/145647e636114eb6f21cad67b1088aa387035fcb", "message": "margins in xml", "committedDate": "2020-11-03T14:47:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjc0NDMxNw==", "url": "https://github.com/AntennaPod/AntennaPod/pull/4627#discussion_r516744317", "bodyText": "I think it would be better to do this in XML, too. On my device, the line is executed again just before the settings are updated. That results in all feeds having autodl enabled, regardless of what you do with the checkbox", "author": "ByteHamster", "createdAt": "2020-11-03T15:17:22Z", "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -509,11 +510,22 @@ private void handleUpdatedFeedStatus(Feed feed) {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.open_podcast);\n                 if (didPressSubscribe) {\n+                    didPressSubscribe = false;\n+                    if (UserPreferences.isEnableAutodownload()) {\n+                        Feed feed1 = DBReader.getFeed(getFeedId(feed));\n+                        FeedPreferences feedPreferences = feed1.getPreferences();\n+                        feedPreferences.setAutoDownload(viewBinding.autoDownloadCheckBox.isChecked());\n+                        feed1.savePreferences();\n+                    }\n                     openFeed();\n                 }\n             } else {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.subscribe_label);\n+                if (UserPreferences.isEnableAutodownload()) {\n+                    viewBinding.autoDownloadCheckBox.setChecked(true);", "originalCommit": "145647e636114eb6f21cad67b1088aa387035fcb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d7791f461ea2b120509c66105454d3bbe4ae9a60", "chunk": "diff --git a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\nindex ffc0bc075..2fd537159 100644\n--- a/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n+++ b/app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java\n\n@@ -523,7 +523,6 @@ public class OnlineFeedViewActivity extends AppCompatActivity {\n                 viewBinding.subscribeButton.setEnabled(true);\n                 viewBinding.subscribeButton.setText(R.string.subscribe_label);\n                 if (UserPreferences.isEnableAutodownload()) {\n-                    viewBinding.autoDownloadCheckBox.setChecked(true);\n                     viewBinding.autoDownloadCheckBox.setVisibility(View.VISIBLE);\n                 }\n             }\n"}}, {"oid": "d7791f461ea2b120509c66105454d3bbe4ae9a60", "url": "https://github.com/AntennaPod/AntennaPod/commit/d7791f461ea2b120509c66105454d3bbe4ae9a60", "message": "fix", "committedDate": "2020-11-03T15:26:16Z", "type": "commit"}]}