{"pr_number": 610, "pr_title": "#606 Check correct cross compilation setup", "pr_createdAt": "2020-05-20T12:41:44Z", "pr_url": "https://github.com/gluonhq/substrate/pull/610", "timeline": [{"oid": "60e79750d4f8249403e50de8e11a7c6ab3a09562", "url": "https://github.com/gluonhq/substrate/commit/60e79750d4f8249403e50de8e11a7c6ab3a09562", "message": "#606 Check correct cross compilation setup", "committedDate": "2020-05-20T12:16:05Z", "type": "commit"}, {"oid": "e2a7e2b64a75a49c2bf946660e4d1d9964ad59fe", "url": "https://github.com/gluonhq/substrate/commit/e2a7e2b64a75a49c2bf946660e4d1d9964ad59fe", "message": "Fail fast, before creating targets", "committedDate": "2020-05-20T12:35:55Z", "type": "commit"}, {"oid": "de4cd8d3a5d4b7c016a5b39220c46a89cd8727ce", "url": "https://github.com/gluonhq/substrate/commit/de4cd8d3a5d4b7c016a5b39220c46a89cd8727ce", "message": "Fix test", "committedDate": "2020-05-20T13:47:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1MTU3Mg==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r428051572", "bodyText": "this will fail on Darwin as host and target", "author": "johanvos", "createdAt": "2020-05-20T14:20:00Z", "path": "src/main/java/com/gluonhq/substrate/model/Triplet.java", "diffHunk": "@@ -114,9 +114,9 @@ public boolean canCompileTo(Triplet target) {\n         // if the host os and target os are the same, always return true\n         if (getOs().equals(target.getOs())) return true;\n \n-        // if host is linux and target is ios, fail\n-        return (!Constants.OS_LINUX.equals(getOs()) && !Constants.OS_WINDOWS.equals(getOs())) ||\n-                !Constants.OS_IOS.equals(target.getOs());\n+        // so far, iOS can be built from Mac, Android can be built from Linux\n+        return (OS_DARWIN.equals(getOs()) && Constants.OS_IOS.equals(target.getOs())) ||", "originalCommit": "de4cd8d3a5d4b7c016a5b39220c46a89cd8727ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1MzU3OQ==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r428053579", "bodyText": "if returns true before when host and target are the same.", "author": "jperedadnr", "createdAt": "2020-05-20T14:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1MTU3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "1287bc793d5cf423575c63bcaeb1b6faf64f09cd", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/model/Triplet.java b/src/main/java/com/gluonhq/substrate/model/Triplet.java\nindex 4bf1392..9e470a6 100644\n--- a/src/main/java/com/gluonhq/substrate/model/Triplet.java\n+++ b/src/main/java/com/gluonhq/substrate/model/Triplet.java\n\n@@ -115,7 +115,7 @@ public class Triplet {\n         if (getOs().equals(target.getOs())) return true;\n \n         // so far, iOS can be built from Mac, Android can be built from Linux\n-        return (OS_DARWIN.equals(getOs()) && Constants.OS_IOS.equals(target.getOs())) ||\n+        return (OS_DARWIN.equals(getOs()) && OS_IOS.equals(target.getOs())) ||\n                 (OS_LINUX.equals(getOs()) && OS_ANDROID.equals(target.getOs()));\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5MDA5MQ==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r428090091", "bodyText": "s/Constants.OS_IOS/OS_IOS", "author": "abhinayagarwal", "createdAt": "2020-05-20T15:08:40Z", "path": "src/main/java/com/gluonhq/substrate/model/Triplet.java", "diffHunk": "@@ -114,9 +114,9 @@ public boolean canCompileTo(Triplet target) {\n         // if the host os and target os are the same, always return true\n         if (getOs().equals(target.getOs())) return true;\n \n-        // if host is linux and target is ios, fail\n-        return (!Constants.OS_LINUX.equals(getOs()) && !Constants.OS_WINDOWS.equals(getOs())) ||\n-                !Constants.OS_IOS.equals(target.getOs());\n+        // so far, iOS can be built from Mac, Android can be built from Linux\n+        return (OS_DARWIN.equals(getOs()) && Constants.OS_IOS.equals(target.getOs())) ||", "originalCommit": "de4cd8d3a5d4b7c016a5b39220c46a89cd8727ce", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1287bc793d5cf423575c63bcaeb1b6faf64f09cd", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/model/Triplet.java b/src/main/java/com/gluonhq/substrate/model/Triplet.java\nindex 4bf1392..9e470a6 100644\n--- a/src/main/java/com/gluonhq/substrate/model/Triplet.java\n+++ b/src/main/java/com/gluonhq/substrate/model/Triplet.java\n\n@@ -115,7 +115,7 @@ public class Triplet {\n         if (getOs().equals(target.getOs())) return true;\n \n         // so far, iOS can be built from Mac, Android can be built from Linux\n-        return (OS_DARWIN.equals(getOs()) && Constants.OS_IOS.equals(target.getOs())) ||\n+        return (OS_DARWIN.equals(getOs()) && OS_IOS.equals(target.getOs())) ||\n                 (OS_LINUX.equals(getOs()) && OS_ANDROID.equals(target.getOs()));\n     }\n \n"}}, {"oid": "1287bc793d5cf423575c63bcaeb1b6faf64f09cd", "url": "https://github.com/gluonhq/substrate/commit/1287bc793d5cf423575c63bcaeb1b6faf64f09cd", "message": "Remove unnecessary Constants", "committedDate": "2020-05-20T15:21:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0OTU4Mw==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r429749583", "bodyText": "I don't think this check belongs here. We want to get the targetConfiguration, even if we can't compile to it.\n(e.g. because we want to build in the cloud, or do other operations, e.g. link/run or so, that do not depend on compilation)", "author": "johanvos", "createdAt": "2020-05-25T06:19:17Z", "path": "src/main/java/com/gluonhq/substrate/SubstrateDispatcher.java", "diffHunk": "@@ -310,6 +310,9 @@ public SubstrateDispatcher(Path buildRoot, ProjectConfiguration config) throws I\n     }\n \n     private TargetConfiguration getTargetConfiguration(Triplet targetTriplet) throws IOException {\n+        if (!config.getHostTriplet().canCompileTo(targetTriplet)) {", "originalCommit": "1287bc793d5cf423575c63bcaeb1b6faf64f09cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc5NzMyMg==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r429797322", "bodyText": "Ok, but problem so far is that AndroidTarget will start downloading SDK once the target is set.", "author": "jperedadnr", "createdAt": "2020-05-25T08:16:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0OTU4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTgxMDU3OA==", "url": "https://github.com/gluonhq/substrate/pull/610#discussion_r429810578", "bodyText": "That is wrong, but has nothing to do with cross-compiling.\ne.g. farm build allows for AndroidTarget on mac, but SDK should not be downloaded.", "author": "johanvos", "createdAt": "2020-05-25T08:42:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0OTU4Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "1c1ca104a17508749c1e627f6eb4aade44056b5a", "url": "https://github.com/gluonhq/substrate/commit/1c1ca104a17508749c1e627f6eb4aade44056b5a", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 606-cross", "committedDate": "2020-10-07T14:33:02Z", "type": "commit"}, {"oid": "5f54d732fa027349a6dda2e4fcf7207a62906262", "url": "https://github.com/gluonhq/substrate/commit/5f54d732fa027349a6dda2e4fcf7207a62906262", "message": "Remove duplicated check", "committedDate": "2020-10-07T14:38:06Z", "type": "commit"}]}