{"pr_number": 675, "pr_title": "Check that Android required packages are present", "pr_createdAt": "2020-06-20T15:31:19Z", "pr_url": "https://github.com/gluonhq/substrate/pull/675", "timeline": [{"oid": "efcfe509c11a876cd782806b4e2242bc95ca76c9", "url": "https://github.com/gluonhq/substrate/commit/efcfe509c11a876cd782806b4e2242bc95ca76c9", "message": "Check that Android required packages are present, else install them with Android SdkManager", "committedDate": "2020-06-20T15:30:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MjIxNg==", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443142216", "bodyText": "this looks like all packages will be downloaded, not only the missing ones?", "author": "johanvos", "createdAt": "2020-06-20T16:17:24Z", "path": "src/main/java/com/gluonhq/substrate/util/FileDeps.java", "diffHunk": "@@ -134,6 +137,24 @@ public Path getAndroidNDKPath() throws IOException {\n         return resolvePath(configuration.getAndroidNdkPath(),\"Fatal error, could not install Android NDK \");\n     }\n \n+    /**\n+     * Checks that the required Android packages are present, else proceeds to\n+     * install them\n+     *\n+     * @param androidSdk The path to the Android SDK\n+     * @throws IOException\n+     * @throws InterruptedException\n+     */\n+    public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n+        if (Stream.of(ANDROID_SDK_PACKAGES)\n+                .filter(s -> !s.contains(\"ndk\"))\n+                .map(s -> Path.of(androidSdk, s.split(\";\")))\n+                .anyMatch(p -> !Files.exists(p))) {\n+            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");\n+            fetchFromSdkManager();", "originalCommit": "efcfe509c11a876cd782806b4e2242bc95ca76c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MzMzMw==", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443143333", "bodyText": "No, the SdkManager verifies what is already installed and what needs to be installed or updated.", "author": "jperedadnr", "createdAt": "2020-06-20T16:35:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0MjIxNg=="}], "type": "inlineReview", "revised_code": {"commit": "e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/util/FileDeps.java b/src/main/java/com/gluonhq/substrate/util/FileDeps.java\nindex 023a270..03f1e73 100644\n--- a/src/main/java/com/gluonhq/substrate/util/FileDeps.java\n+++ b/src/main/java/com/gluonhq/substrate/util/FileDeps.java\n\n@@ -146,11 +147,12 @@ public final class FileDeps {\n      * @throws InterruptedException\n      */\n     public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n-        if (Stream.of(ANDROID_SDK_PACKAGES)\n-                .filter(s -> !s.contains(\"ndk\"))\n-                .map(s -> Path.of(androidSdk, s.split(\";\")))\n-                .anyMatch(p -> !Files.exists(p))) {\n-            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");\n+        List<String> missingPackages = Stream.of(ANDROID_SDK_PACKAGES)\n+                .limit(ANDROID_SDK_PACKAGES.length - 1)\n+                .filter(s -> !Files.exists(Path.of(androidSdk, s.split(\";\"))))\n+                .collect(Collectors.toList());\n+        if (!missingPackages.isEmpty()) {\n+            Logger.logInfo(\"Required Android packages not found: \" + missingPackages);\n             fetchFromSdkManager();\n         }\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NDY2OA==", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443144668", "bodyText": "It would be good to print the missing packages here, so that the developer (or we) can verify", "author": "johanvos", "createdAt": "2020-06-20T16:56:14Z", "path": "src/main/java/com/gluonhq/substrate/util/FileDeps.java", "diffHunk": "@@ -134,6 +137,24 @@ public Path getAndroidNDKPath() throws IOException {\n         return resolvePath(configuration.getAndroidNdkPath(),\"Fatal error, could not install Android NDK \");\n     }\n \n+    /**\n+     * Checks that the required Android packages are present, else proceeds to\n+     * install them\n+     *\n+     * @param androidSdk The path to the Android SDK\n+     * @throws IOException\n+     * @throws InterruptedException\n+     */\n+    public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n+        if (Stream.of(ANDROID_SDK_PACKAGES)\n+                .filter(s -> !s.contains(\"ndk\"))\n+                .map(s -> Path.of(androidSdk, s.split(\";\")))\n+                .anyMatch(p -> !Files.exists(p))) {\n+            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");", "originalCommit": "efcfe509c11a876cd782806b4e2242bc95ca76c9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NTU3MA==", "url": "https://github.com/gluonhq/substrate/pull/675#discussion_r443145570", "bodyText": "Fixed", "author": "jperedadnr", "createdAt": "2020-06-20T17:10:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE0NDY2OA=="}], "type": "inlineReview", "revised_code": {"commit": "e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/util/FileDeps.java b/src/main/java/com/gluonhq/substrate/util/FileDeps.java\nindex 023a270..03f1e73 100644\n--- a/src/main/java/com/gluonhq/substrate/util/FileDeps.java\n+++ b/src/main/java/com/gluonhq/substrate/util/FileDeps.java\n\n@@ -146,11 +147,12 @@ public final class FileDeps {\n      * @throws InterruptedException\n      */\n     public void checkAndroidPackages(String androidSdk) throws IOException, InterruptedException {\n-        if (Stream.of(ANDROID_SDK_PACKAGES)\n-                .filter(s -> !s.contains(\"ndk\"))\n-                .map(s -> Path.of(androidSdk, s.split(\";\")))\n-                .anyMatch(p -> !Files.exists(p))) {\n-            Logger.logInfo(\"Some required Android packages were not found, they will be downloaded.\");\n+        List<String> missingPackages = Stream.of(ANDROID_SDK_PACKAGES)\n+                .limit(ANDROID_SDK_PACKAGES.length - 1)\n+                .filter(s -> !Files.exists(Path.of(androidSdk, s.split(\";\"))))\n+                .collect(Collectors.toList());\n+        if (!missingPackages.isEmpty()) {\n+            Logger.logInfo(\"Required Android packages not found: \" + missingPackages);\n             fetchFromSdkManager();\n         }\n     }\n"}}, {"oid": "e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "url": "https://github.com/gluonhq/substrate/commit/e4ab58cfbcdf88ee3680e46f8b1130f42c8dee05", "message": "Log missing packages", "committedDate": "2020-06-20T17:10:30Z", "type": "commit"}]}