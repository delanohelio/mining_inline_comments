{"pr_number": 249, "pr_title": "Use latest Android build-tools", "pr_createdAt": "2020-01-07T17:09:57Z", "pr_url": "https://github.com/gluonhq/substrate/pull/249", "timeline": [{"oid": "dbfde29f54d2164f8b2f3ef2df984a5bf9c0dbc9", "url": "https://github.com/gluonhq/substrate/commit/dbfde29f54d2164f8b2f3ef2df984a5bf9c0dbc9", "message": "Use latest Android build-tools", "committedDate": "2020-01-07T17:08:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg1ODcyNw==", "url": "https://github.com/gluonhq/substrate/pull/249#discussion_r363858727", "bodyText": "Use Files.exists(buildToolsPath) instead", "author": "jperedadnr", "createdAt": "2020-01-07T17:21:33Z", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -360,4 +362,20 @@ private void createDevelopKeystore() throws IOException, InterruptedException {\n \n         System.err.println(\"done creating ks\");\n     }\n+    \n+    private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n+        if (buildToolsPath.toFile().exists()) {", "originalCommit": "dbfde29f54d2164f8b2f3ef2df984a5bf9c0dbc9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "038c82061344bf39363603fdbd300dcd7a6a7b1c", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\nindex 1b39ac4..0f3a820 100644\n--- a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n+++ b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n\n@@ -362,20 +362,26 @@ public class AndroidTargetConfiguration extends PosixTargetConfiguration {\n \n         System.err.println(\"done creating ks\");\n     }\n-    \n+\n     private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Objects.requireNonNull(sdkPath);\n         Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n-        if (buildToolsPath.toFile().exists()) {\n-            Optional<Version> latest = Files.walk(buildToolsPath, 1)\n+        if (Files.exists(buildToolsPath)) {\n+            return Files.walk(buildToolsPath, 1)\n                     .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n                     .map(file -> new Version(file.getFileName().toString()))\n-                    .max(Version::compareTo);\n-            if (latest.isPresent()) {\n-                return latest.get().toString();\n-            }\n+                    .max(Version::compareTo)\n+                    .map(Version::toString)\n+                    .orElseThrow(BuildToolNotFoundException::new);\n         }\n-        throw new IOException(\"Android build tools not found. Please install it and try again.\");\n+        throw new BuildToolNotFoundException();\n         // TODO: If no build tool is found, we can install it using sdkmanager.\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n+\n+    private static class BuildToolNotFoundException extends IOException {\n+        public BuildToolNotFoundException() {\n+            super(\"Android build tools not found. Please install it and try again.\");\n+        }\n+    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg1OTYyOA==", "url": "https://github.com/gluonhq/substrate/pull/249#discussion_r363859628", "bodyText": "Objects.requireNonNull(sdkPath) and Files.exists(sdkPath)?", "author": "jperedadnr", "createdAt": "2020-01-07T17:23:32Z", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -360,4 +362,20 @@ private void createDevelopKeystore() throws IOException, InterruptedException {\n \n         System.err.println(\"done creating ks\");\n     }\n+    \n+    private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Path buildToolsPath = sdkPath.resolve(\"build-tools\");", "originalCommit": "dbfde29f54d2164f8b2f3ef2df984a5bf9c0dbc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI0MDM5OA==", "url": "https://github.com/gluonhq/substrate/pull/249#discussion_r364240398", "bodyText": "Adding a check for Files.exists(buildToolsPath) makes Files.exists(sdkPath) redundant.", "author": "abhinayagarwal", "createdAt": "2020-01-08T13:51:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg1OTYyOA=="}], "type": "inlineReview", "revised_code": {"commit": "038c82061344bf39363603fdbd300dcd7a6a7b1c", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\nindex 1b39ac4..0f3a820 100644\n--- a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n+++ b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n\n@@ -362,20 +362,26 @@ public class AndroidTargetConfiguration extends PosixTargetConfiguration {\n \n         System.err.println(\"done creating ks\");\n     }\n-    \n+\n     private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Objects.requireNonNull(sdkPath);\n         Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n-        if (buildToolsPath.toFile().exists()) {\n-            Optional<Version> latest = Files.walk(buildToolsPath, 1)\n+        if (Files.exists(buildToolsPath)) {\n+            return Files.walk(buildToolsPath, 1)\n                     .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n                     .map(file -> new Version(file.getFileName().toString()))\n-                    .max(Version::compareTo);\n-            if (latest.isPresent()) {\n-                return latest.get().toString();\n-            }\n+                    .max(Version::compareTo)\n+                    .map(Version::toString)\n+                    .orElseThrow(BuildToolNotFoundException::new);\n         }\n-        throw new IOException(\"Android build tools not found. Please install it and try again.\");\n+        throw new BuildToolNotFoundException();\n         // TODO: If no build tool is found, we can install it using sdkmanager.\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n+\n+    private static class BuildToolNotFoundException extends IOException {\n+        public BuildToolNotFoundException() {\n+            super(\"Android build tools not found. Please install it and try again.\");\n+        }\n+    }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzg2MDkzMw==", "url": "https://github.com/gluonhq/substrate/pull/249#discussion_r363860933", "bodyText": "maybe you simplify it to something like return Files.walk().filter().map().max(...).map(toString).orElseThrow(IOException)?", "author": "jperedadnr", "createdAt": "2020-01-07T17:26:22Z", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -360,4 +362,20 @@ private void createDevelopKeystore() throws IOException, InterruptedException {\n \n         System.err.println(\"done creating ks\");\n     }\n+    \n+    private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n+        if (buildToolsPath.toFile().exists()) {\n+            Optional<Version> latest = Files.walk(buildToolsPath, 1)\n+                    .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n+                    .map(file -> new Version(file.getFileName().toString()))\n+                    .max(Version::compareTo);\n+            if (latest.isPresent()) {", "originalCommit": "dbfde29f54d2164f8b2f3ef2df984a5bf9c0dbc9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "038c82061344bf39363603fdbd300dcd7a6a7b1c", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\nindex 1b39ac4..0f3a820 100644\n--- a/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n+++ b/src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java\n\n@@ -362,20 +362,26 @@ public class AndroidTargetConfiguration extends PosixTargetConfiguration {\n \n         System.err.println(\"done creating ks\");\n     }\n-    \n+\n     private String findLatestBuildTool(Path sdkPath) throws IOException {\n+        Objects.requireNonNull(sdkPath);\n         Path buildToolsPath = sdkPath.resolve(\"build-tools\");\n-        if (buildToolsPath.toFile().exists()) {\n-            Optional<Version> latest = Files.walk(buildToolsPath, 1)\n+        if (Files.exists(buildToolsPath)) {\n+            return Files.walk(buildToolsPath, 1)\n                     .filter(file -> Files.isDirectory(file) && !file.equals(buildToolsPath))\n                     .map(file -> new Version(file.getFileName().toString()))\n-                    .max(Version::compareTo);\n-            if (latest.isPresent()) {\n-                return latest.get().toString();\n-            }\n+                    .max(Version::compareTo)\n+                    .map(Version::toString)\n+                    .orElseThrow(BuildToolNotFoundException::new);\n         }\n-        throw new IOException(\"Android build tools not found. Please install it and try again.\");\n+        throw new BuildToolNotFoundException();\n         // TODO: If no build tool is found, we can install it using sdkmanager.\n         //  Currently, sdkmanager doesn't work with JDK 11: https://issuetracker.google.com/issues/67495440\n     }\n+\n+    private static class BuildToolNotFoundException extends IOException {\n+        public BuildToolNotFoundException() {\n+            super(\"Android build tools not found. Please install it and try again.\");\n+        }\n+    }\n }\n"}}, {"oid": "038c82061344bf39363603fdbd300dcd7a6a7b1c", "url": "https://github.com/gluonhq/substrate/commit/038c82061344bf39363603fdbd300dcd7a6a7b1c", "message": "Changes as per review comments", "committedDate": "2020-01-08T13:58:34Z", "type": "commit"}, {"oid": "038c82061344bf39363603fdbd300dcd7a6a7b1c", "url": "https://github.com/gluonhq/substrate/commit/038c82061344bf39363603fdbd300dcd7a6a7b1c", "message": "Changes as per review comments", "committedDate": "2020-01-08T13:58:34Z", "type": "forcePushed"}]}