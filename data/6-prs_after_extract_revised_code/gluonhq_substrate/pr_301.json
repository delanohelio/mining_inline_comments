{"pr_number": 301, "pr_title": "Various android improvements", "pr_createdAt": "2020-01-29T14:14:35Z", "pr_url": "https://github.com/gluonhq/substrate/pull/301", "timeline": [{"oid": "8fcfc67f01ec5d6a7afc6b366ce2672db7ca6f61", "url": "https://github.com/gluonhq/substrate/commit/8fcfc67f01ec5d6a7afc6b366ce2672db7ca6f61", "message": "Start app and see log on `runUntilEnd`, enable non-jfx apps building\n\nFixes to get on par with ios", "committedDate": "2020-01-29T13:12:14Z", "type": "commit"}, {"oid": "0798222fc20f42280b619e1f5b38627151d5791a", "url": "https://github.com/gluonhq/substrate/commit/0798222fc20f42280b619e1f5b38627151d5791a", "message": "Force Travis to rebuild due to transient issues", "committedDate": "2020-01-29T14:57:16Z", "type": "commit"}, {"oid": "36df71b024b04a7ddef78cce26fe91fd27af51eb", "url": "https://github.com/gluonhq/substrate/commit/36df71b024b04a7ddef78cce26fe91fd27af51eb", "message": "Remove log clutter", "committedDate": "2020-01-29T16:33:04Z", "type": "commit"}, {"oid": "6c39a7a603e01b085a78f03ebd6c65b6f2bf4970", "url": "https://github.com/gluonhq/substrate/commit/6c39a7a603e01b085a78f03ebd6c65b6f2bf4970", "message": "Transient issues with travis (+ debug info removal)", "committedDate": "2020-01-29T17:09:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg0NDExOA==", "url": "https://github.com/gluonhq/substrate/pull/301#discussion_r372844118", "bodyText": "this is a nice feature, but I wonder if we should have an option to toggle it on/off (the whole logcat thread). For example, I typically use logcat -v threadtime but depending on what you are doing, you want to try different options.", "author": "johanvos", "createdAt": "2020-01-30T09:38:40Z", "path": "src/main/java/com/gluonhq/substrate/target/AndroidTargetConfiguration.java", "diffHunk": "@@ -242,7 +242,32 @@ public boolean runUntilEnd() throws IOException, InterruptedException {\n         ProcessRunner install = new ProcessRunner(sdkPath.resolve(\"platform-tools\").resolve(\"adb\").toString(),\n                 \"install\", \"-r\", alignedApk);\n         processResult = install.runProcess(\"install\");\n+        if (processResult != 0) throw new IOException(\"Application instalation failed!\");\n+\n+        Runnable logcat = () -> {\n+            try {\n+                ProcessRunner clearLog = new ProcessRunner(sdkPath.resolve(\"platform-tools\").resolve(\"adb\").toString(),\n+                \"logcat\", \"-c\");\n+                clearLog.runProcess(\"clearLog\");\n+\n+                ProcessRunner log = new ProcessRunner(sdkPath.resolve(\"platform-tools\").resolve(\"adb\").toString(),\n+                \"-d\", \"logcat\", \"-v\", \"brief\", \"-v\", \"color\", \"GraalCompiled:V\", \"GraalGluon:V\", \"AndroidRuntime:E\", \"ActivityManager:W\", \"*:S\");", "originalCommit": "6c39a7a603e01b085a78f03ebd6c65b6f2bf4970", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4NTYwNQ==", "url": "https://github.com/gluonhq/substrate/pull/301#discussion_r373285605", "bodyText": "threadtime would display the date and invocation time which are already added by ProcessRunner. I was aiming for most iOS-like option without losing vital information (since Android has no per app filter, several different tags needed to be included in order to catch crash logs). Here is the nice breakdown of logcat format options, so we can decide whether there is more suitable option.\nAbout toggling whole thread I guess we could use verbose configuration option, however I didn't see it used for runtime options yet, and CTRL+C would kill the logcat thread anyway.", "author": "lazar-mitrovic", "createdAt": "2020-01-31T01:58:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg0NDExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQwNTE1OQ==", "url": "https://github.com/gluonhq/substrate/pull/301#discussion_r373405159", "bodyText": "I was actually referring to make the whole log process toggled on/off.\nAs for the treadtime option: thread shows the process + parent process on android, and ProcessRunner doesn't have that. The time from the ProcessRunner is the received time, which can be different from the \"android time\".\nCombining these remarks: the options here are perfect, and they fit well with the ios style.\nThinking about it for a bit longer: you're totally right this should not even be an option. Android is the only platform where \"client:run\" didn't result in a run, so it has to be changed to be in line with the others. We are thinking about other lifecycle events (e.g. install, package), but that is another issue.", "author": "johanvos", "createdAt": "2020-01-31T10:13:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg0NDExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQwNjk5Mw==", "url": "https://github.com/gluonhq/substrate/pull/301#discussion_r373406993", "bodyText": "I guess this option will be the default one you get with client:run, but you can always go to a terminal and run adb with other options if needed.", "author": "jperedadnr", "createdAt": "2020-01-31T10:18:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjg0NDExOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "343e0ba307c79887a1dea86aac91542d00edb522", "url": "https://github.com/gluonhq/substrate/commit/343e0ba307c79887a1dea86aac91542d00edb522", "message": "Merge remote-tracking branch 'gluonhq/master' into androidQoL", "committedDate": "2020-01-30T23:54:42Z", "type": "commit"}]}