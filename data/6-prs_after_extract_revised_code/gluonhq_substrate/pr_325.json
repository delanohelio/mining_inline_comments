{"pr_number": 325, "pr_title": "#318 Check if GraalVM is under Apple\u2019s quarantine and remove it silently", "pr_createdAt": "2020-02-05T09:51:55Z", "pr_url": "https://github.com/gluonhq/substrate/pull/325", "timeline": [{"oid": "75ca36f52bcf9363c25bc593491a2a7b4db31c75", "url": "https://github.com/gluonhq/substrate/commit/75ca36f52bcf9363c25bc593491a2a7b4db31c75", "message": "#318 Check if GraalVM is under Apple\u2019s quarantine and remove it silently", "committedDate": "2020-02-05T09:50:47Z", "type": "commit"}, {"oid": "2033d68c4c1da0ec5f0f655dfd7135ffcdc839d6", "url": "https://github.com/gluonhq/substrate/commit/2033d68c4c1da0ec5f0f655dfd7135ffcdc839d6", "message": "Verify platform before calling getGraalPath", "committedDate": "2020-02-05T11:26:05Z", "type": "commit"}, {"oid": "c21fd39b8739346ccc0eaeae0857479748c4820c", "url": "https://github.com/gluonhq/substrate/commit/c21fd39b8739346ccc0eaeae0857479748c4820c", "message": "Fix test from Linux", "committedDate": "2020-02-05T16:31:49Z", "type": "commit"}, {"oid": "9d23440ff55a6c38ea04f946a8bd362501d82f8c", "url": "https://github.com/gluonhq/substrate/commit/9d23440ff55a6c38ea04f946a8bd362501d82f8c", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 318-xattr", "committedDate": "2020-02-10T12:16:00Z", "type": "commit"}, {"oid": "d985a5655c53af78307402b576bb61d9ff9f374e", "url": "https://github.com/gluonhq/substrate/commit/d985a5655c53af78307402b576bb61d9ff9f374e", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 318-xattr", "committedDate": "2020-02-10T13:11:56Z", "type": "commit"}, {"oid": "4fd347e83d4780d07d20b7138fba3b4db2c4df15", "url": "https://github.com/gluonhq/substrate/commit/4fd347e83d4780d07d20b7138fba3b4db2c4df15", "message": "Fix test on Linux", "committedDate": "2020-02-10T13:34:00Z", "type": "commit"}, {"oid": "f60a6d846bdaa44789b5439a0c919f02ea26f35c", "url": "https://github.com/gluonhq/substrate/commit/f60a6d846bdaa44789b5439a0c919f02ea26f35c", "message": "Check only on Mac OS", "committedDate": "2020-02-10T17:33:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDEwMA==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380154100", "bodyText": "why is this in PosixTargetConfiguration if it is only relevant to MacOS?", "author": "johanvos", "createdAt": "2020-02-17T12:28:38Z", "path": "src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java", "diffHunk": "@@ -38,6 +42,10 @@\n \n     PosixTargetConfiguration(ProcessPaths paths, InternalProjectConfiguration configuration) {\n         super(paths, configuration);\n+\n+        if (new Triplet(Constants.Profile.MACOS).equals(Triplet.fromCurrentOS())) {", "originalCommit": "f60a6d846bdaa44789b5439a0c919f02ea26f35c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NTE3OA==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380155178", "bodyText": "This applies to MacOS and iOS", "author": "jperedadnr", "createdAt": "2020-02-17T12:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1OTI3Mg==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380159272", "bodyText": "that is Darwin, not posix", "author": "johanvos", "createdAt": "2020-02-17T12:40:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE2NjUyMA==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380166520", "bodyText": "However, since this is a check on host and not on target, this does not belong in a TargetConfiguration at all (but probably in SubstrateDispatcher)", "author": "johanvos", "createdAt": "2020-02-17T12:57:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDEwMA=="}], "type": "inlineReview", "revised_code": {"commit": "68649c6247c268d81bf522e2a65855c1c98f8386", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java b/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\nindex 1c581fe..c85bd58 100644\n--- a/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\n+++ b/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\n\n@@ -42,10 +38,6 @@ abstract class PosixTargetConfiguration extends AbstractTargetConfiguration {\n \n     PosixTargetConfiguration(ProcessPaths paths, InternalProjectConfiguration configuration) {\n         super(paths, configuration);\n-\n-        if (new Triplet(Constants.Profile.MACOS).equals(Triplet.fromCurrentOS())) {\n-            checkGraalVMPermissions(configuration.getGraalPath().toString());\n-        }\n     }\n \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDU4MA==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380154580", "bodyText": "similar here. If this is only applicable to Mac, it doesn't belong in Posix", "author": "johanvos", "createdAt": "2020-02-17T12:29:45Z", "path": "src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java", "diffHunk": "@@ -46,4 +54,37 @@ void checkPlatformSpecificClibs(Path clibPath) throws IOException {\n         if (!Files.exists(libjvmPath)) throw new IOException(\"Missing library libjvm.a not in linkpath \"+clibPath);\n     }\n \n+    /**\n+     * Prevent undesired dialogs and build failures when running on MacOs 1.15.0+.", "originalCommit": "f60a6d846bdaa44789b5439a0c919f02ea26f35c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NTMwMw==", "url": "https://github.com/gluonhq/substrate/pull/325#discussion_r380155303", "bodyText": "Same", "author": "jperedadnr", "createdAt": "2020-02-17T12:31:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDE1NDU4MA=="}], "type": "inlineReview", "revised_code": {"commit": "68649c6247c268d81bf522e2a65855c1c98f8386", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java b/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\nindex 1c581fe..c85bd58 100644\n--- a/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\n+++ b/src/main/java/com/gluonhq/substrate/target/PosixTargetConfiguration.java\n\n@@ -54,37 +46,4 @@ abstract class PosixTargetConfiguration extends AbstractTargetConfiguration {\n         if (!Files.exists(libjvmPath)) throw new IOException(\"Missing library libjvm.a not in linkpath \"+clibPath);\n     }\n \n-    /**\n-     * Prevent undesired dialogs and build failures when running on MacOs 1.15.0+.\n-     *\n-     * By default, the OS prevents the access to any non-notarized executable if it\n-     * has been downloaded.\n-     *\n-     * This method will check if the GraalVM folder is under quarantine, and if that\n-     * is the case, it will remove it recursively from all the files, without the\n-     * need of deactivating GateKeeper.\n-     *\n-     * See https://github.com/oracle/graal/issues/1724\n-     *\n-     * @param graalvmHome the path to GraalVM\n-     */\n-    private void checkGraalVMPermissions(String graalvmHome) {\n-        if (graalvmHome == null || graalvmHome.isEmpty()) {\n-            return;\n-        }\n-        Logger.logDebug(\"Checking execution permissions for \" + graalvmHome);\n-        try {\n-            String response = ProcessRunner.runProcessForSingleOutput(\"check attr\", \"xattr\", \"-p\", \"com.apple.quarantine\", graalvmHome);\n-            if (response != null && !response.contains(\"No such xattr\")) {\n-                ProcessRunner runner = new ProcessRunner(\"xattr\", \"-r\", \"-d\", \"com.apple.quarantine\", graalvmHome);\n-                if (runner.runProcess(\"remove quarantine\") != 0) {\n-                    throw new IOException(\"Error removing quarantine from \" + graalvmHome);\n-                }\n-                Logger.logDebug(\"Quarantine attributes removed successfully\");\n-            }\n-        } catch (IOException | InterruptedException e) {\n-            Logger.logFatal(e,\"Error checking execution permissions for \" + graalvmHome);\n-        }\n-    }\n-\n }\n"}}, {"oid": "c6a59915070dc6e90a76d97b5658c75706fa17b1", "url": "https://github.com/gluonhq/substrate/commit/c6a59915070dc6e90a76d97b5658c75706fa17b1", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 318-xattr", "committedDate": "2020-02-17T15:56:25Z", "type": "commit"}, {"oid": "68649c6247c268d81bf522e2a65855c1c98f8386", "url": "https://github.com/gluonhq/substrate/commit/68649c6247c268d81bf522e2a65855c1c98f8386", "message": "Move xattr check to DarwinTargetConfiguration", "committedDate": "2020-02-17T16:11:21Z", "type": "commit"}, {"oid": "f8960e790ea00ee0ee47db4c2f9f48d5656aa988", "url": "https://github.com/gluonhq/substrate/commit/f8960e790ea00ee0ee47db4c2f9f48d5656aa988", "message": "Merge branch 'master' of https://github.com/gluonhq/substrate into 318-xattr", "committedDate": "2020-02-21T10:13:47Z", "type": "commit"}, {"oid": "178c4cdf8758e1706c8838cd537989a283a30011", "url": "https://github.com/gluonhq/substrate/commit/178c4cdf8758e1706c8838cd537989a283a30011", "message": "Move check to InternalProjectConfig", "committedDate": "2020-02-21T11:41:18Z", "type": "commit"}]}