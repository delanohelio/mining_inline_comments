{"pr_number": 690, "pr_title": "Use JAVA_HOME/bin/jar", "pr_createdAt": "2020-07-07T09:12:01Z", "pr_url": "https://github.com/gluonhq/substrate/pull/690", "timeline": [{"oid": "84c9912156f39faa8a5b5a05b211ca4e3a1515c0", "url": "https://github.com/gluonhq/substrate/commit/84c9912156f39faa8a5b5a05b211ca4e3a1515c0", "message": "Use JAVA_HOME/bin/jar", "committedDate": "2020-07-07T09:08:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDczMDg5Mw==", "url": "https://github.com/gluonhq/substrate/pull/690#discussion_r450730893", "bodyText": "Should be jarPath in the exception message.", "author": "tiainen", "createdAt": "2020-07-07T09:27:40Z", "path": "src/main/java/com/gluonhq/substrate/model/ClassPath.java", "diffHunk": "@@ -120,10 +130,26 @@ public String mapWithLibs(Path libsPath, String... libNames) {\n                 if (resourcesPath != null && Files.exists(resourcesPath)) {\n                     FileOps.copyDirectory(resourcesPath, classesPath);\n                 }\n-                Path jar = classesPath.resolve(\"classes.jar\");\n-                ProcessRunner runner = new ProcessRunner(\"jar\", \"cf\", jar.toString(), \"-C\", classesPath.toString(), \".\");\n-                if (runner.runProcess(\"jar\") == 0 && Files.exists(jar)) {\n-                    jars.add(jar.toFile());\n+\n+                String javaPath = System.getenv(\"JAVA_HOME\");\n+                if (javaPath == null || javaPath.isEmpty()) {\n+                    javaPath = System.getenv(\"GRAALVM_HOME\");\n+                    if (javaPath == null || javaPath.isEmpty()) {\n+                        throw new IOException(\"Error: $JAVA_HOME and $GRAALVM_HOME are undefined\");\n+                    }\n+                }\n+                Path jarPath = Path.of(javaPath, \"bin\", \"jar\");\n+                if (!Files.exists(jarPath)) {\n+                    throw new IOException(\"Error: \" + javaPath + \" doesn't exist\");", "originalCommit": "84c9912156f39faa8a5b5a05b211ca4e3a1515c0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2f2d0cf8312149f1e0accbb28cbeb96be82afa58", "chunk": "diff --git a/src/main/java/com/gluonhq/substrate/model/ClassPath.java b/src/main/java/com/gluonhq/substrate/model/ClassPath.java\nindex 96f130a..3c1a723 100644\n--- a/src/main/java/com/gluonhq/substrate/model/ClassPath.java\n+++ b/src/main/java/com/gluonhq/substrate/model/ClassPath.java\n\n@@ -140,7 +140,7 @@ public class ClassPath {\n                 }\n                 Path jarPath = Path.of(javaPath, \"bin\", \"jar\");\n                 if (!Files.exists(jarPath)) {\n-                    throw new IOException(\"Error: \" + javaPath + \" doesn't exist\");\n+                    throw new IOException(\"Error: \" + jarPath + \" doesn't exist\");\n                 }\n \n                 Path classesJar = classesPath.resolve(\"classes.jar\");\n"}}, {"oid": "2f2d0cf8312149f1e0accbb28cbeb96be82afa58", "url": "https://github.com/gluonhq/substrate/commit/2f2d0cf8312149f1e0accbb28cbeb96be82afa58", "message": "Fix typo", "committedDate": "2020-07-07T09:43:45Z", "type": "commit"}]}