{"pr_number": 4587, "pr_title": "Display structured errors immediately", "pr_createdAt": "2020-05-29T17:31:33Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4587", "timeline": [{"oid": "c514e119d50b380b797de22f6952a921c6150056", "url": "https://github.com/flutter/flutter-intellij/commit/c514e119d50b380b797de22f6952a921c6150056", "message": "Add structured errors flag for run", "committedDate": "2020-05-29T16:26:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r432648853", "bodyText": "@DanTup for FYI", "author": "devoncarew", "createdAt": "2020-05-29T17:59:17Z", "path": "src/io/flutter/run/SdkFields.java", "diffHunk": "@@ -129,6 +130,9 @@ public GeneralCommandLine createFlutterSdkRunCommand(@NotNull Project project,\n     if (buildFlavor != null) {\n       args = ArrayUtil.append(args, \"--flavor=\" + buildFlavor);\n     }\n+    if (FlutterSettings.getInstance().isShowStructuredErrors()) {\n+      args = ArrayUtil.append(args, \"--dart-define=flutter.inspector.structuredErrors=true\");", "originalCommit": "c514e119d50b380b797de22f6952a921c6150056", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1MDQ0OA==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r432650448", "bodyText": "Great, this should fix Dart-Code/Dart-Code#1850!\nI presume it's safe to pass --dart-define= to older SDKs and this won't need a version check?", "author": "DanTup", "createdAt": "2020-05-29T18:02:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1NDIxMQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r432654211", "bodyText": "I'm not sure about this - is the concern that an older SDK will break when using --dart-define or this particular flag? If the SDK doesn't consider the flag yet there should be no problem, but I don't know if anything happens if --dart-define doesn't exist.", "author": "helin24", "createdAt": "2020-05-29T18:10:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY1Nzc5Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r432657796", "bodyText": "is the concern that an older SDK will break when using --dart-define or this particular flag?\n\nEither, I guess. I wondered if it's safe for me to just always send this (if structured errors is enabled), or if that might result in errors for users with older Flutter SDKs. As long as it works in the latest stable and later it's probably not a real concern, but since I already have version checks on some flags, it's easy to add one if required to have compatibility with more SDKs.\n(I can test it if nobody knows the answer off-hand, I just thought I'd ask and save the multiple sets of downloads changing between versions \ud83d\ude01)", "author": "DanTup", "createdAt": "2020-05-29T18:18:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY3OTA2Mw==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r432679063", "bodyText": "Yes can you test and update me too? If there is an issue I think I would need a version check as well.", "author": "helin24", "createdAt": "2020-05-29T19:01:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2NDM2MA==", "url": "https://github.com/flutter/flutter-intellij/pull/4587#discussion_r433164360", "bodyText": "Looks like --dart-define exists in both the current stable, and the previous stable (v1.12), added in flutter/flutter#44083.\nI think I'll add a version in VS Code check since it's easy and I already have it for some other things, but it's probably not entirely necessary.", "author": "DanTup", "createdAt": "2020-06-01T10:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY0ODg1Mw=="}], "type": "inlineReview", "revised_code": {"commit": "578ccb9e01c484449eb2b0be2c291fef8c8b342a", "chunk": "diff --git a/src/io/flutter/run/SdkFields.java b/src/io/flutter/run/SdkFields.java\nindex dd314ca8..df24b35c 100644\n--- a/src/io/flutter/run/SdkFields.java\n+++ b/src/io/flutter/run/SdkFields.java\n\n@@ -130,7 +130,7 @@ public class SdkFields {\n     if (buildFlavor != null) {\n       args = ArrayUtil.append(args, \"--flavor=\" + buildFlavor);\n     }\n-    if (FlutterSettings.getInstance().isShowStructuredErrors()) {\n+    if (FlutterSettings.getInstance().isShowStructuredErrors() && flutterSdk.getVersion().isDartDefineSupported()) {\n       args = ArrayUtil.append(args, \"--dart-define=flutter.inspector.structuredErrors=true\");\n     }\n     command = flutterSdk.flutterRun(root, main.getFile(), device, runMode, flutterLaunchMode, project, args);\n"}}, {"oid": "578ccb9e01c484449eb2b0be2c291fef8c8b342a", "url": "https://github.com/flutter/flutter-intellij/commit/578ccb9e01c484449eb2b0be2c291fef8c8b342a", "message": "Add version check for using --dart-define", "committedDate": "2020-06-01T23:42:22Z", "type": "commit"}]}