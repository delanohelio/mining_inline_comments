{"pr_number": 5011, "pr_title": "Decouple navigation to inspector selection location from IntelliJ.", "pr_createdAt": "2020-10-29T23:35:32Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/5011", "timeline": [{"oid": "8308e02b527f536ab59c1a4a05cf7ce6893745b2", "url": "https://github.com/flutter/flutter-intellij/commit/8308e02b527f536ab59c1a4a05cf7ce6893745b2", "message": "Decouple navigation to inspector selection location from IntelliJ.", "committedDate": "2020-10-29T23:34:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzM4Mw==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514627383", "bodyText": "typo - and", "author": "helin24", "createdAt": "2020-10-29T23:37:36Z", "path": "src/io/flutter/inspector/InspectorService.java", "diffHunk": "@@ -398,12 +398,11 @@ private void onVmServiceReceived(String streamId, Event event) {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Make sure the WidgetInspector on the device switches to show the inspected object\n-          // if the inspected object is a Widget or RenderObject.\n+          // Assume the inspector in Flutter DevTools or the on device\n+          // has already set the selection on the device so we don't have to.\n+          // Having multiple clients set the selection risks race conditions\n+          // where the selection ping-pongs back an forth.", "originalCommit": "8308e02b527f536ab59c1a4a05cf7ce6893745b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMjkyMg==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514632922", "bodyText": "done", "author": "jacob314", "createdAt": "2020-10-29T23:56:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzM4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "chunk": "diff --git a/src/io/flutter/inspector/InspectorService.java b/src/io/flutter/inspector/InspectorService.java\nindex 1b0e871b..614d0691 100644\n--- a/src/io/flutter/inspector/InspectorService.java\n+++ b/src/io/flutter/inspector/InspectorService.java\n\n@@ -398,10 +398,10 @@ public class InspectorService implements Disposable {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Assume the inspector in Flutter DevTools or the on device\n-          // has already set the selection on the device so we don't have to.\n-          // Having multiple clients set the selection risks race conditions\n-          // where the selection ping-pongs back an forth.\n+          // Assume the inspector in Flutter DevTools or the on device widget\n+          // inspector has already set the selection on the device so we don't\n+          // have to Having multiple clients set the selection risks race\n+          // conditions where the selection ping-pongs back and forth.\n \n           // Update the UI in IntelliJ.\n           notifySelectionChanged(false, false);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzUyNg==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514627526", "bodyText": "typo - on the", "author": "helin24", "createdAt": "2020-10-29T23:38:05Z", "path": "src/io/flutter/inspector/InspectorService.java", "diffHunk": "@@ -398,12 +398,11 @@ private void onVmServiceReceived(String streamId, Event event) {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Make sure the WidgetInspector on the device switches to show the inspected object\n-          // if the inspected object is a Widget or RenderObject.\n+          // Assume the inspector in Flutter DevTools or the on device", "originalCommit": "8308e02b527f536ab59c1a4a05cf7ce6893745b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMzI2Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514633266", "bodyText": "done", "author": "jacob314", "createdAt": "2020-10-29T23:57:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYyNzUyNg=="}], "type": "inlineReview", "revised_code": {"commit": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "chunk": "diff --git a/src/io/flutter/inspector/InspectorService.java b/src/io/flutter/inspector/InspectorService.java\nindex 1b0e871b..614d0691 100644\n--- a/src/io/flutter/inspector/InspectorService.java\n+++ b/src/io/flutter/inspector/InspectorService.java\n\n@@ -398,10 +398,10 @@ public class InspectorService implements Disposable {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Assume the inspector in Flutter DevTools or the on device\n-          // has already set the selection on the device so we don't have to.\n-          // Having multiple clients set the selection risks race conditions\n-          // where the selection ping-pongs back an forth.\n+          // Assume the inspector in Flutter DevTools or the on device widget\n+          // inspector has already set the selection on the device so we don't\n+          // have to Having multiple clients set the selection risks race\n+          // conditions where the selection ping-pongs back and forth.\n \n           // Update the UI in IntelliJ.\n           notifySelectionChanged(false, false);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMjM2Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514632366", "bodyText": "Is this for debugging?", "author": "helin24", "createdAt": "2020-10-29T23:54:23Z", "path": "src/io/flutter/view/FlutterView.java", "diffHunk": "@@ -115,6 +119,29 @@ public FlutterView(@NotNull Project project) {\n \n     shouldAutoHorizontalScroll.listen(state::setShouldAutoScroll);\n     highlightNodesShownInBothTrees.listen(state::setHighlightNodesShownInBothTrees);\n+\n+    InspectorGroupManagerService.getInstance(project).addListener(new InspectorGroupManagerService.Listener() {\n+      @Override\n+      public void onInspectorAvailable(InspectorService service) { }\n+\n+      @Override\n+      public void onSelectionChanged(DiagnosticsNode selection) {\n+        if (selection != null) {\n+          final InspectorSourceLocation location = selection.getCreationLocation();\n+          if (location != null) {\n+            final XSourcePosition sourcePosition = location.getXSourcePosition();\n+            sourcePosition.createNavigatable(project).navigate(true);\n+          }\n+          if (selection.isCreatedByLocalProject()) {\n+            final XSourcePosition position = selection.getCreationLocation().getXSourcePosition();\n+            if (position != null) {\n+              position.createNavigatable(project).navigate(false);\n+            }\n+          }\n+        }\n+        System.out.println(\"XXX selection changed to :\" + selection);", "originalCommit": "8308e02b527f536ab59c1a4a05cf7ce6893745b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMzM2Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514633362", "bodyText": "removed", "author": "jacob314", "createdAt": "2020-10-29T23:57:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzMjM2Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "chunk": "diff --git a/src/io/flutter/view/FlutterView.java b/src/io/flutter/view/FlutterView.java\nindex 882566f8..f8c2ab96 100644\n--- a/src/io/flutter/view/FlutterView.java\n+++ b/src/io/flutter/view/FlutterView.java\n\n@@ -139,7 +139,6 @@ public class FlutterView implements PersistentStateComponent<FlutterViewState>,\n             }\n           }\n         }\n-        System.out.println(\"XXX selection changed to :\" + selection);\n       }\n     }, this);\n   }\n"}}, {"oid": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "url": "https://github.com/flutter/flutter-intellij/commit/7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "message": "Code review comment fixes.", "committedDate": "2020-10-29T23:57:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNDMwNw==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514634307", "bodyText": "Assume the inspector in Flutter DevTools or on the device widget", "author": "helin24", "createdAt": "2020-10-30T00:01:05Z", "path": "src/io/flutter/inspector/InspectorService.java", "diffHunk": "@@ -398,12 +398,11 @@ private void onVmServiceReceived(String streamId, Event event) {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Make sure the WidgetInspector on the device switches to show the inspected object\n-          // if the inspected object is a Widget or RenderObject.\n+          // Assume the inspector in Flutter DevTools or the on device widget", "originalCommit": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNTYzOQ==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514635639", "bodyText": "done", "author": "jacob314", "createdAt": "2020-10-30T00:05:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNDMwNw=="}], "type": "inlineReview", "revised_code": {"commit": "75d5e6e220c106e2a8f399a90814958e0aeb04f6", "chunk": "diff --git a/src/io/flutter/inspector/InspectorService.java b/src/io/flutter/inspector/InspectorService.java\nindex 614d0691..0796707e 100644\n--- a/src/io/flutter/inspector/InspectorService.java\n+++ b/src/io/flutter/inspector/InspectorService.java\n\n@@ -398,9 +398,9 @@ public class InspectorService implements Disposable {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Assume the inspector in Flutter DevTools or the on device widget\n+          // Assume the inspector in Flutter DevTools or on the device widget\n           // inspector has already set the selection on the device so we don't\n-          // have to Having multiple clients set the selection risks race\n+          // have to. Having multiple clients set the selection risks race\n           // conditions where the selection ping-pongs back and forth.\n \n           // Update the UI in IntelliJ.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNDQxNg==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514634416", "bodyText": "add the period back after \"have to.\"", "author": "helin24", "createdAt": "2020-10-30T00:01:26Z", "path": "src/io/flutter/inspector/InspectorService.java", "diffHunk": "@@ -398,12 +398,11 @@ private void onVmServiceReceived(String streamId, Event event) {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Make sure the WidgetInspector on the device switches to show the inspected object\n-          // if the inspected object is a Widget or RenderObject.\n+          // Assume the inspector in Flutter DevTools or the on device widget\n+          // inspector has already set the selection on the device so we don't\n+          // have to Having multiple clients set the selection risks race", "originalCommit": "7b1778e89790eb611b2f0b9c8d6a6940864ffa09", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNTc1NA==", "url": "https://github.com/flutter/flutter-intellij/pull/5011#discussion_r514635754", "bodyText": "done", "author": "jacob314", "createdAt": "2020-10-30T00:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYzNDQxNg=="}], "type": "inlineReview", "revised_code": {"commit": "75d5e6e220c106e2a8f399a90814958e0aeb04f6", "chunk": "diff --git a/src/io/flutter/inspector/InspectorService.java b/src/io/flutter/inspector/InspectorService.java\nindex 614d0691..0796707e 100644\n--- a/src/io/flutter/inspector/InspectorService.java\n+++ b/src/io/flutter/inspector/InspectorService.java\n\n@@ -398,9 +398,9 @@ public class InspectorService implements Disposable {\n     switch (streamId) {\n       case VmService.DEBUG_STREAM_ID: {\n         if (event.getKind() == EventKind.Inspect) {\n-          // Assume the inspector in Flutter DevTools or the on device widget\n+          // Assume the inspector in Flutter DevTools or on the device widget\n           // inspector has already set the selection on the device so we don't\n-          // have to Having multiple clients set the selection risks race\n+          // have to. Having multiple clients set the selection risks race\n           // conditions where the selection ping-pongs back and forth.\n \n           // Update the UI in IntelliJ.\n"}}, {"oid": "75d5e6e220c106e2a8f399a90814958e0aeb04f6", "url": "https://github.com/flutter/flutter-intellij/commit/75d5e6e220c106e2a8f399a90814958e0aeb04f6", "message": "Comment fixes.", "committedDate": "2020-10-30T00:06:37Z", "type": "commit"}]}