{"pr_number": 4633, "pr_title": "Recognize \\r as newlines from flutter", "pr_createdAt": "2020-06-17T20:45:27Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4633", "timeline": [{"oid": "e1a0624e6079c2b2a3ee5cffdb800012f132ab92", "url": "https://github.com/flutter/flutter-intellij/commit/e1a0624e6079c2b2a3ee5cffdb800012f132ab92", "message": "Recognize \\r as newlines from flutter", "committedDate": "2020-06-17T20:43:29Z", "type": "commit"}, {"oid": "441592452e7671bb9e8d2288835801d1ab8ea16e", "url": "https://github.com/flutter/flutter-intellij/commit/441592452e7671bb9e8d2288835801d1ab8ea16e", "message": "Check for windows return and modify tests", "committedDate": "2020-06-17T21:56:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NDAwNQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4633#discussion_r441874005", "bodyText": "a little odd that we don't flush when the c is a '\\n'\nis this really\nassert(c!= '\\n');\n?", "author": "jacob314", "createdAt": "2020-06-17T22:45:20Z", "path": "src/io/flutter/utils/StdoutJsonParser.java", "diffHunk": "@@ -32,11 +33,25 @@ public void appendOutput(String string) {\n       if (eatNextEol) {\n         eatNextEol = false;\n \n-        if (c == '\\n' || c == '\\r') {\n+        if (c == '\\n') {\n+          continue;\n+        }\n+\n+        if (c == '\\r' && !isPotentialWindowsReturn) {\n+          eatNextEol = true;\n+          isPotentialWindowsReturn = true;\n           continue;\n         }\n       }\n \n+      if (isPotentialWindowsReturn) {\n+        isPotentialWindowsReturn = false;\n+\n+        if (c != '\\n') {", "originalCommit": "441592452e7671bb9e8d2288835801d1ab8ea16e", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NDg0OA==", "url": "https://github.com/flutter/flutter-intellij/pull/4633#discussion_r441874848", "bodyText": "somewhat minor: do we have to worry about \\r or \\n in the middle of a json block? I don't know off the top of my head how the dart json encoder deals with them.", "author": "jacob314", "createdAt": "2020-06-17T22:48:07Z", "path": "testSrc/unit/io/flutter/utils/StdoutJsonParserTest.java", "diffHunk": "@@ -49,6 +51,21 @@ public void appendsWithoutLineBreaks() {\n     );\n   }\n \n+  @Test\n+  public void jsonWithLineBreaks() {\n+    final StdoutJsonParser parser = new StdoutJsonParser();\n+    parser.appendOutput(\"[{'foo':'bar'}]\\ntest\\n\");", "originalCommit": "441592452e7671bb9e8d2288835801d1ab8ea16e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkwMjU2NQ==", "url": "https://github.com/flutter/flutter-intellij/pull/4633#discussion_r441902565", "bodyText": "It seems this is dealt with fine, I tried putting \\r, \\n and \\r\\n in the middle of flutter tools output and it's recognized correctly.", "author": "helin24", "createdAt": "2020-06-18T00:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NDg0OA=="}], "type": "inlineReview", "revised_code": {"commit": "d72fdea048fe67df3eef4da04832d43a546265c5", "chunk": "diff --git a/testSrc/unit/io/flutter/utils/StdoutJsonParserTest.java b/testSrc/unit/io/flutter/utils/StdoutJsonParserTest.java\nindex af2542e1..6311cc00 100644\n--- a/testSrc/unit/io/flutter/utils/StdoutJsonParserTest.java\n+++ b/testSrc/unit/io/flutter/utils/StdoutJsonParserTest.java\n\n@@ -54,14 +54,17 @@ public class StdoutJsonParserTest {\n   @Test\n   public void jsonWithLineBreaks() {\n     final StdoutJsonParser parser = new StdoutJsonParser();\n-    parser.appendOutput(\"[{'foo':'bar'}]\\ntest\\n\");\n-    parser.appendOutput(\"[{'foo':'baz'}]\\rtest\\r\");\n-    parser.appendOutput(\"[{'foo':'baz'}]\\r\\n\");\n+    parser.appendOutput(\"[{'foo':'bar'}]\");\n+    parser.appendOutput(\"\\ntest\\n\");\n+    parser.appendOutput(\"[{'foo':'baz'}]\");\n+    parser.appendOutput(\"\\rtest\\r\");\n+    parser.appendOutput(\"[{'foo':'baz2'}]\");\n+    parser.appendOutput(\"\\r\\nwindows\");\n     parser.appendOutput(\"bye\\n\");\n \n     assertArrayEquals(\n       \"validating parser results\",\n-      new String[]{\"[{'foo':'bar'}]\\n\", \"test\\n\", \"[{'foo':'baz'}]\\r\", \"test\\r\", \"[{'foo':'baz'}]\\r\\n\", \"bye\\n\"},\n+      new String[]{\"[{'foo':'bar'}]\", \"test\\n\", \"[{'foo':'baz'}]\", \"test\\r\", \"[{'foo':'baz2'}]\", \"windows\", \"bye\\n\"},\n       parser.getAvailableLines().toArray()\n     );\n   }\n"}}, {"oid": "d72fdea048fe67df3eef4da04832d43a546265c5", "url": "https://github.com/flutter/flutter-intellij/commit/d72fdea048fe67df3eef4da04832d43a546265c5", "message": "Add test for removing next newline char", "committedDate": "2020-06-18T00:06:36Z", "type": "commit"}]}