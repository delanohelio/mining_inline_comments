{"pr_number": 4603, "pr_title": "Avoid updating subscribers if bazel project is disconnected", "pr_createdAt": "2020-06-05T23:18:00Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4603", "timeline": [{"oid": "a38e23024b6efe759a378e3fea71b05e47ecef13", "url": "https://github.com/flutter/flutter-intellij/commit/a38e23024b6efe759a378e3fea71b05e47ecef13", "message": "Avoid updating file watch if bazel project is disconnected", "committedDate": "2020-06-05T23:13:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5ODMyNg==", "url": "https://github.com/flutter/flutter-intellij/pull/4603#discussion_r436998326", "bodyText": "should we instead return early here after setting\ndisconnected = true;\n?\nsetting cache=null in this case seems a bit odd.", "author": "jacob314", "createdAt": "2020-06-08T21:01:11Z", "path": "src/io/flutter/bazel/WorkspaceCache.java", "diffHunk": "@@ -129,7 +132,12 @@ public void unsubscribe(Runnable callback) {\n    */\n   private void refresh() {\n     final Workspace workspace = Workspace.loadUncached(project);\n-    if (workspace == cache) return;\n+    if (workspace == cache && !disconnected) return;\n+    if (cache != null && workspace == null) {\n+      disconnected = true;", "originalCommit": "a38e23024b6efe759a378e3fea71b05e47ecef13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzAyMTQwMg==", "url": "https://github.com/flutter/flutter-intellij/pull/4603#discussion_r437021402", "bodyText": "I thought it would be better for cache to be null when going on to notify listeners, because the only listener we want to behave differently is the workspace itself so that it keeps watching the previous file. For devices I think we still want the menu to disappear and for developers to not be able to run a project if they're disconnected.", "author": "helin24", "createdAt": "2020-06-08T21:50:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk5ODMyNg=="}], "type": "inlineReview", "revised_code": {"commit": "c9ed1643836b49b6acbfad89a690233b6eef741b", "chunk": "diff --git a/src/io/flutter/bazel/WorkspaceCache.java b/src/io/flutter/bazel/WorkspaceCache.java\nindex 744c4cf5..9b8c7a9b 100644\n--- a/src/io/flutter/bazel/WorkspaceCache.java\n+++ b/src/io/flutter/bazel/WorkspaceCache.java\n\n@@ -135,9 +133,10 @@ public class WorkspaceCache {\n     if (workspace == cache && !disconnected) return;\n     if (cache != null && workspace == null) {\n       disconnected = true;\n-    } else {\n-      disconnected = false;\n+      return;\n     }\n+\n+    disconnected = false;\n     cache = workspace;\n \n     // If the current workspace is a bazel workspace, update the Dart plugin\n"}}, {"oid": "c9ed1643836b49b6acbfad89a690233b6eef741b", "url": "https://github.com/flutter/flutter-intellij/commit/c9ed1643836b49b6acbfad89a690233b6eef741b", "message": "Skip notifying subscribers if disconnected", "committedDate": "2020-06-10T19:23:44Z", "type": "commit"}]}