{"pr_number": 4886, "pr_title": "Return null workspace if missing flutter.json", "pr_createdAt": "2020-09-24T23:57:14Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/4886", "timeline": [{"oid": "fe07c0b8c6ff14bd0a74cfe2f0ed1d86bac5adec", "url": "https://github.com/flutter/flutter-intellij/commit/fe07c0b8c6ff14bd0a74cfe2f0ed1d86bac5adec", "message": "Return null workspace if missing flutter.json", "committedDate": "2020-09-24T23:41:20Z", "type": "commit"}, {"oid": "a1166def34e7b5d0d12a675ad999bd51b31982fa", "url": "https://github.com/flutter/flutter-intellij/commit/a1166def34e7b5d0d12a675ad999bd51b31982fa", "message": "Fix test", "committedDate": "2020-09-25T17:43:37Z", "type": "commit"}, {"oid": "a1166def34e7b5d0d12a675ad999bd51b31982fa", "url": "https://github.com/flutter/flutter-intellij/commit/a1166def34e7b5d0d12a675ad999bd51b31982fa", "message": "Fix test", "committedDate": "2020-09-25T17:43:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1ODkxMg==", "url": "https://github.com/flutter/flutter-intellij/pull/4886#discussion_r495158912", "bodyText": "why not short circuit if the configFile == null OR readonlyRoot == null?\nThat should indicate we are in an environment where you can't actually run a g3 app.", "author": "jacob314", "createdAt": "2020-09-25T18:23:14Z", "path": "src/io/flutter/bazel/Workspace.java", "diffHunk": "@@ -220,6 +220,8 @@ static Workspace loadUncached(@NotNull Project project) {\n     final String readonlyPath = \"../READONLY/\" + root.getName();\n     final VirtualFile readonlyRoot = root.findFileByRelativePath(readonlyPath);\n     VirtualFile configFile = root.findFileByRelativePath(PLUGIN_CONFIG_PATH);\n+    if (configFile == null && readonlyRoot == null) return null;", "originalCommit": "a1166def34e7b5d0d12a675ad999bd51b31982fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE2MjE3Nw==", "url": "https://github.com/flutter/flutter-intellij/pull/4886#discussion_r495162177", "bodyText": "I'm not clear on how the readonlyRoot works. I thought that if configFile is null but readOnlyRoot exists, then we can still run a g3 app? Since the code below finds a config file within readonly.\nMaybe I should instead check for only configFile later, e.g.:\n    VirtualFile configFile = root.findFileByRelativePath(PLUGIN_CONFIG_PATH);\n    if (configFile == null && readonlyRoot != null) {\n      configFile = readonlyRoot.findFileByRelativePath(PLUGIN_CONFIG_PATH);\n    }\n    if (configFile == null) return null;", "author": "helin24", "createdAt": "2020-09-25T18:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE1ODkxMg=="}], "type": "inlineReview", "revised_code": {"commit": "a2b8ecea2f1e60a88d356f9a50e7b30afc907959", "chunk": "diff --git a/src/io/flutter/bazel/Workspace.java b/src/io/flutter/bazel/Workspace.java\nindex 1cc87fc0..69a7190e 100644\n--- a/src/io/flutter/bazel/Workspace.java\n+++ b/src/io/flutter/bazel/Workspace.java\n\n@@ -220,11 +220,11 @@ public class Workspace {\n     final String readonlyPath = \"../READONLY/\" + root.getName();\n     final VirtualFile readonlyRoot = root.findFileByRelativePath(readonlyPath);\n     VirtualFile configFile = root.findFileByRelativePath(PLUGIN_CONFIG_PATH);\n-    if (configFile == null && readonlyRoot == null) return null;\n-\n     if (configFile == null && readonlyRoot != null) {\n       configFile = readonlyRoot.findFileByRelativePath(PLUGIN_CONFIG_PATH);\n     }\n+    if (configFile == null) return null;\n+\n     final PluginConfig config = configFile == null ? null : PluginConfig.load(configFile);\n \n     final String daemonScript = config == null ? null : getScriptFromPath(root, readonlyPath, config.getDaemonScript());\n"}}, {"oid": "a2b8ecea2f1e60a88d356f9a50e7b30afc907959", "url": "https://github.com/flutter/flutter-intellij/commit/a2b8ecea2f1e60a88d356f9a50e7b30afc907959", "message": "Move config file check to after read only check", "committedDate": "2020-09-25T18:41:47Z", "type": "commit"}]}