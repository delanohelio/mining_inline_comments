{"pr_number": 5035, "pr_title": "Set user-data folder for embedded browser", "pr_createdAt": "2020-11-10T18:15:03Z", "pr_url": "https://github.com/flutter/flutter-intellij/pull/5035", "timeline": [{"oid": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "url": "https://github.com/flutter/flutter-intellij/commit/59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "message": "Set user-data folder for embedded browser", "committedDate": "2020-11-10T18:12:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MTk3MA==", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520881970", "bodyText": "log this instead?", "author": "devoncarew", "createdAt": "2020-11-10T21:22:46Z", "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -16,25 +16,46 @@\n import com.teamdev.jxbrowser.navigation.event.LoadFinished;\n import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n+import org.jetbrains.annotations.NotNull;\n \n import java.awt.*;\n+import java.io.File;\n+import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n \n public class EmbeddedBrowser {\n-  public void openPanel(ContentManager contentManager, String tabName, String url) {\n+  private static EmbeddedBrowser embeddedBrowser;\n+\n+  @NotNull\n+  public static EmbeddedBrowser getInstance() {\n+    if (embeddedBrowser == null) {\n+      embeddedBrowser = new EmbeddedBrowser();\n+    }\n+    return embeddedBrowser;\n+  }\n+\n+  private Browser browser;\n+\n+  private EmbeddedBrowser() {\n+    System.out.println(Paths.get(JxBrowserManager.DOWNLOAD_PATH + File.separatorChar + \"user-data\"));", "originalCommit": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5b2994f85d62b55121495d4843815282814fddf0", "chunk": "diff --git a/src/io/flutter/jxbrowser/EmbeddedBrowser.java b/src/io/flutter/jxbrowser/EmbeddedBrowser.java\nindex 6feb23a4..3020ec0f 100644\n--- a/src/io/flutter/jxbrowser/EmbeddedBrowser.java\n+++ b/src/io/flutter/jxbrowser/EmbeddedBrowser.java\n\n@@ -18,7 +21,7 @@ import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n import org.jetbrains.annotations.NotNull;\n \n-import java.awt.*;\n+import java.awt.Dimension;\n import java.io.File;\n import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MzM0Ng==", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520883346", "bodyText": "Do we want this to be an application singleton or a per project (per IntelliJ window) singleton? I'm guessing the 2nd one. There are several places in the code base where we have per-project singletons. You register them in the plugin's xml file and then have a slightly different singleton getter. See for example FlutterReloadManager.getInstance(Project project).", "author": "devoncarew", "createdAt": "2020-11-10T21:25:25Z", "path": "src/io/flutter/jxbrowser/EmbeddedBrowser.java", "diffHunk": "@@ -16,25 +16,46 @@\n import com.teamdev.jxbrowser.navigation.event.LoadFinished;\n import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n+import org.jetbrains.annotations.NotNull;\n \n import java.awt.*;\n+import java.io.File;\n+import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n \n import static com.teamdev.jxbrowser.engine.RenderingMode.HARDWARE_ACCELERATED;\n \n public class EmbeddedBrowser {\n-  public void openPanel(ContentManager contentManager, String tabName, String url) {\n+  private static EmbeddedBrowser embeddedBrowser;\n+\n+  @NotNull\n+  public static EmbeddedBrowser getInstance() {", "originalCommit": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk0NDAwNg==", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520944006", "bodyText": "Ack forgot about this! Changed to per-project.", "author": "helin24", "createdAt": "2020-11-10T23:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg4MzM0Ng=="}], "type": "inlineReview", "revised_code": {"commit": "5b2994f85d62b55121495d4843815282814fddf0", "chunk": "diff --git a/src/io/flutter/jxbrowser/EmbeddedBrowser.java b/src/io/flutter/jxbrowser/EmbeddedBrowser.java\nindex 6feb23a4..3020ec0f 100644\n--- a/src/io/flutter/jxbrowser/EmbeddedBrowser.java\n+++ b/src/io/flutter/jxbrowser/EmbeddedBrowser.java\n\n@@ -18,7 +21,7 @@ import com.teamdev.jxbrowser.view.swing.BrowserView;\n import icons.FlutterIcons;\n import org.jetbrains.annotations.NotNull;\n \n-import java.awt.*;\n+import java.awt.Dimension;\n import java.io.File;\n import java.nio.file.Paths;\n import java.util.concurrent.atomic.AtomicBoolean;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg5Njg3MQ==", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520896871", "bodyText": "getInstance(project)\nI think we'd want separate instances for each window.\nI don't think IntelliJ allows opening two windows on a single project, but if it does that could be a problem.", "author": "stevemessick", "createdAt": "2020-11-10T21:51:48Z", "path": "src/io/flutter/devtools/DevToolsManager.java", "diffHunk": "@@ -404,7 +404,7 @@ public void openPanel(String serviceProtocolUri, ContentManager contentManager,\n \n     //noinspection CodeBlock2Expr\n     ApplicationManager.getApplication().invokeLater(() -> {\n-      new EmbeddedBrowser().openPanel(contentManager, tabName, url);\n+      EmbeddedBrowser.getInstance().openPanel(contentManager, tabName, url);", "originalCommit": "59ef40bdb28ebe092ae1e6b2284143e86b02b0ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk0NDM2Mg==", "url": "https://github.com/flutter/flutter-intellij/pull/5035#discussion_r520944362", "bodyText": "Hmm.. I can't do it easily, so hopefully only one project per window.", "author": "helin24", "createdAt": "2020-11-10T23:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDg5Njg3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "5b2994f85d62b55121495d4843815282814fddf0", "chunk": "diff --git a/src/io/flutter/devtools/DevToolsManager.java b/src/io/flutter/devtools/DevToolsManager.java\nindex a85c2354..c00f4964 100644\n--- a/src/io/flutter/devtools/DevToolsManager.java\n+++ b/src/io/flutter/devtools/DevToolsManager.java\n\n@@ -398,13 +398,13 @@ class DevToolsInstance {\n     );\n   }\n \n-  public void openPanel(String serviceProtocolUri, ContentManager contentManager, String tabName, String pageName) {\n+  public void openPanel(Project project, String serviceProtocolUri, ContentManager contentManager, String tabName, String pageName) {\n     final String color = ColorUtil.toHex(UIUtil.getEditorPaneBackground());\n     final String url = DevToolsUtils.generateDevToolsUrl(devtoolsHost, devtoolsPort, serviceProtocolUri, pageName, true, color);\n \n     //noinspection CodeBlock2Expr\n     ApplicationManager.getApplication().invokeLater(() -> {\n-      EmbeddedBrowser.getInstance().openPanel(contentManager, tabName, url);\n+      EmbeddedBrowser.getInstance(project).openPanel(contentManager, tabName, url);\n     });\n   }\n }\n"}}, {"oid": "5b2994f85d62b55121495d4843815282814fddf0", "url": "https://github.com/flutter/flutter-intellij/commit/5b2994f85d62b55121495d4843815282814fddf0", "message": "Use separate engine for each project", "committedDate": "2020-11-10T23:39:33Z", "type": "commit"}]}