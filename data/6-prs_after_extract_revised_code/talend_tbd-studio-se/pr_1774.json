{"pr_number": 1774, "pr_title": "fix(TBD-11772):S3 component doesn't work on CDP 7.1.1", "pr_createdAt": "2020-12-14T10:51:51Z", "pr_url": "https://github.com/Talend/tbd-studio-se/pull/1774", "timeline": [{"oid": "2cbc634ff632ef1a44ff13caa9e7b49aa6cf07aa", "url": "https://github.com/Talend/tbd-studio-se/commit/2cbc634ff632ef1a44ff13caa9e7b49aa6cf07aa", "message": "fix(TBD-11772): fixed missing module group for s3", "committedDate": "2020-12-14T10:50:48Z", "type": "commit"}, {"oid": "db2ac8ea82f2175da7b2c64a7a310eaedfa04af1", "url": "https://github.com/Talend/tbd-studio-se/commit/db2ac8ea82f2175da7b2c64a7a310eaedfa04af1", "message": "Merge branch 'hliashchuk/fix/TBD-11772' of github.com:Talend/tbd-studio-se into hliashchuk/fix/TBD-11772", "committedDate": "2020-12-14T10:51:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM4MDgzMA==", "url": "https://github.com/Talend/tbd-studio-se/pull/1774#discussion_r542380830", "bodyText": "Would be better to plug this in node module group for s3 components only to avoid adding those aws libs on all Spark jobs.\nCan be done in https://github.com/Talend/tbd-studio-se/blob/maintenance/7.3/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/DynamicSparkBatchModuleGroupTemplate.java#L67", "author": "lbourgeois", "createdAt": "2020-12-14T13:25:47Z", "path": "main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/modulegroup/cdp/DynamicCDPSparkBatchModuleGroup.java", "diffHunk": "@@ -89,6 +92,9 @@ protected void initConditions() {\n                     new BasicExpression(SparkBatchConstant.USE_CLOUDERA_NAVIGATOR));\r\n             moduleGroups.add(new DistributionModuleGroup(talendClouderaNaviRuntimeId, true, conditionUseNavigator));\r\n         }\r\n+        if (StringUtils.isNotBlank(sparkS3RuntimeId)) {\r", "originalCommit": "db2ac8ea82f2175da7b2c64a7a310eaedfa04af1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEyMDc1Ng==", "url": "https://github.com/Talend/tbd-studio-se/pull/1774#discussion_r543120756", "bodyText": "I'm guessing it should be DynamicCDPSparkBatchModuleGroupTemplate instead of DynamicSparkBatchModuleGroupTemplate ? Too many extends for this part really ... Imho that whole thing should be just one class because it seems pretty common to import S3 libs in case theres a S3 component in a job ... I don't get why we need those module condition for all distribs :(", "author": "AlixMetivier", "createdAt": "2020-12-15T07:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM4MDgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "771a15344ae8f4b69f5681629c9063864d284eeb", "chunk": "diff --git a/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/modulegroup/cdp/DynamicCDPSparkBatchModuleGroup.java b/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/modulegroup/cdp/DynamicCDPSparkBatchModuleGroup.java\nindex bfcd172ad..8de237b73 100644\n--- a/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/modulegroup/cdp/DynamicCDPSparkBatchModuleGroup.java\n+++ b/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/dynamic/template/modulegroup/cdp/DynamicCDPSparkBatchModuleGroup.java\n\n@@ -92,9 +89,6 @@ public class DynamicCDPSparkBatchModuleGroup extends DynamicSparkBatchModuleGrou\n                     new BasicExpression(SparkBatchConstant.USE_CLOUDERA_NAVIGATOR));\n             moduleGroups.add(new DistributionModuleGroup(talendClouderaNaviRuntimeId, true, conditionUseNavigator));\n         }\n-        if (StringUtils.isNotBlank(sparkS3RuntimeId)) {\n-            moduleGroups.add(new DistributionModuleGroup(sparkS3RuntimeId, true, conditionSpark2));\n-        }\n \n         return moduleGroups;\n     }\n"}}, {"oid": "771a15344ae8f4b69f5681629c9063864d284eeb", "url": "https://github.com/Talend/tbd-studio-se/commit/771a15344ae8f4b69f5681629c9063864d284eeb", "message": "fix(TBD-11772): missing dependencies", "committedDate": "2020-12-30T17:25:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQyMjg0Nw==", "url": "https://github.com/Talend/tbd-studio-se/pull/1774#discussion_r550422847", "bodyText": "Just to my knowledge : we support s3a for CDP, right?", "author": "sponomarova", "createdAt": "2020-12-31T08:00:39Z", "path": "main/plugins/org.talend.hadoop.distribution.cdp/src/main/java/org/talend/hadoop/distribution/cdp/CDP7xDistributionTemplate.java", "diffHunk": "@@ -269,6 +269,11 @@ public boolean doImportDynamoDBDependencies() {\n \tpublic boolean doSupportAssumeRole() {\n \t\treturn true;\n \t}\n+\t\n+\t@Override\n+    public boolean useS3AProperties() {", "originalCommit": "771a15344ae8f4b69f5681629c9063864d284eeb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQyMzI3Mg==", "url": "https://github.com/Talend/tbd-studio-se/pull/1774#discussion_r550423272", "bodyText": "SInce https://jira.talendforge.org/browse/TBD-9385 is delivered, s3a is the only option available", "author": "hliashchuk", "createdAt": "2020-12-31T08:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQyMjg0Nw=="}], "type": "inlineReview", "revised_code": null}]}