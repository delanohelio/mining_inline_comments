{"pr_number": 1346, "pr_title": "fix(TBD-10095): Sqoop issue with parquet format with EMR 5.15(2.8.3)", "pr_createdAt": "2020-03-31T07:41:00Z", "pr_url": "https://github.com/Talend/tbd-studio-se/pull/1346", "timeline": [{"oid": "146488e775cdbb5145cb7fd35464e10d83d28646", "url": "https://github.com/Talend/tbd-studio-se/commit/146488e775cdbb5145cb7fd35464e10d83d28646", "message": "TBD-10095: jar loading order fixed", "committedDate": "2020-03-31T07:37:38Z", "type": "commit"}, {"oid": "fb9cfafd286df68c0bf5fb067e88e15a55e29221", "url": "https://github.com/Talend/tbd-studio-se/commit/fb9cfafd286df68c0bf5fb067e88e15a55e29221", "message": "Merge branch 'master' of https://github.com/Talend/tbd-studio-se", "committedDate": "2020-03-31T07:38:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400736665", "bodyText": "You changed the condition from equal PARQUET to not equal AVRO. Is it equivalent. Don't we have other txt formats ?", "author": "lbourgeois", "createdAt": "2020-03-31T08:35:30Z", "path": "main/plugins/org.talend.hadoop.distribution.emr5150/src/main/java/org/talend/hadoop/distribution/emr5150/modulegroup/EMR5150SqoopModuleGroup.java", "diffHunk": "@@ -31,10 +31,15 @@\n         hs.add(new DistributionModuleGroup(EMR5150Constant.MAPREDUCE_MODULE_GROUP.getModuleName()));\n         hs.add(new DistributionModuleGroup(EMR5150Constant.HDFS_MODULE_GROUP.getModuleName()));\n         ComponentCondition parquetOutputCondition =\n-                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.EQ,\n-                        SqoopConstant.PAQUET_OUTPUT_FORMAT));\n+                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.NOT_EQ,", "originalCommit": "fb9cfafd286df68c0bf5fb067e88e15a55e29221", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgyODY2NA==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400828664", "bodyText": "No, this is not equal condition. In fact, it is what you just have mentioned: it covers all others (not avro) txt formats", "author": "mtuhai", "createdAt": "2020-03-31T11:10:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg0NzU4NQ==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400847585", "bodyText": "What is not clear here is that you will import SQOOP_PARQUET_MODULE_GROUP even for text formats", "author": "lbourgeois", "createdAt": "2020-03-31T11:45:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5ODQyMA==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400898420", "bodyText": "Yes, job bundle for all file formats except avro, will contain parquet kite-* libraries. I do not think there is a reason to split non-avro group to several smaller groups to build smaller job bundle, as these jars are not conflicting. Additionally, I do not know how to realize condition in EMR5150SqoopModuleGroup class in this case.", "author": "mtuhai", "createdAt": "2020-03-31T13:08:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDkyMzIzMw==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400923233", "bodyText": "I was a bit confused to see a group called PARQUET imported even for non parquet files (text files) and maybe you can't rename without impacting other distros. It won't help clarity for future maintenance.\nReguarding condition I can't see the issue to test each format independently", "author": "lbourgeois", "createdAt": "2020-03-31T13:42:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5OTAzOA==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r401299038", "bodyText": "Split non-avro groups to text-, sequence- and parquet- groups", "author": "mtuhai", "createdAt": "2020-04-01T01:01:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNjY2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "5485e8a41637f4b5b07861f2d7946399b2604441", "chunk": "diff --git a/main/plugins/org.talend.hadoop.distribution.emr5150/src/main/java/org/talend/hadoop/distribution/emr5150/modulegroup/EMR5150SqoopModuleGroup.java b/main/plugins/org.talend.hadoop.distribution.emr5150/src/main/java/org/talend/hadoop/distribution/emr5150/modulegroup/EMR5150SqoopModuleGroup.java\nindex b201a0237..01c442653 100644\n--- a/main/plugins/org.talend.hadoop.distribution.emr5150/src/main/java/org/talend/hadoop/distribution/emr5150/modulegroup/EMR5150SqoopModuleGroup.java\n+++ b/main/plugins/org.talend.hadoop.distribution.emr5150/src/main/java/org/talend/hadoop/distribution/emr5150/modulegroup/EMR5150SqoopModuleGroup.java\n\n@@ -31,10 +31,20 @@ public class EMR5150SqoopModuleGroup {\n         hs.add(new DistributionModuleGroup(EMR5150Constant.MAPREDUCE_MODULE_GROUP.getModuleName()));\n         hs.add(new DistributionModuleGroup(EMR5150Constant.HDFS_MODULE_GROUP.getModuleName()));\n         ComponentCondition parquetOutputCondition =\n-                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.NOT_EQ,\n-                        SqoopConstant.AVRO_OUTPUT_FORMAT));\n+                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.EQ,\n+                        SqoopConstant.PAQUET_OUTPUT_FORMAT));\n         hs.add(new DistributionModuleGroup(EMR5150Constant.SQOOP_PARQUET_MODULE_GROUP.getModuleName(), true,\n                 parquetOutputCondition));\n+        ComponentCondition textOutputCondition =\n+                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.EQ,\n+                        SqoopConstant.TEXT_OUTPUT_FORMAT));\n+        hs.add(new DistributionModuleGroup(EMR5150Constant.SQOOP_TEXT_MODULE_GROUP.getModuleName(), true,\n+                textOutputCondition));\n+        ComponentCondition sequenceOutputCondition =\n+                new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.EQ,\n+                        SqoopConstant.SEQUENCE_OUTPUT_FORMAT));\n+        hs.add(new DistributionModuleGroup(EMR5150Constant.SQOOP_SEQUENCE_MODULE_GROUP.getModuleName(), true,\n+                sequenceOutputCondition));\n         ComponentCondition avroOutputCondition = \n                 new SimpleComponentCondition(new BasicExpression(SqoopConstant.FILE_FORMAT, EqualityOperator.EQ, \n                         SqoopConstant.AVRO_OUTPUT_FORMAT));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNzAwMw==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400737003", "bodyText": "Is this constant still needed ?", "author": "lbourgeois", "createdAt": "2020-03-31T08:36:03Z", "path": "main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/constants/SqoopConstant.java", "diffHunk": "@@ -28,4 +28,6 @@\n \n     public static final String PAQUET_OUTPUT_FORMAT = \"parquetfile\";//$NON-NLS-1$", "originalCommit": "fb9cfafd286df68c0bf5fb067e88e15a55e29221", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgzMDAyNw==", "url": "https://github.com/Talend/tbd-studio-se/pull/1346#discussion_r400830027", "bodyText": "It is used in many other distros", "author": "mtuhai", "createdAt": "2020-03-31T11:12:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDczNzAwMw=="}], "type": "inlineReview", "revised_code": {"commit": "5485e8a41637f4b5b07861f2d7946399b2604441", "chunk": "diff --git a/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/constants/SqoopConstant.java b/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/constants/SqoopConstant.java\nindex c1b563854..73d84381e 100644\n--- a/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/constants/SqoopConstant.java\n+++ b/main/plugins/org.talend.hadoop.distribution/src/main/java/org/talend/hadoop/distribution/constants/SqoopConstant.java\n\n@@ -30,4 +30,8 @@ public final class SqoopConstant {\n \n     public static final String AVRO_OUTPUT_FORMAT = \"avrofile\";//$NON-NLS-1$\n \n+    public static final String TEXT_OUTPUT_FORMAT = \"textfile\";//$NON-NLS-1$\n+\n+    public static final String SEQUENCE_OUTPUT_FORMAT = \"sequencefile\";//$NON-NLS-1$\n+\n }\n"}}, {"oid": "5485e8a41637f4b5b07861f2d7946399b2604441", "url": "https://github.com/Talend/tbd-studio-se/commit/5485e8a41637f4b5b07861f2d7946399b2604441", "message": "fine grained groups added", "committedDate": "2020-04-01T00:59:11Z", "type": "commit"}, {"oid": "f7bffe889ea23d5a9dee1d2717726ecd2173f676", "url": "https://github.com/Talend/tbd-studio-se/commit/f7bffe889ea23d5a9dee1d2717726ecd2173f676", "message": "Merge branch 'master' into fix/TBD-10095_jar_loading_order", "committedDate": "2020-04-01T07:03:39Z", "type": "commit"}, {"oid": "8a20de438160d189505849bdd4f27364edac7118", "url": "https://github.com/Talend/tbd-studio-se/commit/8a20de438160d189505849bdd4f27364edac7118", "message": "minor comments", "committedDate": "2020-04-01T10:24:19Z", "type": "commit"}, {"oid": "b7e884ad7152afcd601a5055acfb9035e4a7cf1d", "url": "https://github.com/Talend/tbd-studio-se/commit/b7e884ad7152afcd601a5055acfb9035e4a7cf1d", "message": "Merge branch 'fix/TBD-10095_jar_loading_order' of https://github.com/Talend/tbd-studio-se into fix/TBD-10095_jar_loading_order", "committedDate": "2020-04-01T10:26:22Z", "type": "commit"}, {"oid": "042de2ee2c5cd216a2683c90c1327396c97cd1cc", "url": "https://github.com/Talend/tbd-studio-se/commit/042de2ee2c5cd216a2683c90c1327396c97cd1cc", "message": "Merge branch 'master' into fix/TBD-10095_jar_loading_order", "committedDate": "2020-04-02T08:56:20Z", "type": "commit"}, {"oid": "0f40ca038c8203b6fce927ed2c7dc96f612e1336", "url": "https://github.com/Talend/tbd-studio-se/commit/0f40ca038c8203b6fce927ed2c7dc96f612e1336", "message": "Sqoop tests fixed", "committedDate": "2020-04-03T09:26:17Z", "type": "commit"}, {"oid": "491fd23e916625260d9232de865eab92a60a7662", "url": "https://github.com/Talend/tbd-studio-se/commit/491fd23e916625260d9232de865eab92a60a7662", "message": "Merge branch 'fix/TBD-10095_jar_loading_order' of https://github.com/Talend/tbd-studio-se into fix/TBD-10095_jar_loading_order", "committedDate": "2020-04-03T09:27:42Z", "type": "commit"}, {"oid": "820be78539eecb514be925e9cadd58d8e42f157c", "url": "https://github.com/Talend/tbd-studio-se/commit/820be78539eecb514be925e9cadd58d8e42f157c", "message": "Merge branch 'master' into fix/TBD-10095_jar_loading_order", "committedDate": "2020-04-03T10:30:04Z", "type": "commit"}]}