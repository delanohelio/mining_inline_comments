{"pr_number": 3206, "pr_title": "[ISSUE #2856]Adjust the use of thread pools (config module)", "pr_createdAt": "2020-06-30T03:26:59Z", "pr_url": "https://github.com/alibaba/nacos/pull/3206", "timeline": [{"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "url": "https://github.com/alibaba/nacos/commit/94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "message": "[ISSUE #2856]Adjust the use of thread pools (config\u3001cmdb module)", "committedDate": "2020-07-11T13:40:28Z", "type": "commit"}, {"oid": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "url": "https://github.com/alibaba/nacos/commit/94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "message": "[ISSUE #2856]Adjust the use of thread pools (config\u3001cmdb module)", "committedDate": "2020-07-11T13:40:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxMDYxMA==", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453410610", "bodyText": "Should we create a new class CmdbExecutors like naming and config? Don't put them into UtilsAndCommons", "author": "KomachiSion", "createdAt": "2020-07-13T03:02:56Z", "path": "cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java", "diffHunk": "@@ -117,11 +117,9 @@ public void init() throws NacosException {\n         initCmdbService();\n         load();\n         \n-        UtilsAndCommons.GLOBAL_EXECUTOR.schedule(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.GLOBAL_EXECUTOR\n-                .schedule(new CmdbLabelTask(), switches.getLabelTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.GLOBAL_EXECUTOR\n-                .schedule(new CmdbEventTask(), switches.getEventTaskInterval(), TimeUnit.SECONDS);\n+        UtilsAndCommons.scheduleCmdbTask(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);", "originalCommit": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "chunk": "diff --git a/cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java b/cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java\nindex 8a2ff94b8..c2390e5a6 100644\n--- a/cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java\n+++ b/cmdb/src/main/java/com/alibaba/nacos/cmdb/memory/CmdbProvider.java\n\n@@ -117,9 +117,9 @@ public class CmdbProvider implements CmdbReader, CmdbWriter {\n         initCmdbService();\n         load();\n         \n-        UtilsAndCommons.scheduleCmdbTask(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.scheduleCmdbTask(new CmdbLabelTask(), switches.getLabelTaskInterval(), TimeUnit.SECONDS);\n-        UtilsAndCommons.scheduleCmdbTask(new CmdbEventTask(), switches.getEventTaskInterval(), TimeUnit.SECONDS);\n+        CmdbExecutor.scheduleCmdbTask(new CmdbDumpTask(), switches.getDumpTaskInterval(), TimeUnit.SECONDS);\n+        CmdbExecutor.scheduleCmdbTask(new CmdbLabelTask(), switches.getLabelTaskInterval(), TimeUnit.SECONDS);\n+        CmdbExecutor.scheduleCmdbTask(new CmdbEventTask(), switches.getEventTaskInterval(), TimeUnit.SECONDS);\n     }\n     \n     @Override\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxMDg1Mw==", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453410853", "bodyText": "Why remove public?", "author": "KomachiSion", "createdAt": "2020-07-13T03:04:02Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java", "diffHunk": "@@ -30,17 +30,17 @@\n  * @author Nacos\n  */\n @Service\n-public class MemoryMonitor {\n+class MemoryMonitor {", "originalCommit": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java b/config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java\nindex 8c72ca25a..44c0a8825 100755\n--- a/config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/monitor/MemoryMonitor.java\n\n@@ -30,18 +30,19 @@ import java.util.concurrent.TimeUnit;\n  * @author Nacos\n  */\n @Service\n-class MemoryMonitor {\n+public class MemoryMonitor {\n     \n     @Autowired\n     public MemoryMonitor(AsyncNotifyService notifySingleService) {\n         \n         ConfigExecutor.scheduleConfigTask(new PrintMemoryTask(), DELAY_SECONDS, DELAY_SECONDS, TimeUnit.SECONDS);\n         \n-        ConfigExecutor.scheduleConfigTask(new PrintGetConfigResponeTask(), DELAY_SECONDS, DELAY_SECONDS,\n-                TimeUnit.SECONDS);\n+        ConfigExecutor\n+                .scheduleConfigTask(new PrintGetConfigResponeTask(), DELAY_SECONDS, DELAY_SECONDS, TimeUnit.SECONDS);\n         \n-        ConfigExecutor.scheduleConfigTask(new NotifyTaskQueueMonitorTask(notifySingleService), DELAY_SECONDS,\n-                DELAY_SECONDS, TimeUnit.SECONDS);\n+        ConfigExecutor\n+                .scheduleConfigTask(new NotifyTaskQueueMonitorTask(notifySingleService), DELAY_SECONDS, DELAY_SECONDS,\n+                        TimeUnit.SECONDS);\n         \n     }\n     \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQxNjU5OA==", "url": "https://github.com/alibaba/nacos/pull/3206#discussion_r453416598", "bodyText": "The thread pool factory are different between original and here.", "author": "KomachiSion", "createdAt": "2020-07-13T03:31:20Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/utils/ConfigExecutor.java", "diffHunk": "@@ -31,20 +35,68 @@\n  */\n public final class ConfigExecutor {\n     \n-    private static final Executor DUMP_EXECUTOR = ExecutorFactory\n-            .newFixedExecutorService(Config.class.getCanonicalName(), 1,\n-                    new NameThreadFactory(\"nacos.config.embedded.dump\"));\n+    private static final Executor DUMP_EXECUTOR = ExecutorFactory.Managed\n+            .newSingleExecutorService(ClassUtils.getCanonicalName(Config.class),\n+                    new NameThreadFactory(\"com.alibaba.nacos.config.embedded.dump\"));\n     \n-    private static final ScheduledExecutorService TIMER_EXECUTOR = ExecutorFactory\n-            .newScheduledExecutorService(Config.class.getCanonicalName(), 10,\n-                    new NameThreadFactory(\"com.alibaba.nacos.server.Timer\"));\n+    private static final ScheduledExecutorService TIMER_EXECUTOR = ExecutorFactory.Managed\n+            .newScheduledExecutorService(ClassUtils.getCanonicalName(Config.class), 10,\n+                    new NameThreadFactory(\"com.alibaba.nacos.config.server.timer\"));\n     \n-    public static void scheduleWithFixedDelay(Runnable command, long initialDelay, long delay, TimeUnit unit) {\n+    private static final ScheduledExecutorService CAPACITY_MANAGEMENT_EXECUTOR = ExecutorFactory.Managed", "originalCommit": "94f6c61ccdccd0866abc724ca4f8618aa1b8f10b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "url": "https://github.com/alibaba/nacos/commit/eb86f4e7131dfa78781794e4767ef2197f129a2a", "message": "add CmdbExecutor class", "committedDate": "2020-07-13T08:21:31Z", "type": "commit"}, {"oid": "eb86f4e7131dfa78781794e4767ef2197f129a2a", "url": "https://github.com/alibaba/nacos/commit/eb86f4e7131dfa78781794e4767ef2197f129a2a", "message": "add CmdbExecutor class", "committedDate": "2020-07-13T08:21:31Z", "type": "forcePushed"}]}