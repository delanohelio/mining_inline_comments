{"pr_number": 3543, "pr_title": "Fix #2792 When nacos.core.auth.enabled = true, user information is saved to the request in login", "pr_createdAt": "2020-08-07T02:49:57Z", "pr_url": "https://github.com/alibaba/nacos/pull/3543", "timeline": [{"oid": "4bfaa64c2d96bafbbe96ae2e6fc168861e70c2dd", "url": "https://github.com/alibaba/nacos/commit/4bfaa64c2d96bafbbe96ae2e6fc168861e70c2dd", "message": "Fix #3269 NacosAuthManager request.setAttribute(user) and ConfigController getSrcUserName(req)", "committedDate": "2020-08-07T02:42:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5MjIwMw==", "url": "https://github.com/alibaba/nacos/pull/3543#discussion_r466792203", "bodyText": "Please do not change indent.\nPlease use nacos code style to reformat code.\nsee src/style/codeStyle.md", "author": "KomachiSion", "createdAt": "2020-08-07T02:53:09Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/controller/ConfigController.java", "diffHunk": "@@ -87,31 +87,31 @@\n @RestController\n @RequestMapping(Constants.CONFIG_CONTROLLER_PATH)\n public class ConfigController {\n-    \n+", "originalCommit": "4bfaa64c2d96bafbbe96ae2e6fc168861e70c2dd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5NjY3NQ==", "url": "https://github.com/alibaba/nacos/pull/3543#discussion_r466796675", "bodyText": "ok", "author": "lidaoyang", "createdAt": "2020-08-07T03:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njc5MjIwMw=="}], "type": "inlineReview", "revised_code": {"commit": "378acb142530f89c1f3ae3b5a6969227c41bb847", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/controller/ConfigController.java b/config/src/main/java/com/alibaba/nacos/config/server/controller/ConfigController.java\nindex 1a4abffae..812b93cab 100644\n--- a/config/src/main/java/com/alibaba/nacos/config/server/controller/ConfigController.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/controller/ConfigController.java\n\n@@ -87,23 +87,23 @@ import java.util.stream.Collectors;\n @RestController\n @RequestMapping(Constants.CONFIG_CONTROLLER_PATH)\n public class ConfigController {\n-\n+    \n     private static final Logger LOGGER = LoggerFactory.getLogger(ConfigController.class);\n-\n+    \n     private static final String NAMESPACE_PUBLIC_KEY = \"public\";\n-\n+    \n     private static final String EXPORT_CONFIG_FILE_NAME = \"nacos_config_export_\";\n-\n+    \n     private static final String EXPORT_CONFIG_FILE_NAME_EXT = \".zip\";\n-\n+    \n     private static final String EXPORT_CONFIG_FILE_NAME_DATE_FORMAT = \"yyyyMMddHHmmss\";\n-\n+    \n     private final ConfigServletInner inner;\n-\n+    \n     private final PersistService persistService;\n-\n+    \n     private final ConfigSubService configSubService;\n-\n+    \n     @Autowired\n     public ConfigController(ConfigServletInner configServletInner, PersistService persistService,\n             ConfigSubService configSubService) {\n"}}, {"oid": "dcd84029298765eef9590b78ce237328449f9821", "url": "https://github.com/alibaba/nacos/commit/dcd84029298765eef9590b78ce237328449f9821", "message": "Merge branch 'sourcelib.develop' into fix_2792\n\n# Conflicts:\n#\tcore/src/main/java/com/alibaba/nacos/core/auth/AuthFilter.java", "committedDate": "2020-08-07T02:59:05Z", "type": "commit"}, {"oid": "378acb142530f89c1f3ae3b5a6969227c41bb847", "url": "https://github.com/alibaba/nacos/commit/378acb142530f89c1f3ae3b5a6969227c41bb847", "message": "Fix #3269 format code", "committedDate": "2020-08-07T03:09:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNjE5Ng==", "url": "https://github.com/alibaba/nacos/pull/3543#discussion_r466806196", "bodyText": "same question as above, do not change indent.", "author": "KomachiSion", "createdAt": "2020-08-07T03:53:39Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/service/repository/RowMapperManager.java", "diffHunk": "@@ -47,138 +47,138 @@\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n public final class RowMapperManager {\n-    \n+", "originalCommit": "378acb142530f89c1f3ae3b5a6969227c41bb847", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNzk0MQ==", "url": "https://github.com/alibaba/nacos/pull/3543#discussion_r466807941", "bodyText": "ok", "author": "lidaoyang", "createdAt": "2020-08-07T04:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjgwNjE5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "7aa69f26268d1ce5e009d07c77a1de1193ef65e0", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/service/repository/RowMapperManager.java b/config/src/main/java/com/alibaba/nacos/config/server/service/repository/RowMapperManager.java\nindex 8192d0851..b86e441f2 100644\n--- a/config/src/main/java/com/alibaba/nacos/config/server/service/repository/RowMapperManager.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/service/repository/RowMapperManager.java\n\n@@ -47,138 +47,138 @@ import org.springframework.jdbc.core.RowMapper;\n  * @author <a href=\"mailto:liaochuntao@live.com\">liaochuntao</a>\n  */\n public final class RowMapperManager {\n-\n+    \n     public static final RowMapper<TenantInfo> TENANT_INFO_ROW_MAPPER = new TenantInfoRowMapper();\n-\n+    \n     public static final RowMapper<User> USER_ROW_MAPPER = new UserRowMapper();\n-\n+    \n     public static final RowMapper<ConfigInfoWrapper> CONFIG_INFO_WRAPPER_ROW_MAPPER = new ConfigInfoWrapperRowMapper();\n-\n+    \n     public static final RowMapper<ConfigKey> CONFIG_KEY_ROW_MAPPER = new ConfigKeyRowMapper();\n-\n+    \n     public static final ConfigInfoBetaWrapperRowMapper CONFIG_INFO_BETA_WRAPPER_ROW_MAPPER = new ConfigInfoBetaWrapperRowMapper();\n-\n+    \n     public static final ConfigInfoTagWrapperRowMapper CONFIG_INFO_TAG_WRAPPER_ROW_MAPPER = new ConfigInfoTagWrapperRowMapper();\n-\n+    \n     public static final ConfigInfoRowMapper CONFIG_INFO_ROW_MAPPER = new ConfigInfoRowMapper();\n-\n+    \n     public static final ConfigAdvanceInfoRowMapper CONFIG_ADVANCE_INFO_ROW_MAPPER = new ConfigAdvanceInfoRowMapper();\n-\n+    \n     public static final ConfigAllInfoRowMapper CONFIG_ALL_INFO_ROW_MAPPER = new ConfigAllInfoRowMapper();\n-\n+    \n     public static final ConfigInfo4BetaRowMapper CONFIG_INFO4BETA_ROW_MAPPER = new ConfigInfo4BetaRowMapper();\n-\n+    \n     public static final ConfigInfo4TagRowMapper CONFIG_INFO4TAG_ROW_MAPPER = new ConfigInfo4TagRowMapper();\n-\n+    \n     public static final ConfigInfoBaseRowMapper CONFIG_INFO_BASE_ROW_MAPPER = new ConfigInfoBaseRowMapper();\n-\n+    \n     public static final ConfigInfoAggrRowMapper CONFIG_INFO_AGGR_ROW_MAPPER = new ConfigInfoAggrRowMapper();\n-\n+    \n     public static final ConfigInfoChangedRowMapper CONFIG_INFO_CHANGED_ROW_MAPPER = new ConfigInfoChangedRowMapper();\n-\n+    \n     public static final ConfigHistoryRowMapper HISTORY_LIST_ROW_MAPPER = new ConfigHistoryRowMapper();\n-\n+    \n     public static final ConfigHistoryDetailRowMapper HISTORY_DETAIL_ROW_MAPPER = new ConfigHistoryDetailRowMapper();\n-\n+    \n     public static final RoleInfoRowMapper ROLE_INFO_ROW_MAPPER = new RoleInfoRowMapper();\n-\n+    \n     public static final PermissionRowMapper PERMISSION_ROW_MAPPER = new PermissionRowMapper();\n-\n+    \n     public static Map<String, RowMapper> mapperMap = new HashMap<>(16);\n-\n+    \n     static {\n-\n+        \n         // TENANT_INFO_ROW_MAPPER\n-\n+        \n         mapperMap.put(TENANT_INFO_ROW_MAPPER.getClass().getCanonicalName(), TENANT_INFO_ROW_MAPPER);\n-\n+        \n         // USER_ROW_MAPPER\n-\n+        \n         mapperMap.put(USER_ROW_MAPPER.getClass().getCanonicalName(), USER_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_WRAPPER_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_WRAPPER_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO_WRAPPER_ROW_MAPPER);\n-\n+        \n         // CONFIG_KEY_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_KEY_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_KEY_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_BETA_WRAPPER_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_BETA_WRAPPER_ROW_MAPPER.getClass().getCanonicalName(),\n                 CONFIG_INFO_BETA_WRAPPER_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_TAG_WRAPPER_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_TAG_WRAPPER_ROW_MAPPER.getClass().getCanonicalName(),\n                 CONFIG_INFO_TAG_WRAPPER_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO_ROW_MAPPER);\n-\n+        \n         // CONFIG_ADVANCE_INFO_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_ADVANCE_INFO_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_ADVANCE_INFO_ROW_MAPPER);\n-\n+        \n         // CONFIG_ALL_INFO_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_ALL_INFO_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_ALL_INFO_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO4BETA_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO4BETA_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO4BETA_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO4TAG_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO4TAG_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO4TAG_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_BASE_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_BASE_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO_BASE_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_AGGR_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_AGGR_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO_AGGR_ROW_MAPPER);\n-\n+        \n         // CONFIG_INFO_CHANGED_ROW_MAPPER\n-\n+        \n         mapperMap.put(CONFIG_INFO_CHANGED_ROW_MAPPER.getClass().getCanonicalName(), CONFIG_INFO_CHANGED_ROW_MAPPER);\n-\n+        \n         // HISTORY_LIST_ROW_MAPPER\n-\n+        \n         mapperMap.put(HISTORY_LIST_ROW_MAPPER.getClass().getCanonicalName(), HISTORY_LIST_ROW_MAPPER);\n-\n+        \n         // HISTORY_DETAIL_ROW_MAPPER\n-\n+        \n         mapperMap.put(HISTORY_DETAIL_ROW_MAPPER.getClass().getCanonicalName(), HISTORY_DETAIL_ROW_MAPPER);\n-\n+        \n         // ROLE_INFO_ROW_MAPPER\n-\n+        \n         mapperMap.put(ROLE_INFO_ROW_MAPPER.getClass().getCanonicalName(), ROLE_INFO_ROW_MAPPER);\n-\n+        \n         // PERMISSION_ROW_MAPPER\n-\n+        \n         mapperMap.put(PERMISSION_ROW_MAPPER.getClass().getCanonicalName(), PERMISSION_ROW_MAPPER);\n     }\n-\n+    \n     public static <D> RowMapper<D> getRowMapper(String classFullName) {\n         return (RowMapper<D>) mapperMap.get(classFullName);\n     }\n-\n+    \n     public static final class ConfigInfoWrapperRowMapper implements RowMapper<ConfigInfoWrapper> {\n-\n+        \n         @Override\n         public ConfigInfoWrapper mapRow(ResultSet rs, int rowNum) throws SQLException {\n             ConfigInfoWrapper info = new ConfigInfoWrapper();\n-\n+            \n             info.setDataId(rs.getString(\"data_id\"));\n             info.setGroup(rs.getString(\"group_id\"));\n             info.setTenant(rs.getString(\"tenant_id\"));\n             info.setAppName(rs.getString(\"app_name\"));\n             info.setType(rs.getString(\"type\"));\n-\n+            \n             try {\n                 info.setContent(rs.getString(\"content\"));\n             } catch (SQLException ignore) {\n"}}, {"oid": "7aa69f26268d1ce5e009d07c77a1de1193ef65e0", "url": "https://github.com/alibaba/nacos/commit/7aa69f26268d1ce5e009d07c77a1de1193ef65e0", "message": "Fix #3269 format code", "committedDate": "2020-08-07T04:01:26Z", "type": "commit"}]}