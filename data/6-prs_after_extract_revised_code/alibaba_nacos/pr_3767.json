{"pr_number": 3767, "pr_title": "[ISSUE #3687] check serviceName's format(groupName@@serviceName) in server and client", "pr_createdAt": "2020-09-07T06:12:30Z", "pr_url": "https://github.com/alibaba/nacos/pull/3767", "timeline": [{"oid": "2e0b1146330139bba8e791c93377c54ab735b55b", "url": "https://github.com/alibaba/nacos/commit/2e0b1146330139bba8e791c93377c54ab735b55b", "message": "1.in server, check serviceName's format 'groupName@@serviceName', groupName and serviceName can't be blank\n2.in client, check 'groupName@@serviceName', groupName and serviceName can't be blank", "committedDate": "2020-09-07T06:07:17Z", "type": "commit"}, {"oid": "6d37a5bd4cb84425f8b85d8c05053e92ffa07736", "url": "https://github.com/alibaba/nacos/commit/6d37a5bd4cb84425f8b85d8c05053e92ffa07736", "message": "ignore the check to groupName", "committedDate": "2020-09-07T08:34:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1NzA1Mg==", "url": "https://github.com/alibaba/nacos/pull/3767#discussion_r484357052", "bodyText": "I think check length of array is better than catch exception.", "author": "KomachiSion", "createdAt": "2020-09-07T10:55:30Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java", "diffHunk": "@@ -433,6 +440,19 @@ public ObjectNode listWithHealthStatus(@RequestParam String key) throws NacosExc\n         return result;\n     }\n     \n+    private void checkServiceNameFormat(String serviceName) {\n+        try {\n+            String[] split = serviceName.split(Constants.SERVICE_INFO_SPLITER);\n+            String service = split[1];", "originalCommit": "6d37a5bd4cb84425f8b85d8c05053e92ffa07736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ5MDAyMg==", "url": "https://github.com/alibaba/nacos/pull/3767#discussion_r484490022", "bodyText": "agree", "author": "chuntaojun", "createdAt": "2020-09-07T15:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1NzA1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2ee0d7de758f8e872f2538c6af720a4fdeb1a9a3", "chunk": "diff --git a/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java b/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\nindex 4456e5ac7..ca1a9c880 100644\n--- a/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\n+++ b/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\n\n@@ -441,16 +441,15 @@ public class InstanceController {\n     }\n     \n     private void checkServiceNameFormat(String serviceName) {\n-        try {\n-            String[] split = serviceName.split(Constants.SERVICE_INFO_SPLITER);\n-            String service = split[1];\n-            if (StringUtils.isBlank(service)) {\n-                throw new IllegalArgumentException(\"Param 'serviceName' is illegal, service is blank\");\n-            }\n-        } catch (IndexOutOfBoundsException e) {\n+        String[] split = serviceName.split(Constants.SERVICE_INFO_SPLITER);\n+        if (split.length <= 1) {\n             throw new IllegalArgumentException(\n                     \"Param 'serviceName' is illegal, it should be format as 'groupName@@serviceName\");\n         }\n+        String service = split[1];\n+        if (StringUtils.isBlank(service)) {\n+            throw new IllegalArgumentException(\"Param 'serviceName' is illegal, service is blank\");\n+        }\n     }\n     \n     private Instance parseInstance(HttpServletRequest request) throws Exception {\n"}}, {"oid": "2ee0d7de758f8e872f2538c6af720a4fdeb1a9a3", "url": "https://github.com/alibaba/nacos/commit/2ee0d7de758f8e872f2538c6af720a4fdeb1a9a3", "message": "check split's length instead of exception to check argument", "committedDate": "2020-09-07T14:36:18Z", "type": "commit"}, {"oid": "eb1ac54fa255d48ea160d34ba2a571829376bfbe", "url": "https://github.com/alibaba/nacos/commit/eb1ac54fa255d48ea160d34ba2a571829376bfbe", "message": "1.add some notes\n2.remove unnecessary code", "committedDate": "2020-09-08T02:48:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4MDM3NA==", "url": "https://github.com/alibaba/nacos/pull/3767#discussion_r484880374", "bodyText": "\u6539\u6210\nserviceName = \"@@\"; the length = 0; illegal\nserviceName = \"group@@\"; the length = 1; illegal\nserviceName = \"@@serviceName\"; the length = 2; legal\nserviceName = \"group@@serviceName\"; the length = 2; legal\n\n\u4f1a\u4e0d\u4f1a\u66f4\u597d\u7406\u89e3\uff1f", "author": "KomachiSion", "createdAt": "2020-09-08T12:34:49Z", "path": "naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java", "diffHunk": "@@ -433,6 +441,22 @@ public ObjectNode listWithHealthStatus(@RequestParam String key) throws NacosExc\n         return result;\n     }\n     \n+    /**\n+     * check combineServiceName format, the serviceName can't be blank. some relational logic in {@link\n+     * DistroFilter#doFilter}, it will handle combineServiceName in some case, you should know it\n+     *\n+     * @param combineServiceName such as: groupName@@serviceName\n+     */\n+    private void checkServiceNameFormat(String combineServiceName) {\n+        String[] split = combineServiceName.split(Constants.SERVICE_INFO_SPLITER);\n+        //namingService.registerInstance(\"\", \"\", instance); the length = 0\n+        //namingService.registerInstance(\"\", \"DEFAULT_GROUP\", instance); the length = 1", "originalCommit": "eb1ac54fa255d48ea160d34ba2a571829376bfbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4MjI2Nw==", "url": "https://github.com/alibaba/nacos/pull/3767#discussion_r484882267", "bodyText": "\u751a\u81f3\u53ef\u4ee5\u5427\u8fd9\u6bb5\u653e\u5728\u65b9\u6cd5\u7684\u6ce8\u91ca\u91cc\uff0c\u7528<p></p>\u5305\u4e00\u4e0b", "author": "KomachiSion", "createdAt": "2020-09-08T12:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4MDM3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkyMjI5OQ==", "url": "https://github.com/alibaba/nacos/pull/3767#discussion_r484922299", "bodyText": "\u8d5e", "author": "horizonzy", "createdAt": "2020-09-08T13:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg4MDM3NA=="}], "type": "inlineReview", "revised_code": {"commit": "2ada9585766a5c74acf14a7636ca270cc137ac9a", "chunk": "diff --git a/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java b/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\nindex a46fd09b5..b6b7974e9 100644\n--- a/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\n+++ b/naming/src/main/java/com/alibaba/nacos/naming/controllers/InstanceController.java\n\n@@ -442,15 +442,19 @@ public class InstanceController {\n     }\n     \n     /**\n-     * check combineServiceName format, the serviceName can't be blank. some relational logic in {@link\n-     * DistroFilter#doFilter}, it will handle combineServiceName in some case, you should know it\n+     * check combineServiceName format. the serviceName can't be blank. some relational logic in {@link\n+     * DistroFilter#doFilter}, it will handle combineServiceName in some case, you should know it.\n+     * <pre>\n+     * serviceName = \"@@\"; the length = 0; illegal\n+     * serviceName = \"group@@\"; the length = 1; illegal\n+     * serviceName = \"@@serviceName\"; the length = 2; legal\n+     * serviceName = \"group@@serviceName\"; the length = 2; legal\n+     * </pre>\n      *\n      * @param combineServiceName such as: groupName@@serviceName\n      */\n     private void checkServiceNameFormat(String combineServiceName) {\n         String[] split = combineServiceName.split(Constants.SERVICE_INFO_SPLITER);\n-        //namingService.registerInstance(\"\", \"\", instance); the length = 0\n-        //namingService.registerInstance(\"\", \"DEFAULT_GROUP\", instance); the length = 1\n         if (split.length <= 1) {\n             throw new IllegalArgumentException(\n                     \"Param 'serviceName' is illegal, it should be format as 'groupName@@serviceName\");\n"}}, {"oid": "2ada9585766a5c74acf14a7636ca270cc137ac9a", "url": "https://github.com/alibaba/nacos/commit/2ada9585766a5c74acf14a7636ca270cc137ac9a", "message": "modify the notes", "committedDate": "2020-09-08T13:58:29Z", "type": "commit"}]}