{"pr_number": 3522, "pr_title": "When binding roles, the user list is changed to the drop-down selection mode \uff08\u5728\u7ed1\u5b9a\u89d2\u8272\u7684\u65f6\u5019\u7528\u6237\u5217\u8868\u6539\u6210\u4e0b\u62c9\u9009\u4e2d\u7684\u6a21\u5f0f) #3518", "pr_createdAt": "2020-08-04T14:38:17Z", "pr_url": "https://github.com/alibaba/nacos/pull/3522", "timeline": [{"oid": "2216dc723375ade2ae9f2d39fc260dbcd596f58b", "url": "https://github.com/alibaba/nacos/commit/2216dc723375ade2ae9f2d39fc260dbcd596f58b", "message": "\u914d\u7f6epageSize\u5217\u8868 #3439", "committedDate": "2020-08-04T01:59:27Z", "type": "commit"}, {"oid": "10e05b9f68fc33cd73adffa4e8d461a574f2cf17", "url": "https://github.com/alibaba/nacos/commit/10e05b9f68fc33cd73adffa4e8d461a574f2cf17", "message": "Service List Page Increase the number of pages switching function is the same as the configuration management page #3500", "committedDate": "2020-08-04T02:52:30Z", "type": "commit"}, {"oid": "0e8cda787e9ced80c159f7c0e4711d674402a004", "url": "https://github.com/alibaba/nacos/commit/0e8cda787e9ced80c159f7c0e4711d674402a004", "message": "issues#3500 \u7f16\u8bd1\u4e4b\u540e\u7684\u4ee3\u7801", "committedDate": "2020-08-04T07:53:03Z", "type": "commit"}, {"oid": "72bceca7edd16c5fd50a9723804783b1c3a9fa2d", "url": "https://github.com/alibaba/nacos/commit/72bceca7edd16c5fd50a9723804783b1c3a9fa2d", "message": "\u5728\u7ed1\u5b9a\u89d2\u8272\u7684\u65f6\u5019\u7528\u6237\u5217\u8868\u6539\u6210\u4e0b\u62c9\u9009\u4e2d\u7684\u6a21\u5f0f #3518", "committedDate": "2020-08-04T14:36:18Z", "type": "commit"}, {"oid": "41eb4a05e56bc4c4722da9536b33fde263b1d56b", "url": "https://github.com/alibaba/nacos/commit/41eb4a05e56bc4c4722da9536b33fde263b1d56b", "message": "change code style", "committedDate": "2020-08-05T02:15:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzMzE5OQ==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465433199", "bodyText": "Do not change indent please.\nplease check for all your changed files", "author": "KomachiSion", "createdAt": "2020-08-05T02:21:02Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java", "diffHunk": "@@ -39,13 +40,13 @@\n @Conditional(value = ConditionOnEmbeddedStorage.class)\n @Component\n public class EmbeddedUserPersistServiceImpl implements UserPersistService {\n-    \n+", "originalCommit": "41eb4a05e56bc4c4722da9536b33fde263b1d56b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ0MDc5Mw==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465440793", "bodyText": "Github show the indent still be changed", "author": "KomachiSion", "createdAt": "2020-08-05T02:49:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzMzE5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ0MTUyOA==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465441528", "bodyText": "I am changing", "author": "zzq1314zll", "createdAt": "2020-08-05T02:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQzMzE5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "ad3e205a4eae1392be891e628c0ed30ea1b69c48", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java b/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\nindex 37dc29380..7b58e901f 100644\n--- a/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\n\n@@ -40,13 +40,13 @@ import static com.alibaba.nacos.config.server.service.repository.RowMapperManage\n @Conditional(value = ConditionOnEmbeddedStorage.class)\n @Component\n public class EmbeddedUserPersistServiceImpl implements UserPersistService {\n-\n+    \n     @Autowired\n     private DatabaseOperate databaseOperate;\n-\n+    \n     @Autowired\n     private EmbeddedStoragePersistServiceImpl persistService;\n-\n+    \n     /**\n      * Execute create user operation.\n      *\n"}}, {"oid": "ec02b83b3dc51371d7b0ff3c365c569f3c5ac786", "url": "https://github.com/alibaba/nacos/commit/ec02b83b3dc51371d7b0ff3c365c569f3c5ac786", "message": "delete unused import", "committedDate": "2020-08-05T02:26:32Z", "type": "commit"}, {"oid": "ad3e205a4eae1392be891e628c0ed30ea1b69c48", "url": "https://github.com/alibaba/nacos/commit/ad3e205a4eae1392be891e628c0ed30ea1b69c48", "message": "delete changed indent please.", "committedDate": "2020-08-05T02:59:39Z", "type": "commit"}, {"oid": "68ddfb843764ad43fda08a3dcfec0d3703b31a20", "url": "https://github.com/alibaba/nacos/commit/68ddfb843764ad43fda08a3dcfec0d3703b31a20", "message": "Merge branch 'upstream-develop' into develop-issues#3518\n\n# Conflicts:\n#\tconsole/src/main/resources/static/js/main.js", "committedDate": "2020-08-05T03:25:54Z", "type": "commit"}, {"oid": "8ad30a4c73d39ee2d58a3019fbd4526434447ec2", "url": "https://github.com/alibaba/nacos/commit/8ad30a4c73d39ee2d58a3019fbd4526434447ec2", "message": "Javadoc add an ending period", "committedDate": "2020-08-05T03:47:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU1Nzk4Nw==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465557987", "bodyText": "Is the SQL is right? Can you make sure this SQL can run both in derby and mysql?", "author": "KomachiSion", "createdAt": "2020-08-05T08:23:09Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java", "diffHunk": "@@ -117,4 +118,11 @@ public User findUserByUsername(String username) {\n         }\n         return pageInfo;\n     }\n+\n+    @Override\n+    public List<User> findUserLikeUsername(String username) {\n+        String sql = \"SELECT username FROM users WHERE username like '%' ? '%'\";", "originalCommit": "8ad30a4c73d39ee2d58a3019fbd4526434447ec2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU1OTI2MA==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465559260", "bodyText": "I think the SQL will be handle to SELECT username FROM users WHERE username like '%' 'xxx' '%'; if username is xxx", "author": "KomachiSion", "createdAt": "2020-08-05T08:25:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU1Nzk4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "5a0d0307eaa48ecefa3b020de30319755004aa3c", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java b/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\nindex 7b58e901f..41bcd5795 100644\n--- a/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/auth/EmbeddedUserPersistServiceImpl.java\n\n@@ -120,9 +120,9 @@ public class EmbeddedUserPersistServiceImpl implements UserPersistService {\n     }\n \n     @Override\n-    public List<User> findUserLikeUsername(String username) {\n-        String sql = \"SELECT username FROM users WHERE username like '%' ? '%'\";\n-        List<User> users = databaseOperate.queryMany(sql, new Object[]{username}, User.class);\n+    public List<String> findUserLikeUsername(String username) {\n+        String sql = \"SELECT username FROM users WHERE username like ? \";\n+        List<String> users = databaseOperate.queryMany(sql, new String[]{\"%\"+username+\"%\"}, String.class);\n         return users;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTYxMDYxNQ==", "url": "https://github.com/alibaba/nacos/pull/3522#discussion_r465610615", "bodyText": "Only query username in Embedded, but username,password in Extranal?", "author": "KomachiSion", "createdAt": "2020-08-05T09:54:50Z", "path": "config/src/main/java/com/alibaba/nacos/config/server/auth/ExternalUserPersistServiceImpl.java", "diffHunk": "@@ -145,4 +146,11 @@ public User findUserByUsername(String username) {\n             throw e;\n         }\n     }\n+\n+    @Override\n+    public List<User> findUserLikeUsername(String username) {\n+        String sql = \"SELECT username,password FROM users WHERE username like '%' ? '%'\";", "originalCommit": "8ad30a4c73d39ee2d58a3019fbd4526434447ec2", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5a0d0307eaa48ecefa3b020de30319755004aa3c", "chunk": "diff --git a/config/src/main/java/com/alibaba/nacos/config/server/auth/ExternalUserPersistServiceImpl.java b/config/src/main/java/com/alibaba/nacos/config/server/auth/ExternalUserPersistServiceImpl.java\nindex dcd60b209..800ad9168 100644\n--- a/config/src/main/java/com/alibaba/nacos/config/server/auth/ExternalUserPersistServiceImpl.java\n+++ b/config/src/main/java/com/alibaba/nacos/config/server/auth/ExternalUserPersistServiceImpl.java\n\n@@ -148,9 +148,9 @@ public class ExternalUserPersistServiceImpl implements UserPersistService {\n     }\n \n     @Override\n-    public List<User> findUserLikeUsername(String username) {\n-        String sql = \"SELECT username,password FROM users WHERE username like '%' ? '%'\";\n-        List<User> users = this.jt.query(sql, new Object[]{username}, USER_ROW_MAPPER);\n+    public List<String> findUserLikeUsername(String username) {\n+        String sql = \"SELECT username FROM users WHERE username like '%' ? '%'\";\n+        List<String> users = this.jt.queryForList(sql,new String[]{username},String.class);\n         return users;\n     }\n }\n"}}, {"oid": "5a0d0307eaa48ecefa3b020de30319755004aa3c", "url": "https://github.com/alibaba/nacos/commit/5a0d0307eaa48ecefa3b020de30319755004aa3c", "message": "fix bad sql and change return type", "committedDate": "2020-08-05T15:44:00Z", "type": "commit"}, {"oid": "58da19bd75eee0ba01f763d77c081ca57f1033fc", "url": "https://github.com/alibaba/nacos/commit/58da19bd75eee0ba01f763d77c081ca57f1033fc", "message": "change js get value", "committedDate": "2020-08-05T15:48:46Z", "type": "commit"}, {"oid": "809dc49def3d6d634727b1e07b685cc7c4f622c2", "url": "https://github.com/alibaba/nacos/commit/809dc49def3d6d634727b1e07b685cc7c4f622c2", "message": "delete whitespace", "committedDate": "2020-08-05T15:55:47Z", "type": "commit"}, {"oid": "badec6491e0ef81cfa247ac1ac807eedba775e50", "url": "https://github.com/alibaba/nacos/commit/badec6491e0ef81cfa247ac1ac807eedba775e50", "message": "check code style", "committedDate": "2020-08-05T16:05:06Z", "type": "commit"}, {"oid": "c4324454cc44e95fd7588ba9af8a0f9d3ad5ae88", "url": "https://github.com/alibaba/nacos/commit/c4324454cc44e95fd7588ba9af8a0f9d3ad5ae88", "message": "add permissions, associated role, change to fuzzy matching drop-down(java code)", "committedDate": "2020-08-06T00:13:51Z", "type": "commit"}, {"oid": "1e46e452a4072d18cb9af3b0f0246bff107798c4", "url": "https://github.com/alibaba/nacos/commit/1e46e452a4072d18cb9af3b0f0246bff107798c4", "message": "add permissions, associated role, change to fuzzy matching drop-down(js code)", "committedDate": "2020-08-06T00:20:33Z", "type": "commit"}, {"oid": "41aa594f3fa5284e68bf34278f6dbfaa54a40a4c", "url": "https://github.com/alibaba/nacos/commit/41aa594f3fa5284e68bf34278f6dbfaa54a40a4c", "message": "Merge remote-tracking branch 'origin/develop-issues#3518' into develop-issues#3518", "committedDate": "2020-08-06T00:21:01Z", "type": "commit"}, {"oid": "8b4343abe89fb4c30a11dd3fe910c768d8987968", "url": "https://github.com/alibaba/nacos/commit/8b4343abe89fb4c30a11dd3fe910c768d8987968", "message": "delete \"/\"", "committedDate": "2020-08-06T05:03:20Z", "type": "commit"}]}