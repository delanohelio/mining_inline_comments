{"pr_number": 641, "pr_title": "Reload legacy autnums every 15 minutes.", "pr_createdAt": "2020-06-23T11:42:48Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/641", "timeline": [{"oid": "637ebcc9060de35be60ac39b4b63cd5e76f8c056", "url": "https://github.com/RIPE-NCC/whois/commit/637ebcc9060de35be60ac39b4b63cd5e76f8c056", "message": "Reload legacy autnums every 15 minutes.", "committedDate": "2020-06-23T11:42:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4MTMwNg==", "url": "https://github.com/RIPE-NCC/whois/pull/641#discussion_r444181306", "bodyText": "Is this a global lock? Do we still need it?", "author": "eshryane", "createdAt": "2020-06-23T12:23:25Z", "path": "whois-scheduler/src/main/java/net/ripe/db/whois/scheduler/task/autnum/LegacyAutnumReloadTask.java", "diffHunk": "@@ -21,7 +21,7 @@ public LegacyAutnumReloadTask(final LegacyAutnum legacyAutnum) {\n     }\n \n     @Override\n-    @Scheduled(cron = \"0 0 0 * * *\")\n+    @Scheduled(cron = \"0 1/15 * * * *\")\n     @SchedulerLock(name = \"ReloadLegacyAutnums\")", "originalCommit": "637ebcc9060de35be60ac39b4b63cd5e76f8c056", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4NjI5Ng==", "url": "https://github.com/RIPE-NCC/whois/pull/641#discussion_r444186296", "bodyText": "Yes it's the global lock and you're right we don't need it. I've removed it as the task needs to be executed on all nodes every 15 minutes.", "author": "sbusk", "createdAt": "2020-06-23T12:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDE4MTMwNg=="}], "type": "inlineReview", "revised_code": {"commit": "8a4af09d89fc4b82be0c23b7f8ad9597293cd361", "chunk": "diff --git a/whois-scheduler/src/main/java/net/ripe/db/whois/scheduler/task/autnum/LegacyAutnumReloadTask.java b/whois-scheduler/src/main/java/net/ripe/db/whois/scheduler/task/autnum/LegacyAutnumReloadTask.java\nindex a9dbadc51..0a6fa3201 100644\n--- a/whois-scheduler/src/main/java/net/ripe/db/whois/scheduler/task/autnum/LegacyAutnumReloadTask.java\n+++ b/whois-scheduler/src/main/java/net/ripe/db/whois/scheduler/task/autnum/LegacyAutnumReloadTask.java\n\n@@ -22,7 +21,6 @@ public class LegacyAutnumReloadTask implements DailyScheduledTask {\n \n     @Override\n     @Scheduled(cron = \"0 1/15 * * * *\")\n-    @SchedulerLock(name = \"ReloadLegacyAutnums\")\n     public void run() {\n         LOGGER.info(\"Reloading legacy autnums\");\n         final int previousTotal = legacyAutnum.getTotal();\n"}}, {"oid": "8a4af09d89fc4b82be0c23b7f8ad9597293cd361", "url": "https://github.com/RIPE-NCC/whois/commit/8a4af09d89fc4b82be0c23b7f8ad9597293cd361", "message": "Don't need a global lock, legacy autnums need to be refreshed on all servers.", "committedDate": "2020-06-23T12:29:56Z", "type": "commit"}]}