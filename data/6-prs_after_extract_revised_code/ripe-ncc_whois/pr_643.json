{"pr_number": 643, "pr_title": "NWI-11 Punycode Internationalized Domain Names in email addresses.", "pr_createdAt": "2020-07-07T07:53:03Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/643", "timeline": [{"oid": "c89fc7271114cba6daef9528e66e4620b006f8cf", "url": "https://github.com/RIPE-NCC/whois/commit/c89fc7271114cba6daef9528e66e4620b006f8cf", "message": "Punycode Internationalized Domain Names in email addresses.", "committedDate": "2020-07-07T07:52:04Z", "type": "commit"}, {"oid": "6cb8537e83a56e70c6c5cf574add6a758cbe6085", "url": "https://github.com/RIPE-NCC/whois/commit/6cb8537e83a56e70c6c5cf574add6a758cbe6085", "message": "Fix test code.", "committedDate": "2020-07-07T07:54:36Z", "type": "commit"}, {"oid": "441118bd372c281d6d999b8d26841905a410eba0", "url": "https://github.com/RIPE-NCC/whois/commit/441118bd372c281d6d999b8d26841905a410eba0", "message": "Added unit tests for punycoding of email addresses.", "committedDate": "2020-07-08T11:54:43Z", "type": "commit"}, {"oid": "0a0d32ff6a809513a2a4688beeac420cb7169337", "url": "https://github.com/RIPE-NCC/whois/commit/0a0d32ff6a809513a2a4688beeac420cb7169337", "message": "Allow gzip or deflate compression in RSNG response. Tested response size is reduced from 19MB to 3.8MB without affecting response time.", "committedDate": "2020-07-13T14:21:17Z", "type": "commit"}, {"oid": "3f95dd6f3fa04cec649820b124240684a7faa1fe", "url": "https://github.com/RIPE-NCC/whois/commit/3f95dd6f3fa04cec649820b124240684a7faa1fe", "message": "An object may be deleted from the RIPE database and a full text search matches it before its been removed from the index. (#644)\n\nHandle this by catching the DB exception, and decrementing the result size (i.e. skip the non-existant match).", "committedDate": "2020-07-13T14:21:17Z", "type": "commit"}, {"oid": "fcfb6e4da7dbae2909cf3bfdf6aebf661575b181", "url": "https://github.com/RIPE-NCC/whois/commit/fcfb6e4da7dbae2909cf3bfdf6aebf661575b181", "message": "An object may be deleted from the RIPE database and an RDAP search matches it before its been removed from the full text search index. (#645)\n\nHandle this by catching the DB exception, and continuing (i.e. skip the non-existant match).", "committedDate": "2020-07-13T14:21:17Z", "type": "commit"}, {"oid": "eabfa768b6ee08abe46d63213cc4b7e108bbbc40", "url": "https://github.com/RIPE-NCC/whois/commit/eabfa768b6ee08abe46d63213cc4b7e108bbbc40", "message": "Merge branch 'master' into punycode", "committedDate": "2020-07-13T14:21:20Z", "type": "commit"}, {"oid": "053a58c6299a507c7bfd7e2df0096fd65b1bbdaa", "url": "https://github.com/RIPE-NCC/whois/commit/053a58c6299a507c7bfd7e2df0096fd65b1bbdaa", "message": "Non-latin1 characters are substituted and not converted to Punycode properly.", "committedDate": "2020-07-14T06:51:19Z", "type": "commit"}, {"oid": "076d122aaa9665708655a23336940c3266826b1f", "url": "https://github.com/RIPE-NCC/whois/commit/076d122aaa9665708655a23336940c3266826b1f", "message": "Added integration test", "committedDate": "2020-07-14T06:58:06Z", "type": "commit"}, {"oid": "f915b21442a234e971ea99819cdd959c282ed992", "url": "https://github.com/RIPE-NCC/whois/commit/f915b21442a234e971ea99819cdd959c282ed992", "message": "Only accept US ASCII characters for email address local part.", "committedDate": "2020-07-14T07:25:00Z", "type": "commit"}, {"oid": "cff57f3619555d8473d9e47efefff224d0ae8dff", "url": "https://github.com/RIPE-NCC/whois/commit/cff57f3619555d8473d9e47efefff224d0ae8dff", "message": "Merge branch 'master' into punycode", "committedDate": "2020-09-08T12:40:46Z", "type": "commit"}, {"oid": "503155ad3eb95d146cef0f10b994f0aeba980ef6", "url": "https://github.com/RIPE-NCC/whois/commit/503155ad3eb95d146cef0f10b994f0aeba980ef6", "message": "Perform Punycode conversion on the paragraph and not on the RPSL object (i.e. before the content has been converted to latin-1)", "committedDate": "2020-09-16T07:54:51Z", "type": "commit"}, {"oid": "8a83891bc9e6e3aaf6d826221694af39dd5dd83f", "url": "https://github.com/RIPE-NCC/whois/commit/8a83891bc9e6e3aaf6d826221694af39dd5dd83f", "message": "Improved logging on failure", "committedDate": "2020-09-16T08:23:22Z", "type": "commit"}, {"oid": "49c2733bc6b5643aa8d201dd9712fea9cca2b717", "url": "https://github.com/RIPE-NCC/whois/commit/49c2733bc6b5643aa8d201dd9712fea9cca2b717", "message": "Added tests", "committedDate": "2020-09-16T08:37:07Z", "type": "commit"}, {"oid": "6070682d45a8caa5877fe71ac8ebcda2e3944482", "url": "https://github.com/RIPE-NCC/whois/commit/6070682d45a8caa5877fe71ac8ebcda2e3944482", "message": "Allow charset to be specified in Syncupdates request", "committedDate": "2020-09-16T10:05:32Z", "type": "commit"}, {"oid": "9969a2e19441c5fd7a0377c64145e0f564281b3e", "url": "https://github.com/RIPE-NCC/whois/commit/9969a2e19441c5fd7a0377c64145e0f564281b3e", "message": "Updated tests", "committedDate": "2020-09-16T10:07:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1MTAwMA==", "url": "https://github.com/RIPE-NCC/whois/pull/643#discussion_r489351000", "bodyText": "Minor: Maybe consider using StandardCharsets.ISO_8859_1 instead of hardcoded string", "author": "dadepo", "createdAt": "2020-09-16T11:02:04Z", "path": "whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java", "diffHunk": "@@ -83,23 +84,20 @@ public SyncUpdateBuilder setRedirect(final boolean redirect) {\n         return this;\n     }\n \n-    public Client build() {\n-        if (url != null) {\n-            return new Client(url, headers, data, help, diff, aNew, redirect);\n-        }\n-\n-        if (host != null && port != null && source != null) {\n-            return new Client(host, port, source, headers, data, help, diff, aNew, redirect);\n-        }\n+    public SyncUpdateBuilder setCharset(final String charset) {\n+        this.charset = charset;\n+        return this;\n+    }\n \n-        throw new IllegalStateException(\"Either (host, port, source) or (url) should not be null\");\n+    public Client build() {\n+        return new Client(url, host, port, source, headers, data, help, diff, aNew, redirect, charset);\n     }\n \n     public static class Client {\n \n         private static final Joiner.MapJoiner PARAM_JOINER = Joiner.on('&').withKeyValueSeparator(\"=\");\n         private static final Pattern CHARSET_PATTERN = Pattern.compile(\".*;charset=(.*)\");\n-        private static final String CHARSET = \"ISO-8859-1\";\n+        private static final String DEFAULT_CHARSET = \"ISO-8859-1\";", "originalCommit": "9969a2e19441c5fd7a0377c64145e0f564281b3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM3Nzc4Mg==", "url": "https://github.com/RIPE-NCC/whois/pull/643#discussion_r489377782", "bodyText": "Done!", "author": "eshryane", "createdAt": "2020-09-16T11:53:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1MTAwMA=="}], "type": "inlineReview", "revised_code": {"commit": "bcdbb7865c39b55c34d8f30a2d02219616b59771", "chunk": "diff --git a/whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java b/whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java\nindex 79eccdd31..1c02cf206 100644\n--- a/whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java\n+++ b/whois-client/src/main/java/net/ripe/db/whois/api/syncupdate/SyncUpdateBuilder.java\n\n@@ -97,7 +99,7 @@ public class SyncUpdateBuilder {\n \n         private static final Joiner.MapJoiner PARAM_JOINER = Joiner.on('&').withKeyValueSeparator(\"=\");\n         private static final Pattern CHARSET_PATTERN = Pattern.compile(\".*;charset=(.*)\");\n-        private static final String DEFAULT_CHARSET = \"ISO-8859-1\";\n+        private static final Charset DEFAULT_CHARSET = StandardCharsets.ISO_8859_1;\n \n         private final URL url;\n         private final MultivaluedMap<String, String> headers;\n"}}, {"oid": "bcdbb7865c39b55c34d8f30a2d02219616b59771", "url": "https://github.com/RIPE-NCC/whois/commit/bcdbb7865c39b55c34d8f30a2d02219616b59771", "message": "Use constant for charset rather than hard-coded String.", "committedDate": "2020-09-16T11:53:34Z", "type": "commit"}, {"oid": "646055776a881df3d3b3d73f07ab9f88c9cd71db", "url": "https://github.com/RIPE-NCC/whois/commit/646055776a881df3d3b3d73f07ab9f88c9cd71db", "message": "Test punycode abuse-mailbox but object is syntactically incorrect", "committedDate": "2020-09-16T12:07:27Z", "type": "commit"}]}