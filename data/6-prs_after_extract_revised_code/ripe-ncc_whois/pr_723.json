{"pr_number": 723, "pr_title": "Delete object bug", "pr_createdAt": "2020-12-16T13:59:40Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/723", "timeline": [{"oid": "a7325eb35aef1cf48131d86a0babf089ade9c2bb", "url": "https://github.com/RIPE-NCC/whois/commit/a7325eb35aef1cf48131d86a0babf089ade9c2bb", "message": "delete object with sanitize bug", "committedDate": "2020-12-14T15:15:08Z", "type": "commit"}, {"oid": "1447a942ba6cfea1c4ce510cbf3ceb9da0beda8e", "url": "https://github.com/RIPE-NCC/whois/commit/1447a942ba6cfea1c4ce510cbf3ceb9da0beda8e", "message": "formatting", "committedDate": "2020-12-14T16:30:00Z", "type": "commit"}, {"oid": "5b8b8e19f8180a6458f00a7bb3ae0ead40e66db4", "url": "https://github.com/RIPE-NCC/whois/commit/5b8b8e19f8180a6458f00a7bb3ae0ead40e66db4", "message": "delete with cidr  supported", "committedDate": "2020-12-16T12:52:40Z", "type": "commit"}, {"oid": "3d739d77b3cc72ec7856040f2aa429caf02674d3", "url": "https://github.com/RIPE-NCC/whois/commit/3d739d77b3cc72ec7856040f2aa429caf02674d3", "message": "imports", "committedDate": "2020-12-16T14:01:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545714429", "bodyText": "So the error message will contain the key as the user submitted it?", "author": "eshryane", "createdAt": "2020-12-18T09:39:53Z", "path": "whois-update/src/main/java/net/ripe/db/whois/update/handler/SingleUpdateHandler.java", "diffHunk": "@@ -102,7 +102,7 @@ public void handle(final Origin origin, final Keyword keyword, final Update upda\n         }\n \n         if (action == Action.DELETE && originalObject == null) {\n-            updateContext.addMessage(update, UpdateMessages.objectNotFound(updatedObject.getFormattedKey()));\n+            updateContext.addMessage(update, UpdateMessages.objectNotFound(update.getSubmittedObject().getFormattedKey()));", "originalCommit": "3d739d77b3cc72ec7856040f2aa429caf02674d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNzI4NA==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545717284", "bodyText": "Yes, like it was before.", "author": "maggarwal13", "createdAt": "2020-12-18T09:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMDk1NA==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545720954", "bodyText": "Great, thanks", "author": "eshryane", "createdAt": "2020-12-18T09:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDQyOQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545714904", "bodyText": "Do you need to test the primary key in the test? It seems superfluous", "author": "eshryane", "createdAt": "2020-12-18T09:40:49Z", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java", "diffHunk": "@@ -4707,6 +4707,33 @@ public void delete_route_out_of_region_redirect() {\n         databaseHelper.addAuthoritativeResource(\"test\", \"0.0.0.0/0\");\n     }\n \n+    @Test\n+    public void delete_domain_trailing_dot_nserver() {\n+        databaseHelper.addObject(\n+                \"domain:        193.in-addr.arpa4\\n\" +\n+                        \"nserver:         test.ns.\\n\" +\n+                        \"mnt-by:          OWNER-MNT\\n\" +\n+                        \"source:          TEST\\n\");\n+\n+        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n+                .request()\n+                .get(WhoisResources.class);\n+        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));", "originalCommit": "3d739d77b3cc72ec7856040f2aa429caf02674d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxODA1Mw==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545718053", "bodyText": "Its just a way to test that before delete key exists and after it does not. I can remove that if you prefer that", "author": "maggarwal13", "createdAt": "2020-12-18T09:46:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMDg0NQ==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545720845", "bodyText": "I don't think it's needed, and can be safely removed", "author": "eshryane", "createdAt": "2020-12-18T09:51:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcyMjc5OQ==", "url": "https://github.com/RIPE-NCC/whois/pull/723#discussion_r545722799", "bodyText": "Done", "author": "maggarwal13", "createdAt": "2020-12-18T09:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxNDkwNA=="}], "type": "inlineReview", "revised_code": {"commit": "8c3dc622d568707cdcb64d389e135ae3bfa0ccb5", "chunk": "diff --git a/whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java b/whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java\nindex 15c459702..80ebc13f1 100644\n--- a/whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java\n+++ b/whois-api/src/test/java/net/ripe/db/whois/api/rest/WhoisRestServiceTestIntegration.java\n\n@@ -4715,23 +4715,9 @@ public class WhoisRestServiceTestIntegration extends AbstractIntegrationTest {\n                         \"mnt-by:          OWNER-MNT\\n\" +\n                         \"source:          TEST\\n\");\n \n-        final WhoisResources whoisResources = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n-                .request()\n-                .get(WhoisResources.class);\n-        assertThat(whoisResources.getWhoisObjects().get(0).getPrimaryKey().get(0).getValue(), is(\"193.in-addr.arpa4\"));\n-\n         final Response response = RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4?password=test\")\n                 .request().delete();\n         assertThat(response.getStatus(), is(Response.Status.OK.getStatusCode()));\n-\n-        try {\n-            RestTest.target(getPort(), \"whois/test/domain/193.in-addr.arpa4\")\n-                    .request()\n-                    .get(WhoisResources.class);\n-            fail();\n-        } catch (NotFoundException ex) {\n-            assertThat(ex.getResponse().readEntity(WhoisResources.class).getErrorMessages().get(0).getText(), containsString(\"ERROR:101: no entries found\"));\n-        }\n     }\n \n     @Test\n"}}, {"oid": "8c3dc622d568707cdcb64d389e135ae3bfa0ccb5", "url": "https://github.com/RIPE-NCC/whois/commit/8c3dc622d568707cdcb64d389e135ae3bfa0ccb5", "message": "test case simplfy", "committedDate": "2020-12-18T09:54:16Z", "type": "commit"}]}