{"pr_number": 2112, "pr_title": "Add additional platform signals to UserAgent.", "pr_createdAt": "2020-10-27T18:22:41Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/2112", "timeline": [{"oid": "41e644e23f142429fca83eb5625a329dea094a43", "url": "https://github.com/firebase/firebase-android-sdk/commit/41e644e23f142429fca83eb5625a329dea094a43", "message": "Add additional platform signals to UserAgent.", "committedDate": "2020-10-27T18:21:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk0MTYzMQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2112#discussion_r512941631", "bodyText": "nit: are we making sure we substitute spaces in the value anywhere?", "author": "maksymmalyhin", "createdAt": "2020-10-27T18:43:08Z", "path": "firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase;\n+\n+import android.content.pm.ApplicationInfo;\n+import android.content.pm.PackageManager;\n+import android.os.Build;\n+import com.google.firebase.components.Component;\n+import com.google.firebase.components.ComponentRegistrar;\n+import com.google.firebase.heartbeatinfo.DefaultHeartBeatInfo;\n+import com.google.firebase.platforminfo.DefaultUserAgentPublisher;\n+import com.google.firebase.platforminfo.LibraryVersionComponent;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/** @hide */\n+public class FirebaseCommonRegistrar implements ComponentRegistrar {\n+  private static final String FIREBASE_ANDROID = \"fire-android\";\n+  private static final String FIREBASE_COMMON = \"fire-core\";\n+  private static final String DEVICE_NAME = \"device-name\";\n+  private static final String DEVICE_MODEL = \"device-model\";\n+  private static final String DEVICE_BRAND = \"device-brand\";\n+  private static final String TARGET_SDK = \"android-target-sdk\";\n+  private static final String MIN_SDK = \"android-min-sdk\";\n+  private static final String ANDROID_PLATFORM = \"android-platform\";\n+  private static final String ANDROID_INSTALLER = \"android-installer\";\n+\n+  @Override\n+  public List<Component<?>> getComponents() {\n+    return Arrays.asList(\n+        LibraryVersionComponent.create(FIREBASE_ANDROID, String.valueOf(Build.VERSION.SDK_INT)),\n+        LibraryVersionComponent.create(FIREBASE_COMMON, BuildConfig.VERSION_NAME),\n+        LibraryVersionComponent.create(DEVICE_NAME, Build.PRODUCT),", "originalCommit": "41e644e23f142429fca83eb5625a329dea094a43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e7cdcdd3017242fb71dd50e6d2a2ecc30e5e13bf", "chunk": "diff --git a/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java b/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\nindex 9738e4c9..b4c4ef9f 100644\n--- a/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\n+++ b/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\n\n@@ -21,8 +21,9 @@ import com.google.firebase.components.Component;\n import com.google.firebase.components.ComponentRegistrar;\n import com.google.firebase.heartbeatinfo.DefaultHeartBeatInfo;\n import com.google.firebase.platforminfo.DefaultUserAgentPublisher;\n+import com.google.firebase.platforminfo.KotlinDetector;\n import com.google.firebase.platforminfo.LibraryVersionComponent;\n-import java.util.Arrays;\n+import java.util.ArrayList;\n import java.util.List;\n \n /** @hide */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc2MTI2MA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2112#discussion_r513761260", "bodyText": "possible to make these constants? Here and throughout", "author": "VinayGuthal", "createdAt": "2020-10-28T21:08:02Z", "path": "firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright 2020 Google LLC\n+//\n+// Licensed under the Apache License, Version 2.0 (the \"License\");\n+// you may not use this file except in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+//      http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing, software\n+// distributed under the License is distributed on an \"AS IS\" BASIS,\n+// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+// See the License for the specific language governing permissions and\n+// limitations under the License.\n+\n+package com.google.firebase;\n+\n+import android.content.pm.ApplicationInfo;\n+import android.content.pm.PackageManager;\n+import android.os.Build;\n+import com.google.firebase.components.Component;\n+import com.google.firebase.components.ComponentRegistrar;\n+import com.google.firebase.heartbeatinfo.DefaultHeartBeatInfo;\n+import com.google.firebase.platforminfo.DefaultUserAgentPublisher;\n+import com.google.firebase.platforminfo.LibraryVersionComponent;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+/** @hide */\n+public class FirebaseCommonRegistrar implements ComponentRegistrar {\n+  private static final String FIREBASE_ANDROID = \"fire-android\";\n+  private static final String FIREBASE_COMMON = \"fire-core\";\n+  private static final String DEVICE_NAME = \"device-name\";\n+  private static final String DEVICE_MODEL = \"device-model\";\n+  private static final String DEVICE_BRAND = \"device-brand\";\n+  private static final String TARGET_SDK = \"android-target-sdk\";\n+  private static final String MIN_SDK = \"android-min-sdk\";\n+  private static final String ANDROID_PLATFORM = \"android-platform\";\n+  private static final String ANDROID_INSTALLER = \"android-installer\";\n+\n+  @Override\n+  public List<Component<?>> getComponents() {\n+    return Arrays.asList(\n+        LibraryVersionComponent.create(FIREBASE_ANDROID, String.valueOf(Build.VERSION.SDK_INT)),\n+        LibraryVersionComponent.create(FIREBASE_COMMON, BuildConfig.VERSION_NAME),\n+        LibraryVersionComponent.create(DEVICE_NAME, Build.PRODUCT),\n+        LibraryVersionComponent.create(DEVICE_MODEL, Build.DEVICE),\n+        LibraryVersionComponent.create(DEVICE_BRAND, Build.BRAND),\n+        LibraryVersionComponent.fromContext(\n+            TARGET_SDK,\n+            ctx -> {\n+              ApplicationInfo info = ctx.getApplicationInfo();\n+              if (info != null) {\n+                return String.valueOf(info.targetSdkVersion);\n+              }\n+              return \"\";\n+            }),\n+        LibraryVersionComponent.fromContext(\n+            MIN_SDK,\n+            ctx -> {\n+              ApplicationInfo info = ctx.getApplicationInfo();\n+              if (info != null && Build.VERSION.SDK_INT >= Build.VERSION_CODES.N) {\n+                return String.valueOf(info.minSdkVersion);\n+              }\n+              return \"\";\n+            }),\n+        LibraryVersionComponent.fromContext(\n+            ANDROID_PLATFORM,\n+            ctx -> {\n+              if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN\n+                  && ctx.getPackageManager().hasSystemFeature(PackageManager.FEATURE_TELEVISION)) {\n+                return \"tv\";", "originalCommit": "41e644e23f142429fca83eb5625a329dea094a43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e7cdcdd3017242fb71dd50e6d2a2ecc30e5e13bf", "chunk": "diff --git a/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java b/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\nindex 9738e4c9..b4c4ef9f 100644\n--- a/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\n+++ b/firebase-common/src/main/java/com/google/firebase/FirebaseCommonRegistrar.java\n\n@@ -21,8 +21,9 @@ import com.google.firebase.components.Component;\n import com.google.firebase.components.ComponentRegistrar;\n import com.google.firebase.heartbeatinfo.DefaultHeartBeatInfo;\n import com.google.firebase.platforminfo.DefaultUserAgentPublisher;\n+import com.google.firebase.platforminfo.KotlinDetector;\n import com.google.firebase.platforminfo.LibraryVersionComponent;\n-import java.util.Arrays;\n+import java.util.ArrayList;\n import java.util.List;\n \n /** @hide */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc2MTkxNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2112#discussion_r513761917", "bodyText": "This cannot be moved inside the new FirebaseCommonRegistrar? Since I am assuming the useragentstring will also get this value right?", "author": "VinayGuthal", "createdAt": "2020-10-28T21:08:59Z", "path": "firebase-common/src/main/java/com/google/firebase/FirebaseApp.java", "diffHunk": "@@ -428,11 +427,7 @@ protected FirebaseApp(Context applicationContext, String name, FirebaseOptions o\n             Component.of(applicationContext, Context.class),\n             Component.of(this, FirebaseApp.class),\n             Component.of(options, FirebaseOptions.class),\n-            LibraryVersionComponent.create(FIREBASE_ANDROID, \"\"),\n-            LibraryVersionComponent.create(FIREBASE_COMMON, BuildConfig.VERSION_NAME),\n-            kotlinVersion != null ? LibraryVersionComponent.create(KOTLIN, kotlinVersion) : null,\n-            DefaultUserAgentPublisher.component(),\n-            DefaultHeartBeatInfo.component());\n+            kotlinVersion != null ? LibraryVersionComponent.create(KOTLIN, kotlinVersion) : null);", "originalCommit": "41e644e23f142429fca83eb5625a329dea094a43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e7cdcdd3017242fb71dd50e6d2a2ecc30e5e13bf", "chunk": "diff --git a/firebase-common/src/main/java/com/google/firebase/FirebaseApp.java b/firebase-common/src/main/java/com/google/firebase/FirebaseApp.java\nindex 556bf475..f06e337e 100644\n--- a/firebase-common/src/main/java/com/google/firebase/FirebaseApp.java\n+++ b/firebase-common/src/main/java/com/google/firebase/FirebaseApp.java\n\n@@ -419,15 +417,13 @@ public class FirebaseApp {\n             .discover();\n     registrars.add(new FirebaseCommonRegistrar());\n \n-    String kotlinVersion = KotlinDetector.detectVersion();\n     componentRuntime =\n         new ComponentRuntime(\n             UI_EXECUTOR,\n             registrars,\n             Component.of(applicationContext, Context.class),\n             Component.of(this, FirebaseApp.class),\n-            Component.of(options, FirebaseOptions.class),\n-            kotlinVersion != null ? LibraryVersionComponent.create(KOTLIN, kotlinVersion) : null);\n+            Component.of(options, FirebaseOptions.class));\n \n     dataCollectionConfigStorage =\n         new Lazy<>(\n"}}, {"oid": "e7cdcdd3017242fb71dd50e6d2a2ecc30e5e13bf", "url": "https://github.com/firebase/firebase-android-sdk/commit/e7cdcdd3017242fb71dd50e6d2a2ecc30e5e13bf", "message": "Address review comments.", "committedDate": "2020-10-29T14:53:11Z", "type": "commit"}, {"oid": "2f5849023863b7a0731961c76f02a79ea8ea9930", "url": "https://github.com/firebase/firebase-android-sdk/commit/2f5849023863b7a0731961c76f02a79ea8ea9930", "message": "Replace spaces in user agent values.", "committedDate": "2020-10-29T14:58:17Z", "type": "commit"}, {"oid": "f8ae8117ab3ac45ce274173f4718dced4b9561fe", "url": "https://github.com/firebase/firebase-android-sdk/commit/f8ae8117ab3ac45ce274173f4718dced4b9561fe", "message": "Address review comment.", "committedDate": "2020-10-29T16:52:20Z", "type": "commit"}]}