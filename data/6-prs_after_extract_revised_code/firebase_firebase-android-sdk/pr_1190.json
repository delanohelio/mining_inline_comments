{"pr_number": 1190, "pr_title": "Chime Hack: Allow Chime to migrate Insatnce_IDs.", "pr_createdAt": "2020-02-03T22:49:14Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1190", "timeline": [{"oid": "6c5d4b53ea22de876e5aa42ec7843be2c5b0017b", "url": "https://github.com/firebase/firebase-android-sdk/commit/6c5d4b53ea22de876e5aa42ec7843be2c5b0017b", "message": "Chime Hack: Allow Chime to migrate Insatnce_IDs.", "committedDate": "2020-02-03T22:47:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM5NDkzOA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1190#discussion_r374394938", "bodyText": "shouldn't this be a separate PR?", "author": "andirayo", "createdAt": "2020-02-03T23:13:20Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -363,13 +364,14 @@ private PersistedInstallationEntry getPrefsWithGeneratedIdMultiProcessSafe() {\n   }\n \n   private String readExistingIidOrCreateFid(PersistedInstallationEntry prefs) {\n-    // Check if this firebase app is the default (first initialized) instance\n-    if (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration()) {\n+    // Check if this firebase app is the default (first initialized) instance or is a chime app\n+    if (!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME)\n+        && (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration())) {\n       return fidGenerator.createRandomFid();\n     }\n-    // For a default firebase installation, read the existing iid from shared prefs\n+    // For a default/chime firebase installation, read the existing iid from shared prefs\n     String fid = iidStore.readIid();\n-    if (fid == null) {\n+    if (TextUtils.isEmpty(fid)) {", "originalCommit": "6c5d4b53ea22de876e5aa42ec7843be2c5b0017b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwMjM3Ng==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1190#discussion_r374402376", "bodyText": "Small change and seemed relevant as the change the same method. Will do it next time.", "author": "ankitaj224", "createdAt": "2020-02-03T23:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM5NDkzOA=="}], "type": "inlineReview", "revised_code": {"commit": "4d15656642d5e1513d1a479ed6a9c4e4940646b0", "chunk": "diff --git a/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java b/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\nindex 32647552..d4dd4512 100644\n--- a/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\n+++ b/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\n\n@@ -365,8 +365,8 @@ public class FirebaseInstallations implements FirebaseInstallationsApi {\n \n   private String readExistingIidOrCreateFid(PersistedInstallationEntry prefs) {\n     // Check if this firebase app is the default (first initialized) instance or is a chime app\n-    if (!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME)\n-        && (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration())) {\n+    if ((!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME) && !firebaseApp.isDefaultApp())\n+        || !prefs.shouldAttemptMigration()) {\n       return fidGenerator.createRandomFid();\n     }\n     // For a default/chime firebase installation, read the existing iid from shared prefs\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM5NTcxNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1190#discussion_r374395717", "bodyText": "Not sure if the bracketing is right here...\nI don't know what #shouldAttemptMigration does (so I might be wrong here)...\nBut it seems, that this should be changed to:\nif ((!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME) && !firebaseApp.isDefaultApp())\n   || !prefs.shouldAttemptMigration()) {", "author": "andirayo", "createdAt": "2020-02-03T23:15:39Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java", "diffHunk": "@@ -363,13 +364,14 @@ private PersistedInstallationEntry getPrefsWithGeneratedIdMultiProcessSafe() {\n   }\n \n   private String readExistingIidOrCreateFid(PersistedInstallationEntry prefs) {\n-    // Check if this firebase app is the default (first initialized) instance\n-    if (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration()) {\n+    // Check if this firebase app is the default (first initialized) instance or is a chime app\n+    if (!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME)\n+        && (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration())) {", "originalCommit": "6c5d4b53ea22de876e5aa42ec7843be2c5b0017b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQwMTgwMA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1190#discussion_r374401800", "bodyText": "Done.", "author": "ankitaj224", "createdAt": "2020-02-03T23:34:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDM5NTcxNw=="}], "type": "inlineReview", "revised_code": {"commit": "4d15656642d5e1513d1a479ed6a9c4e4940646b0", "chunk": "diff --git a/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java b/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\nindex 32647552..d4dd4512 100644\n--- a/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\n+++ b/firebase-installations/src/main/java/com/google/firebase/installations/FirebaseInstallations.java\n\n@@ -365,8 +365,8 @@ public class FirebaseInstallations implements FirebaseInstallationsApi {\n \n   private String readExistingIidOrCreateFid(PersistedInstallationEntry prefs) {\n     // Check if this firebase app is the default (first initialized) instance or is a chime app\n-    if (!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME)\n-        && (!firebaseApp.isDefaultApp() || !prefs.shouldAttemptMigration())) {\n+    if ((!firebaseApp.getName().equals(CHIME_FIREBASE_APP_NAME) && !firebaseApp.isDefaultApp())\n+        || !prefs.shouldAttemptMigration()) {\n       return fidGenerator.createRandomFid();\n     }\n     // For a default/chime firebase installation, read the existing iid from shared prefs\n"}}, {"oid": "4d15656642d5e1513d1a479ed6a9c4e4940646b0", "url": "https://github.com/firebase/firebase-android-sdk/commit/4d15656642d5e1513d1a479ed6a9c4e4940646b0", "message": "Addressing Rayo's comments", "committedDate": "2020-02-03T23:33:40Z", "type": "commit"}]}