{"pr_number": 2009, "pr_title": "Send the GMP app ID along with user agent", "pr_createdAt": "2020-09-25T00:14:21Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/2009", "timeline": [{"oid": "37ed2b07e320971b860802d3dfc99820716cba5b", "url": "https://github.com/firebase/firebase-android-sdk/commit/37ed2b07e320971b860802d3dfc99820716cba5b", "message": "Initial commit", "committedDate": "2020-09-25T00:04:00Z", "type": "commit"}, {"oid": "98305d525910477a24069bfc0ac750c91810508b", "url": "https://github.com/firebase/firebase-android-sdk/commit/98305d525910477a24069bfc0ac750c91810508b", "message": "Remove the temporary test", "committedDate": "2020-09-25T00:10:49Z", "type": "commit"}, {"oid": "a6f3a83d26478b6dde1415794adb4703117d886a", "url": "https://github.com/firebase/firebase-android-sdk/commit/a6f3a83d26478b6dde1415794adb4703117d886a", "message": "Format", "committedDate": "2020-09-25T00:11:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTYxOQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2009#discussion_r495241619", "bodyText": "Declare this @NonNull or @Nullable.", "author": "wilhuff", "createdAt": "2020-09-25T21:24:17Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/remote/FirebaseClientGrpcMetadataProvider.java", "diffHunk": "@@ -29,32 +30,51 @@\n \n   private final Provider<HeartBeatInfo> heartBeatInfoProvider;\n   private final Provider<UserAgentPublisher> userAgentPublisherProvider;\n-  private final String firebaseFirestoreHeartBeatTag = \"fire-fst\";\n+  private final FirebaseOptions firebaseOptions;\n+\n+  private static final String HEART_BEAT_TAG = \"fire-fst\";\n \n   private static final Metadata.Key<String> HEART_BEAT_HEADER =\n       Metadata.Key.of(\"x-firebase-client-log-type\", Metadata.ASCII_STRING_MARSHALLER);\n \n   private static final Metadata.Key<String> USER_AGENT_HEADER =\n       Metadata.Key.of(\"x-firebase-client\", Metadata.ASCII_STRING_MARSHALLER);\n \n+  private static final Metadata.Key<String> GMP_APP_ID_HEADER =\n+      Metadata.Key.of(\"x-firebase-gmpid\", Metadata.ASCII_STRING_MARSHALLER);\n+\n   public FirebaseClientGrpcMetadataProvider(\n       @NonNull Provider<UserAgentPublisher> userAgentPublisherProvider,\n-      @NonNull Provider<HeartBeatInfo> heartBeatInfoProvider) {\n+      @NonNull Provider<HeartBeatInfo> heartBeatInfoProvider,\n+      FirebaseOptions firebaseOptions) {", "originalCommit": "a6f3a83d26478b6dde1415794adb4703117d886a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjMxOTE2NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2009#discussion_r496319165", "bodyText": "Done (went with @Nullable mostly because I'm not really sure how this thing with dependency injection works and accounting for null seemed safer).", "author": "var-const", "createdAt": "2020-09-29T01:15:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTYxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcyNzcxOQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/2009#discussion_r496727719", "bodyText": "I suggest you use @NonNull here as FirebaseOptions are always present, I would also (optionally) recommend changing your dependency on FirebaseOptions to required here: \n  \n    \n      firebase-android-sdk/firebase-firestore/src/main/java/com/google/firebase/firestore/FirestoreRegistrar.java\n    \n    \n         Line 51\n      in\n      22d1615\n    \n    \n    \n    \n\n        \n          \n           .add(Dependency.optional(FirebaseOptions.class))", "author": "vkryachko", "createdAt": "2020-09-29T13:43:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI0MTYxOQ=="}], "type": "inlineReview", "revised_code": {"commit": "a194e9f55a4e772a9505651aef8a7e30f49944bc", "chunk": "diff --git a/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/FirebaseClientGrpcMetadataProvider.java b/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/FirebaseClientGrpcMetadataProvider.java\nindex d13ef46d..65c322f8 100644\n--- a/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/FirebaseClientGrpcMetadataProvider.java\n+++ b/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/FirebaseClientGrpcMetadataProvider.java\n\n@@ -46,7 +46,7 @@ public class FirebaseClientGrpcMetadataProvider implements GrpcMetadataProvider\n   public FirebaseClientGrpcMetadataProvider(\n       @NonNull Provider<UserAgentPublisher> userAgentPublisherProvider,\n       @NonNull Provider<HeartBeatInfo> heartBeatInfoProvider,\n-      FirebaseOptions firebaseOptions) {\n+      @Nullable FirebaseOptions firebaseOptions) {\n     this.userAgentPublisherProvider = userAgentPublisherProvider;\n     this.heartBeatInfoProvider = heartBeatInfoProvider;\n     this.firebaseOptions = firebaseOptions;\n"}}, {"oid": "a194e9f55a4e772a9505651aef8a7e30f49944bc", "url": "https://github.com/firebase/firebase-android-sdk/commit/a194e9f55a4e772a9505651aef8a7e30f49944bc", "message": "Nullable", "committedDate": "2020-09-29T01:06:52Z", "type": "commit"}, {"oid": "e1b66f8d294d2a8f44ab6b5be2f7c23d90c894e3", "url": "https://github.com/firebase/firebase-android-sdk/commit/e1b66f8d294d2a8f44ab6b5be2f7c23d90c894e3", "message": "Fix build", "committedDate": "2020-09-29T01:10:38Z", "type": "commit"}]}