{"pr_number": 1301, "pr_title": "Catching NPE and throwing IOE instead.", "pr_createdAt": "2020-03-02T21:21:57Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1301", "timeline": [{"oid": "aa02969fb1ae7627162bb10e352a56f0aa94c53a", "url": "https://github.com/firebase/firebase-android-sdk/commit/aa02969fb1ae7627162bb10e352a56f0aa94c53a", "message": "Catching NPE and throwing IOE instead.\n\nYoutube observed this error on some devices when rolling out a new version. b/150526702\r\nWe were not able to reproduce this Exception, but found implementations of (Http)URLConnection that might return NULL for #getOutputStream.\r\nThe new code is preventing NPE and following the default error scenario that a connection to the FIS server API can not be established.", "committedDate": "2020-03-02T21:17:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1OTIzNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1301#discussion_r386659237", "bodyText": "please change to:\nCannot send create request", "author": "fredquintana", "createdAt": "2020-03-02T21:25:04Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -175,7 +177,12 @@ public InstallationResponse createFirebaseInstallation(\n   private void writeFIDCreateRequestBodyToOutputStream(\n       HttpURLConnection httpURLConnection, @NonNull String fid, @NonNull String appId)\n       throws IOException {\n-    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(httpURLConnection.getOutputStream());\n+    OutputStream outputStream = httpURLConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new ObjectStreamException(\"Cannot send request to FIS. No OutputStream available.\");", "originalCommit": "aa02969fb1ae7627162bb10e352a56f0aa94c53a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "975e15bf53edfaedd494c681be209a2af5b168de", "chunk": "diff --git a/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java b/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\nindex 6289ccf3..05d9027e 100644\n--- a/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\n+++ b/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\n\n@@ -179,7 +179,7 @@ public class FirebaseInstallationServiceClient {\n       throws IOException {\n     OutputStream outputStream = httpURLConnection.getOutputStream();\n     if (outputStream == null) {\n-      throw new ObjectStreamException(\"Cannot send request to FIS. No OutputStream available.\");\n+      throw new ObjectStreamException(\"Cannot send CreateInstallation request to FIS. No OutputStream available.\");\n     }\n     \n     GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1OTQzNA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1301#discussion_r386659434", "bodyText": "please change to:\nCannot send authtoken request", "author": "fredquintana", "createdAt": "2020-03-02T21:25:31Z", "path": "firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java", "diffHunk": "@@ -198,7 +205,12 @@ private static JSONObject buildCreateFirebaseInstallationRequestBody(String fid,\n \n   private void writeGenerateAuthTokenRequestBodyToOutputStream(HttpURLConnection httpURLConnection)\n       throws IOException {\n-    GZIPOutputStream gzipOutputStream = new GZIPOutputStream(httpURLConnection.getOutputStream());\n+    OutputStream outputStream = httpURLConnection.getOutputStream();\n+    if (outputStream == null) {\n+      throw new ObjectStreamException(\"Cannot send request to FIS. No OutputStream available.\");", "originalCommit": "aa02969fb1ae7627162bb10e352a56f0aa94c53a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "975e15bf53edfaedd494c681be209a2af5b168de", "chunk": "diff --git a/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java b/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\nindex 6289ccf3..05d9027e 100644\n--- a/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\n+++ b/firebase-installations/src/main/java/com/google/firebase/installations/remote/FirebaseInstallationServiceClient.java\n\n@@ -207,7 +207,7 @@ public class FirebaseInstallationServiceClient {\n       throws IOException {\n     OutputStream outputStream = httpURLConnection.getOutputStream();\n     if (outputStream == null) {\n-      throw new ObjectStreamException(\"Cannot send request to FIS. No OutputStream available.\");\n+      throw new ObjectStreamException(\"Cannot send GenerateAuthToken request to FIS. No OutputStream available.\");\n     }\n     \n     GZIPOutputStream gzipOutputStream = new GZIPOutputStream(outputStream);\n"}}, {"oid": "975e15bf53edfaedd494c681be209a2af5b168de", "url": "https://github.com/firebase/firebase-android-sdk/commit/975e15bf53edfaedd494c681be209a2af5b168de", "message": "Update FirebaseInstallationServiceClient.java\n\nextended exception title", "committedDate": "2020-03-02T21:27:17Z", "type": "commit"}]}