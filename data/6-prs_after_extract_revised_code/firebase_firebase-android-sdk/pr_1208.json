{"pr_number": 1208, "pr_title": "Make FieldValue a test-only class", "pr_createdAt": "2020-02-06T00:44:34Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1208", "timeline": [{"oid": "1602062c2763abaf2a77a4fd2067ae26e6c96965", "url": "https://github.com/firebase/firebase-android-sdk/commit/1602062c2763abaf2a77a4fd2067ae26e6c96965", "message": "Protobuf-backed FieldValues", "committedDate": "2020-02-04T04:03:55Z", "type": "commit"}, {"oid": "804a1b7a9d0304f13a394b2f46054f2409c52b37", "url": "https://github.com/firebase/firebase-android-sdk/commit/804a1b7a9d0304f13a394b2f46054f2409c52b37", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final", "committedDate": "2020-02-04T21:39:54Z", "type": "commit"}, {"oid": "3d5d7c2570b34f0797602f6dd46e407232b3bf8b", "url": "https://github.com/firebase/firebase-android-sdk/commit/3d5d7c2570b34f0797602f6dd46e407232b3bf8b", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final", "committedDate": "2020-02-04T23:44:07Z", "type": "commit"}, {"oid": "120ca33e5a7299151357ae0e70c8b23acfe6b9b9", "url": "https://github.com/firebase/firebase-android-sdk/commit/120ca33e5a7299151357ae0e70c8b23acfe6b9b9", "message": "Feedback", "committedDate": "2020-02-05T19:01:41Z", "type": "commit"}, {"oid": "82c0095659aa83194049693f1336af2864ce5287", "url": "https://github.com/firebase/firebase-android-sdk/commit/82c0095659aa83194049693f1336af2864ce5287", "message": "Update test-only variable", "committedDate": "2020-02-05T19:03:43Z", "type": "commit"}, {"oid": "98953a323513bbc0ef685ab9ca1ee9b9d98ee091", "url": "https://github.com/firebase/firebase-android-sdk/commit/98953a323513bbc0ef685ab9ca1ee9b9d98ee091", "message": "Add ProtoValues.contains()", "committedDate": "2020-02-05T19:34:33Z", "type": "commit"}, {"oid": "940a268825130e3c4c7609d8975d7c428f071f32", "url": "https://github.com/firebase/firebase-android-sdk/commit/940a268825130e3c4c7609d8975d7c428f071f32", "message": "Migrate ArrayTransforms to use Values", "committedDate": "2020-02-05T19:42:37Z", "type": "commit"}, {"oid": "7ea5b3737b23638bb99bcb032893674414c18895", "url": "https://github.com/firebase/firebase-android-sdk/commit/7ea5b3737b23638bb99bcb032893674414c18895", "message": "Migrate TransformResult to use Value", "committedDate": "2020-02-05T20:21:48Z", "type": "commit"}, {"oid": "637838b4497561644308d0eee7c3cedaee1a182d", "url": "https://github.com/firebase/firebase-android-sdk/commit/637838b4497561644308d0eee7c3cedaee1a182d", "message": "Drop Array, Reference, Number, Integer and DoubleValue", "committedDate": "2020-02-05T23:15:14Z", "type": "commit"}, {"oid": "522db2fd28c09a9030c4ea002fcd5856bfa9c895", "url": "https://github.com/firebase/firebase-android-sdk/commit/522db2fd28c09a9030c4ea002fcd5856bfa9c895", "message": "Drop remaining primitive FieldValue types", "committedDate": "2020-02-06T00:06:22Z", "type": "commit"}, {"oid": "b5cc99840698f8fb2e799495fdd478ea1013bd04", "url": "https://github.com/firebase/firebase-android-sdk/commit/b5cc99840698f8fb2e799495fdd478ea1013bd04", "message": "Fix Kotlin", "committedDate": "2020-02-06T00:10:43Z", "type": "commit"}, {"oid": "9f87db1fb30b3663489fd095c08fb41350d0c2ea", "url": "https://github.com/firebase/firebase-android-sdk/commit/9f87db1fb30b3663489fd095c08fb41350d0c2ea", "message": "Merge branch 'mrschmidt/droparray' into mrschmidt/droprest", "committedDate": "2020-02-06T00:11:06Z", "type": "commit"}, {"oid": "162f0715043961e3fd1057a583230095276fb487", "url": "https://github.com/firebase/firebase-android-sdk/commit/162f0715043961e3fd1057a583230095276fb487", "message": "More Kotlin fixes", "committedDate": "2020-02-06T00:27:20Z", "type": "commit"}, {"oid": "3d2eadd560d77157a91cc2b416525fa52f06c016", "url": "https://github.com/firebase/firebase-android-sdk/commit/3d2eadd560d77157a91cc2b416525fa52f06c016", "message": "Merge branch 'mrschmidt/droparray' into mrschmidt/droprest", "committedDate": "2020-02-06T00:27:46Z", "type": "commit"}, {"oid": "13e01c89451b123d4bfee2e51e6adef782f1b102", "url": "https://github.com/firebase/firebase-android-sdk/commit/13e01c89451b123d4bfee2e51e6adef782f1b102", "message": "Review", "committedDate": "2020-02-06T00:56:21Z", "type": "commit"}, {"oid": "baf650e876d47b345418466f40e36f3b97912801", "url": "https://github.com/firebase/firebase-android-sdk/commit/baf650e876d47b345418466f40e36f3b97912801", "message": "Merge branch 'mrschmidt/rewritefieldvalue' into mrschmidt/final", "committedDate": "2020-02-06T01:54:45Z", "type": "commit"}, {"oid": "aa7b3ec782537107693ce98d405190397e8c610f", "url": "https://github.com/firebase/firebase-android-sdk/commit/aa7b3ec782537107693ce98d405190397e8c610f", "message": "Merge branch 'mrschmidt/final' into mrschmidt/migratevalues", "committedDate": "2020-02-06T01:54:57Z", "type": "commit"}, {"oid": "774598a7f912b8558e50109d7822b9bf421f717c", "url": "https://github.com/firebase/firebase-android-sdk/commit/774598a7f912b8558e50109d7822b9bf421f717c", "message": "Feedback", "committedDate": "2020-02-06T05:07:07Z", "type": "commit"}, {"oid": "490c924d4d77d91fa861f5cf7d6b7629808949a3", "url": "https://github.com/firebase/firebase-android-sdk/commit/490c924d4d77d91fa861f5cf7d6b7629808949a3", "message": "Make FieldValue package-private", "committedDate": "2020-02-06T05:11:08Z", "type": "commit"}, {"oid": "0abdfb1698347c81beed67ba720b9003d7766dd4", "url": "https://github.com/firebase/firebase-android-sdk/commit/0abdfb1698347c81beed67ba720b9003d7766dd4", "message": "Merge branch 'mrschmidt/migratevalues' into mrschmidt/droparray", "committedDate": "2020-02-06T05:11:24Z", "type": "commit"}, {"oid": "6ef7289eeae1ab4b2e421294929e675556fe1d68", "url": "https://github.com/firebase/firebase-android-sdk/commit/6ef7289eeae1ab4b2e421294929e675556fe1d68", "message": "Merge", "committedDate": "2020-02-06T05:17:36Z", "type": "commit"}, {"oid": "212e916a500dc0119b78b834920b537680caa687", "url": "https://github.com/firebase/firebase-android-sdk/commit/212e916a500dc0119b78b834920b537680caa687", "message": "Make FieldValue a test-only class\n\nThis is a intermediate step before we remove it from all tests", "committedDate": "2020-02-06T18:15:26Z", "type": "forcePushed"}, {"oid": "903a7775d9e157a203c3987be94dd9c4808bb32e", "url": "https://github.com/firebase/firebase-android-sdk/commit/903a7775d9e157a203c3987be94dd9c4808bb32e", "message": "Make FieldValue a test-only class", "committedDate": "2020-02-06T19:02:40Z", "type": "commit"}, {"oid": "903a7775d9e157a203c3987be94dd9c4808bb32e", "url": "https://github.com/firebase/firebase-android-sdk/commit/903a7775d9e157a203c3987be94dd9c4808bb32e", "message": "Make FieldValue a test-only class", "committedDate": "2020-02-06T19:02:40Z", "type": "forcePushed"}, {"oid": "3f2efb491b872ea597d7df12a4dffe951eab4424", "url": "https://github.com/firebase/firebase-android-sdk/commit/3f2efb491b872ea597d7df12a4dffe951eab4424", "message": "Merge", "committedDate": "2020-02-06T19:04:45Z", "type": "commit"}, {"oid": "067c43ebb5ab391b95e55c1d1c584a9c127658d6", "url": "https://github.com/firebase/firebase-android-sdk/commit/067c43ebb5ab391b95e55c1d1c584a9c127658d6", "message": "Merge", "committedDate": "2020-02-06T19:05:15Z", "type": "commit"}, {"oid": "585ce2ab9c9563010bba1cbb3b253d2f53bb22ce", "url": "https://github.com/firebase/firebase-android-sdk/commit/585ce2ab9c9563010bba1cbb3b253d2f53bb22ce", "message": "Review", "committedDate": "2020-02-06T19:10:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAzMzQzNw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1208#discussion_r376033437", "bodyText": "I'm surprised this works. Is the only usage of this in UserDataWriter?", "author": "wilhuff", "createdAt": "2020-02-06T19:23:15Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/model/value/ServerTimestampValue.java", "diffHunk": "@@ -37,7 +37,7 @@\n  * <li>They sort after all TimestampValues. With respect to other ServerTimestampValues, they sort\n  *     by their localWriteTime.\n  */\n-public final class ServerTimestampValue extends FieldValue {\n+public final class ServerTimestampValue {", "originalCommit": "903a7775d9e157a203c3987be94dd9c4808bb32e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEwOTk3NA==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1208#discussion_r376109974", "bodyText": "The class is only used in UserDataWriter and ProtoValues. isServerTimestamp() is used in a couple other places.", "author": "schmidt-sebastian", "createdAt": "2020-02-06T22:08:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAzMzQzNw=="}], "type": "inlineReview", "revised_code": {"commit": "9ab4f2c0df32dcafb96368f6d83b2233b6400a94", "chunk": "diff --git a/firebase-firestore/src/main/java/com/google/firebase/firestore/model/value/ServerTimestampValue.java b/firebase-firestore/src/main/java/com/google/firebase/firestore/model/value/ServerTimestampValue.java\nindex 481e042d..53cc2c94 100644\n--- a/firebase-firestore/src/main/java/com/google/firebase/firestore/model/value/ServerTimestampValue.java\n+++ b/firebase-firestore/src/main/java/com/google/firebase/firestore/model/value/ServerTimestampValue.java\n\n@@ -37,7 +37,7 @@ import com.google.firestore.v1.Value;\n  * <li>They sort after all TimestampValues. With respect to other ServerTimestampValues, they sort\n  *     by their localWriteTime.\n  */\n-public final class ServerTimestampValue {\n+public final class ServerTimestampValue extends FieldValue {\n   private static final String SERVER_TIMESTAMP_SENTINEL = \"server_timestamp\";\n   private static final String TYPE_KEY = \"__type__\";\n   private static final String PREVIOUS_VALUE_KEY = \"__previous_value__\";\n"}}, {"oid": "4669589d41c62dc2ee11e96e70075d68ae1d668e", "url": "https://github.com/firebase/firebase-android-sdk/commit/4669589d41c62dc2ee11e96e70075d68ae1d668e", "message": "Update ObjectValue.java", "committedDate": "2020-02-06T19:28:00Z", "type": "commit"}, {"oid": "9ab4f2c0df32dcafb96368f6d83b2233b6400a94", "url": "https://github.com/firebase/firebase-android-sdk/commit/9ab4f2c0df32dcafb96368f6d83b2233b6400a94", "message": "Fix Kotlin", "committedDate": "2020-02-06T19:29:58Z", "type": "commit"}, {"oid": "2ce8a22e6cc87742910ddfd7e17ddde5480d0c87", "url": "https://github.com/firebase/firebase-android-sdk/commit/2ce8a22e6cc87742910ddfd7e17ddde5480d0c87", "message": "Fix Kotlin", "committedDate": "2020-02-06T21:40:58Z", "type": "commit"}, {"oid": "666458aa40291b01c20cd213e0c96e190d3810b8", "url": "https://github.com/firebase/firebase-android-sdk/commit/666458aa40291b01c20cd213e0c96e190d3810b8", "message": "Merge branch 'mrschmidt/droprest' into mrschmidt/dropall", "committedDate": "2020-02-06T22:01:55Z", "type": "commit"}, {"oid": "739e6460c04a7038c85bfbf0b3cff855c8c6aba8", "url": "https://github.com/firebase/firebase-android-sdk/commit/739e6460c04a7038c85bfbf0b3cff855c8c6aba8", "message": "Merge", "committedDate": "2020-02-06T22:10:10Z", "type": "commit"}]}