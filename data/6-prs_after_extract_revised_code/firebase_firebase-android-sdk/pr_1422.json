{"pr_number": 1422, "pr_title": "Only iterate across active targets in WatchChangeAggregator", "pr_createdAt": "2020-04-02T23:57:49Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1422", "timeline": [{"oid": "ccd26b532be99364fc5f0e22694bb855c78c4766", "url": "https://github.com/firebase/firebase-android-sdk/commit/ccd26b532be99364fc5f0e22694bb855c78c4766", "message": "check for active targets in getTargetIds", "committedDate": "2020-04-02T23:56:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyODI0Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1422#discussion_r403228243", "bodyText": "targetStates is a HashMap with Integer keys. By iterating on this with an int variable you're unboxing and then re-boxing to add to activeIds. This should be for (Integer id : ...).\nThis whole file is sloppy about this but let's not make the problem any worse.", "author": "wilhuff", "createdAt": "2020-04-03T18:32:48Z", "path": "firebase-firestore/src/main/java/com/google/firebase/firestore/remote/WatchChangeAggregator.java", "diffHunk": "@@ -162,7 +163,13 @@ public void handleTargetChange(WatchTargetChange targetChange) {\n     if (!targetIds.isEmpty()) {\n       return targetIds;\n     } else {\n-      return targetStates.keySet();\n+      List<Integer> activeIds = new ArrayList<>();\n+      for (int id : targetStates.keySet()) {", "originalCommit": "ccd26b532be99364fc5f0e22694bb855c78c4766", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "45905fcbea819cfc3c5ee2359f102bebc442c283", "chunk": "diff --git a/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/WatchChangeAggregator.java b/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/WatchChangeAggregator.java\nindex 47e8e2d7..1fc1e88b 100644\n--- a/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/WatchChangeAggregator.java\n+++ b/firebase-firestore/src/main/java/com/google/firebase/firestore/remote/WatchChangeAggregator.java\n\n@@ -164,7 +164,7 @@ public class WatchChangeAggregator {\n       return targetIds;\n     } else {\n       List<Integer> activeIds = new ArrayList<>();\n-      for (int id : targetStates.keySet()) {\n+      for (Integer id : targetStates.keySet()) {\n         if (isActiveTarget(id)) {\n           activeIds.add(id);\n         }\n"}}, {"oid": "45905fcbea819cfc3c5ee2359f102bebc442c283", "url": "https://github.com/firebase/firebase-android-sdk/commit/45905fcbea819cfc3c5ee2359f102bebc442c283", "message": "change int to integer", "committedDate": "2020-04-03T19:14:33Z", "type": "commit"}]}