{"pr_number": 1646, "pr_title": "Send the FIS auth token in the RC fetch headers.", "pr_createdAt": "2020-06-12T01:49:40Z", "pr_url": "https://github.com/firebase/firebase-android-sdk/pull/1646", "timeline": [{"oid": "a3735b80fd060f61c6dadf28ad98121bd8abf2fb", "url": "https://github.com/firebase/firebase-android-sdk/commit/a3735b80fd060f61c6dadf28ad98121bd8abf2fb", "message": "Send the FIS auth token in the RC fetch headers.", "committedDate": "2020-06-12T02:00:05Z", "type": "forcePushed"}, {"oid": "4ce3c6a366bc95a618878919fc4fde200a83e540", "url": "https://github.com/firebase/firebase-android-sdk/commit/4ce3c6a366bc95a618878919fc4fde200a83e540", "message": "Send the FIS auth token in the RC fetch headers.", "committedDate": "2020-06-17T23:56:05Z", "type": "forcePushed"}, {"oid": "666d6367636ae93a3a90af596362e73e2d87cf9c", "url": "https://github.com/firebase/firebase-android-sdk/commit/666d6367636ae93a3a90af596362e73e2d87cf9c", "message": "Migrate RC Bandwagoner app to direct FIS dependency.", "committedDate": "2020-06-18T20:14:14Z", "type": "commit"}, {"oid": "3f8959fcb619f27167b52f189f16a0c000fd80cd", "url": "https://github.com/firebase/firebase-android-sdk/commit/3f8959fcb619f27167b52f189f16a0c000fd80cd", "message": "Remove google-services plugin from checked in bandwagoner app.", "committedDate": "2020-06-18T20:14:14Z", "type": "commit"}, {"oid": "e5092a9587b3598b95e5f20bfe1974e75379db6f", "url": "https://github.com/firebase/firebase-android-sdk/commit/e5092a9587b3598b95e5f20bfe1974e75379db6f", "message": "Update docs to reference Installations SDK.", "committedDate": "2020-06-18T20:14:14Z", "type": "commit"}, {"oid": "a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "url": "https://github.com/firebase/firebase-android-sdk/commit/a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "message": "Send the FIS auth token in the RC fetch headers.", "committedDate": "2020-06-18T20:14:14Z", "type": "commit"}, {"oid": "a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "url": "https://github.com/firebase/firebase-android-sdk/commit/a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "message": "Send the FIS auth token in the RC fetch headers.", "committedDate": "2020-06-18T20:14:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2OTQ1Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r442569457", "bodyText": "Thinking (no action required): this is comparable to usage of the same header in RC's iOS SDK: https://github.com/firebase/firebase-ios-sdk/blob/c07c89ee7582e84da1c5aafaa94b38a53bcfbdc2/FirebaseRemoteConfig/Sources/RCNFetch.m#L49", "author": "erikeldridge", "createdAt": "2020-06-19T00:27:05Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/internal/ConfigFetchHttpClient.java", "diffHunk": "@@ -78,6 +78,8 @@\n   private static final String X_ANDROID_PACKAGE_HEADER = \"X-Android-Package\";\n   private static final String X_ANDROID_CERT_HEADER = \"X-Android-Cert\";\n   private static final String X_GOOGLE_GFE_CAN_RETRY = \"X-Google-GFE-Can-Retry\";\n+  private static final String INSTALLATIONS_AUTH_TOKEN_HEADER =\n+      \"X-Goog-Firebase-Installations-Auth\";", "originalCommit": "a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU3MjA1NQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r442572055", "bodyText": "... also FIAM and FIS SDKs:\nhttps://github.com/firebase/firebase-ios-sdk/search?q=x-goog-firebase-installations-auth&unscoped_q=x-goog-firebase-installations-auth", "author": "erikeldridge", "createdAt": "2020-06-19T00:38:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU2OTQ1Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU3MDg4Nw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r442570887", "bodyText": "Thinking (no action required): this is a public error message, so the phrasing should match the public docs. The FirebaseInstallations.getToken docs describe \"authentication token for the Firebase installation\", which matches the phrasing here.", "author": "erikeldridge", "createdAt": "2020-06-19T00:33:02Z", "path": "firebase-config/src/test/java/com/google/firebase/remoteconfig/internal/ConfigFetchHttpClientTest.java", "diffHunk": "@@ -240,22 +242,22 @@ public void fetch_localeUsesToStringBelowLollipop() throws Exception {\n   }\n \n   @Test\n-  public void fetch_instanceIdIsNull_throwsFRCClientException() throws Exception {\n+  public void fetch_installationIdIsNull_throwsFRCClientException() throws Exception {\n     setServerResponseTo(noChangeResponseBody, SECOND_ETAG);\n \n     FirebaseRemoteConfigClientException frcException =\n-        assertThrows(FirebaseRemoteConfigClientException.class, () -> fetchWithoutIid());\n+        assertThrows(FirebaseRemoteConfigClientException.class, () -> fetchWithoutInstallationId());\n \n-    assertThat(frcException).hasMessageThat().contains(\"instance id is null\");\n+    assertThat(frcException).hasMessageThat().contains(\"installation id is null\");\n   }\n \n   @Test\n-  public void fetch_instanceIdTokenIsNull_doesNotThrowException() throws Exception {\n+  public void fetch_installationAuthTokenIsNull_doesNotThrowException() throws Exception {\n     setServerResponseTo(noChangeResponseBody, SECOND_ETAG);\n \n-    FetchResponse fetchResponse = fetchWithoutIidToken();\n+    FetchResponse fetchResponse = fetchWithoutInstallationAuthToken();\n \n-    assertWithMessage(\"Fetch() failed with null instance id token!\")\n+    assertWithMessage(\"Fetch() failed with null installation auth token!\")", "originalCommit": "a470ea5694e0ba5114cfe8278c69a19cbc63e0a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ1ODk2Mw==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r444458963", "bodyText": "Great callout, thank you!\nWe had a meeting recently with DevRel and Tech Writers and decided to name the authentication tokens for Firebase installations: \"installation auth tokens\".\nSo, the action item is probably on us in the FIS team.", "author": "andirayo", "createdAt": "2020-06-23T19:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjU3MDg4Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "9736d01eb796a0a251967a5bcfd4712c4dfd9596", "url": "https://github.com/firebase/firebase-android-sdk/commit/9736d01eb796a0a251967a5bcfd4712c4dfd9596", "message": "Merge branch 'master' into rc-fis-token-header", "committedDate": "2020-06-19T17:07:29Z", "type": "commit"}, {"oid": "ffcbb9dbd2c9fc0af70b1418962f774f497df956", "url": "https://github.com/firebase/firebase-android-sdk/commit/ffcbb9dbd2c9fc0af70b1418962f774f497df956", "message": "Merge branch 'master' into rc-fis-token-header", "committedDate": "2020-06-19T17:18:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0MDIxNQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r443740215", "bodyText": "We might need some clarity here. The javadoc gives the impression that INSTANCE_ID_TOKEN can be fetched from FIS SDK, which is incorrect. We can explicitly call out INSTANCE_ID_TOKEN is replaced by  installation auth token fetched from FIS SDK.", "author": "ankitaj224", "createdAt": "2020-06-22T18:12:05Z", "path": "firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigConstants.java", "diffHunk": "@@ -31,6 +31,10 @@\n   /**\n    * Keys of fields in the Fetch request body that the client sends to the Firebase Remote Config\n    * server.\n+   *\n+   * <p>{@code INSTANCE_ID} and {@code INSTANCE_ID_TOKEN} are legacy names for the fields that used", "originalCommit": "ffcbb9dbd2c9fc0af70b1418962f774f497df956", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzg5NzMwMQ==", "url": "https://github.com/firebase/firebase-android-sdk/pull/1646#discussion_r443897301", "bodyText": "Good call. Updated.", "author": "danasilver", "createdAt": "2020-06-23T00:35:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mzc0MDIxNQ=="}], "type": "inlineReview", "revised_code": {"commit": "937f3f8261920d5880cb6090bd56c983ed00e510", "chunk": "diff --git a/firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigConstants.java b/firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigConstants.java\nindex b7df7619..b1e791a8 100644\n--- a/firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigConstants.java\n+++ b/firebase-config/src/main/java/com/google/firebase/remoteconfig/RemoteConfigConstants.java\n\n@@ -33,8 +33,8 @@ public final class RemoteConfigConstants {\n    * server.\n    *\n    * <p>{@code INSTANCE_ID} and {@code INSTANCE_ID_TOKEN} are legacy names for the fields that used\n-   * to be populated by the IID SDK and now come from the Firebase Installations SDK. The fields are\n-   * now the installation ID and installation auth token, respectively.\n+   * to be populated by the IID SDK. The fields have been replaced by the installation ID and\n+   * installation auth token, respectively, which are fetched from the FIS SDK.\n    */\n   @StringDef({\n     RequestFieldKey.INSTANCE_ID,\n"}}, {"oid": "937f3f8261920d5880cb6090bd56c983ed00e510", "url": "https://github.com/firebase/firebase-android-sdk/commit/937f3f8261920d5880cb6090bd56c983ed00e510", "message": "Update javadoc about installation auth token coming from FIS.", "committedDate": "2020-06-23T00:35:17Z", "type": "commit"}, {"oid": "892e7505bffd8a9c85861d3b4747ba1fae6de9dc", "url": "https://github.com/firebase/firebase-android-sdk/commit/892e7505bffd8a9c85861d3b4747ba1fae6de9dc", "message": "Merge branch 'master' into rc-fis-token-header", "committedDate": "2020-06-23T00:47:16Z", "type": "commit"}, {"oid": "4221b46bbf8ea096bb6b58c86a83a9243357074e", "url": "https://github.com/firebase/firebase-android-sdk/commit/4221b46bbf8ea096bb6b58c86a83a9243357074e", "message": "Fix FIS precondition tests with API key.", "committedDate": "2020-06-23T01:17:02Z", "type": "commit"}, {"oid": "1080fa7e56d2ebe2ac4a465e09c3421d00ef16e3", "url": "https://github.com/firebase/firebase-android-sdk/commit/1080fa7e56d2ebe2ac4a465e09c3421d00ef16e3", "message": "Use properly formatted API Key and App ID in ktx tests.", "committedDate": "2020-06-23T01:29:10Z", "type": "commit"}, {"oid": "dafda53a397cf5a2ea65c6bb58119399d1f44894", "url": "https://github.com/firebase/firebase-android-sdk/commit/dafda53a397cf5a2ea65c6bb58119399d1f44894", "message": "Use valid key and project id in integ test.", "committedDate": "2020-06-23T01:42:41Z", "type": "commit"}]}