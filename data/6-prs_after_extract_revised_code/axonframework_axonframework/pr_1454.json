{"pr_number": 1454, "pr_title": "[#1453] Add TimestampWriter to facilitate writing timestamp as sql-timestamp", "pr_createdAt": "2020-06-19T06:26:40Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1454", "timeline": [{"oid": "f32bd40a53758a6e0e679e615e6d021c2c5f8f93", "url": "https://github.com/AxonFramework/AxonFramework/commit/f32bd40a53758a6e0e679e615e6d021c2c5f8f93", "message": "Add TimestampWriter to facilitate writing timestamp to event- and snapshot-tables as sql-timestamps.", "committedDate": "2020-06-19T06:23:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwMjY3OA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r442702678", "bodyText": "I am missing class level and method javadoc here.\nDon't forget to add a since and author tag to the class level javadoc too.", "author": "smcvb", "createdAt": "2020-06-19T08:19:56Z", "path": "eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/TimestampWriter.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package org.axonframework.eventsourcing.eventstore.jdbc.statements;\n+\n+import java.sql.PreparedStatement;\n+import java.sql.SQLException;\n+import java.time.Instant;\n+", "originalCommit": "f32bd40a53758a6e0e679e615e6d021c2c5f8f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjU4NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r443326585", "bodyText": "Added javadoc.", "author": "ovstetun", "createdAt": "2020-06-22T05:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwMjY3OA=="}], "type": "inlineReview", "revised_code": {"commit": "461da34f704462661469a7fab824d3ccbb28974b", "chunk": "diff --git a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/TimestampWriter.java b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/TimestampWriter.java\nindex ac637bd47..0e22558ac 100644\n--- a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/TimestampWriter.java\n+++ b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/TimestampWriter.java\n\n@@ -4,6 +4,17 @@\n import java.sql.SQLException;\n import java.time.Instant;\n \n+import org.axonframework.eventhandling.TrackingToken;\n+import org.axonframework.eventsourcing.eventstore.jdbc.JdbcEventStorageEngine;\n+\n+/**\n+ * Writer interface for writing a formatted timestamp to a {@link PreparedStatement} during updates of the database.\n+ * Used in {@link AppendEventsStatementBuilder} and {@link AppendSnapshotStatementBuilder}.\n+ * Contract which defines how to build a PreparedStatement for use on {@link JdbcEventStorageEngine#cleanGaps(TrackingToken)}\n+ *\n+ * @author Trond Marius \u00d8vstetun\n+ * @since 4.4\n+ */\n @FunctionalInterface\n public interface TimestampWriter {\n     void writeTimestamp(PreparedStatement preparedStatement, int position, Instant timestamp) throws SQLException;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwNDM2Mg==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r442704362", "bodyText": "I expect a @param timestampWriter to be added to the javadoc.", "author": "smcvb", "createdAt": "2020-06-19T08:23:15Z", "path": "eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendEventsStatementBuilder.java", "diffHunk": "@@ -48,5 +48,5 @@\n      * @throws SQLException when an exception occurs while creating the prepared statement.", "originalCommit": "f32bd40a53758a6e0e679e615e6d021c2c5f8f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjU1NA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r443326554", "bodyText": "Added.", "author": "ovstetun", "createdAt": "2020-06-22T05:39:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwNDM2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "461da34f704462661469a7fab824d3ccbb28974b", "chunk": "diff --git a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendEventsStatementBuilder.java b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendEventsStatementBuilder.java\nindex 7c890eb72..d304af929 100644\n--- a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendEventsStatementBuilder.java\n+++ b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendEventsStatementBuilder.java\n\n@@ -44,6 +44,7 @@\n      * @param dataType   The serialized type of the payload and metadata.\n      * @param events     The events to be added.\n      * @param serializer The serializer for the payload and metadata.\n+     * @param timestampWriter Writer responsible for writing timestamp in the correct format for the given database.\n      * @return the newly created {@link PreparedStatement}.\n      * @throws SQLException when an exception occurs while creating the prepared statement.\n      */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwNDQ0NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r442704445", "bodyText": "I expect a @param timestampWriter to be added to the javadoc.", "author": "smcvb", "createdAt": "2020-06-19T08:23:24Z", "path": "eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendSnapshotStatementBuilder.java", "diffHunk": "@@ -47,5 +47,5 @@\n      * @throws SQLException when an exception occurs while creating the prepared statement.", "originalCommit": "f32bd40a53758a6e0e679e615e6d021c2c5f8f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzMyNjUxMA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1454#discussion_r443326510", "bodyText": "Added.", "author": "ovstetun", "createdAt": "2020-06-22T05:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjcwNDQ0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "461da34f704462661469a7fab824d3ccbb28974b", "chunk": "diff --git a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendSnapshotStatementBuilder.java b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendSnapshotStatementBuilder.java\nindex 2e33ea3ca..62258aeb2 100644\n--- a/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendSnapshotStatementBuilder.java\n+++ b/eventsourcing/src/main/java/org/axonframework/eventsourcing/eventstore/jdbc/statements/AppendSnapshotStatementBuilder.java\n\n@@ -43,6 +43,7 @@\n      * @param dataType   The serialized type of the payload and metadata.\n      * @param snapshot   The snapshot to be appended.\n      * @param serializer The serializer for the payload and metadata.\n+     * @param timestampWriter Writer responsible for writing timestamp in the correct format for the given database.\n      * @return The newly created {@link PreparedStatement}.\n      * @throws SQLException when an exception occurs while creating the prepared statement.\n      */\n"}}, {"oid": "461da34f704462661469a7fab824d3ccbb28974b", "url": "https://github.com/AxonFramework/AxonFramework/commit/461da34f704462661469a7fab824d3ccbb28974b", "message": "Added javadoc and test for writing/reading event data with timestamp as column type.", "committedDate": "2020-06-22T05:37:29Z", "type": "commit"}]}