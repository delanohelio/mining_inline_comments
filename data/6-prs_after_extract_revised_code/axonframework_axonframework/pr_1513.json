{"pr_number": 1513, "pr_title": "Enable customization of gRPC channel from Axon Framework application", "pr_createdAt": "2020-09-21T10:04:22Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1513", "timeline": [{"oid": "6569322c2e4c153ecfd4c27b78aa714dcdbb3b92", "url": "https://github.com/AxonFramework/AxonFramework/commit/6569322c2e4c153ecfd4c27b78aa714dcdbb3b92", "message": "Allow further customization of managed channel to Axon Server through configuration of a ManagedChannelCustomizer.", "committedDate": "2020-09-21T10:00:40Z", "type": "commit"}, {"oid": "9054a421fe24fd33ef4a75fea4702fceeeb0429f", "url": "https://github.com/AxonFramework/AxonFramework/commit/9054a421fe24fd33ef4a75fea4702fceeeb0429f", "message": "renamed operation", "committedDate": "2020-09-21T10:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyNzk5NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491927995", "bodyText": "Can we add a test that such a channelCustomization is actually invoked upon creation of the AxonServerConnectionManager?", "author": "smcvb", "createdAt": "2020-09-21T10:08:45Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConnectionManager.java", "diffHunk": "@@ -186,6 +189,21 @@ public Builder tagsConfiguration(TagsConfiguration tagsConfiguration) {\n             return this;\n         }\n \n+        /**\n+         * Registers the given {@code channelCustomization}, which configures the underling {@link ManagedChannelBuilder} used\n+         * to set up connections to AxonServer.\n+         * <p>\n+         * This method may be used in case none of the operations on this Builder provide support for the required\n+         * feature.\n+         *\n+         * @param channelCustomization A function defining the customization to make on the ManagedChannelBuilder\n+         * @return this builder for further configuration\n+         */\n+        public Builder channelCustomizer(UnaryOperator<ManagedChannelBuilder<?>> channelCustomization) {", "originalCommit": "9054a421fe24fd33ef4a75fea4702fceeeb0429f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2MDYwMw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491960603", "bodyText": "added testcase", "author": "MGathier", "createdAt": "2020-09-21T11:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyNzk5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "0269c320f8bb532a644db3950225dc522169b7f9", "chunk": "diff --git a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConnectionManager.java b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConnectionManager.java\nindex 80b9f270d..754e339ad 100644\n--- a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConnectionManager.java\n+++ b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/AxonServerConnectionManager.java\n\n@@ -190,8 +223,8 @@ public Builder tagsConfiguration(TagsConfiguration tagsConfiguration) {\n         }\n \n         /**\n-         * Registers the given {@code channelCustomization}, which configures the underling {@link ManagedChannelBuilder} used\n-         * to set up connections to AxonServer.\n+         * Registers the given {@code channelCustomization}, which configures the underling {@link\n+         * ManagedChannelBuilder} used to set up connections to AxonServer.\n          * <p>\n          * This method may be used in case none of the operations on this Builder provide support for the required\n          * feature.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyODI2Nw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491928267", "bodyText": "Curious: would you need to add @FunctionalInterface on this level too or is that taken over from the UnaryOperator automatically?", "author": "smcvb", "createdAt": "2020-09-21T10:09:17Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/ManagedChannelCustomizer.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package org.axonframework.axonserver.connector;\n+\n+import io.grpc.ManagedChannelBuilder;\n+import java.util.function.UnaryOperator;\n+\n+/**\n+ * Customizer to add more customizations to a managed channel to Axon Server.\n+ *\n+ * @author Marc Gathier\n+ * @since 4.4.3\n+ */\n+public interface ManagedChannelCustomizer extends UnaryOperator<ManagedChannelBuilder<?>> {", "originalCommit": "9054a421fe24fd33ef4a75fea4702fceeeb0429f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2NDI1Mw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491964253", "bodyText": "Apparently not taken super interface, so added this.", "author": "MGathier", "createdAt": "2020-09-21T11:19:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyODI2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "550f7a1839aaa6a509ea292e620b5d1f902b1d9d", "chunk": "diff --git a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/ManagedChannelCustomizer.java b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/ManagedChannelCustomizer.java\nindex ec9c0df33..972a76ba6 100644\n--- a/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/ManagedChannelCustomizer.java\n+++ b/axon-server-connector/src/main/java/org/axonframework/axonserver/connector/ManagedChannelCustomizer.java\n\n@@ -9,6 +9,7 @@\n  * @author Marc Gathier\n  * @since 4.4.3\n  */\n+@FunctionalInterface\n public interface ManagedChannelCustomizer extends UnaryOperator<ManagedChannelBuilder<?>> {\n \n     /**\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyODc2OA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491928768", "bodyText": "This addition serves a simple additional verification in the AxonServerAutoConfigurationTest I think.", "author": "smcvb", "createdAt": "2020-09-21T10:10:10Z", "path": "spring-boot-autoconfigure/src/main/java/org/axonframework/springboot/autoconfig/AxonServerAutoConfiguration.java", "diffHunk": "@@ -90,12 +91,20 @@ private String clientName(String id) {\n         return id;\n     }\n \n+    @Bean\n+    @ConditionalOnMissingBean\n+    public ManagedChannelCustomizer managedChannelCustomizer() {", "originalCommit": "9054a421fe24fd33ef4a75fea4702fceeeb0429f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk2MDUxMw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1513#discussion_r491960513", "bodyText": "Added test for this", "author": "MGathier", "createdAt": "2020-09-21T11:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyODc2OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "0ce25ec617b38456b8e22f916caabcd7afb4698f", "url": "https://github.com/AxonFramework/AxonFramework/commit/0ce25ec617b38456b8e22f916caabcd7afb4698f", "message": "added testcases", "committedDate": "2020-09-21T11:07:22Z", "type": "commit"}, {"oid": "550f7a1839aaa6a509ea292e620b5d1f902b1d9d", "url": "https://github.com/AxonFramework/AxonFramework/commit/550f7a1839aaa6a509ea292e620b5d1f902b1d9d", "message": "added testcases", "committedDate": "2020-09-21T11:18:11Z", "type": "commit"}, {"oid": "9abfc52947c881edfa8624c06791a4876d83daf7", "url": "https://github.com/AxonFramework/AxonFramework/commit/9abfc52947c881edfa8624c06791a4876d83daf7", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into feature/1504\n\n# Conflicts:\n#\taxon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java", "committedDate": "2020-09-22T12:57:34Z", "type": "commit"}, {"oid": "0269c320f8bb532a644db3950225dc522169b7f9", "url": "https://github.com/AxonFramework/AxonFramework/commit/0269c320f8bb532a644db3950225dc522169b7f9", "message": "Fix merge issues\n\nFix merge issues with 4.4.x\n\n#1504", "committedDate": "2020-09-22T12:59:39Z", "type": "commit"}]}