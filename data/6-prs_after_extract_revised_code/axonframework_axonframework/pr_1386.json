{"pr_number": 1386, "pr_title": "Fix resubscribe of Query Handlers on Resource Exhausted exception", "pr_createdAt": "2020-03-27T14:07:35Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1386", "timeline": [{"oid": "c1534c05f8b47e2d6cd2a37b9055a08ca3a12f0c", "url": "https://github.com/AxonFramework/AxonFramework/commit/c1534c05f8b47e2d6cd2a37b9055a08ca3a12f0c", "message": "set stream to null on error, fixes resubscribe on RESOURCE_EXHAUSTED expection.", "committedDate": "2020-03-27T14:02:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5ODk4OQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1386#discussion_r399298989", "bodyText": "Sounds fair. Is there a doable test class to be made which verifies that this works?", "author": "smcvb", "createdAt": "2020-03-27T14:21:04Z", "path": "axon-server-connector/src/main/java/org/axonframework/axonserver/connector/query/AxonServerQueryBus.java", "diffHunk": "@@ -719,6 +719,7 @@ public void onNext(QueryProviderInbound inboundRequest) {\n                 @Override\n                 public void onError(Throwable ex) {\n                     logger.warn(\"Query Inbound Stream closed with error\", ex);\n+                    outboundStreamObserver = null;", "originalCommit": "c1534c05f8b47e2d6cd2a37b9055a08ca3a12f0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMwMDAyNg==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1386#discussion_r399300026", "bodyText": "I could only reproduce the issue when I was running on Docker, so probably timing related.", "author": "MGathier", "createdAt": "2020-03-27T14:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5ODk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAwNjYyNw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1386#discussion_r400006627", "bodyText": "Shouldn't we make sure that the outbound stream is also properly \"completed\" before setting it to null? I'm afraid we'll be leaking connections if we don't close both sides.", "author": "abuijze", "createdAt": "2020-03-30T08:18:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5ODk4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDExMzU3MA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1386#discussion_r400113570", "bodyText": "Will create a new issue for this, as this needs to be done in more places.", "author": "MGathier", "createdAt": "2020-03-30T11:18:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI5ODk4OQ=="}], "type": "inlineReview", "revised_code": null}]}