{"pr_number": 1376, "pr_title": "Changes to ensure certain handlers take priority over others", "pr_createdAt": "2020-03-17T20:01:59Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1376", "timeline": [{"oid": "3322731cef264368ed45f0fbc2c2ee1ae64c2ea4", "url": "https://github.com/AxonFramework/AxonFramework/commit/3322731cef264368ed45f0fbc2c2ee1ae64c2ea4", "message": "Changes to ensure certain handlers take priority over others\n\nMainly the explicit priority of handlers must be taken into account before looking at payload types or parameter count. This allows handlers for specific Message types to be evaluated before handlers of more generic Message types.", "committedDate": "2020-03-17T20:00:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE4ODI2NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1376#discussion_r394188265", "bodyText": "Nit: So, nothing on this class' javadoc describes what the ordering is when the comparator is actually used. Might be nice to include this to provide a quicker glance than having to figure out this static Comparator INSTANCE here.", "author": "smcvb", "createdAt": "2020-03-18T08:53:31Z", "path": "messaging/src/main/java/org/axonframework/messaging/annotation/HandlerComparator.java", "diffHunk": "@@ -26,13 +26,19 @@\n  */\n public final class HandlerComparator {\n \n-    private static final Comparator<MessageHandlingMember<?>> INSTANCE = Comparator\n-            .comparing((Function<MessageHandlingMember<?>, Class<?>>) MessageHandlingMember::payloadType,\n-                       HandlerComparator::compareHierarchy)\n-            .thenComparing(\n-                    Comparator.comparingInt((ToIntFunction<MessageHandlingMember<?>>) MessageHandlingMember::priority)\n-                            .reversed())\n-            .thenComparing(m -> m.unwrap(Executable.class).map(Executable::toGenericString).orElse(m.toString()));\n+    private static final Comparator<MessageHandlingMember<?>> INSTANCE =", "originalCommit": "3322731cef264368ed45f0fbc2c2ee1ae64c2ea4", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7d206fc403567842fde11249503e199b0e70f3c7", "chunk": "diff --git a/messaging/src/main/java/org/axonframework/messaging/annotation/HandlerComparator.java b/messaging/src/main/java/org/axonframework/messaging/annotation/HandlerComparator.java\nindex 6dd87639d..c3da68a96 100644\n--- a/messaging/src/main/java/org/axonframework/messaging/annotation/HandlerComparator.java\n+++ b/messaging/src/main/java/org/axonframework/messaging/annotation/HandlerComparator.java\n\n@@ -22,7 +22,18 @@\n import java.util.function.ToIntFunction;\n \n /**\n- * Comparator used by {@link AnnotatedHandlerInspector} to sort {@link MessageHandlingMember entity members}.\n+ * Comparator used by {@link AnnotatedHandlerInspector} to sort {@link MessageHandlingMember} entity members.\n+ * <p>\n+ * The ordering among {@code MessageHandlingMember}s through this comparator is defined as follows:\n+ * <ol type=\"1\">\n+ * <li>The {@link MessageHandlingMember#priority()}, favoring the largest number</li>\n+ * <li>The class hierarchy of the {@link MessageHandlingMember#payloadType()}, favoring the most specific handler.</li>\n+ * <li>The parameter count on the actual message handling function, favoring the highest number as the most specific handler.</li>\n+ * <li>As a final tie breaker, the {@link Executable#toGenericString()} of the actual message handling function</li>\n+ * </ol>\n+ *\n+ * @author Allard Buijze\n+ * @since 3.0\n  */\n public final class HandlerComparator {\n \n"}}, {"oid": "9e58f7c029aa9de1f593d3d913800f5ea56e74f1", "url": "https://github.com/AxonFramework/AxonFramework/commit/9e58f7c029aa9de1f593d3d913800f5ea56e74f1", "message": "Merge branch 'axon-4.3.x' into event-handler-order-fix", "committedDate": "2020-03-18T14:15:55Z", "type": "commit"}, {"oid": "7d206fc403567842fde11249503e199b0e70f3c7", "url": "https://github.com/AxonFramework/AxonFramework/commit/7d206fc403567842fde11249503e199b0e70f3c7", "message": "Provide some javadoc\n\nProvide some more direct javadoc to explain what the ordering is built\nup of\n\n#1376", "committedDate": "2020-03-18T14:30:51Z", "type": "commit"}, {"oid": "5f678b03a3416d0a5bb1fb55f1a38cda575e3714", "url": "https://github.com/AxonFramework/AxonFramework/commit/5f678b03a3416d0a5bb1fb55f1a38cda575e3714", "message": "Merge remote-tracking branch 'origin/axon-4.3.x' into event-handler-order-fix", "committedDate": "2020-03-18T14:31:31Z", "type": "commit"}]}