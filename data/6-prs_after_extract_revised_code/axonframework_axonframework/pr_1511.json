{"pr_number": 1511, "pr_title": "Client side Heartbeat Message enabling ", "pr_createdAt": "2020-09-18T13:49:13Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1511", "timeline": [{"oid": "c0fd6ff80216799f675f43683dc13fdc9b836480", "url": "https://github.com/AxonFramework/AxonFramework/commit/c0fd6ff80216799f675f43683dc13fdc9b836480", "message": "Allow easier enabling of heartbeat messages on the client side\n\nIntroduce a means to the AxonServerConfiguration to enable heartbeat\nmessages. If enabled, an interval and timeout field should be taken into\n account and given to the connection manager to enable heartbeat\n messages accordingly.\n\n#enable-heartbeats-client-side", "committedDate": "2020-09-18T13:26:54Z", "type": "commit"}, {"oid": "ca218766ad24b56485688517ab059df9e84004cc", "url": "https://github.com/AxonFramework/AxonFramework/commit/ca218766ad24b56485688517ab059df9e84004cc", "message": "Adjust timeout\n\nAdjust timeout to coop with build times\n\n#1511", "committedDate": "2020-09-18T13:51:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk3NTEyOA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1511#discussion_r490975128", "bodyText": "If you want you can also add a test to verify that no heartbeats are sent when the configuration is disabled, that it is actually what this PR fixes.", "author": "saratry", "createdAt": "2020-09-18T14:08:36Z", "path": "axon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java", "diffHunk": "@@ -123,4 +119,25 @@ public void getPlatformServer(ClientIdentification request, StreamObserver<Platf\n             assertTrue(e.getMessage().contains(\"connection\"));\n         }\n     }\n+\n+    @Test\n+    void testEnablingHeartbeatsEnsuresHeartbeatMessagesAreSent() {", "originalCommit": "ca218766ad24b56485688517ab059df9e84004cc", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "04d29b5a80ee45c8710d5ef261c0a6df91f0da1c", "chunk": "diff --git a/axon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java b/axon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java\nindex f0fdc6421..e049ab8d4 100644\n--- a/axon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java\n+++ b/axon-server-connector/src/test/java/org/axonframework/axonserver/connector/AxonServerConnectionManagerTest.java\n\n@@ -140,4 +142,25 @@ void testEnablingHeartbeatsEnsuresHeartbeatMessagesAreSent() {\n                 () -> assertFalse(secondNode.getPlatformService().getHeartbeatMessages().isEmpty())\n         );\n     }\n+\n+    @Test\n+    void testDisablingHeartbeatsEnsuresNoHeartbeatMessagesAreSent() {\n+        AxonServerConfiguration config = AxonServerConfiguration.builder()\n+                                                                .servers(\"localhost:\" + stubServer.getPort())\n+                                                                .build();\n+        config.getHeartbeat().setEnabled(false);\n+        AxonServerConnectionManager connectionManager =\n+                AxonServerConnectionManager.builder()\n+                                           .axonServerConfiguration(config)\n+                                           .build();\n+        connectionManager.start();\n+\n+        assertNotNull(connectionManager.getConnection(config.getContext()));\n+\n+        assertWithin(\n+                250, TimeUnit.MILLISECONDS,\n+                // Retrieving the messages from the secondNode, as the stubServer forwards all messages to this instance\n+                () -> assertTrue(secondNode.getPlatformService().getHeartbeatMessages().isEmpty())\n+        );\n+    }\n }\n"}}, {"oid": "04d29b5a80ee45c8710d5ef261c0a6df91f0da1c", "url": "https://github.com/AxonFramework/AxonFramework/commit/04d29b5a80ee45c8710d5ef261c0a6df91f0da1c", "message": "Add test case\n\nAdd test case validating no heartbeats are sent if it has been disabled\n\n#1511", "committedDate": "2020-09-21T07:42:18Z", "type": "commit"}]}