{"pr_number": 7082, "pr_title": "#7034 NPE when setting preferred size and null chat, in ChatPlayerPan\u2026", "pr_createdAt": "2020-07-09T11:06:02Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7082", "timeline": [{"oid": "e9f64682b0011055bf50fd9ca8f1e6982f131705", "url": "https://github.com/triplea-game/triplea/commit/e9f64682b0011055bf50fd9ca8f1e6982f131705", "message": "#7034 NPE when setting preferred size and null chat, in ChatPlayerPanel#setDynamicPreferredSize", "committedDate": "2020-07-09T11:05:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUzMDA2Mg==", "url": "https://github.com/triplea-game/triplea/pull/7082#discussion_r452530062", "bodyText": "I was thinking about this for a while, but I think this isn't the right fix for this.\nThe stacktrace in #7034 makes it clear that this NullPointerException occurs when shutting down a game, so adjusting the preffered size just before the game is closed doesn't really make sense to me.\nThat's why I'd recommend making this method no-op if chat is null i.e.\nif (chat == null) {\n  return;\n}\nAt the start if the method", "author": "RoiEXLab", "createdAt": "2020-07-09T22:45:30Z", "path": "game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java", "diffHunk": "@@ -85,9 +85,11 @@ public void setChat(final Chat chat) {\n    */\n   private void setDynamicPreferredSize() {\n     int maxNameLength = 0;\n-    final FontMetrics fontMetrics = this.getFontMetrics(UIManager.getFont(\"TextField.font\"));\n-    for (final UserName onlinePlayer : chat.getOnlinePlayers()) {\n-      maxNameLength = Math.max(maxNameLength, fontMetrics.stringWidth(onlinePlayer.getValue()));\n+    if (chat != null) {", "originalCommit": "e9f64682b0011055bf50fd9ca8f1e6982f131705", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY0ODUyOQ==", "url": "https://github.com/triplea-game/triplea/pull/7082#discussion_r452648529", "bodyText": "Just pushed that, and verifying zero interactions with renderer mock. Was wondering if I should create more unit tests/test cases (in general) ?", "author": "tjrbrom", "createdAt": "2020-07-10T06:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUzMDA2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5bdf33a5ad18a6454a0ed55e617cbc44a0b76c08", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java b/game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java\nindex 3c2f347088..2cb3dd8f40 100644\n--- a/game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java\n+++ b/game-core/src/main/java/games/strategy/engine/chat/ChatPlayerPanel.java\n\n@@ -84,12 +84,13 @@ public class ChatPlayerPanel extends JPanel implements ChatPlayerListener {\n    * set minimum size based on players (number and max name length) and distribution to playerIDs.\n    */\n   private void setDynamicPreferredSize() {\n+    if (chat == null) {\n+      return;\n+    }\n     int maxNameLength = 0;\n-    if (chat != null) {\n-      final FontMetrics fontMetrics = this.getFontMetrics(UIManager.getFont(\"TextField.font\"));\n-      for (final UserName onlinePlayer : chat.getOnlinePlayers()) {\n-        maxNameLength = Math.max(maxNameLength, fontMetrics.stringWidth(onlinePlayer.getValue()));\n-      }\n+    final FontMetrics fontMetrics = this.getFontMetrics(UIManager.getFont(\"TextField.font\"));\n+    for (final UserName onlinePlayer : chat.getOnlinePlayers()) {\n+      maxNameLength = Math.max(maxNameLength, fontMetrics.stringWidth(onlinePlayer.getValue()));\n     }\n     int iconCounter = 0;\n     if (setCellRenderer instanceof PlayerChatRenderer) {\n"}}, {"oid": "5bdf33a5ad18a6454a0ed55e617cbc44a0b76c08", "url": "https://github.com/triplea-game/triplea/commit/5bdf33a5ad18a6454a0ed55e617cbc44a0b76c08", "message": "#7034 if chat is null, exit without setting/calculating new dynamic preferred size", "committedDate": "2020-07-10T06:27:18Z", "type": "commit"}, {"oid": "ce4b8aa521f363a72b7bf9654ba45fca3f312960", "url": "https://github.com/triplea-game/triplea/commit/ce4b8aa521f363a72b7bf9654ba45fca3f312960", "message": "replace verifyNoInteractions with never", "committedDate": "2020-07-10T06:55:38Z", "type": "commit"}]}