{"pr_number": 6382, "pr_title": "Github issue client cleanup & Add \"Error Report\" label to uploaded issues", "pr_createdAt": "2020-05-04T19:04:55Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6382", "timeline": [{"oid": "30a92de3743dfdadcadbb6e90a902ba4442d9d22", "url": "https://github.com/triplea-game/triplea/commit/30a92de3743dfdadcadbb6e90a902ba4442d9d22", "message": "Github issue client cleanup & Add \"Error Report\" label to uploaded issues\n\n1. Feature: Update automatic issue creation to add a label \"Error Report\"\n   to issues created via the error report functionality. The labels will\n   server to more easily identify and organize errors that were uploaded\n   from the game client.\n\n   Implementation changes:\n   To attach labels we split the create error report object, prevoiusly\n   the error report object sent to the HTTP server matched the one we\n   sent to github. After splitting the error report request object,\n   the 'createIssueRequest' object we send to github to create issues\n   can have labels added to it.\n\n2. Cleanup: Update github issue client to be consistent with a well\n   named feign client class.\n\n3. Cleanup: Make github issue client upload 'isTest' behavior be internal\n   to the client. Before it was the user of the client class that checked\n   if the client was in test mode and stubbed a response, now the client\n   will transparently return a stubbed response when in test mode.", "committedDate": "2020-05-04T19:02:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0MzQ5Nw==", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420043497", "bodyText": "What about checking !isTest || !configuration.isProd() or !(isTest && configuration.isProd()) instead of the if block?", "author": "RoiEXLab", "createdAt": "2020-05-05T11:38:09Z", "path": "http-server/src/main/java/org/triplea/modules/error/reporting/ErrorReportController.java", "diffHunk": "@@ -27,15 +27,18 @@\n   private final BiFunction<String, ErrorReportRequest, ErrorReportResponse> errorReportIngestion;\n \n   public static ErrorReportController build(final AppConfig configuration, final Jdbi jdbi) {\n+    final boolean isTest = configuration.getGithubApiToken().equals(\"test\");\n+\n     final GithubIssueClient githubIssueClient =\n         GithubIssueClient.builder()\n             .uri(AppConfig.GITHUB_WEB_SERVICE_API_URL)\n             .authToken(configuration.getGithubApiToken())\n             .githubOrg(AppConfig.GITHUB_ORG)\n             .githubRepo(configuration.getGithubRepo())\n+            .isTest(isTest)\n             .build();\n \n-    if (githubIssueClient.isTest()) {\n+    if (isTest) {\n       Preconditions.checkState(!configuration.isProd());", "originalCommit": "30a92de3743dfdadcadbb6e90a902ba4442d9d22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3OTk1MA==", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420279950", "bodyText": "I was/am tempted, though I'm not sure it's actually simpler to reason about.", "author": "DanVanAtta", "createdAt": "2020-05-05T17:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0MzQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4MDkzNg==", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420280936", "bodyText": "Same, it's kind of a weird thing to check though", "author": "RoiEXLab", "createdAt": "2020-05-05T17:25:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0MzQ5Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0NDE4Nw==", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420044187", "bodyText": "Is 20000 a github limit?", "author": "RoiEXLab", "createdAt": "2020-05-05T11:39:32Z", "path": "http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.triplea.http.client.github.issues;\n+\n+import com.google.common.base.Ascii;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.EqualsAndHashCode;\n+import lombok.NoArgsConstructor;\n+import lombok.ToString;\n+\n+/** Represents request data to create a github issue. */\n+@ToString\n+@EqualsAndHashCode\n+@Builder\n+@NoArgsConstructor\n+@AllArgsConstructor\n+public class CreateIssueRequest {\n+  private String title;\n+  private String body;\n+  private String[] labels;\n+\n+  public String getTitle() {\n+    return title == null ? null : Ascii.truncate(title, 125, \"...\");\n+  }\n+\n+  public String getBody() {\n+    return body == null ? null : Ascii.truncate(body, 20000, \"...\");", "originalCommit": "30a92de3743dfdadcadbb6e90a902ba4442d9d22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI3OTIwMg==", "url": "https://github.com/triplea-game/triplea/pull/6382#discussion_r420279202", "bodyText": "no, it's somewhat arbitrary. This request object is lifted from the error upload request object. Before we had the same request object between client, server, and github. So this limit is just carried forward from that previous object. The fact that they match now I'm not sure is actually important. It still might be better to document that this is an arbitrarily large number.", "author": "DanVanAtta", "createdAt": "2020-05-05T17:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA0NDE4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "ab7c27427fbbe3a1c4b34e260ecde6c638a13144", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java b/http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java\nindex 35b371fbb..cac82bc51 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/github/issues/CreateIssueRequest.java\n\n@@ -19,10 +19,12 @@ public class CreateIssueRequest {\n   private String[] labels;\n \n   public String getTitle() {\n-    return title == null ? null : Ascii.truncate(title, 125, \"...\");\n+    return title == null ? null : Ascii.truncate(title, GithubIssueClient.TITLE_MAX_LENGTH, \"...\");\n   }\n \n   public String getBody() {\n-    return body == null ? null : Ascii.truncate(body, 20000, \"...\");\n+    return body == null\n+        ? null\n+        : Ascii.truncate(body, GithubIssueClient.REPORT_BODY_MAX_LENGTH, \"...\");\n   }\n }\n"}}, {"oid": "5178ee7eb11a335cce37eb1c60f2d5fdc4e5ab79", "url": "https://github.com/triplea-game/triplea/commit/5178ee7eb11a335cce37eb1c60f2d5fdc4e5ab79", "message": "Merge remote-tracking branch 'origin/master' into issue-upload-labels", "committedDate": "2020-05-05T17:24:47Z", "type": "commit"}, {"oid": "ab7c27427fbbe3a1c4b34e260ecde6c638a13144", "url": "https://github.com/triplea-game/triplea/commit/ab7c27427fbbe3a1c4b34e260ecde6c638a13144", "message": "Use constants for title and body limits and add documentation to them.", "committedDate": "2020-05-05T17:27:01Z", "type": "commit"}]}