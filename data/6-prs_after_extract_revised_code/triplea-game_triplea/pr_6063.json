{"pr_number": 6063, "pr_title": "Combine server side websockets", "pr_createdAt": "2020-03-20T06:41:17Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6063", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ1OTEzMQ==", "url": "https://github.com/triplea-game/triplea/pull/6063#discussion_r395459131", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-20T06:44:14Z", "path": "http-server/src/main/java/org/triplea/server/web/socket/GameConnectionWebSocket.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package org.triplea.server.web.socket;\n+\n+import javax.websocket.CloseReason;\n+import javax.websocket.OnClose;\n+import javax.websocket.OnError;\n+import javax.websocket.OnOpen;\n+import javax.websocket.Session;\n+import javax.websocket.server.ServerEndpoint;\n+import org.triplea.http.client.web.socket.WebsocketPaths;\n+import org.triplea.server.remote.actions.RemoteActionsEventQueue;\n+\n+@ServerEndpoint(WebsocketPaths.GAME_CONNECTIONS)\n+public class GameConnectionWebSocket {\n+\n+  public static final String REMOTE_ACTIONS_QUEUE_KEY = \"remote.actions.event.queue\";\n+\n+  @OnOpen\n+  public void open(final Session session) {\n+    ((RemoteActionsEventQueue) session.getUserProperties().get(REMOTE_ACTIONS_QUEUE_KEY))\n+        .addSession(session);\n+  }\n+\n+  @OnClose\n+  public void onClose(final Session session, final CloseReason closeReason) {\n+    ((RemoteActionsEventQueue) session.getUserProperties().get(REMOTE_ACTIONS_QUEUE_KEY))\n+        .removeSession(session);\n+  }\n+\n+  /**\n+   * This error handler is called automatically when server processing encounters an uncaught\n+   * exception. We use it to notify the user that an error occurred.\n+   */\n+  @OnError\n+  public void handleError(final Session session, final Throwable throwable) {\n+    // TODO: Project#12 implement error notification", "originalCommit": "f75833acc0e946339c72cc2132f031a093ba255a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "url": "https://github.com/triplea-game/triplea/commit/a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "message": "Combine server side websockets\n\nThis update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\n\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward this means we will likely only have two websocket\nendpoints in the long run.", "committedDate": "2020-03-20T07:06:00Z", "type": "commit"}, {"oid": "a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "url": "https://github.com/triplea-game/triplea/commit/a50ed381b30b9a5fcf5c9b51ec76c9aad5fab4b6", "message": "Combine server side websockets\n\nThis update combines all server side websockets into just two. The two websocket\nconnections are based on the expected source of connections, ie: players or games.\n\nThis updates the server side design for websockets to be source based rather than\ntopic based.  Going forward this means we will likely only have two websocket\nendpoints in the long run.", "committedDate": "2020-03-20T07:06:00Z", "type": "forcePushed"}]}