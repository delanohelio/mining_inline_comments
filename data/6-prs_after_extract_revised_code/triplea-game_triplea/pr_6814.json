{"pr_number": 6814, "pr_title": "Find a location to use for BattleCalculatorPanel even if one isn't selected", "pr_createdAt": "2020-06-24T14:41:12Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6814", "timeline": [{"oid": "4876989c2f8c9d1d787cc300da36c3b50983daa7", "url": "https://github.com/triplea-game/triplea/commit/4876989c2f8c9d1d787cc300da36c3b50983daa7", "message": "Find a location to use for BattleCalculatorPanel even if one isn't selected", "committedDate": "2020-06-24T14:37:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzMzQzOA==", "url": "https://github.com/triplea-game/triplea/pull/6814#discussion_r445133438", "bodyText": "Should we remove this comment now that we have a method?", "author": "DanVanAtta", "createdAt": "2020-06-24T19:51:27Z", "path": "game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java", "diffHunk": "@@ -1194,17 +1194,7 @@ private void updateStats() {\n             () -> {\n               try {\n                 // find a territory to fight in", "originalCommit": "4876989c2f8c9d1d787cc300da36c3b50983daa7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b6fbd14e8ae39ed28afb830b428f6fb55f3770e5", "chunk": "diff --git a/game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java b/game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java\nindex 77bb8632e..55824fba1 100644\n--- a/game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java\n+++ b/game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java\n\n@@ -1193,7 +1193,6 @@ class BattleCalculatorPanel extends JPanel {\n     new Thread(\n             () -> {\n               try {\n-                // find a territory to fight in\n                 final Territory location = findPotentialBattleSite();\n                 if (location == null) {\n                   throw new IllegalStateException(\"No territory found that is land:\" + isLand());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzMzk1Mw==", "url": "https://github.com/triplea-game/triplea/pull/6814#discussion_r445133953", "bodyText": "Any chance location will already be computed? Is the instance location attached to the class still used at all, or would it be better to get rid of that state and do more on-demand computing?", "author": "DanVanAtta", "createdAt": "2020-06-24T19:52:25Z", "path": "game-core/src/main/java/games/strategy/triplea/odds/calculator/BattleCalculatorPanel.java", "diffHunk": "@@ -1413,6 +1418,7 @@ private void setWidgetActivation() {\n       final Collection<TerritoryEffect> territoryEffects = getTerritoryEffects();\n       final IntegerMap<UnitType> costs = TuvUtils.getCostsForTuv(getAttacker(), data);\n       attackers.sort(new UnitBattleComparator(false, costs, territoryEffects, data).reversed());\n+      final Territory location = findPotentialBattleSite();", "originalCommit": "4876989c2f8c9d1d787cc300da36c3b50983daa7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE3MzQ5MQ==", "url": "https://github.com/triplea-game/triplea/pull/6814#discussion_r445173491", "bodyText": "Yes, location is already computed if you click on a territory and use the shortcut to open the battle calculator.  The way to get a null location is by opening it from the menu.\nIn the case where you are opening the battle calculator from a specific territory, we want to use that territory.  I believe the calculator utilizes territory attachments for its calculations so you'll get more accurate results.", "author": "trevan", "createdAt": "2020-06-24T21:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzMzk1Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "b6fbd14e8ae39ed28afb830b428f6fb55f3770e5", "url": "https://github.com/triplea-game/triplea/commit/b6fbd14e8ae39ed28afb830b428f6fb55f3770e5", "message": "Remove unneeded comment", "committedDate": "2020-06-24T21:11:11Z", "type": "commit"}]}