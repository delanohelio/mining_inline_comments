{"pr_number": 6409, "pr_title": "Add right click menu for moderators to view game chat history", "pr_createdAt": "2020-05-06T01:20:44Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6409", "timeline": [{"oid": "9142b1e82b109f288cd518347b62796f10c66236", "url": "https://github.com/triplea-game/triplea/commit/9142b1e82b109f288cd518347b62796f10c66236", "message": "Add right click menu for moderators to view game chat history\n\nEnables a 'show chat history\" option for moderators to view the chat\nhistory of any lobby game.\n\nChange summary:\n- add moderator right click option\n- add client side module to query lobby for chat history of a game id\n  and display results in a pop-up in a text area box\n- add http client call to fetch game chat history\n- add moderator only http server endpoint to fetch game chat history\n- add http server chat history module to request chat history\n  from DB and marshall into a response object\n- adds a game chat history DAO to query game chat history table.\n\nOf note:\n- changed indices on lobby_game table to match expected query pattern\n- changed types of date columns that did not have timezones. Testing\n  revealed that timestamps returned from those tables were in local\n  time, these were all changed to be 'timestamptz' to keep all times\n  in UTC (the only non-UTC times should be when we are displaying a\n  last-mile date value to a user, otherwise we want all UTC or epoch\n  millis everywhere else).", "committedDate": "2020-05-06T01:19:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTgyNzc1MA==", "url": "https://github.com/triplea-game/triplea/pull/6409#discussion_r421827750", "bodyText": "Are old chat messages ever deleted?\nIf not I'm concerned that we'll run out of disk space very quickly \ud83e\udd14", "author": "RoiEXLab", "createdAt": "2020-05-07T22:20:17Z", "path": "http-server/src/main/java/org/triplea/db/dao/moderator/chat/history/GameChatHistoryDao.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package org.triplea.db.dao.moderator.chat.history;\n+\n+import java.util.List;\n+import org.jdbi.v3.sqlobject.customizer.Bind;\n+import org.jdbi.v3.sqlobject.statement.SqlQuery;\n+\n+/**\n+ * DAO to access history of in-game chat messages stored in database. Chat messages are stored for\n+ * all lobby-connected games.\n+ */\n+public interface GameChatHistoryDao {\n+\n+  @SqlQuery(\n+      \"select \"\n+          + \"    gch.date,\"\n+          + \"    gch.username,\"\n+          + \"    gch.message\"\n+          + \"  from game_chat_history gch\"\n+          + \"  join lobby_game lg on lg.id = gch.lobby_game_id\"\n+          + \"  where\"\n+          + \"    lg.game_id = :gameId\"\n+          + \"    and date > (now() - '6 hour'::interval)\")", "originalCommit": "9142b1e82b109f288cd518347b62796f10c66236", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}