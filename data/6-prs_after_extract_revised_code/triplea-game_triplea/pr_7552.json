{"pr_number": 7552, "pr_title": "Reduce state in GameChooser & Apply Strangler to Shallow Parsing", "pr_createdAt": "2020-09-05T23:11:01Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7552", "timeline": [{"oid": "5e6eab80a6a9b64d68628d965e8baf56682252ab", "url": "https://github.com/triplea-game/triplea/commit/5e6eab80a6a9b64d68628d965e8baf56682252ab", "message": "Reduce state in GameChooser & Apply Strangler to Shallow Parsing\n\n1. Stop keeping tracking of a fully parsed vs shallow parsed game data in game chooser.\n  Instead we'll return a fully parsed game data when requested and otherwise\n  we keep track of the shallow parsed data. It turns out the shallow parsed data is\n  just the game name.\n\n2. Extract shallow parsing to its own module so that later we can swap out\n  the implementation (strangler pattern). As part of this we can simplify the API\n  of shallow parsing since we only need the game data name.\n\n3. Reduce severity level for invalid maps from 'SEVERE' to 'WARN'. Bad map\n  data we do want reported to users but they are not actionable bug reports\n  for us generally (users who are working on new maps would expect to see problems).\n\nThis update changes error handling behavior such that if a map has a parse error we do\nnot deselect it from the game chooser. This is a bit forward looking as eventually\na shallow parse will not reveal any errors anyways. It would make sense to get\na deep parse only when selecting a game map and seeing errors then.\n\nThis update does reduce game performance in the map selection as we do a game parse\nwhenever clicking any new game selection items. We'll need to revisit this to\nsee if and how that can and/or should be improved later.", "committedDate": "2020-09-05T23:03:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwOTY4OQ==", "url": "https://github.com/triplea-game/triplea/pull/7552#discussion_r487109689", "bodyText": "Also a consideration:\nNow that GameChooserEntry is no longer a thing this class could get renamed", "author": "RoiEXLab", "createdAt": "2020-09-11T15:08:28Z", "path": "game-core/src/main/java/games/strategy/engine/framework/ui/DefaultGameChooserEntry.java", "diffHunk": "@@ -4,126 +4,67 @@\n import games.strategy.engine.data.GameData;\n import games.strategy.engine.data.GameParseException;\n import games.strategy.engine.data.gameparser.GameParser;\n-import games.strategy.triplea.Constants;\n+import games.strategy.engine.data.gameparser.ShallowGameParser;\n import java.io.IOException;\n import java.io.InputStream;\n import java.net.URI;\n-import java.util.Objects;\n import java.util.Optional;\n import java.util.logging.Level;\n-import javax.annotation.Nonnull;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n import lombok.extern.java.Log;\n import org.triplea.java.UrlStreams;\n \n @Log\n-final class DefaultGameChooserEntry implements GameChooserEntry {\n-  private final URI url;\n-  @Nonnull private GameData gameData;\n-  private boolean gameDataFullyLoaded = false;\n-  private final String gameNameAndMapNameProperty;\n+@EqualsAndHashCode(of = \"uri\")\n+@Getter\n+public class DefaultGameChooserEntry implements Comparable<DefaultGameChooserEntry> {", "originalCommit": "5e6eab80a6a9b64d68628d965e8baf56682252ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2ODc3Mw==", "url": "https://github.com/triplea-game/triplea/pull/7552#discussion_r487268773", "bodyText": "Indeed. I've been waiting on the rename for a moment for a few reasons:\n\nrenames are really tough on review as the file often will look new. File renaming and package moves is perhaps the biggest downside of doing reviews, reviews do discourage those operations because the diff gets so messed up\na rename done on its own would conflict with work that is continuing on from this point. A post-merge really indicates that I needed to incorporate these updates to keep going in a clean manner. The merge conflicts have been working out pretty okay so far, but I have been encountering some even with a pretty quick cadence of merges. So this is to say that there is already future work that would make a rename not nice as it would conflict badly with that, so it's a matter of finding the time to fit in\nhasn't necessarily been that important per-say. The name 'default game chooser entry' is not too horrible necessarily.\nnot clear if this class has a long term future or would be refactored away to another form or just reduced down to a map. It is now only a tuple class that holds a string and a URI, really TBD if it'll survive", "author": "DanVanAtta", "createdAt": "2020-09-11T20:14:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwOTY4OQ=="}], "type": "inlineReview", "revised_code": null}]}