{"pr_number": 6096, "pr_title": "Websocket listeners", "pr_createdAt": "2020-03-26T06:18:09Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6096", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ0NQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339445", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T06:19:47Z", "path": "http-server/src/main/java/org/triplea/modules/error/reporting/ErrorReportController.java", "diffHunk": "@@ -11,17 +12,38 @@\n import javax.ws.rs.Path;\n import javax.ws.rs.core.Context;\n import lombok.Builder;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.http.AppConfig;\n import org.triplea.http.HttpController;\n import org.triplea.http.client.error.report.ErrorReportClient;\n import org.triplea.http.client.error.report.ErrorReportRequest;\n import org.triplea.http.client.error.report.ErrorReportResponse;\n+import org.triplea.http.client.github.issues.GithubIssueClient;\n \n /** Http controller that binds the error upload endpoint with the error report upload handler. */\n @Builder\n public class ErrorReportController extends HttpController {\n   @Nonnull\n   private final BiFunction<String, ErrorReportRequest, ErrorReportResponse> errorReportIngestion;\n \n+  public static ErrorReportController build(final AppConfig configuration, final Jdbi jdbi) {", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ0Ng==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339446", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T06:19:47Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameRemovedMessage.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.game.listing;", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2508e91354274c47a9312176ac445ffed731f15c", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameRemovedMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameRemovedMessage.java\nindex b0a664d0d..4947e4e7a 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameRemovedMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameRemovedMessage.java\n\n@@ -2,6 +2,7 @@ package org.triplea.http.client.web.socket.messages.envelopes.game.listing;\n \n import javax.annotation.Nonnull;\n import lombok.AllArgsConstructor;\n+import lombok.Builder;\n import lombok.Getter;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n import org.triplea.http.client.web.socket.messages.MessageType;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ0OA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339448", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T06:19:48Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerStatusUpdateReceivedMessage.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.chat;", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerStatusUpdateReceivedMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerStatusUpdateReceivedMessage.java\nindex 79a7249a7..4a0460e38 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerStatusUpdateReceivedMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerStatusUpdateReceivedMessage.java\n\n@@ -1,6 +1,5 @@\n package org.triplea.http.client.web.socket.messages.envelopes.chat;\n \n-import lombok.AllArgsConstructor;\n import lombok.Getter;\n import org.triplea.domain.data.UserName;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ1Mw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339453", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T06:19:48Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameUpdatedMessage.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.game.listing;", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "782958b9b00a43bc9833e8493dd5151ba4e13531", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameUpdatedMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameUpdatedMessage.java\nindex 0a0ed528a..dca4d284c 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameUpdatedMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/game/listing/LobbyGameUpdatedMessage.java\n\n@@ -2,6 +2,7 @@ package org.triplea.http.client.web.socket.messages.envelopes.game.listing;\n \n import javax.annotation.Nonnull;\n import lombok.AllArgsConstructor;\n+import lombok.EqualsAndHashCode;\n import lombok.Getter;\n import org.triplea.http.client.lobby.game.listing.LobbyGameListing;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ1Ng==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339456", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-26T06:19:48Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatReceivedMessage.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.chat;", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatReceivedMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatReceivedMessage.java\nindex b4818977e..086579401 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatReceivedMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatReceivedMessage.java\n\n@@ -1,6 +1,5 @@\n package org.triplea.http.client.web.socket.messages.envelopes.chat;\n \n-import lombok.Builder;\n import lombok.Getter;\n import org.triplea.domain.data.UserName;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ1OQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339459", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-26T06:19:49Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -21,6 +21,10 @@\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2508e91354274c47a9312176ac445ffed731f15c", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex eae8fd02a..146d18b73 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -15,6 +16,8 @@ import lombok.AccessLevel;\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ2MA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339460", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-26T06:19:49Z", "path": "http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package org.triplea.web.socket;\n+\n+import javax.annotation.Nonnull;\n+import javax.websocket.Session;\n+import lombok.Builder;\n+import lombok.Getter;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+\n+@Builder\n+public class WebSocketMessageContext<T extends WebSocketMessage> {\n+  @Nonnull private final WebSocketMessagingBus messagingBus;\n+  @Getter @Nonnull private final Session senderSession;\n+  @Getter @Nonnull private final T message;\n+\n+  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2508e91354274c47a9312176ac445ffed731f15c", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\nindex bff411168..8af9e0822 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\n\n@@ -5,12 +5,16 @@ import javax.websocket.Session;\n import lombok.Builder;\n import lombok.Getter;\n import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.web.socket.connections.WebSocketMessagingBus;\n \n @Builder\n public class WebSocketMessageContext<T extends WebSocketMessage> {\n   @Nonnull private final WebSocketMessagingBus messagingBus;\n-  @Getter @Nonnull private final Session senderSession;\n-  @Getter @Nonnull private final T message;\n+  @Getter\n+  @Nonnull private final Session senderSession;\n+  @Getter\n+  @Nonnull private final T message;\n+\n \n   public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n     throw new UnsupportedOperationException(\"TODO\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ2Mg==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339462", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-26T06:19:49Z", "path": "http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package org.triplea.web.socket;\n+\n+import javax.annotation.Nonnull;\n+import javax.websocket.Session;\n+import lombok.Builder;\n+import lombok.Getter;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+\n+@Builder\n+public class WebSocketMessageContext<T extends WebSocketMessage> {\n+  @Nonnull private final WebSocketMessagingBus messagingBus;\n+  @Getter @Nonnull private final Session senderSession;\n+  @Getter @Nonnull private final T message;\n+\n+  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(X broadcastMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2508e91354274c47a9312176ac445ffed731f15c", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\nindex bff411168..8af9e0822 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessageContext.java\n\n@@ -5,12 +5,16 @@ import javax.websocket.Session;\n import lombok.Builder;\n import lombok.Getter;\n import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.web.socket.connections.WebSocketMessagingBus;\n \n @Builder\n public class WebSocketMessageContext<T extends WebSocketMessage> {\n   @Nonnull private final WebSocketMessagingBus messagingBus;\n-  @Getter @Nonnull private final Session senderSession;\n-  @Getter @Nonnull private final T message;\n+  @Getter\n+  @Nonnull private final Session senderSession;\n+  @Getter\n+  @Nonnull private final T message;\n+\n \n   public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n     throw new UnsupportedOperationException(\"TODO\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzOTQ2NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r398339464", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-26T06:19:49Z", "path": "game-core/src/main/java/games/strategy/engine/lobby/connection/PlayerToLobbyConnection.java", "diffHunk": "@@ -1,90 +1,93 @@\n package games.strategy.engine.lobby.connection;\n \n-import com.google.common.base.Preconditions;\n-import java.net.InetAddress;\n import java.net.URI;\n-import java.util.Collection;\n+import java.util.List;\n+import java.util.function.Consumer;\n import lombok.extern.java.Log;\n import org.triplea.domain.data.ApiKey;\n-import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.PlayerChatId;\n import org.triplea.domain.data.UserName;\n import org.triplea.http.client.lobby.HttpLobbyClient;\n-import org.triplea.http.client.lobby.chat.ChatMessageListeners;\n import org.triplea.http.client.lobby.game.listing.GameListingClient;\n-import org.triplea.http.client.lobby.game.listing.messages.GameListingListeners;\n+import org.triplea.http.client.lobby.game.listing.LobbyGameListing;\n import org.triplea.http.client.lobby.moderator.BanPlayerRequest;\n import org.triplea.http.client.lobby.moderator.toolbox.HttpModeratorToolboxClient;\n+import org.triplea.http.client.web.socket.GenericWebSocketClient;\n+import org.triplea.http.client.web.socket.WebSocket;\n+import org.triplea.http.client.web.socket.WebsocketPaths;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.chat.ChatSentMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.chat.ConnectToChatMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.chat.PlayerSlapSentMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.chat.PlayerStatusUpdateSentMessage;\n \n /**\n  * Represents a connection from a player to lobby. A player can do actions like get game listings,\n  * send chat messages, slap players, etc.. The lobby will send messages to the player for example\n  * like chat messages, slap notifications, ban notifications.\n  */\n+// TODO: test-me", "originalCommit": "3a8e254bbc0ce354189a0e52e07be6b5668acb5a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2508e91354274c47a9312176ac445ffed731f15c", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/lobby/connection/PlayerToLobbyConnection.java b/game-core/src/main/java/games/strategy/engine/lobby/connection/PlayerToLobbyConnection.java\nindex 86a0ea5d1..ff7fd9f81 100644\n--- a/game-core/src/main/java/games/strategy/engine/lobby/connection/PlayerToLobbyConnection.java\n+++ b/game-core/src/main/java/games/strategy/engine/lobby/connection/PlayerToLobbyConnection.java\n\n@@ -1,5 +1,6 @@\n package games.strategy.engine.lobby.connection;\n \n+import java.net.InetAddress;\n import java.net.URI;\n import java.util.List;\n import java.util.function.Consumer;\n"}}, {"oid": "2508e91354274c47a9312176ac445ffed731f15c", "url": "https://github.com/triplea-game/triplea/commit/2508e91354274c47a9312176ac445ffed731f15c", "message": "wip", "committedDate": "2020-03-27T07:47:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NTI0Nw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399085247", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-27T07:48:56Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ConnectToChatMessage.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.chat;", "originalCommit": "2508e91354274c47a9312176ac445ffed731f15c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0092443bcef243afbe82ea00cbc60648a719d00b", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ConnectToChatMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ConnectToChatMessage.java\nindex 7ee8f28fb..cefd0edb0 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ConnectToChatMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ConnectToChatMessage.java\n\n@@ -1,5 +1,6 @@\n package org.triplea.http.client.web.socket.messages.envelopes.chat;\n \n+import lombok.EqualsAndHashCode;\n import org.triplea.domain.data.ApiKey;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n import org.triplea.http.client.web.socket.messages.MessageType;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NTI1MA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399085250", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-27T07:48:56Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerLeftMessage.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.chat;", "originalCommit": "2508e91354274c47a9312176ac445ffed731f15c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerLeftMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerLeftMessage.java\nindex d4e36f038..4ee5b0b57 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerLeftMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/PlayerLeftMessage.java\n\n@@ -1,6 +1,5 @@\n package org.triplea.http.client.web.socket.messages.envelopes.chat;\n \n-import lombok.Builder;\n import org.triplea.domain.data.UserName;\n import org.triplea.http.client.web.socket.MessageEnvelope;\n import org.triplea.http.client.web.socket.messages.MessageType;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NTI1Ng==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399085256", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-27T07:48:56Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatterListingMessage.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.triplea.http.client.web.socket.messages.envelopes.chat;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import lombok.Builder;\n+import org.triplea.domain.data.ChatParticipant;\n+import org.triplea.http.client.web.socket.MessageEnvelope;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+\n+public class ChatterListingMessage implements WebSocketMessage {\n+  public static final MessageType<ChatterListingMessage> TYPE =\n+      MessageType.of(ChatterListingMessage.class);\n+\n+  @Builder\n+  private static class Chatter {\n+    private final String userName;\n+    private final String playerChatId;\n+    private final boolean isModerator;\n+    private final String status;\n+  }\n+\n+  private final List<Chatter> chatters;\n+\n+  public ChatterListingMessage(List<ChatParticipant> chatters) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "2508e91354274c47a9312176ac445ffed731f15c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatterListingMessage.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatterListingMessage.java\nindex 1a2a78110..2ec562b52 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatterListingMessage.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/messages/envelopes/chat/ChatterListingMessage.java\n\n@@ -22,8 +22,20 @@ public class ChatterListingMessage implements WebSocketMessage {\n \n   private final List<Chatter> chatters;\n \n-  public ChatterListingMessage(List<ChatParticipant> chatters) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+  public ChatterListingMessage(List<ChatParticipant> chatParticipants) {\n+    chatters =\n+        chatParticipants.stream() //\n+            .map(this::mapToChatter)\n+            .collect(Collectors.toList());\n+  }\n+\n+  private Chatter mapToChatter(final ChatParticipant chatParticipant) {\n+    return Chatter.builder()\n+        .isModerator(chatParticipant.isModerator())\n+        .playerChatId(chatParticipant.getPlayerChatId().getValue())\n+        .status(chatParticipant.getStatus())\n+        .userName(chatParticipant.getUserName().getValue())\n+        .build();\n   }\n \n   public List<ChatParticipant> getChatters() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NTI2MA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399085260", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-27T07:48:57Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -15,12 +16,40 @@\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n+  private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n+  private final ChatParticipantAdapter chatParticipantAdapter;\n+\n+  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey) {\n+\n+    final Optional<ChatParticipant> chatParticipant =\n+        apiKeyDaoWrapper.lookupByApiKey(apiKey).map(chatParticipantAdapter);\n+\n+    if (chatParticipant.isPresent()) {\n+      // add chatter\n+    }\n+    return chatParticipant;\n+  }\n+\n+  public List<ChatParticipant> getChatters() {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "2508e91354274c47a9312176ac445ffed731f15c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex 146d18b73..b6bc368fa 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -16,21 +16,28 @@ import lombok.AccessLevel;\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.jdbi.v3.core.Jdbi;\n import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n+/** Keeps the current list of ChatParticipants and maps them to their websocket session. */\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n-  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n-    throw new UnsupportedOperationException(\"TODO\");\n-  }\n \n   private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n   private final ChatParticipantAdapter chatParticipantAdapter;\n \n+  public static Chatters build(final Jdbi jdbi) {\n+    return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n+  }\n+\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n   public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey) {\n \n     final Optional<ChatParticipant> chatParticipant =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA4NTI2NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399085264", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-27T07:48:57Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -15,12 +16,40 @@\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n+  private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n+  private final ChatParticipantAdapter chatParticipantAdapter;\n+\n+  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey) {\n+\n+    final Optional<ChatParticipant> chatParticipant =\n+        apiKeyDaoWrapper.lookupByApiKey(apiKey).map(chatParticipantAdapter);\n+\n+    if (chatParticipant.isPresent()) {\n+      // add chatter\n+    }\n+    return chatParticipant;\n+  }\n+\n+  public List<ChatParticipant> getChatters() {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n+  public Optional<UserName> playerLeft(final Session session) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "2508e91354274c47a9312176ac445ffed731f15c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex 146d18b73..b6bc368fa 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -16,21 +16,28 @@ import lombok.AccessLevel;\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.jdbi.v3.core.Jdbi;\n import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n+/** Keeps the current list of ChatParticipants and maps them to their websocket session. */\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n-  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n-    throw new UnsupportedOperationException(\"TODO\");\n-  }\n \n   private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n   private final ChatParticipantAdapter chatParticipantAdapter;\n \n+  public static Chatters build(final Jdbi jdbi) {\n+    return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n+  }\n+\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n   public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey) {\n \n     final Optional<ChatParticipant> chatParticipant =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMTg0MQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399631841", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-28T07:32:26Z", "path": "http-server/src/main/java/org/triplea/modules/chat/event/processing/StatusUpdateListener.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package org.triplea.modules.chat.event.processing;", "originalCommit": "507510286ef2dda99c543636458f9812dda9c828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "306e25b2085078b6fb7c35b34426918f3c486968", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/event/processing/StatusUpdateListener.java b/http-server/src/main/java/org/triplea/modules/chat/event/processing/StatusUpdateListener.java\nindex f4488acda..c32d44e52 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/event/processing/StatusUpdateListener.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/event/processing/StatusUpdateListener.java\n\n@@ -26,8 +26,10 @@ public class StatusUpdateListener\n       final WebSocketMessageContext<PlayerStatusUpdateSentMessage> messageContext,\n       final ChatParticipant chatParticipant) {\n \n-    messageContext.getMessagingBus().broadcastMessage(\n-        new PlayerStatusUpdateReceivedMessage(\n-            chatParticipant.getUserName(), messageContext.getMessage().getStatus()));\n+    messageContext\n+        .getMessagingBus()\n+        .broadcastMessage(\n+            new PlayerStatusUpdateReceivedMessage(\n+                chatParticipant.getUserName(), messageContext.getMessage().getStatus()));\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMTg0Mw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399631843", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-28T07:32:26Z", "path": "http-server/src/main/java/org/triplea/modules/chat/event/processing/ChatMessageListener.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package org.triplea.modules.chat.event.processing;", "originalCommit": "507510286ef2dda99c543636458f9812dda9c828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "4b3b9ee250f8594d51f7e50b657adac497f52255", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/event/processing/ChatMessageListener.java b/http-server/src/main/java/org/triplea/modules/chat/event/processing/ChatMessageListener.java\nindex bdbca626b..fc443a1a7 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/event/processing/ChatMessageListener.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/event/processing/ChatMessageListener.java\n\n@@ -23,10 +23,8 @@ public class ChatMessageListener implements Consumer<WebSocketMessageContext<Cha\n   private static void broadcastChatMessage(\n       final WebSocketMessageContext<ChatSentMessage> messageContext, final ChatParticipant sender) {\n \n-    messageContext\n-        .getMessagingBus()\n-        .broadcastMessage(\n-            new ChatReceivedMessage(\n-                sender.getUserName(), messageContext.getMessage().getChatMessage()));\n+    messageContext.broadcastMessage(\n+        new ChatReceivedMessage(\n+            sender.getUserName(), messageContext.getMessage().getChatMessage()));\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMTg0NQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399631845", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-28T07:32:26Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -15,12 +16,47 @@\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n+/** Keeps the current list of ChatParticipants and maps them to their websocket session. */\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+\n+  private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n+  private final ChatParticipantAdapter chatParticipantAdapter;\n+\n+  public static Chatters build(final Jdbi jdbi) {\n+    return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n+  }\n+\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "507510286ef2dda99c543636458f9812dda9c828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex b6bc368fa..b0b69d781 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -26,26 +26,35 @@ import org.triplea.domain.data.UserName;\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n-\n   private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n   private final ChatParticipantAdapter chatParticipantAdapter;\n \n+  @Getter(value = AccessLevel.PACKAGE, onMethod_ = @VisibleForTesting)\n+  private final Map<String, ChatterSession> participants = new ConcurrentHashMap<>();\n+\n+  @AllArgsConstructor\n+  @Getter\n+  @VisibleForTesting\n+  static class ChatterSession {\n+    private final ChatParticipant chatParticipant;\n+    private final Session session;\n+  }\n+\n   public static Chatters build(final Jdbi jdbi) {\n     return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n   }\n \n   public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+    return Optional.ofNullable(participants.get(senderSession.getId()))\n+        .map(chatterSession -> chatterSession.chatParticipant);\n   }\n \n-  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey) {\n-\n+  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey, final Session session) {\n     final Optional<ChatParticipant> chatParticipant =\n         apiKeyDaoWrapper.lookupByApiKey(apiKey).map(chatParticipantAdapter);\n-\n-    if (chatParticipant.isPresent()) {\n-      // add chatter\n-    }\n+    // add chatter\n+    chatParticipant.ifPresent(\n+        participant -> participants.put(session.getId(), new ChatterSession(participant, session)));\n     return chatParticipant;\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMTg0Nw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399631847", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-28T07:32:26Z", "path": "http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.triplea.web.socket.connections;\n+\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import javax.websocket.Session;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.web.socket.WebSocketMessageContext;\n+\n+public class WebSocketMessagingBus {\n+  public static String MESSAGING_BUS_KEY = \"messaging.bus\";\n+\n+  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "507510286ef2dda99c543636458f9812dda9c828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java b/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\nindex 638476661..70ed6e08b 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\n\n@@ -3,19 +3,28 @@ package org.triplea.web.socket.connections;\n import java.util.function.BiConsumer;\n import java.util.function.Consumer;\n import javax.websocket.Session;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n import org.triplea.http.client.web.socket.messages.MessageType;\n import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n import org.triplea.web.socket.WebSocketMessageContext;\n \n+@AllArgsConstructor\n public class WebSocketMessagingBus {\n   public static String MESSAGING_BUS_KEY = \"messaging.bus\";\n \n-  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+  private final MessageBroadcaster messageBroadcaster;\n+  private final MessageSender messageSender;\n+\n+  public static WebSocketMessagingBus build() {\n+  }\n+\n+  public <X extends WebSocketMessage> void sendResponse(final Session session, final X responseMessage) {\n+    messageSender.accept(session, responseMessage.toEnvelope());\n   }\n \n-  public <X extends WebSocketMessage> void broadcastMessage(X broadcastMessage) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+  public <X extends WebSocketMessage> void broadcastMessage(final Session session, final X broadcastMessage) {\n+    messageBroadcaster.accept(session.getOpenSessions(), broadcastMessage.toEnvelope());\n   }\n \n   public <T extends WebSocketMessage> void addListener(\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYzMTg0OQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399631849", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-28T07:32:27Z", "path": "http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.triplea.web.socket.connections;\n+\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import javax.websocket.Session;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.web.socket.WebSocketMessageContext;\n+\n+public class WebSocketMessagingBus {\n+  public static String MESSAGING_BUS_KEY = \"messaging.bus\";\n+\n+  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(X broadcastMessage) {\n+    throw new UnsupportedOperationException(\"TODO\");", "originalCommit": "507510286ef2dda99c543636458f9812dda9c828", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java b/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\nindex 638476661..70ed6e08b 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/connections/WebSocketMessagingBus.java\n\n@@ -3,19 +3,28 @@ package org.triplea.web.socket.connections;\n import java.util.function.BiConsumer;\n import java.util.function.Consumer;\n import javax.websocket.Session;\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n import org.triplea.http.client.web.socket.messages.MessageType;\n import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n import org.triplea.web.socket.WebSocketMessageContext;\n \n+@AllArgsConstructor\n public class WebSocketMessagingBus {\n   public static String MESSAGING_BUS_KEY = \"messaging.bus\";\n \n-  public <X extends WebSocketMessage> void sendResponse(X responseMessage) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+  private final MessageBroadcaster messageBroadcaster;\n+  private final MessageSender messageSender;\n+\n+  public static WebSocketMessagingBus build() {\n+  }\n+\n+  public <X extends WebSocketMessage> void sendResponse(final Session session, final X responseMessage) {\n+    messageSender.accept(session, responseMessage.toEnvelope());\n   }\n \n-  public <X extends WebSocketMessage> void broadcastMessage(X broadcastMessage) {\n-    throw new UnsupportedOperationException(\"TODO\");\n+  public <X extends WebSocketMessage> void broadcastMessage(final Session session, final X broadcastMessage) {\n+    messageBroadcaster.accept(session.getOpenSessions(), broadcastMessage.toEnvelope());\n   }\n \n   public <T extends WebSocketMessage> void addListener(\n"}}, {"oid": "306e25b2085078b6fb7c35b34426918f3c486968", "url": "https://github.com/triplea-game/triplea/commit/306e25b2085078b6fb7c35b34426918f3c486968", "message": "Formatting", "committedDate": "2020-03-28T07:49:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUzMDM4NQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399530385", "bodyText": "Would you mind explaining this change?", "author": "RoiEXLab", "createdAt": "2020-03-27T20:48:56Z", "path": "game-core/src/main/java/games/strategy/engine/chat/LobbyChatTransmitter.java", "diffHunk": "@@ -21,30 +28,47 @@\n \n   @Override\n   public void setChatClient(final ChatClient chatClient) {\n-    playerToLobbyConnection.addChatMessageListeners(\n-        ChatMessageListeners.builder()\n-            .playerStatusListener(chatClient::statusUpdated)\n-            .playerLeftListener(chatClient::participantRemoved)\n-            .playerJoinedListener(chatClient::participantAdded)\n-            .chatMessageListener(chatClient::messageReceived)\n-            .connectedListener(chatClient::connected)\n-            .chatEventListener(chatClient::eventReceived)\n-            .playerSlappedListener(\n-                slapEvent -> {\n-                  if (slapEvent.getSlapped().equals(localUserName)) {\n-                    chatClient.slappedBy(slapEvent.getSlapper());\n-                  } else {\n-                    chatClient.playerSlapped(\n-                        slapEvent.getSlapper() + \" slapped \" + slapEvent.getSlapped());\n-                  }\n-                })\n-            .serverErrorListener(log::severe)\n-            .build());\n+    playerToLobbyConnection.addMessageListener(\n+        ChatterListingMessage.TYPE, message -> chatClient.connected(message.getChatters()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        PlayerStatusUpdateReceivedMessage.TYPE,\n+        message -> chatClient.statusUpdated(message.getUserName(), message.getStatus()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        PlayerLeftMessage.TYPE, message -> chatClient.participantRemoved(message.getUserName()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        PlayerJoinedMessage.TYPE,\n+        message -> chatClient.participantAdded(message.getChatParticipant()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        ChatReceivedMessage.TYPE,\n+        message -> chatClient.messageReceived(message.getSender(), message.getMessage()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        PlayerJoinedMessage.TYPE,\n+        message -> chatClient.participantAdded(message.getChatParticipant()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        ChatEventReceivedMessage.TYPE, message -> chatClient.eventReceived(message.getMessage()));\n+\n+    playerToLobbyConnection.addMessageListener(\n+        PlayerSlapReceivedMessage.TYPE,\n+        message -> {\n+          if (message.getSlappedPlayer().equals(localUserName)) {\n+            chatClient.slappedBy(message.getSlappingPlayer());\n+          } else {\n+            chatClient.eventReceived(\n+                message.getSlappingPlayer() + \" slapped \" + message.getSlappedPlayer());\n+          }\n+        });\n+    playerToLobbyConnection.sendConnectToChatMessage();\n   }\n \n   @Override\n   public Collection<ChatParticipant> connect() {\n-    return playerToLobbyConnection.connect();\n+    return List.of();", "originalCommit": "1b28cbb1954852950e96cbeabf9ab436ed254e2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5ODYxOA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399698618", "bodyText": "Certainly. Before we had more of a hybrid http and websocket model, sync and async. On the very first iteration we had a problem where if you initially connect to websocket, we would not know the chatter name. So what we did was the initial connection established a chatter, and we got the list of chatters back in a synchronized manner.\nThis is being updated so that we establish a websocket session first, but even with the websocket session you are not going to get any messages until you send a 'join' message. With that, the server will respond to 'join' messages with a websocket response containing the chatter list.", "author": "DanVanAtta", "createdAt": "2020-03-28T19:15:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUzMDM4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "79a487c40807ab3f89056ae4387598d0ca7683a8", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/chat/LobbyChatTransmitter.java b/game-core/src/main/java/games/strategy/engine/chat/LobbyChatTransmitter.java\nindex 36676cb26..1d5cc74f5 100644\n--- a/game-core/src/main/java/games/strategy/engine/chat/LobbyChatTransmitter.java\n+++ b/game-core/src/main/java/games/strategy/engine/chat/LobbyChatTransmitter.java\n\n@@ -54,18 +54,21 @@ public class LobbyChatTransmitter implements ChatTransmitter {\n         ChatEventReceivedMessage.TYPE, message -> chatClient.eventReceived(message.getMessage()));\n \n     playerToLobbyConnection.addMessageListener(\n-        PlayerSlapReceivedMessage.TYPE,\n-        message -> {\n-          if (message.getSlappedPlayer().equals(localUserName)) {\n-            chatClient.slappedBy(message.getSlappingPlayer());\n-          } else {\n-            chatClient.eventReceived(\n-                message.getSlappingPlayer() + \" slapped \" + message.getSlappedPlayer());\n-          }\n-        });\n+        PlayerSlapReceivedMessage.TYPE, message -> handleSlapMessage(chatClient, message));\n+\n     playerToLobbyConnection.sendConnectToChatMessage();\n   }\n \n+  private void handleSlapMessage(\n+      final ChatClient chatClient, final PlayerSlapReceivedMessage message) {\n+    if (message.getSlappedPlayer().equals(localUserName)) {\n+      chatClient.slappedBy(message.getSlappingPlayer());\n+    } else {\n+      chatClient.eventReceived(\n+          message.getSlappingPlayer() + \" slapped \" + message.getSlappedPlayer());\n+    }\n+  }\n+\n   @Override\n   public Collection<ChatParticipant> connect() {\n     return List.of();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4NDk0NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399684944", "bodyText": "Thoughts about using a MultiMap to get the O(1) runtime of this frequently used method?", "author": "RoiEXLab", "createdAt": "2020-03-28T17:03:09Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/GenericWebSocketClient.java", "diffHunk": "@@ -19,74 +24,102 @@\n  * API, and it automatically converts incoming and outgoing messages to JSON string. In particular\n  * this class makes sure that all operations are non-blocking, but keep their initial dispatch\n  * order.\n+ *\n+ * <p>Note: The error handler passed in is invoked if we get an error connecting to server, or if\n+ * server sends us an error message.\n  */\n @Log\n-public class GenericWebSocketClient implements WebSocketConnectionListener {\n+public class GenericWebSocketClient implements WebSocket, WebSocketConnectionListener {\n   private static final Gson gson = new Gson();\n \n-  private final WebSocketConnection client;\n   /** These are called whenever connection is closed, whether by us or server. */\n   private final Collection<Runnable> connectionClosedListeners = new ArrayList<>();\n \n-  private final Consumer<String> errorHandler;\n-  private Consumer<ServerMessageEnvelope> messageListener;\n+  @Nonnull private final URI websocketUri;\n+  @Nonnull private final Consumer<String> errorHandler;\n \n-  public GenericWebSocketClient(final URI lobbyUri, final Consumer<String> errorHandler) {\n-    this(new WebSocketConnection(swapHttpsToWssProtocol(lobbyUri)), errorHandler);\n-  }\n+  private WebSocketConnection webSocketConnection;\n+  private final Set<MessageListener<? extends WebSocketMessage>> listeners = new HashSet<>();\n \n-  @VisibleForTesting\n-  GenericWebSocketClient(\n-      final WebSocketConnection webSocketClient, final Consumer<String> errorHandler) {\n-    client = webSocketClient;\n-    this.errorHandler = errorHandler;\n+  @Builder\n+  private static class MessageListener<T extends WebSocketMessage> {\n+    @Nonnull MessageType<T> messageType;\n+    @Nonnull Consumer<Object> listener;\n   }\n \n-  @VisibleForTesting\n-  static URI swapHttpsToWssProtocol(final URI uri) {\n-    return uri.getScheme().equals(\"https\")\n-        ? URI.create(uri.toString().replace(\"https\", \"wss\"))\n-        : uri;\n-  }\n-\n-  public void registerListenerAndConnect(final Consumer<ServerMessageEnvelope> messageListener) {\n-    this.messageListener = messageListener;\n-    client\n-        .connect(this, errorHandler)\n-        .exceptionally(\n-            throwable -> {\n-              log.log(\n-                  Level.SEVERE, \"Unexpected exception completing websocket connection\", throwable);\n-              return false;\n-            });\n+  @Builder\n+  public GenericWebSocketClient(\n+      @Nonnull final URI websocketUri, @Nonnull final Consumer<String> errorHandler) {\n+    this.websocketUri = websocketUri;\n+    this.errorHandler = errorHandler;\n   }\n \n   /**\n    * Non-blocking send of a message to the server. Implementation note: data is sent as a JSON\n    * string, this method handles conversion of the parameter object to JSON.\n    *\n    * @param message The data object to send to the server.\n+   * @deprecated Call {@code sendMessage(WebsocketMessage)} instead.\n    */\n+  @Deprecated\n   public void send(final ClientMessageEnvelope message) {\n     // we get by doing the send on a new thread.\n-    client.sendMessage(gson.toJson(message));\n+    webSocketConnection.sendMessage(gson.toJson(message));\n   }\n \n-  /**\n-   * Removes connection lost listeners and starts a non-blocking close of the websocket connection.\n-   */\n+  @Override\n+  public void connect() {\n+    addListener(ServerErrorMessage.TYPE, message -> errorHandler.accept(message.getError()));\n+    webSocketConnection = new WebSocketConnection(swapHttpsToWssProtocol(websocketUri));\n+    webSocketConnection.connect(this, errorHandler);\n+  }\n+\n+  @VisibleForTesting\n+  static URI swapHttpsToWssProtocol(final URI uri) {\n+    return uri.getScheme().equals(\"https\")\n+        ? URI.create(uri.toString().replace(\"https\", \"wss\"))\n+        : uri;\n+  }\n+\n+  /** Starts a non-blocking close of the websocket connection. */\n+  @Override\n   public void close() {\n-    client.close();\n+    webSocketConnection.close();\n+  }\n+\n+  @SuppressWarnings(\"unchecked\")\n+  @Override\n+  public <T extends WebSocketMessage> void addListener(\n+      final MessageType<T> messageType, final Consumer<T> messageHandler) {\n+\n+    final Consumer<Object> messageConsumer = object -> messageHandler.accept((T) object);\n+    listeners.add(\n+        MessageListener.<T>builder() //\n+            .messageType(messageType)\n+            .listener(messageConsumer)\n+            .build());\n+  }\n+\n+  @Override\n+  public void sendMessage(final WebSocketMessage message) {\n+    webSocketConnection.sendMessage(gson.toJson(message.toEnvelope()));\n   }\n \n+  @Override\n   public void addConnectionClosedListener(final Runnable connectionClosedListener) {\n     connectionClosedListeners.add(connectionClosedListener);\n   }\n \n   @Override\n   public void messageReceived(final String message) {\n-    final ServerMessageEnvelope converted = gson.fromJson(message, ServerMessageEnvelope.class);\n-    messageListener.accept(converted);\n+    final MessageEnvelope converted = gson.fromJson(message, MessageEnvelope.class);\n+\n+    listeners.stream()\n+        .filter(listener -> converted.messageTypeIs(listener.messageType))", "originalCommit": "1b28cbb1954852950e96cbeabf9ab436ed254e2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5ODk2NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399698964", "bodyText": "I did want a map, the listeners are of mixed type. If you can see how to solve that, it would make for cleaner logic probably. Otherwise, the mixed typing caused issues defining such a map.\nFWIW, I don't think the iteration and lookup is necessarily a  problem. A recent saying I've come across that I found interesting, https://blog.cloudflare.com/when-bloom-filters-dont-bloom/,\n\n\"One colleague often says: \"You can assume modern CPUs are infinitely fast. They run at infinite speed until they hit the memory wall\".\"\n\nIn this case, we are not going to have all listeners loaded from main memory, but still the point remains that a map is not necessarily going to be that much faster than sequential scanning on a pretty limited collection size.", "author": "DanVanAtta", "createdAt": "2020-03-28T19:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4NDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcyNzMzNQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399727335", "bodyText": "I agree that a map might not yield the desired performance benefits with this few listeners, but your answer about the types surprised me:\nWhat would speak against code that looks something along the lines of this:\nprivate final Multimap<MessageType<?>, MessageListener> listeners = HashMultimap.create();\n\n@Override\npublic void messageReceived(final String message) {\n  final MessageEnvelope converted = gson.fromJson(message, MessageEnvelope.class);\n\n  listeners.get(converted.getMessageType()).forEach(listener ->\n                listener.listener.accept(\n                    converted.getPayload(listener.messageType.getPayloadType())));\n}", "author": "RoiEXLab", "createdAt": "2020-03-29T00:38:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4NDk0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTczNjgwOQ==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399736809", "bodyText": "Seems you'll lose type coherence, getMessageType() returns a string. MessageListener is also a generic type as well, it should match the generic type for MessageType\nOne also needs to account for the adding a listener as well under those constraints. The type safety we worked pretty hard for previously, clarity and correctness are important heuristics. We also need to think about system level issues, whether the incoming/outgoing message pattern is going to be clear and sustainable.", "author": "DanVanAtta", "createdAt": "2020-03-29T02:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY4NDk0NA=="}], "type": "inlineReview", "revised_code": {"commit": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "chunk": "diff --git a/http-clients/src/main/java/org/triplea/http/client/web/socket/GenericWebSocketClient.java b/http-clients/src/main/java/org/triplea/http/client/web/socket/GenericWebSocketClient.java\nindex 6669ff168..a56df1d9c 100644\n--- a/http-clients/src/main/java/org/triplea/http/client/web/socket/GenericWebSocketClient.java\n+++ b/http-clients/src/main/java/org/triplea/http/client/web/socket/GenericWebSocketClient.java\n\n@@ -32,6 +32,7 @@ import org.triplea.http.client.web.socket.messages.envelopes.ServerErrorMessage;\n public class GenericWebSocketClient implements WebSocket, WebSocketConnectionListener {\n   private static final Gson gson = new Gson();\n \n+  private final WebSocketConnection client;\n   /** These are called whenever connection is closed, whether by us or server. */\n   private final Collection<Runnable> connectionClosedListeners = new ArrayList<>();\n \n"}}, {"oid": "f3e112e077264b59909aad8198872dee75c3f111", "url": "https://github.com/triplea-game/triplea/commit/f3e112e077264b59909aad8198872dee75c3f111", "message": "wip", "committedDate": "2020-03-29T00:13:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTcyNTY2Mw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399725663", "bodyText": "Identical blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-29T00:15:49Z", "path": "http-server/src/main/java/org/triplea/modules/moderation/ban/user/UserBanService.java", "diffHunk": "@@ -149,16 +124,50 @@ private static UserBanParams toUserBanParams(\n         .build();\n   }\n \n-  private static String playerBannedMessage(final long banMinutes) {\n-    return String.format(\n-        \"You have been banned for %s for violating lobby rules\",\n-        BanDurationFormatter.formatBanMinutes(banMinutes));\n+  private void persistUserBanToDatabase(final UserBanParams userBanParams) {\n+    if (userBanDao.addBan(\n+            publicIdSupplier.get(),\n+            userBanParams.getUsername(),\n+            userBanParams.getSystemId(),\n+            userBanParams.getIp(),\n+            userBanParams.getMinutesToBan())\n+        != 1) {\n+      throw new IllegalStateException(\"Failed to insert ban record:\" + userBanParams);\n+    }\n   }\n \n-  private static String playerBannedNotification(\n-      final UserName bannedUserName, final long banMinutes) {\n-    return String.format(\n-        \"%s violated lobby rules and was banned for %s\",\n-        bannedUserName, BanDurationFormatter.formatBanMinutes(banMinutes));\n+  private void removePlayerFromChat(final UserBanParams userBanParams) {\n+    // kick the player out of chat and send a broadcast message\n+    if (chatters.hasPlayer(UserName.of(userBanParams.getUsername()))\n+        && disconnectUserFromChat(userBanParams)) {\n+      broadcastToChattersPlayerBannedMessage(userBanParams);\n+    }\n+  }\n+\n+  private boolean disconnectUserFromChat(final UserBanParams userBanParams) {\n+    return chatters.disconnectPlayerSessions(\n+        UserName.of(userBanParams.getUsername()),\n+        String.format(\n+            \"You have been banned for %s for violating lobby rules\",\n+            BanDurationFormatter.formatBanMinutes(userBanParams.getMinutesToBan())));\n+  }\n+\n+  private void broadcastToChattersPlayerBannedMessage(final UserBanParams banUserParams) {\n+    chatMessagingBus.broadcastMessage(\n+        new ChatEventReceivedMessage(\n+            String.format(\n+                \"%s violated lobby rules and was banned for %s\",\n+                banUserParams.getUsername(),\n+                BanDurationFormatter.formatBanMinutes(banUserParams.getMinutesToBan()))));\n+  }\n+\n+  private void recordBanInModeratorAuditLog(int moderatorId, UserBanParams userBanParams) {\n+    moderatorAuditHistoryDao.addAuditRecord(", "originalCommit": "f3e112e077264b59909aad8198872dee75c3f111", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0cbba59c00e6790a241b174eb7851fa773530552", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/moderation/ban/user/UserBanService.java b/http-server/src/main/java/org/triplea/modules/moderation/ban/user/UserBanService.java\nindex dcf48b806..ec5ff70dd 100644\n--- a/http-server/src/main/java/org/triplea/modules/moderation/ban/user/UserBanService.java\n+++ b/http-server/src/main/java/org/triplea/modules/moderation/ban/user/UserBanService.java\n\n@@ -136,15 +132,7 @@ public class UserBanService {\n     }\n   }\n \n-  private void removePlayerFromChat(final UserBanParams userBanParams) {\n-    // kick the player out of chat and send a broadcast message\n-    if (chatters.hasPlayer(UserName.of(userBanParams.getUsername()))\n-        && disconnectUserFromChat(userBanParams)) {\n-      broadcastToChattersPlayerBannedMessage(userBanParams);\n-    }\n-  }\n-\n-  private boolean disconnectUserFromChat(final UserBanParams userBanParams) {\n+  private boolean removePlayerFromChat(final UserBanParams userBanParams) {\n     return chatters.disconnectPlayerSessions(\n         UserName.of(userBanParams.getUsername()),\n         String.format(\n"}}, {"oid": "c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "url": "https://github.com/triplea-game/triplea/commit/c0ac86ab8ea9135bacf67f0f0c1310498a5d9d30", "message": "Refactor websocket listeners & messages, attach one at a time instead of in groups", "committedDate": "2020-03-29T21:09:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODIyNw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399858227", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-29T21:45:27Z", "path": "http-server/src/main/java/org/triplea/web/socket/GameConnectionWebSocket.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.triplea.web.socket;", "originalCommit": "f086a64eb27882184cdff25629f42b964ba3c39a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0cbba59c00e6790a241b174eb7851fa773530552", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/GameConnectionWebSocket.java b/http-server/src/main/java/org/triplea/web/socket/GameConnectionWebSocket.java\nindex 2ef99b832..724e61958 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/GameConnectionWebSocket.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/GameConnectionWebSocket.java\n\n@@ -1,5 +1,7 @@\n package org.triplea.web.socket;\n \n+import static org.triplea.web.socket.WebSocketMessagingBus.MESSAGING_BUS_KEY;\n+\n import javax.websocket.CloseReason;\n import javax.websocket.OnClose;\n import javax.websocket.OnError;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1ODIyOA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399858228", "bodyText": "Similar blocks of code found in 2 locations. Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-29T21:45:27Z", "path": "http-server/src/main/java/org/triplea/web/socket/PlayerConnectionWebSocket.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package org.triplea.web.socket;", "originalCommit": "f086a64eb27882184cdff25629f42b964ba3c39a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0cbba59c00e6790a241b174eb7851fa773530552", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/PlayerConnectionWebSocket.java b/http-server/src/main/java/org/triplea/web/socket/PlayerConnectionWebSocket.java\nindex bf1dcf8d3..adfc2658e 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/PlayerConnectionWebSocket.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/PlayerConnectionWebSocket.java\n\n@@ -1,5 +1,7 @@\n package org.triplea.web.socket;\n \n+import static org.triplea.web.socket.WebSocketMessagingBus.MESSAGING_BUS_KEY;\n+\n import javax.websocket.CloseReason;\n import javax.websocket.OnClose;\n import javax.websocket.OnError;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjM3Mw==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399906373", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-30T03:15:58Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -15,39 +16,79 @@\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n+/** Keeps the current list of ChatParticipants and maps them to their websocket session. */\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+  private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n+  private final ChatParticipantAdapter chatParticipantAdapter;\n+\n+  @Getter(value = AccessLevel.PACKAGE, onMethod_ = @VisibleForTesting)\n+  private final Map<String, ChatterSession> participants = new ConcurrentHashMap<>();\n+\n   @AllArgsConstructor\n   @Getter\n   @VisibleForTesting\n-  static class ChatterSession {\n+  private static class ChatterSession {\n     private final ChatParticipant chatParticipant;\n     private final Session session;\n   }\n \n-  @Getter(value = AccessLevel.PACKAGE, onMethod_ = @VisibleForTesting)\n-  private final Map<String, ChatterSession> participants = new ConcurrentHashMap<>();\n+  public static Chatters build(final Jdbi jdbi) {\n+    return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n+  }\n \n-  Optional<UserName> removeSession(final Session session) {\n-    return Optional.ofNullable(participants.remove(session.getId()))\n-        .map(ChatterSession::getChatParticipant)\n-        .map(ChatParticipant::getUserName);\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    return Optional.ofNullable(participants.get(senderSession.getId()))\n+        .map(chatterSession -> chatterSession.chatParticipant);\n   }\n \n-  void put(final Session session, final ChatParticipant chatter) {\n-    participants.put(session.getId(), new ChatterSession(chatter, session));\n+  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey, final Session session) {\n+    final Optional<ChatParticipant> chatParticipant =\n+        apiKeyDaoWrapper.lookupByApiKey(apiKey).map(chatParticipantAdapter);\n+    // add chatter\n+    chatParticipant.ifPresent(\n+        participant -> participants.put(session.getId(), new ChatterSession(participant, session)));\n+    return chatParticipant;\n   }\n \n-  Collection<ChatParticipant> getAllParticipants() {\n+  // TODO: test", "originalCommit": "0cbba59c00e6790a241b174eb7851fa773530552", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0092443bcef243afbe82ea00cbc60648a719d00b", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex 786f325db..01d805528 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -58,37 +56,17 @@ public class Chatters {\n     return chatParticipant;\n   }\n \n-  // TODO: test\n   public Collection<ChatParticipant> getChatters() {\n     return participants.values().stream()\n         .map(session -> session.chatParticipant)\n         .collect(Collectors.toList());\n   }\n \n-  // TODO: test\n   public Optional<UserName> playerLeft(final Session session) {\n     return Optional.ofNullable(participants.remove(session.getId()))\n         .map(chatterSession -> chatterSession.chatParticipant.getUserName());\n   }\n \n-  /*\n-    Optional<UserName> removeSession(final Session session) {\n-      return Optional.ofNullable(participants.remove(session.getId()))\n-          .map(ChatterSession::getChatParticipant)\n-          .map(ChatParticipant::getUserName);\n-    }\n-\n-    void put(final Session session, final ChatParticipant chatter) {\n-      participants.put(session.getId(), new ChatterSession(chatter, session));\n-    }\n-\n-    Collection<ChatParticipant> getAllParticipants() {\n-      return participants.values().stream()\n-          .map(ChatterSession::getChatParticipant)\n-          .collect(Collectors.toSet());\n-    }\n-  */\n-\n   public boolean hasPlayer(final UserName userName) {\n     return participants.values().stream()\n         .map(ChatterSession::getChatParticipant)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNjM3NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r399906374", "bodyText": "TODO found", "author": "codeclimate", "createdAt": "2020-03-30T03:15:59Z", "path": "http-server/src/main/java/org/triplea/modules/chat/Chatters.java", "diffHunk": "@@ -15,39 +16,79 @@\n import lombok.AllArgsConstructor;\n import lombok.Getter;\n import lombok.extern.slf4j.Slf4j;\n+import org.jdbi.v3.core.Jdbi;\n+import org.triplea.db.dao.api.key.ApiKeyDaoWrapper;\n+import org.triplea.domain.data.ApiKey;\n import org.triplea.domain.data.ChatParticipant;\n import org.triplea.domain.data.UserName;\n \n+/** Keeps the current list of ChatParticipants and maps them to their websocket session. */\n @Slf4j\n @AllArgsConstructor\n public class Chatters {\n+  private final ApiKeyDaoWrapper apiKeyDaoWrapper;\n+  private final ChatParticipantAdapter chatParticipantAdapter;\n+\n+  @Getter(value = AccessLevel.PACKAGE, onMethod_ = @VisibleForTesting)\n+  private final Map<String, ChatterSession> participants = new ConcurrentHashMap<>();\n+\n   @AllArgsConstructor\n   @Getter\n   @VisibleForTesting\n-  static class ChatterSession {\n+  private static class ChatterSession {\n     private final ChatParticipant chatParticipant;\n     private final Session session;\n   }\n \n-  @Getter(value = AccessLevel.PACKAGE, onMethod_ = @VisibleForTesting)\n-  private final Map<String, ChatterSession> participants = new ConcurrentHashMap<>();\n+  public static Chatters build(final Jdbi jdbi) {\n+    return new Chatters(ApiKeyDaoWrapper.build(jdbi), new ChatParticipantAdapter());\n+  }\n \n-  Optional<UserName> removeSession(final Session session) {\n-    return Optional.ofNullable(participants.remove(session.getId()))\n-        .map(ChatterSession::getChatParticipant)\n-        .map(ChatParticipant::getUserName);\n+  public Optional<ChatParticipant> lookupPlayerBySession(final Session senderSession) {\n+    return Optional.ofNullable(participants.get(senderSession.getId()))\n+        .map(chatterSession -> chatterSession.chatParticipant);\n   }\n \n-  void put(final Session session, final ChatParticipant chatter) {\n-    participants.put(session.getId(), new ChatterSession(chatter, session));\n+  public Optional<ChatParticipant> connectPlayer(final ApiKey apiKey, final Session session) {\n+    final Optional<ChatParticipant> chatParticipant =\n+        apiKeyDaoWrapper.lookupByApiKey(apiKey).map(chatParticipantAdapter);\n+    // add chatter\n+    chatParticipant.ifPresent(\n+        participant -> participants.put(session.getId(), new ChatterSession(participant, session)));\n+    return chatParticipant;\n   }\n \n-  Collection<ChatParticipant> getAllParticipants() {\n+  // TODO: test\n+  public Collection<ChatParticipant> getChatters() {\n     return participants.values().stream()\n-        .map(ChatterSession::getChatParticipant)\n-        .collect(Collectors.toSet());\n+        .map(session -> session.chatParticipant)\n+        .collect(Collectors.toList());\n+  }\n+\n+  // TODO: test", "originalCommit": "0cbba59c00e6790a241b174eb7851fa773530552", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0092443bcef243afbe82ea00cbc60648a719d00b", "chunk": "diff --git a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\nindex 786f325db..01d805528 100644\n--- a/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n+++ b/http-server/src/main/java/org/triplea/modules/chat/Chatters.java\n\n@@ -58,37 +56,17 @@ public class Chatters {\n     return chatParticipant;\n   }\n \n-  // TODO: test\n   public Collection<ChatParticipant> getChatters() {\n     return participants.values().stream()\n         .map(session -> session.chatParticipant)\n         .collect(Collectors.toList());\n   }\n \n-  // TODO: test\n   public Optional<UserName> playerLeft(final Session session) {\n     return Optional.ofNullable(participants.remove(session.getId()))\n         .map(chatterSession -> chatterSession.chatParticipant.getUserName());\n   }\n \n-  /*\n-    Optional<UserName> removeSession(final Session session) {\n-      return Optional.ofNullable(participants.remove(session.getId()))\n-          .map(ChatterSession::getChatParticipant)\n-          .map(ChatParticipant::getUserName);\n-    }\n-\n-    void put(final Session session, final ChatParticipant chatter) {\n-      participants.put(session.getId(), new ChatterSession(chatter, session));\n-    }\n-\n-    Collection<ChatParticipant> getAllParticipants() {\n-      return participants.values().stream()\n-          .map(ChatterSession::getChatParticipant)\n-          .collect(Collectors.toSet());\n-    }\n-  */\n-\n   public boolean hasPlayer(final UserName userName) {\n     return participants.values().stream()\n         .map(ChatterSession::getChatParticipant)\n"}}, {"oid": "0cbba59c00e6790a241b174eb7851fa773530552", "url": "https://github.com/triplea-game/triplea/commit/0cbba59c00e6790a241b174eb7851fa773530552", "message": "wip", "committedDate": "2020-03-30T02:13:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxMTI5Mg==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r400011292", "bodyText": "Method onMessage has 27 lines of code (exceeds 25 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-30T08:26:42Z", "path": "http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java", "diffHunk": "@@ -0,0 +1,127 @@\n+package org.triplea.web.socket;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.gson.Gson;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.websocket.Session;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Value;\n+import lombok.extern.slf4j.Slf4j;\n+import org.triplea.http.client.web.socket.MessageEnvelope;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.ServerErrorMessage;\n+\n+@AllArgsConstructor(access = AccessLevel.PACKAGE, onConstructor_ = @VisibleForTesting)\n+@Slf4j\n+public class WebSocketMessagingBus {\n+  public static final String MESSAGING_BUS_KEY = \"messaging.bus\";\n+  private static final Gson GSON = new Gson();\n+\n+  @Nonnull private final MessageBroadcaster messageBroadcaster;\n+  @Nonnull private final MessageSender messageSender;\n+  @Nonnull private final SessionSet sessionSet;\n+\n+  private final List<BiConsumer<WebSocketMessagingBus, Session>> sessionClosedListeners =\n+      new ArrayList<>();\n+\n+  @Value\n+  private static class MessageListener<T extends WebSocketMessage> {\n+    MessageType<T> messageType;\n+    Consumer<WebSocketMessageContext> listener;\n+  }\n+\n+  private final List<MessageListener<?>> messageListeners = new ArrayList<>();\n+\n+  public WebSocketMessagingBus() {\n+    messageSender = new MessageSender();\n+    messageBroadcaster = new MessageBroadcaster(messageSender);\n+    sessionSet = new SessionSet();\n+  }\n+\n+  public <X extends WebSocketMessage> void sendResponse(\n+      final Session session, final X responseMessage) {\n+    messageSender.accept(session, responseMessage.toEnvelope());\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(final X broadcastMessage) {\n+    broadcastMessage(sessionSet.getSessions(), broadcastMessage);\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(\n+      final Collection<Session> sessions, final X broadcastMessage) {\n+    messageBroadcaster.accept(sessions, broadcastMessage.toEnvelope());\n+  }\n+\n+  public <T extends WebSocketMessage> void addListener(\n+      final MessageType<T> type, final Consumer<WebSocketMessageContext<T>> listener) {\n+    messageListeners.add(new MessageListener(type, listener));\n+  }\n+\n+  void onMessage(final Session session, final String message) {", "originalCommit": "a14479809f9e3c68fe234c815cc95b29d75a7d70", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "649f9405ad46f0aa57c39043543fe583e25420c9", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\nindex 14dd97b47..358cb3ba7 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\n\n@@ -32,6 +32,7 @@ public class WebSocketMessagingBus {\n   private final List<BiConsumer<WebSocketMessagingBus, Session>> sessionClosedListeners =\n       new ArrayList<>();\n \n+  @SuppressWarnings(\"rawtypes\")\n   @Value\n   private static class MessageListener<T extends WebSocketMessage> {\n     MessageType<T> messageType;\n"}}, {"oid": "20b17bce377036662fffeb3d2d6ddf4cb363ee63", "url": "https://github.com/triplea-game/triplea/commit/20b17bce377036662fffeb3d2d6ddf4cb363ee63", "message": "wip", "committedDate": "2020-03-30T08:30:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDAxNjI5Mg==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r400016292", "bodyText": "Method onMessage has 27 lines of code (exceeds 25 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-03-30T08:35:01Z", "path": "http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java", "diffHunk": "@@ -0,0 +1,127 @@\n+package org.triplea.web.socket;\n+\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.gson.Gson;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import javax.annotation.Nonnull;\n+import javax.websocket.Session;\n+import lombok.AccessLevel;\n+import lombok.AllArgsConstructor;\n+import lombok.Value;\n+import lombok.extern.slf4j.Slf4j;\n+import org.triplea.http.client.web.socket.MessageEnvelope;\n+import org.triplea.http.client.web.socket.messages.MessageType;\n+import org.triplea.http.client.web.socket.messages.WebSocketMessage;\n+import org.triplea.http.client.web.socket.messages.envelopes.ServerErrorMessage;\n+\n+@AllArgsConstructor(access = AccessLevel.PACKAGE, onConstructor_ = @VisibleForTesting)\n+@Slf4j\n+public class WebSocketMessagingBus {\n+  public static final String MESSAGING_BUS_KEY = \"messaging.bus\";\n+  private static final Gson GSON = new Gson();\n+\n+  @Nonnull private final MessageBroadcaster messageBroadcaster;\n+  @Nonnull private final MessageSender messageSender;\n+  @Nonnull private final SessionSet sessionSet;\n+\n+  private final List<BiConsumer<WebSocketMessagingBus, Session>> sessionClosedListeners =\n+      new ArrayList<>();\n+\n+  @Value\n+  private static class MessageListener<T extends WebSocketMessage> {\n+    MessageType<T> messageType;\n+    Consumer<WebSocketMessageContext> listener;\n+  }\n+\n+  private final List<MessageListener<?>> messageListeners = new ArrayList<>();\n+\n+  public WebSocketMessagingBus() {\n+    messageSender = new MessageSender();\n+    messageBroadcaster = new MessageBroadcaster(messageSender);\n+    sessionSet = new SessionSet();\n+  }\n+\n+  public <X extends WebSocketMessage> void sendResponse(\n+      final Session session, final X responseMessage) {\n+    messageSender.accept(session, responseMessage.toEnvelope());\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(final X broadcastMessage) {\n+    broadcastMessage(sessionSet.getSessions(), broadcastMessage);\n+  }\n+\n+  public <X extends WebSocketMessage> void broadcastMessage(\n+      final Collection<Session> sessions, final X broadcastMessage) {\n+    messageBroadcaster.accept(sessions, broadcastMessage.toEnvelope());\n+  }\n+\n+  public <T extends WebSocketMessage> void addListener(\n+      final MessageType<T> type, final Consumer<WebSocketMessageContext<T>> listener) {\n+    messageListeners.add(new MessageListener(type, listener));\n+  }\n+\n+  void onMessage(final Session session, final String message) {", "originalCommit": "20b17bce377036662fffeb3d2d6ddf4cb363ee63", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "649f9405ad46f0aa57c39043543fe583e25420c9", "chunk": "diff --git a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\nindex 14dd97b47..358cb3ba7 100644\n--- a/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\n+++ b/http-server/src/main/java/org/triplea/web/socket/WebSocketMessagingBus.java\n\n@@ -32,6 +32,7 @@ public class WebSocketMessagingBus {\n   private final List<BiConsumer<WebSocketMessagingBus, Session>> sessionClosedListeners =\n       new ArrayList<>();\n \n+  @SuppressWarnings(\"rawtypes\")\n   @Value\n   private static class MessageListener<T extends WebSocketMessage> {\n     MessageType<T> messageType;\n"}}, {"oid": "649f9405ad46f0aa57c39043543fe583e25420c9", "url": "https://github.com/triplea-game/triplea/commit/649f9405ad46f0aa57c39043543fe583e25420c9", "message": "wip", "committedDate": "2020-04-04T06:08:04Z", "type": "forcePushed"}, {"oid": "0092443bcef243afbe82ea00cbc60648a719d00b", "url": "https://github.com/triplea-game/triplea/commit/0092443bcef243afbe82ea00cbc60648a719d00b", "message": "Refactor websocket listeners & messages, attach one at a time instead of in groups", "committedDate": "2020-04-05T00:51:41Z", "type": "commit"}, {"oid": "c3e0d8b162cdbad3b6bf3576642456dbedf23468", "url": "https://github.com/triplea-game/triplea/commit/c3e0d8b162cdbad3b6bf3576642456dbedf23468", "message": "Fix code climate method too long", "committedDate": "2020-04-05T00:51:41Z", "type": "commit"}, {"oid": "79a487c40807ab3f89056ae4387598d0ca7683a8", "url": "https://github.com/triplea-game/triplea/commit/79a487c40807ab3f89056ae4387598d0ca7683a8", "message": "Reduce method length", "committedDate": "2020-04-05T00:51:41Z", "type": "commit"}, {"oid": "4055ad60562f67a65e6563d77c616a0e2d7e8e67", "url": "https://github.com/triplea-game/triplea/commit/4055ad60562f67a65e6563d77c616a0e2d7e8e67", "message": "Fix method too long codeclimate", "committedDate": "2020-04-05T00:51:41Z", "type": "commit"}, {"oid": "a153ecf66b1c54efe79c2c5af14ce0195d223b79", "url": "https://github.com/triplea-game/triplea/commit/a153ecf66b1c54efe79c2c5af14ce0195d223b79", "message": "Extract common functionality of server side websockets to a single class", "committedDate": "2020-04-05T00:51:41Z", "type": "commit"}, {"oid": "85bc3c68375d15dca2c88cc50ba6b03f3f84cf24", "url": "https://github.com/triplea-game/triplea/commit/85bc3c68375d15dca2c88cc50ba6b03f3f84cf24", "message": "Partial revert of reduce method lenght", "committedDate": "2020-04-05T00:55:10Z", "type": "commit"}, {"oid": "85bc3c68375d15dca2c88cc50ba6b03f3f84cf24", "url": "https://github.com/triplea-game/triplea/commit/85bc3c68375d15dca2c88cc50ba6b03f3f84cf24", "message": "Partial revert of reduce method lenght", "committedDate": "2020-04-05T00:55:10Z", "type": "forcePushed"}, {"oid": "fb131cb7b3b200fcb71d140a5cb3a7b430566fc1", "url": "https://github.com/triplea-game/triplea/commit/fb131cb7b3b200fcb71d140a5cb3a7b430566fc1", "message": "Fix test, update method name", "committedDate": "2020-04-05T01:18:04Z", "type": "commit"}, {"oid": "4b3b9ee250f8594d51f7e50b657adac497f52255", "url": "https://github.com/triplea-game/triplea/commit/4b3b9ee250f8594d51f7e50b657adac497f52255", "message": "Add a test for ChatMessageListener", "committedDate": "2020-04-05T01:18:15Z", "type": "commit"}, {"oid": "6b2e563b6c555206a2611195334fa12fe31207e5", "url": "https://github.com/triplea-game/triplea/commit/6b2e563b6c555206a2611195334fa12fe31207e5", "message": "Removed unused logger annotations", "committedDate": "2020-04-05T02:30:39Z", "type": "commit"}, {"oid": "782958b9b00a43bc9833e8493dd5151ba4e13531", "url": "https://github.com/triplea-game/triplea/commit/782958b9b00a43bc9833e8493dd5151ba4e13531", "message": "Various test fixes", "committedDate": "2020-04-05T03:16:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5Mzg4NA==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r405593884", "bodyText": "The curly braces are unecessary here", "author": "RoiEXLab", "createdAt": "2020-04-08T15:03:18Z", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/mc/SetupPanelModel.java", "diffHunk": "@@ -64,7 +64,9 @@ public ServerModel showServer() {\n         this,\n         ui,\n         new HeadedLaunchAction(ui),\n-        error -> SwingComponents.showError(null, \"Connection problem\", error));\n+        error -> {\n+          SwingComponents.showError(null, \"Connection problem\", error);\n+        });", "originalCommit": "0092443bcef243afbe82ea00cbc60648a719d00b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5OTU5Mg==", "url": "https://github.com/triplea-game/triplea/pull/6096#discussion_r405599592", "bodyText": "This class could even implement UnaryOperator<URI>\nhttps://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/function/UnaryOperator.html", "author": "RoiEXLab", "createdAt": "2020-04-08T15:11:14Z", "path": "http-clients/src/main/java/org/triplea/http/client/web/socket/WebSocketProtocolSwapper.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package org.triplea.http.client.web.socket;\n+\n+import java.net.URI;\n+import java.util.function.Function;\n+\n+class WebSocketProtocolSwapper implements Function<URI, URI> {", "originalCommit": "0092443bcef243afbe82ea00cbc60648a719d00b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}