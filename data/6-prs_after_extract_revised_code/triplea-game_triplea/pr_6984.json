{"pr_number": 6984, "pr_title": "De dupe error uploads & Add Map Name to Error Uploads", "pr_createdAt": "2020-07-01T08:19:07Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6984", "timeline": [{"oid": "6af5f46092f247f9677cf879073f8e83c0b58919", "url": "https://github.com/triplea-game/triplea/commit/6af5f46092f247f9677cf879073f8e83c0b58919", "message": "De-Dupe Error Report Uploads\n\nPrevent redundant error message uploads by first checking\nwith the server if an error report already exists.\nIf the error report exists, then we will show a prompt\nto the user and give them a link to the existing error report.\n\nChange Summary:\n- Add columns in error report history table to track the\n  title of the error report, reporting game version,\n  and the issue link that was created.\n- Add APIs to error reporting DAO to get the link of\n  an existing error report by title and game version.\n- Add server API to check if an error report exists\n- Update client so that after clicking 'upload error report',\n  we first query the server if an error report exists.\n  If one exists, we show the link to the user, othewise\n  we show the user the upload form.\n\nNote: we use both title and game version for de-duplication.\n  This may lead to some duplication as version number\n  changes, but in case we do not fix a problem or if\n  the title matches but is actually different in a different\n  version we will allow the error report upload.", "committedDate": "2020-07-01T07:43:17Z", "type": "commit"}, {"oid": "8ed128a76e98949e7e5b0e438fb43d2da6a5bc0f", "url": "https://github.com/triplea-game/triplea/commit/8ed128a76e98949e7e5b0e438fb43d2da6a5bc0f", "message": "Add field to error report upload for map name", "committedDate": "2020-07-01T08:13:33Z", "type": "commit"}, {"oid": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "url": "https://github.com/triplea-game/triplea/commit/e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "message": "Do not print Exception in its own block (redundant)\n\nException is always at the head of the stack trace which\nwe already print in the issue body. This update removes\nthe redundant 'exception' block.", "committedDate": "2020-07-01T08:29:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzOTYwNA==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448639604", "bodyText": "Something worth considering:\nAs we all know the report body is truncated at X characters. This means that the trailing \\n```\\n\\n will be cut off if the stacktrace is too long.\nPerhaps we want to truncate the stracktrace so we don't ever hit the other limit", "author": "RoiEXLab", "createdAt": "2020-07-01T22:03:13Z", "path": "game-core/src/main/java/org/triplea/debug/error/reporting/StackTraceErrorReportFormatter.java", "diffHunk": "@@ -158,11 +170,6 @@ private static String throwableToString(final Throwable e) {\n     try (PrintWriter printWriter = new PrintWriter(outputStream, false, StandardCharsets.UTF_8)) {\n       e.printStackTrace(printWriter);\n     }\n-    return \"## Exception \\n\"\n-        + e.getClass().getName()\n-        + Optional.ofNullable(e.getMessage()).map(msg -> \": \" + msg).orElse(\"\")\n-        + \"\\n\\n## Stack Trace\\n```\\n\"\n-        + outputStream.toString(StandardCharsets.UTF_8)\n-        + \"\\n```\\n\\n\";\n+    return \"## Stack Trace\\n```\\n\" + outputStream.toString(StandardCharsets.UTF_8) + \"\\n```\\n\\n\";", "originalCommit": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2MDA1Mw==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448660053", "bodyText": "If you're missing the trailing ```, you'll still get the code format.\nIf we truncate only the stack trace, you'll need to calculate how much the rest of the content is taking and do a subtraction.\nIt then seems just easier to truncate the whole thing knowing that the stack trace is at the end.", "author": "DanVanAtta", "createdAt": "2020-07-01T23:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzOTYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5MjY1MA==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r449292650", "bodyText": "True, just wanted to through the idea out there", "author": "RoiEXLab", "createdAt": "2020-07-02T22:27:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODYzOTYwNA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NTc2Nw==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448645767", "bodyText": "I wonder if a check for equality is the right move here.\nIf we fix an issue, but people are still using an unpatched version, they shouldn't be able to create an issue IMO.\nThoughts?", "author": "RoiEXLab", "createdAt": "2020-07-01T22:20:57Z", "path": "http-server/src/main/java/org/triplea/db/dao/error/reporting/ErrorReportingDao.java", "diffHunk": "@@ -23,4 +26,12 @@\n    */\n   @SqlUpdate(\"delete from error_report_history where date_created < :purgeSinceDate\")\n   void purgeOld(@Bind(\"purgeSinceDate\") Instant purgeSinceDate);\n+\n+  @SqlQuery(\n+      \"select created_issue_link\"\n+          + \"  from error_report_history\"\n+          + \"  where report_title = :reportTitle \"\n+          + \"    and game_version = :gameVersion\")", "originalCommit": "e9da7eb10e0e26e6fad48bc0539a0be5d09545ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY1OTE4MA==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448659180", "bodyText": "That'll be a problem if you go back in time. So we can certainly get 'n' issues up until a problem is fixed. That is a risk. If we fail to fix an issue, it's more risky if we suppress it. False-positives are not great,  false-negatives are worse.\nDoes that make sense?", "author": "DanVanAtta", "createdAt": "2020-07-01T23:01:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NTc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY2MTcxNg==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r448661716", "bodyText": "@RoiEXLab how do you mean by an unpatched version?\nLet's say a problem is reported for 'v2', and someone is using a 'v3' and we only have a fix in 'v4', we can get a duplicate report fro both 'v2' and 'v3', is that the scenario you are considering?\nIMO it's okay:\n\nthe stack traces could change between v2 and v3 along with line numbers. Having that be different is slightly helpful.\nwe still go from 'n' reports being linear to the number of versions instead of number of occurrances.\nwe avoid a situation where we think we fixed the problem in 'v4', but perhaps we did not. If we de-dupe on title only, then a closed issue is theoretically definitive even if the problem is re-introduced or never fixed in the first place.\n\nIn part we're being clever about detecting when problems are fixed by just de-duping by title and version. If we suppressed all future version reports we'd need to know when a problem is fixed. As-is, a person looks at the bug report, sees it's closed and hopefully we'll comment which version has a fix.\nGoing forward pre-release hopefully will get back to being used for preview and testing and not early access like it was. In part the early access was due to map features and because map versioning is deficient when it comes to forward & backward compatibility. Removing the need for early access implies we've some work to improve how maps are handled.", "author": "DanVanAtta", "createdAt": "2020-07-01T23:10:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NTc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5MjQ4Nw==", "url": "https://github.com/triplea-game/triplea/pull/6984#discussion_r449292487", "bodyText": "is that the scenario you are considering\n\nYes, that's exactly what I meant", "author": "RoiEXLab", "createdAt": "2020-07-02T22:26:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY0NTc2Nw=="}], "type": "inlineReview", "revised_code": null}]}