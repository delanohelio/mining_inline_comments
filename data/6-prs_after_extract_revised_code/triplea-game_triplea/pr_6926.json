{"pr_number": 6926, "pr_title": "Compute maps folder location rather than storing as client setting", "pr_createdAt": "2020-06-29T16:34:43Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6926", "timeline": [{"oid": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "url": "https://github.com/triplea-game/triplea/commit/8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "message": "Compute maps folder location rather than storing as client setting\n\nThis update removes client setting storage of default maps folder\nand instead computes the location when it is not overriden.\nThe default maps folder location is not a value the user would configure\nand hence is not appropriate to be in client settings.", "committedDate": "2020-06-29T16:29:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjQwMg==", "url": "https://github.com/triplea-game/triplea/pull/6926#discussion_r447302402", "bodyText": "getRootFolder() is a little bit weird tbh.\nOn a clean system the triplea folder will never be inside \"documents\", only if you manually create this folder it will end up storing it there indefinitely.", "author": "RoiEXLab", "createdAt": "2020-06-29T22:47:34Z", "path": "game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java", "diffHunk": "@@ -105,25 +105,22 @@ public static File getUserRootFolder() {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    final File mapsFolder =\n-        getUserMapsFolder(ClientSetting.userMapsFolderPath, ClientSetting.mapFolderOverride)\n-            .toFile();\n-    if (!mapsFolder.exists()) {\n-      mapsFolder.mkdirs();\n-    }\n-    if (!mapsFolder.exists()) {\n-      log.severe(\"Error, downloaded maps folder does not exist: \" + mapsFolder.getAbsolutePath());\n-    }\n-    return mapsFolder;\n+    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);", "originalCommit": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "68accad84599b029a3df8d0dc03ec05d6f95720f", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java b/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\nindex 1b89c7171..78c62957f 100644\n--- a/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\n+++ b/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\n\n@@ -105,7 +105,7 @@ public final class ClientFileSystemHelper {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);\n+    return getUserMapsFolder(ClientFileSystemHelper::getUserRootFolder);\n   }\n \n   @VisibleForTesting\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMwMjU4MA==", "url": "https://github.com/triplea-game/triplea/pull/6926#discussion_r447302580", "bodyText": "Some day we can migrate all of the APIs to use java.nio.Path ^^", "author": "RoiEXLab", "createdAt": "2020-06-29T22:48:03Z", "path": "game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java", "diffHunk": "@@ -105,25 +105,22 @@ public static File getUserRootFolder() {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    final File mapsFolder =\n-        getUserMapsFolder(ClientSetting.userMapsFolderPath, ClientSetting.mapFolderOverride)\n-            .toFile();\n-    if (!mapsFolder.exists()) {\n-      mapsFolder.mkdirs();\n-    }\n-    if (!mapsFolder.exists()) {\n-      log.severe(\"Error, downloaded maps folder does not exist: \" + mapsFolder.getAbsolutePath());\n-    }\n-    return mapsFolder;\n+    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);\n   }\n \n   @VisibleForTesting\n-  static Path getUserMapsFolder(\n-      final GameSetting<Path> currentUserMapsFolderSetting,\n-      final GameSetting<Path> overrideUserMapsFolderSetting) {\n-    return overrideUserMapsFolderSetting.isSet()\n-        ? overrideUserMapsFolderSetting.getValueOrThrow()\n-        : currentUserMapsFolderSetting.getValueOrThrow();\n+  static File getUserMapsFolder(final Supplier<File> userHomeRootFolderSupplier) {\n+    final File mapsFolder =\n+        ClientSetting.mapFolderOverride\n+            .getValue()\n+            .map(Path::toFile)", "originalCommit": "8df934ed29d6d44d1a1dc54b38c29f3cbd5fa315", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "68accad84599b029a3df8d0dc03ec05d6f95720f", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java b/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\nindex 1b89c7171..78c62957f 100644\n--- a/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\n+++ b/game-core/src/main/java/games/strategy/engine/ClientFileSystemHelper.java\n\n@@ -105,7 +105,7 @@ public final class ClientFileSystemHelper {\n    *     installations. Users can override this location in settings.\n    */\n   public static File getUserMapsFolder() {\n-    return getUserMapsFolder(ClientFileSystemHelper::getRootFolder);\n+    return getUserMapsFolder(ClientFileSystemHelper::getUserRootFolder);\n   }\n \n   @VisibleForTesting\n"}}, {"oid": "68accad84599b029a3df8d0dc03ec05d6f95720f", "url": "https://github.com/triplea-game/triplea/commit/68accad84599b029a3df8d0dc03ec05d6f95720f", "message": "Fix, use correct 'getUserRoot' folder method", "committedDate": "2020-06-30T01:00:06Z", "type": "commit"}]}