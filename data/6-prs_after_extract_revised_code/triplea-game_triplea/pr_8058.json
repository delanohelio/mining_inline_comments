{"pr_number": 8058, "pr_title": "Fix, handle invalid default game URIs", "pr_createdAt": "2020-11-02T00:23:07Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8058", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5Mzc2NA==", "url": "https://github.com/triplea-game/triplea/pull/8058#discussion_r515693764", "bodyText": "@trevan  , could you remind me why we have the try/catch blocks in this method? It looks like they can be removed entirely. Is there an undocumented side-effect that we are relying on for this method to work properly?", "author": "DanVanAtta", "createdAt": "2020-11-02T00:23:49Z", "path": "game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorModel.java", "diffHunk": "@@ -226,7 +226,7 @@ public void loadDefaultGameSameThread() {\n   private static Path getDefaultGameRealPath(final URI defaultGame) {\n     try {", "originalCommit": "2b6f38a06ba57edbeb49acd56f83955f07f0c55a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5NjMxNQ==", "url": "https://github.com/triplea-game/triplea/pull/8058#discussion_r515696315", "bodyText": "If the path is a zip file, then the getFileSystem will initially throw FileSystemNotFoundException so you'll have to call newFileSystem to create it.  The second time, getFileSystem will not have any problem.  For non zip, getFileSystem doesn't throw anything.  This is documented at https://docs.oracle.com/javase/7/docs/api/java/nio/file/FileSystems.html#getFileSystem(java.net.URI).\nI don't know why it would throw null pointer.  Maybe that happens if defaultGame is a null uri?", "author": "trevan", "createdAt": "2020-11-02T00:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5Mzc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcwMjMzOA==", "url": "https://github.com/triplea-game/triplea/pull/8058#discussion_r515702338", "bodyText": "Could we call 'newFileSystem' first always and then call 'getFileSystem'?\nIt looks like if the URI is missing a scheme, then we'll get a NPE in file systems.", "author": "DanVanAtta", "createdAt": "2020-11-02T01:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5Mzc2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTcwNDkxMg==", "url": "https://github.com/triplea-game/triplea/pull/8058#discussion_r515704912", "bodyText": "I force pushed over this PR and drastically changed the solution, just catching a NPE is a bad fix.\nI think we probably could use some documentation to explain the needed side effects from the FileSystem calls, I was certainly confused by it and wondered why it was needed.\nFWIW, I think we've made good progress here, seems we have much more robust code here that doesn't break.", "author": "DanVanAtta", "createdAt": "2020-11-02T01:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY5Mzc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "c8fdb9673e067859b90a52573ffd56bdd978b9cc", "chunk": "diff --git a/game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorModel.java b/game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorModel.java\nindex 2e18dddd7..e99e9c9e0 100644\n--- a/game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorModel.java\n+++ b/game-core/src/main/java/games/strategy/engine/framework/startup/ui/panels/main/game/selector/GameSelectorModel.java\n\n@@ -226,7 +240,7 @@ public class GameSelectorModel extends Observable implements GameSelector {\n   private static Path getDefaultGameRealPath(final URI defaultGame) {\n     try {\n       FileSystems.getFileSystem(defaultGame);\n-    } catch (final NullPointerException | FileSystemNotFoundException exception) {\n+    } catch (final FileSystemNotFoundException notFoundException) {\n       try {\n         FileSystems.newFileSystem(defaultGame, Map.of());\n       } catch (final IOException ioException) {\n"}}, {"oid": "011dc0c338afe9287fe2bf44b9204ca4943a9375", "url": "https://github.com/triplea-game/triplea/commit/011dc0c338afe9287fe2bf44b9204ca4943a9375", "message": "Fix, catch NPE from getDefaultGameRealPath:224", "committedDate": "2020-11-02T00:25:10Z", "type": "forcePushed"}, {"oid": "c8fdb9673e067859b90a52573ffd56bdd978b9cc", "url": "https://github.com/triplea-game/triplea/commit/c8fdb9673e067859b90a52573ffd56bdd978b9cc", "message": "Fix, prevent NPE in FileSystems#getFileSystem when default game URI is missing a scheme\n\nBug report #8015 has a NPE in getFileSystem, this looks to happen if the default\ngame URI is missing a scheme. That can be something trivial like an empty\nvalue for the default game URI (empty but not null), or could be caused by\nother reasons.\n\nRegardless, instead of throwing an exception in such cases, we can fall back to resetting\nthe default game to a default value.", "committedDate": "2020-11-02T01:42:26Z", "type": "forcePushed"}, {"oid": "f3f24b0389586c1e826bb94883694b2820641183", "url": "https://github.com/triplea-game/triplea/commit/f3f24b0389586c1e826bb94883694b2820641183", "message": "Fix, prevent NPE in FileSystems#getFileSystem when default game URI is missing a scheme\n\nBug report #8015 has a NPE in getFileSystem, this looks to happen if the default\ngame URI is missing a scheme. That can be something trivial like an empty\nvalue for the default game URI (empty but not null), or could be caused by\nother reasons.\n\nRegardless, instead of throwing an exception in such cases, we can fall back to resetting\nthe default game to a default value.", "committedDate": "2020-11-02T01:46:43Z", "type": "forcePushed"}, {"oid": "6ae846d2393c4601fad8cd72675c4d7cd484732f", "url": "https://github.com/triplea-game/triplea/commit/6ae846d2393c4601fad8cd72675c4d7cd484732f", "message": "Fix, prevent NPE in FileSystems#getFileSystem when default game URI is missing a scheme\n\nBug report #8015 has a NPE in getFileSystem, this looks to happen if the default\ngame URI is missing a scheme. That can be something trivial like an empty\nvalue for the default game URI (empty but not null), or could be caused by\nother reasons.\n\nRegardless, instead of throwing an exception in such cases, we can fall back to resetting\nthe default game to a default value.", "committedDate": "2020-11-02T01:47:49Z", "type": "forcePushed"}, {"oid": "effba746836e7bcd05bdcc2b748048aa366b184a", "url": "https://github.com/triplea-game/triplea/commit/effba746836e7bcd05bdcc2b748048aa366b184a", "message": "Fix, prevent NPE in FileSystems#getFileSystem when default game URI is missing a scheme\n\nBug report #8015 has a NPE in getFileSystem, this looks to happen if the default\ngame URI is missing a scheme. That can be something trivial like an empty\nvalue for the default game URI (empty but not null), or could be caused by\nother reasons.\n\nRegardless, instead of throwing an exception in such cases, we can fall back to resetting\nthe default game to a default value.", "committedDate": "2020-11-02T02:28:23Z", "type": "commit"}, {"oid": "effba746836e7bcd05bdcc2b748048aa366b184a", "url": "https://github.com/triplea-game/triplea/commit/effba746836e7bcd05bdcc2b748048aa366b184a", "message": "Fix, prevent NPE in FileSystems#getFileSystem when default game URI is missing a scheme\n\nBug report #8015 has a NPE in getFileSystem, this looks to happen if the default\ngame URI is missing a scheme. That can be something trivial like an empty\nvalue for the default game URI (empty but not null), or could be caused by\nother reasons.\n\nRegardless, instead of throwing an exception in such cases, we can fall back to resetting\nthe default game to a default value.", "committedDate": "2020-11-02T02:28:23Z", "type": "forcePushed"}]}