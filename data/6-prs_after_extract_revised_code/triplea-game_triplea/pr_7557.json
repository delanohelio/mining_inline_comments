{"pr_number": 7557, "pr_title": "Migrate shallow parsing to Xml scanning", "pr_createdAt": "2020-09-06T02:38:22Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7557", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxMjUyMQ==", "url": "https://github.com/triplea-game/triplea/pull/7557#discussion_r484012521", "bodyText": "Method scanForAttributeValue has a Cognitive Complexity of 10 (exceeds 7 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-09-06T02:39:29Z", "path": "xml-reader/src/main/java/org/triplea/generic/xml/scanner/AttributeScanner.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package org.triplea.generic.xml.scanner;\n+\n+import java.util.Optional;\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamReader;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * Searches for a given XML tag and attribute name and returns the attribute value. Designed to run\n+ * quickly and only partially scan XML content.\n+ */\n+@UtilityClass\n+class AttributeScanner {\n+  Optional<String> scanForAttributeValue(", "originalCommit": "16f4d41e87f8edf140ffb46f92484fc5741ae554", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxMjUyMg==", "url": "https://github.com/triplea-game/triplea/pull/7557#discussion_r484012522", "bodyText": "Method scanForBodyText has a Cognitive Complexity of 17 (exceeds 7 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-09-06T02:39:29Z", "path": "xml-reader/src/main/java/org/triplea/generic/xml/scanner/BodyTextScanner.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package org.triplea.generic.xml.scanner;\n+\n+import java.util.Optional;\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamReader;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * Searches for body tag content in a XML file (originally built to read 'game-notes'). This\n+ * searches for a specific tag, with attribute key value pairs, then looks for a specific child tag\n+ * underneath that and returns the tag body content.\n+ */\n+@UtilityClass\n+class BodyTextScanner {\n+\n+  /*\n+   Implementation notes:\n+\n+   This works by keeping track of state of whether we have found the parent tag and the child tag.\n+   When we first see the parent tag with matching attribute name and value then we toggle\n+   'foundParent' to true. When we find the child tag we'll toggle \"foundChild\" to true and\n+   from there we'll buffer any body content that we find.\n+\n+   When we hit the end tag for the child we'll return the buffered content. If we hit\n+   an end tag and \"foundChild\" is false, then the parent tag did not contain the desired\n+   child tag and we flag \"foundParent\" to false and we keep searching for another parent\n+   tag that matches, and then we'll search for a child tag and so on until we find something\n+   or return empty if we never do find a match.\n+\n+  */\n+  Optional<String> scanForBodyText(", "originalCommit": "16f4d41e87f8edf140ffb46f92484fc5741ae554", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxMjUyMw==", "url": "https://github.com/triplea-game/triplea/pull/7557#discussion_r484012523", "bodyText": "Method scanForBodyText has 32 lines of code (exceeds 30 allowed). Consider refactoring.", "author": "codeclimate", "createdAt": "2020-09-06T02:39:30Z", "path": "xml-reader/src/main/java/org/triplea/generic/xml/scanner/BodyTextScanner.java", "diffHunk": "@@ -0,0 +1,83 @@\n+package org.triplea.generic.xml.scanner;\n+\n+import java.util.Optional;\n+import javax.xml.stream.XMLStreamException;\n+import javax.xml.stream.XMLStreamReader;\n+import lombok.experimental.UtilityClass;\n+\n+/**\n+ * Searches for body tag content in a XML file (originally built to read 'game-notes'). This\n+ * searches for a specific tag, with attribute key value pairs, then looks for a specific child tag\n+ * underneath that and returns the tag body content.\n+ */\n+@UtilityClass\n+class BodyTextScanner {\n+\n+  /*\n+   Implementation notes:\n+\n+   This works by keeping track of state of whether we have found the parent tag and the child tag.\n+   When we first see the parent tag with matching attribute name and value then we toggle\n+   'foundParent' to true. When we find the child tag we'll toggle \"foundChild\" to true and\n+   from there we'll buffer any body content that we find.\n+\n+   When we hit the end tag for the child we'll return the buffered content. If we hit\n+   an end tag and \"foundChild\" is false, then the parent tag did not contain the desired\n+   child tag and we flag \"foundParent\" to false and we keep searching for another parent\n+   tag that matches, and then we'll search for a child tag and so on until we find something\n+   or return empty if we never do find a match.\n+\n+  */\n+  Optional<String> scanForBodyText(", "originalCommit": "16f4d41e87f8edf140ffb46f92484fc5741ae554", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDAxMzA4Nw==", "url": "https://github.com/triplea-game/triplea/pull/7557#discussion_r484013087", "bodyText": "This class was moved and renamed so that it could be shared between the 'reader' and 'scanner' packages.", "author": "DanVanAtta", "createdAt": "2020-09-06T02:48:15Z", "path": "xml-reader/src/test/java/org/triplea/generic/xml/reader/XmlMapperTestUtils.java", "diffHunk": "@@ -1,11 +0,0 @@\n-package org.triplea.generic.xml.reader;\n-", "originalCommit": "16f4d41e87f8edf140ffb46f92484fc5741ae554", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "f191f714430aced1e3eab6fea8260ff90a2bd491", "url": "https://github.com/triplea-game/triplea/commit/f191f714430aced1e3eab6fea8260ff90a2bd491", "message": "Add an XML Scanner, reads partial data from an XML\n\nA utility that will replace \"shallow parsing\". Rather than having\na partially populated game data, we'll skip the game data assembly\nand just return parts of the XML directly. Any consumers of this\nwill only get data fields and will *not* get a partial game data\nobject.", "committedDate": "2020-09-06T02:51:43Z", "type": "commit"}, {"oid": "1d2b96aa19c84f68bbc974d91b7a40c2efa983dd", "url": "https://github.com/triplea-game/triplea/commit/1d2b96aa19c84f68bbc974d91b7a40c2efa983dd", "message": "Use XML-Scanner in game-core to do shallow-parsing\n\nThe shallow-parsing is so we can find the game name of a XML file\nwithout doing the full parse of XML and without assembling\na GameData object.\n\nThis update changes shallow parsing to use a new XML Scanner\n(in xml-reader) that is based on StAX.\n\nThe performance change for Bot startup speed is negligable, but\nfor listing game files (clicking 'select map' button), there\nis a pretty nice speedup and XML shallow parsing time is\nreduced from on average 80ms (per XML) to 0.5ms\n\nForward-looking, future work will incorporate the XML body-text\nscanner to read game-notes in a quick manner to speed up the listing\nof game notes in the 'select game' screen.", "committedDate": "2020-09-06T02:51:43Z", "type": "commit"}, {"oid": "1d2b96aa19c84f68bbc974d91b7a40c2efa983dd", "url": "https://github.com/triplea-game/triplea/commit/1d2b96aa19c84f68bbc974d91b7a40c2efa983dd", "message": "Use XML-Scanner in game-core to do shallow-parsing\n\nThe shallow-parsing is so we can find the game name of a XML file\nwithout doing the full parse of XML and without assembling\na GameData object.\n\nThis update changes shallow parsing to use a new XML Scanner\n(in xml-reader) that is based on StAX.\n\nThe performance change for Bot startup speed is negligable, but\nfor listing game files (clicking 'select map' button), there\nis a pretty nice speedup and XML shallow parsing time is\nreduced from on average 80ms (per XML) to 0.5ms\n\nForward-looking, future work will incorporate the XML body-text\nscanner to read game-notes in a quick manner to speed up the listing\nof game notes in the 'select game' screen.", "committedDate": "2020-09-06T02:51:43Z", "type": "forcePushed"}, {"oid": "0a04da16907da1f174bf4233b84ac0e901e9ab18", "url": "https://github.com/triplea-game/triplea/commit/0a04da16907da1f174bf4233b84ac0e901e9ab18", "message": "Remove unused game parser, parse-shallow methods", "committedDate": "2020-09-06T02:55:53Z", "type": "commit"}]}