{"pr_number": 1229, "pr_title": "Make cacheRecord immutable, insist on non-null AccountRecord", "pr_createdAt": "2020-11-13T00:55:14Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDcxMzg4NQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229#discussion_r524713885", "bodyText": "Nit: Variable naming here may be improvable", "author": "iambmelt", "createdAt": "2020-11-16T23:00:31Z", "path": "msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java", "diffHunk": "@@ -64,16 +64,18 @@ public AcquireTokenResult execute() {\n                 expiryDate);\n \n         // Create parameters for dummy authentication result\n-        final CacheRecord cacheRecord = new CacheRecord();\n-        cacheRecord.setAccount(new AccountRecord());\n-        cacheRecord.getAccount().setHomeAccountId(\"abcd\");\n-        cacheRecord.getAccount().setLocalAccountId(\"abcd\");\n+        final CacheRecordBuilder cacheRecord = new CacheRecord.builder();\n+        final AccountRecord accountRecord = new AccountRecord();\n+        cacheRecord.account(accountRecord);\n+        accountRecord.setHomeAccountId(\"abcd\");\n+        accountRecord.setLocalAccountId(\"abcd\");\n         final List<ICacheRecord> cacheRecordList = new ArrayList<>();\n-        cacheRecordList.add(cacheRecord);\n+        final ICacheRecord build = cacheRecord.build();", "originalCommit": "8aa480049dbc716724b147dec76962d11d5a06b5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cc4a319f59925460918465133ed5a9a71eba712f", "chunk": "diff --git a/msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java b/msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java\nindex 29d04ec1..4a11d83b 100644\n--- a/msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java\n+++ b/msal/src/test/java/com/microsoft/identity/client/e2e/shadows/ShadowDeviceCodeFlowCommandSuccessful.java\n\n@@ -64,18 +64,18 @@ public class ShadowDeviceCodeFlowCommandSuccessful {\n                 expiryDate);\n \n         // Create parameters for dummy authentication result\n-        final CacheRecordBuilder cacheRecord = new CacheRecord.builder();\n+        final CacheRecordBuilder recordBuilder = new CacheRecord.builder();\n         final AccountRecord accountRecord = new AccountRecord();\n-        cacheRecord.account(accountRecord);\n+        recordBuilder.account(accountRecord);\n         accountRecord.setHomeAccountId(\"abcd\");\n         accountRecord.setLocalAccountId(\"abcd\");\n         final List<ICacheRecord> cacheRecordList = new ArrayList<>();\n-        final ICacheRecord build = cacheRecord.build();\n-        cacheRecordList.add(build);\n+        final ICacheRecord cacheRecord = recordBuilder.build();\n+        cacheRecordList.add(cacheRecord);\n \n         // Create dummy authentication result\n         final ILocalAuthenticationResult localAuthenticationResult = new LocalAuthenticationResult(\n-                build,\n+                cacheRecord,\n                 cacheRecordList,\n                 SdkType.MSAL,\n                 false\n"}}, {"oid": "ba352fcce8497619b63a151849ff393866a15c1f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/ba352fcce8497619b63a151849ff393866a15c1f", "message": "Make cacheRecord immutable, insist on non-null AccountRecord", "committedDate": "2020-11-17T21:25:08Z", "type": "forcePushed"}, {"oid": "b48b4a8a2264da4b64cc9c42fb7d2cbcb49d91ae", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/b48b4a8a2264da4b64cc9c42fb7d2cbcb49d91ae", "message": "Make cacheRecord immutable, insist on non-null AccountRecord", "committedDate": "2020-11-30T20:30:26Z", "type": "commit"}, {"oid": "cc4a319f59925460918465133ed5a9a71eba712f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/cc4a319f59925460918465133ed5a9a71eba712f", "message": "Address naming feedback", "committedDate": "2020-11-30T20:30:26Z", "type": "commit"}, {"oid": "cc4a319f59925460918465133ed5a9a71eba712f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/cc4a319f59925460918465133ed5a9a71eba712f", "message": "Address naming feedback", "committedDate": "2020-11-30T20:30:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MjQzMQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1229#discussion_r532892431", "bodyText": "Checking this for null is now moot.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            final AccountRecord account = cacheRecord.getAccount();\n          \n          \n            \n                            if (account == null) {\n          \n          \n            \n                                // If the account is null, it can't be a home account.\n          \n          \n            \n                                continue;\n          \n          \n            \n                            }\n          \n          \n            \n                            final String acctHomeAccountId = account.getHomeAccountId();\n          \n          \n            \n                            final String acctLocalAccountId = account.getLocalAccountId();\n          \n          \n            \n                            final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\n          \n          \n            \n                            final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();", "author": "AdamBJohnsonx", "createdAt": "2020-11-30T20:45:52Z", "path": "msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java", "diffHunk": "@@ -79,8 +79,13 @@\n             final List<ICacheRecord> result = new ArrayList<>();\n \n             for (final ICacheRecord cacheRecord : records) {\n-                final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\n-                final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();\n+                final AccountRecord account = cacheRecord.getAccount();\n+                if (account == null) {\n+                    // If the account is null, it can't be a home account.\n+                    continue;\n+                }\n+                final String acctHomeAccountId = account.getHomeAccountId();\n+                final String acctLocalAccountId = account.getLocalAccountId();", "originalCommit": "cc4a319f59925460918465133ed5a9a71eba712f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8af23dc36b2978268f2d4be3f9e869a18bb26a86", "chunk": "diff --git a/msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java b/msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java\nindex da687173..f7127e64 100644\n--- a/msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java\n+++ b/msal/src/main/java/com/microsoft/identity/client/AccountAdapter.java\n\n@@ -79,13 +79,8 @@ class AccountAdapter {\n             final List<ICacheRecord> result = new ArrayList<>();\n \n             for (final ICacheRecord cacheRecord : records) {\n-                final AccountRecord account = cacheRecord.getAccount();\n-                if (account == null) {\n-                    // If the account is null, it can't be a home account.\n-                    continue;\n-                }\n-                final String acctHomeAccountId = account.getHomeAccountId();\n-                final String acctLocalAccountId = account.getLocalAccountId();\n+                final String acctHomeAccountId = cacheRecord.getAccount().getHomeAccountId();\n+                final String acctLocalAccountId = cacheRecord.getAccount().getLocalAccountId();\n \n                 if (acctHomeAccountId.contains(acctLocalAccountId)) {\n                     result.add(cacheRecord);\n"}}, {"oid": "8af23dc36b2978268f2d4be3f9e869a18bb26a86", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/8af23dc36b2978268f2d4be3f9e869a18bb26a86", "message": "Revert impossible null check.", "committedDate": "2020-11-30T20:46:13Z", "type": "commit"}, {"oid": "364a52047677473516f67c1ccf09b30c9a9d0a63", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/364a52047677473516f67c1ccf09b30c9a9d0a63", "message": "Address missing unit test files", "committedDate": "2020-12-01T01:10:21Z", "type": "commit"}, {"oid": "639801912b6cd3280e99f7d3856433135df29d82", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/639801912b6cd3280e99f7d3856433135df29d82", "message": "Update common submodule", "committedDate": "2020-12-01T01:10:21Z", "type": "commit"}]}