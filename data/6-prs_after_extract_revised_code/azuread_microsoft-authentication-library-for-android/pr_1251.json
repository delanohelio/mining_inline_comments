{"pr_number": 1251, "pr_title": "Retry auto mfa test cases + sleep before making two back to back AUTO MFA requests", "pr_createdAt": "2020-12-17T18:20:13Z", "pr_url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1251", "timeline": [{"oid": "c8f048a31c144860d56a9cfe943d9779abb7827f", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/c8f048a31c144860d56a9cfe943d9779abb7827f", "message": "Retry auto mfa test cases", "committedDate": "2020-12-17T18:18:41Z", "type": "commit"}, {"oid": "d5fcb9492fad0b68d236716d81b6855745c6a7ce", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/d5fcb9492fad0b68d236716d81b6855745c6a7ce", "message": "Add thread sleep before calling auto mfa second time", "committedDate": "2020-12-19T00:46:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NDAwOQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1251#discussion_r546164009", "bodyText": "ThreadUtils.sleepSafely()?", "author": "AdamBJohnsonx", "createdAt": "2020-12-19T00:48:38Z", "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java", "diffHunk": "@@ -103,6 +106,8 @@ public void handleUserInteraction() {\n         silentLatch.await(TokenRequestTimeout.SILENT);\n \n         // second interactive request\n+        // wait about a minute here to throttle usage of AUTO MFA account\n+        Thread.sleep(TimeUnit.MINUTES.toMillis(1));", "originalCommit": "d5fcb9492fad0b68d236716d81b6855745c6a7ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NTM1Ng==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1251#discussion_r546165356", "bodyText": "Addressed here: fd1a434", "author": "shahzaibj", "createdAt": "2020-12-19T00:56:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NDAwOQ=="}], "type": "inlineReview", "revised_code": {"commit": "fd1a43460545e3ca9127b24b0f85b96cfc8c9022", "chunk": "diff --git a/msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java b/msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java\nindex 52ec9f6b..655f8574 100644\n--- a/msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java\n+++ b/msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java\n\n@@ -107,7 +109,11 @@ public class TestCase99656 extends AbstractMsalUiTest {\n \n         // second interactive request\n         // wait about a minute here to throttle usage of AUTO MFA account\n-        Thread.sleep(TimeUnit.MINUTES.toMillis(1));\n+        ThreadUtils.sleepSafely(\n+                (int) TimeUnit.MINUTES.toMillis(1),\n+                TAG,\n+                \"Problem occurred while sleeping safely to throttle AUTO MFA requests.\"\n+        );\n \n         final TokenRequestLatch latch2 = new TokenRequestLatch(1);\n \n"}}, {"oid": "d514d73ac6efdc725d2117f2fb9f66bba9dc4862", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/d514d73ac6efdc725d2117f2fb9f66bba9dc4862", "message": "Reduce retry count to 1 for auto mfa test cases", "committedDate": "2020-12-19T00:49:09Z", "type": "commit"}, {"oid": "fd1a43460545e3ca9127b24b0f85b96cfc8c9022", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/fd1a43460545e3ca9127b24b0f85b96cfc8c9022", "message": "Address comment and use thread utils sleep safely while sleeping", "committedDate": "2020-12-19T00:53:45Z", "type": "commit"}, {"oid": "628dd4fa81be71fe9cd4d55b68032338b8d17da1", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/commit/628dd4fa81be71fe9cd4d55b68032338b8d17da1", "message": "Merge branch 'dev' into shahzaibj/retryAutoMfaTestCases", "committedDate": "2020-12-19T00:56:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NTkzNQ==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1251#discussion_r546165935", "bodyText": "I mean, there's nothing really safe about it, it just takes care of the boilerplate for you in terms of thread.sleep.", "author": "AdamBJohnsonx", "createdAt": "2020-12-19T00:59:47Z", "path": "msalautomationapp/src/androidTest/java/com/microsoft/identity/client/msal/automationapp/testpass/local/TestCase99656.java", "diffHunk": "@@ -103,6 +108,12 @@ public void handleUserInteraction() {\n         silentLatch.await(TokenRequestTimeout.SILENT);\n \n         // second interactive request\n+        // wait about a minute here to throttle usage of AUTO MFA account\n+        ThreadUtils.sleepSafely(\n+                (int) TimeUnit.MINUTES.toMillis(1),\n+                TAG,\n+                \"Problem occurred while sleeping safely to throttle AUTO MFA requests.\"", "originalCommit": "628dd4fa81be71fe9cd4d55b68032338b8d17da1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NjE2Nw==", "url": "https://github.com/AzureAD/microsoft-authentication-library-for-android/pull/1251#discussion_r546166167", "bodyText": "Yeah...I couldn't figure out a better message to log here :D", "author": "shahzaibj", "createdAt": "2020-12-19T01:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE2NTkzNQ=="}], "type": "inlineReview", "revised_code": null}]}