{"pr_number": 987, "pr_title": "Allow admins to pause/resume deposits", "pr_createdAt": "2020-05-11T15:33:00Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/987", "timeline": [{"oid": "037c883185967826f1d86914843753ec19cb0c14", "url": "https://github.com/UNC-Libraries/box-c/commit/037c883185967826f1d86914843753ec19cb0c14", "message": "Allow admins to pause/resume deposits", "committedDate": "2020-05-11T15:29:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1MjMzNQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/987#discussion_r423852335", "bodyText": "We should avoid hardcoding this.\nYou already have access to GlobalPermissionEvaluator in this controller, which has hasGlobalPermission and getGlobalUserRoles, either of which can probably be used for this purpose. With the latter, I think you could just check the result to see if it contains the Admin role, although it looks like you're already using globalPermissionEvaluator.hasGlobalPermission(principals, Permission.createAdminUnit) down below. Either is fine.", "author": "bbpennel", "createdAt": "2020-05-12T16:02:45Z", "path": "services/src/main/java/edu/unc/lib/dl/cdr/services/rest/DepositController.java", "diffHunk": "@@ -250,6 +250,9 @@ public void init() {\n         result.put(\"jobsURI\", \"/api/status/deposit/\" + depositUUID + \"/jobs\");\n         result.put(\"eventsURI\", \"/api/status/deposit/\" + depositUUID + \"/eventsXML\");\n \n+        AccessGroupSet groups = getAgentPrincipals().getPrincipals();\n+        result.put(\"isAdmin\", groups.contains(\"unc:app:lib:cdr:admin\"));", "originalCommit": "037c883185967826f1d86914843753ec19cb0c14", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ef2823118a3293ca4291832f3163e78e93d989dd", "chunk": "diff --git a/services/src/main/java/edu/unc/lib/dl/cdr/services/rest/DepositController.java b/services/src/main/java/edu/unc/lib/dl/cdr/services/rest/DepositController.java\nindex 6df24a751..14da0ac11 100644\n--- a/services/src/main/java/edu/unc/lib/dl/cdr/services/rest/DepositController.java\n+++ b/services/src/main/java/edu/unc/lib/dl/cdr/services/rest/DepositController.java\n\n@@ -250,8 +250,9 @@ public class DepositController {\n         result.put(\"jobsURI\", \"/api/status/deposit/\" + depositUUID + \"/jobs\");\n         result.put(\"eventsURI\", \"/api/status/deposit/\" + depositUUID + \"/eventsXML\");\n \n-        AccessGroupSet groups = getAgentPrincipals().getPrincipals();\n-        result.put(\"isAdmin\", groups.contains(\"unc:app:lib:cdr:admin\"));\n+        AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n+        result.put(\"isAdmin\", globalPermissionEvaluator.hasGlobalPermission(principals,\n+                Permission.createAdminUnit));\n \n         return result;\n     }\n"}}, {"oid": "ef2823118a3293ca4291832f3163e78e93d989dd", "url": "https://github.com/UNC-Libraries/box-c/commit/ef2823118a3293ca4291832f3163e78e93d989dd", "message": "Switch the way admin status is calculated.", "committedDate": "2020-05-12T17:33:58Z", "type": "commit"}]}