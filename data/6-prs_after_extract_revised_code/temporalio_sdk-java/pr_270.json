{"pr_number": 270, "pr_title": "Adding binary checksum to WorkflowClientOptions", "pr_createdAt": "2020-12-09T06:11:16Z", "pr_url": "https://github.com/temporalio/sdk-java/pull/270", "timeline": [{"oid": "ddfc8104db01fed416b2162f2013ed7163eabdc0", "url": "https://github.com/temporalio/sdk-java/commit/ddfc8104db01fed416b2162f2013ed7163eabdc0", "message": "* Adding binary checksum to workflow client options\n\n* Add binary checksum to respond task completed and state machines also\nadding default value", "committedDate": "2020-12-09T06:18:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0ODQ3OQ==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539348479", "bodyText": "Why not an empty string as it is now?", "author": "mfateev", "createdAt": "2020-12-09T14:24:54Z", "path": "temporal-sdk/src/main/java/io/temporal/client/WorkflowClientOptions.java", "diffHunk": "@@ -33,6 +33,7 @@\n \n   private static final WorkflowClientOptions DEFAULT_INSTANCE;\n   private static final String DEFAULT_NAMESPACE = \"default\";\n+  private static final String DEFAULT_BINARY_CHECKSUM = \"none\";", "originalCommit": "ddfc8104db01fed416b2162f2013ed7163eabdc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU4MzM3Mg==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539583372", "bodyText": "Having some value could potentially be useful in case when someone just added their own binary checksum and wants to roll back.\nI'm okay changing it to empty string if you prefer it.", "author": "vitarb", "createdAt": "2020-12-09T19:25:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0ODQ3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1NzI5OA==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539857298", "bodyText": "Done", "author": "vitarb", "createdAt": "2020-12-10T05:33:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0ODQ3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "2f4ef3d92106616ca033f88737425e57654a62f2", "chunk": "diff --git a/temporal-sdk/src/main/java/io/temporal/client/WorkflowClientOptions.java b/temporal-sdk/src/main/java/io/temporal/client/WorkflowClientOptions.java\nindex 5ea5e678..e33160d2 100644\n--- a/temporal-sdk/src/main/java/io/temporal/client/WorkflowClientOptions.java\n+++ b/temporal-sdk/src/main/java/io/temporal/client/WorkflowClientOptions.java\n\n@@ -33,7 +33,7 @@ public final class WorkflowClientOptions {\n \n   private static final WorkflowClientOptions DEFAULT_INSTANCE;\n   private static final String DEFAULT_NAMESPACE = \"default\";\n-  private static final String DEFAULT_BINARY_CHECKSUM = \"none\";\n+  private static final String DEFAULT_BINARY_CHECKSUM = \"\";\n \n   static {\n     DEFAULT_INSTANCE = newBuilder().build();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0OTM1MQ==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539349351", "bodyText": "I would make the default null and not call this method if it is not set.", "author": "mfateev", "createdAt": "2020-12-09T14:26:00Z", "path": "temporal-sdk/src/main/java/io/temporal/internal/replay/ReplayWorkflowTaskHandler.java", "diffHunk": "@@ -127,6 +128,7 @@ private Result failureToResult(PollWorkflowTaskQueueResponse workflowTask, Throw\n           RespondWorkflowTaskCompletedRequest.newBuilder()\n               .setTaskToken(workflowTask.getTaskToken())\n               .setIdentity(options.getIdentity())\n+              .setBinaryChecksum(options.getBinaryChecksum())", "originalCommit": "ddfc8104db01fed416b2162f2013ed7163eabdc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTU4MjQ0NQ==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539582445", "bodyText": "I did that initially, but didn't like the extra if statement and decided to add a default.\nShould we have an empty string default instead as you've suggested above?", "author": "vitarb", "createdAt": "2020-12-09T19:24:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0OTM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1NzIyMA==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539857220", "bodyText": "I've changed it to empty string by default, let me know if you think that's sufficient.", "author": "vitarb", "createdAt": "2020-12-10T05:33:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM0OTM1MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM1MDgxMg==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539350812", "bodyText": "Does test verify that it was indeed added to the history?", "author": "mfateev", "createdAt": "2020-12-09T14:27:46Z", "path": "temporal-sdk/src/test/java/io/temporal/worker/StickyWorkerTest.java", "diffHunk": "@@ -489,13 +490,18 @@ public void workflowsCanBeQueriedAfterEviction() throws Exception {\n     private TestWorkflowEnvironment testEnv;\n     private WorkerFactory factory;\n     private final String identity = UUID.randomUUID().toString();\n+    private final String binaryChecksum = UUID.randomUUID().toString();\n \n     public TestEnvironmentWrapper(WorkerFactoryOptions options) {\n       if (options == null) {\n         options = WorkerFactoryOptions.newBuilder().build();\n       }\n       WorkflowClientOptions clientOptions =\n-          WorkflowClientOptions.newBuilder().setNamespace(NAMESPACE).setIdentity(identity).build();\n+          WorkflowClientOptions.newBuilder()\n+              .setNamespace(NAMESPACE)\n+              .setIdentity(identity)\n+              .setBinaryChecksum(binaryChecksum)", "originalCommit": "ddfc8104db01fed416b2162f2013ed7163eabdc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTg1NzAzNw==", "url": "https://github.com/temporalio/sdk-java/pull/270#discussion_r539857037", "bodyText": "I've added a separate test for it in the WorkflowTest, this one just adds it because identity was there already.", "author": "vitarb", "createdAt": "2020-12-10T05:32:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM1MDgxMg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "7e1611581382629e9a09e44d46ba5a3ffdfd791e", "url": "https://github.com/temporalio/sdk-java/commit/7e1611581382629e9a09e44d46ba5a3ffdfd791e", "message": "* Adding binary checksum to workflow client options\n\n* Add binary checksum to respond task completed and state machines also\nadding default value", "committedDate": "2020-12-10T04:57:22Z", "type": "commit"}, {"oid": "2f4ef3d92106616ca033f88737425e57654a62f2", "url": "https://github.com/temporalio/sdk-java/commit/2f4ef3d92106616ca033f88737425e57654a62f2", "message": "Add a test for binary checksum and default to empty string", "committedDate": "2020-12-10T05:26:38Z", "type": "commit"}, {"oid": "2f4ef3d92106616ca033f88737425e57654a62f2", "url": "https://github.com/temporalio/sdk-java/commit/2f4ef3d92106616ca033f88737425e57654a62f2", "message": "Add a test for binary checksum and default to empty string", "committedDate": "2020-12-10T05:26:38Z", "type": "forcePushed"}, {"oid": "5be11bca1fc99905e0ed86fafff8ff7ff0cdece5", "url": "https://github.com/temporalio/sdk-java/commit/5be11bca1fc99905e0ed86fafff8ff7ff0cdece5", "message": "Merge branch 'master' into binary-checksum", "committedDate": "2020-12-10T19:32:45Z", "type": "commit"}, {"oid": "a9b6f278a12e878c2bacc9a016d913823992bdd1", "url": "https://github.com/temporalio/sdk-java/commit/a9b6f278a12e878c2bacc9a016d913823992bdd1", "message": "Merge branch 'master' into binary-checksum", "committedDate": "2020-12-10T20:24:01Z", "type": "commit"}]}