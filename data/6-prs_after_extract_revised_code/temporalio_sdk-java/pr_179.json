{"pr_number": 179, "pr_title": "Wired upsertSearchAttributes to the WorkflowStateMachines", "pr_createdAt": "2020-08-15T00:12:59Z", "pr_url": "https://github.com/temporalio/sdk-java/pull/179", "timeline": [{"oid": "c39a2559eba1658eb57037b51c45653e2431ea2f", "url": "https://github.com/temporalio/sdk-java/commit/c39a2559eba1658eb57037b51c45653e2431ea2f", "message": "Improved state machine code coverage", "committedDate": "2020-08-14T23:34:17Z", "type": "commit"}, {"oid": "dc7bfd9450f6363853692c82945132d5d67d8162", "url": "https://github.com/temporalio/sdk-java/commit/dc7bfd9450f6363853692c82945132d5d67d8162", "message": "Wired search attributes. Fixed input retention", "committedDate": "2020-08-14T23:57:13Z", "type": "commit"}, {"oid": "bc898db588e795fc7fc1fe00aea21366e2e55837", "url": "https://github.com/temporalio/sdk-java/commit/bc898db588e795fc7fc1fe00aea21366e2e55837", "message": "Fixed testUpsertSearchAttributes unit test", "committedDate": "2020-08-15T00:04:47Z", "type": "commit"}, {"oid": "59c7883847124e46a87e20d89b3545d15cd4f8bc", "url": "https://github.com/temporalio/sdk-java/commit/59c7883847124e46a87e20d89b3545d15cd4f8bc", "message": "retention of signal external fixed", "committedDate": "2020-08-15T00:10:23Z", "type": "commit"}, {"oid": "022ad879b91f5e3c5e4c81fe3d6f48419ffdbe74", "url": "https://github.com/temporalio/sdk-java/commit/022ad879b91f5e3c5e4c81fe3d6f48419ffdbe74", "message": "timer state machine diagram readded", "committedDate": "2020-08-15T00:11:20Z", "type": "commit"}, {"oid": "7461f0a134c0e78f5d38baee939b531ade1808f8", "url": "https://github.com/temporalio/sdk-java/commit/7461f0a134c0e78f5d38baee939b531ade1808f8", "message": "dead code removal", "committedDate": "2020-08-15T00:33:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxODQ5Nw==", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470918497", "bodyText": "curious what inspired you to make this change (whether it just occurred to you or you saw something interesting during local debugging / execution)", "author": "mastermanu", "createdAt": "2020-08-15T01:03:49Z", "path": "src/main/java/io/temporal/internal/statemachines/ActivityStateMachine.java", "diffHunk": "@@ -415,5 +404,6 @@ private void createRequestCancelActivityTaskCommand() {\n                 RequestCancelActivityTaskCommandAttributes.newBuilder()\n                     .setScheduledEventId(getInitialCommandEventId()))\n             .build());\n+    parameters = null; // avoid retaining large input for the duration of the activity", "originalCommit": "7461f0a134c0e78f5d38baee939b531ade1808f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxOTgyNw==", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470919827", "bodyText": "I was thinking about it in my spare time but was forgetting about it when getting to the computer :).", "author": "mfateev", "createdAt": "2020-08-15T01:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxODQ5Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxOTE5Mg==", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470919192", "bodyText": "[Nit] Fix error message to say MutableSideEffectStateMachine", "author": "mastermanu", "createdAt": "2020-08-15T01:09:30Z", "path": "src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java", "diffHunk": "@@ -34,15 +38,46 @@\n import io.temporal.api.history.v1.MarkerRecordedEventAttributes;\n import io.temporal.api.history.v1.TimerFiredEventAttributes;\n import io.temporal.common.converter.DataConverter;\n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Optional;\n+import org.junit.AfterClass;\n import org.junit.Test;\n \n public class MutableSideEffectStateMachineTest {\n \n   private final DataConverter converter = DataConverter.getDefaultInstance();\n   private WorkflowStateMachines stateMachines;\n \n+  private static final List<\n+          StateMachine<\n+              MutableSideEffectStateMachine.State,\n+              MutableSideEffectStateMachine.ExplicitEvent,\n+              MutableSideEffectStateMachine.InvocationStateMachine>>\n+      stateMachineList = new ArrayList<>();\n+\n+  private WorkflowStateMachines newStateMachines(TestEntityManagerListenerBase listener) {\n+    return new WorkflowStateMachines(\n+        listener, (stateMachine -> stateMachineList.add(stateMachine)));\n+  }\n+\n+  @AfterClass\n+  public static void generateCoverage() {\n+    List<Transition> missed =\n+        MutableSideEffectStateMachine.STATE_MACHINE_DEFINITION.getUnvisitedTransitions(\n+            stateMachineList);\n+    if (!missed.isEmpty()) {\n+      CommandsGeneratePlantUMLStateDiagrams.writeToFile(\n+          \"test\",\n+          MutableSideEffectStateMachine.class,\n+          MutableSideEffectStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n+              stateMachineList));\n+      fail(\n+          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"", "originalCommit": "7461f0a134c0e78f5d38baee939b531ade1808f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "chunk": "diff --git a/src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java b/src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java\nindex ccc59249..cf35acd6 100644\n--- a/src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java\n+++ b/src/test/java/io/temporal/internal/statemachines/MutableSideEffectStateMachineTest.java\n\n@@ -73,7 +73,7 @@ public class MutableSideEffectStateMachineTest {\n           MutableSideEffectStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n               stateMachineList));\n       fail(\n-          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"\n+          \"MutableSideEffectStateMachine is missing test coverage for the following transitions:\\n\"\n               + missed);\n     }\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxOTI3OA==", "url": "https://github.com/temporalio/sdk-java/pull/179#discussion_r470919278", "bodyText": "[Nit] fix error message to say TimerStateMachine", "author": "mastermanu", "createdAt": "2020-08-15T01:10:09Z", "path": "src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java", "diffHunk": "@@ -34,15 +35,42 @@\n import io.temporal.internal.common.ProtobufTimeUtils;\n import io.temporal.workflow.Functions;\n import java.time.Duration;\n+import java.util.ArrayList;\n import java.util.List;\n import java.util.Optional;\n+import org.junit.AfterClass;\n import org.junit.Test;\n \n public class TimerStateMachineTest {\n \n   private final DataConverter converter = DataConverter.getDefaultInstance();\n   private WorkflowStateMachines stateMachines;\n \n+  private static final List<\n+          StateMachine<TimerStateMachine.State, TimerStateMachine.ExplicitEvent, TimerStateMachine>>\n+      stateMachineList = new ArrayList<>();\n+\n+  private WorkflowStateMachines newStateMachines(TestEntityManagerListenerBase listener) {\n+    return new WorkflowStateMachines(\n+        listener, (stateMachine -> stateMachineList.add(stateMachine)));\n+  }\n+\n+  @AfterClass\n+  public static void generateCoverage() {\n+    List<Transition> missed =\n+        TimerStateMachine.STATE_MACHINE_DEFINITION.getUnvisitedTransitions(stateMachineList);\n+    if (!missed.isEmpty()) {\n+      CommandsGeneratePlantUMLStateDiagrams.writeToFile(\n+          \"test\",\n+          TimerStateMachine.class,\n+          TimerStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n+              stateMachineList));\n+      fail(\n+          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"", "originalCommit": "7461f0a134c0e78f5d38baee939b531ade1808f8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "chunk": "diff --git a/src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java b/src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java\nindex 7ddcf6f7..5513debf 100644\n--- a/src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java\n+++ b/src/test/java/io/temporal/internal/statemachines/TimerStateMachineTest.java\n\n@@ -65,9 +65,7 @@ public class TimerStateMachineTest {\n           TimerStateMachine.class,\n           TimerStateMachine.STATE_MACHINE_DEFINITION.asPlantUMLStateDiagramCoverage(\n               stateMachineList));\n-      fail(\n-          \"SideEffectStateMachine is missing test coverage for the following transitions:\\n\"\n-              + missed);\n+      fail(\"isEmpty is missing test coverage for the following transitions:\\n\" + missed);\n     }\n   }\n \n"}}, {"oid": "7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "url": "https://github.com/temporalio/sdk-java/commit/7b5abbc733f8bf9ebc9a1321c6f529f9f6b9a469", "message": "PR comments", "committedDate": "2020-08-15T01:16:21Z", "type": "commit"}]}