{"pr_number": 1723, "pr_title": "DDB Enhanced Client adds bean annotations for attribute converter pro\u2026", "pr_createdAt": "2020-03-18T17:13:54Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1723", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyNzA0Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394527042", "bodyText": "This example doesn't really make any sense because we're using the plural form with the 'temporary' singular implementation, maybe add a TODO? I also don't see the need to use an inner class here in this isolated example?", "author": "bmaizels", "createdAt": "2020-03-18T17:39:56Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java", "diffHunk": "@@ -20,15 +20,27 @@\n import java.lang.annotation.RetentionPolicy;\n import java.lang.annotation.Target;\n import software.amazon.awssdk.annotations.SdkPublicApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n \n /**\n  * Class level annotation that identifies this class as being a DynamoDb mappable entity. Any class used to initialize\n- * a {@link BeanTableSchema} must have this\n- * annotation. If a class is used as a document within another DynamoDbBean it will also require this annotation.\n+ * a {@link BeanTableSchema} must have this annotation. If a class is used as a document within another DynamoDbBean,\n+ * it will also require this annotation.\n+ * <p>\n+ * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n+ * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n+ * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n+ * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n+ * that the defaults do not cover. Define the AttributeConverterProvider like this:\n+ * {@code\n+ * @literal @DynamoDbBean(converterProviders = ConverterBean.CustomAttributeConverterProvider.class)", "originalCommit": "57c6e284ecec013ee1b0bc7d54e9280c2c52a4ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NzM4MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394547381", "bodyText": "I will remove it completely then since we're anyway going to update it soon", "author": "cenedhryn", "createdAt": "2020-03-18T18:13:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyNzA0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "18fab281c16d6015bf3b490578267c7f330381f6", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\nindex 977df0df7e..a122c09579 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n\n@@ -33,10 +33,7 @@ import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n  * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n  * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n  * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n- * that the defaults do not cover. Define the AttributeConverterProvider like this:\n- * {@code\n- * @literal @DynamoDbBean(converterProviders = ConverterBean.CustomAttributeConverterProvider.class)\n- * }\n+ * that the defaults do not cover.\n  */\n @Target({ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyNzU4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394527583", "bodyText": "I think saying 'The converter is optional' is misleading, I'd rather say 'This annotation is optional'", "author": "bmaizels", "createdAt": "2020-03-18T17:40:46Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.mapper.annotations;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import software.amazon.awssdk.annotations.SdkPublicApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n+\n+/**\n+ * Associates a custom {@link AttributeConverter} with this attribute. The converter is optional and takes\n+ * precedence over any converter for this type provided by the table schema {@link AttributeConverterProvider}\n+ * if it exists. Use custom AttributeConverterProvider when you have specific needs for type conversion\n+ * that the defaults do not cover.", "originalCommit": "57c6e284ecec013ee1b0bc7d54e9280c2c52a4ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0NzgzMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394547833", "bodyText": "ok", "author": "cenedhryn", "createdAt": "2020-03-18T18:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyNzU4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "18fab281c16d6015bf3b490578267c7f330381f6", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\nindex e06f0ce639..8c4d15e739 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\n\n@@ -24,7 +24,7 @@ import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n \n /**\n- * Associates a custom {@link AttributeConverter} with this attribute. The converter is optional and takes\n+ * Associates a custom {@link AttributeConverter} with this attribute. This annotation is optional and takes\n  * precedence over any converter for this type provided by the table schema {@link AttributeConverterProvider}\n  * if it exists. Use custom AttributeConverterProvider when you have specific needs for type conversion\n  * that the defaults do not cover.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyODAwMA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394528000", "bodyText": "Maybe add an example showing both the annotation and the attribute declaration?", "author": "bmaizels", "createdAt": "2020-03-18T17:41:27Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.mapper.annotations;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+import software.amazon.awssdk.annotations.SdkPublicApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n+\n+/**\n+ * Associates a custom {@link AttributeConverter} with this attribute. The converter is optional and takes\n+ * precedence over any converter for this type provided by the table schema {@link AttributeConverterProvider}\n+ * if it exists. Use custom AttributeConverterProvider when you have specific needs for type conversion\n+ * that the defaults do not cover.\n+ */", "originalCommit": "57c6e284ecec013ee1b0bc7d54e9280c2c52a4ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0ODg3Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394548873", "bodyText": "Yes. Do you, btw, think we should add a section in the README with more advanced bean features?", "author": "cenedhryn", "createdAt": "2020-03-18T18:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyODAwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU1MzE0NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394553144", "bodyText": "Yeah I think that's a great idea. We should have at least one example of using a converter provider and also an example of an attribute converter override.", "author": "bmaizels", "createdAt": "2020-03-18T18:23:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyODAwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTEzMTYyNw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r395131627", "bodyText": "For simplicity's sake I'm splitting the documentation off into a separate task that I'll take up immediately, it's added to the sprint.", "author": "cenedhryn", "createdAt": "2020-03-19T15:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUyODAwMA=="}], "type": "inlineReview", "revised_code": {"commit": "18fab281c16d6015bf3b490578267c7f330381f6", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\nindex e06f0ce639..8c4d15e739 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbConvertedBy.java\n\n@@ -24,7 +24,7 @@ import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n \n /**\n- * Associates a custom {@link AttributeConverter} with this attribute. The converter is optional and takes\n+ * Associates a custom {@link AttributeConverter} with this attribute. This annotation is optional and takes\n  * precedence over any converter for this type provided by the table schema {@link AttributeConverterProvider}\n  * if it exists. Use custom AttributeConverterProvider when you have specific needs for type conversion\n  * that the defaults do not cover.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MzgzMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394543833", "bodyText": "I can't find a test associated with this, also I think the CustomAttributeConverter should have a private constructor (so it can't be instantiated by the test), and we should check for exception. You have a good test for this with the provider.", "author": "bmaizels", "createdAt": "2020-03-18T18:07:14Z", "path": "services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/enhanced/dynamodb/mapper/testbeans/AttributeConverterNoConstructorBean.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.mapper.testbeans;\n+\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeValueType;\n+import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;\n+import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbBean;\n+import software.amazon.awssdk.enhanced.dynamodb.mapper.annotations.DynamoDbConvertedBy;\n+import software.amazon.awssdk.services.dynamodb.model.AttributeValue;\n+\n+@DynamoDbBean\n+public class AttributeConverterNoConstructorBean extends AbstractBean {", "originalCommit": "57c6e284ecec013ee1b0bc7d54e9280c2c52a4ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU1MTgyMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1723#discussion_r394551822", "bodyText": "I had missed referring to that bean in the (last) test of the BeanTableSchema, thanks for spotting.", "author": "cenedhryn", "createdAt": "2020-03-18T18:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU0MzgzMw=="}], "type": "inlineReview", "revised_code": {"commit": "18fab281c16d6015bf3b490578267c7f330381f6", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/enhanced/dynamodb/mapper/testbeans/AttributeConverterNoConstructorBean.java b/services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/enhanced/dynamodb/mapper/testbeans/AttributeConverterNoConstructorBean.java\nindex 58f393e7c8..5881fbfaf3 100644\n--- a/services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/enhanced/dynamodb/mapper/testbeans/AttributeConverterNoConstructorBean.java\n+++ b/services-custom/dynamodb-enhanced/src/test/java/software/amazon/awssdk/enhanced/dynamodb/mapper/testbeans/AttributeConverterNoConstructorBean.java\n\n@@ -37,6 +37,9 @@ public class AttributeConverterNoConstructorBean extends AbstractBean {\n \n     public static class CustomAttributeConverter implements AttributeConverter {\n \n+        private CustomAttributeConverter() {\n+        }\n+\n         @Override\n         public AttributeValue transformFrom(Object input) {\n             return null;\n"}}, {"oid": "18fab281c16d6015bf3b490578267c7f330381f6", "url": "https://github.com/aws/aws-sdk-java-v2/commit/18fab281c16d6015bf3b490578267c7f330381f6", "message": "DDB Enhanced Client adds bean annotations for attribute converter providers and attribute converters", "committedDate": "2020-03-19T22:32:03Z", "type": "commit"}, {"oid": "18fab281c16d6015bf3b490578267c7f330381f6", "url": "https://github.com/aws/aws-sdk-java-v2/commit/18fab281c16d6015bf3b490578267c7f330381f6", "message": "DDB Enhanced Client adds bean annotations for attribute converter providers and attribute converters", "committedDate": "2020-03-19T22:32:03Z", "type": "forcePushed"}]}