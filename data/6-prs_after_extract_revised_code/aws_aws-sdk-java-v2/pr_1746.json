{"pr_number": 1746, "pr_title": "DDB Enhanced adding ChainConverterProvider", "pr_createdAt": "2020-03-30T17:46:38Z", "pr_url": "https://github.com/aws/aws-sdk-java-v2/pull/1746", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1ODkxMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401058913", "bodyText": "I think an [immutable] List would be the most appropriate collection to return here.", "author": "bmaizels", "createdAt": "2020-03-31T16:42:22Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n+\n+import java.util.ArrayDeque;\n+import java.util.Arrays;\n+import java.util.Deque;\n+import java.util.List;\n+import java.util.Queue;\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n+import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;\n+\n+/**\n+ * A {@link AttributeConverterProvider} that allows multiple providers to be chained in a specified order\n+ * to act as a single composite provider. When searching for an attribute converter for a type,\n+ * the providers will be called in forward/ascending order, attempting to find a converter from the\n+ * first provider, then the second, and so on, until a match is found or the operation fails.\n+ */\n+@SdkInternalApi\n+public final class ChainConverterProvider implements AttributeConverterProvider {\n+    private final Deque<AttributeConverterProvider> providerChain;\n+\n+    private ChainConverterProvider(List<AttributeConverterProvider> providers) {\n+        this.providerChain = new ArrayDeque<>(providers);\n+    }\n+\n+    /**\n+     * Construct a new instance of {@link ChainConverterProvider}.\n+     * @param providers A list of {@link AttributeConverterProvider} to chain together.\n+     * @return A constructed {@link ChainConverterProvider} object.\n+     */\n+    public static ChainConverterProvider create(AttributeConverterProvider... providers) {\n+        return new ChainConverterProvider(Arrays.asList(providers));\n+    }\n+\n+    /**\n+     * Construct a new instance of {@link ChainConverterProvider}.\n+     * @param providers A list of {@link AttributeConverterProvider} to chain together.\n+     * @return A constructed {@link ChainConverterProvider} object.\n+     */\n+    public static ChainConverterProvider create(List<AttributeConverterProvider> providers) {\n+        return new ChainConverterProvider(providers);\n+    }\n+\n+    public Queue<AttributeConverterProvider> chainedProviders() {", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwNDg3OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401104878", "bodyText": "I might have gone overboard with utilizing the same patterns as for the extension chains :-)", "author": "cenedhryn", "createdAt": "2020-03-31T17:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1ODkxMw=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\nindex 0709f52187..a455051adb 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n\n@@ -15,11 +15,10 @@\n \n package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n \n-import java.util.ArrayDeque;\n+import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.Deque;\n+import java.util.Collections;\n import java.util.List;\n-import java.util.Queue;\n import software.amazon.awssdk.annotations.SdkInternalApi;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA1OTg4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401059883", "bodyText": "nit: linebreak before second dot [.]", "author": "bmaizels", "createdAt": "2020-03-31T16:43:50Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n+\n+import java.util.ArrayDeque;\n+import java.util.Arrays;\n+import java.util.Deque;\n+import java.util.List;\n+import java.util.Queue;\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n+import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;\n+\n+/**\n+ * A {@link AttributeConverterProvider} that allows multiple providers to be chained in a specified order\n+ * to act as a single composite provider. When searching for an attribute converter for a type,\n+ * the providers will be called in forward/ascending order, attempting to find a converter from the\n+ * first provider, then the second, and so on, until a match is found or the operation fails.\n+ */\n+@SdkInternalApi\n+public final class ChainConverterProvider implements AttributeConverterProvider {\n+    private final Deque<AttributeConverterProvider> providerChain;\n+\n+    private ChainConverterProvider(List<AttributeConverterProvider> providers) {\n+        this.providerChain = new ArrayDeque<>(providers);\n+    }\n+\n+    /**\n+     * Construct a new instance of {@link ChainConverterProvider}.\n+     * @param providers A list of {@link AttributeConverterProvider} to chain together.\n+     * @return A constructed {@link ChainConverterProvider} object.\n+     */\n+    public static ChainConverterProvider create(AttributeConverterProvider... providers) {\n+        return new ChainConverterProvider(Arrays.asList(providers));\n+    }\n+\n+    /**\n+     * Construct a new instance of {@link ChainConverterProvider}.\n+     * @param providers A list of {@link AttributeConverterProvider} to chain together.\n+     * @return A constructed {@link ChainConverterProvider} object.\n+     */\n+    public static ChainConverterProvider create(List<AttributeConverterProvider> providers) {\n+        return new ChainConverterProvider(providers);\n+    }\n+\n+    public Queue<AttributeConverterProvider> chainedProviders() {\n+        return this.providerChain;\n+    }\n+\n+    @Override\n+    public <T> AttributeConverter<T> converterFor(EnhancedType<T> enhancedType) {\n+        return this.providerChain.stream()\n+                                 .filter(provider -> provider.converterFor(enhancedType) != null)\n+                                 .map(p -> p.converterFor(enhancedType))\n+                                 .findFirst().orElse(null);", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\nindex 0709f52187..a455051adb 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n\n@@ -15,11 +15,10 @@\n \n package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n \n-import java.util.ArrayDeque;\n+import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.Deque;\n+import java.util.Collections;\n import java.util.List;\n-import java.util.Queue;\n import software.amazon.awssdk.annotations.SdkInternalApi;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MDU1Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401060556", "bodyText": "I'd have chosen ArrayList here as it's simpler and perfectly well suited to the only way we use it which is to iterate through its items in order.", "author": "bmaizels", "createdAt": "2020-03-31T16:44:50Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n+\n+import java.util.ArrayDeque;\n+import java.util.Arrays;\n+import java.util.Deque;\n+import java.util.List;\n+import java.util.Queue;\n+import software.amazon.awssdk.annotations.SdkInternalApi;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n+import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n+import software.amazon.awssdk.enhanced.dynamodb.EnhancedType;\n+\n+/**\n+ * A {@link AttributeConverterProvider} that allows multiple providers to be chained in a specified order\n+ * to act as a single composite provider. When searching for an attribute converter for a type,\n+ * the providers will be called in forward/ascending order, attempting to find a converter from the\n+ * first provider, then the second, and so on, until a match is found or the operation fails.\n+ */\n+@SdkInternalApi\n+public final class ChainConverterProvider implements AttributeConverterProvider {\n+    private final Deque<AttributeConverterProvider> providerChain;", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\nindex 0709f52187..a455051adb 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/converter/ChainConverterProvider.java\n\n@@ -15,11 +15,10 @@\n \n package software.amazon.awssdk.enhanced.dynamodb.internal.converter;\n \n-import java.util.ArrayDeque;\n+import java.util.ArrayList;\n import java.util.Arrays;\n-import java.util.Deque;\n+import java.util.Collections;\n import java.util.List;\n-import java.util.Queue;\n import software.amazon.awssdk.annotations.SdkInternalApi;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverter;\n import software.amazon.awssdk.enhanced.dynamodb.AttributeConverterProvider;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzA4Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401063083", "bodyText": "The name of this method confuses me a bit. When I read it, I think that it's going to return the annotation object itself. Maybe call it 'createConverterProvidersFromAnnotation' ? or something like that.", "author": "bmaizels", "createdAt": "2020-03-31T16:48:39Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/BeanTableSchema.java", "diffHunk": "@@ -222,12 +224,23 @@ public TableMetadata tableMetadata() {\n         return builder.build();\n     }\n \n-    private static Optional<AttributeConverterProvider> converterProviderAnnotation(DynamoDbBean dynamoDbBean) {\n-        Class<?>[] converterClasses = dynamoDbBean.converterProviders();\n-        //TODO: temporary solution to pick one AttributeConverterProvider.\n-        return converterClasses.length > 0 ?\n-               Optional.of((AttributeConverterProvider) newObjectSupplierForClass(converterClasses[0]).get()) :\n-               Optional.empty();\n+    private static List<AttributeConverterProvider> converterProviderAnnotation(DynamoDbBean dynamoDbBean) {", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwNjgzMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401106833", "bodyText": "I chose the name because of the prior art of naming similar methods in the same class, called from that particular method. I am somewhat on the same page as you, but then I'd rename all of the methods.", "author": "cenedhryn", "createdAt": "2020-03-31T17:58:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyOTc1Mg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401129752", "bodyText": "Yes feel free to rename anything that doesn't make sense, I was just looking at your changes.", "author": "bmaizels", "createdAt": "2020-03-31T18:36:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzA4Mw=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/BeanTableSchema.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/BeanTableSchema.java\nindex 603d21708c..4e1ca9c7d1 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/BeanTableSchema.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/BeanTableSchema.java\n\n@@ -224,60 +223,79 @@ public final class BeanTableSchema<T> implements TableSchema<T> {\n         return builder.build();\n     }\n \n-    private static List<AttributeConverterProvider> converterProviderAnnotation(DynamoDbBean dynamoDbBean) {\n+    private static List<AttributeConverterProvider> createConverterProvidersFromAnnotation(DynamoDbBean dynamoDbBean) {\n         Class<? extends AttributeConverterProvider>[] providerClasses = dynamoDbBean.converterProviders();\n \n-        if (shouldNotOverrideConverterProviders(providerClasses)) {\n-            return null;\n-        }\n-\n         return Arrays.stream(providerClasses)\n                 .map(c -> (AttributeConverterProvider) newObjectSupplierForClass(c).get())\n                 .collect(Collectors.toList());\n     }\n \n-    private static boolean shouldNotOverrideConverterProviders(\n-            Class<? extends AttributeConverterProvider>[] providerClasses) {\n-        Class<? extends AttributeConverterProvider> noAttributeConverterProviderOverrideClass =\n-                DynamoDbBean.NoAttributeConverterProviderOverride.class;\n-        return providerClasses.length == 1 && providerClasses[0].equals(noAttributeConverterProviderOverrideClass);\n-    }\n-\n-    @SuppressWarnings(\"unchecked\")\n     private static <T> StaticAttribute.Builder<T, ?> staticAttributeBuilder(PropertyDescriptor propertyDescriptor,\n                                                                             Class<T> beanClass) {\n \n         Type propertyType = propertyDescriptor.getReadMethod().getGenericReturnType();\n-        EnhancedType<?> propertyTypeToken = null;\n+        EnhancedType<?> propertyTypeToken = convertTypeToEnhancedType(propertyType);\n+        return StaticAttribute.builder(beanClass, propertyTypeToken)\n+                              .name(attributeNameForProperty(propertyDescriptor))\n+                              .getter(getterForProperty(propertyDescriptor, beanClass))\n+                              .setter(setterForProperty(propertyDescriptor, beanClass));\n+    }\n \n-        if (propertyType instanceof Class) {\n-            Class<?> clazz = (Class<?>) propertyType;\n-            if (clazz.getAnnotation(DynamoDbBean.class) != null) {\n-                propertyTypeToken = EnhancedType.documentOf((Class<Object>) clazz,\n-                                                         (TableSchema<Object>) createStaticTableSchema(clazz));\n+    /**\n+     * Converts a {@link Type} to an {@link EnhancedType}. Usually {@link EnhancedType#of} is capable of doing this all\n+     * by itself, but for the BeanTableSchema we want to detect if a parameterized class is being passed without a\n+     * converter that is actually a {@link DynamoDbBean} in which case we want to capture its schema and add it to the\n+     * EnhancedType. Unfortunately this means we have to duplicate some of the recursive Type parsing that\n+     * EnhancedClient otherwise does all by itself.\n+     */\n+    @SuppressWarnings(\"unchecked\")\n+    private static EnhancedType<?> convertTypeToEnhancedType(Type type) {\n+        Class<?> clazz = null;\n+\n+        if (type instanceof ParameterizedType) {\n+            ParameterizedType parameterizedType = (ParameterizedType) type;\n+            Type rawType = parameterizedType.getRawType();\n+\n+            if (List.class.equals(rawType)) {\n+                return EnhancedType.listOf(convertTypeToEnhancedType(parameterizedType.getActualTypeArguments()[0]));\n+            }\n+\n+            if (Map.class.equals(rawType)) {\n+                return EnhancedType.mapOf(EnhancedType.of(parameterizedType.getActualTypeArguments()[0]),\n+                                          convertTypeToEnhancedType(parameterizedType.getActualTypeArguments()[1]));\n+            }\n+\n+            if (rawType instanceof Class) {\n+                clazz = (Class<?>) rawType;\n             }\n+        } else if (type instanceof Class) {\n+            clazz = (Class<?>) type;\n         }\n \n-        if (propertyTypeToken == null) {\n-            propertyTypeToken = EnhancedType.of(propertyDescriptor.getReadMethod().getGenericReturnType());\n+        if (clazz != null) {\n+            if (clazz.getAnnotation(DynamoDbBean.class) != null) {\n+                return EnhancedType.documentOf((Class<Object>) clazz,\n+                                               (TableSchema<Object>) createStaticTableSchema(clazz));\n+            }\n         }\n \n-        return StaticAttribute.builder(beanClass, propertyTypeToken)\n-                              .name(attributeNameForProperty(propertyDescriptor))\n-                              .getter(getterForProperty(propertyDescriptor, beanClass))\n-                              .setter(setterForProperty(propertyDescriptor, beanClass));\n+        return EnhancedType.of(type);\n     }\n \n-    private static Optional<AttributeConverter> attributeConverterAnnotation(PropertyDescriptor propertyDescriptor) {\n-        DynamoDbConvertedBy attributeConverterBean = propertyAnnotation(propertyDescriptor, DynamoDbConvertedBy.class);\n+    private static Optional<AttributeConverter> createAttributeConverterFromAnnotation(\n+            PropertyDescriptor propertyDescriptor) {\n+        DynamoDbConvertedBy attributeConverterBean =\n+                getPropertyAnnotation(propertyDescriptor, DynamoDbConvertedBy.class);\n         Optional<Class<?>> optionalClass = Optional.ofNullable(attributeConverterBean)\n                                                    .map(DynamoDbConvertedBy::value);\n         return optionalClass.map(clazz -> (AttributeConverter) newObjectSupplierForClass(clazz).get());\n     }\n \n     /**\n-     * This method scans all the annotations on a property and looks for a meta-annotation of {@link BeanTableSchemaAttributeTag}.\n-     * If the meta-annotation is found, it attempts to create an annotation tag based on a standard named static method\n+     * This method scans all the annotations on a property and looks for a meta-annotation of\n+     * {@link BeanTableSchemaAttributeTag}. If the meta-annotation is found, it attempts to create\n+     * an annotation tag based on a standard named static method\n      * of the class that tag has been annotated with passing in the original property annotation as an argument.\n      */\n     private static void addTagsToAttribute(StaticAttribute.Builder<?, ?> attributeBuilder,\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjczMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401066733", "bodyText": "As a general pattern I avoid having the Builder own the defaults to things, I prefer to see that in the constructor of the object. It can be tested and is more reliable there. Ideally the builder should do absolutely nothing just collect information and pass it to the constructor.", "author": "bmaizels", "createdAt": "2020-03-31T16:54:06Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java", "diffHunk": "@@ -143,7 +141,9 @@ private StaticTableSchema(Builder<T> builder) {\n         private List<StaticAttribute<T, ?>> attributes;\n         private Supplier<T> newItemSupplier;\n         private List<StaticTableTag> tags;\n-        private AttributeConverterProvider attributeConverterProvider;\n+        private List<AttributeConverterProvider> attributeConverterProviders =\n+            Collections.singletonList(ConverterProviderResolver.defaultConverterProvider());", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwOTU0MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401109540", "bodyText": "There is prior art here:\n\n  \n    \n      aws-sdk-java-v2/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/internal/client/DefaultDynamoDbEnhancedClient.java\n    \n    \n        Lines 153 to 154\n      in\n      c72d2b5\n    \n    \n    \n    \n\n        \n          \n           private List<DynamoDbEnhancedClientExtension> dynamoDbEnhancedClientExtensions = \n        \n\n        \n          \n               new ArrayList<>(ExtensionResolver.defaultExtensions()); \n        \n    \n  \n\n\nWhat should take precedence?", "author": "cenedhryn", "createdAt": "2020-03-31T18:02:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjczMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMTc5OA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401121798", "bodyText": "There's also prior art for the other way \n  \n    \n      aws-sdk-java-v2/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\n    \n    \n         Line 85\n      in\n      c72d2b5\n    \n    \n    \n    \n\n        \n          \n           this.attributeConverterProvider = builder.attributeConverterProvider != null ? \n        \n    \n  \n\n\nThe reality is we started off inconsistent and I believe we gravitated (at least I did) towards the way I'm now recommending.", "author": "bmaizels", "createdAt": "2020-03-31T18:23:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjczMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyODgzNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401128835", "bodyText": "Yes. I like that pattern better too, for the reasons you wrote.", "author": "cenedhryn", "createdAt": "2020-03-31T18:34:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjczMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwMTcyNQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401201725", "bodyText": "Then I must set the list to null by default in the builder. Which is the best choice, null or using the default?", "author": "cenedhryn", "createdAt": "2020-03-31T20:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjczMw=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\nindex e0b5ba7be2..497fa64411 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\n\n@@ -144,7 +144,6 @@ public final class StaticTableSchema<T> implements TableSchema<T> {\n         private List<AttributeConverterProvider> attributeConverterProviders =\n             Collections.singletonList(ConverterProviderResolver.defaultConverterProvider());\n \n-\n         private Builder(Class<T> itemClass) {\n             this.itemClass = itemClass;\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NzY2NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401067665", "bodyText": "I think this would be a good place to insert a code example of how to 'best' use the default one (since there are a number of different valid ways to instantiate it). I think we should encourage people to use the most friendly one.", "author": "bmaizels", "createdAt": "2020-03-31T16:55:33Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java", "diffHunk": "@@ -282,18 +282,40 @@ private Builder(Class<T> itemClass) {\n         }\n \n         /**\n-         * A higher-precedence {@link AttributeConverterProvider} than the default one provided by the table schema.\n-         * The {@link AttributeConverterProvider} must provide {@link AttributeConverter}s for all types used in the schema.\n+         * Specifies the {@link AttributeConverterProvider}s to use with the table schema.\n+         * The list of attribute converter providers must provide {@link AttributeConverter}s for all types used\n+         * in the schema. The attribute converter providers will be loaded in the strict order they are supplied here.\n          * <p>\n-         * The table schema has a default, internal, AttributeConverterProvider which provides standard converters\n-         * for most primitive and common Java types. Use custom AttributeConverterProvider when you have specific\n-         * needs for type conversion that the defaults do not cover.\n+         * Calling this method will override the default attribute converter provider\n+         * {@link DefaultAttributeConverterProvider}, which provides standard converters\n+         * for most primitive and common Java types, so that provider must included in the supplied list if it is to be\n+         * used. Providing an empty list here will cause no providers to get loaded.", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEwOTk5Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401109993", "bodyText": "That'd be not using the annotation at all. Right?!", "author": "cenedhryn", "createdAt": "2020-03-31T18:03:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMjMwMw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401122303", "bodyText": "StaticTableSchema should not use the annotation. I was thinking the defaultProvider() method on the base interface if it's still there, otherwise DefaultAttributeConverterProvider.create() or whatever.", "author": "bmaizels", "createdAt": "2020-03-31T18:24:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyODQ2NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401128464", "bodyText": "Sorry, I was still in the bean space. Yes.", "author": "cenedhryn", "createdAt": "2020-03-31T18:34:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NzY2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\nindex e0b5ba7be2..497fa64411 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/StaticTableSchema.java\n\n@@ -287,9 +286,14 @@ public final class StaticTableSchema<T> implements TableSchema<T> {\n          * in the schema. The attribute converter providers will be loaded in the strict order they are supplied here.\n          * <p>\n          * Calling this method will override the default attribute converter provider\n-         * {@link DefaultAttributeConverterProvider}, which provides standard converters\n-         * for most primitive and common Java types, so that provider must included in the supplied list if it is to be\n+         * {@link DefaultAttributeConverterProvider}, which provides standard converters for most primitive\n+         * and common Java types, so that provider must included in the supplied list if it is to be\n          * used. Providing an empty list here will cause no providers to get loaded.\n+         * <p>\n+         * Adding one custom attribute converter provider and using the default as fallback:\n+         * {@code\n+         * builder.attributeConverterProviders(customAttributeConverter, AttributeConverterProvider.defaultProvider())\n+         * }\n          *\n          * @param attributeConverterProviders a list of attribute converter providers to use with the table schema\n          */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2ODUxMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401068512", "bodyText": "Maybe we should mention in the javadoc that passing an empty list as converterProviders results in no converters at all.", "author": "bmaizels", "createdAt": "2020-03-31T16:56:51Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java", "diffHunk": "@@ -39,5 +40,13 @@\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n-    Class<? extends AttributeConverterProvider>[] converterProviders() default {};\n+    Class<? extends AttributeConverterProvider>[] converterProviders()\n+            default { NoAttributeConverterProviderOverride.class };", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExMDE0NQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401110145", "bodyText": "Yes, I'll add that", "author": "cenedhryn", "createdAt": "2020-03-31T18:03:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2ODUxMg=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\nindex 5eaac9dcb4..5a5a282949 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n\n@@ -30,23 +30,30 @@ import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n  * a {@link BeanTableSchema} must have this annotation. If a class is used as a document within another DynamoDbBean,\n  * it will also require this annotation.\n  * <p>\n+ * <b>Attribute Converter Providers</b><br>\n  * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n- * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n- * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n- * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n- * that the defaults do not cover.\n+ * converter provided by the table schema.\n+ * <p>\n+ * Note:\n+ * <ul>\n+ *     <li>The converter(s) must provide {@link AttributeConverter}s for all types used in the schema. </li>\n+ *     <li>The table schema DefaultAttributeConverterProvider provides standard converters for most primitive\n+ *     and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n+ *     that the defaults do not cover.</li>\n+ *     <li>If you provide a list of attribute converter providers, you can add DefaultAttributeConverterProvider\n+ *     to the end of the list to fall back on the defaults.</li>\n+ *     <li>Providing an empty list {} will cause no providers to get loaded.</li>\n+ * </ul>\n+ *\n+ * Example using attribute converter providers with one custom provider and the default provider:\n+ * {@code\n+ * (converterProviders = {CustomAttributeConverter.class, DefaultAttributeConverterProvider.class});\n+ * }\n  */\n @Target({ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n     Class<? extends AttributeConverterProvider>[] converterProviders()\n-            default { NoAttributeConverterProviderOverride.class };\n-\n-    final class NoAttributeConverterProviderOverride implements AttributeConverterProvider {\n-        @Override\n-        public <T> AttributeConverter<T> converterFor(EnhancedType<T> enhancedType) {\n-            return null;\n-        }\n-    }\n+            default { DefaultAttributeConverterProvider.class };\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MDE2NA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401070164", "bodyText": "I think 'throw UnsupportedOperationException(\"This is not a real converter [or something to that effect]\") ' would be more appropriate", "author": "bmaizels", "createdAt": "2020-03-31T16:59:22Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java", "diffHunk": "@@ -39,5 +40,13 @@\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n-    Class<? extends AttributeConverterProvider>[] converterProviders() default {};\n+    Class<? extends AttributeConverterProvider>[] converterProviders()\n+            default { NoAttributeConverterProviderOverride.class };\n+\n+    final class NoAttributeConverterProviderOverride implements AttributeConverterProvider {\n+        @Override\n+        public <T> AttributeConverter<T> converterFor(EnhancedType<T> enhancedType) {\n+            return null;", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExMDI5Mw==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401110293", "bodyText": "You're right, will update", "author": "cenedhryn", "createdAt": "2020-03-31T18:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MDE2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyNDMzMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401124332", "bodyText": "Actually let's just get rid of this and use the real DefaultAttributeConverterProvider", "author": "bmaizels", "createdAt": "2020-03-31T18:27:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MDE2NA=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\nindex 5eaac9dcb4..5a5a282949 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n\n@@ -30,23 +30,30 @@ import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n  * a {@link BeanTableSchema} must have this annotation. If a class is used as a document within another DynamoDbBean,\n  * it will also require this annotation.\n  * <p>\n+ * <b>Attribute Converter Providers</b><br>\n  * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n- * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n- * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n- * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n- * that the defaults do not cover.\n+ * converter provided by the table schema.\n+ * <p>\n+ * Note:\n+ * <ul>\n+ *     <li>The converter(s) must provide {@link AttributeConverter}s for all types used in the schema. </li>\n+ *     <li>The table schema DefaultAttributeConverterProvider provides standard converters for most primitive\n+ *     and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n+ *     that the defaults do not cover.</li>\n+ *     <li>If you provide a list of attribute converter providers, you can add DefaultAttributeConverterProvider\n+ *     to the end of the list to fall back on the defaults.</li>\n+ *     <li>Providing an empty list {} will cause no providers to get loaded.</li>\n+ * </ul>\n+ *\n+ * Example using attribute converter providers with one custom provider and the default provider:\n+ * {@code\n+ * (converterProviders = {CustomAttributeConverter.class, DefaultAttributeConverterProvider.class});\n+ * }\n  */\n @Target({ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n     Class<? extends AttributeConverterProvider>[] converterProviders()\n-            default { NoAttributeConverterProviderOverride.class };\n-\n-    final class NoAttributeConverterProviderOverride implements AttributeConverterProvider {\n-        @Override\n-        public <T> AttributeConverter<T> converterFor(EnhancedType<T> enhancedType) {\n-            return null;\n-        }\n-    }\n+            default { DefaultAttributeConverterProvider.class };\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MDg1Ng==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401070856", "bodyText": "By inheritance, this class is effectively public (which is why you're able to use it elsewhere in the code). That means we should either javadoc it or move it out of here and into internal namespace. I think I favor the latter but open to discussion.", "author": "bmaizels", "createdAt": "2020-03-31T17:00:26Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java", "diffHunk": "@@ -39,5 +40,13 @@\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n-    Class<? extends AttributeConverterProvider>[] converterProviders() default {};\n+    Class<? extends AttributeConverterProvider>[] converterProviders()\n+            default { NoAttributeConverterProviderOverride.class };\n+\n+    final class NoAttributeConverterProviderOverride implements AttributeConverterProvider {", "originalCommit": "03632ccca229de1993881769cfbe7a32d6f0b251", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTExOTQ0MA==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401119440", "bodyText": "Offline agreed to just use DefaultAttriburteConverterProvider instead (which will be a public class in this PR)", "author": "cenedhryn", "createdAt": "2020-03-31T18:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MDg1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\nindex 5eaac9dcb4..5a5a282949 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n\n@@ -30,23 +30,30 @@ import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n  * a {@link BeanTableSchema} must have this annotation. If a class is used as a document within another DynamoDbBean,\n  * it will also require this annotation.\n  * <p>\n+ * <b>Attribute Converter Providers</b><br>\n  * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n- * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n- * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n- * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n- * that the defaults do not cover.\n+ * converter provided by the table schema.\n+ * <p>\n+ * Note:\n+ * <ul>\n+ *     <li>The converter(s) must provide {@link AttributeConverter}s for all types used in the schema. </li>\n+ *     <li>The table schema DefaultAttributeConverterProvider provides standard converters for most primitive\n+ *     and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n+ *     that the defaults do not cover.</li>\n+ *     <li>If you provide a list of attribute converter providers, you can add DefaultAttributeConverterProvider\n+ *     to the end of the list to fall back on the defaults.</li>\n+ *     <li>Providing an empty list {} will cause no providers to get loaded.</li>\n+ * </ul>\n+ *\n+ * Example using attribute converter providers with one custom provider and the default provider:\n+ * {@code\n+ * (converterProviders = {CustomAttributeConverter.class, DefaultAttributeConverterProvider.class});\n+ * }\n  */\n @Target({ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n @SdkPublicApi\n public @interface DynamoDbBean {\n     Class<? extends AttributeConverterProvider>[] converterProviders()\n-            default { NoAttributeConverterProviderOverride.class };\n-\n-    final class NoAttributeConverterProviderOverride implements AttributeConverterProvider {\n-        @Override\n-        public <T> AttributeConverter<T> converterFor(EnhancedType<T> enhancedType) {\n-            return null;\n-        }\n-    }\n+            default { DefaultAttributeConverterProvider.class };\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0NDIzMg==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401744232", "bodyText": "I think we should spruce up the javadoc a bit to celebrate this class' new status as 'public'. At a minimum mention (preferably with examples) how to use it in a StaticTableSchema builder and a BeanTableSchema annotation.", "author": "bmaizels", "createdAt": "2020-04-01T16:23:28Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DefaultAttributeConverterProvider.java", "diffHunk": "@@ -80,7 +77,7 @@\n  * Given an input, this will identify a converter that can convert the specific Java type and invoke it. If a converter cannot\n  * be found, it will invoke a \"parent\" converter, which would be expected to be able to convert the value (or throw an exception).\n  */\n-@SdkInternalApi\n+@SdkPublicApi", "originalCommit": "22cc5230cccc52db0bad422cd3bcf16b03ee3b03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DefaultAttributeConverterProvider.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DefaultAttributeConverterProvider.java\nindex 87480bf0ce..1935d159cd 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DefaultAttributeConverterProvider.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/DefaultAttributeConverterProvider.java\n\n@@ -73,9 +73,13 @@ import software.amazon.awssdk.utils.Logger;\n import software.amazon.awssdk.utils.Validate;\n \n /**\n+ * This class is the default attribute converter provider in the DDB Enhanced library. When instantiated\n+ * using the constructor {@link #DefaultAttributeConverterProvider()} or the {@link #create()} method, it's loaded\n+ * with the currently supported attribute converters in the library.\n  * <p>\n- * Given an input, this will identify a converter that can convert the specific Java type and invoke it. If a converter cannot\n- * be found, it will invoke a \"parent\" converter, which would be expected to be able to convert the value (or throw an exception).\n+ * Given an input, the method {@link #converterFor(EnhancedType)} will identify a converter that can convert the\n+ * specific Java type and invoke it. If a converter cannot be found, it will invoke a \"parent\" converter,\n+ * which would be expected to be able to convert the value (or throw an exception).\n  */\n @SdkPublicApi\n @ThreadSafe\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0OTE2MQ==", "url": "https://github.com/aws/aws-sdk-java-v2/pull/1746#discussion_r401749161", "bodyText": "I think it'd be nice to give an example here of using a single custom converter provider with default as fallback (as we did in the StaticTableSchema example).", "author": "bmaizels", "createdAt": "2020-04-01T16:30:38Z", "path": "services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java", "diffHunk": "@@ -31,22 +31,21 @@\n  * it will also require this annotation.\n  * <p>\n  * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n- * converter provided by the table schema. The converter must provide {@link AttributeConverter}s for all types used\n- * in the schema. The table schema default AttributeConverterProvider provides standard converters for most primitive\n- * and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n- * that the defaults do not cover.\n+ * converter provided by the table schema.\n+ * <p>\n+ * Note:\n+ * <ul>", "originalCommit": "22cc5230cccc52db0bad422cd3bcf16b03ee3b03", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "chunk": "diff --git a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\nindex 6d3eba6674..5a5a282949 100644\n--- a/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n+++ b/services-custom/dynamodb-enhanced/src/main/java/software/amazon/awssdk/enhanced/dynamodb/mapper/annotations/DynamoDbBean.java\n\n@@ -30,17 +30,25 @@ import software.amazon.awssdk.enhanced.dynamodb.mapper.BeanTableSchema;\n  * a {@link BeanTableSchema} must have this annotation. If a class is used as a document within another DynamoDbBean,\n  * it will also require this annotation.\n  * <p>\n+ * <b>Attribute Converter Providers</b><br>\n  * Using {@link AttributeConverterProvider}s is optional and, if used, the supplied provider supersedes the default\n  * converter provided by the table schema.\n  * <p>\n  * Note:\n  * <ul>\n  *     <li>The converter(s) must provide {@link AttributeConverter}s for all types used in the schema. </li>\n- *     <li>The table schema default AttributeConverterProvider provides standard converters for most primitive\n+ *     <li>The table schema DefaultAttributeConverterProvider provides standard converters for most primitive\n  *     and common Java types. Use custom AttributeConverterProviders when you have specific needs for type conversion\n  *     that the defaults do not cover.</li>\n+ *     <li>If you provide a list of attribute converter providers, you can add DefaultAttributeConverterProvider\n+ *     to the end of the list to fall back on the defaults.</li>\n  *     <li>Providing an empty list {} will cause no providers to get loaded.</li>\n  * </ul>\n+ *\n+ * Example using attribute converter providers with one custom provider and the default provider:\n+ * {@code\n+ * (converterProviders = {CustomAttributeConverter.class, DefaultAttributeConverterProvider.class});\n+ * }\n  */\n @Target({ElementType.TYPE})\n @Retention(RetentionPolicy.RUNTIME)\n"}}, {"oid": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "message": "DDB Enhanced adding ChainConverterProvider", "committedDate": "2020-04-01T21:34:24Z", "type": "commit"}, {"oid": "077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "url": "https://github.com/aws/aws-sdk-java-v2/commit/077b0a31a950cc45620c8998b6bf39f4e0c3c12d", "message": "DDB Enhanced adding ChainConverterProvider", "committedDate": "2020-04-01T21:34:24Z", "type": "forcePushed"}]}