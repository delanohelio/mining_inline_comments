{"pr_number": 4688, "pr_title": "Issue #4682 Session with no attributes unreadable from jdbc", "pr_createdAt": "2020-03-21T13:32:56Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4688", "timeline": [{"oid": "2f41e63b68e6144708c9ea985cdebd352517acf9", "url": "https://github.com/eclipse/jetty.project/commit/2f41e63b68e6144708c9ea985cdebd352517acf9", "message": "Issue #4682 Session with no attributes unreadable from jdbc\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-21T13:28:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODMzNjQzMA==", "url": "https://github.com/eclipse/jetty.project/pull/4688#discussion_r398336430", "bodyText": "maybe use logging :)", "author": "olamy", "createdAt": "2020-03-26T06:09:10Z", "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/JdbcTestHelper.java", "diffHunk": "@@ -131,6 +130,35 @@ public static void prepareTables() throws SQLException\n \n         sessionTableSchema.prepareTables();\n     }\n+    \n+    public static void dumpRow(ResultSet row) throws SQLException\n+    {\n+        if (row != null)\n+        {\n+            String id = row.getString(ID_COL);\n+            long created = row.getLong(CREATE_COL);\n+            long accessed = row.getLong(ACCESS_COL);\n+            long lastAccessed = row.getLong(LAST_ACCESS_COL);\n+            long maxIdle = row.getLong(MAX_IDLE_COL);\n+            long cookieSet = row.getLong(COOKIE_COL);\n+            String node = row.getString(LAST_NODE_COL);\n+            long expires = row.getLong(EXPIRY_COL);\n+            long lastSaved = row.getLong(LAST_SAVE_COL);\n+            String context = row.getString(CONTEXT_COL);\n+            Blob blob = row.getBlob(MAP_COL);\n+            \n+            String dump = \"id=\" + id +\n+                          \" ctxt=\" + context +\n+                          \" node=\" + node +\n+                          \" exp=\" + expires +\n+                          \" acc=\" + accessed +\n+                          \" lacc=\" + lastAccessed +\n+                          \" ck=\" + cookieSet +\n+                          \" lsv=\" + lastSaved +\n+                          \" blob length=\" + blob.length();\n+            System.err.println(dump);", "originalCommit": "2f41e63b68e6144708c9ea985cdebd352517acf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMjU4NQ==", "url": "https://github.com/eclipse/jetty.project/pull/4688#discussion_r398612585", "bodyText": "Want to leave this System.err.println here?", "author": "joakime", "createdAt": "2020-03-26T14:24:00Z", "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/JdbcTestHelper.java", "diffHunk": "@@ -151,6 +179,7 @@ public static boolean existsInSessionTable(String id, boolean verbose)\n                 while (result.next())\n                 {\n                     results = true;\n+                    dumpRow(result);", "originalCommit": "2f41e63b68e6144708c9ea985cdebd352517acf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMzc3Nw==", "url": "https://github.com/eclipse/jetty.project/pull/4688#discussion_r398613777", "bodyText": "Any reason why \", virtualHost, \" is not just \", \" + VHOST_COL + \", \" ?", "author": "joakime", "createdAt": "2020-03-26T14:25:31Z", "path": "tests/test-sessions/test-jdbc-sessions/src/test/java/org/eclipse/jetty/server/session/JdbcTestHelper.java", "diffHunk": "@@ -232,41 +261,53 @@ public static boolean checkSessionPersisted(SessionData data)\n \n         return true;\n     }\n-\n-    public static void insertSession(String id, String contextPath, String vhost)\n-        throws Exception\n+    \n+    public static void insertSession(SessionData data) throws Exception\n     {\n+\n         Class.forName(DRIVER_CLASS);\n         try (Connection con = DriverManager.getConnection(DEFAULT_CONNECTION_URL);)\n         {\n             PreparedStatement statement = con.prepareStatement(\"insert into \" + TABLE +\n                 \" (\" + ID_COL + \", \" + CONTEXT_COL + \", virtualHost, \" + LAST_NODE_COL +", "originalCommit": "2f41e63b68e6144708c9ea985cdebd352517acf9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}