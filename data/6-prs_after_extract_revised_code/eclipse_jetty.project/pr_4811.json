{"pr_number": 4811, "pr_title": "Issue #4819 - Workarounds for old (pre API 24) Android SDKs", "pr_createdAt": "2020-04-24T16:13:07Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4811", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYwNTc2OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4811#discussion_r415605769", "bodyText": "Just call it getHandshakeSession().", "author": "sbordet", "createdAt": "2020-04-27T08:15:51Z", "path": "jetty-io/src/main/java/org/eclipse/jetty/io/ssl/SslConnection.java", "diffHunk": "@@ -143,9 +142,22 @@ public void setRenegotiationAllowed(boolean renegotiationAllowed)\n         this._renegotiationAllowed = renegotiationAllowed;\n     }\n \n+    private SSLSession getOptionalHandshakeSession()", "originalCommit": "1bbd1615eefa14dfda0af8b13eacc641386f4670", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "26e6979ce2264d181549e47c2bb2a39fe5d3f950", "chunk": "diff --git a/jetty-io/src/main/java/org/eclipse/jetty/io/ssl/SslConnection.java b/jetty-io/src/main/java/org/eclipse/jetty/io/ssl/SslConnection.java\nindex 8811cd2a22..a177b7dd97 100644\n--- a/jetty-io/src/main/java/org/eclipse/jetty/io/ssl/SslConnection.java\n+++ b/jetty-io/src/main/java/org/eclipse/jetty/io/ssl/SslConnection.java\n\n@@ -142,22 +142,23 @@ public class SslConnection extends AbstractConnection\n         this._renegotiationAllowed = renegotiationAllowed;\n     }\n \n-    private SSLSession getOptionalHandshakeSession()\n+    private SSLSession getHandshakeSession()\n     {\n         try\n         {\n+            // Method introduced on introduced on Android API 24.\n             return _sslEngine.getHandshakeSession();\n         }\n-        catch (NoSuchMethodError ignore)\n+        catch (NoSuchMethodError ignored)\n         {\n-            // ignore on Android (introduced on Android API 24)\n+            // ignore failure on old Android API revisions.\n             return null;\n         }\n     }\n \n     private int getApplicationBufferSize()\n     {\n-        SSLSession hsSession = getOptionalHandshakeSession();\n+        SSLSession hsSession = getHandshakeSession();\n         SSLSession session = _sslEngine.getSession();\n         int size = session.getApplicationBufferSize();\n         if (hsSession == null || hsSession == session)\n"}}, {"oid": "26e6979ce2264d181549e47c2bb2a39fe5d3f950", "url": "https://github.com/eclipse/jetty.project/commit/26e6979ce2264d181549e47c2bb2a39fe5d3f950", "message": "Issue #4819 - Rework SSL/TLS methods to allow use on Android API 23 (or older)\n\n* Workaround missing SSLEngine.getHandshakeSession()\n* Workaround missing SSLParameters.setEndpointIdentificationAlgorithm()\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-04-27T14:00:50Z", "type": "commit"}, {"oid": "26e6979ce2264d181549e47c2bb2a39fe5d3f950", "url": "https://github.com/eclipse/jetty.project/commit/26e6979ce2264d181549e47c2bb2a39fe5d3f950", "message": "Issue #4819 - Rework SSL/TLS methods to allow use on Android API 23 (or older)\n\n* Workaround missing SSLEngine.getHandshakeSession()\n* Workaround missing SSLParameters.setEndpointIdentificationAlgorithm()\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-04-27T14:00:50Z", "type": "forcePushed"}]}