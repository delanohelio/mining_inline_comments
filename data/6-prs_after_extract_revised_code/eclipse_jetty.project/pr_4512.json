{"pr_number": 4512, "pr_title": "Issue #4247 use context default for samesite cookie attribute", "pr_createdAt": "2020-01-23T09:04:25Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4512", "timeline": [{"oid": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "url": "https://github.com/eclipse/jetty.project/commit/f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "message": "Issue #4247 use context default for samesite cookie attribute\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-23T08:58:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxODgwMA==", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371818800", "bodyText": "This should not be a log warn.... at least no a log warn on every single cookie set as that will be very verbose.\nI think debug is fine.", "author": "gregw", "createdAt": "2020-01-28T14:02:30Z", "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");", "originalCommit": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "chunk": "diff --git a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\nindex c844a6182e..4a906cc0a7 100644\n--- a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n+++ b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n\n@@ -475,7 +475,8 @@ public class HttpCookie\n         Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n         if (o == null)\n         {\n-            LOG.warn(\"No default value for SameSite\");\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"No default value for SameSite\");\n             return null;\n         }\n         \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxOTU1NA==", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371819554", "bodyText": "You should use o.toString() rather than a cast.", "author": "gregw", "createdAt": "2020-01-28T14:04:06Z", "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");\n+            return null;\n+        }\n+        \n+        if (o instanceof SameSite)\n+            return (SameSite)o;\n+        \n+        try\n+        {\n+            return Enum.valueOf(SameSite.class, ((String)o).trim().toUpperCase(Locale.ENGLISH));", "originalCommit": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "chunk": "diff --git a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\nindex c844a6182e..4a906cc0a7 100644\n--- a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n+++ b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n\n@@ -475,7 +475,8 @@ public class HttpCookie\n         Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n         if (o == null)\n         {\n-            LOG.warn(\"No default value for SameSite\");\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"No default value for SameSite\");\n             return null;\n         }\n         \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyMTg2MQ==", "url": "https://github.com/eclipse/jetty.project/pull/4512#discussion_r371821861", "bodyText": "Should we set the converted value back so that every cookie doesn't need to carry this cost???", "author": "gregw", "createdAt": "2020-01-28T14:08:10Z", "path": "jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java", "diffHunk": "@@ -448,6 +460,39 @@ public static SameSite getSameSiteFromComment(String comment)\n         return null;\n     }\n \n+    /**\n+     * Get the default value for SameSite cookie attribute, if one\n+     * has been set for the given context.\n+     * \n+     * @param context the context to check for default SameSite value\n+     * @return the default SameSite value or null if one does not exist\n+     * @throws IllegalStateException if the default value is not a permitted value\n+     */\n+    public static SameSite getSameSiteDefault(ServletContext context)\n+    {\n+        if (context == null)\n+            return null;\n+        Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n+        if (o == null)\n+        {\n+            LOG.warn(\"No default value for SameSite\");\n+            return null;\n+        }\n+        \n+        if (o instanceof SameSite)\n+            return (SameSite)o;\n+        \n+        try\n+        {\n+            return Enum.valueOf(SameSite.class, ((String)o).trim().toUpperCase(Locale.ENGLISH));", "originalCommit": "f52373bee48fe3b4ef163d1ca74a3ab32bc865b7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "chunk": "diff --git a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\nindex c844a6182e..4a906cc0a7 100644\n--- a/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n+++ b/jetty-http/src/main/java/org/eclipse/jetty/http/HttpCookie.java\n\n@@ -475,7 +475,8 @@ public class HttpCookie\n         Object o = context.getAttribute(SAME_SITE_DEFAULT_ATTRIBUTE);\n         if (o == null)\n         {\n-            LOG.warn(\"No default value for SameSite\");\n+            if (LOG.isDebugEnabled())\n+                LOG.debug(\"No default value for SameSite\");\n             return null;\n         }\n         \n"}}, {"oid": "495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "url": "https://github.com/eclipse/jetty.project/commit/495dcfec074b7d0d4e0751d8eed8b5fe893a6dbd", "message": "Issue #4247 changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-29T08:59:17Z", "type": "commit"}]}