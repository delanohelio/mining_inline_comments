{"pr_number": 4708, "pr_title": "Issue #4707 wrong value for ServletContext.setSessionTimeout", "pr_createdAt": "2020-03-24T15:16:31Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4708", "timeline": [{"oid": "73a21079f808a6fbe6398cc991676b152209fea9", "url": "https://github.com/eclipse/jetty.project/commit/73a21079f808a6fbe6398cc991676b152209fea9", "message": "Issue #4707 wrong value for ServletContext.setSessionTimeout\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-24T15:14:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1NDY5OA==", "url": "https://github.com/eclipse/jetty.project/pull/4708#discussion_r397654698", "bodyText": "println left in", "author": "gregw", "createdAt": "2020-03-25T07:36:17Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java", "diffHunk": "@@ -834,6 +834,7 @@ public void setSessionIdManager(SessionIdManager metaManager)\n     public void setMaxInactiveInterval(int seconds)\n     {\n         _dftMaxIdleSecs = seconds;\n+        System.err.println(\"SETMAXINACTIVE = \" + seconds);", "originalCommit": "73a21079f808a6fbe6398cc991676b152209fea9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01972b837bb71a9f9b358226c9bb57cc8c06f46d", "chunk": "diff --git a/jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java b/jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java\nindex 060fcc3365..a3d624e516 100644\n--- a/jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java\n+++ b/jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java\n\n@@ -834,7 +834,6 @@ public class SessionHandler extends ScopedHandler\n     public void setMaxInactiveInterval(int seconds)\n     {\n         _dftMaxIdleSecs = seconds;\n-        System.err.println(\"SETMAXINACTIVE = \" + seconds);\n         if (LOG.isDebugEnabled())\n         {\n             if (_dftMaxIdleSecs <= 0)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1NDgyOA==", "url": "https://github.com/eclipse/jetty.project/pull/4708#discussion_r397654828", "bodyText": "ditto... and more below", "author": "gregw", "createdAt": "2020-03-25T07:36:36Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java", "diffHunk": "@@ -1386,6 +1386,7 @@ public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingMode\n         @Override\n         public int getSessionTimeout()\n         {\n+            System.err.println(\"CALLING GETSESSIONTIMEOUT\");", "originalCommit": "73a21079f808a6fbe6398cc991676b152209fea9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01972b837bb71a9f9b358226c9bb57cc8c06f46d", "chunk": "diff --git a/jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java b/jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java\nindex bb5331ef5f..9d22064128 100644\n--- a/jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java\n+++ b/jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java\n\n@@ -1386,7 +1386,6 @@ public class ServletContextHandler extends ContextHandler\n         @Override\n         public int getSessionTimeout()\n         {\n-            System.err.println(\"CALLING GETSESSIONTIMEOUT\");\n             if (!isStarting())\n                 throw new IllegalStateException();\n             if (!_enabled)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1NTI1NA==", "url": "https://github.com/eclipse/jetty.project/pull/4708#discussion_r397655254", "bodyText": "println left in", "author": "gregw", "createdAt": "2020-03-25T07:37:39Z", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java", "diffHunk": "@@ -660,8 +660,8 @@ public void visitSessionConfig(WebAppContext context, Descriptor descriptor, Xml\n         if (tNode != null)\n         {\n             long val = Long.parseLong(tNode.toString(false, true));\n-            val = TimeUnit.MINUTES.toSeconds(val);\n-            if (val > Integer.MAX_VALUE)\n+            System.err.println(\"SESSION CONFIG TIMEOUT = \" + val);", "originalCommit": "73a21079f808a6fbe6398cc991676b152209fea9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01972b837bb71a9f9b358226c9bb57cc8c06f46d", "chunk": "diff --git a/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java b/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\nindex eb01b804a1..44e4e41146 100644\n--- a/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\n+++ b/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\n\n@@ -659,11 +659,10 @@ public class StandardDescriptorProcessor extends IterativeDescriptorProcessor\n         XmlParser.Node tNode = node.get(\"session-timeout\");\n         if (tNode != null)\n         {\n-            long val = Long.parseLong(tNode.toString(false, true));\n-            System.err.println(\"SESSION CONFIG TIMEOUT = \" + val);\n-            if (TimeUnit.MINUTES.toSeconds(val) > Integer.MAX_VALUE)\n+            long mins = Long.parseLong(tNode.toString(false, true));\n+            if (TimeUnit.MINUTES.toSeconds(mins) > Integer.MAX_VALUE)\n                 throw new IllegalStateException(\"Max session-timeout in minutes is \" + TimeUnit.SECONDS.toMinutes(Integer.MAX_VALUE));\n-            context.getServletContext().setSessionTimeout((int)val);\n+            context.getServletContext().setSessionTimeout((int)mins);\n         }\n \n         //Servlet Spec 3.0\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY1NjE2OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4708#discussion_r397656169", "bodyText": "can we change the name of val to something that includes the units.  It is not clear that this is where the fix is.", "author": "gregw", "createdAt": "2020-03-25T07:39:55Z", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java", "diffHunk": "@@ -660,8 +660,8 @@ public void visitSessionConfig(WebAppContext context, Descriptor descriptor, Xml\n         if (tNode != null)\n         {\n             long val = Long.parseLong(tNode.toString(false, true));", "originalCommit": "73a21079f808a6fbe6398cc991676b152209fea9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "01972b837bb71a9f9b358226c9bb57cc8c06f46d", "chunk": "diff --git a/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java b/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\nindex eb01b804a1..44e4e41146 100644\n--- a/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\n+++ b/jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java\n\n@@ -659,11 +659,10 @@ public class StandardDescriptorProcessor extends IterativeDescriptorProcessor\n         XmlParser.Node tNode = node.get(\"session-timeout\");\n         if (tNode != null)\n         {\n-            long val = Long.parseLong(tNode.toString(false, true));\n-            System.err.println(\"SESSION CONFIG TIMEOUT = \" + val);\n-            if (TimeUnit.MINUTES.toSeconds(val) > Integer.MAX_VALUE)\n+            long mins = Long.parseLong(tNode.toString(false, true));\n+            if (TimeUnit.MINUTES.toSeconds(mins) > Integer.MAX_VALUE)\n                 throw new IllegalStateException(\"Max session-timeout in minutes is \" + TimeUnit.SECONDS.toMinutes(Integer.MAX_VALUE));\n-            context.getServletContext().setSessionTimeout((int)val);\n+            context.getServletContext().setSessionTimeout((int)mins);\n         }\n \n         //Servlet Spec 3.0\n"}}, {"oid": "01972b837bb71a9f9b358226c9bb57cc8c06f46d", "url": "https://github.com/eclipse/jetty.project/commit/01972b837bb71a9f9b358226c9bb57cc8c06f46d", "message": "Issue #4707 changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-25T09:54:42Z", "type": "commit"}]}