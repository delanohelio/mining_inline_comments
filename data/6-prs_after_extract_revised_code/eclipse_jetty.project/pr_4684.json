{"pr_number": 4684, "pr_title": "Issue #4683 Fix jetty-slf4j-impl for osgi", "pr_createdAt": "2020-03-19T14:12:33Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4684", "timeline": [{"oid": "50f296cac514cd05d34b73b06142e5493de0ac9d", "url": "https://github.com/eclipse/jetty.project/commit/50f296cac514cd05d34b73b06142e5493de0ac9d", "message": "Issue #4683 Fix jetty-slf4j-impl for osgi\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-19T14:08:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r398619289", "bodyText": "Why can't this use a jetty-logging.properties file instead?", "author": "joakime", "createdAt": "2020-03-26T14:32:23Z", "path": "jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestOSGiUtil.java", "diffHunk": "@@ -124,15 +138,24 @@ public static Option optionalRemoteDebug()\n         {\n             res.add(systemProperty(\"org.ops4j.pax.url.mvn.settings\").value(System.getProperty(\"settingsFilePath\")));\n         }\n+        \n+        //sort out logging level from jetty\n+        String jettyLogLevel = System.getProperty(\"org.eclipse.jetty.LEVEL\", \"WARN\");\n+        res.add(systemProperty(\"org.eclipse.jetty.LEVEL\").value(jettyLogLevel));", "originalCommit": "50f296cac514cd05d34b73b06142e5493de0ac9d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc3ODU5MA==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r398778590", "bodyText": "It seemed more convenient to be able to run the test and pass in the log level on the command line of the test, so it is very quick to change log levels. Is there some advantage in using a jetty-logging.properties file instead?", "author": "janbartel", "createdAt": "2020-03-26T17:58:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4MjMyNQ==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r398782325", "bodyText": "Everywhere else, if we want to change logging levels, we look for a jetty-logging.properties file and make the change, controlling more then 1 level, message escaping, etc as well.\nFor jetty-osgi, we have to remember to edit a source file that's 3 levels of indirection away from the problem we are working to resolve.\nWe used to be able to edit a log4j.xml in jetty-osgi to manage logging, but you removed that file in this PR.", "author": "joakime", "createdAt": "2020-03-26T18:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5NzUxMg==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r398797512", "bodyText": "Log4j doesn't seem to work any more in the pax exam environment combined with jetty logging that now requires the slf4j interface, so the combination you see is the only combination I could get to work. I'll try creating a jetty-logging.properties file, which I assume the jetty logging infrastructure will take care of reading and parsing? Ie, all I have to do is provide it?", "author": "janbartel", "createdAt": "2020-03-26T18:26:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTU3Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r398809576", "bodyText": "Correct, jetty-slf4j-impl will load it.\nhttps://github.com/eclipse/jetty.project/blob/jetty-10.0.x/jetty-slf4j-impl/src/main/java/org/eclipse/jetty/logging/JettyLoggerConfiguration.java#L169-L194\nIt essentially does ...\nClassLoader.getResource(\"jetty-logging.properties\");\nto find the properties URL and then load it from that URL.", "author": "joakime", "createdAt": "2020-03-26T18:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIzMTIxNQ==", "url": "https://github.com/eclipse/jetty.project/pull/4684#discussion_r399231215", "bodyText": "@joakime ok, I've modified the osgi tests so that they can use src/test/resources/jetty-logging.properties.  This is better because it gives more flexibility in setting the logging levels, but also means the chance of someone committing their changes for local testing to jetty-logging.properties is high.", "author": "janbartel", "createdAt": "2020-03-27T12:32:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTI4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "1f57993568981836540d89669395577e122dc5e2", "chunk": "diff --git a/jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestOSGiUtil.java b/jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestOSGiUtil.java\nindex aacd962b7c..15b7729d2b 100644\n--- a/jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestOSGiUtil.java\n+++ b/jetty-osgi/test-jetty-osgi/src/test/java/org/eclipse/jetty/osgi/test/TestOSGiUtil.java\n\n@@ -139,10 +161,13 @@ public class TestOSGiUtil\n             res.add(systemProperty(\"org.ops4j.pax.url.mvn.settings\").value(System.getProperty(\"settingsFilePath\")));\n         }\n         \n-        //sort out logging level from jetty\n-        String jettyLogLevel = System.getProperty(\"org.eclipse.jetty.LEVEL\", \"WARN\");\n-        res.add(systemProperty(\"org.eclipse.jetty.LEVEL\").value(jettyLogLevel));\n-        \n+        //make src/test/resources/jetty-logging.properties visible to jetty in the osgi container        \n+        TinyBundle loggingPropertiesBundle = TinyBundles.bundle();\n+        loggingPropertiesBundle.add(\"jetty-logging.properties\", ClassLoader.getSystemResource(\"jetty-logging.properties\"));\n+        loggingPropertiesBundle.set(Constants.BUNDLE_SYMBOLICNAME, \"jetty-logging-properties\");\n+        loggingPropertiesBundle.set(Constants.FRAGMENT_HOST, \"org.eclipse.jetty.logging\");\n+        loggingPropertiesBundle.add(FragmentActivator.class);\n+        res.add(CoreOptions.streamBundle(loggingPropertiesBundle.build()).noStart());\n         res.add(mavenBundle().groupId(\"org.eclipse.jetty.toolchain\").artifactId(\"jetty-servlet-api\").versionAsInProject().start());\n         res.add(mavenBundle().groupId(\"org.ow2.asm\").artifactId(\"asm\").versionAsInProject().start());\n         res.add(mavenBundle().groupId(\"org.ow2.asm\").artifactId(\"asm-commons\").versionAsInProject().start());\n"}}, {"oid": "1f57993568981836540d89669395577e122dc5e2", "url": "https://github.com/eclipse/jetty.project/commit/1f57993568981836540d89669395577e122dc5e2", "message": "Issue #4683 Use jetty-logging.properties for osgi tests\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-27T12:31:02Z", "type": "commit"}, {"oid": "0b6a47ebf1bcd635a1972865c89672ea0d3e41b9", "url": "https://github.com/eclipse/jetty.project/commit/0b6a47ebf1bcd635a1972865c89672ea0d3e41b9", "message": "Issue #4683 Update README.txt\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-03-27T12:34:33Z", "type": "commit"}, {"oid": "ab4041c09ea578b6f56c277e5dd62c4cfd759ca4", "url": "https://github.com/eclipse/jetty.project/commit/ab4041c09ea578b6f56c277e5dd62c4cfd759ca4", "message": "Issue #4683 - cleaning up pom for clarity\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-03-31T16:50:11Z", "type": "commit"}]}