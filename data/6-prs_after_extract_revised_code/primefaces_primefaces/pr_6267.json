{"pr_number": 6267, "pr_title": "Fix #5978: FileDownload: add Ajax support", "pr_createdAt": "2020-08-30T14:58:46Z", "pr_url": "https://github.com/primefaces/primefaces/pull/6267", "timeline": [{"oid": "1f033c75aaded2b4cabb7e60d6f70d95b4029aeb", "url": "https://github.com/primefaces/primefaces/commit/1f033c75aaded2b4cabb7e60d6f70d95b4029aeb", "message": "fileDownload add Ajax support", "committedDate": "2020-08-30T14:53:52Z", "type": "commit"}, {"oid": "c31f130ccbcddc42ae1d95dba6d746cd7be4f084", "url": "https://github.com/primefaces/primefaces/commit/c31f130ccbcddc42ae1d95dba6d746cd7be4f084", "message": "Reverted indexed for loop", "committedDate": "2020-08-30T18:15:36Z", "type": "commit"}, {"oid": "0d50cd9461425101047c1cced3bea35b31f64b43", "url": "https://github.com/primefaces/primefaces/commit/0d50cd9461425101047c1cced3bea35b31f64b43", "message": "Merge branch 'master' into fix_5978", "committedDate": "2020-09-01T17:37:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTMzNzU3NA==", "url": "https://github.com/primefaces/primefaces/pull/6267#discussion_r481337574", "bodyText": "@tandraschko are you referring to this line? If so, src could be null originally:\n\n  \n    \n      primefaces/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java\n    \n    \n         Line 127\n      in\n      d05387b\n    \n    \n    \n    \n\n        \n          \n           src = ResourceUtils.appendCacheBuster(src, cache); \n        \n    \n  \n\n\nShall I change that into throwing a FacesException?", "author": "jepsar", "createdAt": "2020-09-01T18:12:15Z", "path": "src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java", "diffHunk": "@@ -65,36 +63,43 @@ public static String build(FacesContext context, Object value, UIComponent compo\n         }\n         else if (value instanceof String) {\n             src = ResourceUtils.getResourceURL(context, (String) value);\n+            return encodeResourceURL(context, src, cache);\n         }\n         else if (value instanceof StreamedContent) {\n             StreamedContent streamedContent = (StreamedContent) value;\n-\n-            if (stream) {\n-                Resource resource = context.getApplication().getResourceHandler().createResource(\n-                        \"dynamiccontent.properties\", \"primefaces\", streamedContent.getContentType());\n-                String resourcePath = resource.getRequestPath();\n-\n-                Map<String, Object> session = context.getExternalContext().getSessionMap();\n-                Map<String, String> dynamicResourcesMapping = (Map) session.get(Constants.DYNAMIC_RESOURCES_MAPPING);\n-                if (dynamicResourcesMapping == null) {\n-                    dynamicResourcesMapping = new LimitedSizeHashMap<>(200);\n-                    session.put(Constants.DYNAMIC_RESOURCES_MAPPING, dynamicResourcesMapping);\n-                }\n-\n-                ValueExpression expression = ValueExpressionAnalyzer.getExpression(\n+            ValueExpression expression = ValueExpressionAnalyzer.getExpression(\n                         context.getELContext(), component.getValueExpression(attributeName));\n+            return build(context, streamedContent, component, cache, type, stream, expression);\n+        }\n+        return encodeResourceURL(context, src, cache);", "originalCommit": "0d50cd9461425101047c1cced3bea35b31f64b43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "94d24f6cfa42c89e53b6e34aa8de3b198bddd14b", "chunk": "diff --git a/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java b/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java\nindex aafc2a60d..4fe941084 100644\n--- a/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java\n+++ b/src/main/java/org/primefaces/util/DynamicContentSrcBuilder.java\n\n@@ -71,7 +71,7 @@ public class DynamicContentSrcBuilder {\n                         context.getELContext(), component.getValueExpression(attributeName));\n             return build(context, streamedContent, component, cache, type, stream, expression);\n         }\n-        return encodeResourceURL(context, src, cache);\n+        return null;\n     }\n \n     public static String build(FacesContext context, StreamedContent streamedContent, UIComponent component, boolean cache,\n"}}, {"oid": "94d24f6cfa42c89e53b6e34aa8de3b198bddd14b", "url": "https://github.com/primefaces/primefaces/commit/94d24f6cfa42c89e53b6e34aa8de3b198bddd14b", "message": "Return null if no supported value type was found", "committedDate": "2020-09-01T18:21:16Z", "type": "commit"}, {"oid": "2ffc3e58fca6ac393c21a1af16af2d1bf872a78e", "url": "https://github.com/primefaces/primefaces/commit/2ffc3e58fca6ac393c21a1af16af2d1bf872a78e", "message": "Added download.js", "committedDate": "2020-09-01T18:23:59Z", "type": "commit"}, {"oid": "4b000b3813311050dba5d9546fcd0aeb71b86116", "url": "https://github.com/primefaces/primefaces/commit/4b000b3813311050dba5d9546fcd0aeb71b86116", "message": "Alphabetical order", "committedDate": "2020-09-01T19:30:29Z", "type": "commit"}]}