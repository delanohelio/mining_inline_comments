{"pr_number": 2026, "pr_title": "remove unnecessary Map", "pr_createdAt": "2020-09-08T13:09:11Z", "pr_url": "https://github.com/graphql-java/graphql-java/pull/2026", "timeline": [{"oid": "198df972b680cc2cf79388866e1526adbfc5037a", "url": "https://github.com/graphql-java/graphql-java/commit/198df972b680cc2cf79388866e1526adbfc5037a", "message": "remove unnecessary Map", "committedDate": "2020-09-08T12:45:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r484937307", "bodyText": "Create a new method NodeUtil.directiveByName(String directiveName) instead of introducing for-loops everywhere.\nSimilarly with arguments.", "author": "juriad", "createdAt": "2020-09-08T13:51:53Z", "path": "src/main/java/graphql/execution/ConditionalNodes.java", "diffHunk": "@@ -9,7 +9,6 @@\n \n import static graphql.Directives.IncludeDirective;\n import static graphql.Directives.SkipDirective;\n-import static graphql.language.NodeUtil.directivesByName;\n ", "originalCommit": "198df972b680cc2cf79388866e1526adbfc5037a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI5MjY5OA==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r485292698", "bodyText": "Thanks for you review, the reason that not implemented by util method is that there is \u2019reture\u2018 in for loop. invoking NodeUtil.directiveByName(List<Directive>,directiveName) and then determine whether the return value is null will effect the readability of method.", "author": "dugenkui03", "createdAt": "2020-09-09T02:00:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTI5NDI1Ng==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r485294256", "bodyText": "This will also affect performance", "author": "dugenkui03", "createdAt": "2020-09-09T02:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQzOTkyOA==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r485439928", "bodyText": "You are worried about performance but you have provided no evidence its an actual performance problem\nThe number of directives on an element is most likely 0 and less than 5 in most cases.\nSame with field arguments - there are just not enough of them to be a problem\nNow if we can show that these methods turn up in some \"runtime hotspot\" during execution then it starts to make more sense\nAlso the JVM is EXCELLENT at escape analysis - if it can determine that a variable NEVER escapes the frame then it will allocate objects on the stack and they will be cleaned up at near zero cost.\nreturn directivesByName(directives).get(name); is such a case - this map created can be detected as NEVER escaping this method and will be allocated on the stack", "author": "bbakerman", "createdAt": "2020-09-09T08:40:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjAzNTMyOQ==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r486035329", "bodyText": "Create a new method NodeUtil.directiveByName(String directiveName) instead of introducing for-loops everywhere.\nSimilarly with arguments.\n\nTHIS!", "author": "bbakerman", "createdAt": "2020-09-10T03:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI2OTgzMw==", "url": "https://github.com/graphql-java/graphql-java/pull/2026#discussion_r486269833", "bodyText": "Thanks for you review and explanation, the minor gc problem that I worried about would not happen.\nAs you said, the number of directives on an element will not too much, as well as the number arguments of Directive. In most cases, the improvement of this change is very limited.", "author": "dugenkui03", "createdAt": "2020-09-10T11:41:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDkzNzMwNw=="}], "type": "inlineReview", "revised_code": {"commit": "558992d0b6f06cb86c21ffa7fb65c4d887d1c41b", "chunk": "diff --git a/src/main/java/graphql/execution/ConditionalNodes.java b/src/main/java/graphql/execution/ConditionalNodes.java\nindex 24b20ea8..a018e693 100644\n--- a/src/main/java/graphql/execution/ConditionalNodes.java\n+++ b/src/main/java/graphql/execution/ConditionalNodes.java\n\n@@ -9,6 +9,7 @@ import java.util.Map;\n \n import static graphql.Directives.IncludeDirective;\n import static graphql.Directives.SkipDirective;\n+import static graphql.language.NodeUtil.directiveByName;\n \n \n @Internal\n"}}, {"oid": "558992d0b6f06cb86c21ffa7fb65c4d887d1c41b", "url": "https://github.com/graphql-java/graphql-java/commit/558992d0b6f06cb86c21ffa7fb65c4d887d1c41b", "message": "remove unnecessary Map", "committedDate": "2020-09-10T11:41:54Z", "type": "commit"}]}