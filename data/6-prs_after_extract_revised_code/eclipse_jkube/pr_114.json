{"pr_number": 114, "pr_title": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1", "pr_createdAt": "2020-03-23T04:29:41Z", "pr_url": "https://github.com/eclipse/jkube/pull/114", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIzNTAzNw==", "url": "https://github.com/eclipse/jkube/pull/114#discussion_r396235037", "bodyText": "Try to use Java native ways to achieve the same purpose.\nIf I understand correctly, we're trying to create the directory containing the file specified in the targetFileName variable.\nThis can easily be achieved with: new File(targetFileName).getParent().mkdirs(), no need to reinvent the wheel or create so many helper class methods (there are also alternatives using the new java.nio.file).\nI also see that this targetFileName should always point to a file within a directory > don't see a valid compliant use-case having this variable set to something like /archive.tar especially on *nix systems > pathParts.length > 0 shouldn't be optional.", "author": "manusa", "createdAt": "2020-03-23T06:32:19Z", "path": "jkube-kit/build/service/docker/src/main/java/org/eclipse/jkube/kit/build/core/assembly/JKubeTarArchiver.java", "diffHunk": "@@ -67,7 +67,7 @@ public File createArchive(File inputDirectory, BuildDirs buildDirs, ArchiveCompr\n                 String targetFileName = entry.getValue();\n \n                 // 1. Check whether nested directory is there, if not create it\n-                String[] pathParts = targetFileName.split(File.separator);\n+                String[] pathParts = FileUtil.splitFilePathIntoParts(targetFileName);", "originalCommit": "d2970d2d5d93803e628bef76d0be3355df9e23f9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8770114ce7b16b2b26157fd79270ddc38bf6bf42", "chunk": "diff --git a/jkube-kit/build/service/docker/src/main/java/org/eclipse/jkube/kit/build/core/assembly/JKubeTarArchiver.java b/jkube-kit/build/service/docker/src/main/java/org/eclipse/jkube/kit/build/core/assembly/JKubeTarArchiver.java\nindex f9fc7177..6d124611 100644\n--- a/jkube-kit/build/service/docker/src/main/java/org/eclipse/jkube/kit/build/core/assembly/JKubeTarArchiver.java\n+++ b/jkube-kit/build/service/docker/src/main/java/org/eclipse/jkube/kit/build/core/assembly/JKubeTarArchiver.java\n\n@@ -67,18 +67,11 @@ public class JKubeTarArchiver {\n                 String targetFileName = entry.getValue();\n \n                 // 1. Check whether nested directory is there, if not create it\n-                String[] pathParts = FileUtil.splitFilePathIntoParts(targetFileName);\n-                File parentDirectory = inputDirectory;\n-                if (pathParts.length > 0) {\n-                    StringBuilder finalPathBuilder = new StringBuilder();\n-                    for (int i = 0; i < pathParts.length - 1; i++) {\n-                        String pathPart = pathParts[i];\n-                        finalPathBuilder.append(pathPart + File.separator);\n-                    }\n-                    parentDirectory = new File(inputDirectory, finalPathBuilder.toString());\n+                File parentDirectory = new File(targetFileName).getParentFile();\n+                if (parentDirectory != null) {\n                     parentDirectory.mkdirs();\n                 }\n-                File targetFile = new File(parentDirectory, pathParts[pathParts.length - 1]);\n+                File targetFile = new File(parentDirectory, targetFileName);\n                 // Check whether file is not already created.\n                 if (!targetFile.exists()) {\n                     FileUtils.copyFile(srcFile, targetFile);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIzNzcyMw==", "url": "https://github.com/eclipse/jkube/pull/114#discussion_r396237723", "bodyText": "BTW, this comment is not accurate.\nYou have to re-escape the \\ character because String#split accepts a regex and \\ is the escape sequence for Java regular expressions, so you have to re-escape it.", "author": "manusa", "createdAt": "2020-03-23T06:42:13Z", "path": "jkube-kit/common/src/main/java/org/eclipse/jkube/kit/common/util/FileUtil.java", "diffHunk": "@@ -360,5 +360,25 @@ public static void createDirectory(File directory) throws IOException {\n             }\n         }\n     }\n+\n+    protected static String[] splitFilePathIntoParts(String filePath, String separator) {\n+        // To deal with Windows Path separators we have to do this", "originalCommit": "d2970d2d5d93803e628bef76d0be3355df9e23f9", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8770114ce7b16b2b26157fd79270ddc38bf6bf42", "chunk": "diff --git a/jkube-kit/common/src/main/java/org/eclipse/jkube/kit/common/util/FileUtil.java b/jkube-kit/common/src/main/java/org/eclipse/jkube/kit/common/util/FileUtil.java\nindex 1cb01beb..01c5116a 100644\n--- a/jkube-kit/common/src/main/java/org/eclipse/jkube/kit/common/util/FileUtil.java\n+++ b/jkube-kit/common/src/main/java/org/eclipse/jkube/kit/common/util/FileUtil.java\n\n@@ -360,25 +357,5 @@ public class FileUtil {\n             }\n         }\n     }\n-\n-    protected static String[] splitFilePathIntoParts(String filePath, String separator) {\n-        // To deal with Windows Path separators we have to do this\n-        String splitter = separator.replace(\"\\\\\", \"\\\\\\\\\");\n-        return filePath.split(splitter);\n-    }\n-\n-    /**\n-     * Split file path into an array of strings\n-     *\n-     * @param filePath path of file\n-     * @return an array contains various path elements\n-     */\n-    public static String[] splitFilePathIntoParts(String filePath) {\n-        if (filePath == null || filePath.isEmpty()) {\n-            return new String[0];\n-        }\n-\n-        return splitFilePathIntoParts(filePath, File.separator);\n-    }\n }\n \n"}}, {"oid": "8770114ce7b16b2b26157fd79270ddc38bf6bf42", "url": "https://github.com/eclipse/jkube/commit/8770114ce7b16b2b26157fd79270ddc38bf6bf42", "message": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1\n\nFix Windows specific path parsing error", "committedDate": "2020-03-23T13:16:48Z", "type": "forcePushed"}, {"oid": "e0645491c26b3def395725cbfb30c36948138c72", "url": "https://github.com/eclipse/jkube/commit/e0645491c26b3def395725cbfb30c36948138c72", "message": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1\n\nFix Windows specific path parsing error", "committedDate": "2020-03-23T16:14:12Z", "type": "forcePushed"}, {"oid": "2fabae95e8f97c14769c83fd2957959cf399fce9", "url": "https://github.com/eclipse/jkube/commit/2fabae95e8f97c14769c83fd2957959cf399fce9", "message": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1\n\nFix Windows specific path parsing error", "committedDate": "2020-03-23T17:08:41Z", "type": "forcePushed"}, {"oid": "bbbc6fd38532e07281a56c7c4ae4372b343260d1", "url": "https://github.com/eclipse/jkube/commit/bbbc6fd38532e07281a56c7c4ae4372b343260d1", "message": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1\n\nFix Windows specific path parsing error", "committedDate": "2020-03-24T07:55:04Z", "type": "commit"}, {"oid": "bbbc6fd38532e07281a56c7c4ae4372b343260d1", "url": "https://github.com/eclipse/jkube/commit/bbbc6fd38532e07281a56c7c4ae4372b343260d1", "message": "Fix #112: Quarkus Error while trying to build the image: Unexpected internal error near index 1\n\nFix Windows specific path parsing error", "committedDate": "2020-03-24T07:55:04Z", "type": "forcePushed"}]}