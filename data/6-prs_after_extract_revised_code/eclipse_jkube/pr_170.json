{"pr_number": 170, "pr_title": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin", "pr_createdAt": "2020-04-28T15:34:26Z", "pr_url": "https://github.com/eclipse/jkube/pull/170", "timeline": [{"oid": "627ad65b67b7df99f39ae022c946e049e561a873", "url": "https://github.com/eclipse/jkube/commit/627ad65b67b7df99f39ae022c946e049e561a873", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-28T15:37:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416719074", "bodyText": "This warning looks confusing \ud83d\ude15", "author": "rohanKanojia", "createdAt": "2020-04-28T15:41:26Z", "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java", "diffHunk": "@@ -114,7 +97,14 @@ public void executeInternal() throws MojoExecutionException {\n         } catch (Exception ex) {\n             throw new MojoExecutionException(\"An error has occurred while while trying to watch the resources\", ex);\n         }\n+    }\n \n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"Switch to openshift-maven-client in case there are any problems\");", "originalCommit": "627ad65b67b7df99f39ae022c946e049e561a873", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMjEzMA==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416722130", "bodyText": "Any suggestion to make thinks clearer for the user?\nWhat's basically happening is that a user is performing a k8s:watch against an Kubernetes (\ud83d\ude13) OpenShift Cluster.\nIs \"OpenShift cluster detected while using kubernetes-maven-plugin\", \"Switch to...\"  clearer?", "author": "manusa", "createdAt": "2020-04-28T15:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyNTI4OA==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416725288", "bodyText": "Yeah \ud83d\udc4d\nOpenShift cluster detected, using Kubernetes manifests.\nSwitch to openshift-maven-plugin in case there are any problems.", "author": "rohanKanojia", "createdAt": "2020-04-28T15:49:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcxOTA3NA=="}], "type": "inlineReview", "revised_code": {"commit": "a4a5107e8661128e13a2e10ad95f77c76532c183", "chunk": "diff --git a/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java b/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java\nindex bb3277b0..39ff93d9 100644\n--- a/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java\n+++ b/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/WatchMojo.java\n\n@@ -101,7 +101,7 @@ public class WatchMojo extends AbstractDockerMojo {\n \n     protected File getManifest(KubernetesClient kubernetesClient) {\n         if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n-            log.warn(\"OpenShift KubernetesClient detected, using Kubernetes YAML manifests\");\n+            log.warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n             log.warn(\"Switch to openshift-maven-client in case there are any problems\");\n         }\n         return kubernetesManifest;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjcyMTc0OQ==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r416721749", "bodyText": "nit, s/possible/possibly", "author": "rohanKanojia", "createdAt": "2020-04-28T15:44:56Z", "path": "openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java", "diffHunk": "@@ -27,8 +41,60 @@\n @Mojo(name = \"undeploy\", requiresDependencyResolution = ResolutionScope.COMPILE, defaultPhase = LifecyclePhase.INSTALL)\n public class OpenshiftUndeployMojo extends UndeployMojo {\n \n+    /**\n+     * The S2I binary builder BuildConfig name suffix appended to the image name to avoid\n+     * clashing with the underlying BuildConfig for the Jenkins pipeline\n+     */\n+    @Parameter(property = \"jkube.s2i.buildNameSuffix\", defaultValue = \"-s2i\")\n+    protected String s2iBuildNameSuffix;\n+\n+    /**\n+     * The generated openshift YAML file\n+     */\n+    @Parameter(property = \"jkube.openshiftManifest\", defaultValue = DEFAULT_OPENSHIFT_MANIFEST)\n+    private File openshiftManifest;\n+\n+    @Parameter(property = \"jkube.openshiftImageStreamManifest\", defaultValue = \"${basedir}/target/${project.artifactId}-is.yml\")\n+    private File openshiftImageStreamManifest;\n+\n+    @Override\n+    protected void applyEntities(KubernetesClient kubernetes, String namespace, String fileName, Set<HasMetadata> entities) throws Exception {\n+        super.applyEntities(kubernetes, namespace, fileName, entities);\n+        final Set<HasMetadata> openShiftEntities = Stream.concat(entities.stream(), getImageStreamManifest().stream())\n+            .collect(Collectors.toSet());\n+        deleteOpenShiftEntities(kubernetes, namespace, openShiftEntities, s2iBuildNameSuffix, log);\n+    }\n+\n+    @Override\n+    protected File getManifest(KubernetesClient kubernetesClient) {\n+        if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+            return openshiftManifest;\n+        }\n+        return super.getManifest(kubernetesClient);\n+    }\n+\n     @Override\n     protected String getLogPrefix() {\n-        return DEFAULT_LOG_PREFIX;\n+        return Openshift.DEFAULT_LOG_PREFIX;\n+    }\n+\n+    /**\n+     * Loads the ImageStream manifest that was possible created during the oc:build phase of an empty", "originalCommit": "627ad65b67b7df99f39ae022c946e049e561a873", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a4a5107e8661128e13a2e10ad95f77c76532c183", "chunk": "diff --git a/openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java b/openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java\nindex cbad4457..00e21966 100644\n--- a/openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java\n+++ b/openshift-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/develop/OpenshiftUndeployMojo.java\n\n@@ -79,7 +79,7 @@ public class OpenshiftUndeployMojo extends UndeployMojo {\n     }\n \n     /**\n-     * Loads the ImageStream manifest that was possible created during the oc:build phase of an empty\n+     * Loads the ImageStream manifest that was possibly created during the oc:build phase or an empty\n      * Set if it doesn't exist.\n      * @return the ImageStream manifest set.\n      */\n"}}, {"oid": "a4a5107e8661128e13a2e10ad95f77c76532c183", "url": "https://github.com/eclipse/jkube/commit/a4a5107e8661128e13a2e10ad95f77c76532c183", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-28T15:52:33Z", "type": "forcePushed"}, {"oid": "db42762e4682fdd2a24b7cbef80278fa1302e08a", "url": "https://github.com/eclipse/jkube/commit/db42762e4682fdd2a24b7cbef80278fa1302e08a", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-29T05:36:33Z", "type": "forcePushed"}, {"oid": "2b5171511ad59df5718b7d27230791538b360970", "url": "https://github.com/eclipse/jkube/commit/2b5171511ad59df5718b7d27230791538b360970", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-29T07:55:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjI3NQ==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r417132275", "bodyText": "Umm, any specific reason you are writing openshift-maven-client instead of openshift-maven-plugin ?? This warning would be displayed to user who might not be aware of kubernetes/openshift client being used internally", "author": "rohanKanojia", "createdAt": "2020-04-29T07:57:35Z", "path": "kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/**\n+ * Copyright (c) 2019 Red Hat, Inc.\n+ * This program and the accompanying materials are made\n+ * available under the terms of the Eclipse Public License 2.0\n+ * which is available at:\n+ *\n+ *     https://www.eclipse.org/legal/epl-2.0/\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *\n+ * Contributors:\n+ *   Red Hat, Inc. - initial API and implementation\n+ */\n+package org.eclipse.jkube.maven.plugin.mojo;\n+\n+import java.io.File;\n+\n+import org.eclipse.jkube.kit.common.util.OpenshiftHelper;\n+\n+import io.fabric8.kubernetes.client.KubernetesClient;\n+\n+public interface ManifestProvider extends KitLoggerProvider{\n+\n+  File getKubernetesManifest();\n+\n+  default File getManifest(KubernetesClient kubernetesClient) {\n+    if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n+      getKitLogger().warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n+      getKitLogger().warn(\"Switch to openshift-maven-client in case there are any problems\");", "originalCommit": "2b5171511ad59df5718b7d27230791538b360970", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMzExMg==", "url": "https://github.com/eclipse/jkube/pull/170#discussion_r417133112", "bodyText": "\ud83d\ude33 It's a typo, I was really tired yesterday.", "author": "manusa", "createdAt": "2020-04-29T07:59:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzEzMjI3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "774b4248a62691f53f9d57a625e8b35017b15f84", "chunk": "diff --git a/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java b/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java\nindex 3cc598a4..18ef8195 100644\n--- a/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java\n+++ b/kubernetes-maven-plugin/plugin/src/main/java/org/eclipse/jkube/maven/plugin/mojo/ManifestProvider.java\n\n@@ -26,7 +26,7 @@ public interface ManifestProvider extends KitLoggerProvider{\n   default File getManifest(KubernetesClient kubernetesClient) {\n     if (OpenshiftHelper.isOpenShift(kubernetesClient)) {\n       getKitLogger().warn(\"OpenShift cluster detected, using Kubernetes manifests\");\n-      getKitLogger().warn(\"Switch to openshift-maven-client in case there are any problems\");\n+      getKitLogger().warn(\"Switch to openshift-maven-plugin in case there are any problems\");\n     }\n     return getKubernetesManifest();\n   }\n"}}, {"oid": "774b4248a62691f53f9d57a625e8b35017b15f84", "url": "https://github.com/eclipse/jkube/commit/774b4248a62691f53f9d57a625e8b35017b15f84", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-29T07:59:44Z", "type": "commit"}, {"oid": "774b4248a62691f53f9d57a625e8b35017b15f84", "url": "https://github.com/eclipse/jkube/commit/774b4248a62691f53f9d57a625e8b35017b15f84", "message": "refactor: Removed OpenShift specific config flags from kubernetes-maven-plugin\n\n- Enhanced OpenshiftUndeployMojo to remove Build resources along with the BuildConfigs\n\nSigned-off-by: Marc Nuri <marc@marcnuri.com>", "committedDate": "2020-04-29T07:59:44Z", "type": "forcePushed"}]}