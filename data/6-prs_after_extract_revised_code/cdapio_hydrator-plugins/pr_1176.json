{"pr_number": 1176, "pr_title": "[PLUGIN-370] Improved Cassandra Validations", "pr_createdAt": "2020-08-14T02:00:33Z", "pr_url": "https://github.com/cdapio/hydrator-plugins/pull/1176", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NzE1NA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1176#discussion_r470377154", "bodyText": "more clear to put in this way:\n!containsMacro(Cassandra.USERNAME) && !containsMacro(Cassandra.PASSWORD) && (Strings.isNullOrEmpty(username) ^ Strings.isNullOrEmpty(password))", "author": "shifuxu0301", "createdAt": "2020-08-14T02:34:23Z", "path": "cassandra-plugins/src/main/java/io/cdap/plugin/batch/source/BatchCassandraSource.java", "diffHunk": "@@ -273,6 +272,22 @@ private Schema getSchema() {\n         throw new IllegalArgumentException(\"Invalid schema: \" + e.getMessage());\n       }\n     }\n+\n+    public void validate(FailureCollector collector) {\n+      if (Strings.isNullOrEmpty(schema)) {\n+        collector.addFailure(\"Schema must be specified.\", null).withConfigProperty(Cassandra.SCHEMA);\n+      }\n+      if (port != null && (port < 1 || port > 65535)) {\n+        collector.addFailure(\"Invalid port.\", \"Port number must be an integer from 1 to 65535.\")\n+          .withConfigProperty(BatchCassandraSink.Cassandra.PORT);\n+      }\n+      if ((!containsMacro(Cassandra.USERNAME) && !containsMacro(Cassandra.PASSWORD)) &&", "originalCommit": "e1838b518da6a4465270a68eef133429b2f625f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjEwMA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1176#discussion_r470392100", "bodyText": "Fixed", "author": "dli357", "createdAt": "2020-08-14T03:39:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NzE1NA=="}], "type": "inlineReview", "revised_code": {"commit": "5889119595e33103f65148d8cf269af7cc15a9db", "chunk": "diff --git a/cassandra-plugins/src/main/java/io/cdap/plugin/batch/source/BatchCassandraSource.java b/cassandra-plugins/src/main/java/io/cdap/plugin/batch/source/BatchCassandraSource.java\nindex c2565334..5487eb46 100644\n--- a/cassandra-plugins/src/main/java/io/cdap/plugin/batch/source/BatchCassandraSource.java\n+++ b/cassandra-plugins/src/main/java/io/cdap/plugin/batch/source/BatchCassandraSource.java\n\n@@ -278,10 +278,10 @@ public class BatchCassandraSource extends ReferenceBatchSource<Long, Row, Struct\n         collector.addFailure(\"Schema must be specified.\", null).withConfigProperty(Cassandra.SCHEMA);\n       }\n       if (port != null && (port < 1 || port > 65535)) {\n-        collector.addFailure(\"Invalid port.\", \"Port number must be an integer from 1 to 65535.\")\n+        collector.addFailure(\"Invalid port number.\", \"Port number must be an integer from 1 to 65535.\")\n           .withConfigProperty(BatchCassandraSink.Cassandra.PORT);\n       }\n-      if ((!containsMacro(Cassandra.USERNAME) && !containsMacro(Cassandra.PASSWORD)) &&\n+      if (!containsMacro(Cassandra.USERNAME) && !containsMacro(Cassandra.PASSWORD) &&\n         Strings.isNullOrEmpty(username) ^ Strings.isNullOrEmpty(password)) {\n         collector.addFailure(\"Invalid username and password combination.\",\n                              \"You must either set both username and password or neither username nor password.\")\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NzM5Mg==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1176#discussion_r470377392", "bodyText": "\"Invalid port number.\" Same thing below.", "author": "shifuxu0301", "createdAt": "2020-08-14T02:35:17Z", "path": "cassandra-plugins/src/main/java/io/cdap/plugin/batch/sink/BatchCassandraSink.java", "diffHunk": "@@ -178,6 +189,13 @@ public CassandraBatchConfig(String referenceName, String partitioner, @Nullable\n       this.columns = columns;\n       this.primaryKey = primaryKey;\n     }\n+\n+    public void validate(FailureCollector collector) {\n+      if (port != null && (port < 1 || port > 65535)) {\n+        collector.addFailure(\"Invalid port.\", \"Port number must be an integer from 1 to 65535.\")", "originalCommit": "e1838b518da6a4465270a68eef133429b2f625f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM5MjI0OA==", "url": "https://github.com/cdapio/hydrator-plugins/pull/1176#discussion_r470392248", "bodyText": "Fixed", "author": "dli357", "createdAt": "2020-08-14T03:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM3NzM5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5889119595e33103f65148d8cf269af7cc15a9db", "chunk": "diff --git a/cassandra-plugins/src/main/java/io/cdap/plugin/batch/sink/BatchCassandraSink.java b/cassandra-plugins/src/main/java/io/cdap/plugin/batch/sink/BatchCassandraSink.java\nindex a5803c89..4bbeca31 100644\n--- a/cassandra-plugins/src/main/java/io/cdap/plugin/batch/sink/BatchCassandraSink.java\n+++ b/cassandra-plugins/src/main/java/io/cdap/plugin/batch/sink/BatchCassandraSink.java\n\n@@ -192,7 +192,7 @@ public class BatchCassandraSink\n \n     public void validate(FailureCollector collector) {\n       if (port != null && (port < 1 || port > 65535)) {\n-        collector.addFailure(\"Invalid port.\", \"Port number must be an integer from 1 to 65535.\")\n+        collector.addFailure(\"Invalid port number.\", \"Port number must be an integer from 1 to 65535.\")\n           .withConfigProperty(Cassandra.PORT);\n       }\n     }\n"}}, {"oid": "5889119595e33103f65148d8cf269af7cc15a9db", "url": "https://github.com/cdapio/hydrator-plugins/commit/5889119595e33103f65148d8cf269af7cc15a9db", "message": "[PLUGIN-370] Moved validations to helper, added port validation, validate username password combo in deployment\n\n[PLUGIN-370] Shorten username password conditional, improve error messages for ports", "committedDate": "2020-08-14T03:44:51Z", "type": "commit"}, {"oid": "5889119595e33103f65148d8cf269af7cc15a9db", "url": "https://github.com/cdapio/hydrator-plugins/commit/5889119595e33103f65148d8cf269af7cc15a9db", "message": "[PLUGIN-370] Moved validations to helper, added port validation, validate username password combo in deployment\n\n[PLUGIN-370] Shorten username password conditional, improve error messages for ports", "committedDate": "2020-08-14T03:44:51Z", "type": "forcePushed"}]}