{"pr_number": 794, "pr_title": "v4 fluentlite, bug fixes", "pr_createdAt": "2020-11-17T07:00:56Z", "pr_url": "https://github.com/Azure/autorest.java/pull/794", "timeline": [{"oid": "5c74134d635711484b5e3ded0ecd276748da5684", "url": "https://github.com/Azure/autorest.java/commit/5c74134d635711484b5e3ded0ecd276748da5684", "message": "add override of flatten-payload=false in lite", "committedDate": "2020-11-17T06:35:15Z", "type": "commit"}, {"oid": "31330a74309409fc524b2ff114f1b2db735f8f7e", "url": "https://github.com/Azure/autorest.java/commit/31330a74309409fc524b2ff114f1b2db735f8f7e", "message": "Relation could have type AnySchema in it", "committedDate": "2020-11-17T06:59:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMzA5MQ==", "url": "https://github.com/Azure/autorest.java/pull/794#discussion_r524923091", "bodyText": "It actually get a AnySchema in it, in this spec (though for me, that definition does not make much sense) https://github.com/Azure/azure-rest-api-specs/blob/master/specification/cloudshell/resource-manager/Microsoft.Portal/stable/2018-10-01/CloudShell.json#L789-L809", "author": "weidongxu-microsoft", "createdAt": "2020-11-17T07:02:33Z", "path": "extension-base/src/main/java/com/azure/autorest/extension/base/model/codemodel/Relations.java", "diffHunk": "@@ -3,23 +3,23 @@\n import java.util.List;\n \n public class Relations {\n-    private List<ComplexSchema> all;\n+    private List<Schema> all;\n \n-    private List<ComplexSchema> immediate;\n+    private List<Schema> immediate;", "originalCommit": "31330a74309409fc524b2ff114f1b2db735f8f7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyNDE4MA==", "url": "https://github.com/Azure/autorest.java/pull/794#discussion_r524924180", "bodyText": "The change should not affect existing logic. For child class, it definitely still need to be ObjectSchema. For parent class, AnySchema will be ignored (not able to do much anyway). Currently for parent class, ObjectSchema is good, DictionarySchema will be converted to additionalProperties.", "author": "weidongxu-microsoft", "createdAt": "2020-11-17T07:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMzA5MQ=="}], "type": "inlineReview", "revised_code": null}, {"oid": "645c7780ec5829755c0d67a5b848fd9cf6bb1640", "url": "https://github.com/Azure/autorest.java/commit/645c7780ec5829755c0d67a5b848fd9cf6bb1640", "message": "add jianghao to owner", "committedDate": "2020-11-17T07:11:19Z", "type": "commit"}, {"oid": "9f1997311365e6ee875e2aaa6d107e8636e7b529", "url": "https://github.com/Azure/autorest.java/commit/9f1997311365e6ee875e2aaa6d107e8636e7b529", "message": "throw exception for schema error", "committedDate": "2020-11-17T07:37:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzNzgyMg==", "url": "https://github.com/Azure/autorest.java/pull/794#discussion_r524937822", "bodyText": "This is spec error. Some pageable in spec does not have \"value\" property.", "author": "weidongxu-microsoft", "createdAt": "2020-11-17T07:39:01Z", "path": "javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java", "diffHunk": "@@ -75,9 +76,14 @@ public static ClientMethodMapper getInstance() {\n             Schema responseBodySchema = SchemaUtil.getLowestCommonParent(\n                     operation.getResponses().stream().map(Response::getSchema).filter(Objects::nonNull).collect(Collectors.toList()));\n             ClientModel responseBodyModel = Mappers.getModelMapper().map((ObjectSchema) responseBodySchema);\n-            IType listType = responseBodyModel.getProperties().stream()\n+            Optional<ClientModelProperty> itemPropertyOpt = responseBodyModel.getProperties().stream()\n                     .filter(p -> p.getSerializedName().equals(operation.getExtensions().getXmsPageable().getItemName()))\n-                    .findFirst().get().getWireType();\n+                    .findFirst();\n+            if (!itemPropertyOpt.isPresent()) {\n+                throw new IllegalArgumentException(String.format(\"[JavaCheck/SchemaError] item name %s not found among properties of client model %s\",\n+                        operation.getExtensions().getXmsPageable().getItemName(), responseBodyModel.getName()));\n+            }", "originalCommit": "9f1997311365e6ee875e2aaa6d107e8636e7b529", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "9683476a0e3bc850d62410c7ac673a0b591f7777", "url": "https://github.com/Azure/autorest.java/commit/9683476a0e3bc850d62410c7ac673a0b591f7777", "message": "add exception when discriminator is not found", "committedDate": "2020-11-17T08:06:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk1NTQ4Nw==", "url": "https://github.com/Azure/autorest.java/pull/794#discussion_r524955487", "bodyText": "This appear to be m4 problem. Spec put the discriminator property to a parent class.\nhttps://github.com/Azure/azure-rest-api-specs/blob/master/specification/security/resource-manager/Microsoft.Security/stable/2020-01-01/externalSecuritySolutions.json#L180-L199", "author": "weidongxu-microsoft", "createdAt": "2020-11-17T08:08:45Z", "path": "javagen/src/main/java/com/azure/autorest/util/SchemaUtil.java", "diffHunk": "@@ -90,13 +89,17 @@ public static String getDiscriminatorSerializedName(ObjectSchema compositeType)\n         if (compositeType.getDiscriminator() != null) {\n             discriminator = compositeType.getDiscriminator().getProperty().getSerializedName();\n         } else if (compositeType.getDiscriminatorValue() != null) {\n-            for (ComplexSchema parent : compositeType.getParents().getAll()) {\n-                if (((ObjectSchema) parent).getDiscriminator() != null) {\n+            for (Schema parent : compositeType.getParents().getAll()) {\n+                if (parent instanceof ObjectSchema && ((ObjectSchema) parent).getDiscriminator() != null) {\n                     discriminator = ((ObjectSchema) parent).getDiscriminator().getProperty().getSerializedName();\n                     break;\n                 }\n             }\n         }\n+        if (discriminator == null) {\n+            throw new IllegalStateException(String.format(\"discriminator not found in type %s and its parents\",\n+                    compositeType.getLanguage().getJava().getName()));\n+        }", "originalCommit": "9683476a0e3bc850d62410c7ac673a0b591f7777", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}