{"pr_number": 573, "pr_title": "Add context to single page async client methods", "pr_createdAt": "2020-04-10T09:52:32Z", "pr_url": "https://github.com/Azure/autorest.java/pull/573", "timeline": [{"oid": "6bb4ea8ebef89cc59cd3e8b71cf64395ade84b3c", "url": "https://github.com/Azure/autorest.java/commit/6bb4ea8ebef89cc59cd3e8b71cf64395ade84b3c", "message": "Add context to single page async client methods", "committedDate": "2020-04-10T09:49:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5MzkwMQ==", "url": "https://github.com/Azure/autorest.java/pull/573#discussion_r406693901", "bodyText": "Not sure whether need to set all these?\nIt seems to me that only thing need to be swapped is withContextParameters? All rest appears to be same as the builder from input parameter?", "author": "weidongxu-microsoft", "createdAt": "2020-04-10T10:05:56Z", "path": "javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java", "diffHunk": "@@ -360,6 +348,37 @@ public static ClientMethodMapper getInstance() {\n         return methods;\n     }\n \n+    private void addClientMethodWithContext(List<ClientMethod> methods, Builder builder, ProxyMethod proxyMethod,\n+        List<ClientMethodParameter> parameters, ClientMethodType clientMethodType, String proxyMethodName,\n+        ReturnValue returnValue) {\n+        ClientMethodParameter contextParam = new ClientMethodParameter.Builder()\n+            .description(\"The context to associate with this operation.\")\n+            .wireType(ClassType.Context)\n+            .name(\"context\")\n+            .annotations(new ArrayList<>())\n+            .isConstant(false)\n+            .defaultValue(null)\n+            .fromClient(false)\n+            .isFinal(false)\n+            .isRequired(true)\n+            .build();\n+\n+        List<ClientMethodParameter> withContextParameters = new ArrayList<>();\n+        withContextParameters.addAll(parameters);\n+        withContextParameters.add(contextParam);\n+\n+        methods.add(builder\n+            .parameters(withContextParameters) // update builder parameters to include context\n+            .returnValue(returnValue)\n+            .name(proxyMethodName)\n+            .onlyRequiredParameters(false)\n+            .type(clientMethodType)\n+            .isGroupedParameterRequired(false)", "originalCommit": "6bb4ea8ebef89cc59cd3e8b71cf64395ade84b3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg4MDg5Mg==", "url": "https://github.com/Azure/autorest.java/pull/573#discussion_r406880892", "bodyText": "Yes, you're right that the builder is already configured with these values from the previous client method but I didn't want to make an assumption that this method would be added only after the non-context method is added.", "author": "srnagar", "createdAt": "2020-04-10T18:19:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5MzkwMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2MTY2OQ==", "url": "https://github.com/Azure/autorest.java/pull/573#discussion_r406861669", "bodyText": "nit: JavaSettings.getInstance() is assigned to a local variable settings on line 53", "author": "jianghaolu", "createdAt": "2020-04-10T17:33:22Z", "path": "javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java", "diffHunk": "@@ -196,6 +197,12 @@ public static ClientMethodMapper getInstance() {\n                         .type(ClientMethodType.PagingAsyncSinglePage)\n                         .isGroupedParameterRequired(false)\n                         .build());\n+                if (JavaSettings.getInstance().isContextClientMethodParameter()) {", "originalCommit": "6bb4ea8ebef89cc59cd3e8b71cf64395ade84b3c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg5MDQ5Ng==", "url": "https://github.com/Azure/autorest.java/pull/573#discussion_r406890496", "bodyText": "Updated to just use settings", "author": "srnagar", "createdAt": "2020-04-10T18:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg2MTY2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "68ca5b04a3b3e7260d51550a94e235b3e6546a06", "chunk": "diff --git a/javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java b/javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java\nindex c1f23a98..b6f34e7d 100644\n--- a/javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java\n+++ b/javagen/src/main/java/com/azure/autorest/mapper/ClientMethodMapper.java\n\n@@ -197,7 +197,7 @@ public class ClientMethodMapper implements IMapper<Operation, List<ClientMethod>\n                         .type(ClientMethodType.PagingAsyncSinglePage)\n                         .isGroupedParameterRequired(false)\n                         .build());\n-                if (JavaSettings.getInstance().isContextClientMethodParameter()) {\n+                if (settings.isContextClientMethodParameter()) {\n                     addClientMethodWithContext(methods, builder, proxyMethod, parameters,\n                         ClientMethodType.PagingAsyncSinglePage, proxyMethod.getPagingAsyncSinglePageMethodName(),\n                         new ReturnValue(returnTypeDescription(operation, asyncRestResponseReturnType, syncReturnType),\n"}}, {"oid": "68ca5b04a3b3e7260d51550a94e235b3e6546a06", "url": "https://github.com/Azure/autorest.java/commit/68ca5b04a3b3e7260d51550a94e235b3e6546a06", "message": "Address review comments", "committedDate": "2020-04-10T18:20:17Z", "type": "commit"}]}