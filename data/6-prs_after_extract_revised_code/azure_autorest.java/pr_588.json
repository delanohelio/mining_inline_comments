{"pr_number": 588, "pr_title": "v4 mgmt validate, and support ClientLogger", "pr_createdAt": "2020-04-20T07:05:45Z", "pr_url": "https://github.com/Azure/autorest.java/pull/588", "timeline": [{"oid": "0139fb4ce60a9448e30692290e8e57a2c061ca75", "url": "https://github.com/Azure/autorest.java/commit/0139fb4ce60a9448e30692290e8e57a2c061ca75", "message": "adjust a bit for validate; also add javadoc", "committedDate": "2020-04-20T06:53:24Z", "type": "commit"}, {"oid": "0890461a755c3aee2e55f32e7cd152f966ffe507", "url": "https://github.com/Azure/autorest.java/commit/0890461a755c3aee2e55f32e7cd152f966ffe507", "message": "regen tests", "committedDate": "2020-04-20T07:02:33Z", "type": "commit"}, {"oid": "1eea26019ee58c39dad530ee27b5fb9f796a9375", "url": "https://github.com/Azure/autorest.java/commit/1eea26019ee58c39dad530ee27b5fb9f796a9375", "message": "add a depth to GenericType, to avoid duplidate variable name", "committedDate": "2020-04-20T07:59:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE3MzI1OA==", "url": "https://github.com/Azure/autorest.java/pull/588#discussion_r411173258", "bodyText": "To generate this compositeIndexes().forEach(e -> e.forEach(e1 -> e1.validate()));\nProbably not a good fix. Any suggestion?", "author": "weidongxu-microsoft", "createdAt": "2020-04-20T08:00:55Z", "path": "javagen/src/main/java/com/azure/autorest/model/clientmodel/ListType.java", "diffHunk": "@@ -30,10 +30,19 @@ public void addImportsTo(Set<String> imports, boolean includeImplementationImpor\n         super.addImportsTo(imports, includeImplementationImports);\n     }\n \n+    @Override\n     public String validate(String expression) {\n-        String elementValidation = getElementType().validate(\"e\");\n+        return validate(expression, 0);\n+    }\n+\n+    @Override\n+    public String validate(String expression, int depth) {\n+        String var = depth == 0 ? \"e\" : \"e\" + depth;\n+        String elementValidation = getElementType() instanceof GenericType\n+                ? ((GenericType) getElementType()).validate(var, ++depth)\n+                : getElementType().validate(var);", "originalCommit": "1eea26019ee58c39dad530ee27b5fb9f796a9375", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"oid": "d62fdff2e2d7d63193401a7acd82d315c4ed87eb", "url": "https://github.com/Azure/autorest.java/commit/d62fdff2e2d7d63193401a7acd82d315c4ed87eb", "message": "add option for ClientLogger", "committedDate": "2020-04-20T08:48:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTIwNTMxNA==", "url": "https://github.com/Azure/autorest.java/pull/588#discussion_r411205314", "bodyText": "For support this exception through ClientLogger.\n            throw logger\n                .logExceptionAsError(\n                    new IllegalArgumentException(\n                        \"Missing required property keyName in model StorageAccountRegenerateKeyParameters\"));", "author": "weidongxu-microsoft", "createdAt": "2020-04-20T08:50:37Z", "path": "javagen/src/main/java/com/azure/autorest/template/ModelTemplate.java", "diffHunk": "@@ -252,20 +261,36 @@ public final void write(ClientModel model, JavaFile javaFile) {\n \n     private void addPropertyValidations(JavaClass classBlock, ClientModel model, JavaSettings settings) {\n         if (settings.shouldClientSideValidations()) {\n-            if (model.getParentModelName() != null) {\n+            boolean validateOnParent = this.validateOnParentModel(model.getParentModelName());\n+\n+            // javadoc\n+            classBlock.javadocComment(settings.getMaximumJavadocCommentWidth(), (comment) -> {\n+                comment.description(\"Validates the instance.\");\n+\n+                comment.methodThrows(\"IllegalArgumentException\", \"thrown if the instance is not valid\");\n+            });\n+\n+            if (validateOnParent) {\n                 classBlock.annotation(\"Override\");\n             }\n             classBlock.publicMethod(\"void validate()\", methodBlock -> {\n-                if (model.getParentModelName() != null) {\n+                if (validateOnParent) {\n                     methodBlock.line(\"super.validate();\");\n                 }\n                 for (ClientModelProperty property : model.getProperties()) {\n                     String validation = property.getClientType().validate(property.getGetterName() + \"()\");\n                     if (property.isRequired() && !property.getIsReadOnly() && !property.getIsConstant() && !(property.getClientType() instanceof PrimitiveType)) {\n                         JavaIfBlock nullCheck = methodBlock.ifBlock(String.format(\"%s() == null\", property.getGetterName()), ifBlock -> {\n-                            ifBlock.line(String.format(\n-                                    \"throw new IllegalArgumentException(\\\"Missing required property %s in model %s\\\");\",\n-                                    property.getName(), model.getName()));\n+                            final String errorMessage = String.format(\"\\\"Missing required property %s in model %s\\\"\", property.getName(), model.getName());\n+                            if (settings.shouldClientLogger()) {\n+                                ifBlock.line(String.format(\n+                                        \"throw logger.logExceptionAsError(new IllegalArgumentException(%s));\",\n+                                        errorMessage));", "originalCommit": "d62fdff2e2d7d63193401a7acd82d315c4ed87eb", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}