{"pr_number": 4335, "pr_title": "DHFPROD-5266:Add step to flow", "pr_createdAt": "2020-08-04T20:13:33Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4335", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY5MzIwMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4335#discussion_r465693201", "bodyText": "This looks good, but can you move it to FlowManagerImpl? I think the scope of ScaffoldingImpl should be limited to scaffolding out new file in a project, whereas this is a flow-specific operation.", "author": "rjrudin", "createdAt": "2020-08-05T12:35:10Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ScaffoldingImpl.java", "diffHunk": "@@ -173,6 +174,29 @@ public static String getAbsolutePath(String first, String... more) {\n         }\n     }\n \n+    public Pair<File, String> addStepToFlow(String flowName, String stepName, String stepType) {", "originalCommit": "f8b1c847dd848b592c0da085c751e349f23f1064", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "813281ce3dbd9315aa7ced2963d82d81b3372e0f", "chunk": "diff --git a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ScaffoldingImpl.java b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ScaffoldingImpl.java\nindex bcfc83478..a7d99596d 100644\n--- a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ScaffoldingImpl.java\n+++ b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/ScaffoldingImpl.java\n\n@@ -174,29 +173,6 @@ public class ScaffoldingImpl implements Scaffolding {\n         }\n     }\n \n-    public Pair<File, String> addStepToFlow(String flowName, String stepName, String stepType) {\n-        StepDefinitionType stepDefType = StepDefinitionType.getStepDefinitionType(stepType);\n-        Assert.notNull(stepDefType, \"Unrecognized step type: \" + stepType);\n-        File flowFile = hubConfig.getFlowsDir().resolve(flowName + \".flow.json\").toFile();\n-        JsonNode flow;\n-        try{\n-            DatabaseClient stagingClient = hubConfig.newHubClient().getStagingClient();\n-            FlowService flowService = FlowService.on(stagingClient);\n-            flow = flowService.addStepToFlow(flowName, stepName, stepType);\n-        }\n-        catch (Exception e) {\n-            throw new RuntimeException(\"Unable to add step '\" + stepName + \"' to flow'\" + flowName + \"'; cause: \" + e.getMessage(), e);\n-        }\n-        ObjectMapper objectMapper = new ObjectMapper();\n-\n-        try {\n-            objectMapper.writerWithDefaultPrettyPrinter().writeValue(flowFile, flow);\n-            return Pair.of(flowFile, \"Added step '\" + stepName + \"' to flow '\" + flowName + \"'.\");\n-        } catch (IOException e) {\n-            throw new RuntimeException(\"Unable to write flow to file: \" + flowFile.getAbsolutePath() + \"; cause: \" + e.getMessage(), e);\n-        }\n-    }\n-\n     @Override public Path getLegacyFlowDir(String entityName, String flowName, FlowType flowType) {\n         Path entityDir = hubConfig.getHubProject().getEntityDir(entityName);\n         Path typeDir = entityDir.resolve(flowType.toString());\n"}}, {"oid": "813281ce3dbd9315aa7ced2963d82d81b3372e0f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/813281ce3dbd9315aa7ced2963d82d81b3372e0f", "message": "DHFPROD-5266:Add step to flow", "committedDate": "2020-08-05T15:43:37Z", "type": "commit"}, {"oid": "813281ce3dbd9315aa7ced2963d82d81b3372e0f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/813281ce3dbd9315aa7ced2963d82d81b3372e0f", "message": "DHFPROD-5266:Add step to flow", "committedDate": "2020-08-05T15:43:37Z", "type": "forcePushed"}]}