{"pr_number": 3439, "pr_title": "DHFPROD-3935: Fixing ValidateMappingTest", "pr_createdAt": "2020-01-08T20:20:09Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3439", "timeline": [{"oid": "2746a5c73d4e953b8f8d466c950672368e296fa9", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2746a5c73d4e953b8f8d466c950672368e296fa9", "message": "DHFPROD-3935: Fixing ValidateMappingTest\n\nIt started failing because it was accessing adminHubConfig before ensuring it was initialized to use flow-developer as a user.\n\nPerhaps HubTestBase should be doing this before every test?? Otherwise there's the chance that one test modified adminHubConfig, and that bleeds over into the next test, causing an error.", "committedDate": "2020-01-08T20:19:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQzMTcwNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3439#discussion_r364431705", "bodyText": "I wanted to ensure that \"data-hub-developer\" role can deploy artifacts and modules but missed to use this config in HubTestBase.setupProjectForRunningTestFlow().I think the method setupProjectForRunningTestFlow() can be changed to use that config so that we can test \"data-hub-developer\" role can deploy artifacts and modules\nJust an FYI, I added \"any-uri\" privilege to \"data-hub-developer\" so that it can deploy mappings and entities which are protected by uri privileges", "author": "srinathgit", "createdAt": "2020-01-08T20:37:04Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/flow/FlowRunWithDataHubOperatorTest.java", "diffHunk": "@@ -105,7 +105,7 @@ public void setupEach() throws Exception {\n         //Copy mapping functions\n         FileUtils.copyFileToDirectory(getResourceFile(\"flow-runner-test/mapping-functions/add-function.xqy\"),\n             adminHubConfig.getHubProject().getCustomMappingFunctionsDir().toFile());\n-        setupProjectForRunningTestFlow(getHubFlowRunnerConfig(\"test-data-hub-developer\", \"test-data-hub-developer\"));\n+        setupProjectForRunningTestFlow();\n ", "originalCommit": "2746a5c73d4e953b8f8d466c950672368e296fa9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ0OTY0MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3439#discussion_r364449641", "bodyText": "I don't believe calling getHubFlowRunnerConfig(\"test-data-hub-developer\", \"test-data-hub-developer\") was having any effect though, because the second line of setupProjectForRunningTestFlow is a call to \"getDataHubAdminConfig();\", which therefore overrides the effect of getHubFlowRunnerConfig. So flow-developer was still being used to load artifacts and modules.\nFlowRunWithDataHubOperatorTest then calls getHubFlowRunnerConfig after calling setupProjectForRunningTestFlow, which ensures the flow is run as that user.\nIf your goal is to ensure that data-hub-developer can load artifacts and modules, I don't think this is the right test for that (and that wasn't happening either). DataHubDeveloperTest has a task19LoadModulesAndArtifacts test in it - perhaps that needs to be enhanced?", "author": "rjrudin", "createdAt": "2020-01-08T21:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQzMTcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1ODg2OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3439#discussion_r364458868", "bodyText": "Yeah, I missed to use getHubFlowRunnerConfig(\"test-data-hub-developer\", \"test-data-hub-developer\") to deploy artifacts, modules in HubTestBase.setupProjectForRunningTestFlow(). I will modify the task19LoadModulesAndArtifacts later", "author": "srinathgit", "createdAt": "2020-01-08T21:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQzMTcwNQ=="}], "type": "inlineReview", "revised_code": null}]}