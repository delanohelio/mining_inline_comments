{"pr_number": 3538, "pr_title": "DHFPROD-4258:Provide host, stagingPort info to UI and some refactoring", "pr_createdAt": "2020-01-31T21:26:54Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3538", "timeline": [{"oid": "072b237bec35deb478076fa8937749f683a3a53b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/072b237bec35deb478076fa8937749f683a3a53b", "message": "DHFPROD-4258:Provide host, stagingPort info to UI and some refactoring", "committedDate": "2020-02-01T00:18:10Z", "type": "commit"}, {"oid": "072b237bec35deb478076fa8937749f683a3a53b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/072b237bec35deb478076fa8937749f683a3a53b", "message": "DHFPROD-4258:Provide host, stagingPort info to UI and some refactoring", "committedDate": "2020-02-01T00:18:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc5MTczMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3538#discussion_r373791731", "bodyText": "I know this has been merged already, but I really encourage trying to minimize dependencies on HubConfig. Note that some of it is user-specific, but most of it is not. HubProject is not user-specific, and ideally that can be depended on without depending on HubConfig. Staging port is not user-specific. It's awkward because this is depending on a user-specific object for data that isn't user-specific.", "author": "rjrudin", "createdAt": "2020-02-01T17:33:37Z", "path": "one-ui/src/main/java/com/marklogic/hub/oneui/services/EnvironmentConfig.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright 2012-2019 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.oneui.services;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnore;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.marklogic.hub.DatabaseKind;\n+import com.marklogic.hub.HubProject;\n+import com.marklogic.hub.impl.Versions;\n+import com.marklogic.hub.oneui.models.HubConfigSession;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class EnvironmentConfig {\n+\n+    private String projectDir;\n+    private String projectName;\n+    private String dataHubVersion;\n+    private String marklogicVersion;\n+    private int stagingPort;\n+    private String host;\n+\n+    @Autowired\n+    @JsonIgnore\n+    private HubConfigSession hubConfig;", "originalCommit": "072b237bec35deb478076fa8937749f683a3a53b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ2OTExNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3538#discussion_r374469116", "bodyText": "@rjrudin ,\nIn one-ui, HubConfigSession is the first object created and hence every object depends on it. If I autowire, HubProject object, it's value is  is null ,so it has to be obtained from HubConfigSession and hence the dependency on it.", "author": "srinathgit", "createdAt": "2020-02-04T04:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc5MTczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDY0ODg1MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3538#discussion_r374648850", "bodyText": "Isn't there a Spring container running by the time the user logs in (which I assume results in the creation of a HubConfigSession), and couldn't HubProject just be obtained from the Spring container?", "author": "rjrudin", "createdAt": "2020-02-04T12:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc5MTczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgxNzI4Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3538#discussion_r374817283", "bodyText": "Yeah, the HubProject is created prior to the user logging in by the Spring container but it's fields are all null. That's why I had to get the project from HubConfigSession.", "author": "srinathgit", "createdAt": "2020-02-04T17:33:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc5MTczMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgyNzQ0NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3538#discussion_r374827444", "bodyText": "That seems strange that the HubProject fields are null, as it's not a user-specific object, and thus I wouldn't think that its state depends on a user being logged in. I would think that when the application starts up, a HubProjectImpl can be fully initialized and stored as a singleton in the Spring container.", "author": "rjrudin", "createdAt": "2020-02-04T17:54:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc5MTczMQ=="}], "type": "inlineReview", "revised_code": null}]}