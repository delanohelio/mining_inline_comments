{"pr_number": 3778, "pr_title": "DHFPROD-4727: Fixing MasterTest failure", "pr_createdAt": "2020-04-02T14:39:10Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3778", "timeline": [{"oid": "cec3f41a0b8555440573736e2c34bfa7097f6a26", "url": "https://github.com/marklogic/marklogic-data-hub/commit/cec3f41a0b8555440573736e2c34bfa7097f6a26", "message": "DHFPROD-4727: Fixing MasterTest failure\n\nAlso speeding up bootstrap by deploying the test final-database.json via a single call, as opposed to all the overhead of datahub.updateIndexes()", "committedDate": "2020-04-02T16:10:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1MjE4OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3778#discussion_r402452189", "bodyText": "The param datahub can be removed.", "author": "rahulvudutala", "createdAt": "2020-04-02T16:36:37Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/bootstrap/Installer.java", "diffHunk": "@@ -85,15 +88,14 @@ public void bootstrapHub() {\n      * @param dataHub", "originalCommit": "cec3f41a0b8555440573736e2c34bfa7097f6a26", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "fa4015f0da2be1048b050a35d13cbf7aba2fed9b", "chunk": "diff --git a/marklogic-data-hub/src/test/java/com/marklogic/bootstrap/Installer.java b/marklogic-data-hub/src/test/java/com/marklogic/bootstrap/Installer.java\nindex 2d489dc7a..368b36dc4 100644\n--- a/marklogic-data-hub/src/test/java/com/marklogic/bootstrap/Installer.java\n+++ b/marklogic-data-hub/src/test/java/com/marklogic/bootstrap/Installer.java\n\n@@ -85,16 +88,19 @@ public class Installer extends HubTestBase implements InitializingBean {\n      * database changes go away as a result of some test that runs in our test suite before RMLUTT. So RMLUTT has to\n      * run this again to ensure that the indexes it depends on are present. Sigh.\n      *\n-     * @param dataHub\n      * @param hubConfig\n      */\n     public static void applyDatabasePropertiesForTests(HubConfig hubConfig) {\n-        File file = Paths.get(\"src\", \"test\", \"ml-config\", \"databases\",\"final-database.json\").toFile();\n+        File testFile = Paths.get(\"src\", \"test\", \"ml-config\", \"databases\", \"final-database.json\").toFile();\n         try {\n-            String payload = new String(FileCopyUtils.copyToByteArray(file));\n+            String payload = new String(FileCopyUtils.copyToByteArray(testFile));\n             new DatabaseManager(hubConfig.getManageClient()).save(payload);\n+            // Gotta rerun this command since the test file has path range indexes in it\n+            DeployDatabaseFieldCommand command = new DeployDatabaseFieldCommand();\n+            command.setResourceFilenamesIncludePattern(Pattern.compile(\"final-database.xml\"));\n+            command.execute(new CommandContext(hubConfig.getAppConfig(), hubConfig.getManageClient(), null));\n         } catch (IOException ioe) {\n-            throw new RuntimeException(\"Unable to deploy test indexes from file: \" + file, ioe);\n+            throw new RuntimeException(\"Unable to deploy test indexes from file: \" + testFile, ioe);\n         }\n     }\n \n"}}, {"oid": "fa4015f0da2be1048b050a35d13cbf7aba2fed9b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/fa4015f0da2be1048b050a35d13cbf7aba2fed9b", "message": "DHFPROD-4727: Fixing MasterTest failure\n\nAlso speeding up bootstrap by deploying the test final-database.json via a single call, as opposed to all the overhead of datahub.updateIndexes()", "committedDate": "2020-04-02T19:25:05Z", "type": "forcePushed"}, {"oid": "fa4015f0da2be1048b050a35d13cbf7aba2fed9b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/fa4015f0da2be1048b050a35d13cbf7aba2fed9b", "message": "DHFPROD-4727: Fixing MasterTest failure\n\nAlso speeding up bootstrap by deploying the test final-database.json via a single call, as opposed to all the overhead of datahub.updateIndexes()", "committedDate": "2020-04-02T19:25:05Z", "type": "commit"}]}