{"pr_number": 4905, "pr_title": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "pr_createdAt": "2020-11-24T20:21:35Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4905", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2MDQ0OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4905#discussion_r529860449", "bodyText": "Can you add another assertion on \"sources[0]\", verifying that it's the step name?", "author": "rjrudin", "createdAt": "2020-11-24T20:32:41Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/step/impl/IngestWithSourceNameAndSourceTypeTest.java", "diffHunk": "@@ -53,8 +53,8 @@ void runDefaultIngestionWithSourceNameAndSourceType(){\n         assertEquals(JobStatus.FINISHED.toString(), response.getJobStatus());\n         JsonNode sourceDoc = getStagingDoc(\"customer1.json\");\n         assertNotNull(sourceDoc);\n-        JsonNode sourcesNode = sourceDoc.get(\"envelope\").get(\"headers\").get(\"sources\").get(0);\n-        assertEquals(\"sample-source\", sourcesNode.get(\"name\").asText());\n+        JsonNode sourcesNode = sourceDoc.get(\"envelope\").get(\"headers\").get(\"sources\").get(1);", "originalCommit": "5511acf43d4a7c84c78054e7d7e643010c178e85", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3d6de18d41ffb944d51833ea3b2963d062dc2638", "chunk": "diff --git a/marklogic-data-hub/src/test/java/com/marklogic/hub/step/impl/IngestWithSourceNameAndSourceTypeTest.java b/marklogic-data-hub/src/test/java/com/marklogic/hub/step/impl/IngestWithSourceNameAndSourceTypeTest.java\nindex 6f92ee9ac..f892dcc6a 100644\n--- a/marklogic-data-hub/src/test/java/com/marklogic/hub/step/impl/IngestWithSourceNameAndSourceTypeTest.java\n+++ b/marklogic-data-hub/src/test/java/com/marklogic/hub/step/impl/IngestWithSourceNameAndSourceTypeTest.java\n\n@@ -53,7 +53,10 @@ public class IngestWithSourceNameAndSourceTypeTest extends AbstractHubCoreTest {\n         assertEquals(JobStatus.FINISHED.toString(), response.getJobStatus());\n         JsonNode sourceDoc = getStagingDoc(\"customer1.json\");\n         assertNotNull(sourceDoc);\n-        JsonNode sourcesNode = sourceDoc.get(\"envelope\").get(\"headers\").get(\"sources\").get(1);\n+        JsonNode sourcesNode = sourceDoc.get(\"envelope\").get(\"headers\").get(\"sources\").get(0);\n+        assertEquals(\"sources-test\", sourcesNode.get(\"name\").asText());\n+\n+        sourcesNode = sourceDoc.get(\"envelope\").get(\"headers\").get(\"sources\").get(1);\n         assertEquals(\"sample-source\", sourcesNode.get(\"datahubSourceName\").asText());\n         assertEquals(\"employee\", sourcesNode.get(\"datahubSourceType\").asText());\n     }\n"}}, {"oid": "3d6de18d41ffb944d51833ea3b2963d062dc2638", "url": "https://github.com/marklogic/marklogic-data-hub/commit/3d6de18d41ffb944d51833ea3b2963d062dc2638", "message": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "committedDate": "2020-11-24T20:45:19Z", "type": "forcePushed"}, {"oid": "7093bb57e82e1184d615ce7e3a1b27392c1e1d01", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7093bb57e82e1184d615ce7e3a1b27392c1e1d01", "message": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "committedDate": "2020-11-25T18:33:05Z", "type": "forcePushed"}, {"oid": "a8677319db37db848e11edb4efa58fc079085a4c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a8677319db37db848e11edb4efa58fc079085a4c", "message": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "committedDate": "2020-11-25T22:43:25Z", "type": "forcePushed"}, {"oid": "7a08e0fb710b62e02437de9be02bb6e413139a82", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7a08e0fb710b62e02437de9be02bb6e413139a82", "message": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "committedDate": "2020-11-26T02:53:54Z", "type": "commit"}, {"oid": "7a08e0fb710b62e02437de9be02bb6e413139a82", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7a08e0fb710b62e02437de9be02bb6e413139a82", "message": "DHFPROD-6247: Add sourceName to records during ingestion and make it facetable", "committedDate": "2020-11-26T02:53:54Z", "type": "forcePushed"}]}