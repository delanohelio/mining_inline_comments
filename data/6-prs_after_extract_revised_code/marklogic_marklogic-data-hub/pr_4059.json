{"pr_number": 4059, "pr_title": "DHFPROD-5078: Display default properties for entity search results", "pr_createdAt": "2020-06-05T22:20:57Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4059", "timeline": [{"oid": "d5d8acb8cfc26c60942b76372643817bec449100", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d5d8acb8cfc26c60942b76372643817bec449100", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests", "committedDate": "2020-06-05T23:24:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY5NzI4Nw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4059#discussion_r436697287", "bodyText": "Is it possible to select more than one entity type? If not, can we change this to a string instead of a List? We don't want the code to imply that something is possible when it's not.", "author": "rjrudin", "createdAt": "2020-06-08T13:24:27Z", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/entities/search/EntitySearchManager.java", "diffHunk": "@@ -96,6 +97,14 @@ public StringHandle search(SearchQuery searchQuery) {\n             String query = queryDef.serialize();\n             StructureWriteHandle handle = new StringHandle(buildSearchOptions(query, searchQuery)).withMimetype(\"application/xml\");\n             RawCombinedQueryDefinition rcQueryDef = queryMgr.newRawCombinedQueryDefinition(handle, queryDef.getOptionsName());\n+\n+            // If an entity has been selected, then apply this transform\n+            List<String> entityTypeIds = searchQuery.getQuery().getEntityTypeIds();", "originalCommit": "d5d8acb8cfc26c60942b76372643817bec449100", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjcxNzkyNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4059#discussion_r436717927", "bodyText": "@rjrudin When AllEntities are selected, there can be more than 1 entityTypeId", "author": "rahulvudutala", "createdAt": "2020-06-08T13:49:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjY5NzI4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "d1a3a3eb6414095bda8fcaa11fafa67ba493a160", "chunk": "diff --git a/marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/entities/search/EntitySearchManager.java b/marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/entities/search/EntitySearchManager.java\nindex a7fcd48eb..d3db06415 100644\n--- a/marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/entities/search/EntitySearchManager.java\n+++ b/marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/entities/search/EntitySearchManager.java\n\n@@ -99,10 +99,12 @@ public class EntitySearchManager {\n             RawCombinedQueryDefinition rcQueryDef = queryMgr.newRawCombinedQueryDefinition(handle, queryDef.getOptionsName());\n \n             // If an entity has been selected, then apply this transform\n-            List<String> entityTypeIds = searchQuery.getQuery().getEntityTypeIds();\n-            if (entityTypeIds != null && entityTypeIds.size() == 1) {\n+            String[] entityTypeCollections = searchQuery.getQuery().getEntityTypeCollections();\n+            if (entityTypeCollections != null && entityTypeCollections.length > 0) {\n+                // We have some awkwardness here where the input is 'entityName', but as of 5.3.0, the \"entityTypeIds\"\n+                // property is capturing entity names, which are expected to double as collection names as well\n                 rcQueryDef.setResponseTransform(new ServerTransform(\"hubEntitySearchTransform\")\n-                    .addParameter(\"entityName\", entityTypeIds.get(0)));\n+                    .addParameter(\"entityName\", entityTypeCollections[0]));\n             }\n \n             return queryMgr.search(rcQueryDef, resultHandle, searchQuery.getStart());\n"}}, {"oid": "7d720d52b1b73dd88e41b6dc248d7ffd5a3e7332", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7d720d52b1b73dd88e41b6dc248d7ffd5a3e7332", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests\n\nDHFPROD-5078: Error handling for search transform and updating Customer input docs in reference-entity-model", "committedDate": "2020-06-08T14:23:06Z", "type": "forcePushed"}, {"oid": "d1a3a3eb6414095bda8fcaa11fafa67ba493a160", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d1a3a3eb6414095bda8fcaa11fafa67ba493a160", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests\n\nDHFPROD-5078: Error handling for search transform and updating Customer input docs in reference-entity-model", "committedDate": "2020-06-08T17:58:31Z", "type": "forcePushed"}, {"oid": "6935e16909f6d80c7981538318c3b32987ad2ed1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6935e16909f6d80c7981538318c3b32987ad2ed1", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests\n\nDHFPROD-5078: Error handling for search transform and updating Customer input docs in reference-entity-model", "committedDate": "2020-06-08T21:28:31Z", "type": "forcePushed"}, {"oid": "8743574e387161ee93519165a7da36fd92390764", "url": "https://github.com/marklogic/marklogic-data-hub/commit/8743574e387161ee93519165a7da36fd92390764", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests\n\nDHFPROD-5078: Error handling for search transform and updating Customer input docs in reference-entity-model\n\nMaking Address/Street into an array", "committedDate": "2020-06-08T22:30:57Z", "type": "commit"}, {"oid": "8743574e387161ee93519165a7da36fd92390764", "url": "https://github.com/marklogic/marklogic-data-hub/commit/8743574e387161ee93519165a7da36fd92390764", "message": "DHFPROD-5078: Adding search transform for returning entity properties\n\nDHFPROD-5078: EntitySearch Transform Modules\n\nDHFPROD-5078: reference entity model changes\n\nDHFPROD-5078: Adding tests\n\nDHFPROD-5078: Error handling for search transform and updating Customer input docs in reference-entity-model\n\nMaking Address/Street into an array", "committedDate": "2020-06-08T22:30:57Z", "type": "forcePushed"}]}