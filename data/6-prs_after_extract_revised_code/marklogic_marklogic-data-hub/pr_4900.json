{"pr_number": 4900, "pr_title": "DHFPROD-6290:Original gradle properties get reset if runAsUser() is called", "pr_createdAt": "2020-11-24T01:55:53Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4900", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU1ODA5MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4900#discussion_r529558090", "bodyText": "I think it would be better to construct a new Properties object and copy everything from \"props\" into it, then override mlUsername/mlPassword. That ensures we don't modify the set of Properties that were actually read from disk.\nGood catch though figuring this out.", "author": "rjrudin", "createdAt": "2020-11-24T13:49:24Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/HubTestBase.java", "diffHunk": "@@ -183,8 +184,10 @@ protected HubClient runAsDataHubOperator() {\n     @Override\n     protected HubClient runAsUser(String mlUsername, String mlPassword) {\n         hubClient = null;\n-\n-        applyMlUsernameAndMlPassword(mlUsername, mlPassword);\n+        Properties props = hubConfigInterceptor.getHubConfigObjectFactory().getGradleProperties();\n+        props.setProperty(\"mlUsername\", mlUsername);", "originalCommit": "58b21ecde2fddc1410455d1741126e4091a9a77a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "feb8f3618a31f6ffc74d630f60ffda0bec70ed7e", "chunk": "diff --git a/marklogic-data-hub/src/test/java/com/marklogic/hub/HubTestBase.java b/marklogic-data-hub/src/test/java/com/marklogic/hub/HubTestBase.java\nindex ba48f6fa9..ac2ab2a71 100644\n--- a/marklogic-data-hub/src/test/java/com/marklogic/hub/HubTestBase.java\n+++ b/marklogic-data-hub/src/test/java/com/marklogic/hub/HubTestBase.java\n\n@@ -184,10 +184,10 @@ public class HubTestBase extends AbstractHubTest {\n     @Override\n     protected HubClient runAsUser(String mlUsername, String mlPassword) {\n         hubClient = null;\n-        Properties props = hubConfigInterceptor.getHubConfigObjectFactory().getGradleProperties();\n-        props.setProperty(\"mlUsername\", mlUsername);\n-        props.setProperty(\"mlPassword\", mlPassword);\n-        applyMlUsernameAndMlPassword(props);\n+        Properties newProps = new Properties(hubConfigInterceptor.getHubConfigObjectFactory().getGradleProperties());\n+        newProps.setProperty(\"mlUsername\", mlUsername);\n+        newProps.setProperty(\"mlPassword\", mlPassword);\n+        applyMlUsernameAndMlPassword(newProps);\n \n         // Re-initializes the Manage API connection\n         getHubConfig().getManageClient().setManageConfig(hubConfig.getManageConfig());\n"}}, {"oid": "feb8f3618a31f6ffc74d630f60ffda0bec70ed7e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/feb8f3618a31f6ffc74d630f60ffda0bec70ed7e", "message": "DHFPROD-6290:Original gradle properties get reset if runAsUser() is called", "committedDate": "2020-11-24T18:01:23Z", "type": "forcePushed"}, {"oid": "4b8f268d08bfbe74822c1ec14ed18a45f90918ef", "url": "https://github.com/marklogic/marklogic-data-hub/commit/4b8f268d08bfbe74822c1ec14ed18a45f90918ef", "message": "DHFPROD-6290:Set 'hubDhs' and 'hubSsl' when runAsUser() is called", "committedDate": "2020-11-25T03:42:15Z", "type": "commit"}, {"oid": "4b8f268d08bfbe74822c1ec14ed18a45f90918ef", "url": "https://github.com/marklogic/marklogic-data-hub/commit/4b8f268d08bfbe74822c1ec14ed18a45f90918ef", "message": "DHFPROD-6290:Set 'hubDhs' and 'hubSsl' when runAsUser() is called", "committedDate": "2020-11-25T03:42:15Z", "type": "forcePushed"}]}