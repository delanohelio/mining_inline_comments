{"pr_number": 3753, "pr_title": "DHFPROD-4610:Remove \"fileLocations\" from flow declaration", "pr_createdAt": "2020-03-25T01:49:07Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3753", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyMTA0Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3753#discussion_r397821043", "bodyText": "What happens if an existing flow file has fileLocations in a step, and then saves the flow via QS? Won't the user lose the fileLocations data? This seems risky to me.\nCan you test this out in QS? People will still be using QS for many months to come, we can't break anything in it.", "author": "rjrudin", "createdAt": "2020-03-25T12:38:22Z", "path": "one-ui/src/test/java/com/marklogic/hub/curation/controllers/FlowControllerTest.java", "diffHunk": "@@ -124,8 +125,13 @@ void getFlow() throws IOException {\n \n             //POST step\n             StepModel stepModel = (StepModel)controller.createStep(\"testFlow\", 1, stepString).getBody();\n+            JsonNode flowJson = JSONUtils.convertArtifactToJson(controller.getFlow(\"testFlow\").getBody());\n \n             Assertions.assertNotNull(stepModel);\n+            //\"fileLocations\" should not be present in flow declaration\n+            Assertions.assertNotNull(flowJson.get(\"steps\").get(\"1\"));", "originalCommit": "27893986c54cbb7cf91c51dea1b5e5acfc19159e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5MDYxOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3753#discussion_r397890619", "bodyText": "I just realized this is the one-ui class. I think it's worth adding a comment to the JsonIgnore annotation to define why this is being ignored. Should it even be in the class if it's being ignored??", "author": "rjrudin", "createdAt": "2020-03-25T14:20:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyMTA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzk1MjQyMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3753#discussion_r397952421", "bodyText": "Made changes so that \"fileLocations\", if present in the step is retained.", "author": "srinathgit", "createdAt": "2020-03-25T15:36:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzgyMTA0Mw=="}], "type": "inlineReview", "revised_code": {"commit": "74c1ac5f334d138b1776c0952154006d7d697622", "chunk": "diff --git a/one-ui/src/test/java/com/marklogic/hub/curation/controllers/FlowControllerTest.java b/one-ui/src/test/java/com/marklogic/hub/curation/controllers/FlowControllerTest.java\nindex 251224f34..049ff497a 100644\n--- a/one-ui/src/test/java/com/marklogic/hub/curation/controllers/FlowControllerTest.java\n+++ b/one-ui/src/test/java/com/marklogic/hub/curation/controllers/FlowControllerTest.java\n\n@@ -125,24 +125,31 @@ class FlowControllerTest extends TestHelper{\n \n             //POST step\n             StepModel stepModel = (StepModel)controller.createStep(\"testFlow\", 1, stepString).getBody();\n+            controller.createStep(\"testFlow\", 2, \"{\\\"name\\\":\\\"name\\\",\\\"stepDefinitionName\\\":\\\"default-ingestion\\\",\\\"stepDefinitionType\\\"\" +\n+                \":\\\"INGESTION\\\",\\\"options\\\":{\\\"loadData\\\":{\\\"name\\\":\\\"name\\\"}}}\");\n+\n             JsonNode flowJson = JSONUtils.convertArtifactToJson(controller.getFlow(\"testFlow\").getBody());\n \n             Assertions.assertNotNull(stepModel);\n-            //\"fileLocations\" should not be present in flow declaration\n+            //\"fileLocations\" should  be present in flow declaration if already present in the step\n             Assertions.assertNotNull(flowJson.get(\"steps\").get(\"1\"));\n-            Assertions.assertNull(flowJson.get(\"steps\").get(\"1\").get(\"fileLocations\"));\n+            Assertions.assertNotNull(flowJson.get(\"steps\").get(\"1\").get(\"fileLocations\"));\n+\n+            //\"fileLocations\" should  not be present in flow declaration if it is not present in the step\n+            Assertions.assertNotNull(flowJson.get(\"steps\").get(\"2\"));\n+            Assertions.assertNull(flowJson.get(\"steps\").get(\"2\").get(\"fileLocations\"));\n \n             //update batch size\n             stepModel.setBatchSize(100);\n \n             //GET all steps in a flow\n             steps = controller.getSteps(\"testFlow\");\n-            Assertions.assertEquals(1, (steps.size()));\n+            Assertions.assertEquals(2, (steps.size()));\n \n             //PUT step\n             controller.createStep(\"testFlow\",\"e2e-json-ingestion\", mapper.writeValueAsString(stepModel));\n             //POST custom step\n-            controller.createStep(\"testFlow\", 2, customStepString).getBody();\n+            controller.createStep(\"testFlow\", 3, customStepString).getBody();\n \n             GenericDocumentManager docMgr = hubConfig.newStagingClient().newDocumentManager();\n             StringHandle readHandle = new StringHandle();\n"}}, {"oid": "74c1ac5f334d138b1776c0952154006d7d697622", "url": "https://github.com/marklogic/marklogic-data-hub/commit/74c1ac5f334d138b1776c0952154006d7d697622", "message": "DHFPROD-4610:Remove \"fileLocations\" from flow declaration", "committedDate": "2020-03-25T15:33:55Z", "type": "commit"}, {"oid": "74c1ac5f334d138b1776c0952154006d7d697622", "url": "https://github.com/marklogic/marklogic-data-hub/commit/74c1ac5f334d138b1776c0952154006d7d697622", "message": "DHFPROD-4610:Remove \"fileLocations\" from flow declaration", "committedDate": "2020-03-25T15:33:55Z", "type": "forcePushed"}]}