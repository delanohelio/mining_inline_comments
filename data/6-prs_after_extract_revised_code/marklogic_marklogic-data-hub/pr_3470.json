{"pr_number": 3470, "pr_title": "DHFPROD-3764: Initial work for new curation UI", "pr_createdAt": "2020-01-15T23:46:32Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3470", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NjMzMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3470#discussion_r367176330", "bodyText": "I recommend adding a constructor instead", "author": "rjrudin", "createdAt": "2020-01-16T00:26:36Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/GenerateFunctionMetadataCommand.java", "diffHunk": "@@ -91,4 +91,9 @@ public void execute(CommandContext context) {\n             logger.warn(\"GenerateFunctionMetadataCommand is not supported on this MarkLogic server version \");\n         }\n     }\n+\n+    public void setHubConfig(HubConfig hubConfig) {", "originalCommit": "b0f609e0e46b435b5d16edfe035368567fc70e84", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e8f852dfafb69e8d8919106c3d481ac9f74c092", "chunk": "diff --git a/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/GenerateFunctionMetadataCommand.java b/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/GenerateFunctionMetadataCommand.java\nindex dea933a36..5d7531dcc 100644\n--- a/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/GenerateFunctionMetadataCommand.java\n+++ b/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/GenerateFunctionMetadataCommand.java\n\n@@ -94,6 +105,12 @@ public class GenerateFunctionMetadataCommand extends AbstractCommand {\n \n     public void setHubConfig(HubConfig hubConfig) {\n         this.hubConfig = hubConfig;\n-        this.versions = new Versions(hubConfig);\n+    }\n+\n+    private Versions getVersions() {\n+        if (this.versions == null) {\n+            this.versions = new Versions(this.hubConfig);\n+        }\n+        return this.versions;\n     }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NjU5OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3470#discussion_r367176598", "bodyText": "I recommend using the constructor for each of these", "author": "rjrudin", "createdAt": "2020-01-16T00:27:43Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/DataHubImpl.java", "diffHunk": "@@ -895,10 +895,31 @@ protected void prepareProjectBeforeUpgrading(HubProject hubProject, String curre\n     // only used in test\n     public void setHubConfig(HubConfigImpl hubConfig) {\n         this.hubConfig = hubConfig;\n+        if (this.loadUserModulesCommand != null) {", "originalCommit": "b0f609e0e46b435b5d16edfe035368567fc70e84", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "cbad38f25217f9814f7ce4623ed83e72dae4d5f4", "chunk": "diff --git a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/DataHubImpl.java b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/DataHubImpl.java\nindex f4575d63f..2297017f2 100644\n--- a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/DataHubImpl.java\n+++ b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/DataHubImpl.java\n\n@@ -895,31 +895,10 @@ public class DataHubImpl implements DataHub {\n     // only used in test\n     public void setHubConfig(HubConfigImpl hubConfig) {\n         this.hubConfig = hubConfig;\n-        if (this.loadUserModulesCommand != null) {\n-            this.loadUserModulesCommand.setHubConfig(hubConfig);\n-        }\n-        if (this.loadHubModulesCommand != null) {\n-            this.loadHubModulesCommand.setHubConfig(hubConfig);\n-        }\n-        if (this.loadHubArtifactsCommand != null) {\n-            this.loadHubArtifactsCommand.setHubConfig(hubConfig);\n-        }\n-        if (this.loadUserArtifactsCommand != null) {\n-            this.loadUserArtifactsCommand.setHubConfig(hubConfig);\n-        }\n-        if (this.generateFunctionMetadataCommand != null) {\n-            this.generateFunctionMetadataCommand.setHubConfig(hubConfig);\n-        }\n-    }\n-\n-    // only used in test\n-    public HubConfig getHubConfig() {\n-        return this.hubConfig;\n     }\n \n     // only used in test\n     public void setVersions(Versions versions) {\n         this.versions = versions;\n     }\n-\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NjcwNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3470#discussion_r367176705", "bodyText": "I recommend just ditching this, it only complicates things. Just change each reference to hubConfig.getHubProject().", "author": "rjrudin", "createdAt": "2020-01-16T00:28:07Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/EntityManagerImpl.java", "diffHunk": "@@ -35,32 +35,44 @@\n import com.marklogic.hub.EntityManager;\n import com.marklogic.hub.HubConfig;\n import com.marklogic.hub.HubProject;\n-import com.marklogic.hub.entity.*;\n+import com.marklogic.hub.entity.DefinitionType;\n+import com.marklogic.hub.entity.DefinitionsType;\n+import com.marklogic.hub.entity.HubEntity;\n+import com.marklogic.hub.entity.InfoType;\n+import com.marklogic.hub.entity.ItemType;\n+import com.marklogic.hub.entity.PropertyType;\n import com.marklogic.hub.error.EntityServicesGenerationException;\n import com.marklogic.hub.util.HubModuleManager;\n import org.apache.commons.io.FileUtils;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.core.io.FileSystemResource;\n import org.springframework.core.io.Resource;\n import org.springframework.stereotype.Component;\n+import org.springframework.web.context.annotation.SessionScope;\n \n+import javax.annotation.PostConstruct;\n import java.io.File;\n import java.io.FileInputStream;\n import java.io.IOException;\n import java.nio.file.Path;\n import java.nio.file.Paths;\n-import java.util.*;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.HashMap;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Map;\n import java.util.stream.Collectors;\n \n+@SessionScope\n @Component\n public class EntityManagerImpl extends LoggingObject implements EntityManager {\n     private static final String ENTITY_FILE_EXTENSION = \".entity.json\";\n \n     @Autowired\n     private HubConfig hubConfig;\n \n-    @Autowired\n-    private HubProject hubProject;\n+    private HubProject hubProject = null;", "originalCommit": "b0f609e0e46b435b5d16edfe035368567fc70e84", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6e8f852dfafb69e8d8919106c3d481ac9f74c092", "chunk": "diff --git a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/EntityManagerImpl.java b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/EntityManagerImpl.java\nindex 6290de2e0..4558e4d65 100644\n--- a/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/EntityManagerImpl.java\n+++ b/marklogic-data-hub/src/main/java/com/marklogic/hub/impl/EntityManagerImpl.java\n\n@@ -34,7 +34,6 @@ import com.marklogic.client.util.RequestParameters;\n import com.marklogic.hub.DatabaseKind;\n import com.marklogic.hub.EntityManager;\n import com.marklogic.hub.HubConfig;\n-import com.marklogic.hub.HubProject;\n import com.marklogic.hub.entity.DefinitionType;\n import com.marklogic.hub.entity.DefinitionsType;\n import com.marklogic.hub.entity.HubEntity;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODgwOTc2NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3470#discussion_r368809764", "bodyText": "EntityManagerImpl is the only implementation of EntityManager. Maybe we should add the setHubConfig as an new interface method instead of checking the instance type and do the cast...", "author": "hao1st", "createdAt": "2020-01-21T04:47:00Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/LoadUserModulesCommand.java", "diffHunk": "@@ -270,6 +270,12 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) {\n \n     public void setHubConfig(HubConfig hubConfig) {\n         this.hubConfig = hubConfig;\n+        if (this.entityManager == null) {\n+            this.entityManager = new EntityManagerImpl();\n+        }\n+        if (this.entityManager instanceof EntityManagerImpl) {", "originalCommit": "b0f609e0e46b435b5d16edfe035368567fc70e84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTAxNTQ5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3470#discussion_r369015499", "bodyText": "Setters for dependencies shouldn't be part of an interface, as that exposes the implementation. EntityManagerImpl(HubConfig) should be used instead when setHubConfig is called (though I don't think there should be a setHubConfig on LoadUserModulesCommand either - it should be LoadUserModulesCommand(HubConfig) instead).", "author": "rjrudin", "createdAt": "2020-01-21T13:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODgwOTc2NA=="}], "type": "inlineReview", "revised_code": {"commit": "6e8f852dfafb69e8d8919106c3d481ac9f74c092", "chunk": "diff --git a/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/LoadUserModulesCommand.java b/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/LoadUserModulesCommand.java\nindex e9728f405..0cba2c5c6 100644\n--- a/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/LoadUserModulesCommand.java\n+++ b/marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/LoadUserModulesCommand.java\n\n@@ -271,10 +279,7 @@ public class LoadUserModulesCommand extends LoadModulesCommand {\n     public void setHubConfig(HubConfig hubConfig) {\n         this.hubConfig = hubConfig;\n         if (this.entityManager == null) {\n-            this.entityManager = new EntityManagerImpl();\n-        }\n-        if (this.entityManager instanceof EntityManagerImpl) {\n-            ((EntityManagerImpl) this.entityManager).setHubConfig(hubConfig);\n+            this.entityManager = new EntityManagerImpl(hubConfig);\n         }\n     }\n \n"}}, {"oid": "6e8f852dfafb69e8d8919106c3d481ac9f74c092", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6e8f852dfafb69e8d8919106c3d481ac9f74c092", "message": "DHFPROD-4166: Bring in latest changes from one-ui", "committedDate": "2020-01-21T22:15:36Z", "type": "forcePushed"}, {"oid": "0caab273d445ff8aefa2c62a37c40041cb6afdfa", "url": "https://github.com/marklogic/marklogic-data-hub/commit/0caab273d445ff8aefa2c62a37c40041cb6afdfa", "message": "DHFPROD-4166: Bring in latest changes from one-ui", "committedDate": "2020-01-22T18:37:02Z", "type": "forcePushed"}, {"oid": "53c6fb2872598c7ef72c719288d8d4f9665abc1d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/53c6fb2872598c7ef72c719288d8d4f9665abc1d", "message": "DHFPROD-3764: Fixing tests for Java update", "committedDate": "2020-01-23T06:21:18Z", "type": "forcePushed"}, {"oid": "29c8ee5bd699508ebedcdd833f4d5101f170c6ba", "url": "https://github.com/marklogic/marklogic-data-hub/commit/29c8ee5bd699508ebedcdd833f4d5101f170c6ba", "message": "DHFPROD-3764: Fixing tests for Java update", "committedDate": "2020-01-23T20:41:54Z", "type": "forcePushed"}, {"oid": "cbad38f25217f9814f7ce4623ed83e72dae4d5f4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/cbad38f25217f9814f7ce4623ed83e72dae4d5f4", "message": "updating version to 5.3-snapshots", "committedDate": "2020-01-23T22:07:35Z", "type": "commit"}, {"oid": "6bc1643f8a973fb2d323c6e701b20ce162a35718", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6bc1643f8a973fb2d323c6e701b20ce162a35718", "message": "updated task and version", "committedDate": "2020-01-23T22:07:35Z", "type": "commit"}, {"oid": "7507428164f0dda52284c1497f62cc0d0f370c47", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7507428164f0dda52284c1497f62cc0d0f370c47", "message": "Updating target branch from develop to feature/5.3.0", "committedDate": "2020-01-23T22:07:36Z", "type": "commit"}, {"oid": "e00259db53eebda73f25b3f90076d4f4322b78db", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e00259db53eebda73f25b3f90076d4f4322b78db", "message": "DHFPROD-4067:Updating to Java 11", "committedDate": "2020-01-23T22:07:36Z", "type": "commit"}, {"oid": "7feeea42c60e870dc92abf9205ff7f67da10323a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7feeea42c60e870dc92abf9205ff7f67da10323a", "message": "DHFPROD-3984: Add data services for artifacts (#3417)", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "b5d8c5b7db241a9191d37236a516f2b9e394b214", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b5d8c5b7db241a9191d37236a516f2b9e394b214", "message": "DHFPROD-3974: Changes for new UI install (#3450)", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "15b26f95b9477d7e6ae11a37980351595f2eac75", "url": "https://github.com/marklogic/marklogic-data-hub/commit/15b26f95b9477d7e6ae11a37980351595f2eac75", "message": "DHFPROD-4166: Move one-ui to marklogic data hub", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "9f56a4e12a0aa778c657f1329637abde6d29ad2b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/9f56a4e12a0aa778c657f1329637abde6d29ad2b", "message": "DHFPROD-4104:Use DS to perform flow/step CRUD operations (#3476)", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "48eff90cd8d823db693f999add46f61597cf2450", "url": "https://github.com/marklogic/marklogic-data-hub/commit/48eff90cd8d823db693f999add46f61597cf2450", "message": "DHFPROD-4166: Bring in latest changes from one-ui", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "1c644d3fe3ec888eefc6de1c1657ae715d2f4648", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c644d3fe3ec888eefc6de1c1657ae715d2f4648", "message": "DHFPROD-3764: Fixing tests for Java update", "committedDate": "2020-01-24T17:27:38Z", "type": "commit"}, {"oid": "9e582d063c8d2333be6d9b25cd46332efe8c4406", "url": "https://github.com/marklogic/marklogic-data-hub/commit/9e582d063c8d2333be6d9b25cd46332efe8c4406", "message": "DHFPROD-4166: Move one-ui to marklogic data hub", "committedDate": "2020-01-24T18:03:05Z", "type": "commit"}, {"oid": "dedb04dbdb3b0a406c048e798686cc70cd5599ac", "url": "https://github.com/marklogic/marklogic-data-hub/commit/dedb04dbdb3b0a406c048e798686cc70cd5599ac", "message": "DHFPROD-4166: Bring in latest changes from one-ui", "committedDate": "2020-01-24T18:22:13Z", "type": "commit"}, {"oid": "4a23fd69cbf2bb19dbb7cad2c52d9d450fb5a195", "url": "https://github.com/marklogic/marklogic-data-hub/commit/4a23fd69cbf2bb19dbb7cad2c52d9d450fb5a195", "message": "DHFPROD-4104:Middle tier for flow/step CRUD", "committedDate": "2020-01-24T18:22:13Z", "type": "commit"}, {"oid": "60ba7b7535a24d94f3c6380e6e1c1c508b11e32e", "url": "https://github.com/marklogic/marklogic-data-hub/commit/60ba7b7535a24d94f3c6380e6e1c1c508b11e32e", "message": "DHFPROD-4210: Allow for the deletion of a data set via API (#3494)", "committedDate": "2020-01-24T18:22:13Z", "type": "commit"}, {"oid": "60ba7ed220f554fe2daad10f7e738979dadbeffa", "url": "https://github.com/marklogic/marklogic-data-hub/commit/60ba7ed220f554fe2daad10f7e738979dadbeffa", "message": "DHFPROD-3978: Add reset route\n\nA UI convenience as we develop login functionality, resets hostname setting on server.", "committedDate": "2020-01-24T18:25:25Z", "type": "commit"}, {"oid": "bc22b5aa6d322d07fdadc823261c30f317399948", "url": "https://github.com/marklogic/marklogic-data-hub/commit/bc22b5aa6d322d07fdadc823261c30f317399948", "message": "DHFPROD-4144: Add backup font faces for app name in header\n\nFirefox not recognizing 'HelveticaNeue-Light'.", "committedDate": "2020-01-24T18:25:25Z", "type": "commit"}, {"oid": "bc22b5aa6d322d07fdadc823261c30f317399948", "url": "https://github.com/marklogic/marklogic-data-hub/commit/bc22b5aa6d322d07fdadc823261c30f317399948", "message": "DHFPROD-4144: Add backup font faces for app name in header\n\nFirefox not recognizing 'HelveticaNeue-Light'.", "committedDate": "2020-01-24T18:25:25Z", "type": "forcePushed"}]}