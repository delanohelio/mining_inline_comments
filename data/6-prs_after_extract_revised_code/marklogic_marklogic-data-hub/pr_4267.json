{"pr_number": 4267, "pr_title": "DHFPROD-5553:Remove granular privileges before removing databases", "pr_createdAt": "2020-07-24T01:55:09Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4267", "timeline": [{"oid": "458b4d2da2f508198dae32d05a9593fa6983ef37", "url": "https://github.com/marklogic/marklogic-data-hub/commit/458b4d2da2f508198dae32d05a9593fa6983ef37", "message": "DHFPROD-5553:Remove granular privileges before deleting databases", "committedDate": "2020-07-24T02:00:02Z", "type": "commit"}, {"oid": "458b4d2da2f508198dae32d05a9593fa6983ef37", "url": "https://github.com/marklogic/marklogic-data-hub/commit/458b4d2da2f508198dae32d05a9593fa6983ef37", "message": "DHFPROD-5553:Remove granular privileges before deleting databases", "committedDate": "2020-07-24T02:00:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAzMDE1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4267#discussion_r460030151", "bodyText": "If needed in the future, we could have this executed right at the beginning of undeployment too.", "author": "rjrudin", "createdAt": "2020-07-24T12:46:34Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/deploy/commands/CreateGranularPrivilegesCommand.java", "diffHunk": "@@ -95,9 +95,10 @@ public Integer getExecuteSortOrder() {\n         return Integer.MAX_VALUE;\n     }\n \n+    // Granular privileges should be removed before dbs as the 'granularPrivileges' map's key uses db id\n     @Override\n     public Integer getUndoSortOrder() {\n-        return SortOrderConstants.DELETE_PRIVILEGES;\n+        return SortOrderConstants.DELETE_OTHER_DATABASES - 1;", "originalCommit": "458b4d2da2f508198dae32d05a9593fa6983ef37", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}