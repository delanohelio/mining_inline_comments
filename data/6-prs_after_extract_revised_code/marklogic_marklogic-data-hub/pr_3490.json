{"pr_number": 3490, "pr_title": "DHFPROD-4104:Middle tier for flow/step CRUD", "pr_createdAt": "2020-01-22T20:47:50Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3490", "timeline": [{"oid": "debddd817ed8b27d2a5879c82bfd9b41fc7b5a81", "url": "https://github.com/marklogic/marklogic-data-hub/commit/debddd817ed8b27d2a5879c82bfd9b41fc7b5a81", "message": "updating version to 5.3-snapshots", "committedDate": "2020-01-22T18:07:35Z", "type": "commit"}, {"oid": "7015cd1db1b32de99d1e1af6514ddb21ddbc0c2c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/7015cd1db1b32de99d1e1af6514ddb21ddbc0c2c", "message": "updated task and version", "committedDate": "2020-01-22T18:07:35Z", "type": "commit"}, {"oid": "1831bb8bd04510d83f33db6e4f52f293885ed091", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1831bb8bd04510d83f33db6e4f52f293885ed091", "message": "Updating target branch from develop to feature/5.3.0", "committedDate": "2020-01-22T18:07:35Z", "type": "commit"}, {"oid": "280ae3c61dbb9972f6d79961321bc41f9ef3ad8f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/280ae3c61dbb9972f6d79961321bc41f9ef3ad8f", "message": "DHFPROD-3984: Add data services for artifacts (#3417)", "committedDate": "2020-01-22T18:27:51Z", "type": "commit"}, {"oid": "6eb1bfc28ae31563b15fbd43b63d0908da5a02f0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/6eb1bfc28ae31563b15fbd43b63d0908da5a02f0", "message": "DHFPROD-3974: Changes for new UI install (#3450)", "committedDate": "2020-01-22T18:37:01Z", "type": "commit"}, {"oid": "5b597566eaaa5434f08b81f78f6fdaf8b61bea5d", "url": "https://github.com/marklogic/marklogic-data-hub/commit/5b597566eaaa5434f08b81f78f6fdaf8b61bea5d", "message": "DHFPROD-4166: Move one-ui to marklogic data hub", "committedDate": "2020-01-22T18:37:01Z", "type": "commit"}, {"oid": "f659b3e33d4f77d0971bbaebd1f5c33a5b666e50", "url": "https://github.com/marklogic/marklogic-data-hub/commit/f659b3e33d4f77d0971bbaebd1f5c33a5b666e50", "message": "DHFPROD-4104:Use DS to perform flow/step CRUD operations (#3476)", "committedDate": "2020-01-22T18:37:02Z", "type": "commit"}, {"oid": "0caab273d445ff8aefa2c62a37c40041cb6afdfa", "url": "https://github.com/marklogic/marklogic-data-hub/commit/0caab273d445ff8aefa2c62a37c40041cb6afdfa", "message": "DHFPROD-4166: Bring in latest changes from one-ui", "committedDate": "2020-01-22T18:37:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgwNzQ2Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369807462", "bodyText": "we can remove @EnableAsync for the implmentation.", "author": "hao1st", "createdAt": "2020-01-22T21:16:11Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2012-2019 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.marklogic.hub.curation.controllers;\n+\n+import com.marklogic.hub.curation.services.FlowManagerService;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.scheduling.annotation.EnableAsync;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.*;\n+\n+@Controller\n+@RequestMapping(\"/api/flows\")\n+@EnableAsync", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MTIzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369871238", "bodyText": "That sounds right. Also, if we did need it, I think a comment would be very helpful. Spring annotations can be powerful, but they often beg the question - why is this annotation here?", "author": "rjrudin", "createdAt": "2020-01-23T00:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTgwNzQ2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\nindex 1393e658a..2b65b44e9 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n\n@@ -16,20 +16,16 @@\n package com.marklogic.hub.curation.controllers;\n \n import com.marklogic.hub.curation.services.FlowManagerService;\n-import com.marklogic.hub.error.DataHubProjectException;\n import com.marklogic.hub.flow.Flow;\n-import com.marklogic.hub.oneui.exceptions.DataHubException;\n import com.marklogic.hub.oneui.models.StepModel;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n import org.springframework.http.ResponseEntity;\n-import org.springframework.scheduling.annotation.EnableAsync;\n import org.springframework.stereotype.Controller;\n import org.springframework.web.bind.annotation.*;\n \n @Controller\n @RequestMapping(\"/api/flows\")\n-@EnableAsync\n public class FlowController {\n \n     @Autowired\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MTg1NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369871855", "bodyText": "Shouldn't the service throw a useful exception here if the payload is invalid? The controller should be as thin as possible, just passing inputs and outputs around. I think all of these methods should roughly be:\nreturn new ResponseEntity<>(service.createFlow(flowJson, false), HttpStatus.OK);", "author": "rjrudin", "createdAt": "2020-01-23T00:03:21Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2012-2019 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.marklogic.hub.curation.controllers;\n+\n+import com.marklogic.hub.curation.services.FlowManagerService;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.scheduling.annotation.EnableAsync;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.*;\n+\n+@Controller\n+@RequestMapping(\"/api/flows\")\n+@EnableAsync\n+public class FlowController {\n+\n+    @Autowired\n+    private FlowManagerService flowManagerService;\n+\n+    @RequestMapping(method = RequestMethod.POST)\n+    @ResponseBody\n+    public ResponseEntity<?> createFlow(@RequestBody String flowJson) {\n+        Flow flow;\n+        try {\n+            flow = flowManagerService.createFlow(flowJson, false);", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\nindex 1393e658a..2b65b44e9 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n\n@@ -16,20 +16,16 @@\n package com.marklogic.hub.curation.controllers;\n \n import com.marklogic.hub.curation.services.FlowManagerService;\n-import com.marklogic.hub.error.DataHubProjectException;\n import com.marklogic.hub.flow.Flow;\n-import com.marklogic.hub.oneui.exceptions.DataHubException;\n import com.marklogic.hub.oneui.models.StepModel;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n import org.springframework.http.ResponseEntity;\n-import org.springframework.scheduling.annotation.EnableAsync;\n import org.springframework.stereotype.Controller;\n import org.springframework.web.bind.annotation.*;\n \n @Controller\n @RequestMapping(\"/api/flows\")\n-@EnableAsync\n public class FlowController {\n \n     @Autowired\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MTk4NA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369871984", "bodyText": "Same thing here, createFlow should throw a useful exception. There shouldn't be any need for the controller to do anything other than call the service method.", "author": "rjrudin", "createdAt": "2020-01-23T00:03:49Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2012-2019 MarkLogic Corporation\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package com.marklogic.hub.curation.controllers;\n+\n+import com.marklogic.hub.curation.services.FlowManagerService;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.scheduling.annotation.EnableAsync;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.*;\n+\n+@Controller\n+@RequestMapping(\"/api/flows\")\n+@EnableAsync\n+public class FlowController {\n+\n+    @Autowired\n+    private FlowManagerService flowManagerService;\n+\n+    @RequestMapping(method = RequestMethod.POST)\n+    @ResponseBody\n+    public ResponseEntity<?> createFlow(@RequestBody String flowJson) {\n+        Flow flow;\n+        try {\n+            flow = flowManagerService.createFlow(flowJson, false);\n+            if (flow == null) {\n+                throw new DataHubException(\"Flow request payload is invalid.\");\n+            }\n+        } catch (Exception dpe) {\n+            throw new DataHubException(dpe.getMessage());\n+        }\n+        return new ResponseEntity<>(flow, HttpStatus.OK);\n+    }\n+\n+    @RequestMapping(value = \"/{flowName}\", method = RequestMethod.PUT)\n+    @ResponseBody\n+    public ResponseEntity<?> updateFlow(@PathVariable String flowName, @RequestBody String flowJson) {\n+        Flow flow;\n+        try {\n+            flow = flowManagerService.createFlow(flowJson, true);", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\nindex 1393e658a..2b65b44e9 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/controllers/FlowController.java\n\n@@ -16,20 +16,16 @@\n package com.marklogic.hub.curation.controllers;\n \n import com.marklogic.hub.curation.services.FlowManagerService;\n-import com.marklogic.hub.error.DataHubProjectException;\n import com.marklogic.hub.flow.Flow;\n-import com.marklogic.hub.oneui.exceptions.DataHubException;\n import com.marklogic.hub.oneui.models.StepModel;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.http.HttpStatus;\n import org.springframework.http.ResponseEntity;\n-import org.springframework.scheduling.annotation.EnableAsync;\n import org.springframework.stereotype.Controller;\n import org.springframework.web.bind.annotation.*;\n \n @Controller\n @RequestMapping(\"/api/flows\")\n-@EnableAsync\n public class FlowController {\n \n     @Autowired\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MjI5MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369872291", "bodyText": "What's the point of using JSONObject? Why not just accept a JsonNode instead? The Spring controller can convert the RequestBody automatically into a JsonNode as well. That will cut out a lot of code and make for a richer method interface, as createFlow(JsonNode) is better than createFlow(String).", "author": "rjrudin", "createdAt": "2020-01-23T00:05:11Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java", "diffHunk": "@@ -0,0 +1,288 @@\n+package com.marklogic.hub.curation.services;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.FlowManager;\n+import com.marklogic.hub.StepDefinitionManager;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.flow.impl.FlowImpl;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import com.marklogic.hub.scaffold.Scaffolding;\n+import com.marklogic.hub.step.StepDefinition;\n+import com.marklogic.hub.step.impl.Step;\n+import com.marklogic.hub.util.json.JSONObject;\n+import com.marklogic.hub.util.json.JSONUtils;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.lang3.EnumUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.NotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+@Service\n+public class FlowManagerService {\n+\n+    @Autowired\n+    private FlowManager flowManager;\n+\n+    @Autowired\n+    private StepDefinitionManager stepDefinitionManager;\n+\n+    @Autowired\n+    private Scaffolding scaffolding;\n+\n+    public Flow createFlow(String flowJson, boolean isFlowPresent) {\n+        JSONObject jsonObject;\n+        try {\n+            jsonObject = new JSONObject(flowJson);", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMwODg4OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r370308888", "bodyText": "JSONObject (com.marklogic.hub.util.json) is a utility class that is composed of JsonNode  and has a bunch of other utility methods", "author": "srinathgit", "createdAt": "2020-01-23T19:23:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MjI5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\nindex 1464f3a40..8999e8f19 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n\n@@ -38,7 +38,40 @@ public class FlowManagerService {\n     @Autowired\n     private Scaffolding scaffolding;\n \n-    public Flow createFlow(String flowJson, boolean isFlowPresent) {\n+    public Flow updateFlow(String flowJson) {\n+        //for PUT updating\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+        flow = flowManager.getFlow(flowName);\n+        if (flow == null) {\n+            throw new DataHubException(\"Either the flow \"+ flowName +\" doesn't exist or an attempt to change flow name \" +\n+                \"is made which is prohibited \");\n+        }\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    public Flow createFlow(String flowJson) {\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+\n+        if (flowManager.isFlowExisted(flowName)) {\n+            throw new DataHubException(\"A Flow with \" + flowName + \" already exists.\");\n+        }\n+        flow = new FlowImpl();\n+        flow.setName(flowName);\n+\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    private JSONObject processPayload(String flowJson) {\n         JSONObject jsonObject;\n         try {\n             jsonObject = new JSONObject(flowJson);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3Mjg1MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369872851", "bodyText": "This all seems logic that would go into the DS endpoint. @aebadirad What are your thoughts on that? That would require calling ML first. But it would get rid of a ton of code in Java and move it into a more interesting DS endpoint that can see if the flow exists already, and create it if not or update it otherwise.", "author": "rjrudin", "createdAt": "2020-01-23T00:07:19Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java", "diffHunk": "@@ -0,0 +1,288 @@\n+package com.marklogic.hub.curation.services;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.FlowManager;\n+import com.marklogic.hub.StepDefinitionManager;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.flow.impl.FlowImpl;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import com.marklogic.hub.scaffold.Scaffolding;\n+import com.marklogic.hub.step.StepDefinition;\n+import com.marklogic.hub.step.impl.Step;\n+import com.marklogic.hub.util.json.JSONObject;\n+import com.marklogic.hub.util.json.JSONUtils;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.lang3.EnumUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.NotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+@Service\n+public class FlowManagerService {\n+\n+    @Autowired\n+    private FlowManager flowManager;\n+\n+    @Autowired\n+    private StepDefinitionManager stepDefinitionManager;\n+\n+    @Autowired\n+    private Scaffolding scaffolding;\n+\n+    public Flow createFlow(String flowJson, boolean isFlowPresent) {\n+        JSONObject jsonObject;\n+        try {\n+            jsonObject = new JSONObject(flowJson);\n+\n+            JSONUtils.trimText(jsonObject, \"separator\");\n+        }\n+        catch (IOException e) {\n+            throw new DataHubException(\"Unable to parse flow json string : \" + e.getMessage());\n+        }\n+\n+        if (!jsonObject.isExist(\"name\") || StringUtils.isEmpty(jsonObject.getString(\"name\"))) {\n+            throw new BadRequestException(\"Flow Name not provided. Flow Name is required.\");\n+        }\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+        if (!isFlowPresent) {", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\nindex 1464f3a40..8999e8f19 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n\n@@ -38,7 +38,40 @@ public class FlowManagerService {\n     @Autowired\n     private Scaffolding scaffolding;\n \n-    public Flow createFlow(String flowJson, boolean isFlowPresent) {\n+    public Flow updateFlow(String flowJson) {\n+        //for PUT updating\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+        flow = flowManager.getFlow(flowName);\n+        if (flow == null) {\n+            throw new DataHubException(\"Either the flow \"+ flowName +\" doesn't exist or an attempt to change flow name \" +\n+                \"is made which is prohibited \");\n+        }\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    public Flow createFlow(String flowJson) {\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+\n+        if (flowManager.isFlowExisted(flowName)) {\n+            throw new DataHubException(\"A Flow with \" + flowName + \" already exists.\");\n+        }\n+        flow = new FlowImpl();\n+        flow.setName(flowName);\n+\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    private JSONObject processPayload(String flowJson) {\n         JSONObject jsonObject;\n         try {\n             jsonObject = new JSONObject(flowJson);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3Mjk3OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369872979", "bodyText": "I would think the client shouldn't have to tell the service whether the flow exists yet or not - the service should know how to figure that out. The client just wants to say - here's my JSON, please save it.", "author": "rjrudin", "createdAt": "2020-01-23T00:07:51Z", "path": "one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java", "diffHunk": "@@ -0,0 +1,288 @@\n+package com.marklogic.hub.curation.services;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.FlowManager;\n+import com.marklogic.hub.StepDefinitionManager;\n+import com.marklogic.hub.error.DataHubProjectException;\n+import com.marklogic.hub.oneui.exceptions.DataHubException;\n+import com.marklogic.hub.flow.Flow;\n+import com.marklogic.hub.flow.impl.FlowImpl;\n+import com.marklogic.hub.oneui.models.StepModel;\n+import com.marklogic.hub.scaffold.Scaffolding;\n+import com.marklogic.hub.step.StepDefinition;\n+import com.marklogic.hub.step.impl.Step;\n+import com.marklogic.hub.util.json.JSONObject;\n+import com.marklogic.hub.util.json.JSONUtils;\n+import org.apache.commons.io.IOUtils;\n+import org.apache.commons.lang3.EnumUtils;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.NotFoundException;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+\n+@Service\n+public class FlowManagerService {\n+\n+    @Autowired\n+    private FlowManager flowManager;\n+\n+    @Autowired\n+    private StepDefinitionManager stepDefinitionManager;\n+\n+    @Autowired\n+    private Scaffolding scaffolding;\n+\n+    public Flow createFlow(String flowJson, boolean isFlowPresent) {", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "chunk": "diff --git a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\nindex 1464f3a40..8999e8f19 100644\n--- a/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n+++ b/one-ui/src/main/java/com/marklogic/hub/curation/services/FlowManagerService.java\n\n@@ -38,7 +38,40 @@ public class FlowManagerService {\n     @Autowired\n     private Scaffolding scaffolding;\n \n-    public Flow createFlow(String flowJson, boolean isFlowPresent) {\n+    public Flow updateFlow(String flowJson) {\n+        //for PUT updating\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+        flow = flowManager.getFlow(flowName);\n+        if (flow == null) {\n+            throw new DataHubException(\"Either the flow \"+ flowName +\" doesn't exist or an attempt to change flow name \" +\n+                \"is made which is prohibited \");\n+        }\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    public Flow createFlow(String flowJson) {\n+        JSONObject jsonObject = processPayload(flowJson);\n+\n+        String flowName = jsonObject.getString(\"name\");\n+        Flow flow;\n+\n+        if (flowManager.isFlowExisted(flowName)) {\n+            throw new DataHubException(\"A Flow with \" + flowName + \" already exists.\");\n+        }\n+        flow = new FlowImpl();\n+        flow.setName(flowName);\n+\n+        flow.deserialize(jsonObject.jsonNode());\n+        flowManager.saveFlow(flow);\n+        return flow;\n+    }\n+\n+    private JSONObject processPayload(String flowJson) {\n         JSONObject jsonObject;\n         try {\n             jsonObject = new JSONObject(flowJson);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MzM4Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r369873383", "bodyText": "What's the benefit of this class? Can't we just pass a JsonNode between the browser and ML? That would significantly reduce the code in the Java middle tier and put a lot more smarts into ML. And we wouldn't need to convert a JsonNode into some other class and then back to a JsonNode.", "author": "rjrudin", "createdAt": "2020-01-23T00:09:29Z", "path": "one-ui/src/main/java/com/marklogic/hub/oneui/models/StepModel.java", "diffHunk": "@@ -0,0 +1,307 @@\n+/*\n+ * Copyright 2012-2019 MarkLogic Corporation\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ */\n+package com.marklogic.hub.oneui.models;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.JsonNodeFactory;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.marklogic.hub.step.StepDefinition;\n+import com.marklogic.hub.step.impl.Step;\n+import com.marklogic.hub.util.json.JSONObject;\n+\n+import java.util.Iterator;\n+\n+public class StepModel {", "originalCommit": "e1806dfe7a7c6d1be2b3d1a962b5b888d9ce203b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMxMDMxOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3490#discussion_r370310319", "bodyText": "The UI doesn't know anything about step definition. So, when some one creates a custom step, we have to create a custom step definition, main.sjs in addition to the step itself that goes inside the flow. So, the core and web models for steps are different, webModel (called StepModel.java) has 'modulePath' which provides the uri of the main.sjs\nwhereas it is not present in the core step model (Step.java). This is all inherited from 5.0 code codebase .", "author": "srinathgit", "createdAt": "2020-01-23T19:26:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3MzM4Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/87e884495d1d2d75bfff2d6178d29e46eaeb566a", "message": "DHFPROD-4104:Middle tier for flow/step CRUD", "committedDate": "2020-01-23T19:38:22Z", "type": "commit"}, {"oid": "87e884495d1d2d75bfff2d6178d29e46eaeb566a", "url": "https://github.com/marklogic/marklogic-data-hub/commit/87e884495d1d2d75bfff2d6178d29e46eaeb566a", "message": "DHFPROD-4104:Middle tier for flow/step CRUD", "committedDate": "2020-01-23T19:38:22Z", "type": "forcePushed"}]}