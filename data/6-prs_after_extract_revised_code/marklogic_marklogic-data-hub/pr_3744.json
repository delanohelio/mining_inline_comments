{"pr_number": 3744, "pr_title": "DHFPROD-4531: Handle runFlow exception to return a proper message to the caller", "pr_createdAt": "2020-03-24T05:33:42Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3744", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxMzkyNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396913927", "bodyText": "\"error\" seems like the better logging level here", "author": "srinathgit", "createdAt": "2020-03-24T05:45:28Z", "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -38,20 +38,25 @@ public HttpResponseMessage run(\n         } else {\n             // Write the name to the message queue.\n             msg.setValue(name);\n-\n-            runFlow();\n-            return request.createResponseBuilder(HttpStatus.OK).body(\"Hello, \" + name).build();\n+            String runFlowMessage = \"Flow <\" + name + \"> successfully executed.\"; //default message\n+            try {\n+                runFlow(name);\n+            } catch (Exception ex) {\n+                context.getLogger().info(\"Exception caught: \" + ex.getMessage());", "originalCommit": "f146825e65a3966d3841eca0da2dc01beb068037", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkyNzUyNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396927527", "bodyText": "Good point. User would never see this message as it will be logged at the azure apps backend. But nonetheless, changed to \"severe\" to honor the semantics.", "author": "vgouraba", "createdAt": "2020-03-24T06:34:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxMzkyNw=="}], "type": "inlineReview", "revised_code": {"commit": "547783b3fadcdbf320b5522311c855fd86335ce1", "chunk": "diff --git a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nsimilarity index 85%\nrename from azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\nrename to azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nindex 36f56566c..83c0d1a5e 100644\n--- a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\n+++ b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\n\n@@ -42,14 +42,14 @@ public class FunctionDhfFlow {\n             try {\n                 runFlow(name);\n             } catch (Exception ex) {\n-                context.getLogger().info(\"Exception caught: \" + ex.getMessage());\n+                context.getLogger().severe(\"Exception caught: \" + ex.getMessage());\n                 runFlowMessage = ex.getMessage(); //set to exception\n             }\n             return request.createResponseBuilder(HttpStatus.OK).body(runFlowMessage).build();\n         }\n     }\n \n-    // Run DHF flow\n+    // Run DataHub flow\n     public void runFlow(String flowName) {\n         System.out.println (\"**** Inside AzureFunction runFlow method\");\n         // Create a FlowRunner instance.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDYyMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396914621", "bodyText": "'RunFlowResponse' object.toString() returns a JSON string which provides details of every step that ran in the flow, along with the stats. Will that be more useful to the user ?", "author": "srinathgit", "createdAt": "2020-03-24T05:48:18Z", "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -38,20 +38,25 @@ public HttpResponseMessage run(\n         } else {\n             // Write the name to the message queue.\n             msg.setValue(name);\n-\n-            runFlow();\n-            return request.createResponseBuilder(HttpStatus.OK).body(\"Hello, \" + name).build();\n+            String runFlowMessage = \"Flow <\" + name + \"> successfully executed.\"; //default message", "originalCommit": "f146825e65a3966d3841eca0da2dc01beb068037", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxOTY0Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r396919642", "bodyText": "As part of this Jira, we are not actually running a valid flow. I plan to providing a valid/correct response as part of the next Jira 4532. As part of the current Jira 4531, we are always returning HTTP 200 with a status message (in this case it will always be exception message).", "author": "vgouraba", "createdAt": "2020-03-24T06:07:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjkxNDYyMQ=="}], "type": "inlineReview", "revised_code": {"commit": "547783b3fadcdbf320b5522311c855fd86335ce1", "chunk": "diff --git a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nsimilarity index 85%\nrename from azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\nrename to azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nindex 36f56566c..83c0d1a5e 100644\n--- a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\n+++ b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\n\n@@ -42,14 +42,14 @@ public class FunctionDhfFlow {\n             try {\n                 runFlow(name);\n             } catch (Exception ex) {\n-                context.getLogger().info(\"Exception caught: \" + ex.getMessage());\n+                context.getLogger().severe(\"Exception caught: \" + ex.getMessage());\n                 runFlowMessage = ex.getMessage(); //set to exception\n             }\n             return request.createResponseBuilder(HttpStatus.OK).body(runFlowMessage).build();\n         }\n     }\n \n-    // Run DHF flow\n+    // Run DataHub flow\n     public void runFlow(String flowName) {\n         System.out.println (\"**** Inside AzureFunction runFlow method\");\n         // Create a FlowRunner instance.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwMjA3NQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r397102075", "bodyText": "Same thing, can you do DataHubFlow? Or - just rename this in the next JIRA ticket. Either approach is fine.", "author": "rjrudin", "createdAt": "2020-03-24T12:06:03Z", "path": "azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java", "diffHunk": "@@ -18,9 +18,9 @@\n  */\n public class FunctionDhfFlow {\n     /**\n-     * This function listens at endpoint \"/api/HttpExample\". Two ways to invoke it using \"curl\" command in bash:\n-     * 1. curl -d \"HTTP Body\" {your host}/api/HttpExample\n-     * 2. curl \"{your host}/api/HttpExample?name=HTTP%20Query\"\n+     * This function listens at endpoint \"/api/HttpExampleDhfFlow\". Two ways to invoke it using \"curl\" command in bash:", "originalCommit": "25c8a846d3af4a0052739b072a7968b22ec8a5fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzMyODM5Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3744#discussion_r397328393", "bodyText": "Sure. Done.", "author": "vgouraba", "createdAt": "2020-03-24T17:19:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzEwMjA3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "547783b3fadcdbf320b5522311c855fd86335ce1", "chunk": "diff --git a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nsimilarity index 88%\nrename from azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\nrename to azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\nindex fecbf091e..83c0d1a5e 100644\n--- a/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDhfFlow.java\n+++ b/azure/flow-runner-function/src/main/java/com/marklogic/dhf/azure/FunctionDataHubFlow.java\n\n@@ -16,13 +16,13 @@ import com.marklogic.hub.flow.impl.FlowRunnerImpl;\n /**\n  * Azure Functions with HTTP Trigger.\n  */\n-public class FunctionDhfFlow {\n+public class FunctionDataHubFlow {\n     /**\n-     * This function listens at endpoint \"/api/HttpExampleDhfFlow\". Two ways to invoke it using \"curl\" command in bash:\n-     * 1. curl -d \"HTTP Body\" {your host}/api/HttpExampleDhfFlow\n-     * 2. curl \"{your host}/api/HttpExampleDhfFlow?name=HTTP%20Query\"\n+     * This function listens at endpoint \"/api/HttpExampleDataHubFlow\". Two ways to invoke it using \"curl\" command in bash:\n+     * 1. curl -d \"HTTP Body\" {your host}/api/HttpExampleDataHubFlow\n+     * 2. curl \"{your host}/api/HttpExampleDataHubFlow?name=HTTP%20Query\"\n      */\n-    @FunctionName(\"HttpExampleDhfFlow\")\n+    @FunctionName(\"HttpExampleDataHubFlow\")\n     public HttpResponseMessage run(\n             @HttpTrigger(name = \"req\", methods = {HttpMethod.GET, HttpMethod.POST}, authLevel = AuthorizationLevel.ANONYMOUS) HttpRequestMessage<Optional<String>> request,\n             @QueueOutput(name = \"msg\", queueName = \"dhf-queue\", connection = \"AzureWebJobsStorage\") OutputBinding<String> msg,\n"}}, {"oid": "547783b3fadcdbf320b5522311c855fd86335ce1", "url": "https://github.com/marklogic/marklogic-data-hub/commit/547783b3fadcdbf320b5522311c855fd86335ce1", "message": "handle runflow exception to return a proper message to the caller\n\nchange logger message from info to severe\n\nDHFPROD-4531: rename function names from Dhf to DataHub", "committedDate": "2020-03-24T17:17:55Z", "type": "commit"}]}