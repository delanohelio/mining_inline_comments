{"pr_number": 3830, "pr_title": "DHFPROD-3650: Delete saved personal queries feature", "pr_createdAt": "2020-04-16T22:23:02Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3830", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkyMzc0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3830#discussion_r409923740", "bodyText": "I'm of the opinion that it's perfectly fine just to toss the test of deletion onto an existing test method, like the existing createThenUpdate test. Fewer test methods means less time setting up tests, which means our test suite is faster.", "author": "rjrudin", "createdAt": "2020-04-17T00:26:24Z", "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java", "diffHunk": "@@ -110,4 +110,38 @@ void getSavedQuery() throws Exception {\n                     assertEquals(savedQueryResponse.get(\"savedQuery\").get(\"id\").asText(), response.get(\"savedQuery\").get(\"id\").asText());\n                 });\n     }\n+\n+    @Test\n+    void deleteSavedQuery() throws Exception {", "originalCommit": "8f176af8a985cc27278a98c02b48095dc128b877", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "af7024da2af0e2cc9389b1e22b4d0c71c806da18", "chunk": "diff --git a/marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java b/marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java\nindex 74e46eaa7..83c08e83e 100644\n--- a/marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java\n+++ b/marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/EntitySearchControllerTest.java\n\n@@ -109,31 +63,16 @@ public class EntitySearchControllerTest extends AbstractMvcTest {\n                     ObjectNode response = readJsonObject(result.getResponse().getContentAsString());\n                     assertEquals(savedQueryResponse.get(\"savedQuery\").get(\"id\").asText(), response.get(\"savedQuery\").get(\"id\").asText());\n                 });\n-    }\n-\n-    @Test\n-    void deleteSavedQuery() throws Exception {\n-        String json = \"{\\n\" +\n-                \"  \\\"savedQuery\\\": {\\n\" +\n-                \"    \\\"name\\\": \\\"some-query\\\",\\n\" +\n-                \"    \\\"description\\\": \\\"some-query-description\\\",\\n\" +\n-                \"    \\\"query\\\": {\\n\" +\n-                \"      \\\"searchText\\\": \\\"some-string\\\",\\n\" +\n-                \"      \\\"entityTypeIds\\\": [\\n\" +\n-                \"        \\\"Entity1\\\"\\n\" +\n-                \"      ]\\n\" +\n-                \"    },\\n\" +\n-                \"    \\\"propertiesToDisplay\\\": [\\\"facet1\\\", \\\"EntityTypeProperty1\\\"]\\n\" +\n-                \"  }\\n\" +\n-                \"}\";\n-\n-        postJson(SAVED_QUERIES_PATH, json)\n-                .andExpect(status().isCreated())\n-                .andDo(result -> savedQueryResponse = readJsonObject(result.getResponse().getContentAsString()));\n \n-        MultiValueMap<String, String> params = new LinkedMultiValueMap<>();\n-        params.add(\"id\", savedQueryResponse.get(\"savedQuery\").get(\"id\").asText());\n+        // testing get all savedQuery documents\n+        getJson(SAVED_QUERIES_PATH, new LinkedMultiValueMap<>())\n+                .andExpect(status().isOk())\n+                .andDo(result -> {\n+                    ArrayNode response = readJsonArray(result.getResponse().getContentAsString());\n+                    assertTrue(response.size() > 0, \"There should be at least one saved query document\");\n+                });\n \n+        // testing delete savedQuery document\n         deleteJson(SAVED_QUERIES_PATH+\"/query\", params)\n                 .andExpect(status().isNoContent());\n \n"}}, {"oid": "af7024da2af0e2cc9389b1e22b4d0c71c806da18", "url": "https://github.com/marklogic/marklogic-data-hub/commit/af7024da2af0e2cc9389b1e22b4d0c71c806da18", "message": "DHFPROD-3650: Delete saved personal queries", "committedDate": "2020-04-17T02:32:21Z", "type": "commit"}, {"oid": "d3e2e34607c2cca813187f3b822215ea73449138", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d3e2e34607c2cca813187f3b822215ea73449138", "message": "DHFPROD-3650: Refactoring Search API to match with SavedQueries feature", "committedDate": "2020-04-17T02:32:37Z", "type": "commit"}, {"oid": "d3e2e34607c2cca813187f3b822215ea73449138", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d3e2e34607c2cca813187f3b822215ea73449138", "message": "DHFPROD-3650: Refactoring Search API to match with SavedQueries feature", "committedDate": "2020-04-17T02:32:37Z", "type": "forcePushed"}]}