{"pr_number": 3651, "pr_title": "DHFPROD-4562: Export project got exception if a folder does not exist\u2026", "pr_createdAt": "2020-03-05T18:33:34Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3651", "timeline": [{"oid": "1c94adba60f0105065b36db7b97e8e3611deef69", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1c94adba60f0105065b36db7b97e8e3611deef69", "message": "DHFPROD-4562: Export project got exception if a folder does not exist in the exported project folder", "committedDate": "2020-03-05T18:28:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NDA1Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388484053", "bodyText": "I think that logging that a folder doesn't exist is sufficient.", "author": "ryanjdew", "createdAt": "2020-03-05T18:36:10Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubProjectImpl.java", "diffHunk": "@@ -647,6 +647,11 @@ private void writeToStream(OutputStream out) {\n             Stream.of(\"entities\", \"flows\", \"src\" + File.separator + \"main\", \"mappings\", \"step-definitions\", \"loadData\", \"gradle\",\n                 \"gradlew\", \"gradlew.bat\", \"build.gradle\", \"gradle.properties\").forEach(file ->{\n                 File fileToZip = getProjectDir().resolve(file).toFile();\n+                if (!fileToZip.exists()) {\n+                    // should we add check if some missing files/folders are mandatory and give error info?", "originalCommit": "1c94adba60f0105065b36db7b97e8e3611deef69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MDkzNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388490936", "bodyText": "@hao1st what if there are gradle-<evn>.properties?\n@bsrikan from the package list, we only need gradle.properties and ignore those \"gradle-*.properties\" though i do not sure the list is complete.", "author": "bsrikan", "createdAt": "2020-03-05T18:49:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NDA1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MTM0OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388491349", "bodyText": "The original requirement was to exclude gradle-*.properties, as there may be sensitive data in those that shouldn't be shared.", "author": "rjrudin", "createdAt": "2020-03-05T18:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4NDA1Mw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388492099", "bodyText": "@hao1st Since a bug is being fixed, there should be a test that reproduces the bug such that if I comment out this change, the test fails, and then the test succeeds with this change in place.\nThe only exception to this is if we have some sort of intermittent bug with no idea of how to reproduce it, which would be indicated by the JIRA ticket lacking reproducible steps.", "author": "rjrudin", "createdAt": "2020-03-05T18:51:32Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubProjectImpl.java", "diffHunk": "@@ -647,6 +647,11 @@ private void writeToStream(OutputStream out) {\n             Stream.of(\"entities\", \"flows\", \"src\" + File.separator + \"main\", \"mappings\", \"step-definitions\", \"loadData\", \"gradle\",\n                 \"gradlew\", \"gradlew.bat\", \"build.gradle\", \"gradle.properties\").forEach(file ->{\n                 File fileToZip = getProjectDir().resolve(file).toFile();\n+                if (!fileToZip.exists()) {", "originalCommit": "1c94adba60f0105065b36db7b97e8e3611deef69", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU0MzIzMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388543232", "bodyText": "@rjrudin I think that the change is trying to make the code more robust so that we can make sure the exported zip includes all the folder/files from the project folder. If any of them is missing against necessary folder structure, we can identify it for sure.", "author": "hao1st", "createdAt": "2020-03-05T20:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU2MTEzNQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388561135", "bodyText": "It looks like the change is trying to prevent the export from breaking when a directory doesn't exist. So an automated test would simulate that condition by e.g. deleting one of these directories or files before calling the export method.", "author": "rjrudin", "createdAt": "2020-03-05T20:56:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODU4OTEzNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388589136", "bodyText": "@rjrudin we already have a downloadProject test case, and it will throw excception and the case will fail if required package folder is missing without the change.", "author": "hao1st", "createdAt": "2020-03-05T21:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODYwNjIxMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r388606212", "bodyText": "I think the upload project test was commented out. Can we uncomment it and see what we get. Earlier we were getting an error saying \"loadData: No such file or directory\"", "author": "bsrikan", "createdAt": "2020-03-05T22:33:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAyMjkzNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3651#discussion_r389022937", "bodyText": "@bsrikan upload project test case was not commented out, but it was broken. The PR is the reason due to export failure.", "author": "hao1st", "createdAt": "2020-03-06T16:58:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5MjA5OQ=="}], "type": "inlineReview", "revised_code": null}]}