{"pr_number": 6249, "pr_title": "[2.19.x] DDF-6223 Added Logout Redirect", "pr_createdAt": "2020-08-17T23:16:38Z", "pr_url": "https://github.com/codice/ddf/pull/6249", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM4MzM3NQ==", "url": "https://github.com/codice/ddf/pull/6249#discussion_r473383375", "bodyText": "this logging should be parameterized", "author": "bdeining", "createdAt": "2020-08-19T22:22:09Z", "path": "platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java", "diffHunk": "@@ -102,4 +112,26 @@ private void deleteJSessionId(HttpServletResponse response) {\n     cookie.setComment(\"EXPIRING COOKIE at \" + System.currentTimeMillis());\n     response.addCookie(cookie);\n   }\n+\n+  private String getRedirectUriMessage() {\n+    String redirectUriMessage = \"\";\n+    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n+        && Strings.isNotBlank(redirectUri)) {\n+      try {\n+        URIBuilder redirectUrlBuilder =\n+            new URIBuilder(SystemBaseUrl.INTERNAL.getBaseUrl() + redirectUri);\n+        redirectUriMessage =\n+            redirectUrlBuilder == null ? \"\" : redirectUrlBuilder.build().toString();\n+      } catch (URISyntaxException e) {\n+        LOGGER.debug(\n+            \"Invalid URI of %s set for logout redirect uri. Users will not be redirected to %s upon logout.\",", "originalCommit": "5994c99aa6063649f1910023090cf92e1a0ea4ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAzMzU0OQ==", "url": "https://github.com/codice/ddf/pull/6249#discussion_r476033549", "bodyText": "Yeah this is a format string, not a parameterized log string. By parameterized, we mean:\n\"Invalid URI of {} set for logout redirect uri. Users will not be redirected to {} upon logout.\"", "author": "Lambeaux", "createdAt": "2020-08-25T01:20:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM4MzM3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "990fe46754700aee433034d887e7ad9f0b7ef56d", "chunk": "diff --git a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\nindex 816df1edc6..bb66c106a9 100644\n--- a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n+++ b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n\n@@ -113,25 +112,25 @@ private void deleteJSessionId(HttpServletResponse response) {\n     response.addCookie(cookie);\n   }\n \n-  private String getRedirectUriMessage() {\n-    String redirectUriMessage = \"\";\n-    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n-        && Strings.isNotBlank(redirectUri)) {\n+  private String getRedirectUrlMessage() {\n+    String redirectUrlMessage = \"\";\n+    if (Strings.isNotBlank(redirectUrl)) {\n       try {\n-        URIBuilder redirectUrlBuilder =\n-            new URIBuilder(SystemBaseUrl.INTERNAL.getBaseUrl() + redirectUri);\n-        redirectUriMessage =\n+        URIBuilder redirectUrlBuilder = new URIBuilder(redirectUrl);\n+        redirectUrlMessage =\n             redirectUrlBuilder == null ? \"\" : redirectUrlBuilder.build().toString();\n       } catch (URISyntaxException e) {\n         LOGGER.debug(\n-            \"Invalid URI of %s set for logout redirect uri. Users will not be redirected to %s upon logout.\",\n-            redirectUri, redirectUri, e);\n+            \"Invalid URL of {} set for logout redirect URL. Users will not be redirected to {} upon logout.\",\n+            redirectUrl,\n+            redirectUrl,\n+            e);\n       }\n     }\n-    return redirectUriMessage;\n+    return redirectUrlMessage;\n   }\n \n-  public void setRedirectUri(String redirectUri) {\n-    this.redirectUri = redirectUri;\n+  public void setRedirectUrl(String redirectUrl) {\n+    this.redirectUrl = redirectUrl;\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyMzg4Mg==", "url": "https://github.com/codice/ddf/pull/6249#discussion_r476523882", "bodyText": "\u270f\ufe0f This is more of a redirect path and not a URI.", "author": "pklinef", "createdAt": "2020-08-25T15:08:29Z", "path": "platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java", "diffHunk": "@@ -102,4 +112,26 @@ private void deleteJSessionId(HttpServletResponse response) {\n     cookie.setComment(\"EXPIRING COOKIE at \" + System.currentTimeMillis());\n     response.addCookie(cookie);\n   }\n+\n+  private String getRedirectUriMessage() {\n+    String redirectUriMessage = \"\";\n+    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n+        && Strings.isNotBlank(redirectUri)) {\n+      try {\n+        URIBuilder redirectUrlBuilder =\n+            new URIBuilder(SystemBaseUrl.INTERNAL.getBaseUrl() + redirectUri);", "originalCommit": "5994c99aa6063649f1910023090cf92e1a0ea4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "990fe46754700aee433034d887e7ad9f0b7ef56d", "chunk": "diff --git a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\nindex 816df1edc6..bb66c106a9 100644\n--- a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n+++ b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n\n@@ -113,25 +112,25 @@ private void deleteJSessionId(HttpServletResponse response) {\n     response.addCookie(cookie);\n   }\n \n-  private String getRedirectUriMessage() {\n-    String redirectUriMessage = \"\";\n-    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n-        && Strings.isNotBlank(redirectUri)) {\n+  private String getRedirectUrlMessage() {\n+    String redirectUrlMessage = \"\";\n+    if (Strings.isNotBlank(redirectUrl)) {\n       try {\n-        URIBuilder redirectUrlBuilder =\n-            new URIBuilder(SystemBaseUrl.INTERNAL.getBaseUrl() + redirectUri);\n-        redirectUriMessage =\n+        URIBuilder redirectUrlBuilder = new URIBuilder(redirectUrl);\n+        redirectUrlMessage =\n             redirectUrlBuilder == null ? \"\" : redirectUrlBuilder.build().toString();\n       } catch (URISyntaxException e) {\n         LOGGER.debug(\n-            \"Invalid URI of %s set for logout redirect uri. Users will not be redirected to %s upon logout.\",\n-            redirectUri, redirectUri, e);\n+            \"Invalid URL of {} set for logout redirect URL. Users will not be redirected to {} upon logout.\",\n+            redirectUrl,\n+            redirectUrl,\n+            e);\n       }\n     }\n-    return redirectUriMessage;\n+    return redirectUrlMessage;\n   }\n \n-  public void setRedirectUri(String redirectUri) {\n-    this.redirectUri = redirectUri;\n+  public void setRedirectUrl(String redirectUrl) {\n+    this.redirectUrl = redirectUrl;\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjUyNzM3Mw==", "url": "https://github.com/codice/ddf/pull/6249#discussion_r476527373", "bodyText": "\u2753 Should we instead add the ability to point to any URL which could include an external security system?  I am not sure if we should always assume DDF will handle logout.  For example, you could logout of Keycloak directly instead of redirecting from the DDF logout servlet.\nhttps://www.keycloak.org/docs/latest/securing_apps/index.html#logout", "author": "pklinef", "createdAt": "2020-08-25T15:13:23Z", "path": "platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java", "diffHunk": "@@ -102,4 +112,26 @@ private void deleteJSessionId(HttpServletResponse response) {\n     cookie.setComment(\"EXPIRING COOKIE at \" + System.currentTimeMillis());\n     response.addCookie(cookie);\n   }\n+\n+  private String getRedirectUriMessage() {\n+    String redirectUriMessage = \"\";\n+    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n+        && Strings.isNotBlank(redirectUri)) {", "originalCommit": "5994c99aa6063649f1910023090cf92e1a0ea4ee", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "990fe46754700aee433034d887e7ad9f0b7ef56d", "chunk": "diff --git a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\nindex 816df1edc6..bb66c106a9 100644\n--- a/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n+++ b/platform/security/servlet/security-servlet-logout/src/main/java/org/codice/ddf/security/servlet/logout/LocalLogoutServlet.java\n\n@@ -113,25 +112,25 @@ private void deleteJSessionId(HttpServletResponse response) {\n     response.addCookie(cookie);\n   }\n \n-  private String getRedirectUriMessage() {\n-    String redirectUriMessage = \"\";\n-    if (Strings.isNotBlank(SystemBaseUrl.INTERNAL.getBaseUrl())\n-        && Strings.isNotBlank(redirectUri)) {\n+  private String getRedirectUrlMessage() {\n+    String redirectUrlMessage = \"\";\n+    if (Strings.isNotBlank(redirectUrl)) {\n       try {\n-        URIBuilder redirectUrlBuilder =\n-            new URIBuilder(SystemBaseUrl.INTERNAL.getBaseUrl() + redirectUri);\n-        redirectUriMessage =\n+        URIBuilder redirectUrlBuilder = new URIBuilder(redirectUrl);\n+        redirectUrlMessage =\n             redirectUrlBuilder == null ? \"\" : redirectUrlBuilder.build().toString();\n       } catch (URISyntaxException e) {\n         LOGGER.debug(\n-            \"Invalid URI of %s set for logout redirect uri. Users will not be redirected to %s upon logout.\",\n-            redirectUri, redirectUri, e);\n+            \"Invalid URL of {} set for logout redirect URL. Users will not be redirected to {} upon logout.\",\n+            redirectUrl,\n+            redirectUrl,\n+            e);\n       }\n     }\n-    return redirectUriMessage;\n+    return redirectUrlMessage;\n   }\n \n-  public void setRedirectUri(String redirectUri) {\n-    this.redirectUri = redirectUri;\n+  public void setRedirectUrl(String redirectUrl) {\n+    this.redirectUrl = redirectUrl;\n   }\n }\n"}}, {"oid": "990fe46754700aee433034d887e7ad9f0b7ef56d", "url": "https://github.com/codice/ddf/commit/990fe46754700aee433034d887e7ad9f0b7ef56d", "message": "DDF-6223 Added Logout Redirect", "committedDate": "2020-08-31T23:51:12Z", "type": "forcePushed"}, {"oid": "6efc5595b53a354b59b733ec427e7b6f1a377307", "url": "https://github.com/codice/ddf/commit/6efc5595b53a354b59b733ec427e7b6f1a377307", "message": "DDF-6223 Added Logout Redirect", "committedDate": "2020-09-01T00:11:40Z", "type": "commit"}, {"oid": "6efc5595b53a354b59b733ec427e7b6f1a377307", "url": "https://github.com/codice/ddf/commit/6efc5595b53a354b59b733ec427e7b6f1a377307", "message": "DDF-6223 Added Logout Redirect", "committedDate": "2020-09-01T00:11:40Z", "type": "forcePushed"}]}