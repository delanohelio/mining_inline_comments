{"pr_number": 6190, "pr_title": "DDF-6182 Move OutgoingSubjectRetrievalInterceptor into custom CXF client code", "pr_createdAt": "2020-07-20T19:42:42Z", "pr_url": "https://github.com/codice/ddf/pull/6190", "timeline": [{"oid": "21d47844c57ea260289f7535f27447134abc269b", "url": "https://github.com/codice/ddf/commit/21d47844c57ea260289f7535f27447134abc269b", "message": "Remove usage of SubjectRetrievalInterceptor from CSW code", "committedDate": "2020-07-20T22:26:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0Njk4NQ==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r458246985", "bodyText": "\u270f\ufe0f Javadoc needs to be updated", "author": "SmithJosh", "createdAt": "2020-07-21T16:54:53Z", "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/client/interceptor/SubjectRetrievalInterceptor.java", "diffHunk": "@@ -38,7 +38,7 @@\n  * that stores the receivers subject in the header of the response with a key of\n  * ddf.security.Subject.\n  */\n-public class OutgoingSubjectRetrievalInterceptor extends AbstractPhaseInterceptor<Message>\n+public class SubjectRetrievalInterceptor extends AbstractPhaseInterceptor<Message>", "originalCommit": "21d47844c57ea260289f7535f27447134abc269b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "65d8b8cd64ccb817dd5f1fb6402d95fe39f6352f", "chunk": "diff --git a/platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/client/interceptor/SubjectRetrievalInterceptor.java b/platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/client/interceptor/SubjectRetrievalInterceptor.java\nindex 89ca8a0714..d034565187 100644\n--- a/platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/client/interceptor/SubjectRetrievalInterceptor.java\n+++ b/platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/client/interceptor/SubjectRetrievalInterceptor.java\n\n@@ -34,9 +34,8 @@\n import org.codice.ddf.security.handler.AuthenticationTokenFactory;\n \n /**\n- * OutgoingSubjectRetrievalInterceptor provides a implementation of {@link AbstractPhaseInterceptor}\n- * that stores the receivers subject in the header of the response with a key of\n- * ddf.security.Subject.\n+ * SubjectRetrievalInterceptor provides a implementation of {@link AbstractPhaseInterceptor} that\n+ * stores the receivers subject in the header of the response with a key of ddf.security.Subject.\n  */\n public class SubjectRetrievalInterceptor extends AbstractPhaseInterceptor<Message>\n     implements Handler<WrappedMessageContext> {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0ODg5Ng==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r458248896", "bodyText": "\u2753 In what case would you set this to false?", "author": "SmithJosh", "createdAt": "2020-07-21T16:57:49Z", "path": "platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/ClientBuilder.java", "diffHunk": "@@ -188,4 +188,12 @@\n    * @return\n    */\n   ClientBuilder<T> useSamlEcp(boolean useSamlEcp);\n+\n+  /**\n+   * True will enable the use of the SubjectRetrievalInterceptor for this client.\n+   *\n+   * @param useSubjectRetrievalInterceptor\n+   * @return\n+   */\n+  ClientBuilder<T> useSubjectRetrievalInterceptor(boolean useSubjectRetrievalInterceptor);", "originalCommit": "21d47844c57ea260289f7535f27447134abc269b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0Njc1MQ==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r459646751", "bodyText": "Sorry, I'm still a little unclear here. What's the use case where the subject retrieval interceptor would not be used?", "author": "SmithJosh", "createdAt": "2020-07-23T18:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0ODg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIyNTI0OQ==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r463225249", "bodyText": "I don't have a very clear grasp on it either since I was focusing on preserving functionality. But I think I know its use.\nWhat I know:\nLets say DDF1 subscribes to DDF2 through CSW by sending a subscription request. The subscription request contains a query and says \"Hey, every time you (DDF2) update your catalog with an entry that matches the given query, I want you to send me (DDF1) those updates\".\nWhat I think I know:\nNow when DDF2 updates is catalog appropriately, it needs to run the query and possible return results to DDF1. But that query might contain sensitive information that DDF1 isn't allowed to see, so before DDF2 runs the query it uses the SubjectRetreivalInterceptor to grab the certificates of DDF1, creates a subject, and runs the query as that subject in order to filter results DDF1 shouldn't see.", "author": "bakejeyner", "createdAt": "2020-07-30T19:35:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0ODg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIyODA3OQ==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r463228079", "bodyText": "The original javadoc says \"stores the receivers subject in the header of the response with a key of ddf.security.Subject.\"\nNot sure why we would care about the subject in a response.", "author": "bakejeyner", "createdAt": "2020-07-30T19:40:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0ODg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI4MDMwNw==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r463280307", "bodyText": "Not sure why we would care about the subject in a response.\n\nI don't get that either. Thanks for the explanation though \ud83d\ude04", "author": "SmithJosh", "createdAt": "2020-07-30T21:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI0ODg5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "65d8b8cd64ccb817dd5f1fb6402d95fe39f6352f", "chunk": "diff --git a/platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/ClientBuilder.java b/platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/ClientBuilder.java\nindex e7644faa6a..0f30f8e852 100644\n--- a/platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/ClientBuilder.java\n+++ b/platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/ClientBuilder.java\n\n@@ -195,5 +195,5 @@\n    * @param useSubjectRetrievalInterceptor\n    * @return\n    */\n-  ClientBuilder<T> useSubjectRetrievalInterceptor(boolean useSubjectRetrievalInterceptor);\n+  ClientBuilder<T> useSubjectRetrievalInterceptor();\n }\n"}}, {"oid": "65d8b8cd64ccb817dd5f1fb6402d95fe39f6352f", "url": "https://github.com/codice/ddf/commit/65d8b8cd64ccb817dd5f1fb6402d95fe39f6352f", "message": "Remove parameter from useSubjectRetrievalInterceptor method", "committedDate": "2020-07-23T16:19:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTY0NzQ1Nw==", "url": "https://github.com/codice/ddf/pull/6190#discussion_r459647457", "bodyText": "This uses the old api method", "author": "SmithJosh", "createdAt": "2020-07-23T18:30:57Z", "path": "catalog/spatial/csw/spatial-csw-endpoint/src/main/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/event/SendEvent.java", "diffHunk": "@@ -156,11 +154,11 @@ public SendEvent(\n               .interfaceClass(CswSubscribe.class)\n               .entityProviders(providers)\n               .useSamlEcp(true)\n+              .useSubjectRetrievalInterceptor(true)", "originalCommit": "65d8b8cd64ccb817dd5f1fb6402d95fe39f6352f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "8974e870060b44a6d0dcf6419341a4d8b432c07e", "chunk": "diff --git a/catalog/spatial/csw/spatial-csw-endpoint/src/main/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/event/SendEvent.java b/catalog/spatial/csw/spatial-csw-endpoint/src/main/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/event/SendEvent.java\nindex 8e6f73b5e4..874b5471aa 100644\n--- a/catalog/spatial/csw/spatial-csw-endpoint/src/main/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/event/SendEvent.java\n+++ b/catalog/spatial/csw/spatial-csw-endpoint/src/main/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/event/SendEvent.java\n\n@@ -154,7 +154,7 @@ public SendEvent(\n               .interfaceClass(CswSubscribe.class)\n               .entityProviders(providers)\n               .useSamlEcp(true)\n-              .useSubjectRetrievalInterceptor(true)\n+              .useSubjectRetrievalInterceptor()\n               .build();\n     } catch (URISyntaxException e) {\n       throw new IllegalArgumentException(e);\n"}}, {"oid": "8974e870060b44a6d0dcf6419341a4d8b432c07e", "url": "https://github.com/codice/ddf/commit/8974e870060b44a6d0dcf6419341a4d8b432c07e", "message": "Remove parameter from useSubjectRetrievalInterceptor", "committedDate": "2020-07-30T18:44:34Z", "type": "forcePushed"}, {"oid": "5f0207508f022ba1c288dd00b5061c51ea03ec6f", "url": "https://github.com/codice/ddf/commit/5f0207508f022ba1c288dd00b5061c51ea03ec6f", "message": "Move OutgoingSubjectRetrievalInterceptor into custom CXF client code", "committedDate": "2020-09-10T18:05:58Z", "type": "commit"}, {"oid": "62b202b6072aef0584e5d58a6dc17f78aae00f9d", "url": "https://github.com/codice/ddf/commit/62b202b6072aef0584e5d58a6dc17f78aae00f9d", "message": "Refactor tests to account for ClientBuilderImpl constructor change", "committedDate": "2020-09-10T18:06:03Z", "type": "commit"}, {"oid": "9322cf1c740a87e56105e8e6c09ecc5259b5a99b", "url": "https://github.com/codice/ddf/commit/9322cf1c740a87e56105e8e6c09ecc5259b5a99b", "message": "Remove usage of SubjectRetrievalInterceptor from CSW code", "committedDate": "2020-09-10T18:07:19Z", "type": "commit"}, {"oid": "62f8a6a4fb7cbd028af8c11ea6dbac559f97e728", "url": "https://github.com/codice/ddf/commit/62f8a6a4fb7cbd028af8c11ea6dbac559f97e728", "message": "Remove parameter from useSubjectRetrievalInterceptor method", "committedDate": "2020-09-10T18:07:24Z", "type": "commit"}, {"oid": "3e04d742f15931497afe8c1808d91fcc4e3a8314", "url": "https://github.com/codice/ddf/commit/3e04d742f15931497afe8c1808d91fcc4e3a8314", "message": "Remove parameter from useSubjectRetrievalInterceptor", "committedDate": "2020-09-10T18:08:11Z", "type": "commit"}, {"oid": "c8a8714a990d113cb612705133730acffe2413fd", "url": "https://github.com/codice/ddf/commit/c8a8714a990d113cb612705133730acffe2413fd", "message": "Use correct SecurityManager package", "committedDate": "2020-09-10T18:08:16Z", "type": "commit"}, {"oid": "c8a8714a990d113cb612705133730acffe2413fd", "url": "https://github.com/codice/ddf/commit/c8a8714a990d113cb612705133730acffe2413fd", "message": "Use correct SecurityManager package", "committedDate": "2020-09-10T18:08:16Z", "type": "forcePushed"}]}