{"pr_number": 4017, "pr_title": "Moved NUI into a separate library", "pr_createdAt": "2020-06-01T13:51:30Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4017", "timeline": [{"oid": "0f6747ad381f2622c8db0dd58dcbb435c2f0620d", "url": "https://github.com/MovingBlocks/Terasology/commit/0f6747ad381f2622c8db0dd58dcbb435c2f0620d", "message": "Initial removal of NUI code (moved to library).", "committedDate": "2019-12-31T20:04:03Z", "type": "commit"}, {"oid": "abd061719ad7e1ad8ce19735a61423bd08ce9ca1", "url": "https://github.com/MovingBlocks/Terasology/commit/abd061719ad7e1ad8ce19735a61423bd08ce9ca1", "message": "Moved Border class to TeraNUI.", "committedDate": "2020-01-01T10:01:29Z", "type": "commit"}, {"oid": "805967831011fddba2856446d1de700e2dd1cfc9", "url": "https://github.com/MovingBlocks/Terasology/commit/805967831011fddba2856446d1de700e2dd1cfc9", "message": "Fixed UI Tabbing.", "committedDate": "2020-01-10T17:17:05Z", "type": "commit"}, {"oid": "337922fbb5306dabce85667f62c0517928a0eae5", "url": "https://github.com/MovingBlocks/Terasology/commit/337922fbb5306dabce85667f62c0517928a0eae5", "message": "Fixed compile error with TeraEd facade.\n\nAn import statement was removed in a previous commit that was needed.", "committedDate": "2020-01-10T20:19:39Z", "type": "commit"}, {"oid": "d3b20a7c195e02b02a9dfbd2971327dcb3fd5313", "url": "https://github.com/MovingBlocks/Terasology/commit/d3b20a7c195e02b02a9dfbd2971327dcb3fd5313", "message": "Moved org.terasology.reflections to another library.", "committedDate": "2020-01-11T17:42:40Z", "type": "commit"}, {"oid": "b8790ff71f9b07603f088f6936426a4c2f201f7b", "url": "https://github.com/MovingBlocks/Terasology/commit/b8790ff71f9b07603f088f6936426a4c2f201f7b", "message": "Fixed sound on button click and an engine test.", "committedDate": "2020-01-13T18:47:20Z", "type": "commit"}, {"oid": "451169039eb18f120d949c0c01ae8cb06bccd279", "url": "https://github.com/MovingBlocks/Terasology/commit/451169039eb18f120d949c0c01ae8cb06bccd279", "message": "Fixed engine tests.", "committedDate": "2020-01-13T19:53:40Z", "type": "commit"}, {"oid": "68a5fce793295df1401859770a56fe9739ba8dd3", "url": "https://github.com/MovingBlocks/Terasology/commit/68a5fce793295df1401859770a56fe9739ba8dd3", "message": "Re-implemented drawing meshes on UI (fix for Inventory module).\n\nNUI does not expose this functionality anymore, so it is instead re-directed to Terasology's implementation via CanvasUtility, as CanvasImpl does not have an @API annotation (it is a private API).", "committedDate": "2020-01-13T20:48:54Z", "type": "commit"}, {"oid": "fba2bd19c6d5399bf611de28651b8a073d8141f6", "url": "https://github.com/MovingBlocks/Terasology/commit/fba2bd19c6d5399bf611de28651b8a073d8141f6", "message": "Removed usage of Terasology input (entity-system) events in NUI.", "committedDate": "2020-01-15T17:15:06Z", "type": "commit"}, {"oid": "e856efef99d77b6529849ce5d67ad9372bc19d81", "url": "https://github.com/MovingBlocks/Terasology/commit/e856efef99d77b6529849ce5d67ad9372bc19d81", "message": "Re-added support for rendering materials to canvas via CanvasUtility.", "committedDate": "2020-01-15T17:32:24Z", "type": "commit"}, {"oid": "7a5b993686073b00d55abdad50af84d850ec2044", "url": "https://github.com/MovingBlocks/Terasology/commit/7a5b993686073b00d55abdad50af84d850ec2044", "message": "Re-added UIDeltaFormat (as it implies a JSON file format, like UIFormat).", "committedDate": "2020-01-15T17:44:00Z", "type": "commit"}, {"oid": "32f0f9f55a805cd7c1787105402e2fccc36bafaf", "url": "https://github.com/MovingBlocks/Terasology/commit/32f0f9f55a805cd7c1787105402e2fccc36bafaf", "message": "Fixed compile errors and removed duplicate FontColor and FontUnderline classes (moved to NUI).", "committedDate": "2020-01-15T19:11:15Z", "type": "commit"}, {"oid": "5f270c82a7b510fed6a1bf27b6434b0bfd4c79a6", "url": "https://github.com/MovingBlocks/Terasology/commit/5f270c82a7b510fed6a1bf27b6434b0bfd4c79a6", "message": "Added some additional methods removed from Canvas to CanvasUtility.", "committedDate": "2020-01-16T22:37:57Z", "type": "commit"}, {"oid": "acf41c1d9e082ad8f13dd7432e32f111ab4de070", "url": "https://github.com/MovingBlocks/Terasology/commit/acf41c1d9e082ad8f13dd7432e32f111ab4de070", "message": "Moved CanvasImpl (as well as its associated classes) to NUI.", "committedDate": "2020-02-01T13:28:05Z", "type": "commit"}, {"oid": "d799f7d17a292656bcb532e7650c8a4994297b10", "url": "https://github.com/MovingBlocks/Terasology/commit/d799f7d17a292656bcb532e7650c8a4994297b10", "message": "Merge branch 'nui-extraction' of https://github.com/BenjaminAmos/Terasology into BenjaminAmos-nui-extraction", "committedDate": "2020-06-01T13:41:48Z", "type": "commit"}, {"oid": "ccd433cbe672cb557cd3a0361ea28c6c292374ef", "url": "https://github.com/MovingBlocks/Terasology/commit/ccd433cbe672cb557cd3a0361ea28c6c292374ef", "message": "fix: reintroduce rendering/dag files, fix import issues", "committedDate": "2020-06-01T14:56:43Z", "type": "commit"}, {"oid": "6e828dc03edf307183136d803e1671760e618453", "url": "https://github.com/MovingBlocks/Terasology/commit/6e828dc03edf307183136d803e1671760e618453", "message": "Fix imports", "committedDate": "2020-06-05T09:09:06Z", "type": "commit"}, {"oid": "6ad4c07775e2dd2c45b18fa83c06161453379a46", "url": "https://github.com/MovingBlocks/Terasology/commit/6ad4c07775e2dd2c45b18fa83c06161453379a46", "message": "Fix issues related to Joml vector conversion", "committedDate": "2020-06-05T09:09:06Z", "type": "commit"}, {"oid": "1d9abe0e4f786a43ff752fcef222e649fdf11a24", "url": "https://github.com/MovingBlocks/Terasology/commit/1d9abe0e4f786a43ff752fcef222e649fdf11a24", "message": "Add utility functions for rectangle conversion to JomlUtil", "committedDate": "2020-06-05T09:09:06Z", "type": "commit"}, {"oid": "591b405242672bba0faeb251f5af0165f5a5bd8a", "url": "https://github.com/MovingBlocks/Terasology/commit/591b405242672bba0faeb251f5af0165f5a5bd8a", "message": "Fix issues related to Joml rectangle conversion", "committedDate": "2020-06-05T09:09:06Z", "type": "commit"}, {"oid": "cfcfb075e001db09d6a051f877be1549d9ed9054", "url": "https://github.com/MovingBlocks/Terasology/commit/cfcfb075e001db09d6a051f877be1549d9ed9054", "message": "Merge branch 'develop' into feat/nui-extraction", "committedDate": "2020-06-05T09:13:35Z", "type": "commit"}, {"oid": "e48787fbccab6603aced158eff969be15ed5567e", "url": "https://github.com/MovingBlocks/Terasology/commit/e48787fbccab6603aced158eff969be15ed5567e", "message": "Merge remote-tracking branch 'origin/develop' into feat/nui-extraction\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/math/JomlUtil.java\n#\tengine/src/main/java/org/terasology/persistence/typeHandling/extensionTypes/ColorTypeHandler.java\n#\tengine/src/main/java/org/terasology/rendering/nui/AbstractWidget.java\n#\tengine/src/main/java/org/terasology/rendering/nui/layouts/ScrollableArea.java\n#\tengine/src/main/java/org/terasology/rendering/nui/widgets/UIRadialRing.java\n#\tengine/src/main/java/org/terasology/rendering/nui/widgets/UIScrollingText.java", "committedDate": "2020-06-13T00:10:53Z", "type": "commit"}, {"oid": "cbf38064d91e131203f775626d7b1a56dbd30ca3", "url": "https://github.com/MovingBlocks/Terasology/commit/cbf38064d91e131203f775626d7b1a56dbd30ca3", "message": "chore: linting \ud83d\udeae", "committedDate": "2020-06-13T00:20:54Z", "type": "commit"}, {"oid": "b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "url": "https://github.com/MovingBlocks/Terasology/commit/b8698f3bffe55b8a1ec7772dba838a5c08302c9c", "message": "Converted Terasology UI widgets to JOML. Fixed crash on game start.\n\nTemporarily introduced MouseDevice.getMousePosition to fix JOML TeraMath incompatibilities.", "committedDate": "2020-06-13T10:50:05Z", "type": "commit"}, {"oid": "3771b605cab78567d68593d7f817556f1e72cadc", "url": "https://github.com/MovingBlocks/Terasology/commit/3771b605cab78567d68593d7f817556f1e72cadc", "message": "Merge pull request #4048 from BenjaminAmos/nui-extraction-runtime-fixes\n\nfeat/nui-extraction branch: Make the game playable again", "committedDate": "2020-06-14T00:03:04Z", "type": "commit"}, {"oid": "bf1a77262910ae716b33abdbc7016284e1ba3db3", "url": "https://github.com/MovingBlocks/Terasology/commit/bf1a77262910ae716b33abdbc7016284e1ba3db3", "message": "Merge remote-tracking branch 'origin/develop' into feat/nui-extraction\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/math/JomlUtil.java", "committedDate": "2020-06-14T00:14:00Z", "type": "commit"}, {"oid": "78f98b8e39423c963b8f2328b3bee7ce36291f48", "url": "https://github.com/MovingBlocks/Terasology/commit/78f98b8e39423c963b8f2328b3bee7ce36291f48", "message": "fix: use joml 1.9.25 method names", "committedDate": "2020-06-14T00:48:58Z", "type": "commit"}, {"oid": "f946b14cc3e18abfe0942c8f0bae858f567a97a0", "url": "https://github.com/MovingBlocks/Terasology/commit/f946b14cc3e18abfe0942c8f0bae858f567a97a0", "message": "Merge branch 'develop' into feat/nui-extraction", "committedDate": "2020-06-29T20:33:00Z", "type": "commit"}, {"oid": "bd5dd8f07cbd98afedb8e812022dffb66f5c1ffb", "url": "https://github.com/MovingBlocks/Terasology/commit/bd5dd8f07cbd98afedb8e812022dffb66f5c1ffb", "message": "Merge remote-tracking branch 'remotes/origin/develop' into feat/nui-extraction\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/logic/nameTags/NameTagComponent.java\n#\tengine/src/main/java/org/terasology/rendering/iconmesh/IconMeshFactory.java", "committedDate": "2020-07-20T03:18:17Z", "type": "commit"}, {"oid": "894b4d9372f9b71889da4b1577b43983a667bcdb", "url": "https://github.com/MovingBlocks/Terasology/commit/894b4d9372f9b71889da4b1577b43983a667bcdb", "message": "chore: Tweak target version for extracted NUI", "committedDate": "2020-07-20T03:41:36Z", "type": "commit"}, {"oid": "fca8f0ef4446267c580a7e3dbccce1cd1aca8579", "url": "https://github.com/MovingBlocks/Terasology/commit/fca8f0ef4446267c580a7e3dbccce1cd1aca8579", "message": "chore: Adjustments needed for various engine changes since last merge\n\n* CanvasRenderer in the extracted NUI had a new method added, implemented it twice here to compile (but one may need a legit implementation if desired)\n* Some JOML adjustments\n* Adjust for Border now living in the extracted NUI", "committedDate": "2020-07-20T04:17:54Z", "type": "commit"}, {"oid": "3857bef92641cf923a014732810a9155d36daa7d", "url": "https://github.com/MovingBlocks/Terasology/commit/3857bef92641cf923a014732810a9155d36daa7d", "message": "Merge remote-tracking branch 'origin/develop' into feat/nui-extraction", "committedDate": "2020-08-09T21:49:33Z", "type": "commit"}, {"oid": "19b3ee2d164aa063a9a66f9fb12fc043a1c47a4f", "url": "https://github.com/MovingBlocks/Terasology/commit/19b3ee2d164aa063a9a66f9fb12fc043a1c47a4f", "message": "chore: use v1.0.0 release of TeraNUI", "committedDate": "2020-08-09T21:50:37Z", "type": "commit"}, {"oid": "ad1b1b38a1c5cbd811bdb7f9ee58f19b18216cd2", "url": "https://github.com/MovingBlocks/Terasology/commit/ad1b1b38a1c5cbd811bdb7f9ee58f19b18216cd2", "message": "chore: build with TeraNUI v1.1.0-SNAPSHOT for testing", "committedDate": "2020-08-10T13:03:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMTQwNQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4017#discussion_r467931405", "bodyText": "RectUtility::createFromMinAndSize and in turn Border#shrink can produce invalid Rectangle2i (e.g, by RectUtility.createFromMinAndSize(20, 20, -10, -10)). I'm not sure where/how we want to fix this... @pollend ?", "author": "skaldarnar", "createdAt": "2020-08-10T14:11:36Z", "path": "engine-tests/src/test/java/org/terasology/math/BorderTest.java", "diffHunk": "@@ -33,46 +21,46 @@ public void initBorder() {\n \n     @Test\n     public void shrinkSameBorderAndRegionSize() {\n-        assertEquals(border.shrink(Rect2i.createFromMinAndSize(10, 10, 10, 10)), Rect2i.EMPTY);\n+        assertEquals(border.shrink(JomlUtil.from(Rect2i.createFromMinAndSize(10, 10, 10, 10))), JomlUtil.from(Rect2i.EMPTY));", "originalCommit": "ad1b1b38a1c5cbd811bdb7f9ee58f19b18216cd2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMjM4Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4017#discussion_r467932383", "bodyText": "A potential fix for Border#shrink might be:\n    public Rectanglei shrink(Rectanglei region) {\n        final Rectanglei shrunk = RectUtility.createFromMinAndSize(region.minX + getLeft(), region.minY + getTop(),\n                region.lengthX() - getTotalWidth(), region.lengthY() - getTotalHeight());\n        return shrunk.isValid() ? shrunk : new Rectanglei();\n    }\nThis mimics the behavior of Rect2i::createFromMinAndSize\n    public static Rect2i createFromMinAndSize(int x, int y, int width, int height) {\n        if (width <= 0 || height <= 0) {\n            return EMPTY;\n        }\n        return new Rect2i(x, y, width, height);\n    }", "author": "skaldarnar", "createdAt": "2020-08-10T14:13:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkzMTQwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "fc9846d62801bc744b5dc9fc338e9532db580c0e", "chunk": "diff --git a/engine-tests/src/test/java/org/terasology/math/BorderTest.java b/engine-tests/src/test/java/org/terasology/math/BorderTest.java\nindex edc7fa13c..fe1f7bb67 100644\n--- a/engine-tests/src/test/java/org/terasology/math/BorderTest.java\n+++ b/engine-tests/src/test/java/org/terasology/math/BorderTest.java\n\n@@ -59,8 +61,9 @@ public void growBorder() {\n \n     @Test\n     public void growBorderMax() {\n-        assertEquals(border.grow(JomlUtil.from(Rect2i.createFromMinAndSize(10, 10, Integer.MAX_VALUE,\n-            Integer.MAX_VALUE))), JomlUtil.from(Rect2i.createFromMinAndSize(0, 0, Integer.MAX_VALUE,\n-            Integer.MAX_VALUE)));\n+        assertEquals(\n+                RectUtility.createFromMinAndSize(0, 0, Integer.MAX_VALUE, Integer.MAX_VALUE),\n+                border.grow(RectUtility.createFromMinAndSize(10, 10, Integer.MAX_VALUE, Integer.MAX_VALUE)),\n+                \"Growing border should be capped at Integer.MAX_VALUE\");\n     }\n }\n"}}, {"oid": "fc9846d62801bc744b5dc9fc338e9532db580c0e", "url": "https://github.com/MovingBlocks/Terasology/commit/fc9846d62801bc744b5dc9fc338e9532db580c0e", "message": "test: fix `growBorderMax` test by removing JomlUtil conversion", "committedDate": "2020-08-10T14:26:48Z", "type": "commit"}, {"oid": "bfbb10eafcbe7ce74af7ff418f4ea2cf277b3996", "url": "https://github.com/MovingBlocks/Terasology/commit/bfbb10eafcbe7ce74af7ff418f4ea2cf277b3996", "message": "move tests to MovingBlocks/TeraNUI#15", "committedDate": "2020-08-11T07:28:28Z", "type": "commit"}, {"oid": "6b5440350458e238033b4de164ae1593dc29312e", "url": "https://github.com/MovingBlocks/Terasology/commit/6b5440350458e238033b4de164ae1593dc29312e", "message": "fix: update TeraNUI dependency to 1.1.0 release.", "committedDate": "2020-08-18T20:34:05Z", "type": "commit"}, {"oid": "5f1b733cf02bd8bd2e15d4593a586177d3f68961", "url": "https://github.com/MovingBlocks/Terasology/commit/5f1b733cf02bd8bd2e15d4593a586177d3f68961", "message": "chore: update TeraMath dependency to 1.5.0 release.\n\nThis is an upgrade from current develop branch (at 1.4.0) but a small step back from earlier versions of this PR (had 1.5.1-SNAPSHOT)", "committedDate": "2020-08-18T20:44:12Z", "type": "commit"}]}