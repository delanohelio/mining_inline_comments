{"pr_number": 3911, "pr_title": "fix: Add logic check to allow visible water under other blocks", "pr_createdAt": "2020-04-26T20:19:22Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3911", "timeline": [{"oid": "a1589b0e408090a4128a158e20ebeb691e288cd9", "url": "https://github.com/MovingBlocks/Terasology/commit/a1589b0e408090a4128a158e20ebeb691e288cd9", "message": "Add logic check to allow visible water under other blocks", "committedDate": "2020-04-26T19:42:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYxMTMyNQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3911#discussion_r415611325", "bodyText": "Please add a //TODO: ... comment here to indicate that this only fixes part of a broader problem:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (currentBlock.isWater() && (side == Side.TOP) && !blockToCheck.isWater()){\n          \n          \n            \n                    //TODO: This only fixes the \"water under block\" issue of the top side not being rendered.\n          \n          \n            \n                    //      Find a more general way to handle this for \"engine:loweredCube\" shapes.\n          \n          \n            \n                    if (currentBlock.isWater() && (side == Side.TOP) && !blockToCheck.isWater()){", "author": "skaldarnar", "createdAt": "2020-04-27T08:23:35Z", "path": "engine/src/main/java/org/terasology/rendering/primitives/BlockMeshGeneratorSingleShape.java", "diffHunk": "@@ -142,6 +142,10 @@ private boolean isSideVisibleForBlockTypes(Block blockToCheck, Block currentBloc\n             return false;\n         }\n \n+        if (currentBlock.isWater() && (side == Side.TOP) && !blockToCheck.isWater()){", "originalCommit": "a1589b0e408090a4128a158e20ebeb691e288cd9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTczNzQ5NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3911#discussion_r415737495", "bodyText": "Thanks Skaldarnar, good point; I've added the TODO. I also put a note about IntelliJ warning !blockToCheck.isLiquid() always returns true", "author": "cvennel", "createdAt": "2020-04-27T11:36:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYxMTMyNQ=="}], "type": "inlineReview", "revised_code": {"commit": "17ae0b1bfb3b2845d693c16c017e7a9b6000a31c", "chunk": "diff --git a/engine/src/main/java/org/terasology/rendering/primitives/BlockMeshGeneratorSingleShape.java b/engine/src/main/java/org/terasology/rendering/primitives/BlockMeshGeneratorSingleShape.java\nindex e06aea480..38df4619f 100644\n--- a/engine/src/main/java/org/terasology/rendering/primitives/BlockMeshGeneratorSingleShape.java\n+++ b/engine/src/main/java/org/terasology/rendering/primitives/BlockMeshGeneratorSingleShape.java\n\n@@ -141,7 +141,10 @@ private boolean isSideVisibleForBlockTypes(Block blockToCheck, Block currentBloc\n         if (currentBlock.isLiquid() && blockToCheck.isLiquid()) {\n             return false;\n         }\n-\n+        \n+        //TODO: This only fixes the \"water under block\" issue of the top side not being rendered. (see bug #3889)\n+        //Note: originally tried .isLiquid() instead of isWater for both checks, but IntelliJ was warning that\n+        //      !blockToCheck.isWater() is always true, may need further investigation\n         if (currentBlock.isWater() && (side == Side.TOP) && !blockToCheck.isWater()){\n             return true;\n         }\n"}}, {"oid": "17ae0b1bfb3b2845d693c16c017e7a9b6000a31c", "url": "https://github.com/MovingBlocks/Terasology/commit/17ae0b1bfb3b2845d693c16c017e7a9b6000a31c", "message": "Added todo note", "committedDate": "2020-04-27T11:33:08Z", "type": "commit"}]}