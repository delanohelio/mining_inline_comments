{"pr_number": 4148, "pr_title": "fix(performance): optimize ModuleEnvironmentSandbox.getSubTypeIdentifier", "pr_createdAt": "2020-09-13T20:38:10Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4148", "timeline": [{"oid": "c35f5c376747bd46aec2ef96f1cd1981bd14962a", "url": "https://github.com/MovingBlocks/Terasology/commit/c35f5c376747bd46aec2ef96f1cd1981bd14962a", "message": "fix(performance): optimize ModuleEnvironmentSandbox.getSubTypeIdentifier\n\nAlways use the class's fully-qualified Java class name as its type identifier, as ReflectionsSandbox does.\n\nThe previous implementation led to calling loadClass on *all* of Component's subclasses every time the serializer asked for this type identifier. We encountered scalability problems with that in #4126.", "committedDate": "2020-09-13T19:15:48Z", "type": "commit"}, {"oid": "7890da9a395e9a80e728209be219dd7c72fbf4e1", "url": "https://github.com/MovingBlocks/Terasology/commit/7890da9a395e9a80e728209be219dd7c72fbf4e1", "message": "chore: move common getSubTypeIdentifier implementation to interface default\n\nremove the test, because the default implementation is too mundane.", "committedDate": "2020-09-14T02:39:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYzNTgzMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4148#discussion_r487635833", "bodyText": "I think there are no longer any implementations of this that use baseType at all.\nShould we change the interface and remove that parameter entirely?\nIf so, is this still a subtypeIdentifier, or is it just its Identifier?", "author": "keturn", "createdAt": "2020-09-14T03:44:59Z", "path": "engine/src/main/java/org/terasology/persistence/typeHandling/reflection/SerializationSandbox.java", "diffHunk": "@@ -46,7 +33,9 @@\n      * @param <T>      The base type whose subtype needs to be identified.\n      * @return The unique identifier for {@code subType}.\n      */\n-    <T> String getSubTypeIdentifier(Class<? extends T> subType, Class<T> baseType);\n+    default <T> String getSubTypeIdentifier(Class<? extends T> subType, Class<T> baseType) {\n+        return subType.getName();", "originalCommit": "7890da9a395e9a80e728209be219dd7c72fbf4e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzY0NzI5NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4148#discussion_r487647294", "bodyText": "Probably just keep simplifying, if we need something like this in the future we could put it back in. Might still be good to hear from @eviltak\nAdditionally serialization and/or the whole ECS likely would majorly change when reintegrated as libraries anyway, so we don't have to aim for perfection right now", "author": "Cervator", "createdAt": "2020-09-14T04:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYzNTgzMw=="}], "type": "inlineReview", "revised_code": null}]}