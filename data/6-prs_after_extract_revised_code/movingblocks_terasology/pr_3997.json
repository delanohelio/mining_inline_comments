{"pr_number": 3997, "pr_title": "fix: prevent crash entering rendering settings with no renderers", "pr_createdAt": "2020-05-28T22:10:28Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3997", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MjIxMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r432542212", "bodyText": "make  transformation \"null -> emptyList\" in org/terasology/engine/module/rendering/RenderingModuleRegistry.java:121 instead checking on null.", "author": "DarkWeird", "createdAt": "2020-05-29T14:54:48Z", "path": "engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java", "diffHunk": "@@ -76,6 +78,13 @@ public void postInit() {\n         renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);\n         orderedModuleRenderingInstances = renderingModuleRegistry.getOrderedRenderingModules();\n \n+        if (orderedModuleRenderingInstances == null || orderedModuleRenderingInstances.isEmpty()) {", "originalCommit": "bd76ca9a68f0887a00632b95ab2d60d8897fd792", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY4NTc3Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r432685777", "bodyText": "Odd. The only reason I was getting null-warnings on that site was because this method is explicitly annotated as @Nullable\n\n  \n    \n      Terasology/engine/src/main/java/org/terasology/engine/module/rendering/RenderingModuleRegistry.java\n    \n    \n        Lines 75 to 76\n      in\n      73b04de\n    \n    \n    \n    \n\n        \n          \n           @Nullable \n        \n\n        \n          \n           public List<ModuleRendering> getOrderedRenderingModules() { \n        \n    \n  \n\n\nbut I don't think it is? that field has a default value, is only set in one other place that looks like it's non-nullable, and is private so I don't think anything else can null it.", "author": "keturn", "createdAt": "2020-05-29T19:17:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MjIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY4OTkyMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r432689920", "bodyText": "I think so too.\nI not noticed annotation :3", "author": "DarkWeird", "createdAt": "2020-05-29T19:27:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MjIxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2NTY2Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r433365667", "bodyText": "why would you ever return null if you could return an empty list? o.O", "author": "skaldarnar", "createdAt": "2020-06-01T17:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MjIxMg=="}], "type": "inlineReview", "revised_code": {"commit": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "chunk": "diff --git a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java b/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\nindex 24504bd97..fa6846b16 100644\n--- a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\n+++ b/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\n\n@@ -75,10 +75,9 @@ public void postInit() {\n \n         renderingModuleRegistry = context.get(RenderingModuleRegistry.class);\n \n-        renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);\n-        orderedModuleRenderingInstances = renderingModuleRegistry.getOrderedRenderingModules();\n+        orderedModuleRenderingInstances = renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);\n \n-        if (orderedModuleRenderingInstances == null || orderedModuleRenderingInstances.isEmpty()) {\n+        if (orderedModuleRenderingInstances.isEmpty()) {\n             logger.error(\"No rendering module found!\");\n             GameEngine gameEngine = context.get(GameEngine.class);\n             gameEngine.changeState(new StateMainMenu(\"No rendering module installed, unable to render. Try enabling CoreRendering.\"));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0Mjg4NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r432542884", "bodyText": "updateRenderingModuleOrder returns orderdRenderingModules\nUse it directly", "author": "DarkWeird", "createdAt": "2020-05-29T14:55:47Z", "path": "engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java", "diffHunk": "@@ -76,6 +78,13 @@ public void postInit() {\n         renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);", "originalCommit": "bd76ca9a68f0887a00632b95ab2d60d8897fd792", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "chunk": "diff --git a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java b/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\nindex 24504bd97..fa6846b16 100644\n--- a/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\n+++ b/engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/videoSettings/RenderingModuleSettingScreen.java\n\n@@ -75,10 +75,9 @@ public void postInit() {\n \n         renderingModuleRegistry = context.get(RenderingModuleRegistry.class);\n \n-        renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);\n-        orderedModuleRenderingInstances = renderingModuleRegistry.getOrderedRenderingModules();\n+        orderedModuleRenderingInstances = renderingModuleRegistry.updateRenderingModulesOrder(moduleEnvironment, subContext);\n \n-        if (orderedModuleRenderingInstances == null || orderedModuleRenderingInstances.isEmpty()) {\n+        if (orderedModuleRenderingInstances.isEmpty()) {\n             logger.error(\"No rendering module found!\");\n             GameEngine gameEngine = context.get(GameEngine.class);\n             gameEngine.changeState(new StateMainMenu(\"No rendering module installed, unable to render. Try enabling CoreRendering.\"));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0MzYyOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r432543628", "bodyText": "use it directly there. (via variable)", "author": "DarkWeird", "createdAt": "2020-05-29T14:56:52Z", "path": "engine/src/main/java/org/terasology/rendering/world/WorldRendererImpl.java", "diffHunk": "@@ -216,7 +210,7 @@ private void initRenderingModules() {\n             renderingModuleRegistry.updateRenderingModulesOrder(context.get(ModuleManager.class).getEnvironment(), context);", "originalCommit": "bd76ca9a68f0887a00632b95ab2d60d8897fd792", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "chunk": "diff --git a/engine/src/main/java/org/terasology/rendering/world/WorldRendererImpl.java b/engine/src/main/java/org/terasology/rendering/world/WorldRendererImpl.java\nindex 9cfea4e3f..19496ad6c 100644\n--- a/engine/src/main/java/org/terasology/rendering/world/WorldRendererImpl.java\n+++ b/engine/src/main/java/org/terasology/rendering/world/WorldRendererImpl.java\n\n@@ -207,8 +207,9 @@ private void initRenderingModules() {\n \n         // registry not populated by new ModuleRendering instances in UI, populate now\n         if (renderingModuleRegistry.getOrderedRenderingModules().isEmpty()) {\n-            renderingModuleRegistry.updateRenderingModulesOrder(context.get(ModuleManager.class).getEnvironment(), context);\n-            if(renderingModuleRegistry.getOrderedRenderingModules().isEmpty()) {\n+            List<ModuleRendering> renderingModules = renderingModuleRegistry.updateRenderingModulesOrder(\n+                    context.get(ModuleManager.class).getEnvironment(), context);\n+            if (renderingModules.isEmpty()) {\n                 GameEngine gameEngine = context.get(GameEngine.class);\n                 gameEngine.changeState(new StateMainMenu(\"No rendering module loaded, unable to render. Try enabling CoreRendering.\"));\n             }\n"}}, {"oid": "4050f67df78e404de1d99b267b8cfe3a2deaa578", "url": "https://github.com/MovingBlocks/Terasology/commit/4050f67df78e404de1d99b267b8cfe3a2deaa578", "message": "fix: prevent crash entering rendering settings with no renderers", "committedDate": "2020-05-29T18:28:59Z", "type": "commit"}, {"oid": "b79ef4d4ae5e11c593353112b2787b240f106da9", "url": "https://github.com/MovingBlocks/Terasology/commit/b79ef4d4ae5e11c593353112b2787b240f106da9", "message": "fix: this method is not nullable", "committedDate": "2020-05-29T19:36:16Z", "type": "commit"}, {"oid": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "url": "https://github.com/MovingBlocks/Terasology/commit/64dbb1202b66ac917d360fbf705739bd99c31e6c", "message": "refactor: make use of return value", "committedDate": "2020-05-29T19:37:45Z", "type": "commit"}, {"oid": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "url": "https://github.com/MovingBlocks/Terasology/commit/64dbb1202b66ac917d360fbf705739bd99c31e6c", "message": "refactor: make use of return value", "committedDate": "2020-05-29T19:37:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2NjEzOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3997#discussion_r433366138", "bodyText": "\ud83d\udc4d", "author": "skaldarnar", "createdAt": "2020-06-01T17:02:25Z", "path": "engine/src/main/java/org/terasology/engine/module/rendering/RenderingModuleRegistry.java", "diffHunk": "@@ -73,7 +72,6 @@ public ModuleRendering getModuleRenderingByModuleId(Name renderingModuleId) {\n      * For use everywhere to get last ordered list of {@link ModuleRendering} instances.\n      * @return list of {@link ModuleRendering} instances\n      */\n-    @Nullable", "originalCommit": "64dbb1202b66ac917d360fbf705739bd99c31e6c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}]}