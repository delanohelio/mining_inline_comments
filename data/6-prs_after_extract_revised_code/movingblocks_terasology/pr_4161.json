{"pr_number": 4161, "pr_title": "feat(JOML): migrate target system", "pr_createdAt": "2020-09-30T20:54:22Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4161", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzEwMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4161#discussion_r502647100", "bodyText": "Would it make sense to have JomlUtil.from(null) return null instead?", "author": "jdrueckert", "createdAt": "2020-10-09T20:05:08Z", "path": "engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java", "diffHunk": "@@ -158,7 +159,10 @@ public boolean updateBindState(Input input,\n                 }\n                 if (!keyConsumed) {\n                     buttonEvent.prepare(id, ButtonState.DOWN, delta);\n-                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n+                    buttonEvent.setTargetInfo(target,\n+                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n+                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n+                        hitNormal == null ? null : JomlUtil.from(hitNormal));", "originalCommit": "c287016765b315fb94f689ee64037e9747540294", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1412cac38ff77e93cf8bb2a1007c4beeeee33d79", "chunk": "diff --git a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\nindex 280ed0aa6..2afbdf896 100644\n--- a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n+++ b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n\n@@ -159,10 +158,7 @@ public boolean updateBindState(Input input,\n                 }\n                 if (!keyConsumed) {\n                     buttonEvent.prepare(id, ButtonState.DOWN, delta);\n-                    buttonEvent.setTargetInfo(target,\n-                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n-                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n-                        hitNormal == null ? null : JomlUtil.from(hitNormal));\n+                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n                     for (EntityRef entity : inputEntities) {\n                         entity.send(buttonEvent);\n                         if (buttonEvent.isConsumed()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzYzOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/4161#discussion_r502647638", "bodyText": "I guess/hope that \"rotation\" is on purpose?\nSo TeraMath's x.sub(y, z) equals joml's y.sub(z, x)?", "author": "jdrueckert", "createdAt": "2020-10-09T20:06:25Z", "path": "engine/src/main/java/org/terasology/input/cameraTarget/CameraTargetSystem.java", "diffHunk": "@@ -144,7 +144,7 @@ private void updateFocalDistance(HitResult hitInfo, float delta) {\n         if (hitInfo.isHit()) {\n             Vector3f playerToTargetRay = new Vector3f();\n             //calculate the distance from the player to the hit point\n-            playerToTargetRay.sub(JomlUtil.from(hitInfo.getHitPoint()), localPlayer.getViewPosition());\n+            hitInfo.getHitPoint().sub(JomlUtil.from(localPlayer.getViewPosition()), playerToTargetRay);", "originalCommit": "c287016765b315fb94f689ee64037e9747540294", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjczODA3Mg==", "url": "https://github.com/MovingBlocks/Terasology/pull/4161#discussion_r502738072", "bodyText": "for termath x.sub(y,z) --> x = y - z where joml it's  x-y = z. z is the dest in this case.", "author": "pollend", "createdAt": "2020-10-10T03:05:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzYzOA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0NzcyOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4161#discussion_r502647729", "bodyText": "see above", "author": "jdrueckert", "createdAt": "2020-10-09T20:06:39Z", "path": "engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java", "diffHunk": "@@ -176,7 +180,10 @@ public boolean updateBindState(Input input,\n                 }\n                 if (!keyConsumed) {\n                     buttonEvent.prepare(id, ButtonState.UP, delta);\n-                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n+                    buttonEvent.setTargetInfo(target,\n+                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n+                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n+                        hitNormal == null ? null : JomlUtil.from(hitNormal));", "originalCommit": "c287016765b315fb94f689ee64037e9747540294", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1412cac38ff77e93cf8bb2a1007c4beeeee33d79", "chunk": "diff --git a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\nindex 280ed0aa6..2afbdf896 100644\n--- a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n+++ b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n\n@@ -180,10 +176,7 @@ public boolean updateBindState(Input input,\n                 }\n                 if (!keyConsumed) {\n                     buttonEvent.prepare(id, ButtonState.UP, delta);\n-                    buttonEvent.setTargetInfo(target,\n-                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n-                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n-                        hitNormal == null ? null : JomlUtil.from(hitNormal));\n+                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n                     for (EntityRef entity : inputEntities) {\n                         entity.send(buttonEvent);\n                         if (buttonEvent.isConsumed()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjY0Nzc5OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4161#discussion_r502647799", "bodyText": "see above", "author": "jdrueckert", "createdAt": "2020-10-09T20:06:47Z", "path": "engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java", "diffHunk": "@@ -205,7 +212,10 @@ public void update(EntityRef[] inputEntities,\n                 boolean consumed = triggerOnRepeat(delta, target);\n                 if (!consumed) {\n                     buttonEvent.prepare(id, ButtonState.REPEAT, delta);\n-                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n+                    buttonEvent.setTargetInfo(target,\n+                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n+                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n+                        hitNormal == null ? null : JomlUtil.from(hitNormal));", "originalCommit": "c287016765b315fb94f689ee64037e9747540294", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1412cac38ff77e93cf8bb2a1007c4beeeee33d79", "chunk": "diff --git a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\nindex 280ed0aa6..2afbdf896 100644\n--- a/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n+++ b/engine/src/main/java/org/terasology/input/internal/BindableButtonImpl.java\n\n@@ -212,10 +205,7 @@ public void update(EntityRef[] inputEntities,\n                 boolean consumed = triggerOnRepeat(delta, target);\n                 if (!consumed) {\n                     buttonEvent.prepare(id, ButtonState.REPEAT, delta);\n-                    buttonEvent.setTargetInfo(target,\n-                        targetBlockPos == null ? null : JomlUtil.from(targetBlockPos),\n-                        hitPosition == null ? null : JomlUtil.from(hitPosition),\n-                        hitNormal == null ? null : JomlUtil.from(hitNormal));\n+                    buttonEvent.setTargetInfo(target, targetBlockPos, hitPosition, hitNormal);\n                     for (EntityRef entity : inputEntities) {\n                         entity.send(buttonEvent);\n                         if (buttonEvent.isConsumed()) {\n"}}, {"oid": "1412cac38ff77e93cf8bb2a1007c4beeeee33d79", "url": "https://github.com/MovingBlocks/Terasology/commit/1412cac38ff77e93cf8bb2a1007c4beeeee33d79", "message": "feat(JOML): migrate target system", "committedDate": "2020-10-26T03:06:18Z", "type": "commit"}, {"oid": "f65b65f139cc2098f439851fa32a9f98573ea2fb", "url": "https://github.com/MovingBlocks/Terasology/commit/f65b65f139cc2098f439851fa32a9f98573ea2fb", "message": "fix null for input", "committedDate": "2020-10-26T03:06:18Z", "type": "commit"}, {"oid": "805e71dab2cfc241aaede977a007a15fd2a1651b", "url": "https://github.com/MovingBlocks/Terasology/commit/805e71dab2cfc241aaede977a007a15fd2a1651b", "message": "add null check", "committedDate": "2020-10-26T03:06:18Z", "type": "commit"}, {"oid": "56979d32f5dafba46ad7f174f68ad87dac3b9bb4", "url": "https://github.com/MovingBlocks/Terasology/commit/56979d32f5dafba46ad7f174f68ad87dac3b9bb4", "message": "remove null check", "committedDate": "2020-10-26T03:06:18Z", "type": "commit"}, {"oid": "ea859e8c25aea023293f743ea34cea3f11cd6c32", "url": "https://github.com/MovingBlocks/Terasology/commit/ea859e8c25aea023293f743ea34cea3f11cd6c32", "message": "JomlUtil final", "committedDate": "2020-10-26T03:06:18Z", "type": "commit"}, {"oid": "ea859e8c25aea023293f743ea34cea3f11cd6c32", "url": "https://github.com/MovingBlocks/Terasology/commit/ea859e8c25aea023293f743ea34cea3f11cd6c32", "message": "JomlUtil final", "committedDate": "2020-10-26T03:06:18Z", "type": "forcePushed"}, {"oid": "a8152a4bae5e0535bbe226a6f4634f47839cf0e9", "url": "https://github.com/MovingBlocks/Terasology/commit/a8152a4bae5e0535bbe226a6f4634f47839cf0e9", "message": "Merge branch 'develop' into feature/joml-migrate-targetsystem", "committedDate": "2020-10-27T17:28:39Z", "type": "commit"}]}