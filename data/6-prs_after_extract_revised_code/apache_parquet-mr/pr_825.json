{"pr_number": 825, "pr_title": "PARQUET-1922: Deprecate IOExceptionUtils", "pr_createdAt": "2020-10-08T18:08:53Z", "pr_url": "https://github.com/apache/parquet-mr/pull/825", "timeline": [{"oid": "9f3712301099118b72bb7cf20bada79181058da7", "url": "https://github.com/apache/parquet-mr/commit/9f3712301099118b72bb7cf20bada79181058da7", "message": "PARQUET-1922: Deprecate IOExceptionUtils", "committedDate": "2020-10-08T18:07:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkxNzI2MA==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r501917260", "bodyText": "The inherited close() method throws IOException so this is fine to do", "author": "belugabehr", "createdAt": "2020-10-08T18:10:33Z", "path": "parquet-common/src/main/java/org/apache/parquet/bytes/LittleEndianDataOutputStream.java", "diffHunk": "@@ -210,8 +207,8 @@ public final void writeDouble(double v) throws IOException {\n     writeLong(Double.doubleToLongBits(v));\n   }\n \n-  public void close() {\n-    IOExceptionUtils.closeQuietly(out);\n+  public void close() throws IOException {", "originalCommit": "9f3712301099118b72bb7cf20bada79181058da7", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "68b2c8ed74a36cea58918862bc791ba5bb34a5be", "chunk": "diff --git a/parquet-common/src/main/java/org/apache/parquet/bytes/LittleEndianDataOutputStream.java b/parquet-common/src/main/java/org/apache/parquet/bytes/LittleEndianDataOutputStream.java\nindex 9c20ae5b0..74bb144ca 100644\n--- a/parquet-common/src/main/java/org/apache/parquet/bytes/LittleEndianDataOutputStream.java\n+++ b/parquet-common/src/main/java/org/apache/parquet/bytes/LittleEndianDataOutputStream.java\n\n@@ -207,8 +207,12 @@ public class LittleEndianDataOutputStream extends OutputStream {\n     writeLong(Double.doubleToLongBits(v));\n   }\n \n-  public void close() throws IOException {\n-    out.close();\n+  public void close() {\n+    try {\n+      out.close();\n+    } catch (IOException e) {\n+      // swallow exception\n+    }\n   }\n \n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkyMDgxMQ==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r501920811", "bodyText": "out in this case is wraps arrayOut, and it has no buffering, so it does not need to be explicitly closed, or better, in the future, out should be closed only and arrayOut will be closed implicitly.  Anyway, I came to this conclusion because this is how close() is implemented in a couple of other Writer classes as well.", "author": "belugabehr", "createdAt": "2020-10-08T18:16:14Z", "path": "parquet-column/src/main/java/org/apache/parquet/column/values/plain/PlainValuesWriter.java", "diffHunk": "@@ -127,7 +127,6 @@ public void reset() {\n   @Override\n   public void close() {\n     arrayOut.close();\n-    out.close();", "originalCommit": "9f3712301099118b72bb7cf20bada79181058da7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE0NjgxOQ==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r510146819", "bodyText": "I would either close only arrayOut but with comments about what you have written here or close only out and catching the IOException that would never occur and comment in the catch block similarly.", "author": "gszadovszky", "createdAt": "2020-10-22T13:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkyMDgxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4OTMwOQ==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r510189309", "bodyText": "@gszadovszky Thanks for the review!\nI think this line of work should be pursued in a different ticket.  This change makes this PR's changes possible, but also puts it in line with other implementations:\n\n  \n    \n      parquet-mr/parquet-column/src/main/java/org/apache/parquet/column/values/plain/FixedLenByteArrayPlainValuesWriter.java\n    \n    \n        Lines 88 to 90\n      in\n      dc61e51\n    \n    \n    \n    \n\n        \n          \n           public void close() { \n        \n\n        \n          \n             arrayOut.close(); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nSo if we want to change how things are closed (nice, but technically not required) it can be addressed holistically.", "author": "belugabehr", "createdAt": "2020-10-22T14:05:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkyMDgxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIwNTA4MQ==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r510205081", "bodyText": "I am fine fixing this in another ticket. What I think is a key in this change is to put the related comments (out.close is not required because...) in the code as well as in this review.", "author": "gszadovszky", "createdAt": "2020-10-22T14:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkyMDgxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMjAzMzE4MA==", "url": "https://github.com/apache/parquet-mr/pull/825#discussion_r632033180", "bodyText": "@gszadovszky OK, finally got back to this. Ha.  I added a comment.  Please consider for merge.", "author": "belugabehr", "createdAt": "2021-05-13T18:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkyMDgxMQ=="}], "type": "inlineReview", "revised_code": {"commit": "8f338753acc3a4647ac4aada6a7bece3f7995f8a", "chunk": "diff --git a/parquet-column/src/main/java/org/apache/parquet/column/values/plain/PlainValuesWriter.java b/parquet-column/src/main/java/org/apache/parquet/column/values/plain/PlainValuesWriter.java\nindex d23cbf843..bfa21cd40 100644\n--- a/parquet-column/src/main/java/org/apache/parquet/column/values/plain/PlainValuesWriter.java\n+++ b/parquet-column/src/main/java/org/apache/parquet/column/values/plain/PlainValuesWriter.java\n\n@@ -126,6 +126,8 @@ public class PlainValuesWriter extends ValuesWriter {\n \n   @Override\n   public void close() {\n+    // Need only close 'arrayOut' as 'out' simply closes 'arrayOut' but raises\n+    // an IOException by signature\n     arrayOut.close();\n   }\n \n"}}, {"oid": "8f338753acc3a4647ac4aada6a7bece3f7995f8a", "url": "https://github.com/apache/parquet-mr/commit/8f338753acc3a4647ac4aada6a7bece3f7995f8a", "message": "Add comment to close method", "committedDate": "2021-05-13T18:55:30Z", "type": "commit"}, {"oid": "68b2c8ed74a36cea58918862bc791ba5bb34a5be", "url": "https://github.com/apache/parquet-mr/commit/68b2c8ed74a36cea58918862bc791ba5bb34a5be", "message": "Manually swallow exceptions", "committedDate": "2021-05-13T19:33:06Z", "type": "commit"}]}