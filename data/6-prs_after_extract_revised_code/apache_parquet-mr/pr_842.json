{"pr_number": 842, "pr_title": "PARQUET-1938: Key rotation - option to get KMS details from key material", "pr_createdAt": "2020-11-03T16:45:17Z", "pr_url": "https://github.com/apache/parquet-mr/pull/842", "timeline": [{"oid": "6fccdf61d8169fb0f2f37096a0a9d678afd7fd9d", "url": "https://github.com/apache/parquet-mr/commit/6fccdf61d8169fb0f2f37096a0a9d678afd7fd9d", "message": "Key rotation - option to get KMS details from key material", "committedDate": "2020-11-03T16:39:46Z", "type": "commit"}, {"oid": "0b5df15a953a868835b4fa434a317cb4f83db50b", "url": "https://github.com/apache/parquet-mr/commit/0b5df15a953a868835b4fa434a317cb4f83db50b", "message": "Rename variable", "committedDate": "2020-11-04T15:02:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1NzU2Mg==", "url": "https://github.com/apache/parquet-mr/pull/842#discussion_r519957562", "bodyText": "It is not common to set a value in the hadoop conf in our code base. I would expect some comments about why this is necessary. Also, I am not sure if this would not impact the caller. If the caller gives us a hadoop Configuration object we should not modify it.", "author": "gszadovszky", "createdAt": "2020-11-09T16:46:03Z", "path": "parquet-hadoop/src/main/java/org/apache/parquet/crypto/keytools/KeyToolkit.java", "diffHunk": "@@ -206,9 +206,10 @@ String getEncodedWrappedKEK() {\n   public static void rotateMasterKeys(String folderPath, Configuration hadoopConfig)\n     throws IOException, ParquetCryptoRuntimeException, KeyAccessDeniedException, UnsupportedOperationException {\n \n-    if (hadoopConfig.getBoolean(KEY_MATERIAL_INTERNAL_PROPERTY_NAME, KEY_MATERIAL_INTERNAL_DEFAULT)) {\n+    if (hadoopConfig.getBoolean(KEY_MATERIAL_INTERNAL_PROPERTY_NAME, false)) {\n       throw new UnsupportedOperationException(\"Key rotation is not supported for internal key material\");\n     }\n+    hadoopConfig.setBoolean(KEY_MATERIAL_INTERNAL_PROPERTY_NAME, false);", "originalCommit": "0b5df15a953a868835b4fa434a317cb4f83db50b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5eff262fcae12582d07641344fd5ea29607c71de", "chunk": "diff --git a/parquet-hadoop/src/main/java/org/apache/parquet/crypto/keytools/KeyToolkit.java b/parquet-hadoop/src/main/java/org/apache/parquet/crypto/keytools/KeyToolkit.java\nindex d7c500cfd..d28aec25f 100644\n--- a/parquet-hadoop/src/main/java/org/apache/parquet/crypto/keytools/KeyToolkit.java\n+++ b/parquet-hadoop/src/main/java/org/apache/parquet/crypto/keytools/KeyToolkit.java\n\n@@ -209,7 +209,6 @@ public class KeyToolkit {\n     if (hadoopConfig.getBoolean(KEY_MATERIAL_INTERNAL_PROPERTY_NAME, false)) {\n       throw new UnsupportedOperationException(\"Key rotation is not supported for internal key material\");\n     }\n-    hadoopConfig.setBoolean(KEY_MATERIAL_INTERNAL_PROPERTY_NAME, false);\n \n     if (hadoopConfig.getBoolean(WRAP_LOCALLY_PROPERTY_NAME, WRAP_LOCALLY_DEFAULT)) {\n       throw new UnsupportedOperationException(\"Key rotation is not supported for local key wrapping\");\n"}}, {"oid": "5eff262fcae12582d07641344fd5ea29607c71de", "url": "https://github.com/apache/parquet-mr/commit/5eff262fcae12582d07641344fd5ea29607c71de", "message": "Remove unneeded asignment", "committedDate": "2020-11-10T15:56:18Z", "type": "commit"}]}