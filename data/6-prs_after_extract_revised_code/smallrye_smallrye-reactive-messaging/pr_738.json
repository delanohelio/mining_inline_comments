{"pr_number": 738, "pr_title": "Introduce Message Converters", "pr_createdAt": "2020-09-14T18:30:39Z", "pr_url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/738", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE1NzAyMg==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/738#discussion_r488157022", "bodyText": "accept is quite overloaded.\nMaybe canConvert? or isConvertible? or handles?", "author": "kenfinnigan", "createdAt": "2020-09-14T19:04:37Z", "path": "api/src/main/java/io/smallrye/reactive/messaging/MessageConverter.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package io.smallrye.reactive.messaging;\n+\n+import java.lang.reflect.Type;\n+\n+import org.eclipse.microprofile.reactive.messaging.Message;\n+\n+/**\n+ * Converter transforming {@code Message<A>} into {@code Message<B>}.\n+ * To register a converter, expose a, generally {@code ApplicationScoped} bean, implementing this interface.\n+ */\n+public interface MessageConverter {\n+\n+    /**\n+     * Checks whether this instance of converter can convert the given message {@code in} into a {@code Message<T>} with\n+     * {@code T} being the type represented by {@code target}.\n+     *\n+     * @param in the input message, not {@code null}\n+     * @param target the target type, generally the type ingested by a method\n+     * @return {@code true} if the conversion is possible, {@code false} otherwise.\n+     */\n+    boolean accept(Message<?> in, Type target);", "originalCommit": "41a3ed332d9e1b07013cc4931d1c7c1e818d479c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5ODQzMA==", "url": "https://github.com/smallrye/smallrye-reactive-messaging/pull/738#discussion_r488498430", "bodyText": "Switched to canConvert.", "author": "cescoffier", "createdAt": "2020-09-15T08:52:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODE1NzAyMg=="}], "type": "inlineReview", "revised_code": {"commit": "ed86fd9c91b262b99c34f604ed6dc3f93e2e9d53", "chunk": "diff --git a/api/src/main/java/io/smallrye/reactive/messaging/MessageConverter.java b/api/src/main/java/io/smallrye/reactive/messaging/MessageConverter.java\nindex 00cccb858..319b305fa 100644\n--- a/api/src/main/java/io/smallrye/reactive/messaging/MessageConverter.java\n+++ b/api/src/main/java/io/smallrye/reactive/messaging/MessageConverter.java\n\n@@ -1,35 +1,52 @@\n package io.smallrye.reactive.messaging;\n \n-import java.lang.reflect.Type;\n-\n import org.eclipse.microprofile.reactive.messaging.Message;\n \n+import javax.enterprise.inject.spi.Prioritized;\n+import java.lang.reflect.Type;\n+\n /**\n  * Converter transforming {@code Message<A>} into {@code Message<B>}.\n  * To register a converter, expose a, generally {@code ApplicationScoped} bean, implementing this interface.\n+ * <p>\n+ * When multiple converters are available, implementation should override the {@link #getPriority()} method.\n+ * The default priority is {@link #CONVERTER_DEFAULT_PRIORITY}. Converters with higher priority are executed first.\n  */\n-public interface MessageConverter {\n+public interface MessageConverter extends Prioritized {\n+\n+    /**\n+     * Default priority: {@code 100}\n+     */\n+    int CONVERTER_DEFAULT_PRIORITY = 100;\n \n     /**\n      * Checks whether this instance of converter can convert the given message {@code in} into a {@code Message<T>} with\n      * {@code T} being the type represented by {@code target}.\n      *\n-     * @param in the input message, not {@code null}\n+     * When reactive messaging looks for a converter, it picks the first converter returning {@code true} for a given\n+     * message.\n+     *\n+     * @param in     the input message, not {@code null}\n      * @param target the target type, generally the type ingested by a method\n      * @return {@code true} if the conversion is possible, {@code false} otherwise.\n      */\n-    boolean accept(Message<?> in, Type target);\n+    boolean canConvert(Message<?> in, Type target);\n \n     /**\n      * Converts the given message {@code in} into a {@code Message<T>}.\n-     * This method is only called after a successful call to {@link #accept(Message, Type)} with the given target type.\n+     * This method is only called after a successful call to {@link #canConvert(Message, Type)} with the given target type.\n      *\n-     * @param in the input message\n+     * @param in     the input message\n      * @param target the target type\n      * @return the converted message.\n      */\n     Message<?> convert(Message<?> in, Type target);\n \n+    @Override\n+    default int getPriority() {\n+        return CONVERTER_DEFAULT_PRIORITY;\n+    }\n+\n     class IdentityConverter implements MessageConverter {\n \n         public static final IdentityConverter INSTANCE = new IdentityConverter();\n"}}, {"oid": "ed86fd9c91b262b99c34f604ed6dc3f93e2e9d53", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/ed86fd9c91b262b99c34f604ed6dc3f93e2e9d53", "message": "Add support for converter priority", "committedDate": "2020-09-15T08:51:25Z", "type": "forcePushed"}, {"oid": "8db0d68d976f8d3ac7098767f627f3f50e9e556a", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/8db0d68d976f8d3ac7098767f627f3f50e9e556a", "message": "Extract ingested payload type.", "committedDate": "2020-09-15T13:28:21Z", "type": "commit"}, {"oid": "70da2801ffaa89839f164f57e714a92c5142a058", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/70da2801ffaa89839f164f57e714a92c5142a058", "message": "Define MessageConverter and introduce these converters in the weaving.", "committedDate": "2020-09-15T13:28:23Z", "type": "commit"}, {"oid": "c9cf02cc9cc2bbad0c8e042b55c24b7e2e727513", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/c9cf02cc9cc2bbad0c8e042b55c24b7e2e727513", "message": "Avoid unnecessary conversions.", "committedDate": "2020-09-15T13:28:23Z", "type": "commit"}, {"oid": "33f66c376f15eb4f44f00e82959db39a1cb90e7d", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/33f66c376f15eb4f44f00e82959db39a1cb90e7d", "message": "Add support for converter priority", "committedDate": "2020-09-15T13:28:23Z", "type": "commit"}, {"oid": "7ad6a21ae104b5ce94bb4dd454f6c56e424473ec", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/7ad6a21ae104b5ce94bb4dd454f6c56e424473ec", "message": "Document message converters", "committedDate": "2020-09-15T13:28:23Z", "type": "commit"}, {"oid": "7ad6a21ae104b5ce94bb4dd454f6c56e424473ec", "url": "https://github.com/smallrye/smallrye-reactive-messaging/commit/7ad6a21ae104b5ce94bb4dd454f6c56e424473ec", "message": "Document message converters", "committedDate": "2020-09-15T13:28:23Z", "type": "forcePushed"}]}