{"pr_number": 1785, "pr_title": "Update Circuit Breaker configured as a standard plugin", "pr_createdAt": "2020-08-26T05:21:46Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1785", "timeline": [{"oid": "e4ae54b1250f34e8be062545ccadbad2f1048d2a", "url": "https://github.com/apache/lucene-solr/commit/e4ae54b1250f34e8be062545ccadbad2f1048d2a", "message": "Update Circuit Breaker Configuration to Use Plugins", "committedDate": "2020-08-26T04:53:49Z", "type": "commit"}, {"oid": "a80bcc731beb99f9c254488410b7ad9c42faaf16", "url": "https://github.com/apache/lucene-solr/commit/a80bcc731beb99f9c254488410b7ad9c42faaf16", "message": "Fix precommit", "committedDate": "2020-08-26T05:32:03Z", "type": "commit"}, {"oid": "8b3c1671c2ec35669a81a5b83ceb227afaf7aa78", "url": "https://github.com/apache/lucene-solr/commit/8b3c1671c2ec35669a81a5b83ceb227afaf7aa78", "message": "More precommit", "committedDate": "2020-08-26T05:43:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEyODE2NQ==", "url": "https://github.com/apache/lucene-solr/pull/1785#discussion_r477128165", "bodyText": "Make CircuitBreakerManager implement PluginInfoInitialized", "author": "noblepaul", "createdAt": "2020-08-26T08:30:58Z", "path": "solr/core/src/java/org/apache/solr/core/SolrCore.java", "diffHunk": "@@ -1174,7 +1174,8 @@ private SolrCoreMetricManager initCoreMetricManager(SolrConfig config) {\n   }\n \n   private CircuitBreakerManager initCircuitBreakerManager() {\n-    CircuitBreakerManager circuitBreakerManager = CircuitBreakerManager.build(solrConfig);\n+    final PluginInfo info = solrConfig.getPluginInfo(CircuitBreakerManager.class.getName());\n+    CircuitBreakerManager circuitBreakerManager = CircuitBreakerManager.build(info.initArgs);", "originalCommit": "8b3c1671c2ec35669a81a5b83ceb227afaf7aa78", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2f1a9e37c234d3b9fcb3dc257c0cd04cf4f5476f", "chunk": "diff --git a/solr/core/src/java/org/apache/solr/core/SolrCore.java b/solr/core/src/java/org/apache/solr/core/SolrCore.java\nindex 11a39351678..b44866e30f7 100644\n--- a/solr/core/src/java/org/apache/solr/core/SolrCore.java\n+++ b/solr/core/src/java/org/apache/solr/core/SolrCore.java\n\n@@ -1175,7 +1175,7 @@ public final class SolrCore implements SolrInfoBean, Closeable {\n \n   private CircuitBreakerManager initCircuitBreakerManager() {\n     final PluginInfo info = solrConfig.getPluginInfo(CircuitBreakerManager.class.getName());\n-    CircuitBreakerManager circuitBreakerManager = CircuitBreakerManager.build(info.initArgs);\n+    CircuitBreakerManager circuitBreakerManager = CircuitBreakerManager.build(info);\n \n     return circuitBreakerManager;\n   }\n"}}, {"oid": "2f1a9e37c234d3b9fcb3dc257c0cd04cf4f5476f", "url": "https://github.com/apache/lucene-solr/commit/2f1a9e37c234d3b9fcb3dc257c0cd04cf4f5476f", "message": "Update per comments", "committedDate": "2020-08-26T11:14:26Z", "type": "commit"}, {"oid": "40ea9508cee3f002d5e6f4582919983d469b53d4", "url": "https://github.com/apache/lucene-solr/commit/40ea9508cee3f002d5e6f4582919983d469b53d4", "message": "Update docs", "committedDate": "2020-08-26T14:06:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyNjkyMA==", "url": "https://github.com/apache/lucene-solr/pull/1785#discussion_r477426920", "bodyText": "can we avoid adding new suppress to the code please?", "author": "madrob", "createdAt": "2020-08-26T16:21:32Z", "path": "solr/core/src/java/org/apache/solr/util/circuitbreaker/CircuitBreakerManager.java", "diffHunk": "@@ -121,19 +135,41 @@ public static String toErrorMessage(List<CircuitBreaker> circuitBreakerList) {\n    *\n    * Any default circuit breakers should be registered here.\n    */\n-  public static CircuitBreakerManager build(SolrConfig solrConfig) {\n-    CircuitBreakerManager circuitBreakerManager = new CircuitBreakerManager(solrConfig.useCircuitBreakers);\n-\n-    // Install the default circuit breakers\n-    CircuitBreaker memoryCircuitBreaker = new MemoryCircuitBreaker(solrConfig);\n-    CircuitBreaker cpuCircuitBreaker = new CPUCircuitBreaker(solrConfig);\n+  @SuppressWarnings({\"rawtypes\"})", "originalCommit": "40ea9508cee3f002d5e6f4582919983d469b53d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODI0MzQ0NQ==", "url": "https://github.com/apache/lucene-solr/pull/1785#discussion_r478243445", "bodyText": "Unfortunately, that is the way NamedArgs are structured in PluginInfo -- we need to fix that before we remove this warning. I will follow up.", "author": "atris", "createdAt": "2020-08-27T08:22:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQyNjkyMA=="}], "type": "inlineReview", "revised_code": {"commit": "0094360f6ce68fef41615774cfcf42c05b324d69", "chunk": "diff --git a/solr/core/src/java/org/apache/solr/util/circuitbreaker/CircuitBreakerManager.java b/solr/core/src/java/org/apache/solr/util/circuitbreaker/CircuitBreakerManager.java\nindex 8fec5771551..975ca4b124e 100644\n--- a/solr/core/src/java/org/apache/solr/util/circuitbreaker/CircuitBreakerManager.java\n+++ b/solr/core/src/java/org/apache/solr/util/circuitbreaker/CircuitBreakerManager.java\n\n@@ -147,7 +147,7 @@ public class CircuitBreakerManager implements PluginInfoInitialized {\n   @VisibleForTesting\n   @SuppressWarnings({\"rawtypes\"})\n   public static CircuitBreaker.CircuitBreakerConfig buildCBConfig(PluginInfo pluginInfo) {\n-    boolean enabled = false;\n+    boolean enabled = Boolean.parseBoolean(pluginInfo.attributes.get(\"enabled\"));\n     boolean cpuCBEnabled = false;\n     boolean memCBEnabled = false;\n     int memCBThreshold = 100;\n"}}, {"oid": "0094360f6ce68fef41615774cfcf42c05b324d69", "url": "https://github.com/apache/lucene-solr/commit/0094360f6ce68fef41615774cfcf42c05b324d69", "message": "Update args input", "committedDate": "2020-08-27T08:19:18Z", "type": "commit"}]}