{"pr_number": 1825, "pr_title": "SOLR-14828: reduce 'error' logging noise in BaseCloudSolrClient.requestWithRetryOnStaleState", "pr_createdAt": "2020-09-03T16:38:04Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1825", "timeline": [{"oid": "25552353f79be86b119dd994490d0619d73480f8", "url": "https://github.com/apache/lucene-solr/commit/25552353f79be86b119dd994490d0619d73480f8", "message": "SOLR-14828: reduce 'error' logging noise in BaseCloudSolrClient.requestWithRetryOnStaleState", "committedDate": "2020-09-03T16:34:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5Mzc1Nw==", "url": "https://github.com/apache/lucene-solr/pull/1825#discussion_r487993757", "bodyText": "Since you add  - retrying to the info logging above, maybe add something like  - max retries hit here", "author": "HoustonPutman", "createdAt": "2020-09-14T14:51:10Z", "path": "solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "diffHunk": "@@ -994,12 +991,15 @@ public RouteException(ErrorCode errorCode, NamedList<Throwable> throwables, Map<\n           // and we could not get any information from the server\n           //it is probably not worth trying again and again because\n           // the state would not have been updated\n-          log.info(\"trying request again\");\n+          log.info(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} - retrying\",\n+              inputCollections, errorCode, rootCause, retryCount, wasCommError, errorCode);\n           return requestWithRetryOnStaleState(request, retryCount + 1, inputCollections);\n         }\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n+      log.error(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} \",", "originalCommit": "25552353f79be86b119dd994490d0619d73480f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODA3MTcwMA==", "url": "https://github.com/apache/lucene-solr/pull/1825#discussion_r488071700", "bodyText": "max retries hit is a little tricky to determine exactly since e.g. commError and other things influence the logic. But inclusion of MAX_STALE_RETRIES in the logging could make it clear(er) when \"max retries hit\" was likely the case.", "author": "cpoerschke", "createdAt": "2020-09-14T16:39:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk5Mzc1Nw=="}], "type": "inlineReview", "revised_code": {"commit": "c4990ee038cf02833736a968faf80105e0dd68cf", "chunk": "diff --git a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\nindex b8dd877b99e..c49bf3402b8 100644\n--- a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\n+++ b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\n\n@@ -991,15 +991,15 @@ public abstract class BaseCloudSolrClient extends SolrClient {\n           // and we could not get any information from the server\n           //it is probably not worth trying again and again because\n           // the state would not have been updated\n-          log.info(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} - retrying\",\n-              inputCollections, errorCode, rootCause, retryCount, wasCommError, errorCode);\n+          log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} - retrying\",\n+              inputCollections, errorCode, rootCause, retryCount, MAX_STALE_RETRIES, wasCommError, errorCode);\n           return requestWithRetryOnStaleState(request, retryCount + 1, inputCollections);\n         }\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n-      log.error(\"Request to collection {} failed due to ({}) {}, retry={} commError={} errorCode={} \",\n-          inputCollections, errorCode, rootCause, retryCount, wasCommError, errorCode);\n+      log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n+          inputCollections, errorCode, rootCause, retryCount, MAX_STALE_RETRIES, wasCommError, errorCode);\n \n       boolean stateWasStale = false;\n       if (retryCount < MAX_STALE_RETRIES  &&\n"}}, {"oid": "c4990ee038cf02833736a968faf80105e0dd68cf", "url": "https://github.com/apache/lucene-solr/commit/c4990ee038cf02833736a968faf80105e0dd68cf", "message": "include maxRetries limit alongside retryCount value", "committedDate": "2020-09-14T16:34:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyMTczNg==", "url": "https://github.com/apache/lucene-solr/pull/1825#discussion_r488821736", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n          \n          \n            \n                  log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n          \n      \n    \n    \n  \n\n@noblepaul - is this what you had in mind when you wrote \"switch this to INFO\" on the https://issues.apache.org/jira/browse/SOLR-14828 ticket? Or would you prefer keeping the logging at line 973 only but as INFO instead of ERROR?", "author": "cpoerschke", "createdAt": "2020-09-15T17:00:47Z", "path": "solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "diffHunk": "@@ -994,12 +991,15 @@ public RouteException(ErrorCode errorCode, NamedList<Throwable> throwables, Map<\n           // and we could not get any information from the server\n           //it is probably not worth trying again and again because\n           // the state would not have been updated\n-          log.info(\"trying request again\");\n+          log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} - retrying\",\n+              inputCollections, errorCode, rootCause, retryCount, MAX_STALE_RETRIES, wasCommError, errorCode);\n           return requestWithRetryOnStaleState(request, retryCount + 1, inputCollections);\n         }\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n+      log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",", "originalCommit": "c4990ee038cf02833736a968faf80105e0dd68cf", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3b21411957ba70efeb13c1b1150a0489750b568d", "chunk": "diff --git a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\nindex c49bf3402b8..ef96be720d0 100644\n--- a/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\n+++ b/solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java\n\n@@ -998,7 +998,7 @@ public abstract class BaseCloudSolrClient extends SolrClient {\n       } else {\n         log.info(\"request was not communication error it seems\");\n       }\n-      log.error(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n+      log.info(\"Request to collection {} failed due to ({}) {}, retry={} maxRetries={} commError={} errorCode={} \",\n           inputCollections, errorCode, rootCause, retryCount, MAX_STALE_RETRIES, wasCommError, errorCode);\n \n       boolean stateWasStale = false;\n"}}, {"oid": "3b21411957ba70efeb13c1b1150a0489750b568d", "url": "https://github.com/apache/lucene-solr/commit/3b21411957ba70efeb13c1b1150a0489750b568d", "message": "Update solr/solrj/src/java/org/apache/solr/client/solrj/impl/BaseCloudSolrClient.java", "committedDate": "2020-09-16T14:21:16Z", "type": "commit"}]}