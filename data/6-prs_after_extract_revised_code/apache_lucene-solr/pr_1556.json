{"pr_number": 1556, "pr_title": "SOLR-8392 type safety on SolrParam", "pr_createdAt": "2020-06-08T18:15:36Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1556", "timeline": [{"oid": "beba6e9283cf357234e2a84cf17730705b79d0aa", "url": "https://github.com/apache/lucene-solr/commit/beba6e9283cf357234e2a84cf17730705b79d0aa", "message": "SOLR-8392 type safety on SolrParam", "committedDate": "2020-06-08T18:14:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkwMTg3NA==", "url": "https://github.com/apache/lucene-solr/pull/1556#discussion_r436901874", "bodyText": "I don't understand why this case is special and gets treated differently rather than converting the value to a String[]", "author": "madrob", "createdAt": "2020-06-08T18:16:21Z", "path": "solr/core/src/java/org/apache/solr/core/RequestParams.java", "diffHunk": "@@ -85,32 +85,25 @@ public static ParamSet createParamSet(Map map, Long version) {\n    * This converts Lists to arrays of strings. Because Solr expects\n    * params to be String[]\n    */\n-\n-  @SuppressWarnings({\"unchecked\", \"rawtypes\"})\n-  private static Map getMapCopy(Map value) {\n-    @SuppressWarnings({\"rawtypes\"})\n-    Map copy = new LinkedHashMap<>();\n-    for (Object o1 : value.entrySet()) {\n-      @SuppressWarnings({\"rawtypes\"})\n-      Map.Entry entry = (Map.Entry) o1;\n+  private static Map<String,String[]> getMapCopy(Map<String,?> value) {\n+    Map<String, String[]> copy = new LinkedHashMap<>();\n+    for (Map.Entry<String, ?> entry : value.entrySet()) {\n       if (\"\".equals(entry.getKey())) {\n-        copy.put(entry.getKey(), entry.getValue());\n-        continue;\n+        // nocommit\n+        // copy.put(entry.getKey(), entry.getValue());", "originalCommit": "beba6e9283cf357234e2a84cf17730705b79d0aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk3ODIyOQ==", "url": "https://github.com/apache/lucene-solr/pull/1556#discussion_r436978229", "bodyText": "This smells badly. If the key is \"\", then the raw value would be put in the return in the old code, even if null, whereas the changed code if the value was NOT null, it'd be the entry.getValue().toString() rather than entry.getValue().\nThat said, I think the change is better and any place in the that relies on the old behavior should be fixed.", "author": "ErickErickson", "createdAt": "2020-06-08T20:23:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkwMTg3NA=="}], "type": "inlineReview", "revised_code": {"commit": "e37d0efc9ecf655d74c62e50cbaff94e1c65af22", "chunk": "diff --git a/solr/core/src/java/org/apache/solr/core/RequestParams.java b/solr/core/src/java/org/apache/solr/core/RequestParams.java\nindex a758a2094c3..da1ae633809 100644\n--- a/solr/core/src/java/org/apache/solr/core/RequestParams.java\n+++ b/solr/core/src/java/org/apache/solr/core/RequestParams.java\n\n@@ -89,11 +89,13 @@ public class RequestParams implements MapSerializable {\n     Map<String, String[]> copy = new LinkedHashMap<>();\n     for (Map.Entry<String, ?> entry : value.entrySet()) {\n       if (\"\".equals(entry.getKey())) {\n-        // nocommit\n-        // copy.put(entry.getKey(), entry.getValue());\n-        // continue;\n-      }\n-      if (entry.getValue() == null) {\n+        // Why is this a special case?\n+        if (entry.getValue() instanceof String[]) {\n+          copy.put(\"\", (String[]) entry.getValue());\n+        } else {\n+          throw new IllegalArgumentException();\n+        }\n+      } else if (entry.getValue() == null) {\n         copy.put(entry.getKey(), null);\n       } else if (entry.getValue() instanceof List) {\n         List<?> l = (List<?>) entry.getValue();\n"}}, {"oid": "e37d0efc9ecf655d74c62e50cbaff94e1c65af22", "url": "https://github.com/apache/lucene-solr/commit/e37d0efc9ecf655d74c62e50cbaff94e1c65af22", "message": "special case?", "committedDate": "2020-06-08T21:01:44Z", "type": "commit"}, {"oid": "01d698aace8cb05b41a328c183c28917e8ee6f95", "url": "https://github.com/apache/lucene-solr/commit/01d698aace8cb05b41a328c183c28917e8ee6f95", "message": "better assertion", "committedDate": "2020-06-09T18:25:12Z", "type": "commit"}]}