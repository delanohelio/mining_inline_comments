{"pr_number": 1938, "pr_title": "SOLR-14659: Remove restlet as dependency for the ManagedResource API", "pr_createdAt": "2020-10-01T23:51:02Z", "pr_url": "https://github.com/apache/lucene-solr/pull/1938", "timeline": [{"oid": "0b9530975bc2b89eadd487f2d1704f7868b4c547", "url": "https://github.com/apache/lucene-solr/commit/0b9530975bc2b89eadd487f2d1704f7868b4c547", "message": "SOLR-14766: Remove restlet as dependency for the ManagedResource API", "committedDate": "2020-10-01T22:54:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MTk4Mg==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r498581982", "bodyText": "UNSAFE_HASH_EQUALS:  Unsafe comparison of hash that are susceptible to timing attack (details)", "author": "sonatype-lift", "createdAt": "2020-10-02T01:16:33Z", "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -326,44 +327,46 @@ public void doInit() throws ResourceException {\n           }\n         }\n       }    \n-      \n+\n       if (managedResource == null) {\n-        if (Method.PUT.equals(getMethod()) || Method.POST.equals(getMethod())) {\n+        final String method = getSolrRequest().getHttpMethod();\n+        if (\"PUT\".equals(method) || \"POST\".equals(method)) {", "originalCommit": "0b9530975bc2b89eadd487f2d1704f7868b4c547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxNjEwNg==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r498916106", "bodyText": "String equals unsafe? Not sure I understand what this warning is trying to convey?", "author": "thelabdude", "createdAt": "2020-10-02T16:10:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MTk4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTExMzc2MA==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r499113760", "bodyText": "If you click the details link, it explains.  It's pretty wild what it suggests... it's a stretch IMO.  Good luck pulling that attack off.  Besides, this is the HTTP method (fixed vocab); it's not a param.\nOur use of Muse here is very new.... we haven't tweaked .muse/config.toml yet but it needs some taming.  https://docs.muse.dev/docs/configuring-muse/", "author": "dsmiley", "createdAt": "2020-10-03T04:07:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU4MTk4Mg=="}], "type": "inlineReview", "revised_code": null}, {"oid": "4124ae724e47f43764250c316749b20af6bb1cb3", "url": "https://github.com/apache/lucene-solr/commit/4124ae724e47f43764250c316749b20af6bb1cb3", "message": "Apply patch from Noble and clean-up stray references to restlet", "committedDate": "2020-10-02T14:51:36Z", "type": "commit"}, {"oid": "90fd21de89843ce75978c99ab1c1c6c299c5be02", "url": "https://github.com/apache/lucene-solr/commit/90fd21de89843ce75978c99ab1c1c6c299c5be02", "message": "Remove unused import", "committedDate": "2020-10-02T15:21:45Z", "type": "commit"}, {"oid": "308cf2f07d818e378b3aa6dd65a78acb6b4b9033", "url": "https://github.com/apache/lucene-solr/commit/308cf2f07d818e378b3aa6dd65a78acb6b4b9033", "message": "Remove unnecessary changes", "committedDate": "2020-10-02T16:12:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk1Njc1OA==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r498956758", "bodyText": "THREAD_SAFETY_VIOLATION:  Read/Write race. Non-private method RestManager$Registry.isPathRegistered(...) reads without synchronization from container this.registered via call to Map.containsKey(...). Potentially races with write in method RestManager$Registry.registerManagedResource(...).\nReporting because another access to the same memory occurs on a background thread, although this access may not.", "author": "sonatype-lift", "createdAt": "2020-10-02T17:33:22Z", "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -160,6 +156,10 @@ private Pattern getReservedEndpointsPattern() {\n       return Pattern.compile(builder.toString());\n     }\n \n+    public boolean isPathRegistered(String s) {\n+      return registered.containsKey(s);", "originalCommit": "90fd21de89843ce75978c99ab1c1c6c299c5be02", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2b5f504282d9f539ed04e73f0442546f85bdb7a5", "chunk": "diff --git a/solr/core/src/java/org/apache/solr/rest/RestManager.java b/solr/core/src/java/org/apache/solr/rest/RestManager.java\nindex f6dbb2454be..0b396827f79 100644\n--- a/solr/core/src/java/org/apache/solr/rest/RestManager.java\n+++ b/solr/core/src/java/org/apache/solr/rest/RestManager.java\n\n@@ -156,10 +153,6 @@ public class RestManager {\n       return Pattern.compile(builder.toString());\n     }\n \n-    public boolean isPathRegistered(String s) {\n-      return registered.containsKey(s);\n-    }\n-\n \n     /**\n      * Get a view of the currently registered resources. \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTExMzE0OA==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r499113148", "bodyText": "I'd prefer you configure your IDE to keep java.* up front.  FWIW this is in the IntelliJ config in the project.", "author": "dsmiley", "createdAt": "2020-10-03T03:57:08Z", "path": "solr/core/src/java/org/apache/solr/rest/RestManager.java", "diffHunk": "@@ -16,15 +16,33 @@\n  */\n package org.apache.solr.rest;\n \n+import org.apache.solr.common.SolrException;", "originalCommit": "90fd21de89843ce75978c99ab1c1c6c299c5be02", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NDgxNA==", "url": "https://github.com/apache/lucene-solr/pull/1938#discussion_r499254814", "bodyText": "oops my bad, thanks for catching", "author": "thelabdude", "createdAt": "2020-10-04T14:51:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTExMzE0OA=="}], "type": "inlineReview", "revised_code": {"commit": "ddfb33fc7d984d61d0be4b0f1d56d8dad21b0d81", "chunk": "diff --git a/solr/core/src/java/org/apache/solr/rest/RestManager.java b/solr/core/src/java/org/apache/solr/rest/RestManager.java\nindex f6dbb2454be..6375e0e5637 100644\n--- a/solr/core/src/java/org/apache/solr/rest/RestManager.java\n+++ b/solr/core/src/java/org/apache/solr/rest/RestManager.java\n\n@@ -21,10 +21,7 @@ import org.apache.solr.common.SolrException.ErrorCode;\n import org.apache.solr.common.util.ContentStream;\n import org.apache.solr.common.util.NamedList;\n import org.apache.solr.core.SolrResourceLoader;\n-import org.apache.solr.metrics.SolrMetricsContext;\n import org.apache.solr.request.SolrQueryRequest;\n-import org.apache.solr.request.SolrRequestHandler;\n-import org.apache.solr.request.SolrRequestInfo;\n import org.apache.solr.response.SolrQueryResponse;\n import org.apache.solr.rest.ManagedResourceStorage.StorageIO;\n import org.slf4j.Logger;\n"}}, {"oid": "ddfb33fc7d984d61d0be4b0f1d56d8dad21b0d81", "url": "https://github.com/apache/lucene-solr/commit/ddfb33fc7d984d61d0be4b0f1d56d8dad21b0d81", "message": "Move the request handler to SchemaHandler", "committedDate": "2020-10-03T05:12:33Z", "type": "commit"}, {"oid": "2b5f504282d9f539ed04e73f0442546f85bdb7a5", "url": "https://github.com/apache/lucene-solr/commit/2b5f504282d9f539ed04e73f0442546f85bdb7a5", "message": "Support for security permissions", "committedDate": "2020-10-03T05:31:34Z", "type": "commit"}, {"oid": "e8d4c84f0373b2706d8b16ffc93a5c37ba566a27", "url": "https://github.com/apache/lucene-solr/commit/e8d4c84f0373b2706d8b16ffc93a5c37ba566a27", "message": "Fix import order", "committedDate": "2020-10-04T15:09:27Z", "type": "commit"}, {"oid": "09dcb51d3a1259c7da84f06272e908139152e1fe", "url": "https://github.com/apache/lucene-solr/commit/09dcb51d3a1259c7da84f06272e908139152e1fe", "message": "Fix imports", "committedDate": "2020-10-04T15:20:45Z", "type": "commit"}, {"oid": "5545260f2007bb1410e4d5374b2ba94bb5536d5f", "url": "https://github.com/apache/lucene-solr/commit/5545260f2007bb1410e4d5374b2ba94bb5536d5f", "message": "Merge remote-tracking branch 'asf/master' into jira/solr-14766", "committedDate": "2020-10-04T16:12:26Z", "type": "commit"}, {"oid": "cbf8d47f99a397d42aea445e48a8bd4c58263b1d", "url": "https://github.com/apache/lucene-solr/commit/cbf8d47f99a397d42aea445e48a8bd4c58263b1d", "message": "Add to changes.txt", "committedDate": "2020-10-04T16:13:39Z", "type": "commit"}, {"oid": "fbe446f4096ede155eea16565c8a6670972d2a99", "url": "https://github.com/apache/lucene-solr/commit/fbe446f4096ede155eea16565c8a6670972d2a99", "message": "Fix import order", "committedDate": "2020-10-04T16:16:22Z", "type": "commit"}]}