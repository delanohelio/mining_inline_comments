{"pr_number": 225, "pr_title": "HH-101495 add unit tests for kafka's listener and publisher", "pr_createdAt": "2020-01-24T09:05:09Z", "pr_url": "https://github.com/hhru/nuts-and-bolts/pull/225", "timeline": [{"oid": "cdc72000580b2b5951d2d3d2983bb31e964ec796", "url": "https://github.com/hhru/nuts-and-bolts/commit/cdc72000580b2b5951d2d3d2983bb31e964ec796", "message": "HH-101495 add spring config for kafka unit tests, add few unit tests", "committedDate": "2020-01-24T11:54:34Z", "type": "commit"}, {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "url": "https://github.com/hhru/nuts-and-bolts/commit/182532d3a22ebc65b650330f9a9f3e3be84243c8", "message": "HH-101495 rename package according to classes' names", "committedDate": "2020-01-24T11:54:34Z", "type": "commit"}, {"oid": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "url": "https://github.com/hhru/nuts-and-bolts/commit/182532d3a22ebc65b650330f9a9f3e3be84243c8", "message": "HH-101495 rename package according to classes' names", "committedDate": "2020-01-24T11:54:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNDgwMg==", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370604802", "bodyText": "\u0442\u0443\u0442 \u0432\u043e\u0442 \u043d\u0435 \u043e\u0447\u0435\u043d\u044c \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u043a\u043b\u044e\u0447 \u043a\u043e\u043d\u0444\u0438\u0433\u043e\u0432 \u0434\u043b\u044f \u043a\u0430\u0444\u043a\u0438 \u0432 \u0440\u0430\u0437\u043d\u044b\u0445 \u0441\u0435\u0440\u0432\u0438\u0441\u0430\u0445 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0440\u0430\u0437\u043d\u044b\u043c", "author": "bokshitsky", "createdAt": "2020-01-24T12:14:17Z", "path": "nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package ru.hh.nab.testbase.kafka;\n+\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Primary;\n+import ru.hh.kafka.test.TestKafka;\n+import static ru.hh.nab.testbase.NabTestConfig.createProperties;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+@Configuration\n+public class NabKafkaCommonTestConfig {\n+\n+  @Bean\n+  @Primary\n+  Properties serviceProperties(TestKafka testKafka) throws IOException {\n+    Properties serviceProperties = createProperties(\"service-test.properties\");\n+    serviceProperties.putAll(createProperties(\"kafka-test.properties\"));\n+    serviceProperties.setProperty(\"kafka.common.bootstrap.servers\", testKafka.getBootstrapServers());", "originalCommit": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMjQyMA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370622420", "bodyText": "\u0434\u0430\u0430\u0430, \u0442\u043e\u0447\u043d\u043e) \u0441\u043f\u0430\u0441\u0438\u0431\u043e \u0437\u0430 \u0432\u043d\u0438\u043c\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0441\u0442\u044c", "author": "vorobey92", "createdAt": "2020-01-24T13:03:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNDgwMg=="}], "type": "inlineReview", "revised_code": {"commit": "f4f1babd691c2a6459791f3d90cb3292545d0b1e", "chunk": "diff --git a/nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java b/nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java\nindex 2555c72b..65300d36 100644\n--- a/nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java\n+++ b/nab-testbase/src/main/java/ru/hh/nab/testbase/kafka/NabKafkaCommonTestConfig.java\n\n@@ -1,10 +1,10 @@\n package ru.hh.nab.testbase.kafka;\n \n+import org.springframework.beans.factory.config.PropertiesFactoryBean;\n import org.springframework.context.annotation.Bean;\n import org.springframework.context.annotation.Configuration;\n-import org.springframework.context.annotation.Primary;\n+import org.springframework.core.io.ClassPathResource;\n import ru.hh.kafka.test.TestKafka;\n-import static ru.hh.nab.testbase.NabTestConfig.createProperties;\n import java.io.IOException;\n import java.util.Properties;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNTQxMA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370605410", "bodyText": "\u0431\u0438\u043d objectMapper \u043d\u0435 \u043e\u0447 \u0445\u043e\u0440\u043e\u0448\u0430\u044f \u0438\u0434\u0435\u044f - \u0431\u0443\u0434\u0435\u0442 \u043f\u043e\u0441\u0442\u043e\u044f\u043d\u043d\u043e \u0442\u0430\u043c \u0441 \u0447\u0435\u043c-\u0442\u043e \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u043e\u0432\u0430\u0442\u044c-\u043f\u0435\u0440\u0435\u0442\u0438\u0440\u0430\u0442\u044c", "author": "bokshitsky", "createdAt": "2020-01-24T12:16:09Z", "path": "nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package ru.hh.nab.kafka;\n+\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.context.annotation.Import;\n+import ru.hh.nab.common.properties.FileSettings;\n+import ru.hh.nab.kafka.listener.DefaultListenerFactory;\n+import ru.hh.nab.kafka.listener.DeserializerSupplier;\n+import ru.hh.nab.kafka.listener.ListenerFactory;\n+import ru.hh.nab.kafka.publisher.PublisherFactory;\n+import ru.hh.nab.kafka.publisher.SerializerSupplier;\n+import ru.hh.nab.kafka.serialization.JacksonDeserializerSupplier;\n+import ru.hh.nab.kafka.serialization.JacksonSerializerSupplier;\n+import ru.hh.nab.kafka.util.ConfigProvider;\n+import ru.hh.nab.testbase.kafka.NabKafkaJsonTestConfig;\n+import java.util.Properties;\n+\n+@Configuration\n+@Import({NabKafkaJsonTestConfig.class})\n+public class KafkaTestConfig {\n+\n+  @Bean\n+  ObjectMapper objectMapper(){", "originalCommit": "182532d3a22ebc65b650330f9a9f3e3be84243c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyNDE0NA==", "url": "https://github.com/hhru/nuts-and-bolts/pull/225#discussion_r370624144", "bodyText": "\u041f\u043e\u043d\u0438\u043c\u0430\u044e, \u044d\u0442\u043e \u043f\u0440\u043e\u0441\u0442\u043e\u0439 \u0441\u043f\u043e\u0441\u043e\u0431 \u043f\u043e\u0434\u043b\u043e\u0436\u0438\u0442\u044c  \u0435\u0433\u043e \u0432  KafkaTestUtils.startKafkaWithJsonMessages(objectMapper) \u0442\u0443\u0442 https://github.com/hhru/nuts-and-bolts/pull/225/files#diff-7691060374d2258795462fc0bf869c4bR12\n\u041d\u0430\u0432\u0435\u0440\u043d\u043e\u0435, \u043c\u043e\u0436\u043d\u043e \u0441\u0434\u0435\u043b\u0430\u0442\u044c \u043a\u0430\u043a\u043e\u0439-\u043d TestObjectMapperProvider. \u0427\u0442\u043e\u0431 \u043a\u043e\u043d\u0444\u043b\u0438\u043a\u0442\u043e\u0432 \u043d\u0435 \u0431\u044b\u043b\u043e.", "author": "vorobey92", "createdAt": "2020-01-24T13:07:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYwNTQxMA=="}], "type": "inlineReview", "revised_code": {"commit": "f4f1babd691c2a6459791f3d90cb3292545d0b1e", "chunk": "diff --git a/nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java b/nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java\nindex 04003cf4..c2409eb2 100644\n--- a/nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java\n+++ b/nab-tests/src/test/java/ru/hh/nab/kafka/KafkaTestConfig.java\n\n@@ -14,6 +14,7 @@ import ru.hh.nab.kafka.serialization.JacksonDeserializerSupplier;\n import ru.hh.nab.kafka.serialization.JacksonSerializerSupplier;\n import ru.hh.nab.kafka.util.ConfigProvider;\n import ru.hh.nab.testbase.kafka.NabKafkaJsonTestConfig;\n+import ru.hh.nab.testbase.kafka.TestObjectMapperSupplier;\n import java.util.Properties;\n \n @Configuration\n"}}, {"oid": "f4f1babd691c2a6459791f3d90cb3292545d0b1e", "url": "https://github.com/hhru/nuts-and-bolts/commit/f4f1babd691c2a6459791f3d90cb3292545d0b1e", "message": "HH-101495 user kafkaClusterName when setting props, user TestObjectMapperSupplier instead of simple ObjectMapper", "committedDate": "2020-01-27T16:48:50Z", "type": "commit"}, {"oid": "137ed512fb840a56067ad0c9211c13f3b6f12c53", "url": "https://github.com/hhru/nuts-and-bolts/commit/137ed512fb840a56067ad0c9211c13f3b6f12c53", "message": "HH-101495 remove test configs", "committedDate": "2020-01-28T09:36:45Z", "type": "commit"}]}