{"pr_number": 10005, "pr_title": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress", "pr_createdAt": "2020-05-26T18:18:09Z", "pr_url": "https://github.com/crate/crate/pull/10005", "timeline": [{"oid": "2e55b51460df367235c5426df6392862c667865d", "url": "https://github.com/crate/crate/commit/2e55b51460df367235c5426df6392862c667865d", "message": "WIP", "committedDate": "2020-05-26T19:36:44Z", "type": "forcePushed"}, {"oid": "f3fd5e59c3bf92f345900dec2cbda3dffda11937", "url": "https://github.com/crate/crate/commit/f3fd5e59c3bf92f345900dec2cbda3dffda11937", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-26T20:23:10Z", "type": "forcePushed"}, {"oid": "8f7c053445a3821e88acbb07576d364bdeb8d1a1", "url": "https://github.com/crate/crate/commit/8f7c053445a3821e88acbb07576d364bdeb8d1a1", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-27T07:17:32Z", "type": "forcePushed"}, {"oid": "c5f8d6e22c1791c27a48d45a971125aa7db74d73", "url": "https://github.com/crate/crate/commit/c5f8d6e22c1791c27a48d45a971125aa7db74d73", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-27T07:24:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk3MDcxOA==", "url": "https://github.com/crate/crate/pull/10005#discussion_r430970718", "bodyText": "This method is still present in latest ES master, why did you remove it?", "author": "mfussenegger", "createdAt": "2020-05-27T09:09:37Z", "path": "server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java", "diffHunk": "@@ -109,7 +106,6 @@ public Entry(Snapshot snapshot, boolean includeGlobalState, boolean partial, Sta\n             } else {\n                 this.shards = shards;\n                 this.waitingIndices = findWaitingIndices(shards);\n-                assert assertShardsConsistent(state, indices, shards);", "originalCommit": "c5f8d6e22c1791c27a48d45a971125aa7db74d73", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk4MDExNA==", "url": "https://github.com/crate/crate/pull/10005#discussion_r430980114", "bodyText": "Oh, my bad. It was not present at the time of original the pr https://github.com/original-brownbear/elasticsearch/blob/808b8133cf9a7baf58615f0f00ddab402e448169/server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java and i thought it was removed before. It must have been added later. I didn't compare to master. I will add it back.", "author": "mkleen", "createdAt": "2020-05-27T09:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk3MDcxOA=="}], "type": "inlineReview", "revised_code": {"commit": "98a9e20431b23dfceebf09bf934763044ff2c4ac", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java b/server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java\nindex ee0b98a398..5040ffe4a4 100644\n--- a/server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java\n+++ b/server/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java\n\n@@ -106,6 +109,7 @@ public class SnapshotsInProgress extends AbstractNamedDiffable<Custom> implement\n             } else {\n                 this.shards = shards;\n                 this.waitingIndices = findWaitingIndices(shards);\n+                assert assertShardsConsistent(state, indices, shards);\n             }\n             this.repositoryStateId = repositoryStateId;\n             this.failure = failure;\n"}}, {"oid": "98a9e20431b23dfceebf09bf934763044ff2c4ac", "url": "https://github.com/crate/crate/commit/98a9e20431b23dfceebf09bf934763044ff2c4ac", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-27T12:20:50Z", "type": "forcePushed"}, {"oid": "dbddb319c13580e9a8351d202a5e757d9dbacbff", "url": "https://github.com/crate/crate/commit/dbddb319c13580e9a8351d202a5e757d9dbacbff", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-27T12:23:02Z", "type": "commit"}, {"oid": "dbddb319c13580e9a8351d202a5e757d9dbacbff", "url": "https://github.com/crate/crate/commit/dbddb319c13580e9a8351d202a5e757d9dbacbff", "message": "Introduce ShardState Enum + Slight Cleanup SnapshotsInProgress\n\nBackport of https://github.com/elastic/elasticsearch/pull/41940", "committedDate": "2020-05-27T12:23:02Z", "type": "forcePushed"}, {"oid": "a51c97d1efa660dfb99cf6c893fb1e9a42c49910", "url": "https://github.com/crate/crate/commit/a51c97d1efa660dfb99cf6c893fb1e9a42c49910", "message": "Merge branch 'master' into mkleen/shardstate", "committedDate": "2020-05-27T12:56:18Z", "type": "commit"}, {"oid": "216941a3409221a497d530ebd4f89b1b52dba9f4", "url": "https://github.com/crate/crate/commit/216941a3409221a497d530ebd4f89b1b52dba9f4", "message": "Merge branch 'master' into mkleen/shardstate", "committedDate": "2020-05-27T13:32:17Z", "type": "commit"}]}