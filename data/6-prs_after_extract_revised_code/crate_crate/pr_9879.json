{"pr_number": 9879, "pr_title": "Use the new function registry for the `pg_get_keywords` and `empty_row` table functions.", "pr_createdAt": "2020-04-22T14:04:38Z", "pr_url": "https://github.com/crate/crate/pull/9879", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzNDcyOA==", "url": "https://github.com/crate/crate/pull/9879#discussion_r413634728", "bodyText": "Once #9853 is merged we should use the signature's return type. Probably FunctionInfo will be gone once all functions uses the signature registry.\nMaybe we could wait a bit for #9853 as it maybe merged soon.", "author": "seut", "createdAt": "2020-04-23T08:52:10Z", "path": "sql/src/main/java/io/crate/expression/tablefunctions/EmptyRowTableFunction.java", "diffHunk": "@@ -66,7 +61,9 @@ public FunctionInfo info() {\n \n         @Override\n         public RowType returnType() {\n-            return emptyRow;\n+            assert info.returnType() instanceof RowType", "originalCommit": "e1bf73949a79761fb3407595ae0700dce9f2d66a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzOTk0Nw==", "url": "https://github.com/crate/crate/pull/9879#discussion_r413639947", "bodyText": "\ud83d\udc4d Sure, i'll rebase and adjust the PRs once #9853 is merged.", "author": "kovrus", "createdAt": "2020-04-23T08:59:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzNDcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzgxOTgyMQ==", "url": "https://github.com/crate/crate/pull/9879#discussion_r413819821", "bodyText": "As discussed, we can't do that atm as we'd need the bound signature for the correct return type. So we have to postpone this change until we may get rid of FunctionInfo.", "author": "seut", "createdAt": "2020-04-23T14:01:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYzNDcyOA=="}], "type": "inlineReview", "revised_code": {"commit": "1490b73d2ecb4591d4ddf2598a04961b07a8fbd0", "chunk": "diff --git a/sql/src/main/java/io/crate/expression/tablefunctions/EmptyRowTableFunction.java b/sql/src/main/java/io/crate/expression/tablefunctions/EmptyRowTableFunction.java\nindex 28a27ef42c..e209f05d19 100644\n--- a/sql/src/main/java/io/crate/expression/tablefunctions/EmptyRowTableFunction.java\n+++ b/sql/src/main/java/io/crate/expression/tablefunctions/EmptyRowTableFunction.java\n\n@@ -61,9 +72,7 @@ public class EmptyRowTableFunction {\n \n         @Override\n         public RowType returnType() {\n-            assert info.returnType() instanceof RowType\n-                : \"table functions must have the row return type\";\n-            return (RowType) info.returnType();\n+            return returnType;\n         }\n \n         @Override\n"}}, {"oid": "1490b73d2ecb4591d4ddf2598a04961b07a8fbd0", "url": "https://github.com/crate/crate/commit/1490b73d2ecb4591d4ddf2598a04961b07a8fbd0", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-23T10:10:31Z", "type": "forcePushed"}, {"oid": "9c0139bc5f36e03c2f32e97946c7e87e455e11ba", "url": "https://github.com/crate/crate/commit/9c0139bc5f36e03c2f32e97946c7e87e455e11ba", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-23T13:08:20Z", "type": "forcePushed"}, {"oid": "1716ee247e3f00d2fdd155f2ddb2435121914197", "url": "https://github.com/crate/crate/commit/1716ee247e3f00d2fdd155f2ddb2435121914197", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-23T14:06:36Z", "type": "forcePushed"}, {"oid": "46ce45d9975c5d263428041a4cba5c5e153c3cf9", "url": "https://github.com/crate/crate/commit/46ce45d9975c5d263428041a4cba5c5e153c3cf9", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-23T14:08:35Z", "type": "forcePushed"}, {"oid": "823a395c06bfbc43cc6d032c8297c573d3a64b6e", "url": "https://github.com/crate/crate/commit/823a395c06bfbc43cc6d032c8297c573d3a64b6e", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-24T07:47:00Z", "type": "forcePushed"}, {"oid": "3a1faad062d63a28bd8fd8a07e19b49b22d1f241", "url": "https://github.com/crate/crate/commit/3a1faad062d63a28bd8fd8a07e19b49b22d1f241", "message": "Use new func registry for the empty row table function.", "committedDate": "2020-04-24T08:19:12Z", "type": "commit"}, {"oid": "b5c61f4eef13f0fd09e41ce343a1c888b3b3c92f", "url": "https://github.com/crate/crate/commit/b5c61f4eef13f0fd09e41ce343a1c888b3b3c92f", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-24T08:19:12Z", "type": "commit"}, {"oid": "b5c61f4eef13f0fd09e41ce343a1c888b3b3c92f", "url": "https://github.com/crate/crate/commit/b5c61f4eef13f0fd09e41ce343a1c888b3b3c92f", "message": "Use new function registry for the pg_get_keywords function.", "committedDate": "2020-04-24T08:19:12Z", "type": "forcePushed"}]}