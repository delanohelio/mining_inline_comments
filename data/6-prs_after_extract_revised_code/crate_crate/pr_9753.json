{"pr_number": 9753, "pr_title": "Make sure inserts from lazy table functions are throttled", "pr_createdAt": "2020-03-10T15:17:33Z", "pr_url": "https://github.com/crate/crate/pull/9753", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQwNDUwMQ==", "url": "https://github.com/crate/crate/pull/9753#discussion_r390404501", "bodyText": "Shouldn't it return false if one is false?", "author": "seut", "createdAt": "2020-03-10T15:32:36Z", "path": "dex/src/main/java/io/crate/data/join/JoinBatchIterator.java", "diffHunk": "@@ -113,10 +113,7 @@ public void kill(@Nonnull Throwable throwable) {\n     }\n \n     @Override\n-    public boolean involvesIO() {\n-        if (left.involvesIO()) {\n-            return true;\n-        }\n-        return right.involvesIO();\n+    public boolean hasLazyResultSet() {\n+        return left.hasLazyResultSet() || right.hasLazyResultSet();", "originalCommit": "197aac029405af6bfbc63db6135302ecec1bdc4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQxNzUzMw==", "url": "https://github.com/crate/crate/pull/9753#discussion_r390417533", "bodyText": "I think it's safer to weight the true / lazy case higher. If you insert from a join of values with generate_series it should throttle.", "author": "mfussenegger", "createdAt": "2020-03-10T15:49:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQwNDUwMQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQwODExNg==", "url": "https://github.com/crate/crate/pull/9753#discussion_r390408116", "bodyText": "should we rename the instance var as well?", "author": "seut", "createdAt": "2020-03-10T15:37:21Z", "path": "dex/src/main/java/io/crate/data/InMemoryBatchIterator.java", "diffHunk": "@@ -109,7 +109,7 @@ public void kill(@Nonnull Throwable throwable) {\n     }\n \n     @Override\n-    public boolean involvesIO() {\n+    public boolean hasLazyResultSet() {", "originalCommit": "197aac029405af6bfbc63db6135302ecec1bdc4f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "32b001abe2eb4e0305e03fb79d931cde6d10cefe", "chunk": "diff --git a/dex/src/main/java/io/crate/data/InMemoryBatchIterator.java b/dex/src/main/java/io/crate/data/InMemoryBatchIterator.java\nindex e868cde7f2..c0f52badb2 100644\n--- a/dex/src/main/java/io/crate/data/InMemoryBatchIterator.java\n+++ b/dex/src/main/java/io/crate/data/InMemoryBatchIterator.java\n\n@@ -110,6 +110,6 @@ public class InMemoryBatchIterator<T> implements BatchIterator<T> {\n \n     @Override\n     public boolean hasLazyResultSet() {\n-        return involvesIO;\n+        return hasLazyResultSet;\n     }\n }\n"}}, {"oid": "32b001abe2eb4e0305e03fb79d931cde6d10cefe", "url": "https://github.com/crate/crate/commit/32b001abe2eb4e0305e03fb79d931cde6d10cefe", "message": "Make sure inserts from lazy table functions are throttled\n\nTable functions like `generate_series` can generate a large result set.\nThis ensures that inserts from such tables are using the throttle\nmechanism to not overload the cluster.", "committedDate": "2020-03-10T19:04:29Z", "type": "commit"}, {"oid": "32b001abe2eb4e0305e03fb79d931cde6d10cefe", "url": "https://github.com/crate/crate/commit/32b001abe2eb4e0305e03fb79d931cde6d10cefe", "message": "Make sure inserts from lazy table functions are throttled\n\nTable functions like `generate_series` can generate a large result set.\nThis ensures that inserts from such tables are using the throttle\nmechanism to not overload the cluster.", "committedDate": "2020-03-10T19:04:29Z", "type": "forcePushed"}]}