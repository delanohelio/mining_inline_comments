{"pr_number": 10492, "pr_title": "Match all Exception types in KillIntegrationTest to fix flakiness", "pr_createdAt": "2020-09-04T10:57:35Z", "pr_url": "https://github.com/crate/crate/pull/10492", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU0NTQ0Mg==", "url": "https://github.com/crate/crate/pull/10492#discussion_r483545442", "bodyText": "This handles the following case:\n\n  \n    \n      crate/libs/dex/src/test/java/io/crate/testing/FailingBatchIterator.java\n    \n    \n         Line 46\n      in\n      6814214\n    \n    \n    \n    \n\n        \n          \n           Exceptions.rethrowUnchecked(new InterruptedException(\"Job killed\")); \n        \n    \n  \n\n\nThe test used to match against SqlActionException which wrapped all underlying exceptions. Now since SqlActionException is gone we need to match each exception type.", "author": "mkleen", "createdAt": "2020-09-04T10:59:20Z", "path": "server/src/test/java/io/crate/integrationtests/KillIntegrationTest.java", "diffHunk": "@@ -95,7 +95,7 @@ private void assertGotCancelled(final String statement, @Nullable final Object[]\n                 future.get(10, TimeUnit.SECONDS);\n             } catch (Throwable exception) {\n                 exception = SQLExceptions.unwrap(exception); // wrapped in ExecutionException\n-                assertThat(exception, instanceOf(JobKilledException.class));\n+                assertThat(exception, anyOf(instanceOf(JobKilledException.class), instanceOf(InterruptedException.class));", "originalCommit": "c6b92fd1e9ae38cdf7f6a63ec502840ea2f33c29", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b40945eefe7ec9bbd536e9a1b51e00cfaf621c4a", "chunk": "diff --git a/server/src/test/java/io/crate/integrationtests/KillIntegrationTest.java b/server/src/test/java/io/crate/integrationtests/KillIntegrationTest.java\nindex ee225f209d..1a4659b956 100644\n--- a/server/src/test/java/io/crate/integrationtests/KillIntegrationTest.java\n+++ b/server/src/test/java/io/crate/integrationtests/KillIntegrationTest.java\n\n@@ -97,7 +97,7 @@ public class KillIntegrationTest extends SQLTransportIntegrationTest {\n                 exception = SQLExceptions.unwrap(exception); // wrapped in ExecutionException\n                 assertThat(exception, anyOf(instanceOf(JobKilledException.class), instanceOf(InterruptedException.class));\n                 assertThat(exception.toString(), anyOf(\n-                    containsString(\"Job killed\"), // CancellationException\n+                    containsString(\"Job killed\"), // CancellationException, InterruptedException\n                     containsString(\"RootTask for job\"), // TaskMissing when root task not found\n                     containsString(\"Task for job\") // TaskMissing when task not found\n                 ));\n"}}, {"oid": "ba9f41233abcca7f66cf9326b9c001c079251b16", "url": "https://github.com/crate/crate/commit/ba9f41233abcca7f66cf9326b9c001c079251b16", "message": "Add InterruptedException to matcher to fix flaky KillIntegrationTest", "committedDate": "2020-09-04T11:05:24Z", "type": "forcePushed"}, {"oid": "d58acaa82afe317d1b9119a6b08a6bd3123fbda8", "url": "https://github.com/crate/crate/commit/d58acaa82afe317d1b9119a6b08a6bd3123fbda8", "message": "Match InterruptedException in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:06:13Z", "type": "forcePushed"}, {"oid": "b40945eefe7ec9bbd536e9a1b51e00cfaf621c4a", "url": "https://github.com/crate/crate/commit/b40945eefe7ec9bbd536e9a1b51e00cfaf621c4a", "message": "Match InterruptedException in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:08:48Z", "type": "forcePushed"}, {"oid": "d554177eef0f169318e0837a608ae6785ec9252e", "url": "https://github.com/crate/crate/commit/d554177eef0f169318e0837a608ae6785ec9252e", "message": "Match InterruptedException in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:11:25Z", "type": "forcePushed"}, {"oid": "26cefd8456f7020f34ac4666c5ef6da88c23ebd6", "url": "https://github.com/crate/crate/commit/26cefd8456f7020f34ac4666c5ef6da88c23ebd6", "message": "Match InterruptedException in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:42:13Z", "type": "forcePushed"}, {"oid": "4cd259776de465f81af3f7a83e11e1fd9ef0a13f", "url": "https://github.com/crate/crate/commit/4cd259776de465f81af3f7a83e11e1fd9ef0a13f", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:43:17Z", "type": "forcePushed"}, {"oid": "4a9d56acca5d22a67617270940ce4d50d5667d5f", "url": "https://github.com/crate/crate/commit/4a9d56acca5d22a67617270940ce4d50d5667d5f", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T11:54:41Z", "type": "forcePushed"}, {"oid": "3627707f0ba6a77078ceb29ad24d514a2e51b2a0", "url": "https://github.com/crate/crate/commit/3627707f0ba6a77078ceb29ad24d514a2e51b2a0", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T12:06:18Z", "type": "forcePushed"}, {"oid": "33209801336a207cb7ce7a11535e9f2e99c0641b", "url": "https://github.com/crate/crate/commit/33209801336a207cb7ce7a11535e9f2e99c0641b", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T14:14:34Z", "type": "forcePushed"}, {"oid": "7803147e21d4c7c14bbde1435e26baba121fb581", "url": "https://github.com/crate/crate/commit/7803147e21d4c7c14bbde1435e26baba121fb581", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T14:15:34Z", "type": "commit"}, {"oid": "7803147e21d4c7c14bbde1435e26baba121fb581", "url": "https://github.com/crate/crate/commit/7803147e21d4c7c14bbde1435e26baba121fb581", "message": "Match all Exception types in KillIntegrationTest to fix flakiness", "committedDate": "2020-09-04T14:15:34Z", "type": "forcePushed"}, {"oid": "3b02a13754f7b1c08fcfd2b44fadac0c5a4ffcfa", "url": "https://github.com/crate/crate/commit/3b02a13754f7b1c08fcfd2b44fadac0c5a4ffcfa", "message": "Make TaskMissing an ElasticSearchException", "committedDate": "2020-09-07T08:23:15Z", "type": "commit"}, {"oid": "3b02a13754f7b1c08fcfd2b44fadac0c5a4ffcfa", "url": "https://github.com/crate/crate/commit/3b02a13754f7b1c08fcfd2b44fadac0c5a4ffcfa", "message": "Make TaskMissing an ElasticSearchException", "committedDate": "2020-09-07T08:23:15Z", "type": "forcePushed"}]}