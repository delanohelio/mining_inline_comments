{"pr_number": 10812, "pr_title": "Fix testRecentPrimaryInformation", "pr_createdAt": "2020-11-25T10:56:58Z", "pr_url": "https://github.com/crate/crate/pull/10812", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNDkzMw==", "url": "https://github.com/crate/crate/pull/10812#discussion_r530434933", "bodyText": "shouldn't this also contain wait_for_active_shards=0? at least the original test does this..", "author": "seut", "createdAt": "2020-11-25T14:57:06Z", "path": "server/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorIT.java", "diffHunk": "@@ -133,7 +136,7 @@ public void testRecentPrimaryInformation() throws Exception {\n             // AllocationService only calls GatewayAllocator if there are unassigned shards\n             execute(\"\"\"\n                 create table doc.dummy (x int)\n-                with (\"routing.allocation.require.attr\" = 'not-found')\n+                with (\"number_of_replicas\" = 1)", "originalCommit": "6948b1c55310e3d583af559bd7a1a6595e348897", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNjY4Ng==", "url": "https://github.com/crate/crate/pull/10812#discussion_r530436686", "bodyText": "But looks like this has no effect at this test and such is unrelated, so ignore my comment.", "author": "seut", "createdAt": "2020-11-25T14:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNDkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ1MDE1MA==", "url": "https://github.com/crate/crate/pull/10812#discussion_r530450150", "bodyText": "I'll add it anyway \ud83d\udc4d", "author": "mfussenegger", "createdAt": "2020-11-25T15:17:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQzNDkzMw=="}], "type": "inlineReview", "revised_code": {"commit": "ff341950c8c6af6715ba71cb192c402f49e09279", "chunk": "diff --git a/server/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorIT.java b/server/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorIT.java\nindex 0ae00dcb65..68b11af619 100644\n--- a/server/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorIT.java\n+++ b/server/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorIT.java\n\n@@ -136,7 +133,7 @@ public class ReplicaShardAllocatorIT extends SQLTransportIntegrationTest {\n             // AllocationService only calls GatewayAllocator if there are unassigned shards\n             execute(\"\"\"\n                 create table doc.dummy (x int)\n-                with (\"number_of_replicas\" = 1)\n+                with (\"number_of_replicas\" = 1, \"write.wait_for_active_shards\" = 0)\n             \"\"\");\n             internalCluster().startDataOnlyNode(nodeWithReplicaSettings);\n             // need to wait for events to ensure the reroute has happened since we perform it async when a new node joins.\n"}}, {"oid": "ff341950c8c6af6715ba71cb192c402f49e09279", "url": "https://github.com/crate/crate/commit/ff341950c8c6af6715ba71cb192c402f49e09279", "message": "Fix testRecentPrimaryInformation", "committedDate": "2020-11-25T15:18:36Z", "type": "commit"}, {"oid": "ff341950c8c6af6715ba71cb192c402f49e09279", "url": "https://github.com/crate/crate/commit/ff341950c8c6af6715ba71cb192c402f49e09279", "message": "Fix testRecentPrimaryInformation", "committedDate": "2020-11-25T15:18:36Z", "type": "forcePushed"}, {"oid": "4b4d6c2861e923ef332d648ab2a9bd2af23225e0", "url": "https://github.com/crate/crate/commit/4b4d6c2861e923ef332d648ab2a9bd2af23225e0", "message": "Merge branch 'master' into j/shard-allocator-it", "committedDate": "2020-11-25T15:54:47Z", "type": "commit"}]}