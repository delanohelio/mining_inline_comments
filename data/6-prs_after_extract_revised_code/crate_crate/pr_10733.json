{"pr_number": 10733, "pr_title": "Backport ES changes", "pr_createdAt": "2020-11-02T15:45:05Z", "pr_url": "https://github.com/crate/crate/pull/10733", "timeline": [{"oid": "ccaef7593a2a23de664ddda47a57f32cd3100024", "url": "https://github.com/crate/crate/commit/ccaef7593a2a23de664ddda47a57f32cd3100024", "message": "bp: Always use primary term from primary to index docs on replica\n\nhttps://github.com/elastic/elasticsearch/commit/66f49d8ea5d263eb3c78739657dc4718c1420825", "committedDate": "2020-11-03T09:29:00Z", "type": "forcePushed"}, {"oid": "8a81284a462d450c335f4e241b50ebb898e7f393", "url": "https://github.com/crate/crate/commit/8a81284a462d450c335f4e241b50ebb898e7f393", "message": "bp: Remove type field from internal PutMappingRequest", "committedDate": "2020-11-03T09:58:43Z", "type": "forcePushed"}, {"oid": "93e3259994d775c1e9b5817dff62c92fb19e3440", "url": "https://github.com/crate/crate/commit/93e3259994d775c1e9b5817dff62c92fb19e3440", "message": "bp: ThreadPool and ThreadContext are not closeable\n\nhttps://github.com/elastic/elasticsearch/commit/0260c6f55c4623f1195341bdc4e61a7ec7bc1754", "committedDate": "2020-11-03T10:31:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU5NDU1OQ==", "url": "https://github.com/crate/crate/pull/10733#discussion_r516594559", "bodyText": "Any reason to keep this variable? Afaik its only usage is in the same class for type validating which we could also remove as our type is always fixed and could already not be changed in the past.", "author": "seut", "createdAt": "2020-11-03T11:21:24Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -74,7 +76,7 @@\n         MAPPING_RECOVERY;\n     }\n \n-    public static final String SINGLE_MAPPING_NAME = \"_doc\";\n+    public static final String SINGLE_MAPPING_NAME = Constants.DEFAULT_MAPPING_TYPE;", "originalCommit": "591a407610de4a3f248cc265dc29455c3c76ddaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4ODI2Mg==", "url": "https://github.com/crate/crate/pull/10733#discussion_r516688262", "bodyText": "The only reason was to keep the diff closer to the ES patch and because I thought that it may actually be nicer so change everything to MapperService.SINGLE_MAPPING_NAME and remove Constants.DEFAULT_MAPPING_TYPE.\nBut I think it's better to do that once we've removed more type occurrences from the APIs. Maybe both will disappear altogether.", "author": "mfussenegger", "createdAt": "2020-11-03T14:03:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjU5NDU1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "c88ba056cb0c519b2d020e28f1a5cc0e2a90a948", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\nindex 38f081317d..700bb9112a 100644\n--- a/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\n+++ b/server/src/main/java/org/elasticsearch/index/mapper/MapperService.java\n\n@@ -76,7 +74,7 @@ public class MapperService extends AbstractIndexComponent implements Closeable {\n         MAPPING_RECOVERY;\n     }\n \n-    public static final String SINGLE_MAPPING_NAME = Constants.DEFAULT_MAPPING_TYPE;\n+    public static final String SINGLE_MAPPING_NAME = \"_doc\";\n     public static final Setting<Long> INDEX_MAPPING_TOTAL_FIELDS_LIMIT_SETTING =\n         Setting.longSetting(\"index.mapping.total_fields.limit\", 1000L, 0, Property.Dynamic, Property.IndexScope);\n     public static final Setting<Long> INDEX_MAPPING_DEPTH_LIMIT_SETTING =\n"}}, {"oid": "7b3a4dc4821bdbe7556ac4b1cb4b78ed6f2db7df", "url": "https://github.com/crate/crate/commit/7b3a4dc4821bdbe7556ac4b1cb4b78ed6f2db7df", "message": "bp: ThreadPool and ThreadContext are not closeable\n\nhttps://github.com/elastic/elasticsearch/commit/0260c6f55c4623f1195341bdc4e61a7ec7bc1754", "committedDate": "2020-11-03T15:58:13Z", "type": "forcePushed"}, {"oid": "c88ba056cb0c519b2d020e28f1a5cc0e2a90a948", "url": "https://github.com/crate/crate/commit/c88ba056cb0c519b2d020e28f1a5cc0e2a90a948", "message": "bp: MapperService.merge() should take a single mapper rather than a map\n\nhttps://github.com/elastic/elasticsearch/commit/7559bab501f5cbc42e164b1de9de85f729bad00e", "committedDate": "2020-11-04T10:39:04Z", "type": "commit"}, {"oid": "f006a444d16118980ff8b521412f78fbb8f47bfe", "url": "https://github.com/crate/crate/commit/f006a444d16118980ff8b521412f78fbb8f47bfe", "message": "bp: Fix Transport Stopped Exception\n\nhttps://github.com/elastic/elasticsearch/commit/fbaf8c428d75e43e69c4c0d1d036e75d8eeb606a", "committedDate": "2020-11-04T10:39:04Z", "type": "commit"}, {"oid": "f58666310c51f5da5ed781a17922ea78700e0f38", "url": "https://github.com/crate/crate/commit/f58666310c51f5da5ed781a17922ea78700e0f38", "message": "bp: Always use primary term from primary to index docs on replica\n\nhttps://github.com/elastic/elasticsearch/commit/66f49d8ea5d263eb3c78739657dc4718c1420825", "committedDate": "2020-11-04T10:39:04Z", "type": "commit"}, {"oid": "33ef1495be67a9e2631aa09c559bbc718963f180", "url": "https://github.com/crate/crate/commit/33ef1495be67a9e2631aa09c559bbc718963f180", "message": "bp: Remove type field from internal PutMappingRequest\n\nhttps://github.com/elastic/elasticsearch/commit/c1c7fa5d9c8f8423c848e196682273828bf50b3e", "committedDate": "2020-11-04T10:39:04Z", "type": "commit"}, {"oid": "e9469b3e60eac849f8ff7a1731d22bceaf1b8714", "url": "https://github.com/crate/crate/commit/e9469b3e60eac849f8ff7a1731d22bceaf1b8714", "message": "bp: Ignore Lucene index in peer recovery if translog corrupted\n\nhttps://github.com/elastic/elasticsearch/commit/5aa5d7b54b9a9bfcf8edb0672d7911b0b477ad08", "committedDate": "2020-11-04T10:39:05Z", "type": "commit"}, {"oid": "eadcf2e99cba7475f2819cea29a7c7c55c3a5a36", "url": "https://github.com/crate/crate/commit/eadcf2e99cba7475f2819cea29a7c7c55c3a5a36", "message": "bp: ThreadPool and ThreadContext are not closeable\n\nhttps://github.com/elastic/elasticsearch/commit/0260c6f55c4623f1195341bdc4e61a7ec7bc1754", "committedDate": "2020-11-04T10:39:05Z", "type": "commit"}, {"oid": "eadcf2e99cba7475f2819cea29a7c7c55c3a5a36", "url": "https://github.com/crate/crate/commit/eadcf2e99cba7475f2819cea29a7c7c55c3a5a36", "message": "bp: ThreadPool and ThreadContext are not closeable\n\nhttps://github.com/elastic/elasticsearch/commit/0260c6f55c4623f1195341bdc4e61a7ec7bc1754", "committedDate": "2020-11-04T10:39:05Z", "type": "forcePushed"}]}