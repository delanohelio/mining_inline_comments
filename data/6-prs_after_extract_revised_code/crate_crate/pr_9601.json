{"pr_number": 9601, "pr_title": "Add returning clause for insert to grammar and parser", "pr_createdAt": "2020-01-30T12:54:35Z", "pr_url": "https://github.com/crate/crate/pull/9601", "timeline": [{"oid": "80c97d77ec14300b936d4c12c046a5da803eb84d", "url": "https://github.com/crate/crate/commit/80c97d77ec14300b936d4c12c046a5da803eb84d", "message": "Add insert to sqlformatter and teststatementbuilder", "committedDate": "2020-01-30T18:10:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM2NDM3Mw==", "url": "https://github.com/crate/crate/pull/9601#discussion_r373364373", "bodyText": "Could Insert and InsertFromSubquery merged into one class ?  Looks like everywhere InsertFromSubquery is used.", "author": "mkleen", "createdAt": "2020-01-31T08:32:58Z", "path": "sql-parser/src/main/java/io/crate/sql/tree/Insert.java", "diffHunk": "@@ -31,11 +31,16 @@\n     protected final Table<T> table;\n     private final DuplicateKeyContext<T> duplicateKeyContext;\n     protected final List<String> columns;\n+    protected final List<SelectItem> returning;\n \n-    Insert(Table<T> table, List<String> columns, DuplicateKeyContext<T> duplicateKeyContext) {\n+    Insert(Table<T> table,", "originalCommit": "80c97d77ec14300b936d4c12c046a5da803eb84d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM3MTI0MQ==", "url": "https://github.com/crate/crate/pull/9601#discussion_r373371241", "bodyText": "Yes we should do that. Could you follow up on that against master before continueing with this here?", "author": "mfussenegger", "createdAt": "2020-01-31T08:52:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzM2NDM3Mw=="}], "type": "inlineReview", "revised_code": {"commit": "aea04f5cb0c2f5fadefd0ca8c9e77091cb686872", "chunk": "diff --git a/sql-parser/src/main/java/io/crate/sql/tree/Insert.java b/sql-parser/src/main/java/io/crate/sql/tree/Insert.java\nindex 5b13e7d1a2..610e02de89 100644\n--- a/sql-parser/src/main/java/io/crate/sql/tree/Insert.java\n+++ b/sql-parser/src/main/java/io/crate/sql/tree/Insert.java\n\n@@ -21,24 +21,28 @@\n \n package io.crate.sql.tree;\n \n+import com.google.common.base.MoreObjects;\n import com.google.common.base.Objects;\n \n import java.util.Collections;\n import java.util.List;\n \n-public abstract class Insert<T> extends Statement {\n+public final class Insert<T> extends Statement {\n \n-    protected final Table<T> table;\n+    private final Table<T> table;\n     private final DuplicateKeyContext<T> duplicateKeyContext;\n-    protected final List<String> columns;\n-    protected final List<SelectItem> returning;\n-\n-    Insert(Table<T> table,\n-           List<String> columns,\n-           DuplicateKeyContext<T> duplicateKeyContext,\n-           List<SelectItem> returning) {\n+    private final List<String> columns;\n+    private final Query insertSource;\n+    private final List<SelectItem> returning;\n+\n+    public Insert(Table<T> table,\n+                  Query insertSource,\n+                  List<String> columns,\n+                  List<SelectItem> returning,\n+                  DuplicateKeyContext<T> duplicateKeyContext) {\n         this.table = table;\n         this.columns = columns;\n+        this.insertSource = insertSource;\n         this.duplicateKeyContext = duplicateKeyContext;\n         this.returning = returning;\n     }\n"}}, {"oid": "f020bb3113557a4d5b16f6386e32b9d001948eb6", "url": "https://github.com/crate/crate/commit/f020bb3113557a4d5b16f6386e32b9d001948eb6", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-01-31T08:35:50Z", "type": "forcePushed"}, {"oid": "aea04f5cb0c2f5fadefd0ca8c9e77091cb686872", "url": "https://github.com/crate/crate/commit/aea04f5cb0c2f5fadefd0ca8c9e77091cb686872", "message": "Remove InsertFromSubquery", "committedDate": "2020-01-31T15:12:05Z", "type": "forcePushed"}, {"oid": "e0c710f303a2d28b8888c29e2db2e795e8b12f73", "url": "https://github.com/crate/crate/commit/e0c710f303a2d28b8888c29e2db2e795e8b12f73", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-01-31T15:17:16Z", "type": "forcePushed"}, {"oid": "ed66293237238e4f29aea017d24e75a4a2de910c", "url": "https://github.com/crate/crate/commit/ed66293237238e4f29aea017d24e75a4a2de910c", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-01-31T15:28:16Z", "type": "forcePushed"}, {"oid": "774166eaae9e4d232804be7879ed08145bdf1500", "url": "https://github.com/crate/crate/commit/774166eaae9e4d232804be7879ed08145bdf1500", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-01-31T15:31:57Z", "type": "forcePushed"}, {"oid": "4bbba73933a795ced2350452b90a17654ee30e88", "url": "https://github.com/crate/crate/commit/4bbba73933a795ced2350452b90a17654ee30e88", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-01T02:49:09Z", "type": "forcePushed"}, {"oid": "87a1a1355fbc2d5c2d98e472a262257a0e47906c", "url": "https://github.com/crate/crate/commit/87a1a1355fbc2d5c2d98e472a262257a0e47906c", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-01T02:52:46Z", "type": "forcePushed"}, {"oid": "5b8e4eca2de88b426585e4016a157e2019be05fe", "url": "https://github.com/crate/crate/commit/5b8e4eca2de88b426585e4016a157e2019be05fe", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-01T02:54:49Z", "type": "forcePushed"}, {"oid": "8414f06a897ed08ea0a564b7b94ee69f79e1b323", "url": "https://github.com/crate/crate/commit/8414f06a897ed08ea0a564b7b94ee69f79e1b323", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-02T03:27:10Z", "type": "forcePushed"}, {"oid": "a29d155350f59b4f0fea0583167adef0a012a134", "url": "https://github.com/crate/crate/commit/a29d155350f59b4f0fea0583167adef0a012a134", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-03T05:50:49Z", "type": "forcePushed"}, {"oid": "c6b8e8dce43a15ce72c0c1b49fe5f717e109af32", "url": "https://github.com/crate/crate/commit/c6b8e8dce43a15ce72c0c1b49fe5f717e109af32", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-03T15:29:32Z", "type": "commit"}, {"oid": "c6b8e8dce43a15ce72c0c1b49fe5f717e109af32", "url": "https://github.com/crate/crate/commit/c6b8e8dce43a15ce72c0c1b49fe5f717e109af32", "message": "Add returning clause for insert to grammar and parser", "committedDate": "2020-02-03T15:29:32Z", "type": "forcePushed"}]}