{"pr_number": 10050, "pr_title": "Add character_maximum_length to the columns table.", "pr_createdAt": "2020-06-05T09:37:45Z", "pr_url": "https://github.com/crate/crate/pull/10050", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyMTg4Mg==", "url": "https://github.com/crate/crate/pull/10050#discussion_r435821882", "bodyText": "Minor: this could be simplified. However this is up to you.\nif (DataTypes.isSameType(r.info.valueType(), STRING)) {\n  var stringType = ((StringType) r.info.valueType());\n  if (!stringType.unbound()) {\n    return stringType.lengthLimit();\n  }\n}\nreturn null;", "author": "mkleen", "createdAt": "2020-06-05T10:04:43Z", "path": "server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java", "diffHunk": "@@ -81,7 +82,18 @@\n                     return null;\n                 }\n             })\n-            .add(\"character_maximum_length\", INTEGER, ignored -> null)\n+            .add(\"character_maximum_length\", INTEGER, r -> {\n+                if (DataTypes.isSameType(r.info.valueType(), STRING)) {", "originalCommit": "f3e2da11963effb825404265faab41607c83aaa6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyNTAwNQ==", "url": "https://github.com/crate/crate/pull/10050#discussion_r435825005", "bodyText": "not sure, I find a bit more explicit and consistent if-else flow a bit easier to read, but no strong opinion.", "author": "kovrus", "createdAt": "2020-06-05T10:10:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgyMTg4Mg=="}], "type": "inlineReview", "revised_code": {"commit": "bcb52d9d1f4d00fc4e710138d493436e63bc6e18", "chunk": "diff --git a/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java b/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\nindex 627b3d4f4f..7b685beeb8 100644\n--- a/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\n+++ b/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\n\n@@ -83,7 +83,7 @@ public class InformationColumnsTableInfo {\n                 }\n             })\n             .add(\"character_maximum_length\", INTEGER, r -> {\n-                if (DataTypes.isSameType(r.info.valueType(), STRING)) {\n+                if (r.info.valueType() instanceof StringType) {\n                     var stringType = ((StringType) r.info.valueType());\n                     if (stringType.unbound()) {\n                         return null;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTgzNDg3MA==", "url": "https://github.com/crate/crate/pull/10050#discussion_r435834870", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if (DataTypes.isSameType(r.info.valueType(), STRING)) {\n          \n          \n            \n                            if (r.info.valueType() instanceof StringType) {\n          \n      \n    \n    \n  \n\nGiven that there is a cast in the next line, the isSameType is kinda unnecessary abstraction here and it would also imply that this callsite is aware about the implementation details of isSameType", "author": "mfussenegger", "createdAt": "2020-06-05T10:31:33Z", "path": "server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java", "diffHunk": "@@ -81,7 +82,18 @@\n                     return null;\n                 }\n             })\n-            .add(\"character_maximum_length\", INTEGER, ignored -> null)\n+            .add(\"character_maximum_length\", INTEGER, r -> {\n+                if (DataTypes.isSameType(r.info.valueType(), STRING)) {", "originalCommit": "f3e2da11963effb825404265faab41607c83aaa6", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bcb52d9d1f4d00fc4e710138d493436e63bc6e18", "chunk": "diff --git a/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java b/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\nindex 627b3d4f4f..7b685beeb8 100644\n--- a/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\n+++ b/server/src/main/java/io/crate/metadata/information/InformationColumnsTableInfo.java\n\n@@ -83,7 +83,7 @@ public class InformationColumnsTableInfo {\n                 }\n             })\n             .add(\"character_maximum_length\", INTEGER, r -> {\n-                if (DataTypes.isSameType(r.info.valueType(), STRING)) {\n+                if (r.info.valueType() instanceof StringType) {\n                     var stringType = ((StringType) r.info.valueType());\n                     if (stringType.unbound()) {\n                         return null;\n"}}, {"oid": "bcb52d9d1f4d00fc4e710138d493436e63bc6e18", "url": "https://github.com/crate/crate/commit/bcb52d9d1f4d00fc4e710138d493436e63bc6e18", "message": "Add character_maximum_length to the columns table.", "committedDate": "2020-06-05T11:26:04Z", "type": "forcePushed"}, {"oid": "03db164b17cf6913df306e5fdbf601062001f072", "url": "https://github.com/crate/crate/commit/03db164b17cf6913df306e5fdbf601062001f072", "message": "Add character_maximum_length to the columns table.", "committedDate": "2020-06-05T11:31:39Z", "type": "forcePushed"}, {"oid": "73d6bc3988f4e73fc0da7ad9648d94869fa6c565", "url": "https://github.com/crate/crate/commit/73d6bc3988f4e73fc0da7ad9648d94869fa6c565", "message": "Add character_maximum_length to the columns table.", "committedDate": "2020-06-05T11:42:51Z", "type": "commit"}, {"oid": "73d6bc3988f4e73fc0da7ad9648d94869fa6c565", "url": "https://github.com/crate/crate/commit/73d6bc3988f4e73fc0da7ad9648d94869fa6c565", "message": "Add character_maximum_length to the columns table.", "committedDate": "2020-06-05T11:42:51Z", "type": "forcePushed"}]}