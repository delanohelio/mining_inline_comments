{"pr_number": 9570, "pr_title": "Remove bound and unbound notions in PreparedStmt and Portal", "pr_createdAt": "2020-01-27T09:01:07Z", "pr_url": "https://github.com/crate/crate/pull/9570", "timeline": [{"oid": "860137e5aef9d3535e8f87199c4eba1a8b2484e7", "url": "https://github.com/crate/crate/commit/860137e5aef9d3535e8f87199c4eba1a8b2484e7", "message": "Rename PreparedStmt#unboundStatement to PreparedStmt#analyzedStatement.", "committedDate": "2020-01-27T09:23:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMzMyNA==", "url": "https://github.com/crate/crate/pull/9570#discussion_r371133324", "bodyText": "Do you think it would make sense to now always eagerly analyze the statement within parse already? That would allow us to remove the special case here and in describe. And we could probably also get rid of the analyzedStatement setter on PreparedStmt.", "author": "mfussenegger", "createdAt": "2020-01-27T09:27:49Z", "path": "sql/src/main/java/io/crate/action/sql/Session.java", "diffHunk": "@@ -272,9 +272,8 @@ public void bind(String portalName,\n             throw t;\n         }\n \n-        AnalyzedStatement unboundStatement = preparedStmt.unboundStatement();\n         AnalyzedStatement analyzedStatement;\n-        if (unboundStatement == null) {\n+        if (preparedStmt.analyzedStatement() == null) {", "originalCommit": "860137e5aef9d3535e8f87199c4eba1a8b2484e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE0MTc0OQ==", "url": "https://github.com/crate/crate/pull/9570#discussion_r371141749", "bodyText": "makes sense! \ud83d\udc4d I'll push a commit that does that to this PR.", "author": "kovrus", "createdAt": "2020-01-27T09:46:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTEzMzMyNA=="}], "type": "inlineReview", "revised_code": {"commit": "774357784c5fce1f0a8c8d21317372b4cf43b2c8", "chunk": "diff --git a/sql/src/main/java/io/crate/action/sql/Session.java b/sql/src/main/java/io/crate/action/sql/Session.java\nindex 6c7bd7ef8a..33b7e0da7d 100644\n--- a/sql/src/main/java/io/crate/action/sql/Session.java\n+++ b/sql/src/main/java/io/crate/action/sql/Session.java\n\n@@ -272,8 +272,9 @@ public class Session implements AutoCloseable {\n             throw t;\n         }\n \n+        AnalyzedStatement unboundStatement = preparedStmt.unboundStatement();\n         AnalyzedStatement analyzedStatement;\n-        if (preparedStmt.analyzedStatement() == null) {\n+        if (unboundStatement == null) {\n             try {\n                 analyzedStatement = analyzer.analyze(\n                     preparedStmt.parsedStatement(),\n"}}, {"oid": "774357784c5fce1f0a8c8d21317372b4cf43b2c8", "url": "https://github.com/crate/crate/commit/774357784c5fce1f0a8c8d21317372b4cf43b2c8", "message": "Rename Portal#boundOrUnboundStatement to Portal#analyzedStatement.", "committedDate": "2020-01-27T09:32:29Z", "type": "commit"}, {"oid": "aa0462e781b3adb98033c5cba017f0c99e9ccc8e", "url": "https://github.com/crate/crate/commit/aa0462e781b3adb98033c5cba017f0c99e9ccc8e", "message": "Rename PreparedStmt#unboundStatement to PreparedStmt#analyzedStatement.", "committedDate": "2020-01-27T09:32:29Z", "type": "commit"}, {"oid": "a46638991a5945c027a4fa4cf908d0c11d45ebe9", "url": "https://github.com/crate/crate/commit/a46638991a5945c027a4fa4cf908d0c11d45ebe9", "message": "Eagerly analyze statement in Session#parse.\n\nIt removes special handling for statements analysis\nin bind, describe and execBulk.", "committedDate": "2020-01-27T10:05:44Z", "type": "commit"}, {"oid": "a46638991a5945c027a4fa4cf908d0c11d45ebe9", "url": "https://github.com/crate/crate/commit/a46638991a5945c027a4fa4cf908d0c11d45ebe9", "message": "Eagerly analyze statement in Session#parse.\n\nIt removes special handling for statements analysis\nin bind, describe and execBulk.", "committedDate": "2020-01-27T10:05:44Z", "type": "forcePushed"}]}