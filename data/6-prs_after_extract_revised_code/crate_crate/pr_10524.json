{"pr_number": 10524, "pr_title": "Add more es testcases", "pr_createdAt": "2020-09-11T13:21:00Z", "pr_url": "https://github.com/crate/crate/pull/10524", "timeline": [{"oid": "ab34dccae5e4160ed57c8f1f474ecdbc394eaada", "url": "https://github.com/crate/crate/commit/ab34dccae5e4160ed57c8f1f474ecdbc394eaada", "message": "bp: Update ESAllocationTestCase to current state\n\nThis updates ESAllocationTestCase to the state of elasticsearch commit\n704317da71c to enable backports of more allocation tests.", "committedDate": "2020-09-11T13:33:06Z", "type": "forcePushed"}, {"oid": "c49e904285e86bd5a13e8c945b0190628fe785cd", "url": "https://github.com/crate/crate/commit/c49e904285e86bd5a13e8c945b0190628fe785cd", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests back", "committedDate": "2020-09-11T14:08:00Z", "type": "forcePushed"}, {"oid": "c854c0bb4f3fc818e06e4babbd0646f120d6cbea", "url": "https://github.com/crate/crate/commit/c854c0bb4f3fc818e06e4babbd0646f120d6cbea", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-11T20:13:14Z", "type": "forcePushed"}, {"oid": "9cdceef40a83f54e31307e3d914ab8139a4f46b7", "url": "https://github.com/crate/crate/commit/9cdceef40a83f54e31307e3d914ab8139a4f46b7", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-11T20:18:13Z", "type": "forcePushed"}, {"oid": "4f7f8c367a28c7481e3db785069d018e7481e817", "url": "https://github.com/crate/crate/commit/4f7f8c367a28c7481e3db785069d018e7481e817", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-21T07:15:25Z", "type": "forcePushed"}, {"oid": "62fc2fa7245b4b638d00535c5b7c89553d24c581", "url": "https://github.com/crate/crate/commit/62fc2fa7245b4b638d00535c5b7c89553d24c581", "message": "Add ShardRoutingTests back to es test suite", "committedDate": "2020-09-23T08:38:43Z", "type": "commit"}, {"oid": "42efb02fd6e4cf76e7a17a3cd8dbf7b37e772e78", "url": "https://github.com/crate/crate/commit/42efb02fd6e4cf76e7a17a3cd8dbf7b37e772e78", "message": "Add IndexShardRoutingTableTests back to es test suite", "committedDate": "2020-09-23T08:38:44Z", "type": "commit"}, {"oid": "1ea4b8925e9f4a98311a2ad9ddde48e82b665f77", "url": "https://github.com/crate/crate/commit/1ea4b8925e9f4a98311a2ad9ddde48e82b665f77", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-23T08:38:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM3NTQ5Nw==", "url": "https://github.com/crate/crate/pull/10524#discussion_r493375497", "bodyText": "why is this removed? it is not on the referred ES state https://github.com/elastic/elasticsearch/blame/704317da71c3de1b85679bc549bba3b4230acb5d/test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java#L228\nSeems like this could result in wrong behaviour.", "author": "seut", "createdAt": "2020-09-23T09:37:38Z", "path": "server/src/test/java/org/elasticsearch/cluster/ESAllocationTestCase.java", "diffHunk": "@@ -144,11 +217,6 @@ public Decision canAllocate(ShardRouting shardRouting, RoutingNode node, Routing\n         public Decision canAllocate(ShardRouting shardRouting, RoutingAllocation allocation) {\n             return decision;\n         }\n-\n-        @Override\n-        public Decision canAllocate(RoutingNode node, RoutingAllocation allocation) {", "originalCommit": "e7b96767f59a5534c454075ca1b798b0b3bbf1ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwNTA3Mw==", "url": "https://github.com/crate/crate/pull/10524#discussion_r493405073", "bodyText": "Good pick, i took it from the wrong point-of-time (head). My mistake. Thanks.", "author": "mkleen", "createdAt": "2020-09-23T10:08:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM3NTQ5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQwNTM2MQ==", "url": "https://github.com/crate/crate/pull/10524#discussion_r493405361", "bodyText": "I merged it already in the commit.", "author": "mkleen", "createdAt": "2020-09-23T10:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM3NTQ5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "7291529623b798db07098558d955ddd5a4dce802", "chunk": "diff --git a/server/src/test/java/org/elasticsearch/cluster/ESAllocationTestCase.java b/server/src/test/java/org/elasticsearch/cluster/ESAllocationTestCase.java\nindex fdf581edb3..2e3a39242f 100644\n--- a/server/src/test/java/org/elasticsearch/cluster/ESAllocationTestCase.java\n+++ b/server/src/test/java/org/elasticsearch/cluster/ESAllocationTestCase.java\n\n@@ -217,6 +217,11 @@ public abstract class ESAllocationTestCase extends ESTestCase {\n         public Decision canAllocate(ShardRouting shardRouting, RoutingAllocation allocation) {\n             return decision;\n         }\n+\n+        @Override\n+        public Decision canAllocate(RoutingNode node, RoutingAllocation allocation) {\n+            return decision;\n+        }\n     }\n \n     /** A lock {@link AllocationService} allowing tests to override time */\n"}}, {"oid": "7291529623b798db07098558d955ddd5a4dce802", "url": "https://github.com/crate/crate/commit/7291529623b798db07098558d955ddd5a4dce802", "message": "Update ESAllocationTestCase to current state\n\nThis updates ESAllocationTestCase to the state of elasticsearch commit\n704317da71c to enable backports of more allocation tests.", "committedDate": "2020-09-23T10:06:48Z", "type": "commit"}, {"oid": "09f51af2e5115d2b902c142143572d0f3d2bbbe2", "url": "https://github.com/crate/crate/commit/09f51af2e5115d2b902c142143572d0f3d2bbbe2", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-23T10:06:48Z", "type": "commit"}, {"oid": "09f51af2e5115d2b902c142143572d0f3d2bbbe2", "url": "https://github.com/crate/crate/commit/09f51af2e5115d2b902c142143572d0f3d2bbbe2", "message": "Add DeadNodesAllocationTests and AllocateUnassignedDecisionTests", "committedDate": "2020-09-23T10:06:48Z", "type": "forcePushed"}, {"oid": "ef8a76a9ea645a7f2554bdf3ab011f3495719446", "url": "https://github.com/crate/crate/commit/ef8a76a9ea645a7f2554bdf3ab011f3495719446", "message": "Merge branch 'master' into mkleen/bp_test_1", "committedDate": "2020-09-23T10:38:09Z", "type": "commit"}]}