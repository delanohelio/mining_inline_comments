{"pr_number": 10381, "pr_title": "Backport ES changes", "pr_createdAt": "2020-08-17T08:42:20Z", "pr_url": "https://github.com/crate/crate/pull/10381", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTMzMDg0Mw==", "url": "https://github.com/crate/crate/pull/10381#discussion_r471330843", "bodyText": "As far as I can tell this method was never present in ES in Engine, only in InternalEngine.", "author": "mfussenegger", "createdAt": "2020-08-17T08:44:04Z", "path": "server/src/main/java/org/elasticsearch/index/engine/Engine.java", "diffHunk": "@@ -698,11 +712,6 @@ public final CommitStats commitStats() {\n      */\n     public abstract long getLastSyncedGlobalCheckpoint();\n \n-    /**\n-     * Returns the latest local checkpoint value that has been processed\n-     */\n-    public abstract long getProcessedLocalCheckpoint();", "originalCommit": "a0406f5ceac701ae9642901aa43d452d8ed829b0", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "a6bff9656f8ab02f007a39f963f88b2cea65f668", "chunk": "diff --git a/server/src/main/java/org/elasticsearch/index/engine/Engine.java b/server/src/main/java/org/elasticsearch/index/engine/Engine.java\nindex 93b5eb578e..9bb8525eed 100644\n--- a/server/src/main/java/org/elasticsearch/index/engine/Engine.java\n+++ b/server/src/main/java/org/elasticsearch/index/engine/Engine.java\n\n@@ -712,6 +698,11 @@ public abstract class Engine implements Closeable {\n      */\n     public abstract long getLastSyncedGlobalCheckpoint();\n \n+    /**\n+     * Returns the latest local checkpoint value that has been processed\n+     */\n+    public abstract long getProcessedLocalCheckpoint();\n+\n     /** How much heap is used that would be freed by a refresh.  Note that this may throw {@link AlreadyClosedException}. */\n     public abstract long getIndexBufferRAMBytesUsed();\n \n"}}, {"oid": "9a43192c294e4c9e400bdc67940e266abe182988", "url": "https://github.com/crate/crate/commit/9a43192c294e4c9e400bdc67940e266abe182988", "message": "bp: Close and acquire commit during reset engine fix\n\nhttps://github.com/elastic/elasticsearch/commit/eda31b0ac00c952a52885902be59ac429b0ca81a\n\nThis also applies missing bits from earlier commits and pulls in the\nReadOnlyEngine:\n\n- https://github.com/elastic/elasticsearch/commit/918232a9c6219867d8e83919bf319b8a3bcfc4fe\n- https://github.com/elastic/elasticsearch/commit/902d6f579aff968d8f8426f1e6855ca1d9fb3a05\n- https://github.com/elastic/elasticsearch/commit/5166dd0a4c6b53560cb873dbda1f41099e1554fa\n\nAnd makes some additional changes because we have already applied these\ncommits:\n\n- https://github.com/elastic/elasticsearch/commit/f27e808c1457ddbda1c69b4422d9a10ee6ec299d\n- https://github.com/elastic/elasticsearch/commit/73bfdc4066be080dc4cad1f0521bf6ea14cded93", "committedDate": "2020-08-17T14:30:19Z", "type": "forcePushed"}, {"oid": "a6bff9656f8ab02f007a39f963f88b2cea65f668", "url": "https://github.com/crate/crate/commit/a6bff9656f8ab02f007a39f963f88b2cea65f668", "message": "bp: Recovery should not indefinitely retry on mapping error\n\nhttps://github.com/elastic/elasticsearch/commit/24e3145fd002064e79f54aa644212999640d3565", "committedDate": "2020-08-17T14:35:28Z", "type": "commit"}, {"oid": "4b8599160470a3c04cbef2d4f28238e1b985f936", "url": "https://github.com/crate/crate/commit/4b8599160470a3c04cbef2d4f28238e1b985f936", "message": "bp: Remove search analyzers from DocumentFieldMappers\n\nhttps://github.com/elastic/elasticsearch/commit/de222731f8ec17270a8139c2a18be0f7c02c24a7", "committedDate": "2020-08-17T14:35:28Z", "type": "commit"}, {"oid": "5403cd6993b4afa5ac9e69940848c4c957014cdf", "url": "https://github.com/crate/crate/commit/5403cd6993b4afa5ac9e69940848c4c957014cdf", "message": "bp: Use Java 11 collections conveniences everywhere\n\nhttps://github.com/elastic/elasticsearch/commit/f48ddd53fd66cfef3032a17023cd9e2f88702af9", "committedDate": "2020-08-17T14:35:28Z", "type": "commit"}, {"oid": "a332a804c8cdc0f1a48e935c8683d8471a04bd40", "url": "https://github.com/crate/crate/commit/a332a804c8cdc0f1a48e935c8683d8471a04bd40", "message": "bp: Remove some usages of MapBuilder#immutableMap\n\nhttps://github.com/elastic/elasticsearch/commit/545e56d1d1187669c7da810a356cba9dcb04822c", "committedDate": "2020-08-17T14:35:28Z", "type": "commit"}, {"oid": "223798eb915405f03d360600903c535e0ccc00f5", "url": "https://github.com/crate/crate/commit/223798eb915405f03d360600903c535e0ccc00f5", "message": "bp: Close and acquire commit during reset engine fix\n\nhttps://github.com/elastic/elasticsearch/commit/eda31b0ac00c952a52885902be59ac429b0ca81a\n\nThis also applies missing bits from earlier commits and pulls in the\nReadOnlyEngine:\n\n- https://github.com/elastic/elasticsearch/commit/918232a9c6219867d8e83919bf319b8a3bcfc4fe\n- https://github.com/elastic/elasticsearch/commit/902d6f579aff968d8f8426f1e6855ca1d9fb3a05\n- https://github.com/elastic/elasticsearch/commit/5166dd0a4c6b53560cb873dbda1f41099e1554fa\n\nAnd makes some additional changes because we have already applied these\ncommits:\n\n- https://github.com/elastic/elasticsearch/commit/f27e808c1457ddbda1c69b4422d9a10ee6ec299d\n- https://github.com/elastic/elasticsearch/commit/73bfdc4066be080dc4cad1f0521bf6ea14cded93", "committedDate": "2020-08-17T14:35:28Z", "type": "commit"}, {"oid": "223798eb915405f03d360600903c535e0ccc00f5", "url": "https://github.com/crate/crate/commit/223798eb915405f03d360600903c535e0ccc00f5", "message": "bp: Close and acquire commit during reset engine fix\n\nhttps://github.com/elastic/elasticsearch/commit/eda31b0ac00c952a52885902be59ac429b0ca81a\n\nThis also applies missing bits from earlier commits and pulls in the\nReadOnlyEngine:\n\n- https://github.com/elastic/elasticsearch/commit/918232a9c6219867d8e83919bf319b8a3bcfc4fe\n- https://github.com/elastic/elasticsearch/commit/902d6f579aff968d8f8426f1e6855ca1d9fb3a05\n- https://github.com/elastic/elasticsearch/commit/5166dd0a4c6b53560cb873dbda1f41099e1554fa\n\nAnd makes some additional changes because we have already applied these\ncommits:\n\n- https://github.com/elastic/elasticsearch/commit/f27e808c1457ddbda1c69b4422d9a10ee6ec299d\n- https://github.com/elastic/elasticsearch/commit/73bfdc4066be080dc4cad1f0521bf6ea14cded93", "committedDate": "2020-08-17T14:35:28Z", "type": "forcePushed"}]}