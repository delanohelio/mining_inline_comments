{"pr_number": 9562, "pr_title": "Impove types incompatibility exception message in insert analyzer.", "pr_createdAt": "2020-01-24T12:36:59Z", "pr_url": "https://github.com/crate/crate/pull/9562", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMzU2MA==", "url": "https://github.com/crate/crate/pull/9562#discussion_r370623560", "bodyText": "Would it be possible to turn this into an analyzer test? (Cheaper to run)", "author": "mfussenegger", "createdAt": "2020-01-24T13:06:19Z", "path": "sql/src/test/java/io/crate/integrationtests/PostgresITest.java", "diffHunk": "@@ -516,6 +516,25 @@ public void testExecuteBatchWithOneFailingAndNothingExecuted() throws Exception\n         }\n     }\n \n+    @Test\n+    public void test_execute_bulk_insert_from_subquery_fails_with_analyzer__types_incompatibility_exception() throws Exception {", "originalCommit": "16a3bbc4cbf0fb33a2c091c52ef26ac2e0e6712f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyNDk2OQ==", "url": "https://github.com/crate/crate/pull/9562#discussion_r370624969", "bodyText": "i deliberately wanted it to keep as an integration test, but probably it should be also fine to have it as the . analyzer test.  \ud83d\udc4d will update", "author": "kovrus", "createdAt": "2020-01-24T13:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDYyMzU2MA=="}], "type": "inlineReview", "revised_code": {"commit": "8e525b81325d91d7e533919dfe5449a79e1943d0", "chunk": "diff --git a/sql/src/test/java/io/crate/integrationtests/PostgresITest.java b/sql/src/test/java/io/crate/integrationtests/PostgresITest.java\nindex 13bd12b731..30d61298b8 100644\n--- a/sql/src/test/java/io/crate/integrationtests/PostgresITest.java\n+++ b/sql/src/test/java/io/crate/integrationtests/PostgresITest.java\n\n@@ -516,25 +516,6 @@ public class PostgresITest extends SQLTransportIntegrationTest {\n         }\n     }\n \n-    @Test\n-    public void test_execute_bulk_insert_from_subquery_fails_with_analyzer__types_incompatibility_exception() throws Exception {\n-        try (Connection conn = DriverManager.getConnection(url(RW), properties)) {\n-            conn.setAutoCommit(true);\n-            conn.createStatement().execute(\n-                \"CREATE TABLE t (x int) \" +\n-                \"WITH (number_of_replicas = 0)\");\n-            var preparedStatement = conn.prepareStatement(\"INSERT INTO t (x) (SELECT ?)\");\n-            preparedStatement.setObject(1, Map.of());\n-            preparedStatement.addBatch();\n-\n-            expectedException.expect(BatchUpdateException.class);\n-            expectedException.expectMessage(\n-                \"The type 'object' of the insert source '$1' \" +\n-                \"is not convertible to the type 'integer' of target column 'x'\");\n-            preparedStatement.executeBatch();\n-        }\n-    }\n-\n     @Test\n     public void testExecuteBatchWithOneRuntimeFailure() throws Exception {\n         try (Connection conn = DriverManager.getConnection(url(RW), properties)) {\n"}}, {"oid": "8e525b81325d91d7e533919dfe5449a79e1943d0", "url": "https://github.com/crate/crate/commit/8e525b81325d91d7e533919dfe5449a79e1943d0", "message": "Impove types incompatibility exception message in insert analyzer.", "committedDate": "2020-01-24T13:22:12Z", "type": "forcePushed"}, {"oid": "b9feb92cfd8a8bc039c46272e9e90956c1f11442", "url": "https://github.com/crate/crate/commit/b9feb92cfd8a8bc039c46272e9e90956c1f11442", "message": "Impove types incompatibility exception message in insert analyzer.", "committedDate": "2020-01-24T13:22:41Z", "type": "commit"}, {"oid": "b9feb92cfd8a8bc039c46272e9e90956c1f11442", "url": "https://github.com/crate/crate/commit/b9feb92cfd8a8bc039c46272e9e90956c1f11442", "message": "Impove types incompatibility exception message in insert analyzer.", "committedDate": "2020-01-24T13:22:41Z", "type": "forcePushed"}]}