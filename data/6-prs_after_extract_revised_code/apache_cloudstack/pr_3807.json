{"pr_number": 3807, "pr_title": "Enhancement: Allow creating network with duplicate name", "pr_createdAt": "2020-01-13T17:30:26Z", "pr_url": "https://github.com/apache/cloudstack/pull/3807", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5MTM1Ng==", "url": "https://github.com/apache/cloudstack/pull/3807#discussion_r366191356", "bodyText": "these are global scope only settings? is account level not more applicable or something in between?", "author": "DaanHoogland", "createdAt": "2020-01-14T07:52:06Z", "path": "server/src/main/java/com/cloud/network/NetworkServiceImpl.java", "diffHunk": "@@ -200,9 +203,14 @@\n /**\n  * NetworkServiceImpl implements NetworkService.\n  */\n-public class NetworkServiceImpl extends ManagerBase implements NetworkService {\n+public class NetworkServiceImpl extends ManagerBase implements NetworkService, Configurable {\n     private static final Logger s_logger = Logger.getLogger(NetworkServiceImpl.class);\n \n+    private static final ConfigKey<Boolean> AllowDuplicateNetworkName = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n+            \"allow.duplicate.networkname\", \"true\", \"Allow creating networks with same name in account\", true);\n+    private static final ConfigKey<Boolean> AllowEmptyStartEndIpAddress = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n+            \"allow.empty.start.end.ipaddress\", \"true\", \"Allow creating network without mentioning start and end IP address\",\n+            true);", "originalCommit": "17b087d0e6bdc7e9c875382a382f5165571fc765", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjMzMjY2Mg==", "url": "https://github.com/apache/cloudstack/pull/3807#discussion_r366332662", "bodyText": "I have made the necessary changes it include the account level setting", "author": "ravening", "createdAt": "2020-01-14T13:20:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5MTM1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "43a5b710bf4f5e37dbb41a99d9df2ab522dc32ed", "chunk": "diff --git a/server/src/main/java/com/cloud/network/NetworkServiceImpl.java b/server/src/main/java/com/cloud/network/NetworkServiceImpl.java\nindex 13de83466d..975b7dfc1f 100644\n--- a/server/src/main/java/com/cloud/network/NetworkServiceImpl.java\n+++ b/server/src/main/java/com/cloud/network/NetworkServiceImpl.java\n\n@@ -207,10 +207,10 @@ public class NetworkServiceImpl extends ManagerBase implements NetworkService, C\n     private static final Logger s_logger = Logger.getLogger(NetworkServiceImpl.class);\n \n     private static final ConfigKey<Boolean> AllowDuplicateNetworkName = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n-            \"allow.duplicate.networkname\", \"true\", \"Allow creating networks with same name in account\", true);\n+            \"allow.duplicate.networkname\", \"true\", \"Allow creating networks with same name in account\", true, ConfigKey.Scope.Account);\n     private static final ConfigKey<Boolean> AllowEmptyStartEndIpAddress = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n             \"allow.empty.start.end.ipaddress\", \"true\", \"Allow creating network without mentioning start and end IP address\",\n-            true);\n+            true, ConfigKey.Scope.Account);\n     private static final long MIN_VLAN_ID = 0L;\n     private static final long MAX_VLAN_ID = 4095L; // 2^12 - 1\n     private static final long MIN_GRE_KEY = 0L;\n"}}, {"oid": "43a5b710bf4f5e37dbb41a99d9df2ab522dc32ed", "url": "https://github.com/apache/cloudstack/commit/43a5b710bf4f5e37dbb41a99d9df2ab522dc32ed", "message": "Enhancement: Allow creating network with duplicate name\n\nAdd a global setting to disable creating networks with\nsame name in an account\n\nAdd a global setting to disable creating network without\nmentioning the start and end IPv4 or IPv6 address", "committedDate": "2020-01-14T13:17:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxOTI3NA==", "url": "https://github.com/apache/cloudstack/pull/3807#discussion_r371619274", "bodyText": "@ravening for backward compatibility, should this be false?", "author": "rhtyd", "createdAt": "2020-01-28T05:48:05Z", "path": "server/src/main/java/com/cloud/network/NetworkServiceImpl.java", "diffHunk": "@@ -200,9 +203,14 @@\n /**\n  * NetworkServiceImpl implements NetworkService.\n  */\n-public class NetworkServiceImpl extends ManagerBase implements NetworkService {\n+public class NetworkServiceImpl extends ManagerBase implements NetworkService, Configurable {\n     private static final Logger s_logger = Logger.getLogger(NetworkServiceImpl.class);\n \n+    private static final ConfigKey<Boolean> AllowDuplicateNetworkName = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n+            \"allow.duplicate.networkname\", \"true\", \"Allow creating networks with same name in account\", true, ConfigKey.Scope.Account);\n+    private static final ConfigKey<Boolean> AllowEmptyStartEndIpAddress = new ConfigKey<Boolean>(\"Advanced\", Boolean.class,\n+            \"allow.empty.start.end.ipaddress\", \"true\", \"Allow creating network without mentioning start and end IP address\",\n+            true, ConfigKey.Scope.Account);", "originalCommit": "43a5b710bf4f5e37dbb41a99d9df2ab522dc32ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTcwNTAzNw==", "url": "https://github.com/apache/cloudstack/pull/3807#discussion_r371705037", "bodyText": "@rhtyd In the current/default behavior we can create network without mentioning the start and end IP address. So the default value is \"true\". If the default value is \"false\" then it means we cant create a network with an empty start and end IP address which is not backward compatible.", "author": "ravening", "createdAt": "2020-01-28T09:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxOTI3NA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8525f77ff3e53c78a968c7c0601b08ad9096291d", "url": "https://github.com/apache/cloudstack/commit/8525f77ff3e53c78a968c7c0601b08ad9096291d", "message": "Enhancement: Allow creating network with duplicate name\n\nAdd a global setting to disable creating networks with\nsame name in an account\n\nAdd a global setting to disable creating network without\nmentioning the start and end IPv4 or IPv6 address\n\nBy default we can create networks with the same name in the account.\nSometimes we should not create the networks with same name.\nThis change adds a global setting which prevents creating the network with same name.\nThe default value is true and set it to false to prevent creating network with same names.\n\nAlso its possible to create a shared network without mentioning the\nstart and the end IPv4 or IPv6 address.\nThis change adds a global setting which prevents creating a shared\nnetwork without specifying the start and the end IPv4 or IPv6 address", "committedDate": "2020-01-30T08:57:03Z", "type": "commit"}, {"oid": "8525f77ff3e53c78a968c7c0601b08ad9096291d", "url": "https://github.com/apache/cloudstack/commit/8525f77ff3e53c78a968c7c0601b08ad9096291d", "message": "Enhancement: Allow creating network with duplicate name\n\nAdd a global setting to disable creating networks with\nsame name in an account\n\nAdd a global setting to disable creating network without\nmentioning the start and end IPv4 or IPv6 address\n\nBy default we can create networks with the same name in the account.\nSometimes we should not create the networks with same name.\nThis change adds a global setting which prevents creating the network with same name.\nThe default value is true and set it to false to prevent creating network with same names.\n\nAlso its possible to create a shared network without mentioning the\nstart and the end IPv4 or IPv6 address.\nThis change adds a global setting which prevents creating a shared\nnetwork without specifying the start and the end IPv4 or IPv6 address", "committedDate": "2020-01-30T08:57:03Z", "type": "forcePushed"}]}