{"pr_number": 4396, "pr_title": "Show network name in exception message", "pr_createdAt": "2020-10-12T08:13:31Z", "pr_url": "https://github.com/apache/cloudstack/pull/4396", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503271152", "bodyText": "this might yield an NPE hiding the original problem, no?", "author": "DaanHoogland", "createdAt": "2020-10-12T12:46:22Z", "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -3821,7 +3821,7 @@ private void checkIfHostNameUniqueInNtwkDomain(String hostName, List<? extends N\n                 // * verify that there are no duplicates\n                 if (hostNames.contains(hostName)) {\n                     throw new InvalidParameterValueException(\"The vm with hostName \" + hostName + \" already exists in the network domain: \" + ntwkDomain.getKey() + \"; network=\"\n-                            + _networkModel.getNetwork(ntwkId));\n+                            + _networkModel.getNetwork(ntwkId).getName());", "originalCommit": "30b35e298985c26e99f754532324bb25f717959f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI5MzYzMw==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503293633", "bodyText": "I see no problem in adding an if checking for a non-null name. However, a network can only be created with a name.\nIf the network is a non-null Object then I don't see how the name would be null. Unless manual queries have been executed on DB (messing with networks) or there are some bugs on the network removal/update process.", "author": "GabrielBrascher", "createdAt": "2020-10-12T13:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI5ODA4OQ==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503298089", "bodyText": "@DaanHoogland @GabrielBrascher most of the time the network name will be nonnull but there is no harm adding an extra if check. I will modify the code", "author": "ravening", "createdAt": "2020-10-12T13:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc5NjY5Ng==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503796696", "bodyText": "I am talking about the model returning a network in the first place. the namer being null will probably just print \"<null>\", @ravening @GabrielBrascher", "author": "DaanHoogland", "createdAt": "2020-10-13T09:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgwMDA4Ng==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503800086", "bodyText": "@DaanHoogland we are iterating over the list of networks which got populated earlier and it contains only valid existing networks. so networkmodel shouldnt return null", "author": "ravening", "createdAt": "2020-10-13T09:22:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxMDM0NA==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503810344", "bodyText": "@ravening How about just adding the network name to the NetworkVO toString(), so this remains the same, and we get to see the network's name along with other details like networkId, traffic type, etc?", "author": "Pearl1594", "createdAt": "2020-10-13T09:37:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxMjA4MQ==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503812081", "bodyText": "@ravening How about just adding the network name to the NetworkVO toString(), so this remains the same, and we get to see the network's name along with other details like networkId, traffic type, etc?\n\n@Pearl1594 should we all those detail in exception message? It makes sense to add entire networkVO object tostring in log message", "author": "ravening", "createdAt": "2020-10-13T09:40:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgzMTUwMw==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503831503", "bodyText": "@DaanHoogland we are iterating over the list of networks which got populated earlier and it contains only valid existing networks. so networkmodel shouldnt return null\n\nMaybe so @ravening, i trust your judgement on that. But it didn't happen in this method, so there is no telling what future generations will make of it.", "author": "DaanHoogland", "createdAt": "2020-10-13T10:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg1MjkxNw==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503852917", "bodyText": "@ravening How about just adding the network name to the NetworkVO toString(), so this remains the same, and we get to see the network's name along with other details like networkId, traffic type, etc?\n\n@Pearl1594 should we all those detail in exception message? It makes sense to add entire networkVO object tostring in log message\n\nIt actually depends, we may not want to show the network Id (i.e, DB id) to users, so maybe replace id with name in the toString()", "author": "Pearl1594", "createdAt": "2020-10-13T10:49:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzg4Njg4OA==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r503886888", "bodyText": "@ravening How about just adding the network name to the NetworkVO toString(), so this remains the same, and we get to see the network's name along with other details like networkId, traffic type, etc?\n\n\n\n\n\n@Pearl1594 should we all those detail in exception message? It makes sense to add entire networkVO object tostring in log message\n\nIt actually depends, we may not want to show the network Id (i.e, DB id) to users, so maybe replace id with name in the toString()\n\nThat will involve extra code changes which I want to avoid", "author": "ravening", "createdAt": "2020-10-13T11:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzNTgxNw==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r506435817", "bodyText": "@ravening while it does make sense to show the network name, we do not ensure uniqueness in network names in CloudStack - so would it lead to ambiguity just showing the name?", "author": "Pearl1594", "createdAt": "2020-10-16T13:41:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ0MjM4MQ==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r506442381", "bodyText": "@ravening while it does make sense to show the network name, we do not ensure uniqueness in network names in CloudStack - so would it lead to ambiguity just showing the name?\n\n@Pearl1594  this exception is thrown when we are trying to create second VM with same in same network. So I would assume, user will know in which network he is creating the VM. Also even if the network name is not unique, it's better than displaying VO object right which won't make sense anyway", "author": "ravening", "createdAt": "2020-10-16T13:48:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzI3MTE1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "cc58369710cec496544e11bfa1074b4d8f02c99b", "chunk": "diff --git a/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java b/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\nindex 0db7adcbe2..af410cfc1b 100644\n--- a/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n+++ b/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n\n@@ -3821,7 +3888,7 @@ public class UserVmManagerImpl extends ManagerBase implements UserVmManager, Vir\n                 // * verify that there are no duplicates\n                 if (hostNames.contains(hostName)) {\n                     throw new InvalidParameterValueException(\"The vm with hostName \" + hostName + \" already exists in the network domain: \" + ntwkDomain.getKey() + \"; network=\"\n-                            + _networkModel.getNetwork(ntwkId).getName());\n+                            + (_networkModel.getNetwork(ntwkId) != null) ? _networkModel.getNetwork(ntwkId).getName()) : \"<unknown>\";\n                 }\n             }\n         }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU1NDA3MQ==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r504554071", "bodyText": "How about fixing/extending the toString of the returned network object (the VO?)", "author": "rhtyd", "createdAt": "2020-10-14T09:59:47Z", "path": "server/src/main/java/com/cloud/vm/UserVmManagerImpl.java", "diffHunk": "@@ -3821,7 +3821,7 @@ private void checkIfHostNameUniqueInNtwkDomain(String hostName, List<? extends N\n                 // * verify that there are no duplicates\n                 if (hostNames.contains(hostName)) {\n                     throw new InvalidParameterValueException(\"The vm with hostName \" + hostName + \" already exists in the network domain: \" + ntwkDomain.getKey() + \"; network=\"\n-                            + _networkModel.getNetwork(ntwkId));\n+                            + _networkModel.getNetwork(ntwkId).getName());", "originalCommit": "30b35e298985c26e99f754532324bb25f717959f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3NTE0MDQyMA==", "url": "https://github.com/apache/cloudstack/pull/4396#discussion_r575140420", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        + _networkModel.getNetwork(ntwkId).getName());\n          \n          \n            \n                                        + (_networkModel.getNetwork(ntwkId) != null) ? _networkModel.getNetwork(ntwkId).getName()) : \"<unknown>\";", "author": "DaanHoogland", "createdAt": "2021-02-12T10:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU1NDA3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "cc58369710cec496544e11bfa1074b4d8f02c99b", "chunk": "diff --git a/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java b/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\nindex 0db7adcbe2..af410cfc1b 100644\n--- a/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n+++ b/server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n\n@@ -3821,7 +3888,7 @@ public class UserVmManagerImpl extends ManagerBase implements UserVmManager, Vir\n                 // * verify that there are no duplicates\n                 if (hostNames.contains(hostName)) {\n                     throw new InvalidParameterValueException(\"The vm with hostName \" + hostName + \" already exists in the network domain: \" + ntwkDomain.getKey() + \"; network=\"\n-                            + _networkModel.getNetwork(ntwkId).getName());\n+                            + (_networkModel.getNetwork(ntwkId) != null) ? _networkModel.getNetwork(ntwkId).getName()) : \"<unknown>\";\n                 }\n             }\n         }\n"}}, {"oid": "c24693c90a082ba719e51d0db9b347fa3b4fdd9d", "url": "https://github.com/apache/cloudstack/commit/c24693c90a082ba719e51d0db9b347fa3b4fdd9d", "message": "Show network name in exception message", "committedDate": "2020-10-28T11:52:51Z", "type": "commit"}, {"oid": "c24693c90a082ba719e51d0db9b347fa3b4fdd9d", "url": "https://github.com/apache/cloudstack/commit/c24693c90a082ba719e51d0db9b347fa3b4fdd9d", "message": "Show network name in exception message", "committedDate": "2020-10-28T11:52:51Z", "type": "forcePushed"}, {"oid": "cc58369710cec496544e11bfa1074b4d8f02c99b", "url": "https://github.com/apache/cloudstack/commit/cc58369710cec496544e11bfa1074b4d8f02c99b", "message": "Update server/src/main/java/com/cloud/vm/UserVmManagerImpl.java\n\nCo-authored-by: dahn <daan.hoogland@gmail.com>", "committedDate": "2021-02-19T08:34:02Z", "type": "commit"}]}