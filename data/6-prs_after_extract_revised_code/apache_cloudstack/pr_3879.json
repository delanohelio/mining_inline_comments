{"pr_number": 3879, "pr_title": "kvm: Enable virtio drivers based on guest os display name", "pr_createdAt": "2020-02-11T10:19:52Z", "pr_url": "https://github.com/apache/cloudstack/pull/3879", "timeline": [{"oid": "7ea0e908e4e3d2a8f6a76e76850a471267a10dc5", "url": "https://github.com/apache/cloudstack/commit/7ea0e908e4e3d2a8f6a76e76850a471267a10dc5", "message": "kvm: Enable virtio drivers based on guest os display name", "committedDate": "2020-02-11T10:09:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2OTAzNg==", "url": "https://github.com/apache/cloudstack/pull/3879#discussion_r379269036", "bodyText": "@ustcweizhou how about we check and fallback to \"Other\" in case guestOS.getDisplayName() is null or empty (unlikely but just to make code more defensive)?", "author": "rhtyd", "createdAt": "2020-02-14T06:31:09Z", "path": "server/src/main/java/com/cloud/hypervisor/KVMGuru.java", "diffHunk": "@@ -132,7 +132,7 @@ public VirtualMachineTO implement(VirtualMachineProfile vm) {\n             guestOsMapping = _guestOsHypervisorDao.findByOsIdAndHypervisor(guestOS.getId(), getHypervisorType().toString(), host.getHypervisorVersion());\n         }\n         if (guestOsMapping == null || host == null) {\n-            to.setPlatformEmulator(\"Other\");\n+            to.setPlatformEmulator(guestOS.getDisplayName());", "originalCommit": "7ea0e908e4e3d2a8f6a76e76850a471267a10dc5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d6fae5afbc6d147da81d6f186c5744b6110a520b", "chunk": "diff --git a/server/src/main/java/com/cloud/hypervisor/KVMGuru.java b/server/src/main/java/com/cloud/hypervisor/KVMGuru.java\nindex 64d542d26f..f6abbe1f19 100644\n--- a/server/src/main/java/com/cloud/hypervisor/KVMGuru.java\n+++ b/server/src/main/java/com/cloud/hypervisor/KVMGuru.java\n\n@@ -132,7 +132,7 @@ public class KVMGuru extends HypervisorGuruBase implements HypervisorGuru {\n             guestOsMapping = _guestOsHypervisorDao.findByOsIdAndHypervisor(guestOS.getId(), getHypervisorType().toString(), host.getHypervisorVersion());\n         }\n         if (guestOsMapping == null || host == null) {\n-            to.setPlatformEmulator(guestOS.getDisplayName());\n+            to.setPlatformEmulator(guestOS.getDisplayName() == null ? \"unknown\" : guestOS.getDisplayName());\n         } else {\n             to.setPlatformEmulator(guestOsMapping.getGuestOsName());\n         }\n"}}, {"oid": "d6fae5afbc6d147da81d6f186c5744b6110a520b", "url": "https://github.com/apache/cloudstack/commit/d6fae5afbc6d147da81d6f186c5744b6110a520b", "message": "fall back if null", "committedDate": "2020-02-14T15:24:43Z", "type": "commit"}, {"oid": "8d69839e6b20ccf056e13b291df286c934bbc7f8", "url": "https://github.com/apache/cloudstack/commit/8d69839e6b20ccf056e13b291df286c934bbc7f8", "message": "use Other instead unknown", "committedDate": "2020-02-14T16:57:01Z", "type": "commit"}]}