{"pr_number": 4501, "pr_title": "Disallowing udp for lb rules for haproxy", "pr_createdAt": "2020-11-24T05:57:10Z", "pr_url": "https://github.com/apache/cloudstack/pull/4501", "timeline": [{"oid": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "url": "https://github.com/apache/cloudstack/commit/a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "message": "Disallowing udp for lb rules", "committedDate": "2020-11-24T05:53:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE5ODA1MQ==", "url": "https://github.com/apache/cloudstack/pull/4501#discussion_r530198051", "bodyText": "@davidjumani as far as I remember, 'ssl' is also a valid protocol", "author": "weizhouapache", "createdAt": "2020-11-25T08:48:01Z", "path": "api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java", "diffHunk": "@@ -255,6 +255,12 @@ public Boolean getOpenFirewall() {\n     }\n \n     public String getLbProtocol() {\n+        if (lbProtocol != null) {\n+            lbProtocol = lbProtocol.toLowerCase();\n+            if (!lbProtocol.equals(NetUtils.TCP_PROTO) && !lbProtocol.equals(NetUtils.TCP_PROXY_PROTO)) {\n+                throw new InvalidParameterValueException(\"Invalid protocool. Supported protocols are tcp and tcp-proxy\");", "originalCommit": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e23537bac50f9fbf038c5d966e0506fac5713082", "chunk": "diff --git a/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java b/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\nindex b9e3642974..53273fe1d1 100644\n--- a/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\n+++ b/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\n\n@@ -255,12 +255,6 @@ public class CreateLoadBalancerRuleCmd extends BaseAsyncCreateCmd /*implements L\n     }\n \n     public String getLbProtocol() {\n-        if (lbProtocol != null) {\n-            lbProtocol = lbProtocol.toLowerCase();\n-            if (!lbProtocol.equals(NetUtils.TCP_PROTO) && !lbProtocol.equals(NetUtils.TCP_PROXY_PROTO)) {\n-                throw new InvalidParameterValueException(\"Invalid protocool. Supported protocols are tcp and tcp-proxy\");\n-            }\n-        }\n         return lbProtocol;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE5OTE4MQ==", "url": "https://github.com/apache/cloudstack/pull/4501#discussion_r530199181", "bodyText": "@davidjumani might 'udp' be supportd by some lb hardware devices ?", "author": "weizhouapache", "createdAt": "2020-11-25T08:49:46Z", "path": "api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java", "diffHunk": "@@ -114,7 +114,7 @@\n         + \"rule will be created for. Required when public Ip address is not associated with any Guest network yet (VPC case)\")\n     private Long networkId;\n \n-    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp, udp or tcp-proxy.\")\n+    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp or tcp-proxy.\")\n     private String lbProtocol;", "originalCommit": "a5f43014c9dded01d199d55a84fd6cdc4d10c90b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDI5Nzg4Nw==", "url": "https://github.com/apache/cloudstack/pull/4501#discussion_r530297887", "bodyText": "@weizhouapache good point, I'll move the check to the NetworkHelperImpl.java", "author": "davidjumani", "createdAt": "2020-11-25T11:19:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE5OTE4MQ=="}], "type": "inlineReview", "revised_code": {"commit": "e23537bac50f9fbf038c5d966e0506fac5713082", "chunk": "diff --git a/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java b/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\nindex b9e3642974..53273fe1d1 100644\n--- a/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\n+++ b/api/src/main/java/org/apache/cloudstack/api/command/user/loadbalancer/CreateLoadBalancerRuleCmd.java\n\n@@ -114,7 +114,7 @@ public class CreateLoadBalancerRuleCmd extends BaseAsyncCreateCmd /*implements L\n         + \"rule will be created for. Required when public Ip address is not associated with any Guest network yet (VPC case)\")\n     private Long networkId;\n \n-    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp or tcp-proxy.\")\n+    @Parameter(name = ApiConstants.PROTOCOL, type = CommandType.STRING, description = \"The protocol for the LB such as tcp, udp or tcp-proxy.\")\n     private String lbProtocol;\n \n     @Parameter(name = ApiConstants.FOR_DISPLAY, type = CommandType.BOOLEAN, description = \"an optional field, whether to the display the rule to the end user or not\", since = \"4.4\", authorized = {RoleType.Admin})\n"}}, {"oid": "e23537bac50f9fbf038c5d966e0506fac5713082", "url": "https://github.com/apache/cloudstack/commit/e23537bac50f9fbf038c5d966e0506fac5713082", "message": "Revert \"Disallowing udp for lb rules\"\n\nThis reverts commit a5f43014c9dded01d199d55a84fd6cdc4d10c90b.", "committedDate": "2020-11-26T08:53:19Z", "type": "commit"}, {"oid": "cf37c9577699868287e1e937cbad9f5cb31c07cc", "url": "https://github.com/apache/cloudstack/commit/cf37c9577699868287e1e937cbad9f5cb31c07cc", "message": "Adding check for udp rules for haproxy", "committedDate": "2020-11-26T09:06:54Z", "type": "forcePushed"}, {"oid": "bb1d68044049919dfeff93083b9c84c7779025a3", "url": "https://github.com/apache/cloudstack/commit/bb1d68044049919dfeff93083b9c84c7779025a3", "message": "Adding check for udp rules for haproxy", "committedDate": "2020-11-26T09:07:19Z", "type": "forcePushed"}, {"oid": "9fee66d2481cc7e153bafff21b3c9c44b857224a", "url": "https://github.com/apache/cloudstack/commit/9fee66d2481cc7e153bafff21b3c9c44b857224a", "message": "Adding check for udp rules for haproxy", "committedDate": "2020-11-26T09:08:27Z", "type": "commit"}, {"oid": "9fee66d2481cc7e153bafff21b3c9c44b857224a", "url": "https://github.com/apache/cloudstack/commit/9fee66d2481cc7e153bafff21b3c9c44b857224a", "message": "Adding check for udp rules for haproxy", "committedDate": "2020-11-26T09:08:27Z", "type": "forcePushed"}, {"oid": "7227685fb53f824ccb632647f39e033e4d192707", "url": "https://github.com/apache/cloudstack/commit/7227685fb53f824ccb632647f39e033e4d192707", "message": "Adding defensive check", "committedDate": "2020-11-30T05:12:31Z", "type": "commit"}]}