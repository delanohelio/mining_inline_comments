{"pr_number": 3967, "pr_title": "noVNC console integration", "pr_createdAt": "2020-03-16T06:53:57Z", "pr_url": "https://github.com/apache/cloudstack/pull/3967", "timeline": [{"oid": "49b94fc7d4558920aaaf46c09bb4cd8f97cdd518", "url": "https://github.com/apache/cloudstack/commit/49b94fc7d4558920aaaf46c09bb4cd8f97cdd518", "message": "Adding noVNC support", "committedDate": "2020-03-16T09:04:50Z", "type": "forcePushed"}, {"oid": "7aba8b170c76285c90d31d14d56024db33fc30f4", "url": "https://github.com/apache/cloudstack/commit/7aba8b170c76285c90d31d14d56024db33fc30f4", "message": "Adding noVNC support", "committedDate": "2020-03-16T09:43:20Z", "type": "forcePushed"}, {"oid": "f00aaad053d8d3371c8d6d7243d75eb0322eed00", "url": "https://github.com/apache/cloudstack/commit/f00aaad053d8d3371c8d6d7243d75eb0322eed00", "message": "Adding noVNC repo", "committedDate": "2020-03-17T09:26:57Z", "type": "commit"}, {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730", "url": "https://github.com/apache/cloudstack/commit/f246c4301a75e2e4050c09d3423dabfb7b603730", "message": "Adding support for noVNC", "committedDate": "2020-03-17T09:28:36Z", "type": "commit"}, {"oid": "f246c4301a75e2e4050c09d3423dabfb7b603730", "url": "https://github.com/apache/cloudstack/commit/f246c4301a75e2e4050c09d3423dabfb7b603730", "message": "Adding support for noVNC", "committedDate": "2020-03-17T09:28:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Mzg4MA==", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r398863880", "bodyText": "Why not using vnc.html which provides more functionalities? Briefly tested invoking it and got this extra functionalities:", "author": "nvazquez", "createdAt": "2020-03-26T20:16:42Z", "path": "server/src/main/java/com/cloud/servlet/ConsoleProxyServlet.java", "diffHunk": "@@ -478,7 +481,12 @@ private String composeConsoleAccessUrl(String rootUrl, VirtualMachine vm, HostVO\n             param.setClientTunnelSession(parsedHostInfo.third());\n         }\n \n-        sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        if (param.getHypervHost() != null || !ConsoleProxyManager.NoVncConsoleDefault.value()) {\n+            sb.append(\"/ajax?token=\" + encryptor.encryptObject(ConsoleProxyClientParam.class, param));\n+        } else {\n+            sb.append(\"/resource/noVNC/vnc_lite.html?port=\" + ConsoleProxyManager.DEFAULT_NOVNC_PORT + \"&token=\"", "originalCommit": "f246c4301a75e2e4050c09d3423dabfb7b603730", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1MzE5MQ==", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r399053191", "bodyText": "Wanted a simpler, minimalist UI, can add this when we get multi lingual keyboard working", "author": "davidjumani", "createdAt": "2020-03-27T06:10:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2Mzg4MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2NjA1Nw==", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r398866057", "bodyText": "I think it should be disabled by default at least until all hypervisors tested working properly", "author": "nvazquez", "createdAt": "2020-03-26T20:20:36Z", "path": "server/src/main/java/com/cloud/consoleproxy/ConsoleProxyManager.java", "diffHunk": "@@ -31,9 +33,14 @@\n     public static final int DEFAULT_PROXY_URL_PORT = 80;\n     public static final int DEFAULT_PROXY_SESSION_TIMEOUT = 300000;        // 5 minutes\n \n+    public static final int DEFAULT_NOVNC_PORT = 8080;\n+\n     public static final String ALERT_SUBJECT = \"proxy-alert\";\n     public static final String CERTIFICATE_NAME = \"CPVMCertificate\";\n \n+    public static final ConfigKey<Boolean> NoVncConsoleDefault = new ConfigKey<Boolean>(\"Advanced\", Boolean.class, \"novnc.console.default\", \"true\",\n+        \"If true, noVNC console will be default console for virtual machines\", true);", "originalCommit": "f246c4301a75e2e4050c09d3423dabfb7b603730", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTA1Mjg4Mg==", "url": "https://github.com/apache/cloudstack/pull/3967#discussion_r399052882", "bodyText": "I've tested it on KVM, VMware and Xen and it works fine!", "author": "davidjumani", "createdAt": "2020-03-27T06:08:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg2NjA1Nw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "018c4eb589d558ea07a25377cf9b925b4bff3cb5", "url": "https://github.com/apache/cloudstack/commit/018c4eb589d558ea07a25377cf9b925b4bff3cb5", "message": "Adding Ctl+Esc", "committedDate": "2020-04-14T10:54:25Z", "type": "commit"}, {"oid": "6dc14676dd8df6638c95b96808b7a82400672782", "url": "https://github.com/apache/cloudstack/commit/6dc14676dd8df6638c95b96808b7a82400672782", "message": "Removing device name from novnc header", "committedDate": "2020-05-16T20:18:12Z", "type": "commit"}]}