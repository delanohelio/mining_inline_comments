{"pr_number": 4023, "pr_title": "FIX: prevent empty sshkey name.", "pr_createdAt": "2020-04-07T15:14:39Z", "pr_url": "https://github.com/apache/cloudstack/pull/4023", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMxOTMxMw==", "url": "https://github.com/apache/cloudstack/pull/4023#discussion_r405319313", "bodyText": "can you move this validation above the validation that queries the DB above?", "author": "DaanHoogland", "createdAt": "2020-04-08T07:39:54Z", "path": "server/src/main/java/com/cloud/server/ManagementServerImpl.java", "diffHunk": "@@ -3711,6 +3711,11 @@ public SSHKeyPair createSSHKeyPair(final CreateSSHKeyPairCmd cmd) {\n         final SSHKeysHelper keys = new SSHKeysHelper(sshKeyLength.value());\n \n         final String name = cmd.getName();\n+        \n+        if (StringUtils.isBlank(name)) {\n+            throw new InvalidParameterValueException(\"Please specify a valid name for the key pair. The key name can't be empty\");\n+        }\n+        ", "originalCommit": "f6fca544a1174c5a8973bcc46df66fa35087eee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ0NDQwNg==", "url": "https://github.com/apache/cloudstack/pull/4023#discussion_r405444406", "bodyText": "Thanks for your comment. Moved it.", "author": "soreana", "createdAt": "2020-04-08T11:10:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTMxOTMxMw=="}], "type": "inlineReview", "revised_code": {"commit": "828219edd41f6f326c8c760a29a95e7229eeb6ed", "chunk": "diff --git a/server/src/main/java/com/cloud/server/ManagementServerImpl.java b/server/src/main/java/com/cloud/server/ManagementServerImpl.java\nindex c777e7e855..1ef96f225b 100644\n--- a/server/src/main/java/com/cloud/server/ManagementServerImpl.java\n+++ b/server/src/main/java/com/cloud/server/ManagementServerImpl.java\n\n@@ -3709,13 +3715,6 @@ public class ManagementServerImpl extends ManagerBase implements ManagementServe\n         }\n \n         final SSHKeysHelper keys = new SSHKeysHelper(sshKeyLength.value());\n-\n-        final String name = cmd.getName();\n-        \n-        if (StringUtils.isBlank(name)) {\n-            throw new InvalidParameterValueException(\"Please specify a valid name for the key pair. The key name can't be empty\");\n-        }\n-        \n         final String publicKey = keys.getPublicKey();\n         final String fingerprint = keys.getPublicKeyFingerPrint();\n         final String privateKey = keys.getPrivateKey();\n"}}, {"oid": "d68e3f1d200d95ef416143321332bff18a8657e0", "url": "https://github.com/apache/cloudstack/commit/d68e3f1d200d95ef416143321332bff18a8657e0", "message": "FIX: prevent empty sshkey name.", "committedDate": "2020-04-08T08:21:44Z", "type": "commit"}, {"oid": "828219edd41f6f326c8c760a29a95e7229eeb6ed", "url": "https://github.com/apache/cloudstack/commit/828219edd41f6f326c8c760a29a95e7229eeb6ed", "message": "Move sshKeyName check before database access.", "committedDate": "2020-04-08T11:07:39Z", "type": "commit"}]}