{"pr_number": 3851, "pr_title": "vpc: set traffic type of private gateway IP to Public to fix keepalived misconfiguration", "pr_createdAt": "2020-01-29T13:29:15Z", "pr_url": "https://github.com/apache/cloudstack/pull/3851", "timeline": [{"oid": "a7c9c5212b6e42557d88cc18f755267c55a6c699", "url": "https://github.com/apache/cloudstack/commit/a7c9c5212b6e42557d88cc18f755267c55a6c699", "message": "vpc: set traffic type of private gateway IP to Public to fix keepalived misconfiguration", "committedDate": "2020-01-29T13:28:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExOTEzNA==", "url": "https://github.com/apache/cloudstack/pull/3851#discussion_r373119134", "bodyText": "@ustcweizhou what do you think of adding also the network name? Sometimes it annoys me to see a lot of IDs on the log and then go after a few selects to understand what is really going on.\nHaving the network ID and name would be great for debugging :-)", "author": "GabrielBrascher", "createdAt": "2020-01-30T18:31:26Z", "path": "server/src/main/java/com/cloud/network/router/CommandSetupHelper.java", "diffHunk": "@@ -1101,4 +1105,14 @@ protected String getGuestDhcpRange(final NicProfile guestNic, final Network gues\n         }\n         return dhcpRange;\n     }\n+\n+    private TrafficType getNetworkTrafficType(Network network) {\n+        final VpcGatewayVO gateway = _vpcGatewayDao.getVpcGatewayByNetworkId(network.getId());\n+        if (gateway != null) {\n+            s_logger.debug(\"network \" + network.getId() + \" is a vpc private gateway, set traffic type to Public\");", "originalCommit": "a7c9c5212b6e42557d88cc18f755267c55a6c699", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE1OTE2NQ==", "url": "https://github.com/apache/cloudstack/pull/3851#discussion_r373159165", "bodyText": "@GabrielBrascher added a new commit per your comment.", "author": "weizhouapache", "createdAt": "2020-01-30T19:50:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExOTEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "15ed0d94a9274ef0143f6b93950d39ed0e671c59", "chunk": "diff --git a/server/src/main/java/com/cloud/network/router/CommandSetupHelper.java b/server/src/main/java/com/cloud/network/router/CommandSetupHelper.java\nindex 1c20d0fddd..0fe9dc32c8 100644\n--- a/server/src/main/java/com/cloud/network/router/CommandSetupHelper.java\n+++ b/server/src/main/java/com/cloud/network/router/CommandSetupHelper.java\n\n@@ -1109,7 +1109,7 @@ public class CommandSetupHelper {\n     private TrafficType getNetworkTrafficType(Network network) {\n         final VpcGatewayVO gateway = _vpcGatewayDao.getVpcGatewayByNetworkId(network.getId());\n         if (gateway != null) {\n-            s_logger.debug(\"network \" + network.getId() + \" is a vpc private gateway, set traffic type to Public\");\n+            s_logger.debug(\"network \" + network.getId() + \" (name: \" + network.getName() + \" ) is a vpc private gateway, set traffic type to Public\");\n             return TrafficType.Public;\n         } else {\n             return network.getTrafficType();\n"}}, {"oid": "15ed0d94a9274ef0143f6b93950d39ed0e671c59", "url": "https://github.com/apache/cloudstack/commit/15ed0d94a9274ef0143f6b93950d39ed0e671c59", "message": "Add network name in debugging log", "committedDate": "2020-01-30T19:48:37Z", "type": "commit"}]}