{"pr_number": 1769, "pr_title": "DBZ-2464 Fix intermittent failures with FieldRenamesIT", "pr_createdAt": "2020-08-28T19:22:56Z", "pr_url": "https://github.com/debezium/debezium/pull/1769", "timeline": [{"oid": "08d578b5f9b05cf920efc717d00f1e52bd45454b", "url": "https://github.com/debezium/debezium/commit/08d578b5f9b05cf920efc717d00f1e52bd45454b", "message": "DBZ-2464 Fix intermittent failures with FieldRenamesIT", "committedDate": "2020-08-28T19:22:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3Mjc2OQ==", "url": "https://github.com/debezium/debezium/pull/1769#discussion_r479872769", "bodyText": "@Naros Thanks, I wonder if it makes sense to introduce io.debezium.connector.postgresql.TestHelper.waitTimeForRecords() for MongoDB as well and make it multiplication of the standard wait time instead of hardcoded constant.", "author": "jpechane", "createdAt": "2020-08-31T03:44:56Z", "path": "debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/FieldRenamesIT.java", "diffHunk": "@@ -1485,10 +1489,17 @@ private SourceRecord getUpdateRecord(String database, String collection, String\n     }\n \n     private void assertDocumentContainsFieldError(String fieldName) {\n-        stopConnector(value -> {\n-            final String message = \"IllegalArgumentException: Document already contains field : \" + fieldName;\n-            assertThat(logInterceptor.containsStacktraceElement(message)).isTrue();\n-        });\n+        final String message = \"IllegalArgumentException: Document already contains field : \" + fieldName;\n+        try {\n+            Awaitility.await().atMost(Duration.ofSeconds(30))", "originalCommit": "08d578b5f9b05cf920efc717d00f1e52bd45454b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NTU0NQ==", "url": "https://github.com/debezium/debezium/pull/1769#discussion_r480195545", "bodyText": "That makes sense, I'll add that and resync the PR.", "author": "Naros", "createdAt": "2020-08-31T15:10:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg3Mjc2OQ=="}], "type": "inlineReview", "revised_code": {"commit": "d8e509d338437dc5126e03e54e354c66503c2345", "chunk": "diff --git a/debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/FieldRenamesIT.java b/debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/FieldRenamesIT.java\nindex 8ab527530..038d3fc6f 100644\n--- a/debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/FieldRenamesIT.java\n+++ b/debezium-connector-mongodb/src/test/java/io/debezium/connector/mongodb/FieldRenamesIT.java\n\n@@ -1491,7 +1491,7 @@ private SourceRecord getUpdateRecord(String database, String collection, String\n     private void assertDocumentContainsFieldError(String fieldName) {\n         final String message = \"IllegalArgumentException: Document already contains field : \" + fieldName;\n         try {\n-            Awaitility.await().atMost(Duration.ofSeconds(30))\n+            Awaitility.await().atMost(Duration.ofSeconds(TestHelper.waitTimeForRecords() * 15))\n                     .until(() -> logInterceptor.containsStacktraceElement(message));\n         }\n         catch (ConditionTimeoutException e) {\n"}}, {"oid": "d8e509d338437dc5126e03e54e354c66503c2345", "url": "https://github.com/debezium/debezium/commit/d8e509d338437dc5126e03e54e354c66503c2345", "message": "DBZ-2464 Add debezium.test.records.waittime support", "committedDate": "2020-08-31T15:14:01Z", "type": "commit"}]}