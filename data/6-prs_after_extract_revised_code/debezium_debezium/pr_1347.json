{"pr_number": 1347, "pr_title": "DBZ-1857 Support for autorestart for embedded engine", "pr_createdAt": "2020-03-17T14:01:21Z", "pr_url": "https://github.com/debezium/debezium/pull/1347", "timeline": [{"oid": "ff1e0f1a24043aa15c22e3914ca6a426c8c711d2", "url": "https://github.com/debezium/debezium/commit/ff1e0f1a24043aa15c22e3914ca6a426c8c711d2", "message": "DBZ-1857 Support for autorestart for embedded engine", "committedDate": "2020-03-23T11:05:49Z", "type": "commit"}, {"oid": "ff1e0f1a24043aa15c22e3914ca6a426c8c711d2", "url": "https://github.com/debezium/debezium/commit/ff1e0f1a24043aa15c22e3914ca6a426c8c711d2", "message": "DBZ-1857 Support for autorestart for embedded engine", "committedDate": "2020-03-23T11:05:49Z", "type": "forcePushed"}, {"oid": "4aec59ac4c0ff4519fd7db2459d51c27ef523c43", "url": "https://github.com/debezium/debezium/commit/4aec59ac4c0ff4519fd7db2459d51c27ef523c43", "message": "DBZ-1889 Prevent Connect throttling while connection is down", "committedDate": "2020-03-23T11:40:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxNjAzMQ==", "url": "https://github.com/debezium/debezium/pull/1347#discussion_r396416031", "bodyText": "Should be Metronome#parker().", "author": "gunnarmorling", "createdAt": "2020-03-23T12:32:37Z", "path": "debezium-core/src/main/java/io/debezium/connector/common/BaseSourceTask.java", "diffHunk": "@@ -117,6 +119,10 @@ public final void start(Map<String, String> props) {\n \n         // in backoff period after a retriable exception\n         if (!started) {\n+            // WorkerSourceTask calls us immediately after we return the empty list.\n+            // This turns into a throttling so we need to make a pause before we return\n+            // the control back.\n+            Thread.sleep(PAUSE_WHEN_NOT_STARTED);", "originalCommit": "4aec59ac4c0ff4519fd7db2459d51c27ef523c43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca6e5b98dacdcdf556562aeffa383f8d2af5bf0c", "chunk": "diff --git a/debezium-core/src/main/java/io/debezium/connector/common/BaseSourceTask.java b/debezium-core/src/main/java/io/debezium/connector/common/BaseSourceTask.java\nindex a1b24cb73..a19e240c3 100644\n--- a/debezium-core/src/main/java/io/debezium/connector/common/BaseSourceTask.java\n+++ b/debezium-core/src/main/java/io/debezium/connector/common/BaseSourceTask.java\n\n@@ -122,7 +126,7 @@ public final void start(Map<String, String> props) {\n             // WorkerSourceTask calls us immediately after we return the empty list.\n             // This turns into a throttling so we need to make a pause before we return\n             // the control back.\n-            Thread.sleep(PAUSE_WHEN_NOT_STARTED);\n+            PAUSE_WHEN_NOT_STARTED.pause();\n             return Collections.emptyList();\n         }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQxNjU3Nw==", "url": "https://github.com/debezium/debezium/pull/1347#discussion_r396416577", "bodyText": "Let's log the exception on info or debug.", "author": "gunnarmorling", "createdAt": "2020-03-23T12:33:38Z", "path": "debezium-embedded/src/main/java/io/debezium/embedded/EmbeddedEngine.java", "diffHunk": "@@ -753,6 +754,11 @@ public OffsetStorageReader offsetStorageReader() {\n                                 }\n                                 break;\n                             }\n+                            catch (RetriableException e) {", "originalCommit": "4aec59ac4c0ff4519fd7db2459d51c27ef523c43", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "ca6e5b98dacdcdf556562aeffa383f8d2af5bf0c", "chunk": "diff --git a/debezium-embedded/src/main/java/io/debezium/embedded/EmbeddedEngine.java b/debezium-embedded/src/main/java/io/debezium/embedded/EmbeddedEngine.java\nindex a9322a79c..1344da042 100644\n--- a/debezium-embedded/src/main/java/io/debezium/embedded/EmbeddedEngine.java\n+++ b/debezium-embedded/src/main/java/io/debezium/embedded/EmbeddedEngine.java\n\n@@ -755,6 +755,7 @@ public OffsetStorageReader offsetStorageReader() {\n                                 break;\n                             }\n                             catch (RetriableException e) {\n+                                logger.info(\"Retrieable exception thrown, connector will be restarted\", e);\n                                 // Retriable exception should be ignored by the engine\n                                 // and no change records delivered.\n                                 // The retry is handled in io.debezium.connector.common.BaseSourceTask.poll()\n"}}, {"oid": "ca6e5b98dacdcdf556562aeffa383f8d2af5bf0c", "url": "https://github.com/debezium/debezium/commit/ca6e5b98dacdcdf556562aeffa383f8d2af5bf0c", "message": "DBZ-1889 Use parker", "committedDate": "2020-03-23T12:43:36Z", "type": "commit"}]}