{"pr_number": 1771, "pr_title": "DBZ-2396 ByteBufferConverter support converter delegation for unsupported values", "pr_createdAt": "2020-08-31T14:37:25Z", "pr_url": "https://github.com/debezium/debezium/pull/1771", "timeline": [{"oid": "42729b0ec19dc067e015955556d294b066a55980", "url": "https://github.com/debezium/debezium/commit/42729b0ec19dc067e015955556d294b066a55980", "message": "DBZ-2396 Support Converter delegation in ByteBufferConverter\n\nIn the even that the value supplied to the ByteBufferConverter\nis not supported, e.g. not BYTES, the converter should then\nsupport delegation to a configured converter.", "committedDate": "2020-09-23T14:29:33Z", "type": "commit"}, {"oid": "42729b0ec19dc067e015955556d294b066a55980", "url": "https://github.com/debezium/debezium/commit/42729b0ec19dc067e015955556d294b066a55980", "message": "DBZ-2396 Support Converter delegation in ByteBufferConverter\n\nIn the even that the value supplied to the ByteBufferConverter\nis not supported, e.g. not BYTES, the converter should then\nsupport delegation to a configured converter.", "committedDate": "2020-09-23T14:29:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4Mzk2OQ==", "url": "https://github.com/debezium/debezium/pull/1771#discussion_r493683969", "bodyText": "Could you add a test for specifying an option, e.g. include.schema set to false for the JSON converter?", "author": "gunnarmorling", "createdAt": "2020-09-23T15:25:01Z", "path": "debezium-core/src/test/java/io/debezium/converters/ByteBufferConverterTest.java", "diffHunk": "@@ -97,4 +101,35 @@ public void shouldConvertToConnectDataForNullValue() {\n         assertThat(schemaAndValue.schema()).isEqualTo(Schema.OPTIONAL_BYTES_SCHEMA);\n         assertThat(schemaAndValue.value()).isNull();\n     }\n+\n+    @Test\n+    public void shouldThrowWhenNoDelegateConverterConfigured() {\n+        try {\n+            converter.fromConnectData(TOPIC, Schema.OPTIONAL_STRING_SCHEMA, \"Hello World\");\n+            fail(\"now expected exception thrown\");\n+        }\n+        catch (Exception e) {\n+            assertThat(e).isExactlyInstanceOf(DataException.class);\n+        }\n+    }\n+\n+    @Test\n+    public void shouldConvertUsingDelegateConverter() {", "originalCommit": "42729b0ec19dc067e015955556d294b066a55980", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1dbbc348fe10a20f2f507aad192bcc47e4e4e98d", "chunk": "diff --git a/debezium-core/src/test/java/io/debezium/converters/ByteBufferConverterTest.java b/debezium-core/src/test/java/io/debezium/converters/ByteBufferConverterTest.java\nindex 72b428628..21bf843f7 100644\n--- a/debezium-core/src/test/java/io/debezium/converters/ByteBufferConverterTest.java\n+++ b/debezium-core/src/test/java/io/debezium/converters/ByteBufferConverterTest.java\n\n@@ -132,4 +134,24 @@ public void shouldConvertUsingDelegateConverter() {\n         assertThat(value.get(\"payload\")).isNotNull();\n         assertThat(value.get(\"payload\").asText()).isEqualTo(\"{\\\"message\\\": \\\"Hello World\\\"}\");\n     }\n+\n+    @Test\n+    public void shouldConvertUsingDelegateConverterWithOptions() {\n+        // Configure delegate converter\n+        final Map<String, String> config = new HashMap<>();\n+        config.put(ByteBufferConverter.DELEGATE_CONVERTER_TYPE, JsonConverter.class.getName());\n+        config.put(ByteBufferConverter.DELEGATE_CONVERTER_TYPE + \".schemas.enable\", Boolean.FALSE.toString());\n+        converter.configure(config, false);\n+\n+        byte[] data = converter.fromConnectData(TOPIC, Schema.OPTIONAL_STRING_SCHEMA, \"{\\\"message\\\": \\\"Hello World\\\"}\");\n+\n+        JsonNode value = null;\n+        try (JsonDeserializer jsonDeserializer = new JsonDeserializer()) {\n+            value = jsonDeserializer.deserialize(TOPIC, data);\n+        }\n+\n+        assertThat(value.has(\"schema\")).isFalse();\n+        assertThat(value.has(\"payload\")).isFalse();\n+        assertThat(value.asText()).isEqualTo(\"{\\\"message\\\": \\\"Hello World\\\"}\");\n+    }\n }\n"}}, {"oid": "1dbbc348fe10a20f2f507aad192bcc47e4e4e98d", "url": "https://github.com/debezium/debezium/commit/1dbbc348fe10a20f2f507aad192bcc47e4e4e98d", "message": "DBZ-2396 Suggested changes", "committedDate": "2020-09-23T20:25:59Z", "type": "commit"}, {"oid": "d5d5b76ede9626abca1c0b57c0153034811e855d", "url": "https://github.com/debezium/debezium/commit/d5d5b76ede9626abca1c0b57c0153034811e855d", "message": "DBZ-2396 Typo fixes", "committedDate": "2020-09-24T05:41:20Z", "type": "commit"}]}