{"pr_number": 10183, "pr_title": "Fix sys.servers table to not throw NPE and handle brokers/indexers/peons properly for broadcast segments", "pr_createdAt": "2020-07-14T02:24:04Z", "pr_url": "https://github.com/apache/druid/pull/10183", "timeline": [{"oid": "8fed41cd765025749139092fb78a5d58104d5bf5", "url": "https://github.com/apache/druid/commit/8fed41cd765025749139092fb78a5d58104d5bf5", "message": "Fix sys.servers table to not throw NPE and handle brokers/indexers/peons properly for broadcast segments", "committedDate": "2020-07-14T02:17:23Z", "type": "commit"}, {"oid": "9ebe45f5f24deeca7fffd6d414da6dfaf84f21ff", "url": "https://github.com/apache/druid/commit/9ebe45f5f24deeca7fffd6d414da6dfaf84f21ff", "message": "fix tests and add missing tests", "committedDate": "2020-07-14T18:14:52Z", "type": "commit"}, {"oid": "3cc0d5395fdc32ad0593c6488dd355b62b380346", "url": "https://github.com/apache/druid/commit/3cc0d5395fdc32ad0593c6488dd355b62b380346", "message": "revert null handling fix", "committedDate": "2020-07-16T02:02:27Z", "type": "commit"}, {"oid": "b03d206425cef5e697d2b22b185c84470bea50e0", "url": "https://github.com/apache/druid/commit/b03d206425cef5e697d2b22b185c84470bea50e0", "message": "unused import", "committedDate": "2020-07-16T03:21:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY3Nzc1Mg==", "url": "https://github.com/apache/druid/pull/10183#discussion_r457677752", "bodyText": "should this precondition check isDiscoverableDataServer?", "author": "clintropolis", "createdAt": "2020-07-20T20:38:57Z", "path": "server/src/main/java/org/apache/druid/discovery/DiscoveryDruidNode.java", "diffHunk": "@@ -80,6 +84,16 @@ public DruidNode getDruidNode()\n     return druidNode;\n   }\n \n+  public boolean isDiscoverableDataServer()\n+  {\n+    final DruidService druidService = services.get(DataNodeService.DISCOVERY_SERVICE_KEY);\n+    if (druidService == null) {\n+      return false;\n+    }\n+    final DataNodeService dataNodeService = (DataNodeService) druidService;\n+    return dataNodeService.isDiscoverable();\n+  }\n+\n   public DruidServer toDruidServer()\n   {\n     return new DruidServer(", "originalCommit": "b03d206425cef5e697d2b22b185c84470bea50e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc1ODUyNw==", "url": "https://github.com/apache/druid/pull/10183#discussion_r457758527", "bodyText": "Yes, it should. Looking at this and isDiscoverableDataServer closely, it seems better to have them as util methods. I moved them into static methods in ServersTable.", "author": "jihoonson", "createdAt": "2020-07-21T00:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY3Nzc1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "8e3c0436e2a81f3e7b3647edad5bb4b2d18ffa5e", "chunk": "diff --git a/server/src/main/java/org/apache/druid/discovery/DiscoveryDruidNode.java b/server/src/main/java/org/apache/druid/discovery/DiscoveryDruidNode.java\nindex 32dd04a435..ff4ee7f46e 100644\n--- a/server/src/main/java/org/apache/druid/discovery/DiscoveryDruidNode.java\n+++ b/server/src/main/java/org/apache/druid/discovery/DiscoveryDruidNode.java\n\n@@ -84,29 +83,6 @@ public class DiscoveryDruidNode\n     return druidNode;\n   }\n \n-  public boolean isDiscoverableDataServer()\n-  {\n-    final DruidService druidService = services.get(DataNodeService.DISCOVERY_SERVICE_KEY);\n-    if (druidService == null) {\n-      return false;\n-    }\n-    final DataNodeService dataNodeService = (DataNodeService) druidService;\n-    return dataNodeService.isDiscoverable();\n-  }\n-\n-  public DruidServer toDruidServer()\n-  {\n-    return new DruidServer(\n-        getDruidNode().getHostAndPortToUse(),\n-        getDruidNode().getHostAndPort(),\n-        getDruidNode().getHostAndTlsPort(),\n-        ((DataNodeService) getServices().get(DataNodeService.DISCOVERY_SERVICE_KEY)).getMaxSize(),\n-        ((DataNodeService) getServices().get(DataNodeService.DISCOVERY_SERVICE_KEY)).getType(),\n-        ((DataNodeService) getServices().get(DataNodeService.DISCOVERY_SERVICE_KEY)).getTier(),\n-        ((DataNodeService) getServices().get(DataNodeService.DISCOVERY_SERVICE_KEY)).getPriority()\n-    );\n-  }\n-\n   @Override\n   public boolean equals(Object o)\n   {\n"}}, {"oid": "8e3c0436e2a81f3e7b3647edad5bb4b2d18ffa5e", "url": "https://github.com/apache/druid/commit/8e3c0436e2a81f3e7b3647edad5bb4b2d18ffa5e", "message": "move out util methods from DiscoveryDruidNode", "committedDate": "2020-07-21T00:02:23Z", "type": "commit"}]}