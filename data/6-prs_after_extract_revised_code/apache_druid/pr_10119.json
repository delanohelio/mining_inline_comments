{"pr_number": 10119, "pr_title": "Combine InDimFilter, InFilter.", "pr_createdAt": "2020-07-01T17:13:02Z", "pr_url": "https://github.com/apache/druid/pull/10119", "timeline": [{"oid": "754bde5e4b800ad015d0dec4f2e83759b5546447", "url": "https://github.com/apache/druid/commit/754bde5e4b800ad015d0dec4f2e83759b5546447", "message": "Combine InDimFilter, InFilter.\n\nThere are two motivations:\n\n1. Ensure that when HashJoinSegmentStorageAdapter compares its Filter\n   to the original one, and it is an \"in\" type, the comparison is by\n   reference and does not need to check deep equality. This is useful\n   when the \"in\" filter is very large.\n2. Simplify things. (There isn't a great reason for the DimFilter and\n   Filter logic to be separate, and combining them reduces some\n   duplication.)", "committedDate": "2020-07-01T17:12:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMjA2NQ==", "url": "https://github.com/apache/druid/pull/10119#discussion_r465412065", "bodyText": "Imagining a future world where DimFilter and Filter are combined, in the future can we rename this to InFilter instead of InDimFilter and drop all the DimFilter terminology?\nIs the place where the DimFilter implementations live org.apache.druid.query.filter more appropriate packaging than the place where the Filter implementations live org.apache.druid.segment.filter?", "author": "clintropolis", "createdAt": "2020-08-05T01:02:16Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -56,12 +69,14 @@\n import java.util.Collection;\n import java.util.Comparator;\n import java.util.HashSet;\n+import java.util.Iterator;\n import java.util.List;\n+import java.util.Map;\n import java.util.Objects;\n import java.util.Set;\n import java.util.stream.Collectors;\n \n-public class InDimFilter implements DimFilter\n+public class InDimFilter implements DimFilter, Filter", "originalCommit": "754bde5e4b800ad015d0dec4f2e83759b5546447", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjA3NTA1MQ==", "url": "https://github.com/apache/druid/pull/10119#discussion_r466075051", "bodyText": "Imagining a future world where DimFilter and Filter are combined, in the future can we rename this to InFilter instead of InDimFilter and drop all the DimFilter terminology?\n\nI think that would be best, yes.\n\nIs the place where the DimFilter implementations live org.apache.druid.query.filter more appropriate packaging than the place where the Filter implementations live org.apache.druid.segment.filter?\n\nI think you could argue for either one. Just from looking at them, it seems like most other stuff that mixes Jackson API and implementation lives in org.apache.druid.query.", "author": "gianm", "createdAt": "2020-08-06T00:23:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQxMjA2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "983e19f0d2daf926c1276959cb397671aca1baa9", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex 412d8d9a92..8e13cf1cf5 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -76,7 +76,7 @@ import java.util.Objects;\n import java.util.Set;\n import java.util.stream.Collectors;\n \n-public class InDimFilter implements DimFilter, Filter\n+public class InDimFilter extends AbstractOptimizableDimFilter implements Filter\n {\n   // determined through benchmark that binary search on long[] is faster than HashSet until ~16 elements\n   // Hashing threshold is not applied to String for now, String still uses ImmutableSortedSet\n"}}, {"oid": "983e19f0d2daf926c1276959cb397671aca1baa9", "url": "https://github.com/apache/druid/commit/983e19f0d2daf926c1276959cb397671aca1baa9", "message": "Merge branch 'master' into fix-comment-and-cache-in-filter", "committedDate": "2020-08-05T22:44:25Z", "type": "commit"}, {"oid": "8ac3470059c639250a046efb6493c93be80365ae", "url": "https://github.com/apache/druid/commit/8ac3470059c639250a046efb6493c93be80365ae", "message": "Fix test.", "committedDate": "2020-08-06T08:01:07Z", "type": "commit"}]}