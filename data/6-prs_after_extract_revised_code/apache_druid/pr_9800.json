{"pr_number": 9800, "pr_title": "Avoid sorting values in InDimFilter if possible", "pr_createdAt": "2020-04-30T07:34:15Z", "pr_url": "https://github.com/apache/druid/pull/9800", "timeline": [{"oid": "76aa704cd4d6ffa50eb4c5a2a4f3794488dcba6f", "url": "https://github.com/apache/druid/commit/76aa704cd4d6ffa50eb4c5a2a4f3794488dcba6f", "message": "Avoid sorting values in InDimFilter if possible", "committedDate": "2020-04-30T07:15:21Z", "type": "commit"}, {"oid": "18991e14681dfb0d6b1120ef493bd99b4bcee7bc", "url": "https://github.com/apache/druid/commit/18991e14681dfb0d6b1120ef493bd99b4bcee7bc", "message": "tests", "committedDate": "2020-04-30T07:29:30Z", "type": "commit"}, {"oid": "0346843569f9bc23169696a1718c0c3b25a9d481", "url": "https://github.com/apache/druid/commit/0346843569f9bc23169696a1718c0c3b25a9d481", "message": "more tests", "committedDate": "2020-04-30T07:33:41Z", "type": "commit"}, {"oid": "4d6e7a5cbdd370eed0650a8c0ce20ce96101d5d5", "url": "https://github.com/apache/druid/commit/4d6e7a5cbdd370eed0650a8c0ce20ce96101d5d5", "message": "fix and and or filters", "committedDate": "2020-04-30T17:29:05Z", "type": "commit"}, {"oid": "e97ce94d189bdbe5d61cb4fd5378f73a08f1e323", "url": "https://github.com/apache/druid/commit/e97ce94d189bdbe5d61cb4fd5378f73a08f1e323", "message": "fix build", "committedDate": "2020-04-30T18:40:43Z", "type": "commit"}, {"oid": "2e40df19324f958acff7f03c01a1f852e2926018", "url": "https://github.com/apache/druid/commit/2e40df19324f958acff7f03c01a1f852e2926018", "message": "false and true vector matchers", "committedDate": "2020-05-01T00:03:22Z", "type": "commit"}, {"oid": "d1f3d171230faf538da88d060e12e68ec91a7427", "url": "https://github.com/apache/druid/commit/d1f3d171230faf538da88d060e12e68ec91a7427", "message": "fix vector matchers", "committedDate": "2020-05-01T01:02:15Z", "type": "commit"}, {"oid": "e4e4590ac2feffddaf917bfaef7eb36a17f97d7b", "url": "https://github.com/apache/druid/commit/e4e4590ac2feffddaf917bfaef7eb36a17f97d7b", "message": "checkstyle", "committedDate": "2020-05-01T01:36:42Z", "type": "commit"}, {"oid": "07cbeff02c36dab31fc90cf5dd5eb5b75041f69d", "url": "https://github.com/apache/druid/commit/07cbeff02c36dab31fc90cf5dd5eb5b75041f69d", "message": "in filter null handling", "committedDate": "2020-05-01T04:04:54Z", "type": "commit"}, {"oid": "5e67d9cb7bd60bf9d36104371e45c0f97968b285", "url": "https://github.com/apache/druid/commit/5e67d9cb7bd60bf9d36104371e45c0f97968b285", "message": "remove wrong test", "committedDate": "2020-05-01T04:22:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxMjE4OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419212188", "bodyText": "I don't think we have any usages right now where this would be an issue, but maybe it's good to have a comment somewhere noting that the set passed in to InDimFilter shouldn't be modified afterwards since it can be reused", "author": "jon-wei", "createdAt": "2020-05-04T04:48:20Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -84,9 +90,11 @@ public InDimFilter(\n     Preconditions.checkNotNull(dimension, \"dimension can not be null\");\n     Preconditions.checkArgument(values != null, \"values can not be null\");\n \n-    this.values = new TreeSet<>(Comparators.naturalNullsFirst());\n-    for (String value : values) {\n-      this.values.add(NullHandling.emptyToNullIfNeeded(value));\n+    // The values set can be huge. Try to avoid copying the set if possible.\n+    if (values instanceof Set && values.stream().noneMatch(NullHandling::needsEmptyToNull)) {\n+      this.values = (Set<String>) values;", "originalCommit": "5e67d9cb7bd60bf9d36104371e45c0f97968b285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYwNDA1MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419604051", "bodyText": "Added a comment on the constructor.", "author": "jihoonson", "createdAt": "2020-05-04T17:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxMjE4OA=="}], "type": "inlineReview", "revised_code": {"commit": "ef6938d5844818e6a388b4cb4471b2ef18648dbf", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex 9fb72dbe8e..b1f4742565 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -91,7 +93,8 @@ public class InDimFilter implements DimFilter\n     Preconditions.checkArgument(values != null, \"values can not be null\");\n \n     // The values set can be huge. Try to avoid copying the set if possible.\n-    if (values instanceof Set && values.stream().noneMatch(NullHandling::needsEmptyToNull)) {\n+    if (values instanceof Set\n+        && (NullHandling.sqlCompatible() || values.stream().noneMatch(NullHandling::needsEmptyToNull))) {\n       this.values = (Set<String>) values;\n     } else {\n       this.values = values.stream().map(NullHandling::emptyToNullIfNeeded).collect(Collectors.toSet());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxNDczNA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419214734", "bodyText": "If values is a set, I think you could determine hasNull beforehand if you've already scanned values for empty/nulls, and avoid scanning again", "author": "jon-wei", "createdAt": "2020-05-04T05:03:00Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -132,31 +141,43 @@ public FilterTuning getFilterTuning()\n   @Override\n   public byte[] getCacheKey()\n   {\n-    boolean hasNull = false;\n-    for (String value : values) {\n-      if (value == null) {\n-        hasNull = true;\n-        break;\n-      }\n+    if (cacheKey == null) {\n+      final boolean hasNull = values.stream().anyMatch(Objects::isNull);", "originalCommit": "5e67d9cb7bd60bf9d36104371e45c0f97968b285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYxMzQ4Nw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419613487", "bodyText": "Hmm, this value doesn't seem necessary. Removed and added a unit test for it", "author": "jihoonson", "createdAt": "2020-05-04T17:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxNDczNA=="}], "type": "inlineReview", "revised_code": {"commit": "ef6938d5844818e6a388b4cb4471b2ef18648dbf", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex 9fb72dbe8e..b1f4742565 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -142,17 +145,18 @@ public class InDimFilter implements DimFilter\n   public byte[] getCacheKey()\n   {\n     if (cacheKey == null) {\n-      final boolean hasNull = values.stream().anyMatch(Objects::isNull);\n       final List<String> sortedValues = new ArrayList<>(values);\n       Collections.sort(sortedValues);\n       final Hasher hasher = Hashing.sha256().newHasher();\n-      sortedValues.forEach(v -> {\n+      boolean hasNull = false;\n+      for (String v : sortedValues) {\n         if (v == null) {\n+          hasNull = true;\n           hasher.putInt(0);\n         } else {\n           hasher.putString(v, StandardCharsets.UTF_8);\n         }\n-      });\n+      }\n       cacheKey = new CacheKeyBuilder(DimFilterUtils.IN_CACHE_ID)\n           .appendString(dimension)\n           .appendByte(DimFilterUtils.STRING_SEPARATOR)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxNTcwMg==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419215702", "bodyText": "If NullHandling.replaceWithDefault() returns false, I think you can skip the scan here and just reuse the set", "author": "jon-wei", "createdAt": "2020-05-04T05:08:51Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -84,9 +90,11 @@ public InDimFilter(\n     Preconditions.checkNotNull(dimension, \"dimension can not be null\");\n     Preconditions.checkArgument(values != null, \"values can not be null\");\n \n-    this.values = new TreeSet<>(Comparators.naturalNullsFirst());\n-    for (String value : values) {\n-      this.values.add(NullHandling.emptyToNullIfNeeded(value));\n+    // The values set can be huge. Try to avoid copying the set if possible.\n+    if (values instanceof Set && values.stream().noneMatch(NullHandling::needsEmptyToNull)) {", "originalCommit": "5e67d9cb7bd60bf9d36104371e45c0f97968b285", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTYwNDgzNQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419604835", "bodyText": "Good point. Added a check for it.", "author": "jihoonson", "createdAt": "2020-05-04T17:31:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTIxNTcwMg=="}], "type": "inlineReview", "revised_code": {"commit": "ef6938d5844818e6a388b4cb4471b2ef18648dbf", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex 9fb72dbe8e..b1f4742565 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -91,7 +93,8 @@ public class InDimFilter implements DimFilter\n     Preconditions.checkArgument(values != null, \"values can not be null\");\n \n     // The values set can be huge. Try to avoid copying the set if possible.\n-    if (values instanceof Set && values.stream().noneMatch(NullHandling::needsEmptyToNull)) {\n+    if (values instanceof Set\n+        && (NullHandling.sqlCompatible() || values.stream().noneMatch(NullHandling::needsEmptyToNull))) {\n       this.values = (Set<String>) values;\n     } else {\n       this.values = values.stream().map(NullHandling::emptyToNullIfNeeded).collect(Collectors.toSet());\n"}}, {"oid": "ef6938d5844818e6a388b4cb4471b2ef18648dbf", "url": "https://github.com/apache/druid/commit/ef6938d5844818e6a388b4cb4471b2ef18648dbf", "message": "address comments", "committedDate": "2020-05-04T17:30:14Z", "type": "commit"}, {"oid": "9ce40f929347443c17ca15a3143f40417ce5324c", "url": "https://github.com/apache/druid/commit/9ce40f929347443c17ca15a3143f40417ce5324c", "message": "remove unnecessary null check", "committedDate": "2020-05-04T17:42:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgwODA1OQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419808059", "bodyText": "There's an extra STRING_SEPARATOR now", "author": "jon-wei", "createdAt": "2020-05-05T00:41:25Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -132,31 +145,41 @@ public FilterTuning getFilterTuning()\n   @Override\n   public byte[] getCacheKey()\n   {\n-    boolean hasNull = false;\n-    for (String value : values) {\n-      if (value == null) {\n-        hasNull = true;\n-        break;\n+    if (cacheKey == null) {\n+      final List<String> sortedValues = new ArrayList<>(values);\n+      sortedValues.sort(Comparator.nullsFirst(Ordering.natural()));\n+      final Hasher hasher = Hashing.sha256().newHasher();\n+      for (String v : sortedValues) {\n+        if (v == null) {\n+          hasher.putInt(0);\n+        } else {\n+          hasher.putString(v, StandardCharsets.UTF_8);\n+        }\n       }\n+      cacheKey = new CacheKeyBuilder(DimFilterUtils.IN_CACHE_ID)\n+          .appendString(dimension)\n+          .appendByte(DimFilterUtils.STRING_SEPARATOR)\n+          .appendByteArray(extractionFn == null ? new byte[0] : extractionFn.getCacheKey())\n+          .appendByte(DimFilterUtils.STRING_SEPARATOR)\n+          .appendByte(DimFilterUtils.STRING_SEPARATOR)", "originalCommit": "9ce40f929347443c17ca15a3143f40417ce5324c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgxNzM5MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r419817391", "bodyText": "Oops", "author": "jihoonson", "createdAt": "2020-05-05T01:18:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgwODA1OQ=="}], "type": "inlineReview", "revised_code": {"commit": "f033ccbcd24bab9781e88609f5f77933031a5007", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex 6f6ad7e8a2..d7cf0572e3 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -161,7 +161,6 @@ public class InDimFilter implements DimFilter\n           .appendByte(DimFilterUtils.STRING_SEPARATOR)\n           .appendByteArray(extractionFn == null ? new byte[0] : extractionFn.getCacheKey())\n           .appendByte(DimFilterUtils.STRING_SEPARATOR)\n-          .appendByte(DimFilterUtils.STRING_SEPARATOR)\n           .appendByteArray(hasher.hash().asBytes())\n           .build();\n     }\n"}}, {"oid": "f033ccbcd24bab9781e88609f5f77933031a5007", "url": "https://github.com/apache/druid/commit/f033ccbcd24bab9781e88609f5f77933031a5007", "message": "redundant separator", "committedDate": "2020-05-05T01:18:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTc0OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420309748", "bodyText": "AndDimFilterTest is missing branch coverage for this and line 88", "author": "suneet-s", "createdAt": "2020-05-05T18:12:40Z", "path": "processing/src/main/java/org/apache/druid/query/filter/AndDimFilter.java", "diffHunk": "@@ -72,8 +73,20 @@ public AndDimFilter(DimFilter... fields)\n   @Override\n   public DimFilter optimize()\n   {\n-    List<DimFilter> elements = DimFilters.optimize(fields);\n-    return elements.size() == 1 ? elements.get(0) : new AndDimFilter(elements);\n+    List<DimFilter> elements = DimFilters.optimize(fields)\n+                                         .stream()\n+                                         .filter(filter -> !(filter instanceof TrueDimFilter))\n+                                         .collect(Collectors.toList());\n+    if (elements.isEmpty()) {\n+      // All elements were TrueDimFilter after optimization\n+      return TrueDimFilter.instance();\n+    } else if (elements.size() == 1) {\n+      return elements.get(0);", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxOTc0Nw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420319747", "bodyText": "Looks like this code is hit by other tests in druid-processing, but I'm not sure which ones", "author": "suneet-s", "createdAt": "2020-05-05T18:29:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NDM5Mw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420344393", "bodyText": "The use of this and OrDimFilter are prevalent in unit tests so I believe they are being tested somewhere (I didn't change the logic of the lines you mentioned). But I can add some more tests.", "author": "jihoonson", "createdAt": "2020-05-05T19:11:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTQ1Ng==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421005456", "bodyText": "Added.", "author": "jihoonson", "createdAt": "2020-05-06T18:32:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMwOTc0OA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMTcwNQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420311705", "bodyText": "nit: should this be a static instance", "author": "suneet-s", "createdAt": "2020-05-05T18:16:00Z", "path": "processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.query.filter;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.google.common.collect.ImmutableRangeSet;\n+import com.google.common.collect.RangeSet;\n+import org.apache.druid.query.cache.CacheKeyBuilder;\n+import org.apache.druid.segment.filter.FalseFilter;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collections;\n+import java.util.Set;\n+\n+public class FalseDimFilter implements DimFilter\n+{\n+  private static final FalseDimFilter INSTANCE = new FalseDimFilter();\n+\n+  @JsonCreator\n+  public static FalseDimFilter instance()\n+  {\n+    return INSTANCE;\n+  }\n+\n+  private FalseDimFilter()\n+  {\n+  }\n+\n+  @Override\n+  public DimFilter optimize()\n+  {\n+    return this;\n+  }\n+\n+  @Override\n+  public Filter toFilter()\n+  {\n+    return FalseFilter.instance();\n+  }\n+\n+  @Nullable\n+  @Override\n+  public RangeSet<String> getDimensionRangeSet(String dimension)\n+  {\n+    return ImmutableRangeSet.of();\n+  }\n+\n+  @Override\n+  public Set<String> getRequiredColumns()\n+  {\n+    return Collections.emptySet();\n+  }\n+\n+  @Override\n+  public byte[] getCacheKey()\n+  {\n+    return new CacheKeyBuilder(DimFilterUtils.FALSE_CACHE_ID).build();", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NDQ5Mg==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420344492", "bodyText": "Good point. Will add it.", "author": "jihoonson", "createdAt": "2020-05-05T19:12:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMTcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTQ4Nw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421005487", "bodyText": "Done.", "author": "jihoonson", "createdAt": "2020-05-06T18:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMTcwNQ=="}], "type": "inlineReview", "revised_code": {"commit": "fe69355a87a1f7419e4b8b23b99b95d37ea8fd3c", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\nindex 7a1e854593..4b21e5eb49 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\n\n@@ -32,6 +32,7 @@ import java.util.Set;\n public class FalseDimFilter implements DimFilter\n {\n   private static final FalseDimFilter INSTANCE = new FalseDimFilter();\n+  private static final byte[] CACHE_KEY = new CacheKeyBuilder(DimFilterUtils.FALSE_CACHE_ID).build();\n \n   @JsonCreator\n   public static FalseDimFilter instance()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjQ0OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420312448", "bodyText": "EqualsVerifierTest for this?", "author": "suneet-s", "createdAt": "2020-05-05T18:17:11Z", "path": "processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.query.filter;\n+\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+import com.google.common.collect.ImmutableRangeSet;\n+import com.google.common.collect.RangeSet;\n+import org.apache.druid.query.cache.CacheKeyBuilder;\n+import org.apache.druid.segment.filter.FalseFilter;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collections;\n+import java.util.Set;\n+\n+public class FalseDimFilter implements DimFilter\n+{\n+  private static final FalseDimFilter INSTANCE = new FalseDimFilter();\n+\n+  @JsonCreator\n+  public static FalseDimFilter instance()\n+  {\n+    return INSTANCE;\n+  }\n+\n+  private FalseDimFilter()\n+  {\n+  }\n+\n+  @Override\n+  public DimFilter optimize()\n+  {\n+    return this;\n+  }\n+\n+  @Override\n+  public Filter toFilter()\n+  {\n+    return FalseFilter.instance();\n+  }\n+\n+  @Nullable\n+  @Override\n+  public RangeSet<String> getDimensionRangeSet(String dimension)\n+  {\n+    return ImmutableRangeSet.of();\n+  }\n+\n+  @Override\n+  public Set<String> getRequiredColumns()\n+  {\n+    return Collections.emptySet();\n+  }\n+\n+  @Override\n+  public byte[] getCacheKey()\n+  {\n+    return new CacheKeyBuilder(DimFilterUtils.FALSE_CACHE_ID).build();\n+  }\n+\n+  @Override\n+  public int hashCode()\n+  {\n+    return DimFilterUtils.FALSE_CACHE_ID;\n+  }\n+\n+  @Override\n+  public boolean equals(Object o)\n+  {\n+    return o == this;\n+  }", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NDU1NA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420344554", "bodyText": "\ud83d\udc4d", "author": "jihoonson", "createdAt": "2020-05-05T19:12:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjQ0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTUyNA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421005524", "bodyText": "Done.", "author": "jihoonson", "createdAt": "2020-05-06T18:32:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxMjQ0OA=="}], "type": "inlineReview", "revised_code": {"commit": "fe69355a87a1f7419e4b8b23b99b95d37ea8fd3c", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\nindex 7a1e854593..4b21e5eb49 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/FalseDimFilter.java\n\n@@ -32,6 +32,7 @@ import java.util.Set;\n public class FalseDimFilter implements DimFilter\n {\n   private static final FalseDimFilter INSTANCE = new FalseDimFilter();\n+  private static final byte[] CACHE_KEY = new CacheKeyBuilder(DimFilterUtils.FALSE_CACHE_ID).build();\n \n   @JsonCreator\n   public static FalseDimFilter instance()\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxOTM5MA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420319390", "bodyText": "Can we pass in a Set<String> instead of Collection<String> so jackson can do the de-dupe for us?", "author": "suneet-s", "createdAt": "2020-05-05T18:28:45Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -73,9 +77,14 @@\n   private final Supplier<DruidFloatPredicate> floatPredicateSupplier;\n   private final Supplier<DruidDoublePredicate> doublePredicateSupplier;\n \n+  @JsonIgnore\n+  private byte[] cacheKey;\n+\n   @JsonCreator\n   public InDimFilter(\n       @JsonProperty(\"dimension\") String dimension,\n+      // This 'values' collection instance can be reused if possible to avoid copying a big collection.\n+      // Callers should _not_ modify the collection after it is passed to this constructor.\n       @JsonProperty(\"values\") Collection<String> values,", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NTIyNQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420345225", "bodyText": "To be honest, I was lazy and haven't checked how many callers call this constructor before. It seems small enough, I guess I can.", "author": "jihoonson", "createdAt": "2020-05-05T19:13:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxOTM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTU1OQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421005559", "bodyText": "Done.", "author": "jihoonson", "createdAt": "2020-05-06T18:32:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMxOTM5MA=="}], "type": "inlineReview", "revised_code": {"commit": "fe69355a87a1f7419e4b8b23b99b95d37ea8fd3c", "chunk": "diff --git a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\nindex d7cf0572e3..a82f71a52e 100644\n--- a/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n+++ b/processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java\n\n@@ -85,7 +86,7 @@ public class InDimFilter implements DimFilter\n       @JsonProperty(\"dimension\") String dimension,\n       // This 'values' collection instance can be reused if possible to avoid copying a big collection.\n       // Callers should _not_ modify the collection after it is passed to this constructor.\n-      @JsonProperty(\"values\") Collection<String> values,\n+      @JsonProperty(\"values\") Set<String> values,\n       @JsonProperty(\"extractionFn\") @Nullable ExtractionFn extractionFn,\n       @JsonProperty(\"filterTuning\") @Nullable FilterTuning filterTuning\n   )\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyNzk0MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420327941", "bodyText": "Does this negate your comment on line 96?\nWe'd be copying all the values here to a list so that we can sort the list.", "author": "suneet-s", "createdAt": "2020-05-05T18:43:06Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -132,31 +145,40 @@ public FilterTuning getFilterTuning()\n   @Override\n   public byte[] getCacheKey()\n   {\n-    boolean hasNull = false;\n-    for (String value : values) {\n-      if (value == null) {\n-        hasNull = true;\n-        break;\n+    if (cacheKey == null) {\n+      final List<String> sortedValues = new ArrayList<>(values);", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzOTkzMA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420339930", "bodyText": "This method is not called if populateCache = false and useCache = false. Will add some comments about it.", "author": "jihoonson", "createdAt": "2020-05-05T19:03:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyNzk0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNTYxMg==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421005612", "bodyText": "Added.", "author": "jihoonson", "createdAt": "2020-05-06T18:32:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyNzk0MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyOTE3MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420329171", "bodyText": "Can multiple threads call getCacheKey at the same time?\nWhat happens if 2 threads try to build sortedValues?", "author": "suneet-s", "createdAt": "2020-05-05T18:45:01Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -132,31 +145,40 @@ public FilterTuning getFilterTuning()\n   @Override\n   public byte[] getCacheKey()\n   {", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0MDQ4NQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420340485", "bodyText": "All DimFilters are not thread-safe. It should be never called by two threads at the same time.", "author": "jihoonson", "createdAt": "2020-05-05T19:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMyOTE3MQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420331727", "bodyText": "Why did you choose a sha256 hasher? Is it fast to construct a new hasher? or to perform a sha256 hash?\nI wrote a test here which fails to produce the same cacheKey even though the values are sorted\n@Test\n  public void testCacheKey()\n  {\n    final InDimFilter dimFilter1 = new InDimFilter(\"dim\", ImmutableList.of(\"v1\", \"v2\", \"v3\"), null);\n    final InDimFilter dimFilter2 = new InDimFilter(\"dim\", ImmutableList.of(\"v3\", \"v2\", \"v1\"), null);\n    Assert.assertEquals(dimFilter1.getCacheKey(), dimFilter2.getCacheKey());\n  }", "author": "suneet-s", "createdAt": "2020-05-05T18:49:18Z", "path": "processing/src/main/java/org/apache/druid/query/filter/InDimFilter.java", "diffHunk": "@@ -132,31 +145,40 @@ public FilterTuning getFilterTuning()\n   @Override\n   public byte[] getCacheKey()\n   {\n-    boolean hasNull = false;\n-    for (String value : values) {\n-      if (value == null) {\n-        hasNull = true;\n-        break;\n+    if (cacheKey == null) {\n+      final List<String> sortedValues = new ArrayList<>(values);\n+      sortedValues.sort(Comparator.nullsFirst(Ordering.natural()));\n+      final Hasher hasher = Hashing.sha256().newHasher();", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0MTk2OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420341968", "bodyText": "Sorry about the false alarm. I just realized it's failing because we're comparing 2 byte arrays, but they are in fact equivalent\n  @Test\n  public void testCacheKey()\n  {\n    final InDimFilter dimFilter1 = new InDimFilter(\"dim\", ImmutableList.of(\"v1\", \"v2\", \"v3\"), null);\n    final InDimFilter dimFilter2 = new InDimFilter(\"dim\", ImmutableList.of(\"v3\", \"v2\", \"v1\"), null);\n    byte[] cacheKey1 = dimFilter1.getCacheKey();\n    byte[] cacheKey2 = dimFilter2.getCacheKey();\n    Assert.assertEquals(Arrays.toString(cacheKey1), Arrays.toString(cacheKey2));\n  }", "author": "suneet-s", "createdAt": "2020-05-05T19:07:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0Mjc0MA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420342740", "bodyText": "I believe your test will pass if you use Assert.assertArrayEquals() (getCacheKey() returns a byte array).\n\nWhy did you choose a sha256 hasher? Is it fast to construct a new hasher? or to perform a sha256 hash?\n\nI chose sha256 since it is long enough to distinguish different values sets even though I haven't really tested. I will do some tests.", "author": "jihoonson", "createdAt": "2020-05-05T19:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM0NTk1MA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420345950", "bodyText": "Oh sorry, didn't see your last comment. \ud83d\udc4d", "author": "jihoonson", "createdAt": "2020-05-05T19:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2MDg5OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420360898", "bodyText": "I chose sha256 since it is long enough to distinguish different values sets even though I haven't really tested. I will do some tests.\n\n\ud83d\udc4d\nI think a simpler solution would be to revert back to the previous way of building a cacheKey, but use .appendStringsIgnoringOrder() instead of .appendStrings() This way the sort is done once for the list and we don't add any new memory overhead from the current implementation.\nMaybe consider creating a new utility function to the CacheKeyBuilder that sorts the list and writes whether or not any nulls existed in the list. This way we can do one pass over the list of values to build the cacheKey, but even at 10k entries in the list, this might be a micro optimization.", "author": "suneet-s", "createdAt": "2020-05-05T19:41:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNjEzMw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421006133", "bodyText": "The issue with storing all values in the cacheKey is that the cache key can become huge as the size of values grows which can result in pollution in the cache.\nRegarding using SHA-256, I believe academical research is more trustable than my testing. According to the probability table, the required number of hashed elements such that probability of at least one hash collision >= 10^\u221218 is 4.8\u00d710^29 under assumption that the hash function is perfect. This is negligible when it comes to practice even though the SHA-256 hash function is not proven to be perfect.", "author": "jihoonson", "createdAt": "2020-05-06T18:33:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDMzMTcyNw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2NDU1NA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420364554", "bodyText": "Why not use the recommended resolution\nFalseDimFilter.instance().equals(optimized)", "author": "suneet-s", "createdAt": "2020-05-05T19:48:32Z", "path": "processing/src/main/java/org/apache/druid/query/filter/NotDimFilter.java", "diffHunk": "@@ -60,10 +60,17 @@ public DimFilter getField()\n     return ByteBuffer.allocate(1 + subKey.length).put(DimFilterUtils.NOT_CACHE_ID).put(subKey).array();\n   }\n \n+  @SuppressWarnings(\"ObjectEquality\")", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNjY0MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421006641", "bodyText": "Why is it better?", "author": "jihoonson", "createdAt": "2020-05-06T18:34:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2NDU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxMTU1NA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421011554", "bodyText": "This suppression is only correct as long as TrueDimFilter and FalseDimFilter are singletons. If in the future that assumption changes, this will break, and nothing will notify us of this incorrect behavior if we don't catch it in code review. That's usually why I try to limit any suppressions, because it takes a lot of reasoning power to justify why the suppression was made.\nAnyways, I'm ok with this as currently written.", "author": "suneet-s", "createdAt": "2020-05-06T18:42:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2NDU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTA2OTEzMw==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421069133", "bodyText": "Thanks. I think this is fine since I don't see any reason to change them to be not singletons in the near future. Also, we should be able to notice that this method is not valid anymore if the assumption did change because we would remove instance() methods and therefore modify this method.", "author": "jihoonson", "createdAt": "2020-05-06T20:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM2NDU1NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5NzA0Ng==", "url": "https://github.com/apache/druid/pull/9800#discussion_r420397046", "bodyText": "Should the max size / current size of these be 1 since VectorMatch.allFalse() is an empty array?\nNot really sure how the vector sizes are used", "author": "suneet-s", "createdAt": "2020-05-05T20:49:15Z", "path": "processing/src/main/java/org/apache/druid/query/filter/vector/FalseVectorMatcher.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.query.filter.vector;\n+\n+import org.apache.druid.segment.vector.VectorSizeInspector;\n+\n+public class FalseVectorMatcher implements VectorValueMatcher\n+{\n+  private final VectorSizeInspector vectorSizeInspector;\n+\n+  public FalseVectorMatcher(VectorSizeInspector vectorSizeInspector)\n+  {\n+    this.vectorSizeInspector = vectorSizeInspector;\n+  }\n+\n+  @Override\n+  public ReadableVectorMatch match(ReadableVectorMatch mask)\n+  {\n+    return VectorMatch.allFalse();\n+  }\n+\n+  @Override\n+  public int getMaxVectorSize()\n+  {\n+    return vectorSizeInspector.getMaxVectorSize();\n+  }\n+\n+  @Override\n+  public int getCurrentVectorSize()\n+  {\n+    return vectorSizeInspector.getCurrentVectorSize();\n+  }", "originalCommit": "f033ccbcd24bab9781e88609f5f77933031a5007", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAwNjI5OA==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421006298", "bodyText": "The max vector size is the maximum number of values in a column you can read per iteration. The current vector size can be different depending on the remaining number of values to read.\nThe max and current vector sizes are irrelevant to the size of backing array in VectorMatcher, although the array usually has the same size with the max vector size. The allFalse vectorMatch has an empty array because it always returns false no matter what value you evaluate in a vector.", "author": "jihoonson", "createdAt": "2020-05-06T18:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5NzA0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTAxMTk2MQ==", "url": "https://github.com/apache/druid/pull/9800#discussion_r421011961", "bodyText": "ah cool. Thanks for the explanation!", "author": "suneet-s", "createdAt": "2020-05-06T18:43:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM5NzA0Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "fe69355a87a1f7419e4b8b23b99b95d37ea8fd3c", "url": "https://github.com/apache/druid/commit/fe69355a87a1f7419e4b8b23b99b95d37ea8fd3c", "message": "address comments", "committedDate": "2020-05-06T18:32:01Z", "type": "commit"}, {"oid": "ef4f62f289185c91829b6771908f94b49b1e5a2d", "url": "https://github.com/apache/druid/commit/ef4f62f289185c91829b6771908f94b49b1e5a2d", "message": "typo", "committedDate": "2020-05-06T20:18:50Z", "type": "commit"}, {"oid": "e2dc504e1e8506d491446e0149854b30cc5a42aa", "url": "https://github.com/apache/druid/commit/e2dc504e1e8506d491446e0149854b30cc5a42aa", "message": "tests", "committedDate": "2020-05-06T21:06:08Z", "type": "commit"}]}