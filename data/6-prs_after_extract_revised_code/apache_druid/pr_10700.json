{"pr_number": 10700, "pr_title": "refactor NodeRole so extensions can participate in disco and announcement", "pr_createdAt": "2020-12-21T21:43:42Z", "pr_url": "https://github.com/apache/druid/pull/10700", "timeline": [{"oid": "ef42524a8d12ccfdc657765087ebefa4dd063d49", "url": "https://github.com/apache/druid/commit/ef42524a8d12ccfdc657765087ebefa4dd063d49", "message": "refactor NodeRole so extensions can participate in disco and announcement", "committedDate": "2020-12-21T20:08:13Z", "type": "commit"}, {"oid": "cd7f898770dfaa7c86923802af5af0f8103b0878", "url": "https://github.com/apache/druid/commit/cd7f898770dfaa7c86923802af5af0f8103b0878", "message": "fixes, maybe", "committedDate": "2020-12-22T01:20:41Z", "type": "commit"}, {"oid": "00abb926e63778733144e2e21d4621c0aeb65d1b", "url": "https://github.com/apache/druid/commit/00abb926e63778733144e2e21d4621c0aeb65d1b", "message": "Merge remote-tracking branch 'upstream/master' into disco-rework-node-role", "committedDate": "2020-12-22T08:04:59Z", "type": "commit"}, {"oid": "a18e98a2f11aff74da63bb08538d115c1a225649", "url": "https://github.com/apache/druid/commit/a18e98a2f11aff74da63bb08538d115c1a225649", "message": "retries", "committedDate": "2020-12-22T09:16:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM0MDU1NQ==", "url": "https://github.com/apache/druid/pull/10700#discussion_r548340555", "bodyText": "Please edit the javadoc:\n\nIt's no longer an enum, the the javadoc says it is.\nThe javadoc should explain the difference between \"name\" and \"jsonName\" and why they both exist.", "author": "gianm", "createdAt": "2020-12-24T01:20:54Z", "path": "server/src/main/java/org/apache/druid/discovery/NodeRole.java", "diffHunk": "@@ -31,33 +38,88 @@\n  * These abstractions can probably be merged when Druid updates to Jackson 2.9 that supports JsonAliases, see\n  * see https://github.com/apache/druid/issues/7152.\n  */\n-public enum NodeRole\n+public class NodeRole", "originalCommit": "a18e98a2f11aff74da63bb08538d115c1a225649", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM0ODQ0Mg==", "url": "https://github.com/apache/druid/pull/10700#discussion_r548348442", "bodyText": "thanks, forgot to update, should be good now", "author": "clintropolis", "createdAt": "2020-12-24T02:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODM0MDU1NQ=="}], "type": "inlineReview", "revised_code": {"commit": "3449da3bf07d80256f47db9b63ac1b95ad1e1fc0", "chunk": "diff --git a/server/src/main/java/org/apache/druid/discovery/NodeRole.java b/server/src/main/java/org/apache/druid/discovery/NodeRole.java\nindex 35e4a59892..4f0b4f118b 100644\n--- a/server/src/main/java/org/apache/druid/discovery/NodeRole.java\n+++ b/server/src/main/java/org/apache/druid/discovery/NodeRole.java\n\n@@ -29,13 +29,22 @@ import java.util.function.Function;\n import java.util.stream.Collectors;\n \n /**\n- * This is a historical occasion that this enum is different from {@link\n- * org.apache.druid.server.coordination.ServerType} (also called \"node type\" in various places) because they are\n- * essentially the same abstraction, but merging them could only increase the complexity and drop the code safety,\n- * because they name the same types differently (\"peon\" - \"indexer-executor\" and \"middleManager\" - \"realtime\") and both\n- * expose them via JSON APIs.\n+ * Defines the 'role' of a Druid service, utilized to strongly type announcement and service discovery.\n  *\n- * These abstractions can probably be merged when Druid updates to Jackson 2.9 that supports JsonAliases, see\n+ * Originally, this was an enum to add type safety for discovery and announcment purposes, but was expanded\n+ * into a class to allow for extensibility while retaining the type safety of using defined types instead of raw\n+ * strings. As such, this class tries to mimic the interface provided by the previous enum.\n+ *\n+ * Built in node roles define a {@link #name} that is distinct from {@link #jsonName}, and is the previous value\n+ * which would be used occur the enum was used in a 'toString' context. Custom node roles allow extension to participate\n+ * in announcement and discovery, but are limited to only using {@link #jsonName} for both toString and JSON serde.\n+ *\n+ * The historical context of why the enum was different from {@link org.apache.druid.server.coordination.ServerType}\n+ * (also called \"node type\" in various places) is because while they are essentially the same abstraction, merging them\n+ * could only increase the complexity and drop the code safety, because they name the same types differently\n+ * (\"peon\" - \"indexer-executor\" and \"middleManager\" - \"realtime\") and both expose them via JSON APIs.\n+ *\n+ * These abstractions can all potentially be merged when Druid updates to Jackson 2.9 that supports JsonAliases,\n  * see https://github.com/apache/druid/issues/7152.\n  */\n public class NodeRole\n"}}, {"oid": "3449da3bf07d80256f47db9b63ac1b95ad1e1fc0", "url": "https://github.com/apache/druid/commit/3449da3bf07d80256f47db9b63ac1b95ad1e1fc0", "message": "javadoc", "committedDate": "2020-12-24T01:59:00Z", "type": "commit"}, {"oid": "0b1c5d14b4528f58d27ef1bda0c33ef78eb5d0d1", "url": "https://github.com/apache/druid/commit/0b1c5d14b4528f58d27ef1bda0c33ef78eb5d0d1", "message": "fix", "committedDate": "2020-12-24T02:01:38Z", "type": "commit"}, {"oid": "6dbbe1deda1ebe499f54711a6668b35540ab8ab0", "url": "https://github.com/apache/druid/commit/6dbbe1deda1ebe499f54711a6668b35540ab8ab0", "message": "spelling", "committedDate": "2020-12-24T02:02:05Z", "type": "commit"}]}