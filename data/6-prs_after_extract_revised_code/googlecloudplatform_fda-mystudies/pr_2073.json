{"pr_number": 2073, "pr_title": "Participant Manager Datastore: Fixed Performance issue for  GET /{studyId}/participants endpoint", "pr_createdAt": "2020-11-17T15:28:03Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2073", "timeline": [{"oid": "dafd281dcc2903f786e7b2032b15728484b1ee5d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dafd281dcc2903f786e7b2032b15728484b1ee5d", "message": "Fixed Performance issue for /{studyId}/participants endpoint", "committedDate": "2020-11-17T15:26:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgwMzg5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2073#discussion_r525803899", "bodyText": "getStudyAppDetails()", "author": "saminguyen", "createdAt": "2020-11-18T04:44:26Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java", "diffHunk": "@@ -83,4 +85,39 @@\n               + \"GROUP BY study.id \",\n       nativeQuery = true)\n   public List<StudyCount> findEnrolledCountByStudyId();\n+\n+  @Query(\n+      value =\n+          \"SELECT DISTINCT si.id AS studyId, si.name AS studyName, si.custom_id AS customStudyId,si.type AS studyType, \"\n+              + \"ai.id AS appId,ai.app_name AS appName,ai.custom_app_id AS customAppId, \"\n+              + \"st.target_enrollment AS targetEnrollment, stp.edit AS edit \"\n+              + \"FROM app_info ai, study_info si, sites st,sites_permissions stp \"\n+              + \"WHERE ai.id=si.app_info_id AND st.study_id=si.id AND si.id=:studyId AND stp.study_id=si.id AND stp.ur_admin_user_id=:userId \",\n+      nativeQuery = true)\n+  public Optional<StudyAppDetails> getStudyParticipant(String studyId, String userId);", "originalCommit": "dafd281dcc2903f786e7b2032b15728484b1ee5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODA0OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2073#discussion_r525818049", "bodyText": "changed to getStudyAppDetails()", "author": "navya-BTC", "createdAt": "2020-11-18T05:08:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgwMzg5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "32b61209aa64aa014cd700c9a1e503342538106a", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\nindex 4f5dd4da4..7d6389f80 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\n\n@@ -94,7 +94,7 @@ public interface StudyRepository extends JpaRepository<StudyEntity, String> {\n               + \"FROM app_info ai, study_info si, sites st,sites_permissions stp \"\n               + \"WHERE ai.id=si.app_info_id AND st.study_id=si.id AND si.id=:studyId AND stp.study_id=si.id AND stp.ur_admin_user_id=:userId \",\n       nativeQuery = true)\n-  public Optional<StudyAppDetails> getStudyParticipant(String studyId, String userId);\n+  public Optional<StudyAppDetails> getStudyAppDetails(String studyId, String userId);\n \n   @Query(\n       value =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgwNDA5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2073#discussion_r525804090", "bodyText": "same here too", "author": "saminguyen", "createdAt": "2020-11-18T04:44:36Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java", "diffHunk": "@@ -83,4 +85,39 @@\n               + \"GROUP BY study.id \",\n       nativeQuery = true)\n   public List<StudyCount> findEnrolledCountByStudyId();\n+\n+  @Query(\n+      value =\n+          \"SELECT DISTINCT si.id AS studyId, si.name AS studyName, si.custom_id AS customStudyId,si.type AS studyType, \"\n+              + \"ai.id AS appId,ai.app_name AS appName,ai.custom_app_id AS customAppId, \"\n+              + \"st.target_enrollment AS targetEnrollment, stp.edit AS edit \"\n+              + \"FROM app_info ai, study_info si, sites st,sites_permissions stp \"\n+              + \"WHERE ai.id=si.app_info_id AND st.study_id=si.id AND si.id=:studyId AND stp.study_id=si.id AND stp.ur_admin_user_id=:userId \",\n+      nativeQuery = true)\n+  public Optional<StudyAppDetails> getStudyParticipant(String studyId, String userId);\n+\n+  @Query(\n+      value =\n+          \"SELECT DISTINCT si.id AS studyId, si.name AS studyName, si.custom_id AS customStudyId,si.type AS studyType, \"\n+              + \"ai.id AS appId,ai.app_name AS appName,ai.custom_app_id AS customAppId, \"\n+              + \"st.target_enrollment AS targetEnrollment \"\n+              + \"FROM app_info ai, study_info si, sites st \"\n+              + \"WHERE ai.id=si.app_info_id AND st.study_id=si.id AND si.id=:studyId \",\n+      nativeQuery = true)\n+  public Optional<StudyAppDetails> getStudyParticipantForSuperAdmin(String studyId);", "originalCommit": "dafd281dcc2903f786e7b2032b15728484b1ee5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgxODA3Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2073#discussion_r525818077", "bodyText": "changed to getStudyAppDetailsForSuperAdmin()", "author": "navya-BTC", "createdAt": "2020-11-18T05:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTgwNDA5MA=="}], "type": "inlineReview", "revised_code": {"commit": "32b61209aa64aa014cd700c9a1e503342538106a", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\nindex 4f5dd4da4..7d6389f80 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java\n\n@@ -94,7 +94,7 @@ public interface StudyRepository extends JpaRepository<StudyEntity, String> {\n               + \"FROM app_info ai, study_info si, sites st,sites_permissions stp \"\n               + \"WHERE ai.id=si.app_info_id AND st.study_id=si.id AND si.id=:studyId AND stp.study_id=si.id AND stp.ur_admin_user_id=:userId \",\n       nativeQuery = true)\n-  public Optional<StudyAppDetails> getStudyParticipant(String studyId, String userId);\n+  public Optional<StudyAppDetails> getStudyAppDetails(String studyId, String userId);\n \n   @Query(\n       value =\n"}}, {"oid": "32b61209aa64aa014cd700c9a1e503342538106a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/32b61209aa64aa014cd700c9a1e503342538106a", "message": "Fixed review comments", "committedDate": "2020-11-18T05:06:57Z", "type": "commit"}, {"oid": "b8b73fa82fba5c58ff7856d2066b5aa452f21d7d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b8b73fa82fba5c58ff7856d2066b5aa452f21d7d", "message": "Merge branch 'develop' into studyParticipant-performance-dev", "committedDate": "2020-11-20T06:42:04Z", "type": "commit"}, {"oid": "80e8c8720bc313c59bd0857d2c9a3d689ec71c34", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/80e8c8720bc313c59bd0857d2c9a3d689ec71c34", "message": "Merge branch 'develop' into studyParticipant-performance-dev", "committedDate": "2020-11-23T04:34:27Z", "type": "commit"}, {"oid": "9f3b6b68c1e8455d7b7f2d7ad025ffe89af53e29", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9f3b6b68c1e8455d7b7f2d7ad025ffe89af53e29", "message": "Merge branch 'develop' into studyParticipant-performance-dev", "committedDate": "2020-11-23T04:35:21Z", "type": "commit"}, {"oid": "51f4d6df275839fc2557a200ae5dd83c9353c9f7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/51f4d6df275839fc2557a200ae5dd83c9353c9f7", "message": "Merge branch 'develop' into studyParticipant-performance-dev", "committedDate": "2020-11-24T04:28:08Z", "type": "commit"}]}