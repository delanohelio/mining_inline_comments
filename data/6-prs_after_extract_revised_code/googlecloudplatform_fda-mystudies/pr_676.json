{"pr_number": 676, "pr_title": "Participant Manager Service: GET /{app}/participants endpoint with integration tests", "pr_createdAt": "2020-07-24T16:21:24Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676", "timeline": [{"oid": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/053fbd1d9519e638cfcb46b88caffcf467d4b35d", "message": "GET /{app}/participants endpoint with integration tests\n\nGET /{app}/participants endpoint with integration tests", "committedDate": "2020-07-24T16:18:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjExODYwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462118606", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\"),\n          \n          \n            \n              GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfully\"),", "author": "saminguyen", "createdAt": "2020-07-29T08:11:58Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java", "diffHunk": "@@ -53,7 +53,9 @@\n \n   GET_LOCATION_SUCCESS(HttpStatus.OK, \"MSG-0008\", \"Get locations successfull\"),\n \n-  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\");\n+  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\"),", "originalCommit": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NzM5NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462897395", "bodyText": "Changed to \"Get locations for site successfully\".", "author": "monica-BTC", "createdAt": "2020-07-30T10:17:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjExODYwNg=="}], "type": "inlineReview", "revised_code": {"commit": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\nindex 74d3989f3..54a4a812b 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n\n@@ -53,7 +50,7 @@ public enum MessageCode {\n \n   GET_LOCATION_SUCCESS(HttpStatus.OK, \"MSG-0008\", \"Get locations successfull\"),\n \n-  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\"),\n+  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfully\"),\n \n   GET_APP_PARTICIPANTS_SUCCESS(HttpStatus.OK, \"MSG-0005\", \"get App Participants successfully\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyMzg5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462123893", "bodyText": "I have seen other PRs with a new ParticipantDetail.java file here. Could you look into those and make sure to consolidate with that also? For example PR #656", "author": "saminguyen", "createdAt": "2020-07-29T08:20:39Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetails.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.beans;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+\n+@Getter\n+@Setter\n+@NoArgsConstructor\n+@JsonInclude(JsonInclude.Include.NON_EMPTY)\n+public class ParticipantDetails {", "originalCommit": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzMTk4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462131987", "bodyText": "This comment also goes with the above classes. Also I think there should be a consensus for all these classes on whether or not Detail is plural", "author": "saminguyen", "createdAt": "2020-07-29T08:33:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyMzg5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5ODE0NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462898144", "bodyText": "Removed ParticipantDetails and required fields are added in ParticipantDetail.", "author": "monica-BTC", "createdAt": "2020-07-30T10:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyMzg5Mw=="}], "type": "inlineReview", "revised_code": {"commit": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetails.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetails.java\ndeleted file mode 100644\nindex 9e95b5c45..000000000\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetails.java\n+++ /dev/null\n\n@@ -1,57 +0,0 @@\n-/*\n- * Copyright 2020 Google LLC\n- *\n- * Use of this source code is governed by an MIT-style\n- * license that can be found in the LICENSE file or at\n- * https://opensource.org/licenses/MIT.\n- */\n-\n-package com.google.cloud.healthcare.fdamystudies.beans;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import com.fasterxml.jackson.annotation.JsonInclude;\n-\n-import lombok.Getter;\n-import lombok.NoArgsConstructor;\n-import lombok.Setter;\n-\n-@Getter\n-@Setter\n-@NoArgsConstructor\n-@JsonInclude(JsonInclude.Include.NON_EMPTY)\n-public class ParticipantDetails {\n-\n-  private String participantRegistrySiteid;\n-\n-  private String siteId;\n-\n-  private String customLocationId;\n-\n-  private String locationName;\n-\n-  private String customStudyId;\n-\n-  private String studyName;\n-\n-  private String customAppId;\n-\n-  private String appName;\n-\n-  private String onboardringStatus;\n-\n-  private String email;\n-\n-  private String invitationDate;\n-\n-  private String userDetailsId;\n-\n-  private String registrationStatus;\n-\n-  private String studiesEnrolled;\n-\n-  private String registrationDate;\n-\n-  private List<AppStudyDetails> enrolledStudies = new ArrayList<>();\n-}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyOTI3Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462129277", "bodyText": "{appId} ?", "author": "saminguyen", "createdAt": "2020-07-29T08:29:08Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "diffHunk": "@@ -38,7 +38,9 @@\n   GET_LOCATIONS(\"http://localhost:8003/participant-manager-service/locations\"),\n \n   GET_LOCATION_BY_LOCATION_ID(\n-      \"http://localhost:8003/participant-manager-service/locations/{locationId}\");\n+      \"http://localhost:8003/participant-manager-service/locations/{locationId}\"),\n+\n+  GET_APP_PARTICIPANTS(\"http://localhost:8080/participant-manager-service/apps/{app}/participants\");", "originalCommit": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5ODYxMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462898611", "bodyText": "Changed to appId.", "author": "monica-BTC", "createdAt": "2020-07-30T10:19:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEyOTI3Nw=="}], "type": "inlineReview", "revised_code": {"commit": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\nindex dd1f5582c..6df4b952d 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n\n@@ -40,7 +40,8 @@ public enum ApiEndpoint {\n   GET_LOCATION_BY_LOCATION_ID(\n       \"http://localhost:8003/participant-manager-service/locations/{locationId}\"),\n \n-  GET_APP_PARTICIPANTS(\"http://localhost:8080/participant-manager-service/apps/{app}/participants\");\n+  GET_APP_PARTICIPANTS(\n+      \"http://localhost:8080/participant-manager-service/apps/{appId}/participants\");\n \n   private String url;\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzMzQ1Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462133452", "bodyText": "typo", "author": "saminguyen", "createdAt": "2020-07-29T08:35:31Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java", "diffHunk": "@@ -53,7 +53,9 @@\n \n   GET_LOCATION_SUCCESS(HttpStatus.OK, \"MSG-0008\", \"Get locations successfull\"),\n \n-  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\");\n+  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\"),", "originalCommit": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5OTc3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462899775", "bodyText": "Typo corrected.", "author": "monica-BTC", "createdAt": "2020-07-30T10:22:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzMzQ1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\nindex 74d3989f3..54a4a812b 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n\n@@ -53,7 +50,7 @@ public enum MessageCode {\n \n   GET_LOCATION_SUCCESS(HttpStatus.OK, \"MSG-0008\", \"Get locations successfull\"),\n \n-  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfull\"),\n+  GET_LOCATION_FOR_SITE_SUCCESS(HttpStatus.OK, \"MSG-0009\", \"Get locations for site successfully\"),\n \n   GET_APP_PARTICIPANTS_SUCCESS(HttpStatus.OK, \"MSG-0005\", \"get App Participants successfully\");\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzNjI5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462136292", "bodyText": "Always check for size of Array before checking for values within it. Also check for other fields by participants[0] too like the actual enrolled studies to make sure it matches test data", "author": "saminguyen", "createdAt": "2020-07-29T08:40:38Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java", "diffHunk": "@@ -171,6 +171,64 @@ public void shouldReturnForbiddenForGetAppDetailsAccessDenied() throws Exception\n                 \"$.error_description\", is(ErrorCode.USER_ADMIN_ACCESS_DENIED.getDescription())));\n   }\n \n+  @Test\n+  public void shouldReturnGetAppParticipants() throws Exception {\n+    // Step 1 : Set studyEntity,siteEntity,locationEntity,userDetailsEntity\n+    studyEntity.setAppInfo(appEntity);\n+    siteEntity.setStudy(studyEntity);\n+    locationEntity = testDataHelper.createLocation();\n+    siteEntity.setLocation(locationEntity);\n+    participantStudyEntity.setUserDetails(userDetailsEntity);\n+    testDataHelper.getParticipantStudyRepository().saveAndFlush(participantStudyEntity);\n+\n+    // Step 2: Call API to return GET_APPS_PARTICIPANTS\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.set(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_APP_PARTICIPANTS.getPath(), appEntity.getId())\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.participants\").isArray())", "originalCommit": "053fbd1d9519e638cfcb46b88caffcf467d4b35d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMDA4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/676#discussion_r462900086", "bodyText": "Checked for size of array and values.", "author": "monica-BTC", "createdAt": "2020-07-30T10:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjEzNjI5Mg=="}], "type": "inlineReview", "revised_code": {"commit": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\nindex fefbfe0f0..3a086f850 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\n\n@@ -193,7 +192,12 @@ public class AppControllerTest extends BaseMockIT {\n         .andDo(print())\n         .andExpect(status().isOk())\n         .andExpect(jsonPath(\"$.participants\").isArray())\n+        .andExpect(jsonPath(\"$.participants\", hasSize(1)))\n         .andExpect(jsonPath(\"$.participants[0].enrolledStudies\").isArray())\n+        .andExpect(jsonPath(\"$.participants[0].enrolledStudies\", hasSize(1)))\n+        .andExpect(jsonPath(\"$.participants[0].email\").value(userDetailsEntity.getEmail()))\n+        .andExpect(\n+            jsonPath(\"$.participants[0].enrolledStudies[0].studyName\").value(studyEntity.getName()))\n         .andExpect(jsonPath(\"$.customId\").value(appEntity.getAppId()))\n         .andExpect(jsonPath(\"$.name\").value(appEntity.getAppName()));\n   }\n"}}, {"oid": "5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5ce49ac64c664f4a2d1a783e83e4e2f9fd6c132b", "message": "Fixed PR comments\n\nFixed PR comments", "committedDate": "2020-07-30T10:16:23Z", "type": "commit"}, {"oid": "c2ef5e6fb4823b34182398cbbb676afc78e8495e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c2ef5e6fb4823b34182398cbbb676afc78e8495e", "message": "Fixed PR comment\n\nFixed PR comment", "committedDate": "2020-07-30T10:21:51Z", "type": "commit"}, {"oid": "bdffe157165c56e80fa87b173331647c138547c5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bdffe157165c56e80fa87b173331647c138547c5", "message": "Merge branch 'participant-manager-getlocations-endpoint' into get-app-participants-api", "committedDate": "2020-07-30T10:24:23Z", "type": "commit"}, {"oid": "eb3f416c751bab3d45a6796e879a0b83e621348b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eb3f416c751bab3d45a6796e879a0b83e621348b", "message": "Merge branch 'develop' into get-app-participants-api", "committedDate": "2020-08-14T06:59:47Z", "type": "commit"}, {"oid": "5cc7c1f43d1949c2a31fab70cb96069bd527cf01", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5cc7c1f43d1949c2a31fab70cb96069bd527cf01", "message": "resolved conflict errors\n\nresolved conflict errors", "committedDate": "2020-08-14T07:06:50Z", "type": "commit"}, {"oid": "4de955863d8246f5f2dade49703a96ba99e6c6e9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4de955863d8246f5f2dade49703a96ba99e6c6e9", "message": "Merge branch 'develop' into get-app-participants-api", "committedDate": "2020-08-14T15:19:53Z", "type": "commit"}]}