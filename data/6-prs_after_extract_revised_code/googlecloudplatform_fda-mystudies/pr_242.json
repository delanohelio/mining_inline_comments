{"pr_number": 242, "pr_title": "Android: Feedback and contact us moved to registration server and pdf issue for unsupported characters fixed", "pr_createdAt": "2020-04-25T18:07:50Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/242", "timeline": [{"oid": "d76a93c8267296662f08a845099ebd05f93a8e50", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d76a93c8267296662f08a845099ebd05f93a8e50", "message": "1.Feedback and contactUs moved from wcp to registration server\n2.Issue in pdf for unsupported character fixed\n3.Study filter screen UI fixed", "committedDate": "2020-04-25T17:58:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMwMjEyOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/242#discussion_r415302129", "bodyText": "move this to where font is defined as an initial value.", "author": "zohrehj", "createdAt": "2020-04-26T12:43:39Z", "path": "Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java", "diffHunk": "@@ -41,18 +50,27 @@\n \n   void createPdfFile(Context context) {\n     PDFBoxResourceLoader.init(context);\n+    assetManager = context.getAssets();\n     doc = new PDDocument();\n-    font = PDType1Font.HELVETICA;\n+    try {\n+      font =\n+          PDType0Font.load(\n+              doc,\n+              assetManager.open(\"com/tom_roush/pdfbox/resources/ttf/LiberationSans-Regular.ttf\"));\n+    } catch (Exception e) {\n+      font = PDType1Font.HELVETICA;", "originalCommit": "d76a93c8267296662f08a845099ebd05f93a8e50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5NTY5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/242#discussion_r417095694", "bodyText": "Updated", "author": "naveenr-btc", "createdAt": "2020-04-29T06:38:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMwMjEyOQ=="}], "type": "inlineReview", "revised_code": {"commit": "210df470a0b8aae5339b533600b0364ae3153d16", "chunk": "diff --git a/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java b/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\nindex 99d48582c..786ad1811 100644\n--- a/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\n+++ b/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\n\n@@ -50,7 +43,7 @@ public class PDFWriter {\n \n   void createPdfFile(Context context) {\n     PDFBoxResourceLoader.init(context);\n-    assetManager = context.getAssets();\n+    AssetManager assetManager = context.getAssets();\n     doc = new PDDocument();\n     try {\n       font =\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMwMzI4NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/242#discussion_r415303285", "bodyText": "method name is misleading, since if the character is encodable it will not be replaced.\nShould be called something like sanitizeCharacter instead.", "author": "zohrehj", "createdAt": "2020-04-26T12:49:12Z", "path": "Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java", "diffHunk": "@@ -149,34 +165,62 @@ void saveAndClose() {\n   }\n \n   private void parseIndividualLines(\n-      StringBuffer wholeLetter, List<String> lines, float fontSize, PDFont pdfFont, float width)\n-      throws IOException {\n+      StringBuffer wholeLetter, List<String> lines, float fontSize, PDFont pdfFont, float width) {\n     String[] paragraphs = wholeLetter.toString().split(System.getProperty(\"line.separator\"));\n     for (int i = 0; i < paragraphs.length; i++) {\n       int lastSpace = -1;\n       lines.add(\" \");\n-      while (paragraphs[i].length() > 0) {\n-        int spaceIndex = paragraphs[i].indexOf(' ', lastSpace + 1);\n-        if (spaceIndex < 0) {\n-          spaceIndex = paragraphs[i].length();\n-        }\n-        String subString = paragraphs[i].substring(0, spaceIndex);\n-        float size = fontSize * pdfFont.getStringWidth(subString) / 1000;\n-        if (size > width) {\n-          if (lastSpace < 0) {\n+      if (paragraphs[i] != null)\n+        while (paragraphs[i].length() > 0) {\n+          paragraphs[i] = replaceUnsupportedCharacter(paragraphs[i]).toString();\n+          int spaceIndex = paragraphs[i].indexOf(' ', lastSpace + 1);\n+          if (spaceIndex < 0) {\n+            spaceIndex = paragraphs[i].length();\n+          }\n+          String subString = paragraphs[i].substring(0, spaceIndex);\n+          float size = 10;\n+          try {\n+            size = fontSize * pdfFont.getStringWidth(subString) / 1000;\n+          } catch (Exception e) {\n+            Logger.log(e);\n+          }\n+          if (size > width) {\n+            if (lastSpace < 0) {\n+              lastSpace = spaceIndex;\n+            }\n+            subString = paragraphs[i].substring(0, lastSpace);\n+            lines.add(subString);\n+            paragraphs[i] = paragraphs[i].substring(lastSpace).trim();\n+            lastSpace = -1;\n+          } else if (spaceIndex == paragraphs[i].length()) {\n+            lines.add(paragraphs[i]);\n+            paragraphs[i] = \"\";\n+          } else {\n             lastSpace = spaceIndex;\n           }\n-          subString = paragraphs[i].substring(0, lastSpace);\n-          lines.add(subString);\n-          paragraphs[i] = paragraphs[i].substring(lastSpace).trim();\n-          lastSpace = -1;\n-        } else if (spaceIndex == paragraphs[i].length()) {\n-          lines.add(paragraphs[i]);\n-          paragraphs[i] = \"\";\n-        } else {\n-          lastSpace = spaceIndex;\n         }\n+    }\n+  }\n+\n+  private StringBuffer replaceUnsupportedCharacter(String text) {", "originalCommit": "d76a93c8267296662f08a845099ebd05f93a8e50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzA5NTc1Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/242#discussion_r417095752", "bodyText": "updated", "author": "naveenr-btc", "createdAt": "2020-04-29T06:38:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMwMzI4NQ=="}], "type": "inlineReview", "revised_code": {"commit": "210df470a0b8aae5339b533600b0364ae3153d16", "chunk": "diff --git a/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java b/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\nindex 99d48582c..786ad1811 100644\n--- a/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\n+++ b/Android/app/src/main/java/com/harvard/studyappmodule/consent/PDFWriter.java\n\n@@ -172,7 +164,7 @@ public class PDFWriter {\n       lines.add(\" \");\n       if (paragraphs[i] != null)\n         while (paragraphs[i].length() > 0) {\n-          paragraphs[i] = replaceUnsupportedCharacter(paragraphs[i]).toString();\n+          paragraphs[i] = sanitizeCharacter(paragraphs[i]).toString();\n           int spaceIndex = paragraphs[i].indexOf(' ', lastSpace + 1);\n           if (spaceIndex < 0) {\n             spaceIndex = paragraphs[i].length();\n"}}, {"oid": "210df470a0b8aae5339b533600b0364ae3153d16", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/210df470a0b8aae5339b533600b0364ae3153d16", "message": "replaced method name and removed unwanted header", "committedDate": "2020-04-29T05:23:11Z", "type": "commit"}, {"oid": "c5ca960efc69b38138be4127b77f579ee4fc3e8a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c5ca960efc69b38138be4127b77f579ee4fc3e8a", "message": "Merge branch 'early-access' into early-access-Android-25-04", "committedDate": "2020-04-29T05:36:29Z", "type": "commit"}, {"oid": "031af3f01e7c41b973430657cc9cf2f646256c49", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/031af3f01e7c41b973430657cc9cf2f646256c49", "message": "Merge branch 'early-access' into early-access-Android-25-04", "committedDate": "2020-04-29T18:04:09Z", "type": "commit"}]}