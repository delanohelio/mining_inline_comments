{"pr_number": 79, "pr_title": "Code push for github PR issue fixes and github open issue fixes", "pr_createdAt": "2020-04-03T16:23:53Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79", "timeline": [{"oid": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cdf53a094c73a23e1a16d8ac883628d9b48214e3", "message": "Code push for github PR issue fixes and github open issue fixes", "committedDate": "2020-04-03T16:05:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEzOTI1MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403139251", "bodyText": "why is this an error log? it doesn't contain an exception message, so it's confusing to log it as error.", "author": "zohrehj", "createdAt": "2020-04-03T16:46:57Z", "path": "auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/AuthenticationController.java", "diffHunk": "@@ -1011,7 +1014,7 @@ private AuthServerRegistrationResponse prepareSuccessResponse(\n       responseBean.setMessage(ErrorCode.EC_113.errorMessage());\n       return new ResponseEntity<>(responseBean, HttpStatus.BAD_REQUEST);\n     }\n-    logger.info(\"AuthenticationController forgotPassword() - Ends \");\n+    logger.error(\"AuthenticationController forgotPassword() - Ends \");", "originalCommit": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc2MTkyOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r404761929", "bodyText": "We will fix this in the next PR", "author": "aswinijena100", "createdAt": "2020-04-07T12:16:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzEzOTI1MQ=="}], "type": "inlineReview", "revised_code": {"commit": "94407a4fc3270c64bab4a9cb980b9e35ee42087b", "chunk": "diff --git a/auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/AuthenticationController.java b/auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/AuthenticationController.java\nindex 7417e70d4..bd453e19f 100644\n--- a/auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/AuthenticationController.java\n+++ b/auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/AuthenticationController.java\n\n@@ -1014,7 +1014,7 @@ public class AuthenticationController {\n       responseBean.setMessage(ErrorCode.EC_113.errorMessage());\n       return new ResponseEntity<>(responseBean, HttpStatus.BAD_REQUEST);\n     }\n-    logger.error(\"AuthenticationController forgotPassword() - Ends \");\n+    logger.info(\"AuthenticationController forgotPassword() - Ends \");\n     return new ResponseEntity<>(responseBean, HttpStatus.OK);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MDA5NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403140094", "bodyText": "This error message does not give any more context to the user, and is not actionable.\nI think what the bug wants is a clear actionable message telling user what the issue is and how they can resolve it.", "author": "zohrehj", "createdAt": "2020-04-03T16:48:32Z", "path": "auth-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/utils/MyStudiesUserRegUtil.java", "diffHunk": "@@ -52,7 +52,8 @@\n     EMAIL_ID_VERIFIED(\"EmailId has already verified\"),\n     INVALID_CLIENTID_OR_SECRET_KEY(\"Invalid Client Id or Secret Key\"),\n     INVALID_CLIENT_TOKEN(\"Invalid client token\"),\n-    SYSTEM_ERROR_FOUND(\"System error found\"),\n+    SYSTEM_ERROR_FOUND(\n+        \"Sorry, an error has occurred and your request could not be processed. Please try again later.\"),", "originalCommit": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg1NTg1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403855853", "bodyText": "We r logging this error whenever there will a system level error/exception like database down,etc . For which there won't be any actionable from the user's prospective , hence the generic message. However please let us know what should be the message in such scenarios when there is system failure .", "author": "aswinijena100", "createdAt": "2020-04-06T06:30:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MDA5NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MDkxOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403140919", "bodyText": "If this exception is related to user credential, why is it throwing a systemException?", "author": "zohrehj", "createdAt": "2020-04-03T16:50:02Z", "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/CommonServiceImpl.java", "diffHunk": "@@ -77,16 +77,16 @@ public boolean validateServerClientCredentials(String clientId, String clientSec\n       logger.error(\"ERROR: \", e);\n \n       if (e.getRawStatusCode() == 401) {\n-        logger.error(\"Invalid client Id or client secret.\");\n+        logger.error(\"Invalid client credentials.\");\n         throw new UnAuthorizedRequestException();\n       } else if (e.getRawStatusCode() == 400) {\n-        logger.error(\"Client verification ended with Bad Request\");\n+        logger.error(\"Client credentials verification error.\");\n         throw new InvalidRequestException();\n       } else {\n         throw new SystemException();\n       }\n     }\n-    logger.error(\"Invalid client Id or client secret.\");\n+    logger.error(\"Invalid client credentials.\");", "originalCommit": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MTc0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403141745", "bodyText": "this would also remove spaces in the middle of a token, why not use trim()?", "author": "zohrehj", "createdAt": "2020-04-03T16:51:38Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "diffHunk": "@@ -75,8 +75,9 @@\n       return new ResponseEntity<>(verifyEmailIdResponse, HttpStatus.BAD_REQUEST);\n     }\n     try {\n-      VerifyCodeResponse serviceResult =\n-          userDetailsService.verifyCode(verificationForm.getCode(), userId);\n+      verificationCode =\n+          verificationForm.getCode().replaceAll(\"\\\\s\", \"\"); // trim the surrounding whitespace.", "originalCommit": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc2MTQ0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r404761441", "bodyText": "In the current implementation random generated token does not have space in between hence I added replaceAll method instead of  trim. However will fix this issue by adding trim() .", "author": "aswinijena100", "createdAt": "2020-04-07T12:16:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MTc0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "7e5a1b9f5ced42e609c44235cb50b687b210d7ca", "chunk": "diff --git a/user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java b/user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java\nindex 9d43a47d3..63c91a82d 100644\n--- a/user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java\n+++ b/user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java\n\n@@ -75,8 +75,7 @@ public class VerifyEmailIdController {\n       return new ResponseEntity<>(verifyEmailIdResponse, HttpStatus.BAD_REQUEST);\n     }\n     try {\n-      verificationCode =\n-          verificationForm.getCode().replaceAll(\"\\\\s\", \"\"); // trim the surrounding whitespace.\n+      verificationCode = verificationForm.getCode().trim(); // trim the surrounding whitespace.\n       VerifyCodeResponse serviceResult = userDetailsService.verifyCode(verificationCode, userId);\n \n       if (serviceResult != null && Boolean.TRUE.equals(serviceResult.getIsCodeVerified())) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MjA4OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403142088", "bodyText": "why was this code removed?", "author": "zohrehj", "createdAt": "2020-04-03T16:52:17Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "diffHunk": "@@ -215,61 +211,4 @@ private void decommisionSiteFromStudy(Session session, Integer studyId) {\n     }\n     logger.info(\"StudiesDaoImpl - decommisionSiteFromStudy() : ends\");\n   }\n-\n-  @Override\n-  public String withdrawFromStudy(String participantId, String studyId, boolean delete) {", "originalCommit": "cdf53a094c73a23e1a16d8ac883628d9b48214e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg1NjI1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/79#discussion_r403856250", "bodyText": "Same piece of  code were duplicated under 2 bundles , hence removed .", "author": "aswinijena100", "createdAt": "2020-04-06T06:31:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE0MjA4OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "9f84e0c8d6f69619b6a9d2ce413e83f1ca3cf30c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9f84e0c8d6f69619b6a9d2ce413e83f1ca3cf30c", "message": "Merge branch 'early-access' of https://github.com/GoogleCloudPlatform/fda-mystudies into early-access-build", "committedDate": "2020-04-07T11:34:11Z", "type": "commit"}, {"oid": "94407a4fc3270c64bab4a9cb980b9e35ee42087b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/94407a4fc3270c64bab4a9cb980b9e35ee42087b", "message": "Added logger.info instead of logger.error", "committedDate": "2020-04-07T11:36:23Z", "type": "commit"}, {"oid": "7e5a1b9f5ced42e609c44235cb50b687b210d7ca", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7e5a1b9f5ced42e609c44235cb50b687b210d7ca", "message": "Added trim method instead of replaceAll . Also internal QA issue fixes for IOS pushnotification issue", "committedDate": "2020-04-07T11:40:11Z", "type": "commit"}, {"oid": "10a8a8c5a71c163e067bedc214aa427a003d54b8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/10a8a8c5a71c163e067bedc214aa427a003d54b8", "message": "Merge branch 'early-access' into early-access-build", "committedDate": "2020-04-07T11:59:04Z", "type": "commit"}, {"oid": "4e251c1ad3a1ab5b70621082e09a476571578738", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4e251c1ad3a1ab5b70621082e09a476571578738", "message": "Merge branch 'early-access-build' of https://github.com/GoogleCloudPlatform/fda-mystudies into early-access-build", "committedDate": "2020-04-07T12:03:17Z", "type": "commit"}]}