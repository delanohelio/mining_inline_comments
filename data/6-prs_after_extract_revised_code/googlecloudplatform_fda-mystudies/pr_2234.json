{"pr_number": 2234, "pr_title": "Participant Manager Datastore : GET /{appId}/participants endpoint", "pr_createdAt": "2020-12-03T07:21:45Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234", "timeline": [{"oid": "e6f0b0b629a5174e22243a014fdc96a015f7a1a8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e6f0b0b629a5174e22243a014fdc96a015f7a1a8", "message": "App Participants Pagination\n\nApp Participants Pagination", "committedDate": "2020-12-03T07:19:38Z", "type": "commit"}, {"oid": "f0a342a8467202a76aadd9423f1bea82cf42dd68", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f0a342a8467202a76aadd9423f1bea82cf42dd68", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-07T13:03:27Z", "type": "commit"}, {"oid": "c153e90e0ec52810b04e8c207623cf5274201855", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c153e90e0ec52810b04e8c207623cf5274201855", "message": "updated sorting and search term\n\nupdated sorting and search term", "committedDate": "2020-12-07T14:04:31Z", "type": "commit"}, {"oid": "011850f4fe6e7d0c18114a034b829b1e8c6702ef", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/011850f4fe6e7d0c18114a034b829b1e8c6702ef", "message": "Update AppController.java", "committedDate": "2020-12-07T14:11:29Z", "type": "commit"}, {"oid": "e9c709be75a13725fbb39a3d8e69de85b4e54f24", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9c709be75a13725fbb39a3d8e69de85b4e54f24", "message": "fixed test case\n\nfixed test case", "committedDate": "2020-12-07T14:17:58Z", "type": "commit"}, {"oid": "0fff833cbd81ee1d0dc105937bac6ab637462716", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0fff833cbd81ee1d0dc105937bac6ab637462716", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-07T14:59:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk4ODE1NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r537988154", "bodyText": "sortBy", "author": "saminguyen", "createdAt": "2020-12-08T02:37:39Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java", "diffHunk": "@@ -329,7 +329,13 @@\n       HttpStatus.NOT_FOUND.toString(),\n       \"This view displays app-wise enrollment if you manage multiple studies.\"),\n \n-  USER_EMAIL_EXIST(400, \"EC_0064\", Constants.BAD_REQUEST, \"The email already exists\");\n+  USER_EMAIL_EXIST(400, \"EC_0064\", Constants.BAD_REQUEST, \"The email already exists\"),\n+\n+  UNSUPPORTED_SORTBY_VALUE(\n+      400, \"EC_0076\", HttpStatus.BAD_REQUEST.toString(), \"Invalid sortby value\"),", "originalCommit": "0fff833cbd81ee1d0dc105937bac6ab637462716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2NDc2MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r538564760", "bodyText": "Changed to sortBy", "author": "monica-BTC", "createdAt": "2020-12-08T16:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk4ODE1NA=="}], "type": "inlineReview", "revised_code": {"commit": "1e9f4762d339b9a31e8e011313f747c3bad83f0c", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java\nindex 1ef845f61..dde83c670 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java\n\n@@ -335,7 +335,19 @@ public enum ErrorCode {\n       400, \"EC_0076\", HttpStatus.BAD_REQUEST.toString(), \"Invalid sortby value\"),\n \n   UNSUPPORTED_SORT_DIRECTION_VALUE(\n-      400, \"EC_0077\", HttpStatus.BAD_REQUEST.toString(), \"Invalid sorting direction\");\n+      400, \"EC_0077\", HttpStatus.BAD_REQUEST.toString(), \"Invalid sorting direction\"),\n+  \n+  FEEDBACK_ERROR_MESSAGE(\n+      500,\n+      \"EC_0073\",\n+      \"Internal Server Error\",\n+      \"Sorry, an error occurred and your feedback could not be sent to the organization. Please retry in some time.\"),\n+\n+  CONTACT_US_ERROR_MESSAGE(\n+      500,\n+      \"EC_0074\",\n+      \"Internal Server Error\",\n+      \"Sorry, an error occurred and your inquiry could not be sent to the organization. Please retry in some time.\");\n \n   private final int status;\n   private final String code;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNTM3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r538005371", "bodyText": "check the first few participants returned to verify the sorting function", "author": "saminguyen", "createdAt": "2020-12-08T03:25:54Z", "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java", "diffHunk": "@@ -427,6 +429,107 @@ public void shouldReturnGetAppParticipantsWithoutParticipants() throws Exception\n     verifyTokenIntrospectRequest();\n   }\n \n+  @Test\n+  public void shouldReturnAppParticipantsWithPagination() throws Exception {\n+    // Step 1 : Set studyEntity,siteEntity,locationEntity,userDetailsEntity and superAdmin to false\n+    userRegAdminEntity.setSuperAdmin(false);\n+    testDataHelper.getUserRegAdminRepository().save(userRegAdminEntity);\n+    studyEntity.setApp(appEntity);\n+    siteEntity.setStudy(studyEntity);\n+    locationEntity = testDataHelper.createLocation();\n+    siteEntity.setLocation(locationEntity);\n+    participantStudyEntity.setUserDetails(userDetailsEntity);\n+    testDataHelper.getParticipantStudyRepository().saveAndFlush(participantStudyEntity);\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    // Step 1: 1 Participants for app already added in @BeforeEach, add 20 new Participants for\n+    // app\n+    for (int i = 1; i <= 20; i++) {\n+      userDetailsEntity = testDataHelper.newUserDetails();\n+      userDetailsEntity.setApp(appEntity);\n+      userDetailsEntity.setEmail(EMAIL_VALUE + String.valueOf(i));\n+      testDataHelper.getUserDetailsRepository().saveAndFlush(userDetailsEntity);\n+      // Pagination records should be in descending order of created timestamp\n+      // Entities are not saved in sequential order so adding delay\n+      Thread.sleep(500);\n+    }\n+\n+    // Step 2: Call API and expect GET_PARTICIPANT_REGISTRY_SUCCESS message and fetch 11 data\n+    // out of 21\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_APP_PARTICIPANTS.getPath(), appEntity.getId())\n+                .headers(headers)\n+                .param(\"limit\", \"20\")\n+                .param(\"offset\", \"10\")\n+                .param(\"sortBy\", \"registrationDate\")\n+                .param(\"sortDirection\", \"desc\")", "originalCommit": "0fff833cbd81ee1d0dc105937bac6ab637462716", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2ODU1OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r538568558", "bodyText": "Sorted By email and verified.", "author": "monica-BTC", "createdAt": "2020-12-08T16:29:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNTM3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9", "chunk": "diff --git a/participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java b/participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\nindex 099ea6f25..9fb672db6 100644\n--- a/participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\n+++ b/participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java\n\n@@ -463,7 +507,7 @@ public class AppControllerTest extends BaseMockIT {\n                 .headers(headers)\n                 .param(\"limit\", \"20\")\n                 .param(\"offset\", \"10\")\n-                .param(\"sortBy\", \"registrationDate\")\n+                .param(\"sortBy\", \"email\")\n                 .param(\"sortDirection\", \"desc\")\n                 .param(\"searchTerm\", EMAIL_VALUE)\n                 .contextPath(getContextPath()))\n"}}, {"oid": "1e9f4762d339b9a31e8e011313f747c3bad83f0c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1e9f4762d339b9a31e8e011313f747c3bad83f0c", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-08T15:32:41Z", "type": "commit"}, {"oid": "67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9", "message": "Fixed review comment\n\nFixed review comment", "committedDate": "2020-12-08T16:22:26Z", "type": "commit"}, {"oid": "6420d53e4f843ec99f1d04416fd2078ecb35c3ba", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6420d53e4f843ec99f1d04416fd2078ecb35c3ba", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-09T14:26:38Z", "type": "commit"}, {"oid": "ff37d831ff2262ef162129044929b7f4c93635b4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ff37d831ff2262ef162129044929b7f4c93635b4", "message": "Fixed issue #1636\n\nFixed issue #1636", "committedDate": "2020-12-09T14:49:59Z", "type": "commit"}, {"oid": "ee66afdae18c25645b59cc1412da186375846794", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ee66afdae18c25645b59cc1412da186375846794", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-11T09:25:33Z", "type": "commit"}, {"oid": "4c6c0cee405642309a6b02d26e2845d5f06e96d9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4c6c0cee405642309a6b02d26e2845d5f06e96d9", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-11T09:38:19Z", "type": "commit"}, {"oid": "bf97c55244e7b890b87568b203b7cf0522ed1947", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bf97c55244e7b890b87568b203b7cf0522ed1947", "message": "Update ErrorCode.java", "committedDate": "2020-12-11T09:59:51Z", "type": "commit"}, {"oid": "ea506dea24f3f7e5ce48dd4f14625240bd6be766", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ea506dea24f3f7e5ce48dd4f14625240bd6be766", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-11T10:15:57Z", "type": "commit"}, {"oid": "4ef798cc7fc790030b65f10d8e36dd2029094a85", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4ef798cc7fc790030b65f10d8e36dd2029094a85", "message": "Merge branch 'app-participants-pagination' into participant-manager-issue#1636", "committedDate": "2020-12-11T10:21:28Z", "type": "commit"}, {"oid": "e4077050bbb8d50e82bbd9cfa75189146580e430", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e4077050bbb8d50e82bbd9cfa75189146580e430", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-11T14:19:46Z", "type": "commit"}, {"oid": "dabb9a5650df14122b725550b26fa88cb196d027", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dabb9a5650df14122b725550b26fa88cb196d027", "message": "Merge pull request #2309 from GoogleCloudPlatform/participant-manager-issue#1636\n\nParticipant Manager : Fixed issue #1636 in GET /{appId}/participants endpoint", "committedDate": "2020-12-13T13:14:09Z", "type": "commit"}, {"oid": "d0c9438d762d3215a1ed12815ca40f03b21eb089", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d0c9438d762d3215a1ed12815ca40f03b21eb089", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-13T13:16:53Z", "type": "commit"}, {"oid": "e9a2830c97820520a4b5bdbfe1e8a932517b17a6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9a2830c97820520a4b5bdbfe1e8a932517b17a6", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-14T13:22:43Z", "type": "commit"}, {"oid": "0538c11b5c1cad2106233937c2f42cf5054cf10c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0538c11b5c1cad2106233937c2f42cf5054cf10c", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-14T16:49:56Z", "type": "commit"}, {"oid": "a407880e2932a10c13e07c7421f88b83adb5ed55", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a407880e2932a10c13e07c7421f88b83adb5ed55", "message": "Merge branch 'develop' into app-participants-pagination", "committedDate": "2020-12-15T04:25:30Z", "type": "commit"}]}