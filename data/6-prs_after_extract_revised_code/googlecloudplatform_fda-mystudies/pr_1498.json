{"pr_number": 1498, "pr_title": "Study-Builder: Scheduler audit log", "pr_createdAt": "2020-10-19T15:45:03Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498", "timeline": [{"oid": "a2680ebb197bce2245228a9860f515da395dcaf7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a2680ebb197bce2245228a9860f515da395dcaf7", "message": "scheduler audit log", "committedDate": "2020-10-19T15:40:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzgzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508023835", "bodyText": "Keep empty line between static and non static imports", "author": "saminguyen", "createdAt": "2020-10-19T19:55:05Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java", "diffHunk": "@@ -12,7 +12,6 @@\n import static com.fdahpstudydesigner.common.PlatformComponent.RESPONSE_DATASTORE;\n import static com.fdahpstudydesigner.common.PlatformComponent.STUDY_BUILDER;\n import static com.fdahpstudydesigner.common.PlatformComponent.STUDY_DATASTORE;\n-", "originalCommit": "a2680ebb197bce2245228a9860f515da395dcaf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI4ODE4MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508288180", "bodyText": "Fixed the comment", "author": "navya-BTC", "createdAt": "2020-10-20T07:58:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzgzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "d7942e957061702ba7eb423ab0d73ce31cd1186b", "chunk": "diff --git a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java\nindex 4dcd2398e..c80094eb1 100644\n--- a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java\n+++ b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java\n\n@@ -12,6 +12,7 @@ import static com.fdahpstudydesigner.common.PlatformComponent.PARTICIPANT_DATAST\n import static com.fdahpstudydesigner.common.PlatformComponent.RESPONSE_DATASTORE;\n import static com.fdahpstudydesigner.common.PlatformComponent.STUDY_BUILDER;\n import static com.fdahpstudydesigner.common.PlatformComponent.STUDY_DATASTORE;\n+\n import lombok.Getter;\n \n @Getter\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDEwMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508024103", "bodyText": "please fix typo here", "author": "saminguyen", "createdAt": "2020-10-19T19:55:29Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java", "diffHunk": "@@ -78,6 +89,8 @@\n \n   @Autowired private NotificationService notificationService;\n \n+  @Autowired private StudyBuilderAuditEventHelper auditLogEvtHelper;", "originalCommit": "a2680ebb197bce2245228a9860f515da395dcaf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI4ODM0OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508288348", "bodyText": "Fixed the comment", "author": "navya-BTC", "createdAt": "2020-10-20T07:58:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDEwMw=="}], "type": "inlineReview", "revised_code": {"commit": "d7942e957061702ba7eb423ab0d73ce31cd1186b", "chunk": "diff --git a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\nindex 2a22e3646..dbcfa8dfd 100644\n--- a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\n+++ b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\n\n@@ -89,7 +89,7 @@ public class FDASchedulerService {\n \n   @Autowired private NotificationService notificationService;\n \n-  @Autowired private StudyBuilderAuditEventHelper auditLogEvtHelper;\n+  @Autowired private StudyBuilderAuditEventHelper auditLogEventHelper;\n \n   @Bean()\n   public ThreadPoolTaskScheduler taskScheduler() {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDgxMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508024812", "bodyText": "Please add unit testing for these audit log cases", "author": "saminguyen", "createdAt": "2020-10-19T19:56:44Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java", "diffHunk": "@@ -228,11 +241,32 @@ public void sendPushNotification() {\n             new StringEntity(json.toString(), ContentType.APPLICATION_JSON);\n         post.setEntity(requestEntity);\n         client.execute(post);\n+        client.execute(post);\n+        HttpResponse response = client.execute(post);\n+        StatusLine statusLine = response.getStatusLine();\n+        if (statusLine.getStatusCode() == 200) {\n+          logSendNotificationFailedEvent(NOTIFICATION_METADATA_SENT_TO_PARTICIPANT_DATASTORE);\n+        } else {\n+          logSendNotificationFailedEvent(NOTIFICATION_METADATA_SEND_OPERATION_FAILED);\n+        }", "originalCommit": "a2680ebb197bce2245228a9860f515da395dcaf7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODI4NDcxMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1498#discussion_r508284710", "bodyText": "Navya has provided the reason for not writing the test cases for these 2 audit events in PR description. We can discuss this after the status call or on Thursday technical discussion meeting.", "author": "dhanyak-btc", "createdAt": "2020-10-20T07:53:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDgxMg=="}], "type": "inlineReview", "revised_code": {"commit": "d7942e957061702ba7eb423ab0d73ce31cd1186b", "chunk": "diff --git a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\nindex 2a22e3646..dbcfa8dfd 100644\n--- a/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\n+++ b/study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/scheduler/FDASchedulerService.java\n\n@@ -267,6 +267,6 @@ public class FDASchedulerService {\n     auditRequest.setDescription(eventEnum.getDescription());\n     auditRequest.setEventCode(eventEnum.getEventCode());\n     auditRequest.setOccurred(new Timestamp(Instant.now().toEpochMilli()));\n-    auditLogEvtHelper.logEvent(eventEnum, auditRequest);\n+    auditLogEventHelper.logEvent(eventEnum, auditRequest);\n   }\n }\n"}}, {"oid": "d7942e957061702ba7eb423ab0d73ce31cd1186b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d7942e957061702ba7eb423ab0d73ce31cd1186b", "message": "Fixed the comments", "committedDate": "2020-10-20T07:56:48Z", "type": "commit"}, {"oid": "82038ac81f16d647ad1fa1d431e07a27181f9133", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/82038ac81f16d647ad1fa1d431e07a27181f9133", "message": "Merge branch 'develop' into studyBuilder-scheduler-audit", "committedDate": "2020-10-20T07:58:06Z", "type": "commit"}, {"oid": "4d3fad3963fdf90d08bbeac8b78975fbb0f09a24", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4d3fad3963fdf90d08bbeac8b78975fbb0f09a24", "message": "Update FDASchedulerService.java", "committedDate": "2020-10-20T08:03:45Z", "type": "commit"}, {"oid": "ab9e85cd7ae58b191046193221418d04f25c6aa5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ab9e85cd7ae58b191046193221418d04f25c6aa5", "message": "Merge branch 'develop' into studyBuilder-scheduler-audit", "committedDate": "2020-10-22T13:46:03Z", "type": "commit"}, {"oid": "eda0721e424db13836cdd7b5950f8bfcf19856e9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eda0721e424db13836cdd7b5950f8bfcf19856e9", "message": "Merge branch 'develop' into studyBuilder-scheduler-audit", "committedDate": "2020-10-22T16:55:13Z", "type": "commit"}, {"oid": "54027f1d23380e88b2ddc23204c3b02b9257c5a5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/54027f1d23380e88b2ddc23204c3b02b9257c5a5", "message": "Merge branch 'develop' into studyBuilder-scheduler-audit", "committedDate": "2020-10-23T05:50:04Z", "type": "commit"}]}