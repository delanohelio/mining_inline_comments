{"pr_number": 852, "pr_title": "Participant Manager Service: [PATCH] /users/{userId}/status  endpoint implementation with integration tests", "pr_createdAt": "2020-08-28T17:09:17Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852", "timeline": [{"oid": "37fc6b4e8a3018be4c041c70d494e9ab491a8e93", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/37fc6b4e8a3018be4c041c70d494e9ab491a8e93", "message": "Deactivate/Reactivate User endpoint implementation\n\nDeactivate/Reactivate User endpoint implementation", "committedDate": "2020-08-28T17:03:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMDM2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r480200367", "bodyText": "let's use an enum instead? that would make it more clear what 0 and 1 are at a glance.\nIf you are looking for a boolean behavior, lets change the name to something that indicates that, e.g. active instead of status and change the value to Boolean instead of Integer", "author": "zohrehj", "createdAt": "2020-08-31T15:17:48Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/UserStatusRequest.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package com.google.cloud.healthcare.fdamystudies.beans;\n+\n+import javax.validation.constraints.Max;\n+import javax.validation.constraints.Min;\n+import javax.validation.constraints.NotNull;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+@ToString\n+public class UserStatusRequest {\n+\n+  @Min(0)", "originalCommit": "37fc6b4e8a3018be4c041c70d494e9ab491a8e93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1NDQzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482154435", "bodyText": "There is no annotation for validating enum values in Bean Validation built-in constraints. We may need to write custom enum validator or check the value in service layer and throw an ErrorCodeException.", "author": "dhanyak-btc", "createdAt": "2020-09-02T15:17:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMDM2Nw=="}], "type": "inlineReview", "revised_code": {"commit": "b2a2f6c9e28abbaea0e43ee9efcce727b131a1f5", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/UserStatusRequest.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/UserStatusRequest.java\nindex dab01e785..99f1e195b 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/UserStatusRequest.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/UserStatusRequest.java\n\n@@ -1,7 +1,5 @@\n package com.google.cloud.healthcare.fdamystudies.beans;\n \n-import javax.validation.constraints.Max;\n-import javax.validation.constraints.Min;\n import javax.validation.constraints.NotNull;\n import lombok.Getter;\n import lombok.Setter;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwNTEwNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r480205107", "bodyText": "this does not follow REST URL formats, status is not a resource and it is also not a custom action on the user.", "author": "zohrehj", "createdAt": "2020-08-31T15:25:36Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java", "diffHunk": "@@ -98,15 +99,18 @@\n   }\n \n   @PatchMapping(\n-      value = \"/users/{userId}/deactivate\",\n+      value = \"/users/{userId}/status\",", "originalCommit": "37fc6b4e8a3018be4c041c70d494e9ab491a8e93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE1NTM2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482155369", "bodyText": "We need to update just single field in this API, I referred Rest uri design for changing the status for resource", "author": "dhanyak-btc", "createdAt": "2020-09-02T15:18:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwNTEwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjM0NjE1Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482346153", "bodyText": "Your solution is a mixture of the two answers, you are status in the URL, so treating it as a resource, but using patch which could have just as easily been called on the user itself.\nthe two solutions are:\nPATCH /users/{user_id}\n{status: \"active\"}\n\nand\nPUT /users/{user_id}/status\n\n\"active\"\n\ndepending on the number of complexity of the status and logic associated with it I would recommend a different option.\nLess complex, option 1, more complex: option 2 which makes it easier to move the complex logic into a UserStatusController.\nIf you are only setting active/deactive, I am not sure this even is suitable for status property. Status has a broad meaning and anyone reading the code would expect it to hold any of the following values:\ncreated, unverified, deactivated, deleted ...\nThis is why it is useful to share your initial thoughts and plans in a doc before starting implementation.", "author": "zohrehj", "createdAt": "2020-09-02T19:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwNTEwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjc0Nzk5Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482747996", "bodyText": "Thanks @zohrehj for the two solutions. I've asked @Kantharajut-btc to change the endpoint as below:\nPATCH /users/{user_id}\n{status: 0}\n\nTeam is trying to remove the blockers for angular/mobile app teams during integration so we are making the code changes and then address any review comments. I totally agree with you, this is not the best practice to follow in future releases/tracks.", "author": "dhanyak-btc", "createdAt": "2020-09-03T07:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwNTEwNw=="}], "type": "inlineReview", "revised_code": {"commit": "ca7608be9965985cc042ca2e29a74c66c63e1aad", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\nindex 621544141..e28e39048 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n\n@@ -99,7 +99,7 @@ public class UserProfileController {\n   }\n \n   @PatchMapping(\n-      value = \"/users/{userId}/status\",\n+      value = \"/users/{userId}\",\n       consumes = MediaType.APPLICATION_JSON_VALUE,\n       produces = MediaType.APPLICATION_JSON_VALUE)\n   public ResponseEntity<UserAccountStatusResponse> updateUserAccountStatus(\n"}}, {"oid": "b2a2f6c9e28abbaea0e43ee9efcce727b131a1f5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b2a2f6c9e28abbaea0e43ee9efcce727b131a1f5", "message": "fixed PR comments\n\nfixed PR comments", "committedDate": "2020-09-02T15:12:40Z", "type": "commit"}, {"oid": "ca7608be9965985cc042ca2e29a74c66c63e1aad", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ca7608be9965985cc042ca2e29a74c66c63e1aad", "message": "Fixed PR comment\n\nFixed PR comment", "committedDate": "2020-09-03T06:59:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzODExNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482938114", "bodyText": "should this be a more generic request then? since we can in future add more fields here.", "author": "zohrehj", "createdAt": "2020-09-03T12:26:36Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java", "diffHunk": "@@ -98,15 +99,18 @@\n   }\n \n   @PatchMapping(\n-      value = \"/users/{userId}/deactivate\",\n+      value = \"/users/{userId}\",\n       consumes = MediaType.APPLICATION_JSON_VALUE,\n       produces = MediaType.APPLICATION_JSON_VALUE)\n-  public ResponseEntity<DeactivateAccountResponse> deactivateAccount(\n-      @PathVariable String userId, HttpServletRequest request) {\n-\n+  public ResponseEntity<UserAccountStatusResponse> updateUserAccountStatus(\n+      @PathVariable String userId,\n+      @Valid @RequestBody UserStatusRequest statusRequest,", "originalCommit": "ca7608be9965985cc042ca2e29a74c66c63e1aad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk1OTA1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482959050", "bodyText": "renamed to PatchUserRequest", "author": "Kantharajut-btc", "createdAt": "2020-09-03T13:00:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzODExNA=="}], "type": "inlineReview", "revised_code": {"commit": "6755c91a296eb9f5946f2a10bd39116d25575d2d", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\nindex e28e39048..f1666fe76 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n\n@@ -102,14 +102,14 @@ public class UserProfileController {\n       value = \"/users/{userId}\",\n       consumes = MediaType.APPLICATION_JSON_VALUE,\n       produces = MediaType.APPLICATION_JSON_VALUE)\n-  public ResponseEntity<UserAccountStatusResponse> updateUserAccountStatus(\n+  public ResponseEntity<PatchUserResponse> updateUserAccountStatus(\n       @PathVariable String userId,\n-      @Valid @RequestBody UserStatusRequest statusRequest,\n+      @Valid @RequestBody PatchUserRequest statusRequest,\n       HttpServletRequest request) {\n     logger.entry(String.format(BEGIN_REQUEST_LOG, request.getRequestURI()));\n \n     statusRequest.setUserId(userId);\n-    UserAccountStatusResponse deactivateResponse =\n+    PatchUserResponse deactivateResponse =\n         userProfileService.updateUserAccountStatus(statusRequest);\n \n     logger.exit(String.format(STATUS_LOG, deactivateResponse.getHttpStatusCode()));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzODUzMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482938533", "bodyText": "please rename. deactivateResponse is no longer accurate.", "author": "zohrehj", "createdAt": "2020-09-03T12:27:17Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java", "diffHunk": "@@ -98,15 +99,18 @@\n   }\n \n   @PatchMapping(\n-      value = \"/users/{userId}/deactivate\",\n+      value = \"/users/{userId}\",\n       consumes = MediaType.APPLICATION_JSON_VALUE,\n       produces = MediaType.APPLICATION_JSON_VALUE)\n-  public ResponseEntity<DeactivateAccountResponse> deactivateAccount(\n-      @PathVariable String userId, HttpServletRequest request) {\n-\n+  public ResponseEntity<UserAccountStatusResponse> updateUserAccountStatus(\n+      @PathVariable String userId,\n+      @Valid @RequestBody UserStatusRequest statusRequest,\n+      HttpServletRequest request) {\n     logger.entry(String.format(BEGIN_REQUEST_LOG, request.getRequestURI()));\n \n-    DeactivateAccountResponse deactivateResponse = userProfileService.deactivateAccount(userId);\n+    statusRequest.setUserId(userId);\n+    UserAccountStatusResponse deactivateResponse =", "originalCommit": "ca7608be9965985cc042ca2e29a74c66c63e1aad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk1ODc1MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482958751", "bodyText": "renamed to PatchUserResponse", "author": "Kantharajut-btc", "createdAt": "2020-09-03T13:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzODUzMw=="}], "type": "inlineReview", "revised_code": {"commit": "6755c91a296eb9f5946f2a10bd39116d25575d2d", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\nindex e28e39048..f1666fe76 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n\n@@ -102,14 +102,14 @@ public class UserProfileController {\n       value = \"/users/{userId}\",\n       consumes = MediaType.APPLICATION_JSON_VALUE,\n       produces = MediaType.APPLICATION_JSON_VALUE)\n-  public ResponseEntity<UserAccountStatusResponse> updateUserAccountStatus(\n+  public ResponseEntity<PatchUserResponse> updateUserAccountStatus(\n       @PathVariable String userId,\n-      @Valid @RequestBody UserStatusRequest statusRequest,\n+      @Valid @RequestBody PatchUserRequest statusRequest,\n       HttpServletRequest request) {\n     logger.entry(String.format(BEGIN_REQUEST_LOG, request.getRequestURI()));\n \n     statusRequest.setUserId(userId);\n-    UserAccountStatusResponse deactivateResponse =\n+    PatchUserResponse deactivateResponse =\n         userProfileService.updateUserAccountStatus(statusRequest);\n \n     logger.exit(String.format(STATUS_LOG, deactivateResponse.getHttpStatusCode()));\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzOTMwMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482939303", "bodyText": "why not user PATCH_USER?", "author": "zohrehj", "createdAt": "2020-09-03T12:28:39Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "diffHunk": "@@ -20,7 +20,7 @@\n \n   SET_UP_ACCOUNT(\"http://localhost:8080/participant-manager-service/users/\"),\n \n-  DEACTIVATE_ACCOUNT(\"http://localhost:8080/participant-manager-service/users/{userId}/deactivate\"),\n+  UPDATE_USER_STATUS(\"http://localhost:8080/participant-manager-service/users/{userId}\"),", "originalCommit": "ca7608be9965985cc042ca2e29a74c66c63e1aad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mjk1ODA5NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/852#discussion_r482958095", "bodyText": "renamed to PATCH_USER", "author": "Kantharajut-btc", "createdAt": "2020-09-03T12:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjkzOTMwMw=="}], "type": "inlineReview", "revised_code": {"commit": "6755c91a296eb9f5946f2a10bd39116d25575d2d", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\nindex 9fe7e84a6..7283e62cc 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n\n@@ -20,7 +20,7 @@ public enum ApiEndpoint {\n \n   SET_UP_ACCOUNT(\"http://localhost:8080/participant-manager-service/users/\"),\n \n-  UPDATE_USER_STATUS(\"http://localhost:8080/participant-manager-service/users/{userId}\"),\n+  PATCH_USER(\"http://localhost:8080/participant-manager-service/users/{userId}\"),\n \n   GET_APPS(\"http://localhost:8080/participant-manager-service/apps\"),\n \n"}}, {"oid": "6755c91a296eb9f5946f2a10bd39116d25575d2d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6755c91a296eb9f5946f2a10bd39116d25575d2d", "message": "Fixed PR comments\n\nFixed PR comments", "committedDate": "2020-09-03T12:58:36Z", "type": "commit"}, {"oid": "e86bc4448c997fc276e190aad93f679f34430d5f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e86bc4448c997fc276e190aad93f679f34430d5f", "message": "Merge branch 'develop' into participant-manager-deactivate-user-code-changes", "committedDate": "2020-09-03T13:56:33Z", "type": "commit"}, {"oid": "d82fa0bae0693a9c1cd57cb3809389c446a3c3d9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d82fa0bae0693a9c1cd57cb3809389c446a3c3d9", "message": "Merge branch 'develop' into participant-manager-deactivate-user-code-changes", "committedDate": "2020-09-03T14:11:13Z", "type": "commit"}]}