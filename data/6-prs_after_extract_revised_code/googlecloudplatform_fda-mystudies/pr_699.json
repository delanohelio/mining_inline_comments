{"pr_number": 699, "pr_title": "Participant Manager [GET]  /sites/{participantRegistrySiteId}/participant endpoint implementation", "pr_createdAt": "2020-07-28T14:54:57Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699", "timeline": [{"oid": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6c0691de78f8d0f03c171b08dbefa9a27edee718", "message": "GET /sites/{participantRegistrySiteId}/participant endpoint implementation with integration tests\n\nGET /sites/{participantRegistrySiteId}/participant endpoint implementation with integration tests", "committedDate": "2020-07-28T14:51:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNTk4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462715987", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfull\"),\n          \n          \n            \n                  HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfully\"),", "author": "saminguyen", "createdAt": "2020-07-30T03:41:19Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java", "diffHunk": "@@ -64,7 +64,10 @@\n   GET_USER_PROFILE_SUCCESS(HttpStatus.OK, \"MSG-0022\", \"Get user profile successfull\"),\n \n   GET_USER_PROFILE_WITH_SECURITY_CODE_SUCCESS(\n-      HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfull\");\n+      HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfull\"),", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NTU4OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462755588", "bodyText": "typo corrected", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:07:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNTk4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\nindex 7e986627e..fd7445000 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n\n@@ -61,10 +58,10 @@ public enum MessageCode {\n \n   UPDATE_USER_SUCCESS(HttpStatus.OK, \"MSG-0021\", \"User updated successfully\"),\n \n-  GET_USER_PROFILE_SUCCESS(HttpStatus.OK, \"MSG-0022\", \"Get user profile successfull\"),\n+  GET_USER_PROFILE_SUCCESS(HttpStatus.OK, \"MSG-0022\", \"Get user profile successfully\"),\n \n   GET_USER_PROFILE_WITH_SECURITY_CODE_SUCCESS(\n-      HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfull\"),\n+      HttpStatus.OK, \"MSG-0023\", \"Get user profile with security code successfully\"),\n \n   GET_PARTICIPANT_DETAILS_SUCCESS(\n       HttpStatus.OK, \"MSG-0019\", \"Get participant details successfully\");\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjk5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462716999", "bodyText": "Could this just be replaced by built in findById method?", "author": "saminguyen", "createdAt": "2020-07-30T03:45:27Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyConsentRepository.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.repository;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.data.jpa.repository.JpaRepository;\n+import org.springframework.data.jpa.repository.Query;\n+import org.springframework.stereotype.Repository;\n+\n+import com.google.cloud.healthcare.fdamystudies.model.StudyConsentEntity;\n+\n+@Repository\n+@ConditionalOnProperty(\n+    value = \"participant.manager.repository.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public interface StudyConsentRepository extends JpaRepository<StudyConsentEntity, String> {\n+\n+  @Query(\n+      \"SELECT sc FROM StudyConsentEntity sc WHERE sc.participantStudy.id in (:participantStudyIds)\")\n+  public List<StudyConsentEntity> findByParticipantRegistrySiteId(List<String> participantStudyIds);\n+\n+  @Query(\"SELECT sc FROM StudyConsentEntity sc WHERE sc.id =:consentId\")\n+  Optional<StudyConsentEntity> findByConsentId(String consentId);", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NTk5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462755993", "bodyText": "Removed findByConsentId method", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNjk5OQ=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyConsentRepository.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyConsentRepository.java\nindex ebad88910..f692d068d 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyConsentRepository.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyConsentRepository.java\n\n@@ -8,16 +8,13 @@\n \n package com.google.cloud.healthcare.fdamystudies.repository;\n \n+import com.google.cloud.healthcare.fdamystudies.model.StudyConsentEntity;\n import java.util.List;\n-import java.util.Optional;\n-\n import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n import org.springframework.data.jpa.repository.JpaRepository;\n import org.springframework.data.jpa.repository.Query;\n import org.springframework.stereotype.Repository;\n \n-import com.google.cloud.healthcare.fdamystudies.model.StudyConsentEntity;\n-\n @Repository\n @ConditionalOnProperty(\n     value = \"participant.manager.repository.enabled\",\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNzczNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462717736", "bodyText": "How about having a mapper method ConsentHistory -> StudyConsentEntity instead, you can use stream() when you call it", "author": "saminguyen", "createdAt": "2020-07-30T03:48:45Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ConsentMapper.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.mapper;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.CommonConstants.NOT_APPLICABLE;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.apache.commons.collections4.CollectionUtils;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import com.google.cloud.healthcare.fdamystudies.beans.ConsentHistory;\n+import com.google.cloud.healthcare.fdamystudies.common.DateTimeUtils;\n+import com.google.cloud.healthcare.fdamystudies.model.StudyConsentEntity;\n+\n+public final class ConsentMapper {\n+\n+  private ConsentMapper() {}\n+\n+  public static List<ConsentHistory> toStudyConsents(List<StudyConsentEntity> studyConsents) {", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1Njg3Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462756876", "bodyText": "Refactored the code, please review", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:11:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNzczNg=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ConsentMapper.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ConsentMapper.java\nindex 33728dd04..ccecc125a 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ConsentMapper.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ConsentMapper.java\n\n@@ -8,37 +8,27 @@\n \n package com.google.cloud.healthcare.fdamystudies.mapper;\n \n-import static com.google.cloud.healthcare.fdamystudies.common.CommonConstants.NOT_APPLICABLE;\n-\n-import java.util.ArrayList;\n-import java.util.List;\n-\n-import org.apache.commons.collections4.CollectionUtils;\n-import org.apache.commons.lang3.StringUtils;\n-\n import com.google.cloud.healthcare.fdamystudies.beans.ConsentHistory;\n import com.google.cloud.healthcare.fdamystudies.common.DateTimeUtils;\n import com.google.cloud.healthcare.fdamystudies.model.StudyConsentEntity;\n+import org.apache.commons.lang3.StringUtils;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.CommonConstants.NOT_APPLICABLE;\n \n public final class ConsentMapper {\n \n   private ConsentMapper() {}\n \n-  public static List<ConsentHistory> toStudyConsents(List<StudyConsentEntity> studyConsents) {\n-    List<ConsentHistory> consentHistories = new ArrayList<>();\n-    for (StudyConsentEntity studyCosent : CollectionUtils.emptyIfNull(studyConsents)) {\n-      ConsentHistory consentHistory = new ConsentHistory();\n-      consentHistory.setId(studyCosent.getId());\n-      consentHistory.setConsentDocumentPath(studyCosent.getPdfPath());\n-      consentHistory.setConsentVersion(studyCosent.getVersion());\n-\n-      String consentDate =\n-          DateTimeUtils.format(studyCosent.getParticipantStudy().getEnrolledDate());\n-      consentHistory.setConsentedDate(StringUtils.defaultIfEmpty(consentDate, NOT_APPLICABLE));\n-\n-      consentHistory.setDataSharingPermissions(studyCosent.getParticipantStudy().getSharing());\n-      consentHistories.add(consentHistory);\n-    }\n-    return consentHistories;\n+  public static ConsentHistory toConsentHistory(StudyConsentEntity studyConsent) {\n+    ConsentHistory consentHistory = new ConsentHistory();\n+    consentHistory.setId(studyConsent.getId());\n+    consentHistory.setConsentDocumentPath(studyConsent.getPdfPath());\n+    consentHistory.setConsentVersion(studyConsent.getVersion());\n+\n+    String consentDate = DateTimeUtils.format(studyConsent.getParticipantStudy().getEnrolledDate());\n+    consentHistory.setConsentedDate(StringUtils.defaultIfEmpty(consentDate, NOT_APPLICABLE));\n+\n+    consentHistory.setDataSharingPermissions(studyConsent.getParticipantStudy().getSharing());\n+    return consentHistory;\n   }\n }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxOTA2Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462719062", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class ParticipantDetailResponse extends BaseResponse {\n          \n          \n            \n            public class ParticipantDetailsResponse extends BaseResponse {", "author": "saminguyen", "createdAt": "2020-07-30T03:54:18Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailResponse.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.beans;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ErrorCode;\n+import com.google.cloud.healthcare.fdamystudies.common.MessageCode;\n+\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+\n+@Getter\n+@Setter\n+@NoArgsConstructor\n+public class ParticipantDetailResponse extends BaseResponse {", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NzQxOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462757419", "bodyText": "Changed to ParticipantDetailsResponse", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:12:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxOTA2Mg=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailResponse.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailsResponse.java\nsimilarity index 74%\nrename from participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailResponse.java\nrename to participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailsResponse.java\nindex 2d7a34259..101d82db2 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailResponse.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantDetailsResponse.java\n\n@@ -18,15 +18,15 @@ import lombok.Setter;\n @Getter\n @Setter\n @NoArgsConstructor\n-public class ParticipantDetailResponse extends BaseResponse {\n+public class ParticipantDetailsResponse extends BaseResponse {\n \n   private ParticipantDetails participantDetails;\n \n-  public ParticipantDetailResponse(ErrorCode errorCode) {\n+  public ParticipantDetailsResponse(ErrorCode errorCode) {\n     super(errorCode);\n   }\n \n-  public ParticipantDetailResponse(MessageCode messageCode, ParticipantDetails participantDetails) {\n+  public ParticipantDetailsResponse(MessageCode messageCode, ParticipantDetails participantDetails) {\n     super(messageCode);\n     this.participantDetails = participantDetails;\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyMTc2NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462721765", "bodyText": "swap positions for these two parameter. Since participantDetails is being updated it should be first", "author": "saminguyen", "createdAt": "2020-07-30T04:05:11Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ParticipantMapper.java", "diffHunk": "@@ -153,4 +154,47 @@ public static ParticipantDetails toParticipantDetails(UserDetailsEntity userDeta\n     participant.setRegistrationDate(DateTimeUtils.format(userDetailsEntity.getVerificationDate()));\n     return participant;\n   }\n+\n+  public static void addEnrollments(\n+      List<ParticipantStudyEntity> participantsEnrollments, ParticipantDetails participantDetails) {", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NzczNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462757735", "bodyText": "Swapped parameters", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyMTc2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ParticipantMapper.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ParticipantMapper.java\nindex dae5e3412..75af6d454 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ParticipantMapper.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/ParticipantMapper.java\n\n@@ -156,7 +154,7 @@ public final class ParticipantMapper {\n   }\n \n   public static void addEnrollments(\n-      List<ParticipantStudyEntity> participantsEnrollments, ParticipantDetails participantDetails) {\n+      ParticipantDetails participantDetails, List<ParticipantStudyEntity> participantsEnrollments) {\n     for (ParticipantStudyEntity participantsEnrollment : participantsEnrollments) {\n       Enrollment enrollment = new Enrollment();\n       enrollment.setEnrollmentStatus(participantsEnrollment.getStatus());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyMzQzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462723432", "bodyText": "validate() method", "author": "saminguyen", "createdAt": "2020-07-30T04:11:49Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java", "diffHunk": "@@ -491,4 +501,60 @@ private void deactivateYetToEnrollParticipants(String siteId) {\n       participantRegistrySiteRepository.saveAndFlush(participantRegistrySite);\n     }\n   }\n+\n+  @Override\n+  @Transactional(readOnly = true)\n+  public ParticipantDetailResponse getParticipantDetails(\n+      String participantRegistrySiteId, String userId) {\n+    logger.entry(\"begin getParticipantDetails()\");\n+\n+    Optional<ParticipantRegistrySiteEntity> optParticipantRegistry =\n+        participantRegistrySiteRepository.findById(participantRegistrySiteId);\n+\n+    if (!optParticipantRegistry.isPresent()) {", "originalCommit": "6c0691de78f8d0f03c171b08dbefa9a27edee718", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjc1NzkyMA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/699#discussion_r462757920", "bodyText": "Used validate() method", "author": "Kantharajut-btc", "createdAt": "2020-07-30T06:14:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyMzQzMg=="}], "type": "inlineReview", "revised_code": {"commit": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java\nindex 1a542d057..79ebe95f1 100644\n--- a/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java\n+++ b/participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java\n\n@@ -504,30 +502,21 @@ public class SiteServiceImpl implements SiteService {\n \n   @Override\n   @Transactional(readOnly = true)\n-  public ParticipantDetailResponse getParticipantDetails(\n+  public ParticipantDetailsResponse getParticipantDetails(\n       String participantRegistrySiteId, String userId) {\n     logger.entry(\"begin getParticipantDetails()\");\n \n     Optional<ParticipantRegistrySiteEntity> optParticipantRegistry =\n         participantRegistrySiteRepository.findById(participantRegistrySiteId);\n \n-    if (!optParticipantRegistry.isPresent()) {\n-      logger.exit(ErrorCode.PARTICIPANT_REGISTRY_SITE_NOT_FOUND);\n-      return new ParticipantDetailResponse(ErrorCode.PARTICIPANT_REGISTRY_SITE_NOT_FOUND);\n-    }\n-\n-    Optional<SitePermissionEntity> sitePermissions =\n-        sitePermissionRepository.findSitePermissionByUserIdAndSiteId(\n-            userId, optParticipantRegistry.get().getSite().getId());\n-\n-    if (!sitePermissions.isPresent()) {\n-      logger.exit(ErrorCode.MANAGE_SITE_PERMISSION_ACCESS_DENIED);\n-      return new ParticipantDetailResponse(ErrorCode.MANAGE_SITE_PERMISSION_ACCESS_DENIED);\n+    ErrorCode errorCode = validateParticipantDetailsRequest(optParticipantRegistry, userId);\n+    if (errorCode != null) {\n+      logger.exit(errorCode);\n+      return new ParticipantDetailsResponse(errorCode);\n     }\n \n     ParticipantDetails participantDetails =\n         ParticipantMapper.toParticipantDetailsResponse(optParticipantRegistry.get());\n-\n     List<ParticipantStudyEntity> participantsEnrollments =\n         participantStudyRepository.findParticipantsEnrollment(participantRegistrySiteId);\n \n"}}, {"oid": "4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4a91f945c9acbc1f91fcc3ba83d22cd48b67dd62", "message": "Fixed PR comments\n\nFixed PR comments", "committedDate": "2020-07-30T06:06:11Z", "type": "commit"}, {"oid": "57a37b4da8b54757caec8ab699e8df19b3f1e3f1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/57a37b4da8b54757caec8ab699e8df19b3f1e3f1", "message": "Changed lambda expression to method reference\n\nChanged lambda expression to method reference", "committedDate": "2020-07-30T06:20:25Z", "type": "commit"}, {"oid": "461173ab646baedda4ead5635c712d9ca96a4f9d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/461173ab646baedda4ead5635c712d9ca96a4f9d", "message": "Removed ParticipantDetails and properties added to ParticipantDetail\n\nRemoved ParticipantDetails and properties added to ParticipantDetail", "committedDate": "2020-07-30T10:28:28Z", "type": "commit"}, {"oid": "334b8c29958ece07e6516d0ec454c97c45555903", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/334b8c29958ece07e6516d0ec454c97c45555903", "message": "Merge branch 'develop' into participant-manager-get-participant-details", "committedDate": "2020-08-18T15:43:28Z", "type": "commit"}, {"oid": "d463bb07f88155f9a4ca05719f99b6bb223ab64b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d463bb07f88155f9a4ca05719f99b6bb223ab64b", "message": "Merge fix issue, and organized import", "committedDate": "2020-08-18T15:48:57Z", "type": "commit"}]}