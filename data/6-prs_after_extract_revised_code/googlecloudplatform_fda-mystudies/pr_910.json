{"pr_number": 910, "pr_title": "Consent Mgmt Service - Replace transaction commit/rollback with @Transactional ", "pr_createdAt": "2020-09-08T07:13:11Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910", "timeline": [{"oid": "1032e3e14f747d484a2d8e0852b6c82231e7ba2e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1032e3e14f747d484a2d8e0852b6c82231e7ba2e", "message": "Use @Transactional in service layer\n\nRemove commit/rollback in dao layer\nAdded Hibernate Configuration and changed data.sql to fix SQL Syntax error", "committedDate": "2020-09-05T21:58:50Z", "type": "commit"}, {"oid": "db8297bae332df98c9f4a396c89bc06b849ae003", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/db8297bae332df98c9f4a396c89bc06b849ae003", "message": "Added default values to show-sql, ddl-auto, import file props\n\nAdded default values to show-sql, ddl-auto, import file props", "committedDate": "2020-09-06T07:13:55Z", "type": "commit"}, {"oid": "89ff6dbc57769a299158ce92aad9886deb8d6da9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/89ff6dbc57769a299158ce92aad9886deb8d6da9", "message": "Source Code Format and Organize Imports\n\nSource Code Format and Organize Imports", "committedDate": "2020-09-06T07:23:38Z", "type": "commit"}, {"oid": "8fbcb8a0d1b3c995fb4be8f5e682f1dcda6f49c9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8fbcb8a0d1b3c995fb4be8f5e682f1dcda6f49c9", "message": "Added Mock for Cloud Storage in AppConfigTest\n\nAdded Mock for Cloud Storage in AppConfigTest", "committedDate": "2020-09-06T09:33:39Z", "type": "commit"}, {"oid": "422705145683a17a72b52594666eda04b8d7ce1d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/422705145683a17a72b52594666eda04b8d7ce1d", "message": "Added Integration test cases for consent bundle\n\nAdded Integration test cases for consent bundle", "committedDate": "2020-09-08T07:07:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3NjY4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r484976687", "bodyText": "It doesn't seem like this is strictly necessary, spring-boot-data seems like it does this for you https://stackoverflow.com/a/41643269", "author": "nikklassen", "createdAt": "2020-09-08T14:44:02Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/HibernateConfiguration.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.config;\n+\n+import java.util.Properties;\n+import javax.sql.DataSource;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.jdbc.datasource.DriverManagerDataSource;\n+import org.springframework.orm.hibernate5.HibernateTransactionManager;\n+import org.springframework.orm.hibernate5.LocalSessionFactoryBean;\n+import org.springframework.transaction.annotation.EnableTransactionManagement;\n+\n+@Configuration\n+@EnableTransactionManagement", "originalCommit": "422705145683a17a72b52594666eda04b8d7ce1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU4OTE1OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r485589158", "bodyText": "Removed @EnableTransactionManagement annotation.", "author": "monica-BTC", "createdAt": "2020-09-09T12:56:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk3NjY4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "8ded875beef48da8e27c9de27a49bb34f155d477", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/HibernateConfiguration.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/HibernateConfiguration.java\nindex 2e2fbe75d..13e0ae332 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/HibernateConfiguration.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/config/HibernateConfiguration.java\n\n@@ -18,10 +18,8 @@ import org.springframework.context.annotation.Configuration;\n import org.springframework.jdbc.datasource.DriverManagerDataSource;\n import org.springframework.orm.hibernate5.HibernateTransactionManager;\n import org.springframework.orm.hibernate5.LocalSessionFactoryBean;\n-import org.springframework.transaction.annotation.EnableTransactionManagement;\n \n @Configuration\n-@EnableTransactionManagement\n @ConditionalOnProperty(\n     value = \"hibernate.transaction.management.enabled\",\n     havingValue = \"true\",\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4Mjk4MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r484982980", "bodyText": "Why are these changes included?", "author": "nikklassen", "createdAt": "2020-09-08T14:52:18Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/CloudStorageService.java", "diffHunk": "@@ -66,27 +58,14 @@ public String saveFile(String fileName, String content, String underDirectory) {\n   }\n \n   @Override\n-  public void downloadFileTo(String absoluteFileName, OutputStream outputStream) {", "originalCommit": "422705145683a17a72b52594666eda04b8d7ce1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyNDA2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r485624069", "bodyText": "Some of the tests were failing so we needed to fix them. We implemented Cloud Storage mock in Participant Manager so we've refactored the code to follow same approach here.", "author": "dhanyak-btc", "createdAt": "2020-09-09T13:46:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4Mjk4MA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzQ4Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r484983483", "bodyText": "Shouldn't these annotations be on the Dao class? That way you add them in one place instead of everywhere that the Dao is used", "author": "nikklassen", "createdAt": "2020-09-08T14:52:58Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserConsentManagementServiceImpl.java", "diffHunk": "@@ -42,6 +41,7 @@\n       LoggerFactory.getLogger(UserConsentManagementServiceImpl.class);\n \n   @Override\n+  @Transactional(readOnly = true)", "originalCommit": "422705145683a17a72b52594666eda04b8d7ce1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYyNTY2NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r485625664", "bodyText": "I checked SO post Where should \u201c@Transactional\u201d be place Service Layer or DAO\nWe should add @Transactional in Service layer.", "author": "dhanyak-btc", "createdAt": "2020-09-09T13:48:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTYzNTQzNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/910#discussion_r485635436", "bodyText": "You also see on that post.\n\nThere are a lot of CRUD applications that don't have any significant business logic, for them having a service layer that just passes stuff through between the controllers and data access objects is not useful. In these cases we can put transaction annotation on Dao.\n\nIt's really just a judgement call of where your logical transactions exist. Either way is fine here I guess, I just wanted to highlight that this isn't a hard rule.", "author": "nikklassen", "createdAt": "2020-09-09T14:00:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDk4MzQ4Mw=="}], "type": "inlineReview", "revised_code": null}, {"oid": "8ded875beef48da8e27c9de27a49bb34f155d477", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8ded875beef48da8e27c9de27a49bb34f155d477", "message": "Fixed review comment\n\nFixed review comment", "committedDate": "2020-09-09T12:20:50Z", "type": "commit"}, {"oid": "fc405700b70f1cc1e0791590d526a95fbe897fd1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fc405700b70f1cc1e0791590d526a95fbe897fd1", "message": "Merge branch 'develop' into consent_dao_transactional", "committedDate": "2020-09-09T14:48:11Z", "type": "commit"}]}