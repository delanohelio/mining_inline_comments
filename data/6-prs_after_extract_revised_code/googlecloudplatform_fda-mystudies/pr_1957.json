{"pr_number": 1957, "pr_title": "[Participant User Datastore] [POST] /updateUserProfile endpoint fails to update user profile", "pr_createdAt": "2020-11-11T10:28:47Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1957", "timeline": [{"oid": "99ad9666f5a6954ed1396a5183307df2d3e1bb1d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/99ad9666f5a6954ed1396a5183307df2d3e1bb1d", "message": "[Participant User Datastore] [POST] /updateUserProfile endpoint issue fix\n\n[Participant User Datastore] [POST] /updateUserProfile endpoint issue #1956 fix", "committedDate": "2020-11-11T10:26:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI2MjA3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1957#discussion_r521262075", "bodyText": "[user-mgmt Checks] reported by reviewdog \ud83d\udc36\n'}' at column 9 should be on the same line as the next part of a multi-block statement (one that directly contains multiple blocks: if/else-if/else, do/while or try/catch/finally).", "author": "github-actions", "createdAt": "2020-11-11T10:29:33Z", "path": "participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -388,4 +366,35 @@ public EmailResponse resendConfirmationthroughEmail(\n     logger.info(\"UserManagementProfileServiceImpl - resendConfirmationthroughEmail() - Ends\");\n     return emailService.sendMimeMail(emailRequest);\n   }\n+\n+  private AuthInfoEntity authInfoDetails(UserDetailsEntity userDetails, UserRequestBean user) {\n+    AuthInfoEntity authInfo = null;\n+    authInfo = userProfileManagementDao.getAuthInfo(userDetails);\n+    if (authInfo != null) {\n+      if (user.getSettings() != null && user.getSettings().getRemoteNotifications() != null) {\n+        authInfo.setRemoteNotificationFlag(user.getSettings().getRemoteNotifications());\n+      }\n+      if (user.getInfo() != null) {\n+        if (!StringUtils.isBlank(user.getInfo().getOs())) {\n+          authInfo.setDeviceType(user.getInfo().getOs());\n+        }\n+        if (!StringUtils.isBlank(user.getInfo().getOs())\n+            && (user.getInfo().getOs().equalsIgnoreCase(\"IOS\")\n+                || user.getInfo().getOs().equalsIgnoreCase(\"I\"))) {\n+          authInfo.setIosAppVersion(user.getInfo().getAppVersion());\n+        } else {\n+          authInfo.setAndroidAppVersion(user.getInfo().getAppVersion());\n+        }\n+        if (!StringUtils.isBlank(user.getInfo().getDeviceToken())) {\n+          authInfo.setDeviceToken(user.getInfo().getDeviceToken());\n+        } // To maintain single session and update old device token", "originalCommit": "99ad9666f5a6954ed1396a5183307df2d3e1bb1d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "70cce3ca9dc1a80ace83b02571722f1591a8adf8", "chunk": "diff --git a/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java b/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java\nindex e50f88d83..3d639113a 100644\n--- a/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java\n+++ b/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java\n\n@@ -387,9 +387,7 @@ public class UserManagementProfileServiceImpl implements UserManagementProfileSe\n         }\n         if (!StringUtils.isBlank(user.getInfo().getDeviceToken())) {\n           authInfo.setDeviceToken(user.getInfo().getDeviceToken());\n-        } // To maintain single session and update old device token\n-        // when user changed the device from android to IOS or vice versa\n-        else if (!StringUtils.isBlank(authInfo.getDeviceToken())) {\n+        } else if (!StringUtils.isBlank(authInfo.getDeviceToken())) {\n           authInfo.setDeviceToken(null);\n         }\n       }\n"}}, {"oid": "70cce3ca9dc1a80ace83b02571722f1591a8adf8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/70cce3ca9dc1a80ace83b02571722f1591a8adf8", "message": "github acticon review fix\n\ngithub acticon review fix", "committedDate": "2020-11-11T10:31:07Z", "type": "commit"}, {"oid": "5c9a2299222d0ef195acb465dbb999a847ab0092", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5c9a2299222d0ef195acb465dbb999a847ab0092", "message": "Merge branch 'develop' into participant-datastore-update-profile-issue-fix", "committedDate": "2020-11-16T15:54:40Z", "type": "commit"}, {"oid": "3bbf1b6adebc904df8ff42ef43436682a11d4cff", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3bbf1b6adebc904df8ff42ef43436682a11d4cff", "message": "Merge branch 'develop' into participant-datastore-update-profile-issue-fix", "committedDate": "2020-11-17T05:01:20Z", "type": "commit"}, {"oid": "ca90104d13000c3d67196c6781a5e642c56fadc4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ca90104d13000c3d67196c6781a5e642c56fadc4", "message": "Merge branch 'develop' into participant-datastore-update-profile-issue-fix", "committedDate": "2020-11-17T05:01:36Z", "type": "commit"}]}