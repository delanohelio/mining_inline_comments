{"pr_number": 2280, "pr_title": "Fixed #2233 [auth-server] few audit event fields are missing ", "pr_createdAt": "2020-12-07T12:08:57Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280", "timeline": [{"oid": "2ea81de57590150423bb79578d30d50b4111e1c3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2ea81de57590150423bb79578d30d50b4111e1c3", "message": "Fixed [auth-server] few audit event fields are missing #2233\n\nFixed [auth-server] few audit event fields are missing #2233", "committedDate": "2020-12-07T12:06:27Z", "type": "commit"}, {"oid": "5e1549e27fa18e811f5d97c6289877cfa3e2fa00", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e1549e27fa18e811f5d97c6289877cfa3e2fa00", "message": "Fixed test failure\n\nFixed test failure", "committedDate": "2020-12-07T12:58:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r537568087", "bodyText": "consider moving it to a cookie name helper, otherwise all AuditEventMappers in each component would need to be aware of this prefix.", "author": "zohrehj", "createdAt": "2020-12-07T14:52:53Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/AuditEventMapper.java", "diffHunk": "@@ -56,7 +62,14 @@ public static AuditLogEventRequest fromHttpServletRequest(HttpServletRequest req\n   private static String getValue(HttpServletRequest request, String name) {\n     String value = request.getHeader(name);\n     if (StringUtils.isEmpty(value)) {\n-      value = getCookieValue(request, name);\n+      value = getCookieValue(request, \"mystudies_\" + name);", "originalCommit": "5e1549e27fa18e811f5d97c6289877cfa3e2fa00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODEwOTY1MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r538109650", "bodyText": "AuditEventMapper is in common-service and all the services use this mapper. I've already added decode() in cookie helper, CookieHelper L69.\nPlease review and approve the PR.", "author": "dhanyak-btc", "createdAt": "2020-12-08T07:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ4MDIzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r538480232", "bodyText": "can this function reuse the cookie prefix constant?\nMy problem is that if these prefix values are supposed to match one another, their value should not be scattered through the code, but should be set as a constant, or attached/removed in a global helper function and used by all other services.\nThis is not what we are doing here.", "author": "zohrehj", "createdAt": "2020-12-08T15:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ5MzU4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r538493586", "bodyText": "Cookies are set/get by auth-server only, other services don't use these cookies. I'll ask @harisboston to extract mystudies_ to constant and fix the review comment.", "author": "dhanyak-btc", "createdAt": "2020-12-08T15:23:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUzNDkyNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r538534926", "bodyText": "Fixed review comment", "author": "harisboston", "createdAt": "2020-12-08T16:00:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY0MTg2Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2280#discussion_r538641867", "bodyText": "the comment was about referring/using the same constant, rather than creating new constants everywhere. I'll approve for now, but please file a bug and fix it.", "author": "zohrehj", "createdAt": "2020-12-08T17:35:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzU2ODA4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "2894b0d921c926395bf53e5381d42e0216c5da5f", "chunk": "diff --git a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/AuditEventMapper.java b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/AuditEventMapper.java\nindex cbdc096c2..f1180f1f8 100644\n--- a/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/AuditEventMapper.java\n+++ b/common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/AuditEventMapper.java\n\n@@ -62,7 +64,7 @@ public final class AuditEventMapper {\n   private static String getValue(HttpServletRequest request, String name) {\n     String value = request.getHeader(name);\n     if (StringUtils.isEmpty(value)) {\n-      value = getCookieValue(request, \"mystudies_\" + name);\n+      value = getCookieValue(request, COOKIE_PREFIX + name);\n     }\n     if (StringUtils.isNotEmpty(value)) {\n       try {\n"}}, {"oid": "790b18cb6dc638c9b9c1e41e9f4f8a24cc16e56d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/790b18cb6dc638c9b9c1e41e9f4f8a24cc16e56d", "message": "Merge branch 'develop' into oauth-server-audit-issue-2233", "committedDate": "2020-12-08T08:15:18Z", "type": "commit"}, {"oid": "2894b0d921c926395bf53e5381d42e0216c5da5f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2894b0d921c926395bf53e5381d42e0216c5da5f", "message": "Fixed review comment [auth-server] few audit event fields are missing #2280\n\nFixed review comment  [auth-server] few audit event fields are missing #2280", "committedDate": "2020-12-08T15:59:19Z", "type": "commit"}, {"oid": "72dda1788a62e0bf751d020d03a6d9ee27764d8d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/72dda1788a62e0bf751d020d03a6d9ee27764d8d", "message": "Merge branch 'develop' into oauth-server-audit-issue-2233", "committedDate": "2020-12-08T16:07:06Z", "type": "commit"}, {"oid": "a62c84661fe8b7c26f85d25f7081f986a9e800da", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a62c84661fe8b7c26f85d25f7081f986a9e800da", "message": "Merge branch 'develop' into oauth-server-audit-issue-2233", "committedDate": "2020-12-08T18:03:46Z", "type": "commit"}]}