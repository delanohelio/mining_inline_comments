{"pr_number": 787, "pr_title": "Participant manager [GET] /users endpoint implementation", "pr_createdAt": "2020-08-21T13:06:00Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/787", "timeline": [{"oid": "2aa4d0f4c1602b8cdbb7fdcf8dc7045437994cbe", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2aa4d0f4c1602b8cdbb7fdcf8dc7045437994cbe", "message": "Participant manager [GET] /users endpoint implementation", "committedDate": "2020-08-21T13:03:12Z", "type": "commit"}, {"oid": "bdba840004cd44b806268322036a0a6fc3bce326", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bdba840004cd44b806268322036a0a6fc3bce326", "message": "Merge branch 'participant-manager-get-admin-details-and-apps-api-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-get-users-api-implementation", "committedDate": "2020-08-23T07:56:39Z", "type": "commit"}, {"oid": "0be50863dc236e69ce0f57e5494650554e396499", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0be50863dc236e69ce0f57e5494650554e396499", "message": "Merge branch 'participant-manager-get-admin-details-and-apps-api-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-get-users-api-implementation", "committedDate": "2020-08-23T13:00:38Z", "type": "commit"}, {"oid": "a78269c3014f367187c4ad536f7541fb3a5d795e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a78269c3014f367187c4ad536f7541fb3a5d795e", "message": "Merge branch 'develop' into participant-manager-get-users-api-implementation", "committedDate": "2020-08-25T05:33:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE4OTA3Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/787#discussion_r476189072", "bodyText": "why is this size 3? You created one superadmin user and one non-superadmin above, right?\nAlso please verify the values of users[1] and users[2] below too", "author": "saminguyen", "createdAt": "2020-08-25T05:37:29Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java", "diffHunk": "@@ -630,6 +631,57 @@ public void shouldReturnAdminNotFoundErrorForGetAdminDetailsAndApps() throws Exc\n             jsonPath(\"$.error_description\").value(ErrorCode.ADMIN_NOT_FOUND.getDescription()));\n   }\n \n+  @Test\n+  public void shouldReturnAdminsForGetAdmins() throws Exception {\n+    // Step 1: Set few admins\n+    testDataHelper.createSuperAdmin();\n+    testDataHelper.createNonSuperAdmin();\n+\n+    // Step 2: Call API and expect GET_ADMINS_SUCCESS message\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.set(USER_ID_HEADER, userRegAdminEntity.getId());\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_USERS.getPath()).headers(headers).contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.users\").isArray())\n+        .andExpect(jsonPath(\"$.users\", hasSize(3)))", "originalCommit": "a78269c3014f367187c4ad536f7541fb3a5d795e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjIxOTkzNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/787#discussion_r476219936", "bodyText": "We have used your suggested approach to assert bad request violations in other places, but here some of the fields are dynamically generated so we are using andExpect() to assert the values. The only thing that I could assert is the admin email ids,\nHere, the size is 3 because 2 admins are created in this test method and another one is created in @BeforeEach method.", "author": "chiranjibi009", "createdAt": "2020-08-25T06:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE4OTA3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4OTk3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/787#discussion_r476489979", "bodyText": "Gotcha. Thank you", "author": "saminguyen", "createdAt": "2020-08-25T14:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjE4OTA3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "78731e9a32f93e7a0e1b2ea5445cadcb1fb27661", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java\nindex 47f330d59..58981243f 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserControllerTest.java\n\n@@ -649,7 +650,10 @@ public class UserControllerTest extends BaseMockIT {\n         .andExpect(jsonPath(\"$.users\", hasSize(3)))\n         .andExpect(jsonPath(\"$.users[0].apps\").isArray())\n         .andExpect(jsonPath(\"$.users[0].apps\").isEmpty())\n-        .andExpect(jsonPath(\"$.message\", is(MessageCode.GET_USERS_SUCCESS.getMessage())));\n+        .andExpect(jsonPath(\"$.message\", is(MessageCode.GET_USERS_SUCCESS.getMessage())))\n+        .andExpect(jsonPath(\"$.users..email\", hasItem(TestDataHelper.SUPER_ADMIN_EMAIL_ID)))\n+        .andExpect(jsonPath(\"$.users..email\", hasItem(TestDataHelper.NON_SUPER_ADMIN_EMAIL_ID)))\n+        .andExpect(jsonPath(\"$.users..email\", hasItem(TestDataHelper.EMAIL_VALUE)));\n   }\n \n   @Test\n"}}, {"oid": "78731e9a32f93e7a0e1b2ea5445cadcb1fb27661", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78731e9a32f93e7a0e1b2ea5445cadcb1fb27661", "message": "email ids are asserted for shouldReturnAdminsForGetAdmins test case method", "committedDate": "2020-08-25T06:58:31Z", "type": "commit"}]}