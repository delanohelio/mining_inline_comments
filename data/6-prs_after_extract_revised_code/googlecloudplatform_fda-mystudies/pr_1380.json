{"pr_number": 1380, "pr_title": "Common Service - Fixed Issue #1200 - ID generation process should be simplified", "pr_createdAt": "2020-10-14T12:25:54Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380", "timeline": [{"oid": "af42dda3353ac0cb5604156c02bff5c9f638e133", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/af42dda3353ac0cb5604156c02bff5c9f638e133", "message": "Fixed Issue #1200\n\nFixed Issue #1200", "committedDate": "2020-10-14T12:24:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNDE2Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380#discussion_r504704166", "bodyText": "how many characters is this random string? we should try to fix the length of the iD to the 64 character (or whatever that length was) we defined at the DB level.", "author": "zohrehj", "createdAt": "2020-10-14T14:03:31Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/IdGenerator.java", "diffHunk": "@@ -8,27 +8,27 @@\n \n package com.google.cloud.healthcare.fdamystudies.common;\n \n-import java.security.SecureRandom;\n import java.util.UUID;\n-import org.apache.commons.codec.digest.DigestUtils;\n+import org.apache.commons.lang3.RandomStringUtils;\n \n public final class IdGenerator {\n \n-  private static SecureRandom secureRandom = new SecureRandom();\n-\n   private IdGenerator() {}\n \n-  /**\n-   * Generates a random Id using UUID and current time (milliseconds). Returns Sha256 Hex value of\n-   * random id (length=64).\n-   */\n+  /** Generate a random Id using UUID and replace hyphen (-) with random alpha numeric letter */\n   public static String id() {\n-    String millis = String.valueOf(System.currentTimeMillis());\n-    StringBuilder builder = new StringBuilder(UUID.randomUUID().toString());\n-    for (int i = 0; i < millis.length(); i++) {\n-      int index = secureRandom.nextInt(builder.length() - 1);\n-      builder.insert(index, millis.charAt(i));\n+    String uuid = UUID.randomUUID().toString();", "originalCommit": "af42dda3353ac0cb5604156c02bff5c9f638e133", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcyMDYyMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380#discussion_r504720623", "bodyText": "The length of randomUUID is 36 characters. I also checked the letters count of the generated id value. Reference: https://www.baeldung.com/java-uuid#overview", "author": "dhanyak-btc", "createdAt": "2020-10-14T14:24:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNDE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc1NzM0OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380#discussion_r504757348", "bodyText": "see ID_LENGTH=128 here", "author": "zohrehj", "createdAt": "2020-10-14T15:09:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNDE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2NjU1OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380#discussion_r504766558", "bodyText": "I was using the hash value of the generated id, so the length was 64 and we decided to give 128 length for column size during data integrity PR. I've removed adding epochMilliSeconds to id value and then converting to hash value is removed in PR to fix the Issue #1200 .\nPlease let me know whether to change the ID_LENGTH to 64 but this requires database schema DDL statements needs to be re-generated.", "author": "dhanyak-btc", "createdAt": "2020-10-14T15:21:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNDE2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc5NDc2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1380#discussion_r504794761", "bodyText": "yes, please file a bug to update the database as well.", "author": "zohrehj", "createdAt": "2020-10-14T16:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDcwNDE2Ng=="}], "type": "inlineReview", "revised_code": null}, {"oid": "0690a8bee657eae23413bc342ad99940ad8e2f5b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0690a8bee657eae23413bc342ad99940ad8e2f5b", "message": "Merge branch 'develop' into issue-1200", "committedDate": "2020-10-14T14:25:03Z", "type": "commit"}, {"oid": "62009f2314768db9cc170335d33b3dd139947de9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/62009f2314768db9cc170335d33b3dd139947de9", "message": "Merge branch 'develop' into issue-1200", "committedDate": "2020-10-14T16:10:22Z", "type": "commit"}]}