{"pr_number": 722, "pr_title": "Participant Manager [PUT] /users/{userId}/profile endpoint implementation with integration tests.", "pr_createdAt": "2020-08-04T15:25:59Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722", "timeline": [{"oid": "f066adde8f0c2dba6448dab53044d1401dc0c321", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f066adde8f0c2dba6448dab53044d1401dc0c321", "message": "Participant-manager: Update user profile implementation", "committedDate": "2020-08-04T15:21:51Z", "type": "commit"}, {"oid": "25de1c09c029d4c0a1bc202a71a5078ec86546cf", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/25de1c09c029d4c0a1bc202a71a5078ec86546cf", "message": "Compilation fix", "committedDate": "2020-08-04T15:32:14Z", "type": "commit"}, {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "message": "Merge branch 'participant-manager-get-sites' into particiapnt-manager-update-user-profile-API-implementation", "committedDate": "2020-08-11T11:43:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2Njk1Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468766956", "bodyText": "create constants for these", "author": "saminguyen", "createdAt": "2020-08-11T18:04:31Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -151,6 +164,71 @@ public void shouldReturnUnauthorizedForUserDetailsBySecurityCode() throws Except\n             jsonPath(\"$.error_description\", is(ErrorCode.SECURITY_CODE_EXPIRED.getDescription())));\n   }\n \n+  @Test\n+  public void shouldUpdateUserProfile() throws Exception {\n+    // Step 1: Call API to update user profile\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), userRegAdminEntity.getId())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.message\", is(MessageCode.PROFILE_UPDATE_SUCCESS.getMessage())));\n+\n+    // Step 2: verify updated values\n+    Optional<UserRegAdminEntity> optUserRegAdminUser =\n+        userRegAdminRepository.findById(userRegAdminEntity.getId());\n+    UserRegAdminEntity userRegAdminEntity = optUserRegAdminUser.get();\n+    assertNotNull(userRegAdminEntity);\n+    assertEquals(\"mockit_email_updated@grr.la\", userRegAdminEntity.getEmail());\n+    assertEquals(\"mockito_updated\", userRegAdminEntity.getFirstName());\n+    assertEquals(\"mockito_updated_last_name\", userRegAdminEntity.getLastName());\n+  }\n+\n+  @Test\n+  public void shouldReturnUserNotExistsForUpdatedUserDetails() throws Exception {\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), IdGenerator.id())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isUnauthorized())\n+        .andExpect(jsonPath(\"$.error_description\", is(ErrorCode.USER_NOT_EXISTS.getDescription())));\n+  }\n+\n+  @Test\n+  public void shouldReturnUserNotActiveForUpdatedUserDetails() throws Exception {\n+    // Step 1: change the status to inactive\n+    userRegAdminEntity.setStatus(CommonConstants.INACTIVE_STATUS);\n+    userRegAdminRepository.saveAndFlush(userRegAdminEntity);\n+\n+    // Step 2: Call API and expect error USER_NOT_ACTIVE\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), userRegAdminEntity.getId())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isBadRequest())\n+        .andExpect(jsonPath(\"$.error_description\", is(ErrorCode.USER_NOT_ACTIVE.getDescription())));\n+  }\n+\n+  public UserProfileRequest getUserProfileRequest() {\n+    UserProfileRequest userProfileRequest = new UserProfileRequest();\n+    userProfileRequest.setFirstName(\"mockito_updated\");\n+    userProfileRequest.setLastName(\"mockito_updated_last_name\");\n+    userProfileRequest.setEmail(\"mockit_email_updated@grr.la\");", "originalCommit": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE2NzcwNg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r469167706", "bodyText": "These values used only 2 times so didn't created constants. If its more than 3 times sonarlint will suggest to create constant.", "author": "madhurya-btc", "createdAt": "2020-08-12T10:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2Njk1Ng=="}], "type": "inlineReview", "revised_code": {"commit": "a762906a59c850e515c4f151c24e669f15678f2e", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\nindex 46d05bdeb..4fe209b80 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\n\n@@ -183,7 +175,6 @@ public class UserProfileControllerTest extends BaseMockIT {\n         userRegAdminRepository.findById(userRegAdminEntity.getId());\n     UserRegAdminEntity userRegAdminEntity = optUserRegAdminUser.get();\n     assertNotNull(userRegAdminEntity);\n-    assertEquals(\"mockit_email_updated@grr.la\", userRegAdminEntity.getEmail());\n     assertEquals(\"mockito_updated\", userRegAdminEntity.getFirstName());\n     assertEquals(\"mockito_updated_last_name\", userRegAdminEntity.getLastName());\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODQ0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468768441", "bodyText": "Please re-format the code, the imports are not in alphabetical order. All the java, org imports should be after the com.... section", "author": "saminguyen", "createdAt": "2020-08-11T18:07:13Z", "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -1,13 +1,26 @@\n package com.google.cloud.healthcare.fdamystudies.controller;\n \n+import static com.google.cloud.healthcare.fdamystudies.common.JsonUtils.asJsonString;\n import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.CoreMatchers.notNullValue;\n+import static org.junit.Assert.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n \n+import java.sql.Timestamp;", "originalCommit": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODU0NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468768544", "bodyText": "Should be done automatically by IDE?", "author": "saminguyen", "createdAt": "2020-08-11T18:07:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODQ0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTE2ODQ0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r469168445", "bodyText": "Yes, it will be done automatically by IDE. Made changes and pushed.", "author": "madhurya-btc", "createdAt": "2020-08-12T10:41:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODQ0MQ=="}], "type": "inlineReview", "revised_code": {"commit": "744d6a6f224f1b3ba9c7da3501a1a95262766e12", "chunk": "diff --git a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\nindex 46d05bdeb..9fb51262c 100644\n--- a/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\n+++ b/participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java\n\n@@ -11,15 +11,6 @@ import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n \n-import java.sql.Timestamp;\n-import java.time.Instant;\n-import java.time.temporal.ChronoUnit;\n-import java.util.Optional;\n-import org.junit.jupiter.api.AfterEach;\n-import org.junit.jupiter.api.BeforeEach;\n-import org.junit.jupiter.api.Test;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.http.HttpHeaders;\n import com.google.cloud.healthcare.fdamystudies.beans.UserProfileRequest;\n import com.google.cloud.healthcare.fdamystudies.common.ApiEndpoint;\n import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n"}}, {"oid": "744d6a6f224f1b3ba9c7da3501a1a95262766e12", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/744d6a6f224f1b3ba9c7da3501a1a95262766e12", "message": "import statements formatting", "committedDate": "2020-08-12T10:40:56Z", "type": "commit"}, {"oid": "20fa2d5d35d63257f95e07d9a4570924d4ddcca6", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/20fa2d5d35d63257f95e07d9a4570924d4ddcca6", "message": "passing UserRegAdminEntity from service layer to mapper", "committedDate": "2020-08-14T06:04:04Z", "type": "commit"}, {"oid": "a762906a59c850e515c4f151c24e669f15678f2e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a762906a59c850e515c4f151c24e669f15678f2e", "message": "Updating only first name and last name.", "committedDate": "2020-08-14T10:37:25Z", "type": "commit"}, {"oid": "d0f71d8290b89764596ccc00b0f9b5e1b78d3db0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d0f71d8290b89764596ccc00b0f9b5e1b78d3db0", "message": "Merge branch 'develop' into particiapnt-manager-update-user-profile-API-implementation", "committedDate": "2020-08-19T15:58:10Z", "type": "commit"}, {"oid": "eae7189a49d593ff0bc0980e8e9411410695d02b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eae7189a49d593ff0bc0980e8e9411410695d02b", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into particiapnt-manager-update-user-profile-API-implementation\n\n# Conflicts:\n#\tcommon-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantStatusResponse.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/SiteController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/StudyMapper.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileService.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SitesControllerTest.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "committedDate": "2020-08-19T16:05:40Z", "type": "commit"}, {"oid": "1fd35ce8d4312d6c69ee55a1f64105f668b53986", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1fd35ce8d4312d6c69ee55a1f64105f668b53986", "message": "Merge branch 'particiapnt-manager-update-user-profile-API-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into particiapnt-manager-update-user-profile-API-implementation\n\n# Conflicts:\n#\tcommon-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantStatusResponse.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/SiteController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/StudyMapper.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileService.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "committedDate": "2020-08-19T16:09:17Z", "type": "commit"}, {"oid": "20282d2b47141b18d1f084950f245c9617e982b9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/20282d2b47141b18d1f084950f245c9617e982b9", "message": "Merge issue fix", "committedDate": "2020-08-19T16:10:41Z", "type": "commit"}]}