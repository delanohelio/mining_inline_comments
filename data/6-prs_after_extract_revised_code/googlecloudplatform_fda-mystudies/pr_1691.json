{"pr_number": 1691, "pr_title": "[User Management Service]:Issue 1637 fixes, Onboarding status should be DISABLED when participant deactivates his account", "pr_createdAt": "2020-10-28T14:31:11Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1691", "timeline": [{"oid": "2f9d0226bb0c97f1d5898370d8ceb66e8973f568", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2f9d0226bb0c97f1d5898370d8ceb66e8973f568", "message": "Issue 1637 fixed", "committedDate": "2020-10-28T14:20:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5MTc3MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1691#discussion_r513491771", "bodyText": "[user-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 237).", "author": "github-actions", "createdAt": "2020-10-28T14:32:02Z", "path": "participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java", "diffHunk": "@@ -291,6 +292,14 @@ public void deactivateAcct(String userId, List<String> deleteData, String userDe\n       criteriaParticipantStudiesUpdate.where(\n           studyIdPredicates.toArray(new Predicate[studyIdPredicates.size()]));\n       session.createQuery(criteriaParticipantStudiesUpdate).executeUpdate();\n+\n+      session\n+          .createSQLQuery(\n+              \"UPDATE participant_registry_site SET onboarding_status=:onboardingStatus WHERE id IN (SELECT participant_registry_site_id FROM participant_study_info where user_details_id=:userDetailsId and study_info_id IN (:studyIds))\")", "originalCommit": "2f9d0226bb0c97f1d5898370d8ceb66e8973f568", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5NTUxMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1691#discussion_r513495513", "bodyText": "Fixed", "author": "madhurya-btc", "createdAt": "2020-10-28T14:36:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzQ5MTc3MQ=="}], "type": "inlineReview", "revised_code": {"commit": "86aa8796eb43134eaa14e21ee0126b11469fa372", "chunk": "diff --git a/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java b/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java\nindex e4dadfec4..8ce62223c 100644\n--- a/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java\n+++ b/participant-datastore/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java\n\n@@ -295,7 +295,9 @@ public class UserProfileManagementDaoImpl implements UserProfileManagementDao {\n \n       session\n           .createSQLQuery(\n-              \"UPDATE participant_registry_site SET onboarding_status=:onboardingStatus WHERE id IN (SELECT participant_registry_site_id FROM participant_study_info where user_details_id=:userDetailsId and study_info_id IN (:studyIds))\")\n+              \"UPDATE participant_registry_site SET onboarding_status=:onboardingStatus WHERE \"\n+                  + \"id IN (SELECT participant_registry_site_id FROM participant_study_info where \"\n+                  + \"user_details_id=:userDetailsId and study_info_id IN (:studyIds))\")\n           .setParameter(\"onboardingStatus\", OnboardingStatus.DISABLED.getCode())\n           .setParameter(\"userDetailsId\", userDetails)\n           .setParameter(\"studyIds\", studyInfoBoList)\n"}}, {"oid": "86aa8796eb43134eaa14e21ee0126b11469fa372", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/86aa8796eb43134eaa14e21ee0126b11469fa372", "message": "github review comment", "committedDate": "2020-10-28T14:36:09Z", "type": "commit"}, {"oid": "5146aa5765c380681e3a58339a9c2a1e3ecb7685", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5146aa5765c380681e3a58339a9c2a1e3ecb7685", "message": "Merge branch 'develop' into issue1637", "committedDate": "2020-10-29T04:58:10Z", "type": "commit"}]}