{"pr_number": 4098, "pr_title": "Prevents plastanium conveyor unload exploit", "pr_createdAt": "2020-12-24T09:08:19Z", "pr_url": "https://github.com/Anuken/Mindustry/pull/4098", "timeline": [{"oid": "65fddb2972137b0706c208a3c4fca779329ebdd6", "url": "https://github.com/Anuken/Mindustry/commit/65fddb2972137b0706c208a3c4fca779329ebdd6", "message": "Prevent unloaders from unloading plast loading dock", "committedDate": "2020-12-24T09:01:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU0OTM1OA==", "url": "https://github.com/Anuken/Mindustry/pull/4098#discussion_r548549358", "bodyText": "This should be an overridable boolean method instead of an instance variable, to be in line with how everything else is implemented.", "author": "Anuken", "createdAt": "2020-12-24T14:46:19Z", "path": "core/src/mindustry/entities/comp/BuildingComp.java", "diffHunk": "@@ -63,6 +63,7 @@\n     transient boolean enabled = true;\n     transient float enabledControlTime;\n     transient String lastAccessed;\n+    transient boolean unloadable = true;", "originalCommit": "65fddb2972137b0706c208a3c4fca779329ebdd6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU1MDQyNA==", "url": "https://github.com/Anuken/Mindustry/pull/4098#discussion_r548550424", "bodyText": "ok, though this was better for performance given how often its called and only for this single purpose atm, I'll get it changed \ud83d\udc4d", "author": "Quezler", "createdAt": "2020-12-24T14:51:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU0OTM1OA=="}], "type": "inlineReview", "revised_code": {"commit": "c89edfaf03abb1058210f600f4040054623fa2be", "chunk": "diff --git a/core/src/mindustry/entities/comp/BuildingComp.java b/core/src/mindustry/entities/comp/BuildingComp.java\nindex dd8f85120..b6b93f888 100644\n--- a/core/src/mindustry/entities/comp/BuildingComp.java\n+++ b/core/src/mindustry/entities/comp/BuildingComp.java\n\n@@ -63,7 +63,6 @@ abstract class BuildingComp implements Posc, Teamc, Healthc, Buildingc, Timerc,\n     transient boolean enabled = true;\n     transient float enabledControlTime;\n     transient String lastAccessed;\n-    transient boolean unloadable = true;\n \n     PowerModule power;\n     ItemModule items;\n"}}, {"oid": "c89edfaf03abb1058210f600f4040054623fa2be", "url": "https://github.com/Anuken/Mindustry/commit/c89edfaf03abb1058210f600f4040054623fa2be", "message": "Use overridable boolean method unloadable instead", "committedDate": "2020-12-24T14:58:57Z", "type": "commit"}, {"oid": "8336ab07e9e2ee3bf0c6c1924da93358562d365b", "url": "https://github.com/Anuken/Mindustry/commit/8336ab07e9e2ee3bf0c6c1924da93358562d365b", "message": "Merge branch 'master' into loading-dock-loads\n\n# Conflicts:\n#\tcore/src/mindustry/world/blocks/distribution/StackConveyor.java", "committedDate": "2020-12-24T15:00:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU1Mjk1Mg==", "url": "https://github.com/Anuken/Mindustry/pull/4098#discussion_r548552952", "bodyText": "redundant check inside Unloader.java though, should this just be hardcoded to true or simply remove the block level check in unloader and route it all through this function?", "author": "Quezler", "createdAt": "2020-12-24T15:01:50Z", "path": "core/src/mindustry/entities/comp/BuildingComp.java", "diffHunk": "@@ -384,6 +384,10 @@ public byte version(){\n     //endregion\n     //region handler methods\n \n+    public boolean unloadable(){\n+        return block.unloadable;", "originalCommit": "8336ab07e9e2ee3bf0c6c1924da93358562d365b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "39136a32676646603f73a24e4beece6d19edfd8a", "chunk": "diff --git a/core/src/mindustry/entities/comp/BuildingComp.java b/core/src/mindustry/entities/comp/BuildingComp.java\nindex b6b93f888..9c4ca480f 100644\n--- a/core/src/mindustry/entities/comp/BuildingComp.java\n+++ b/core/src/mindustry/entities/comp/BuildingComp.java\n\n@@ -384,7 +384,7 @@ abstract class BuildingComp implements Posc, Teamc, Healthc, Buildingc, Timerc,\n     //endregion\n     //region handler methods\n \n-    public boolean unloadable(){\n+    public boolean canUnload(){\n         return block.unloadable;\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODU1MzI0Mw==", "url": "https://github.com/Anuken/Mindustry/pull/4098#discussion_r548553243", "bodyText": "press to implement the above comment, not sure if this will break on blocks with no building entity or something?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if(other.interactable(team) && other.block.unloadable && other.unloadable() && other.block.hasItems\n          \n          \n            \n                                if(other.interactable(team) && other.unloadable() && other.block.hasItems", "author": "Quezler", "createdAt": "2020-12-24T15:03:21Z", "path": "core/src/mindustry/world/blocks/storage/Unloader.java", "diffHunk": "@@ -61,7 +61,7 @@ public void updateTile(){\n                     int pos = (offset + i) % proximity.size;\n                     var other = proximity.get(pos);\n \n-                    if(other.interactable(team) && other.block.unloadable && other.block.hasItems\n+                    if(other.interactable(team) && other.block.unloadable && other.unloadable() && other.block.hasItems", "originalCommit": "8336ab07e9e2ee3bf0c6c1924da93358562d365b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "39136a32676646603f73a24e4beece6d19edfd8a", "chunk": "diff --git a/core/src/mindustry/world/blocks/storage/Unloader.java b/core/src/mindustry/world/blocks/storage/Unloader.java\nindex 14581d407..e04015382 100644\n--- a/core/src/mindustry/world/blocks/storage/Unloader.java\n+++ b/core/src/mindustry/world/blocks/storage/Unloader.java\n\n@@ -61,7 +61,7 @@ public class Unloader extends Block{\n                     int pos = (offset + i) % proximity.size;\n                     var other = proximity.get(pos);\n \n-                    if(other.interactable(team) && other.block.unloadable && other.unloadable() && other.block.hasItems\n+                    if(other.interactable(team) && other.block.unloadable && other.canUnload() && other.block.hasItems\n                     && ((sortItem == null && other.items.total() > 0) || (sortItem != null && other.items.has(sortItem)))){\n                         //make sure the item can't be dumped back into this block\n                         dumpingTo = other;\n"}}, {"oid": "39136a32676646603f73a24e4beece6d19edfd8a", "url": "https://github.com/Anuken/Mindustry/commit/39136a32676646603f73a24e4beece6d19edfd8a", "message": "unloadable -> canUnload", "committedDate": "2020-12-24T15:32:32Z", "type": "commit"}]}