{"pr_number": 3722, "pr_title": "Fast forward boulder deconstruction", "pr_createdAt": "2020-12-02T15:32:31Z", "pr_url": "https://github.com/Anuken/Mindustry/pull/3722", "timeline": [{"oid": "664cd6a3a0dc5386f2d7887de66bb2bfdcac66ee", "url": "https://github.com/Anuken/Mindustry/commit/664cd6a3a0dc5386f2d7887de66bb2bfdcac66ee", "message": "Update ConstructBlock.java", "committedDate": "2020-12-02T15:26:22Z", "type": "commit"}, {"oid": "e4c3664cc686b7eb1cf1f885f47050abba76495f", "url": "https://github.com/Anuken/Mindustry/commit/e4c3664cc686b7eb1cf1f885f47050abba76495f", "message": "Update ConstructBlock.java", "committedDate": "2020-12-02T15:36:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwNDQ3Mg==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r534304472", "bodyText": "Instead of hardcoding it for boulders, the number should be a special property that is 0 for normal blocks.", "author": "Anuken", "createdAt": "2020-12-02T16:27:17Z", "path": "core/src/mindustry/world/blocks/ConstructBlock.java", "diffHunk": "@@ -288,6 +289,9 @@ public void deconstruct(Unit builder, @Nullable Building core, float amount){\n             }\n \n             progress = Mathf.clamp(progress - amount);\n+            \n+            // fast forward boulder deconstruction when visually already gone\n+            if(progress <= 0.35f && previous instanceof Boulder) progress = 0;", "originalCommit": "e4c3664cc686b7eb1cf1f885f47050abba76495f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwODIyNw==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r534308227", "bodyText": "ok, I'll change it within the hour \ud83d\udc4d", "author": "Quezler", "createdAt": "2020-12-02T16:31:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwNDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMxMDIyNA==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r534310224", "bodyText": "any name suggestions?\n\ndeconstructionFinishesAt\ndeconstructTrigger\ndemolishThreshold\n\nthey just don't sound quite right \ud83e\udd14", "author": "Quezler", "createdAt": "2020-12-02T16:34:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwNDQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMxMjI3MQ==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r534312271", "bodyText": "deconstructThreshold seems appropriate", "author": "Anuken", "createdAt": "2020-12-02T16:37:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMwNDQ3Mg=="}], "type": "inlineReview", "revised_code": {"commit": "435f15a450d6d840d516b07e2f6d64d220a2f884", "chunk": "diff --git a/core/src/mindustry/world/blocks/ConstructBlock.java b/core/src/mindustry/world/blocks/ConstructBlock.java\nindex 226bcf1a0..712911b26 100644\n--- a/core/src/mindustry/world/blocks/ConstructBlock.java\n+++ b/core/src/mindustry/world/blocks/ConstructBlock.java\n\n@@ -289,11 +288,8 @@ public class ConstructBlock extends Block{\n             }\n \n             progress = Mathf.clamp(progress - amount);\n-            \n-            // fast forward boulder deconstruction when visually already gone\n-            if(progress <= 0.35f && previous instanceof Boulder) progress = 0;\n \n-            if(progress <= 0 || state.rules.infiniteResources){\n+            if(progress <= previous.deconstructThreshold || state.rules.infiniteResources){\n                 if(lastBuilder == null) lastBuilder = builder;\n                 Call.deconstructFinish(tile, this.cblock == null ? previous : this.cblock, lastBuilder);\n             }\n"}}, {"oid": "ea96bf26754c1b7a9b2e463631b627d4b2b6ee40", "url": "https://github.com/Anuken/Mindustry/commit/ea96bf26754c1b7a9b2e463631b627d4b2b6ee40", "message": "Update Block.java", "committedDate": "2020-12-02T16:58:58Z", "type": "commit"}, {"oid": "3eac8cb6adce100117347fe66d84101e48d2c5ab", "url": "https://github.com/Anuken/Mindustry/commit/3eac8cb6adce100117347fe66d84101e48d2c5ab", "message": "Update Boulder.java", "committedDate": "2020-12-02T16:59:20Z", "type": "commit"}, {"oid": "435f15a450d6d840d516b07e2f6d64d220a2f884", "url": "https://github.com/Anuken/Mindustry/commit/435f15a450d6d840d516b07e2f6d64d220a2f884", "message": "Update ConstructBlock.java", "committedDate": "2020-12-02T17:00:50Z", "type": "commit"}, {"oid": "129f21e3a946f8d98159c0bb5f56aff4fb7c7a50", "url": "https://github.com/Anuken/Mindustry/commit/129f21e3a946f8d98159c0bb5f56aff4fb7c7a50", "message": "Update Boulder.java", "committedDate": "2020-12-02T17:01:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM2MjkyOA==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r534362928", "bodyText": "I believe it's possible for previous to be null, so check that just in case.", "author": "Anuken", "createdAt": "2020-12-02T17:48:02Z", "path": "core/src/mindustry/world/blocks/ConstructBlock.java", "diffHunk": "@@ -289,7 +289,7 @@ public void deconstruct(Unit builder, @Nullable Building core, float amount){\n \n             progress = Mathf.clamp(progress - amount);\n \n-            if(progress <= 0 || state.rules.infiniteResources){\n+            if(progress <= previous.deconstructThreshold || state.rules.infiniteResources){", "originalCommit": "129f21e3a946f8d98159c0bb5f56aff4fb7c7a50", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2e586c440325ed131590f8bc7a1964b94e545999", "chunk": "diff --git a/core/src/mindustry/world/blocks/ConstructBlock.java b/core/src/mindustry/world/blocks/ConstructBlock.java\nindex 712911b26..17210fefe 100644\n--- a/core/src/mindustry/world/blocks/ConstructBlock.java\n+++ b/core/src/mindustry/world/blocks/ConstructBlock.java\n\n@@ -289,7 +289,7 @@ public class ConstructBlock extends Block{\n \n             progress = Mathf.clamp(progress - amount);\n \n-            if(progress <= previous.deconstructThreshold || state.rules.infiniteResources){\n+            if(progress <= (previous == null ? 0 : previous.deconstructThreshold) || state.rules.infiniteResources){\n                 if(lastBuilder == null) lastBuilder = builder;\n                 Call.deconstructFinish(tile, this.cblock == null ? previous : this.cblock, lastBuilder);\n             }\n"}}, {"oid": "2e586c440325ed131590f8bc7a1964b94e545999", "url": "https://github.com/Anuken/Mindustry/commit/2e586c440325ed131590f8bc7a1964b94e545999", "message": "Update ConstructBlock.java", "committedDate": "2020-12-02T17:54:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczODk2Mg==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r535738962", "bodyText": "Whitespace in the wrong place?", "author": "genNAowl", "createdAt": "2020-12-04T00:09:48Z", "path": "core/src/mindustry/world/Block.java", "diffHunk": "@@ -126,7 +126,7 @@\n     public BlockGroup group = BlockGroup.none;\n     /** List of block flags. Used for AI indexing. */\n     public EnumSet<BlockFlag> flags = EnumSet.of();\n-    /** Targeting priority of this block, as seen by enemies.*/\n+    /** Targeting priority of this block, as seen by enemies .*/", "originalCommit": "2e586c440325ed131590f8bc7a1964b94e545999", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTkwMzA5Nw==", "url": "https://github.com/Anuken/Mindustry/pull/3722#discussion_r535903097", "bodyText": "whoops", "author": "Quezler", "createdAt": "2020-12-04T07:56:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTczODk2Mg=="}], "type": "inlineReview", "revised_code": null}]}