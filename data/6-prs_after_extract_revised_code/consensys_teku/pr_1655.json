{"pr_number": 1655, "pr_title": "append error message to end of help", "pr_createdAt": "2020-04-23T01:32:02Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1655", "timeline": [{"oid": "d4bd4e88e905a035bfbace09148bc1fda31c77d5", "url": "https://github.com/ConsenSys/teku/commit/d4bd4e88e905a035bfbace09148bc1fda31c77d5", "message": "append error message to end of help\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-04-23T01:28:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ0OTMyMA==", "url": "https://github.com/ConsenSys/teku/pull/1655#discussion_r413449320", "bodyText": "nit: These are not constants so should use normal camel case (or be moved to actual constants).", "author": "ajsutton", "createdAt": "2020-04-23T01:47:40Z", "path": "artemis/src/main/java/tech/pegasys/artemis/cli/BeaconNodeCommand.java", "diffHunk": "@@ -217,12 +219,33 @@ private int handleParseException(final CommandLine.ParameterException ex, final\n     errorWriter.println(ex.getMessage());\n \n     if (!CommandLine.UnmatchedArgumentException.printSuggestions(ex, outputWriter)) {\n+      appendErrorMessageToHelp(ex.getCommandLine(), ex.getMessage());\n       ex.getCommandLine().usage(outputWriter, CommandLine.Help.Ansi.AUTO);\n     }\n \n     return ex.getCommandLine().getCommandSpec().exitCodeOnInvalidInput();\n   }\n \n+  private void appendErrorMessageToHelp(CommandLine cmd, String message) {\n+    final String SECTION_KEY_NEW_HEADING = \"errorHeading\";\n+    final String SECTION_KEY_NEW_DETAILS = \"errorContent\";", "originalCommit": "d4bd4e88e905a035bfbace09148bc1fda31c77d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NzE3OA==", "url": "https://github.com/ConsenSys/teku/pull/1655#discussion_r413477178", "bodyText": "fixed", "author": "macfarla", "createdAt": "2020-04-23T03:13:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ0OTMyMA=="}], "type": "inlineReview", "revised_code": {"commit": "55a732065685209ddff11699f335e6e5f5f4b4f2", "chunk": "diff --git a/artemis/src/main/java/tech/pegasys/artemis/cli/BeaconNodeCommand.java b/artemis/src/main/java/tech/pegasys/artemis/cli/BeaconNodeCommand.java\nindex 649d0afdd..832006fac 100644\n--- a/artemis/src/main/java/tech/pegasys/artemis/cli/BeaconNodeCommand.java\n+++ b/artemis/src/main/java/tech/pegasys/artemis/cli/BeaconNodeCommand.java\n\n@@ -218,34 +216,14 @@ public class BeaconNodeCommand implements Callable<Integer> {\n   private int handleParseException(final CommandLine.ParameterException ex, final String[] args) {\n     errorWriter.println(ex.getMessage());\n \n-    if (!CommandLine.UnmatchedArgumentException.printSuggestions(ex, outputWriter)) {\n-      appendErrorMessageToHelp(ex.getCommandLine(), ex.getMessage());\n-      ex.getCommandLine().usage(outputWriter, CommandLine.Help.Ansi.AUTO);\n-    }\n+    CommandLine.UnmatchedArgumentException.printSuggestions(ex, outputWriter);\n+    outputWriter.println();\n+    outputWriter.println(\"To display full help:\");\n+    outputWriter.println(\"teku --help\");\n \n     return ex.getCommandLine().getCommandSpec().exitCodeOnInvalidInput();\n   }\n \n-  private void appendErrorMessageToHelp(CommandLine cmd, String message) {\n-    final String SECTION_KEY_NEW_HEADING = \"errorHeading\";\n-    final String SECTION_KEY_NEW_DETAILS = \"errorContent\";\n-\n-    Map<String, String> env = new LinkedHashMap<>();\n-    env.put(\"ERROR:\", message);\n-    cmd.getHelpSectionMap()\n-        .put(\n-            SECTION_KEY_NEW_HEADING,\n-            help -> help.createHeading(\"%n%nProblem parsing CLI options:%n\"));\n-    cmd.getHelpSectionMap()\n-        .put(SECTION_KEY_NEW_DETAILS, help -> help.createTextTable(env).toString());\n-\n-    List<String> keys = new ArrayList<>(cmd.getHelpSectionKeys());\n-    int index = keys.indexOf(CommandLine.Model.UsageMessageSpec.SECTION_KEY_FOOTER_HEADING);\n-    keys.add(index, SECTION_KEY_NEW_HEADING);\n-    keys.add(index + 1, SECTION_KEY_NEW_DETAILS);\n-    cmd.setHelpSectionKeys(keys);\n-  }\n-\n   @Override\n   public Integer call() {\n     try {\n"}}, {"oid": "55a732065685209ddff11699f335e6e5f5f4b4f2", "url": "https://github.com/ConsenSys/teku/commit/55a732065685209ddff11699f335e6e5f5f4b4f2", "message": "display instructions on how to get help instead of actual help\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-04-23T03:11:06Z", "type": "commit"}, {"oid": "5a5482a99893fa7522a6fe2182b1dc452515bc49", "url": "https://github.com/ConsenSys/teku/commit/5a5482a99893fa7522a6fe2182b1dc452515bc49", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into help-message", "committedDate": "2020-04-23T23:20:56Z", "type": "commit"}, {"oid": "68368515b69fe8c5f92bf5c88547a86040fa1fe4", "url": "https://github.com/ConsenSys/teku/commit/68368515b69fe8c5f92bf5c88547a86040fa1fe4", "message": "added tests\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-04-24T00:34:19Z", "type": "commit"}, {"oid": "201103f3b9996bc556f3ac3490473f3936a2b952", "url": "https://github.com/ConsenSys/teku/commit/201103f3b9996bc556f3ac3490473f3936a2b952", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into help-message", "committedDate": "2020-04-24T00:34:36Z", "type": "commit"}]}