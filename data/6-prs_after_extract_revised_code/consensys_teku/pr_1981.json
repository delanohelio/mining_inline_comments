{"pr_number": 1981, "pr_title": "Added new ValidatorOptions validation rule and improved readability of existing error + tests.", "pr_createdAt": "2020-05-27T13:52:58Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1981", "timeline": [{"oid": "1512c85b8d588792a63a9977aeb33ff23bf45b60", "url": "https://github.com/ConsenSys/teku/commit/1512c85b8d588792a63a9977aeb33ff23bf45b60", "message": "Added new ValidatorOptions validation rule and improved readability of existing error + tests.", "committedDate": "2020-05-27T13:50:04Z", "type": "commit"}, {"oid": "03c109a47cf07452d8852deb7b2d63cff4b4ab1c", "url": "https://github.com/ConsenSys/teku/commit/03c109a47cf07452d8852deb7b2d63cff4b4ab1c", "message": "Build fix.", "committedDate": "2020-05-27T14:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzNzUxMA==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431437510", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' cannot be specified separately\";\n          \n          \n            \n                      \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' must be specified together\";", "author": "macfarla", "createdAt": "2020-05-27T20:57:23Z", "path": "util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java", "diffHunk": "@@ -456,17 +457,30 @@ public void validateConfig() throws IllegalArgumentException {\n               \"Invalid configuration. Interop number of validators [%d] must be greater than or equal to [%d]\",\n               interopNumberOfValidators, Constants.SLOTS_PER_EPOCH));\n     }\n-    validateKeyStoreFilesAndPasswordFilesSize();\n+    validateKeyStoreFilesAndPasswordFilesConfig();\n   }\n \n-  private void validateKeyStoreFilesAndPasswordFilesSize() {\n+  private void validateKeyStoreFilesAndPasswordFilesConfig() {\n     final List<String> validatorKeystoreFiles = getValidatorKeystoreFiles();\n     final List<String> validatorKeystorePasswordFiles = getValidatorKeystorePasswordFiles();\n \n+    if ((validatorKeystoreFiles != null && validatorKeystorePasswordFiles == null)\n+        || (validatorKeystoreFiles == null && validatorKeystorePasswordFiles != null)) {\n+      final String errorMessage =\n+          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' cannot be specified separately\";", "originalCommit": "03c109a47cf07452d8852deb7b2d63cff4b4ab1c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "1de2911eea4bfe03dbc5a027824d321c309e43e7", "chunk": "diff --git a/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java b/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\nindex ea5c2c65aa..fce5d9fa9a 100644\n--- a/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\n+++ b/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\n\n@@ -467,7 +467,7 @@ public class TekuConfiguration {\n     if ((validatorKeystoreFiles != null && validatorKeystorePasswordFiles == null)\n         || (validatorKeystoreFiles == null && validatorKeystorePasswordFiles != null)) {\n       final String errorMessage =\n-          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' cannot be specified separately\";\n+          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' must be specified together\";\n       throw new InvalidConfigurationException(errorMessage);\n     }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODIxMw==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431438213", "bodyText": "number of arguments doesn't seem quite right. The argument is a list, containing a number of items? Size or length might be more accurate", "author": "macfarla", "createdAt": "2020-05-27T20:58:42Z", "path": "util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java", "diffHunk": "@@ -456,17 +457,30 @@ public void validateConfig() throws IllegalArgumentException {\n               \"Invalid configuration. Interop number of validators [%d] must be greater than or equal to [%d]\",\n               interopNumberOfValidators, Constants.SLOTS_PER_EPOCH));\n     }\n-    validateKeyStoreFilesAndPasswordFilesSize();\n+    validateKeyStoreFilesAndPasswordFilesConfig();\n   }\n \n-  private void validateKeyStoreFilesAndPasswordFilesSize() {\n+  private void validateKeyStoreFilesAndPasswordFilesConfig() {\n     final List<String> validatorKeystoreFiles = getValidatorKeystoreFiles();\n     final List<String> validatorKeystorePasswordFiles = getValidatorKeystorePasswordFiles();\n \n+    if ((validatorKeystoreFiles != null && validatorKeystorePasswordFiles == null)\n+        || (validatorKeystoreFiles == null && validatorKeystorePasswordFiles != null)) {\n+      final String errorMessage =\n+          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' cannot be specified separately\";\n+      throw new InvalidConfigurationException(errorMessage);\n+    }\n+\n     if (validatorKeystoreFiles.size() != validatorKeystorePasswordFiles.size()) {\n+      StatusLogger.getLogger()\n+          .debug(\n+              \"Invalid configuration. The size of validator.validatorsKeystoreFiles {} and validator.validatorsKeystorePasswordFiles {} must match\",\n+              validatorKeystoreFiles.size(),\n+              validatorKeystorePasswordFiles.size());\n+\n       final String errorMessage =\n           String.format(\n-              \"Invalid configuration. The size of validator.validatorsKeystoreFiles [%d] and validator.validatorsKeystorePasswordFiles [%d] must match\",\n+              \"Invalid configuration. The number of arguments for --validators-key-files [%d] and --validators-key-password-files [%d] must match\",", "originalCommit": "03c109a47cf07452d8852deb7b2d63cff4b4ab1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ3NDgzNg==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431474836", "bodyText": "We're trying to make it more human-readable, imo referring to the number of items in a list as size or length is confusing.\nPerhaps something more like:\n\"The number of files specified for --validators-key-files [%d] and --validators-key-password-files [%d] must match\" ?", "author": "mark-terry", "createdAt": "2020-05-27T22:18:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ4NTg0Ng==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431485846", "bodyText": "each key file specified by --validators-keys-files must also have a password file specified by --validators-key-password-files?", "author": "rolfyone", "createdAt": "2020-05-27T22:48:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ4NjEzNg==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431486136", "bodyText": "you must specify the same number of key and password files?", "author": "macfarla", "createdAt": "2020-05-27T22:49:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODIxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTUxMDgwNg==", "url": "https://github.com/ConsenSys/teku/pull/1981#discussion_r431510806", "bodyText": "The number of --validators-key-files (num) must equal the number of --validators-key-password-files (num)", "author": "mark-terry", "createdAt": "2020-05-28T00:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzODIxMw=="}], "type": "inlineReview", "revised_code": {"commit": "1de2911eea4bfe03dbc5a027824d321c309e43e7", "chunk": "diff --git a/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java b/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\nindex ea5c2c65aa..fce5d9fa9a 100644\n--- a/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\n+++ b/util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\n\n@@ -467,7 +467,7 @@ public class TekuConfiguration {\n     if ((validatorKeystoreFiles != null && validatorKeystorePasswordFiles == null)\n         || (validatorKeystoreFiles == null && validatorKeystorePasswordFiles != null)) {\n       final String errorMessage =\n-          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' cannot be specified separately\";\n+          \"Invalid configuration. '--validators-key-files' and '--validators-key-password-files' must be specified together\";\n       throw new InvalidConfigurationException(errorMessage);\n     }\n \n"}}, {"oid": "1de2911eea4bfe03dbc5a027824d321c309e43e7", "url": "https://github.com/ConsenSys/teku/commit/1de2911eea4bfe03dbc5a027824d321c309e43e7", "message": "Update util/src/main/java/tech/pegasys/teku/util/config/TekuConfiguration.java\n\nCo-authored-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-05-27T22:42:03Z", "type": "commit"}, {"oid": "3357680ad409a5bfeb280a0b629c30bfdf1fe5e6", "url": "https://github.com/ConsenSys/teku/commit/3357680ad409a5bfeb280a0b629c30bfdf1fe5e6", "message": "Altered exception message.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-28T12:34:49Z", "type": "commit"}, {"oid": "9b22f1221cf06134647232efca26511ee943e3ea", "url": "https://github.com/ConsenSys/teku/commit/9b22f1221cf06134647232efca26511ee943e3ea", "message": "Merge branch 'master' into 1774", "committedDate": "2020-05-28T12:35:43Z", "type": "commit"}, {"oid": "1fae06853e4050fcef38c638e3bd434385fb5962", "url": "https://github.com/ConsenSys/teku/commit/1fae06853e4050fcef38c638e3bd434385fb5962", "message": "Merge branch 'master' into 1774", "committedDate": "2020-05-28T23:44:48Z", "type": "commit"}, {"oid": "a4fedba65b25406704328a43a051700d10e765c5", "url": "https://github.com/ConsenSys/teku/commit/a4fedba65b25406704328a43a051700d10e765c5", "message": "String fixes.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-28T23:56:01Z", "type": "commit"}, {"oid": "f751aeaed6a78f97ab625bb84c739b3e9749c139", "url": "https://github.com/ConsenSys/teku/commit/f751aeaed6a78f97ab625bb84c739b3e9749c139", "message": "Spotless.\n\nSigned-off-by: Mark Terry <mark.terry@consensys.net>", "committedDate": "2020-05-28T23:59:54Z", "type": "commit"}]}