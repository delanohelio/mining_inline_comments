{"pr_number": 3101, "pr_title": "Handle requests for a single block by slot or root not returning any result", "pr_createdAt": "2020-10-28T04:34:22Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3101", "timeline": [{"oid": "8f303be3b5cef0251fad64b095fd9d5b10a00c2d", "url": "https://github.com/ConsenSys/teku/commit/8f303be3b5cef0251fad64b095fd9d5b10a00c2d", "message": "Handle requests for a single block by slot or root not returning any results.", "committedDate": "2020-10-28T04:33:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYxMjM5MA==", "url": "https://github.com/ConsenSys/teku/pull/3101#discussion_r513612390", "bodyText": "We can cut this exceptionally call now \ud83c\udf89", "author": "mbaxter", "createdAt": "2020-10-28T17:01:51Z", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java", "diffHunk": "@@ -183,8 +183,6 @@ private boolean isForkValid(final Eth2Peer peer, final PeerStatus status) {\n       LOG.trace(\n           \"Request required checkpoint block from peer {}: {}\", peer.getId(), checkpointToVerify);\n       return peer.requestBlockByRoot(checkpointToVerify.getRoot())\n-          // Map result to an optional block\n-          .thenApply(Optional::of)\n           .exceptionally(\n               err -> {\n                 if (Throwables.getRootCause(err) instanceof NullPointerException) {", "originalCommit": "8f303be3b5cef0251fad64b095fd9d5b10a00c2d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "3fa24d007234d4bcc43090b89d3e742af332d77a", "chunk": "diff --git a/networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java b/networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java\nindex 97f503d89..c5177b139 100644\n--- a/networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java\n+++ b/networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java\n\n@@ -183,13 +182,6 @@ public class PeerChainValidator {\n       LOG.trace(\n           \"Request required checkpoint block from peer {}: {}\", peer.getId(), checkpointToVerify);\n       return peer.requestBlockByRoot(checkpointToVerify.getRoot())\n-          .exceptionally(\n-              err -> {\n-                if (Throwables.getRootCause(err) instanceof NullPointerException) {\n-                  return Optional.empty();\n-                }\n-                throw new RuntimeException(err);\n-              })\n           // When requesting block by root, there is no explicit guarantee that the block is\n           // canonical.\n           // So, double-check by requesting the block by slot to make sure the peer considers this\n"}}, {"oid": "3fa24d007234d4bcc43090b89d3e742af332d77a", "url": "https://github.com/ConsenSys/teku/commit/3fa24d007234d4bcc43090b89d3e742af332d77a", "message": "Remove unnecessary exception handling.", "committedDate": "2020-10-28T19:52:19Z", "type": "commit"}, {"oid": "3d656c0faab4a0b513dafd68e438c6d27ffbcc47", "url": "https://github.com/ConsenSys/teku/commit/3d656c0faab4a0b513dafd68e438c6d27ffbcc47", "message": "Merge branch 'master' of github.com:ConsenSys/teku into get-optional-block", "committedDate": "2020-10-28T20:03:57Z", "type": "commit"}, {"oid": "bf364e4c1a9286fbc46721733a95eb93cb892f06", "url": "https://github.com/ConsenSys/teku/commit/bf364e4c1a9286fbc46721733a95eb93cb892f06", "message": "Update test as well.", "committedDate": "2020-10-28T20:14:04Z", "type": "commit"}]}