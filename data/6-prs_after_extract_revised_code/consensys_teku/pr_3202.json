{"pr_number": 3202, "pr_title": "Add CLI option to disable built-in slashing protection for external signers", "pr_createdAt": "2020-11-12T01:48:25Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3202", "timeline": [{"oid": "000afe1a666ab5916acf3b0f1fddd18bd95c988f", "url": "https://github.com/ConsenSys/teku/commit/000afe1a666ab5916acf3b0f1fddd18bd95c988f", "message": "Add CLI option to disable built-in slashing protection for external signers.", "committedDate": "2020-11-12T01:41:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3OTUxNw==", "url": "https://github.com/ConsenSys/teku/pull/3202#discussion_r521779517", "bodyText": "i would just make this --validators-internal-slashing-protection-enabled", "author": "rolfyone", "createdAt": "2020-11-12T02:34:02Z", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java", "diffHunk": "@@ -75,6 +75,14 @@\n       arity = \"1\")\n   private String validatorExternalSignerUrl = null;\n \n+  @Option(\n+      names = {\"--validators-external-signer-slashing-protection-enabled\"},\n+      paramLabel = \"<BOOLEAN>\",\n+      description = \"Enable internal slashing protection for external signers. Default: true\",\n+      fallbackValue = \"true\",\n+      arity = \"0..1\")\n+  private boolean validatorExternalSignerSlashingProtectionEnabled = true;", "originalCommit": "000afe1a666ab5916acf3b0f1fddd18bd95c988f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc4NDIxMg==", "url": "https://github.com/ConsenSys/teku/pull/3202#discussion_r521784212", "bodyText": "The pretty much the exact opposite of what it does.  It controls only whether the external signers have slashing protection.  The internal signers always have slashing protection enabled and there's no option to disable it.", "author": "ajsutton", "createdAt": "2020-11-12T02:50:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc3OTUxNw=="}], "type": "inlineReview", "revised_code": {"commit": "82cf0dc9289d13bda2bb0a1c85619f95713b775e", "chunk": "diff --git a/teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java b/teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java\nindex 8d6b9e5ad..18af7053e 100644\n--- a/teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java\n+++ b/teku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java\n\n@@ -13,82 +13,17 @@\n \n package tech.pegasys.teku.cli.options;\n \n-import com.google.common.base.Strings;\n-import java.net.MalformedURLException;\n-import java.net.URL;\n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.List;\n-import java.util.stream.Collectors;\n-import org.apache.tuweni.bytes.Bytes;\n import org.apache.tuweni.bytes.Bytes32;\n+import picocli.CommandLine;\n import picocli.CommandLine.Option;\n-import tech.pegasys.teku.bls.BLSPublicKey;\n import tech.pegasys.teku.cli.converter.GraffitiConverter;\n import tech.pegasys.teku.config.TekuConfiguration;\n-import tech.pegasys.teku.util.config.InvalidConfigurationException;\n import tech.pegasys.teku.util.config.ValidatorPerformanceTrackingMode;\n \n public class ValidatorOptions {\n-  @Option(\n-      names = {\"--validator-keys\"},\n-      paramLabel = \"<KEY_DIR>:<PASS_DIR> | <KEY_FILE>:<PASS_FILE>\",\n-      description =\n-          \"<KEY_DIR>:<PASS_DIR> will find <KEY_DIR>/**.json, and expect to find <PASS_DIR>/**.txt.\\n\"\n-              + \"<KEY_FILE>:<PASS_FILE> will expect that the file <KEY_FILE> exists, \"\n-              + \"and the file containing the password for it is <PASS_FILE>.\\n\"\n-              + \"The path separator is operating system dependent, and should be ';' in windows rather than ':'.\",\n-      split = \",\",\n-      arity = \"1..*\")\n-  private List<String> validatorKeys = new ArrayList<>();\n-\n-  @Option(\n-      names = {\"--validators-key-files\"},\n-      paramLabel = \"<FILENAMES>\",\n-      description = \"The list of encrypted keystore files to load the validator keys from\",\n-      split = \",\",\n-      hidden = true,\n-      arity = \"0..*\")\n-  private List<String> validatorKeystoreFiles = new ArrayList<>();\n-\n-  @Option(\n-      names = {\"--validators-key-password-files\"},\n-      paramLabel = \"<FILENAMES>\",\n-      description = \"The list of password files to decrypt the validator keystore files\",\n-      split = \",\",\n-      hidden = true,\n-      arity = \"0..*\")\n-  private List<String> validatorKeystorePasswordFiles = new ArrayList<>();\n-\n-  @Option(\n-      names = {\"--validators-external-signer-public-keys\"},\n-      paramLabel = \"<STRINGS>\",\n-      description = \"The list of external signer public keys\",\n-      split = \",\",\n-      arity = \"0..*\")\n-  private List<String> validatorExternalSignerPublicKeys = new ArrayList<>();\n-\n-  @Option(\n-      names = {\"--validators-external-signer-url\"},\n-      paramLabel = \"<NETWORK>\",\n-      description = \"URL for the external signing service\",\n-      arity = \"1\")\n-  private String validatorExternalSignerUrl = null;\n \n-  @Option(\n-      names = {\"--validators-external-signer-slashing-protection-enabled\"},\n-      paramLabel = \"<BOOLEAN>\",\n-      description = \"Enable internal slashing protection for external signers. Default: true\",\n-      fallbackValue = \"true\",\n-      arity = \"0..1\")\n-  private boolean validatorExternalSignerSlashingProtectionEnabled = true;\n-\n-  @Option(\n-      names = {\"--validators-external-signer-timeout\"},\n-      paramLabel = \"<INTEGER>\",\n-      description = \"Timeout (in milliseconds) for the external signing service\",\n-      arity = \"1\")\n-  private int validatorExternalSignerTimeout = 1000;\n+  @CommandLine.Mixin(name = \"Validator Keys\")\n+  private ValidatorKeysOptions validatorKeysOptions;\n \n   @Option(\n       names = {\"--validators-graffiti\"},\n"}}, {"oid": "82cf0dc9289d13bda2bb0a1c85619f95713b775e", "url": "https://github.com/ConsenSys/teku/commit/82cf0dc9289d13bda2bb0a1c85619f95713b775e", "message": "Merge branch 'master' of github.com:ConsenSys/teku into support-disabling-slashing-protection\n\n# Conflicts:\n#\tteku/src/main/java/tech/pegasys/teku/cli/options/ValidatorOptions.java\n#\tteku/src/main/java/tech/pegasys/teku/cli/subcommand/VoluntaryExitCommand.java\n#\tvalidator/client/src/main/java/tech/pegasys/teku/validator/client/ValidatorClientService.java", "committedDate": "2020-11-12T20:02:18Z", "type": "commit"}]}