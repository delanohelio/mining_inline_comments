{"pr_number": 1401, "pr_title": "add custom 404 page for when swagger is enabled", "pr_createdAt": "2020-03-18T02:35:46Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1401", "timeline": [{"oid": "6e708ae675510721fcd0e7cdea47892ff09d61f1", "url": "https://github.com/ConsenSys/teku/commit/6e708ae675510721fcd0e7cdea47892ff09d61f1", "message": "add custom 404 page for when swagger is enabled", "committedDate": "2020-03-18T02:34:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA3ODk0Nw==", "url": "https://github.com/ConsenSys/teku/pull/1401#discussion_r394078947", "bodyText": "nit: should prob pull the filename out as a constant", "author": "macfarla", "createdAt": "2020-03-18T02:51:58Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -50,14 +58,37 @@\n public class BeaconRestApi {\n   private final Javalin app;\n   private final JsonProvider jsonProvider = new JsonProvider();\n+  private static final Logger LOG = LogManager.getLogger();\n \n-  private void initialise(final DataProvider dataProvider, final int requestedPortNumber) {\n-    app.server().setServerPort(requestedPortNumber);\n+  private void initialise(\n+      final DataProvider dataProvider, final ArtemisConfiguration configuration) {\n+    app.server().setServerPort(configuration.getBeaconRestAPIPortNumber());\n \n     addBeaconHandlers(dataProvider);\n     addNetworkHandlers(dataProvider.getNetworkDataProvider());\n     addNodeHandlers(dataProvider);\n     addValidatorHandlers(dataProvider);\n+    addCustomErrorPages(configuration);\n+  }\n+\n+  private void addCustomErrorPages(final ArtemisConfiguration configuration) {\n+    if (configuration.getBeaconRestAPIEnableSwagger()) {\n+      try {\n+        String content = readResource(\"404.html\", Charsets.UTF_8);", "originalCommit": "6e708ae675510721fcd0e7cdea47892ff09d61f1", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "b4b070a21f8d468296e2bf685ac667f80ee4e3aa", "chunk": "diff --git a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\nindex 0c8e18e3b4..0027a680d8 100644\n--- a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n+++ b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n\n@@ -59,6 +59,7 @@ public class BeaconRestApi {\n   private final Javalin app;\n   private final JsonProvider jsonProvider = new JsonProvider();\n   private static final Logger LOG = LogManager.getLogger();\n+  public static final String FILE_NOT_FOUND_HTML = \"404.html\";\n \n   private void initialise(\n       final DataProvider dataProvider, final ArtemisConfiguration configuration) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA3OTY2MQ==", "url": "https://github.com/ConsenSys/teku/pull/1401#discussion_r394079661", "bodyText": "do we need to use jetty 404?", "author": "macfarla", "createdAt": "2020-03-18T02:54:38Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -13,14 +13,22 @@\n \n package tech.pegasys.artemis.beaconrestapi;\n \n+import static org.eclipse.jetty.http.HttpStatus.NOT_FOUND_404;", "originalCommit": "6e708ae675510721fcd0e7cdea47892ff09d61f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA4ODg3Ng==", "url": "https://github.com/ConsenSys/teku/pull/1401#discussion_r394088876", "bodyText": "hrm no that's what it imported, i'll see if there's a better option", "author": "rolfyone", "createdAt": "2020-03-18T03:33:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA3OTY2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "b4b070a21f8d468296e2bf685ac667f80ee4e3aa", "chunk": "diff --git a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\nindex 0c8e18e3b4..0027a680d8 100644\n--- a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n+++ b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n\n@@ -13,7 +13,7 @@\n \n package tech.pegasys.artemis.beaconrestapi;\n \n-import static org.eclipse.jetty.http.HttpStatus.NOT_FOUND_404;\n+import static javax.servlet.http.HttpServletResponse.SC_NOT_FOUND;\n \n import com.google.common.io.Resources;\n import io.javalin.Javalin;\n"}}, {"oid": "b4b070a21f8d468296e2bf685ac667f80ee4e3aa", "url": "https://github.com/ConsenSys/teku/commit/b4b070a21f8d468296e2bf685ac667f80ee4e3aa", "message": "review feedback", "committedDate": "2020-03-18T03:43:00Z", "type": "commit"}, {"oid": "4f1a3c6192037967752286c2e3b0979512b40831", "url": "https://github.com/ConsenSys/teku/commit/4f1a3c6192037967752286c2e3b0979512b40831", "message": "Merge remote-tracking branch 'upstream/master' into custom-404", "committedDate": "2020-03-18T03:55:53Z", "type": "commit"}, {"oid": "7edfbf49670fb3decba79f32479bb7be580a1459", "url": "https://github.com/ConsenSys/teku/commit/7edfbf49670fb3decba79f32479bb7be580a1459", "message": "Merge remote-tracking branch 'upstream/master' into custom-404", "committedDate": "2020-03-18T20:13:29Z", "type": "commit"}]}