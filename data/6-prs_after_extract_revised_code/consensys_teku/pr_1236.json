{"pr_number": 1236, "pr_title": "allow swagger endpoints to be disabled via configuration item.", "pr_createdAt": "2020-02-27T03:06:30Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1236", "timeline": [{"oid": "c2f06b6c58a9e8149b9c718f7eaf274cb9c63a7d", "url": "https://github.com/ConsenSys/teku/commit/c2f06b6c58a9e8149b9c718f7eaf274cb9c63a7d", "message": "allow swagger endpoints to be disabled via configuration item.\n\nadded enableSwagger to config.toml, and defaulted to true.\n\nWhen enableSwagger is set to false, both swagger-docs and swagger-ui become unavailable.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>\n\n#1227", "committedDate": "2020-02-27T03:05:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg5MzEyNg==", "url": "https://github.com/ConsenSys/teku/pull/1236#discussion_r384893126", "bodyText": "ohhh 12345 had a certain ring to it", "author": "macfarla", "createdAt": "2020-02-27T03:17:14Z", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java", "diffHunk": "@@ -41,12 +42,15 @@\n       mock(CombinedChainDataClient.class);\n   private final JavalinServer server = mock(JavalinServer.class);\n   private final Javalin app = mock(Javalin.class);\n-  private static final Integer THE_PORT = 12345;\n+  private static final Integer THE_PORT = 5051;", "originalCommit": "c2f06b6c58a9e8149b9c718f7eaf274cb9c63a7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bf27554fb1b55a6f6ed3f5552a5be5013ceac243", "chunk": "diff --git a/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java b/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\nindex 12d809def0..f7a97881b5 100644\n--- a/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\n+++ b/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\n\n@@ -42,13 +42,14 @@ class BeaconRestApiTest {\n       mock(CombinedChainDataClient.class);\n   private final JavalinServer server = mock(JavalinServer.class);\n   private final Javalin app = mock(Javalin.class);\n-  private static final Integer THE_PORT = 5051;\n+  private static final Integer THE_PORT = 12345;\n+  private static final String THE_CONFIG =\n+      String.format(\n+          \"beaconrestapi.portNumber=%d\\nbeaconrestapi.enableSwagger=%s\", THE_PORT, \"false\");\n \n   @BeforeEach\n   public void setup() {\n-    ArtemisConfiguration config =\n-        ArtemisConfiguration.fromString(\n-            \"beaconrestapi.portNumber=5051\\nbeaconrestapi.enableSwagger=false\");\n+    ArtemisConfiguration config = ArtemisConfiguration.fromString(THE_CONFIG);\n     when(app.server()).thenReturn(server);\n     new BeaconRestApi(storageClient, null, null, combinedChainDataClient, config, app);\n   }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg5MzQ2Mg==", "url": "https://github.com/ConsenSys/teku/pull/1236#discussion_r384893462", "bodyText": "final", "author": "macfarla", "createdAt": "2020-02-27T03:18:44Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -132,14 +135,10 @@ private static OpenApiOptions getOpenApiOptions(JsonProvider jsonProvider) {\n                 new License()\n                     .name(\"Apache 2.0\")\n                     .url(\"https://www.apache.org/licenses/LICENSE-2.0.html\"));\n-    OpenApiOptions options =\n-        new OpenApiOptions(applicationInfo)\n-            //            .jacksonMapper(factory.getObjectMapper())\n-            .modelConverterFactory(factory)\n-            .path(\"/swagger-docs\")\n-            .swagger(new SwaggerOptions(\"/swagger-ui\"));\n-    // TODO: allow swagger-ui to be turned off - ideally still leave swagger-docs, just dont add the\n-    // swagger-ui endpoint\n+    OpenApiOptions options = new OpenApiOptions(applicationInfo).modelConverterFactory(factory);", "originalCommit": "c2f06b6c58a9e8149b9c718f7eaf274cb9c63a7d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bf27554fb1b55a6f6ed3f5552a5be5013ceac243", "chunk": "diff --git a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\nindex 15ba9401e6..f72172adaa 100644\n--- a/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n+++ b/data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApi.java\n\n@@ -135,7 +135,8 @@ public class BeaconRestApi {\n                 new License()\n                     .name(\"Apache 2.0\")\n                     .url(\"https://www.apache.org/licenses/LICENSE-2.0.html\"));\n-    OpenApiOptions options = new OpenApiOptions(applicationInfo).modelConverterFactory(factory);\n+    final OpenApiOptions options =\n+        new OpenApiOptions(applicationInfo).modelConverterFactory(factory);\n     if (config.getBeaconRestAPIEnableSwagger()) {\n       options.path(\"/swagger-docs\").swagger(new SwaggerOptions(\"/swagger-ui\"));\n     }\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg5MzU5MQ==", "url": "https://github.com/ConsenSys/teku/pull/1236#discussion_r384893591", "bodyText": "can 5051 not be hardcoded in here", "author": "macfarla", "createdAt": "2020-02-27T03:19:21Z", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java", "diffHunk": "@@ -41,12 +42,15 @@\n       mock(CombinedChainDataClient.class);\n   private final JavalinServer server = mock(JavalinServer.class);\n   private final Javalin app = mock(Javalin.class);\n-  private static final Integer THE_PORT = 12345;\n+  private static final Integer THE_PORT = 5051;\n \n   @BeforeEach\n   public void setup() {\n+    ArtemisConfiguration config =\n+        ArtemisConfiguration.fromString(\n+            \"beaconrestapi.portNumber=5051\\nbeaconrestapi.enableSwagger=false\");", "originalCommit": "c2f06b6c58a9e8149b9c718f7eaf274cb9c63a7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg5NTg3MQ==", "url": "https://github.com/ConsenSys/teku/pull/1236#discussion_r384895871", "bodyText": "it's just configuring the configuration object for the test suite... alternative?", "author": "rolfyone", "createdAt": "2020-02-27T03:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDg5MzU5MQ=="}], "type": "inlineReview", "revised_code": {"commit": "bf27554fb1b55a6f6ed3f5552a5be5013ceac243", "chunk": "diff --git a/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java b/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\nindex 12d809def0..f7a97881b5 100644\n--- a/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\n+++ b/data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/BeaconRestApiTest.java\n\n@@ -42,13 +42,14 @@ class BeaconRestApiTest {\n       mock(CombinedChainDataClient.class);\n   private final JavalinServer server = mock(JavalinServer.class);\n   private final Javalin app = mock(Javalin.class);\n-  private static final Integer THE_PORT = 5051;\n+  private static final Integer THE_PORT = 12345;\n+  private static final String THE_CONFIG =\n+      String.format(\n+          \"beaconrestapi.portNumber=%d\\nbeaconrestapi.enableSwagger=%s\", THE_PORT, \"false\");\n \n   @BeforeEach\n   public void setup() {\n-    ArtemisConfiguration config =\n-        ArtemisConfiguration.fromString(\n-            \"beaconrestapi.portNumber=5051\\nbeaconrestapi.enableSwagger=false\");\n+    ArtemisConfiguration config = ArtemisConfiguration.fromString(THE_CONFIG);\n     when(app.server()).thenReturn(server);\n     new BeaconRestApi(storageClient, null, null, combinedChainDataClient, config, app);\n   }\n"}}, {"oid": "bf27554fb1b55a6f6ed3f5552a5be5013ceac243", "url": "https://github.com/ConsenSys/teku/commit/bf27554fb1b55a6f6ed3f5552a5be5013ceac243", "message": "changes per review comments.", "committedDate": "2020-02-27T03:40:09Z", "type": "commit"}, {"oid": "ca58fe7fa05e8fe13ff263b22ca82d89d0e01b95", "url": "https://github.com/ConsenSys/teku/commit/ca58fe7fa05e8fe13ff263b22ca82d89d0e01b95", "message": "Merge remote-tracking branch 'upstream/master' into 1227-config-item-for-swagger", "committedDate": "2020-02-27T03:47:26Z", "type": "commit"}, {"oid": "4268ddd03b8be8a6615ad903557a89056583d93e", "url": "https://github.com/ConsenSys/teku/commit/4268ddd03b8be8a6615ad903557a89056583d93e", "message": "Merge remote-tracking branch 'upstream/master' into 1227-config-item-for-swagger", "committedDate": "2020-02-27T20:34:03Z", "type": "commit"}, {"oid": "94ddf701b801f9b6447e6a9641ac74fb64e6e4d5", "url": "https://github.com/ConsenSys/teku/commit/94ddf701b801f9b6447e6a9641ac74fb64e6e4d5", "message": "fix AT with config changes. this is a bit of a left-field thing with the config being hand written for testing.", "committedDate": "2020-02-27T22:26:26Z", "type": "commit"}, {"oid": "9724100ea4adcfadce96affb48b90dafa778e6b6", "url": "https://github.com/ConsenSys/teku/commit/9724100ea4adcfadce96affb48b90dafa778e6b6", "message": "Merge remote-tracking branch 'upstream/master' into 1227-config-item-for-swagger", "committedDate": "2020-02-28T00:41:11Z", "type": "commit"}]}