{"pr_number": 2875, "pr_title": "Cache block roots", "pr_createdAt": "2020-10-01T19:18:29Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2875", "timeline": [{"oid": "e505f4a73227a611e13c146a0854bd7e6198cdd1", "url": "https://github.com/ConsenSys/teku/commit/e505f4a73227a611e13c146a0854bd7e6198cdd1", "message": "Cache block roots", "committedDate": "2020-10-01T19:17:44Z", "type": "commit"}, {"oid": "ff236b704aaa0c1cb717949c50f0c1e0a381ad14", "url": "https://github.com/ConsenSys/teku/commit/ff236b704aaa0c1cb717949c50f0c1e0a381ad14", "message": "Run spotless", "committedDate": "2020-10-01T19:17:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NDg4Ng==", "url": "https://github.com/ConsenSys/teku/pull/2875#discussion_r498474886", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public Bytes32 getRoot() {\n          \n          \n            \n              private Bytes32 calculateRoot() {", "author": "mbaxter", "createdAt": "2020-10-01T19:43:00Z", "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java", "diffHunk": "@@ -146,6 +152,10 @@ public UInt64 getProposer_index() {\n \n   @Override\n   public Bytes32 hash_tree_root() {\n+    return hashTreeRoot.get();\n+  }\n+\n+  public Bytes32 getRoot() {", "originalCommit": "ff236b704aaa0c1cb717949c50f0c1e0a381ad14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5OTkzMQ==", "url": "https://github.com/ConsenSys/teku/pull/2875#discussion_r498499931", "bodyText": "Done.", "author": "cemozerr", "createdAt": "2020-10-01T20:37:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NDg4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "f507b169a72be174c667074a3b4f1d01d1975016", "chunk": "diff --git a/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java b/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\nindex bbf563717c..da62c31c7b 100644\n--- a/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\n+++ b/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\n\n@@ -155,7 +162,7 @@ public final class BeaconBlock implements Merkleizable, SimpleOffsetSerializable\n     return hashTreeRoot.get();\n   }\n \n-  public Bytes32 getRoot() {\n+  public Bytes32 calculateRoot() {\n     return HashTreeUtil.merkleize(\n         Arrays.asList(\n             HashTreeUtil.hash_tree_root(SSZTypes.BASIC, SSZ.encodeUInt64(slot.longValue())),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NDkzMQ==", "url": "https://github.com/ConsenSys/teku/pull/2875#discussion_r498474931", "bodyText": "Looks like we should also do this for BlockBody", "author": "mbaxter", "createdAt": "2020-10-01T19:43:06Z", "path": "ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java", "diffHunk": "@@ -42,6 +45,9 @@\n   // Body\n   private BeaconBlockBody body;", "originalCommit": "ff236b704aaa0c1cb717949c50f0c1e0a381ad14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwNTQ2OA==", "url": "https://github.com/ConsenSys/teku/pull/2875#discussion_r498505468", "bodyText": "Makes sense.", "author": "cemozerr", "createdAt": "2020-10-01T20:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ3NDkzMQ=="}], "type": "inlineReview", "revised_code": {"commit": "f507b169a72be174c667074a3b4f1d01d1975016", "chunk": "diff --git a/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java b/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\nindex bbf563717c..da62c31c7b 100644\n--- a/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\n+++ b/ethereum/datastructures/src/main/java/tech/pegasys/teku/datastructures/blocks/BeaconBlock.java\n\n@@ -31,22 +27,27 @@ import tech.pegasys.teku.infrastructure.unsigned.UInt64;\n import tech.pegasys.teku.ssz.SSZTypes.SSZContainer;\n import tech.pegasys.teku.ssz.sos.SimpleOffsetSerializable;\n \n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.function.Supplier;\n+\n public final class BeaconBlock implements Merkleizable, SimpleOffsetSerializable, SSZContainer {\n \n   // The number of SimpleSerialize basic types in this SSZ Container/POJO.\n   public static final int SSZ_FIELD_COUNT = 4;\n \n   // Header\n-  private UInt64 slot;\n-  private UInt64 proposer_index;\n-  private Bytes32 parent_root;\n-  private Bytes32 state_root;\n+  private final UInt64 slot;\n+  private final UInt64 proposer_index;\n+  private final Bytes32 parent_root;\n+  private final Bytes32 state_root;\n \n   // Body\n-  private BeaconBlockBody body;\n+  private final BeaconBlockBody body;\n \n   @Label(\"sos-ignore\")\n-  private final Supplier<Bytes32> hashTreeRoot = Suppliers.memoize(this::getRoot);\n+  private final Supplier<Bytes32> hashTreeRoot = Suppliers.memoize(this::calculateRoot);\n \n   public BeaconBlock(\n       UInt64 slot,\n"}}, {"oid": "f507b169a72be174c667074a3b4f1d01d1975016", "url": "https://github.com/ConsenSys/teku/commit/f507b169a72be174c667074a3b4f1d01d1975016", "message": "Make beacon block final", "committedDate": "2020-10-01T20:47:37Z", "type": "commit"}, {"oid": "44fd856b6a0aba248db0fe6dc14cfe1ec7346dc9", "url": "https://github.com/ConsenSys/teku/commit/44fd856b6a0aba248db0fe6dc14cfe1ec7346dc9", "message": "Cache beacon block body root", "committedDate": "2020-10-01T20:48:36Z", "type": "commit"}, {"oid": "8d77a62eda0a0d34d9088aaeb8ba4e269efbe15f", "url": "https://github.com/ConsenSys/teku/commit/8d77a62eda0a0d34d9088aaeb8ba4e269efbe15f", "message": "Cache signed beacon block root", "committedDate": "2020-10-01T20:49:34Z", "type": "commit"}, {"oid": "dc12f1c3b3e99eb8317729ede57b22ddd8b5c3d4", "url": "https://github.com/ConsenSys/teku/commit/dc12f1c3b3e99eb8317729ede57b22ddd8b5c3d4", "message": "Run spotless", "committedDate": "2020-10-01T20:49:46Z", "type": "commit"}, {"oid": "343d63ba11ddfcd86b00324318006a487196d63d", "url": "https://github.com/ConsenSys/teku/commit/343d63ba11ddfcd86b00324318006a487196d63d", "message": "Merge branch 'master' into cacheBlockRoots", "committedDate": "2020-10-01T20:50:24Z", "type": "commit"}]}