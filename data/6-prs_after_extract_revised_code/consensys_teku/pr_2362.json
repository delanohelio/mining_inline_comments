{"pr_number": 2362, "pr_title": "Deliver EventChannel responses on a publisher owned thread", "pr_createdAt": "2020-07-16T06:44:49Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2362", "timeline": [{"oid": "2e4fd954c597149b53ffb5c37e05afc883d839d2", "url": "https://github.com/ConsenSys/teku/commit/2e4fd954c597149b53ffb5c37e05afc883d839d2", "message": "Unbounded response threads.", "committedDate": "2020-07-16T04:04:06Z", "type": "commit"}, {"oid": "42481c51c5a78b5232e6eaf9317fc93640a0b5a4", "url": "https://github.com/ConsenSys/teku/commit/42481c51c5a78b5232e6eaf9317fc93640a0b5a4", "message": "Limit the number of threads that can be created to deliver responses.", "committedDate": "2020-07-16T04:43:39Z", "type": "commit"}, {"oid": "b1de33a3607981ae0ac98df09e74d471e2210e28", "url": "https://github.com/ConsenSys/teku/commit/b1de33a3607981ae0ac98df09e74d471e2210e28", "message": "Require specifying an async runner for callbacks when creating a publisher to an event channel that provides return values.", "committedDate": "2020-07-16T05:18:10Z", "type": "commit"}, {"oid": "be3aad1662bdd730b2c9603dc2d8793e758edf44", "url": "https://github.com/ConsenSys/teku/commit/be3aad1662bdd730b2c9603dc2d8793e758edf44", "message": "Deliver responses via an AsyncRunner provided when the publisher is created so responses are handled on a thread owned by the calling service, not the subscribing one.", "committedDate": "2020-07-16T06:24:24Z", "type": "commit"}, {"oid": "6256a8ecef972a1b8ed8554d68aa8549f5272631", "url": "https://github.com/ConsenSys/teku/commit/6256a8ecef972a1b8ed8554d68aa8549f5272631", "message": "Rename and add comments.", "committedDate": "2020-07-16T06:42:35Z", "type": "commit"}, {"oid": "3070c710c4102aaddabd86fe96529bd0cba9b5b0", "url": "https://github.com/ConsenSys/teku/commit/3070c710c4102aaddabd86fe96529bd0cba9b5b0", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into deliver-response-async", "committedDate": "2020-07-16T06:46:13Z", "type": "commit"}, {"oid": "ba415f8d15d0f9d7125d9cc65b361917e645e6c8", "url": "https://github.com/ConsenSys/teku/commit/ba415f8d15d0f9d7125d9cc65b361917e645e6c8", "message": "No requirement that publishers be the same now.", "committedDate": "2020-07-16T06:56:52Z", "type": "commit"}, {"oid": "9794087e9db0e633246c6c049e91a4380293b992", "url": "https://github.com/ConsenSys/teku/commit/9794087e9db0e633246c6c049e91a4380293b992", "message": "Allow queuing in ScheduledExecutorAsyncRunner.", "committedDate": "2020-07-16T09:04:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg0MzcwMw==", "url": "https://github.com/ConsenSys/teku/pull/2362#discussion_r455843703", "bodyText": "Should this class and its methods be package-private?  It seems that we always go through EventChannels from outside this package.", "author": "mbaxter", "createdAt": "2020-07-16T14:46:45Z", "path": "events/src/main/java/tech/pegasys/teku/events/EventChannel.java", "diffHunk": "@@ -130,7 +129,14 @@ private static boolean hasAllowedAsyncReturnValue(final Class<?> returnType) {\n         && returnType.isAssignableFrom(SafeFuture.class);\n   }\n \n-  public T getPublisher() {\n+  public T getPublisher(final Optional<AsyncRunner> responseRunner) {", "originalCommit": "9794087e9db0e633246c6c049e91a4380293b992", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "9acab2fd0082aeb042c8bd01bf945eb7641695d3", "chunk": "diff --git a/events/src/main/java/tech/pegasys/teku/events/EventChannel.java b/events/src/main/java/tech/pegasys/teku/events/EventChannel.java\nindex d6fb6898b0..18e46d8373 100644\n--- a/events/src/main/java/tech/pegasys/teku/events/EventChannel.java\n+++ b/events/src/main/java/tech/pegasys/teku/events/EventChannel.java\n\n@@ -129,7 +129,7 @@ public class EventChannel<T> {\n         && returnType.isAssignableFrom(SafeFuture.class);\n   }\n \n-  public T getPublisher(final Optional<AsyncRunner> responseRunner) {\n+  T getPublisher(final Optional<AsyncRunner> responseRunner) {\n     @SuppressWarnings(\"unchecked\")\n     final T publisher =\n         (T)\n"}}, {"oid": "87e748c1b467af2c314b988e22b04a8b652415b3", "url": "https://github.com/ConsenSys/teku/commit/87e748c1b467af2c314b988e22b04a8b652415b3", "message": "Increase minimum thread count.", "committedDate": "2020-07-16T19:56:14Z", "type": "commit"}, {"oid": "9acab2fd0082aeb042c8bd01bf945eb7641695d3", "url": "https://github.com/ConsenSys/teku/commit/9acab2fd0082aeb042c8bd01bf945eb7641695d3", "message": "Make EventChannel package private.", "committedDate": "2020-07-16T21:09:08Z", "type": "commit"}, {"oid": "e19685ca666471120e2e7bc5db31bc6e05047eee", "url": "https://github.com/ConsenSys/teku/commit/e19685ca666471120e2e7bc5db31bc6e05047eee", "message": "Create ThreadPoolExecutor that creates additional threads when needed up to a limit and queues tasks beyond that limit in a bounded queue.", "committedDate": "2020-07-16T23:31:38Z", "type": "commit"}, {"oid": "72eb39dbd57ef5636ee8e8c1958ffb1092b99753", "url": "https://github.com/ConsenSys/teku/commit/72eb39dbd57ef5636ee8e8c1958ffb1092b99753", "message": "Reduce minimum thread limit.", "committedDate": "2020-07-16T23:43:26Z", "type": "commit"}, {"oid": "cc1d38cda7722c8e31aea2227d5d0c62941790b7", "url": "https://github.com/ConsenSys/teku/commit/cc1d38cda7722c8e31aea2227d5d0c62941790b7", "message": "Merge branch 'master' into deliver-response-async", "committedDate": "2020-07-17T00:40:47Z", "type": "commit"}, {"oid": "6d4aa62921cc0c1c424b59c6d2061dbcd65f07b0", "url": "https://github.com/ConsenSys/teku/commit/6d4aa62921cc0c1c424b59c6d2061dbcd65f07b0", "message": "Merge branch 'master' into deliver-response-async", "committedDate": "2020-07-17T01:26:52Z", "type": "commit"}]}