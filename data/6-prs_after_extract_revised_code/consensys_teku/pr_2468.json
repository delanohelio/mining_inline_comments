{"pr_number": 2468, "pr_title": "startup should fail if storage fails to start in some cases.", "pr_createdAt": "2020-07-28T23:25:53Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2468", "timeline": [{"oid": "f20ccebcf8f87c9819c440bae4a1f005c80c379a", "url": "https://github.com/ConsenSys/teku/commit/f20ccebcf8f87c9819c440bae4a1f005c80c379a", "message": "startup should fail if storage fails to start in some cases.\n\n - startup now fails if storage causes anything other than a TimeoutException\n\n - added regression test to show storage failing for an IOException\n\n - added debug trace to include stack trace if context is required.\n\n fixes #2368\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-28T23:25:00Z", "type": "commit"}, {"oid": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "url": "https://github.com/ConsenSys/teku/commit/dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "message": "Merge branch 'master' into 2368", "committedDate": "2020-07-28T23:58:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjM0MQ==", "url": "https://github.com/ConsenSys/teku/pull/2468#discussion_r461972341", "bodyText": "We don't want to log this to the console.  Just a normal trace log in StorageBackedRecentChainData would be enough. We'll almost certainly hit this at least once during startup because of the order that services start.", "author": "ajsutton", "createdAt": "2020-07-29T00:41:03Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -98,6 +98,18 @@ public void beginInitializingChainData() {\n     log.info(\"Initializing storage\");\n   }\n \n+  public void initializingChainDataTimeout() {\n+    log.info(\"storage initialisation timed out, will retry.\");\n+  }", "originalCommit": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "chunk": "diff --git a/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java b/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\nindex 604a3987f0..6ba6e2d490 100644\n--- a/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\n+++ b/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\n\n@@ -98,15 +98,11 @@ public class StatusLogger {\n     log.info(\"Initializing storage\");\n   }\n \n-  public void initializingChainDataTimeout() {\n-    log.info(\"storage initialisation timed out, will retry.\");\n-  }\n-\n   public void fatalErrorInitialisingStorage(Throwable err) {\n     log.debug(\"Failed to intiailize storage\", err);\n     log.fatal(\n         \"Failed to initialize storage. \"\n-            + \"Is your network set in line with your existing database? \"\n+            + \"Check the existing database matches the current network configuration. \"\n             + \"Set log level to debug for more information.\");\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3MjUxNw==", "url": "https://github.com/ConsenSys/teku/pull/2468#discussion_r461972517", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        + \"Is your network set in line with your existing database? \"\n          \n          \n            \n                        + \"Check the existing database matches the current network configuration. \"", "author": "ajsutton", "createdAt": "2020-07-29T00:41:43Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -98,6 +98,18 @@ public void beginInitializingChainData() {\n     log.info(\"Initializing storage\");\n   }\n \n+  public void initializingChainDataTimeout() {\n+    log.info(\"storage initialisation timed out, will retry.\");\n+  }\n+\n+  public void fatalErrorInitialisingStorage(Throwable err) {\n+    log.debug(\"Failed to intiailize storage\", err);\n+    log.fatal(\n+        \"Failed to initialize storage. \"\n+            + \"Is your network set in line with your existing database? \"", "originalCommit": "dc7aaef4c262e00feb5c40af9d792ca1b5fcb36b", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "chunk": "diff --git a/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java b/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\nindex 604a3987f0..6ba6e2d490 100644\n--- a/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\n+++ b/logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java\n\n@@ -98,15 +98,11 @@ public class StatusLogger {\n     log.info(\"Initializing storage\");\n   }\n \n-  public void initializingChainDataTimeout() {\n-    log.info(\"storage initialisation timed out, will retry.\");\n-  }\n-\n   public void fatalErrorInitialisingStorage(Throwable err) {\n     log.debug(\"Failed to intiailize storage\", err);\n     log.fatal(\n         \"Failed to initialize storage. \"\n-            + \"Is your network set in line with your existing database? \"\n+            + \"Check the existing database matches the current network configuration. \"\n             + \"Set log level to debug for more information.\");\n   }\n \n"}}, {"oid": "e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "url": "https://github.com/ConsenSys/teku/commit/e568a15ffa85d23e5dee1850e248c3ad3e4bd4bd", "message": "review feedback.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-29T01:58:26Z", "type": "commit"}, {"oid": "a0c9269347bc07dc1b8bc784b370f850d554b27c", "url": "https://github.com/ConsenSys/teku/commit/a0c9269347bc07dc1b8bc784b370f850d554b27c", "message": "Merge remote-tracking branch 'upstream/master' into 2368", "committedDate": "2020-07-29T02:06:03Z", "type": "commit"}]}