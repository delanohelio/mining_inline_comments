{"pr_number": 1808, "pr_title": "1798 - update chainHead to use bestBlockAndState", "pr_createdAt": "2020-05-18T22:48:59Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1808", "timeline": [{"oid": "4d98b685153f9dbb5730a15b63e0cc845b98379e", "url": "https://github.com/ConsenSys/teku/commit/4d98b685153f9dbb5730a15b63e0cc845b98379e", "message": "1798 - update chainHead to use bestBlockAndState\n\n - changed /beacon/head to use bestBlockAndState also.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-05-18T22:47:39Z", "type": "commit"}, {"oid": "19d55558d1ceb96a57cdd33e48eb2bfd13d21de6", "url": "https://github.com/ConsenSys/teku/commit/19d55558d1ceb96a57cdd33e48eb2bfd13d21de6", "message": "Merge remote-tracking branch 'upstream/master' into 1798-chainhead", "committedDate": "2020-05-18T22:49:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MTk4OQ==", "url": "https://github.com/ConsenSys/teku/pull/1808#discussion_r426941989", "bodyText": "nit: remove commented out code.", "author": "ajsutton", "createdAt": "2020-05-18T23:14:57Z", "path": "data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java", "diffHunk": "@@ -214,6 +207,10 @@ public boolean isFinalizedEpoch(final UnsignedLong epoch) {\n   }\n \n   public Optional<BeaconChainHead> getHeadState() {\n-    return combinedChainDataClient.getHeadStateFromStore().map(BeaconChainHead::new);\n+    if (!isStoreAvailable()) {\n+      throw new ChainDataUnavailableException();\n+    }\n+    return recentChainData.getBestBlockAndState().map(BeaconChainHead::new);\n+    //    return combinedChainDataClient.getHeadStateFromStore().map(BeaconChainHead::new);", "originalCommit": "19d55558d1ceb96a57cdd33e48eb2bfd13d21de6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MzY4NA==", "url": "https://github.com/ConsenSys/teku/pull/1808#discussion_r426943684", "bodyText": "gah! fair point!", "author": "rolfyone", "createdAt": "2020-05-18T23:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk0MTk4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "39207f5f31252814d7fde89e200414e2c7657ae7", "chunk": "diff --git a/data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java b/data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java\nindex 89b1ede809..91cd93f7c4 100644\n--- a/data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java\n+++ b/data/provider/src/main/java/tech/pegasys/teku/api/ChainDataProvider.java\n\n@@ -211,6 +211,5 @@ public class ChainDataProvider {\n       throw new ChainDataUnavailableException();\n     }\n     return recentChainData.getBestBlockAndState().map(BeaconChainHead::new);\n-    //    return combinedChainDataClient.getHeadStateFromStore().map(BeaconChainHead::new);\n   }\n }\n"}}, {"oid": "39207f5f31252814d7fde89e200414e2c7657ae7", "url": "https://github.com/ConsenSys/teku/commit/39207f5f31252814d7fde89e200414e2c7657ae7", "message": "code review feedback.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-05-18T23:21:07Z", "type": "commit"}, {"oid": "0897e5e485f0288c7e7b1c580a46108bcee90860", "url": "https://github.com/ConsenSys/teku/commit/0897e5e485f0288c7e7b1c580a46108bcee90860", "message": "Merge remote-tracking branch 'upstream/master' into 1798-chainhead", "committedDate": "2020-05-18T23:36:26Z", "type": "commit"}]}