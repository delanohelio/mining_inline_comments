{"pr_number": 1794, "pr_title": "Set and print bootnode ENR", "pr_createdAt": "2020-05-15T22:30:01Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1794", "timeline": [{"oid": "a59f5ba7417a56cd98b35a9f5a55ffb55d1db3ad", "url": "https://github.com/ConsenSys/teku/commit/a59f5ba7417a56cd98b35a9f5a55ffb55d1db3ad", "message": "Set & print bootnode ENR regardless of genesis", "committedDate": "2020-05-15T22:29:20Z", "type": "commit"}, {"oid": "73fd82e041b116bc116d6cd88a16d452f0cfb726", "url": "https://github.com/ConsenSys/teku/commit/73fd82e041b116bc116d6cd88a16d452f0cfb726", "message": "Remove check that failed due to mock", "committedDate": "2020-05-15T22:45:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA4NzM3OA==", "url": "https://github.com/ConsenSys/teku/pull/1794#discussion_r426087378", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                setBootNodeForkInfo();\n          \n          \n            \n                setPreGenesisForkInfo();", "author": "mbaxter", "createdAt": "2020-05-15T23:28:56Z", "path": "networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/DiscoveryNetwork.java", "diffHunk": "@@ -61,6 +64,12 @@\n     this.p2pNetwork = p2pNetwork;\n     this.discoveryService = discoveryService;\n     this.connectionManager = connectionManager;\n+    initialize();\n+  }\n+\n+  public void initialize() {\n+    setBootNodeForkInfo();", "originalCommit": "73fd82e041b116bc116d6cd88a16d452f0cfb726", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExMDM5NQ==", "url": "https://github.com/ConsenSys/teku/pull/1794#discussion_r426110395", "bodyText": "done.", "author": "cemozerr", "createdAt": "2020-05-16T02:49:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA4NzM3OA=="}], "type": "inlineReview", "revised_code": {"commit": "61f80d6b7d3b4ee72a7839312dbb1911bf9a186f", "chunk": "diff --git a/networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/DiscoveryNetwork.java b/networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/DiscoveryNetwork.java\nindex 5563801a20..071d13a56c 100644\n--- a/networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/DiscoveryNetwork.java\n+++ b/networking/p2p/src/main/java/tech/pegasys/teku/networking/p2p/DiscoveryNetwork.java\n\n@@ -68,7 +68,7 @@ public class DiscoveryNetwork<P extends Peer> extends DelegatingP2PNetwork<P> {\n   }\n \n   public void initialize() {\n-    setBootNodeForkInfo();\n+    setPreGenesisForkInfo();\n     getEnr().ifPresent(StatusLogger.STATUS_LOG::listeningForDiscv5);\n   }\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA4ODg4OA==", "url": "https://github.com/ConsenSys/teku/pull/1794#discussion_r426088888", "bodyText": "May be worth verifying the expected discoveryService interaction, then asserting verifyNoMoreInteractions(discoveryService).", "author": "mbaxter", "createdAt": "2020-05-15T23:36:15Z", "path": "networking/p2p/src/test/java/tech/pegasys/teku/networking/p2p/DiscoveryNetworkTest.java", "diffHunk": "@@ -88,7 +91,7 @@ public void shouldStopConnectionManagerBeforeNetworkAndDiscovery() {\n     discoveryNetwork.stop();\n \n     verify(connectionManager).stop();\n-    verifyNoInteractions(p2pNetwork, discoveryService);", "originalCommit": "73fd82e041b116bc116d6cd88a16d452f0cfb726", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjExMDQwNw==", "url": "https://github.com/ConsenSys/teku/pull/1794#discussion_r426110407", "bodyText": "good idea!", "author": "cemozerr", "createdAt": "2020-05-16T02:49:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjA4ODg4OA=="}], "type": "inlineReview", "revised_code": {"commit": "07dd87b04c7ed975c80276450715608f3598f0c5", "chunk": "diff --git a/networking/p2p/src/test/java/tech/pegasys/teku/networking/p2p/DiscoveryNetworkTest.java b/networking/p2p/src/test/java/tech/pegasys/teku/networking/p2p/DiscoveryNetworkTest.java\nindex 7077b69c8d..b089745b12 100644\n--- a/networking/p2p/src/test/java/tech/pegasys/teku/networking/p2p/DiscoveryNetworkTest.java\n+++ b/networking/p2p/src/test/java/tech/pegasys/teku/networking/p2p/DiscoveryNetworkTest.java\n\n@@ -91,6 +93,9 @@ class DiscoveryNetworkTest {\n     discoveryNetwork.stop();\n \n     verify(connectionManager).stop();\n+    verify(discoveryService).updateCustomENRField(any(), any());\n+    verify(discoveryService).getEnr();\n+    verifyNoMoreInteractions(discoveryService);\n     verifyNoInteractions(p2pNetwork);\n \n     connectionStop.complete(null);\n"}}, {"oid": "07dd87b04c7ed975c80276450715608f3598f0c5", "url": "https://github.com/ConsenSys/teku/commit/07dd87b04c7ed975c80276450715608f3598f0c5", "message": "Make test more granular", "committedDate": "2020-05-16T02:55:50Z", "type": "commit"}, {"oid": "61f80d6b7d3b4ee72a7839312dbb1911bf9a186f", "url": "https://github.com/ConsenSys/teku/commit/61f80d6b7d3b4ee72a7839312dbb1911bf9a186f", "message": "Change method name", "committedDate": "2020-05-16T02:55:56Z", "type": "commit"}, {"oid": "63ac5978263cc8cc565cd17cd4614f271e5d78ec", "url": "https://github.com/ConsenSys/teku/commit/63ac5978263cc8cc565cd17cd4614f271e5d78ec", "message": "Add distinct print statement for pre genesis ENR", "committedDate": "2020-05-16T02:59:02Z", "type": "commit"}]}