{"pr_number": 2293, "pr_title": "add a metric to track connected eth2 nodes similar to api and console", "pr_createdAt": "2020-07-02T00:18:39Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2293", "timeline": [{"oid": "0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "url": "https://github.com/ConsenSys/teku/commit/0fcf8cfd3c3b2ae4be7bb2cf387e9cf8086fff63", "message": "add a metric to track connected eth2 nodes similar to api and console\n\n - added beacon_peer_count to track connections in the same way the API does\n\n - added regression test to show metric working.\n\nfixes #2177\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T00:16:21Z", "type": "commit"}, {"oid": "608534e77c097655ad52c8af53e9f210e42a82ea", "url": "https://github.com/ConsenSys/teku/commit/608534e77c097655ad52c8af53e9f210e42a82ea", "message": "add changelog entry.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T00:23:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODY4ODE5OQ==", "url": "https://github.com/ConsenSys/teku/pull/2293#discussion_r448688199", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Tracks number of connected peers\",\n          \n          \n            \n                    \"Tracks number of connected peers, verified to be on the same chain\",\n          \n      \n    \n    \n  \n\nWe may need to update the description for the libp2p_peer_count metric as well to make it clear that it's counting connections - otherwise people will just be confused why we have two metrics for the same thing with different values.", "author": "ajsutton", "createdAt": "2020-07-02T00:47:52Z", "path": "services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java", "diffHunk": "@@ -104,6 +108,11 @@ public BeaconChainMetrics(\n         \"previous_justified_root\",\n         \"Current previously justified root\",\n         this::getPreviousJustifiedRootValue);\n+    metricsSystem.createGauge(\n+        TekuMetricCategory.BEACON,\n+        \"peer_count\",\n+        \"Tracks number of connected peers\",", "originalCommit": "608534e77c097655ad52c8af53e9f210e42a82ea", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "2001d439203b8b2d111ca2a78c5e90d8708df845", "chunk": "diff --git a/services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java b/services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java\nindex 7bc8e4fbe2..e7a85ebcd1 100644\n--- a/services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java\n+++ b/services/beaconchain/src/main/java/tech/pegasys/teku/services/beaconchain/BeaconChainMetrics.java\n\n@@ -111,7 +111,7 @@ public class BeaconChainMetrics implements SlotEventsChannel {\n     metricsSystem.createGauge(\n         TekuMetricCategory.BEACON,\n         \"peer_count\",\n-        \"Tracks number of connected peers\",\n+        \"Tracks number of connected peers, verified to be on the same chain\",\n         p2pNetwork::getPeerCount);\n \n     previousLiveValidators =\n"}}, {"oid": "2001d439203b8b2d111ca2a78c5e90d8708df845", "url": "https://github.com/ConsenSys/teku/commit/2001d439203b8b2d111ca2a78c5e90d8708df845", "message": "review comment addressed.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-07-02T02:28:16Z", "type": "commit"}]}