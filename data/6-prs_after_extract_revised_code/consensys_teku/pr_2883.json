{"pr_number": 2883, "pr_title": "follow symlinks in order to better support k8s secrets", "pr_createdAt": "2020-10-06T00:10:55Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2883", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0MTUyMw==", "url": "https://github.com/ConsenSys/teku/pull/2883#discussion_r499941523", "bodyText": "createSymbolicLink isn't supported on all file systems so we probably should catch the UnsupportedOperationException it may throw and just skip the test in that case.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                Files.createSymbolicLink(tempDir.resolve(\"key\"), realKeyDir);\n          \n          \n            \n                Files.createSymbolicLink(tempDir.resolve(\"pass\"), realPassDir);\n          \n          \n            \n                try {\n          \n          \n            \n                    Files.createSymbolicLink(tempDir.resolve(\"key\"), realKeyDir);\n          \n          \n            \n                    Files.createSymbolicLink(tempDir.resolve(\"pass\"), realPassDir);\n          \n          \n            \n                } catch (UnsupportedOperationException e) {\n          \n          \n            \n                    throw new AssumptionViolatedException(\"Symbolic links not supported on this file system\");\n          \n          \n            \n                }", "author": "ajsutton", "createdAt": "2020-10-06T00:24:34Z", "path": "util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java", "diffHunk": "@@ -189,6 +191,27 @@ public void shouldHandleOldArgs(@TempDir final Path tempDir) throws IOException\n         .containsExactly(tuple(tempDir, List.of(\"key\", \"a\"), List.of(\"pass\", \"a.txt\")));\n   }\n \n+  @Test\n+  public void shouldHandleSymlinkedDirectories(@TempDir final Path tempDir) throws IOException {\n+    Path realKeyDir = Path.of(\"actualKey\");\n+    Path realPassDir = Path.of(\"actualPass\");\n+    createFolders(tempDir, realKeyDir, realPassDir);\n+    createFiles(tempDir, realKeyDir.resolve(\"a.json\"), realPassDir.resolve(\"a.txt\"));\n+\n+    Files.createSymbolicLink(tempDir.resolve(\"key\"), realKeyDir);\n+    Files.createSymbolicLink(tempDir.resolve(\"pass\"), realPassDir);", "originalCommit": "c69898d76707a28f417c1f308e6a360b4845a20b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0NDM0Mg==", "url": "https://github.com/ConsenSys/teku/pull/2883#discussion_r499944342", "bodyText": "Good idea! Looks like that exception class comes from an older junit. junit-jupiter-api has a \"TestAbortedException\" - let me know if you want me to do something different.", "author": "mread", "createdAt": "2020-10-06T00:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk0MTUyMw=="}], "type": "inlineReview", "revised_code": {"commit": "a630737752ab6e3791bf57660cdc586cf27fbdbe", "chunk": "diff --git a/util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java b/util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java\nindex fa6f297a7f..d047eaa2d9 100644\n--- a/util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java\n+++ b/util/src/test/java/tech/pegasys/teku/util/config/KeyStoreFilesLocatorTest.java\n\n@@ -206,10 +206,9 @@ public class KeyStoreFilesLocatorTest {\n     locator.parse();\n \n     assertThat(locator.getFilePairs())\n-            .containsExactlyInAnyOrder(\n-                    tuple(tempDir,\n-                            Path.of(\"key\", \"a.json\").toString(),\n-                            Path.of(\"pass\", \"a.txt\").toString()));\n+        .containsExactlyInAnyOrder(\n+            tuple(\n+                tempDir, Path.of(\"key\", \"a.json\").toString(), Path.of(\"pass\", \"a.txt\").toString()));\n   }\n \n   private void createFolders(final Path tempDir, String... paths) {\n"}}, {"oid": "a630737752ab6e3791bf57660cdc586cf27fbdbe", "url": "https://github.com/ConsenSys/teku/commit/a630737752ab6e3791bf57660cdc586cf27fbdbe", "message": "follow symlinks in order to better support k8s secrets", "committedDate": "2020-10-06T00:52:35Z", "type": "commit"}, {"oid": "ca2c857fa37eaf7685b1823616a3d6680144e7d9", "url": "https://github.com/ConsenSys/teku/commit/ca2c857fa37eaf7685b1823616a3d6680144e7d9", "message": "wrap UOE if symlinks aren't supported, also let spotless do its thing", "committedDate": "2020-10-06T00:53:01Z", "type": "commit"}, {"oid": "ca2c857fa37eaf7685b1823616a3d6680144e7d9", "url": "https://github.com/ConsenSys/teku/commit/ca2c857fa37eaf7685b1823616a3d6680144e7d9", "message": "wrap UOE if symlinks aren't supported, also let spotless do its thing", "committedDate": "2020-10-06T00:53:01Z", "type": "forcePushed"}, {"oid": "ac8a30bf872c3cf34265ab08ab8c57ca0d2642b9", "url": "https://github.com/ConsenSys/teku/commit/ac8a30bf872c3cf34265ab08ab8c57ca0d2642b9", "message": "not having much luck with spotless, last attempt", "committedDate": "2020-10-06T00:56:38Z", "type": "commit"}]}