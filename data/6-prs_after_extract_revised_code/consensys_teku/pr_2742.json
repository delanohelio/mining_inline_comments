{"pr_number": 2742, "pr_title": "Better handle p2p target peer bounds", "pr_createdAt": "2020-09-07T11:48:48Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2742", "timeline": [{"oid": "197105ae851ac953a0eebc767b44e5feeec11133", "url": "https://github.com/ConsenSys/teku/commit/197105ae851ac953a0eebc767b44e5feeec11133", "message": "Better handle p2p target peer bounds", "committedDate": "2020-09-07T11:48:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTAwMw==", "url": "https://github.com/ConsenSys/teku/pull/2742#discussion_r484569003", "bodyText": "Math.min?", "author": "ajsutton", "createdAt": "2020-09-07T21:20:50Z", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java", "diffHunk": "@@ -150,11 +150,19 @@ public String getP2pPrivateKeyFile() {\n   }\n \n   public int getP2pLowerBound() {\n-    return p2pLowerBound;\n+    if (p2pLowerBound > p2pUpperBound) {\n+      return p2pUpperBound;\n+    } else {\n+      return p2pLowerBound;\n+    }", "originalCommit": "197105ae851ac953a0eebc767b44e5feeec11133", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg1NzYzOA==", "url": "https://github.com/ConsenSys/teku/pull/2742#discussion_r484857638", "bodyText": "I just added the warnings and with those warnings embedded in the body of the if statements, I don't know how I can incorporate Math.min and max.\npublic int getP2pLowerBound() {\n    if (p2pLowerBound > p2pUpperBound) {\n      LOG.warn(\"Adjusting target number of peers lower bound to equal upper bound, which is {}\", p2pUpperBound);\n      return p2pUpperBound;\n    } else {\n      return p2pLowerBound;\n    }\n  }", "author": "cemozerr", "createdAt": "2020-09-08T11:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTAwMw=="}], "type": "inlineReview", "revised_code": {"commit": "84a61b29321832a316cb6b791efb7d417d6cf954", "chunk": "diff --git a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\nindex 82259e2bb..55ac6891a 100644\n--- a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n+++ b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n\n@@ -151,6 +156,7 @@ public class P2POptions {\n \n   public int getP2pLowerBound() {\n     if (p2pLowerBound > p2pUpperBound) {\n+      LOG.warn(\"Adjusting target number of peers lower bound to equal upper bound, which is {}\", p2pUpperBound);\n       return p2pUpperBound;\n     } else {\n       return p2pLowerBound;\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDU2OTA1Mw==", "url": "https://github.com/ConsenSys/teku/pull/2742#discussion_r484569053", "bodyText": "Math.max?", "author": "ajsutton", "createdAt": "2020-09-07T21:21:10Z", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java", "diffHunk": "@@ -150,11 +150,19 @@ public String getP2pPrivateKeyFile() {\n   }\n \n   public int getP2pLowerBound() {\n-    return p2pLowerBound;\n+    if (p2pLowerBound > p2pUpperBound) {\n+      return p2pUpperBound;\n+    } else {\n+      return p2pLowerBound;\n+    }\n   }\n \n   public int getP2pUpperBound() {\n-    return p2pUpperBound;\n+    if (p2pUpperBound < p2pLowerBound) {\n+      return p2pLowerBound;\n+    } else {\n+      return p2pUpperBound;\n+    }", "originalCommit": "197105ae851ac953a0eebc767b44e5feeec11133", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "84a61b29321832a316cb6b791efb7d417d6cf954", "chunk": "diff --git a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\nindex 82259e2bb..55ac6891a 100644\n--- a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n+++ b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n\n@@ -151,6 +156,7 @@ public class P2POptions {\n \n   public int getP2pLowerBound() {\n     if (p2pLowerBound > p2pUpperBound) {\n+      LOG.warn(\"Adjusting target number of peers lower bound to equal upper bound, which is {}\", p2pUpperBound);\n       return p2pUpperBound;\n     } else {\n       return p2pLowerBound;\n"}}, {"oid": "7729e00c9341800d493bb5f833449a7dad09d4ba", "url": "https://github.com/ConsenSys/teku/commit/7729e00c9341800d493bb5f833449a7dad09d4ba", "message": "Merge branch 'master' into betterHandleP2PTargetPeerBounds", "committedDate": "2020-09-08T11:43:34Z", "type": "commit"}, {"oid": "84a61b29321832a316cb6b791efb7d417d6cf954", "url": "https://github.com/ConsenSys/teku/commit/84a61b29321832a316cb6b791efb7d417d6cf954", "message": "Add warnings", "committedDate": "2020-09-08T11:54:25Z", "type": "commit"}, {"oid": "75871ee984943f8d6b3779cc36d1ba3b6ef4bf8b", "url": "https://github.com/ConsenSys/teku/commit/75871ee984943f8d6b3779cc36d1ba3b6ef4bf8b", "message": "Run spotless", "committedDate": "2020-09-08T11:54:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzEyMw==", "url": "https://github.com/ConsenSys/teku/pull/2742#discussion_r485197123", "bodyText": "This will get lost in the log file but probably should go to the console instead (via StatusLogger).", "author": "ajsutton", "createdAt": "2020-09-08T21:08:29Z", "path": "teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java", "diffHunk": "@@ -150,11 +154,25 @@ public String getP2pPrivateKeyFile() {\n   }\n \n   public int getP2pLowerBound() {\n-    return p2pLowerBound;\n+    if (p2pLowerBound > p2pUpperBound) {\n+      LOG.warn(\n+          \"Adjusting target number of peers lower bound to equal upper bound, which is {}\",\n+          p2pUpperBound);", "originalCommit": "75871ee984943f8d6b3779cc36d1ba3b6ef4bf8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU1OTIwOA==", "url": "https://github.com/ConsenSys/teku/pull/2742#discussion_r485559208", "bodyText": "Done.", "author": "cemozerr", "createdAt": "2020-09-09T12:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTE5NzEyMw=="}], "type": "inlineReview", "revised_code": {"commit": "6bf89da3b0fb8eb4873c14a486bd03d6959c9ab8", "chunk": "diff --git a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\nindex aaa5143df..a96060cd9 100644\n--- a/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n+++ b/teku/src/main/java/tech/pegasys/teku/cli/options/P2POptions.java\n\n@@ -155,9 +157,7 @@ public class P2POptions {\n \n   public int getP2pLowerBound() {\n     if (p2pLowerBound > p2pUpperBound) {\n-      LOG.warn(\n-          \"Adjusting target number of peers lower bound to equal upper bound, which is {}\",\n-          p2pUpperBound);\n+      STATUS_LOG.adjustingP2pLowerBoundToUpperBound(p2pUpperBound);\n       return p2pUpperBound;\n     } else {\n       return p2pLowerBound;\n"}}, {"oid": "46e03ea2810fb54e74be0d722c8f8328937c4f9d", "url": "https://github.com/ConsenSys/teku/commit/46e03ea2810fb54e74be0d722c8f8328937c4f9d", "message": "Merge branch 'master' into betterHandleP2PTargetPeerBounds", "committedDate": "2020-09-08T23:35:08Z", "type": "commit"}, {"oid": "f460d7fb146df9c555991ed0f8fcad3e74783584", "url": "https://github.com/ConsenSys/teku/commit/f460d7fb146df9c555991ed0f8fcad3e74783584", "message": "Merge branch 'master' into betterHandleP2PTargetPeerBounds", "committedDate": "2020-09-08T23:38:24Z", "type": "commit"}, {"oid": "6bf89da3b0fb8eb4873c14a486bd03d6959c9ab8", "url": "https://github.com/ConsenSys/teku/commit/6bf89da3b0fb8eb4873c14a486bd03d6959c9ab8", "message": "Log via the status logger", "committedDate": "2020-09-09T12:07:23Z", "type": "commit"}, {"oid": "dc99419c900f458103208d57cdc9eb8fc854c45b", "url": "https://github.com/ConsenSys/teku/commit/dc99419c900f458103208d57cdc9eb8fc854c45b", "message": "Merge branch 'master' into betterHandleP2PTargetPeerBounds", "committedDate": "2020-09-09T12:07:38Z", "type": "commit"}, {"oid": "2242e8adc958e6013a04dbc1a4df5aa746660632", "url": "https://github.com/ConsenSys/teku/commit/2242e8adc958e6013a04dbc1a4df5aa746660632", "message": "Remove redundant logger", "committedDate": "2020-09-09T12:17:47Z", "type": "commit"}, {"oid": "b65554e90d04f93dc7a418da5f0384c22c42826f", "url": "https://github.com/ConsenSys/teku/commit/b65554e90d04f93dc7a418da5f0384c22c42826f", "message": "Run spotless", "committedDate": "2020-09-09T13:11:08Z", "type": "commit"}]}