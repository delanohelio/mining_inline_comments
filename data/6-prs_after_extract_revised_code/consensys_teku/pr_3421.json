{"pr_number": 3421, "pr_title": "Implement SSZ state retrieval on `/eth/v1/debug/beacon/states/:state_id`", "pr_createdAt": "2020-12-21T03:52:42Z", "pr_url": "https://github.com/ConsenSys/teku/pull/3421", "timeline": [{"oid": "dd83ae4c10aa12f71fca6b1e49ded1607f560fbf", "url": "https://github.com/ConsenSys/teku/commit/dd83ae4c10aa12f71fca6b1e49ded1607f560fbf", "message": "Implement SSZ state retrieval on `/eth/v1/debug/beacon/states/:state_id`\n\n - if accept-header `application/octet-stream` is passed, then SSZ will be returned, otherwise JSON will be returned if the accept header is empty or set to `application/json`.\n\n - this functionality was previously available on `/teku/v1/beacon/states/:state_id`, which has been deprecated in favor of the standard api implementation.\n\nfixes #3411\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-12-21T03:48:59Z", "type": "commit"}, {"oid": "ecccb0b8b20bd668edcc062b07fb898b4d17944c", "url": "https://github.com/ConsenSys/teku/commit/ecccb0b8b20bd668edcc062b07fb898b4d17944c", "message": "Merge remote-tracking branch 'upstream/master' into 3411", "committedDate": "2020-12-21T05:32:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODAzNDYyMQ==", "url": "https://github.com/ConsenSys/teku/pull/3421#discussion_r548034621", "bodyText": "May be worth another test with an empty accept header", "author": "mbaxter", "createdAt": "2020-12-23T16:15:45Z", "path": "data/beaconrestapi/src/integration-test/java/tech/pegasys/teku/beaconrestapi/v1/debug/GetStateIntegrationTest.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.beaconrestapi.v1.debug;\n+\n+import static javax.servlet.http.HttpServletResponse.SC_BAD_REQUEST;\n+import static javax.servlet.http.HttpServletResponse.SC_OK;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static tech.pegasys.teku.beaconrestapi.RestApiConstants.HEADER_ACCEPT_JSON;\n+import static tech.pegasys.teku.beaconrestapi.RestApiConstants.HEADER_ACCEPT_OCTET;\n+\n+import java.io.IOException;\n+import okhttp3.Response;\n+import org.apache.tuweni.bytes.Bytes;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import tech.pegasys.teku.api.response.v1.debug.GetStateResponse;\n+import tech.pegasys.teku.beaconrestapi.AbstractDataBackedRestAPIIntegrationTest;\n+import tech.pegasys.teku.beaconrestapi.handlers.v1.debug.GetState;\n+import tech.pegasys.teku.datastructures.state.BeaconState;\n+import tech.pegasys.teku.datastructures.util.SimpleOffsetSerializer;\n+\n+public class GetStateIntegrationTest extends AbstractDataBackedRestAPIIntegrationTest {\n+  @BeforeEach\n+  public void setup() {\n+    startRestAPIAtGenesis();\n+  }\n+\n+  @Test\n+  public void shouldGetStateAsJson() throws IOException {", "originalCommit": "ecccb0b8b20bd668edcc062b07fb898b4d17944c", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "89060e7537f1384934f221ff3d4d74666aec9ef5", "chunk": "diff --git a/data/beaconrestapi/src/integration-test/java/tech/pegasys/teku/beaconrestapi/v1/debug/GetStateIntegrationTest.java b/data/beaconrestapi/src/integration-test/java/tech/pegasys/teku/beaconrestapi/v1/debug/GetStateIntegrationTest.java\nindex 59a71352b..575b58554 100644\n--- a/data/beaconrestapi/src/integration-test/java/tech/pegasys/teku/beaconrestapi/v1/debug/GetStateIntegrationTest.java\n+++ b/data/beaconrestapi/src/integration-test/java/tech/pegasys/teku/beaconrestapi/v1/debug/GetStateIntegrationTest.java\n\n@@ -45,6 +45,15 @@ public class GetStateIntegrationTest extends AbstractDataBackedRestAPIIntegratio\n     assertThat(stateResponse).isNotNull();\n   }\n \n+  @Test\n+  public void shouldGetStateAsJsonWithoutHeader() throws IOException {\n+    final Response response = get(\"head\");\n+    assertThat(response.code()).isEqualTo(SC_OK);\n+    final GetStateResponse stateResponse =\n+        jsonProvider.jsonToObject(response.body().string(), GetStateResponse.class);\n+    assertThat(stateResponse).isNotNull();\n+  }\n+\n   @Test\n   public void shouldGetStateAsOctetStream() throws IOException {\n     final Response response = get(\"head\", HEADER_ACCEPT_OCTET);\n"}}, {"oid": "57c2ef25b2e30111420bd3ca9df3edd75f0cc06a", "url": "https://github.com/ConsenSys/teku/commit/57c2ef25b2e30111420bd3ca9df3edd75f0cc06a", "message": "Merge remote-tracking branch 'upstream/master' into 3411", "committedDate": "2020-12-23T21:06:53Z", "type": "commit"}, {"oid": "89060e7537f1384934f221ff3d4d74666aec9ef5", "url": "https://github.com/ConsenSys/teku/commit/89060e7537f1384934f221ff3d4d74666aec9ef5", "message": "add test for requesting state without an accept header.\n\nSigned-off-by: Paul Harris <paul.harris@consensys.net>", "committedDate": "2020-12-24T00:46:25Z", "type": "commit"}]}