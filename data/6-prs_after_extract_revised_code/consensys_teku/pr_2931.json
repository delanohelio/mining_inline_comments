{"pr_number": 2931, "pr_title": "Support standard event source for remote validator", "pr_createdAt": "2020-10-09T04:26:00Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2931", "timeline": [{"oid": "4063d05b6a5f4e6142096116e587e2a5f7125ed1", "url": "https://github.com/ConsenSys/teku/commit/4063d05b6a5f4e6142096116e587e2a5f7125ed1", "message": "Add eventsource client dependency", "committedDate": "2020-10-08T23:39:42Z", "type": "commit"}, {"oid": "b1caff825828485dc89c1a62d58d813eaa9c7afb", "url": "https://github.com/ConsenSys/teku/commit/b1caff825828485dc89c1a62d58d813eaa9c7afb", "message": "Introduce independent timer based validator events for remote validators.", "committedDate": "2020-10-09T01:17:24Z", "type": "commit"}, {"oid": "17b937377bb16d9aa6b5e10945fb1df163cb0377", "url": "https://github.com/ConsenSys/teku/commit/17b937377bb16d9aa6b5e10945fb1df163cb0377", "message": "Use independent timer automatically if websocket endpoint is not specified.", "committedDate": "2020-10-09T03:24:52Z", "type": "commit"}, {"oid": "2b9d1e984c328765f88e02590125a01648dbd453", "url": "https://github.com/ConsenSys/teku/commit/2b9d1e984c328765f88e02590125a01648dbd453", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source", "committedDate": "2020-10-09T03:25:16Z", "type": "commit"}, {"oid": "b8dfcd008d9ac190016966030cb0ebf57a32c48f", "url": "https://github.com/ConsenSys/teku/commit/b8dfcd008d9ac190016966030cb0ebf57a32c48f", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source", "committedDate": "2020-10-09T03:35:29Z", "type": "commit"}, {"oid": "b594b32bbd721781bac98fd8d1d64fb3c40694d0", "url": "https://github.com/ConsenSys/teku/commit/b594b32bbd721781bac98fd8d1d64fb3c40694d0", "message": "Fix NullPointerException.\nDon't execute tasks if the delayed event runs slightly before it is due.", "committedDate": "2020-10-09T03:57:19Z", "type": "commit"}, {"oid": "bda488dae6925687eca026bb7107dfe46556fba8", "url": "https://github.com/ConsenSys/teku/commit/bda488dae6925687eca026bb7107dfe46556fba8", "message": "Don't default current epoch to zero, it may cause us to calculate duties from way too far back.", "committedDate": "2020-10-09T04:01:53Z", "type": "commit"}, {"oid": "56db9f042466d463c8d385a6c0b1b7503e1eec86", "url": "https://github.com/ConsenSys/teku/commit/56db9f042466d463c8d385a6c0b1b7503e1eec86", "message": "Add tests.", "committedDate": "2020-10-09T04:07:01Z", "type": "commit"}, {"oid": "49440f12215fc69d9ac6db7f867d002b58ac2b07", "url": "https://github.com/ConsenSys/teku/commit/49440f12215fc69d9ac6db7f867d002b58ac2b07", "message": "Move keep-alive thread to EventSourceBeaconChainEventAdapter since it's only needed when that's in use.", "committedDate": "2020-10-09T04:10:16Z", "type": "commit"}, {"oid": "bd76c30c4e212d2c9f5a1883c151a316b98019f9", "url": "https://github.com/ConsenSys/teku/commit/bd76c30c4e212d2c9f5a1883c151a316b98019f9", "message": "Add tests for handler and handle invalid messages.", "committedDate": "2020-10-09T04:25:41Z", "type": "commit"}, {"oid": "83742025a5d8d2b92b7e07b6b97b304bb245d4cc", "url": "https://github.com/ConsenSys/teku/commit/83742025a5d8d2b92b7e07b6b97b304bb245d4cc", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into remote-validator-event-source", "committedDate": "2020-10-09T04:26:22Z", "type": "commit"}, {"oid": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200", "url": "https://github.com/ConsenSys/teku/commit/f1e8eedc9e91b8628e64bf2232ddd9ea24037200", "message": "Remove unused field.", "committedDate": "2020-10-09T04:32:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIwNDYyMw==", "url": "https://github.com/ConsenSys/teku/pull/2931#discussion_r502204623", "bodyText": "this is basically tech.pegasys.teku.beaconrestapi.handlers.v1.events.EventType - should we use the same?", "author": "rolfyone", "createdAt": "2020-10-09T05:58:06Z", "path": "validator/remote/src/main/java/tech/pegasys/teku/validator/remote/EventTypes.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright 2020 ConsenSys AG.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+ * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package tech.pegasys.teku.validator.remote;\n+\n+public class EventTypes {\n+  public static final String HEAD = \"head\";\n+  public static final String CHAIN_REORG = \"chain_reorg\";\n+}", "originalCommit": "f1e8eedc9e91b8628e64bf2232ddd9ea24037200", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxODY3NQ==", "url": "https://github.com/ConsenSys/teku/pull/2931#discussion_r502318675", "bodyText": "It wasn't in an accessible module before (was in with all the implementation of the REST API).  I've moved it to be with the other API response schema stuff and now use it.", "author": "ajsutton", "createdAt": "2020-10-09T09:54:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjIwNDYyMw=="}], "type": "inlineReview", "revised_code": {"commit": "aa21372d0ea07147053ea03f7bd28617f038f07b", "chunk": "diff --git a/validator/remote/src/main/java/tech/pegasys/teku/validator/remote/EventTypes.java b/validator/remote/src/main/java/tech/pegasys/teku/validator/remote/EventTypes.java\ndeleted file mode 100644\nindex 499f25ea51..0000000000\n--- a/validator/remote/src/main/java/tech/pegasys/teku/validator/remote/EventTypes.java\n+++ /dev/null\n\n@@ -1,19 +0,0 @@\n-/*\n- * Copyright 2020 ConsenSys AG.\n- *\n- * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n- * the License. You may obtain a copy of the License at\n- *\n- * http://www.apache.org/licenses/LICENSE-2.0\n- *\n- * Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n- * an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n- * specific language governing permissions and limitations under the License.\n- */\n-\n-package tech.pegasys.teku.validator.remote;\n-\n-public class EventTypes {\n-  public static final String HEAD = \"head\";\n-  public static final String CHAIN_REORG = \"chain_reorg\";\n-}\n"}}, {"oid": "608c7de0a21e1c3489bb97ebc013753b95dc42b0", "url": "https://github.com/ConsenSys/teku/commit/608c7de0a21e1c3489bb97ebc013753b95dc42b0", "message": "Spotless.", "committedDate": "2020-10-09T09:45:57Z", "type": "commit"}, {"oid": "aa21372d0ea07147053ea03f7bd28617f038f07b", "url": "https://github.com/ConsenSys/teku/commit/aa21372d0ea07147053ea03f7bd28617f038f07b", "message": "Use EventType.", "committedDate": "2020-10-09T09:53:46Z", "type": "commit"}, {"oid": "1c66ca732bf045de54e094a0fa3cd1bd904f74e9", "url": "https://github.com/ConsenSys/teku/commit/1c66ca732bf045de54e094a0fa3cd1bd904f74e9", "message": "Fix tests.", "committedDate": "2020-10-09T10:09:00Z", "type": "commit"}]}