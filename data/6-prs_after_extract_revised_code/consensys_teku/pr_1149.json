{"pr_number": 1149, "pr_title": "Throw error when Eth1Node cache is stale", "pr_createdAt": "2020-02-12T18:43:27Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1149", "timeline": [{"oid": "743005dc252810649db13b19ac40ff3336d027b7", "url": "https://github.com/ConsenSys/teku/commit/743005dc252810649db13b19ac40ff3336d027b7", "message": "Throw error when Eth1Node cache is stale", "committedDate": "2020-02-12T18:40:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0NDc4OQ==", "url": "https://github.com/ConsenSys/teku/pull/1149#discussion_r378444789", "bodyText": "What about \"Eth1 call has failed:  data at block number X is unavailable.\"", "author": "mbaxter", "createdAt": "2020-02-12T18:50:41Z", "path": "pow/src/main/java/tech/pegasys/artemis/pow/DepositContractListener.java", "diffHunk": "@@ -88,7 +88,14 @@ public void stop() {\n                 throw new Eth1RequestException(\n                     \"Eth1 call has failed:\" + ethCall.getError().getMessage());\n               } else {\n-                return ethCall.getValue();\n+                String value = ethCall.getValue();\n+                if (value == null) {\n+                  throw new Eth1RequestException(\n+                      \"Eth1 call on state of block number \"\n+                          + blockHeight\n+                          + \" seems to be outdated on the node cache.\");", "originalCommit": "743005dc252810649db13b19ac40ff3336d027b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ4Mjc3MA==", "url": "https://github.com/ConsenSys/teku/pull/1149#discussion_r378482770", "bodyText": "I like that. Done.", "author": "cemozerr", "createdAt": "2020-02-12T20:02:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0NDc4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "acd6b91e1203a65b52ccb7171981e2f2f3667558", "chunk": "diff --git a/pow/src/main/java/tech/pegasys/artemis/pow/DepositContractListener.java b/pow/src/main/java/tech/pegasys/artemis/pow/DepositContractListener.java\nindex 308c16e3aa..39fedc1383 100644\n--- a/pow/src/main/java/tech/pegasys/artemis/pow/DepositContractListener.java\n+++ b/pow/src/main/java/tech/pegasys/artemis/pow/DepositContractListener.java\n\n@@ -91,9 +91,9 @@ public class DepositContractListener {\n                 String value = ethCall.getValue();\n                 if (value == null) {\n                   throw new Eth1RequestException(\n-                      \"Eth1 call on state of block number \"\n+                      \"Eth1 call has failed: data at block number \"\n                           + blockHeight\n-                          + \" seems to be outdated on the node cache.\");\n+                          + \" is unavailable.\");\n                 }\n                 return value;\n               }\n"}}, {"oid": "acd6b91e1203a65b52ccb7171981e2f2f3667558", "url": "https://github.com/ConsenSys/teku/commit/acd6b91e1203a65b52ccb7171981e2f2f3667558", "message": "Resolve comment", "committedDate": "2020-02-12T20:02:40Z", "type": "commit"}, {"oid": "0c4bb7c6d741205566db6171ed4952c18295a8ea", "url": "https://github.com/ConsenSys/teku/commit/0c4bb7c6d741205566db6171ed4952c18295a8ea", "message": "Merge branch 'master' into reportEth1NodeArchivalCacheStaleError", "committedDate": "2020-02-12T20:02:55Z", "type": "commit"}]}