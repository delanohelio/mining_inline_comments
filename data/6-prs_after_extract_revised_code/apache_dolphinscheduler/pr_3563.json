{"pr_number": 3563, "pr_title": "[Improvement-3556] remove unnecessary try catch, and do the unittest \u2026", "pr_createdAt": "2020-08-21T01:00:21Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3563", "timeline": [{"oid": "6af5a3021c2ae44ea8aaa8a4e469f6e24a221c79", "url": "https://github.com/apache/dolphinscheduler/commit/6af5a3021c2ae44ea8aaa8a4e469f6e24a221c79", "message": "[Improvement-3556] remove unnecessary try catch, and do the unittest to full coverage.", "committedDate": "2020-08-21T00:50:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2MzM2NA==", "url": "https://github.com/apache/dolphinscheduler/pull/3563#discussion_r474363364", "bodyText": "Hi~\nPlease add null judge for startDate and endDate, because in this case, we can not judge the null result of start or end is because of the null value of startDate and endDate or having exception when processing getScheduleDate. If the cause is the exception of processing getScheduleDate [1], we need to return the result Status.REQUEST_PARAMS_NOT_VALID_ERROR to user.\nI think you can define the Status.START_OR_END_DATE_VALID_ERROR.\n\n\u8bf7\u6dfb\u52a0 startDate and endDate \u4e3a null \u65f6\u7684\u5224\u65ad\uff0c\u56e0\u4e3a\u5f53 start \u6216 end \u7684\u503c\u4e3a null \u65f6\uff0c\u6211\u4eec\u65e0\u6cd5\u5224\u65ad\u662f\u7531\u4e8e startDate \u6216\u8005 endDate \u4e3anull \u5bfc\u81f4\u7684\uff0c\u8fd8\u662f\u7531\u4e8e\u810f\u6570\u636e\u5bfc\u81f4\u5728\u6267\u884c getScheduleDate \u53d1\u751f\u5f02\u5e38\u5bfc\u81f4\u7684\u3002\u5982\u679c\u53d1\u751f\u5f02\u5e38\u5bfc\u81f4\u7684[1]\uff0c\u6211\u4eec\u5e94\u8be5\u8fd4\u56de Status.REQUEST_PARAMS_NOT_VALID_ERROR.\n\u4f60\u53ef\u4ee5\u770b\u4e0b\u6709\u6ca1\u6709\u5df2\u7ecf\u5b9a\u4e49\u597d\u7684\u5f02\u5e38\u7c7b\u578b\uff0c\u5982\u679c\u6ca1\u6709\u7684\u8bdd\uff0c\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u9519\u8bef\uff0c\u8be6\u7ec6\u63cf\u8ff0\u9519\u8bef\u5185\u5bb9\uff0c\u6bd4\u5982 Status.START_OR_END_DATE_VALID_ERROR.\n[1]", "author": "yangyichao-mango", "createdAt": "2020-08-21T01:50:30Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/TaskInstanceService.java", "diffHunk": "@@ -93,23 +99,17 @@\n         }\n \n         int[] statusArray = null;\n-        if(stateType != null){\n+        if (stateType != null) {\n             statusArray = new int[]{stateType.ordinal()};\n         }\n \n         Date start = null;\n         Date end = null;\n-        try {\n-            if(StringUtils.isNotEmpty(startDate)){\n-                start = DateUtils.getScheduleDate(startDate);\n-            }\n-            if(StringUtils.isNotEmpty( endDate)){\n-                end = DateUtils.getScheduleDate(endDate);\n-            }\n-        } catch (Exception e) {\n-            result.put(Constants.STATUS, Status.REQUEST_PARAMS_NOT_VALID_ERROR);\n-            result.put(Constants.MSG, MessageFormat.format(Status.REQUEST_PARAMS_NOT_VALID_ERROR.getMsg(), \"startDate,endDate\"));\n-            return result;\n+        if (StringUtils.isNotEmpty(startDate)) {\n+            start = DateUtils.getScheduleDate(startDate);\n+        }\n+        if (StringUtils.isNotEmpty(endDate)) {\n+            end = DateUtils.getScheduleDate(endDate);", "originalCommit": "6af5a3021c2ae44ea8aaa8a4e469f6e24a221c79", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM4NTIzOQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3563#discussion_r474385239", "bodyText": "thanks for review.\ni just use Status.REQUEST_PARAMS_NOT_VALID_ERROR to return the error when date param is not right", "author": "geosmart", "createdAt": "2020-08-21T03:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2MzM2NA=="}], "type": "inlineReview", "revised_code": {"commit": "6a83ba9992f28ff672b54332641173982a5382a9", "chunk": "diff --git a/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/TaskInstanceService.java b/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/TaskInstanceService.java\nindex f04e6a171..695b76b2b 100644\n--- a/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/TaskInstanceService.java\n+++ b/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/TaskInstanceService.java\n\n@@ -107,9 +108,15 @@ public class TaskInstanceService extends BaseService {\n         Date end = null;\n         if (StringUtils.isNotEmpty(startDate)) {\n             start = DateUtils.getScheduleDate(startDate);\n+            if (start == null) {\n+                return generateInvalidParamRes(result, \"startDate\");\n+            }\n         }\n         if (StringUtils.isNotEmpty(endDate)) {\n             end = DateUtils.getScheduleDate(endDate);\n+            if (end == null) {\n+                return generateInvalidParamRes(result, \"endDate\");\n+            }\n         }\n \n         Page<TaskInstance> page = new Page(pageNo, pageSize);\n"}}, {"oid": "6a83ba9992f28ff672b54332641173982a5382a9", "url": "https://github.com/apache/dolphinscheduler/commit/6a83ba9992f28ff672b54332641173982a5382a9", "message": "[Improvement-3556] add REQUEST_PARAMS_NOT_VALID_ERROR res when param is not valid", "committedDate": "2020-08-21T03:11:17Z", "type": "commit"}, {"oid": "303a8d4aa1162fc09f35bf7dde3bd1e7e68e448d", "url": "https://github.com/apache/dolphinscheduler/commit/303a8d4aa1162fc09f35bf7dde3bd1e7e68e448d", "message": "[fix-3548] Monitor gauge chart display blank with same pid", "committedDate": "2020-08-24T06:35:11Z", "type": "commit"}]}