{"pr_number": 4303, "pr_title": "[Feature-#3828][server] Delete recipients and CCs in the process defi\u2026", "pr_createdAt": "2020-12-24T10:04:29Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/4303", "timeline": [{"oid": "443504864013dc4c37b99ded426889b6287cab97", "url": "https://github.com/apache/dolphinscheduler/commit/443504864013dc4c37b99ded426889b6287cab97", "message": "[Feature-#3828][server] Delete recipients and CCs in the process definition and select the associated alert group instead\n\n* The specific alarm instance associated with the alert group\n* The process definition only associates the alert group, and does not care about the specific alarm instance.\n\nthis closes #3828", "committedDate": "2020-12-24T10:03:08Z", "type": "commit"}, {"oid": "c21441adbea0f7eb9d3bd2cb5f6cd75f805012b2", "url": "https://github.com/apache/dolphinscheduler/commit/c21441adbea0f7eb9d3bd2cb5f6cd75f805012b2", "message": "remove test cc", "committedDate": "2020-12-24T11:52:03Z", "type": "commit"}, {"oid": "b8ceb18ba15fd1d088707a2d5cb916011ef73f29", "url": "https://github.com/apache/dolphinscheduler/commit/b8ceb18ba15fd1d088707a2d5cb916011ef73f29", "message": "remove test cc", "committedDate": "2020-12-24T15:09:13Z", "type": "commit"}, {"oid": "2a48b17717c39cc81bbc3f422eccc02b5e7f282b", "url": "https://github.com/apache/dolphinscheduler/commit/2a48b17717c39cc81bbc3f422eccc02b5e7f282b", "message": "fix test error", "committedDate": "2020-12-25T04:53:49Z", "type": "commit"}, {"oid": "df0457f23aabf5ccb7f48bcabccd01bc81c8861e", "url": "https://github.com/apache/dolphinscheduler/commit/df0457f23aabf5ccb7f48bcabccd01bc81c8861e", "message": "add sql upgrade script\ndelete alert column(show_type\u3001alert_type\u3001re\u3001cc)", "committedDate": "2020-12-26T03:41:13Z", "type": "commit"}, {"oid": "6b928e3d182220adc8f3b0fc10f7d13eca33cbdb", "url": "https://github.com/apache/dolphinscheduler/commit/6b928e3d182220adc8f3b0fc10f7d13eca33cbdb", "message": "code style", "committedDate": "2020-12-26T03:45:31Z", "type": "commit"}, {"oid": "1a535fc18f85b57c7d6990038eddcd2aa89efed0", "url": "https://github.com/apache/dolphinscheduler/commit/1a535fc18f85b57c7d6990038eddcd2aa89efed0", "message": "update test\nNote the statement to delete the column, and provide related instructions", "committedDate": "2020-12-26T03:53:26Z", "type": "commit"}, {"oid": "20ee7f3cd7ca8313efda706f47e8a5d0df486651", "url": "https://github.com/apache/dolphinscheduler/commit/20ee7f3cd7ca8313efda706f47e8a5d0df486651", "message": "delete AlertGroup field(alert_type)", "committedDate": "2020-12-26T08:28:53Z", "type": "commit"}, {"oid": "60bc2ebd320c1736b7ba5ccdb34f6595c85ed775", "url": "https://github.com/apache/dolphinscheduler/commit/60bc2ebd320c1736b7ba5ccdb34f6595c85ed775", "message": "fix ut error", "committedDate": "2020-12-26T08:43:01Z", "type": "commit"}, {"oid": "4264f59547a70feb1f084b5c49e51b18ffe3e0bf", "url": "https://github.com/apache/dolphinscheduler/commit/4264f59547a70feb1f084b5c49e51b18ffe3e0bf", "message": "fix ut error", "committedDate": "2020-12-26T08:52:53Z", "type": "commit"}, {"oid": "e4048fbf89391a6ea91197ef668b9b87d1bddb5a", "url": "https://github.com/apache/dolphinscheduler/commit/e4048fbf89391a6ea91197ef668b9b87d1bddb5a", "message": "fix ut error", "committedDate": "2020-12-26T09:03:36Z", "type": "commit"}, {"oid": "8310b651598c2ce6f3a0490b88daad0c948d4aca", "url": "https://github.com/apache/dolphinscheduler/commit/8310b651598c2ce6f3a0490b88daad0c948d4aca", "message": "code style", "committedDate": "2020-12-26T10:28:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU0MDgwNw==", "url": "https://github.com/apache/dolphinscheduler/pull/4303#discussion_r549540807", "bodyText": "Why is there still receivers and receiversCc here ?", "author": "gaojun2048", "createdAt": "2020-12-29T01:56:35Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java", "diffHunk": "@@ -74,20 +90,20 @@\n      */\n     @ApiOperation(value = \"startProcessInstance\", notes = \"RUN_PROCESS_INSTANCE_NOTES\")\n     @ApiImplicitParams({\n-            @ApiImplicitParam(name = \"processDefinitionId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\"),\n-            @ApiImplicitParam(name = \"scheduleTime\", value = \"SCHEDULE_TIME\", required = true, dataType = \"String\"),\n-            @ApiImplicitParam(name = \"failureStrategy\", value = \"FAILURE_STRATEGY\", required = true, dataType = \"FailureStrategy\"),\n-            @ApiImplicitParam(name = \"startNodeList\", value = \"START_NODE_LIST\", dataType = \"String\"),\n-            @ApiImplicitParam(name = \"taskDependType\", value = \"TASK_DEPEND_TYPE\", dataType = \"TaskDependType\"),\n-            @ApiImplicitParam(name = \"execType\", value = \"COMMAND_TYPE\", dataType = \"CommandType\"),\n-            @ApiImplicitParam(name = \"warningType\", value = \"WARNING_TYPE\", required = true, dataType = \"WarningType\"),\n-            @ApiImplicitParam(name = \"warningGroupId\", value = \"WARNING_GROUP_ID\", required = true, dataType = \"Int\", example = \"100\"),\n-            @ApiImplicitParam(name = \"receivers\", value = \"RECEIVERS\", dataType = \"String\"),\n-            @ApiImplicitParam(name = \"receiversCc\", value = \"RECEIVERS_CC\", dataType = \"String\"),\n-            @ApiImplicitParam(name = \"runMode\", value = \"RUN_MODE\", dataType = \"RunMode\"),\n-            @ApiImplicitParam(name = \"processInstancePriority\", value = \"PROCESS_INSTANCE_PRIORITY\", required = true, dataType = \"Priority\"),\n-            @ApiImplicitParam(name = \"workerGroup\", value = \"WORKER_GROUP\", dataType = \"String\", example = \"default\"),\n-            @ApiImplicitParam(name = \"timeout\", value = \"TIMEOUT\", dataType = \"Int\", example = \"100\"),\n+        @ApiImplicitParam(name = \"processDefinitionId\", value = \"PROCESS_DEFINITION_ID\", required = true, dataType = \"Int\", example = \"100\"),\n+        @ApiImplicitParam(name = \"scheduleTime\", value = \"SCHEDULE_TIME\", required = true, dataType = \"String\"),\n+        @ApiImplicitParam(name = \"failureStrategy\", value = \"FAILURE_STRATEGY\", required = true, dataType = \"FailureStrategy\"),\n+        @ApiImplicitParam(name = \"startNodeList\", value = \"START_NODE_LIST\", dataType = \"String\"),\n+        @ApiImplicitParam(name = \"taskDependType\", value = \"TASK_DEPEND_TYPE\", dataType = \"TaskDependType\"),\n+        @ApiImplicitParam(name = \"execType\", value = \"COMMAND_TYPE\", dataType = \"CommandType\"),\n+        @ApiImplicitParam(name = \"warningType\", value = \"WARNING_TYPE\", required = true, dataType = \"WarningType\"),\n+        @ApiImplicitParam(name = \"warningGroupId\", value = \"WARNING_GROUP_ID\", required = true, dataType = \"Int\", example = \"100\"),\n+        @ApiImplicitParam(name = \"receivers\", value = \"RECEIVERS\", dataType = \"String\"),", "originalCommit": "8310b651598c2ce6f3a0490b88daad0c948d4aca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "chunk": "diff --git a/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java b/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java\nindex 8245be0b7..b908b0511 100644\n--- a/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java\n+++ b/dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/controller/ExecutorController.java\n\n@@ -98,8 +98,6 @@ public class ExecutorController extends BaseController {\n         @ApiImplicitParam(name = \"execType\", value = \"COMMAND_TYPE\", dataType = \"CommandType\"),\n         @ApiImplicitParam(name = \"warningType\", value = \"WARNING_TYPE\", required = true, dataType = \"WarningType\"),\n         @ApiImplicitParam(name = \"warningGroupId\", value = \"WARNING_GROUP_ID\", required = true, dataType = \"Int\", example = \"100\"),\n-        @ApiImplicitParam(name = \"receivers\", value = \"RECEIVERS\", dataType = \"String\"),\n-        @ApiImplicitParam(name = \"receiversCc\", value = \"RECEIVERS_CC\", dataType = \"String\"),\n         @ApiImplicitParam(name = \"runMode\", value = \"RUN_MODE\", dataType = \"RunMode\"),\n         @ApiImplicitParam(name = \"processInstancePriority\", value = \"PROCESS_INSTANCE_PRIORITY\", required = true, dataType = \"Priority\"),\n         @ApiImplicitParam(name = \"workerGroup\", value = \"WORKER_GROUP\", dataType = \"String\", example = \"default\"),\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU0MTY5Mw==", "url": "https://github.com/apache/dolphinscheduler/pull/4303#discussion_r549541693", "bodyText": "I think alert group and user no longer have any relationship in this feature. So this method need be delete.", "author": "gaojun2048", "createdAt": "2020-12-29T02:02:42Z", "path": "dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java", "diffHunk": "@@ -99,31 +97,31 @@ public int updateAlert(AlertStatus alertStatus, String log, int id) {\n     /**\n      * query user list by alert group id\n      *\n-     * @param alerGroupId alerGroupId\n+     * @param alertGroupId alertGroupId\n      * @return user list\n      */\n-    public List<User> queryUserByAlertGroupId(int alerGroupId) {\n+    public List<User> queryUserByAlertGroupId(int alertGroupId) {", "originalCommit": "8310b651598c2ce6f3a0490b88daad0c948d4aca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "chunk": "diff --git a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\nindex ed30b7c64..d03b7c5be 100644\n--- a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\n+++ b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\n\n@@ -94,17 +88,6 @@ public class AlertDao extends AbstractBaseDao {\n         return alertMapper.updateById(alert);\n     }\n \n-    /**\n-     * query user list by alert group id\n-     *\n-     * @param alertGroupId alertGroupId\n-     * @return user list\n-     */\n-    public List<User> queryUserByAlertGroupId(int alertGroupId) {\n-\n-        return userAlertGroupMapper.listUserByAlertGroupId(alertGroupId);\n-    }\n-\n     /**\n      * MasterServer or WorkerServer stoped\n      *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU0MTk0MA==", "url": "https://github.com/apache/dolphinscheduler/pull/4303#discussion_r549541940", "bodyText": "UserAlertGroupMapper need be delete in this feature.", "author": "gaojun2048", "createdAt": "2020-12-29T02:04:23Z", "path": "dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java", "diffHunk": "@@ -207,11 +193,11 @@ public void sendTaskTimeoutAlert(int alertgroupId, String receivers, String rece\n     /**\n      * list user information by alert group id\n      *\n-     * @param alertgroupId alertgroupId\n+     * @param alertGroupId alertGroupId\n      * @return user list\n      */\n-    public List<User> listUserByAlertgroupId(int alertgroupId) {\n-        return userAlertGroupMapper.listUserByAlertgroupId(alertgroupId);\n+    public List<User> listUserByAlertGroupId(int alertGroupId) {\n+        return userAlertGroupMapper.listUserByAlertGroupId(alertGroupId);", "originalCommit": "8310b651598c2ce6f3a0490b88daad0c948d4aca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "chunk": "diff --git a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\nindex ed30b7c64..d03b7c5be 100644\n--- a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\n+++ b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\n\n@@ -190,16 +173,6 @@ public class AlertDao extends AbstractBaseDao {\n         return alertMapper.listAlertByStatus(AlertStatus.WAIT_EXECUTION);\n     }\n \n-    /**\n-     * list user information by alert group id\n-     *\n-     * @param alertGroupId alertGroupId\n-     * @return user list\n-     */\n-    public List<User> listUserByAlertGroupId(int alertGroupId) {\n-        return userAlertGroupMapper.listUserByAlertGroupId(alertGroupId);\n-    }\n-\n     /**\n      * for test\n      *\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU0MjM5OA==", "url": "https://github.com/apache/dolphinscheduler/pull/4303#discussion_r549542398", "bodyText": "UserAlertGroupMapper is need be delete in this feature.", "author": "gaojun2048", "createdAt": "2020-12-29T02:06:52Z", "path": "dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/mapper/UserAlertGroupMapper.java", "diffHunk": "@@ -30,16 +30,18 @@\n \n     /**\n      * delete user alertgroup relation by alertgroupId\n-     * @param alertgroupId alertgroupId\n+     *\n+     * @param alertGroupId alertGroupId\n      * @return delete result\n      */\n-    int deleteByAlertgroupId(@Param(\"alertgroupId\") int alertgroupId);\n+    int deleteByAlertGroupId(@Param(\"alertgroupId\") int alertGroupId);\n \n     /**\n-     *  list user by alertgroupId\n-     * @param alertgroupId alertgroupId\n+     * list user by alertgroupId\n+     *\n+     * @param alertGroupId alertgroupId\n      * @return user list\n      */\n-    List<User> listUserByAlertgroupId(@Param(\"alertgroupId\") int alertgroupId);\n+    List<User> listUserByAlertGroupId(@Param(\"alertgroupId\") int alertGroupId);", "originalCommit": "8310b651598c2ce6f3a0490b88daad0c948d4aca", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "chunk": "diff --git a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/mapper/UserAlertGroupMapper.java b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/mapper/UserAlertGroupMapper.java\nindex b2279c1d9..944ab1b0c 100644\n--- a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/mapper/UserAlertGroupMapper.java\n+++ b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/mapper/UserAlertGroupMapper.java\n\n@@ -36,12 +36,4 @@ public interface UserAlertGroupMapper extends BaseMapper<UserAlertGroup> {\n      */\n     int deleteByAlertGroupId(@Param(\"alertgroupId\") int alertGroupId);\n \n-    /**\n-     * list user by alertgroupId\n-     *\n-     * @param alertGroupId alertgroupId\n-     * @return user list\n-     */\n-    List<User> listUserByAlertGroupId(@Param(\"alertgroupId\") int alertGroupId);\n-\n }\n"}}, {"oid": "eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "url": "https://github.com/apache/dolphinscheduler/commit/eca4a5655f4a749cfd8461f7e7fde9968c1e5103", "message": "delete api-doc receiverCC", "committedDate": "2020-12-29T02:35:56Z", "type": "commit"}, {"oid": "9c112f06ac5286639e9076f1c564920bc8b7c077", "url": "https://github.com/apache/dolphinscheduler/commit/9c112f06ac5286639e9076f1c564920bc8b7c077", "message": "delete UserAlertGroupMapper", "committedDate": "2020-12-29T02:48:21Z", "type": "commit"}, {"oid": "f8dd917f547d093bdd2492fda3ab519b902bf425", "url": "https://github.com/apache/dolphinscheduler/commit/f8dd917f547d093bdd2492fda3ab519b902bf425", "message": "delete UserAlertGroup", "committedDate": "2020-12-29T03:12:54Z", "type": "commit"}, {"oid": "4385a0f5021d9e0110360c5909d5edbb52e6bfd8", "url": "https://github.com/apache/dolphinscheduler/commit/4385a0f5021d9e0110360c5909d5edbb52e6bfd8", "message": "delete UserAlertGroupApi", "committedDate": "2020-12-29T03:29:13Z", "type": "commit"}, {"oid": "7189e142114f418808959e1c4ecd99cc001aa132", "url": "https://github.com/apache/dolphinscheduler/commit/7189e142114f418808959e1c4ecd99cc001aa132", "message": "alert group add coulmn user_id", "committedDate": "2020-12-29T04:04:10Z", "type": "commit"}, {"oid": "939ea80bd658daf98652035e5dac946d56837d26", "url": "https://github.com/apache/dolphinscheduler/commit/939ea80bd658daf98652035e5dac946d56837d26", "message": "alter user_id to create_user_id", "committedDate": "2020-12-29T06:23:45Z", "type": "commit"}, {"oid": "958f802142445e217e05f32b657d215c5420a431", "url": "https://github.com/apache/dolphinscheduler/commit/958f802142445e217e05f32b657d215c5420a431", "message": "userinfo remove alert group info", "committedDate": "2020-12-29T06:28:23Z", "type": "commit"}]}