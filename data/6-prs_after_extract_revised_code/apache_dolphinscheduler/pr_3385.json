{"pr_number": 3385, "pr_title": "[Improvement][dao,server] unit test for ConditionsTask", "pr_createdAt": "2020-08-02T14:47:15Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3385", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MTI5Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/3385#discussion_r464251296", "bodyText": "Why change common.utils.JSONUtils to jackson.annotation.JsonFormat ?", "author": "Jave-Chen", "createdAt": "2020-08-03T07:55:24Z", "path": "dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/entity/TaskInstance.java", "diffHunk": "@@ -16,19 +16,18 @@\n  */\n package org.apache.dolphinscheduler.dao.entity;\n \n-import com.baomidou.mybatisplus.annotation.IdType;\n-import com.baomidou.mybatisplus.annotation.TableField;\n-import com.fasterxml.jackson.annotation.JsonFormat;\n import org.apache.dolphinscheduler.common.enums.ExecutionStatus;\n import org.apache.dolphinscheduler.common.enums.Flag;\n import org.apache.dolphinscheduler.common.enums.Priority;\n import org.apache.dolphinscheduler.common.enums.TaskType;\n import org.apache.dolphinscheduler.common.model.TaskNode;\n-import org.apache.dolphinscheduler.common.utils.*;\n+import org.apache.dolphinscheduler.common.utils.JSONUtils;\n+\n import com.baomidou.mybatisplus.annotation.IdType;\n+import com.baomidou.mybatisplus.annotation.TableField;\n import com.baomidou.mybatisplus.annotation.TableId;\n import com.baomidou.mybatisplus.annotation.TableName;\n-import org.apache.dolphinscheduler.common.utils.JSONUtils;\n+import com.fasterxml.jackson.annotation.JsonFormat;\n ", "originalCommit": "630c7873b356b5edb5d5b47ef934536c8a256cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MjIwNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3385#discussion_r464252205", "bodyText": "Why change common.utils.JSONUtils to jackson.annotation.JsonFormat ?\n\nA import auto refactoring happened here.", "author": "hsupu", "createdAt": "2020-08-03T07:57:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1MTI5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "d8b63cb8c2b6fe3d977ae7a099608dee8db08e2f", "chunk": "diff --git a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/entity/TaskInstance.java b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/entity/TaskInstance.java\nindex 42408d317..b82da62b0 100644\n--- a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/entity/TaskInstance.java\n+++ b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/entity/TaskInstance.java\n\n@@ -23,16 +23,16 @@ import org.apache.dolphinscheduler.common.enums.TaskType;\n import org.apache.dolphinscheduler.common.model.TaskNode;\n import org.apache.dolphinscheduler.common.utils.JSONUtils;\n \n+import java.io.Serializable;\n+import java.util.Date;\n+import java.util.Map;\n+\n import com.baomidou.mybatisplus.annotation.IdType;\n import com.baomidou.mybatisplus.annotation.TableField;\n import com.baomidou.mybatisplus.annotation.TableId;\n import com.baomidou.mybatisplus.annotation.TableName;\n import com.fasterxml.jackson.annotation.JsonFormat;\n \n-import java.io.Serializable;\n-import java.util.Date;\n-import java.util.Map;\n-\n /**\n  * task instance\n  */\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1OTIzMA==", "url": "https://github.com/apache/dolphinscheduler/pull/3385#discussion_r464259230", "bodyText": "Hi,\nGood job, but there is no necessary to add the FLOWNODE_RUN_FLAG_NORMAL in Constants just for test case.\nIf you want to add the constant, you can directly add FLOWNODE_RUN_FLAG_NORMAL in ConditionsTaskTest", "author": "yangyichao-mango", "createdAt": "2020-08-03T08:12:26Z", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java", "diffHunk": "@@ -391,7 +391,12 @@ private Constants() {\n     public static final int RPC_PORT = 50051;\n \n     /**\n-     * forbid running task\n+     * task can be run normally\n+     */\n+    public static final String FLOWNODE_RUN_FLAG_NORMAL = \"NORMAL\";", "originalCommit": "630c7873b356b5edb5d5b47ef934536c8a256cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTQ1NzIyNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3385#discussion_r465457225", "bodyText": "I just moved it to the test file by now, but I think it should be a constant for \"NORMAL\" in common/Constants.java for use in future.", "author": "hsupu", "createdAt": "2020-08-05T03:57:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI1OTIzMA=="}], "type": "inlineReview", "revised_code": {"commit": "653871804eee1f26b598e8945bacbeb2f587405e", "chunk": "diff --git a/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java b/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java\nindex ae30fc0c1..4cb09a1a5 100644\n--- a/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java\n+++ b/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/Constants.java\n\n@@ -391,12 +391,7 @@ public final class Constants {\n     public static final int RPC_PORT = 50051;\n \n     /**\n-     * task can be run normally\n-     */\n-    public static final String FLOWNODE_RUN_FLAG_NORMAL = \"NORMAL\";\n-\n-    /**\n-     * task forbidden to run\n+     * forbid running task\n      */\n     public static final String FLOWNODE_RUN_FLAG_FORBIDDEN = \"FORBIDDEN\";\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI2ODIzOQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3385#discussion_r464268239", "bodyText": "Hi,\nI checkout to your branch and found that the ConditionsTaskTest.java is not in the test case includer.\nPlease add the test to root pom.", "author": "yangyichao-mango", "createdAt": "2020-08-03T08:30:28Z", "path": "dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/master/ConditionsTaskTest.java", "diffHunk": "@@ -17,7 +17,16 @@\n package org.apache.dolphinscheduler.server.master;", "originalCommit": "630c7873b356b5edb5d5b47ef934536c8a256cb5", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "653871804eee1f26b598e8945bacbeb2f587405e", "chunk": "diff --git a/dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/master/ConditionsTaskTest.java b/dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/master/ConditionsTaskTest.java\nindex 14308398b..a72d843dd 100644\n--- a/dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/master/ConditionsTaskTest.java\n+++ b/dolphinscheduler-server/src/test/java/org/apache/dolphinscheduler/server/master/ConditionsTaskTest.java\n\n@@ -17,7 +17,6 @@\n package org.apache.dolphinscheduler.server.master;\n \n \n-import org.apache.dolphinscheduler.common.Constants;\n import org.apache.dolphinscheduler.common.enums.DependentRelation;\n import org.apache.dolphinscheduler.common.enums.ExecutionStatus;\n import org.apache.dolphinscheduler.common.enums.TaskType;\n"}}, {"oid": "653871804eee1f26b598e8945bacbeb2f587405e", "url": "https://github.com/apache/dolphinscheduler/commit/653871804eee1f26b598e8945bacbeb2f587405e", "message": "enable test", "committedDate": "2020-08-03T08:42:09Z", "type": "forcePushed"}, {"oid": "d4b61ed1928de5466326a4a0406c542fce51b435", "url": "https://github.com/apache/dolphinscheduler/commit/d4b61ed1928de5466326a4a0406c542fce51b435", "message": "polish", "committedDate": "2020-08-10T08:48:04Z", "type": "forcePushed"}, {"oid": "d8b63cb8c2b6fe3d977ae7a099608dee8db08e2f", "url": "https://github.com/apache/dolphinscheduler/commit/d8b63cb8c2b6fe3d977ae7a099608dee8db08e2f", "message": "merged", "committedDate": "2020-08-18T02:35:11Z", "type": "forcePushed"}, {"oid": "d8b63cb8c2b6fe3d977ae7a099608dee8db08e2f", "url": "https://github.com/apache/dolphinscheduler/commit/d8b63cb8c2b6fe3d977ae7a099608dee8db08e2f", "message": "merged", "committedDate": "2020-08-18T02:35:11Z", "type": "commit"}, {"oid": "4a70cd323385ea86189607c5577cb381b44f7f1c", "url": "https://github.com/apache/dolphinscheduler/commit/4a70cd323385ea86189607c5577cb381b44f7f1c", "message": "update", "committedDate": "2020-08-18T02:53:50Z", "type": "commit"}]}