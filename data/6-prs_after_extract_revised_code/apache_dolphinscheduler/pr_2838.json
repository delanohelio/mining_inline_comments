{"pr_number": 2838, "pr_title": "fix table not exist when init db metadata", "pr_createdAt": "2020-05-28T07:28:38Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/2838", "timeline": [{"oid": "884f2640204275921d0ef38e277dc82df0214fb9", "url": "https://github.com/apache/dolphinscheduler/commit/884f2640204275921d0ef38e277dc82df0214fb9", "message": "fix table not exist when init db metadata", "committedDate": "2020-05-28T06:27:18Z", "type": "commit"}, {"oid": "dd8cfe9145e353f7a6eacd89708a4ccd4e9e283b", "url": "https://github.com/apache/dolphinscheduler/commit/dd8cfe9145e353f7a6eacd89708a4ccd4e9e283b", "message": "Merge remote-tracking branch 'upstream/dev-1.3.0' into dev-1.3.0-cdh5.16.2", "committedDate": "2020-05-28T07:36:39Z", "type": "commit"}, {"oid": "e021e0031de76bfa36830e66a11f46b70a611c8e", "url": "https://github.com/apache/dolphinscheduler/commit/e021e0031de76bfa36830e66a11f46b70a611c8e", "message": "fix db init error", "committedDate": "2020-05-28T07:47:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIyOTQ5Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/2838#discussion_r432229496", "bodyText": "Hi,why remove to this place,it will run more one times", "author": "lgcareer", "createdAt": "2020-05-29T02:56:22Z", "path": "dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/upgrade/DolphinSchedulerManager.java", "diffHunk": "@@ -112,11 +112,12 @@ public void upgradeDolphinScheduler() throws Exception{\n             for(String schemaDir : schemaList) {\n                 schemaVersion = schemaDir.split(\"_\")[0];\n                 if(SchemaUtils.isAGreatVersion(schemaVersion , version)) {\n-\n-                    logger.info(\"upgrade DolphinScheduler metadata version from \" + version + \" to \" + schemaVersion);\n-\n+                    logger.info(\"upgrade DolphinScheduler metadata version from {} to {}\", version, schemaVersion);\n                     logger.info(\"Begin upgrading DolphinScheduler's table structure\");\n                     upgradeDao.upgradeDolphinScheduler(schemaDir);\n+                    if (upgradeDao.isExistsTable(\"t_ds_worker_group\")) {", "originalCommit": "e021e0031de76bfa36830e66a11f46b70a611c8e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM1OTg5MA==", "url": "https://github.com/apache/dolphinscheduler/pull/2838#discussion_r432359890", "bodyText": "Yes, need according to ds-version to exec upgrade worker group", "author": "Eights-Li", "createdAt": "2020-05-29T09:16:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIyOTQ5Ng=="}], "type": "inlineReview", "revised_code": {"commit": "a88f6f2c6de89dac7617e334e59c280fb7d45845", "chunk": "diff --git a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/upgrade/DolphinSchedulerManager.java b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/upgrade/DolphinSchedulerManager.java\nindex 6752b779b..8d1d86264 100644\n--- a/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/upgrade/DolphinSchedulerManager.java\n+++ b/dolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/upgrade/DolphinSchedulerManager.java\n\n@@ -115,7 +115,7 @@ public class DolphinSchedulerManager {\n                     logger.info(\"upgrade DolphinScheduler metadata version from {} to {}\", version, schemaVersion);\n                     logger.info(\"Begin upgrading DolphinScheduler's table structure\");\n                     upgradeDao.upgradeDolphinScheduler(schemaDir);\n-                    if (upgradeDao.isExistsTable(\"t_ds_worker_group\")) {\n+                    if (\"1.3.0\".equals(schemaVersion)) {\n                         upgradeDao.upgradeDolphinSchedulerWorkerGroup();\n                     }\n                     version = schemaVersion;\n"}}, {"oid": "a88f6f2c6de89dac7617e334e59c280fb7d45845", "url": "https://github.com/apache/dolphinscheduler/commit/a88f6f2c6de89dac7617e334e59c280fb7d45845", "message": "fix ds-1.3.0 init db", "committedDate": "2020-05-29T09:04:23Z", "type": "commit"}, {"oid": "0124506d51a88b37051eaf1ef30c163976cc29f1", "url": "https://github.com/apache/dolphinscheduler/commit/0124506d51a88b37051eaf1ef30c163976cc29f1", "message": "init db modify process instance json", "committedDate": "2020-05-29T13:31:03Z", "type": "commit"}]}