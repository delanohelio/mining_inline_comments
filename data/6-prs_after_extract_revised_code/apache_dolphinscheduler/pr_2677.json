{"pr_number": 2677, "pr_title": "Optimization of enumerated values method", "pr_createdAt": "2020-05-11T09:13:25Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/2677", "timeline": [{"oid": "e06c31e77ca790a5c090247d874298bfd47f3599", "url": "https://github.com/apache/dolphinscheduler/commit/e06c31e77ca790a5c090247d874298bfd47f3599", "message": "The value method of enum is a deep copy. If there are many parameters, it is not recommended to use the value method. Specifically see jmh results", "committedDate": "2020-05-11T09:06:40Z", "type": "commit"}, {"oid": "0de5d0ffebef233ee6de0024f27a7de09cb7a97e", "url": "https://github.com/apache/dolphinscheduler/commit/0de5d0ffebef233ee6de0024f27a7de09cb7a97e", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-11T09:14:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0OTMzNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/2677#discussion_r423649335", "bodyText": "do you have better idea? I think the map key will be easy to make wrong with the enum self ,  actually , it write twice now, these number  will be easy to wrong", "author": "dailidong", "createdAt": "2020-05-12T11:07:03Z", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java", "diffHunk": "@@ -66,11 +69,26 @@ public String getDescp() {\n         return descp;\n     }\n \n-    public static CommandType of(Integer status){\n-        for(CommandType cmdType : values()){\n-            if(cmdType.getCode() == status){\n-                return cmdType;\n-            }\n+    private static final Map<Integer, CommandType> COMMAND_TYPE_MAP = new HashMap<>();\n+\n+    static {\n+        COMMAND_TYPE_MAP.put(0, START_PROCESS);\n+        COMMAND_TYPE_MAP.put(1, START_CURRENT_TASK_PROCESS);\n+        COMMAND_TYPE_MAP.put(2, RECOVER_TOLERANCE_FAULT_PROCESS);\n+        COMMAND_TYPE_MAP.put(3, RECOVER_SUSPENDED_PROCESS);\n+        COMMAND_TYPE_MAP.put(4, START_FAILURE_TASK_PROCESS);\n+        COMMAND_TYPE_MAP.put(5, COMPLEMENT_DATA);\n+        COMMAND_TYPE_MAP.put(6, SCHEDULER);\n+        COMMAND_TYPE_MAP.put(7, REPEAT_RUNNING);\n+        COMMAND_TYPE_MAP.put(8, PAUSE);\n+        COMMAND_TYPE_MAP.put(9, STOP);\n+        COMMAND_TYPE_MAP.put(10, RECOVER_WAITTING_THREAD);", "originalCommit": "0de5d0ffebef233ee6de0024f27a7de09cb7a97e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3OTkyNQ==", "url": "https://github.com/apache/dolphinscheduler/pull/2677#discussion_r423679925", "bodyText": "do you have better idea? I think the map key will be easy to make wrong with the enum self , actually , it write twice now, these number will be easy to wrong\n\nI have completed the change, please review", "author": "CalvinKirs", "createdAt": "2020-05-12T12:05:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0OTMzNQ=="}], "type": "inlineReview", "revised_code": {"commit": "063625112dc9c0e7dffb437f8bba4adfba3e9007", "chunk": "diff --git a/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java b/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java\nindex 8032f2f17..9682016d6 100644\n--- a/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java\n+++ b/dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/CommandType.java\n\n@@ -72,17 +72,9 @@ public enum CommandType {\n     private static final Map<Integer, CommandType> COMMAND_TYPE_MAP = new HashMap<>();\n \n     static {\n-        COMMAND_TYPE_MAP.put(0, START_PROCESS);\n-        COMMAND_TYPE_MAP.put(1, START_CURRENT_TASK_PROCESS);\n-        COMMAND_TYPE_MAP.put(2, RECOVER_TOLERANCE_FAULT_PROCESS);\n-        COMMAND_TYPE_MAP.put(3, RECOVER_SUSPENDED_PROCESS);\n-        COMMAND_TYPE_MAP.put(4, START_FAILURE_TASK_PROCESS);\n-        COMMAND_TYPE_MAP.put(5, COMPLEMENT_DATA);\n-        COMMAND_TYPE_MAP.put(6, SCHEDULER);\n-        COMMAND_TYPE_MAP.put(7, REPEAT_RUNNING);\n-        COMMAND_TYPE_MAP.put(8, PAUSE);\n-        COMMAND_TYPE_MAP.put(9, STOP);\n-        COMMAND_TYPE_MAP.put(10, RECOVER_WAITTING_THREAD);\n+        for (CommandType commandType : CommandType.values()) {\n+            COMMAND_TYPE_MAP.put(commandType.code,commandType);\n+        }\n     }\n \n \n"}}, {"oid": "063625112dc9c0e7dffb437f8bba4adfba3e9007", "url": "https://github.com/apache/dolphinscheduler/commit/063625112dc9c0e7dffb437f8bba4adfba3e9007", "message": "beautiful misunderstanding", "committedDate": "2020-05-12T11:45:26Z", "type": "commit"}, {"oid": "8aa38e050ead8ab9b6cbabae65ebb09fd100ea82", "url": "https://github.com/apache/dolphinscheduler/commit/8aa38e050ead8ab9b6cbabae65ebb09fd100ea82", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-14T04:47:55Z", "type": "commit"}, {"oid": "b5326ac68e255cb0cd6f0d74cb6056a8e125512e", "url": "https://github.com/apache/dolphinscheduler/commit/b5326ac68e255cb0cd6f0d74cb6056a8e125512e", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-14T11:24:15Z", "type": "commit"}, {"oid": "00f1613c030e76d69f80b4f25fefde41ea4f69d2", "url": "https://github.com/apache/dolphinscheduler/commit/00f1613c030e76d69f80b4f25fefde41ea4f69d2", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-14T11:38:11Z", "type": "commit"}, {"oid": "cf626af6c85900ddcf770e266c671c57160bf955", "url": "https://github.com/apache/dolphinscheduler/commit/cf626af6c85900ddcf770e266c671c57160bf955", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-19T03:54:42Z", "type": "commit"}, {"oid": "24acd92fcd0ce65579f1a13d8f09f5db977c7e84", "url": "https://github.com/apache/dolphinscheduler/commit/24acd92fcd0ce65579f1a13d8f09f5db977c7e84", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-20T03:35:25Z", "type": "commit"}, {"oid": "61bf032b69766a40906f34fb44a9d0cd34fd4bae", "url": "https://github.com/apache/dolphinscheduler/commit/61bf032b69766a40906f34fb44a9d0cd34fd4bae", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-21T06:56:06Z", "type": "commit"}, {"oid": "3698e8122092cbb273d8766a41cd3bf7612a0f90", "url": "https://github.com/apache/dolphinscheduler/commit/3698e8122092cbb273d8766a41cd3bf7612a0f90", "message": "Merge branch 'dev' into enum", "committedDate": "2020-05-30T15:21:29Z", "type": "commit"}]}