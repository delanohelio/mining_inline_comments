{"pr_number": 3559, "pr_title": "[Improvement][alert]   Optimize alarm information", "pr_createdAt": "2020-08-20T04:56:46Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/3559", "timeline": [{"oid": "b1d1e635eacba59153a6d953f6929caeb08d0d73", "url": "https://github.com/apache/dolphinscheduler/commit/b1d1e635eacba59153a6d953f6929caeb08d0d73", "message": "#3299  Json string parsing problem caused by non-standard json format.", "committedDate": "2020-08-19T07:29:26Z", "type": "commit"}, {"oid": "5445786e7884fb6642a7ccfa89abebf584c744bd", "url": "https://github.com/apache/dolphinscheduler/commit/5445786e7884fb6642a7ccfa89abebf584c744bd", "message": "#3299  Json string parsing problem caused by non-standard json format.", "committedDate": "2020-08-19T07:42:50Z", "type": "commit"}, {"oid": "d2375aa203af09c9ba20eb6c52d8991c1ad377f6", "url": "https://github.com/apache/dolphinscheduler/commit/d2375aa203af09c9ba20eb6c52d8991c1ad377f6", "message": "#3299  Json string parsing problem caused by non-standard json format. fix  code style", "committedDate": "2020-08-19T07:44:35Z", "type": "commit"}, {"oid": "56653556d7f715c7d9d168edd7c584ae6a5de681", "url": "https://github.com/apache/dolphinscheduler/commit/56653556d7f715c7d9d168edd7c584ae6a5de681", "message": "#3299  Json string parsing problem caused by non-standard json format. fix  code style", "committedDate": "2020-08-19T08:04:37Z", "type": "commit"}, {"oid": "040c5d67c0dd0adb8e16a303b5ee34eba21621a5", "url": "https://github.com/apache/dolphinscheduler/commit/040c5d67c0dd0adb8e16a303b5ee34eba21621a5", "message": "Optimize alarm information", "committedDate": "2020-08-20T04:45:10Z", "type": "commit"}, {"oid": "8abbda2ba1f56b2a543a3133307b192d9246f1bd", "url": "https://github.com/apache/dolphinscheduler/commit/8abbda2ba1f56b2a543a3133307b192d9246f1bd", "message": "Merge branch 'dev' into Json\n\n# Conflicts:\n#\tdolphinscheduler-dao/src/main/java/org/apache/dolphinscheduler/dao/AlertDao.java\n#\tdolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/utils/AlertManager.java", "committedDate": "2020-08-20T04:54:55Z", "type": "commit"}, {"oid": "47f3f506e62b7221843acc9720f95acd26ee60c8", "url": "https://github.com/apache/dolphinscheduler/commit/47f3f506e62b7221843acc9720f95acd26ee60c8", "message": "fix code style", "committedDate": "2020-08-20T05:00:45Z", "type": "commit"}, {"oid": "065ddf493b6d596ebb3a427dd1ffaa049457b1d3", "url": "https://github.com/apache/dolphinscheduler/commit/065ddf493b6d596ebb3a427dd1ffaa049457b1d3", "message": "add license", "committedDate": "2020-08-20T05:02:41Z", "type": "commit"}, {"oid": "8fcadb6902d74a6d149b5077b08fe355a00f0043", "url": "https://github.com/apache/dolphinscheduler/commit/8fcadb6902d74a6d149b5077b08fe355a00f0043", "message": "fix code smell", "committedDate": "2020-08-20T05:36:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM2OTk0OA==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474369948", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .replaceAll(\"\\\\{corpId\\\\}\", ENTERPRISE_WE_CHAT_CORP_ID)\n          \n          \n            \n                        .replaceAll(\"\\\\{secret\\\\}\", ENTERPRISE_WE_CHAT_SECRET);\n          \n          \n            \n                        .replaceAll(\"\\\\{corpId}\", ENTERPRISE_WE_CHAT_CORP_ID)\n          \n          \n            \n                        .replaceAll(\"\\\\{secret}\", ENTERPRISE_WE_CHAT_SECRET);\n          \n      \n    \n    \n  \n\nPlease change the other part of replaceAll.", "author": "yangyichao-mango", "createdAt": "2020-08-21T02:16:18Z", "path": "dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java", "diffHunk": "@@ -48,8 +55,8 @@\n \n     private static final String ENTERPRISE_WE_CHAT_TOKEN_URL = PropertyUtils.getString(Constants.ENTERPRISE_WECHAT_TOKEN_URL);\n     private static final String ENTERPRISE_WE_CHAT_TOKEN_URL_REPLACE = ENTERPRISE_WE_CHAT_TOKEN_URL == null ? null : ENTERPRISE_WE_CHAT_TOKEN_URL\n-    .replaceAll(\"\\\\{corpId\\\\}\", ENTERPRISE_WE_CHAT_CORP_ID)\n-    .replaceAll(\"\\\\{secret\\\\}\", ENTERPRISE_WE_CHAT_SECRET);\n+            .replaceAll(\"\\\\{corpId\\\\}\", ENTERPRISE_WE_CHAT_CORP_ID)\n+            .replaceAll(\"\\\\{secret\\\\}\", ENTERPRISE_WE_CHAT_SECRET);", "originalCommit": "8fcadb6902d74a6d149b5077b08fe355a00f0043", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "5aeba114f02db7eb0b281f860a9303284beb19c7", "chunk": "diff --git a/dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java b/dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java\nindex c0e10dbea..9eea1d4ff 100644\n--- a/dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java\n+++ b/dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java\n\n@@ -55,8 +55,8 @@ public class EnterpriseWeChatUtils {\n \n     private static final String ENTERPRISE_WE_CHAT_TOKEN_URL = PropertyUtils.getString(Constants.ENTERPRISE_WECHAT_TOKEN_URL);\n     private static final String ENTERPRISE_WE_CHAT_TOKEN_URL_REPLACE = ENTERPRISE_WE_CHAT_TOKEN_URL == null ? null : ENTERPRISE_WE_CHAT_TOKEN_URL\n-            .replaceAll(\"\\\\{corpId\\\\}\", ENTERPRISE_WE_CHAT_CORP_ID)\n-            .replaceAll(\"\\\\{secret\\\\}\", ENTERPRISE_WE_CHAT_SECRET);\n+            .replaceAll(\"\\\\{corpId}\", ENTERPRISE_WE_CHAT_CORP_ID)\n+            .replaceAll(\"\\\\{secret}\", ENTERPRISE_WE_CHAT_SECRET);\n \n     private static final String ENTERPRISE_WE_CHAT_PUSH_URL = PropertyUtils.getString(Constants.ENTERPRISE_WECHAT_PUSH_URL);\n \n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTEwMA==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474371100", "bodyText": "Is it better to match the logger?\nFor excample: debug, info, warning, error", "author": "yangyichao-mango", "createdAt": "2020-08-21T02:20:57Z", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/enums/AlertWarnLevel.java", "diffHunk": "@@ -0,0 +1,23 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.dolphinscheduler.common.enums;\n+\n+public enum AlertWarnLevel {\n+\n+    MIDDLE,SERIOUS", "originalCommit": "8fcadb6902d74a6d149b5077b08fe355a00f0043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQwOTg2NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474409865", "bodyText": "Is it better to match the logger?\nFor excample: debug, info, warning, error\nThis is a way of storing the string directly into the content of the message and sending it out, and if it's a number it needs to be sent out under conversion.", "author": "felix-thinkingdata", "createdAt": "2020-08-21T05:02:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQxMDE0MA==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474410140", "bodyText": "", "author": "felix-thinkingdata", "createdAt": "2020-08-21T05:03:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTEwMA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTg4Nw==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474371887", "bodyText": "Is this file changes related with this pr?\nIf not related, please revert.", "author": "yangyichao-mango", "createdAt": "2020-08-21T02:24:11Z", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/registry/ZookeeperNodeManager.java", "diffHunk": "@@ -38,33 +35,37 @@\n import java.util.concurrent.locks.Lock;\n import java.util.concurrent.locks.ReentrantLock;\n \n-import static org.apache.dolphinscheduler.common.Constants.DEFAULT_WORKER_GROUP;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.InitializingBean;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Service;\n \n /**\n- *  zookeeper node manager\n+ * zookeeper node manager", "originalCommit": "8fcadb6902d74a6d149b5077b08fe355a00f0043", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQxMjM4NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474412385", "bodyText": "Is this file changes related with this pr?\nIf not related, please revert.\nI've optimized this part\n\nString host = org.apache.commons.lang.StringUtils.substringAfterLast(path, \"/\");\n\nbecause code style,Become less obvious ,lint 226 ,265", "author": "felix-thinkingdata", "createdAt": "2020-08-21T05:12:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDQxMzE5Mg==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r474413192", "bodyText": "Extract the exact host information in the path of zookeeper", "author": "felix-thinkingdata", "createdAt": "2020-08-21T05:16:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTg4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMyODM1OA==", "url": "https://github.com/apache/dolphinscheduler/pull/3559#discussion_r475328358", "bodyText": "modified", "author": "felix-thinkingdata", "createdAt": "2020-08-24T03:54:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDM3MTg4Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6d61c977e1b864fc45c471d14a8dcf611e5f8a3d", "chunk": "diff --git a/dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/registry/ZookeeperNodeManager.java b/dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/registry/ZookeeperNodeManager.java\nindex 97c81f52a..b1a5edee3 100644\n--- a/dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/registry/ZookeeperNodeManager.java\n+++ b/dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/registry/ZookeeperNodeManager.java\n\n@@ -35,14 +38,10 @@ import java.util.concurrent.ConcurrentHashMap;\n import java.util.concurrent.locks.Lock;\n import java.util.concurrent.locks.ReentrantLock;\n \n-import org.slf4j.Logger;\n-import org.slf4j.LoggerFactory;\n-import org.springframework.beans.factory.InitializingBean;\n-import org.springframework.beans.factory.annotation.Autowired;\n-import org.springframework.stereotype.Service;\n+import static org.apache.dolphinscheduler.common.Constants.DEFAULT_WORKER_GROUP;\n \n /**\n- * zookeeper node manager\n+ *  zookeeper node manager\n  */\n @Service\n public class ZookeeperNodeManager implements InitializingBean {\n"}}, {"oid": "5aeba114f02db7eb0b281f860a9303284beb19c7", "url": "https://github.com/apache/dolphinscheduler/commit/5aeba114f02db7eb0b281f860a9303284beb19c7", "message": "Update dolphinscheduler-alert/src/main/java/org/apache/dolphinscheduler/alert/utils/EnterpriseWeChatUtils.java\n\nCo-authored-by: Yichao Yang <1048262223@qq.com>", "committedDate": "2020-08-21T05:14:58Z", "type": "commit"}, {"oid": "6d61c977e1b864fc45c471d14a8dcf611e5f8a3d", "url": "https://github.com/apache/dolphinscheduler/commit/6d61c977e1b864fc45c471d14a8dcf611e5f8a3d", "message": "fix code smell", "committedDate": "2020-08-24T03:50:52Z", "type": "commit"}, {"oid": "b01ea02329eee226ac70ae0ad3878fc7037ceb7b", "url": "https://github.com/apache/dolphinscheduler/commit/b01ea02329eee226ac70ae0ad3878fc7037ceb7b", "message": "fix code smell", "committedDate": "2020-08-24T05:17:09Z", "type": "commit"}, {"oid": "5cff96b59306252369145fd1378a2c1596b62bc8", "url": "https://github.com/apache/dolphinscheduler/commit/5cff96b59306252369145fd1378a2c1596b62bc8", "message": "\u4fee\u6539ut \u548creplace\u95ee\u9898\u3002", "committedDate": "2020-08-24T06:03:14Z", "type": "commit"}, {"oid": "1fdc01595e7ae78731fdadfca603ea859e39efc4", "url": "https://github.com/apache/dolphinscheduler/commit/1fdc01595e7ae78731fdadfca603ea859e39efc4", "message": "\u4fee\u6539ut", "committedDate": "2020-08-24T06:19:06Z", "type": "commit"}]}