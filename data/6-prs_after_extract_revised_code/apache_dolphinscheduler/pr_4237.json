{"pr_number": 4237, "pr_title": "[FIX-3177]Task time parameter parsing error", "pr_createdAt": "2020-12-16T02:45:19Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/4237", "timeline": [{"oid": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022", "url": "https://github.com/apache/dolphinscheduler/commit/9d6ad4d8837e9b83efb0c199afbf90f19dc37022", "message": "fix date_convert null", "committedDate": "2020-12-16T02:40:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk2NjQ2OA==", "url": "https://github.com/apache/dolphinscheduler/pull/4237#discussion_r543966468", "bodyText": "I think you should make sure that the parameters within the Dateutils.parse method are not null\nif (StringUtils.isBlank(date) || StringUtils.isBlank(format)) {\n            return null;\n        }\n\n public static String convertParameterPlaceholders(String parameterString, Map<String, String> parameterMap) {\n        if (StringUtils.isEmpty(parameterString)) {\n            return parameterString;\n        }\n\n        if (parameterMap == null || parameterMap.isEmpty()) {\n            return dateTemplateParse(parameterString, new Date());\n        }\n\n        //Get current time, schedule execute time\n        String cronTimeStr = parameterMap.get(Constants.PARAMETER_DATETIME);\n        Date cronTime = DateUtils.parse(cronTimeStr, Constants.PARAMETER_FORMAT_TIME);\n        if (cronTime == null) {\n            return parameterString;\n        }\n        // replace variable ${} form,refers to the replacement of system variables and custom variables\n        parameterString = PlaceholderUtils.replacePlaceholders(parameterString, parameterMap, true);\n        return dateTemplateParse(parameterString, cronTime);\n    }", "author": "zhuangchong", "createdAt": "2020-12-16T05:15:01Z", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/ParameterUtils.java", "diffHunk": "@@ -66,11 +66,13 @@ public static String convertParameterPlaceholders(String parameterString, Map<St\n         }\n         Date cronTime;\n         if (parameterMap != null && !parameterMap.isEmpty()) {\n+            // replace variable ${} form,refers to the replacement of system variables and custom variables\n+            parameterString = PlaceholderUtils.replacePlaceholders(parameterString, parameterMap, true);\n+        }\n+        if (parameterMap != null && null != parameterMap.get(Constants.PARAMETER_DATETIME)) {", "originalCommit": "9d6ad4d8837e9b83efb0c199afbf90f19dc37022", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk4NjA0Nw==", "url": "https://github.com/apache/dolphinscheduler/pull/4237#discussion_r543986047", "bodyText": "I think this is not necessary, if it is null, then no replacement is performed.\nIn this case, the time itself is wrong. So it doesn\u2019t make sense to replace or not", "author": "CalvinKirs", "createdAt": "2020-12-16T05:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzk2NjQ2OA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "7df03d91a1351d52a8197cccce0c30797ff827e4", "url": "https://github.com/apache/dolphinscheduler/commit/7df03d91a1351d52a8197cccce0c30797ff827e4", "message": "fix time cover", "committedDate": "2020-12-16T05:30:09Z", "type": "commit"}, {"oid": "54ae6437bb3433ce0faddbc809965a999dd58315", "url": "https://github.com/apache/dolphinscheduler/commit/54ae6437bb3433ce0faddbc809965a999dd58315", "message": "fix time cover", "committedDate": "2020-12-16T05:31:59Z", "type": "commit"}, {"oid": "c11a0c42f338f38d1b6d508eda320662aa55e524", "url": "https://github.com/apache/dolphinscheduler/commit/c11a0c42f338f38d1b6d508eda320662aa55e524", "message": "reformat", "committedDate": "2020-12-16T08:41:52Z", "type": "commit"}, {"oid": "0f42f1588ff5d1e5158c579d8c8e92dcc7ac0d11", "url": "https://github.com/apache/dolphinscheduler/commit/0f42f1588ff5d1e5158c579d8c8e92dcc7ac0d11", "message": "add ut", "committedDate": "2020-12-16T13:43:15Z", "type": "commit"}]}