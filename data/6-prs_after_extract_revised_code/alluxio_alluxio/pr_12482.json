{"pr_number": 12482, "pr_title": "Simplify journal writer response", "pr_createdAt": "2020-11-10T18:24:52Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12482", "timeline": [{"oid": "29fa52ff76e3ed2944d80619bc5c024c3116c249", "url": "https://github.com/Alluxio/alluxio/commit/29fa52ff76e3ed2944d80619bc5c024c3116c249", "message": "Explicitly respond empty message to journal writer", "committedDate": "2020-11-10T01:03:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc5NjY0Mg==", "url": "https://github.com/Alluxio/alluxio/pull/12482#discussion_r520796642", "bodyText": "Can you add more context/details to this comment?\nAlso, is there a way to add a simple unit test for this behavior?", "author": "gpang", "createdAt": "2020-11-10T18:53:27Z", "path": "core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java", "diffHunk": "@@ -242,7 +246,10 @@ public void close() {\n   public CompletableFuture<Message> applyTransaction(TransactionContext trx) {\n     try {\n       applyJournalEntryCommand(trx);\n-      return super.applyTransaction(trx);\n+      RaftProtos.LogEntryProto entry = Objects.requireNonNull(trx.getLogEntry());\n+      updateLastAppliedTermIndex(entry.getTerm(), entry.getIndex());\n+      // no response message is expected", "originalCommit": "29fa52ff76e3ed2944d80619bc5c024c3116c249", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkyMTk1Nw==", "url": "https://github.com/Alluxio/alluxio/pull/12482#discussion_r520921957", "bodyText": "Added a simple test and more comments.", "author": "bf8086", "createdAt": "2020-11-10T22:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc5NjY0Mg=="}], "type": "inlineReview", "revised_code": {"commit": "b640491828ef83ff85a5b6bf192cbe4f0970a72d", "chunk": "diff --git a/core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java b/core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java\nindex 9e5557ba08..61d5b655b2 100644\n--- a/core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java\n+++ b/core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java\n\n@@ -248,7 +248,8 @@ public class JournalStateMachine extends BaseStateMachine {\n       applyJournalEntryCommand(trx);\n       RaftProtos.LogEntryProto entry = Objects.requireNonNull(trx.getLogEntry());\n       updateLastAppliedTermIndex(entry.getTerm(), entry.getIndex());\n-      // no response message is expected\n+      // explicitly return empty future since no response message is expected by the journal writer\n+      // avoid using super.applyTransaction() since it will echo the message and add overhead\n       return EMPTY_FUTURE;\n     } catch (Exception e) {\n       return RaftJournalUtils.completeExceptionally(e);\n"}}, {"oid": "b640491828ef83ff85a5b6bf192cbe4f0970a72d", "url": "https://github.com/Alluxio/alluxio/commit/b640491828ef83ff85a5b6bf192cbe4f0970a72d", "message": "Add test and more comments", "committedDate": "2020-11-10T22:41:12Z", "type": "commit"}]}