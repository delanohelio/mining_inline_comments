{"pr_number": 11728, "pr_title": "Resolve null value for Glue fields", "pr_createdAt": "2020-07-07T23:27:13Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11728", "timeline": [{"oid": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "url": "https://github.com/Alluxio/alluxio/commit/5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "message": "NPE resolving", "committedDate": "2020-07-07T23:24:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjIyMA==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202220", "bodyText": "Instead of creating a new object, we can use Collections.emptyMap()", "author": "gpang", "createdAt": "2020-07-07T23:38:56Z", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();", "originalCommit": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTM0Mg==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229342", "bodyText": "Changed.", "author": "HelloHorizon", "createdAt": "2020-07-08T01:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjIyMA=="}], "type": "inlineReview", "revised_code": {"commit": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "chunk": "diff --git a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\nindex 0ebcaf9fae..ffebaf9e5d 100644\n--- a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n+++ b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n\n@@ -306,9 +306,8 @@ public class GlueDatabase implements UnderDatabase {\n     Table table;\n     List<Partition> partitions;\n     // Glue doesn't support column statistics infomation\n-    Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();\n+    Map<String, List<ColumnStatisticsInfo>> statsMap = Collections.emptyMap();\n     try {\n-      List<Column> partitionColumns;\n       GetTableRequest tableRequest = new GetTableRequest()\n           .withCatalogId(mGlueConfiguration.get(Property.CATALOG_ID))\n           .withDatabaseName(mGlueDbName)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjY5MA==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202690", "bodyText": "Why is this defined so far from when it is used?", "author": "gpang", "createdAt": "2020-07-07T23:40:32Z", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -305,6 +308,7 @@ public UdbTable getTable(String tableName) throws IOException {\n     // Glue doesn't support column statistics infomation\n     Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();\n     try {\n+      List<Column> partitionColumns;", "originalCommit": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTM3Ng==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229376", "bodyText": "Changed.", "author": "HelloHorizon", "createdAt": "2020-07-08T01:22:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjY5MA=="}], "type": "inlineReview", "revised_code": {"commit": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "chunk": "diff --git a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\nindex 0ebcaf9fae..ffebaf9e5d 100644\n--- a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n+++ b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n\n@@ -306,9 +306,8 @@ public class GlueDatabase implements UnderDatabase {\n     Table table;\n     List<Partition> partitions;\n     // Glue doesn't support column statistics infomation\n-    Map<String, List<ColumnStatisticsInfo>> statsMap = new HashMap<>();\n+    Map<String, List<ColumnStatisticsInfo>> statsMap = Collections.emptyMap();\n     try {\n-      List<Column> partitionColumns;\n       GetTableRequest tableRequest = new GetTableRequest()\n           .withCatalogId(mGlueConfiguration.get(Property.CATALOG_ID))\n           .withDatabaseName(mGlueDbName)\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjc3OQ==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202779", "bodyText": "Instead of creating a new object, we can just use Collections.emptyList().", "author": "gpang", "createdAt": "2020-07-07T23:40:54Z", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();", "originalCommit": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQwNg==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229406", "bodyText": "Changed.", "author": "HelloHorizon", "createdAt": "2020-07-08T01:22:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjc3OQ=="}], "type": "inlineReview", "revised_code": {"commit": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "chunk": "diff --git a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\nindex 0ebcaf9fae..ffebaf9e5d 100644\n--- a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n+++ b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n\n@@ -319,9 +318,9 @@ public class GlueDatabase implements UnderDatabase {\n       PathTranslator pathTranslator = mountAlluxioPaths(table, partitions);\n \n       // Glue does not provide column statistic information\n-      List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      List<ColumnStatisticsInfo> columnStatisticsData = Collections.emptyList();\n       Map<String, String> tableParameters = table.getParameters() == null\n-          ? new HashMap<>() : table.getParameters();\n+          ? Collections.emptyMap() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n           // Database name is not required for glue table, use mGlueDbName\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjk3Ng==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451202976", "bodyText": "If tableParameters does not need to be mutable, then we can just use Collections.emptyMap()", "author": "gpang", "createdAt": "2020-07-07T23:41:34Z", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();", "originalCommit": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQzMA==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229430", "bodyText": "Changed.", "author": "HelloHorizon", "createdAt": "2020-07-08T01:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMjk3Ng=="}], "type": "inlineReview", "revised_code": {"commit": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "chunk": "diff --git a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\nindex 0ebcaf9fae..ffebaf9e5d 100644\n--- a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n+++ b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n\n@@ -319,9 +318,9 @@ public class GlueDatabase implements UnderDatabase {\n       PathTranslator pathTranslator = mountAlluxioPaths(table, partitions);\n \n       // Glue does not provide column statistic information\n-      List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      List<ColumnStatisticsInfo> columnStatisticsData = Collections.emptyList();\n       Map<String, String> tableParameters = table.getParameters() == null\n-          ? new HashMap<>() : table.getParameters();\n+          ? Collections.emptyMap() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n           // Database name is not required for glue table, use mGlueDbName\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMzEzNA==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451203134", "bodyText": "Instead of creating a new instance, we can use Collections.emptyList()", "author": "gpang", "createdAt": "2020-07-07T23:42:04Z", "path": "table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java", "diffHunk": "@@ -316,26 +320,33 @@ public UdbTable getTable(String tableName) throws IOException {\n \n       // Glue does not provide column statistic information\n       List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      Map<String, String> tableParameters = table.getParameters() == null\n+          ? new HashMap<>() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n+          // Database name is not required for glue table, use mGlueDbName\n           .setDbName(mGlueDbName)\n           .setTableName(tableName)\n           .addAllDataCols(GlueUtils.toProto(table.getStorageDescriptor().getColumns()))\n           .setStorage(GlueUtils.toProto(table.getStorageDescriptor(), pathTranslator))\n-          .putAllParameters(table.getParameters())\n+          .putAllParameters(tableParameters)\n           .build();\n \n       Layout layout = Layout.newBuilder()\n           .setLayoutType(HiveLayout.TYPE)\n           .setLayoutData(partitionInfo.toByteString())\n           .build();\n \n-      List<Column> partitionColumns = table.getPartitionKeys();\n+      if (table.getPartitionKeys() == null) {\n+        partitionColumns = new ArrayList<>();", "originalCommit": "5ab2bbb006cfe740f096b65010d73a0cc14ecb5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIyOTQ0Nw==", "url": "https://github.com/Alluxio/alluxio/pull/11728#discussion_r451229447", "bodyText": "Changed.", "author": "HelloHorizon", "createdAt": "2020-07-08T01:22:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTIwMzEzNA=="}], "type": "inlineReview", "revised_code": {"commit": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "chunk": "diff --git a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\nindex 0ebcaf9fae..ffebaf9e5d 100644\n--- a/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n+++ b/table/server/underdb/glue/src/main/java/alluxio/table/under/glue/GlueDatabase.java\n\n@@ -319,9 +318,9 @@ public class GlueDatabase implements UnderDatabase {\n       PathTranslator pathTranslator = mountAlluxioPaths(table, partitions);\n \n       // Glue does not provide column statistic information\n-      List<ColumnStatisticsInfo> columnStatisticsData = new ArrayList<>();\n+      List<ColumnStatisticsInfo> columnStatisticsData = Collections.emptyList();\n       Map<String, String> tableParameters = table.getParameters() == null\n-          ? new HashMap<>() : table.getParameters();\n+          ? Collections.emptyMap() : table.getParameters();\n \n       PartitionInfo partitionInfo = PartitionInfo.newBuilder()\n           // Database name is not required for glue table, use mGlueDbName\n"}}, {"oid": "28bbadd3e1d8419edd6e515b96714d1854d4f219", "url": "https://github.com/Alluxio/alluxio/commit/28bbadd3e1d8419edd6e515b96714d1854d4f219", "message": "Fix styles", "committedDate": "2020-07-08T01:21:53Z", "type": "commit"}]}