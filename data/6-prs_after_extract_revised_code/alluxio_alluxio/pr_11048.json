{"pr_number": 11048, "pr_title": "Add getWorkerAddresses and invalidate cache when registering worker", "pr_createdAt": "2020-02-27T21:43:54Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11048", "timeline": [{"oid": "d65e9ba4e4a859eed62f402e7efc3330ec686ec8", "url": "https://github.com/Alluxio/alluxio/commit/d65e9ba4e4a859eed62f402e7efc3330ec686ec8", "message": "Add getWorkerAddresses() RPC", "committedDate": "2020-02-27T21:40:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NDg3OA==", "url": "https://github.com/Alluxio/alluxio/pull/11048#discussion_r385394878", "bodyText": "(nit) Initialize with initial capacity to be the number of workers.", "author": "bf8086", "createdAt": "2020-02-27T21:56:53Z", "path": "core/server/master/src/main/java/alluxio/master/block/DefaultBlockMaster.java", "diffHunk": "@@ -463,6 +463,19 @@ public long getUsedBytes() {\n     return workerInfoList;\n   }\n \n+  @Override\n+  public Set<WorkerNetAddress> getWorkerAddresses() throws UnavailableException {\n+    if (mSafeModeManager.isInSafeMode()) {\n+      throw new UnavailableException(ExceptionMessage.MASTER_IN_SAFEMODE.getMessage());\n+    }\n+    Set<WorkerNetAddress> workerAddresses = new HashSet<>();", "originalCommit": "d65e9ba4e4a859eed62f402e7efc3330ec686ec8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c4c78124633188faa89edb18e261db3bd125e206", "chunk": "diff --git a/core/server/master/src/main/java/alluxio/master/block/DefaultBlockMaster.java b/core/server/master/src/main/java/alluxio/master/block/DefaultBlockMaster.java\nindex da57bd1d93..8ac083d696 100644\n--- a/core/server/master/src/main/java/alluxio/master/block/DefaultBlockMaster.java\n+++ b/core/server/master/src/main/java/alluxio/master/block/DefaultBlockMaster.java\n\n@@ -468,7 +468,7 @@ public final class DefaultBlockMaster extends CoreMaster implements BlockMaster\n     if (mSafeModeManager.isInSafeMode()) {\n       throw new UnavailableException(ExceptionMessage.MASTER_IN_SAFEMODE.getMessage());\n     }\n-    Set<WorkerNetAddress> workerAddresses = new HashSet<>();\n+    Set<WorkerNetAddress> workerAddresses = new HashSet<>(mWorkers.size());\n     for (MasterWorkerInfo worker : mWorkers) {\n       // worker net address is unmodifiable after initialization, no locking is needed\n       workerAddresses.add(worker.getWorkerAddress());\n"}}, {"oid": "c4c78124633188faa89edb18e261db3bd125e206", "url": "https://github.com/Alluxio/alluxio/commit/c4c78124633188faa89edb18e261db3bd125e206", "message": "add size to set during initialization", "committedDate": "2020-02-27T22:05:17Z", "type": "commit"}]}