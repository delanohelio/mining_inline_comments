{"pr_number": 12269, "pr_title": "Fix backup worker crashing master on interruption", "pr_createdAt": "2020-10-13T19:55:42Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12269", "timeline": [{"oid": "2a1e60718ea2b883cd932cc156e2c3256382b321", "url": "https://github.com/Alluxio/alluxio/commit/2a1e60718ea2b883cd932cc156e2c3256382b321", "message": "Fix backup worker crashing master on interruption", "committedDate": "2020-10-13T18:13:03Z", "type": "commit"}, {"oid": "e01bd099287d26945b2e282e96edb3a9793e36c8", "url": "https://github.com/Alluxio/alluxio/commit/e01bd099287d26945b2e282e96edb3a9793e36c8", "message": "Fix unit tests", "committedDate": "2020-10-13T21:37:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwODYyMA==", "url": "https://github.com/Alluxio/alluxio/pull/12269#discussion_r504308620", "bodyText": "@bf8086 Can you provide a timeline for the double resume case?", "author": "LuQQiu", "createdAt": "2020-10-13T23:07:45Z", "path": "core/server/common/src/main/java/alluxio/master/journal/raft/JournalStateMachine.java", "diffHunk": "@@ -537,8 +537,12 @@ public synchronized void suspend(Runnable interruptCallback) throws IOException\n   public synchronized void resume() throws IOException {\n     LOG.info(\"Resuming raft state machine\");\n     mInterruptCallback = null;\n-    mJournalApplier.resume();\n-    LOG.info(\"Raft state machine resumed\");\n+    if (mJournalApplier.isSuspended()) {\n+      mJournalApplier.resume();", "originalCommit": "e01bd099287d26945b2e282e96edb3a9793e36c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMzMDY2MA==", "url": "https://github.com/Alluxio/alluxio/pull/12269#discussion_r504330660", "bodyText": "Basically the backup starts and suspends the journal, then the journal resumes, interrupts the backup and reloads from the snapshot, and then the backup attempts to resume the journal again and hit this issue.", "author": "bf8086", "createdAt": "2020-10-14T00:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwODYyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3Nzk0MQ==", "url": "https://github.com/Alluxio/alluxio/pull/12269#discussion_r504377941", "bodyText": "Got it, thanks!", "author": "LuQQiu", "createdAt": "2020-10-14T03:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwODYyMA=="}], "type": "inlineReview", "revised_code": null}]}