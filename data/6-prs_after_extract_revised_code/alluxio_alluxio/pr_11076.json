{"pr_number": 11076, "pr_title": "Log a cancelled message when sync is cancelled due to exception", "pr_createdAt": "2020-03-01T07:01:51Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11076", "timeline": [{"oid": "c403b65b97f11ca746723db9ac22804af94a1772", "url": "https://github.com/Alluxio/alluxio/commit/c403b65b97f11ca746723db9ac22804af94a1772", "message": "log better error message when sync is cancelled", "committedDate": "2020-03-01T07:21:16Z", "type": "forcePushed"}, {"oid": "236e99e5123e486c9e33c08db45c21ff2ea8fa28", "url": "https://github.com/Alluxio/alluxio/commit/236e99e5123e486c9e33c08db45c21ff2ea8fa28", "message": "log better error message when sync is cancelled", "committedDate": "2020-03-01T07:42:22Z", "type": "commit"}, {"oid": "236e99e5123e486c9e33c08db45c21ff2ea8fa28", "url": "https://github.com/Alluxio/alluxio/commit/236e99e5123e486c9e33c08db45c21ff2ea8fa28", "message": "log better error message when sync is cancelled", "committedDate": "2020-03-01T07:42:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4NjMzMg==", "url": "https://github.com/Alluxio/alluxio/pull/11076#discussion_r386586332", "bodyText": "can we keep both if conditions? if we cancel before syncing the first path, we would sync the first path with this change.", "author": "madanadit", "createdAt": "2020-03-02T18:59:44Z", "path": "core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java", "diffHunk": "@@ -3396,10 +3396,6 @@ private boolean syncMetadataInternal(RpcContext rpcContext, LockedInodePath inod\n \n     // Update metadata for all the mount points\n     for (String mountPoint : pathsToLoad) {\n-      if (Thread.currentThread().isInterrupted()) {", "originalCommit": "236e99e5123e486c9e33c08db45c21ff2ea8fa28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU5MDI4MQ==", "url": "https://github.com/Alluxio/alluxio/pull/11076#discussion_r386590281", "bodyText": "done", "author": "yuzhu", "createdAt": "2020-03-02T19:07:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjU4NjMzMg=="}], "type": "inlineReview", "revised_code": {"commit": "d2f1db6a718db6d12bb951a0af35b0b837183d59", "chunk": "diff --git a/core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java b/core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java\nindex 5b687bb4dd..a25c50a127 100644\n--- a/core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java\n+++ b/core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java\n\n@@ -3396,6 +3396,10 @@ public final class DefaultFileSystemMaster extends CoreMaster\n \n     // Update metadata for all the mount points\n     for (String mountPoint : pathsToLoad) {\n+      if (Thread.currentThread().isInterrupted()) {\n+        LOG.warn(\"Thread syncing {} was interrupted before completion\", inodePath.getUri());\n+        return false;\n+      }\n       AlluxioURI mountPointUri = new AlluxioURI(mountPoint);\n       try {\n         if (PathUtils.hasPrefix(inodePath.getUri().getPath(), mountPointUri.getPath())) {\n"}}, {"oid": "d2f1db6a718db6d12bb951a0af35b0b837183d59", "url": "https://github.com/Alluxio/alluxio/commit/d2f1db6a718db6d12bb951a0af35b0b837183d59", "message": "address comments", "committedDate": "2020-03-02T19:06:31Z", "type": "commit"}]}