{"pr_number": 11635, "pr_title": "Improve hdfs version test to parse CDH version", "pr_createdAt": "2020-06-24T15:23:38Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11635", "timeline": [{"oid": "55a69a0f1ed0f1d996fe9059685365dbcd39f94c", "url": "https://github.com/Alluxio/alluxio/commit/55a69a0f1ed0f1d996fe9059685365dbcd39f94c", "message": "improve hdfs version test", "committedDate": "2020-06-24T15:15:09Z", "type": "commit"}, {"oid": "5bc1dd4c9eddf607232be165909e588b672092b8", "url": "https://github.com/Alluxio/alluxio/commit/5bc1dd4c9eddf607232be165909e588b672092b8", "message": "move pattern to static", "committedDate": "2020-06-24T15:22:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxMTQ5Ng==", "url": "https://github.com/Alluxio/alluxio/pull/11635#discussion_r445011496", "bodyText": "nit: why not final?", "author": "madanadit", "createdAt": "2020-06-24T16:13:40Z", "path": "integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java", "diffHunk": "@@ -31,6 +31,20 @@\n public class HdfsVersionValidationTask extends AbstractValidationTask {\n   private final AlluxioConfiguration mConf;\n \n+  // An example output from \"hadoop version\" command:\n+  //    Hadoop 2.7.2\n+  //    Subversion https://git-wip-us.apache.org/repos/asf/hadoop.git\n+  //      -r b165c4fe8a74265c792ce23f546c64604acf0e41\n+  //    Compiled by jenkins on 2016-01-26T00:08Z\n+  //    Compiled with protoc 2.5.0\n+  //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n+  //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n+  private static Pattern sHadoopPattern =", "originalCommit": "5bc1dd4c9eddf607232be165909e588b672092b8", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "81f16d5aebc4047aef4acaf5f03f628fe8e83573", "chunk": "diff --git a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\nindex a2c223b382..98374d4d0d 100644\n--- a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n+++ b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n\n@@ -39,11 +39,12 @@ public class HdfsVersionValidationTask extends AbstractValidationTask {\n   //    Compiled with protoc 2.5.0\n   //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n   //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n-  private static Pattern sHadoopPattern =\n+  private final static Pattern sHadoopPattern =\n           Pattern.compile(\"Hadoop\\\\s+(?<version>([0-9]\\\\.)+[0-9]+)\");\n   // An example Hadoop version for CDH distribution is\n   // Hadoop 2.6.0-cdh5.16.2\n-  private static Pattern sCdhPattern = Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");\n+  private final static Pattern sCdhPattern =\n+          Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");\n \n   /**\n    * Creates a new instance of {@link HdfsVersionValidationTask}\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxOTg4OQ==", "url": "https://github.com/Alluxio/alluxio/pull/11635#discussion_r445019889", "bodyText": "@madanadit Do we want to consider HDP?", "author": "jiacheliu3", "createdAt": "2020-06-24T16:27:08Z", "path": "integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java", "diffHunk": "@@ -31,6 +31,20 @@\n public class HdfsVersionValidationTask extends AbstractValidationTask {\n   private final AlluxioConfiguration mConf;\n \n+  // An example output from \"hadoop version\" command:\n+  //    Hadoop 2.7.2\n+  //    Subversion https://git-wip-us.apache.org/repos/asf/hadoop.git\n+  //      -r b165c4fe8a74265c792ce23f546c64604acf0e41\n+  //    Compiled by jenkins on 2016-01-26T00:08Z\n+  //    Compiled with protoc 2.5.0\n+  //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n+  //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n+  private static Pattern sHadoopPattern =\n+          Pattern.compile(\"Hadoop\\\\s+(?<version>([0-9]\\\\.)+[0-9]+)\");\n+  // An example Hadoop version for CDH distribution is\n+  // Hadoop 2.6.0-cdh5.16.2\n+  private static Pattern sCdhPattern = Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");", "originalCommit": "5bc1dd4c9eddf607232be165909e588b672092b8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyMTk4Nw==", "url": "https://github.com/Alluxio/alluxio/pull/11635#discussion_r445021987", "bodyText": "nope", "author": "madanadit", "createdAt": "2020-06-24T16:30:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxOTg4OQ=="}], "type": "inlineReview", "revised_code": {"commit": "81f16d5aebc4047aef4acaf5f03f628fe8e83573", "chunk": "diff --git a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\nindex a2c223b382..98374d4d0d 100644\n--- a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n+++ b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n\n@@ -39,11 +39,12 @@ public class HdfsVersionValidationTask extends AbstractValidationTask {\n   //    Compiled with protoc 2.5.0\n   //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n   //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n-  private static Pattern sHadoopPattern =\n+  private final static Pattern sHadoopPattern =\n           Pattern.compile(\"Hadoop\\\\s+(?<version>([0-9]\\\\.)+[0-9]+)\");\n   // An example Hadoop version for CDH distribution is\n   // Hadoop 2.6.0-cdh5.16.2\n-  private static Pattern sCdhPattern = Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");\n+  private final static Pattern sCdhPattern =\n+          Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");\n \n   /**\n    * Creates a new instance of {@link HdfsVersionValidationTask}\n"}}, {"oid": "81f16d5aebc4047aef4acaf5f03f628fe8e83573", "url": "https://github.com/Alluxio/alluxio/commit/81f16d5aebc4047aef4acaf5f03f628fe8e83573", "message": "resolve comments", "committedDate": "2020-06-24T16:27:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyMTg3NA==", "url": "https://github.com/Alluxio/alluxio/pull/11635#discussion_r445021874", "bodyText": "@jiacheliu3 same for sCdhPattern and change capitalization to HADOOP_PATTERN", "author": "madanadit", "createdAt": "2020-06-24T16:30:20Z", "path": "integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java", "diffHunk": "@@ -39,11 +39,12 @@\n   //    Compiled with protoc 2.5.0\n   //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n   //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n-  private static Pattern sHadoopPattern =\n+  private final static Pattern sHadoopPattern =", "originalCommit": "81f16d5aebc4047aef4acaf5f03f628fe8e83573", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "c0b24d3145969515014bf53609dd7c15f09dfc99", "chunk": "diff --git a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\nindex 98374d4d0d..7f80a3c814 100644\n--- a/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n+++ b/integration/tools/validation/src/main/java/alluxio/cli/hdfs/HdfsVersionValidationTask.java\n\n@@ -39,11 +39,11 @@ public class HdfsVersionValidationTask extends AbstractValidationTask {\n   //    Compiled with protoc 2.5.0\n   //    From source with checksum d0fda26633fa762bff87ec759ebe689c\n   //    This command was run using /tmp/hadoop/share/hadoop/common/hadoop-common-2.7.2.jar\n-  private final static Pattern sHadoopPattern =\n+  private static final Pattern HADOOP_PATTERN =\n           Pattern.compile(\"Hadoop\\\\s+(?<version>([0-9]\\\\.)+[0-9]+)\");\n   // An example Hadoop version for CDH distribution is\n   // Hadoop 2.6.0-cdh5.16.2\n-  private final static Pattern sCdhPattern =\n+  private static final Pattern CDH_PATTERN =\n           Pattern.compile(\"cdh(?<cdhVersion>([0-9]+\\\\.)+[0-9]+)\");\n \n   /**\n"}}, {"oid": "c0b24d3145969515014bf53609dd7c15f09dfc99", "url": "https://github.com/Alluxio/alluxio/commit/c0b24d3145969515014bf53609dd7c15f09dfc99", "message": "resolve comment", "committedDate": "2020-06-24T17:04:14Z", "type": "commit"}]}