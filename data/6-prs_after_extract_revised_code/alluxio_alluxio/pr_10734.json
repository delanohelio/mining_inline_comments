{"pr_number": 10734, "pr_title": "Implement basic version of getDatabase in catalog service", "pr_createdAt": "2020-01-13T21:41:10Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10734", "timeline": [{"oid": "1466a67c32f36576f69270005873f7fcbf150c5c", "url": "https://github.com/Alluxio/alluxio/commit/1466a67c32f36576f69270005873f7fcbf150c5c", "message": "implement basic getDatabase\n\nNote here getDatabase returns an object that only contains the database name.\nA subsequent PR will add more content into this database object.", "committedDate": "2020-01-13T21:30:29Z", "type": "commit"}, {"oid": "43d0eff95d3e224d75f8dd9f1b0f9da4d2a86700", "url": "https://github.com/Alluxio/alluxio/commit/43d0eff95d3e224d75f8dd9f1b0f9da4d2a86700", "message": "fix checkstyle", "committedDate": "2020-01-13T21:39:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA0NDg2NQ==", "url": "https://github.com/Alluxio/alluxio/pull/10734#discussion_r366044865", "bodyText": "nit: typo", "author": "ZacBlanco", "createdAt": "2020-01-13T21:44:49Z", "path": "table/server/master/src/main/java/alluxio/master/table/AlluxioCatalog.java", "diffHunk": "@@ -196,6 +196,19 @@ private Table getTableInternal(String dbName, String tableName) throws IOExcepti\n     return new ArrayList<>(mDBs.keySet());\n   }\n \n+  /**\n+   * Get Database by its name.\n+   *\n+   * @param dbName database name\n+   * @return a databae object", "originalCommit": "43d0eff95d3e224d75f8dd9f1b0f9da4d2a86700", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "f9ac749499f4877da18feff8f827bb2fc54012f7", "chunk": "diff --git a/table/server/master/src/main/java/alluxio/master/table/AlluxioCatalog.java b/table/server/master/src/main/java/alluxio/master/table/AlluxioCatalog.java\nindex b1e11ade0c..084419a23b 100644\n--- a/table/server/master/src/main/java/alluxio/master/table/AlluxioCatalog.java\n+++ b/table/server/master/src/main/java/alluxio/master/table/AlluxioCatalog.java\n\n@@ -200,7 +200,7 @@ public class AlluxioCatalog implements Journaled {\n    * Get Database by its name.\n    *\n    * @param dbName database name\n-   * @return a databae object\n+   * @return a database object\n    */\n   public alluxio.grpc.table.Database getDatabase(String dbName)  throws IOException {\n     try (LockResource l = getLock(dbName, true)) {\n"}}, {"oid": "f9ac749499f4877da18feff8f827bb2fc54012f7", "url": "https://github.com/Alluxio/alluxio/commit/f9ac749499f4877da18feff8f827bb2fc54012f7", "message": "fix typo", "committedDate": "2020-01-13T21:47:20Z", "type": "commit"}, {"oid": "69276b7432ebc6b9501d7ca34aa5e12d790de182", "url": "https://github.com/Alluxio/alluxio/commit/69276b7432ebc6b9501d7ca34aa5e12d790de182", "message": "add test coverage for getDatabase", "committedDate": "2020-01-13T23:28:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA4NDE3OA==", "url": "https://github.com/Alluxio/alluxio/pull/10734#discussion_r366084178", "bodyText": "won't this stop the rest of the test from being run?", "author": "ZacBlanco", "createdAt": "2020-01-13T23:30:44Z", "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -92,8 +96,12 @@ public void journalAttachDb() throws Exception {\n     TableMaster tableMaster =\n         mCluster.getLocalAlluxioMaster().getMasterProcess().getMaster(TableMaster.class);\n \n+    mException.expect(IOException.class);\n+    tableMaster.getDatabase(DB_NAME);", "originalCommit": "69276b7432ebc6b9501d7ca34aa5e12d790de182", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA4OTQ5MQ==", "url": "https://github.com/Alluxio/alluxio/pull/10734#discussion_r366089491", "bodyText": "doh.. why aren't we on Junit 5 yet?  I totally misunderstood the semantics of expect", "author": "yuzhu", "createdAt": "2020-01-13T23:49:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA4NDE3OA=="}], "type": "inlineReview", "revised_code": {"commit": "20eab99938b49b05d2b4d7b18df62740e3cdf38d", "chunk": "diff --git a/tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java b/tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java\nindex 18430a1771..f37e5e3116 100644\n--- a/tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java\n+++ b/tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java\n\n@@ -95,10 +92,12 @@ public class TableMasterJournalIntegrationTest {\n     LocalAlluxioCluster mCluster = mClusterResource.get();\n     TableMaster tableMaster =\n         mCluster.getLocalAlluxioMaster().getMasterProcess().getMaster(TableMaster.class);\n-\n-    mException.expect(IOException.class);\n-    tableMaster.getDatabase(DB_NAME);\n-\n+    try {\n+      tableMaster.getDatabase(DB_NAME);\n+      fail();\n+    } catch (IOException e) {\n+      assertEquals(\"Database \" + DB_NAME + \" does not exist\", e.getMessage());\n+    }\n     tableMaster\n         .attachDatabase(TestUdbFactory.TYPE, \"connect\", DB_NAME, DB_NAME, Collections.emptyMap());\n     assertEquals(DB_NAME, tableMaster.getDatabase(DB_NAME).getDbName());\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA4NDM2Ng==", "url": "https://github.com/Alluxio/alluxio/pull/10734#discussion_r366084366", "bodyText": "similarly, won't all lines after this not be executed?", "author": "ZacBlanco", "createdAt": "2020-01-13T23:31:23Z", "path": "table/server/master/src/test/java/alluxio/master/table/AlluxioCatalogTest.java", "diffHunk": "@@ -100,6 +100,18 @@ public void detachDb() throws Exception {\n     assertEquals(0, mCatalog.getAllDatabases().size());\n   }\n \n+  @Test\n+  public void getDb() throws Exception {\n+    String dbName = \"testdb\";\n+    TestDatabase.genTable(1, 2);\n+    mException.expect(NotFoundException.class);\n+    mCatalog.getDatabase(dbName);", "originalCommit": "69276b7432ebc6b9501d7ca34aa5e12d790de182", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "20eab99938b49b05d2b4d7b18df62740e3cdf38d", "chunk": "diff --git a/table/server/master/src/test/java/alluxio/master/table/AlluxioCatalogTest.java b/table/server/master/src/test/java/alluxio/master/table/AlluxioCatalogTest.java\nindex 73849fdcb8..5e330673a7 100644\n--- a/table/server/master/src/test/java/alluxio/master/table/AlluxioCatalogTest.java\n+++ b/table/server/master/src/test/java/alluxio/master/table/AlluxioCatalogTest.java\n\n@@ -104,8 +105,14 @@ public class AlluxioCatalogTest {\n   public void getDb() throws Exception {\n     String dbName = \"testdb\";\n     TestDatabase.genTable(1, 2);\n-    mException.expect(NotFoundException.class);\n-    mCatalog.getDatabase(dbName);\n+\n+    try {\n+      mCatalog.getDatabase(dbName);\n+      fail();\n+    } catch (IOException e) {\n+      assertEquals(\"Database \" + dbName + \" does not exist\", e.getMessage());\n+    }\n+\n     mCatalog.attachDatabase(NoopJournalContext.INSTANCE,\n         TestUdbFactory.TYPE, \"connect_URI\", TestDatabase.TEST_UDB_NAME, dbName,\n         Collections.emptyMap());\n"}}, {"oid": "20eab99938b49b05d2b4d7b18df62740e3cdf38d", "url": "https://github.com/Alluxio/alluxio/commit/20eab99938b49b05d2b4d7b18df62740e3cdf38d", "message": "fix tests", "committedDate": "2020-01-13T23:56:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5NzU3NQ==", "url": "https://github.com/Alluxio/alluxio/pull/10734#discussion_r366097575", "bodyText": "i don't care that much but for the most part methods are in alphabetical order in this class. Should we try to keep it that way? the transform methods are obviously not in the right order, but the rest seem to be", "author": "ZacBlanco", "createdAt": "2020-01-14T00:19:56Z", "path": "table/server/master/src/main/java/alluxio/master/table/TableMaster.java", "diffHunk": "@@ -138,4 +139,12 @@ boolean detachDatabase(String dbName)\n    * @return true if the database was changed as a result\n    */\n   boolean syncDatabase(String dbName) throws IOException;\n+\n+  /**\n+   * Gets a database object.\n+   *\n+   * @param dbName the database name\n+   * @return a database object\n+   */\n+  Database getDatabase(String dbName) throws IOException;", "originalCommit": "20eab99938b49b05d2b4d7b18df62740e3cdf38d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "359b16745c1f18b4e50607dd2d48a8d2d294ac41", "chunk": "diff --git a/table/server/master/src/main/java/alluxio/master/table/TableMaster.java b/table/server/master/src/main/java/alluxio/master/table/TableMaster.java\nindex a0f6f19122..1f544d1876 100644\n--- a/table/server/master/src/main/java/alluxio/master/table/TableMaster.java\n+++ b/table/server/master/src/main/java/alluxio/master/table/TableMaster.java\n\n@@ -139,12 +147,4 @@ public interface TableMaster extends Master {\n    * @return true if the database was changed as a result\n    */\n   boolean syncDatabase(String dbName) throws IOException;\n-\n-  /**\n-   * Gets a database object.\n-   *\n-   * @param dbName the database name\n-   * @return a database object\n-   */\n-  Database getDatabase(String dbName) throws IOException;\n }\n"}}, {"oid": "359b16745c1f18b4e50607dd2d48a8d2d294ac41", "url": "https://github.com/Alluxio/alluxio/commit/359b16745c1f18b4e50607dd2d48a8d2d294ac41", "message": "use alphabetical order", "committedDate": "2020-01-14T00:22:38Z", "type": "commit"}]}