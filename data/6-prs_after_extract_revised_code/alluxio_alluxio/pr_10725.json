{"pr_number": 10725, "pr_title": "Fix tests on ubuntu", "pr_createdAt": "2020-01-10T17:04:41Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10725", "timeline": [{"oid": "245acd6482373ecc6d535a4e1ad5f367d765f846", "url": "https://github.com/Alluxio/alluxio/commit/245acd6482373ecc6d535a4e1ad5f367d765f846", "message": "Fix tests on ubuntu\n\nI ran these tests on an Ubuntu 18.04 server with a fresh install of the\nlatest  java and maven versions. The AlluxioFileInStreamTest failed due\nto an issue with PowerMock. The MetricsHeartbeatContextTest took\n120s to complete due to needing to wait for the connect RPC to time\nout.", "committedDate": "2020-01-10T17:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg4MTc5Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10725#discussion_r365881797", "bodyText": "Do we know why these tests \"work\" without these changes?", "author": "gpang", "createdAt": "2020-01-13T15:57:42Z", "path": "core/client/fs/src/test/java/alluxio/client/metrics/MetricsHeartbeatContextTest.java", "diffHunk": "@@ -42,7 +42,9 @@\n   @Test\n   public void testExecutorInitialized() {\n \n-    ClientContext ctx = ClientContext.create();\n+    InstancedConfiguration conf = ConfigurationTestUtils.defaults();\n+    conf.set(PropertyKey.USER_RPC_RETRY_MAX_DURATION, \"1s\");", "originalCommit": "245acd6482373ecc6d535a4e1ad5f367d765f846", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTk0ODkyNw==", "url": "https://github.com/Alluxio/alluxio/pull/10725#discussion_r365948927", "bodyText": "The machine is 32C/64T, so my first guess is that there is some kind of race which is more easily reproducible on a high-core count machine.\nI think the Powermock thing is a bug with powermock and might have something to do with the JVM? There is a very similar issue report here: powermock/powermock#370 where the error output is similar to what I saw", "author": "ZacBlanco", "createdAt": "2020-01-13T18:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTg4MTc5Nw=="}], "type": "inlineReview", "revised_code": null}]}