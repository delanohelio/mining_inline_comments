{"pr_number": 12261, "pr_title": "[SMALLFIX] Update S3 deprecated API usage", "pr_createdAt": "2020-10-13T13:08:55Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12261", "timeline": [{"oid": "c334ce28c3116565c8add6c0487722386e9c33f0", "url": "https://github.com/Alluxio/alluxio/commit/c334ce28c3116565c8add6c0487722386e9c33f0", "message": "update one deprecated call", "committedDate": "2020-10-13T12:58:39Z", "type": "commit"}, {"oid": "39a5479055adb2f3f4ab397072c1b5f91f84e40a", "url": "https://github.com/Alluxio/alluxio/commit/39a5479055adb2f3f4ab397072c1b5f91f84e40a", "message": "checkstyle", "committedDate": "2020-10-13T13:08:20Z", "type": "commit"}, {"oid": "d7971f5123bcd75a06796737574416c917f31254", "url": "https://github.com/Alluxio/alluxio/commit/d7971f5123bcd75a06796737574416c917f31254", "message": "checkstyle", "committedDate": "2020-10-13T14:32:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3NjMzNQ==", "url": "https://github.com/Alluxio/alluxio/pull/12261#discussion_r504376335", "bodyText": "Based on https://stackoverflow.com/questions/18136437/whats-the-use-of-new-string0-in-toarraynew-string0\nlooks like it will be better to create the array with new String[size] than new String[0]", "author": "LuQQiu", "createdAt": "2020-10-14T03:19:25Z", "path": "underfs/s3a/src/main/java/alluxio/underfs/s3a/S3AUnderFileSystem.java", "diffHunk": "@@ -452,7 +453,7 @@ private ObjectListing getObjectListingChunkV1(ListObjectsRequest request) throws\n     @Override\n     public String[] getCommonPrefixes() {\n       List<String> res = mResult.getCommonPrefixes();\n-      return res.toArray(new String[res.size()]);\n+      return res.toArray(new String[0]);", "originalCommit": "d7971f5123bcd75a06796737574416c917f31254", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQyMjMzNg==", "url": "https://github.com/Alluxio/alluxio/pull/12261#discussion_r504422336", "bodyText": "Actually in the comments of this answer, there's a link https://stackoverflow.com/questions/174093/toarraynew-myclass0-or-toarraynew-myclassmylist-size/29444594#29444594 that says giving new String[0] is consistently faster. Plus Intellij throws a warning if you give it a pre-sized array.", "author": "jiacheliu3", "createdAt": "2020-10-14T06:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3NjMzNQ=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3NjQ3OQ==", "url": "https://github.com/Alluxio/alluxio/pull/12261#discussion_r504376479", "bodyText": "Why it needs casting, can we use the concrete type in the whole S3AUnderFileSystem?", "author": "LuQQiu", "createdAt": "2020-10-14T03:19:57Z", "path": "underfs/s3a/src/main/java/alluxio/underfs/s3a/S3AUnderFileSystem.java", "diffHunk": "@@ -198,7 +198,8 @@ public static S3AUnderFileSystem createInstance(AlluxioURI uri,\n       clientConf.setSignerOverride(conf.get(PropertyKey.UNDERFS_S3_SIGNER_ALGORITHM));\n     }\n \n-    AmazonS3Client amazonS3Client = new AmazonS3Client(credentials, clientConf);\n+    AmazonS3Client amazonS3Client = (AmazonS3Client) AmazonS3Client.builder()", "originalCommit": "d7971f5123bcd75a06796737574416c917f31254", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQyMzE4OA==", "url": "https://github.com/Alluxio/alluxio/pull/12261#discussion_r504423188", "bodyText": "AmazonS3ClientBuilder.build() returns type AmazonS3 instead of AmazonS3Client. Casting seems to be the only way. I think it's an issue with how aws sdk is implemented.", "author": "jiacheliu3", "createdAt": "2020-10-14T06:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM3NjQ3OQ=="}], "type": "inlineReview", "revised_code": null}]}