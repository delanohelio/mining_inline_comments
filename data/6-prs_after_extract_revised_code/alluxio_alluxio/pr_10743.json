{"pr_number": 10743, "pr_title": "Fix PageStore FindBugs issues", "pr_createdAt": "2020-01-14T06:15:53Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10743", "timeline": [{"oid": "7182ed9196267ea3d65e7dfa262009d799e3a6d5", "url": "https://github.com/Alluxio/alluxio/commit/7182ed9196267ea3d65e7dfa262009d799e3a6d5", "message": "fix findbugs", "committedDate": "2020-01-14T06:13:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5NDcwNA==", "url": "https://github.com/Alluxio/alluxio/pull/10743#discussion_r366194704", "bodyText": "nit: for src code readability & more explicit error message\nPreconditions.checkNotNull(p.getParent(), \"Path for page %s can not be root\", pageId);\nFiles.createDirectories(p.getParent());", "author": "apc999", "createdAt": "2020-01-14T08:02:15Z", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java", "diffHunk": "@@ -55,7 +57,7 @@ public LocalPageStore(LocalPageStoreOptions options) {\n   public void put(PageId pageId, byte[] page) throws IOException {\n     Path p = getFilePath(pageId);\n     if (!Files.exists(p)) {\n-      Files.createDirectories(p.getParent());\n+      Files.createDirectories(Preconditions.checkNotNull(p.getParent(), \"parent\"));", "originalCommit": "7182ed9196267ea3d65e7dfa262009d799e3a6d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUyNDUxMw==", "url": "https://github.com/Alluxio/alluxio/pull/10743#discussion_r366524513", "bodyText": "Done.", "author": "bf8086", "createdAt": "2020-01-14T19:18:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5NDcwNA=="}], "type": "inlineReview", "revised_code": {"commit": "f5320c5fa3c378f74abf6fc273ef1e1964a56c98", "chunk": "diff --git a/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java b/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\nindex a78973201f..84e110bccc 100644\n--- a/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\n+++ b/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\n\n@@ -57,7 +57,9 @@ public class LocalPageStore implements PageStore, AutoCloseable {\n   public void put(PageId pageId, byte[] page) throws IOException {\n     Path p = getFilePath(pageId);\n     if (!Files.exists(p)) {\n-      Files.createDirectories(Preconditions.checkNotNull(p.getParent(), \"parent\"));\n+      Path parent = Preconditions.checkNotNull(p.getParent(),\n+          \"parent of cache file should not be null\");\n+      Files.createDirectories(parent);\n       Files.createFile(p);\n     }\n     try (FileOutputStream fos = new FileOutputStream(p.toFile(), false)) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5NDgzMA==", "url": "https://github.com/Alluxio/alluxio/pull/10743#discussion_r366194830", "bodyText": "please make the error message more explicit.", "author": "apc999", "createdAt": "2020-01-14T08:02:45Z", "path": "core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java", "diffHunk": "@@ -82,8 +84,11 @@ public void delete(PageId pageId) throws IOException, PageNotFoundException {\n     }\n     Files.delete(p);\n     mSize.decrementAndGet();\n-    if (!Files.newDirectoryStream(p.getParent()).iterator().hasNext()) {\n-      Files.delete(p.getParent());\n+    Path parent = Preconditions.checkNotNull(p.getParent(), \"parent\");", "originalCommit": "7182ed9196267ea3d65e7dfa262009d799e3a6d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUyNDU2MA==", "url": "https://github.com/Alluxio/alluxio/pull/10743#discussion_r366524560", "bodyText": "Done.", "author": "bf8086", "createdAt": "2020-01-14T19:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjE5NDgzMA=="}], "type": "inlineReview", "revised_code": {"commit": "f5320c5fa3c378f74abf6fc273ef1e1964a56c98", "chunk": "diff --git a/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java b/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\nindex a78973201f..84e110bccc 100644\n--- a/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\n+++ b/core/client/fs/src/main/java/alluxio/client/file/cache/store/LocalPageStore.java\n\n@@ -84,7 +86,8 @@ public class LocalPageStore implements PageStore, AutoCloseable {\n     }\n     Files.delete(p);\n     mSize.decrementAndGet();\n-    Path parent = Preconditions.checkNotNull(p.getParent(), \"parent\");\n+    Path parent = Preconditions.checkNotNull(p.getParent(),\n+        \"parent of cache file should not be null\");\n     try (DirectoryStream<Path> stream = Files.newDirectoryStream(parent)) {\n       if (!stream.iterator().hasNext()) {\n         Files.delete(parent);\n"}}, {"oid": "f5320c5fa3c378f74abf6fc273ef1e1964a56c98", "url": "https://github.com/Alluxio/alluxio/commit/f5320c5fa3c378f74abf6fc273ef1e1964a56c98", "message": "address comments", "committedDate": "2020-01-14T19:17:31Z", "type": "commit"}, {"oid": "4226258b3438ab7fa1aff7d2d3b63d884aaa4e92", "url": "https://github.com/Alluxio/alluxio/commit/4226258b3438ab7fa1aff7d2d3b63d884aaa4e92", "message": "Merge remote-tracking branch 'upstream/lite' into lite-findbugs", "committedDate": "2020-01-14T19:32:18Z", "type": "commit"}, {"oid": "a2ef152bb399c55a85aee6ab1ba4a66c934e72f9", "url": "https://github.com/Alluxio/alluxio/commit/a2ef152bb399c55a85aee6ab1ba4a66c934e72f9", "message": "fix checkstyles", "committedDate": "2020-01-14T19:32:38Z", "type": "commit"}]}