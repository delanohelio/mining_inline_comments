{"pr_number": 317, "pr_title": "Vlad roundabout bad tagging", "pr_createdAt": "2020-06-17T00:44:08Z", "pr_url": "https://github.com/osmlab/atlas-checks/pull/317", "timeline": [{"oid": "df8a42445ea533a1ccb3da53fa4acc956a889c1e", "url": "https://github.com/osmlab/atlas-checks/commit/df8a42445ea533a1ccb3da53fa4acc956a889c1e", "message": "Fix flagging roundabout with Synthetic Node\nhttps://github.com/osmlab/atlas-checks/issues/316", "committedDate": "2020-06-17T00:32:17Z", "type": "commit"}, {"oid": "e0cfc6de6c54538cb2d826ec0a3cb6be44162076", "url": "https://github.com/osmlab/atlas-checks/commit/e0cfc6de6c54538cb2d826ec0a3cb6be44162076", "message": "Unit Test for Synthetic Node flagging\nhttps://github.com/osmlab/atlas-checks/issues/316", "committedDate": "2020-06-17T00:33:09Z", "type": "commit"}, {"oid": "0cc038c3b0606e2a2f2826c8059ddca97a64aa00", "url": "https://github.com/osmlab/atlas-checks/commit/0cc038c3b0606e2a2f2826c8059ddca97a64aa00", "message": "fixing style issues", "committedDate": "2020-06-17T13:15:34Z", "type": "commit"}, {"oid": "9564d5e45aecb04cbd4d33c135b79eb06d75ad62", "url": "https://github.com/osmlab/atlas-checks/commit/9564d5e45aecb04cbd4d33c135b79eb06d75ad62", "message": "fixing style issues", "committedDate": "2020-06-17T16:31:55Z", "type": "commit"}, {"oid": "12ef88abf5782b3f1ad9fb3e837531b9a40007a4", "url": "https://github.com/osmlab/atlas-checks/commit/12ef88abf5782b3f1ad9fb3e837531b9a40007a4", "message": "fixing style issues", "committedDate": "2020-06-17T16:38:44Z", "type": "commit"}, {"oid": "a1b3145f99e08aee85f43540b721f5a530c55bbb", "url": "https://github.com/osmlab/atlas-checks/commit/a1b3145f99e08aee85f43540b721f5a530c55bbb", "message": "fixing style issues", "committedDate": "2020-06-17T16:50:46Z", "type": "commit"}, {"oid": "7000d0e5af02b20f13c0bb477de967961902bb1a", "url": "https://github.com/osmlab/atlas-checks/commit/7000d0e5af02b20f13c0bb477de967961902bb1a", "message": "fixing style issues", "committedDate": "2020-06-17T16:55:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3MjM4OQ==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r442372389", "bodyText": "Ah! I missed to add the comment! Please add this keyword here: this.isEdgeWithSyntheticBoundaryNode", "author": "sayas01", "createdAt": "2020-06-18T16:59:43Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java", "diffHunk": "@@ -87,6 +91,14 @@ public boolean validCheckForObject(final AtlasObject object)\n     protected Optional<CheckFlag> flag(final AtlasObject object)\n     {\n         final Set<String> instructions = new HashSet<>();\n+\n+        // Skip if roundabout contains synthetic node. bug fix:\n+        // https://github.com/osmlab/atlas-checks/issues/316\n+        if (isEdgeWithSyntheticBoundaryNode(object))", "originalCommit": "7000d0e5af02b20f13c0bb477de967961902bb1a", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "0630fe5f086dad16cf6948aa18ee66ca67c7a77e", "chunk": "diff --git a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\nindex 62a4f5f..c5dfd88 100644\n--- a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n+++ b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n\n@@ -94,7 +94,7 @@ public class MalformedRoundaboutCheck extends BaseCheck<Long>\n \n         // Skip if roundabout contains synthetic node. bug fix:\n         // https://github.com/osmlab/atlas-checks/issues/316\n-        if (isEdgeWithSyntheticBoundaryNode(object))\n+        if (this.isEdgeWithSyntheticBoundaryNode(object))\n         {\n             return Optional.empty();\n         }\n"}}, {"oid": "0630fe5f086dad16cf6948aa18ee66ca67c7a77e", "url": "https://github.com/osmlab/atlas-checks/commit/0630fe5f086dad16cf6948aa18ee66ca67c7a77e", "message": "fixing code review comments.", "committedDate": "2020-06-18T17:05:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUwNjgxMw==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r442506813", "bodyText": "This is not needed, unless sonar is throwing a fit. The object has already been verified to be an Edge in validCheckForObject.", "author": "Bentleysb", "createdAt": "2020-06-18T21:15:23Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java", "diffHunk": "@@ -163,6 +175,21 @@ private boolean intersectsWithEnclosedGeometry(final Polygon polygon, final Edge\n                         || polygon.fullyGeometricallyEncloses(polyline));\n     }\n \n+    /**\n+     * Checks if {@link AtlasObject} contains synthetic boundary Node\n+     * \n+     * @param object\n+     * @return true if roundabout contains synthetic boundary Node.\n+     */\n+    private boolean isEdgeWithSyntheticBoundaryNode(final AtlasObject object)\n+    {\n+        return object instanceof Edge", "originalCommit": "0630fe5f086dad16cf6948aa18ee66ca67c7a77e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUxMDg0Ng==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r442510846", "bodyText": "object check removed", "author": "vladlemberg", "createdAt": "2020-06-18T21:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUwNjgxMw=="}], "type": "inlineReview", "revised_code": {"commit": "06e0c6d5aea34bebe7ecba641aeced9a29eba04c", "chunk": "diff --git a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\nindex c5dfd88..b1b3fa4 100644\n--- a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n+++ b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n\n@@ -183,8 +183,7 @@ public class MalformedRoundaboutCheck extends BaseCheck<Long>\n      */\n     private boolean isEdgeWithSyntheticBoundaryNode(final AtlasObject object)\n     {\n-        return object instanceof Edge\n-                && new SimpleEdgeWalker((Edge) object, this.isRoundaboutEdge()).collectEdges()\n+        return new SimpleEdgeWalker((Edge) object, this.isRoundaboutEdge()).collectEdges()\n                         .stream()\n                         .anyMatch(roundaboutEdge -> roundaboutEdge.connectedNodes().stream()\n                                 .anyMatch(SyntheticBoundaryNodeTag::isSyntheticBoundaryNode));\n"}}, {"oid": "06e0c6d5aea34bebe7ecba641aeced9a29eba04c", "url": "https://github.com/osmlab/atlas-checks/commit/06e0c6d5aea34bebe7ecba641aeced9a29eba04c", "message": "remove object verification.", "committedDate": "2020-06-18T21:22:10Z", "type": "commit"}, {"oid": "84a8c2b8c6ed183af70400621871e834132d880d", "url": "https://github.com/osmlab/atlas-checks/commit/84a8c2b8c6ed183af70400621871e834132d880d", "message": "remove object verification.", "committedDate": "2020-06-18T21:23:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0OTM1MQ==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r445149351", "bodyText": "nit: could markAsFlagged() the object and the other edges picked up here to avoid reprocessing them", "author": "seancoulter", "createdAt": "2020-06-24T20:22:27Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java", "diffHunk": "@@ -87,6 +91,14 @@ public boolean validCheckForObject(final AtlasObject object)\n     protected Optional<CheckFlag> flag(final AtlasObject object)\n     {\n         final Set<String> instructions = new HashSet<>();\n+\n+        // Skip if roundabout contains synthetic node. bug fix:\n+        // https://github.com/osmlab/atlas-checks/issues/316\n+        if (this.isEdgeWithSyntheticBoundaryNode(object))\n+        {\n+            return Optional.empty();", "originalCommit": "84a8c2b8c6ed183af70400621871e834132d880d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "60ce742d3926ea6b993033927e1e5826b8a7a75f", "chunk": "diff --git a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\nindex d2c3711..f7aabbb 100644\n--- a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n+++ b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n\n@@ -92,13 +95,6 @@ public class MalformedRoundaboutCheck extends BaseCheck<Long>\n     {\n         final Set<String> instructions = new HashSet<>();\n \n-        // Skip if roundabout contains synthetic node. bug fix:\n-        // https://github.com/osmlab/atlas-checks/issues/316\n-        if (this.isEdgeWithSyntheticBoundaryNode(object))\n-        {\n-            return Optional.empty();\n-        }\n-\n         // Create a ComplexRoundabout based on object\n         final ComplexRoundabout complexRoundabout = new ComplexRoundabout((Edge) object,\n                 this.leftDrivingCountries);\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE1MDk2MQ==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r445150961", "bodyText": "Should we use the same constraints as validCheckForObject here? In that method we check !isExcludedHighway instead of HighwayTag.isCarNavigableHighway()", "author": "seancoulter", "createdAt": "2020-06-24T20:25:33Z", "path": "src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java", "diffHunk": "@@ -176,6 +201,19 @@ private boolean isExcludedHighway(final AtlasObject object)\n                 HighwayTag.PEDESTRIAN, HighwayTag.FOOTWAY);\n     }\n \n+    /**\n+     * Function for {@link SimpleEdgeWalker} that gathers connected edges that are part of a\n+     * roundabout.\n+     *\n+     * @return {@link Function} for {@link SimpleEdgeWalker}\n+     */\n+    private Function<Edge, Stream<Edge>> isRoundaboutEdge()\n+    {\n+        return edge -> edge.connectedEdges().stream()\n+                .filter(connected -> JunctionTag.isRoundabout(connected)\n+                        && HighwayTag.isCarNavigableHighway(connected));", "originalCommit": "84a8c2b8c6ed183af70400621871e834132d880d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE5ODk2NQ==", "url": "https://github.com/osmlab/atlas-checks/pull/317#discussion_r445198965", "bodyText": "@seancoulter @vladlemberg Resolved?", "author": "ameliaewatts", "createdAt": "2020-06-24T22:07:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE1MDk2MQ=="}], "type": "inlineReview", "revised_code": {"commit": "60ce742d3926ea6b993033927e1e5826b8a7a75f", "chunk": "diff --git a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\nindex d2c3711..f7aabbb 100644\n--- a/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n+++ b/src/main/java/org/openstreetmap/atlas/checks/validation/linear/edges/MalformedRoundaboutCheck.java\n\n@@ -211,7 +208,7 @@ public class MalformedRoundaboutCheck extends BaseCheck<Long>\n     {\n         return edge -> edge.connectedEdges().stream()\n                 .filter(connected -> JunctionTag.isRoundabout(connected)\n-                        && HighwayTag.isCarNavigableHighway(connected));\n+                        && !this.isExcludedHighway(connected));\n     }\n \n     /**\n"}}, {"oid": "60ce742d3926ea6b993033927e1e5826b8a7a75f", "url": "https://github.com/osmlab/atlas-checks/commit/60ce742d3926ea6b993033927e1e5826b8a7a75f", "message": "added code review suggestions.", "committedDate": "2020-06-24T22:28:07Z", "type": "commit"}]}