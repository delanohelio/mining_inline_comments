{"pr_number": 1940, "pr_title": "HBASE-24601: Change default Hfile storage policy from HOT to NONE for HDFS", "pr_createdAt": "2020-06-20T17:06:25Z", "pr_url": "https://github.com/apache/hbase/pull/1940", "timeline": [{"oid": "31e192b27a5b40f1946af0448738e35728b6219b", "url": "https://github.com/apache/hbase/commit/31e192b27a5b40f1946af0448738e35728b6219b", "message": "HBASE-24601: Change default Hfile storage policy from HOT to NONE for HDFS", "committedDate": "2020-06-20T17:02:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE3NzcyMQ==", "url": "https://github.com/apache/hbase/pull/1940#discussion_r443177721", "bodyText": "Referring to the patch for WAL dir policy fix, is this enough?  In case of NONE we should avoid calling the HDFS API or else will see unwanted exception logs.", "author": "anoopsjohn", "createdAt": "2020-06-21T03:27:37Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java", "diffHunk": "@@ -139,8 +139,8 @@\n       \"hbase.server.compactchecker.interval.multiplier\";\n   public static final String BLOCKING_STOREFILES_KEY = \"hbase.hstore.blockingStoreFiles\";\n   public static final String BLOCK_STORAGE_POLICY_KEY = \"hbase.hstore.block.storage.policy\";\n-  // keep in accordance with HDFS default storage policy\n-  public static final String DEFAULT_BLOCK_STORAGE_POLICY = \"HOT\";\n+  // \"NONE\" is not a valid storage policy and means we defer the policy to HDFS\n+  public static final String DEFAULT_BLOCK_STORAGE_POLICY = \"NONE\";", "originalCommit": "31e192b27a5b40f1946af0448738e35728b6219b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE4NzM1Mg==", "url": "https://github.com/apache/hbase/pull/1940#discussion_r443187352", "bodyText": "Updated JIRA for more details\n\nUsing the HOT or NONE strategy currently won't throw an unexpected exception because HBASE-20691 has already covered the different situation. And they invoke the same method, that's why we can use NONE directly.\nIt makes sense to allow Hbase users to set the storage strategy corresponding to the Hfile/WAL directory, because most users may not be familiar with how to operate the heterogeneous commands of HDFS\nHowever, if the default value stored in Hfile is still HOT, there will be potential semantic conflicts. HDFS managers and Hbase users may not know this default setting and will not modify it, but it actually changes HDFS Storage strategy.\nThis is a omission point of HBASE-20691, It only modified the default policy of WAL, but forgot to modify Hfile.\n\nTBH, it's' a legacy issue to decide if we should avoid/ban setStoragePolicy() in Hbase, seems that keeping the status quo has the least impact now (ban the whole reflect API for HDFS should be done in a separate patch)", "author": "imbajin", "createdAt": "2020-06-21T06:36:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE3NzcyMQ=="}], "type": "inlineReview", "revised_code": null}]}