{"pr_number": 1743, "pr_title": "HBASE-24403 FsDelegationToken Should Cache Token After Acquired A New One", "pr_createdAt": "2020-05-20T05:14:52Z", "pr_url": "https://github.com/apache/hbase/pull/1743", "timeline": [{"oid": "8bfe220eb76f3eca73c7d7a9b963e9756c5bee6d", "url": "https://github.com/apache/hbase/commit/8bfe220eb76f3eca73c7d7a9b963e9756c5bee6d", "message": "cache token for current ugi", "committedDate": "2020-05-20T05:13:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIwMjY2NA==", "url": "https://github.com/apache/hbase/pull/1743#discussion_r428202664", "bodyText": "LGTM. Does it make sense to add a small test to have it covered/verified?", "author": "HorizonNet", "createdAt": "2020-05-20T17:57:28Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/FsDelegationToken.java", "diffHunk": "@@ -104,6 +104,7 @@ public void acquireDelegationToken(final String tokenKind, final FileSystem fs)\n         hasForwardedToken = false;\n         try {\n           userToken = fs.getDelegationToken(renewer);\n+          userProvider.getCurrent().addToken(userToken);", "originalCommit": "8bfe220eb76f3eca73c7d7a9b963e9756c5bee6d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "277ec84fa2a5dd556a41807a14304e8ec5124785", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/FsDelegationToken.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/FsDelegationToken.java\nindex f86d60b6a1..d7cac239db 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/FsDelegationToken.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/security/token/FsDelegationToken.java\n\n@@ -103,6 +104,7 @@ public class FsDelegationToken {\n       if (userToken == null) {\n         hasForwardedToken = false;\n         try {\n+\n           userToken = fs.getDelegationToken(renewer);\n           userProvider.getCurrent().addToken(userToken);\n         } catch (NullPointerException npe) {\n"}}, {"oid": "96aa214011a2e5be1c8fabed2c4cd044f7ae9792", "url": "https://github.com/apache/hbase/commit/96aa214011a2e5be1c8fabed2c4cd044f7ae9792", "message": "add some test case for this new feature", "committedDate": "2020-05-21T08:53:52Z", "type": "commit"}, {"oid": "277ec84fa2a5dd556a41807a14304e8ec5124785", "url": "https://github.com/apache/hbase/commit/277ec84fa2a5dd556a41807a14304e8ec5124785", "message": "add retry logic for token expiration", "committedDate": "2020-05-23T02:19:15Z", "type": "commit"}, {"oid": "94f1546d1872da9cc5d1892b3317ac1d366334ed", "url": "https://github.com/apache/hbase/commit/94f1546d1872da9cc5d1892b3317ac1d366334ed", "message": "add token expiration process logic", "committedDate": "2020-05-28T02:04:23Z", "type": "commit"}, {"oid": "50d0bcbf217d8d5cf6462234882ff29482a065d8", "url": "https://github.com/apache/hbase/commit/50d0bcbf217d8d5cf6462234882ff29482a065d8", "message": "fix the checkstyle issue", "committedDate": "2020-06-03T02:14:42Z", "type": "commit"}, {"oid": "8e4ca0fd4018d9dcc1ffe04ef3d4ed1f9904f912", "url": "https://github.com/apache/hbase/commit/8e4ca0fd4018d9dcc1ffe04ef3d4ed1f9904f912", "message": "stacktrace for token exception", "committedDate": "2020-06-03T05:19:00Z", "type": "commit"}, {"oid": "67c5e6658d784c2af27fd6d3e391becfe2072dcf", "url": "https://github.com/apache/hbase/commit/67c5e6658d784c2af27fd6d3e391becfe2072dcf", "message": "fix testing issue", "committedDate": "2020-06-03T07:52:23Z", "type": "commit"}]}