{"pr_number": 2468, "pr_title": "HBASE-25109 Add MR Counters to WALPlayer; currently hard to tell if i\u2026", "pr_createdAt": "2020-09-28T18:36:22Z", "pr_url": "https://github.com/apache/hbase/pull/2468", "timeline": [{"oid": "0546babfa3c3b41555e94367351cd987f520b76f", "url": "https://github.com/apache/hbase/commit/0546babfa3c3b41555e94367351cd987f520b76f", "message": "HBASE-25109 Add MR Counters to WALPlayer; currently hard to tell if it is doing anything\n\nAdd MR counters so operator can see if WALPlayer run actually did\nanything. Fix bugs in usage (it enforced two args though usage\ndescribes allowing one arg only). Clean up usage output. In\nparticular add note on wal file separator as hbase by default uses\nthe ',' in its WAL file names which could befuddle operator\ntrying to do simple import.", "committedDate": "2020-09-28T21:24:59Z", "type": "forcePushed"}, {"oid": "9eb8f1a01209900678f3eeb644f041c70e3dcbcb", "url": "https://github.com/apache/hbase/commit/9eb8f1a01209900678f3eeb644f041c70e3dcbcb", "message": "HBASE-25091 Move LogComparator from ReplicationSource to AbstractFSWALProvider#.WALsStartTimeComparator\n\nSigned-off-by: Duo Zhang <zhangduo@apache.org>\nSigned-off-by: Guanghao Zhang <zghao@apache.org>\n\nGive the comparator a more descriptive name, a better location,\nand make it work even when passed hbase:meta WAL files.", "committedDate": "2020-09-28T22:04:15Z", "type": "forcePushed"}, {"oid": "9e49c260bc712049e8a9aac1aabd29365b0795ec", "url": "https://github.com/apache/hbase/commit/9e49c260bc712049e8a9aac1aabd29365b0795ec", "message": "HBASE-25109 Add MR Counters to WALPlayer; currently hard to tell if it is doing anything\n\nAdd MR counters so operator can see if WALPlayer run actually did\nanything. Fix bugs in usage (it enforced two args though usage\ndescribes allowing one arg only). Clean up usage output. In\nparticular add note on wal file separator as hbase by default uses\nthe ',' in its WAL file names which could befuddle operator\ntrying to do simple import.", "committedDate": "2020-09-28T23:18:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5NTY5Nw==", "url": "https://github.com/apache/hbase/pull/2468#discussion_r496295697", "bodyText": "Nit, can the above \"context.getCounter(Counter.CELLS_WRITTEN).increment(1);\" be moved of the if {} else {}?", "author": "huaxiangsun", "createdAt": "2020-09-28T23:46:42Z", "path": "hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/WALPlayer.java", "diffHunk": "@@ -225,8 +245,10 @@ public void map(WALKey key, WALEdit value, Context context)\n                 }\n               }\n               if (CellUtil.isDelete(cell)) {\n+                context.getCounter(Counter.CELLS_WRITTEN).increment(1);\n                 del.add(cell);\n               } else {\n+                context.getCounter(Counter.CELLS_WRITTEN).increment(1);\n                 put.add(cell);", "originalCommit": "9e49c260bc712049e8a9aac1aabd29365b0795ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE2Mzk3MA==", "url": "https://github.com/apache/hbase/pull/2468#discussion_r497163970", "bodyText": "Makes sense.", "author": "saintstack", "createdAt": "2020-09-30T00:06:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5NTY5Nw=="}], "type": "inlineReview", "revised_code": {"commit": "6b4f7d101c097f66c67726379071fb2bb3a3e87c", "chunk": "diff --git a/hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/WALPlayer.java b/hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/WALPlayer.java\nindex 32590090c6..a5cc4c40ad 100644\n--- a/hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/WALPlayer.java\n+++ b/hbase-mapreduce/src/main/java/org/apache/hadoop/hbase/mapreduce/WALPlayer.java\n\n@@ -245,12 +245,11 @@ public class WALPlayer extends Configured implements Tool {\n                 }\n               }\n               if (CellUtil.isDelete(cell)) {\n-                context.getCounter(Counter.CELLS_WRITTEN).increment(1);\n                 del.add(cell);\n               } else {\n-                context.getCounter(Counter.CELLS_WRITTEN).increment(1);\n                 put.add(cell);\n               }\n+              context.getCounter(Counter.CELLS_WRITTEN).increment(1);\n             }\n             lastCell = cell;\n           }\n"}}, {"oid": "6b4f7d101c097f66c67726379071fb2bb3a3e87c", "url": "https://github.com/apache/hbase/commit/6b4f7d101c097f66c67726379071fb2bb3a3e87c", "message": "HBASE-25109 Add MR Counters to WALPlayer; currently hard to tell if it is doing anything\n\nAdd MR counters so operator can see if WALPlayer run actually did\nanything. Fix bugs in usage (it enforced two args though usage\ndescribes allowing one arg only). Clean up usage output. In\nparticular add note on wal file separator as hbase by default uses\nthe ',' in its WAL file names which could befuddle operator\ntrying to do simple import.", "committedDate": "2020-09-30T00:06:49Z", "type": "commit"}, {"oid": "6b4f7d101c097f66c67726379071fb2bb3a3e87c", "url": "https://github.com/apache/hbase/commit/6b4f7d101c097f66c67726379071fb2bb3a3e87c", "message": "HBASE-25109 Add MR Counters to WALPlayer; currently hard to tell if it is doing anything\n\nAdd MR counters so operator can see if WALPlayer run actually did\nanything. Fix bugs in usage (it enforced two args though usage\ndescribes allowing one arg only). Clean up usage output. In\nparticular add note on wal file separator as hbase by default uses\nthe ',' in its WAL file names which could befuddle operator\ntrying to do simple import.", "committedDate": "2020-09-30T00:06:49Z", "type": "forcePushed"}]}