{"pr_number": 1629, "pr_title": "HBASE-24328 skip duplicate GCMultipleMergedRegionsProcedure while previous finished", "pr_createdAt": "2020-05-02T14:29:02Z", "pr_url": "https://github.com/apache/hbase/pull/1629", "timeline": [{"oid": "b5181c77898523371287af9cd9b25fce5fabf197", "url": "https://github.com/apache/hbase/commit/b5181c77898523371287af9cd9b25fce5fabf197", "message": "HBASE-24250 CatalogJanitor resubmits GCMultipleMergedRegionsProcedure for the same region", "committedDate": "2020-05-03T10:48:06Z", "type": "forcePushed"}, {"oid": "691121496ac56c4d61924c6f4ccc4dd2c2d386db", "url": "https://github.com/apache/hbase/commit/691121496ac56c4d61924c6f4ccc4dd2c2d386db", "message": "HBASE-24328 skip duplicate GCMultipleMergedRegionsProcedure while previous finished", "committedDate": "2020-05-05T13:44:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5NzEwNw==", "url": "https://github.com/apache/hbase/pull/1629#discussion_r419797107", "bodyText": "Can you review the comment line and new comment? Briefly explain what the code does.", "author": "huaxiangsun", "createdAt": "2020-05-05T00:03:01Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java", "diffHunk": "@@ -78,6 +78,13 @@ protected Flow executeFromState(MasterProcedureEnv env, GCMergedRegionsState sta\n       switch (state) {\n         case GC_MERGED_REGIONS_PREPARE:\n           // Nothing to do to prepare.", "originalCommit": "b5181c77898523371287af9cd9b25fce5fabf197", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU2MzQ4OA==", "url": "https://github.com/apache/hbase/pull/1629#discussion_r420563488", "bodyText": "Hi @nyl3532016, can you put your above comment \"If GCMultipleMergedRegionsProcedure processing is slower than the CatalogJanitor's scan interval, it will end resubmitting GCMultipleMergedRegionsProcedure for the same region, we can skip duplicate GCMultipleMergedRegionsProcedure\" to the code above? It will help other developers's code reading easier. After that, you can merge, thanks.", "author": "huaxiangsun", "createdAt": "2020-05-06T06:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5NzEwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU3MTE2MA==", "url": "https://github.com/apache/hbase/pull/1629#discussion_r420571160", "bodyText": "ok,thanks, I know. I will add this comment.", "author": "nyl3532016", "createdAt": "2020-05-06T06:32:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc5NzEwNw=="}], "type": "inlineReview", "revised_code": {"commit": "00c61233ef8796709525ee85267b432e050a1d8e", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java\nindex 844b63affa..c27fc747bc 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java\n\n@@ -77,7 +77,9 @@ public class GCMultipleMergedRegionsProcedure extends\n     try {\n       switch (state) {\n         case GC_MERGED_REGIONS_PREPARE:\n-          // Nothing to do to prepare.\n+          // If GCMultipleMergedRegionsProcedure processing is slower than the CatalogJanitor's scan\n+          // interval, it will end resubmitting GCMultipleMergedRegionsProcedure for the same\n+          // region, we can skip duplicate GCMultipleMergedRegionsProcedure while previous finished\n           List<RegionInfo> parents = MetaTableAccessor.getMergeRegions(\n             env.getMasterServices().getConnection(), mergedChild.getRegionName());\n           if (parents == null || parents.isEmpty()) {\n"}}, {"oid": "00c61233ef8796709525ee85267b432e050a1d8e", "url": "https://github.com/apache/hbase/commit/00c61233ef8796709525ee85267b432e050a1d8e", "message": "HBASE-24328 skip duplicate GCMultipleMergedRegionsProcedure while previous finished", "committedDate": "2020-05-06T06:42:01Z", "type": "commit"}, {"oid": "00c61233ef8796709525ee85267b432e050a1d8e", "url": "https://github.com/apache/hbase/commit/00c61233ef8796709525ee85267b432e050a1d8e", "message": "HBASE-24328 skip duplicate GCMultipleMergedRegionsProcedure while previous finished", "committedDate": "2020-05-06T06:42:01Z", "type": "forcePushed"}]}