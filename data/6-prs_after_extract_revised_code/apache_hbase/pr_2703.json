{"pr_number": 2703, "pr_title": "HBASE-25324 Remove unnecessary array to list conversion in SplitLogManager", "pr_createdAt": "2020-11-24T10:11:46Z", "pr_url": "https://github.com/apache/hbase/pull/2703", "timeline": [{"oid": "a9625bb55728627d33fdc2b1c2589f8f7b5a2ff3", "url": "https://github.com/apache/hbase/commit/a9625bb55728627d33fdc2b1c2589f8f7b5a2ff3", "message": "HBASE-25324 Remove unnecessary array to list conversion in SplitLogManager", "committedDate": "2020-11-24T10:08:38Z", "type": "commit"}, {"oid": "2453e09408bb0236c3e2ce781a61934343c08d1d", "url": "https://github.com/apache/hbase/commit/2453e09408bb0236c3e2ce781a61934343c08d1d", "message": "HBASE-25324 Remove unnecessary array to list conversion in SplitLogManager, change 1", "committedDate": "2020-11-24T10:12:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTU4MTc3Ng==", "url": "https://github.com/apache/hbase/pull/2703#discussion_r529581776", "bodyText": "Nice", "author": "virajjasani", "createdAt": "2020-11-24T14:22:29Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -220,17 +218,16 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n     Path rootDir = CommonFSUtils.getRootDir(conf);\n     FileSystem rootFS = rootDir.getFileSystem(conf);\n     WALSplitter splitter = new WALSplitter(factory, conf, walRootDir, walFS, rootDir, rootFS);\n-    final FileStatus[] wals =\n+    final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (ArrayUtils.isNotEmpty(wals)) {\n+    if (CollectionUtils.isNotEmpty(wals)) {\n       for (FileStatus wal: wals) {\n         SplitWALResult splitWALResult = splitter.splitWAL(wal, null);\n         if (splitWALResult.isFinished()) {\n           WALSplitUtil.archive(wal.getPath(), splitWALResult.isCorrupt(), archiveDir, walFS, conf);\n-          if (splitter.outputSink.splits != null) {\n-            splits.addAll(splitter.outputSink.splits);\n-          }\n+          //splitter.outputSink.splits is mark as final, do not need null check\n+          splits.addAll(splitter.outputSink.splits);", "originalCommit": "2453e09408bb0236c3e2ce781a61934343c08d1d", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "6da6d6e420d4f818185c739fe19badc4f0a5a7cd", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\nindex 5fa19ba0ec..6d5602a454 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\n\n@@ -221,7 +220,7 @@ public class WALSplitter {\n     final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (CollectionUtils.isNotEmpty(wals)) {\n+    if (!wals.isEmpty()) {\n       for (FileStatus wal: wals) {\n         SplitWALResult splitWALResult = splitter.splitWAL(wal, null);\n         if (splitWALResult.isFinished()) {\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTczMTM3NA==", "url": "https://github.com/apache/hbase/pull/2703#discussion_r529731374", "bodyText": "s/logfiles.size != 0/logfiles.isEmpty()/", "author": "saintstack", "createdAt": "2020-11-24T16:57:03Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java", "diffHunk": "@@ -242,11 +242,11 @@ public long splitLogDistributed(final Set<ServerName> serverNames, final List<Pa\n     long totalSize = 0;\n     TaskBatch batch = null;\n     long startTime = 0;\n-    FileStatus[] logfiles = getFileList(logDirs, filter);\n-    if (logfiles.length != 0) {\n+    List<FileStatus> logfiles = getFileList(logDirs, filter);\n+    if (logfiles.size() != 0) {", "originalCommit": "2453e09408bb0236c3e2ce781a61934343c08d1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA2NTI0MA==", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530065240", "bodyText": "Nice, I will use CollectionUtils.isNotEmpty instead", "author": "yuqi1129", "createdAt": "2020-11-25T02:21:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTczMTM3NA=="}], "type": "inlineReview", "revised_code": {"commit": "e0ef40378ffd2e4cbc2d31e3263c3aedb8f5c803", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\nindex e4ab4d71c1..90c47feabc 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\n\n@@ -243,7 +244,7 @@ public class SplitLogManager {\n     TaskBatch batch = null;\n     long startTime = 0;\n     List<FileStatus> logfiles = getFileList(logDirs, filter);\n-    if (logfiles.size() != 0) {\n+    if (CollectionUtils.isNotEmpty(logfiles)) {\n       status.setStatus(\"Checking directory contents...\");\n       SplitLogCounters.tot_mgr_log_split_batch_start.increment();\n       LOG.info(\"Started splitting \" + logfiles.size() + \" logs in \" + logDirs +\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNzc4Ng==", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530017786", "bodyText": "wals.isEmpty()?", "author": "infraio", "createdAt": "2020-11-24T23:49:20Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java", "diffHunk": "@@ -220,17 +218,16 @@ public static boolean splitLogFile(Path walDir, FileStatus logfile, FileSystem w\n     Path rootDir = CommonFSUtils.getRootDir(conf);\n     FileSystem rootFS = rootDir.getFileSystem(conf);\n     WALSplitter splitter = new WALSplitter(factory, conf, walRootDir, walFS, rootDir, rootFS);\n-    final FileStatus[] wals =\n+    final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (ArrayUtils.isNotEmpty(wals)) {\n+    if (CollectionUtils.isNotEmpty(wals)) {", "originalCommit": "2453e09408bb0236c3e2ce781a61934343c08d1d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDA2NzU1Ng==", "url": "https://github.com/apache/hbase/pull/2703#discussion_r530067556", "bodyText": "The logic here: if wals is not (empty or null), we will do the following loop, so i can't clearly figure out your meaning, could you description it in detail ?", "author": "yuqi1129", "createdAt": "2020-11-25T02:28:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAxNzc4Ng=="}], "type": "inlineReview", "revised_code": {"commit": "6da6d6e420d4f818185c739fe19badc4f0a5a7cd", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\nindex 5fa19ba0ec..6d5602a454 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/wal/WALSplitter.java\n\n@@ -221,7 +220,7 @@ public class WALSplitter {\n     final List<FileStatus> wals =\n       SplitLogManager.getFileList(conf, Collections.singletonList(walsDir), null);\n     List<Path> splits = new ArrayList<>();\n-    if (CollectionUtils.isNotEmpty(wals)) {\n+    if (!wals.isEmpty()) {\n       for (FileStatus wal: wals) {\n         SplitWALResult splitWALResult = splitter.splitWAL(wal, null);\n         if (splitWALResult.isFinished()) {\n"}}, {"oid": "e0ef40378ffd2e4cbc2d31e3263c3aedb8f5c803", "url": "https://github.com/apache/hbase/commit/e0ef40378ffd2e4cbc2d31e3263c3aedb8f5c803", "message": "Fix discussion 1", "committedDate": "2020-11-25T02:31:21Z", "type": "commit"}, {"oid": "6da6d6e420d4f818185c739fe19badc4f0a5a7cd", "url": "https://github.com/apache/hbase/commit/6da6d6e420d4f818185c739fe19badc4f0a5a7cd", "message": "Fix discussion 3", "committedDate": "2020-11-25T04:02:27Z", "type": "commit"}, {"oid": "ba66dbd8f5dcee5af05b1f21017918718f52180e", "url": "https://github.com/apache/hbase/commit/ba66dbd8f5dcee5af05b1f21017918718f52180e", "message": "Fix discussion 4, fix checkstyle problem", "committedDate": "2020-11-25T09:15:58Z", "type": "commit"}, {"oid": "6e058aa1321233c0acf5af7b7df3e58966a461ad", "url": "https://github.com/apache/hbase/commit/6e058aa1321233c0acf5af7b7df3e58966a461ad", "message": "Merge branch 'master' of https://github.com/apache/hbase into HBASE-25324", "committedDate": "2020-11-25T09:18:04Z", "type": "commit"}, {"oid": "bce4bb6d131e8e708e40415bc94d79ad17832b46", "url": "https://github.com/apache/hbase/commit/bce4bb6d131e8e708e40415bc94d79ad17832b46", "message": "Merge branch 'master' into HBASE-25324", "committedDate": "2020-11-26T01:52:26Z", "type": "commit"}, {"oid": "a125c4d2eda3f1a92be41fca16b5c56f3611af98", "url": "https://github.com/apache/hbase/commit/a125c4d2eda3f1a92be41fca16b5c56f3611af98", "message": "merge master and resolve conflict", "committedDate": "2020-11-26T02:20:44Z", "type": "commit"}, {"oid": "f0a6e3f553bd331021b040cfd3812250671aee70", "url": "https://github.com/apache/hbase/commit/f0a6e3f553bd331021b040cfd3812250671aee70", "message": "Merge master, fix conflict again", "committedDate": "2020-11-26T02:23:53Z", "type": "commit"}]}