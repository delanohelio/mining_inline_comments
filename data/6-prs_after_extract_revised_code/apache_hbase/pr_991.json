{"pr_number": 991, "pr_title": "HBASE-23651 Region balance throttling can be disabled", "pr_createdAt": "2020-01-06T07:57:48Z", "pr_url": "https://github.com/apache/hbase/pull/991", "timeline": [{"oid": "198f06d2e69f1b28a42775cae2d244f20c2a6fac", "url": "https://github.com/apache/hbase/commit/198f06d2e69f1b28a42775cae2d244f20c2a6fac", "message": "HBASE-23651 Region balance throttling can be disabled", "committedDate": "2020-01-06T07:54:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363197154", "bodyText": "ok so by disabling throttling what we mean is providing negative int value for hbase.balancer.max.balancing in master site config", "author": "virajjasani", "createdAt": "2020-01-06T08:29:33Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1860,11 +1856,14 @@ public boolean balance(boolean force) throws IOException {\n         //rpCount records balance plans processed, does not care if a plan succeeds\n         rpCount++;\n \n-        balanceThrottling(balanceStartTime + rpCount * balanceInterval, maxRegionsInTransition,\n+        if (this.maxBlancingTime > 0) {", "originalCommit": "198f06d2e69f1b28a42775cae2d244f20c2a6fac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzIwMTcxOQ==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363201719", "bodyText": "Yes.", "author": "binlijin", "createdAt": "2020-01-06T08:45:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3OTM5Mg==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363579392", "bodyText": "So you will change this maxBlancingTime dynamically at HM config?\nIf permanently for the cluster the throttling needs disabled, hbase.master.balancer.maxRitPercent can be 100% right (which is the def value).  What am missing here? I did not read this part of code fully though", "author": "anoopsjohn", "createdAt": "2020-01-07T03:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwNTcxNQ==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363605715", "bodyText": "No this do not change maxBlancingTime dynamically, It just skip the balanceThrottling when maxBlancingTime<=0.", "author": "binlijin", "createdAt": "2020-01-07T06:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzE5NzE1NA=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3ODk3NQ==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363578975", "bodyText": "This change is wrong right?  We no longer check any configured value for HBASE_BALANCER_PERIOD.\nU wanted it like\nmaxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING,  getConfiguration().getInt(HConstants.HBASE_BALANCER_PERIOD,\nHConstants.DEFAULT_HBASE_BALANCER_PERIOD);", "author": "anoopsjohn", "createdAt": "2020-01-07T03:31:31Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -1688,12 +1688,8 @@ InetAddress getRemoteInetAddress(final int port,\n    * @return Maximum time we should run balancer for\n    */\n   private int getMaxBalancingTime() {\n-    int maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING, -1);\n-    if (maxBalancingTime == -1) {\n-      // if max balancing time isn't set, defaulting it to period time\n-      maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_PERIOD,\n-        HConstants.DEFAULT_HBASE_BALANCER_PERIOD);\n-    }\n+    int maxBalancingTime = getConfiguration()", "originalCommit": "198f06d2e69f1b28a42775cae2d244f20c2a6fac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzYwMzI2NA==", "url": "https://github.com/apache/hbase/pull/991#discussion_r363603264", "bodyText": "Yes, you are right.", "author": "binlijin", "createdAt": "2020-01-07T06:10:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzU3ODk3NQ=="}], "type": "inlineReview", "revised_code": {"commit": "4b5f71457dc9771acb17a8c8ad2aa68812bd7aca", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\nindex 533919045b..2de202a011 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n\n@@ -1688,8 +1688,9 @@ public class HMaster extends HRegionServer implements MasterServices {\n    * @return Maximum time we should run balancer for\n    */\n   private int getMaxBalancingTime() {\n-    int maxBalancingTime = getConfiguration()\n-      .getInt(HConstants.HBASE_BALANCER_MAX_BALANCING, HConstants.DEFAULT_HBASE_BALANCER_PERIOD);\n+    int maxBalancingTime = getConfiguration().getInt(HConstants.HBASE_BALANCER_MAX_BALANCING,\n+      getConfiguration()\n+        .getInt(HConstants.HBASE_BALANCER_PERIOD, HConstants.DEFAULT_HBASE_BALANCER_PERIOD));\n     return maxBalancingTime;\n   }\n \n"}}, {"oid": "4b5f71457dc9771acb17a8c8ad2aa68812bd7aca", "url": "https://github.com/apache/hbase/commit/4b5f71457dc9771acb17a8c8ad2aa68812bd7aca", "message": "fix comment", "committedDate": "2020-01-07T06:10:33Z", "type": "commit"}, {"oid": "37ef9c988605c43c85cb51fb58bea9886b538137", "url": "https://github.com/apache/hbase/commit/37ef9c988605c43c85cb51fb58bea9886b538137", "message": "fix comment", "committedDate": "2020-01-07T06:13:01Z", "type": "commit"}]}