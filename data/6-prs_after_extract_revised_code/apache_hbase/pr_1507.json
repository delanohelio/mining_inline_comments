{"pr_number": 1507, "pr_title": "HBASE-24151 The master server aborted for IllegalThreadStateException", "pr_createdAt": "2020-04-14T10:40:15Z", "pr_url": "https://github.com/apache/hbase/pull/1507", "timeline": [{"oid": "b400be3de20559aa4d06b1d4f5f14896fd3e3b6e", "url": "https://github.com/apache/hbase/commit/b400be3de20559aa4d06b1d4f5f14896fd3e3b6e", "message": "HBASE-24151 The master server aborted for IllegalThreadStateException", "committedDate": "2020-04-14T10:37:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY4Njk2OA==", "url": "https://github.com/apache/hbase/pull/1507#discussion_r408686968", "bodyText": "this.getClass().isAssignableFrom(balancerKlass) this is what we can check here to stay consistent with master branch.", "author": "virajjasani", "createdAt": "2020-04-15T08:57:22Z", "path": "hbase-rsgroup/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java", "diffHunk": "@@ -356,6 +357,11 @@ public void initialize() throws HBaseIOException {\n     // Create the balancer\n     Class<? extends LoadBalancer> balancerKlass = config.getClass(HBASE_RSGROUP_LOADBALANCER_CLASS,\n         StochasticLoadBalancer.class, LoadBalancer.class);\n+    if (balancerKlass.equals(this.getClass())) {", "originalCommit": "b400be3de20559aa4d06b1d4f5f14896fd3e3b6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcyMzc2Ng==", "url": "https://github.com/apache/hbase/pull/1507#discussion_r408723766", "bodyText": "Well, thank you", "author": "Gkkkk302", "createdAt": "2020-04-15T09:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY4Njk2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg5MDA1MQ==", "url": "https://github.com/apache/hbase/pull/1507#discussion_r408890051", "bodyText": "Thanks @Gkkkk302\nOnce you are done with this change, will merge this for all branch-2s.", "author": "virajjasani", "createdAt": "2020-04-15T14:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY4Njk2OA=="}], "type": "inlineReview", "revised_code": {"commit": "fc35e9bb423fdde34b91e106d380033402e55145", "chunk": "diff --git a/hbase-rsgroup/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java b/hbase-rsgroup/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\nindex 332d51960d..cc163ac199 100644\n--- a/hbase-rsgroup/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\n+++ b/hbase-rsgroup/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupBasedLoadBalancer.java\n\n@@ -355,14 +355,14 @@ public class RSGroupBasedLoadBalancer implements RSGroupableBalancer {\n     }\n \n     // Create the balancer\n-    Class<? extends LoadBalancer> balancerKlass = config.getClass(HBASE_RSGROUP_LOADBALANCER_CLASS,\n+    Class<? extends LoadBalancer> balancerClass = config.getClass(HBASE_RSGROUP_LOADBALANCER_CLASS,\n         StochasticLoadBalancer.class, LoadBalancer.class);\n-    if (balancerKlass.equals(this.getClass())) {\n+    if (this.getClass().isAssignableFrom(balancerClass)) {\n       LOG.warn(\"The internal balancer of RSGroupBasedLoadBalancer cannot be itself, \" +\n               \"falling back to the default LoadBalancer class\");\n-      balancerKlass = LoadBalancerFactory.getDefaultLoadBalancerClass();\n+      balancerClass = LoadBalancerFactory.getDefaultLoadBalancerClass();\n     }\n-    internalBalancer = ReflectionUtils.newInstance(balancerKlass, config);\n+    internalBalancer = ReflectionUtils.newInstance(balancerClass, config);\n     internalBalancer.setMasterServices(masterServices);\n     if (clusterStatus != null) {\n       internalBalancer.setClusterMetrics(clusterStatus);\n"}}, {"oid": "1f86b805aa442a8980ce5e5f2d59695e17a3e30c", "url": "https://github.com/apache/hbase/commit/1f86b805aa442a8980ce5e5f2d59695e17a3e30c", "message": "Merge remote-tracking branch 'hbase/branch-2.3' into branch-2.3", "committedDate": "2020-04-16T02:40:07Z", "type": "commit"}, {"oid": "fc35e9bb423fdde34b91e106d380033402e55145", "url": "https://github.com/apache/hbase/commit/fc35e9bb423fdde34b91e106d380033402e55145", "message": "HBASE-24151 use same logic as master", "committedDate": "2020-04-16T02:51:02Z", "type": "commit"}]}