{"pr_number": 1627, "pr_title": "HBASE-24221 Support bulkLoadHFile by family", "pr_createdAt": "2020-05-02T08:57:59Z", "pr_url": "https://github.com/apache/hbase/pull/1627", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4MzA0NQ==", "url": "https://github.com/apache/hbase/pull/1627#discussion_r418983045", "bodyText": "nit: why not make BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY public, then remove this variable here?", "author": "wchevreuil", "createdAt": "2020-05-02T17:11:22Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/tool/LoadIncrementalHFiles.java", "diffHunk": "@@ -141,13 +141,15 @@\n   public final static String IGNORE_UNMATCHED_CF_CONF_KEY =\n     BulkLoadHFiles.IGNORE_UNMATCHED_CF_CONF_KEY;\n   public final static String ALWAYS_COPY_FILES = BulkLoadHFiles.ALWAYS_COPY_FILES;\n+  public final static String BULK_LOAD_HFILES_BY_FAMILY = BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY;", "originalCommit": "1f2a0c55ee9fb09e0e771653db8daa622d7ddaec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA1ODQwNQ==", "url": "https://github.com/apache/hbase/pull/1627#discussion_r419058405", "bodyText": "yes,I amend it", "author": "nyl3532016", "createdAt": "2020-05-03T06:56:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4MzA0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "d51cc9db7d83fce982f4fcea5eb84b9acf0d3172", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/tool/LoadIncrementalHFiles.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/tool/LoadIncrementalHFiles.java\nindex 321902e64c..8e634435ee 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/tool/LoadIncrementalHFiles.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/tool/LoadIncrementalHFiles.java\n\n@@ -141,7 +141,6 @@ public class LoadIncrementalHFiles extends Configured implements Tool {\n   public final static String IGNORE_UNMATCHED_CF_CONF_KEY =\n     BulkLoadHFiles.IGNORE_UNMATCHED_CF_CONF_KEY;\n   public final static String ALWAYS_COPY_FILES = BulkLoadHFiles.ALWAYS_COPY_FILES;\n-  public final static String BULK_LOAD_HFILES_BY_FAMILY = BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY;\n \n   // We use a '.' prefix which is ignored when walking directory trees\n   // above. It is invalid family name.\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk4NDAzNQ==", "url": "https://github.com/apache/hbase/pull/1627#discussion_r418984035", "bodyText": "Is this really needed? Isn't BULK_LOAD_HFILES_BY_FAMILY loaded as false by default if not set on LoadIncrementalHFiles#195? Or perhaps you can move this for a separate method that could be overridden by  TestLoadIncrementalHFilesByFamily to avoid duplicating whole setUpBeforeClass in the child class?", "author": "wchevreuil", "createdAt": "2020-05-02T17:20:03Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFiles.java", "diffHunk": "@@ -101,6 +101,7 @@ public static void setUpBeforeClass() throws Exception {\n     // change default behavior so that tag values are returned with normal rpcs\n     util.getConfiguration().set(HConstants.RPC_CODEC_CONF_KEY,\n       KeyValueCodecWithTags.class.getCanonicalName());\n+    util.getConfiguration().setBoolean(BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY, false);", "originalCommit": "1f2a0c55ee9fb09e0e771653db8daa622d7ddaec", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "d51cc9db7d83fce982f4fcea5eb84b9acf0d3172", "chunk": "diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFiles.java b/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFiles.java\nindex 7b90f707e7..d75e9dfd05 100644\n--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFiles.java\n+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFiles.java\n\n@@ -101,7 +104,6 @@ public class TestLoadIncrementalHFiles {\n     // change default behavior so that tag values are returned with normal rpcs\n     util.getConfiguration().set(HConstants.RPC_CODEC_CONF_KEY,\n       KeyValueCodecWithTags.class.getCanonicalName());\n-    util.getConfiguration().setBoolean(BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY, false);\n     util.startMiniCluster();\n \n     setupNamespace();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk5Nzg3OA==", "url": "https://github.com/apache/hbase/pull/1627#discussion_r418997878", "bodyText": "Does this test class actually make sense, without testing the specific new logic added? I mean, even without the group by family feature this test class will pass, so it's not shielding us from inadvertently changes on the new feature.", "author": "wchevreuil", "createdAt": "2020-05-02T19:28:39Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFilesByFamily.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n+ * agreements. See the NOTICE file distributed with this work for additional information regarding\n+ * copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n+ * copy of the License at\n+ * <p>\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ * <p>\n+ * Unless required by applicable law or agreed to in writing, software distributed under the License\n+ * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n+ * or implied. See the License for the specific language governing permissions and limitations under\n+ * the License.\n+ */\n+package org.apache.hadoop.hbase.tool;\n+\n+import org.apache.hadoop.hbase.HBaseClassTestRule;\n+import org.apache.hadoop.hbase.HConstants;\n+import org.apache.hadoop.hbase.codec.KeyValueCodecWithTags;\n+import org.apache.hadoop.hbase.coprocessor.CoprocessorHost;\n+import org.junit.BeforeClass;\n+import org.junit.ClassRule;\n+\n+public class TestLoadIncrementalHFilesByFamily extends TestLoadIncrementalHFiles {", "originalCommit": "1f2a0c55ee9fb09e0e771653db8daa622d7ddaec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTA1ODgyMw==", "url": "https://github.com/apache/hbase/pull/1627#discussion_r419058823", "bodyText": "yes, I delete this test , and add testBulkLoadByFamily ut .\nbulkloadbyFamily only change client side , this config has no affect with server side . no need start another minicluster use different conf for test", "author": "nyl3532016", "createdAt": "2020-05-03T07:00:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk5Nzg3OA=="}], "type": "inlineReview", "revised_code": {"commit": "d51cc9db7d83fce982f4fcea5eb84b9acf0d3172", "chunk": "diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFilesByFamily.java b/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFilesByFamily.java\ndeleted file mode 100644\nindex 4a737a2561..0000000000\n--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/tool/TestLoadIncrementalHFilesByFamily.java\n+++ /dev/null\n\n@@ -1,42 +0,0 @@\n-/**\n- * Licensed to the Apache Software Foundation (ASF) under one or more contributor license\n- * agreements. See the NOTICE file distributed with this work for additional information regarding\n- * copyright ownership. The ASF licenses this file to you under the Apache License, Version 2.0 (the\n- * \"License\"); you may not use this file except in compliance with the License. You may obtain a\n- * copy of the License at\n- * <p>\n- * http://www.apache.org/licenses/LICENSE-2.0\n- * <p>\n- * Unless required by applicable law or agreed to in writing, software distributed under the License\n- * is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express\n- * or implied. See the License for the specific language governing permissions and limitations under\n- * the License.\n- */\n-package org.apache.hadoop.hbase.tool;\n-\n-import org.apache.hadoop.hbase.HBaseClassTestRule;\n-import org.apache.hadoop.hbase.HConstants;\n-import org.apache.hadoop.hbase.codec.KeyValueCodecWithTags;\n-import org.apache.hadoop.hbase.coprocessor.CoprocessorHost;\n-import org.junit.BeforeClass;\n-import org.junit.ClassRule;\n-\n-public class TestLoadIncrementalHFilesByFamily extends TestLoadIncrementalHFiles {\n-\n-  @ClassRule\n-  public static final HBaseClassTestRule CLASS_RULE =\n-      HBaseClassTestRule.forClass(TestLoadIncrementalHFilesByFamily.class);\n-\n-  @BeforeClass\n-  public static void setUpBeforeClass() throws Exception {\n-    util.getConfiguration().set(CoprocessorHost.REGION_COPROCESSOR_CONF_KEY, \"\");\n-    util.getConfiguration().setInt(BulkLoadHFiles.MAX_FILES_PER_REGION_PER_FAMILY,\n-      MAX_FILES_PER_REGION_PER_FAMILY);\n-    // change default behavior so that tag values are returned with normal rpcs\n-    util.getConfiguration().set(HConstants.RPC_CODEC_CONF_KEY,\n-      KeyValueCodecWithTags.class.getCanonicalName());\n-    util.getConfiguration().setBoolean(BulkLoadHFiles.BULK_LOAD_HFILES_BY_FAMILY, true);\n-    util.startMiniCluster();\n-    setupNamespace();\n-  }\n-}\n"}}, {"oid": "d51cc9db7d83fce982f4fcea5eb84b9acf0d3172", "url": "https://github.com/apache/hbase/commit/d51cc9db7d83fce982f4fcea5eb84b9acf0d3172", "message": "HBASE-24221 Support bulkLoadHFile by family", "committedDate": "2020-05-03T06:54:43Z", "type": "forcePushed"}, {"oid": "a4b624c158c932e9702eb308c1353037ce448f51", "url": "https://github.com/apache/hbase/commit/a4b624c158c932e9702eb308c1353037ce448f51", "message": "HBASE-24221 Support bulkLoadHFile by family", "committedDate": "2020-05-03T08:59:40Z", "type": "commit"}, {"oid": "a4b624c158c932e9702eb308c1353037ce448f51", "url": "https://github.com/apache/hbase/commit/a4b624c158c932e9702eb308c1353037ce448f51", "message": "HBASE-24221 Support bulkLoadHFile by family", "committedDate": "2020-05-03T08:59:40Z", "type": "forcePushed"}]}