{"pr_number": 1797, "pr_title": "HBASE-24451 Remove the HasThread because the related bug had been fix\u2026", "pr_createdAt": "2020-05-28T06:33:28Z", "pr_url": "https://github.com/apache/hbase/pull/1797", "timeline": [{"oid": "f7fc7100665f35e3ebe88d0b1f2352b29c59e1f4", "url": "https://github.com/apache/hbase/commit/f7fc7100665f35e3ebe88d0b1f2352b29c59e1f4", "message": "HBASE-24451 Remove the HasThread because the related bug had been fixed since jdk7", "committedDate": "2020-05-28T06:32:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NDg0NQ==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r431674845", "bodyText": "sleep is good enough right? why sleeps?", "author": "virajjasani", "createdAt": "2020-05-28T08:40:15Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java", "diffHunk": "@@ -1472,7 +1470,7 @@ private void waitOnAllRegionsToClose(final boolean abort) {\n     }\n   }\n \n-  private static boolean sleep(long millis) {\n+  private static boolean sleeps(long millis) {", "originalCommit": "f7fc7100665f35e3ebe88d0b1f2352b29c59e1f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY4Nzg0Ng==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r431687846", "bodyText": "sleep is clash with Thread.", "author": "bsglz", "createdAt": "2020-05-28T09:01:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NDg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcxOTQ5MQ==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r431719491", "bodyText": "Oh yes, missed it. Let's name it sleepInterrupted because it makes thread sleep and if interrupted, returns true, else false.", "author": "virajjasani", "createdAt": "2020-05-28T09:57:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NDg0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTcyNTczNg==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r431725736", "bodyText": "Good idea, thanks.", "author": "bsglz", "createdAt": "2020-05-28T10:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3NDg0NQ=="}], "type": "inlineReview", "revised_code": {"commit": "e31989c5a58ead98adf56907612b7095828cf096", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java\nindex 27fe8ae43e..f05c18e38f 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java\n\n@@ -1470,7 +1470,7 @@ public class HRegionServer extends Thread implements\n     }\n   }\n \n-  private static boolean sleeps(long millis) {\n+  private static boolean sleepInterrupted(long millis) {\n     boolean interrupted = false;\n     try {\n       Thread.sleep(millis);\n"}}, {"oid": "0f1499844736500df399b45c711f25febcbb3265", "url": "https://github.com/apache/hbase/commit/0f1499844736500df399b45c711f25febcbb3265", "message": "fix spotbugs, just ignore it, if we do not want to start a thread in constractor, maybe it is better to fix in another issue", "committedDate": "2020-05-28T09:00:24Z", "type": "commit"}, {"oid": "e31989c5a58ead98adf56907612b7095828cf096", "url": "https://github.com/apache/hbase/commit/e31989c5a58ead98adf56907612b7095828cf096", "message": "rename the sleeps to sleepInterrupted", "committedDate": "2020-05-28T10:10:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432095352", "bodyText": "This is not needed w/ this patch?", "author": "saintstack", "createdAt": "2020-05-28T20:09:57Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java", "diffHunk": "@@ -122,9 +121,9 @@ public SplitLogManager(MasterServices master, Configuration conf)\n       throws IOException {\n     this.server = master;\n     this.conf = conf;\n-    // Get Server Thread name. Sometimes the Server is mocked so may not implement HasThread.\n+    // Get Server Thread name. Sometimes the Server is mocked so may not implement Thread.\n     // For example, in tests.\n-    String name = master instanceof HasThread? ((HasThread)master).getName():\n+    String name = master instanceof Thread? ((Thread)master).getName():", "originalCommit": "e31989c5a58ead98adf56907612b7095828cf096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIzODAwMg==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432238002", "bodyText": "Seems still needed, since the master here maybe a mocked one.\neg: DummyMasterServices in TestSplitLogManager, it extends MockNoopMasterServices which implement MasterServices, but does not extends Thread.\nThanks.", "author": "bsglz", "createdAt": "2020-05-29T03:36:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4Mzk1OA==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432283958", "bodyText": "We should not worry about mocked objects. Ideally, we can provide getName() default implementation in MasterServices and HMaster specifically can implement getName() as Thread.getName(), that way here the caller will just call: String name = master.getName();", "author": "virajjasani", "createdAt": "2020-05-29T06:39:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4NDY3Mw==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432284673", "bodyText": "However, there is no harm w/o this change as Stack said. Maybe good to take this clean-up in separate Jira if you would like.\nWill merge this PR in a while.", "author": "virajjasani", "createdAt": "2020-05-29T06:41:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI4NjU3NA==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432286574", "bodyText": "Good idea, will fix it in separate jira.\nThanks.", "author": "bsglz", "createdAt": "2020-05-29T06:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MDk1NA==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432290954", "bodyText": "Thanks @bsglz\nI just triggered one build. Let it go through and one result is out, will merge the PR.", "author": "virajjasani", "createdAt": "2020-05-29T06:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI5MzM0MQ==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432293341", "bodyText": "In addition, maybe we can just always use master.getServerName().toShortString() as name here, WDYT?", "author": "bsglz", "createdAt": "2020-05-29T07:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwMjUyMA==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432402520", "bodyText": "Yes, is should be fine. Does it match with ((Thread)master).getName() exactly? If so, let's do it now, else later.", "author": "virajjasani", "createdAt": "2020-05-29T10:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQwODczNg==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432408736", "bodyText": "Not exactly.\n\ngetName returns master/xxx:16000\nmaster.getServerName().toShortString() returns xxx:16000\n\nSo, will do it later.\nThanks.", "author": "bsglz", "createdAt": "2020-05-29T10:56:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTM1Mg=="}], "type": "inlineReview", "revised_code": {"commit": "2c5e5fd60c2919954852288b57239d221afb544a", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\nindex 78841920ca..b2e99b21a5 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/SplitLogManager.java\n\n@@ -121,7 +121,7 @@ public class SplitLogManager {\n       throws IOException {\n     this.server = master;\n     this.conf = conf;\n-    // Get Server Thread name. Sometimes the Server is mocked so may not implement Thread.\n+    // Get Server Thread name. Sometimes the Server is mocked so may not extends Thread.\n     // For example, in tests.\n     String name = master instanceof Thread? ((Thread)master).getName():\n         master.getServerName().toShortString();\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTQxOA==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432095418", "bodyText": "Ditto", "author": "saintstack", "createdAt": "2020-05-28T20:10:05Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/AssignmentManager.java", "diffHunk": "@@ -1908,9 +1907,9 @@ protected void queueAssign(final RegionStateNode regionNode) {\n   }\n \n   private void startAssignmentThread() {\n-    // Get Server Thread name. Sometimes the Server is mocked so may not implement HasThread.\n+    // Get Server Thread name. Sometimes the Server is mocked so may not implement Thread.\n     // For example, in tests.\n-    String name = master instanceof HasThread? ((HasThread)master).getName():\n+    String name = master instanceof Thread? ((Thread)master).getName():", "originalCommit": "e31989c5a58ead98adf56907612b7095828cf096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjIzODA2Nw==", "url": "https://github.com/apache/hbase/pull/1797#discussion_r432238067", "bodyText": "Ditto", "author": "bsglz", "createdAt": "2020-05-29T03:36:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA5NTQxOA=="}], "type": "inlineReview", "revised_code": null}, {"oid": "2c5e5fd60c2919954852288b57239d221afb544a", "url": "https://github.com/apache/hbase/commit/2c5e5fd60c2919954852288b57239d221afb544a", "message": "change implement to extends in comment", "committedDate": "2020-05-29T03:46:31Z", "type": "commit"}]}