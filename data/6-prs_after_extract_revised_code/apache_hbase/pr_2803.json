{"pr_number": 2803, "pr_title": "HBASE-25431 MAX_FILESIZE and MEMSTORE_FLUSHSIZE should not be set negative number", "pr_createdAt": "2020-12-22T09:26:18Z", "pr_url": "https://github.com/apache/hbase/pull/2803", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ5Mjg2NQ==", "url": "https://github.com/apache/hbase/pull/2803#discussion_r549492865", "bodyText": "Is this a little awkward? Should it be....\nlong maxFileSize = td.getMaxFileSize() == null? conf.getLong(HConstants.HREGION_MAX....): Long.parseLong(td.getMaxFileSize()); ?", "author": "saintstack", "createdAt": "2020-12-28T21:31:13Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/util/TableDescriptorChecker.java", "diffHunk": "@@ -82,8 +83,11 @@ public static void sanityCheck(final Configuration c, final TableDescriptor td)\n \n     // check max file size\n     long maxFileSizeLowerLimit = 2 * 1024 * 1024L; // 2M is the default lower limit\n-    long maxFileSize = td.getMaxFileSize();\n-    if (maxFileSize < 0) {\n+    String maxFileSizeValue = td.getValue(TableDescriptorBuilder.MAX_FILESIZE);\n+    long maxFileSize = maxFileSizeValue == null? -1 : Long.parseLong(maxFileSizeValue);\n+    // if not set MAX_FILESIZE in TableDescriptor,\n+    // use maxFileSizeLowerLimit instead to skip this check\n+    if (maxFileSizeValue == null) {", "originalCommit": "828a3259ea0b345dc6a658457af080ebe2b17b03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2MDczOA==", "url": "https://github.com/apache/hbase/pull/2803#discussion_r549560738", "bodyText": "Thanks for the suggestion, fix it now.", "author": "ZhaoBQ", "createdAt": "2020-12-29T04:07:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTQ5Mjg2NQ=="}], "type": "inlineReview", "revised_code": {"commit": "1bd55da6abfc2b95116dccd1e8ae7d6f1cc75124", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/util/TableDescriptorChecker.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/util/TableDescriptorChecker.java\nindex c7072e1470..30c07b325a 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/util/TableDescriptorChecker.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/util/TableDescriptorChecker.java\n\n@@ -83,13 +83,11 @@ public final class TableDescriptorChecker {\n \n     // check max file size\n     long maxFileSizeLowerLimit = 2 * 1024 * 1024L; // 2M is the default lower limit\n-    String maxFileSizeValue = td.getValue(TableDescriptorBuilder.MAX_FILESIZE);\n-    long maxFileSize = maxFileSizeValue == null? -1 : Long.parseLong(maxFileSizeValue);\n-    // if not set MAX_FILESIZE in TableDescriptor,\n-    // use maxFileSizeLowerLimit instead to skip this check\n-    if (maxFileSizeValue == null) {\n-      maxFileSize = conf.getLong(HConstants.HREGION_MAX_FILESIZE, maxFileSizeLowerLimit);\n-    }\n+    // if not set MAX_FILESIZE in TableDescriptor, and not set HREGION_MAX_FILESIZE in\n+    // hbase-site.xml, use maxFileSizeLowerLimit instead to skip this check\n+    long maxFileSize = td.getValue(TableDescriptorBuilder.MAX_FILESIZE) == null ?\n+      conf.getLong(HConstants.HREGION_MAX_FILESIZE, maxFileSizeLowerLimit) :\n+      Long.parseLong(td.getValue(TableDescriptorBuilder.MAX_FILESIZE));\n     if (maxFileSize < conf.getLong(\"hbase.hregion.max.filesize.limit\", maxFileSizeLowerLimit)) {\n       String message =\n           \"MAX_FILESIZE for table descriptor or \" + \"\\\"hbase.hregion.max.filesize\\\" (\" +\n"}}, {"oid": "11556eea694e008489f59d9f977b121a7ac827b5", "url": "https://github.com/apache/hbase/commit/11556eea694e008489f59d9f977b121a7ac827b5", "message": "HBASE-25431 MAX_FILESIZE and MEMSTORE_FLUSHSIZE should not be set negative number", "committedDate": "2020-12-29T03:49:18Z", "type": "commit"}, {"oid": "1bd55da6abfc2b95116dccd1e8ae7d6f1cc75124", "url": "https://github.com/apache/hbase/commit/1bd55da6abfc2b95116dccd1e8ae7d6f1cc75124", "message": "adopt suggestions and simplify the code", "committedDate": "2020-12-29T04:14:46Z", "type": "commit"}, {"oid": "1bd55da6abfc2b95116dccd1e8ae7d6f1cc75124", "url": "https://github.com/apache/hbase/commit/1bd55da6abfc2b95116dccd1e8ae7d6f1cc75124", "message": "adopt suggestions and simplify the code", "committedDate": "2020-12-29T04:14:46Z", "type": "forcePushed"}]}