{"pr_number": 2430, "pr_title": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it \u2026", "pr_createdAt": "2020-09-21T08:41:50Z", "pr_url": "https://github.com/apache/hbase/pull/2430", "timeline": [{"oid": "96204882cf19bfede9862f36a05fbaeb7424426f", "url": "https://github.com/apache/hbase/commit/96204882cf19bfede9862f36a05fbaeb7424426f", "message": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it easy to understand", "committedDate": "2020-09-21T08:48:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MzM0Nw==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r491893347", "bodyText": "Can we keep all accessors to ZKWatcher protected or at least, package private? In some cases, custom HBaseReplicationEndpoint implementations may need to access those.", "author": "wchevreuil", "createdAt": "2020-09-21T09:10:36Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -63,7 +121,7 @@ protected synchronized void disconnect() {\n    * A private method used to re-establish a zookeeper session with a peer cluster.\n    * @param ke\n    */\n-  protected void reconnect(KeeperException ke) {\n+  private void reconnect(KeeperException ke) {", "originalCommit": "96204882cf19bfede9862f36a05fbaeb7424426f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkxMDY2OQ==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r491910669", "bodyText": "This class is IA.Private, so it is not expected to be used by users. You can stop someone change this method this time but you can not stop them all the time. If you think this class should be used by users  so they can implement replication endpoint easier, let's promote this class to IA.LimitedPrivate?", "author": "Apache9", "createdAt": "2020-09-21T09:41:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTkyOTI1Ng==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r491929256", "bodyText": "Now only ReplicationEndpoint is IA.LimitedPrivate. So if one user want to use these logics, it is better to copy these code to their implementation.", "author": "infraio", "createdAt": "2020-09-21T10:11:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjU4ODYyNw==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r492588627", "bodyText": "So if one user want to use these logics, it is better to copy these code to their implementation.\n\nIt's not that simple, as it would actually require reimplement all other methods currently referring these private ones, leading to a reimplementation of the whole class.\nI agree with @Apache9 , if we are to guarantee a certain level of accessibility here, we should rather discuss about the interfaces audiences. I guess this would be rather a topic for a separate jira/PR, don't want to deviate this current one from it's original purpose.", "author": "wchevreuil", "createdAt": "2020-09-22T09:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzExMTU0MA==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r493111540", "bodyText": "There is a issue about this, see HBASE-15982.", "author": "infraio", "createdAt": "2020-09-23T00:48:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5MzM0Nw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTg5ODYxMQ==", "url": "https://github.com/apache/hbase/pull/2430#discussion_r491898611", "bodyText": "Same as my previous comment. Would be nice to allow for custom implementations to access this method.", "author": "wchevreuil", "createdAt": "2020-09-21T09:19:58Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java", "diffHunk": "@@ -150,13 +202,19 @@ public boolean isAborted() {\n \n   /**\n    * Get the list of all the region servers from the specified peer\n-   * @param zkw zk connection to use\n+   *\n    * @return list of region server addresses or an empty list if the slave is unavailable\n    */\n-  protected static List<ServerName> fetchSlavesAddresses(ZKWatcher zkw)\n-      throws KeeperException {\n-    List<String> children = ZKUtil.listChildrenAndWatchForNewChildren(zkw,\n-            zkw.getZNodePaths().rsZNode);\n+  private List<ServerName> fetchSlavesAddresses() {", "originalCommit": "96204882cf19bfede9862f36a05fbaeb7424426f", "replyToReviewId": null, "replies": null, "type": "inlineReview", "revised_code": {"commit": "bcd38f73fd901850c01bcb4ed228a7d72eb21214", "chunk": "diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java\nindex d8729724dc..d481fa98c4 100644\n--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java\n+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/HBaseReplicationEndpoint.java\n\n@@ -205,7 +207,7 @@ public abstract class HBaseReplicationEndpoint extends BaseReplicationEndpoint\n    *\n    * @return list of region server addresses or an empty list if the slave is unavailable\n    */\n-  private List<ServerName> fetchSlavesAddresses() {\n+  protected List<ServerName> fetchSlavesAddresses() {\n     List<String> children = null;\n     try {\n       children = ZKUtil.listChildrenAndWatchForNewChildren(zkw, zkw.getZNodePaths().rsZNode);\n"}}, {"oid": "bcd38f73fd901850c01bcb4ed228a7d72eb21214", "url": "https://github.com/apache/hbase/commit/bcd38f73fd901850c01bcb4ed228a7d72eb21214", "message": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it easy to understand", "committedDate": "2020-09-22T01:54:48Z", "type": "forcePushed"}, {"oid": "1cf0dbe9e3a227cb73f7efb94dabc8144f777b7a", "url": "https://github.com/apache/hbase/commit/1cf0dbe9e3a227cb73f7efb94dabc8144f777b7a", "message": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it easy to understand", "committedDate": "2020-09-22T01:56:32Z", "type": "forcePushed"}, {"oid": "09fc0689aa72eed21ce48751f61497f7ff759986", "url": "https://github.com/apache/hbase/commit/09fc0689aa72eed21ce48751f61497f7ff759986", "message": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it easy to understand", "committedDate": "2020-09-22T04:39:05Z", "type": "commit"}, {"oid": "09fc0689aa72eed21ce48751f61497f7ff759986", "url": "https://github.com/apache/hbase/commit/09fc0689aa72eed21ce48751f61497f7ff759986", "message": "HBASE-25074 Refactor ReplicationSinkManager: reduce code and make it easy to understand", "committedDate": "2020-09-22T04:39:05Z", "type": "forcePushed"}]}