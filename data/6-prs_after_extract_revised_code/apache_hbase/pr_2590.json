{"pr_number": 2590, "pr_title": "HBASE-25221 Backport HBASE-24368 Let HBCKSCP clear 'Unknown Servers', even if RegionStateNode has RegionLocation == null", "pr_createdAt": "2020-10-27T12:48:47Z", "pr_url": "https://github.com/apache/hbase/pull/2590", "timeline": [{"oid": "107e4fbe87a6d18a764f060185fb593c414a7606", "url": "https://github.com/apache/hbase/commit/107e4fbe87a6d18a764f060185fb593c414a7606", "message": "HBASE-25221 Backport HBASE-24368 Let HBCKSCP clear 'Unknown Servers', even if RegionStateNode has RegionLocation == null\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java\n Edit a log.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/HBCKServerCrashProcedure.java\n Add override of isMatchingRegionLocation. Allow 'null' as a pass in\n HBCKSCP.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ServerCrashProcedure.java\n Add a method for HBCKSCP to override and be less strict filtering\n assigns.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Some doc on what 'Unknown Servers' are.\n\nCo-authored-by: Peter Somogyi <psomogyi@apache.org>", "committedDate": "2020-10-27T17:59:25Z", "type": "commit"}, {"oid": "107e4fbe87a6d18a764f060185fb593c414a7606", "url": "https://github.com/apache/hbase/commit/107e4fbe87a6d18a764f060185fb593c414a7606", "message": "HBASE-25221 Backport HBASE-24368 Let HBCKSCP clear 'Unknown Servers', even if RegionStateNode has RegionLocation == null\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/GCMultipleMergedRegionsProcedure.java\n Edit a log.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/HBCKServerCrashProcedure.java\n Add override of isMatchingRegionLocation. Allow 'null' as a pass in\n HBCKSCP.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ServerCrashProcedure.java\n Add a method for HBCKSCP to override and be less strict filtering\n assigns.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Some doc on what 'Unknown Servers' are.\n\nCo-authored-by: Peter Somogyi <psomogyi@apache.org>", "committedDate": "2020-10-27T17:59:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NDI2OQ==", "url": "https://github.com/apache/hbase/pull/2590#discussion_r513044269", "bodyText": "I'm good w/ this. Just need to watch it.\nI've added changes and then found I sometimes made the situation worse. Need to watch out for that here but it is HBCKSCP, run by the operator, so they should be looking at the result when manually running hbck2.", "author": "saintstack", "createdAt": "2020-10-27T21:29:54Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/HBCKServerCrashProcedure.java", "diffHunk": "@@ -169,4 +170,16 @@ public boolean visit(Result result) throws IOException {\n       return this.reassigns;\n     }\n   }\n+\n+  /**\n+   * The RegionStateNode will not have a location if a confirm of an OPEN fails. On fail,\n+   * the RegionStateNode regionLocation is set to null. This is 'looser' than the test done\n+   * in the superclass. The HBCKSCP has been scheduled by an operator via hbck2 probably at the\n+   * behest of a report of an 'Unknown Server' in the 'HBCK Report'. Let the operators operation\n+   * succeed even in case where the region location in the RegionStateNode is null.\n+   */\n+  @Override\n+  protected boolean isMatchingRegionLocation(RegionStateNode rsn) {", "originalCommit": "107e4fbe87a6d18a764f060185fb593c414a7606", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NjUxOQ==", "url": "https://github.com/apache/hbase/pull/2590#discussion_r513046519", "bodyText": "Is it that the RSN is null but hbase:meta is an 'unknown server'?", "author": "saintstack", "createdAt": "2020-10-27T21:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NDI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NzYxMw==", "url": "https://github.com/apache/hbase/pull/2590#discussion_r513047613", "bodyText": "Yeah... it seems but the compare to RSN fails so we don't clean the unknown server... ok. Got it.", "author": "saintstack", "createdAt": "2020-10-27T21:37:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NDI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU3ODUxMQ==", "url": "https://github.com/apache/hbase/pull/2590#discussion_r513578511", "bodyText": "Yes, this is my understanding. Thanks for the review!", "author": "petersomogyi", "createdAt": "2020-10-28T16:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzA0NDI2OQ=="}], "type": "inlineReview", "revised_code": null}]}