{"pr_number": 2759, "pr_title": "HBASE-25356 HBaseAdmin#getRegion() needs to filter out non-regionName\u2026", "pr_createdAt": "2020-12-09T21:39:35Z", "pr_url": "https://github.com/apache/hbase/pull/2759", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMDMxNw==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r540410317", "bodyText": "Worth noting at trace level? Might be fun to enable trace logging on this class and see what users are sending in?", "author": "saintstack", "createdAt": "2020-12-10T18:44:08Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java", "diffHunk": "@@ -279,7 +279,9 @@ public static HRegionLocation getRegionLocation(Connection connection, byte[] re\n       parsedInfo = parseRegionInfoFromRegionName(regionName);\n       row = getMetaKeyForRegion(parsedInfo);\n     } catch (Exception parseEx) {\n-      // Ignore. This is used with tableName passed as regionName.\n+      // If it is not a valid regionName(i.e, tableName), it needs to return null here\n+      // as querying meta table wont help.", "originalCommit": "b67ccf5c41d1f28c5d46ac7d1832dab6efc4c1af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM3MjE0NQ==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r545372145", "bodyText": "I think non-regionName input comes from hbase shell, where user can input table name.", "author": "huaxiangsun", "createdAt": "2020-12-17T20:09:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMDMxNw=="}], "type": "inlineReview", "revised_code": null}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMjM5NQ==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r540412395", "bodyText": "There is Bytes.isHexDigit.  It is missing (c >= 'a' && c <= 'f'). Bytes might be better place for this than here?", "author": "saintstack", "createdAt": "2020-12-10T18:47:21Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java", "diffHunk": "@@ -1935,6 +1936,22 @@ protected Void postOperationResult(final Void result, final long deadlineTs)\n     }\n   }\n \n+  private boolean isHexChar(char c) {\n+    return (c >= 'A' && c <= 'F') || (c >= 'a' && c <= 'f') || (c >= '0' && c <= '9');", "originalCommit": "b67ccf5c41d1f28c5d46ac7d1832dab6efc4c1af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQyNTg4NA==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r540425884", "bodyText": "I tried poking around.. you'd think this sort of thing would be available in a lib... but I couldn't find an easy ref after looking for 5 mins.", "author": "saintstack", "createdAt": "2020-12-10T19:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQxMjM5NQ=="}], "type": "inlineReview", "revised_code": {"commit": "0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "chunk": "diff --git a/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\nindex c3390a2cb2..532481eba3 100644\n--- a/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\n+++ b/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\n\n@@ -1936,22 +1935,6 @@ public class HBaseAdmin implements Admin {\n     }\n   }\n \n-  private boolean isHexChar(char c) {\n-    return (c >= 'A' && c <= 'F') || (c >= 'a' && c <= 'f') || (c >= '0' && c <= '9');\n-\n-  }\n-  private boolean isMd5Hash(String encodedRegionName) {\n-    if (encodedRegionName.length() != MD5_HEX_LENGTH) {\n-      return false;\n-    }\n-    for (int i = 0; i < encodedRegionName.length(); i++) {\n-      if (!isHexChar(encodedRegionName.charAt(i))) {\n-        return false;\n-      }\n-    }\n-    return true;\n-  }\n-\n   /**\n    * @param regionName Name of a region.\n    * @return a pair of HRegionInfo and ServerName if <code>regionName</code> is\n"}}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQyNzY1NA==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r540427654", "bodyText": "Yeah, this should be elsewhere too (RegionInfo as a static since that is where you get the MD5 length from?)... Capitalize the 'd'.... so MD5, not md5.", "author": "saintstack", "createdAt": "2020-12-10T19:11:40Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java", "diffHunk": "@@ -1935,6 +1936,22 @@ protected Void postOperationResult(final Void result, final long deadlineTs)\n     }\n   }\n \n+  private boolean isHexChar(char c) {\n+    return (c >= 'A' && c <= 'F') || (c >= 'a' && c <= 'f') || (c >= '0' && c <= '9');\n+\n+  }\n+  private boolean isMd5Hash(String encodedRegionName) {", "originalCommit": "b67ccf5c41d1f28c5d46ac7d1832dab6efc4c1af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM3Mjg1OA==", "url": "https://github.com/apache/hbase/pull/2759#discussion_r545372858", "bodyText": "Done. I put the new isMD5Hash() in RegionInfo and embed isHexDigit inside this method.", "author": "huaxiangsun", "createdAt": "2020-12-17T20:10:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDQyNzY1NA=="}], "type": "inlineReview", "revised_code": {"commit": "0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "chunk": "diff --git a/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\nindex c3390a2cb2..532481eba3 100644\n--- a/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\n+++ b/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java\n\n@@ -1936,22 +1935,6 @@ public class HBaseAdmin implements Admin {\n     }\n   }\n \n-  private boolean isHexChar(char c) {\n-    return (c >= 'A' && c <= 'F') || (c >= 'a' && c <= 'f') || (c >= '0' && c <= '9');\n-\n-  }\n-  private boolean isMd5Hash(String encodedRegionName) {\n-    if (encodedRegionName.length() != MD5_HEX_LENGTH) {\n-      return false;\n-    }\n-    for (int i = 0; i < encodedRegionName.length(); i++) {\n-      if (!isHexChar(encodedRegionName.charAt(i))) {\n-        return false;\n-      }\n-    }\n-    return true;\n-  }\n-\n   /**\n    * @param regionName Name of a region.\n    * @return a pair of HRegionInfo and ServerName if <code>regionName</code> is\n"}}, {"oid": "0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "url": "https://github.com/apache/hbase/commit/0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "message": "HBASE-25356 HBaseAdmin#getRegion() needs to filter out non-regionName and non-encodedRegionName", "committedDate": "2020-12-17T20:06:33Z", "type": "commit"}, {"oid": "0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "url": "https://github.com/apache/hbase/commit/0f2ed94a35e21bb97bfd20f01400b9c1ae86460e", "message": "HBASE-25356 HBaseAdmin#getRegion() needs to filter out non-regionName and non-encodedRegionName", "committedDate": "2020-12-17T20:06:33Z", "type": "forcePushed"}]}